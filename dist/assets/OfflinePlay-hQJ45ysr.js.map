{"version":3,"file":"OfflinePlay-hQJ45ysr.js","sources":["../../src/utils/checkout.ts","../../src/components/CameraTile.tsx","../../src/utils/autoscore.ts","../../src/utils/dartDetector.ts","../../src/utils/scoring.ts","../../src/components/ui/ResizablePanel.tsx","../../src/store/heatmap.ts","../../src/store/matchControl.ts","../../src/components/CameraView.tsx","../../src/components/HeatMap.tsx","../../src/game/types.ts","../../src/game/aroundTheClock.ts","../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/game/ticTacToe.ts","../../src/game/scamFivesSevens.ts","../../src/game/americanCricket.ts","../../src/components/ui/GameHeaderBar.tsx","../../src/components/scoreboards/GameScoreboard.tsx","../../src/components/matchControlAdapters.ts","../../src/logic/matchActions.ts","../../src/components/scoreboards/useGameStats.ts","../../src/components/OfflinePlay.tsx"],"sourcesContent":["// Very lightweight checkout suggestions. For proper coverage consider a full table.\n// Returns up to a few route strings like \"T20 T20 D20\" for a given remaining.\n\nconst doubles = [\n  \"D1\",\n  \"D2\",\n  \"D3\",\n  \"D4\",\n  \"D5\",\n  \"D6\",\n  \"D7\",\n  \"D8\",\n  \"D9\",\n  \"D10\",\n  \"D11\",\n  \"D12\",\n  \"D13\",\n  \"D14\",\n  \"D15\",\n  \"D16\",\n  \"D17\",\n  \"D18\",\n  \"D19\",\n  \"D20\",\n  \"DB\",\n];\n\nfunction dVal(tag: string): number {\n  if (tag === \"DB\") return 50;\n  const n = Number(tag.slice(1));\n  return n * 2;\n}\n\nfunction prefsDoubleScore(fav: string): number {\n  if (!doubles.includes(fav)) return 32; // default D16\n  return dVal(fav);\n}\n\nexport function suggestCheckouts(\n  remaining: number,\n  favoriteDouble: string = \"D16\",\n): string[] {\n  if (remaining > 170 || remaining <= 1) return [];\n  // Simple known highest routes for popular numbers, then fall back to greedy towards favourite double\n  const hardcoded: Record<number, string[]> = {\n    170: [\"T20 T20 DB\"],\n    167: [\"T20 T19 DB\"],\n    164: [\"T20 T18 DB\"],\n    161: [\"T20 T17 DB\"],\n    160: [\"T20 T20 D20\"],\n    158: [\"T20 T20 D19\"],\n    157: [\"T20 T19 D20\"],\n    156: [\"T20 T20 D18\"],\n    155: [\"T20 T19 D19\"],\n    154: [\"T20 T18 D20\"],\n    153: [\"T20 T19 D18\"],\n    152: [\"T20 T20 D16\"],\n    151: [\"T20 T17 D20\"],\n    150: [\"T20 T18 D18\"],\n    149: [\"T20 T19 D16\"],\n    148: [\"T20 T16 D20\"],\n    147: [\"T20 T17 D18\"],\n    146: [\"T20 T18 D16\"],\n    145: [\"T20 T15 D20\"],\n    144: [\"T20 T20 D12\"],\n    141: [\"T20 T19 D12\"],\n    140: [\"T20 T20 D10\"],\n    137: [\"T20 T19 D10\"],\n    136: [\"T20 T20 D8\"],\n    132: [\"BULL T14 D20\", \"T20 T12 D8\"],\n    130: [\"T20 T20 D5\", \"T20 T18 D8\"],\n    129: [\"T19 T16 D12\"],\n    128: [\"T18 T14 D16\"],\n    127: [\"T20 T17 D8\"],\n    126: [\"T19 T19 D6\"],\n    121: [\"T20 11 D20\", \"T20 T15 D8\"],\n    120: [\"T20 20 D20\", \"T20 S20 D20\"],\n    110: [\"T20 10 D20\"],\n    100: [\"T20 D20\"],\n    99: [\"T19 10 D16\", \"T19 S10 D16\"],\n    97: [\"T19 D20\"],\n    96: [\"T20 D18\"],\n    95: [\"T19 D19\"],\n    94: [\"T18 D20\"],\n    92: [\"T20 D16\"],\n    90: [\"T18 D18\", \"T20 D15\"],\n    86: [\"T18 D16\"],\n    84: [\"T20 D12\", \"T16 D18\"],\n    82: [\"BULL D16\", \"T14 D20\"],\n    81: [\"T19 D12\"],\n    80: [\"T20 D10\", \"D20 D20\"],\n    78: [\"T18 D12\"],\n    76: [\"T20 D8\", \"T16 D14\"],\n    74: [\"T14 D16\", \"T18 D10\"],\n    72: [\"T16 D12\", \"T20 D6\"],\n    70: [\"T18 D8\", \"S20 BULL\"],\n    68: [\"T20 D4\", \"T16 D10\"],\n    66: [\"T10 D18\", \"T14 D12\"],\n    64: [\"T16 D8\", \"D16 D16\"],\n    62: [\"T10 D16\", \"T12 D13\"],\n    60: [\"20 D20\", \"S20 D20\"],\n    58: [\"18 D20\", \"S18 D20\"],\n    56: [\"16 D20\", \"S16 D20\"],\n    54: [\"14 D20\", \"S14 D20\"],\n    52: [\"20 D16\", \"S20 D16\"],\n    50: [\"BULL\", \"10 D20\"],\n    48: [\"16 D16\", \"S16 D16\"],\n    46: [\"14 D16\"],\n    44: [\"12 D16\"],\n    42: [\"10 D16\"],\n    40: [\"D20\"],\n    38: [\"D19\"],\n    36: [\"D18\"],\n    34: [\"D17\"],\n    32: [\"D16\"],\n    30: [\"D15\"],\n    28: [\"D14\"],\n    26: [\"D13\"],\n    24: [\"D12\"],\n    22: [\"D11\"],\n    20: [\"D10\"],\n    18: [\"D9\"],\n    16: [\"D8\"],\n    14: [\"D7\"],\n    12: [\"D6\"],\n    10: [\"D5\"],\n    8: [\"D4\"],\n    6: [\"D3\"],\n    4: [\"D2\"],\n    2: [\"D1\"],\n  };\n  if (hardcoded[remaining]) return hardcoded[remaining];\n  // Greedy fallback: aim to leave favourite double if possible in two darts\n  const target = prefsDoubleScore(favoriteDouble);\n  const routes: string[] = [];\n  // Try to hit a treble/big single that leaves the fav double\n  for (const t of [60, 57, 54, 51, 48]) {\n    // T20..T16\n    const left = remaining - t;\n    if (left === target) {\n      routes.push(`T${t / 3} ${favoriteDouble}`);\n      break;\n    }\n  }\n  if (!routes.length) {\n    for (const s of [20, 19, 18, 17, 16, 15]) {\n      const left = remaining - s;\n      if (left === target) {\n        routes.push(`${s} ${favoriteDouble}`);\n        break;\n      }\n    }\n  }\n  return routes;\n}\n\nexport function sayScore(\n  name: string,\n  scored: number,\n  remaining: number,\n  voiceName?: string,\n  opts?: { volume?: number; checkoutOnly?: boolean },\n) {\n  try {\n    const synth = window.speechSynthesis;\n    if (!synth) return;\n    const msg = new SpeechSynthesisUtterance();\n    const isCheckout = remaining <= 170 && remaining > 0;\n    const isOneEighty = scored === 180;\n    const shouldAnnounce = !opts?.checkoutOnly || isCheckout || isOneEighty;\n    if (!shouldAnnounce) return;\n\n    if (isOneEighty) {\n      msg.text = `${name}! One eighty!`;\n      msg.rate = 1.04;\n      msg.pitch = 1.15;\n    } else if (isCheckout) {\n      msg.text = `${name}, ${remaining} remaining.`;\n      msg.rate = 1.0;\n      msg.pitch = 1.0;\n    } else if (scored === 0) {\n      msg.text = `${name}, no score.`;\n      msg.rate = 1.0;\n      msg.pitch = 1.0;\n    } else {\n      msg.text = `${name}, ${scored}.`;\n      msg.rate = 1.0;\n      msg.pitch = 1.0;\n    }\n    if (voiceName) {\n      const v = synth.getVoices().find((v) => v.name === voiceName);\n      if (v) msg.voice = v;\n    }\n    if (typeof opts?.volume === \"number\")\n      msg.volume = Math.max(0, Math.min(1, opts.volume));\n    else msg.volume = 1;\n    try {\n      synth.cancel();\n    } catch {}\n    synth.speak(msg);\n  } catch {}\n}\n","/* eslint-disable jsx-a11y/media-has-caption */\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  type CSSProperties,\n} from \"react\";\nimport { dlog } from \"../utils/logger\";\nimport { useUserSettings } from \"../store/userSettings\";\nimport {\n  useCameraSession,\n  type CameraStreamMode,\n} from \"../store/cameraSession\";\nimport {\n  discoverNetworkDevices,\n  connectToNetworkDevice,\n  type NetworkDevice,\n  discoverUSBDevices,\n  requestUSBDevice,\n  connectToUSBDevice,\n  type USBDevice,\n} from \"../utils/networkDevices\";\nimport { apiFetch } from \"../utils/api\";\n\ntype CameraTileProps = {\n  label?: string;\n  autoStart?: boolean;\n  scale?: number;\n  className?: string;\n  aspect?: \"inherit\" | \"wide\" | \"square\" | \"portrait\" | \"classic\" | \"free\";\n  style?: CSSProperties;\n  fill?: boolean;\n  // Offline mode props\n  user?: any;\n  playerScore?: number;\n  aiScore?: number;\n  x01Score?: number;\n  inMatch?: boolean;\n  showWinPopup?: boolean;\n  pendingLegWinner?: \"player\" | \"ai\" | null;\n  playerDartsThrown?: number;\n  aiDartsThrown?: number;\n  totalPlayerDarts?: number;\n  totalAiDarts?: number;\n  totalPlayerPoints?: number;\n  totalAiPoints?: number;\n  player180s?: number;\n  player140s?: number;\n  player100s?: number;\n  ai180s?: number;\n  ai140s?: number;\n  ai100s?: number;\n  playerHighestCheckout?: number;\n  aiHighestCheckout?: number;\n  onClose?: () => void;\n  onOpen?: () => void;\n  layout?: \"classic\" | \"modern\";\n};\n\nexport default function CameraTile({\n  label,\n  autoStart,\n  scale: scaleOverride,\n  className,\n  aspect = \"inherit\",\n  style,\n  fill = false,\n}: CameraTileProps) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const cameraSession = useCameraSession();\n  const [streaming, setStreaming] = useState(false);\n  const [ws, setWs] = useState<WebSocket | null>(null);\n  const [pairCode, setPairCode] = useState<string | null>(null);\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null);\n  const lastRegisteredModeRef = useRef<CameraStreamMode | null>(null);\n  const registerStream = useCallback(\n    (stream: MediaStream | null, modeOverride: CameraStreamMode = \"local\") => {\n      try {\n        if (stream) {\n          cameraSession.setMediaStream(stream);\n          if (videoRef.current) {\n            cameraSession.setVideoElementRef(videoRef.current);\n          }\n          cameraSession.setMode(modeOverride);\n          cameraSession.setStreaming(true);\n          lastRegisteredModeRef.current = modeOverride;\n        } else if (\n          lastRegisteredModeRef.current &&\n          lastRegisteredModeRef.current !== \"phone\"\n        ) {\n          cameraSession.setStreaming(false);\n          cameraSession.setMediaStream(null);\n          lastRegisteredModeRef.current = null;\n        }\n      } catch (err) {\n        console.warn(\n          \"[CameraTile] Failed to register stream with camera session:\",\n          err,\n        );\n      }\n    },\n    [cameraSession],\n  );\n\n  // Initialize mode: prioritize phone camera if preferred, otherwise use localStorage\n  const preferredCameraLabel = useUserSettings((s) => s.preferredCameraLabel);\n  const [mode, setMode] = useState<\"local\" | \"phone\" | \"wifi\">(() => {\n    // If phone camera is selected, start in phone mode\n    if (preferredCameraLabel === \"Phone Camera\") {\n      dlog(\n        \"[CAMERATILE] Initializing mode to phone (from preferred camera selection)\",\n      );\n      return \"phone\";\n    }\n    // Otherwise use saved mode or default to local\n    const saved = localStorage.getItem(\"ndn:camera:mode\") as any;\n    dlog(\n      \"[CAMERATILE] Initializing mode to\",\n      saved || \"local\",\n      \"(from localStorage)\",\n    );\n    return saved || \"local\";\n  });\n\n  const [, setExpiresAt] = useState<number | null>(null);\n  const [, setPaired] = useState<boolean>(false);\n  const [lanHost, setLanHost] = useState<string | null>(null);\n  const [httpsInfo, setHttpsInfo] = useState<{\n    https: boolean;\n    port: number;\n  } | null>(null);\n  const [showTips, setShowTips] = useState<boolean>(true);\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([]);\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false);\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([]);\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false);\n  const autoscoreProvider = useUserSettings((s) => s.autoscoreProvider);\n  const cameraEnabledSetting = useUserSettings((s) => s.cameraEnabled);\n  const setPreferredCameraLocked = useUserSettings(\n    (s) => s.setPreferredCameraLocked,\n  );\n  const preferredCameraLocked = useUserSettings((s) => s.preferredCameraLocked);\n  const setPreferredCamera = useUserSettings((s) => s.setPreferredCamera);\n  const preferredCameraId = useUserSettings((s) => s.preferredCameraId);\n\n  if (autoscoreProvider === \"manual\") {\n    const fallbackBase = fill\n      ? \"rounded-2xl overflow-hidden bg-black w-full flex flex-col\"\n      : \"rounded-2xl overflow-hidden bg-black w-full mx-auto\";\n    const fallbackClass = [fallbackBase, className]\n      .filter(Boolean)\n      .join(\" \")\n      .trim();\n    const fallbackStyle: CSSProperties = { ...(style || {}) };\n    if (\n      !fill &&\n      fallbackStyle.aspectRatio === undefined &&\n      fallbackStyle.height === undefined &&\n      fallbackStyle.minHeight === undefined\n    ) {\n      fallbackStyle.aspectRatio = \"4 / 3\";\n    }\n    return (\n      <div className={fallbackClass} style={fallbackStyle}>\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\n          Manual scoring mode active â€” camera feeds are disabled.\n        </div>\n      </div>\n    );\n  }\n  useEffect(() => {\n    const h = window.location.hostname;\n    if (h === \"localhost\" || h === \"127.0.0.1\") {\n      apiFetch(`/api/hosts`)\n        .then((r) => r.json())\n        .then((j) => {\n          const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x);\n          if (ip) setLanHost(ip);\n        })\n        .catch(() => {});\n    }\n    // Detect HTTPS support for the phone link\n    apiFetch(`/api/https-info`)\n      .then((r) => r.json())\n      .then((j) => {\n        if (j && typeof j.https === \"boolean\")\n          setHttpsInfo({ https: !!j.https, port: Number(j.port) || 8788 });\n      })\n      .catch(() => {});\n  }, []);\n  const mobileUrl = useMemo(() => {\n    const code = pairCode || \"____\";\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined;\n    if (envUrl && envUrl.length > 0) {\n      try {\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\n        const u = new URL(envUrl);\n        const isSecure = u.protocol === \"wss:\";\n        const origin = `${isSecure ? \"https\" : \"http\"}://${u.host}${u.pathname.endsWith(\"/ws\") ? \"\" : u.pathname}`;\n        const base = origin.replace(/\\/?ws$/i, \"\");\n        return `${base}/mobile-cam.html?code=${code}`;\n      } catch {}\n    }\n    // Fallback to local development: prefer LAN host if detected\n    const host = lanHost || window.location.hostname;\n    const useHttps = !!httpsInfo?.https;\n    const port = useHttps ? httpsInfo?.port || 8788 : 8787;\n    const proto = useHttps ? \"https\" : \"http\";\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`;\n  }, [pairCode, lanHost, httpsInfo]);\n  useEffect(() => {\n    dlog(\"[CAMERATILE] Mode changed to:\", mode, \"- persisting to localStorage\");\n    localStorage.setItem(\"ndn:camera:mode\", mode);\n  }, [mode]);\n\n  const [manualModeSetAt, setManualModeSetAt] = useState<number | null>(null);\n\n  // start/stop are implemented later (deduplicated); keep single definition below.\n\n  // Sync phone camera selection from Calibrator into CameraTile mode state\n  // When user locks in phone camera in Calibrator, it updates preferredCameraLabel\n  // This effect ensures CameraTile's UI reflects that selection\n  useEffect(() => {\n    const ignore = useUserSettings.getState().ignorePreferredCameraSync;\n    dlog(\n      \"[CAMERATILE] Checking camera selection sync: preferredCameraLabel=\",\n      preferredCameraLabel,\n      \"mode=\",\n      mode,\n      \"ignoreSync=\",\n      ignore,\n      \"manualModeSetAt=\",\n      manualModeSetAt,\n    );\n    if (ignore) return;\n    // If user manually changed mode recently, avoid auto-syncing preferred camera\n    if (manualModeSetAt && Date.now() - manualModeSetAt < 30_000) return;\n    if (preferredCameraLabel === \"Phone Camera\" && mode !== \"phone\") {\n      dlog(\"[CAMERATILE] Syncing mode to phone from Calibrator selection\");\n      setMode(\"phone\");\n    }\n  }, [preferredCameraLabel, mode, manualModeSetAt]);\n\n  // Intentionally disabled automatic regeneration of phone pairing codes.\n  // Codes will only be created when the user explicitly requests it (button click).\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\n\n  useEffect(() => {\n    if (\n      !cameraEnabledSetting ||\n      (autoscoreProvider &&\n        autoscoreProvider !== \"built-in\" &&\n        autoscoreProvider !== \"external-ws\")\n    )\n      return;\n    if (autoStart === undefined) return;\n    if (autoStart) {\n      let cancelled = false;\n      const desiredLabel = preferredCameraLabel || \"default\";\n      const timer = window.setTimeout(() => {\n        if (cancelled || streaming) return;\n        start().catch((err) =>\n          console.warn(\n            `[CameraTile] Auto-start failed for ${desiredLabel}:`,\n            err,\n          ),\n        );\n      }, 200);\n      return () => {\n        cancelled = true;\n        window.clearTimeout(timer);\n      };\n    }\n    stop();\n  }, [\n    autoStart,\n    streaming,\n    cameraEnabledSetting,\n    autoscoreProvider,\n    preferredCameraLabel,\n    start,\n    stop,\n  ]);\n\n  // If the user selected Phone Camera, bind the global stream into this tile\n  useEffect(() => {\n    const apply = async () => {\n      try {\n        const allowPhoneAttach =\n          (preferredCameraLabel === \"Phone Camera\" &&\n            (!manualModeSetAt || Date.now() - manualModeSetAt >= 30_000)) ||\n          mode === \"phone\";\n        if (!allowPhoneAttach) return;\n        const s = cameraSession.getMediaStream();\n        const v = videoRef.current;\n        if (!v || !s) return;\n        if (v.srcObject !== s) {\n          v.srcObject = s;\n        }\n        v.muted = true;\n        (v as any).playsInline = true;\n        try {\n          await v.play();\n        } catch {}\n        setStreaming(true);\n      } catch {}\n    };\n    // Try immediately and poll briefly to catch late-arriving stream\n    apply();\n    const t = setInterval(apply, 800);\n    return () => clearInterval(t);\n  }, [preferredCameraLabel, mode, cameraSession, cameraSession.isStreaming]);\n\n  const start = useCallback(async () => {\n    dlog(\"[CameraTile] start() invoked with mode=\", mode);\n    if (mode === \"wifi\") {\n      return startWifiConnection();\n    }\n    dlog(\"[CameraTile] Attempting to attach global stream for phone mode...\");\n\n    // If phone camera is selected and paired, don't try to start local camera\n    if (preferredCameraLabel === \"Phone Camera\" || mode === \"phone\") {\n      const s = cameraSession.getMediaStream();\n      if (s && videoRef.current) {\n        try {\n          videoRef.current.srcObject = s;\n          await videoRef.current.play();\n          setStreaming(true);\n          return;\n        } catch {}\n      }\n      // If no global stream yet, for phone mode we should attempt pairing\n      if (mode === \"phone\") {\n        try {\n          await startPhonePairing();\n          return;\n        } catch {}\n      }\n    }\n\n    try {\n      // Prefer saved camera if available\n      const { preferredCameraId, setPreferredCamera } =\n        useUserSettings.getState();\n      const constraints: MediaStreamConstraints = preferredCameraId\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false }\n        : { video: true, audio: false };\n      let stream: MediaStream;\n      try {\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\n      } catch (err: any) {\n        const name = (err && (err.name || err.code)) || \"\";\n        if (\n          preferredCameraId &&\n          (name === \"OverconstrainedError\" || name === \"NotFoundError\")\n        ) {\n          stream = await navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: false,\n          });\n        } else {\n          throw err;\n        }\n      }\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await videoRef.current.play();\n        setStreaming(true);\n        registerStream(stream, \"local\");\n      }\n      // Camera started successfully - no automatic preference updates\n    } catch {}\n  }, [mode, preferredCameraLabel, cameraSession, registerStream, startPhonePairing, startWifiConnection]);\n  const stop = useCallback(() => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks();\n      tracks.forEach((t) => t.stop());\n      videoRef.current.srcObject = null;\n      setStreaming(false);\n      registerStream(null);\n    }\n  }, [registerStream]);\n\n  async function startWifiConnection() {\n    setDiscoveringWifi(true);\n    try {\n      const devices = await discoverNetworkDevices();\n      setWifiDevices(devices);\n      if (devices.length === 0) {\n        alert(\n          \"No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.\",\n        );\n      }\n    } catch (error) {\n      console.error(\"Wifi device discovery failed:\", error);\n      alert(\n        \"Failed to discover wifi devices. Please check your network connection.\",\n      );\n    } finally {\n      setDiscoveringWifi(false);\n    }\n  }\n\n  async function connectToWifiDevice(device: NetworkDevice) {\n    try {\n      setWifiDevices((devices) =>\n        devices.map((d) =>\n          d.id === device.id ? { ...d, status: \"connecting\" as const } : d,\n        ),\n      );\n\n      const stream = await connectToNetworkDevice(device);\n      if (stream && videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await videoRef.current.play();\n        setStreaming(true);\n        registerStream(stream, \"wifi\");\n        setWifiDevices((devices) =>\n          devices.map((d) =>\n            d.id === device.id ? { ...d, status: \"online\" as const } : d,\n          ),\n        );\n      } else {\n        throw new Error(\"Failed to get video stream\");\n      }\n    } catch (error) {\n      console.error(\"Failed to connect to wifi device:\", error);\n      alert(\n        `Failed to connect to ${device.name}. Please check the device and try again.`,\n      );\n      setWifiDevices((devices) =>\n        devices.map((d) =>\n          d.id === device.id ? { ...d, status: \"offline\" as const } : d,\n        ),\n      );\n    }\n  }\n\n  async function startUsbConnection() {\n    setDiscoveringUsb(true);\n    try {\n      // First try to get already paired devices\n      const devices = await discoverUSBDevices();\n      setUsbDevices(devices);\n\n      // Then request user to select a new device\n      const newDevice = await requestUSBDevice();\n      if (newDevice) {\n        setUsbDevices((prev) => [...prev, newDevice]);\n      }\n\n      if (devices.length === 0 && !newDevice) {\n        alert(\n          \"No USB scoring devices found. Please connect a device and try again.\",\n        );\n      }\n    } catch (error) {\n      console.error(\"USB device discovery failed:\", error);\n      alert(\"Failed to discover USB devices. Please check device connections.\");\n    } finally {\n      setDiscoveringUsb(false);\n    }\n  }\n\n  async function connectToUsbDevice(device: USBDevice) {\n    try {\n      setUsbDevices((devices) =>\n        devices.map((d) =>\n          d.id === device.id ? { ...d, status: \"connecting\" as const } : d,\n        ),\n      );\n      const stream = await connectToUSBDevice(device);\n      if (stream && videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await videoRef.current.play();\n        setStreaming(true);\n        setMode(\"wifi\"); // Using wifi mode for USB devices too\n        registerStream(stream, \"wifi\");\n        setUsbDevices((devices) =>\n          devices.map((d) =>\n            d.id === device.id ? { ...d, status: \"online\" as const } : d,\n          ),\n        );\n      } else {\n        throw new Error(\"Failed to get video stream\");\n      }\n    } catch (error) {\n      console.error(\"Failed to connect to USB device:\", error);\n      alert(\n        `Failed to connect to ${device.name}. Please check the device and try again.`,\n      );\n      setUsbDevices((devices) =>\n        devices.map((d) =>\n          d.id === device.id ? { ...d, status: \"offline\" as const } : d,\n        ),\n      );\n    }\n  }\n\n  // Listen for global event to start local camera from other UI components\n  const handleModeSelect = useCallback(\n    (newMode: \"local\" | \"phone\" | \"wifi\" | \"usb\") => {\n      try {\n        setMode(newMode === \"usb\" ? \"wifi\" : newMode);\n        setManualModeSetAt(Date.now());\n        // Persist the user's selection and lock it to avoid auto-switching\n        try {\n          if (newMode === \"local\") {\n            try {\n              setPreferredCamera(preferredCameraId, \"Local\", true);\n            } catch {}\n            try {\n              setPreferredCameraLocked(true);\n            } catch {}\n          } else if (newMode === \"phone\") {\n            try {\n              setPreferredCamera(undefined, \"Phone Camera\", true);\n            } catch {}\n            try {\n              setPreferredCameraLocked(true);\n            } catch {}\n          } else if (newMode === \"wifi\" || newMode === \"usb\") {\n            try {\n              setPreferredCamera(undefined, \"WiFi/USB\", true);\n            } catch {}\n            try {\n              setPreferredCameraLocked(true);\n            } catch {}\n          }\n        } catch {}\n        if (newMode === \"local\") {\n          start().catch(() => {});\n        } else if (newMode === \"phone\") {\n          startPhonePairing();\n        } else if (newMode === \"wifi\") {\n          startWifiConnection();\n        } else if (newMode === \"usb\") {\n          startUsbConnection();\n        }\n      } catch (err) {\n        console.warn(\"[CameraTile] handleModeSelect failed\", err);\n      }\n    },\n    [\n      start,\n      startPhonePairing,\n      startWifiConnection,\n      startUsbConnection,\n      setPreferredCamera,\n      setPreferredCameraLocked,\n      preferredCameraId,\n    ],\n  );\n\n  useEffect(() => {\n    const onStart = (ev: any) => {\n      try {\n        const modeFromEvent = ev && ev.detail && ev.detail.mode;\n        if (\n          modeFromEvent &&\n          [\"local\", \"phone\", \"wifi\", \"usb\"].includes(modeFromEvent)\n        ) {\n          // Respect explicit mode requests and treat as manual selection\n          handleModeSelect(modeFromEvent);\n          // Ensure start is invoked after selection is applied\n          start().catch(() => {});\n        } else {\n          // No explicit mode provided â€” just try to start current mode\n          start().catch(() => {});\n        }\n      } catch {}\n    };\n    window.addEventListener(\"ndn:start-camera\" as any, onStart as any);\n    return () => {\n      window.removeEventListener(\"ndn:start-camera\" as any, onStart as any);\n    };\n  }, [start, handleModeSelect]);\n\n  // Phone pairing via WebRTC\n  function ensureWS() {\n    if (ws && ws.readyState === WebSocket.OPEN) return ws;\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined;\n    const normalizedEnv =\n      envUrl && envUrl.length > 0\n        ? envUrl.endsWith(\"/ws\")\n          ? envUrl\n          : envUrl.replace(/\\/$/, \"\") + \"/ws\"\n        : undefined;\n    const proto = window.location.protocol === \"https:\" ? \"wss\" : \"ws\";\n    const sameOrigin = `${proto}://${window.location.host}/ws`;\n    const host = window.location.hostname;\n    const isLocalhost = host === \"localhost\" || host === \"127.0.0.1\";\n    const isRenderHost = host.endsWith(\"onrender.com\");\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\n    const renderWS = `wss://ninedartnation.onrender.com/ws`;\n    let url = normalizedEnv;\n    if (!url) {\n      if (isLocalhost) {\n        url = `${proto}://${host}:8787/ws`;\n      } else if (isRenderHost) {\n        url = sameOrigin;\n      } else {\n        url = renderWS;\n      }\n    }\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\n    if (!url) url = sameOrigin;\n    const socket = new WebSocket(url);\n    setWs(socket);\n    return socket;\n  }\n  async function startPhonePairing() {\n    setMode(\"phone\");\n    setPaired(false);\n    const socket = ensureWS();\n    if (socket.readyState === WebSocket.OPEN) {\n      socket.send(JSON.stringify({ type: \"cam-create\" }));\n    } else {\n      socket.onopen = () => socket.send(JSON.stringify({ type: \"cam-create\" }));\n    }\n    socket.onmessage = async (ev) => {\n      const data = JSON.parse(ev.data);\n      if (data.type === \"cam-code\") {\n        setPairCode(data.code);\n        if (data.expiresAt) setExpiresAt(data.expiresAt);\n      } else if (data.type === \"cam-peer-joined\") {\n        setPaired(true);\n        // Create offer to the phone\n        const peer = new RTCPeerConnection({\n          iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }],\n        });\n        setPc(peer);\n        peer.onicecandidate = (e) => {\n          if (e.candidate && pairCode)\n            socket.send(\n              JSON.stringify({\n                type: \"cam-ice\",\n                code: pairCode,\n                payload: e.candidate,\n              }),\n            );\n        };\n        peer.ontrack = (ev) => {\n          if (videoRef.current) {\n            const inbound = ev.streams?.[0];\n            if (inbound) {\n              videoRef.current.srcObject = inbound;\n              videoRef.current.play().catch(() => {});\n              setStreaming(true);\n            }\n          }\n        };\n        const offer = await peer.createOffer({\n          offerToReceiveAudio: false,\n          offerToReceiveVideo: true,\n        });\n        await peer.setLocalDescription(offer);\n        if (pairCode)\n          socket.send(\n            JSON.stringify({\n              type: \"cam-offer\",\n              code: pairCode,\n              payload: offer,\n            }),\n          );\n      } else if (data.type === \"cam-answer\") {\n        if (pc)\n          await pc.setRemoteDescription(\n            new RTCSessionDescription(data.payload),\n          );\n      } else if (data.type === \"cam-ice\") {\n        if (pc)\n          try {\n            await pc.addIceCandidate(data.payload);\n          } catch {}\n      }\n    };\n  }\n  function regenerateCode() {\n    setPairCode(null);\n    setExpiresAt(null);\n    setPaired(false);\n    if (ws && ws.readyState === WebSocket.OPEN) {\n      ws.send(JSON.stringify({ type: \"cam-create\" }));\n    } else {\n      startPhonePairing();\n    }\n    try {\n      setPreferredCameraLocked(true);\n    } catch {}\n  }\n\n  function stopAll() {\n    stop();\n    setPairCode(null);\n    setPaired(false);\n    setExpiresAt(null);\n    if (pc) {\n      try {\n        pc.close();\n      } catch {}\n      setPc(null);\n    }\n  }\n  return (\n    <CameraFrame\n      label={label}\n      autoStart={autoStart}\n      start={start}\n      stopAll={stopAll}\n      startPhonePairing={startPhonePairing}\n      startWifiConnection={startWifiConnection}\n      startUsbConnection={startUsbConnection}\n      connectToWifiDevice={connectToWifiDevice}\n      connectToUsbDevice={connectToUsbDevice}\n      videoRef={videoRef}\n      streaming={streaming}\n      mode={mode}\n      setMode={setMode}\n      pairCode={pairCode}\n      mobileUrl={mobileUrl}\n      regenerateCode={regenerateCode}\n      httpsInfo={httpsInfo}\n      showTips={showTips}\n      setShowTips={setShowTips}\n      wifiDevices={wifiDevices}\n      usbDevices={usbDevices}\n      discoveringWifi={discoveringWifi}\n      discoveringUsb={discoveringUsb}\n      scaleOverride={scaleOverride}\n      className={className}\n      aspect={aspect}\n      style={style}\n      fill={fill}\n      onModeSelect={handleModeSelect}\n      preferredCameraLocked={preferredCameraLocked}\n    />\n  );\n}\n\nfunction CameraFrame(props: any) {\n  const cameraSession = useCameraSession();\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings();\n  const {\n    label,\n    start,\n    stopAll,\n    startPhonePairing,\n    startWifiConnection,\n    startUsbConnection,\n    connectToWifiDevice,\n    connectToUsbDevice,\n    videoRef,\n    streaming,\n    mode,\n    setMode,\n    onModeSelect,\n    pairCode,\n    mobileUrl,\n    regenerateCode,\n    httpsInfo,\n    showTips,\n    setShowTips,\n    wifiDevices,\n    usbDevices,\n    discoveringWifi,\n    discoveringUsb,\n    className,\n    aspect,\n    style,\n    fill,\n    preferredCameraLocked,\n  } = props;\n\n  const modeDisplayName: Record<string, string> = {\n    local: \"Local\",\n    phone: \"PhoneCam\",\n    wifi: \"Wi-Fi/USB\",\n  };\n\n  const reconnectOptions = useMemo(() => {\n    return [\n      {\n        id: \"local\",\n        title: \"Local camera\",\n        description: \"Use the desktop webcam or capture card.\",\n        action: () => {\n          if (onModeSelect) onModeSelect(\"local\");\n        },\n      },\n      {\n        id: \"phone\",\n        title: \"PhoneCam\",\n        description: \"Stream from your phone via the mobile link.\",\n        action: () => {\n          if (onModeSelect) onModeSelect(\"phone\");\n        },\n      },\n      {\n        id: \"wifi\",\n        title: \"Wi-Fi/USB\",\n        description: \"Connect to scoring devices on your local network.\",\n        action: () => {\n          if (onModeSelect) onModeSelect(\"wifi\");\n        },\n      },\n      {\n        id: \"usb\",\n        title: \"USB\",\n        description: \"Connect a USB capture device (treated like WiFi mode).\",\n        action: () => {\n          if (onModeSelect) onModeSelect(\"usb\");\n        },\n      },\n    ];\n  }, [\n    setMode,\n    start,\n    startPhonePairing,\n    startWifiConnection,\n    startUsbConnection,\n  ]);\n\n  const [copyFeedback, setCopyFeedback] = useState<\"link\" | \"code\" | null>(\n    null,\n  );\n  const copyTimeoutRef = useRef<number | null>(null);\n\n  useEffect(() => {\n    return () => {\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current);\n    };\n  }, []);\n\n  // Respect stored aspect unless we're explicitly in full-bleed fill mode,\n  // in which case drop the aspect box so the video can truly cover the area.\n  const { cameraFitMode: globalFitMode } = useUserSettings();\n  const effectiveFitMode: \"fit\" | \"fill\" = fill\n    ? \"fill\"\n    : globalFitMode || \"fill\";\n  // In fill mode we guarantee no black bars: never allow downscaling below 1.0\n  const scale = (() => {\n    const raw = Number(props.scaleOverride ?? cameraScale ?? 1);\n    const clamped = Math.max(0.5, Math.min(1.25, raw));\n    return effectiveFitMode === \"fill\" ? Math.max(1, clamped) : clamped;\n  })();\n  const aspectChoice: \"wide\" | \"square\" | \"portrait\" | \"classic\" | \"free\" =\n    fill && effectiveFitMode === \"fill\"\n      ? \"free\"\n      : aspect && aspect !== \"inherit\"\n        ? aspect\n        : (storedAspect as any) || \"wide\";\n\n  const shouldMaintainAspect = aspectChoice !== \"free\";\n  const aspectClass = shouldMaintainAspect\n    ? aspectChoice === \"square\"\n      ? \"aspect-square\"\n      : aspectChoice === \"portrait\"\n        ? \"aspect-[3/4]\"\n        : aspectChoice === \"classic\"\n          ? \"aspect-[4/3]\"\n          : \"aspect-video\"\n    : \"\";\n\n  const containerBase = fill\n    ? \"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30\"\n    : \"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30\";\n  const containerClass = [containerBase, className]\n    .filter(Boolean)\n    .join(\" \")\n    .trim();\n  const containerStyle: CSSProperties = { ...(style || {}) };\n\n  const viewportClass = fill\n    ? \"relative flex-1 min-h-[420px] bg-black\"\n    : \"relative w-full bg-black\";\n\n  const commonVideoProps = {\n    style: { transform: `scale(${scale})`, transformOrigin: \"center\" as const },\n  };\n\n  const usbActive =\n    mode === \"wifi\" && usbDevices.some((d: USBDevice) => d.status === \"online\");\n\n  const videoElement = (() => {\n    // Apply Fit/Fill preference (fill prop hard-overrides to full-bleed)\n    const isFit = effectiveFitMode === \"fit\";\n    const baseVideoClass = isFit\n      ? // Fit: preserve entire frame (may letterbox)\n        \"absolute inset-0 w-full h-full object-contain object-center bg-transparent\"\n      : // Fill: guarantee full coverage with object-cover so there are no black bars\n        \"absolute inset-0 w-full h-full object-cover object-center bg-transparent\";\n    if (fill) {\n      if (shouldMaintainAspect) {\n        return (\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div\n              className={`relative w-full max-w-full max-h-full ${aspectClass}`}\n            >\n              <video\n                ref={videoRef}\n                className={baseVideoClass}\n                {...commonVideoProps}\n              />\n            </div>\n          </div>\n        );\n      }\n      return (\n        <video\n          ref={videoRef}\n          className={baseVideoClass}\n          {...commonVideoProps}\n        />\n      );\n    }\n    if (shouldMaintainAspect) {\n      return (\n        <div className={`relative w-full ${aspectClass}`}>\n          <video\n            ref={videoRef}\n            className={baseVideoClass}\n            {...commonVideoProps}\n          />\n        </div>\n      );\n    }\n    return (\n      <div className=\"relative w-full\">\n        <video\n          ref={videoRef}\n          className={baseVideoClass}\n          {...commonVideoProps}\n        />\n      </div>\n    );\n  })();\n\n  async function copyValue(\n    value: string | null | undefined,\n    type: \"link\" | \"code\",\n  ) {\n    if (!value) return;\n    try {\n      if (navigator.clipboard && navigator.clipboard.writeText) {\n        await navigator.clipboard.writeText(value);\n      } else {\n        const textarea = document.createElement(\"textarea\");\n        textarea.value = value;\n        textarea.style.position = \"fixed\";\n        textarea.style.opacity = \"0\";\n        document.body.appendChild(textarea);\n        textarea.focus();\n        textarea.select();\n        document.execCommand(\"copy\");\n        document.body.removeChild(textarea);\n      }\n      setCopyFeedback(type);\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current);\n      copyTimeoutRef.current = window.setTimeout(\n        () => setCopyFeedback(null),\n        1500,\n      );\n    } catch (err) {\n      console.warn(\"Copy to clipboard failed:\", err);\n      setCopyFeedback(null);\n    }\n  }\n\n  return (\n    <div className={containerClass} style={containerStyle}>\n      <div className={viewportClass}>\n        {videoElement}\n        {cameraSession.isStreaming && mode === \"phone\" && (\n          <div className=\"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg\">\n            <span className=\"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse\" />\n            <span>REC</span>\n          </div>\n        )}\n      </div>\n      <div className=\"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50\">\n        <span className=\"truncate font-medium\">\n          {label ||\n            (streaming\n              ? mode === \"phone\"\n                ? \"PHONE LIVE\"\n                : mode === \"wifi\"\n                  ? \"WIFI LIVE\"\n                  : \"LIVE\"\n              : \"Camera\")}\n          {preferredCameraLocked && (\n            <span className=\"ml-2 text-xs opacity-80\">ðŸ”’</span>\n          )}\n        </span>\n        <div className=\"flex items-center gap-2\">\n          {!streaming && (\n            <>\n              <button\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"local\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\n                onClick={() => onModeSelect(\"local\")}\n              >\n                Local\n              </button>\n              <button\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"phone\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\n                onClick={() => onModeSelect(\"phone\")}\n              >\n                Phone\n              </button>\n              <button\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"wifi\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\n                onClick={() => onModeSelect(\"wifi\")}\n              >\n                WiFi\n              </button>\n              <button\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"wifi\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\n                onClick={() => onModeSelect(\"usb\")}\n              >\n                USB\n              </button>\n            </>\n          )}\n          {streaming ? (\n            <button\n              className=\"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all\"\n              onClick={stopAll}\n            >\n              Stop\n            </button>\n          ) : null}\n        </div>\n      </div>\n      {mode === \"phone\" && pairCode && !streaming && (\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\n          <button\n            type=\"button\"\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\n            onClick={() => copyValue(mobileUrl, \"link\")}\n            title=\"Copy mobile camera link\"\n          >\n            <span className=\"flex-1 min-w-0 font-mono break-all\">\n              {mobileUrl}\n            </span>\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">\n              {copyFeedback === \"link\" ? \"Copied!\" : \"Copy\"}\n            </span>\n          </button>\n          <div className=\"mt-1 flex items-center gap-2\">\n            <a\n              href={mobileUrl}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\n            >\n              Open link\n            </a>\n            <button\n              type=\"button\"\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\n              onClick={() => copyValue(pairCode, \"code\")}\n              title=\"Copy pairing code\"\n            >\n              <span className=\"font-mono tracking-[0.3em] text-sm\">\n                {pairCode}\n              </span>\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">\n                {copyFeedback === \"code\" ? \"Copied!\" : \"Copy\"}\n              </span>\n            </button>\n          </div>\n          <div className=\"mt-1 flex items-center gap-2\">\n            <button\n              className=\"px-1 py-0.5 rounded bg-slate-700\"\n              onClick={regenerateCode}\n            >\n              Regenerate\n            </button>\n          </div>\n          {showTips && (\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\n              <ul className=\"list-disc pl-4 space-y-1\">\n                <li>Phone and desktop must be on the same Wiâ€‘Fi network.</li>\n                <li>\n                  Allow the server through your firewall (ports 8787 and{\" \"}\n                  {httpsInfo?.https ? httpsInfo.port : 8788}).\n                </li>\n                <li>\n                  On iPhone, use HTTPS links (QR will prefer https when\n                  enabled).\n                </li>\n              </ul>\n              <div className=\"mt-2 text-right\">\n                <button\n                  className=\"btn btn--ghost px-2 py-1 text-xs\"\n                  onClick={() => setShowTips(false)}\n                >\n                  Hide tips\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n      {mode === \"wifi\" && !streaming && (\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\n\n          {/* WiFi Devices */}\n          <div className=\"mb-3\">\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\n            {discoveringWifi ? (\n              <div className=\"flex items-center gap-2\">\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\n                <span>Scanning network...</span>\n              </div>\n            ) : wifiDevices.length > 0 ? (\n              <div className=\"space-y-1\">\n                {wifiDevices.map((device: NetworkDevice) => (\n                  <div\n                    key={device.id}\n                    className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\"\n                  >\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium truncate\">{device.name}</div>\n                      <div className=\"opacity-70 text-[9px]\">\n                        {device.ip}:{device.port}\n                      </div>\n                    </div>\n                    <button\n                      className={`px-1 py-0.5 rounded text-[9px] ${\n                        device.status === \"connecting\"\n                          ? \"bg-yellow-600\"\n                          : device.status === \"online\"\n                            ? \"bg-green-600\"\n                            : \"bg-blue-600\"\n                      }`}\n                      onClick={() => connectToWifiDevice(device)}\n                      disabled={device.status === \"connecting\"}\n                    >\n                      {device.status === \"connecting\" ? \"...\" : \"Connect\"}\n                    </button>\n                  </div>\n                ))}\n                <div className=\"text-center mt-2\">\n                  <button\n                    className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\n                    onClick={startWifiConnection}\n                  >\n                    Rescan WiFi\n                  </button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-center\">\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\n                <button\n                  className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\n                  onClick={startWifiConnection}\n                >\n                  Scan WiFi\n                </button>\n              </div>\n            )}\n          </div>\n\n          {/* USB Devices */}\n          <div>\n            <div className=\"font-medium mb-1\">USB Devices</div>\n            {discoveringUsb ? (\n              <div className=\"flex items-center gap-2\">\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\n                <span>Scanning USB...</span>\n              </div>\n            ) : usbDevices.length > 0 ? (\n              <div className=\"space-y-1\">\n                {usbDevices.map((device: USBDevice) => (\n                  <div\n                    key={device.id}\n                    className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\"\n                  >\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium truncate\">{device.name}</div>\n                      <div className=\"opacity-70 text-[9px]\">\n                        {device.type.toUpperCase()}\n                      </div>\n                    </div>\n                    <button\n                      className={`px-1 py-0.5 rounded text-[9px] ${\n                        device.status === \"connecting\"\n                          ? \"bg-yellow-600\"\n                          : device.status === \"online\"\n                            ? \"bg-green-600\"\n                            : \"bg-blue-600\"\n                      }`}\n                      onClick={() => connectToUsbDevice(device)}\n                      disabled={device.status === \"connecting\"}\n                    >\n                      {device.status === \"connecting\" ? \"...\" : \"Connect\"}\n                    </button>\n                  </div>\n                ))}\n                <div className=\"text-center mt-2\">\n                  <button\n                    className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\n                    onClick={startUsbConnection}\n                  >\n                    Rescan USB\n                  </button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-center\">\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\n                <button\n                  className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\n                  onClick={startUsbConnection}\n                >\n                  Scan USB\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      {!streaming && (\n        <div className=\"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div>\n              <div className=\"text-[10px] uppercase tracking-wide text-slate-500\">\n                Camera modes\n              </div>\n              <div className=\"text-sm font-semibold text-slate-900\">\n                Reconnect camera\n              </div>\n            </div>\n            <span className=\"text-xs text-slate-500\">\n              Current: {modeDisplayName[mode] || \"Local\"}\n            </span>\n          </div>\n          <p className=\"text-xs text-slate-500 mb-2\">\n            Tap a mode to restart the feed or switch inputs.\n          </p>\n          <div className=\"grid grid-cols-2 gap-2\">\n            {reconnectOptions.map((option) => {\n              const isActive =\n                option.id === \"usb\" ? usbActive : option.id === mode;\n              return (\n                <button\n                  key={option.id}\n                  type=\"button\"\n                  onClick={option.action}\n                  className={`text-left p-3 rounded-2xl border ${isActive ? \"border-emerald-500 bg-emerald-50 shadow\" : \"border-slate-200 bg-white/80 hover:bg-slate-50\"} transition`}\n                >\n                  <div className=\"text-xs font-semibold uppercase tracking-wide text-slate-500\">\n                    {option.title}\n                  </div>\n                  <div className=\"text-[11px] text-slate-600 mt-1\">\n                    {option.description}\n                  </div>\n                  {isActive && (\n                    <div className=\"text-[10px] text-emerald-500 mt-2\">\n                      Active\n                    </div>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import type { Homography, Point } from \"./vision\";\nimport { imageToBoard, scoreAtBoardPoint } from \"./vision\";\n\nexport function scoreFromImagePoint(H_boardToImage: Homography, pImg: Point) {\n  const pBoard = imageToBoard(H_boardToImage, pImg);\n  return scoreAtBoardPoint(pBoard);\n}\n","// High-accuracy dart detector for built-in autoscore\n// Strategy:\n// - Maintain a grayscale background model (running average) when no darts are present\n// - For each frame, compute abs-diff mask vs background and apply a 3x3 morphological closing to reduce noise\n// - Restrict detection to a circular ROI around board center (from calibration) to ignore background\n// - Find the largest foreground blob; compute PCA on blob pixels to estimate shaft orientation\n// - Estimate the tip as the extreme along the principal axis in the outward radial direction from board center\n// - Stabilize across consecutive frames (2+) before emitting a detection; debounce between darts\n\nexport type Point = { x: number; y: number };\n\nexport type DartDetection = {\n  tip: Point;\n  axis?: { x1: number; y1: number; x2: number; y2: number };\n  area: number;\n  bbox: { x: number; y: number; w: number; h: number };\n  confidence: number; // 0..1 heuristic\n};\n\nexport class DartDetector {\n  private width = 0;\n  private height = 0;\n  private bg: Float32Array | null = null; // grayscale background\n  private lastAcceptTs = 0;\n  private cooldownMs = 600;\n  private roiRadius = 0; // pixels; 0 means disabled\n  private roiCx = 0;\n  private roiCy = 0;\n  private initialized = false;\n\n  // Tuning (defaults intentionally more permissive)\n  private thresh = 18; // intensity threshold for foreground (was 28)\n  private minArea = 60; // min connected pixels to consider a dart (was 90)\n  private maxArea = 6000; // guard against massive motion\n  private angMaxDeg = 70; // how far from radial to tolerate\n  // temporal stabilization\n  private prevTip: Point | null = null;\n  private prevArea: number = 0;\n  private stableCount = 0;\n  private requireStableN = 3;\n\n  constructor(cfg?: {\n    thresh?: number;\n    minArea?: number;\n    maxArea?: number;\n    requireStableN?: number;\n    angMaxDeg?: number;\n  }) {\n    if (cfg?.thresh !== undefined) this.thresh = cfg.thresh;\n    if (cfg?.minArea !== undefined) this.minArea = cfg.minArea;\n    if (cfg?.maxArea !== undefined) this.maxArea = cfg.maxArea;\n    if (cfg?.requireStableN !== undefined)\n      this.requireStableN = cfg.requireStableN;\n    if (cfg?.angMaxDeg !== undefined) this.angMaxDeg = cfg.angMaxDeg;\n  }\n\n  setROI(cx: number, cy: number, radius: number) {\n    this.roiCx = cx;\n    this.roiCy = cy;\n    this.roiRadius = Math.max(0, radius | 0);\n  }\n\n  reset(width: number, height: number) {\n    this.width = width;\n    this.height = height;\n    this.bg = new Float32Array(width * height);\n    this.initialized = false;\n  }\n\n  // Seed or update background model with the provided frame\n  // If not initialized, copy; else running average with small alpha\n  updateBackground(frame: ImageData, alpha = 0.05) {\n    const { width: w, height: h, data } = frame;\n    if (!this.bg || w !== this.width || h !== this.height) {\n      this.reset(w, h);\n    }\n    const bg = this.bg!;\n    const n = w * h;\n    for (let i = 0, p = 0; i < n; i++, p += 4) {\n      const r = data[p],\n        g = data[p + 1],\n        b = data[p + 2];\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n      if (!this.initialized) bg[i] = gray;\n      else bg[i] = (1 - alpha) * bg[i] + alpha * gray;\n    }\n    this.initialized = true;\n  }\n\n  private inRoi(x: number, y: number): boolean {\n    if (this.roiRadius <= 0) return true;\n    const dx = x - this.roiCx;\n    const dy = y - this.roiCy;\n    return dx * dx + dy * dy <= this.roiRadius * this.roiRadius;\n  }\n\n  // Returns a detection if a new dart-like blob is found; null otherwise\n  detect(frame: ImageData): DartDetection | null {\n    const now = Date.now();\n    const recent = now - this.lastAcceptTs < this.cooldownMs;\n    const { width: w, height: h, data } = frame;\n    if (!this.bg || w !== this.width || h !== this.height) this.reset(w, h);\n    const bg = this.bg!;\n    if (!this.initialized) {\n      this.updateBackground(frame, 1.0);\n      return null;\n    }\n\n    // Build diff buffer and compute dynamic threshold excluding specular highlights\n    const n = w * h;\n    const mask = new Uint8Array(n);\n    const diff = new Float32Array(n);\n    let sum = 0,\n      sum2 = 0,\n      cnt = 0;\n    const isHighlight = new Uint8Array(n);\n    for (let i = 0, p = 0; i < n; i++, p += 4) {\n      const r = data[p],\n        g = data[p + 1],\n        b = data[p + 2];\n      const maxc = Math.max(r, g, b);\n      const minc = Math.min(r, g, b);\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n      const d = Math.abs(gray - bg[i]);\n      diff[i] = d;\n      const y = Math.floor(i / w);\n      const x = i - y * w;\n      // specular highlight heuristic: very bright with low chroma\n      const satApprox = maxc === 0 ? 0 : (maxc - minc) / maxc;\n      const isHi = maxc >= 250 && satApprox <= 0.12;\n      if (isHi) isHighlight[i] = 1;\n      if (this.inRoi(x, y) && !isHi) {\n        sum += d;\n        sum2 += d * d;\n        cnt++;\n      }\n    }\n    const mu = cnt ? sum / cnt : 0;\n    const var_ = cnt ? Math.max(0, sum2 / cnt - mu * mu) : 0;\n    const sigma = Math.sqrt(var_);\n    const dynamicThresh = Math.max(this.thresh, mu + 1.2 * sigma);\n    // Rebuild mask using dynamic threshold and ignoring highlights\n    for (let i = 0; i < n; i++) {\n      if (isHighlight[i]) {\n        mask[i] = 0;\n        continue;\n      }\n      if (diff[i] > dynamicThresh) {\n        const y = Math.floor(i / w);\n        const x = i - y * w;\n        mask[i] = this.inRoi(x, y) ? 1 : 0;\n      }\n    }\n\n    // Morphological closing (dilate then erode) to consolidate thin shapes\n    this._dilate(mask, w, h);\n    this._erode(mask, w, h);\n\n    // Connected components (single pass using queue BFS); track largest blob\n    const visited = new Uint8Array(n);\n    let bestArea = 0;\n    let bestIdxs: number[] | null = null;\n    for (let i = 0; i < n; i++) {\n      if (mask[i] === 0 || visited[i]) continue;\n      const idxs: number[] = [];\n      let area = 0;\n      let qh = 0;\n      const q: number[] = [i];\n      visited[i] = 1;\n      while (qh < q.length) {\n        const cur = q[qh++];\n        idxs.push(cur);\n        area++;\n        const y = (cur / w) | 0;\n        const x = cur - y * w;\n        // 4-neighborhood\n        const nbs = [cur - 1, cur + 1, cur - w, cur + w];\n        for (const nb of nbs) {\n          if (nb < 0 || nb >= n) continue;\n          if (visited[nb]) continue;\n          // bounds checks for left/right\n          if ((nb === cur - 1 || nb === cur + 1) && ((nb / w) | 0) !== y)\n            continue;\n          if (mask[nb]) {\n            visited[nb] = 1;\n            q.push(nb);\n          }\n        }\n      }\n      if (area > bestArea) {\n        bestArea = area;\n        bestIdxs = idxs;\n      }\n    }\n\n    if (!bestIdxs || bestArea < this.minArea || bestArea > this.maxArea) {\n      // Slowly update background when no valid detection to adapt lighting\n      if (!recent) this.updateBackground(frame, 0.02);\n      return null;\n    }\n\n    // Compute PCA (covariance) on blob pixels to estimate shaft orientation\n    let minX = w,\n      minY = h,\n      maxX = 0,\n      maxY = 0;\n    let meanX = 0,\n      meanY = 0;\n    for (const idx of bestIdxs) {\n      const y = (idx / w) | 0;\n      const x = idx - y * w;\n      meanX += x;\n      meanY += y;\n      if (x < minX) minX = x;\n      if (x > maxX) maxX = x;\n      if (y < minY) minY = y;\n      if (y > maxY) maxY = y;\n    }\n    meanX /= bestArea;\n    meanY /= bestArea;\n    let cxx = 0,\n      cyy = 0,\n      cxy = 0;\n    for (const idx of bestIdxs) {\n      const y = (idx / w) | 0;\n      const x = idx - y * w;\n      const dx = x - meanX;\n      const dy = y - meanY;\n      cxx += dx * dx;\n      cyy += dy * dy;\n      cxy += dx * dy;\n    }\n    cxx /= bestArea;\n    cyy /= bestArea;\n    cxy /= bestArea;\n    // Principal axis (eigenvector of covariance with largest eigenvalue)\n    // For 2x2 symmetric matrix [[cxx,cxy],[cxy,cyy]], eigenvector for largest eigenvalue lambda satisfies (cxx-l)x + cxy y = 0\n    const trace = cxx + cyy;\n    const det = cxx * cyy - cxy * cxy;\n    const tmp = Math.sqrt(Math.max(0, (trace * trace) / 4 - det));\n    const l1 = trace / 2 + tmp; // largest eigenvalue\n    // eigenvector v = (cxy, l1 - cxx) or (l1 - cyy, cxy); choose longer\n    let vx = cxy,\n      vy = l1 - cxx;\n    if (Math.hypot(vx, vy) < 1e-6) {\n      vx = l1 - cyy;\n      vy = cxy;\n    }\n    const vlen = Math.hypot(vx, vy) || 1;\n    vx /= vlen;\n    vy /= vlen;\n\n    // Determine which direction along the axis points outward from board center\n    const dxc = meanX - this.roiCx;\n    const dyc = meanY - this.roiCy;\n    const outward = dxc * vx + dyc * vy > 0 ? 1 : -1;\n    vx *= outward;\n    vy *= outward;\n\n    // Enforce radial alignment: reject if principal axis deviates too much from radial direction\n    const rlen = Math.hypot(dxc, dyc) || 1;\n    const rx = dxc / rlen,\n      ry = dyc / rlen;\n    const cosAng = Math.max(-1, Math.min(1, vx * rx + vy * ry));\n    const angDeg = (Math.acos(cosAng) * 180) / Math.PI;\n  if (angDeg > this.angMaxDeg) {\n      // likely glare or non-radial artifact\n      if (!recent) this.updateBackground(frame, 0.02);\n      return null;\n    }\n\n    // Project all blob points onto axis and pick extreme (max t) as tip candidate\n    let maxT = -Infinity;\n    let tipX = meanX,\n      tipY = meanY;\n    for (const idx of bestIdxs) {\n      const y = (idx / w) | 0;\n      const x = idx - y * w;\n      const t = (x - meanX) * vx + (y - meanY) * vy;\n      if (t > maxT) {\n        maxT = t;\n        tipX = x;\n        tipY = y;\n      }\n    }\n\n    // Distance to center for confidence heuristic\n    const dxr = tipX - this.roiCx;\n    const dyr = tipY - this.roiCy;\n    const minR2 = dxr * dxr + dyr * dyr;\n\n    // Confidence heuristic based on compactness and radial extent\n    const bboxW = Math.max(1, maxX - minX + 1);\n    const bboxH = Math.max(1, maxY - minY + 1);\n    const bboxArea = bboxW * bboxH;\n    const fill = bestArea / bboxArea; // 0..1 (thin dart should be small fill)\n    const radial = Math.sqrt(minR2) / Math.max(1, this.roiRadius);\n    let confidence = 0.5;\n    // Prefer thin elongated shapes with small fill and inside ROI\n    if (fill < 0.45) confidence += 0.2;\n    if (fill < 0.25) confidence += 0.15;\n    if (radial < 1.1) confidence += 0.1;\n    // Orientation confidence: larger principal eigenvalue vs minor\n    const l2 = trace - l1;\n    const elong = l1 > 0 ? 1 - l2 / l1 : 0;\n    if (elong > 0.3) confidence += 0.1;\n    confidence = Math.max(0, Math.min(1, confidence));\n\n    // Update background outside the blob to keep stability\n    // Optionally, we can inpaint the blob into background upon acceptance by caller\n\n    // Temporal stabilization: require 2+ consistent frames for the same dart\n  const stable = this._isStable({ x: tipX + 0.5, y: tipY + 0.5 }, bestArea);\n    if (!stable) return null;\n    // Debounce\n    if (recent) return null;\n\n    return {\n      tip: { x: tipX + 0.5, y: tipY + 0.5 },\n      axis: {\n        x1: meanX - vx * 20,\n        y1: meanY - vy * 20,\n        x2: meanX + vx * 20,\n        y2: meanY + vy * 20,\n      },\n      area: bestArea,\n      bbox: { x: minX, y: minY, w: bboxW, h: bboxH },\n      confidence,\n    };\n  }\n\n  // Incorporate the accepted detection into background so it won't trigger again\n  accept(frame: ImageData, det: DartDetection) {\n    this.lastAcceptTs = Date.now();\n    // reset temporal stabilization for next dart\n    this.prevTip = null;\n    this.prevArea = 0;\n    this.stableCount = 0;\n    if (!this.bg) return;\n    const { width: w } = frame;\n    const bg = this.bg;\n    const { x, y, w: bw, h: bh } = det.bbox;\n    const alpha = 0.5;\n    for (let yy = y; yy < y + bh; yy++) {\n      for (let xx = x; xx < x + bw; xx++) {\n        const i = yy * w + xx;\n        const p = i * 4;\n        const r = frame.data[p],\n          g = frame.data[p + 1],\n          b = frame.data[p + 2];\n        const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n        bg[i] = (1 - alpha) * bg[i] + alpha * gray;\n      }\n    }\n  }\n\n  // --- helpers ---\n  private _isStable(tip: Point, area: number): boolean {\n    const close = (a: Point, b: Point) => Math.hypot(a.x - b.x, a.y - b.y) <= 6;\n    if (!this.prevTip) {\n      this.prevTip = { ...tip };\n      this.prevArea = area;\n      this.stableCount = 1;\n      return false;\n    }\n    if (\n      close(this.prevTip, tip) &&\n      Math.abs(area - this.prevArea) / Math.max(1, area) < 0.3\n    ) {\n      this.prevTip = { ...tip };\n      this.prevArea = area;\n      this.stableCount++;\n    } else {\n      this.prevTip = { ...tip };\n      this.prevArea = area;\n      this.stableCount = 1;\n      return false;\n    }\n    return this.stableCount >= this.requireStableN;\n  }\n\n  private _dilate(mask: Uint8Array, w: number, h: number) {\n    const out = new Uint8Array(mask.length);\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        let on = 0;\n        for (let j = -1; j <= 1; j++) {\n          for (let i = -1; i <= 1; i++) {\n            const yy = y + j,\n              xx = x + i;\n            if (yy < 0 || yy >= h || xx < 0 || xx >= w) continue;\n            if (mask[yy * w + xx]) {\n              on = 1;\n              break;\n            }\n          }\n          if (on) break;\n        }\n        out[y * w + x] = on;\n      }\n    }\n    mask.set(out);\n  }\n\n  private _erode(mask: Uint8Array, w: number, h: number) {\n    const out = new Uint8Array(mask.length);\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        let on = 1;\n        for (let j = -1; j <= 1; j++) {\n          for (let i = -1; i <= 1; i++) {\n            const yy = y + j,\n              xx = x + i;\n            if (yy < 0 || yy >= h || xx < 0 || xx >= w) continue;\n            if (!mask[yy * w + xx]) {\n              on = 0;\n              break;\n            }\n          }\n          if (!on) break;\n        }\n        out[y * w + x] = on;\n      }\n    }\n    mask.set(out);\n  }\n}\n","// Generic autoscore provider helpers: parse vendor-agnostic payloads and subscribe via WebSocket\n\nexport type Ring =\n  | \"MISS\"\n  | \"SINGLE\"\n  | \"DOUBLE\"\n  | \"TRIPLE\"\n  | \"BULL\"\n  | \"INNER_BULL\";\nexport type ParsedDart = {\n  value: number;\n  ring: Ring;\n  sector?: number | null;\n  mult?: 0 | 1 | 2 | 3;\n};\n\n// Try to parse a variety of vendor payload shapes\nexport function parseExternalDart(data: any): ParsedDart | null {\n  try {\n    if (!data || typeof data !== \"object\") return null;\n    // 1) { type:'dart', value: <0-60>, ring: 'SINGLE'|'DOUBLE'|... }\n    if (\n      (data.type === \"dart\" || data.kind === \"dart\" || data.event === \"dart\") &&\n      typeof data.value === \"number\"\n    ) {\n      const ring = normalizeRing(data.ring);\n      return finalizeFromValue(data.value, ring);\n    }\n    // 2) { value, ring }\n    if (typeof data.value === \"number\" && data.ring) {\n      const ring = normalizeRing(data.ring);\n      return finalizeFromValue(data.value, ring);\n    }\n    // 3) { score: 'T20'|'D16'|'S5'|'25'|'50' }\n    if (typeof data.score === \"string\") {\n      const s = data.score.trim().toUpperCase();\n      if (s === \"50\" || s === \"DBULL\" || s === \"INNER_BULL\")\n        return { value: 50, ring: \"INNER_BULL\", sector: null, mult: 0 };\n      if (s === \"25\" || s === \"BULL\" || s === \"OBULL\")\n        return { value: 25, ring: \"BULL\", sector: null, mult: 0 };\n      const m = s.match(/^(S|D|T)(\\d{1,2})$/);\n      if (m) {\n        const mult = m[1] === \"S\" ? 1 : m[1] === \"D\" ? 2 : 3;\n        const sec = parseInt(m[2], 10);\n        if (sec >= 1 && sec <= 20)\n          return {\n            value: sec * mult,\n            ring: mult === 1 ? \"SINGLE\" : mult === 2 ? \"DOUBLE\" : \"TRIPLE\",\n            sector: sec,\n            mult: mult as 1 | 2 | 3,\n          };\n      }\n    }\n    // 4) { sector: 1..20, mult: 1|2|3 }\n    if (typeof data.sector === \"number\" && typeof data.mult === \"number\") {\n      const sec = Math.max(1, Math.min(20, Math.floor(data.sector)));\n      const mul = data.mult === 1 ? 1 : data.mult === 2 ? 2 : 3;\n      return {\n        value: sec * mul,\n        ring: mul === 1 ? \"SINGLE\" : mul === 2 ? \"DOUBLE\" : \"TRIPLE\",\n        sector: sec,\n        mult: mul as 1 | 2 | 3,\n      };\n    }\n    // 5) { bull: 'outer'|'inner'|true }\n    if (data.bull) {\n      const inner =\n        String(data.bull).toLowerCase() === \"inner\" || data.bull === true;\n      return {\n        value: inner ? 50 : 25,\n        ring: inner ? \"INNER_BULL\" : \"BULL\",\n        sector: null,\n        mult: 0,\n      };\n    }\n  } catch {}\n  return null;\n}\n\nfunction normalizeRing(r: any): Ring {\n  const s = String(r || \"\").toUpperCase();\n  if (s.startsWith(\"TR\")) return \"TRIPLE\";\n  if (s.startsWith(\"DO\")) return \"DOUBLE\";\n  if (s.startsWith(\"SI\")) return \"SINGLE\";\n  if (s === \"INNER_BULL\" || s === \"DBULL\" || s === \"50\" || s === \"IBULL\")\n    return \"INNER_BULL\";\n  if (s === \"BULL\" || s === \"25\" || s === \"OBULL\" || s === \"OUTER_BULL\")\n    return \"BULL\";\n  if (s === \"MISS\" || s === \"0\") return \"MISS\";\n  return \"SINGLE\";\n}\n\nfunction finalizeFromValue(value: number, ring: Ring): ParsedDart | null {\n  const v = Math.max(0, Math.min(60, Math.round(Number(value) || 0)));\n  if (ring === \"INNER_BULL\") return { value: 50, ring };\n  if (ring === \"BULL\") return { value: 25, ring };\n  // Best-effort: preserve base if consistent with ring\n  return { value: v, ring };\n}\n\nexport type ExternalSub = { close: () => void };\n\nexport function subscribeExternalWS(\n  url: string,\n  onDart: (d: ParsedDart) => void,\n): ExternalSub {\n  let socket: WebSocket | null = null;\n  let alive = true;\n  // Lightweight duplicate suppression: ignore exact repeat within a short window\n  let lastSig: string | null = null;\n  let lastSigAt = 0;\n  const DEDUP_WINDOW_MS = 400;\n  // Optional ID-based dedup if provider sends unique ids\n  const seenIds: string[] = [];\n  const seenSet = new Set<string>();\n\n  function considerForward(payload: any, parsed: ParsedDart) {\n    // If payload has a stable id, drop if seen\n    const pid =\n      typeof payload?.id === \"string\" || typeof payload?.id === \"number\"\n        ? String(payload.id)\n        : null;\n    if (pid) {\n      if (seenSet.has(pid)) return;\n      seenSet.add(pid);\n      seenIds.push(pid);\n      if (seenIds.length > 200) {\n        const old = seenIds.shift();\n        if (old) seenSet.delete(old);\n      }\n    }\n    // Time-based dedup by signature (safe; darts cannot occur within <400ms)\n    const sig = `${parsed.value}|${parsed.ring}|${parsed.sector ?? \"\"}|${parsed.mult ?? \"\"}`;\n    const now = Date.now();\n    if (sig === lastSig && now - lastSigAt < DEDUP_WINDOW_MS) return;\n    lastSig = sig;\n    lastSigAt = now;\n    onDart(parsed);\n  }\n\n  function connect() {\n    if (!alive) return;\n    try {\n      socket = new WebSocket(url);\n      socket.onmessage = (ev) => {\n        try {\n          const payload = JSON.parse(ev.data);\n          const parsed = parseExternalDart(payload);\n          if (parsed) considerForward(payload, parsed);\n        } catch {}\n      };\n      socket.onclose = () => {\n        socket = null;\n        setTimeout(connect, 1500);\n      };\n      socket.onerror = () => {\n        /* ignore; will reconnect on close */\n      };\n    } catch {\n      setTimeout(connect, 2000);\n    }\n  }\n  connect();\n  return {\n    close: () => {\n      alive = false;\n      try {\n        socket?.close();\n      } catch {}\n    },\n  };\n}\n","import React, {\n  useEffect,\n  useRef,\n  useState,\n  type ReactNode,\n  type CSSProperties,\n} from \"react\";\n\ntype Props = {\n  storageKey: string;\n  children: ReactNode;\n  className?: string;\n  defaultWidth?: number;\n  defaultHeight?: number;\n  minWidth?: number;\n  minHeight?: number;\n  maxWidth?: number;\n  maxHeight?: number;\n  autoFill?: boolean;\n};\n\ntype Size = { width?: number; height?: number };\n\nexport default function ResizablePanel({\n  storageKey,\n  children,\n  className,\n  defaultWidth = 640,\n  defaultHeight = 360,\n  minWidth = 320,\n  minHeight = 200,\n  maxWidth = 1600,\n  maxHeight = 1200,\n  autoFill = false,\n}: Props) {\n  const [size, setSize] = useState<Size>(() => {\n    try {\n      const raw = localStorage.getItem(storageKey);\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    // If autoFill is requested, don't persist a fixed height â€” let CSS stretch the panel\n    return autoFill\n      ? { width: defaultWidth }\n      : { width: defaultWidth, height: defaultHeight };\n  });\n  const startRef = useRef<{\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n    dir: string;\n  } | null>(null);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    function onReset() {\n      try {\n        localStorage.removeItem(storageKey);\n      } catch {}\n      setSize({ width: defaultWidth, height: defaultHeight });\n    }\n    window.addEventListener(\"ndn:layout-reset\" as any, onReset);\n    window.addEventListener(\"ndn:camera-reset\" as any, onReset);\n    return () => {\n      window.removeEventListener(\"ndn:layout-reset\" as any, onReset);\n      window.removeEventListener(\"ndn:camera-reset\" as any, onReset);\n    };\n  }, [storageKey, defaultWidth, defaultHeight]);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem(storageKey, JSON.stringify(size));\n    } catch {}\n  }, [size, storageKey]);\n\n  function clamp(n: number, min: number, max: number) {\n    return Math.max(min, Math.min(max, n));\n  }\n  function beginResize(e: React.MouseEvent, dir: string) {\n    e.preventDefault();\n    const el = containerRef.current;\n    if (!el) return;\n    const rect = el.getBoundingClientRect();\n    startRef.current = {\n      x: e.clientX,\n      y: e.clientY,\n      w: rect.width,\n      h: rect.height,\n      dir,\n    };\n    window.addEventListener(\"mousemove\", onMove);\n    window.addEventListener(\"mouseup\", endResize);\n  }\n  function onMove(e: globalThis.MouseEvent) {\n    const s = startRef.current;\n    if (!s) return;\n    const dx = e.clientX - s.x;\n    const dy = e.clientY - s.y;\n    let w = s.w;\n    let h = s.h;\n    if (s.dir.includes(\"e\")) w = clamp(s.w + dx, minWidth, maxWidth);\n    // If autoFill is enabled, ignore vertical resizing (panel should fill parent)\n    if (!autoFill && s.dir.includes(\"s\"))\n      h = clamp(s.h + dy, minHeight, maxHeight);\n    if (s.dir.includes(\"w\")) w = clamp(s.w - dx, minWidth, maxWidth);\n    if (!autoFill && s.dir.includes(\"n\"))\n      h = clamp(s.h - dy, minHeight, maxHeight);\n    setSize({ width: Math.round(w), height: Math.round(h) });\n  }\n  function endResize() {\n    window.removeEventListener(\"mousemove\", onMove);\n    window.removeEventListener(\"mouseup\", endResize);\n    startRef.current = null;\n  }\n\n  function handleKeyResize(e: React.KeyboardEvent, dir: string) {\n    const step = 20;\n    const k = e.key;\n    if (\n      ![\n        \"ArrowLeft\",\n        \"ArrowRight\",\n        \"ArrowUp\",\n        \"ArrowDown\",\n        \"Enter\",\n        \" \",\n      ].includes(k)\n    )\n      return;\n    e.preventDefault();\n    const delta = k === \"ArrowLeft\" || k === \"ArrowUp\" ? -step : step;\n    setSize((s) => {\n      const curW = s.width || defaultWidth;\n      const curH = s.height || defaultHeight;\n      let w = curW;\n      let h = curH;\n      if (dir.includes(\"e\")) w = clamp(curW + delta, minWidth, maxWidth);\n      if (dir.includes(\"w\")) w = clamp(curW - delta, minWidth, maxWidth);\n      if (!autoFill && dir.includes(\"s\"))\n        h = clamp(curH + delta, minHeight, maxHeight);\n      if (!autoFill && dir.includes(\"n\"))\n        h = clamp(curH - delta, minHeight, maxHeight);\n      return { width: Math.round(w), height: Math.round(h) };\n    });\n  }\n\n  const style: CSSProperties = {\n    width: autoFill ? \"100%\" : size.width ? `${size.width}px` : undefined,\n    height: autoFill ? \"100%\" : size.height ? `${size.height}px` : undefined,\n    maxWidth: \"100%\",\n    // Allow the panel to fill the parent when autoFill is enabled. Otherwise keep a sensible cap.\n    maxHeight: autoFill ? \"100%\" : \"80vh\",\n    position: \"relative\",\n    // Make it participate in flex layouts when filling\n    ...(autoFill\n      ? { display: \"flex\", flexDirection: \"column\", flex: \"1 1 auto\" }\n      : {}),\n  };\n\n  return (\n    <div ref={containerRef} className={`${className || \"\"}`} style={style}>\n      {children}\n      <div\n        className=\"resizer resizer-nw\"\n        onMouseDown={(e) => beginResize(e, \"nw\")}\n        role=\"button\"\n        tabIndex={0}\n        aria-label=\"Resize north-west\"\n        onKeyDown={(e) => handleKeyResize(e, \"nw\")}\n      />\n      <div\n        className=\"resizer resizer-ne\"\n        onMouseDown={(e) => beginResize(e, \"ne\")}\n        role=\"button\"\n        tabIndex={0}\n        aria-label=\"Resize north-east\"\n        onKeyDown={(e) => handleKeyResize(e, \"ne\")}\n      />\n      <div\n        className=\"resizer resizer-sw\"\n        onMouseDown={(e) => beginResize(e, \"sw\")}\n        role=\"button\"\n        tabIndex={0}\n        aria-label=\"Resize south-west\"\n        onKeyDown={(e) => handleKeyResize(e, \"sw\")}\n      />\n      <div\n        className=\"resizer resizer-se\"\n        onMouseDown={(e) => beginResize(e, \"se\")}\n        role=\"button\"\n        tabIndex={0}\n        aria-label=\"Resize south-east\"\n        onKeyDown={(e) => handleKeyResize(e, \"se\")}\n      />\n    </div>\n  );\n}\n","import { create } from \"zustand\";\n\nexport type HeatSample = {\n  playerId: string | null;\n  sector: number | null;\n  mult: 0 | 1 | 2 | 3;\n  ring: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\";\n  ts: number;\n};\n\ntype HeatState = {\n  samples: HeatSample[];\n  addSample: (s: HeatSample) => void;\n  clear: () => void;\n  export: () => HeatSample[];\n};\n\nexport const useHeatmapStore = create<HeatState>((set, get) => ({\n  samples: [],\n  addSample: (s) => set((state) => ({ samples: [...state.samples, s] })),\n  clear: () => set({ samples: [] }),\n  export: () => get().samples.slice(),\n}));\n\nexport default useHeatmapStore;\n","import { create } from \"zustand\";\n\ntype MatchControlState = {\n  paused: boolean;\n  pauseEndsAt: number | null;\n  setPaused: (v: boolean, endsAt?: number | null) => void;\n};\n\nexport const useMatchControl = create<MatchControlState>((set) => ({\n  paused: false,\n  pauseEndsAt: null,\n  setPaused: (v, endsAt = null) =>\n    set({ paused: v, pauseEndsAt: endsAt ?? null }),\n}));\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { dlog } from \"../utils/logger\";\nimport { useUserSettings } from \"../store/userSettings\";\nimport { useCalibration } from \"../store/calibration\";\nimport { useMatch } from \"../store/match\";\nimport {\n  BoardRadii,\n  drawPolyline,\n  sampleRing,\n  scaleHomography,\n  type Point,\n  applyHomography,\n  drawCross,\n  refinePointSobel,\n} from \"../utils/vision\";\nimport { scoreFromImagePoint } from \"../utils/autoscore\";\nimport { DartDetector } from \"../utils/dartDetector\";\nimport { addSample } from \"../store/profileStats\";\nimport { subscribeExternalWS } from \"../utils/scoring\";\nimport ResizablePanel from \"./ui/ResizablePanel\";\nimport ResizableModal from \"./ui/ResizableModal\";\nimport FocusLock from \"react-focus-lock\";\nimport useHeatmapStore from \"../store/heatmap\";\nimport { usePendingVisit } from \"../store/pendingVisit\";\nimport { useCameraSession } from \"../store/cameraSession\";\nimport { useMatchControl } from \"../store/matchControl\";\nimport { useAudit } from \"../store/audit\";\n\n// Shared ring type across autoscore/manual flows\ntype Ring = \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\";\n\nconst AUTO_COMMIT_MIN_FRAMES = 1;\nconst AUTO_COMMIT_HOLD_MS = 120;\nconst AUTO_COMMIT_COOLDOWN_MS = 400;\nconst AUTO_STREAM_IGNORE_MS = 450;\nconst DETECTION_ARM_DELAY_MS = 5000;\nconst AUTO_COMMIT_CONFIDENCE = 0.85;\nconst BOARD_CLEAR_GRACE_MS = 6500;\nconst DISABLE_CAMERA_OVERLAY = true;\n\ntype AutoCandidate = {\n  value: number;\n  ring: Ring;\n  label: string;\n  sector: number | null;\n  mult: 0 | 1 | 2 | 3;\n  firstTs: number;\n  frames: number;\n};\n\ntype DetectionLogEntry = {\n  ts: number;\n  label: string;\n  value: number;\n  ring: Ring;\n  confidence: number;\n  ready: boolean;\n  accepted: boolean;\n  warmup: boolean;\n};\n\nexport default function CameraView({\n  onVisitCommitted,\n  showToolbar = true,\n  onAutoDart,\n  immediateAutoCommit = false,\n  hideInlinePanels = false,\n  scoringMode = \"x01\",\n  onGenericDart,\n  onGenericReplace,\n  x01DoubleInOverride,\n  onAddVisit,\n  onEndLeg,\n}: {\n  onVisitCommitted?: (score: number, darts: number, finished: boolean) => void;\n  showToolbar?: boolean;\n  onAutoDart?: (\n    value: number,\n    ring: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    info?: { sector: number | null; mult: 0 | 1 | 2 | 3 },\n  ) => void;\n  immediateAutoCommit?: boolean;\n  hideInlinePanels?: boolean;\n  scoringMode?: \"x01\" | \"custom\";\n  onGenericDart?: (value: number, ring: Ring, meta: { label: string }) => void;\n  onGenericReplace?: (\n    value: number,\n    ring: Ring,\n    meta: { label: string },\n  ) => void;\n  x01DoubleInOverride?: boolean;\n  onAddVisit?: (score: number, darts: number, meta?: any) => void;\n  onEndLeg?: (score?: number) => void;\n}) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const {\n    preferredCameraId,\n    preferredCameraLabel,\n    setPreferredCamera,\n    autoscoreProvider,\n    autoscoreWsUrl,\n    cameraAspect,\n    cameraFitMode,\n    autoCommitMode = \"wait-for-clear\",\n    cameraEnabled,\n    setCameraEnabled,\n    preferredCameraLocked,\n    hideCameraOverlay,\n    setHideCameraOverlay,\n  } = useUserSettings();\n  const preserveCalibrationOverlay = useUserSettings((s) => s.preserveCalibrationOverlay);\n  const manualOnly = autoscoreProvider === \"manual\";\n  const [availableCameras, setAvailableCameras] = useState<MediaDeviceInfo[]>(\n    [],\n  );\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const overlayRef = useRef<HTMLCanvasElement>(null);\n  const [streaming, setStreaming] = useState(false);\n  const cameraSession = useCameraSession();\n  const isPhoneCamera = preferredCameraLabel === \"Phone Camera\";\n  const sessionStream = cameraSession.getMediaStream?.() || null;\n  const sessionStreaming = cameraSession.isStreaming;\n  const phoneFeedActive =\n    isPhoneCamera &&\n    cameraSession.mode === \"phone\" &&\n    sessionStreaming &&\n    !!sessionStream;\n  const effectiveStreaming = streaming || sessionStreaming;\n  const [cameraStarting, setCameraStarting] = useState(false);\n  const [snapshotUrl, setSnapshotUrl] = useState<string | null>(null);\n  const { H, imageSize, overlaySize, reset: resetCalibration, _hydrated, locked } = useCalibration();\n  useEffect(() => {\n    if (preferredCameraLocked && !hideCameraOverlay) {\n      setHideCameraOverlay(true);\n    }\n  }, [preferredCameraLocked, hideCameraOverlay, setHideCameraOverlay]);\n  const [lastAutoScore, setLastAutoScore] = useState<string>(\"\");\n  const [manualScore, setManualScore] = useState<string>(\"\");\n  const [lastAutoValue, setLastAutoValue] = useState<number>(0);\n  const [lastAutoRing, setLastAutoRing] = useState<Ring>(\"MISS\");\n  const [pendingDarts, setPendingDarts] = useState<number>(0);\n  const [pendingScore, setPendingScore] = useState<number>(0);\n  const [pendingEntries, setPendingEntries] = useState<\n    { label: string; value: number; ring: Ring }[]\n  >([]);\n  const [pendingPreOpenDarts, setPendingPreOpenDarts] = useState<number>(0);\n  const [pendingDartsAtDouble, setPendingDartsAtDouble] = useState<number>(0);\n  const [awaitingClear, setAwaitingClear] = useState(false);\n  const pendingCommitRef = useRef<{\n    score: number;\n    darts: number;\n    finished: boolean;\n  } | null>(null);\n  const pendingCommitTimerRef = useRef<number | null>(null);\n  const shouldDeferCommit =\n    !immediateAutoCommit && autoCommitMode !== \"immediate\";\n  const [indicatorVersion, setIndicatorVersion] = useState(0);\n  const [indicatorEntryVersions, setIndicatorEntryVersions] = useState<\n    number[]\n  >([]);\n  const autoCandidateRef = useRef<AutoCandidate | null>(null);\n  const detectionLogRef = useRef<DetectionLogEntry[]>([]);\n  const lastAutoCommitRef = useRef<number>(0);\n  const streamingStartMsRef = useRef<number>(0);\n  const detectionArmedRef = useRef<boolean>(false);\n  const detectionArmTimerRef = useRef<number | null>(null);\n  const frameCountRef = useRef<number>(0);\n  const [detectionLog, setDetectionLog] = useState<DetectionLogEntry[]>([]);\n  const [showDetectionLog, setShowDetectionLog] = useState(false);\n  const clearPendingCommitTimer = useCallback(() => {\n    if (pendingCommitTimerRef.current) {\n      clearTimeout(pendingCommitTimerRef.current);\n      pendingCommitTimerRef.current = null;\n    }\n  }, []);\n\n  const captureDetectionLog = useCallback((entry: DetectionLogEntry) => {\n    const next = [...detectionLogRef.current.slice(-8), entry];\n    detectionLogRef.current = next;\n    setDetectionLog(next);\n    try {\n      (window as any).ndnCameraDiagnostics = next;\n    } catch {}\n  }, []);\n  const finalizePendingCommit = useCallback(\n    (_trigger: \"event\" | \"timeout\" | \"teardown\") => {\n      const pending = pendingCommitRef.current;\n      if (!pending) return;\n      pendingCommitRef.current = null;\n      clearPendingCommitTimer();\n      setAwaitingClear(false);\n      if (onVisitCommitted) {\n        try {\n          onVisitCommitted(pending.score, pending.darts, pending.finished);\n        } catch {}\n      }\n    },\n    [onVisitCommitted, clearPendingCommitTimer],\n  );\n  const enqueueVisitCommit = useCallback(\n    (payload: { score: number; darts: number; finished: boolean }) => {\n      if (!onVisitCommitted) return;\n      if (!shouldDeferCommit) {\n        try {\n          onVisitCommitted(payload.score, payload.darts, payload.finished);\n        } catch {}\n        return;\n      }\n      pendingCommitRef.current = payload;\n      setAwaitingClear(true);\n      clearPendingCommitTimer();\n      pendingCommitTimerRef.current = window.setTimeout(\n        () => finalizePendingCommit(\"timeout\"),\n        BOARD_CLEAR_GRACE_MS,\n      );\n    },\n    [\n      onVisitCommitted,\n      shouldDeferCommit,\n      clearPendingCommitTimer,\n      finalizePendingCommit,\n    ],\n  );\n  const clearPendingManual = useCallback((reason: \"indicator\" | \"toolbar\") => {\n    setPendingDarts(0);\n    setPendingScore(0);\n    setPendingEntries([]);\n    setPendingPreOpenDarts(0);\n    setPendingDartsAtDouble(0);\n    setHadRecentAuto(false);\n    try {\n      window.dispatchEvent(\n        new CustomEvent(\"ndn:clear-visit-request\", {\n          detail: { source: \"camera-view\", reason, ts: Date.now() },\n        }),\n      );\n    } catch {}\n  }, []);\n  useEffect(() => {\n    if (!shouldDeferCommit) return;\n    const handler = () => finalizePendingCommit(\"event\");\n    window.addEventListener(\"ndn:darts-cleared\", handler as EventListener);\n    return () =>\n      window.removeEventListener(\"ndn:darts-cleared\", handler as EventListener);\n  }, [shouldDeferCommit, finalizePendingCommit]);\n  useEffect(() => {\n    if (!shouldDeferCommit) finalizePendingCommit(\"timeout\");\n  }, [shouldDeferCommit, finalizePendingCommit]);\n  useEffect(\n    () => () => finalizePendingCommit(\"teardown\"),\n    [finalizePendingCommit],\n  );\n  const handleIndicatorReset = useCallback(() => {\n    clearPendingManual(\"indicator\");\n    setIndicatorVersion((v) => v + 1);\n  }, [clearPendingManual]);\n  const handleToolbarClear = useCallback(() => {\n    if (pendingDarts === 0 && pendingScore === 0) return;\n    clearPendingManual(\"toolbar\");\n    setIndicatorVersion((v) => v + 1);\n  }, [clearPendingManual, pendingDarts, pendingScore]);\n  const requestDeviceManager = useCallback(() => {\n    if (manualOnly) return;\n    try {\n      window.dispatchEvent(\n        new CustomEvent(\"ndn:open-camera-manager\", {\n          detail: { source: \"camera-view\", ts: Date.now() },\n        }),\n      );\n    } catch (err) {\n      console.warn(\"[CameraView] Failed to request camera manager:\", err);\n    }\n  }, [manualOnly]);\n  // X01 Double-In handling: per-player opened state in this session\n  const x01DoubleInSetting = useUserSettings((s) => s.x01DoubleIn);\n  const x01DoubleIn =\n    typeof x01DoubleInOverride === \"boolean\"\n      ? !!x01DoubleInOverride\n      : !!x01DoubleInSetting;\n  const [openedById, setOpenedById] = useState<Record<string, boolean>>({});\n  const matchState = useMatch((s) => s);\n  const currentPlayerId = matchState.players[matchState.currentPlayerIdx]?.id;\n  const isOpened = !!(currentPlayerId && openedById[currentPlayerId]);\n  const setOpened = (v: boolean) => {\n    if (!currentPlayerId) return;\n    setOpenedById((m) => ({ ...m, [currentPlayerId]: v }));\n  };\n  const inProgress = (matchState as any)?.inProgress;\n  // Broadcast pending visit to global store so Scoreboard can visualize dots\n  const setVisit = usePendingVisit((s) => s.setVisit);\n  const resetPendingVisit = usePendingVisit((s) => s.reset);\n  useEffect(() => {\n    try {\n      setVisit(pendingEntries as any, pendingDarts, pendingScore);\n    } catch {}\n  }, [pendingEntries, pendingDarts, pendingScore, setVisit]);\n  useEffect(\n    () => () => {\n      try {\n        resetPendingVisit();\n      } catch {}\n    },\n    [resetPendingVisit],\n  );\n  const addVisit = useMatch((s) => s.addVisit);\n  const endLeg = useMatch((s) => s.endLeg);\n  // Prefer provided adapters (matchActions wrappers) when available\n  const callAddVisit = (score: number, darts: number, meta?: any) => {\n    try {\n      if (onAddVisit) onAddVisit(score, darts, meta);\n      else addVisit(score, darts, meta);\n    } catch {\n      /* noop */\n    }\n  };\n  const callEndLeg = (score?: number) => {\n    try {\n      if (onEndLeg) onEndLeg(score);\n      else endLeg(typeof score === \"number\" ? score : 0);\n    } catch {\n      /* noop */\n    }\n  };\n  const addHeatSample = useHeatmapStore((s) => s.addSample);\n  // Quick entry dropdown selections\n  const [quickSelAuto, setQuickSelAuto] = useState(\"\");\n  const [quickSelManual, setQuickSelManual] = useState(\"\");\n  const [nonRegCount, setNonRegCount] = useState(0);\n  const [showRecalModal, setShowRecalModal] = useState(false);\n  const [hadRecentAuto, setHadRecentAuto] = useState(false);\n  const [pulseManualPill, setPulseManualPill] = useState(false);\n  const pulseTimeoutRef = useRef<number | null>(null);\n  const [activeTab, setActiveTab] = useState<\"auto\" | \"manual\">(\"auto\");\n  const [showManualModal, setShowManualModal] = useState(false);\n  const [showAutoModal, setShowAutoModal] = useState(false);\n  const [showScoringModal, setShowScoringModal] = useState(false);\n  const manualPreviewRef = useRef<HTMLCanvasElement | null>(null);\n  // Dart timer\n  const dartTimerEnabled = useUserSettings((s) => s.dartTimerEnabled);\n  const dartTimerSeconds = useUserSettings((s) => s.dartTimerSeconds) || 10;\n  const [dartTimeLeft, setDartTimeLeft] = useState<number | null>(null);\n  const timerRef = useRef<number | null>(null);\n  const paused = useMatchControl((s) => s.paused);\n  // Built-in CV detector\n  const detectorRef = useRef<DartDetector | null>(null);\n  const rafRef = useRef<number | null>(null);\n  const [detectorSeedVersion, setDetectorSeedVersion] = useState(0);\n  const handlePhoneReconnect = useCallback(() => {\n    try {\n      window.dispatchEvent(\n        new CustomEvent(\"ndn:phone-camera-reconnect\", {\n          detail: { source: \"camera-view\", ts: Date.now() },\n        }),\n      );\n    } catch (err) {\n      console.warn(\"[CameraView] Phone camera reconnect dispatch failed:\", err);\n    }\n  }, []);\n  // Open Autoscore modal from parent via global event\n  useEffect(() => {\n    const onOpen = () => {\n      if (!manualOnly) setShowAutoModal(true);\n    };\n    window.addEventListener(\"ndn:open-autoscore\" as any, onOpen);\n    return () =>\n      window.removeEventListener(\"ndn:open-autoscore\" as any, onOpen);\n  }, [manualOnly]);\n\n  // cleanup pulse timer on unmount\n  useEffect(() => {\n    return () => {\n      try {\n        if (pulseTimeoutRef.current) clearTimeout(pulseTimeoutRef.current);\n      } catch {}\n    };\n  }, []);\n\n  // Open Scoring (Camera + Pending Visit) modal from parent via global event\n  useEffect(() => {\n    const onOpen = () => setShowScoringModal(true);\n    window.addEventListener(\"ndn:open-scoring\" as any, onOpen);\n    return () => window.removeEventListener(\"ndn:open-scoring\" as any, onOpen);\n  }, []);\n\n  useEffect(() => {\n    const onDartsCleared = () => {\n      setIndicatorVersion((v) => v + 1);\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      setPendingPreOpenDarts(0);\n      setPendingDartsAtDouble(0);\n      setHadRecentAuto(false);\n    };\n    window.addEventListener(\n      \"ndn:darts-cleared\",\n      onDartsCleared as EventListener,\n    );\n    return () =>\n      window.removeEventListener(\n        \"ndn:darts-cleared\",\n        onDartsCleared as EventListener,\n      );\n  }, []);\n\n  useEffect(() => {\n    setIndicatorEntryVersions((prev) => {\n      if (pendingEntries.length > prev.length) {\n        const diff = pendingEntries.length - prev.length;\n        return [...prev, ...Array(diff).fill(indicatorVersion)];\n      }\n      if (pendingEntries.length < prev.length) {\n        return prev.slice(0, pendingEntries.length);\n      }\n      return prev;\n    });\n  }, [pendingEntries, indicatorVersion]);\n\n  useEffect(() => {\n    if (detectionArmTimerRef.current) {\n      clearTimeout(detectionArmTimerRef.current);\n      detectionArmTimerRef.current = null;\n    }\n    if (manualOnly) {\n      detectionArmedRef.current = false;\n      streamingStartMsRef.current = 0;\n      autoCandidateRef.current = null;\n      return;\n    }\n    if (effectiveStreaming) {\n      streamingStartMsRef.current = performance.now();\n      autoCandidateRef.current = null;\n      detectionArmedRef.current = false;\n      frameCountRef.current = 0;\n      detectionArmTimerRef.current = window.setTimeout(() => {\n        detectionArmedRef.current = true;\n        detectionArmTimerRef.current = null;\n      }, DETECTION_ARM_DELAY_MS);\n    } else {\n      streamingStartMsRef.current = 0;\n      autoCandidateRef.current = null;\n      detectionArmedRef.current = false;\n      frameCountRef.current = 0;\n    }\n    return () => {\n      if (detectionArmTimerRef.current) {\n        clearTimeout(detectionArmTimerRef.current);\n        detectionArmTimerRef.current = null;\n      }\n      detectionArmedRef.current = false;\n      frameCountRef.current = 0;\n    };\n  }, [effectiveStreaming, manualOnly]);\n\n  // Enumerate devices on mount and when devices change so USB webcams appear quickly\n  useEffect(() => {\n    let mounted = true;\n    async function refresh() {\n      try {\n        if (!navigator?.mediaDevices?.enumerateDevices) return;\n        const list = await navigator.mediaDevices.enumerateDevices();\n        if (!mounted) return;\n        setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\n      } catch (err) {\n        console.warn(\"[CAMERA] enumerateDevices failed:\", err);\n      }\n    }\n    refresh();\n    try {\n      navigator.mediaDevices.addEventListener(\"devicechange\", refresh);\n    } catch {\n      try {\n        (navigator.mediaDevices as any).ondevicechange = refresh;\n      } catch {}\n    }\n    return () => {\n      mounted = false;\n      try {\n        navigator.mediaDevices.removeEventListener(\"devicechange\", refresh);\n      } catch {}\n    };\n  }, []);\n\n  // Allow parent to open/close the manual modal via global events\n  useEffect(() => {\n    const onOpen = () => {\n      setActiveTab(\"manual\");\n      setShowManualModal(true);\n    };\n    const onClose = () => {\n      setActiveTab(\"auto\");\n      setShowManualModal(false);\n    };\n    window.addEventListener(\"ndn:open-manual\" as any, onOpen);\n    window.addEventListener(\"ndn:close-manual\" as any, onClose);\n    return () => {\n      window.removeEventListener(\"ndn:open-manual\" as any, onOpen);\n      window.removeEventListener(\"ndn:close-manual\" as any, onClose);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (manualOnly) {\n      setActiveTab(\"manual\");\n      setShowAutoModal(false);\n    }\n  }, [manualOnly]);\n\n  // Reset open state at the start of a leg (no darts thrown yet), keep across visits within leg\n  useEffect(() => {\n    try {\n      const p = matchState.players[matchState.currentPlayerIdx];\n      const leg = p?.legs?.[p.legs.length - 1];\n      if (!p) return;\n      if (!leg || leg.dartsThrown === 0) {\n        setOpenedById((m) => ({ ...m, [p.id]: false }));\n      }\n    } catch {}\n  }, [\n    matchState.currentPlayerIdx,\n    matchState.players?.[matchState.currentPlayerIdx]?.legs?.length,\n  ]);\n\n  // Manage per-dart timer lifecycle\n  useEffect(() => {\n    const shouldRun =\n      !!dartTimerEnabled && inProgress && !paused && pendingDarts < 3;\n    // Clear any existing interval\n    if (timerRef.current) {\n      clearInterval(timerRef.current as any);\n      timerRef.current = null;\n    }\n    if (!shouldRun) {\n      setDartTimeLeft(null);\n      return;\n    }\n    // Reset timer each time dependencies change (new dart, player change, setting change)\n    setDartTimeLeft(dartTimerSeconds);\n    timerRef.current = window.setInterval(() => {\n      setDartTimeLeft((prev) => {\n        const next = (prev ?? dartTimerSeconds) - 1;\n        if (next <= 0) {\n          // Time expired: record a MISS and reset will occur via pendingEntries change\n          try {\n            addDart(0, \"MISS 0\", \"MISS\");\n          } catch {}\n          // Stop interval until effect re-initializes on state change\n          if (timerRef.current) {\n            clearInterval(timerRef.current as any);\n            timerRef.current = null;\n          }\n          return 0;\n        }\n        return next;\n      });\n    }, 1000) as any;\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current as any);\n        timerRef.current = null;\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    dartTimerEnabled,\n    dartTimerSeconds,\n    pendingDarts,\n    matchState.currentPlayerIdx,\n    (matchState as any)?.inProgress,\n    paused,\n  ]);\n\n  // Drive a lightweight live preview inside the manual modal from the main video element\n  useEffect(() => {\n    if (!showManualModal) return;\n    const id = setInterval(() => {\n      try {\n        const v = videoRef.current;\n        const c = manualPreviewRef.current;\n        if (!v || !c) return;\n        const vw = v.videoWidth || 0;\n        const vh = v.videoHeight || 0;\n        if (!vw || !vh) return;\n        const cw = c.clientWidth || 640;\n        const ch = c.clientHeight || 360;\n        // Set backing size to match display for crisp rendering\n        if (c.width !== cw) c.width = cw;\n        if (c.height !== ch) c.height = ch;\n        const ctx = c.getContext(\"2d\");\n        if (!ctx) return;\n        ctx.imageSmoothingEnabled = true;\n        // Letterbox fit\n        const scale = Math.min(cw / vw, ch / vh);\n        const dw = Math.round(vw * scale);\n        const dh = Math.round(vh * scale);\n        const dx = Math.floor((cw - dw) / 2);\n        const dy = Math.floor((ch - dh) / 2);\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, cw, ch);\n        ctx.drawImage(v, dx, dy, dw, dh);\n      } catch (e) {\n        // Silently ignore preview update errors\n        console.warn(\"Manual preview update error:\", e);\n      }\n    }, 120);\n    return () => clearInterval(id);\n  }, [showManualModal]);\n\n  useEffect(() => {\n    return () => stopCamera();\n  }, []);\n\n  const canFallbackToLocal = isPhoneCamera && !phoneFeedActive;\n\n  async function startCamera() {\n    if (cameraStarting || streaming) return;\n\n    // Only skip local startup when the phone feed is actively streaming\n    if (isPhoneCamera && phoneFeedActive) {\n      dlog(\"[CAMERA] Phone camera stream active - leaving local camera idle\");\n      setCameraStarting(false);\n      return;\n    }\n\n    setCameraStarting(true);\n    dlog(\"[CAMERA] Starting camera...\");\n    try {\n      // If a preferred camera is set, request it; otherwise default to back camera on mobile\n      const constraints: MediaStreamConstraints = preferredCameraId\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false }\n        : { video: { facingMode: \"environment\" }, audio: false }; // Prefer back camera on mobile\n      dlog(\"[CAMERA] Using constraints:\", constraints);\n      let stream: MediaStream;\n      try {\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\n        dlog(\"[CAMERA] Got stream:\", !!stream);\n      } catch (err: any) {\n        console.warn(\"[CAMERA] First attempt failed:\", err);\n        // Fallback if specific device isn't available or facingMode not supported\n        const name = (err && (err.name || err.code)) || \"\";\n        if (\n          preferredCameraId &&\n          (name === \"OverconstrainedError\" || name === \"NotFoundError\")\n        ) {\n          dlog(\"[CAMERA] Trying fallback without deviceId\");\n          stream = await navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: false,\n          });\n        } else if (\n          !preferredCameraId &&\n          (name === \"OverconstrainedError\" ||\n            name === \"NotFoundError\" ||\n            name === \"NotSupportedError\")\n        ) {\n          dlog(\"[CAMERA] Trying fallback for facingMode not supported\");\n          // Fallback for devices that don't support facingMode\n          stream = await navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: false,\n          });\n        } else {\n          throw err;\n        }\n      }\n      if (videoRef.current) {\n        dlog(\"[CAMERA] Setting stream to video element\");\n        videoRef.current.srcObject = stream;\n        dlog(\n          \"[CAMERA] Stream tracks:\",\n          stream.getTracks().length,\n          \"video tracks:\",\n          stream.getVideoTracks().length,\n        );\n        // Add event listeners for debugging\n        videoRef.current.addEventListener(\"loadeddata\", () =>\n          dlog(\"[CAMERA] Video loadeddata\"),\n        );\n        videoRef.current.addEventListener(\"canplay\", () =>\n          dlog(\"[CAMERA] Video canplay\"),\n        );\n        videoRef.current.addEventListener(\"play\", () =>\n          dlog(\"[CAMERA] Video started playing\"),\n        );\n        videoRef.current.addEventListener(\"error\", (e) =>\n          console.error(\"[CAMERA] Video error:\", e),\n        );\n        try {\n          videoRef.current.play();\n          dlog(\"[CAMERA] Play called successfully\");\n        } catch (playErr) {\n          console.error(\"[CAMERA] Video play failed:\", playErr);\n          // Try again after a short delay\n          setTimeout(() => {\n            try {\n              videoRef.current?.play();\n              dlog(\"[CAMERA] Retry play called\");\n            } catch (retryErr) {\n              console.error(\"[CAMERA] Retry play failed:\", retryErr);\n            }\n          }, 100);\n        }\n        try {\n          cameraSession.setVideoElementRef?.(videoRef.current);\n          cameraSession.setMediaStream?.(stream);\n          cameraSession.setMode?.(\"local\");\n          cameraSession.setStreaming?.(true);\n        } catch (err) {\n          console.warn(\n            \"[CAMERA] Failed to sync camera session with local stream:\",\n            err,\n          );\n        }\n      } else {\n        console.error(\"[CAMERA] Video element not found\");\n      }\n      setStreaming(true);\n      // Capture device list for inline picker - no automatic preference updates\n      try {\n        const list = await navigator.mediaDevices.enumerateDevices();\n        setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\n        dlog(\n          \"[CAMERA] Found cameras:\",\n          list.filter((d) => d.kind === \"videoinput\").length,\n        );\n      } catch (enumErr) {\n        console.warn(\"[CAMERA] Failed to enumerate devices:\", enumErr);\n      }\n    } catch (e) {\n      console.error(\"[CAMERA] Camera start failed:\", e);\n      alert(\"Camera permission denied or not available.\");\n    } finally {\n      setCameraStarting(false);\n    }\n  }\n\n  function stopCamera() {\n    if (videoRef.current && videoRef.current.srcObject) {\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks();\n      tracks.forEach((t) => t.stop());\n      videoRef.current.srcObject = null;\n      setStreaming(false);\n      setCameraStarting(false);\n    }\n  }\n\n  useEffect(() => {\n    const videoEl = videoRef.current;\n    if (!videoEl) return;\n    const sessionStream = cameraSession.getMediaStream?.() || null;\n    const sessionVideo = cameraSession.getVideoElementRef?.() || null;\n    const fallbackStream =\n      (sessionVideo?.srcObject as MediaStream | null) || null;\n    const activeStream = sessionStream || fallbackStream;\n    if (!activeStream) return;\n    if (videoEl.srcObject !== activeStream) {\n      videoEl.srcObject = activeStream;\n    }\n    videoEl.muted = true;\n    (videoEl as any).playsInline = true;\n    try {\n      videoEl.play?.();\n    } catch {}\n    if (!streaming) setStreaming(true);\n  }, [cameraSession.mode, cameraSession.isStreaming, streaming, cameraSession]);\n\n  function capture() {\n    try {\n      if (!canvasRef.current) return;\n      const primary = videoRef.current;\n      const sessionVideo = cameraSession.getVideoElementRef?.() || null;\n      const source =\n        primary && primary.videoWidth > 0 && primary.videoHeight > 0\n          ? primary\n          : sessionVideo || primary;\n      if (!source) return;\n      const video = source;\n      const canvas = canvasRef.current;\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      const ctx = canvas.getContext(\"2d\");\n      if (!ctx) return;\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      const url = canvas.toDataURL(\"image/png\");\n      setSnapshotUrl(url);\n    } catch (e) {\n      console.warn(\"Capture error:\", e);\n    }\n  }\n\n  // Inline light-weight device switcher (optional)\n  function CameraSelector() {\n    if (!availableCameras.length) return null;\n    return (\n      <div className=\"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs\">\n        <span>Cam:</span>\n        <select\n          className=\"bg-black/20 rounded px-1 py-0.5\"\n          value={preferredCameraId || \"\"}\n          onChange={async (e) => {\n            if (cameraStarting) return;\n            const id = e.target.value || undefined;\n            const label = availableCameras.find(\n              (d) => d.deviceId === id,\n            )?.label;\n            // This is a user-initiated change so force the preference even when locked\n            setPreferredCamera(id, label || \"\", true);\n            // Stop current camera and wait for cleanup\n            stopCamera();\n            // Small delay to ensure camera device is fully released\n            await new Promise((resolve) => setTimeout(resolve, 150));\n            try {\n              await startCamera();\n            } catch (err) {\n              console.warn(\"Failed to start camera after device switch:\", err);\n              // Try one more time after a longer delay\n              setTimeout(async () => {\n                try {\n                  await startCamera();\n                } catch (retryErr) {\n                  console.error(\"Camera switch failed after retry:\", retryErr);\n                  alert(\n                    \"Failed to switch camera. Please try again or refresh the page.\",\n                  );\n                }\n              }, 500);\n            }\n          }}\n        >\n          <option value=\"\">Auto</option>\n          {availableCameras.map((d) => (\n            <option key={d.deviceId} value={d.deviceId}>\n              {d.label ||\n                (d.deviceId ? `Camera (${d.deviceId.slice(0, 6)})` : \"Camera\")}\n            </option>\n          ))}\n        </select>\n        <button\n          className=\"btn btn--ghost btn-sm ml-2\"\n          onClick={async () => {\n            try {\n              // quick user-triggered rescan\n              const list = await navigator.mediaDevices.enumerateDevices();\n              setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\n            } catch (err) {\n              console.warn(\"Rescan failed:\", err);\n              alert(\n                \"Failed to rescan devices. Ensure camera permissions are granted.\",\n              );\n            }\n          }}\n          title=\"Rescan connected cameras\"\n        >\n          Rescan\n        </button>\n      </div>\n    );\n  }\n\n  function drawOverlay() {\n    if (DISABLE_CAMERA_OVERLAY) {\n      if (overlayRef.current) {\n        const ctx = overlayRef.current.getContext(\"2d\");\n        if (ctx)\n          ctx.clearRect(\n            0,\n            0,\n            overlayRef.current.width,\n            overlayRef.current.height,\n          );\n      }\n      return;\n    }\n    try {\n      // Only render overlays when calibration data exists and the phone stream isn't providing the image\n      if (!overlayRef.current || !videoRef.current || !H || !imageSize) {\n        if (overlayRef.current) {\n          const ctx = overlayRef.current.getContext(\"2d\");\n          ctx?.clearRect(\n            0,\n            0,\n            overlayRef.current.width,\n            overlayRef.current.height,\n          );\n        }\n        return;\n      }\n      if (isPhoneCamera) return;\n      const o = overlayRef.current;\n      const v = videoRef.current;\n      const w = v.clientWidth;\n      const h = v.clientHeight;\n      o.width = w;\n      o.height = h;\n      const ctx = o.getContext(\"2d\");\n      if (!ctx) return;\n      ctx.clearRect(0, 0, w, h);\n      if (preferredCameraLocked || hideCameraOverlay) return;\n\n      // scale homography from calibration image size to current rendered size\n  // If calibration is locked and an overlaySize was saved at lock time, use that to preserve visual scale.\n  const useOverlay = locked && overlaySize && preserveCalibrationOverlay ? overlaySize : { w, h };\n  const sx = useOverlay.w / imageSize.w;\n  const sy = useOverlay.h / imageSize.h;\n  const Hs = scaleHomography(H, sx, sy);\n      const rings = [\n        BoardRadii.bullInner,\n        BoardRadii.bullOuter,\n        BoardRadii.trebleInner,\n        BoardRadii.trebleOuter,\n        BoardRadii.doubleInner,\n        BoardRadii.doubleOuter,\n      ];\n      // If useOverlay differs from actual canvas size, draw scale from useOverlay space to overlay space.\n  const drawScaleX = w / useOverlay.w;\n  const drawScaleY = h / useOverlay.h;\n      for (const r of rings) {\n        const poly = sampleRing(Hs, r, 720);\n        // Scale poly points according to drawScale\n        const scaledPoly = poly.map((p) => ({ x: p.x * drawScaleX, y: p.y * drawScaleY }));\n        drawPolyline(\n          ctx,\n          scaledPoly,\n          r === BoardRadii.doubleOuter ? \"#22d3ee\" : \"#a78bfa\",\n          r === BoardRadii.doubleOuter ? 3 : 2,\n        );\n      }\n    } catch (e) {\n      // Silently ignore drawing errors to prevent re-render loops\n      console.warn(\"Overlay drawing error:\", e);\n    }\n  }\n\n  useEffect(() => {\n    if (manualOnly || DISABLE_CAMERA_OVERLAY) return;\n    const id = setInterval(drawOverlay, 250);\n    return () => clearInterval(id);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    H,\n    imageSize,\n    effectiveStreaming,\n    manualOnly,\n    isPhoneCamera,\n    preferredCameraLocked,\n    hideCameraOverlay,\n  ]);\n\n  // Built-in autoscore loop (offline/local CV)\n  useEffect(() => {\n    if (manualOnly) return;\n    if (autoscoreProvider !== \"built-in\") return;\n    // Choose source: local video element, or paired phone camera element\n    const cameraSession = useCameraSession.getState();\n    const isPhone =\n      useUserSettings.getState().preferredCameraLabel === \"Phone Camera\";\n    const sourceVideo: HTMLVideoElement | null = isPhone\n      ? cameraSession.getVideoElementRef?.() || null\n      : videoRef.current;\n    if (!sourceVideo) return;\n    if (!H || !imageSize) return;\n\n    let canceled = false;\n    const v = sourceVideo;\n    const proc = canvasRef.current;\n    if (!proc) return;\n\n    // Initialize or reset detector with tuned params for resolution/phone cameras\n    if (!detectorRef.current) {\n      // default tuning\n      let minArea = 60;\n      let thresh = 18;\n      let requireStableN = 3;\n      // if resolution is low (common for phone cameras), make detector more permissive\n      if (vw > 0 && vh > 0 && vw * vh < 1280 * 720) {\n        minArea = 40;\n        thresh = 16;\n        requireStableN = 2;\n      }\n      detectorRef.current = new DartDetector({\n        minArea,\n        thresh,\n        requireStableN,\n        angMaxDeg: 70,\n      });\n    }\n\n    const tick = () => {\n      if (canceled) return;\n      try {\n        const vw = v.videoWidth || 0;\n        const vh = v.videoHeight || 0;\n        if (!vw || !vh) {\n          rafRef.current = requestAnimationFrame(tick);\n          return;\n        }\n        if (proc.width !== vw) proc.width = vw;\n        if (proc.height !== vh) proc.height = vh;\n        const ctx = proc.getContext(\"2d\", { willReadFrequently: true });\n        if (!ctx) {\n          rafRef.current = requestAnimationFrame(tick);\n          return;\n        }\n        ctx.drawImage(v, 0, 0, vw, vh);\n        const frame = ctx.getImageData(0, 0, vw, vh);\n\n        frameCountRef.current++;\n\n        // Seed ROI from calibration homography (board center + double radius along X)\n        const cImg = applyHomography(H, { x: 0, y: 0 });\n        const rImg = applyHomography(H, { x: BoardRadii.doubleOuter, y: 0 });\n        // Scale calibration image coordinates to current video size\n        const sx = vw / imageSize.w;\n        const sy = vh / imageSize.h;\n        const cx = cImg.x * sx;\n        const cy = cImg.y * sy;\n        const rx = rImg.x * sx;\n        const ry = rImg.y * sy;\n        const roiR = Math.hypot(rx - cx, ry - cy) * 1.08;\n\n        const detector = detectorRef.current!;\n        if (detectorSeedVersion >= 0) {\n          detector.setROI(\n            cx,\n            cy,\n            Math.max(24, Math.min(Math.max(vw, vh), roiR)),\n          );\n        }\n\n        // Try to detect a new dart when not paused and visit has room\n        if (\n          !paused &&\n          pendingDarts < 3 &&\n          detectionArmedRef.current &&\n          frameCountRef.current > 150\n        ) {\n          const det = detector.detect(frame);\n          const nowPerf = performance.now();\n          if (\n            autoCandidateRef.current &&\n            nowPerf - autoCandidateRef.current.firstTs > 900\n          ) {\n            autoCandidateRef.current = null;\n          }\n          if (det && det.confidence >= AUTO_COMMIT_CONFIDENCE) {\n            const warmupActive =\n              streamingStartMsRef.current > 0 &&\n              nowPerf - streamingStartMsRef.current < AUTO_STREAM_IGNORE_MS;\n            // Refine tip on gradients\n            const tipRefined = refinePointSobel(proc, det.tip, 6);\n            // Map to calibration image space before scoring\n            const pCal = { x: tipRefined.x / sx, y: tipRefined.y / sy };\n            const score = scoreFromImagePoint(H, pCal);\n            const ring = score.ring as Ring;\n            const value = score.base;\n            const label = `${ring} ${value > 0 ? value : \"\"}`.trim();\n            const sector = (score.sector ?? null) as number | null;\n            const mult = Math.max(0, Number(score.mult) || 0) as 0 | 1 | 2 | 3;\n            let shouldAccept = false;\n\n            setLastAutoScore(label);\n            setLastAutoValue(value);\n            setLastAutoRing(ring);\n\n            const applyAutoHit = (candidate: AutoCandidate) => {\n              if (candidate.value > 0) {\n                setHadRecentAuto(true);\n                setPulseManualPill(true);\n                try {\n                  if (pulseTimeoutRef.current)\n                    clearTimeout(pulseTimeoutRef.current);\n                } catch {}\n                pulseTimeoutRef.current = window.setTimeout(() => {\n                  setPulseManualPill(false);\n                  pulseTimeoutRef.current = null;\n                }, 1500);\n                try {\n                  addDart(candidate.value, candidate.label, candidate.ring);\n                } catch {}\n              } else {\n                setHadRecentAuto(false);\n              }\n              try {\n                if (onAutoDart)\n                  onAutoDart(candidate.value, candidate.ring, {\n                    sector: candidate.sector,\n                    mult: candidate.mult,\n                  });\n              } catch {}\n            };\n\n            if (!warmupActive) {\n              if (ring === \"MISS\" || value <= 0) {\n                autoCandidateRef.current = null;\n                setHadRecentAuto(false);\n                try {\n                  if (onAutoDart) onAutoDart(value, ring, { sector, mult });\n                } catch {}\n                shouldAccept = true;\n              } else {\n                const existing = autoCandidateRef.current;\n                if (\n                  !existing ||\n                  existing.value !== value ||\n                  existing.ring !== ring\n                ) {\n                  autoCandidateRef.current = {\n                    value,\n                    ring,\n                    label,\n                    sector,\n                    mult,\n                    firstTs: nowPerf,\n                    frames: 1,\n                  };\n                } else {\n                  autoCandidateRef.current = {\n                    ...existing,\n                    label,\n                    frames: existing.frames + 1,\n                  };\n                }\n                const current = autoCandidateRef.current!;\n                const holdMs = nowPerf - current.firstTs;\n                const ready =\n                  current.frames >= AUTO_COMMIT_MIN_FRAMES ||\n                  holdMs >= AUTO_COMMIT_HOLD_MS;\n                const cooled =\n                  nowPerf - lastAutoCommitRef.current >=\n                  AUTO_COMMIT_COOLDOWN_MS;\n                if (ready && cooled) {\n                  applyAutoHit(current);\n                  autoCandidateRef.current = null;\n                  lastAutoCommitRef.current = nowPerf;\n                  shouldAccept = true;\n                }\n              }\n            } else {\n              autoCandidateRef.current = null;\n              shouldAccept = true;\n            }\n\n            captureDetectionLog({\n              ts: nowPerf,\n              label,\n              value,\n              ring,\n              confidence: det.confidence,\n              ready: shouldAccept,\n              accepted: shouldAccept && value > 0 && ring !== \"MISS\",\n              warmup: warmupActive,\n            });\n\n            // Draw debug tip and shaft axis on overlay (scaled to overlay canvas)\n            try {\n              const drawOverlayHint = value > 0 && ring !== \"MISS\";\n              if (drawOverlayHint) {\n                const o = overlayRef.current;\n                if (o) {\n                  const octx = o.getContext(\"2d\");\n                  if (octx) {\n                    // Maintain overlay size and clear a small area\n                    const ox = (tipRefined.x / vw) * o.width;\n                    const oy = (tipRefined.y / vh) * o.height;\n                    octx.save();\n                    octx.beginPath();\n                    octx.strokeStyle = \"#f59e0b\";\n                    octx.lineWidth = 2;\n                    octx.arc(ox, oy, 6, 0, Math.PI * 2);\n                    octx.stroke();\n                    // axis line if available\n                    if ((det as any).axis) {\n                      const ax = (det as any).axis;\n                      const ax1 = (ax.x1 / vw) * o.width;\n                      const ay1 = (ax.y1 / vh) * o.height;\n                      const ax2 = (ax.x2 / vw) * o.width;\n                      const ay2 = (ax.y2 / vh) * o.height;\n                      octx.beginPath();\n                      octx.moveTo(ax1, ay1);\n                      octx.lineTo(ax2, ay2);\n                      octx.stroke();\n                    }\n                    // bbox\n                    if ((det as any).bbox) {\n                      const bx = ((det as any).bbox.x / vw) * o.width;\n                      const by = ((det as any).bbox.y / vh) * o.height;\n                      const bw = ((det as any).bbox.w / vw) * o.width;\n                      const bh = ((det as any).bbox.h / vh) * o.height;\n                      octx.strokeStyle = \"#22d3ee\";\n                      octx.strokeRect(bx, by, bw, bh);\n                    }\n                    octx.restore();\n                  }\n                }\n              }\n            } catch {}\n\n            if (shouldAccept) {\n              detector.accept(frame, det);\n            }\n          } else {\n            if (\n              autoCandidateRef.current &&\n              nowPerf - autoCandidateRef.current.firstTs > 800\n            ) {\n              autoCandidateRef.current = null;\n            }\n          }\n        }\n      } catch (e) {\n        // Soft-fail; continue next frame\n        // console.warn('Autoscore tick error:', e)\n      }\n      rafRef.current = requestAnimationFrame(tick);\n    };\n\n    rafRef.current = requestAnimationFrame(tick);\n    return () => {\n      canceled = true;\n      if (rafRef.current) cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    manualOnly,\n    autoscoreProvider,\n    effectiveStreaming,\n    H,\n    imageSize,\n    paused,\n    pendingDarts,\n    detectorSeedVersion,\n    captureDetectionLog,\n  ]);\n\n  const handleUseLocalCamera = useCallback(async () => {\n    try {\n      if (isPhoneCamera) {\n        const fallback = availableCameras.find((c) => c.kind === \"videoinput\");\n        if (fallback) {\n          setPreferredCamera(fallback.deviceId, fallback.label || \"\", true);\n        } else {\n          setPreferredCamera(undefined, \"\", true);\n        }\n      }\n      await startCamera();\n    } catch (err) {\n      console.warn(\"[CameraView] Local camera fallback failed:\", err);\n    }\n  }, [availableCameras, isPhoneCamera, setPreferredCamera]);\n\n  // Update calibration audit status whenever homography or image size changes\n  useEffect(() => {\n    try {\n      useAudit\n        .getState()\n    .setCalibrationStatus({ hasHomography: !!H, imageSize, overlaySize });\n    } catch {}\n  }, [H, imageSize]);\n\n  // External autoscore subscription\n  useEffect(() => {\n    if (autoscoreProvider !== \"external-ws\" || !autoscoreWsUrl) return;\n    const sub = subscribeExternalWS(autoscoreWsUrl, (d) => {\n      if (\n        !detectionArmedRef.current ||\n        performance.now() - streamingStartMsRef.current < 5000\n      )\n        return;\n      // Prefer parent hook if provided; otherwise add to visit directly\n      if (onAutoDart) {\n        try {\n          onAutoDart(d.value, d.ring as any, {\n            sector: d.sector ?? null,\n            mult: (d.mult as any) ?? 0,\n          });\n        } catch {}\n        try {\n          addHeatSample({\n            playerId:\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\n            sector: d.sector ?? null,\n            mult: (d.mult as any) ?? 0,\n            ring: d.ring as any,\n            ts: Date.now(),\n          });\n        } catch {}\n      } else {\n        const label =\n          d.ring === \"INNER_BULL\"\n            ? \"INNER_BULL 50\"\n            : d.ring === \"BULL\"\n              ? \"BULL 25\"\n              : `${d.ring[0]}${d.value / (d.mult || 1) || d.value} ${d.value}`;\n        addDart(d.value, label, d.ring as any);\n        try {\n          addHeatSample({\n            playerId:\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\n            sector: d.sector ?? null,\n            mult: (d.mult as any) ?? 0,\n            ring: d.ring as any,\n            ts: Date.now(),\n          });\n        } catch {}\n      }\n    });\n    return () => sub.close();\n  }, [autoscoreProvider, autoscoreWsUrl]);\n\n  function onOverlayClick(e: React.MouseEvent<HTMLCanvasElement>) {\n    if (!overlayRef.current || !H || !imageSize) return;\n    const rect = overlayRef.current.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    // Map to calibration coordinate space by reversing the display scaling\n    const sx = overlayRef.current.width / imageSize.w;\n    const sy = overlayRef.current.height / imageSize.h;\n    const pCal: Point = { x: x / sx, y: y / sy };\n    const score = scoreFromImagePoint(H, pCal);\n    const s = `${score.ring} ${score.base > 0 ? score.base : \"\"}`.trim();\n    setLastAutoScore(s);\n    setLastAutoValue(score.base);\n    setLastAutoRing(score.ring as Ring);\n    setHadRecentAuto(true);\n    // Optional immediate commit hook (e.g., Double Practice)\n    try {\n      if (immediateAutoCommit && onAutoDart) {\n        onAutoDart(score.base, score.ring as Ring, {\n          sector: score.sector,\n          mult: score.mult,\n        });\n        try {\n          addHeatSample({\n            playerId:\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\n            sector: score.sector ?? null,\n            mult: score.mult ?? 0,\n            ring: score.ring as any,\n            ts: Date.now(),\n          });\n        } catch {}\n        setHadRecentAuto(false);\n      }\n    } catch {}\n  }\n\n  function parseManual(\n    input: string,\n  ): { label: string; value: number; ring: Ring } | null {\n    const t = input.trim().toUpperCase();\n    if (!t) return null;\n    const bull = t === \"BULL\" || t === \"50\" || t === \"DBULL\" || t === \"IBULL\";\n    const outerBull = t === \"25\" || t === \"OBULL\";\n    if (bull) return { label: \"INNER_BULL 50\", value: 50, ring: \"INNER_BULL\" };\n    if (outerBull) return { label: \"BULL 25\", value: 25, ring: \"BULL\" };\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\n    if (!m) return null;\n    const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\n    const num = parseInt(m[2], 10);\n    if (num < 1 || num > 20) return null;\n    const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\n    const ring: Ring =\n      mult === \"S\" ? \"SINGLE\" : mult === \"D\" ? \"DOUBLE\" : \"TRIPLE\";\n    return {\n      label: `${mult}${num} ${num * multVal}`,\n      value: num * multVal,\n      ring,\n    };\n  }\n\n  function getCurrentRemaining(): number {\n    const s = matchState;\n    if (!s.players.length) return s.startingScore;\n    const p = s.players[s.currentPlayerIdx];\n    const leg = p.legs[p.legs.length - 1];\n    if (!leg) return s.startingScore;\n    return leg.totalScoreRemaining;\n  }\n\n  function addDart(value: number, label: string, ring: Ring) {\n    if (shouldDeferCommit && awaitingClear) {\n      if (!pulseManualPill) {\n        setPulseManualPill(true);\n        try {\n          if (pulseTimeoutRef.current) clearTimeout(pulseTimeoutRef.current);\n        } catch {}\n        pulseTimeoutRef.current = window.setTimeout(() => {\n          setPulseManualPill(false);\n          pulseTimeoutRef.current = null;\n        }, 1200);\n      }\n      return;\n    }\n    // In generic mode, delegate to parent without X01 bust/finish rules\n    if (scoringMode === \"custom\") {\n      if (onGenericDart)\n        try {\n          onGenericDart(value, ring, { label });\n        } catch {}\n      // Maintain a lightweight pending list for UI only\n      if (pendingDarts >= 3) {\n        // Rotate to next visit locally so we don't drop darts visually\n        setPendingDarts(1);\n        setPendingScore(value);\n        setPendingEntries([{ label, value, ring }]);\n        return;\n      }\n      const newDarts = pendingDarts + 1;\n      setPendingDarts(newDarts);\n      setPendingScore((s) => s + value);\n      setPendingEntries((e) => [...e, { label, value, ring }]);\n      return;\n    }\n\n    // If a new dart arrives while 3 are pending, auto-commit previous visit and start a new one\n    if (pendingDarts >= 3) {\n      const previousScore = pendingScore;\n      const previousDarts = pendingDarts;\n      // Commit previous full visit\n      callAddVisit(previousScore, previousDarts, {\n        preOpenDarts: pendingPreOpenDarts || 0,\n        doubleWindowDarts: pendingDartsAtDouble || 0,\n        finishedByDouble: false,\n        visitTotal: previousScore,\n      });\n      try {\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\n        if (name) addSample(name, previousDarts, previousScore);\n      } catch {}\n      // Start next visit with this dart\n      const willCount =\n        !x01DoubleIn || isOpened || ring === \"DOUBLE\" || ring === \"INNER_BULL\";\n      const applied = willCount ? value : 0;\n      setPendingDarts(1);\n      setPendingScore(applied);\n      setPendingEntries([{ label, value: applied, ring }]);\n      setPendingPreOpenDarts(willCount ? 0 : 1);\n      setPendingDartsAtDouble(0);\n      if (\n        x01DoubleIn &&\n        !isOpened &&\n        (ring === \"DOUBLE\" || ring === \"INNER_BULL\")\n      ) {\n        setOpened(true);\n      }\n      enqueueVisitCommit({\n        score: previousScore,\n        darts: previousDarts,\n        finished: false,\n      });\n      return;\n    }\n    const newDarts = pendingDarts + 1;\n    // Apply X01 Double-In rule before scoring if enabled and not opened yet\n    const countsForScore =\n      !x01DoubleIn || isOpened || ring === \"DOUBLE\" || ring === \"INNER_BULL\";\n    const appliedValue = countsForScore ? value : 0;\n    if (\n      x01DoubleIn &&\n      !isOpened &&\n      (ring === \"DOUBLE\" || ring === \"INNER_BULL\")\n    ) {\n      setOpened(true);\n    }\n    const newScore = pendingScore + appliedValue;\n    const remaining = getCurrentRemaining();\n    const after = remaining - newScore;\n\n    // Bust conditions (double-out): negative or 1, or 0 without double/inner bull\n    const isFinish =\n      after === 0 && (ring === \"DOUBLE\" || ring === \"INNER_BULL\");\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish);\n\n    if (isBust) {\n      // Commit bust visit: 0 score, darts thrown so far including this one\n      const preOpenThis =\n        x01DoubleIn &&\n        !isOpened &&\n        !(ring === \"DOUBLE\" || ring === \"INNER_BULL\")\n          ? 1\n          : 0;\n      const preOpenTotal = (pendingPreOpenDarts || 0) + preOpenThis;\n      // Count attempts in double-out window\n      const postAfter = after;\n      const postBefore = after + appliedValue;\n      const attemptsThisDart =\n        (postBefore > 50 && postAfter <= 50) || postBefore <= 50 ? 1 : 0;\n      const attemptsTotal = (pendingDartsAtDouble || 0) + attemptsThisDart;\n      callAddVisit(0, newDarts, {\n        preOpenDarts: preOpenTotal,\n        doubleWindowDarts: attemptsTotal,\n        finishedByDouble: false,\n        visitTotal: 0,\n      });\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      setPendingPreOpenDarts(0);\n      setPendingDartsAtDouble(0);\n      enqueueVisitCommit({ score: 0, darts: newDarts, finished: false });\n      return;\n    }\n\n    // Normal add (value may be zero if not opened yet)\n    setPendingDarts(newDarts);\n    setPendingScore(newScore);\n    setPendingEntries((e) => [...e, { label, value: appliedValue, ring }]);\n    if (\n      x01DoubleIn &&\n      !isOpened &&\n      !(ring === \"DOUBLE\" || ring === \"INNER_BULL\")\n    ) {\n      setPendingPreOpenDarts((n) => (n || 0) + 1);\n    }\n    // Track double-out attempts within this visit\n    {\n      const postAfter = after;\n      const postBefore = after + appliedValue;\n      const countThisDart =\n        (postBefore > 50 && postAfter <= 50) || postBefore <= 50;\n      if (countThisDart) setPendingDartsAtDouble((c) => (c || 0) + 1);\n    }\n\n    if (isFinish) {\n      // Commit visit with current total and end leg\n      callAddVisit(newScore, newDarts, {\n        preOpenDarts: pendingPreOpenDarts || 0,\n        doubleWindowDarts: pendingDartsAtDouble || 0,\n        finishedByDouble: true,\n        visitTotal: newScore,\n      });\n      callEndLeg(newScore);\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      setPendingPreOpenDarts(0);\n      setPendingDartsAtDouble(0);\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: true });\n      return;\n    }\n\n    if (newDarts >= 3) {\n      callAddVisit(newScore, newDarts, {\n        preOpenDarts: pendingPreOpenDarts || 0,\n        doubleWindowDarts: pendingDartsAtDouble || 0,\n        finishedByDouble: false,\n        visitTotal: newScore,\n      });\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      setPendingPreOpenDarts(0);\n      setPendingDartsAtDouble(0);\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: false });\n    }\n  }\n\n  function onAddAutoDart() {\n    if (shouldDeferCommit && awaitingClear) return;\n    if (lastAutoScore) {\n      if (onAutoDart) {\n        try {\n          onAutoDart(lastAutoValue, lastAutoRing, undefined);\n        } catch {}\n      } else {\n        addDart(lastAutoValue, lastAutoScore, lastAutoRing);\n      }\n      setNonRegCount(0);\n      setHadRecentAuto(false);\n    }\n  }\n\n  function onApplyManual() {\n    if (shouldDeferCommit && awaitingClear) return;\n    const parsed = parseManual(manualScore);\n    if (!parsed) {\n      alert(\"Enter like T20, D16, 5, 25, 50\");\n      return;\n    }\n    // If autoscore didn't register recently, count toward recalibration\n    if (\n      !hadRecentAuto ||\n      !lastAutoScore ||\n      lastAutoRing === \"MISS\" ||\n      lastAutoValue === 0\n    ) {\n      const c = nonRegCount + 1;\n      setNonRegCount(c);\n      if (c >= 5) setShowRecalModal(true);\n    } else {\n      setNonRegCount(0);\n    }\n    addDart(parsed.value, parsed.label, parsed.ring);\n    setManualScore(\"\");\n    setHadRecentAuto(false);\n  }\n\n  // Replace the last pending dart with a manually typed correction\n  function onReplaceManual() {\n    if (shouldDeferCommit && awaitingClear) return;\n    const parsed = parseManual(manualScore);\n    if (!parsed) {\n      alert(\"Enter like T20, D16, 5, 25, 50\");\n      return;\n    }\n    if (pendingDarts === 0 || pendingEntries.length === 0) {\n      onApplyManual();\n      return;\n    }\n    if (scoringMode === \"custom\") {\n      // Let parent handle replacement semantics\n      if (\n        !hadRecentAuto ||\n        !lastAutoScore ||\n        lastAutoRing === \"MISS\" ||\n        lastAutoValue === 0\n      ) {\n        const c = nonRegCount + 1;\n        setNonRegCount(c);\n        if (c >= 5) setShowRecalModal(true);\n      } else setNonRegCount(0);\n\n      // Update local pending UI\n      setPendingEntries((e) => [\n        ...e.slice(0, -1),\n        { label: parsed.label, value: parsed.value, ring: parsed.ring },\n      ]);\n      if (onGenericReplace)\n        try {\n          onGenericReplace(parsed.value, parsed.ring, { label: parsed.label });\n        } catch {}\n      setManualScore(\"\");\n      setHadRecentAuto(false);\n      return;\n    }\n    if (\n      !hadRecentAuto ||\n      !lastAutoScore ||\n      lastAutoRing === \"MISS\" ||\n      lastAutoValue === 0\n    ) {\n      const c = nonRegCount + 1;\n      setNonRegCount(c);\n      if (c >= 5) setShowRecalModal(true);\n    } else setNonRegCount(0);\n\n    const last = pendingEntries[pendingEntries.length - 1];\n    const prevDarts = pendingDarts - 1;\n    const prevScore = pendingScore - (last?.value || 0);\n    const remaining = getCurrentRemaining();\n    const newScore = prevScore + parsed.value;\n    const newDarts = prevDarts + 1;\n    const after = remaining - newScore;\n    const isFinish =\n      after === 0 && (parsed.ring === \"DOUBLE\" || parsed.ring === \"INNER_BULL\");\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish);\n\n    if (isBust) {\n      callAddVisit(0, newDarts);\n      try {\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\n        if (name) addSample(name, newDarts, 0);\n      } catch {}\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      enqueueVisitCommit({ score: 0, darts: newDarts, finished: false });\n      setManualScore(\"\");\n      setHadRecentAuto(false);\n      return;\n    }\n\n    setPendingDarts(newDarts);\n    setPendingScore(newScore);\n    setPendingEntries((e) => [\n      ...e.slice(0, -1),\n      { label: parsed.label, value: parsed.value, ring: parsed.ring },\n    ]);\n\n    if (isFinish) {\n      callAddVisit(newScore, newDarts);\n      callEndLeg(newScore);\n      try {\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\n        if (name) addSample(name, newDarts, newScore);\n      } catch {}\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: true });\n      setManualScore(\"\");\n      setHadRecentAuto(false);\n      return;\n    }\n\n    if (newDarts >= 3) {\n      callAddVisit(newScore, newDarts);\n      try {\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\n        if (name) addSample(name, newDarts, newScore);\n      } catch {}\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: false });\n    }\n    setManualScore(\"\");\n    setHadRecentAuto(false);\n  }\n\n  function onRecalibrateNow() {\n    setShowRecalModal(false);\n    setNonRegCount(0);\n    // Ask App to switch to calibrate tab\n    try {\n      window.dispatchEvent(new CustomEvent(\"ndn:request-calibrate\"));\n    } catch {}\n  }\n\n  function onResetCalibration() {\n    resetCalibration();\n    setShowRecalModal(false);\n    setNonRegCount(0);\n  }\n\n  // Keyboard shortcut: press 'm' to open Manual Correction (if not typing in an input)\n  useEffect(() => {\n    function onKey(e: KeyboardEvent) {\n      try {\n        const active = document.activeElement as HTMLElement | null;\n        const tag = active?.tagName?.toLowerCase();\n        if (e.key === \"m\" && tag !== \"input\" && tag !== \"textarea\") {\n          setActiveTab(\"manual\");\n          setShowManualModal(true);\n        }\n      } catch {}\n    }\n    window.addEventListener(\"keydown\", onKey);\n    return () => window.removeEventListener(\"keydown\", onKey);\n  }, []);\n\n  // Centralized quick-entry handler for S/D/T 1-20 buttons\n  function onQuickEntry(num: number, mult: \"S\" | \"D\" | \"T\") {\n    if (pendingDarts >= 3 || (shouldDeferCommit && awaitingClear)) return;\n    const val = num * (mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3);\n    const ring: Ring =\n      mult === \"S\" ? \"SINGLE\" : mult === \"D\" ? \"DOUBLE\" : \"TRIPLE\";\n    // If autoscore didn't register recently, count toward recalibration\n    if (\n      !hadRecentAuto ||\n      !lastAutoScore ||\n      lastAutoRing === \"MISS\" ||\n      lastAutoValue === 0\n    ) {\n      const c = nonRegCount + 1;\n      setNonRegCount(c);\n      if (c >= 5) setShowRecalModal(true);\n    } else {\n      setNonRegCount(0);\n    }\n    addDart(val, `${mult}${num} ${val}`, ring);\n    setHadRecentAuto(false);\n  }\n\n  function onUndoDart() {\n    if (pendingDarts === 0) return;\n    const last = pendingEntries[pendingEntries.length - 1];\n    setPendingDarts((d) => d - 1);\n    setPendingScore((s) => s - (last?.value || 0));\n    setPendingEntries((e) => e.slice(0, -1));\n  }\n\n  function onCommitVisit() {\n    if (pendingDarts === 0 || (shouldDeferCommit && awaitingClear)) return;\n    if (scoringMode === \"custom\") {\n      // For custom mode, simply clear local pending (parent maintains its own scoring)\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      return;\n    }\n    const visitScore = pendingScore;\n    const visitDarts = pendingDarts;\n    callAddVisit(visitScore, visitDarts);\n    try {\n      const name = matchState.players[matchState.currentPlayerIdx]?.name;\n      if (name) addSample(name, visitDarts, visitScore);\n    } catch {}\n    setPendingDarts(0);\n    setPendingScore(0);\n    setPendingEntries([]);\n    enqueueVisitCommit({\n      score: visitScore,\n      darts: visitDarts,\n      finished: false,\n    });\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n      {/* Pills (optional; can be hidden and controlled by parent) */}\n      {showToolbar && (\n        <div className=\"lg:col-span-2\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            {!manualOnly && (\n              <button\n                className={`btn px-3 py-1 text-sm ${activeTab === \"auto\" ? \"tab--active\" : \"\"}`}\n                onClick={() => {\n                  setActiveTab(\"auto\");\n                  setShowManualModal(false);\n                  setShowAutoModal(true);\n                }}\n              >\n                Autoscore\n              </button>\n            )}\n            <button\n              className={`btn px-3 py-1 text-sm ${activeTab === \"manual\" ? \"tab--active\" : \"\"}`}\n              onClick={() => {\n                setActiveTab(\"manual\");\n                setShowManualModal(true);\n              }}\n              title=\"Open Manual Correction\"\n            >\n              Manual Correction\n            </button>\n            {manualOnly && (\n              <span className=\"text-xs opacity-70\">\n                Manual scoring mode active\n              </span>\n            )}\n          </div>\n        </div>\n      )}\n      {!hideInlinePanels && !manualOnly ? (\n        <div className=\"card relative camera-fullwidth-card lg:col-span-2\">\n          <h2 className=\"text-xl font-semibold mb-3\">Camera</h2>\n          <ResizablePanel\n            storageKey=\"ndn:camera:size\"\n            className=\"relative rounded-2xl overflow-hidden bg-black\"\n            defaultWidth={480}\n            defaultHeight={360}\n            minWidth={360}\n            minHeight={270}\n            maxWidth={800}\n            maxHeight={600}\n            autoFill\n          >\n            <CameraSelector />\n            {(() => {\n              const aspect =\n                cameraAspect ||\n                useUserSettings.getState().cameraAspect ||\n                \"wide\";\n              const fit =\n                (cameraFitMode ||\n                  useUserSettings.getState().cameraFitMode ||\n                  \"fit\") === \"fit\";\n              const videoClass =\n                aspect === \"square\"\n                  ? \"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black\"\n                  : fit\n                    ? \"absolute inset-0 w-full h-full object-contain object-center bg-black\"\n                    : \"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black\";\n              const containerClass =\n                aspect === \"square\"\n                  ? \"relative w-full mx-auto aspect-square bg-black\"\n                  : \"relative w-full aspect-[4/3] bg-black\";\n              const renderVideoSurface = () => (\n                <div className={containerClass}>\n                  <video\n                    ref={videoRef}\n                    className={videoClass}\n                    playsInline\n                    muted\n                    autoPlay\n                  />\n                  <canvas\n                    ref={overlayRef}\n                    className=\"absolute inset-0 w-full h-full\"\n                    onClick={onOverlayClick}\n                  />\n                  <div\n                    className=\"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3 cursor-pointer select-none\"\n                    onDoubleClick={handleIndicatorReset}\n                    aria-label={`Visit status: ${pendingEntries[0] ? (pendingEntries[0].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[1] ? (pendingEntries[1].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[2] ? (pendingEntries[2].value > 0 ? \"hit\" : \"miss\") : \"pending\"}`}\n                  >\n                    {[0, 1, 2].map((i) => {\n                      const e = pendingEntries[i] as any;\n                      const entrySeq = indicatorEntryVersions[i];\n                      const isPending = !e;\n                      const isActive = !!e && entrySeq === indicatorVersion;\n                      const hasPositiveValue =\n                        typeof e?.value === \"number\" ? e.value > 0 : false;\n                      const hasHitRing =\n                        (e?.ring && e.ring !== \"MISS\") ?? false;\n                      const isHit =\n                        isActive && (hasPositiveValue || hasHitRing);\n                      const color = !isActive\n                        ? \"bg-gray-500/70\"\n                        : isHit\n                          ? \"bg-emerald-400\"\n                          : \"bg-rose-500\";\n                      const activeState = isActive && !isPending;\n                      return (\n                        <span\n                          key={i}\n                          className={`visit-dot ${activeState ? \"active\" : \"inactive\"} ${color}`}\n                        />\n                      );\n                    })}\n                    {dartTimerEnabled && dartTimeLeft !== null && (\n                      <span className=\"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold\">\n                        {Math.max(0, dartTimeLeft)}s\n                      </span>\n                    )}\n                  </div>\n                  {shouldDeferCommit && awaitingClear ? (\n                    <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow\">\n                      Remove darts to continue\n                    </div>\n                  ) : null}\n                </div>\n              );\n              if (isPhoneCamera) {\n                if (!phoneFeedActive) {\n                  return (\n                    <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50\">\n                      <div className=\"text-center space-y-3 max-w-xs mx-auto\">\n                        <div className=\"text-4xl\">ðŸ“±</div>\n                        <div className=\"text-lg font-semibold text-blue-100\">\n                          Phone camera selected\n                        </div>\n                        <p className=\"text-sm text-slate-300\">\n                          Start streaming from the Calibrator tab or reconnect\n                          below.\n                        </p>\n                        <div className=\"flex items-center justify-center gap-2 flex-wrap\">\n                          <button\n                            className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\n                            onClick={handlePhoneReconnect}\n                          >\n                            Reconnect Phone\n                          </button>\n                          <button\n                            className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\n                            onClick={() => {\n                              try {\n                                cameraSession.setShowOverlay?.(true);\n                              } catch {}\n                            }}\n                          >\n                            Show Overlay\n                          </button>\n                          <button\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\n                            onClick={handleUseLocalCamera}\n                            disabled={!availableCameras.length}\n                          >\n                            Use Local Camera\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  );\n                }\n                return renderVideoSurface();\n              }\n              return renderVideoSurface();\n            })()}\n          </ResizablePanel>\n\n          <div className=\"mt-3 flex items-center justify-between gap-2\">\n            <button\n              className=\"btn btn--ghost px-3 py-1 text-xs font-semibold\"\n              onClick={() => setShowDetectionLog((prev) => !prev)}\n            >\n              {showDetectionLog ? \"Hide\" : \"Show\"} detection log\n            </button>\n            <span className=\"text-xs text-slate-400\">\n              Recent detections: {detectionLog.length}\n            </span>\n          </div>\n          {showDetectionLog && (\n            <div className=\"mt-2 rounded-2xl border border-white/15 bg-slate-900/80 p-3 text-xs text-white font-mono max-h-36 overflow-y-auto space-y-1\">\n              {detectionLog.length === 0 ? (\n                <div className=\"text-center text-slate-400\">\n                  No autoscore detections yet.\n                </div>\n              ) : (\n                detectionLog\n                  .slice()\n                  .reverse()\n                  .map((entry) => (\n                    <div\n                      key={entry.ts}\n                      className=\"flex items-center justify-between gap-3\"\n                    >\n                      <span\n                        className=\"truncate flex-1\"\n                        title={`Value ${entry.value} ${entry.ring}`}\n                      >\n                        {entry.label.padEnd(6, \" \")}\n                      </span>\n                      <span className=\"text-slate-400\">\n                        {entry.confidence.toFixed(2)}\n                      </span>\n                      <span\n                        className={`px-2 rounded-full text-[10px] font-semibold ${entry.accepted ? \"bg-emerald-500/80\" : entry.ready ? \"bg-amber-500/80\" : \"bg-rose-500/80\"}`}\n                      >\n                        {entry.accepted\n                          ? \"accepted\"\n                          : entry.ready\n                            ? \"queued\"\n                            : \"ignored\"}\n                      </span>\n                    </div>\n                  ))\n              )}\n            </div>\n          )}\n\n          {/* Small Manual pill in top-right of camera card so users in any game mode can open Manual Correction */}\n          {inProgress ? (\n            <div className=\"absolute top-3 right-3 z-30\">\n              {/**\n               * Autoscore state styles:\n               * - success: recent auto detected a valid non-miss score -> green\n               * - ambiguous: recent auto detected but result is miss/zero/empty -> amber\n               * - idle: default white/neutral\n               */}\n              {(() => {\n                let stateClass = \"bg-white/90 text-slate-800\";\n                let title = \"Manual Correction (M)\";\n                if (hadRecentAuto) {\n                  const ok =\n                    !!lastAutoScore &&\n                    lastAutoRing !== \"MISS\" &&\n                    lastAutoValue > 0;\n                  if (ok) {\n                    stateClass = \"bg-emerald-600 text-white\";\n                    title = `Manual Correction (M) â€” Autoscore: ${lastAutoScore} (confirmed)`;\n                  } else {\n                    stateClass = \"bg-amber-400 text-black\";\n                    title = `Manual Correction (M) â€” Autoscore ambiguous: ${lastAutoScore || \"â€”\"}`;\n                  }\n                }\n                // Larger, clearer pill text and padding\n                const baseClasses =\n                  \"px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90\";\n                const okNow =\n                  hadRecentAuto &&\n                  !!lastAutoScore &&\n                  lastAutoRing !== \"MISS\" &&\n                  lastAutoValue > 0;\n                const pulseClass =\n                  pulseManualPill && okNow\n                    ? \"ring-4 ring-emerald-400/60 animate-ping\"\n                    : hadRecentAuto && !okNow\n                      ? \"animate-pulse\"\n                      : \"\";\n                return (\n                  <button\n                    className={`${baseClasses} ${stateClass} ${pulseClass}`}\n                    onClick={() => {\n                      setActiveTab(\"manual\");\n                      setShowManualModal(true);\n                    }}\n                    title={title}\n                  >\n                    Manual\n                  </button>\n                );\n              })()}\n            </div>\n          ) : null}\n          <div className=\"flex flex-wrap items-center gap-2 mt-3\">\n            {isPhoneCamera ? (\n              <>\n                <div\n                  className={`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${phoneFeedActive ? \"bg-emerald-500/10 border-emerald-400/40 text-emerald-100\" : \"bg-amber-500/10 border-amber-400/40 text-amber-100\"}`}\n                >\n                  {phoneFeedActive\n                    ? \"ðŸ“± Phone camera stream active\"\n                    : \"ðŸ“± Waiting for phone camera stream\"}\n                </div>\n                <button\n                  className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\n                  onClick={handlePhoneReconnect}\n                >\n                  Reconnect Phone\n                </button>\n                <button\n                  className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\n                  onClick={() => {\n                    try {\n                      cameraSession.setShowOverlay?.(\n                        !cameraSession.showOverlay,\n                      );\n                    } catch {}\n                  }}\n                >\n                  {cameraSession.showOverlay ? \"Hide Overlay\" : \"Show Overlay\"}\n                </button>\n                <button\n                  className=\"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm\"\n                  disabled={!phoneFeedActive}\n                  onClick={() => {\n                    try {\n                      cameraSession.clearSession?.();\n                    } catch {}\n                  }}\n                >\n                  Stop Phone Feed\n                </button>\n                {canFallbackToLocal && (\n                  <button\n                    className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\n                    onClick={handleUseLocalCamera}\n                    disabled={!availableCameras.length}\n                  >\n                    Use Local Camera\n                  </button>\n                )}\n              </>\n            ) : (\n              <>\n                {!streaming ? (\n                  <button\n                    className=\"btn\"\n                    onClick={startCamera}\n                    disabled={cameraStarting}\n                  >\n                    {cameraStarting ? \"Connecting Camera...\" : \"Connect Camera\"}\n                  </button>\n                ) : (\n                  <button\n                    className=\"btn bg-rose-600 hover:bg-rose-700\"\n                    onClick={stopCamera}\n                  >\n                    Stop Camera\n                  </button>\n                )}\n              </>\n            )}\n            {!manualOnly && (\n              <button\n                className=\"btn bg-slate-700 hover:bg-slate-800\"\n                onClick={requestDeviceManager}\n                title=\"Open phone, WiFi, and USB camera options\"\n              >\n                Camera Devices\n              </button>\n            )}\n            <button\n              className=\"btn btn--ghost px-3 py-1 text-sm\"\n              onClick={() => setHideCameraOverlay(!hideCameraOverlay)}\n              title=\"Toggle the board guide overlay\"\n            >\n              {hideCameraOverlay ? \"Show board guides\" : \"Hide board guides\"}\n            </button>\n            <button\n              className={`btn ${cameraEnabled ? \"bg-rose-600 hover:bg-rose-700 text-white\" : \"bg-emerald-600 hover:bg-emerald-700 text-white\"}`}\n              onClick={() => setCameraEnabled(!cameraEnabled)}\n              title=\"Toggle whether the camera is used for scoring\"\n            >\n              {cameraEnabled ? \"Disable camera mode\" : \"Enable camera mode\"}\n            </button>\n            <button\n              className=\"btn\"\n              onClick={capture}\n              disabled={!effectiveStreaming}\n            >\n              Capture Still\n            </button>\n            <button\n              className=\"btn bg-slate-700 hover:bg-slate-800\"\n              disabled={!effectiveStreaming}\n              onClick={() => {\n                detectorRef.current = null;\n                setDetectorSeedVersion((v) => v + 1);\n              }}\n            >\n              Reset Autoscore Background\n            </button>\n            <button\n              className=\"btn bg-slate-700 hover:bg-slate-800\"\n              onClick={() => {\n                try {\n                  window.dispatchEvent(new Event(\"ndn:camera-reset\" as any));\n                } catch {}\n              }}\n            >\n              Reset Camera Size\n            </button>\n          </div>\n        </div>\n      ) : null}\n\n      {/* Floating Manual Correction button (always available for quick manual typing during games) */}\n      {inProgress ? (\n        <div className=\"fixed bottom-6 right-6 z-50\">\n          <button\n            className=\"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg\"\n            title=\"Open Manual Correction (M)\"\n            onClick={() => {\n              setActiveTab(\"manual\");\n              setShowManualModal(true);\n            }}\n          >\n            âœï¸\n          </button>\n        </div>\n      ) : null}\n      {!hideInlinePanels && manualOnly && (\n        <div className=\"card\">\n          <h2 className=\"text-xl font-semibold mb-3\">Manual Scoring</h2>\n          <p className=\"text-sm opacity-80 mb-3\">\n            Camera-based autoscore is disabled. Use the manual visit input or\n            open the Manual Correction panel to record darts.\n          </p>\n          <div className=\"flex flex-wrap items-center gap-2\">\n            <button\n              className=\"btn\"\n              onClick={() => {\n                setShowManualModal(true);\n                setActiveTab(\"manual\");\n              }}\n            >\n              Open Manual Correction\n            </button>\n            <button\n              className=\"btn btn--ghost\"\n              onClick={() => {\n                try {\n                  window.dispatchEvent(new Event(\"ndn:open-scoring\" as any));\n                } catch {}\n              }}\n            >\n              Manage Pending Visit\n            </button>\n          </div>\n        </div>\n      )}\n      {/* Snapshot panel removed to reduce unused space */}\n      <canvas ref={canvasRef} className=\"hidden\"></canvas>\n      {/* Autoscore moved into a pill-triggered modal to reduce on-screen clutter */}\n      {/* Modal: Autoscore */}\n      {showAutoModal && !manualOnly && (\n        <div\n          className=\"fixed inset-0 bg-black/60 z-[100]\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n        >\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\n            <ResizableModal\n              storageKey=\"ndn:autoscore:size\"\n              className=\"w-full max-w-3xl\"\n              defaultWidth={720}\n              defaultHeight={520}\n              minWidth={420}\n              minHeight={320}\n              maxWidth={1400}\n              maxHeight={900}\n              initialFitHeight\n            >\n              <div className=\"flex items-center justify-between mb-3\">\n                <h2 className=\"text-xl font-semibold\">Autoscore</h2>\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    className=\"btn btn--ghost\"\n                    onClick={() => setShowAutoModal(false)}\n                  >\n                    Close\n                  </button>\n                </div>\n              </div>\n              <div className=\"text-sm opacity-80 mb-3\">\n                Click the camera overlay to autoscore. Use Manual Correction if\n                the last auto is off.\n              </div>\n              <div className=\"flex items-center gap-2 mb-3 flex-wrap\">\n                <span className=\"font-semibold\">Last auto:</span>\n                <span>{lastAutoScore || \"â€”\"}</span>\n                <button\n                  className=\"btn\"\n                  onClick={onAddAutoDart}\n                  disabled={pendingDarts >= 3}\n                >\n                  Add Auto Dart\n                </button>\n                {nonRegCount > 0 && (\n                  <span className=\"text-sm opacity-80\">\n                    No-registers: {nonRegCount}/3\n                  </span>\n                )}\n              </div>\n              <div className=\"mt-2\">\n                <div className=\"text-sm font-semibold mb-2\">Quick entry</div>\n                {/* Bulls */}\n                <div className=\"flex flex-wrap gap-2 mb-3\">\n                  <button\n                    className=\"btn\"\n                    disabled={pendingDarts >= 3}\n                    onClick={() => {\n                      if (\n                        !hadRecentAuto ||\n                        !lastAutoScore ||\n                        lastAutoRing === \"MISS\" ||\n                        lastAutoValue === 0\n                      ) {\n                        const c = nonRegCount + 1;\n                        setNonRegCount(c);\n                        if (c >= 5) setShowRecalModal(true);\n                      } else setNonRegCount(0);\n                      addDart(25, \"BULL 25\", \"BULL\");\n                      setHadRecentAuto(false);\n                    }}\n                  >\n                    25\n                  </button>\n                  <button\n                    className=\"btn\"\n                    disabled={pendingDarts >= 3}\n                    onClick={() => {\n                      if (\n                        !hadRecentAuto ||\n                        !lastAutoScore ||\n                        lastAutoRing === \"MISS\" ||\n                        lastAutoValue === 0\n                      ) {\n                        const c = nonRegCount + 1;\n                        setNonRegCount(c);\n                        if (c >= 5) setShowRecalModal(true);\n                      } else setNonRegCount(0);\n                      addDart(50, \"INNER_BULL 50\", \"INNER_BULL\");\n                      setHadRecentAuto(false);\n                    }}\n                  >\n                    50\n                  </button>\n                </div>\n                {/* Grouped dropdown: Doubles, Singles, Trebles */}\n                <div className=\"flex items-center gap-2 mb-3\">\n                  <input\n                    className=\"input w-full max-w-sm\"\n                    list=\"autoscore-quick-list\"\n                    placeholder=\"Type or select (e.g., D16, T20, S5)\"\n                    value={quickSelAuto}\n                    onChange={(e) =>\n                      setQuickSelAuto(e.target.value.toUpperCase())\n                    }\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\") {\n                        const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/);\n                        if (m) {\n                          onQuickEntry(parseInt(m[2], 10), m[1] as any);\n                        }\n                      }\n                    }}\n                  />\n                  <datalist id=\"autoscore-quick-list\">\n                    {([\"D\", \"S\", \"T\"] as const).map((mult) =>\n                      Array.from({ length: 20 }, (_, i) => i + 1).map((num) => (\n                        <option key={`${mult}${num}`} value={`${mult}${num}`} />\n                      )),\n                    )}\n                  </datalist>\n                  <button\n                    className=\"btn\"\n                    disabled={!quickSelAuto || pendingDarts >= 3}\n                    onClick={() => {\n                      const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/);\n                      if (!m) return;\n                      const mult = m[1] as \"S\" | \"D\" | \"T\";\n                      const num = parseInt(m[2], 10);\n                      onQuickEntry(num, mult);\n                    }}\n                  >\n                    Add\n                  </button>\n                </div>\n              </div>\n            </ResizableModal>\n          </div>\n        </div>\n      )}\n      {showManualModal && (\n        <div\n          className=\"fixed inset-0 bg-black/60 z-[100]\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n        >\n          <div className=\"absolute inset-0 flex flex-col\">\n            <FocusLock returnFocus>\n              <div className=\"p-3 md:p-4 flex items-center justify-between\">\n                <h3 className=\"text-xl md:text-2xl font-semibold\">\n                  Manual Correction\n                </h3>\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    className=\"btn bg-slate-700 hover:bg-slate-800\"\n                    onClick={() => {\n                      setShowManualModal(false);\n                    }}\n                  >\n                    Close\n                  </button>\n                </div>\n              </div>\n              <div className=\"flex-1 p-3 md:p-4\">\n                <div className=\"h-full grid grid-cols-1 lg:grid-cols-2 gap-4\">\n                  {/* Live preview */}\n                  <div className=\"card relative flex flex-col\">\n                    <div className=\"text-sm font-semibold mb-2\">\n                      Live Preview\n                    </div>\n                    <div className=\"relative flex-1 rounded-2xl overflow-hidden bg-black\">\n                      <canvas\n                        ref={manualPreviewRef}\n                        className=\"absolute inset-0 w-full h-full\"\n                      />\n                    </div>\n                  </div>\n                  {/* Manual controls */}\n                  <div className=\"card flex flex-col\">\n                    <div className=\"text-sm opacity-80 mb-2\">\n                      Type a correction or replace the last dart. The preview\n                      updates live.\n                    </div>\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <span className=\"font-semibold\">Last auto:</span>\n                      <span>{lastAutoScore || \"â€”\"}</span>\n                      <button\n                        className=\"btn\"\n                        onClick={onAddAutoDart}\n                        disabled={pendingDarts >= 3}\n                      >\n                        Add Auto Dart\n                      </button>\n                    </div>\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <input\n                        className=\"input flex-[1.2]\"\n                        placeholder=\"Manual (T20, D16, 5, 25, 50)\"\n                        value={manualScore}\n                        onChange={(e) => setManualScore(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === \"Enter\" && !e.shiftKey) {\n                            e.preventDefault();\n                            onApplyManual();\n                          }\n                          if (e.key === \"Enter\" && e.shiftKey) {\n                            e.preventDefault();\n                            onReplaceManual();\n                          }\n                        }}\n                      />\n                      <button\n                        className=\"btn btn--ghost\"\n                        onClick={onReplaceManual}\n                        disabled={pendingDarts === 0}\n                      >\n                        Replace Last\n                      </button>\n                      <button\n                        className=\"btn\"\n                        onClick={onApplyManual}\n                        disabled={pendingDarts >= 3}\n                      >\n                        Add\n                      </button>\n                    </div>\n                    <div className=\"text-xs opacity-70 mb-4\">\n                      Press Enter to Add Â· Shift+Enter to Replace Last\n                    </div>\n                    {/* Numeric keypad for quick manual numeric entry */}\n                    <div className=\"mb-4\">\n                      <div className=\"text-sm font-semibold mb-2\">\n                        Number pad\n                      </div>\n                      <div className=\"grid grid-cols-3 gap-2 max-w-sm\">\n                        {[\"7\", \"8\", \"9\", \"4\", \"5\", \"6\", \"1\", \"2\", \"3\", \"0\"].map(\n                          (d) => (\n                            <button\n                              key={d}\n                              className=\"btn text-lg\"\n                              onClick={() => {\n                                // Append digit to manualScore (keep T/D/T prefixes if present)\n                                setManualScore((ms) => {\n                                  // If existing starts with letter (S/D/T), append after it\n                                  if (/^[SDT]/i.test(ms)) return ms + d;\n                                  return (ms || \"\") + d;\n                                });\n                              }}\n                            >\n                              {d}\n                            </button>\n                          ),\n                        )}\n                        <button\n                          className=\"btn bg-rose-600 hover:bg-rose-700 text-white\"\n                          onClick={() => setManualScore(\"\")}\n                        >\n                          Clear\n                        </button>\n                        <button\n                          className=\"btn bg-slate-600 hover:bg-slate-700 text-white\"\n                          onClick={() =>\n                            setManualScore((ms) => (ms || \"\").slice(0, -1))\n                          }\n                        >\n                          âŒ«\n                        </button>\n                        <button\n                          className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\"\n                          onClick={() => onApplyManual()}\n                          disabled={pendingDarts >= 3}\n                        >\n                          Enter\n                        </button>\n                      </div>\n                      <div className=\"text-xs opacity-70 mt-2\">\n                        Tap numbers then press Enter to submit. Use D/T prefixes\n                        for doubles/trebles (e.g., D16).\n                      </div>\n                    </div>\n                    <div className=\"mt-auto\">\n                      <div className=\"text-sm font-semibold mb-2\">\n                        Quick entry\n                      </div>\n                      {/* Bulls */}\n                      <div className=\"flex flex-wrap gap-2 mb-3\">\n                        <button\n                          className=\"btn\"\n                          disabled={pendingDarts >= 3}\n                          onClick={() => {\n                            if (\n                              !hadRecentAuto ||\n                              !lastAutoScore ||\n                              lastAutoRing === \"MISS\" ||\n                              lastAutoValue === 0\n                            ) {\n                              const c = nonRegCount + 1;\n                              setNonRegCount(c);\n                              if (c >= 5) setShowRecalModal(true);\n                            } else setNonRegCount(0);\n                            addDart(25, \"BULL 25\", \"BULL\");\n                            setHadRecentAuto(false);\n                          }}\n                        >\n                          25\n                        </button>\n                        <button\n                          className=\"btn\"\n                          disabled={pendingDarts >= 3}\n                          onClick={() => {\n                            if (\n                              !hadRecentAuto ||\n                              !lastAutoScore ||\n                              lastAutoRing === \"MISS\" ||\n                              lastAutoValue === 0\n                            ) {\n                              const c = nonRegCount + 1;\n                              setNonRegCount(c);\n                              if (c >= 5) setShowRecalModal(true);\n                            } else setNonRegCount(0);\n                            addDart(50, \"INNER_BULL 50\", \"INNER_BULL\");\n                            setHadRecentAuto(false);\n                          }}\n                        >\n                          50\n                        </button>\n                      </div>\n                      {/* Grouped dropdown: Doubles, Singles, Trebles */}\n                      <div className=\"flex items-center gap-2 mb-3\">\n                        <input\n                          className=\"input w-full max-w-sm\"\n                          list=\"manual-quick-list\"\n                          placeholder=\"Type or select (e.g., D16, T20, S5)\"\n                          value={quickSelManual}\n                          onChange={(e) =>\n                            setQuickSelManual(e.target.value.toUpperCase())\n                          }\n                          onKeyDown={(e) => {\n                            if (e.key === \"Enter\") {\n                              const m =\n                                quickSelManual.match(/^(S|D|T)(\\d{1,2})$/);\n                              if (m) {\n                                onQuickEntry(parseInt(m[2], 10), m[1] as any);\n                              }\n                            }\n                          }}\n                        />\n                        <datalist id=\"manual-quick-list\">\n                          {([\"D\", \"S\", \"T\"] as const).map((mult) =>\n                            Array.from({ length: 20 }, (_, i) => i + 1).map(\n                              (num) => (\n                                <option\n                                  key={`${mult}${num}`}\n                                  value={`${mult}${num}`}\n                                />\n                              ),\n                            ),\n                          )}\n                        </datalist>\n                        <button\n                          className=\"btn\"\n                          disabled={!quickSelManual || pendingDarts >= 3}\n                          onClick={() => {\n                            const m =\n                              quickSelManual.match(/^(S|D|T)(\\d{1,2})$/);\n                            if (!m) return;\n                            const mult = m[1] as \"S\" | \"D\" | \"T\";\n                            const num = parseInt(m[2], 10);\n                            onQuickEntry(num, mult);\n                          }}\n                        >\n                          Add\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </FocusLock>\n          </div>\n        </div>\n      )}\n      {showScoringModal && (\n        <div className=\"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center\">\n          <FocusLock returnFocus>\n            <div\n              className=\"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\"\n              role=\"dialog\"\n              aria-modal=\"true\"\n            >\n              <button\n                className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\"\n                onClick={() => setShowScoringModal(false)}\n                aria-label=\"Close scoring dialog\"\n              >\n                Close\n              </button>\n              <h2 className=\"text-xl font-bold mb-4 flex items-center gap-2 text-white\">\n                Scoring\n              </h2>\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* Camera section */}\n                <div className=\"bg-black/30 rounded-2xl p-4\">\n                  <h2 className=\"text-lg font-semibold mb-3\">Camera</h2>\n                  <ResizablePanel\n                    storageKey=\"ndn:camera:size:modal\"\n                    className=\"relative rounded-2xl overflow-hidden bg-black\"\n                    defaultWidth={480}\n                    defaultHeight={360}\n                    minWidth={360}\n                    minHeight={270}\n                    maxWidth={800}\n                    maxHeight={600}\n                  >\n                    <CameraSelector />\n                    {(() => {\n                      const fit =\n                        (useUserSettings.getState().cameraFitMode || \"fit\") ===\n                        \"fit\";\n                      const videoClass = fit\n                        ? \"absolute inset-0 w-full h-full object-contain object-center bg-black\"\n                        : \"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black\";\n                      const renderVideoSurface = () => (\n                        <div className=\"relative w-full aspect-[4/3] bg-black\">\n                          <video\n                            ref={videoRef}\n                            className={videoClass}\n                            playsInline\n                            muted\n                            autoPlay\n                          />\n                          <canvas\n                            ref={overlayRef}\n                            className=\"absolute inset-0 w-full h-full\"\n                            onClick={onOverlayClick}\n                          />\n                          <div\n                            className=\"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3\"\n                            aria-label={`Visit status: ${pendingEntries[0] ? (pendingEntries[0].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[1] ? (pendingEntries[1].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[2] ? (pendingEntries[2].value > 0 ? \"hit\" : \"miss\") : \"pending\"}`}\n                          >\n                            {[0, 1, 2].map((i) => {\n                              const e = pendingEntries[i] as any;\n                              const isPending = !e;\n                              const isHit =\n                                !!e &&\n                                (typeof e.value === \"number\"\n                                  ? e.value > 0\n                                  : true);\n                              const color = isPending\n                                ? \"bg-gray-500/70\"\n                                : isHit\n                                  ? \"bg-emerald-400\"\n                                  : \"bg-rose-500\";\n                              return (\n                                <span\n                                  key={i}\n                                  className={`w-3 h-3 rounded-full shadow ${color}`}\n                                />\n                              );\n                            })}\n                            {dartTimerEnabled && dartTimeLeft !== null && (\n                              <span className=\"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold\">\n                                {Math.max(0, dartTimeLeft)}s\n                              </span>\n                            )}\n                          </div>\n                          {shouldDeferCommit && awaitingClear ? (\n                            <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow\">\n                              Remove darts to continue\n                            </div>\n                          ) : null}\n                        </div>\n                      );\n                      if (isPhoneCamera) {\n                        if (!phoneFeedActive) {\n                          return (\n                            <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50\">\n                              <div className=\"text-center space-y-3 max-w-xs mx-auto\">\n                                <div className=\"text-4xl\">ðŸ“±</div>\n                                <div className=\"text-lg font-semibold text-blue-100\">\n                                  Phone camera selected\n                                </div>\n                                <p className=\"text-sm text-slate-300\">\n                                  Start streaming from the Calibrator tab or\n                                  reconnect below.\n                                </p>\n                                <div className=\"flex items-center justify-center gap-2 flex-wrap\">\n                                  <button\n                                    className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\n                                    onClick={handlePhoneReconnect}\n                                  >\n                                    Reconnect Phone\n                                  </button>\n                                  <button\n                                    className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\n                                    onClick={() => {\n                                      try {\n                                        cameraSession.setShowOverlay?.(true);\n                                      } catch {}\n                                    }}\n                                  >\n                                    Show Overlay\n                                  </button>\n                                  <button\n                                    className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\n                                    onClick={handleUseLocalCamera}\n                                    disabled={!availableCameras.length}\n                                  >\n                                    Use Local Camera\n                                  </button>\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        }\n                        return renderVideoSurface();\n                      }\n                      return renderVideoSurface();\n                    })()}\n                  </ResizablePanel>\n                  <div className=\"flex flex-wrap items-center gap-2 mt-3\">\n                    {isPhoneCamera ? (\n                      <>\n                        <div\n                          className={`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${phoneFeedActive ? \"bg-emerald-500/10 border-emerald-400/40 text-emerald-100\" : \"bg-amber-500/10 border-amber-400/40 text-amber-100\"}`}\n                        >\n                          {phoneFeedActive\n                            ? \"ðŸ“± Phone camera stream active\"\n                            : \"ðŸ“± Waiting for phone camera stream\"}\n                        </div>\n                        <button\n                          className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\n                          onClick={handlePhoneReconnect}\n                        >\n                          Reconnect Phone\n                        </button>\n                        <button\n                          className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\n                          onClick={() => {\n                            try {\n                              cameraSession.setShowOverlay?.(\n                                !cameraSession.showOverlay,\n                              );\n                            } catch {}\n                          }}\n                        >\n                          {cameraSession.showOverlay\n                            ? \"Hide Overlay\"\n                            : \"Show Overlay\"}\n                        </button>\n                        <button\n                          className=\"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm\"\n                          disabled={!phoneFeedActive}\n                          onClick={() => {\n                            try {\n                              cameraSession.clearSession?.();\n                            } catch {}\n                          }}\n                        >\n                          Stop Phone Feed\n                        </button>\n                        {canFallbackToLocal && (\n                          <button\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\n                            onClick={handleUseLocalCamera}\n                            disabled={!availableCameras.length}\n                          >\n                            Use Local Camera\n                          </button>\n                        )}\n                      </>\n                    ) : (\n                      <>\n                        {!streaming ? (\n                          <button\n                            className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\n                            onClick={startCamera}\n                          >\n                            Connect Camera\n                          </button>\n                        ) : (\n                          <button\n                            className=\"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold\"\n                            onClick={stopCamera}\n                          >\n                            Stop Camera\n                          </button>\n                        )}\n                      </>\n                    )}\n                    <button\n                      className=\"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold\"\n                      onClick={capture}\n                      disabled={!effectiveStreaming}\n                    >\n                      Capture Still\n                    </button>\n                    <button\n                      className=\"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold\"\n                      disabled={!effectiveStreaming}\n                      onClick={() => {\n                        detectorRef.current = null;\n                        setDetectorSeedVersion((v) => v + 1);\n                      }}\n                    >\n                      Reset Autoscore Background\n                    </button>\n                    <button\n                      className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\n                      onClick={() => {\n                        try {\n                          window.dispatchEvent(\n                            new Event(\"ndn:camera-reset\" as any),\n                          );\n                        } catch {}\n                      }}\n                    >\n                      Reset Camera Size\n                    </button>\n                  </div>\n                </div>\n                {/* Pending Visit section */}\n                <div className=\"bg-black/30 rounded-2xl p-4\">\n                  <h2 className=\"text-lg font-semibold mb-3\">Pending Visit</h2>\n                  <div className=\"text-sm opacity-80 mb-2\">\n                    Up to 3 darts per visit.\n                  </div>\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    {[0, 1, 2].map((i) => {\n                      const e = pendingEntries[i] as any;\n                      const isPending = !e;\n                      const isHit =\n                        !!e &&\n                        (typeof e.value === \"number\" ? e.value > 0 : true);\n                      const color = isPending\n                        ? \"bg-gray-500/70\"\n                        : isHit\n                          ? \"bg-emerald-400\"\n                          : \"bg-rose-500\";\n                      return (\n                        <span\n                          key={i}\n                          className={`w-2.5 h-2.5 rounded-full shadow ${color}`}\n                        />\n                      );\n                    })}\n                    {dartTimerEnabled && dartTimeLeft !== null && (\n                      <span className=\"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold\">\n                        {Math.max(0, dartTimeLeft)}s\n                      </span>\n                    )}\n                  </div>\n                  <ul className=\"text-sm mb-2 list-disc pl-5\">\n                    {pendingEntries.length === 0 ? (\n                      <li className=\"opacity-60\">No darts yet</li>\n                    ) : (\n                      pendingEntries.map((e, i) => <li key={i}>{e.label}</li>)\n                    )}\n                  </ul>\n                  <div className=\"flex items-center gap-4 mb-2\">\n                    <div className=\"font-semibold\">Darts: {pendingDarts}/3</div>\n                    <div className=\"font-semibold\">Total: {pendingScore}</div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\n                      onClick={onUndoDart}\n                      disabled={pendingDarts === 0}\n                    >\n                      Undo Dart\n                    </button>\n                    <button\n                      className=\"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold\"\n                      onClick={onCommitVisit}\n                      disabled={pendingDarts === 0}\n                    >\n                      Commit Visit\n                    </button>\n                    <button\n                      className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\n                      onClick={handleToolbarClear}\n                      disabled={pendingDarts === 0}\n                    >\n                      Clear\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </FocusLock>\n        </div>\n      )}\n      {showRecalModal && (\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\n          <div className=\"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\n            <button\n              className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\"\n              onClick={() => {\n                setShowRecalModal(false);\n                setNonRegCount(0);\n              }}\n            >\n              Close\n            </button>\n            <h3 className=\"text-xl font-bold mb-2 flex items-center gap-2 text-white\">\n              Recalibration Recommended\n            </h3>\n            <div className=\"mb-4 text-lg font-semibold text-indigo-200\">\n              We detected 3 incorrect autoscores in a row. You can recalibrate\n              now or reset calibration and try again.\n            </div>\n            <div className=\"flex gap-2\">\n              <button\n                className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\n                onClick={onRecalibrateNow}\n              >\n                Go to Calibrate\n              </button>\n              <button\n                className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\n                onClick={onResetCalibration}\n              >\n                Reset Calibration\n              </button>\n              <button\n                className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\n                onClick={() => {\n                  setShowRecalModal(false);\n                  setNonRegCount(0);\n                }}\n              >\n                Dismiss\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      {/* Duplicate Pending Visit panel removed to avoid showing the same controls twice when inline panels are visible. */}\n    </div>\n  );\n}\n","import React, { useEffect, useRef } from \"react\";\nimport useHeatmapStore from \"../store/heatmap\";\nimport { BoardRadii } from \"../utils/vision\";\n\nfunction polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {\n  const a = ((angleDeg - 90) * Math.PI) / 180.0;\n  return { x: cx + r * Math.cos(a), y: cy + r * Math.sin(a) };\n}\n\nfunction sectorAngle(sector: number) {\n  // SectorOrder puts 20 at top; 360/20 = 18deg per sector\n  const SectorOrder = [\n    20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5,\n  ];\n  const idx = SectorOrder.indexOf(sector);\n  const mid = idx * 18 + 9; // middle of sector\n  return mid;\n}\n\nexport default function HeatMap({\n  width = 320,\n  height = 320,\n}: {\n  width?: number;\n  height?: number;\n}) {\n  const samples = useHeatmapStore((s) => s.samples);\n  const ref = useRef<HTMLCanvasElement | null>(null);\n\n  useEffect(() => {\n    const c = ref.current;\n    if (!c) return;\n    const ctx = c.getContext(\"2d\");\n    if (!ctx) return;\n    c.width = width;\n    c.height = height;\n    ctx.clearRect(0, 0, width, height);\n    // Draw a faint dartboard backdrop (rings)\n    const cx = width / 2;\n    const cy = height / 2;\n    const scale = Math.min(width, height) / (BoardRadii.doubleOuter * 2 + 20);\n    const radii = {\n      bullInner: BoardRadii.bullInner * scale,\n      bullOuter: BoardRadii.bullOuter * scale,\n      trebleInner: BoardRadii.trebleInner * scale,\n      trebleOuter: BoardRadii.trebleOuter * scale,\n      doubleInner: BoardRadii.doubleInner * scale,\n      doubleOuter: BoardRadii.doubleOuter * scale,\n    };\n    // rings\n    ctx.strokeStyle = \"rgba(255,255,255,0.06)\";\n    ctx.lineWidth = 1;\n    const ringOrder = [\n      \"doubleOuter\",\n      \"doubleInner\",\n      \"trebleOuter\",\n      \"trebleInner\",\n      \"bullOuter\",\n      \"bullInner\",\n    ] as const;\n    for (const k of ringOrder) {\n      ctx.beginPath();\n      ctx.arc(cx, cy, (radii as any)[k], 0, Math.PI * 2);\n      ctx.stroke();\n    }\n\n    // Aggregate sample weights by approximate xy\n    const points: { x: number; y: number; w: number }[] = [];\n    for (const s of samples) {\n      // if sector unknown, scatter in board\n      let angle = Math.random() * 360;\n      let r = Math.random() * radii.doubleOuter;\n      if (typeof s.sector === \"number\" && s.sector >= 1 && s.sector <= 20) {\n        angle = sectorAngle(s.sector);\n        // choose radius by mult/ring\n        if (s.ring === \"DOUBLE\")\n          r = (radii.doubleInner + radii.doubleOuter) / 2;\n        else if (s.ring === \"TRIPLE\")\n          r = (radii.trebleInner + radii.trebleOuter) / 2;\n        else if (s.ring === \"INNER_BULL\") r = radii.bullInner * 0.5;\n        else if (s.ring === \"BULL\") r = radii.bullOuter * 0.8;\n        else\n          r =\n            ((radii.trebleOuter + radii.doubleInner) / 2) *\n            (0.6 + Math.random() * 0.4);\n      }\n      const p = polarToCartesian(cx, cy, r, angle);\n      points.push({ x: p.x, y: p.y, w: 1 });\n    }\n\n    // Draw heat circles additive\n    for (const p of points) {\n      const grd = ctx.createRadialGradient(p.x, p.y, 1, p.x, p.y, 60);\n      grd.addColorStop(0, \"rgba(255,0,0,0.9)\");\n      grd.addColorStop(0.3, \"rgba(255,100,0,0.5)\");\n      grd.addColorStop(1, \"rgba(255,100,0,0)\");\n      ctx.fillStyle = grd;\n      ctx.beginPath();\n      ctx.arc(p.x, p.y, 60, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    // Optionally overlay counts per sector\n    ctx.fillStyle = \"rgba(255,255,255,0.85)\";\n    ctx.font = \"12px ui-sans-serif\";\n    // compute counts per sector\n    const sectorCounts: Record<number, number> = {};\n    for (const s of samples)\n      if (s.sector) sectorCounts[s.sector] = (sectorCounts[s.sector] || 0) + 1;\n    for (const secStr of Object.keys(sectorCounts)) {\n      const sec = Number(secStr);\n      const a = sectorAngle(sec);\n      const pos = polarToCartesian(cx, cy, radii.trebleOuter + 18, a);\n      ctx.fillText(String(sectorCounts[sec]), pos.x - 6, pos.y + 4);\n    }\n  }, [samples, width, height]);\n\n  return (\n    <canvas\n      ref={ref}\n      style={{\n        width: \"100%\",\n        height: \"auto\",\n        borderRadius: 8,\n        background: \"#081018\",\n      }}\n    />\n  );\n}\n","export type DartMult = \"S\" | \"D\" | \"T\";\nexport type Dart = { mult: DartMult; num: number } | { bull: 25 | 50 };\n\nexport type DoublePracticeState = {\n  targetIndex: number; // 0..20 for D1..D20 then 21 for DBULL\n  completed: boolean;\n};\n\nexport const DOUBLE_PRACTICE_TARGETS: Array<{\n  label: string;\n  score: number;\n  isBull?: boolean;\n}>[] = [] as any;\n\nexport const DOUBLE_PRACTICE_ORDER: {\n  label: string;\n  score: number;\n  isBull?: boolean;\n}[] = [\n  ...Array.from({ length: 20 }, (_, i) => ({\n    label: `D${i + 1}`,\n    score: (i + 1) * 2,\n  })),\n  { label: \"DBULL\", score: 50, isBull: true },\n];\n\nexport function isDoubleHit(value: number, targetIdx: number): boolean {\n  const t = DOUBLE_PRACTICE_ORDER[targetIdx];\n  return !!t && value === t.score;\n}\n\nexport function parseManualDart(input: string): number | null {\n  const t = input.trim().toUpperCase();\n  if (!t) return null;\n  if (t === \"50\" || t === \"BULL\" || t === \"DBULL\" || t === \"IBULL\") return 50;\n  if (t === \"25\" || t === \"OBULL\") return 25;\n  const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\n  if (!m) return null;\n  const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\n  const num = parseInt(m[2], 10);\n  if (num < 1 || num > 20) return null;\n  const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\n  return num * multVal;\n}\n\n// Parse a detailed dart string like \"T20\", \"D16\", \"S5\", \"25\", \"50\", \"BULL\", returning a structured Dart.\nexport function parseDartDetailed(input: string): Dart | null {\n  const t = input.trim().toUpperCase();\n  if (!t) return null;\n  if (\n    t === \"50\" ||\n    t === \"BULL\" ||\n    t === \"DBULL\" ||\n    t === \"IBULL\" ||\n    t === \"INNER BULL\" ||\n    t === \"INNER_BULL\"\n  )\n    return { bull: 50 };\n  if (t === \"25\" || t === \"OBULL\" || t === \"OUTER BULL\" || t === \"BULL25\")\n    return { bull: 25 };\n  const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\n  if (!m) return null;\n  const mult = (m[1] || \"S\") as DartMult;\n  const num = parseInt(m[2], 10);\n  if (num < 1 || num > 20) return null;\n  return { mult, num };\n}\n\n// Convert autoscore ring+sector data into a structured Dart\n// ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\n// sector: 1..20 for numbered segments; null/undefined for bull/miss\nexport function ringSectorToDart(\n  ring?: string,\n  sector?: number | null,\n): Dart | null {\n  if (!ring || ring === \"MISS\") return null;\n  if (ring === \"BULL\") return { bull: 25 };\n  if (ring === \"INNER_BULL\") return { bull: 50 };\n  if (typeof sector === \"number\" && sector >= 1 && sector <= 20) {\n    const mult: DartMult =\n      ring === \"DOUBLE\" ? \"D\" : ring === \"TRIPLE\" ? \"T\" : \"S\";\n    return { mult, num: sector };\n  }\n  return null;\n}\n","export type ATCState = {\n  target: number; // 1..20 then 25 (outer bull) then 50 (inner)\n  finished: boolean;\n};\n\nexport const ATC_ORDER: number[] = [\n  ...Array.from({ length: 20 }, (_, i) => i + 1),\n  25,\n  50,\n];\n\nexport function nextTarget(current: number): number | null {\n  const idx = ATC_ORDER.indexOf(current);\n  if (idx < 0) return ATC_ORDER[0];\n  if (idx >= ATC_ORDER.length - 1) return null;\n  return ATC_ORDER[idx + 1];\n}\n\nexport function isCorrectHit(value: number, target: number): boolean {\n  return value === target;\n}\n","export type CricketMark = 0 | 1 | 2 | 3;\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25; // 25 is bull (outer+inner)\n\nexport type CricketState = {\n  // marks per number\n  marks: Record<CricketNumber, CricketMark>;\n  // accumulated points when opponent hasn't closed a number\n  points: number;\n};\n\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25];\n\nexport function createCricketState(): CricketState {\n  const marks: any = {};\n  CRICKET_NUMBERS.forEach((n) => {\n    marks[n] = 0;\n  });\n  return { marks, points: 0 };\n}\n\n// Apply a single dart to a player's cricket state\n// Returns deltaPoints scored on this dart\nexport function applyCricketDart(\n  state: CricketState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n  opponentClosed: (n: CricketNumber) => boolean = () => false,\n): number {\n  // Map autoscore terms to logical hits\n  let num: CricketNumber | null = null;\n  let hits = 0;\n  if (\n    ring === \"BULL\" ||\n    ring === \"INNER_BULL\" ||\n    value === 25 ||\n    value === 50\n  ) {\n    num = 25;\n    hits = ring === \"INNER_BULL\" || value === 50 ? 2 : 1;\n  } else if (\n    typeof sector === \"number\" &&\n    (sector as number) >= 15 &&\n    (sector as number) <= 20\n  ) {\n    num = sector as CricketNumber;\n    if (ring === \"TRIPLE\") hits = 3;\n    else if (ring === \"DOUBLE\") hits = 2;\n    else hits = 1;\n  } else if (value) {\n    // Fallback when only numeric score provided (manual): infer by divisibility\n    const cand: CricketNumber[] = [20, 19, 18, 17, 16, 15];\n    for (const c of cand) {\n      if (value === c) {\n        num = c;\n        hits = 1;\n        break;\n      }\n      if (value === c * 2) {\n        num = c;\n        hits = 2;\n        break;\n      }\n      if (value === c * 3) {\n        num = c;\n        hits = 3;\n        break;\n      }\n    }\n    if (!num && (value === 25 || value === 50)) {\n      num = 25;\n      hits = value === 50 ? 2 : 1;\n    }\n  }\n  if (!num) return 0;\n\n  const before = state.marks[num];\n  const remainToClose = Math.max(0, 3 - before);\n  const toApply = Math.min(remainToClose, hits);\n  const overflow = Math.max(0, hits - toApply);\n  // Increase marks up to 3\n  const after = (before + toApply) as CricketMark;\n  state.marks[num] = after > 3 ? 3 : after;\n\n  // Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\n  let points = 0;\n  if (overflow > 0 && !opponentClosed(num)) {\n    if (num === 25) {\n      // Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\n      if (ring === \"INNER_BULL\") points += 50 * overflow;\n      else points += 25 * overflow;\n    } else {\n      points += num * overflow;\n    }\n  }\n\n  state.points += points;\n  return points;\n}\n\nexport function hasClosedAll(state: CricketState): boolean {\n  return CRICKET_NUMBERS.every((n) => (state.marks[n] || 0) >= 3);\n}\n\nexport function cricketWinner(\n  self: CricketState,\n  opponents: CricketState[],\n): boolean {\n  // Win when all closed and you have >= opponents' points\n  if (!hasClosedAll(self)) return false;\n  const maxOppPoints = Math.max(0, ...opponents.map((o) => o.points));\n  return self.points >= maxOppPoints;\n}\n","export type ShanghaiRound =\n  | 1\n  | 2\n  | 3\n  | 4\n  | 5\n  | 6\n  | 7\n  | 8\n  | 9\n  | 10\n  | 11\n  | 12\n  | 13\n  | 14\n  | 15\n  | 16\n  | 17\n  | 18\n  | 19\n  | 20;\n\nexport type ShanghaiState = {\n  round: ShanghaiRound;\n  score: number;\n  finished: boolean;\n  shanghaiAchieved: boolean; // single+double+triple of target in same 3-dart turn\n  turnHits: { singles: number; doubles: number; triples: number };\n};\n\nexport function createShanghaiState(): ShanghaiState {\n  return {\n    round: 1,\n    score: 0,\n    finished: false,\n    shanghaiAchieved: false,\n    turnHits: { singles: 0, doubles: 0, triples: 0 },\n  };\n}\n\nexport function getRoundTarget(state: ShanghaiState): number {\n  return state.round;\n}\n\n// Apply one dart; returns points scored on this dart\nexport function applyShanghaiDart(\n  state: ShanghaiState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): number {\n  if (state.finished) return 0;\n  const target = getRoundTarget(state);\n  let points = 0;\n  if (typeof sector === \"number\" && sector === target) {\n    if (ring === \"TRIPLE\") {\n      points = target * 3;\n      state.turnHits.triples++;\n    } else if (ring === \"DOUBLE\") {\n      points = target * 2;\n      state.turnHits.doubles++;\n    } else if (ring === \"SINGLE\") {\n      points = target * 1;\n      state.turnHits.singles++;\n    }\n  } else if (\n    !sector &&\n    (value === target || value === target * 2 || value === target * 3)\n  ) {\n    // manual numeric entry fallback\n    if (value === target * 3) {\n      points = target * 3;\n      state.turnHits.triples++;\n    } else if (value === target * 2) {\n      points = target * 2;\n      state.turnHits.doubles++;\n    } else if (value === target) {\n      points = target;\n      state.turnHits.singles++;\n    }\n  }\n  state.score += points;\n  return points;\n}\n\n// Call at end of 3-dart turn; advances round and checks Shanghai\nexport function endShanghaiTurn(state: ShanghaiState) {\n  if (!state.finished) {\n    if (\n      state.turnHits.singles > 0 &&\n      state.turnHits.doubles > 0 &&\n      state.turnHits.triples > 0\n    ) {\n      state.shanghaiAchieved = true;\n      state.finished = true;\n      return;\n    }\n    const next = (state.round + 1) as ShanghaiRound;\n    if (next > 20) {\n      state.finished = true;\n    } else {\n      state.round = next;\n    }\n  }\n  // reset per-turn hits\n  state.turnHits = { singles: 0, doubles: 0, triples: 0 };\n}\n","export type HalveItTarget =\n  | { kind: \"ANY_NUMBER\" }\n  | { kind: \"DOUBLE\"; num: number }\n  | { kind: \"TRIPLE\"; num: number }\n  | { kind: \"BULL\" }\n  | { kind: \"NUMBER\"; num: number };\n\nexport type HalveItState = {\n  stage: number;\n  targets: HalveItTarget[];\n  score: number;\n  finished: boolean;\n  hitThisRound: boolean;\n};\n\nexport function createDefaultHalveIt(): HalveItState {\n  const targets: HalveItTarget[] = [\n    { kind: \"NUMBER\", num: 20 },\n    { kind: \"DOUBLE\", num: 16 },\n    { kind: \"TRIPLE\", num: 14 },\n    { kind: \"NUMBER\", num: 19 },\n    { kind: \"BULL\" },\n    { kind: \"ANY_NUMBER\" },\n  ];\n  return { stage: 0, targets, score: 0, finished: false, hitThisRound: false };\n}\n\nexport function getCurrentHalveTarget(\n  state: HalveItState,\n): HalveItTarget | null {\n  return state.targets[state.stage] || null;\n}\n\nexport function applyHalveItDart(\n  state: HalveItState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): number {\n  if (state.finished) return 0;\n  const t = getCurrentHalveTarget(state);\n  if (!t) return 0;\n  let scored = 0;\n  switch (t.kind) {\n    case \"NUMBER\": {\n      if (typeof sector === \"number\" && sector === t.num) {\n        if (ring === \"TRIPLE\") scored = t.num * 3;\n        else if (ring === \"DOUBLE\") scored = t.num * 2;\n        else if (ring === \"SINGLE\") scored = t.num;\n      } else if (\n        !sector &&\n        (value === t.num || value === t.num * 2 || value === t.num * 3)\n      ) {\n        scored = value;\n      }\n      if (scored > 0) state.hitThisRound = true;\n      break;\n    }\n    case \"DOUBLE\": {\n      if ((ring === \"DOUBLE\" && sector === t.num) || value === t.num * 2) {\n        scored = t.num * 2;\n        state.hitThisRound = true;\n      }\n      break;\n    }\n    case \"TRIPLE\": {\n      if ((ring === \"TRIPLE\" && sector === t.num) || value === t.num * 3) {\n        scored = t.num * 3;\n        state.hitThisRound = true;\n      }\n      break;\n    }\n    case \"BULL\": {\n      if (\n        ring === \"BULL\" ||\n        ring === \"INNER_BULL\" ||\n        value === 25 ||\n        value === 50\n      ) {\n        scored = ring === \"INNER_BULL\" || value === 50 ? 50 : 25;\n        state.hitThisRound = true;\n      }\n      break;\n    }\n    case \"ANY_NUMBER\": {\n      // any valid score counts\n      if (value > 0) {\n        scored = value;\n        state.hitThisRound = true;\n      }\n      break;\n    }\n  }\n  state.score += scored;\n  return scored;\n}\n\nexport function endHalveItTurn(state: HalveItState) {\n  if (state.finished) return;\n  if (!state.hitThisRound) {\n    state.score = Math.floor(state.score / 2);\n  }\n  state.hitThisRound = false;\n  state.stage += 1;\n  if (state.stage >= state.targets.length) state.finished = true;\n}\n","export type HighLowState = {\n  round: number;\n  score: number;\n  target: \"HIGH\" | \"LOW\";\n  finished: boolean;\n};\n\nexport function createHighLow(): HighLowState {\n  return { round: 1, score: 0, target: \"HIGH\", finished: false };\n}\n\nexport function applyHighLowDart(\n  state: HighLowState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): number {\n  if (state.finished) return 0;\n  // For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\n  // When LOW, count only scores <= 10 (any ring) and bull does not count\n  let scored = 0;\n  if (state.target === \"HIGH\") {\n    if (ring === \"INNER_BULL\") scored = 50;\n    else if (typeof sector === \"number\") {\n      const mult = ring === \"TRIPLE\" ? 3 : ring === \"DOUBLE\" ? 2 : 1;\n      const v = sector * mult;\n      if (sector >= 20) scored = v;\n    } else {\n      // manual numeric fallback\n      if (value >= 40) scored = value;\n    }\n  } else {\n    if (typeof sector === \"number\") {\n      const mult = ring === \"TRIPLE\" ? 3 : ring === \"DOUBLE\" ? 2 : 1;\n      const v = sector * mult;\n      if (sector <= 10) scored = v;\n    } else {\n      if (value > 0 && value <= 30) scored = value;\n    }\n  }\n  state.score += scored;\n  return scored;\n}\n\nexport function endHighLowTurn(state: HighLowState) {\n  if (state.finished) return;\n  state.round += 1;\n  if (state.round > 10) {\n    state.finished = true;\n    return;\n  }\n  state.target = state.target === \"HIGH\" ? \"LOW\" : \"HIGH\";\n}\n","export type KillerState = {\n  number: number; // assigned sector 1..20\n  lives: number; // start with 3\n  isKiller: boolean; // became killer by hitting own double\n  eliminated: boolean;\n};\n\nexport function createKillerState(assigned: number, lives = 3): KillerState {\n  return { number: assigned, lives, isKiller: false, eliminated: false };\n}\n\n// Assign unique random numbers (1..20) to each player id\nexport function assignKillerNumbers<T extends string>(\n  playerIds: T[],\n): Record<T, number> {\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1);\n  const res: any = {};\n  for (const id of playerIds) {\n    // pick a random remaining number\n    const idx = Math.floor(Math.random() * pool.length);\n    const num = pool.splice(idx, 1)[0];\n    res[id] = num;\n  }\n  return res;\n}\n\n// Apply a single dart in Killer context.\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\nexport function applyKillerDart(\n  selfId: string,\n  states: Record<string, KillerState>,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\n  const me = states[selfId];\n  if (!me || !sector || !ring) return { becameKiller: false };\n  // Becoming killer: hit your own DOUBLE only\n  if (!me.isKiller && ring === \"DOUBLE\" && sector === me.number) {\n    me.isKiller = true;\n    return { becameKiller: true };\n  }\n  // If already killer, hitting opponents' doubles/triples removes lives\n  if (me.isKiller && (ring === \"DOUBLE\" || ring === \"TRIPLE\")) {\n    const victimId = Object.keys(states).find(\n      (pid) =>\n        pid !== selfId &&\n        !states[pid].eliminated &&\n        states[pid].number === sector,\n    );\n    if (victimId) {\n      const victim = states[victimId];\n      const delta = ring === \"TRIPLE\" ? 2 : 1;\n      victim.lives = Math.max(0, victim.lives - delta);\n      if (victim.lives === 0) victim.eliminated = true;\n      return { becameKiller: false, victimId, livesRemoved: delta };\n    }\n  }\n  return { becameKiller: false };\n}\n\nexport function killerWinner(\n  states: Record<string, KillerState>,\n): string | null {\n  const alive = Object.entries(states).filter(\n    ([, st]) => !st.eliminated && st.lives > 0,\n  );\n  if (alive.length === 1) return alive[0][0];\n  return null;\n}\n","export type BaseballInning = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9;\n\nexport type BaseballState = {\n  inning: BaseballInning;\n  score: number;\n  dartsThisInning: number;\n  finished: boolean;\n};\n\nexport function createBaseball(): BaseballState {\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false };\n}\n\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\nexport function applyBaseballDart(\n  state: BaseballState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\n  sector?: number | null,\n): number {\n  if (state.finished) return 0;\n  let runs = 0;\n  if (typeof sector === \"number\" && sector === state.inning) {\n    if (ring === \"TRIPLE\") runs = 3;\n    else if (ring === \"DOUBLE\") runs = 2;\n    else runs = 1;\n  } else if (\n    !sector &&\n    (value === state.inning ||\n      value === state.inning * 2 ||\n      value === state.inning * 3)\n  ) {\n    runs = value === state.inning * 3 ? 3 : value === state.inning * 2 ? 2 : 1;\n  }\n  state.score += runs;\n  state.dartsThisInning += 1;\n  if (state.dartsThisInning >= 3) {\n    const next = (state.inning + 1) as BaseballInning;\n    if (next > 9) state.finished = true;\n    else {\n      state.inning = next;\n      state.dartsThisInning = 0;\n    }\n  }\n  return runs;\n}\n","export type GolfHole =\n  | 1\n  | 2\n  | 3\n  | 4\n  | 5\n  | 6\n  | 7\n  | 8\n  | 9\n  | 10\n  | 11\n  | 12\n  | 13\n  | 14\n  | 15\n  | 16\n  | 17\n  | 18;\n\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\n\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\n  1: 5,\n  2: 20,\n  3: 1,\n  4: 18,\n  5: 4,\n  6: 13,\n  7: 6,\n  8: 10,\n  9: 15,\n  10: 2,\n  11: 17,\n  12: 3,\n  13: 19,\n  14: 7,\n  15: 16,\n  16: 8,\n  17: 11,\n  18: 14,\n};\n\nexport type GolfState = {\n  hole: GolfHole;\n  strokes: number;\n  dartsThisHole: number;\n  finished: boolean;\n};\n\nexport function createGolf(): GolfState {\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false };\n}\n\nexport function applyGolfDart(\n  state: GolfState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\n  sector?: number | null,\n): boolean {\n  if (state.finished) return false;\n  const target = GOLF_TARGETS[state.hole];\n  state.dartsThisHole += 1;\n  const hit =\n    (typeof sector === \"number\" &&\n      sector === target &&\n      (ring === \"SINGLE\" || ring === \"DOUBLE\" || ring === \"TRIPLE\")) ||\n    (!sector &&\n      (value === target || value === target * 2 || value === target * 3));\n  if (hit) {\n    state.strokes += state.dartsThisHole;\n    // advance to next hole\n    const next = (state.hole + 1) as GolfHole;\n    if (next > 18) state.finished = true;\n    else {\n      state.hole = next;\n      state.dartsThisHole = 0;\n    }\n    return true;\n  }\n  // If not finished and took 3 darts, score 3 and advance hole\n  if (state.dartsThisHole >= 3) {\n    state.strokes += 3;\n    const next = (state.hole + 1) as GolfHole;\n    if (next > 18) state.finished = true;\n    else {\n      state.hole = next;\n      state.dartsThisHole = 0;\n    }\n  }\n  return false;\n}\n","export type TicCell = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8;\n\n// Map grid cells to targets: center uses Bull; edges/corners use numbers.\nexport const TTT_TARGETS: Record<\n  TicCell,\n  { type: \"NUM\" | \"BULL\"; num?: number }\n> = {\n  0: { type: \"NUM\", num: 20 },\n  1: { type: \"NUM\", num: 19 },\n  2: { type: \"NUM\", num: 18 },\n  3: { type: \"NUM\", num: 17 },\n  4: { type: \"BULL\" },\n  5: { type: \"NUM\", num: 16 },\n  6: { type: \"NUM\", num: 15 },\n  7: { type: \"NUM\", num: 14 },\n  8: { type: \"NUM\", num: 13 },\n};\n\nexport type TicTacToeState = {\n  board: Array<\"X\" | \"O\" | null>;\n  turn: \"X\" | \"O\";\n  finished: boolean;\n  winner: \"X\" | \"O\" | \"Draw\" | null;\n};\n\nexport function createTicTacToe(): TicTacToeState {\n  return {\n    board: Array(9).fill(null),\n    turn: \"X\",\n    finished: false,\n    winner: null,\n  };\n}\n\nfunction checkWin(board: Array<\"X\" | \"O\" | null>): \"X\" | \"O\" | \"Draw\" | null {\n  const lines = [\n    [0, 1, 2],\n    [3, 4, 5],\n    [6, 7, 8],\n    [0, 3, 6],\n    [1, 4, 7],\n    [2, 5, 8],\n    [0, 4, 8],\n    [2, 4, 6],\n  ];\n  for (const [a, b, c] of lines) {\n    if (board[a] && board[a] === board[b] && board[a] === board[c])\n      return board[a] as \"X\" | \"O\";\n  }\n  if (board.every((c) => c)) return \"Draw\";\n  return null;\n}\n\nexport function tryClaimCell(\n  state: TicTacToeState,\n  cell: TicCell,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): boolean {\n  if (state.finished || state.board[cell]) return false;\n  const tgt = TTT_TARGETS[cell];\n  let ok = false;\n  if (tgt.type === \"BULL\")\n    ok =\n      ring === \"BULL\" || ring === \"INNER_BULL\" || value === 25 || value === 50;\n  else if (tgt.type === \"NUM\" && typeof tgt.num === \"number\") {\n    if (typeof sector === \"number\" && sector === tgt.num) ok = true;\n    else if (\n      !sector &&\n      (value === tgt.num || value === tgt.num * 2 || value === tgt.num * 3)\n    )\n      ok = true;\n  }\n  if (!ok) return false;\n  state.board[cell] = state.turn;\n  const w = checkWin(state.board);\n  if (w) {\n    state.finished = true;\n    state.winner = w;\n    return true;\n  }\n  state.turn = state.turn === \"X\" ? \"O\" : \"X\";\n  return true;\n}\n","/**\n * Scam, Fives, and Sevens game logic\n * All three follow a similar score-race pattern:\n * - Players accumulate scores\n * - Only certain numbers count\n * - First to reach target wins\n */\n\n// SCAM/SCUM - Hit targets 1â†’20â†’Bull in sequence\nexport interface ScamState {\n  targetIndex: number; // 0-20 for numbers 1-20, 21 for bull (25/50)\n  darts: number;\n  finished: boolean;\n}\n\nexport function createScamState(): ScamState {\n  return {\n    targetIndex: 0,\n    darts: 0,\n    finished: false,\n  };\n}\n\nexport const SCAM_TARGETS = [\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25,\n];\nexport const SCAM_TARGET_NAMES = [\n  \"1\",\n  \"2\",\n  \"3\",\n  \"4\",\n  \"5\",\n  \"6\",\n  \"7\",\n  \"8\",\n  \"9\",\n  \"10\",\n  \"11\",\n  \"12\",\n  \"13\",\n  \"14\",\n  \"15\",\n  \"16\",\n  \"17\",\n  \"18\",\n  \"19\",\n  \"20\",\n  \"Bull\",\n];\n\nexport function getScamTarget(state: ScamState): number {\n  return SCAM_TARGETS[state.targetIndex];\n}\n\nexport function addScamAuto(\n  state: ScamState,\n  value: number,\n  ring?: string,\n): ScamState {\n  if (state.finished) return state;\n\n  const target = getScamTarget(state);\n  const targetHit =\n    (ring === \"SINGLE\" && value === target) ||\n    (ring === \"DOUBLE\" && value === target) ||\n    (ring === \"TRIPLE\" && value === target) ||\n    (ring === \"INNER_BULL\" && target === 25);\n\n  if (!targetHit) return state;\n\n  // Hit! Move to next target\n  const newIndex = state.targetIndex + 1;\n  const finished = newIndex >= SCAM_TARGETS.length;\n\n  return {\n    targetIndex: newIndex,\n    darts: state.darts + 1,\n    finished,\n  };\n}\n\nexport function addScamNumeric(state: ScamState, value: number): ScamState {\n  // For manual input, assume single ring hit\n  return addScamAuto(state, value, \"SINGLE\");\n}\n\nexport function resetScam(): ScamState {\n  return createScamState();\n}\n\n// FIVES - Only multiples of 5 count (5,10,15,20,25,50)\nexport interface FivesState {\n  score: number;\n  darts: number;\n  finished: boolean;\n  target: number; // default 50\n}\n\nexport function createFivesState(target: number = 50): FivesState {\n  return {\n    score: 0,\n    darts: 0,\n    finished: false,\n    target,\n  };\n}\n\nexport const FIVES_VALID_NUMBERS = [5, 10, 15, 20, 25, 50];\n\nexport function isFivesValid(value: number): boolean {\n  return FIVES_VALID_NUMBERS.includes(value);\n}\n\nexport function addFivesAuto(\n  state: FivesState,\n  value: number,\n  ring?: string,\n): FivesState {\n  if (state.finished) return state;\n\n  // Only multiples of 5 count\n  if (!isFivesValid(value)) {\n    return { ...state, darts: state.darts + 1 };\n  }\n\n  const newScore = state.score + value;\n  const finished = newScore >= state.target;\n\n  return {\n    score: finished ? state.target : newScore,\n    darts: state.darts + 1,\n    finished,\n    target: state.target,\n  };\n}\n\nexport function addFivesNumeric(state: FivesState, value: number): FivesState {\n  return addFivesAuto(state, value, \"SINGLE\");\n}\n\nexport function resetFives(target: number = 50): FivesState {\n  return createFivesState(target);\n}\n\n// SEVENS - Only multiples of 7 count (7,14,21)\nexport interface SevensState {\n  score: number;\n  darts: number;\n  finished: boolean;\n  target: number; // default 70\n}\n\nexport function createSevensState(target: number = 70): SevensState {\n  return {\n    score: 0,\n    darts: 0,\n    finished: false,\n    target,\n  };\n}\n\nexport const SEVENS_VALID_NUMBERS = [7, 14, 21];\n\nexport function isSevensValid(value: number): boolean {\n  return SEVENS_VALID_NUMBERS.includes(value);\n}\n\nexport function addSevensAuto(\n  state: SevensState,\n  value: number,\n  ring?: string,\n): SevensState {\n  if (state.finished) return state;\n\n  // Only multiples of 7 count\n  if (!isSevensValid(value)) {\n    return { ...state, darts: state.darts + 1 };\n  }\n\n  const newScore = state.score + value;\n  const finished = newScore >= state.target;\n\n  return {\n    score: finished ? state.target : newScore,\n    darts: state.darts + 1,\n    finished,\n    target: state.target,\n  };\n}\n\nexport function addSevensNumeric(\n  state: SevensState,\n  value: number,\n): SevensState {\n  return addSevensAuto(state, value, \"SINGLE\");\n}\n\nexport function resetSevens(target: number = 70): SevensState {\n  return createSevensState(target);\n}\n","export type AmCricketMark = 0 | 1 | 2 | 3;\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25;\n\nexport type AmCricketState = {\n  marks: Record<AmCricketNumber, AmCricketMark>;\n  points: number;\n};\n\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [\n  20, 19, 18, 17, 16, 15, 14, 13, 12, 25,\n];\n\nexport function createAmCricketState(): AmCricketState {\n  const marks: any = {};\n  AM_CRICKET_NUMBERS.forEach((n) => {\n    marks[n] = 0;\n  });\n  return { marks, points: 0 };\n}\n\nexport function applyAmCricketDart(\n  state: AmCricketState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n  opponentClosed: (n: AmCricketNumber) => boolean = () => false,\n): number {\n  let num: AmCricketNumber | null = null;\n  let hits = 0;\n  if (\n    ring === \"BULL\" ||\n    ring === \"INNER_BULL\" ||\n    value === 25 ||\n    value === 50\n  ) {\n    num = 25;\n    hits = ring === \"INNER_BULL\" || value === 50 ? 2 : 1;\n  } else if (typeof sector === \"number\" && sector >= 12 && sector <= 20) {\n    num = sector as AmCricketNumber;\n    if (ring === \"TRIPLE\") hits = 3;\n    else if (ring === \"DOUBLE\") hits = 2;\n    else hits = 1;\n  } else if (value) {\n    for (const c of [20, 19, 18, 17, 16, 15, 14, 13, 12] as AmCricketNumber[]) {\n      if (value === c) {\n        num = c;\n        hits = 1;\n        break;\n      }\n      if (value === c * 2) {\n        num = c;\n        hits = 2;\n        break;\n      }\n      if (value === c * 3) {\n        num = c;\n        hits = 3;\n        break;\n      }\n    }\n    if (!num && (value === 25 || value === 50)) {\n      num = 25;\n      hits = value === 50 ? 2 : 1;\n    }\n  }\n  if (!num) return 0;\n\n  const before = state.marks[num];\n  const toClose = Math.max(0, 3 - before);\n  const toApply = Math.min(toClose, hits);\n  const overflow = Math.max(0, hits - toApply);\n  const after = (before + toApply) as AmCricketMark;\n  state.marks[num] = after > 3 ? 3 : after;\n\n  let points = 0;\n  if (overflow > 0 && !opponentClosed(num)) {\n    if (num === 25) {\n      if (ring === \"INNER_BULL\") points += 50 * overflow;\n      else points += 25 * overflow;\n    } else {\n      points += (num as number) * overflow;\n    }\n  }\n  state.points += points;\n  return points;\n}\n\nexport function hasClosedAllAm(state: AmCricketState): boolean {\n  return AM_CRICKET_NUMBERS.every((n) => (state.marks[n] || 0) >= 3);\n}\n","import type { ReactNode } from \"react\";\n\n// Glassy sticky header bar used across Offline and Online match UIs for visual parity\nexport default function GameHeaderBar({\n  left,\n  right,\n  className = \"\",\n  sticky = true,\n}: {\n  left: ReactNode;\n  right?: ReactNode;\n  className?: string;\n  sticky?: boolean;\n}) {\n  return (\n    <div\n      className={`${sticky ? \"sticky top-0\" : \"\"} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${className}`}\n    >\n      <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent\" />\n      <div className=\"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap\">\n        {left}\n      </div>\n      <div className=\"flex items-center gap-1 flex-wrap justify-end\">\n        {right}\n      </div>\n    </div>\n  );\n}\n","/**\n * Universal Game Scoreboard Component\n * Displays game-specific stats based on the game mode and current game state\n * Works for Online, Offline, and Tournament modes\n */\n\nimport React from \"react\";\n\nexport type GameMode =\n  | \"X01\"\n  | \"Cricket\"\n  | \"Shanghai\"\n  | \"Killer\"\n  | \"High-Low\"\n  | \"Halve It\"\n  | \"Around the Clock\"\n  | \"Double Practice\"\n  | \"Treble Practice\"\n  | \"Count-Up\"\n  | \"High Score\"\n  | \"Low Score\"\n  | \"Checkout 170\"\n  | \"Checkout 121\"\n  | \"American Cricket\"\n  | \"Baseball\"\n  | \"Golf\"\n  | \"Tic Tac Toe\"\n  | \"Bob's 27\"\n  | \"Scam\"\n  | \"Fives\"\n  | \"Sevens\";\n\nexport interface PlayerStats {\n  name: string;\n  isCurrentTurn: boolean;\n  legsWon?: number;\n  score?: number;\n  lastScore?: number;\n  checkoutRate?: number; // 0-100\n  bestLeg?: number | string;\n  // Cricket-specific\n  closed?: Record<number, number>; // { 20: 3, 19: 2, etc }\n  points?: number;\n  // Shanghai-specific\n  round?: number;\n  target?: number;\n  // Killer-specific\n  number?: number;\n  lives?: number;\n  eliminated?: boolean;\n  // Match statistics\n  matchAvg?: number; // Current match 3-dart average\n  allTimeAvg?: number; // Player's all-time 3-dart average\n  // Other generics\n  [key: string]: any;\n}\n\ninterface GameScoreboardProps {\n  gameMode: GameMode;\n  players: PlayerStats[];\n  matchScore?: string; // e.g., \"3-1\"\n  gameRules?: any; // Additional rules/config for the game\n}\n\nexport default function GameScoreboard({\n  gameMode,\n  players,\n  matchScore,\n  gameRules,\n}: GameScoreboardProps) {\n  if (!players || players.length === 0) return null;\n\n  return (\n    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3\">\n      {players.map((player, idx) => (\n        <div\n          key={idx}\n          className={`rounded-lg border p-3 ${\n            player.isCurrentTurn\n              ? \"border-emerald-500/40 bg-emerald-500/10\"\n              : \"border-slate-500/40 bg-slate-500/10\"\n          }`}\n        >\n          <div\n            className={`text-sm font-semibold mb-2 uppercase tracking-wide ${\n              player.isCurrentTurn ? \"text-emerald-300\" : \"text-slate-300\"\n            }`}\n          >\n            {player.name}\n          </div>\n\n          <div className=\"space-y-1 text-sm\">\n            {/* X01 specific */}\n            {gameMode === \"X01\" && (\n              <>\n                <ScoreRow\n                  label=\"Legs Won\"\n                  value={`â— ${player.legsWon || 0}`}\n                  highlight\n                />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n                <ScoreRow\n                  label=\"Last Score\"\n                  value={player.lastScore || \"0\"}\n                  mono\n                />\n                <ScoreRow\n                  label=\"C/Out Rate\"\n                  value={`${player.checkoutRate || 0}%`}\n                  mono\n                />\n                <ScoreRow label=\"Best Leg\" value={player.bestLeg || \"â€”\"} mono />\n                {/* AVG +/- feature */}\n                {player.matchAvg !== undefined &&\n                  player.allTimeAvg !== undefined && (\n                    <>\n                      <div className=\"border-t border-white/20 pt-1 mt-1\">\n                        <ScoreRow\n                          label=\"Match Avg\"\n                          value={player.matchAvg.toFixed(2)}\n                          mono\n                          bold\n                          highlight={player.matchAvg > 0}\n                        />\n                        <AvgDifferenceRow\n                          matchAvg={player.matchAvg}\n                          allTimeAvg={player.allTimeAvg}\n                        />\n                      </div>\n                    </>\n                  )}\n              </>\n            )}\n\n            {/* Cricket & American Cricket specific */}\n            {(gameMode === \"Cricket\" || gameMode === \"American Cricket\") && (\n              <>\n                <ScoreRow\n                  label=\"Closed\"\n                  value={formatCricketClosed(player.closed)}\n                  mono\n                />\n                <ScoreRow label=\"Points\" value={player.points || 0} mono bold />\n                <ScoreRow\n                  label=\"Status\"\n                  value={getCricketStatus(player)}\n                  highlight={player.isCurrentTurn}\n                />\n              </>\n            )}\n\n            {/* Shanghai & Halve It - Round-based */}\n            {(gameMode === \"Shanghai\" || gameMode === \"Halve It\") && (\n              <>\n                <ScoreRow\n                  label={gameMode === \"Shanghai\" ? \"Round\" : \"Stage\"}\n                  value={player.round || 1}\n                  mono\n                />\n                <ScoreRow label=\"Target\" value={player.target || \"â€”\"} mono />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n              </>\n            )}\n\n            {/* Killer specific */}\n            {gameMode === \"Killer\" && (\n              <>\n                <ScoreRow\n                  label=\"Target #\"\n                  value={player.number || \"â€”\"}\n                  mono\n                  bold\n                />\n                <ScoreRow label=\"Lives\" value={player.lives || 0} mono bold />\n                {player.eliminated && (\n                  <ScoreRow\n                    label=\"Status\"\n                    value=\"ELIMINATED\"\n                    highlight={false}\n                  />\n                )}\n              </>\n            )}\n\n            {/* High-Low specific */}\n            {gameMode === \"High-Low\" && (\n              <>\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\n                <ScoreRow label=\"Target\" value={player.target || \"High\"} mono />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n              </>\n            )}\n\n            {/* Practice games */}\n            {(gameMode === \"Double Practice\" ||\n              gameMode === \"Treble Practice\" ||\n              gameMode === \"Around the Clock\") && (\n              <>\n                <ScoreRow\n                  label=\"Target\"\n                  value={player.target || \"â€”\"}\n                  mono\n                  bold\n                />\n                <ScoreRow label=\"Hits\" value={player.hits || 0} mono bold />\n                {player.totalNeeded && (\n                  <ScoreRow\n                    label=\"Progress\"\n                    value={`${player.hits || 0} / ${player.totalNeeded}`}\n                    mono\n                  />\n                )}\n              </>\n            )}\n\n            {/* Count-Up, High Score, Low Score */}\n            {(gameMode === \"Count-Up\" ||\n              gameMode === \"High Score\" ||\n              gameMode === \"Low Score\") && (\n              <>\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n                {gameMode === \"High Score\" && (\n                  <ScoreRow label=\"Best\" value={player.bestScore || 0} mono />\n                )}\n              </>\n            )}\n\n            {/* Checkout challenges */}\n            {(gameMode === \"Checkout 170\" || gameMode === \"Checkout 121\") && (\n              <>\n                <ScoreRow\n                  label=\"Remaining\"\n                  value={player.remaining || 0}\n                  mono\n                  bold\n                />\n                <ScoreRow label=\"Attempts\" value={player.attempts || 0} mono />\n                <ScoreRow\n                  label=\"Successes\"\n                  value={player.successes || 0}\n                  mono\n                />\n              </>\n            )}\n\n            {/* Bob's 27 */}\n            {gameMode === \"Bob's 27\" && (\n              <>\n                <ScoreRow\n                  label=\"Target\"\n                  value={`D${player.target || 1}`}\n                  mono\n                  bold\n                />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n              </>\n            )}\n\n            {/* Baseball & Golf */}\n            {gameMode === \"Baseball\" && (\n              <>\n                <ScoreRow label=\"Inning\" value={player.inning || 1} mono />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n              </>\n            )}\n\n            {gameMode === \"Golf\" && (\n              <>\n                <ScoreRow label=\"Hole\" value={player.hole || 1} mono />\n                <ScoreRow\n                  label=\"Strokes\"\n                  value={player.strokes || 0}\n                  mono\n                  bold\n                />\n              </>\n            )}\n\n            {/* Tic Tac Toe */}\n            {gameMode === \"Tic Tac Toe\" && (\n              <>\n                <ScoreRow label=\"Turn\" value={player.turn || 1} mono />\n                {player.winner && (\n                  <ScoreRow label=\"Result\" value=\"WINNER!\" highlight />\n                )}\n              </>\n            )}\n\n            {/* Match score display for competitive games */}\n            {matchScore &&\n              (gameMode === \"X01\" ||\n                gameMode === \"Cricket\" ||\n                gameMode === \"American Cricket\") &&\n              idx === 1 && (\n                <div className=\"border-t border-white/10 pt-1 mt-1\">\n                  <ScoreRow\n                    label=\"Match\"\n                    value={matchScore}\n                    mono\n                    bold\n                    highlight\n                  />\n                </div>\n              )}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\n// Helper component for consistent score row display\nfunction ScoreRow({\n  label,\n  value,\n  mono = false,\n  bold = false,\n  highlight = false,\n}: {\n  label: string;\n  value: string | number;\n  mono?: boolean;\n  bold?: boolean;\n  highlight?: boolean;\n}) {\n  return (\n    <div className=\"flex justify-between\">\n      <span className=\"opacity-70\">{label}:</span>\n      <span\n        className={`${mono ? \"font-mono\" : \"\"} ${bold ? \"font-semibold\" : \"\"} ${\n          highlight ? \"text-emerald-300\" : \"\"\n        }`}\n      >\n        {value}\n      </span>\n    </div>\n  );\n}\n\n// AVG +/- component showing difference from all-time average\nfunction AvgDifferenceRow({\n  matchAvg,\n  allTimeAvg,\n}: {\n  matchAvg: number;\n  allTimeAvg: number;\n}) {\n  const diff = matchAvg - allTimeAvg;\n  const isPositive = diff > 0;\n  const isNeutral = Math.abs(diff) < 0.01;\n\n  let diffText = \"\";\n  let diffColor = \"text-slate-300\";\n\n  if (isNeutral) {\n    diffText = \"= All-time\";\n    diffColor = \"text-slate-300\";\n  } else if (isPositive) {\n    diffText = `+${diff.toFixed(2)} vs avg`;\n    diffColor = \"text-emerald-400\";\n  } else {\n    diffText = `${diff.toFixed(2)} vs avg`;\n    diffColor = \"text-orange-400\";\n  }\n\n  return (\n    <div className=\"flex justify-between\">\n      <span className=\"opacity-70\">AVG vs Avg:</span>\n      <span className={`font-mono font-semibold ${diffColor}`}>{diffText}</span>\n    </div>\n  );\n}\n\n// Cricket helpers\nfunction formatCricketClosed(closed?: Record<number, number>): string {\n  if (!closed || Object.keys(closed).length === 0) return \"â€”\";\n  const closedNumbers = Object.entries(closed)\n    .filter(([_, count]) => count === 3)\n    .map(([num]) => (num === \"25\" ? \"B\" : num))\n    .join(\",\");\n  return closedNumbers || \"â€”\";\n}\n\nfunction getCricketStatus(player: PlayerStats): string {\n  if (!player.closed) return \"Starting\";\n  const closedCount = Object.values(player.closed).filter(\n    (c) => c === 3,\n  ).length;\n  if (closedCount === 0) return \"No marks\";\n  if (closedCount < 7) return `${closedCount}/7`;\n  return \"Closing in\";\n}\n","// Small adapter helpers to convert generic MatchControls onAddVisit callbacks to the local handlers\nexport function makeOnlineAddVisitAdapter(\n  submitVisitManual: (v: number) => void,\n) {\n  return (score: number, darts: number) => {\n    submitVisitManual(score);\n  };\n}\n\nexport function makeOfflineAddVisitAdapter(\n  commitManualVisitTotal: (v: number) => boolean,\n) {\n  return (score: number, darts: number) => {\n    commitManualVisitTotal(score);\n  };\n}\n","import type { Actions as MatchActions } from \"../store/match\";\n\nexport type UnifiedMatchActions = {\n  addVisit: (score: number, darts?: number, meta?: any) => void;\n  undoVisit: () => void;\n  nextPlayer: () => void;\n  endLeg: (score?: number) => void;\n  endGame: () => void;\n};\n\nexport function createOnlineMatchActions(args: {\n  match: MatchActions;\n  sendState: () => void;\n  submitVisitManual?: (v: number) => void;\n}): UnifiedMatchActions {\n  const { match, sendState, submitVisitManual } = args;\n  return {\n    addVisit: (score: number, darts = 3, meta?: any) => {\n      // Prefer the manual submit helper when available as it computes double/finish meta\n      if (submitVisitManual) {\n        submitVisitManual(score);\n        return;\n      }\n      try {\n        match.addVisit(score, darts, meta);\n      } catch {\n        match.addVisit(score, darts);\n      }\n      try {\n        sendState();\n      } catch {}\n    },\n    undoVisit: () => {\n      match.undoVisit();\n      try {\n        sendState();\n      } catch {}\n    },\n    nextPlayer: () => {\n      match.nextPlayer();\n      try {\n        sendState();\n      } catch {}\n    },\n    endLeg: (score?: number) => {\n      if (typeof score === \"number\") match.endLeg(score);\n      else match.endLeg(0);\n      try {\n        sendState();\n      } catch {}\n    },\n    endGame: () => {\n      match.endGame();\n      try {\n        sendState();\n      } catch {}\n    },\n  };\n}\n\nexport function createOfflineMatchActions(args: {\n  match: MatchActions;\n  commitManualVisitTotal?: (v: number) => boolean;\n  endTurn?: (nextRemaining: number) => void;\n}): UnifiedMatchActions {\n  const { match, commitManualVisitTotal, endTurn } = args;\n  return {\n    addVisit: (score: number, darts = 3, meta?: any) => {\n      if (commitManualVisitTotal) {\n        commitManualVisitTotal(score);\n        return;\n      }\n      try {\n        match.addVisit(score, darts, meta);\n      } catch {\n        match.addVisit(score, darts);\n      }\n    },\n    undoVisit: () => {\n      match.undoVisit();\n    },\n    nextPlayer: () => {\n      if (endTurn) {\n        try {\n          endTurn(0);\n        } catch {\n          match.nextPlayer();\n        }\n      } else {\n        match.nextPlayer();\n      }\n    },\n    endLeg: (score?: number) => {\n      if (typeof score === \"number\") match.endLeg(score);\n      else match.endLeg(0);\n    },\n    endGame: () => {\n      match.endGame();\n    },\n  };\n}\n","/**\n * Hook to convert OfflinePlay game state to GameScoreboard format\n */\n\nimport { useMemo } from \"react\";\nimport type { PlayerStats } from \"./GameScoreboard\";\nimport type { GameMode } from \"./GameScoreboard\";\nimport { getAllTimeAvg } from \"../../store/profileStats\";\n\nexport function useOfflineGameStats(\n  gameMode: GameMode,\n  // X01 state\n  playerScore?: number,\n  aiScore?: number,\n  playerLegs?: number,\n  aiLegs?: number,\n  playerLastDart?: number,\n  aiLastDart?: number,\n  playerVisitSum?: number,\n  aiVisitSum?: number,\n  playerLastVisitScore?: number | null,\n  aiLastVisitScore?: number | null,\n  playerVisitDartCount?: number,\n  aiVisitDartCount?: number,\n  playerDoublesHit?: number,\n  playerDoublesAtt?: number,\n  aiDoublesHit?: number,\n  aiDoublesAtt?: number,\n  legStats?: Array<any>,\n  isPlayerTurn?: boolean,\n  ai?: string,\n  x01Score?: number,\n  // Cricket state\n  cricket?: any,\n  // Shanghai state\n  shanghai?: any,\n  // Killer state\n  killerPlayers?: Array<any>,\n  killerStates?: Record<string, any>,\n  killerAssigned?: Record<string, number>,\n  killerTurnIdx?: number,\n): PlayerStats[] {\n  return useMemo(() => {\n    const players: PlayerStats[] = [];\n\n    if (gameMode === \"X01\") {\n      // Calculate player match average\n      let playerMatchAvg = 0;\n      let playerDarts = 0;\n      let playerScored = 0;\n      if (legStats && legStats.length > 0) {\n        for (const leg of legStats) {\n          if (leg.dartsThrown && leg.totalScored) {\n            playerDarts += leg.dartsThrown;\n            playerScored += leg.totalScored;\n          }\n        }\n        if (playerDarts > 0) {\n          playerMatchAvg = (playerScored / playerDarts) * 3;\n        }\n      }\n\n      // Player card\n      const playerVisitDarts = playerVisitDartCount ?? 0;\n      const playerCurrentVisitActive = playerVisitDarts > 0;\n      const playerCurrentVisitSum = playerVisitSum ?? 0;\n      const playerLastVisitTotal = playerLastVisitScore ?? null;\n      const playerLastDartValue = playerLastDart ?? 0;\n      const resolvedPlayerLastScore = playerCurrentVisitActive\n        ? playerCurrentVisitSum\n        : (playerLastVisitTotal ?? playerLastDartValue);\n\n      players.push({\n        name: \"You\",\n        isCurrentTurn: !!isPlayerTurn,\n        legsWon: playerLegs || 0,\n        score: playerScore || 0,\n        lastScore: resolvedPlayerLastScore,\n        checkoutRate:\n          playerDoublesAtt && playerDoublesAtt > 0\n            ? Math.round(((playerDoublesHit || 0) / playerDoublesAtt) * 100)\n            : 0,\n        bestLeg:\n          legStats && legStats.length > 0\n            ? `${Math.min(...legStats.map((l) => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\n            : \"â€”\",\n        matchAvg: playerMatchAvg,\n        allTimeAvg: getAllTimeAvg(\"You\") || 0,\n      });\n\n      // AI card (if playing against AI)\n      if (ai && ai !== \"None\") {\n        const aiVisitDarts = aiVisitDartCount ?? 0;\n        const aiCurrentVisitActive = aiVisitDarts > 0;\n        const aiCurrentVisitSum = aiVisitSum ?? 0;\n        const aiLastVisitTotal = aiLastVisitScore ?? null;\n        const aiLastDartValue = aiLastDart ?? 0;\n        const resolvedAiLastScore = aiCurrentVisitActive\n          ? aiCurrentVisitSum\n          : (aiLastVisitTotal ?? aiLastDartValue);\n\n        players.push({\n          name: `${ai} AI`,\n          isCurrentTurn: !isPlayerTurn,\n          legsWon: aiLegs || 0,\n          score: aiScore || 0,\n          lastScore: resolvedAiLastScore,\n          checkoutRate:\n            aiDoublesAtt && aiDoublesAtt > 0\n              ? Math.round(((aiDoublesHit || 0) / aiDoublesAtt) * 100)\n              : 0,\n          bestLeg: \"â€”\",\n        });\n      }\n    }\n\n    if (gameMode === \"Cricket\") {\n      players.push({\n        name: \"You\",\n        isCurrentTurn: !!isPlayerTurn,\n        closed: cricket?.marks || {},\n        points: cricket?.points || 0,\n      });\n\n      if (ai && ai !== \"None\") {\n        players.push({\n          name: `${ai} AI`,\n          isCurrentTurn: !isPlayerTurn,\n          closed: {},\n          points: 0,\n        });\n      }\n    }\n\n    if (gameMode === \"Shanghai\") {\n      players.push({\n        name: \"You\",\n        isCurrentTurn: !!isPlayerTurn,\n        round: shanghai?.round || 1,\n        target: shanghai?.target || 1,\n        score: shanghai?.score || 0,\n      });\n\n      if (ai && ai !== \"None\") {\n        players.push({\n          name: `${ai} AI`,\n          isCurrentTurn: !isPlayerTurn,\n          round: shanghai?.round || 1,\n          target: shanghai?.target || 1,\n          score: 0,\n        });\n      }\n    }\n\n    if (gameMode === \"Killer\" && killerPlayers && killerPlayers.length > 0) {\n      killerPlayers.forEach((p, idx) => {\n        const state = killerStates?.[p.id];\n        players.push({\n          name: p.name,\n          isCurrentTurn: idx === killerTurnIdx,\n          number: killerAssigned?.[p.id],\n          lives: state?.lives || 0,\n          eliminated: state?.eliminated || false,\n        });\n      });\n    }\n\n    return players;\n  }, [\n    gameMode,\n    playerScore,\n    aiScore,\n    playerLegs,\n    aiLegs,\n    playerLastDart,\n    aiLastDart,\n    playerVisitSum,\n    aiVisitSum,\n    playerLastVisitScore,\n    aiLastVisitScore,\n    playerVisitDartCount,\n    aiVisitDartCount,\n    playerDoublesHit,\n    playerDoublesAtt,\n    aiDoublesHit,\n    aiDoublesAtt,\n    legStats,\n    isPlayerTurn,\n    ai,\n    cricket,\n    shanghai,\n    killerPlayers,\n    killerStates,\n    killerAssigned,\n    killerTurnIdx,\n  ]);\n}\n\nexport function useOnlineGameStats(\n  gameMode: GameMode,\n  matchState?: any, // From useMatch() store\n  participants?: string[],\n): PlayerStats[] {\n  return useMemo(() => {\n    const players: PlayerStats[] = [];\n\n    if (!matchState || !matchState.players || matchState.players.length === 0) {\n      return players;\n    }\n\n    matchState.players.forEach((player: any, idx: number) => {\n      const isCurrentTurn = idx === matchState.currentPlayerIdx;\n\n      if (gameMode === \"X01\") {\n        // Calculate match average for this player\n        let matchAvg = 0;\n        let totalDarts = 0;\n        let totalScored = 0;\n\n        if (player.legs && player.legs.length > 0) {\n          for (const leg of player.legs) {\n            if (leg.finished) {\n              const legDarts = leg.dartsThrown || 0;\n              const legScored =\n                Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining) || 0;\n              totalDarts += legDarts;\n              totalScored += legScored;\n            }\n          }\n        }\n\n        if (totalDarts > 0) {\n          matchAvg = (totalScored / totalDarts) * 3;\n        }\n\n        players.push({\n          name: player.name || `Player ${idx + 1}`,\n          isCurrentTurn,\n          legsWon: player.legsWon || 0,\n          score: player.score || 0,\n          lastScore: player.lastVisitScore || 0,\n          checkoutRate:\n            player.doublesAttempted > 0\n              ? Math.round((player.doublesHit / player.doublesAttempted) * 100)\n              : 0,\n          bestLeg: player.bestLegDarts ? `${player.bestLegDarts} darts` : \"â€”\",\n          matchAvg: matchAvg,\n          allTimeAvg: player.name ? getAllTimeAvg(player.name) : 0,\n        });\n      }\n\n      if (gameMode === \"Cricket\") {\n        players.push({\n          name: player.name || `Player ${idx + 1}`,\n          isCurrentTurn,\n          closed: player.cricket?.marks || {},\n          points: player.cricket?.points || 0,\n        });\n      }\n\n      if (gameMode === \"Killer\") {\n        players.push({\n          name: player.name || `Player ${idx + 1}`,\n          isCurrentTurn,\n          number: player.killerNumber || null,\n          lives: player.killerLives || 3,\n          eliminated: player.killerEliminated || false,\n        });\n      }\n    });\n\n    return players;\n  }, [gameMode, matchState, participants]);\n}\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { suggestCheckouts, sayScore } from \"../utils/checkout\";\nimport { useUserSettings } from \"../store/userSettings\";\nimport { useToast } from \"../store/toast\";\nimport { useCalibration } from \"../store/calibration\";\nimport GameCalibrationStatus from \"./GameCalibrationStatus\";\nimport CameraTile from \"./CameraTile\";\nimport CameraView from \"./CameraView\";\nimport HeatMap from \"./HeatMap\";\nimport { getUserCurrency, formatPriceInCurrency } from \"../utils/config\";\nimport { bumpGameMode } from \"../store/profileStats\";\nimport {\n  DOUBLE_PRACTICE_ORDER,\n  isDoubleHit,\n  parseManualDart,\n} from \"../game/types\";\nimport { ATC_ORDER } from \"../game/aroundTheClock\";\nimport {\n  createCricketState,\n  applyCricketDart,\n  CRICKET_NUMBERS,\n  hasClosedAll as cricketClosedAll,\n} from \"../game/cricket\";\nimport {\n  createShanghaiState,\n  applyShanghaiDart,\n  endShanghaiTurn,\n} from \"../game/shanghai\";\nimport {\n  createDefaultHalveIt,\n  getCurrentHalveTarget,\n  applyHalveItDart,\n  endHalveItTurn,\n} from \"../game/halveIt\";\nimport {\n  createHighLow,\n  applyHighLowDart,\n  endHighLowTurn,\n} from \"../game/highLow\";\nimport {\n  createKillerState,\n  assignKillerNumbers,\n  applyKillerDart,\n  killerWinner,\n  KillerState,\n} from \"../game/killer\";\nimport { createBaseball, applyBaseballDart } from \"../game/baseball\";\nimport { createGolf, applyGolfDart } from \"../game/golf\";\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from \"../game/ticTacToe\";\nimport {\n  createScamState,\n  addScamAuto,\n  addScamNumeric,\n  resetScam,\n  getScamTarget,\n  SCAM_TARGET_NAMES,\n  ScamState,\n  createFivesState,\n  addFivesAuto,\n  addFivesNumeric,\n  resetFives,\n  FivesState,\n  createSevensState,\n  addSevensAuto,\n  addSevensNumeric,\n  resetSevens,\n  SevensState,\n} from \"../game/scamFivesSevens\";\nimport {\n  createAmCricketState,\n  applyAmCricketDart,\n  AM_CRICKET_NUMBERS,\n  hasClosedAllAm,\n} from \"../game/americanCricket\";\nimport ResizableModal from \"./ui/ResizableModal\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase\";\nimport { useAudit } from \"../store/audit\";\nimport ResizablePanel from \"./ui/ResizablePanel\";\nimport GameHeaderBar from \"./ui/GameHeaderBar\";\nimport GameScoreboard, { type PlayerStats } from \"./scoreboards/GameScoreboard\";\nimport MatchControls from \"./MatchControls\";\nimport { makeOfflineAddVisitAdapter } from \"./matchControlAdapters\";\nimport {\n  createOfflineMatchActions,\n  UnifiedMatchActions,\n} from \"../logic/matchActions\";\nimport { useMatch } from \"../store/match\";\nimport { useOfflineGameStats } from \"./scoreboards/useGameStats\";\nimport { freeGames, premiumGames, allGames } from \"../utils/games\";\n\nconst aiLevels = [\"Easy\", \"Medium\", \"Hardened\"];\n\nfunction clamp(n: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, n));\n}\n\ntype PendingAutoVisit = {\n  visitTotal: number;\n  darts: number;\n  preRemaining: number;\n  remaining: number;\n  doubleAttempts: number;\n  finished: boolean;\n  doubleWindow: boolean;\n  highestCheckout?: number | null;\n  announced?: boolean;\n};\n\nconst BOARD_CLEAR_GRACE_MS = 6500;\n\nfunction aiVisitScore(remaining: number, level: string): number {\n  let target = 0;\n  if (level === \"Easy\") {\n    const candidates = [22, 26, 41, 45, 60];\n    target = candidates[Math.floor(Math.random() * candidates.length)];\n  } else if (level === \"Medium\") {\n    target = Math.round(clamp(60 + (Math.random() * 30 - 15), 30, 100));\n  } else {\n    target = Math.round(clamp(80 + (Math.random() * 20 - 10), 50, 120));\n  }\n  if (remaining <= 0) return 0;\n  if (target > remaining) {\n    const safe = [100, 85, 81, 60, 57, 45, 41, 26, 22, 20, 1].find(\n      (v) => v <= remaining,\n    );\n    return safe ?? 0;\n  }\n  return target;\n}\n\nfunction X01RulesPopup({ onClose }: { onClose: () => void }) {\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\n      <div className=\"card max-w-lg w-full relative\">\n        <button\n          className=\"absolute top-2 right-2 btn px-2 py-1\"\n          onClick={onClose}\n        >\n          Close\n        </button>\n        <h3 className=\"text-xl font-bold mb-2\">X01 Rules & Regulations</h3>\n        <ul className=\"list-disc pl-5 text-left mb-2\">\n          <li>Double In: Start scoring only after hitting a double.</li>\n          <li>\n            Double Out: Finish the game by hitting a double to reach exactly\n            zero.\n          </li>\n          <li>\n            Best Of: Play a set number of legs, winner is first to reach\n            majority.\n          </li>\n          <li>First To: Play until a player reaches a set number of legs.</li>\n          <li>\n            No Cheating: All scores must be valid, no manual score changes\n            mid-leg.\n          </li>\n          <li>\n            Competitive Standard: Follow latest WDF/PDC rules for match play.\n          </li>\n        </ul>\n        <p className=\"text-sm text-slate-600\">\n          For full details, see official darts governing body rules.\n        </p>\n      </div>\n    </div>\n  );\n}\n\nconst API_URL = (import.meta as any).env?.VITE_API_URL || \"\";\n\nexport default function OfflinePlay({ user }: { user: any }) {\n  const {\n    offlineLayout,\n    favoriteDouble,\n    callerEnabled,\n    callerVoice,\n    callerVolume,\n    speakCheckoutOnly,\n    rememberLastOffline,\n    setLastOffline,\n    autoStartOffline,\n    cameraScale,\n    setCameraScale,\n    cameraAspect = \"wide\",\n    setCameraAspect,\n    cameraFitMode = \"fill\",\n    setCameraFitMode,\n    cameraEnabled,\n    textSize,\n    boxSize,\n    autoscoreProvider,\n    autoCommitMode = \"wait-for-clear\",\n    matchType = \"singles\",\n    setMatchType,\n    teamAName = \"Team A\",\n    setTeamAName,\n    teamBName = \"Team B\",\n    setTeamBName,\n  } = useUserSettings();\n  const manualScoring = autoscoreProvider === \"manual\";\n  const cameraToolbarVisible = cameraEnabled && !manualScoring;\n  const waitForBoardClear =\n    cameraEnabled && !manualScoring && autoCommitMode !== \"immediate\";\n  const [selectedMode, setSelectedMode] = useState<string>(\"X01\");\n  const [x01Score, setX01Score] = useState(501);\n  const [ai, setAI] = useState(\"None\");\n  const [showRules, setShowRules] = useState(false);\n  const [inMatch, setInMatch] = useState(false);\n  const [playerScore, setPlayerScore] = useState(x01Score);\n  const [aiScore, setAiScore] = useState(x01Score);\n  const [onDouble, setOnDouble] = useState(false);\n  const [showWinPopup, setShowWinPopup] = useState(false);\n  // Match format: First-to selector and leg counters\n  const [firstTo, setFirstTo] = useState<number>(1);\n  const [playerLegs, setPlayerLegs] = useState<number>(0);\n  const match = useMatch();\n  const [showStartShowcase, setShowStartShowcase] = useState(false);\n  const startedShowcasedRef = useRef(false);\n  const [aiLegs, setAiLegs] = useState<number>(0);\n  // Placeholder for unified offline actions; once commitManualVisitTotal/endTurn defined, we'll assign\n\n  const [pendingLegWinner, setPendingLegWinner] = useState<\n    \"player\" | \"ai\" | null\n  >(null);\n  const [doubleDarts, setDoubleDarts] = useState(1);\n  const [checkoutDarts, setCheckoutDarts] = useState(1);\n  const [legStats, setLegStats] = useState<\n    {\n      winner: \"player\" | \"ai\";\n      doubleDarts: number;\n      checkoutDarts: number;\n      winnerDarts: number;\n      doublesAtt?: number;\n      doublesHit?: number;\n    }[]\n  >([]);\n  // New: pre-game adjustable AI delay (ms)\n  const [aiDelayMs, setAiDelayMs] = useState<number>(2000);\n  const toast = useToast();\n  // New: match popup state\n  const [showMatchModal, setShowMatchModal] = useState(false);\n  // Mirror Online layout defaults when in modern layout, otherwise keep classic feel\n  const [maximized, setMaximized] = useState(offlineLayout === \"modern\");\n  const [fitAll, setFitAll] = useState(offlineLayout === \"modern\");\n  // React to layout changes at runtime\n  useEffect(() => {\n    setMaximized(offlineLayout === \"modern\");\n    setFitAll(offlineLayout === \"modern\");\n  }, [offlineLayout]);\n  useEffect(() => {\n    if (cameraFitMode !== \"fit\") {\n      setCameraFitMode(\"fit\");\n    }\n  }, [cameraFitMode, setCameraFitMode]);\n  const [fitScale, setFitScale] = useState(1);\n  const [fitOverflowing, setFitOverflowing] = useState(false);\n  const [isPlayerTurn, setIsPlayerTurn] = useState(true);\n  useEffect(() => {\n    const handleOpenManager = () => setShowCameraManager(true);\n    window.addEventListener(\"ndn:open-camera-manager\", handleOpenManager);\n    return () =>\n      window.removeEventListener(\"ndn:open-camera-manager\", handleOpenManager);\n  }, []);\n  // Per-dart input and stats\n  const [playerDartPoints, setPlayerDartPoints] = useState<number>(0);\n  const [dpIndex, setDpIndex] = useState<number>(0); // 0..20 (DBULL at 20)\n  const [dpHits, setDpHits] = useState<number>(0);\n  // Around the Clock (offline practice)\n  const [atcIndex, setAtcIndex] = useState<number>(0);\n  const [atcHits, setAtcHits] = useState<number>(0);\n  // Practice mode states\n  const [cricket, setCricket] = useState(createCricketState());\n  const [shanghai, setShanghai] = useState(createShanghaiState());\n  const [halve, setHalve] = useState(createDefaultHalveIt());\n  const [highlow, setHighlow] = useState(createHighLow());\n  const [practiceTurnDarts, setPracticeTurnDarts] = useState<number>(0);\n  // Phase 1 practice modes\n  const [b27Stage, setB27Stage] = useState<number>(1);\n  const [b27Score, setB27Score] = useState<number>(27);\n  const [b27Darts, setB27Darts] = useState<number>(0);\n  const [b27Hits, setB27Hits] = useState<number>(0);\n  const [b27Finished, setB27Finished] = useState<boolean>(false);\n  const [cuRound, setCuRound] = useState<number>(1);\n  const [cuScore, setCuScore] = useState<number>(0);\n  const [cuDarts, setCuDarts] = useState<number>(0);\n  const cuMaxRounds = 8;\n  const [hsRound, setHsRound] = useState<number>(1);\n  const [hsScore, setHsScore] = useState<number>(0);\n  const [hsDarts, setHsDarts] = useState<number>(0);\n  const hsMaxRounds = 10;\n  const [lsRound, setLsRound] = useState<number>(1);\n  const [lsScore, setLsScore] = useState<number>(0);\n  const [lsDarts, setLsDarts] = useState<number>(0);\n  const lsMaxRounds = 10;\n  const [co170Rem, setCo170Rem] = useState<number>(170);\n  const [co170Darts, setCo170Darts] = useState<number>(0);\n  const [co170Attempts, setCo170Attempts] = useState<number>(0);\n  const [co170Successes, setCo170Successes] = useState<number>(0);\n  const [co121Rem, setCo121Rem] = useState<number>(121);\n  const [co121Darts, setCo121Darts] = useState<number>(0);\n  const [co121Attempts, setCo121Attempts] = useState<number>(0);\n  const [co121Successes, setCo121Successes] = useState<number>(0);\n  const [trebleTarget, setTrebleTarget] = useState<number>(20);\n  const [trebleHits, setTrebleHits] = useState<number>(0);\n  const [trebleDarts, setTrebleDarts] = useState<number>(0);\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30);\n  const [trebleFinished, setTrebleFinished] = useState<boolean>(false);\n  // Phase 2 states\n  const [baseball, setBaseball] = useState(createBaseball());\n  const [golf, setGolf] = useState(createGolf());\n  const [ttt, setTTT] = useState(createTicTacToe());\n  const [amCricket, setAmCricket] = useState(createAmCricketState());\n  // Killer (hotseat) state\n  const [killerPlayers, setKillerPlayers] = useState<\n    Array<{ id: string; name: string }>\n  >([\n    { id: \"p1\", name: \"Player 1\" },\n    { id: \"p2\", name: \"Player 2\" },\n  ]);\n  const [killerStates, setKillerStates] = useState<Record<string, KillerState>>(\n    {},\n  );\n  const [killerAssigned, setKillerAssigned] = useState<Record<string, number>>(\n    {},\n  );\n  const [killerSetupDone, setKillerSetupDone] = useState<boolean>(false);\n  const [killerTurnIdx, setKillerTurnIdx] = useState<number>(0);\n  const [killerDarts, setKillerDarts] = useState<number>(0);\n  const [killerWinnerId, setKillerWinnerId] = useState<string | null>(null);\n  const [killerLastEvent, setKillerLastEvent] = useState<string>(\"\");\n  // Scam/Scum state\n  const [scam, setScam] = useState(createScamState());\n  const [scamPlayer, setScamPlayer] = useState(createScamState());\n  // Fives state\n  const [fives, setFives] = useState(createFivesState(50));\n  const [fivesPlayer, setFivesPlayer] = useState(createFivesState(50));\n  // Sevens state\n  const [sevens, setSevens] = useState(createSevensState(70));\n  const [sevensPlayer, setSevensPlayer] = useState(createSevensState(70));\n  const [playerDartsThrown, setPlayerDartsThrown] = useState<number>(0);\n  const [playerLastDart, setPlayerLastDart] = useState<number>(0);\n  const [playerVisitDarts, setPlayerVisitDarts] = useState<number>(0);\n  const [playerVisitStart, setPlayerVisitStart] = useState<number>(x01Score);\n  const [playerVisitSum, setPlayerVisitSum] = useState<number>(0);\n  const [playerLastVisitScore, setPlayerLastVisitScore] = useState<\n    number | null\n  >(null);\n  const [playerVisitDartsAtDouble, setPlayerVisitDartsAtDouble] =\n    useState<number>(0);\n  const lastBounceMissTsRef = useRef<number>(0);\n  const lastVisitDartsRef = useRef<number>(0);\n  const playerScoreRef = useRef<number>(playerScore);\n  const playerVisitDartsRef = useRef<number>(playerVisitDarts);\n  const playerVisitSumRef = useRef<number>(playerVisitSum);\n  const playerVisitStartRef = useRef<number>(playerVisitStart);\n  const playerVisitDartsAtDoubleRef = useRef<number>(playerVisitDartsAtDouble);\n\n  useEffect(() => {\n    playerScoreRef.current = playerScore;\n  }, [playerScore]);\n  useEffect(() => {\n    playerVisitDartsRef.current = playerVisitDarts;\n  }, [playerVisitDarts]);\n  useEffect(() => {\n    playerVisitSumRef.current = playerVisitSum;\n  }, [playerVisitSum]);\n  useEffect(() => {\n    playerVisitStartRef.current = playerVisitStart;\n  }, [playerVisitStart]);\n  useEffect(() => {\n    playerVisitDartsAtDoubleRef.current = playerVisitDartsAtDouble;\n  }, [playerVisitDartsAtDouble]);\n  const [aiCountdownMs, setAiCountdownMs] = useState<number>(0);\n  const aiTimerRef = useRef<number | null>(null);\n  const [aiDartsThrown, setAiDartsThrown] = useState<number>(0);\n  const [aiLastDart, setAiLastDart] = useState<number>(0);\n  const [aiVisitSum, setAiVisitSum] = useState<number>(0);\n  const [aiVisitDarts, setAiVisitDarts] = useState<number>(0);\n  const [aiLastVisitScore, setAiLastVisitScore] = useState<number | null>(null);\n  const [aiVisitDartsAtDouble, setAiVisitDartsAtDouble] = useState<number>(0);\n  // Doubles attempts/hits\n  const [playerDoublesAtt, setPlayerDoublesAtt] = useState<number>(0);\n  const [playerDoublesHit, setPlayerDoublesHit] = useState<number>(0);\n  const [aiDoublesAtt, setAiDoublesAtt] = useState<number>(0);\n  const [aiDoublesHit, setAiDoublesHit] = useState<number>(0);\n  // Match-long totals for averages\n  const [totalPlayerDarts, setTotalPlayerDarts] = useState<number>(0);\n  const [totalAiDarts, setTotalAiDarts] = useState<number>(0);\n  const [totalPlayerPoints, setTotalPlayerPoints] = useState<number>(0);\n  const [totalAiPoints, setTotalAiPoints] = useState<number>(0);\n  // Power scoring and checkout highs\n  const [player180s, setPlayer180s] = useState<number>(0);\n  const [player140s, setPlayer140s] = useState<number>(0);\n  const [player100s, setPlayer100s] = useState<number>(0);\n  const [ai180s, setAi180s] = useState<number>(0);\n  const [ai140s, setAi140s] = useState<number>(0);\n  const [ai100s, setAi100s] = useState<number>(0);\n  const [playerHighestCheckout, setPlayerHighestCheckout] = useState<number>(0);\n  const [aiHighestCheckout, setAiHighestCheckout] = useState<number>(0);\n  // End-of-match summary modal\n  const [showMatchSummary, setShowMatchSummary] = useState<boolean>(false);\n  // Manual correction input for offline (matches CameraView UX)\n  const [manualBox, setManualBox] = useState<string>(\"\");\n  const [manualTextarea, setManualTextarea] = useState<string>(\"\");\n  const [manualPlayerScoreInput, setManualPlayerScoreInput] =\n    useState<string>(\"\");\n  const [manualOpponentScoreInput, setManualOpponentScoreInput] =\n    useState<string>(\"\");\n  const [manualPlayerLegsInput, setManualPlayerLegsInput] =\n    useState<string>(\"\");\n  const [manualOpponentLegsInput, setManualOpponentLegsInput] =\n    useState<string>(\"\");\n  const [legOverrideConfirm, setLegOverrideConfirm] = useState<{\n    target: \"player\" | \"ai\";\n    value: number;\n    stage: 1 | 2;\n  } | null>(null);\n  const [showCameraManager, setShowCameraManager] = useState<boolean>(false);\n  const [dartCounts, setDartCounts] = useState<Record<string, number>>({});\n  const [awaitingBoardClear, setAwaitingBoardClear] = useState<boolean>(false);\n  const pendingVisitRef = useRef<PendingAutoVisit | null>(null);\n  const pendingVisitTimerRef = useRef<ReturnType<typeof setTimeout> | null>(\n    null,\n  );\n\n  const clearPendingVisitTimer = useCallback(() => {\n    const timer = pendingVisitTimerRef.current;\n    if (timer) {\n      clearTimeout(timer);\n      pendingVisitTimerRef.current = null;\n    }\n  }, []);\n\n  const speakAutoVisit = useCallback(\n    (pending: PendingAutoVisit) => {\n      if (!callerEnabled) return;\n      const speaker = user?.username || \"Player\";\n      try {\n        sayScore(\n          speaker,\n          pending.visitTotal,\n          Math.max(pending.remaining, 0),\n          callerVoice,\n          { volume: callerVolume, checkoutOnly: speakCheckoutOnly },\n        );\n      } catch {}\n    },\n    [\n      callerEnabled,\n      callerVoice,\n      callerVolume,\n      speakCheckoutOnly,\n      user?.username,\n    ],\n  );\n\n  const commitPendingVisit = useCallback(\n    (\n      pending: PendingAutoVisit,\n      _trigger: \"immediate\" | \"event\" | \"timeout\",\n    ) => {\n      setAwaitingBoardClear(false);\n      const {\n        visitTotal,\n        darts,\n        preRemaining,\n        remaining,\n        doubleAttempts,\n        finished,\n        doubleWindow,\n        highestCheckout,\n      } = pending;\n\n      if (!finished) {\n        setPlayerScore(remaining);\n        playerScoreRef.current = remaining;\n      } else {\n        setPlayerScore(0);\n        playerScoreRef.current = 0;\n        if (typeof highestCheckout === \"number\" && highestCheckout > 0) {\n          setPlayerHighestCheckout((h) => Math.max(h, highestCheckout));\n        }\n      }\n\n      setPlayerLastVisitScore(visitTotal);\n\n      if (visitTotal === 180) setPlayer180s((n) => n + 1);\n      else if (visitTotal >= 140) setPlayer140s((n) => n + 1);\n      else if (visitTotal >= 100) setPlayer100s((n) => n + 1);\n\n      if (doubleWindow && doubleAttempts > 0) {\n        setPlayerDoublesAtt((a) => a + doubleAttempts);\n        if (finished) setPlayerDoublesHit((h) => h + 1);\n      }\n\n      if (!pending.announced) speakAutoVisit(pending);\n\n      try {\n        useAudit.getState().recordVisit(\"offline-x01\", darts, visitTotal, {\n          preRemaining,\n          postRemaining: finished ? 0 : remaining,\n          finish: finished,\n          bust: false,\n        });\n      } catch {}\n\n      if (finished) {\n        setPendingLegWinner(\"player\");\n        setShowWinPopup(true);\n      }\n\n      endTurn(finished ? 0 : remaining);\n\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n    },\n    [\n      endTurn,\n      setPlayerHighestCheckout,\n      setPendingLegWinner,\n      setPlayerScore,\n      setPlayerLastVisitScore,\n      setPlayerVisitSum,\n      setPlayerVisitDarts,\n      setPlayerVisitDartsAtDouble,\n      setShowWinPopup,\n      setPlayer180s,\n      setPlayer140s,\n      setPlayer100s,\n      setPlayerDoublesAtt,\n      setPlayerDoublesHit,\n      speakAutoVisit,\n    ],\n  );\n\n  const finalizePendingVisit = useCallback(\n    (trigger: \"event\" | \"timeout\") => {\n      const pending = pendingVisitRef.current;\n      if (!pending) return;\n      pendingVisitRef.current = null;\n      clearPendingVisitTimer();\n      commitPendingVisit(pending, trigger);\n    },\n    [clearPendingVisitTimer, commitPendingVisit],\n  );\n\n  const queuePendingVisit = useCallback(\n    (pending: PendingAutoVisit) => {\n      speakAutoVisit(pending);\n      pendingVisitRef.current = { ...pending, announced: true };\n      setAwaitingBoardClear(true);\n      clearPendingVisitTimer();\n      pendingVisitTimerRef.current = setTimeout(\n        () => finalizePendingVisit(\"timeout\"),\n        BOARD_CLEAR_GRACE_MS,\n      );\n    },\n    [clearPendingVisitTimer, finalizePendingVisit, speakAutoVisit],\n  );\n\n  useEffect(() => {\n    if (!waitForBoardClear) return;\n    const handler = () => finalizePendingVisit(\"event\");\n    window.addEventListener(\"ndn:darts-cleared\", handler as EventListener);\n    return () =>\n      window.removeEventListener(\"ndn:darts-cleared\", handler as EventListener);\n  }, [waitForBoardClear, finalizePendingVisit]);\n\n  useEffect(() => {\n    if (!waitForBoardClear) finalizePendingVisit(\"timeout\");\n  }, [waitForBoardClear, finalizePendingVisit]);\n\n  useEffect(() => () => clearPendingVisitTimer(), [clearPendingVisitTimer]);\n\n  useEffect(() => {\n    if (playerVisitDarts === 0) {\n      try {\n        window.dispatchEvent(\n          new CustomEvent(\"ndn:darts-cleared\", {\n            detail: { source: \"offline-play\", ts: Date.now() },\n          }),\n        );\n      } catch {}\n      lastBounceMissTsRef.current = 0;\n    }\n    lastVisitDartsRef.current = playerVisitDarts;\n  }, [playerVisitDarts]);\n\n  const humanName = user?.username || \"Player 1\";\n  const aiDisplayName = ai === \"None\" ? \"Player 2\" : ai;\n\n  // Call all game stat hooks unconditionally at component level (React hooks rules)\n  const statsX01 = useOfflineGameStats(\n    \"X01\" as any,\n    playerScore,\n    aiScore,\n    playerLegs,\n    aiLegs,\n    playerLastDart,\n    aiLastDart,\n    playerVisitSum,\n    aiVisitSum,\n    playerLastVisitScore,\n    aiLastVisitScore,\n    playerVisitDarts,\n    aiVisitDarts,\n    playerDoublesHit,\n    playerDoublesAtt,\n    aiDoublesHit,\n    aiDoublesAtt,\n    legStats,\n    isPlayerTurn,\n    ai,\n    x01Score,\n  );\n  const statsCricket = useOfflineGameStats(\n    \"Cricket\" as any,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    cricket,\n  );\n  const statsShanghai = useOfflineGameStats(\n    \"Shanghai\" as any,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    isPlayerTurn,\n    ai,\n    undefined,\n    cricket,\n    shanghai,\n  );\n  const statsKiller = useOfflineGameStats(\n    \"Killer\" as any,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    killerPlayers,\n    killerStates,\n    killerAssigned,\n    killerTurnIdx,\n  );\n  const statsScam = useOfflineGameStats(\"Scam\" as any);\n  const statsFives = useOfflineGameStats(\"Fives\" as any);\n  const statsSevens = useOfflineGameStats(\"Sevens\" as any);\n\n  const activeScoreboardStats = useMemo(() => {\n    const list = statsX01 || [];\n    const playerResolvedLastScore =\n      playerVisitDarts > 0\n        ? playerVisitSum\n        : (playerLastVisitScore ?? playerLastDart);\n    const aiResolvedLastScore =\n      aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart);\n    if (list.length === 0) {\n      return {\n        name: isPlayerTurn ? humanName : aiDisplayName,\n        isCurrentTurn: true,\n        legsWon: isPlayerTurn ? playerLegs : aiLegs,\n        score: isPlayerTurn ? playerScore : aiScore,\n        lastScore: isPlayerTurn ? playerResolvedLastScore : aiResolvedLastScore,\n      } as PlayerStats;\n    }\n    return list.find((player) => player.isCurrentTurn) ?? list[0];\n  }, [\n    statsX01,\n    isPlayerTurn,\n    humanName,\n    aiDisplayName,\n    playerLegs,\n    aiLegs,\n    playerScore,\n    aiScore,\n    playerVisitDarts,\n    playerVisitSum,\n    playerLastVisitScore,\n    playerLastDart,\n    aiVisitSum,\n    aiLastVisitScore,\n    aiLastDart,\n    aiVisitDarts,\n  ]);\n\n  const singlePlayerScoreboard: PlayerStats[] = useMemo(() => {\n    if (!activeScoreboardStats) return [];\n    const { matchAvg, allTimeAvg, ...rest } = activeScoreboardStats;\n    return [\n      { ...rest, matchAvg: undefined, allTimeAvg: undefined } as PlayerStats,\n    ];\n  }, [activeScoreboardStats]);\n\n  const inactivePlayerName = isPlayerTurn ? aiDisplayName : humanName;\n  const activePlayerName =\n    activeScoreboardStats?.name ?? (isPlayerTurn ? humanName : aiDisplayName);\n  const activeRemaining = isPlayerTurn ? playerScore : aiScore;\n  const activeLastScore = isPlayerTurn\n    ? playerVisitDarts > 0\n      ? playerVisitSum\n      : (playerLastVisitScore ?? playerLastDart)\n    : aiVisitDarts > 0\n      ? aiVisitSum\n      : (aiLastVisitScore ?? aiLastDart);\n\n  const recordDart = useCallback((mode: string, count = 1) => {\n    if (!mode || count <= 0) return;\n    setDartCounts((prev) => ({\n      ...prev,\n      [mode]: (prev[mode] || 0) + count,\n    }));\n  }, []);\n\n  const resetDartCount = useCallback((mode: string) => {\n    if (!mode) return;\n    setDartCounts((prev) => {\n      if (prev[mode] === undefined) return prev;\n      return { ...prev, [mode]: 0 };\n    });\n  }, []);\n\n  const activeModeDarts = dartCounts[selectedMode] || 0;\n\n  const parseManualScoreOverride = (value: string): number | null => {\n    if (!value.trim()) return null;\n    const parsed = Number(value);\n    if (!Number.isFinite(parsed)) return null;\n    return clamp(Math.round(parsed), 0, x01Score);\n  };\n\n  const parseManualLegsOverride = (value: string): number | null => {\n    if (!value.trim()) return null;\n    const parsed = Number(value);\n    if (!Number.isFinite(parsed)) return null;\n    return Math.max(0, Math.round(parsed));\n  };\n\n  const cancelPendingAutoVisit = useCallback(() => {\n    if (pendingVisitRef.current) {\n      pendingVisitRef.current = null;\n    }\n    clearPendingVisitTimer();\n    setAwaitingBoardClear(false);\n  }, [clearPendingVisitTimer]);\n\n  const applyPlayerScoreOverride = useCallback(\n    (nextScore: number) => {\n      const safeScore = clamp(nextScore, 0, x01Score);\n      cancelPendingAutoVisit();\n      setPlayerScore(safeScore);\n      playerScoreRef.current = safeScore;\n\n      const nextVisitStart = safeScore === 0 ? x01Score : safeScore;\n      setPlayerVisitStart(nextVisitStart);\n      playerVisitStartRef.current = nextVisitStart;\n\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n\n      setPlayerLastVisitScore(null);\n      setPlayerLastDart(0);\n      setPlayerDartPoints(0);\n      lastBounceMissTsRef.current = 0;\n\n      if (safeScore === 0) {\n        setPendingLegWinner(\"player\");\n        setShowWinPopup(true);\n      } else {\n        setPendingLegWinner(null);\n        setShowWinPopup(false);\n      }\n    },\n    [\n      cancelPendingAutoVisit,\n      setPlayerScore,\n      x01Score,\n      setPlayerVisitStart,\n      setPlayerVisitSum,\n      setPlayerVisitDarts,\n      setPlayerVisitDartsAtDouble,\n      setPlayerLastVisitScore,\n      setPlayerLastDart,\n      setPlayerDartPoints,\n      setPendingLegWinner,\n      setShowWinPopup,\n    ],\n  );\n\n  const handleManualScoreOverride = (target: \"player\" | \"ai\") => {\n    const source =\n      target === \"player\" ? manualPlayerScoreInput : manualOpponentScoreInput;\n    const parsed = parseManualScoreOverride(source);\n    if (parsed === null) {\n      toast(`Enter a number between 0 and ${x01Score}`, {\n        type: \"error\",\n        timeout: 2500,\n      });\n      return;\n    }\n    if (target === \"player\") {\n      applyPlayerScoreOverride(parsed);\n      setManualPlayerScoreInput(\"\");\n      return;\n    } else {\n      setAiScore(parsed);\n      setAiVisitSum(0);\n      setAiVisitDarts(0);\n      setAiLastVisitScore(null);\n      setAiVisitDartsAtDouble(0);\n      setAiLastDart(0);\n      setManualOpponentScoreInput(\"\");\n    }\n    setPendingLegWinner(null);\n    setShowWinPopup(false);\n  };\n\n  const applyManualLegOverride = useCallback(\n    (target: \"player\" | \"ai\", value: number) => {\n      if (target === \"player\") {\n        setPlayerLegs(value);\n        setManualPlayerLegsInput(\"\");\n      } else {\n        setAiLegs(value);\n        setManualOpponentLegsInput(\"\");\n      }\n      setPendingLegWinner(null);\n      setShowWinPopup(false);\n    },\n    [\n      setAiLegs,\n      setManualOpponentLegsInput,\n      setManualPlayerLegsInput,\n      setPendingLegWinner,\n      setPlayerLegs,\n      setShowWinPopup,\n    ],\n  );\n\n  const handleManualLegsOverride = (target: \"player\" | \"ai\") => {\n    const source =\n      target === \"player\" ? manualPlayerLegsInput : manualOpponentLegsInput;\n    const parsed = parseManualLegsOverride(source);\n    if (parsed === null) {\n      toast(\"Enter a non-negative whole number for legs\", {\n        type: \"error\",\n        timeout: 2500,\n      });\n      return;\n    }\n    setLegOverrideConfirm({ target, value: parsed, stage: 1 });\n  };\n\n  const handleLegOverrideYes = useCallback(() => {\n    setLegOverrideConfirm((prev) => {\n      if (!prev) return prev;\n      if (prev.stage === 1) return { ...prev, stage: 2 };\n      applyManualLegOverride(prev.target, prev.value);\n      return null;\n    });\n  }, [applyManualLegOverride]);\n\n  const handleLegOverrideNo = useCallback(() => {\n    setLegOverrideConfirm(null);\n  }, []);\n\n  useEffect(() => {\n    if (!legOverrideConfirm) return;\n    const handleKey = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        event.preventDefault();\n        handleLegOverrideNo();\n      }\n    };\n    window.addEventListener(\"keydown\", handleKey);\n    return () => window.removeEventListener(\"keydown\", handleKey);\n  }, [handleLegOverrideNo, legOverrideConfirm]);\n\n  // Button size classes for toolbar buttons\n  const getButtonSizeClasses = (size: string) => {\n    switch (size) {\n      case \"small\":\n        return \"px-1.5 py-0.5 text-xs\";\n      case \"large\":\n        return \"px-3 py-1 text-sm\";\n      default:\n        return \"px-2 py-0.5 text-sm\";\n    }\n  };\n  const buttonSizeClass = getButtonSizeClasses(textSize);\n  // Fit-all scaling measurement\n  const scrollerRef = useRef<HTMLDivElement | null>(null);\n  const contentRef = useRef<HTMLDivElement | null>(null);\n  const headerBarRef = useRef<HTMLDivElement | null>(null);\n  // Match format controls (offline only): First to N or Best of N with editable count\n  const [formatType, setFormatType] = useState<\"first\" | \"best\">(\"first\");\n  const [formatCount, setFormatCount] = useState<number>(1);\n  const formatRef = useRef<HTMLDivElement | null>(null);\n  // Keep internal required wins (firstTo) in sync with format selection\n  useEffect(() => {\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1));\n    const wins = formatType === \"first\" ? n : Math.max(1, Math.ceil(n / 2));\n    setFirstTo(wins);\n  }, [formatType, formatCount]);\n  useEffect(() => {\n    if (!fitAll) {\n      setFitScale(1);\n      setFitOverflowing(false);\n      return;\n    }\n    const measure = () => {\n      const scroller = scrollerRef.current;\n      const content = contentRef.current;\n      if (!scroller || !content) return;\n      // Available size excludes the sticky header inside the scroller\n      const headerH = headerBarRef.current\n        ? headerBarRef.current.getBoundingClientRect().height\n        : 0;\n      const availH = Math.max(0, scroller.clientHeight - headerH - 6); // small breathing room\n      const availW = Math.max(0, scroller.clientWidth - 8);\n      // Measure the content size without scale\n      const rect = content.getBoundingClientRect();\n      const currentScale = fitScale || 1;\n      const naturalHeight = rect.height / currentScale;\n      const naturalWidth = rect.width / currentScale;\n      // Compute scale to fit both height and width\n      const scaleH = availH > 0 ? availH / naturalHeight : 1;\n      const scaleW = availW > 0 ? availW / naturalWidth : 1;\n      const next = Math.min(1, Math.max(0.5, Math.min(scaleH, scaleW)));\n      const scaledHeight = naturalHeight * next;\n      const overflowing = availH > 0 && scaledHeight - availH > 1;\n      setFitOverflowing(overflowing);\n      setFitScale(next);\n    };\n    measure();\n    const RO: any = (window as any).ResizeObserver;\n    const ro = RO ? new RO(() => measure()) : null;\n    ro && scrollerRef.current && ro.observe(scrollerRef.current as any);\n    ro && contentRef.current && ro.observe(contentRef.current as any);\n    window.addEventListener(\"resize\", measure);\n    return () => {\n      window.removeEventListener(\"resize\", measure);\n      try {\n        ro && scrollerRef.current && ro.unobserve(scrollerRef.current as any);\n      } catch {}\n      try {\n        ro && contentRef.current && ro.unobserve(contentRef.current as any);\n      } catch {}\n    };\n  }, [fitAll, fitScale]);\n\n  // Auto-start handler (from Home or other tabs)\n  useEffect(() => {\n    const onAuto = (e: any) => {\n      const m = e?.detail?.mode as string | undefined;\n      if (!m) return;\n      setSelectedMode(m);\n      // For Double Practice we could load a specific flow. For now, we just open the X01-like modal with immediate start.\n      startMatch();\n    };\n    window.addEventListener(\"ndn:auto-start\", onAuto as any);\n    return () => window.removeEventListener(\"ndn:auto-start\", onAuto as any);\n  }, []);\n\n  // Accept demo parameters to preconfigure format and starting score before auto-start\n  useEffect(() => {\n    const onFmt = (e: any) => {\n      const t = e?.detail?.formatType;\n      const c = e?.detail?.formatCount;\n      const s = e?.detail?.startScore;\n      if (t === \"first\" || t === \"best\") setFormatType(t);\n      if (typeof c === \"number\" && isFinite(c))\n        setFormatCount(Math.max(1, Math.floor(c)));\n      if (typeof s === \"number\" && isFinite(s))\n        setX01Score(Math.max(1, Math.floor(s)));\n    };\n    window.addEventListener(\"ndn:offline-format\", onFmt as any);\n    return () => window.removeEventListener(\"ndn:offline-format\", onFmt as any);\n  }, []);\n\n  // Auto-start last offline match when opening this tab, if enabled\n  useEffect(() => {\n    if (!autoStartOffline) return;\n    // Kick off a match after initial render for a smooth modal open\n    const id = setTimeout(() => startMatch(), 50);\n    return () => clearTimeout(id);\n  }, [autoStartOffline]);\n\n  // Drive AI countdown and perform AI visit when countdown elapses\n  useEffect(() => {\n    if (!showMatchModal || isPlayerTurn || ai === \"None\" || aiCountdownMs <= 0)\n      return;\n    let raf: number;\n    let last = performance.now();\n    const tick = (now: number) => {\n      const dt = now - last;\n      last = now;\n      setAiCountdownMs((prev) => {\n        const next = prev - dt;\n        if (next <= 0) {\n          // Execute AI visit per dart (up to 3 darts or until finish/bust)\n          let visitDarts = 0;\n          let visitTotal = 0;\n          let remaining = aiScore;\n          setAiVisitDarts(0);\n          while (visitDarts < 3 && remaining > 0) {\n            const targetVisit = aiVisitScore(remaining, ai);\n            // break target into up to 3 darts (roughly 20 per dart for easy split)\n            const dart = clamp(\n              targetVisit - visitDarts * 20,\n              0,\n              Math.min(60, remaining),\n            );\n            const after = remaining - dart;\n            setAiLastDart(dart);\n            setAiDartsThrown((d) => d + 1);\n            setTotalAiDarts((d) => d + 1);\n            if (after < 0) {\n              // bust: revert to remaining before visit\n              remaining = aiScore;\n              setAiVisitSum(0);\n              setAiVisitDartsAtDouble(0);\n              visitTotal = 0;\n              setAiLastVisitScore(0);\n              setAiVisitDarts(0);\n              break;\n            }\n            // Only add points after confirming not a bust\n            visitTotal += dart;\n            setAiVisitSum((s) => s + dart);\n            setTotalAiPoints((p) => p + dart);\n            // Track darts at double window\n            const preRem = remaining;\n            const postRem = after;\n            if (preRem > 50 && postRem <= 50) setAiVisitDartsAtDouble(1);\n            else if (preRem <= 50) setAiVisitDartsAtDouble((c) => c + 1);\n            remaining = after;\n            visitDarts += 1;\n            setAiVisitDarts(visitDarts);\n            if (remaining === 0) break;\n          }\n          setAiScore(remaining);\n          if (remaining === 0) {\n            // Power score classification\n            if (visitTotal === 180) setAi180s((n) => n + 1);\n            else if (visitTotal >= 140) setAi140s((n) => n + 1);\n            else if (visitTotal >= 100) setAi100s((n) => n + 1);\n            // Highest checkout\n            const checkout = aiScore;\n            if (checkout <= 170)\n              setAiHighestCheckout((h) => Math.max(h, checkout));\n            // Doubles attempts/hit if finished from <= 50\n            if (aiScore <= 50) {\n              setAiDoublesAtt(\n                (a) =>\n                  a + (aiVisitDartsAtDouble > 0 ? aiVisitDartsAtDouble : 1),\n              );\n              setAiDoublesHit((h) => h + 1);\n            }\n            setAiLastVisitScore(visitTotal);\n            setAiVisitSum(0);\n            setAiVisitDartsAtDouble(0);\n            setAiVisitDarts(0);\n            // AI won the leg\n            setPendingLegWinner(\"ai\");\n            setShowWinPopup(true);\n          }\n          // If AI did not finish, but threw 3 darts this visit, classify power score and reset visit sum\n          if (remaining > 0 && visitDarts >= 3) {\n            if (visitTotal === 180) setAi180s((n) => n + 1);\n            else if (visitTotal >= 140) setAi140s((n) => n + 1);\n            else if (visitTotal >= 100) setAi100s((n) => n + 1);\n            setAiLastVisitScore(visitTotal);\n            setAiVisitSum(0);\n            setAiVisitDartsAtDouble(0);\n            setAiVisitDarts(0);\n          }\n          // Hand turn back to player\n          setAiVisitDarts(0);\n          setIsPlayerTurn(true);\n          return 0;\n        }\n        return next;\n      });\n      raf = requestAnimationFrame(tick);\n    };\n    raf = requestAnimationFrame(tick);\n    return () => cancelAnimationFrame(raf);\n  }, [showMatchModal, isPlayerTurn, ai, aiScore]);\n\n  useEffect(() => {\n    if (!match.inProgress) return;\n    if (startedShowcasedRef.current) return;\n    setShowStartShowcase(true);\n    startedShowcasedRef.current = true;\n  }, [match.inProgress]);\n\n  function startMatch() {\n    setInMatch(true);\n    setPlayerScore(x01Score);\n    playerScoreRef.current = x01Score;\n    setAiScore(x01Score);\n    setOnDouble(false);\n    setShowMatchModal(true);\n    setIsPlayerTurn(true);\n    setPlayerDartPoints(0);\n    setPlayerDartsThrown(0);\n    setPlayerLastDart(0);\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitStart(x01Score);\n    setPlayerVisitSum(0);\n    setPlayerLastVisitScore(null);\n    setPlayerVisitDartsAtDouble(0);\n    setAiCountdownMs(0);\n    setAiDartsThrown(0);\n    setAiLastDart(0);\n    setAiVisitSum(0);\n    setAiVisitDarts(0);\n    setAiLastVisitScore(null);\n    setPendingLegWinner(null);\n    // When starting a brand-new match from menu, reset legs\n    setPlayerLegs(0);\n    setAiLegs(0);\n    setLegStats([]);\n    // Reset Treble Practice session state when starting a new match\n    setTrebleHits(0);\n    setTrebleDarts(0);\n    setTrebleFinished(false);\n    // Reset match-long totals\n    setTotalPlayerDarts(0);\n    setTotalAiDarts(0);\n    setTotalPlayerPoints(0);\n    setTotalAiPoints(0);\n    setPlayer180s(0);\n    setPlayer140s(0);\n    setPlayer100s(0);\n    setAi180s(0);\n    setAi140s(0);\n    setAi100s(0);\n    setPlayerHighestCheckout(0);\n    setAiHighestCheckout(0);\n    setPlayerDoublesAtt(0);\n    setPlayerDoublesHit(0);\n    setAiDoublesAtt(0);\n    setAiDoublesHit(0);\n    resetDartCount(\"X01\");\n    // Sync required wins from current format selection\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1));\n    setFirstTo(formatType === \"first\" ? n : Math.max(1, Math.ceil(n / 2)));\n    if (rememberLastOffline) {\n      try {\n        setLastOffline({\n          mode: selectedMode,\n          x01Start: x01Score,\n          firstTo,\n          aiLevel: ai,\n        });\n      } catch {}\n    }\n  }\n\n  function startNextLeg() {\n    setPlayerScore(x01Score);\n    playerScoreRef.current = x01Score;\n    setAiScore(x01Score);\n    setOnDouble(false);\n    setShowMatchModal(true);\n    setIsPlayerTurn(true);\n    setPlayerDartPoints(0);\n    setPlayerDartsThrown(0);\n    setPlayerLastDart(0);\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitStart(x01Score);\n    setPlayerVisitSum(0);\n    playerVisitStartRef.current = x01Score;\n    playerVisitSumRef.current = 0;\n    setPlayerLastVisitScore(null);\n    setPlayerVisitDartsAtDouble(0);\n    playerVisitDartsAtDoubleRef.current = 0;\n    playerVisitDartsAtDoubleRef.current = 0;\n    setAiCountdownMs(0);\n    setAiDartsThrown(0);\n    setAiLastDart(0);\n    setAiVisitSum(0);\n    setAiVisitDarts(0);\n    setAiLastVisitScore(null);\n    setPendingLegWinner(null);\n  }\n\n  // --- Offline per-dart helpers ---\n  function endTurn(nextRemaining: number) {\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitStart(nextRemaining === 0 ? x01Score : nextRemaining);\n    playerVisitStartRef.current =\n      nextRemaining === 0 ? x01Score : nextRemaining;\n    setPlayerVisitDartsAtDouble(0);\n    playerVisitDartsAtDoubleRef.current = 0;\n    if (ai !== \"None\") {\n      setIsPlayerTurn(false);\n      setAiCountdownMs(aiDelayMs);\n    } else {\n      setAiCountdownMs(0);\n      setIsPlayerTurn(true);\n    }\n  }\n\n  function applyDartValue(dart: number) {\n    if (waitForBoardClear && pendingVisitRef.current) {\n      if (!awaitingBoardClear) setAwaitingBoardClear(true);\n      toast(\"Remove your darts before starting the next throw\", {\n        type: \"info\",\n        timeout: 1800,\n      });\n      return;\n    }\n    recordDart(\"X01\");\n    const currentScore = playerScoreRef.current;\n    const currentVisitDarts = playerVisitDartsRef.current;\n    const currentVisitSum = playerVisitSumRef.current;\n    const currentVisitStart = playerVisitStartRef.current;\n    const currentVisitDartsAtDouble = playerVisitDartsAtDoubleRef.current;\n    const remaining = currentScore - dart;\n    const newVisitDarts = currentVisitDarts + 1;\n\n    setPlayerLastDart(dart);\n    setPlayerDartsThrown((d) => d + 1);\n    setTotalPlayerDarts((d) => d + 1);\n\n    if (remaining < 0) {\n      try {\n        const preRemaining = currentScore;\n        const postRemaining = currentVisitStart;\n        useAudit.getState().recordVisit(\"offline-x01\", newVisitDarts, 0, {\n          preRemaining,\n          postRemaining,\n          bust: true,\n          finish: false,\n        });\n      } catch {}\n      setPlayerScore(currentVisitStart);\n      playerScoreRef.current = currentVisitStart;\n\n      if (currentScore <= 50) {\n        const attemptsThisVisit = (currentVisitDartsAtDouble || 0) + 1;\n        setPlayerDoublesAtt((a) => a + attemptsThisVisit);\n      }\n\n      if (callerEnabled) {\n        try {\n          sayScore(\n            user?.username || \"Player\",\n            0,\n            Math.max(currentVisitStart, 0),\n            callerVoice,\n            { volume: callerVolume, checkoutOnly: speakCheckoutOnly },\n          );\n        } catch {}\n      }\n\n      setPlayerLastVisitScore(0);\n      setPlayerDartPoints(0);\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n      endTurn(currentVisitStart);\n      return;\n    }\n\n    setPlayerScore(remaining);\n    playerScoreRef.current = remaining;\n\n    setPlayerVisitDarts(newVisitDarts);\n    playerVisitDartsRef.current = newVisitDarts;\n    const newVisitSum = currentVisitSum + dart;\n    setPlayerVisitSum(newVisitSum);\n    playerVisitSumRef.current = newVisitSum;\n\n    setTotalPlayerPoints((p) => p + dart);\n    setPlayerDartPoints(0);\n\n    const preRemaining = currentScore;\n    const postRemaining = remaining;\n    const startedDoubleWindow = preRemaining > 50 && postRemaining <= 50;\n    const stillInDoubleWindow = preRemaining <= 50;\n    if (startedDoubleWindow) {\n      setPlayerVisitDartsAtDouble(1);\n      playerVisitDartsAtDoubleRef.current = 1;\n    } else if (stillInDoubleWindow) {\n      setPlayerVisitDartsAtDouble((c) => c + 1);\n      playerVisitDartsAtDoubleRef.current =\n        (currentVisitDartsAtDouble || 0) + 1;\n    }\n\n    const doubleAttemptsNow = playerVisitDartsAtDoubleRef.current || 0;\n    const inDoubleWindow = preRemaining <= 50;\n    const attemptsForVisit = inDoubleWindow\n      ? Math.max(doubleAttemptsNow, Math.min(newVisitDarts, 3))\n      : 0;\n\n    if (remaining === 0) {\n      const pending: PendingAutoVisit = {\n        visitTotal: newVisitSum,\n        darts: newVisitDarts,\n        preRemaining: currentScore,\n        remaining: 0,\n        doubleAttempts: attemptsForVisit,\n        finished: true,\n        doubleWindow: inDoubleWindow,\n        highestCheckout: currentVisitStart <= 170 ? currentVisitStart : null,\n      };\n      if (waitForBoardClear) {\n        queuePendingVisit(pending);\n      } else {\n        commitPendingVisit(pending, \"immediate\");\n      }\n      return;\n    }\n\n    if (newVisitDarts >= 3) {\n      const pending: PendingAutoVisit = {\n        visitTotal: newVisitSum,\n        darts: newVisitDarts,\n        preRemaining: currentScore,\n        remaining,\n        doubleAttempts: attemptsForVisit,\n        finished: false,\n        doubleWindow: inDoubleWindow,\n        highestCheckout: null,\n      };\n      if (waitForBoardClear) {\n        queuePendingVisit(pending);\n      } else {\n        commitPendingVisit(pending, \"immediate\");\n      }\n      return;\n    }\n  }\n\n  function addDartNumeric() {\n    const dart = clamp(Math.round(Number(playerDartPoints) || 0), 0, 60);\n    applyDartValue(dart);\n  }\n\n  function commitManualVisitTotal(rawTotal: number): boolean {\n    if (!Number.isFinite(rawTotal)) return false;\n\n    const visitStart = playerVisitStartRef.current;\n    const liveScore = playerScoreRef.current;\n    const existingDarts = playerVisitDartsRef.current;\n    const existingSum = playerVisitSumRef.current;\n    const hadPartialVisit = existingDarts > 0 || existingSum > 0;\n\n    if (hadPartialVisit) {\n      setPlayerScore(visitStart);\n      playerScoreRef.current = visitStart;\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n      setPlayerLastDart(0);\n      setPlayerDartPoints(0);\n      setPlayerDartsThrown((d) => Math.max(0, d - existingDarts));\n      setTotalPlayerDarts((d) => Math.max(0, d - existingDarts));\n      setTotalPlayerPoints((p) => Math.max(0, p - existingSum));\n      lastBounceMissTsRef.current = 0;\n    }\n\n    const preRemaining = hadPartialVisit ? visitStart : liveScore;\n    const checkoutCap = preRemaining <= 170 ? 170 : 180;\n    const total = clamp(Math.round(rawTotal), 0, checkoutCap);\n\n    recordDart(\"X01\", 3);\n    setPlayerDartsThrown((d) => d + 3);\n    setTotalPlayerDarts((d) => d + 3);\n    setPlayerVisitDarts(3);\n    playerVisitDartsRef.current = 3;\n    setPlayerVisitSum(total);\n    playerVisitSumRef.current = total;\n    setPlayerLastVisitScore(total);\n\n    if (total === 180) setPlayer180s((n) => n + 1);\n    else if (total >= 140) setPlayer140s((n) => n + 1);\n    else if (total >= 100) setPlayer100s((n) => n + 1);\n\n    const remaining = preRemaining - total;\n\n    if (remaining < 0) {\n      if (callerEnabled) {\n        try {\n          sayScore(humanName, 0, Math.max(visitStart, 0), callerVoice, {\n            volume: callerVolume,\n            checkoutOnly: speakCheckoutOnly,\n          });\n        } catch {}\n      }\n      try {\n        useAudit.getState().recordVisit(\"offline-x01\", 3, 0, {\n          preRemaining,\n          postRemaining: visitStart,\n          bust: true,\n          finish: false,\n        });\n      } catch {}\n      setPlayerScore(visitStart);\n      playerScoreRef.current = visitStart;\n      setPlayerLastVisitScore(0);\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n      endTurn(visitStart);\n      return true;\n    }\n\n    setPlayerScore(remaining);\n    playerScoreRef.current = remaining;\n    setTotalPlayerPoints((p) => p + total);\n\n    if (callerEnabled) {\n      try {\n        sayScore(humanName, total, Math.max(remaining, 0), callerVoice, {\n          volume: callerVolume,\n          checkoutOnly: speakCheckoutOnly,\n        });\n      } catch {}\n    }\n\n    if (preRemaining <= 50) {\n      setPlayerDoublesAtt((a) => a + 3);\n      if (remaining === 0) setPlayerDoublesHit((h) => h + 1);\n    }\n\n    if (remaining === 0) {\n      if (preRemaining <= 170)\n        setPlayerHighestCheckout((h) => Math.max(h, preRemaining));\n      try {\n        useAudit.getState().recordVisit(\"offline-x01\", 3, total, {\n          preRemaining,\n          postRemaining: 0,\n          finish: true,\n          bust: false,\n        });\n      } catch {}\n      setPendingLegWinner(\"player\");\n      setShowWinPopup(true);\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n      return true;\n    }\n\n    try {\n      useAudit.getState().recordVisit(\"offline-x01\", 3, total, {\n        preRemaining,\n        postRemaining: remaining,\n        finish: false,\n        bust: false,\n      });\n    } catch {}\n    endTurn(remaining);\n    setPlayerVisitSum(0);\n    playerVisitSumRef.current = 0;\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitDartsAtDouble(0);\n    playerVisitDartsAtDoubleRef.current = 0;\n    return true;\n  }\n\n  // Once local commit and endTurn functions are defined, create the unified offline actions wrapper\n  const matchActions: UnifiedMatchActions = createOfflineMatchActions({\n    match,\n    commitManualVisitTotal,\n    endTurn,\n  });\n\n  // Optional: Add a full-visit total (0â€“180) input for quick entry like \"93\"\n  const [visitTotalInput, setVisitTotalInput] = useState<string>(\"\");\n  const handleVisitTotalChange = (raw: string) => {\n    if (!raw) {\n      setVisitTotalInput(\"\");\n      return;\n    }\n    const numericOnly = raw.replace(/[^0-9]/g, \"\");\n    if (!numericOnly) {\n      setVisitTotalInput(\"\");\n      return;\n    }\n    const parsed = Number(numericOnly);\n    if (!Number.isFinite(parsed)) return;\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180;\n    const safe = clamp(Math.round(parsed), 0, maxAllowed);\n    setVisitTotalInput(String(safe));\n  };\n  function addVisitTotal() {\n    if (!visitTotalInput) {\n      alert(\"Enter a number 0â€“180 for visit total\");\n      return;\n    }\n    const parsed = Number(visitTotalInput);\n    if (!Number.isFinite(parsed)) {\n      alert(\"Enter a number 0â€“180 for visit total\");\n      return;\n    }\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180;\n    const bounded = clamp(Math.round(parsed), 0, maxAllowed);\n    if (parsed > maxAllowed) {\n      toast(`Visit totals cannot exceed ${maxAllowed}.`, {\n        type: \"info\",\n        timeout: 2200,\n      });\n    }\n    if (commitManualVisitTotal(bounded)) {\n      setVisitTotalInput(\"\");\n    }\n  }\n\n  const clearCurrentVisit = useCallback(() => {\n    if (pendingVisitRef.current) {\n      pendingVisitRef.current = null;\n      clearPendingVisitTimer();\n      setAwaitingBoardClear(false);\n    }\n    const visitDarts = playerVisitDartsRef.current;\n    const visitTotal = playerVisitSumRef.current;\n    const visitStart = playerVisitStartRef.current;\n    if (visitDarts === 0 && visitTotal === 0) return;\n    setPlayerScore(visitStart);\n    playerScoreRef.current = visitStart;\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitSum(0);\n    playerVisitSumRef.current = 0;\n    setPlayerVisitDartsAtDouble(0);\n    playerVisitDartsAtDoubleRef.current = 0;\n    setPlayerLastDart(0);\n    setPlayerDartPoints(0);\n    setPlayerDartsThrown((d) => Math.max(0, d - visitDarts));\n    setTotalPlayerDarts((d) => Math.max(0, d - visitDarts));\n    setTotalPlayerPoints((p) => Math.max(0, p - visitTotal));\n    lastBounceMissTsRef.current = 0;\n  }, [clearPendingVisitTimer]);\n\n  useEffect(() => {\n    const onClearRequest = (evt: Event) => {\n      const detail = (evt as CustomEvent)?.detail;\n      if (!detail || detail?.source === \"offline-play\") return;\n      clearCurrentVisit();\n    };\n    window.addEventListener(\n      \"ndn:clear-visit-request\",\n      onClearRequest as EventListener,\n    );\n    return () =>\n      window.removeEventListener(\n        \"ndn:clear-visit-request\",\n        onClearRequest as EventListener,\n      );\n  }, [clearCurrentVisit]);\n\n  // --- Double Practice helpers ---\n  function addDpValue(val: number) {\n    recordDart(\"Double Practice\");\n    const dart = clamp(Math.round(val || 0), 0, 60);\n    setPlayerLastDart(dart);\n    setPlayerDartsThrown((d) => d + 1);\n    setTotalPlayerDarts((d) => d + 1);\n    if (isDoubleHit(dart, dpIndex)) {\n      const nextHits = dpHits + 1;\n      setDpHits(nextHits);\n      setDpIndex((i) => Math.min(20, i + 1));\n      // End when DBULL (index 20) is hit\n      if (nextHits >= 21) {\n        setPendingLegWinner(\"player\");\n        setShowWinPopup(true);\n      }\n    }\n    setPlayerDartPoints(0);\n  }\n  function addDpNumeric() {\n    addDpValue(Number(playerDartPoints));\n  }\n  function addDpManual() {\n    const v = parseManualDart(manualBox);\n    if (v == null) {\n      alert(\"Enter like D16, 50, 25, T20\");\n      return;\n    }\n    addDpValue(v);\n    setManualBox(\"\");\n  }\n\n  // Bob's 27\n  function addB27Auto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    if (b27Finished) return;\n    recordDart(\"Bob's 27\");\n    const target = b27Stage;\n    const hit =\n      (ring === \"DOUBLE\" && sector === target) ||\n      (!ring && value === target * 2);\n    if (hit) setB27Hits((h) => h + 1);\n    setB27Darts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        const totalHits = b27Hits + (hit ? 1 : 0);\n        if (totalHits > 0) setB27Score((s) => s + totalHits * target * 2);\n        else setB27Score((s) => s - target * 2);\n        const next = target + 1;\n        setB27Stage(next);\n        setB27Hits(0);\n        if (next > 20) setB27Finished(true);\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addB27Numeric() {\n    addB27Auto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n  function resetB27() {\n    setB27Stage(1);\n    setB27Score(27);\n    setB27Darts(0);\n    setB27Hits(0);\n    setB27Finished(false);\n    resetDartCount(\"Bob's 27\");\n  }\n\n  // Count-Up / High Score / Low Score\n  function addCountUpAuto(value: number) {\n    recordDart(\"Count-Up\");\n    setCuScore((s) => s + Math.max(0, value | 0));\n    setCuDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setCuRound((r) => r + 1);\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addHighScoreAuto(value: number) {\n    recordDart(\"High Score\");\n    setHsScore((s) => s + Math.max(0, value | 0));\n    setHsDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setHsRound((r) => r + 1);\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addLowScoreAuto(value: number) {\n    recordDart(\"Low Score\");\n    setLsScore((s) => s + Math.max(0, value | 0));\n    setLsDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setLsRound((r) => r + 1);\n        return 0;\n      }\n      return nd;\n    });\n  }\n\n  // Checkout routines (double out)\n  function applyCheckout(\n    rem: number,\n    setRem: (n: number) => void,\n    darts: number,\n    setDarts: (f: (n: number) => number) => void,\n    setAttempts: (f: (n: number) => number) => void,\n    setSuccesses: (f: (n: number) => number) => void,\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  ) {\n    const next = rem - value;\n    if (next < 0) {\n      // bust: ignore progress during attempt\n    } else if (next === 0) {\n      if (ring === \"DOUBLE\" || ring === \"INNER_BULL\") {\n        setSuccesses((s) => s + 1);\n        setAttempts((a) => a + 1);\n        setDarts(() => 0);\n        setRem(rem); // caller will reset to initial value right after\n        return;\n      }\n      setRem(next);\n    } else {\n      setRem(next);\n    }\n    setDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setAttempts((a) => a + 1);\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addCo170Auto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  ) {\n    recordDart(\"Checkout 170\");\n    applyCheckout(\n      co170Rem,\n      setCo170Rem,\n      co170Darts,\n      setCo170Darts,\n      setCo170Attempts,\n      setCo170Successes,\n      value,\n      ring,\n    );\n    if (co170Darts + 1 >= 3) setCo170Rem(170);\n  }\n  function addCo121Auto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  ) {\n    recordDart(\"Checkout 121\");\n    applyCheckout(\n      co121Rem,\n      setCo121Rem,\n      co121Darts,\n      setCo121Darts,\n      setCo121Attempts,\n      setCo121Successes,\n      value,\n      ring,\n    );\n    if (co121Darts + 1 >= 3) setCo121Rem(121);\n  }\n  function addCoManual(is170: boolean) {\n    const v = parseManualDart(manualBox);\n    if (v == null) {\n      alert(\"Enter like T20, D16, 25, 50\");\n      return;\n    }\n    const t = manualBox.trim().toUpperCase();\n    const isDouble =\n      t.startsWith(\"D\") ||\n      t === \"50\" ||\n      t === \"BULL\" ||\n      t === \"DBULL\" ||\n      t === \"IBULL\" ||\n      t.includes(\"INNER\");\n    if (is170) addCo170Auto(v, isDouble ? \"DOUBLE\" : undefined);\n    else addCo121Auto(v, isDouble ? \"DOUBLE\" : undefined);\n    setManualBox(\"\");\n  }\n  function resetCo170() {\n    setCo170Rem(170);\n    setCo170Darts(0);\n    setCo170Attempts(0);\n    setCo170Successes(0);\n    resetDartCount(\"Checkout 170\");\n  }\n  function resetCo121() {\n    setCo121Rem(121);\n    setCo121Darts(0);\n    setCo121Attempts(0);\n    setCo121Successes(0);\n    resetDartCount(\"Checkout 121\");\n  }\n\n  // Treble practice\n  function addTrebleAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    if (trebleFinished) return;\n    recordDart(\"Treble Practice\");\n    const isHit =\n      (ring === \"TRIPLE\" && sector === trebleTarget) ||\n      (!ring && value === trebleTarget * 3);\n    if (isHit) setTrebleHits((h) => h + 1);\n    setTrebleDarts((d) => {\n      const nd = d + 1;\n      // Auto-rotate target every 3 darts among T20â†’T19â†’T18\n      if (nd % 3 === 0 && [20, 19, 18].includes(trebleTarget)) {\n        const cycle = [20, 19, 18];\n        const idx = cycle.indexOf(trebleTarget);\n        const next = cycle[(idx + 1) % cycle.length];\n        setTrebleTarget(next);\n      }\n      // End session at configured throws\n      if (trebleMaxDarts > 0 && nd >= trebleMaxDarts) setTrebleFinished(true);\n      return nd;\n    });\n  }\n  function resetTreble() {\n    setTrebleHits(0);\n    setTrebleDarts(0);\n    setTrebleFinished(false);\n    resetDartCount(\"Treble Practice\");\n  }\n\n  // Baseball\n  function addBaseballAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Baseball\");\n    setBaseball((prev) => {\n      const cp = { ...prev };\n      applyBaseballDart(cp as any, value, ring as any, sector);\n      return cp;\n    });\n  }\n  function resetBaseball() {\n    setBaseball(createBaseball());\n    resetDartCount(\"Baseball\");\n  }\n\n  // Golf\n  function addGolfAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Golf\");\n    setGolf((prev) => {\n      const cp = { ...prev };\n      applyGolfDart(cp as any, value, ring as any, sector);\n      return cp;\n    });\n  }\n  function resetGolf() {\n    setGolf(createGolf());\n    resetDartCount(\"Golf\");\n  }\n\n  // Tic Tac Toe\n  function addTttAuto(\n    cell: number,\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Tic Tac Toe\");\n    setTTT((prev) => {\n      const cp = { ...prev, board: [...prev.board] as any };\n      tryClaimCell(cp as any, cell as any, value, ring as any, sector);\n      return cp;\n    });\n  }\n  function resetTtt() {\n    setTTT(createTicTacToe());\n    resetDartCount(\"Tic Tac Toe\");\n  }\n\n  // American Cricket\n  function addAmCricketAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"American Cricket\");\n    setAmCricket((prev) => {\n      const cp = { ...prev, marks: { ...prev.marks } };\n      applyAmCricketDart(cp as any, value, ring as any, sector, () => false);\n      return cp;\n    });\n  }\n  function resetAmCricket() {\n    setAmCricket(createAmCricketState());\n    resetDartCount(\"American Cricket\");\n  }\n\n  // --- Around the Clock helpers ---\n  function addAtcValue(\n    val: number,\n    ring?: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Around the Clock\");\n    const target = ATC_ORDER[atcIndex];\n    let hit = false;\n    if (\n      typeof sector === \"number\" &&\n      sector === target &&\n      (ring === \"SINGLE\" || ring === \"DOUBLE\" || ring === \"TRIPLE\")\n    )\n      hit = true;\n    if (target === 25 && (ring === \"BULL\" || val === 25)) hit = true;\n    if (target === 50 && (ring === \"INNER_BULL\" || val === 50)) hit = true;\n    if (!hit) {\n      // Fallback by value only\n      if (val === target || val === target * 2 || val === target * 3)\n        hit = true;\n    }\n    if (hit) {\n      const newHits = atcHits + 1;\n      setAtcHits(newHits);\n      setAtcIndex((i) => i + 1);\n    }\n  }\n  function addAtcNumeric() {\n    addAtcValue(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n  function addAtcManual() {\n    const v = parseManualDart(manualBox);\n    if (v == null) {\n      alert(\"Enter like T20, D5, 25, 50\");\n      return;\n    }\n    addAtcValue(v);\n    setManualBox(\"\");\n  }\n\n  // --- Cricket helpers (solo practice) ---\n  function addCricketAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Cricket\");\n    setCricket((prev) => {\n      const copy = { ...prev, marks: { ...prev.marks } };\n      applyCricketDart(copy as any, value, ring, sector, () => false);\n      return copy;\n    });\n    setPracticeTurnDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) return 0;\n      return nd;\n    });\n  }\n  function addCricketNumeric() {\n    addCricketAuto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n\n  // --- Shanghai helpers ---\n  function addShanghaiAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Shanghai\");\n    setShanghai((prev) => {\n      const copy = { ...prev, turnHits: { ...prev.turnHits } };\n      applyShanghaiDart(copy as any, value, ring, sector);\n      return copy;\n    });\n    setPracticeTurnDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setShanghai((prev) => {\n          const cp = { ...prev, turnHits: { ...prev.turnHits } };\n          endShanghaiTurn(cp as any);\n          return cp;\n        });\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addShanghaiNumeric() {\n    addShanghaiAuto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n\n  // --- Halve It helpers ---\n  function addHalveAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Halve It\");\n    setHalve((prev) => {\n      const copy = { ...prev, targets: [...prev.targets] };\n      applyHalveItDart(copy as any, value, ring, sector);\n      return copy;\n    });\n    setPracticeTurnDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setHalve((prev) => {\n          const cp = { ...prev, targets: [...prev.targets] };\n          endHalveItTurn(cp as any);\n          return cp;\n        });\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addHalveNumeric() {\n    addHalveAuto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n\n  // --- High-Low helpers ---\n  function addHighLowAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"High-Low\");\n    setHighlow((prev) => {\n      const copy = { ...prev };\n      applyHighLowDart(copy as any, value, ring, sector);\n      return copy;\n    });\n    setPracticeTurnDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setHighlow((prev) => {\n          const cp = { ...prev };\n          endHighLowTurn(cp as any);\n          return cp;\n        });\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addHighLowNumeric() {\n    addHighLowAuto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n\n  function parseManualBox(): number | null {\n    const t = manualBox.trim().toUpperCase();\n    if (!t) return null;\n    if (t === \"50\" || t === \"BULL\" || t === \"DBULL\" || t === \"IBULL\") return 50;\n    if (t === \"25\" || t === \"OBULL\") return 25;\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\n    if (!m) return null;\n    const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\n    const num = parseInt(m[2], 10);\n    if (num < 1 || num > 20) return null;\n    const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\n    return num * multVal;\n  }\n\n  function addManual() {\n    const val = parseManualBox();\n    if (val == null) {\n      alert(\"Enter like T20, D16, 5, 25, 50\");\n      return;\n    }\n    applyDartValue(val);\n    setManualBox(\"\");\n  }\n\n  function addManualTextarea() {\n    const lines = manualTextarea\n      .trim()\n      .split(\"\\n\")\n      .map((l) => l.trim())\n      .filter((l) => l);\n    if (lines.length === 0) return;\n    for (const line of lines) {\n      const val = parseManualDart(line);\n      if (val == null) {\n        alert(`Invalid score: ${line}`);\n        return;\n      }\n      applyDartValue(val);\n    }\n    setManualTextarea(\"\");\n  }\n\n  function replaceLast() {\n    if (playerVisitDarts === 0) return;\n    // Rewind one dart: approximate by adding back last dart into score\n    setPlayerScore((s) => s + playerLastDart);\n    setPlayerVisitDarts((d) => Math.max(0, d - 1));\n  }\n\n  function replaceLastManual() {\n    const val = parseManualBox();\n    if (val == null) {\n      alert(\"Enter like T20, D16, 5, 25, 50\");\n      return;\n    }\n    if (playerVisitDarts === 0) {\n      addManual();\n      return;\n    }\n    // Rewind last then apply\n    const rewind = playerLastDart;\n    setPlayerScore((s) => s + rewind);\n    setPlayerVisitDarts((d) => Math.max(0, d - 1));\n    // Apply new value in next microtask to ensure state has updated\n    setTimeout(() => applyDartValue(val), 0);\n    setManualBox(\"\");\n  }\n\n  function playerThrow(points: number) {\n    const newScore = playerScore - points;\n    if (newScore < 0) {\n      setPlayerScore(playerScore); // bust\n      return;\n    }\n    setPlayerScore(newScore);\n    if (newScore === 0) {\n      setPendingLegWinner(\"player\");\n      setShowWinPopup(true);\n    }\n    setOnDouble(newScore <= 40 && newScore % 2 === 0);\n  }\n\n  function aiTurn() {\n    // This is now automated inside the modal turn loop\n  }\n\n  function handleBust() {\n    setPlayerScore(playerScore); // bust, score unchanged\n    setOnDouble(false);\n  }\n\n  function handleWinPopupSubmit() {\n    const winner = pendingLegWinner ?? \"player\";\n    // Approximate per-leg doubles attempts: if winner is player and they finished from <=50, attempts were counted in playerVisitDartsAtDouble; otherwise leave undefined\n    const legDoublesAtt =\n      winner === \"player\"\n        ? playerVisitDartsAtDouble || undefined\n        : aiVisitDartsAtDouble || undefined;\n    const legDoublesHit = 1;\n    const winnerDarts = winner === \"player\" ? playerDartsThrown : aiDartsThrown;\n    setLegStats([\n      ...legStats,\n      {\n        winner,\n        doubleDarts,\n        checkoutDarts,\n        winnerDarts,\n        doublesAtt: legDoublesAtt,\n        doublesHit: legDoublesHit,\n      },\n    ]);\n    setShowWinPopup(false);\n    // Increment legs for the winner\n    let p = playerLegs;\n    let a = aiLegs;\n    if (pendingLegWinner === \"player\") p += 1;\n    else if (pendingLegWinner === \"ai\") a += 1;\n    setPlayerLegs(p);\n    setAiLegs(a);\n    setPendingLegWinner(null);\n    // Check if match is over\n    if (p >= firstTo || a >= firstTo) {\n      // End of match: close modal back to menu state\n      // Record per-game-mode result (local-only demo)\n      try {\n        bumpGameMode(selectedMode, winner === \"player\");\n      } catch {}\n      setShowMatchModal(false);\n      setInMatch(false);\n      // Reset leg-specific stats for next match but keep the summary list visible\n      setPlayerScore(x01Score);\n      setAiScore(x01Score);\n      setShowMatchSummary(true);\n      return;\n    }\n    // Otherwise, start the next leg immediately\n    startNextLeg();\n  }\n\n  const isFreeSelected = freeGames.includes(selectedMode as any);\n  const lockedPremium = !isFreeSelected && !(user?.fullAccess || user?.admin);\n\n  // no external overlay: we render the match modal as absolute inset-0 inside this card\n\n  return (\n    <div className=\"card ndn-game-shell relative overflow-hidden\">\n      {showStartShowcase && (\n        <MatchStartShowcase\n          players={(match.players || []) as any}\n          onDone={() => setShowStartShowcase(false)}\n        />\n      )}\n      <h2 className=\"text-3xl font-bold text-brand-700 mb-4\">\n        Offline Mode{\" \"}\n        {offlineLayout === \"classic\" ? (\n          <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle\">\n            Classic layout\n          </span>\n        ) : (\n          <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle\">\n            Modern layout\n          </span>\n        )}\n      </h2>\n      <div className=\"ndn-shell-body\">\n        <div className=\"mb-4 flex flex-col gap-3\">\n          <select\n            className=\"input w-full\"\n            value={selectedMode}\n            onChange={(e) => setSelectedMode(e.target.value)}\n          >\n            {freeGames.map((mode) => (\n              <option key={mode} value={mode}>\n                {mode}\n              </option>\n            ))}\n            {premiumGames.map((mode) => (\n              <option\n                key={mode}\n                value={mode}\n                disabled={!(user?.fullAccess || user?.admin)}\n              >\n                {mode} {user?.fullAccess || user?.admin ? \"\" : \"(Premium)\"}\n              </option>\n            ))}\n          </select>\n\n          {/* Calibration Status - displayed below game mode selector */}\n          <GameCalibrationStatus gameMode={selectedMode} compact={true} />\n\n          {selectedMode === \"Treble Practice\" && (\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end\">\n              <div className=\"sm:col-span-1\">\n                <label className=\"font-semibold\">Throws per game</label>\n                <input\n                  className=\"input w-full\"\n                  type=\"number\"\n                  min={3}\n                  step={3}\n                  value={trebleMaxDarts}\n                  onChange={(e) =>\n                    setTrebleMaxDarts(\n                      Math.max(3, Math.floor(Number(e.target.value) || 30)),\n                    )\n                  }\n                />\n              </div>\n              <div className=\"sm:col-span-2 text-xs text-slate-300\">\n                Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the\n                selected number of throws.\n              </div>\n            </div>\n          )}\n          {!user?.fullAccess && (\n            <div className=\"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2\">\n              <span>ðŸ”’</span>\n              <span>\n                Only X01 and Double Practice are free. Advanced modes (Killer,\n                Cricket, Shanghai, etc.) require PREMIUM.\n              </span>\n            </div>\n          )}\n          {selectedMode === \"X01\" && (\n            <>\n              <label className=\"font-semibold mt-2\">\n                Enter starting score (1-1001):\n              </label>\n              <input\n                className=\"input w-full\"\n                type=\"number\"\n                min={1}\n                max={1001}\n                value={x01Score}\n                onChange={(e) => setX01Score(Number(e.target.value))}\n              />\n              <label className=\"font-semibold mt-2\">Play against AI bot?</label>\n              <select\n                className=\"input w-full\"\n                value={ai}\n                onChange={(e) => setAI(e.target.value)}\n              >\n                <option value=\"None\">None</option>\n                {aiLevels.map((level) => (\n                  <option key={level} value={level}>\n                    {level}\n                  </option>\n                ))}\n              </select>\n              {ai !== \"None\" && (\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2\">\n                  <div className=\"sm:col-span-2\">\n                    <label className=\"font-semibold\">\n                      AI throw delay (seconds)\n                    </label>\n                    <input\n                      className=\"input w-full\"\n                      type=\"number\"\n                      min={0.5}\n                      max={10}\n                      step={0.5}\n                      value={aiDelayMs / 1000}\n                      onChange={(e) =>\n                        setAiDelayMs(Math.round(Number(e.target.value) * 1000))\n                      }\n                    />\n                  </div>\n                  <div className=\"text-sm text-slate-300\">\n                    Controls how long the AI waits before its visit.\n                  </div>\n                </div>\n              )}\n              <button className=\"btn mt-2\" onClick={() => setShowRules(true)}>\n                X01 Rules & Regulations!\n              </button>\n            </>\n          )}\n          {selectedMode === \"Double Practice\" && (\n            <div className=\"mt-2 text-brand-600\">\n              Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and\n              X01 settings donâ€™t apply.\n            </div>\n          )}\n        </div>\n        {!inMatch && (\n          <button\n            className=\"btn\"\n            disabled={lockedPremium}\n            title={lockedPremium ? \"PREMIUM required for this mode\" : \"\"}\n            onClick={startMatch}\n          >\n            Start Match\n          </button>\n        )}\n        {/* Match Modal with turn-by-turn flow */}\n        {showMatchModal && (\n          <div\n            className={`absolute inset-0 z-[1000] ${maximized ? \"\" : \"flex items-center justify-center p-3 sm:p-4\"}`}\n          >\n            <ResizableModal\n              storageKey=\"ndn:modal:offline-match\"\n              className={`${maximized ? \"w-full h-full ndn-modal-tight\" : \"\"} relative flex flex-col overflow-hidden`}\n              fullScreen={maximized}\n              defaultWidth={1100}\n              defaultHeight={720}\n              minWidth={720}\n              minHeight={480}\n              maxWidth={1600}\n              maxHeight={1200}\n              initialFitHeight\n            >\n              {/* Header bar with visible mode and actions; sheen is clipped to this area */}\n              <div\n                className=\"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2\"\n                style={{ overflowY: \"scroll\" }}\n                ref={(el) => {\n                  (scrollerRef as any).current = el;\n                }}\n              >\n                <div\n                  ref={(el) => {\n                    (headerBarRef as any).current = el;\n                  }}\n                >\n                  <GameHeaderBar\n                    left={\n                      <>\n                        <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">\n                          Game Mode\n                        </span>\n                        <span className=\"font-medium whitespace-nowrap\">\n                          {selectedMode}\n                          {selectedMode === \"X01\" ? ` / ${x01Score}` : \"\"}\n                        </span>\n                        <span className=\"opacity-80 whitespace-nowrap\">\n                          First to {firstTo} Â· Legs {playerLegs}-{aiLegs}\n                        </span>\n                        <span\n                          className={`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${offlineLayout === \"modern\" ? \"bg-emerald-500/15 text-emerald-200 border-emerald-400/30\" : \"bg-white/10 text-white/70 border-white/20\"}`}\n                        >\n                          {offlineLayout === \"modern\"\n                            ? \"Modern layout\"\n                            : \"Classic layout\"}\n                        </span>\n                      </>\n                    }\n                    right={\n                      <>\n                        {/* Camera scale controls (match Online UI) */}\n                        <div className=\"hidden items-center gap-2 mr-2 text-xs\">\n                          <span className=\"opacity-80\">Cam</span>\n                          <button\n                            className=\"btn btn--ghost px-2 py-1\"\n                            onClick={() =>\n                              setCameraScale(\n                                Math.max(\n                                  0.5,\n                                  Math.round((cameraScale - 0.05) * 100) / 100,\n                                ),\n                              )\n                            }\n                            title=\"Decrease camera size\"\n                          >\n                            âˆ’\n                          </button>\n                          <span className=\"w-9 text-center\">\n                            {Math.round(cameraScale * 100)}%\n                          </span>\n                          <button\n                            className=\"btn btn--ghost px-2 py-1\"\n                            onClick={() =>\n                              setCameraScale(\n                                Math.min(\n                                  1.25,\n                                  Math.round((cameraScale + 0.05) * 100) / 100,\n                                ),\n                              )\n                            }\n                            title=\"Increase camera size\"\n                          >\n                            +\n                          </button>\n                        </div>\n                        <button\n                          className=\"btn btn--ghost px-3 py-1 text-sm\"\n                          title={fitAll ? \"Actual Size\" : \"Fit All\"}\n                          onClick={() => setFitAll((v) => !v)}\n                        >\n                          {fitAll ? \"Actual Size\" : \"Fit All\"}\n                        </button>\n                        <button\n                          className=\"btn btn--ghost px-3 py-1 text-sm\"\n                          title={maximized ? \"Restore\" : \"Maximize\"}\n                          onClick={() => setMaximized((m) => !m)}\n                        >\n                          {maximized ? \"Restore\" : \"Maximize\"}\n                        </button>\n                        <button\n                          className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                          onClick={() => {\n                            startMatch();\n                          }}\n                        >\n                          Restart\n                        </button>\n                        <button\n                          className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\n                          onClick={() => {\n                            setShowMatchModal(false);\n                            setInMatch(false);\n                          }}\n                        >\n                          Quit\n                        </button>\n                      </>\n                    }\n                  />\n                </div>\n                <div\n                  ref={(el) => {\n                    (contentRef as any).current = el;\n                  }}\n                  className=\"will-change-transform\"\n                  style={\n                    fitAll\n                      ? {\n                          transform: `scale(${fitScale})`,\n                          transformOrigin: \"top left\",\n                          width: \"100%\",\n                          fontSize: `${Math.max(0.8, Math.min(1, fitScale))}em`,\n                        }\n                      : undefined\n                  }\n                >\n                  <h3 className=\"text-xl font-bold mb-2 mt-1 leading-tight\">\n                    {selectedMode === \"X01\" ? \"X01 Match\" : selectedMode}\n                  </h3>\n                  <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                      Mode: {selectedMode}\n                    </span>\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                      Start: {x01Score}\n                    </span>\n                    <div\n                      ref={formatRef}\n                      className=\"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10\"\n                    >\n                      <span>Format:</span>\n                      {(() => {\n                        const disabled =\n                          playerScore !== x01Score ||\n                          aiScore !== x01Score ||\n                          playerVisitDarts > 0;\n                        const pillCls = `px-2 py-0.5 rounded border text-xs ${disabled ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer\"} `;\n                        return (\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"flex items-center gap-1\">\n                              <button\n                                type=\"button\"\n                                className={`${pillCls} ${formatType === \"first\" ? \"bg-indigo-500/20 text-indigo-100 border-indigo-400/30\" : \"bg-white/10 text-white/80 border-white/20\"}`}\n                                onClick={() => {\n                                  if (!disabled) setFormatType(\"first\");\n                                }}\n                                title=\"First to N\"\n                              >\n                                First to\n                              </button>\n                              <button\n                                type=\"button\"\n                                className={`${pillCls} ${formatType === \"best\" ? \"bg-indigo-500/20 text-indigo-100 border-indigo-400/30\" : \"bg-white/10 text-white/80 border-white/20\"}`}\n                                onClick={() => {\n                                  if (!disabled) setFormatType(\"best\");\n                                }}\n                                title=\"Best of N (wins = ceil(N/2)\"\n                              >\n                                Best of\n                              </button>\n                            </div>\n                            <input\n                              className={`input w-16 text-center ${disabled ? \"opacity-50\" : \"\"}`}\n                              type=\"number\"\n                              min={1}\n                              step={1}\n                              value={formatCount}\n                              onChange={(e) =>\n                                setFormatCount(\n                                  Math.max(\n                                    1,\n                                    Math.floor(Number(e.target.value) || 1),\n                                  ),\n                                )\n                              }\n                              disabled={disabled}\n                              title={\n                                formatType === \"first\"\n                                  ? \"First to N\"\n                                  : \"Best of N (wins = ceil(N/2))\"\n                              }\n                            />\n                          </div>\n                        );\n                      })()}\n                    </div>\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                      Legs: {playerLegs}â€“{aiLegs}\n                    </span>\n                    {/* Move match type and team names to the right of Legs for a single-row header */}\n                    <div className=\"ml-auto flex items-center gap-1 text-[10px] flex-wrap\">\n                      <span className=\"opacity-70\">Match</span>\n                      <select\n                        className={`btn ${buttonSizeClass}`}\n                        value={matchType}\n                        onChange={(e) =>\n                          setMatchType(e.target.value as \"singles\" | \"doubles\")\n                        }\n                      >\n                        <option value=\"singles\">Singles</option>\n                        <option value=\"doubles\">Doubles</option>\n                      </select>\n                      <input\n                        className={`input ${buttonSizeClass} w-[7.5rem]`}\n                        value={teamAName}\n                        onChange={(e) => setTeamAName(e.target.value)}\n                        placeholder=\"Team A\"\n                      />\n                      <span className=\"opacity-50\">vs</span>\n                      <input\n                        className={`input ${buttonSizeClass} w-[7.5rem]`}\n                        value={teamBName}\n                        onChange={(e) => setTeamBName(e.target.value)}\n                        placeholder=\"Team B\"\n                      />\n                    </div>\n                  </div>\n                  {selectedMode !== \"X01\" ? (\n                    <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2\">\n                      {selectedMode === \"Double Practice\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span className=\"opacity-80\">Current Target</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                              {DOUBLE_PRACTICE_ORDER[dpIndex]?.label || \"â€”\"}\n                            </span>\n                          </div>\n                          {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\n                        </>\n                      )}\n                      {selectedMode === \"Around the Clock\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span className=\"opacity-80\">Current Target</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                              {ATC_ORDER[atcIndex] === 25\n                                ? \"25 (Outer Bull)\"\n                                : ATC_ORDER[atcIndex] === 50\n                                  ? \"50 (Inner Bull)\"\n                                  : ATC_ORDER[atcIndex] || \"â€”\"}\n                            </span>\n                          </div>\n                          {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\n                        </>\n                      )}\n                      {selectedMode === \"Cricket\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 mb-1\">\n                            Cricket â€” Close 20â€“15 and Bull; overflow scores\n                            points\n                          </div>\n                          <div className=\"grid grid-cols-7 gap-1 text-center text-[11px] mb-2\">\n                            {CRICKET_NUMBERS.map((n) => (\n                              <div\n                                key={n}\n                                className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\"\n                              >\n                                <div className=\"opacity-70\">\n                                  {n === 25 ? \"Bull\" : n}\n                                </div>\n                                <div className=\"font-semibold\">\n                                  {Math.min(3, cricket.marks?.[n] || 0)} / 3\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                          <div className=\"text-sm\">\n                            Points:{\" \"}\n                            <span className=\"font-semibold\">\n                              {cricket.points}\n                            </span>\n                          </div>\n                          {cricketClosedAll(cricket) && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setCricket(createCricketState());\n                                  setPracticeTurnDarts(0);\n                                  resetDartCount(\"Cricket\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Shanghai\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span>Round</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">\n                              {shanghai.round}\n                            </span>\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {shanghai.score}\n                          </div>\n                          {shanghai.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setShanghai(createShanghaiState());\n                                  setPracticeTurnDarts(0);\n                                  resetDartCount(\"Shanghai\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Halve It\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span>Stage</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">\n                              {halve.stage + 1}/{halve.targets.length}\n                            </span>\n                          </div>\n                          <div className=\"text-sm\">\n                            Target:{\" \"}\n                            <span className=\"font-semibold\">\n                              {(() => {\n                                const t = getCurrentHalveTarget(halve);\n                                if (!t) return \"â€”\";\n                                if (t.kind === \"ANY_NUMBER\") return \"Any\";\n                                if (t.kind === \"BULL\") return \"Bull\";\n                                if (\n                                  t.kind === \"DOUBLE\" ||\n                                  t.kind === \"TRIPLE\" ||\n                                  t.kind === \"NUMBER\"\n                                )\n                                  return `${t.kind} ${(t as any).num}`;\n                                return \"â€”\";\n                              })()}\n                            </span>\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {halve.score}\n                          </div>\n                          {halve.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setHalve(createDefaultHalveIt());\n                                  setPracticeTurnDarts(0);\n                                  resetDartCount(\"Halve It\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"High-Low\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Round {highlow.round} Â· Target {highlow.target}\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {highlow.score}\n                          </div>\n                          {highlow.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setHighlow(createHighLow());\n                                  setPracticeTurnDarts(0);\n                                  resetDartCount(\"High-Low\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Bob's 27\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span>Target</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold\">\n                              D{b27Stage}\n                            </span>\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {b27Score}\n                          </div>\n                          {b27Finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={resetB27}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Count-Up\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Round {cuRound}/8\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {cuScore}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"High Score\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Round {hsRound}/10\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {hsScore}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Low Score\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Round {lsRound}/10\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {lsScore}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Checkout 170\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Remaining\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {co170Rem}\n                          </div>\n                          <div className=\"text-xs text-slate-400 mt-1\">\n                            Attempts: {co170Attempts} Â· Successes:{\" \"}\n                            {co170Successes}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Checkout 121\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Remaining\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {co121Rem}\n                          </div>\n                          <div className=\"text-xs text-slate-400 mt-1\">\n                            Attempts: {co121Attempts} Â· Successes:{\" \"}\n                            {co121Successes}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Treble Practice\" && (\n                        <>\n                          <div className=\"flex items-center justify-between gap-4\">\n                            <div>\n                              <div className=\"text-xs text-slate-600\">\n                                Treble Target: T{trebleTarget}\n                              </div>\n                              <div className=\"text-3xl font-extrabold tracking-tight\">\n                                Hits: {trebleHits}\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-2 flex-wrap\">\n                              <label className=\"text-sm\">Target</label>\n                              <div className=\"inline-flex items-center gap-1\">\n                                {[20, 19, 18].map((n) => (\n                                  <button\n                                    key={`tpick-header-${n}`}\n                                    className={`btn px-2 py-0.5 text-xs ${trebleTarget === n ? \"bg-emerald-600/30 border border-emerald-400/30\" : \"\"}`}\n                                    onClick={() => setTrebleTarget(n)}\n                                  >\n                                    T{n}\n                                  </button>\n                                ))}\n                              </div>\n                              <span className=\"opacity-60 text-xs\">or</span>\n                              <select\n                                className=\"input w-24\"\n                                value={trebleTarget}\n                                onChange={(e) =>\n                                  setTrebleTarget(parseInt(e.target.value, 10))\n                                }\n                              >\n                                {Array.from(\n                                  { length: 20 },\n                                  (_, i) => i + 1,\n                                ).map((n) => (\n                                  <option key={n} value={n}>\n                                    {n}\n                                  </option>\n                                ))}\n                              </select>\n                              <button\n                                className=\"btn px-3 py-1 text-sm\"\n                                onClick={resetTreble}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Baseball\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Inning</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {baseball.inning}\n                          </div>\n                          <div className=\"text-sm\">\n                            Score:{\" \"}\n                            <span className=\"font-semibold\">\n                              {baseball.score}\n                            </span>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Golf\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Hole</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {golf.hole}\n                          </div>\n                          <div className=\"text-sm\">\n                            Strokes:{\" \"}\n                            <span className=\"font-semibold\">\n                              {golf.strokes}\n                            </span>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Tic Tac Toe\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Turn</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {ttt.turn}\n                          </div>\n                          {ttt.finished && (\n                            <div className=\"mt-1 text-xs\">\n                              Winner: {ttt.winner || \"â€”\"}\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Scam\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Target</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {SCAM_TARGET_NAMES[scam.targetIndex]}\n                          </div>\n                          <div className=\"text-sm\">\n                            Progress:{\" \"}\n                            <span className=\"font-semibold\">\n                              {scam.targetIndex + 1}/{SCAM_TARGET_NAMES.length}\n                            </span>\n                          </div>\n                          {scam.finished && (\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\n                              ðŸŽ‰ Finished in {scam.darts} darts!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Fives\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Score</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {fives.score}/{fives.target}\n                          </div>\n                          <div className=\"text-sm\">\n                            Darts:{\" \"}\n                            <span className=\"font-semibold\">{fives.darts}</span>\n                          </div>\n                          {fives.finished && (\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\n                              âœ“ Reached {fives.target}!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Sevens\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Score</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {sevens.score}/{sevens.target}\n                          </div>\n                          <div className=\"text-sm\">\n                            Darts:{\" \"}\n                            <span className=\"font-semibold\">\n                              {sevens.darts}\n                            </span>\n                          </div>\n                          {sevens.finished && (\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\n                              âœ“ Reached {sevens.target}!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"American Cricket\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 mb-1\">\n                            Close 20â€“12 and Bull; overflow scores points\n                          </div>\n                          <div className=\"grid grid-cols-10 gap-1 text-center text-[11px] mb-2\">\n                            {AM_CRICKET_NUMBERS.map((n) => (\n                              <div\n                                key={n}\n                                className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\"\n                              >\n                                <div className=\"opacity-70\">\n                                  {n === 25 ? \"Bull\" : n}\n                                </div>\n                                <div className=\"font-semibold\">\n                                  {Math.min(3, amCricket.marks?.[n] || 0)} / 3\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                          <div className=\"text-sm\">\n                            Points:{\" \"}\n                            <span className=\"font-semibold\">\n                              {amCricket.points}\n                            </span>\n                          </div>\n                          {hasClosedAllAm(amCricket) && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={resetAmCricket}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Killer\" && (\n                        <>\n                          {!killerSetupDone ? (\n                            <div className=\"text-xs text-slate-600\">\n                              Setup players and assign numbers\n                            </div>\n                          ) : (\n                            <>\n                              <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                                <span>Turn</span>\n                                <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                                  {killerPlayers[killerTurnIdx]?.name || \"â€”\"}\n                                </span>\n                              </div>\n                              <div className=\"text-3xl font-extrabold tracking-tight\">\n                                {killerWinnerId\n                                  ? `${killerPlayers.find((p) => p.id === killerWinnerId)?.name || \"Winner\"} Wins`\n                                  : killerLastEvent || \"Ready\"}\n                              </div>\n                            </>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  ) : offlineLayout === \"modern\" ? (\n                    <div className=\"space-y-3 mb-2\">\n                      {!manualScoring ? (\n                        <>\n                          <div className=\"flex items-center flex-wrap gap-1.5 mt-1\">\n                            <div className=\"ml-auto flex items-center gap-1 text-[10px]\">\n                              <span className=\"opacity-70\">Cam</span>\n                              <button\n                                className={`btn ${buttonSizeClass}`}\n                                onClick={() =>\n                                  setCameraScale(\n                                    Math.max(\n                                      0.5,\n                                      Math.round((cameraScale - 0.05) * 100) /\n                                        100,\n                                    ),\n                                  )\n                                }\n                              >\n                                âˆ’\n                              </button>\n                              <span\n                                className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}\n                              >\n                                {Math.round(cameraScale * 100)}%\n                              </span>\n                              <button\n                                className={`btn ${buttonSizeClass}`}\n                                onClick={() =>\n                                  setCameraScale(\n                                    Math.min(\n                                      1.25,\n                                      Math.round((cameraScale + 0.05) * 100) /\n                                        100,\n                                    ),\n                                  )\n                                }\n                              >\n                                +\n                              </button>\n                              <span className=\"opacity-50\">|</span>\n                              <button\n                                className={`btn ${buttonSizeClass}`}\n                                title=\"Toggle fit/fill\"\n                                onClick={() =>\n                                  setCameraFitMode(\n                                    cameraFitMode === \"fill\" ? \"fit\" : \"fill\",\n                                  )\n                                }\n                              >\n                                {cameraFitMode === \"fill\" ? \"Fill\" : \"Fit\"}\n                              </button>\n                              <span className=\"opacity-50\">|</span>\n                              <button\n                                className={`btn ${buttonSizeClass}`}\n                                title=\"Toggle camera aspect\"\n                                onClick={() =>\n                                  setCameraAspect(\n                                    cameraAspect === \"square\"\n                                      ? \"wide\"\n                                      : \"square\",\n                                  )\n                                }\n                              >\n                                {cameraAspect === \"square\" ? \"Square\" : \"Wide\"}\n                              </button>\n                            </div>\n                          </div>\n                          <div className=\"relative\">\n                            <div className=\"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6\">\n                              <div className=\"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]\">\n                                <CameraView\n                                  scoringMode=\"x01\"\n                                  showToolbar={cameraToolbarVisible}\n                                  immediateAutoCommit\n                                  onAutoDart={(value, ring, info) => {\n                                    applyDartValue(value);\n                                  }}\n                                />\n                              </div>\n\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4\">\n                                  <div className=\"space-y-4\">\n                                    <div className=\"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\n                                      <div className=\"text-xs uppercase tracking-wide text-white/50\">\n                                        Current Shooter\n                                      </div>\n                                      <div className=\"mt-1 text-xl font-semibold text-white\">\n                                        {activePlayerName}\n                                      </div>\n                                      <div className=\"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80\">\n                                        <div>\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\n                                            Remaining\n                                          </div>\n                                          <div className=\"font-mono text-lg text-white\">\n                                            {activeRemaining}\n                                          </div>\n                                        </div>\n                                        <div>\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\n                                            Last Dart\n                                          </div>\n                                          <div className=\"font-mono text-lg text-white\">\n                                            {activeLastScore || 0}\n                                          </div>\n                                        </div>\n                                        <div>\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\n                                            Match Legs\n                                          </div>\n                                          <div className=\"font-semibold text-white\">\n                                            {playerLegs}-{aiLegs}\n                                          </div>\n                                        </div>\n                                        <div>\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\n                                            Next Up\n                                          </div>\n                                          <div className=\"font-medium text-white\">\n                                            {inactivePlayerName}\n                                          </div>\n                                        </div>\n                                      </div>\n                                    </div>\n                                  </div>\n\n                                  <div className=\"hidden md:block\">\n                                    <GameScoreboard\n                                      gameMode={selectedMode as any}\n                                      players={singlePlayerScoreboard}\n                                      matchScore={`${playerLegs}-${aiLegs}`}\n                                    />\n                                  </div>\n                                </div>\n\n                                <div className=\"md:hidden\">\n                                  <GameScoreboard\n                                    gameMode={selectedMode as any}\n                                    players={singlePlayerScoreboard}\n                                    matchScore={`${playerLegs}-${aiLegs}`}\n                                  />\n                                </div>\n\n                                {(selectedMode as any) === \"X01\" && (\n                                  <div className=\"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\n                                    <div className=\"text-xs uppercase tracking-wide text-white/50\">\n                                      Manual Scoreboard Override\n                                    </div>\n                                    <p className=\"mt-1 text-xs text-white/40\">\n                                      Adjust the live totals if a dart was\n                                      misread. Values are clamped between 0 and{\" \"}\n                                      {x01Score}.\n                                    </p>\n                                    <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm\">\n                                      <div className=\"space-y-3\">\n                                        <div className=\"text-sm font-semibold text-white\">\n                                          {humanName}\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\n                                            Commit Visit\n                                          </label>\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <MatchControls\n                                              inProgress={true}\n                                              startingScore={x01Score}\n                                              onAddVisit={makeOfflineAddVisitAdapter(\n                                                commitManualVisitTotal,\n                                              )}\n                                              quickButtons={[180, 140, 100, 60]}\n                                              onNextPlayer={() =>\n                                                matchActions?.nextPlayer()\n                                              }\n                                              onEndLeg={() => {\n                                                /* End leg handled via commitManualVisitTotal / addVisitTotal */\n                                              }}\n                                              onUndo={() => {\n                                                /* offline undo not implemented here; optionally reset pending visit */\n                                              }}\n                                              showDartsSelect={true}\n                                            />\n                                          </div>\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\n                                            Legs Override\n                                          </label>\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <input\n                                              className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                              type=\"number\"\n                                              min={0}\n                                              value={manualPlayerLegsInput}\n                                              onChange={(e) =>\n                                                setManualPlayerLegsInput(\n                                                  e.target.value,\n                                                )\n                                              }\n                                              onKeyDown={(e) => {\n                                                if (e.key === \"Enter\")\n                                                  handleManualLegsOverride(\n                                                    \"player\",\n                                                  );\n                                              }}\n                                              placeholder={`${playerLegs}`}\n                                            />\n                                            <button\n                                              className=\"btn px-3 py-1 text-sm\"\n                                              onClick={() =>\n                                                handleManualLegsOverride(\n                                                  \"player\",\n                                                )\n                                              }\n                                            >\n                                              Set\n                                            </button>\n                                          </div>\n                                        </div>\n                                      </div>\n                                      <div className=\"space-y-3\">\n                                        <div className=\"text-sm font-semibold text-white\">\n                                          {aiDisplayName}\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\n                                            Three Dart Edit\n                                          </label>\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <input\n                                              className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                              type=\"number\"\n                                              min={0}\n                                              max={x01Score}\n                                              value={manualOpponentScoreInput}\n                                              onChange={(e) =>\n                                                setManualOpponentScoreInput(\n                                                  e.target.value,\n                                                )\n                                              }\n                                              onKeyDown={(e) => {\n                                                if (e.key === \"Enter\")\n                                                  handleManualScoreOverride(\n                                                    \"ai\",\n                                                  );\n                                              }}\n                                              placeholder={`${aiScore}`}\n                                            />\n                                            <button\n                                              className=\"btn px-3 py-1 text-sm\"\n                                              onClick={() =>\n                                                handleManualScoreOverride(\"ai\")\n                                              }\n                                            >\n                                              Set\n                                            </button>\n                                          </div>\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\n                                            Legs Override\n                                          </label>\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <input\n                                              className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                              type=\"number\"\n                                              min={0}\n                                              value={manualOpponentLegsInput}\n                                              onChange={(e) =>\n                                                setManualOpponentLegsInput(\n                                                  e.target.value,\n                                                )\n                                              }\n                                              onKeyDown={(e) => {\n                                                if (e.key === \"Enter\")\n                                                  handleManualLegsOverride(\n                                                    \"ai\",\n                                                  );\n                                              }}\n                                              placeholder={`${aiLegs}`}\n                                            />\n                                            <button\n                                              className=\"btn px-3 py-1 text-sm\"\n                                              onClick={() =>\n                                                handleManualLegsOverride(\"ai\")\n                                              }\n                                            >\n                                              Set\n                                            </button>\n                                          </div>\n                                        </div>\n                                      </div>\n                                    </div>\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        </>\n                      ) : (\n                        <div className=\"card\">\n                          <div className=\"text-sm font-semibold mb-1\">\n                            Manual scoring active\n                          </div>\n                          <div className=\"text-xs opacity-70\">\n                            Camera previews are disabled. Use the manual entry\n                            controls below to record your turn.\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0\">\n                      <div className=\"flex items-stretch justify-center md:px-3 min-w-0\">\n                        <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span className=\"opacity-80\">You Remain</span>\n                            {isPlayerTurn ? (\n                              <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                                THROWING\n                              </span>\n                            ) : (\n                              <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">\n                                WAITING TO THROW\n                              </span>\n                            )}\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {playerScore}\n                          </div>\n                          <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\n                            <div\n                              className=\"h-full bg-emerald-400/70\"\n                              style={{\n                                width: `${Math.max(0, Math.min(100, (1 - playerScore / x01Score) * 100))}%`,\n                              }}\n                            />\n                          </div>\n                          <div className=\"text-sm mt-1 opacity-90\">\n                            Last dart:{\" \"}\n                            <span className=\"font-semibold\">\n                              {playerLastDart}\n                            </span>\n                          </div>\n                          <div className=\"text-sm opacity-90\">\n                            Last score:{\" \"}\n                            <span className=\"font-semibold\">\n                              {playerVisitDarts > 0\n                                ? playerVisitSum\n                                : (playerLastVisitScore ?? playerLastDart)}\n                            </span>\n                          </div>\n                          <div className=\"text-sm opacity-90\">\n                            3-Dart Avg:{\" \"}\n                            <span className=\"font-semibold\">\n                              {totalPlayerDarts > 0\n                                ? (\n                                    (totalPlayerPoints / totalPlayerDarts) *\n                                    3\n                                  ).toFixed(1)\n                                : \"0.0\"}\n                            </span>\n                          </div>\n                          <div className=\"text-xs opacity-70 flex items-center gap-2\">\n                            <span>Darts thrown: {playerDartsThrown}</span>\n                            <span\n                              className=\"inline-flex items-center gap-1\"\n                              aria-label=\"Visit darts\"\n                            >\n                              {[0, 1, 2].map((i) => (\n                                <span\n                                  key={i}\n                                  className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? \"bg-emerald-400\" : \"bg-white/20\"}`}\n                                ></span>\n                              ))}\n                            </span>\n                          </div>\n                          <div className=\"text-xs opacity-80 mt-1\">\n                            Doubles:{\" \"}\n                            <span className=\"font-semibold\">\n                              Att {playerDoublesAtt} Â· Hit {playerDoublesHit}\n                            </span>\n                          </div>\n                          {playerScore <= 170 &&\n                            playerScore > 0 &&\n                            (() => {\n                              const sugs = suggestCheckouts(\n                                playerScore,\n                                favoriteDouble,\n                              );\n                              const first = sugs[0] || \"â€”\";\n                              return (\n                                <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\n                                  <span className=\"opacity-70\">Checkout</span>\n                                  <span className=\"font-semibold\">{first}</span>\n                                </div>\n                              );\n                            })()}\n                        </div>\n                        {/* Center camera preview: right-aligned and square when selected */}\n                        <div className=\"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall\">\n                          <ResizablePanel\n                            storageKey=\"ndn:camera:tile:offline:center:v4\"\n                            className=\"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card\"\n                            defaultWidth={0}\n                            defaultHeight={0}\n                            minWidth={300}\n                            minHeight={300}\n                            maxWidth={2000}\n                            maxHeight={1200}\n                            autoFill\n                          >\n                            <CameraTile\n                              label=\"Your Board\"\n                              autoStart={true}\n                              className=\"min-w-0 h-full\"\n                              aspect=\"classic\"\n                              fill\n                            />\n                          </ResizablePanel>\n                        </div>\n                        {/* Match summary (offline) */}\n                        <div\n                          className={`mt-2 ${boxSize === \"small\" ? \"p-2\" : boxSize === \"large\" ? \"p-4\" : \"p-3\"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === \"small\" ? \"text-xs\" : textSize === \"large\" ? \"text-base\" : \"text-sm\"}`}\n                        >\n                          <div className=\"font-semibold mb-2\">\n                            Match Summary\n                          </div>\n                          {(() => {\n                            // In offline X01, player is vs AI or practice\n                            const currentThrower = isPlayerTurn\n                              ? user?.username || \"You\"\n                              : ai === \"None\"\n                                ? \"â€”\"\n                                : `${ai} AI`;\n                            const currentRemaining = isPlayerTurn\n                              ? playerScore\n                              : ai === \"None\"\n                                ? 0\n                                : aiScore;\n                            const lastScoreDisplay = isPlayerTurn\n                              ? playerVisitDarts > 0\n                                ? playerVisitSum\n                                : (playerLastVisitScore ?? playerLastDart)\n                              : aiVisitDarts > 0\n                                ? aiVisitSum\n                                : (aiLastVisitScore ?? aiLastDart);\n                            const dartsThrown = isPlayerTurn\n                              ? playerDartsThrown\n                              : aiDartsThrown;\n                            const scored =\n                              x01Score -\n                              (isPlayerTurn\n                                ? playerScore\n                                : ai === \"None\"\n                                  ? x01Score\n                                  : aiScore);\n                            const avg3 =\n                              dartsThrown > 0 ? (scored / dartsThrown) * 3 : 0;\n                            const matchScore = `${playerLegs}-${aiLegs}`;\n                            const bestLegText =\n                              legStats.length > 0\n                                ? `${Math.min(...legStats.map((l) => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\n                                : \"â€”\";\n                            return (\n                              <div className=\"grid grid-cols-2 gap-y-1\">\n                                <div className=\"opacity-80\">Current score</div>\n                                <div className=\"font-mono text-right\">\n                                  {matchScore}\n                                </div>\n                                <div className=\"opacity-80\">\n                                  Current thrower\n                                </div>\n                                <div className=\"text-right font-semibold text-lg\">\n                                  {currentThrower}\n                                </div>\n                                <div className=\"opacity-80\">\n                                  Score remaining\n                                </div>\n                                <div className=\"text-right font-mono font-bold text-xl\">\n                                  {currentRemaining}\n                                </div>\n                                <div className=\"opacity-80\">3-dart avg</div>\n                                <div className=\"text-right font-mono\">\n                                  {avg3.toFixed(1)}\n                                </div>\n                                <div className=\"opacity-80\">Last score</div>\n                                <div className=\"text-right font-mono\">\n                                  {lastScoreDisplay}\n                                </div>\n                                <div className=\"opacity-80\">Best leg</div>\n                                <div className=\"text-right\">{bestLegText}</div>\n                              </div>\n                            );\n                          })()}\n                        </div>\n                        <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\n                          <div className=\"text-xs flex items-center justify-between opacity-80\">\n                            <span>\n                              {ai === \"None\" ? \"Opponent\" : `${ai} AI`} Remain\n                            </span>\n                            {!isPlayerTurn ? (\n                              <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                                THROWING\n                              </span>\n                            ) : (\n                              <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">\n                                WAITING TO THROW\n                              </span>\n                            )}\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {ai !== \"None\" ? aiScore : \"N/A\"}\n                          </div>\n                          {ai !== \"None\" && (\n                            <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\n                              <div\n                                className=\"h-full bg-fuchsia-400/70\"\n                                style={{\n                                  width: `${Math.max(0, Math.min(100, (1 - aiScore / x01Score) * 100))}%`,\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"text-sm mt-1 opacity-90\">\n                            Last dart:{\" \"}\n                            <span className=\"font-semibold\">\n                              {ai === \"None\" ? 0 : aiLastDart}\n                            </span>\n                          </div>\n                          <div className=\"text-sm opacity-90\">\n                            Last score:{\" \"}\n                            <span className=\"font-semibold\">\n                              {ai === \"None\"\n                                ? \"â€”\"\n                                : aiVisitDarts > 0\n                                  ? aiVisitSum\n                                  : (aiLastVisitScore ?? aiLastDart)}\n                            </span>\n                          </div>\n                          <div className=\"text-sm opacity-90\">\n                            3-Dart Avg:{\" \"}\n                            <span className=\"font-semibold\">\n                              {ai !== \"None\"\n                                ? totalAiDarts > 0\n                                  ? (\n                                      (totalAiPoints / totalAiDarts) *\n                                      3\n                                    ).toFixed(1)\n                                  : \"0.0\"\n                                : \"â€”\"}\n                            </span>\n                          </div>\n                          {ai !== \"None\" && (\n                            <div className=\"text-xs opacity-70\">\n                              Darts thrown: {aiDartsThrown}\n                            </div>\n                          )}\n                          {ai !== \"None\" && (\n                            <div className=\"text-xs opacity-80 mt-1\">\n                              Doubles:{\" \"}\n                              <span className=\"font-semibold\">\n                                Att {aiDoublesAtt} Â· Hit {aiDoublesHit}\n                              </span>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                  {/* Turn area */}\n                  {selectedMode !== \"X01\" ? (\n                    <div className=\"space-y-2\">\n                      {selectedMode === \"Double Practice\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Target:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {DOUBLE_PRACTICE_ORDER[dpIndex]?.label || \"â€”\"}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                onAutoDart={(value, ring) => {\n                                  if (\n                                    ring === \"DOUBLE\" ||\n                                    ring === \"INNER_BULL\"\n                                  ) {\n                                    const hit = isDoubleHit(value, dpIndex);\n                                    if (hit) {\n                                      const nh = dpHits + 1;\n                                      const ni = dpIndex + 1;\n                                      setDpHits(nh);\n                                      setDpIndex(ni);\n                                      if (nh >= DOUBLE_PRACTICE_ORDER.length)\n                                        setTimeout(() => {\n                                          setDpHits(0);\n                                          setDpIndex(0);\n                                        }, 250);\n                                    }\n                                  }\n                                }}\n                                immediateAutoCommit\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-col gap-2\">\n                            <div className=\"flex items-center gap-2\">\n                              <input\n                                className=\"input w-24\"\n                                type=\"number\"\n                                min={0}\n                                max={60}\n                                value={playerDartPoints}\n                                onChange={(e) =>\n                                  setPlayerDartPoints(\n                                    Number(e.target.value || 0),\n                                  )\n                                }\n                                onKeyDown={(e) => {\n                                  if (e.key === \"Enter\") addDpNumeric();\n                                }}\n                              />\n                              <button\n                                className=\"btn px-3 py-1 text-sm\"\n                                onClick={addDpNumeric}\n                              >\n                                Add Dart\n                              </button>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <input\n                                className=\"input w-44\"\n                                placeholder=\"Manual (D16, 50, 25, T20)\"\n                                value={manualBox}\n                                onChange={(e) => setManualBox(e.target.value)}\n                                onKeyDown={(e) => {\n                                  if (e.key === \"Enter\") addDpManual();\n                                }}\n                              />\n                              <button\n                                className=\"btn px-3 py-1 text-sm\"\n                                onClick={addDpManual}\n                              >\n                                Add\n                              </button>\n                            </div>\n                          </div>\n                          <div className=\"text-xs text-slate-300\">\n                            Progress: {dpHits} of 21\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Around the Clock\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Target:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {ATC_ORDER[atcIndex] === 25\n                                ? \"25 (Outer Bull)\"\n                                : ATC_ORDER[atcIndex] === 50\n                                  ? \"50 (Inner Bull)\"\n                                  : ATC_ORDER[atcIndex] || \"â€”\"}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addAtcValue(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addAtcNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addAtcNumeric}\n                            >\n                              Add Dart\n                            </button>\n                          </div>\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-44\"\n                              placeholder=\"Manual (T20, D5, 25, 50)\"\n                              value={manualBox}\n                              onChange={(e) => setManualBox(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addAtcManual();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addAtcManual}\n                            >\n                              Add\n                            </button>\n                          </div>\n                          {atcHits >= ATC_ORDER.length && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setAtcHits(0);\n                                  setAtcIndex(0);\n                                  resetDartCount(\"Around the Clock\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Cricket\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addCricketAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addCricketNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addCricketNumeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setCricket(createCricketState());\n                                setPracticeTurnDarts(0);\n                                resetDartCount(\"Cricket\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Shanghai\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addShanghaiAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addShanghaiNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addShanghaiNumeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setShanghai(createShanghaiState());\n                                setPracticeTurnDarts(0);\n                                resetDartCount(\"Shanghai\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Halve It\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addHalveAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addHalveNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addHalveNumeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setHalve(createDefaultHalveIt());\n                                setPracticeTurnDarts(0);\n                                resetDartCount(\"Halve It\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"High-Low\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addHighLowAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addHighLowNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addHighLowNumeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setHighlow(createHighLow());\n                                setPracticeTurnDarts(0);\n                                resetDartCount(\"High-Low\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Bob's 27\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addB27Auto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addB27Numeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addB27Numeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetB27}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Count-Up\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value) => addCountUpAuto(value)}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  addCountUpAuto(playerDartPoints);\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                addCountUpAuto(playerDartPoints);\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setCuRound(1);\n                                setCuScore(0);\n                                setCuDarts(0);\n                                resetDartCount(\"Count-Up\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Round {cuRound}/{cuMaxRounds}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"High Score\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value) => addHighScoreAuto(value)}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  addHighScoreAuto(playerDartPoints);\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                addHighScoreAuto(playerDartPoints);\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setHsRound(1);\n                                setHsScore(0);\n                                setHsDarts(0);\n                                resetDartCount(\"High Score\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Round {hsRound}/{hsMaxRounds}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Low Score\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value) => addLowScoreAuto(value)}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  addLowScoreAuto(playerDartPoints);\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                addLowScoreAuto(playerDartPoints);\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setLsRound(1);\n                                setLsScore(0);\n                                setLsDarts(0);\n                                resetDartCount(\"Low Score\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Round {lsRound}/{lsMaxRounds}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Checkout 170\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring) =>\n                                  addCo170Auto(\n                                    value,\n                                    ring === \"MISS\" ? undefined : ring,\n                                  )\n                                }\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"text\"\n                              placeholder=\"Manual (D16, T20)\"\n                              value={manualBox}\n                              onChange={(e) => setManualBox(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addCoManual(true);\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => addCoManual(true)}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetCo170}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Remaining: {co170Rem} Â· Attempts: {co170Attempts} Â·\n                            Successes: {co170Successes}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Checkout 121\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring) =>\n                                  addCo121Auto(\n                                    value,\n                                    ring === \"MISS\" ? undefined : ring,\n                                  )\n                                }\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"text\"\n                              placeholder=\"Manual (D16, T20)\"\n                              value={manualBox}\n                              onChange={(e) => setManualBox(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addCoManual(false);\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => addCoManual(false)}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetCo121}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Remaining: {co121Rem} Â· Attempts: {co121Attempts} Â·\n                            Successes: {co121Successes}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Treble Practice\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addTrebleAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"text\"\n                              placeholder=\"Manual (T20)\"\n                              value={manualBox}\n                              onChange={(e) => setManualBox(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  const v = parseManualDart(manualBox);\n                                  if (v != null)\n                                    addTrebleAuto(v, undefined, undefined);\n                                  setManualBox(\"\");\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                const v = parseManualDart(manualBox);\n                                if (v != null)\n                                  addTrebleAuto(v, undefined, undefined);\n                                setManualBox(\"\");\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Hits: {trebleHits} Â· Misses:{\" \"}\n                            {Math.max(0, trebleDarts - trebleHits)} Â· Darts:{\" \"}\n                            {trebleDarts}\n                            {trebleMaxDarts > 0 ? `/${trebleMaxDarts}` : \"\"}\n                          </div>\n                          {trebleFinished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={resetTreble}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Baseball\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addBaseballAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetBaseball}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Golf\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addGolfAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetGolf}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Tic Tac Toe\" && (\n                        <>\n                          <div className=\"grid grid-cols-3 gap-1 mb-2\">\n                            {Array.from({ length: 9 }, (_, i) => i).map(\n                              (cell) => (\n                                <button\n                                  key={cell}\n                                  className={`h-16 rounded-xl border ${ttt.board[cell] ? \"bg-emerald-500/20 border-emerald-400/30\" : \"bg-slate-800/50 border-slate-700/50\"}`}\n                                  onClick={() => {\n                                    if (ttt.finished || ttt.board[cell]) return;\n                                    // One-tap claim attempt using autoscore last dart; fallback: prompt numeric\n                                    // For simplicity here, we use a no-op value and rely on next autoscore dart; as a usable fallback, open a numeric prompt\n                                    const promptVal = Number(\n                                      prompt(\n                                        \"Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)\",\n                                      ) || 0,\n                                    );\n                                    const ring =\n                                      promptVal % 3 === 0\n                                        ? \"TRIPLE\"\n                                        : promptVal % 2 === 0\n                                          ? \"DOUBLE\"\n                                          : \"SINGLE\";\n                                    const tcell = cell as unknown as\n                                      | 0\n                                      | 1\n                                      | 2\n                                      | 3\n                                      | 4\n                                      | 5\n                                      | 6\n                                      | 7\n                                      | 8;\n                                    const tgt = TTT_TARGETS[tcell];\n                                    const num =\n                                      tgt.type === \"BULL\"\n                                        ? null\n                                        : tgt.num || null;\n                                    addTttAuto(\n                                      tcell,\n                                      promptVal,\n                                      ring as any,\n                                      num as any,\n                                    );\n                                  }}\n                                >\n                                  {ttt.board[cell] || \"\"}\n                                </button>\n                              ),\n                            )}\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  // Attempt to claim the currently tapped-looking cell not tracked; as a simple flow, map by round-robin preference or let user click a cell button above.\n                                  // No-op here; primary interaction is via buttons with prompt for now.\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetTtt}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"American Cricket\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addAmCricketAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetAmCricket}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Scam\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Target:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {SCAM_TARGET_NAMES[scamPlayer.targetIndex]}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  recordDart(\"Scam\");\n                                  setScamPlayer(\n                                    addScamAuto(scamPlayer, value, r as any),\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={1}\n                              max={25}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  recordDart(\"Scam\");\n                                  setScamPlayer(\n                                    addScamNumeric(\n                                      scamPlayer,\n                                      playerDartPoints,\n                                    ),\n                                  );\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                recordDart(\"Scam\");\n                                setScamPlayer(\n                                  addScamNumeric(scamPlayer, playerDartPoints),\n                                );\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setScamPlayer(resetScam());\n                                resetDartCount(\"Scam\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          {scamPlayer.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              ðŸŽ‰ Finished in {scamPlayer.darts} darts!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Fives\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Score:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {fivesPlayer.score}/{fivesPlayer.target}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  recordDart(\"Fives\");\n                                  setFivesPlayer(\n                                    addFivesAuto(\n                                      fivesPlayer,\n                                      value,\n                                      ring as any,\n                                    ),\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={5}\n                              max={50}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  recordDart(\"Fives\");\n                                  setFivesPlayer(\n                                    addFivesNumeric(\n                                      fivesPlayer,\n                                      playerDartPoints,\n                                    ),\n                                  );\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                recordDart(\"Fives\");\n                                setFivesPlayer(\n                                  addFivesNumeric(\n                                    fivesPlayer,\n                                    playerDartPoints,\n                                  ),\n                                );\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setFivesPlayer(resetFives(fivesPlayer.target));\n                                resetDartCount(\"Fives\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:{\" \"}\n                            {fivesPlayer.darts}\n                          </div>\n                          {fivesPlayer.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              âœ“ Reached {fivesPlayer.target} in{\" \"}\n                              {fivesPlayer.darts} darts!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Sevens\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Score:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {sevensPlayer.score}/{sevensPlayer.target}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  recordDart(\"Sevens\");\n                                  setSevensPlayer(\n                                    addSevensAuto(\n                                      sevensPlayer,\n                                      value,\n                                      ring as any,\n                                    ),\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={7}\n                              max={21}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  recordDart(\"Sevens\");\n                                  setSevensPlayer(\n                                    addSevensNumeric(\n                                      sevensPlayer,\n                                      playerDartPoints,\n                                    ),\n                                  );\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                recordDart(\"Sevens\");\n                                setSevensPlayer(\n                                  addSevensNumeric(\n                                    sevensPlayer,\n                                    playerDartPoints,\n                                  ),\n                                );\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setSevensPlayer(\n                                  resetSevens(sevensPlayer.target),\n                                );\n                                resetDartCount(\"Sevens\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Valid scores: 7, 14, 21 Â· Darts:{\" \"}\n                            {sevensPlayer.darts}\n                          </div>\n                          {sevensPlayer.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              âœ“ Reached {sevensPlayer.target} in{\" \"}\n                              {sevensPlayer.darts} darts!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Killer\" && (\n                        <>\n                          {!killerSetupDone ? (\n                            <div className=\"space-y-2\">\n                              <div className=\"font-semibold\">Players</div>\n                              <div className=\"space-y-1\">\n                                {killerPlayers.map((p, idx) => (\n                                  <div\n                                    key={p.id}\n                                    className=\"flex items-center gap-2\"\n                                  >\n                                    <input\n                                      className=\"input\"\n                                      value={p.name}\n                                      onChange={(e) => {\n                                        const name = e.target.value;\n                                        setKillerPlayers((list) =>\n                                          list.map((it, i) =>\n                                            i === idx ? { ...it, name } : it,\n                                          ),\n                                        );\n                                      }}\n                                    />\n                                    <button\n                                      className=\"btn px-2 py-1\"\n                                      onClick={() =>\n                                        setKillerPlayers((list) =>\n                                          list.filter((_, i) => i !== idx),\n                                        )\n                                      }\n                                      disabled={killerPlayers.length <= 2}\n                                    >\n                                      Remove\n                                    </button>\n                                  </div>\n                                ))}\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <button\n                                  className=\"btn px-2 py-1\"\n                                  onClick={() =>\n                                    setKillerPlayers((list) => {\n                                      const id = `p${list.length + 1}`;\n                                      return [\n                                        ...list,\n                                        {\n                                          id,\n                                          name: `Player ${list.length + 1}`,\n                                        },\n                                      ];\n                                    })\n                                  }\n                                >\n                                  Add Player\n                                </button>\n                                <button\n                                  className=\"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1\"\n                                  onClick={() => {\n                                    if (killerPlayers.length < 2) {\n                                      alert(\"Need at least 2 players\");\n                                      return;\n                                    }\n                                    const ids = killerPlayers.map((p) => p.id);\n                                    const assigned = assignKillerNumbers(ids);\n                                    const initStates: Record<\n                                      string,\n                                      KillerState\n                                    > = {};\n                                    ids.forEach((id) => {\n                                      initStates[id] = createKillerState(\n                                        assigned[id],\n                                      );\n                                    });\n                                    setKillerAssigned(assigned);\n                                    setKillerStates(initStates);\n                                    setKillerTurnIdx(0);\n                                    setKillerDarts(0);\n                                    setKillerWinnerId(null);\n                                    setKillerLastEvent(\"Assigned numbers\");\n                                    setKillerSetupDone(true);\n                                  }}\n                                >\n                                  Assign Numbers & Start\n                                </button>\n                              </div>\n                            </div>\n                          ) : (\n                            <div className=\"space-y-3\">\n                              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\n                                {killerPlayers.map((p) => {\n                                  const st = killerStates[p.id];\n                                  const num = killerAssigned[p.id];\n                                  return (\n                                    <div\n                                      key={p.id}\n                                      className={`p-2 rounded-xl border ${st?.eliminated ? \"opacity-50 border-red-500/40 bg-red-500/10\" : \"border-slate-700/50 bg-slate-800/50\"}`}\n                                    >\n                                      <div className=\"flex items-center justify-between text-xs\">\n                                        <div className=\"font-semibold\">\n                                          {p.name}\n                                        </div>\n                                        <div\n                                          className={`text-[10px] px-1.5 py-0.5 rounded ${st?.isKiller ? \"bg-purple-500/20 text-purple-200 border border-purple-400/30\" : \"bg-slate-600/30 text-slate-300\"}`}\n                                        >\n                                          {st?.isKiller\n                                            ? \"Killer\"\n                                            : \"Not Killer\"}\n                                        </div>\n                                      </div>\n                                      <div className=\"mt-1 text-sm\">\n                                        Number:{\" \"}\n                                        <span className=\"font-semibold\">\n                                          {num}\n                                        </span>\n                                      </div>\n                                      <div className=\"text-sm\">\n                                        Lives:{\" \"}\n                                        <span className=\"font-semibold\">\n                                          {st?.lives ?? 0}\n                                        </span>\n                                      </div>\n                                    </div>\n                                  );\n                                })}\n                              </div>\n                              {cameraEnabled && (\n                                <div className=\"rounded-2xl overflow-hidden bg-black\">\n                                  <CameraView\n                                    scoringMode=\"custom\"\n                                    showToolbar={cameraToolbarVisible}\n                                    immediateAutoCommit\n                                    onAutoDart={(value, ring, info) => {\n                                      if (killerWinnerId) return;\n                                      const r =\n                                        ring === \"MISS\" ? undefined : ring;\n                                      const sector = info?.sector ?? null;\n                                      const cur = killerPlayers[killerTurnIdx];\n                                      if (!cur) return;\n                                      setKillerStates((prev) => {\n                                        const copy: Record<\n                                          string,\n                                          KillerState\n                                        > = {};\n                                        Object.keys(prev).forEach(\n                                          (k) => (copy[k] = { ...prev[k] }),\n                                        );\n                                        const res = applyKillerDart(\n                                          cur.id,\n                                          copy,\n                                          r as any,\n                                          sector,\n                                        );\n                                        if (res.becameKiller)\n                                          setKillerLastEvent(\n                                            `${cur.name} became a Killer`,\n                                          );\n                                        else if (res.victimId) {\n                                          const v = killerPlayers.find(\n                                            (p) => p.id === res.victimId,\n                                          );\n                                          setKillerLastEvent(\n                                            `${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved || 0) > 1 ? \"s\" : \"\"})`,\n                                          );\n                                        } else setKillerLastEvent(\"No effect\");\n                                        // Check winner\n                                        const win = killerWinner(copy);\n                                        if (win) setKillerWinnerId(win);\n                                        return copy;\n                                      });\n                                      setKillerDarts((d) => {\n                                        const nd = d + 1;\n                                        if (nd >= 3) {\n                                          // advance to next alive\n                                          let next = killerTurnIdx;\n                                          for (\n                                            let i = 1;\n                                            i <= killerPlayers.length;\n                                            i++\n                                          ) {\n                                            const idx =\n                                              (killerTurnIdx + i) %\n                                              killerPlayers.length;\n                                            const pid = killerPlayers[idx].id;\n                                            const st = killerStates[pid];\n                                            if (\n                                              st &&\n                                              !st.eliminated &&\n                                              st.lives > 0\n                                            ) {\n                                              next = idx;\n                                              break;\n                                            }\n                                          }\n                                          setKillerTurnIdx(next);\n                                          return 0;\n                                        }\n                                        return nd;\n                                      });\n                                    }}\n                                  />\n                                </div>\n                              )}\n                              <div className=\"flex items-center gap-2\">\n                                <input\n                                  className=\"input w-40\"\n                                  placeholder=\"Manual (D16, T5)\"\n                                  value={manualBox}\n                                  onChange={(e) => setManualBox(e.target.value)}\n                                  onKeyDown={(e) => {\n                                    if (e.key === \"Enter\") {\n                                      if (killerWinnerId) return;\n                                      const t = manualBox.trim().toUpperCase();\n                                      const m = t.match(\n                                        /^(S|D|T)?\\s*(\\d{1,2})$/,\n                                      );\n                                      if (!m) {\n                                        setManualBox(\"\");\n                                        return;\n                                      }\n                                      const mult = (m[1] || \"S\") as\n                                        | \"S\"\n                                        | \"D\"\n                                        | \"T\";\n                                      const num = parseInt(m[2], 10);\n                                      const ring =\n                                        mult === \"D\"\n                                          ? \"DOUBLE\"\n                                          : mult === \"T\"\n                                            ? \"TRIPLE\"\n                                            : \"SINGLE\";\n                                      const cur = killerPlayers[killerTurnIdx];\n                                      setKillerStates((prev) => {\n                                        const copy: Record<\n                                          string,\n                                          KillerState\n                                        > = {};\n                                        Object.keys(prev).forEach(\n                                          (k) => (copy[k] = { ...prev[k] }),\n                                        );\n                                        const res = applyKillerDart(\n                                          cur.id,\n                                          copy,\n                                          ring as any,\n                                          num,\n                                        );\n                                        if (res.becameKiller)\n                                          setKillerLastEvent(\n                                            `${cur.name} became a Killer`,\n                                          );\n                                        else if (res.victimId) {\n                                          const v = killerPlayers.find(\n                                            (p) => p.id === res.victimId,\n                                          );\n                                          setKillerLastEvent(\n                                            `${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved || 0) > 1 ? \"s\" : \"\"})`,\n                                          );\n                                        } else setKillerLastEvent(\"No effect\");\n                                        const win = killerWinner(copy);\n                                        if (win) setKillerWinnerId(win);\n                                        return copy;\n                                      });\n                                      setManualBox(\"\");\n                                      setKillerDarts((d) => {\n                                        const nd = d + 1;\n                                        if (nd >= 3) {\n                                          let next = killerTurnIdx;\n                                          for (\n                                            let i = 1;\n                                            i <= killerPlayers.length;\n                                            i++\n                                          ) {\n                                            const idx =\n                                              (killerTurnIdx + i) %\n                                              killerPlayers.length;\n                                            const pid = killerPlayers[idx].id;\n                                            const st = killerStates[pid];\n                                            if (\n                                              st &&\n                                              !st.eliminated &&\n                                              st.lives > 0\n                                            ) {\n                                              next = idx;\n                                              break;\n                                            }\n                                          }\n                                          setKillerTurnIdx(next);\n                                          return 0;\n                                        }\n                                        return nd;\n                                      });\n                                    }\n                                  }}\n                                />\n                                <button\n                                  className=\"btn px-3 py-1 text-sm\"\n                                  onClick={() => {\n                                    // Skip to next alive player\n                                    let next = killerTurnIdx;\n                                    for (\n                                      let i = 1;\n                                      i <= killerPlayers.length;\n                                      i++\n                                    ) {\n                                      const idx =\n                                        (killerTurnIdx + i) %\n                                        killerPlayers.length;\n                                      const pid = killerPlayers[idx].id;\n                                      const st = killerStates[pid];\n                                      if (\n                                        st &&\n                                        !st.eliminated &&\n                                        st.lives > 0\n                                      ) {\n                                        next = idx;\n                                        break;\n                                      }\n                                    }\n                                    setKillerTurnIdx(next);\n                                    setKillerDarts(0);\n                                  }}\n                                >\n                                  Next Player\n                                </button>\n                                <button\n                                  className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                                  onClick={() => {\n                                    // Reset Killer\n                                    setKillerStates({});\n                                    setKillerAssigned({});\n                                    setKillerSetupDone(false);\n                                    setKillerTurnIdx(0);\n                                    setKillerDarts(0);\n                                    setKillerWinnerId(null);\n                                    setKillerLastEvent(\"\");\n                                  }}\n                                >\n                                  Reset\n                                </button>\n                              </div>\n                              {killerWinnerId && (\n                                <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                                  Winner:{\" \"}\n                                  {\n                                    killerPlayers.find(\n                                      (p) => p.id === killerWinnerId,\n                                    )?.name\n                                  }{\" \"}\n                                  <button\n                                    className=\"ml-2 underline\"\n                                    onClick={() => {\n                                      setKillerStates({});\n                                      setKillerAssigned({});\n                                      setKillerSetupDone(false);\n                                      setKillerTurnIdx(0);\n                                      setKillerDarts(0);\n                                      setKillerWinnerId(null);\n                                      setKillerLastEvent(\"\");\n                                    }}\n                                  >\n                                    Play Again\n                                  </button>\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {/* Scorecard + Camera split (Option A): Scoreboard LEFT, Camera RIGHT */}\n                      <div className=\"flex gap-3 min-h-0 flex-1 text-[14px]\">\n                        {/* Left column: Scoreboard + Manual Scoring (50% width) */}\n                        <div className=\"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm\">\n                          <div className=\"text-sm font-semibold opacity-80\">\n                            Scoreboard\n                          </div>\n                          {/* Scoreboard */}\n                          <div className=\"flex-shrink-0\">\n                            <GameScoreboard\n                              gameMode={selectedMode as any}\n                              players={statsX01}\n                              matchScore={`${playerLegs}-${aiLegs}`}\n                            />\n                          </div>\n\n                          {/* Manual Scoring Section */}\n                          {isPlayerTurn && (\n                            <div className=\"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0\">\n                              <div className=\"flex flex-wrap items-center justify-between gap-3\">\n                                <h4 className=\"text-sm font-semibold tracking-wide uppercase text-indigo-200\">\n                                  Manual Scoring\n                                </h4>\n                                <span className=\"text-xs text-white/60\">\n                                  Override a visit or enter dart-by-dart scores.\n                                </span>\n                              </div>\n                              <div className=\"mt-3 space-y-3\">\n                                <div className=\"flex flex-wrap items-center gap-2\">\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\n                                    Single Dart\n                                  </label>\n                                  <input\n                                    className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                    type=\"number\"\n                                    min={0}\n                                    max={60}\n                                    value={playerDartPoints}\n                                    onChange={(e) =>\n                                      setPlayerDartPoints(\n                                        Number(e.target.value || 0),\n                                      )\n                                    }\n                                    onKeyDown={(e) => {\n                                      if (e.key === \"Enter\")\n                                        e.shiftKey\n                                          ? replaceLast()\n                                          : addDartNumeric();\n                                    }}\n                                    placeholder=\"60\"\n                                  />\n                                  <button\n                                    className=\"btn px-3 py-1 text-sm\"\n                                    onClick={addDartNumeric}\n                                  >\n                                    Add Dart\n                                  </button>\n                                </div>\n\n                                <div className=\"flex flex-wrap items-center gap-2\">\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\n                                    Three Dart Edit\n                                  </label>\n                                  <input\n                                    className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                    type=\"number\"\n                                    min={0}\n                                    max={playerScore <= 170 ? 170 : 180}\n                                    value={visitTotalInput}\n                                    onChange={(e) =>\n                                      handleVisitTotalChange(e.target.value)\n                                    }\n                                    onKeyDown={(e) => {\n                                      if (e.key === \"Enter\") addVisitTotal();\n                                    }}\n                                    placeholder=\"100\"\n                                  />\n                                  <button\n                                    className=\"btn px-3 py-1 text-sm\"\n                                    onClick={addVisitTotal}\n                                  >\n                                    Commit Visit\n                                  </button>\n                                  <button\n                                    className=\"btn btn--ghost px-3 py-1 text-sm\"\n                                    onClick={replaceLast}\n                                  >\n                                    Undo Visit\n                                  </button>\n                                </div>\n\n                                <div className=\"flex flex-wrap items-center gap-2\">\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\n                                    Manual\n                                  </label>\n                                  <input\n                                    className=\"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                    value={manualBox}\n                                    onChange={(e) =>\n                                      setManualBox(e.target.value)\n                                    }\n                                    onKeyDown={(e) => {\n                                      if (e.key === \"Enter\")\n                                        e.shiftKey\n                                          ? replaceLastManual()\n                                          : addManual();\n                                    }}\n                                    placeholder=\"T20\"\n                                  />\n                                  <button\n                                    className=\"btn px-3 py-1 text-sm\"\n                                    onClick={addManual}\n                                  >\n                                    Apply\n                                  </button>\n                                  <button\n                                    className=\"btn btn--ghost px-3 py-1 text-sm\"\n                                    onClick={replaceLastManual}\n                                    disabled={playerVisitDarts === 0}\n                                  >\n                                    Replace Last\n                                  </button>\n                                </div>\n\n                                <div>\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\n                                    Multi-entry (one per line)\n                                  </label>\n                                  <textarea\n                                    className=\"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30\"\n                                    rows={3}\n                                    value={manualTextarea}\n                                    onChange={(e) =>\n                                      setManualTextarea(e.target.value)\n                                    }\n                                    placeholder={\"T20\\nD16\\n25\"}\n                                  />\n                                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                                    <button\n                                      className=\"btn px-3 py-1 text-sm\"\n                                      onClick={addManualTextarea}\n                                    >\n                                      Apply All\n                                    </button>\n                                    <button\n                                      className=\"btn btn--ghost px-3 py-1 text-sm\"\n                                      onClick={() => setManualTextarea(\"\")}\n                                    >\n                                      Clear\n                                    </button>\n                                  </div>\n                                </div>\n\n                                <div className=\"pt-2 border-t border-white/10 mt-3\">\n                                  <button\n                                    className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\n                                    onClick={clearCurrentVisit}\n                                    disabled={\n                                      playerVisitDarts === 0 &&\n                                      playerVisitSum === 0\n                                    }\n                                  >\n                                    Clear Current Visit\n                                  </button>\n                                </div>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Right column: Main Camera Feed (50% width) */}\n                        {cameraEnabled && (\n                          <div className=\"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black\">\n                            <CameraView\n                              scoringMode=\"custom\"\n                              showToolbar={cameraToolbarVisible}\n                              immediateAutoCommit\n                              onAutoDart={(value, ring) => {\n                                const ringLabel = ring ?? \"MISS\";\n                                const safeValue = Number.isFinite(value)\n                                  ? Math.max(0, value)\n                                  : 0;\n                                const now = Date.now();\n                                if (safeValue <= 0) {\n                                  if (ringLabel !== \"MISS\") return;\n                                  if (\n                                    now - (lastBounceMissTsRef.current || 0) <\n                                    1200\n                                  ) {\n                                    return;\n                                  }\n                                  lastBounceMissTsRef.current = now;\n                                } else {\n                                  lastBounceMissTsRef.current = 0;\n                                }\n                                applyDartValue(safeValue);\n                              }}\n                            />\n                          </div>\n                        )}\n                      </div>\n                      {/* Remove the separate camera view below scoreboard */}\n                      {(selectedMode as any) === \"X01\" && !cameraEnabled && (\n                        <>\n                          <GameScoreboard\n                            gameMode={selectedMode as any}\n                            players={statsX01}\n                            matchScore={`${playerLegs}-${aiLegs}`}\n                          />\n                        </>\n                      )}\n                      {(selectedMode as any) === \"Cricket\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Cricket\"\n                            players={statsCricket}\n                          />\n                        </>\n                      )}\n                      {/* Camera view for Cricket auto-scoring */}\n                      {(selectedMode as any) === \"Cricket\" && cameraEnabled && (\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\n                          <CameraView\n                            scoringMode=\"custom\"\n                            showToolbar={cameraToolbarVisible}\n                            immediateAutoCommit\n                            onAutoDart={(value, ring, info) => {\n                              if (value > 0) {\n                                const r = ring === \"MISS\" ? undefined : ring;\n                                addCricketAuto(\n                                  value,\n                                  r as any,\n                                  info?.sector ?? null,\n                                );\n                              }\n                            }}\n                          />\n                        </div>\n                      )}\n                      {(selectedMode as any) === \"Shanghai\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Shanghai\"\n                            players={statsShanghai}\n                          />\n                        </>\n                      )}\n                      {/* Camera view for Shanghai auto-scoring */}\n                      {(selectedMode as any) === \"Shanghai\" &&\n                        cameraEnabled && (\n                          <div className=\"rounded-2xl overflow-hidden bg-black\">\n                            <CameraView\n                              scoringMode=\"custom\"\n                              showToolbar={cameraToolbarVisible}\n                              immediateAutoCommit\n                              onAutoDart={(value, ring, info) => {\n                                if (value > 0) {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addShanghaiAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }\n                              }}\n                            />\n                          </div>\n                        )}\n                      {(selectedMode as any) === \"Killer\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Killer\"\n                            players={statsKiller}\n                          />\n                        </>\n                      )}\n                      {(selectedMode as any) === \"Scam\" && (\n                        <>\n                          <GameScoreboard gameMode=\"Scam\" players={statsScam} />\n                        </>\n                      )}\n                      {/* Camera view for Scam auto-scoring */}\n                      {(selectedMode as any) === \"Scam\" && cameraEnabled && (\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\n                          <CameraView\n                            scoringMode=\"custom\"\n                            showToolbar={cameraToolbarVisible}\n                            immediateAutoCommit\n                            onAutoDart={(value, ring, info) => {\n                              if (value > 0) {\n                                setScamPlayer(\n                                  addScamAuto(scamPlayer, value, ring as any),\n                                );\n                              }\n                            }}\n                          />\n                        </div>\n                      )}\n                      {(selectedMode as any) === \"Fives\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Fives\"\n                            players={statsFives}\n                          />\n                        </>\n                      )}\n                      {/* Camera view for Fives auto-scoring */}\n                      {(selectedMode as any) === \"Fives\" && cameraEnabled && (\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\n                          <CameraView\n                            scoringMode=\"custom\"\n                            showToolbar={cameraToolbarVisible}\n                            immediateAutoCommit\n                            onAutoDart={(value, ring, info) => {\n                              if (value > 0) {\n                                setFivesPlayer(\n                                  addFivesAuto(fivesPlayer, value, ring as any),\n                                );\n                              }\n                            }}\n                          />\n                        </div>\n                      )}\n                      {(selectedMode as any) === \"Sevens\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Sevens\"\n                            players={statsSevens}\n                          />\n                        </>\n                      )}\n                      {/* Camera view for Sevens auto-scoring */}\n                      {(selectedMode as any) === \"Sevens\" && cameraEnabled && (\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\n                          <CameraView\n                            scoringMode=\"custom\"\n                            showToolbar={cameraToolbarVisible}\n                            immediateAutoCommit\n                            onAutoDart={(value, ring, info) => {\n                              if (value > 0) {\n                                setSevensPlayer(\n                                  addSevensAuto(\n                                    sevensPlayer,\n                                    value,\n                                    ring as any,\n                                  ),\n                                );\n                              }\n                            }}\n                          />\n                        </div>\n                      )}\n                      <div className=\"font-semibold\">Your Turn</div>\n                      <div className=\"flex flex-col gap-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            className=\"input w-24\"\n                            type=\"number\"\n                            min={0}\n                            max={60}\n                            value={playerDartPoints}\n                            onChange={(e) =>\n                              setPlayerDartPoints(Number(e.target.value || 0))\n                            }\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\")\n                                e.shiftKey ? replaceLast() : addDartNumeric();\n                            }}\n                          />\n                          <button\n                            className=\"btn px-3 py-1 text-sm\"\n                            onClick={addDartNumeric}\n                            title=\"Add a single dart (0â€“60)\"\n                          >\n                            Add Dart\n                          </button>\n                        </div>\n                        {/* Visit total entry */}\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            className=\"input w-28\"\n                            type=\"number\"\n                            min={0}\n                            max={playerScore <= 170 ? 170 : 180}\n                            placeholder=\"Visit total (0â€“180)\"\n                            value={visitTotalInput}\n                            onChange={(e) =>\n                              handleVisitTotalChange(e.target.value)\n                            }\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\") addVisitTotal();\n                            }}\n                          />\n                          <button\n                            className=\"btn px-3 py-1 text-sm\"\n                            onClick={addVisitTotal}\n                            title=\"Commit a full 3-dart total like 93\"\n                          >\n                            Commit Visit\n                          </button>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            className=\"input w-44\"\n                            placeholder=\"Manual (T20, D16, 5, 25, 50)\"\n                            value={manualBox}\n                            onChange={(e) => setManualBox(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\")\n                                e.shiftKey ? replaceLastManual() : addManual();\n                            }}\n                          />\n                          <button\n                            className=\"btn btn--ghost px-3 py-1 text-sm\"\n                            onClick={replaceLastManual}\n                            disabled={playerVisitDarts === 0}\n                          >\n                            Replace Last\n                          </button>\n                          <button\n                            className=\"btn px-3 py-1 text-sm\"\n                            onClick={addManual}\n                          >\n                            Add\n                          </button>\n                        </div>\n                        <div>\n                          <textarea\n                            className=\"input w-full h-24 resize-none\"\n                            placeholder=\"Type scores manually (one per line, e.g. T20&#10;D16&#10;5&#10;25&#10;50) - No camera needed!\"\n                            value={manualTextarea}\n                            onChange={(e) => setManualTextarea(e.target.value)}\n                          />\n                          <div className=\"flex gap-2 mt-1\">\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addManualTextarea}\n                            >\n                              Add All Scores\n                            </button>\n                            <button\n                              className=\"btn btn--ghost px-3 py-1 text-sm\"\n                              onClick={() => setManualTextarea(\"\")}\n                            >\n                              Clear\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-slate-300\">\n                        Tip: Enter to Add Â· Shift+Enter to Replace Last\n                      </div>\n                    </div>\n                  )}\n                  <div className=\"h-1\" />\n                </div>\n              </div>\n            </ResizableModal>\n          </div>\n        )}\n        {showRules && <X01RulesPopup onClose={() => setShowRules(false)} />}\n        {/* Frosted overlay when selecting premium mode without access */}\n        {lockedPremium && (\n          <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\n            <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\n            <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\n              <div className=\"text-3xl mb-2\">ðŸ”’</div>\n              <div className=\"font-semibold\">Premium mode locked</div>\n              <div className=\"text-sm text-slate-200/80\">\n                Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai,\n                and more.\n              </div>\n              <button\n                onClick={async () => {\n                  try {\n                    const res = await fetch(\n                      `${API_URL}/api/stripe/create-checkout-session`,\n                      {\n                        method: \"POST\",\n                        headers: { \"Content-Type\": \"application/json\" },\n                        body: JSON.stringify({ email: user?.email }),\n                      },\n                    );\n                    const data = await res.json();\n                    if (data.ok && data.url) {\n                      window.location.href = data.url;\n                      if (data.development) {\n                        toast(\n                          \"Opened Stripe test checkout (development mode)\",\n                          { type: \"info\", timeout: 3000 },\n                        );\n                      }\n                    } else if (data.error === \"STRIPE_NOT_CONFIGURED\") {\n                      toast(\n                        \"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\",\n                        { type: \"error\", timeout: 4000 },\n                      );\n                    } else {\n                      toast(\n                        \"Failed to create checkout session. Please try again.\",\n                        { type: \"error\", timeout: 4000 },\n                      );\n                    }\n                  } catch (err) {\n                    toast(\"Error creating checkout. Please try again.\", {\n                      type: \"error\",\n                      timeout: 4000,\n                    });\n                  }\n                }}\n                className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\n              >\n                Upgrade to PREMIUM Â·{\" \"}\n                {formatPriceInCurrency(getUserCurrency(), 5)}\n              </button>\n            </div>\n          </div>\n        )}\n        {showCameraManager && typeof document !== \"undefined\"\n          ? createPortal(\n              <div\n                className=\"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4\"\n                onClick={() => setShowCameraManager(false)}\n              >\n                <ResizableModal\n                  storageKey=\"ndn:modal:offline-camera-manager\"\n                  className=\"relative\"\n                  defaultWidth={640}\n                  defaultHeight={520}\n                  minWidth={480}\n                  minHeight={420}\n                  maxWidth={1200}\n                  maxHeight={900}\n                  initialFitHeight\n                  onClose={() => setShowCameraManager(false)}\n                >\n                  <div\n                    className=\"space-y-3\"\n                    onClick={(e) => e.stopPropagation()}\n                  >\n                    <div className=\"flex items-center justify-between gap-3\">\n                      <div>\n                        <div className=\"text-xs uppercase tracking-wide text-white/50\">\n                          Camera Devices\n                        </div>\n                        <div className=\"text-xl font-semibold text-white mt-1\">\n                          Manage Offline Camera Feeds\n                        </div>\n                      </div>\n                      <button\n                        className=\"btn bg-slate-800 hover:bg-slate-700 text-white\"\n                        onClick={() => setShowCameraManager(false)}\n                      >\n                        Close\n                      </button>\n                    </div>\n                    <CameraTile\n                      fill\n                      user={user}\n                      playerScore={playerScore}\n                      aiScore={aiScore}\n                      x01Score={x01Score}\n                      inMatch={inMatch}\n                      showWinPopup={showWinPopup}\n                      pendingLegWinner={pendingLegWinner}\n                      playerDartsThrown={playerDartsThrown}\n                      aiDartsThrown={aiDartsThrown}\n                      totalPlayerDarts={totalPlayerDarts}\n                      totalAiDarts={totalAiDarts}\n                      totalPlayerPoints={totalPlayerPoints}\n                      totalAiPoints={totalAiPoints}\n                      player180s={player180s}\n                      player140s={player140s}\n                      player100s={player100s}\n                      ai180s={ai180s}\n                      ai140s={ai140s}\n                      ai100s={ai100s}\n                      playerHighestCheckout={playerHighestCheckout}\n                      aiHighestCheckout={aiHighestCheckout}\n                      onClose={() => setShowCameraManager(false)}\n                      onOpen={() => setShowCameraManager(true)}\n                      layout={offlineLayout}\n                    />\n                  </div>\n                </ResizableModal>\n              </div>,\n              document.body,\n            )\n          : null}\n        {legOverrideConfirm && typeof document !== \"undefined\"\n          ? createPortal(\n              (() => {\n                const { target, value, stage } = legOverrideConfirm;\n                const targetName =\n                  target === \"player\" ? humanName : aiDisplayName;\n                const currentLegs = target === \"player\" ? playerLegs : aiLegs;\n                return (\n                  <div\n                    className=\"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4\"\n                    onClick={handleLegOverrideNo}\n                  >\n                    <ResizableModal\n                      storageKey=\"ndn:modal:offline-leg-override\"\n                      className=\"relative\"\n                      defaultWidth={360}\n                      defaultHeight={240}\n                      minWidth={280}\n                      minHeight={200}\n                      maxWidth={420}\n                      maxHeight={360}\n                      initialFitHeight\n                      onClose={handleLegOverrideNo}\n                    >\n                      <div\n                        className=\"space-y-3 max-w-[18rem] mx-auto\"\n                        onClick={(e) => e.stopPropagation()}\n                      >\n                        <div>\n                          <div className=\"text-xs uppercase tracking-wide text-white/50\">\n                            Step {stage} of 2\n                          </div>\n                          <div className=\"text-xl font-semibold text-white mt-1\">\n                            Override legs?\n                          </div>\n                        </div>\n                        <div className=\"text-sm text-slate-200 leading-relaxed\">\n                          {stage === 1 ? (\n                            <>\n                              Set {targetName}&apos;s legs to{\" \"}\n                              <span className=\"font-semibold text-white\">\n                                {value}\n                              </span>\n                              ? Confirm to continue.\n                            </>\n                          ) : (\n                            <>\n                              Final confirmation: set {targetName}&apos;s legs\n                              to{\" \"}\n                              <span className=\"font-semibold text-white\">\n                                {value}\n                              </span>\n                              . Select{\" \"}\n                              <span className=\"font-semibold text-emerald-200\">\n                                Yes\n                              </span>{\" \"}\n                              to apply immediately.\n                            </>\n                          )}\n                        </div>\n                        <div className=\"rounded-xl bg-black/40 border border-white/10 p-3 text-sm\">\n                          <div className=\"text-xs uppercase tracking-wide text-white/50 mb-1\">\n                            Current legs\n                          </div>\n                          <div className=\"text-base font-semibold text-white\">\n                            {currentLegs}\n                          </div>\n                        </div>\n                        <div className=\"flex items-center justify-end gap-2 pt-2\">\n                          <button\n                            className=\"btn bg-rose-600 hover:bg-rose-700 text-white\"\n                            onClick={handleLegOverrideNo}\n                          >\n                            No\n                          </button>\n                          <button\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\"\n                            onClick={handleLegOverrideYes}\n                          >\n                            Yes\n                          </button>\n                        </div>\n                      </div>\n                    </ResizableModal>\n                  </div>\n                );\n              })(),\n              document.body,\n            )\n          : null}\n        {showWinPopup && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\n            <ResizableModal\n              storageKey=\"ndn:modal:offline-win\"\n              className=\"w-full relative\"\n              defaultWidth={420}\n              defaultHeight={360}\n              minWidth={360}\n              minHeight={300}\n              maxWidth={800}\n              maxHeight={700}\n              initialFitHeight\n            >\n              <h3 className=\"text-lg font-bold mb-2\">Leg Won!</h3>\n              <label className=\"block mb-1\">Darts to hit double:</label>\n              <div className=\"flex gap-2 mb-2\">\n                {[1, 2, 3].map((n) => (\n                  <button\n                    key={n}\n                    className={`btn ${doubleDarts === n ? \"bg-brand-600\" : \"\"}`}\n                    onClick={() => setDoubleDarts(n)}\n                  >\n                    {n}\n                  </button>\n                ))}\n              </div>\n              <label className=\"block mb-1\">Darts for checkout:</label>\n              <div className=\"flex gap-2 mb-2\">\n                {[1, 2, 3].map((n) => (\n                  <button\n                    key={n}\n                    className={`btn ${checkoutDarts === n ? \"bg-brand-600\" : \"\"}`}\n                    onClick={() => setCheckoutDarts(n)}\n                  >\n                    {n}\n                  </button>\n                ))}\n              </div>\n              <div className=\"grid grid-cols-1 gap-2 mt-2\">\n                <button className=\"btn w-full\" onClick={handleWinPopupSubmit}>\n                  Submit\n                </button>\n                <button\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700 w-full\"\n                  onClick={() => {\n                    setShowWinPopup(false);\n                    startMatch();\n                  }}\n                >\n                  Rematch\n                </button>\n                <button\n                  className=\"btn bg-slate-700 hover:bg-slate-800 w-full\"\n                  onClick={() => {\n                    setShowWinPopup(false);\n                    setShowMatchModal(false);\n                    setInMatch(false);\n                  }}\n                >\n                  Back to Menu\n                </button>\n              </div>\n            </ResizableModal>\n          </div>\n        )}\n        {showMatchSummary && (\n          <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]\">\n            <ResizableModal\n              storageKey=\"ndn:modal:offline-summary\"\n              className=\"w-full relative\"\n              defaultWidth={820}\n              defaultHeight={520}\n              minWidth={600}\n              minHeight={400}\n              maxWidth={1400}\n              maxHeight={1000}\n              initialFitHeight\n            >\n              <h3 className=\"text-xl font-extrabold mb-2\">Match Summary</h3>\n              <div className=\"text-xs opacity-80 mb-3\">\n                {selectedMode} Â· {x01Score} start Â· First to {firstTo}\n              </div>\n              {(() => {\n                const player3da =\n                  totalPlayerDarts > 0\n                    ? (totalPlayerPoints / totalPlayerDarts) * 3\n                    : 0;\n                const player9da = player3da * 3;\n                const playerBest = (() => {\n                  const darts = legStats\n                    .filter(\n                      (l) =>\n                        l.winner === \"player\" &&\n                        typeof l.winnerDarts === \"number\",\n                    )\n                    .map((l) => l.winnerDarts);\n                  if (!darts.length) return \"â€”\";\n                  return `${Math.min(...darts)} darts`;\n                })();\n                const playerWorst = (() => {\n                  const darts = legStats\n                    .filter(\n                      (l) =>\n                        l.winner === \"player\" &&\n                        typeof l.winnerDarts === \"number\",\n                    )\n                    .map((l) => l.winnerDarts);\n                  if (!darts.length) return \"â€”\";\n                  return `${Math.max(...darts)} darts`;\n                })();\n                const playerPct =\n                  playerDoublesAtt > 0\n                    ? Math.round((playerDoublesHit / playerDoublesAtt) * 100)\n                    : 0;\n\n                const ai3da =\n                  totalAiDarts > 0 ? (totalAiPoints / totalAiDarts) * 3 : 0;\n                const ai9da = ai3da * 3;\n                const aiBest = (() => {\n                  const darts = legStats\n                    .filter(\n                      (l) =>\n                        l.winner === \"ai\" && typeof l.winnerDarts === \"number\",\n                    )\n                    .map((l) => l.winnerDarts);\n                  if (!darts.length) return \"â€”\";\n                  return `${Math.min(...darts)} darts`;\n                })();\n                const aiWorst = (() => {\n                  const darts = legStats\n                    .filter(\n                      (l) =>\n                        l.winner === \"ai\" && typeof l.winnerDarts === \"number\",\n                    )\n                    .map((l) => l.winnerDarts);\n                  if (!darts.length) return \"â€”\";\n                  return `${Math.max(...darts)} darts`;\n                })();\n                const aiPct =\n                  aiDoublesAtt > 0\n                    ? Math.round((aiDoublesHit / aiDoublesAtt) * 100)\n                    : 0;\n\n                return (\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n                    <div className=\"p-3 rounded-2xl glass border border-white/10\">\n                      <div className=\"text-sm font-semibold mb-1\">\n                        {user?.username || \"You\"}\n                      </div>\n                      <div className=\"text-3xl font-extrabold\">\n                        {playerLegs}\n                      </div>\n                      <div className=\"text-xs opacity-80\">Legs Won</div>\n                      <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\n                        <div>\n                          <span className=\"opacity-70\">Final 3DA</span>\n                          <div className=\"font-semibold\">\n                            {player3da.toFixed(1)}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Final 9DA</span>\n                          <div className=\"font-semibold\">\n                            {player9da.toFixed(1)}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Darts At Double</span>\n                          <div className=\"font-semibold\">\n                            {playerDoublesAtt}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Double %</span>\n                          <div className=\"font-semibold\">{playerPct}%</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Best Dart Leg</span>\n                          <div className=\"font-semibold\">{playerBest}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Worst Dart Leg</span>\n                          <div className=\"font-semibold\">{playerWorst}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">180's Hit</span>\n                          <div className=\"font-semibold\">{player180s}</div>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"hidden md:flex items-center justify-center\">\n                      <div className=\"text-4xl font-black\">\n                        {playerLegs} â€“ {aiLegs}\n                      </div>\n                    </div>\n                    <div className=\"p-3 rounded-2xl glass border border-white/10\">\n                      <div className=\"text-sm font-semibold mb-1\">\n                        {ai === \"None\" ? \"Opponent\" : `${ai} AI`}\n                      </div>\n                      <div className=\"text-3xl font-extrabold\">{aiLegs}</div>\n                      <div className=\"text-xs opacity-80\">Legs Won</div>\n                      <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\n                        <div>\n                          <span className=\"opacity-70\">Final 3DA</span>\n                          <div className=\"font-semibold\">\n                            {ai3da.toFixed(1)}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Final 9DA</span>\n                          <div className=\"font-semibold\">\n                            {ai9da.toFixed(1)}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Darts At Double</span>\n                          <div className=\"font-semibold\">{aiDoublesAtt}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Double %</span>\n                          <div className=\"font-semibold\">{aiPct}%</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Best Dart Leg</span>\n                          <div className=\"font-semibold\">{aiBest}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Worst Dart Leg</span>\n                          <div className=\"font-semibold\">{aiWorst}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">180's Hit</span>\n                          <div className=\"font-semibold\">{ai180s}</div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })()}\n              <div className=\"mt-4\">\n                <div className=\"text-sm font-semibold mb-2\">Legs Timeline</div>\n                <div className=\"flex flex-wrap gap-2\">\n                  {legStats.map((leg, i) => (\n                    <div\n                      key={i}\n                      className={`px-3 py-1 rounded-full border text-xs ${leg.winner === \"player\" ? \"bg-emerald-500/15 border-emerald-400/30\" : \"bg-fuchsia-500/15 border-fuchsia-400/30\"}`}\n                    >\n                      Leg {i + 1}:{\" \"}\n                      {leg.winner === \"player\"\n                        ? \"You\"\n                        : ai === \"None\"\n                          ? \"Opp\"\n                          : \"AI\"}{\" \"}\n                      Â· Dbl {leg.doubleDarts} Â· CO {leg.checkoutDarts}\n                    </div>\n                  ))}\n                </div>\n              </div>\n              <div className=\"mt-4\">\n                <div className=\"text-sm font-semibold mb-2\">Shot Heat Map</div>\n                <div className=\"rounded-2xl overflow-hidden bg-black p-3\">\n                  {/* Lazy-load HeatMap component to avoid increasing initial bundle too much */}\n                  <HeatMap />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-2 mt-4\">\n                <button\n                  className=\"btn bg-slate-700 hover:bg-slate-800\"\n                  onClick={() => setShowMatchSummary(false)}\n                >\n                  Close\n                </button>\n                <button\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700\"\n                  onClick={() => {\n                    setShowMatchSummary(false);\n                    startMatch();\n                  }}\n                >\n                  Rematch\n                </button>\n              </div>\n            </ResizableModal>\n          </div>\n        )}\n        {legStats.length > 0 && (\n          <div className=\"mt-4\">\n            <h4 className=\"font-semibold mb-2\">Leg Stats</h4>\n            <ul>\n              {legStats.map((leg, i) => (\n                <li key={i}>\n                  Leg {i + 1}: Double darts: {leg.doubleDarts}, Checkout darts:{\" \"}\n                  {leg.checkoutDarts}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {/* Phone camera overlay removed per UX preference; use header badge preview only */}\n      </div>\n    </div>\n  );\n}\n"],"names":["doubles","dVal","tag","prefsDoubleScore","fav","suggestCheckouts","remaining","favoriteDouble","hardcoded","target","routes","t","s","sayScore","name","scored","voiceName","opts","synth","msg","isCheckout","isOneEighty","v","CameraTile","label","autoStart","scaleOverride","className","aspect","style","fill","videoRef","useRef","cameraSession","useCameraSession","streaming","setStreaming","useState","ws","setWs","pairCode","setPairCode","pc","setPc","lastRegisteredModeRef","registerStream","useCallback","stream","modeOverride","err","preferredCameraLabel","useUserSettings","mode","setMode","setExpiresAt","setPaired","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","cameraEnabledSetting","setPreferredCameraLocked","preferredCameraLocked","setPreferredCamera","preferredCameraId","fallbackClass","fallbackStyle","jsx","useEffect","h","apiFetch","r","ip","x","mobileUrl","useMemo","code","envUrl","u","host","useHttps","port","manualModeSetAt","setManualModeSetAt","cancelled","desiredLabel","timer","start","stop","apply","startWifiConnection","startPhonePairing","constraints","devices","discoverNetworkDevices","error","connectToWifiDevice","device","d","connectToNetworkDevice","startUsbConnection","discoverUSBDevices","newDevice","requestUSBDevice","prev","connectToUsbDevice","connectToUSBDevice","handleModeSelect","newMode","onStart","ev","modeFromEvent","ensureWS","normalizedEnv","proto","sameOrigin","isLocalhost","isRenderHost","renderWS","url","socket","data","peer","e","inbound","offer","regenerateCode","stopAll","CameraFrame","props","cameraScale","storedAspect","onModeSelect","modeDisplayName","reconnectOptions","copyFeedback","setCopyFeedback","copyTimeoutRef","globalFitMode","effectiveFitMode","scale","raw","clamped","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","usbActive","videoElement","baseVideoClass","copyValue","value","type","textarea","jsxs","Fragment","option","isActive","scoreFromImagePoint","H_boardToImage","pImg","pBoard","imageToBoard","scoreAtBoardPoint","DartDetector","cfg","cx","cy","radius","width","height","frame","alpha","w","bg","n","i","p","g","b","gray","y","dx","dy","recent","mask","diff","sum","sum2","cnt","isHighlight","maxc","minc","satApprox","isHi","mu","var_","sigma","dynamicThresh","visited","bestArea","bestIdxs","idxs","area","qh","q","cur","nbs","nb","minX","minY","maxX","maxY","meanX","meanY","idx","cxx","cyy","cxy","trace","det","tmp","l1","vx","vy","vlen","dxc","dyc","outward","rlen","rx","ry","cosAng","maxT","tipX","tipY","dxr","dyr","minR2","bboxW","bboxH","bboxArea","radial","confidence","l2","bw","bh","yy","xx","tip","close","a","out","on","j","parseExternalDart","ring","normalizeRing","finalizeFromValue","m","mult","sec","mul","inner","subscribeExternalWS","onDart","alive","lastSig","lastSigAt","DEDUP_WINDOW_MS","seenIds","seenSet","considerForward","payload","parsed","pid","old","sig","now","connect","ResizablePanel","storageKey","children","defaultWidth","defaultHeight","minWidth","minHeight","maxWidth","maxHeight","autoFill","size","setSize","startRef","containerRef","onReset","clamp","min","max","beginResize","dir","el","rect","onMove","endResize","handleKeyResize","k","delta","curW","curH","useHeatmapStore","create","set","get","state","useMatchControl","endsAt","AUTO_COMMIT_MIN_FRAMES","AUTO_COMMIT_HOLD_MS","AUTO_COMMIT_COOLDOWN_MS","AUTO_STREAM_IGNORE_MS","DETECTION_ARM_DELAY_MS","AUTO_COMMIT_CONFIDENCE","BOARD_CLEAR_GRACE_MS","CameraView","onVisitCommitted","showToolbar","onAutoDart","immediateAutoCommit","hideInlinePanels","scoringMode","onGenericDart","onGenericReplace","x01DoubleInOverride","onAddVisit","onEndLeg","autoscoreWsUrl","cameraAspect","cameraFitMode","autoCommitMode","cameraEnabled","setCameraEnabled","hideCameraOverlay","setHideCameraOverlay","manualOnly","availableCameras","setAvailableCameras","canvasRef","overlayRef","isPhoneCamera","sessionStream","sessionStreaming","phoneFeedActive","effectiveStreaming","cameraStarting","setCameraStarting","snapshotUrl","setSnapshotUrl","H","imageSize","overlaySize","resetCalibration","_hydrated","locked","useCalibration","lastAutoScore","setLastAutoScore","manualScore","setManualScore","lastAutoValue","setLastAutoValue","lastAutoRing","setLastAutoRing","pendingDarts","setPendingDarts","pendingScore","setPendingScore","pendingEntries","setPendingEntries","pendingPreOpenDarts","setPendingPreOpenDarts","pendingDartsAtDouble","setPendingDartsAtDouble","awaitingClear","setAwaitingClear","pendingCommitRef","pendingCommitTimerRef","shouldDeferCommit","indicatorVersion","setIndicatorVersion","indicatorEntryVersions","setIndicatorEntryVersions","autoCandidateRef","detectionLogRef","lastAutoCommitRef","streamingStartMsRef","detectionArmedRef","detectionArmTimerRef","frameCountRef","detectionLog","setDetectionLog","showDetectionLog","setShowDetectionLog","clearPendingCommitTimer","captureDetectionLog","entry","next","finalizePendingCommit","_trigger","pending","enqueueVisitCommit","clearPendingManual","reason","setHadRecentAuto","handler","handleIndicatorReset","handleToolbarClear","requestDeviceManager","x01DoubleInSetting","x01DoubleIn","openedById","setOpenedById","matchState","useMatch","currentPlayerId","isOpened","setOpened","inProgress","setVisit","usePendingVisit","resetPendingVisit","addVisit","endLeg","callAddVisit","score","darts","meta","callEndLeg","addHeatSample","quickSelAuto","setQuickSelAuto","quickSelManual","setQuickSelManual","nonRegCount","setNonRegCount","showRecalModal","setShowRecalModal","hadRecentAuto","pulseManualPill","setPulseManualPill","pulseTimeoutRef","activeTab","setActiveTab","showManualModal","setShowManualModal","showAutoModal","setShowAutoModal","showScoringModal","setShowScoringModal","manualPreviewRef","dartTimerEnabled","dartTimerSeconds","dartTimeLeft","setDartTimeLeft","timerRef","paused","detectorRef","rafRef","detectorSeedVersion","setDetectorSeedVersion","handlePhoneReconnect","onOpen","onDartsCleared","mounted","refresh","list","onClose","leg","shouldRun","addDart","id","c","vw","vh","cw","ch","ctx","dw","dh","stopCamera","canFallbackToLocal","startCamera","dlog","playErr","retryErr","enumErr","videoEl","fallbackStream","activeStream","capture","primary","sessionVideo","source","video","canvas","CameraSelector","resolve","sourceVideo","canceled","proc","minArea","thresh","requireStableN","tick","cImg","applyHomography","rImg","BoardRadii","sx","sy","roiR","detector","nowPerf","warmupActive","tipRefined","refinePointSobel","pCal","sector","shouldAccept","applyAutoHit","candidate","existing","current","holdMs","ready","cooled","o","octx","ox","oy","ax","ax1","ay1","ax2","ay2","bx","by","handleUseLocalCamera","fallback","useAudit","sub","onOverlayClick","parseManual","input","bull","outerBull","num","multVal","getCurrentRemaining","newDarts","previousScore","previousDarts","addSample","willCount","applied","appliedValue","newScore","after","isFinish","preOpenTotal","postAfter","postBefore","attemptsThisDart","attemptsTotal","onAddAutoDart","onApplyManual","onReplaceManual","last","prevDarts","prevScore","onRecalibrateNow","onResetCalibration","onKey","onQuickEntry","val","onUndoDart","onCommitVisit","visitScore","visitDarts","fit","videoClass","renderVideoSurface","entrySeq","isPending","hasPositiveValue","hasHitRing","color","activeState","stateClass","title","baseClasses","okNow","pulseClass","ResizableModal","_","FocusLock","ms","isHit","polarToCartesian","angleDeg","sectorAngle","HeatMap","samples","ref","radii","ringOrder","points","angle","grd","sectorCounts","secStr","pos","DOUBLE_PRACTICE_ORDER","isDoubleHit","targetIdx","parseManualDart","ATC_ORDER","CRICKET_NUMBERS","createCricketState","marks","applyCricketDart","opponentClosed","hits","cand","before","remainToClose","toApply","overflow","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","endShanghaiTurn","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","endHalveItTurn","createHighLow","applyHighLowDart","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","res","applyKillerDart","selfId","states","me","victimId","victim","killerWinner","st","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","TTT_TARGETS","createTicTacToe","checkWin","board","lines","tryClaimCell","cell","tgt","ok","createScamState","SCAM_TARGETS","SCAM_TARGET_NAMES","getScamTarget","addScamAuto","newIndex","finished","addScamNumeric","resetScam","createFivesState","FIVES_VALID_NUMBERS","isFivesValid","addFivesAuto","addFivesNumeric","resetFives","createSevensState","SEVENS_VALID_NUMBERS","isSevensValid","addSevensAuto","addSevensNumeric","resetSevens","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","GameHeaderBar","left","right","sticky","GameScoreboard","gameMode","players","matchScore","gameRules","player","ScoreRow","AvgDifferenceRow","formatCricketClosed","getCricketStatus","mono","bold","highlight","matchAvg","allTimeAvg","isPositive","isNeutral","diffText","diffColor","closed","count","closedCount","makeOfflineAddVisitAdapter","commitManualVisitTotal","createOfflineMatchActions","args","match","endTurn","useOfflineGameStats","playerScore","aiScore","playerLegs","aiLegs","playerLastDart","aiLastDart","playerVisitSum","aiVisitSum","playerLastVisitScore","aiLastVisitScore","playerVisitDartCount","aiVisitDartCount","playerDoublesHit","playerDoublesAtt","aiDoublesHit","aiDoublesAtt","legStats","isPlayerTurn","ai","x01Score","cricket","shanghai","killerPlayers","killerStates","killerAssigned","killerTurnIdx","playerMatchAvg","playerDarts","playerScored","resolvedPlayerLastScore","l","getAllTimeAvg","resolvedAiLastScore","aiLevels","aiVisitScore","level","candidates","X01RulesPopup","API_URL","OfflinePlay","user","offlineLayout","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","rememberLastOffline","setLastOffline","autoStartOffline","setCameraScale","setCameraAspect","setCameraFitMode","textSize","boxSize","matchType","setMatchType","teamAName","setTeamAName","teamBName","setTeamBName","manualScoring","cameraToolbarVisible","waitForBoardClear","selectedMode","setSelectedMode","setX01Score","setAI","showRules","setShowRules","inMatch","setInMatch","setPlayerScore","setAiScore","onDouble","setOnDouble","showWinPopup","setShowWinPopup","firstTo","setFirstTo","setPlayerLegs","showStartShowcase","setShowStartShowcase","startedShowcasedRef","setAiLegs","pendingLegWinner","setPendingLegWinner","doubleDarts","setDoubleDarts","checkoutDarts","setCheckoutDarts","setLegStats","aiDelayMs","setAiDelayMs","toast","useToast","showMatchModal","setShowMatchModal","maximized","setMaximized","fitAll","setFitAll","fitScale","setFitScale","fitOverflowing","setFitOverflowing","setIsPlayerTurn","handleOpenManager","setShowCameraManager","playerDartPoints","setPlayerDartPoints","dpIndex","setDpIndex","dpHits","setDpHits","atcIndex","setAtcIndex","atcHits","setAtcHits","setCricket","setShanghai","halve","setHalve","highlow","setHighlow","practiceTurnDarts","setPracticeTurnDarts","b27Stage","setB27Stage","b27Score","setB27Score","b27Darts","setB27Darts","b27Hits","setB27Hits","b27Finished","setB27Finished","cuRound","setCuRound","cuScore","setCuScore","cuDarts","setCuDarts","cuMaxRounds","hsRound","setHsRound","hsScore","setHsScore","hsDarts","setHsDarts","hsMaxRounds","lsRound","setLsRound","lsScore","setLsScore","lsDarts","setLsDarts","lsMaxRounds","co170Rem","setCo170Rem","co170Darts","setCo170Darts","co170Attempts","setCo170Attempts","co170Successes","setCo170Successes","co121Rem","setCo121Rem","co121Darts","setCo121Darts","co121Attempts","setCo121Attempts","co121Successes","setCo121Successes","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","trebleMaxDarts","setTrebleMaxDarts","trebleFinished","setTrebleFinished","baseball","setBaseball","golf","setGolf","ttt","setTTT","amCricket","setAmCricket","setKillerPlayers","setKillerStates","setKillerAssigned","killerSetupDone","setKillerSetupDone","setKillerTurnIdx","killerDarts","setKillerDarts","killerWinnerId","setKillerWinnerId","killerLastEvent","setKillerLastEvent","scam","setScam","scamPlayer","setScamPlayer","fives","setFives","fivesPlayer","setFivesPlayer","sevens","setSevens","sevensPlayer","setSevensPlayer","playerDartsThrown","setPlayerDartsThrown","setPlayerLastDart","playerVisitDarts","setPlayerVisitDarts","playerVisitStart","setPlayerVisitStart","setPlayerVisitSum","setPlayerLastVisitScore","playerVisitDartsAtDouble","setPlayerVisitDartsAtDouble","lastBounceMissTsRef","lastVisitDartsRef","playerScoreRef","playerVisitDartsRef","playerVisitSumRef","playerVisitStartRef","playerVisitDartsAtDoubleRef","aiCountdownMs","setAiCountdownMs","aiDartsThrown","setAiDartsThrown","setAiLastDart","setAiVisitSum","aiVisitDarts","setAiVisitDarts","setAiLastVisitScore","aiVisitDartsAtDouble","setAiVisitDartsAtDouble","setPlayerDoublesAtt","setPlayerDoublesHit","setAiDoublesAtt","setAiDoublesHit","totalPlayerDarts","setTotalPlayerDarts","totalAiDarts","setTotalAiDarts","totalPlayerPoints","setTotalPlayerPoints","totalAiPoints","setTotalAiPoints","player180s","setPlayer180s","player140s","setPlayer140s","player100s","setPlayer100s","ai180s","setAi180s","ai140s","setAi140s","ai100s","setAi100s","playerHighestCheckout","setPlayerHighestCheckout","aiHighestCheckout","setAiHighestCheckout","showMatchSummary","setShowMatchSummary","manualBox","setManualBox","manualTextarea","setManualTextarea","manualPlayerScoreInput","setManualPlayerScoreInput","manualOpponentScoreInput","setManualOpponentScoreInput","manualPlayerLegsInput","setManualPlayerLegsInput","manualOpponentLegsInput","setManualOpponentLegsInput","legOverrideConfirm","setLegOverrideConfirm","showCameraManager","dartCounts","setDartCounts","awaitingBoardClear","setAwaitingBoardClear","pendingVisitRef","pendingVisitTimerRef","clearPendingVisitTimer","speakAutoVisit","speaker","commitPendingVisit","visitTotal","preRemaining","doubleAttempts","doubleWindow","highestCheckout","finalizePendingVisit","trigger","queuePendingVisit","humanName","aiDisplayName","statsX01","statsCricket","statsShanghai","statsKiller","statsScam","statsFives","statsSevens","activeScoreboardStats","playerResolvedLastScore","aiResolvedLastScore","singlePlayerScoreboard","rest","inactivePlayerName","activePlayerName","activeRemaining","activeLastScore","recordDart","resetDartCount","parseManualScoreOverride","parseManualLegsOverride","cancelPendingAutoVisit","nextScore","safeScore","nextVisitStart","handleManualScoreOverride","applyManualLegOverride","handleManualLegsOverride","handleLegOverrideYes","handleLegOverrideNo","handleKey","event","buttonSizeClass","scrollerRef","contentRef","headerBarRef","formatType","setFormatType","formatCount","setFormatCount","formatRef","wins","measure","scroller","content","headerH","availH","availW","currentScale","naturalHeight","naturalWidth","scaleH","scaleW","scaledHeight","overflowing","RO","ro","onAuto","startMatch","onFmt","raf","dt","targetVisit","dart","preRem","postRem","checkout","startNextLeg","nextRemaining","applyDartValue","currentScore","currentVisitDarts","currentVisitSum","currentVisitStart","currentVisitDartsAtDouble","newVisitDarts","postRemaining","attemptsThisVisit","newVisitSum","startedDoubleWindow","stillInDoubleWindow","doubleAttemptsNow","inDoubleWindow","attemptsForVisit","addDartNumeric","rawTotal","visitStart","liveScore","existingDarts","existingSum","hadPartialVisit","checkoutCap","total","matchActions","visitTotalInput","setVisitTotalInput","handleVisitTotalChange","numericOnly","maxAllowed","safe","addVisitTotal","bounded","clearCurrentVisit","onClearRequest","evt","detail","addDpValue","nextHits","addDpNumeric","addDpManual","addB27Auto","hit","nd","totalHits","addB27Numeric","resetB27","addCountUpAuto","addHighScoreAuto","addLowScoreAuto","applyCheckout","rem","setRem","setDarts","setAttempts","setSuccesses","addCo170Auto","addCo121Auto","addCoManual","is170","isDouble","resetCo170","resetCo121","addTrebleAuto","cycle","resetTreble","addBaseballAuto","cp","resetBaseball","addGolfAuto","resetGolf","addTttAuto","resetTtt","addAmCricketAuto","resetAmCricket","addAtcValue","newHits","addAtcNumeric","addAtcManual","addCricketAuto","copy","addCricketNumeric","addShanghaiAuto","addShanghaiNumeric","addHalveAuto","addHalveNumeric","addHighLowAuto","addHighLowNumeric","parseManualBox","addManual","addManualTextarea","line","replaceLast","replaceLastManual","rewind","handleWinPopupSubmit","winner","legDoublesAtt","legDoublesHit","winnerDarts","bumpGameMode","lockedPremium","freeGames","MatchStartShowcase","premiumGames","GameCalibrationStatus","disabled","pillCls","cricketClosedAll","info","MatchControls","first","currentThrower","currentRemaining","lastScoreDisplay","dartsThrown","avg3","bestLegText","nh","ni","promptVal","tcell","win","it","ids","initStates","ringLabel","safeValue","formatPriceInCurrency","getUserCurrency","createPortal","stage","targetName","currentLegs","player3da","player9da","playerBest","playerWorst","playerPct","ai3da","ai9da","aiBest","aiWorst","aiPct"],"mappings":"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"}
import{b as Ir,u as Qe,j as e,c as gi,d as kl,e as Dl,f as Tl,r as Ll,h as Ml,i as Al,s as El,k as $i,l as Rl,m as Zn,R as Sn,F as vi,n as xt,o as ji,B as Is,p as Il,q as Bl,a as Pl,t as Ni,v as wi,w as Ul,x as Ol,y as Fl,z as $l}from"./index-C32VqwCm.js";import{r as n}from"./ui-gqBJRRJB.js";import{G as Hl}from"./GameCalibrationStatus-C2XzNxQY.js";import{u as Er,a as Cn}from"./match-bSaznbTC.js";import{u as yi,M as Vl}from"./MatchControls-UL1P_Zel.js";import{M as Wl}from"./MatchStartShowcase-nNutOkHo.js";import"./vendor-D3F3s8fL.js";const _l=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function Kl(s){return s==="DB"?50:Number(s.slice(1))*2}function zl(s){return _l.includes(s)?Kl(s):32}function Gl(s,r="D16"){if(s>170||s<=1)return[];const o={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(o[s])return o[s];const m=zl(r),l=[];for(const u of[60,57,54,51,48])if(s-u===m){l.push(`T${u/3} ${r}`);break}if(!l.length){for(const u of[20,19,18,17,16,15])if(s-u===m){l.push(`${u} ${r}`);break}}return l}function Ar(s,r,o,m,l){try{const u=window.speechSynthesis;if(!u)return;const x=new SpeechSynthesisUtterance,S=o<=170&&o>0,C=r===180;if(!(!l?.checkoutOnly||S||C))return;if(C?(x.text=`${s}! One eighty!`,x.rate=1.04,x.pitch=1.15):S?(x.text=`${s}, ${o} remaining.`,x.rate=1,x.pitch=1):r===0?(x.text=`${s}, no score.`,x.rate=1,x.pitch=1):(x.text=`${s}, ${r}.`,x.rate=1,x.pitch=1),m){const E=u.getVoices().find($=>$.name===m);E&&(x.voice=E)}typeof l?.volume=="number"?x.volume=Math.max(0,Math.min(1,l.volume)):x.volume=1;try{u.cancel()}catch{}u.speak(x)}catch{}}function Si({label:s,autoStart:r,scale:o,className:m,aspect:l="inherit",style:u,fill:x=!1}){const S=n.useRef(null),C=Ir(),[k,E]=n.useState(!1),[$,W]=n.useState(null),[y,w]=n.useState(null),[Z,D]=n.useState(null),ge=n.useRef(null),ue=n.useCallback((v,p="local")=>{try{v?(C.setMediaStream(v),S.current&&C.setVideoElementRef(S.current),C.setMode(p),C.setStreaming(!0),ge.current=p):ge.current&&ge.current!=="phone"&&(C.setStreaming(!1),C.setMediaStream(null),ge.current=null)}catch(L){console.warn("[CameraTile] Failed to register stream with camera session:",L)}},[C]),le=Qe(v=>v.preferredCameraLabel),[M,ee]=n.useState(()=>le==="Phone Camera"?"phone":localStorage.getItem("ndn:camera:mode")||"local"),[,Ne]=n.useState(null),[,me]=n.useState(!1),[Ee,Ve]=n.useState(null),[we,he]=n.useState(null),[T,ae]=n.useState(!0),[g,Ze]=n.useState([]),[z,ct]=n.useState(!1),[te,G]=n.useState([]),[xe,Ye]=n.useState(!1),et=Qe(v=>v.autoscoreProvider),Ie=Qe(v=>v.cameraEnabled),se=Qe(v=>v.setPreferredCameraLocked),ve=Qe(v=>v.preferredCameraLocked),fe=Qe(v=>v.setPreferredCamera),$t=Qe(v=>v.preferredCameraId);if(et==="manual"){const p=[x?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",m].filter(Boolean).join(" ").trim(),L={...u||{}};return!x&&L.aspectRatio===void 0&&L.height===void 0&&L.minHeight===void 0&&(L.aspectRatio="4 / 3"),e.jsx("div",{className:p,style:L,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}n.useEffect(()=>{const v=window.location.hostname;(v==="localhost"||v==="127.0.0.1")&&gi("/api/hosts").then(p=>p.json()).then(p=>{const L=Array.isArray(p?.hosts)&&p.hosts.find(j=>j);L&&Ve(L)}).catch(()=>{}),gi("/api/https-info").then(p=>p.json()).then(p=>{p&&typeof p.https=="boolean"&&he({https:!!p.https,port:Number(p.port)||8788})}).catch(()=>{})},[]);const ps=n.useMemo(()=>{const v=y||"____",p="ws://localhost:8787";if(p.length>0)try{const _=new URL(p);return`${`${_.protocol==="wss:"?"https":"http"}://${_.host}${_.pathname.endsWith("/ws")?"":_.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${v}`}catch{}const L=Ee||window.location.hostname,j=!!we?.https,A=j?we?.port||8788:8787;return`${j?"https":"http"}://${L}:${A}/mobile-cam.html?code=${v}`},[y,Ee,we]);n.useEffect(()=>{localStorage.setItem("ndn:camera:mode",M)},[M]);const[ze,tt]=n.useState(null);n.useEffect(()=>{Qe.getState().ignorePreferredCameraSync||ze&&Date.now()-ze<3e4||le==="Phone Camera"&&M!=="phone"&&ee("phone")},[le,M,ze]),n.useEffect(()=>{if(!(!Ie||et&&et!=="built-in"&&et!=="external-ws")&&r!==void 0){if(r){let v=!1;const p=le||"default",L=window.setTimeout(()=>{v||k||oe().catch(j=>console.warn(`[CameraTile] Auto-start failed for ${p}:`,j))},200);return()=>{v=!0,window.clearTimeout(L)}}lt()}},[r,k,Ie,et,le,oe,lt]),n.useEffect(()=>{const v=async()=>{try{if(!(le==="Phone Camera"&&(!ze||Date.now()-ze>=3e4)||M==="phone"))return;const j=C.getMediaStream(),A=S.current;if(!A||!j)return;A.srcObject!==j&&(A.srcObject=j),A.muted=!0,A.playsInline=!0;try{await A.play()}catch{}E(!0)}catch{}};v();const p=setInterval(v,800);return()=>clearInterval(p)},[le,M,C,C.isStreaming]);const oe=n.useCallback(async()=>{if(M==="wifi")return St();if(le==="Phone Camera"||M==="phone"){const v=C.getMediaStream();if(v&&S.current)try{S.current.srcObject=v,await S.current.play(),E(!0);return}catch{}if(M==="phone")try{await Ue();return}catch{}}try{const{preferredCameraId:v,setPreferredCamera:p}=Qe.getState(),L=v?{video:{deviceId:{exact:v}},audio:!1}:{video:!0,audio:!1};let j;try{j=await navigator.mediaDevices.getUserMedia(L)}catch(A){const P=A&&(A.name||A.code)||"";if(v&&(P==="OverconstrainedError"||P==="NotFoundError"))j=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw A}S.current&&(S.current.srcObject=j,await S.current.play(),E(!0),ue(j,"local"))}catch{}},[M,le,C,ue,Ue,St]),lt=n.useCallback(()=>{S.current&&S.current.srcObject&&(S.current.srcObject.getTracks().forEach(p=>p.stop()),S.current.srcObject=null,E(!1),ue(null))},[ue]);async function St(){ct(!0);try{const v=await kl();Ze(v),v.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(v){console.error("Wifi device discovery failed:",v),alert("Failed to discover wifi devices. Please check your network connection.")}finally{ct(!1)}}async function Be(v){try{Ze(L=>L.map(j=>j.id===v.id?{...j,status:"connecting"}:j));const p=await Dl(v);if(p&&S.current)S.current.srcObject=p,await S.current.play(),E(!0),ue(p,"wifi"),Ze(L=>L.map(j=>j.id===v.id?{...j,status:"online"}:j));else throw new Error("Failed to get video stream")}catch(p){console.error("Failed to connect to wifi device:",p),alert(`Failed to connect to ${v.name}. Please check the device and try again.`),Ze(L=>L.map(j=>j.id===v.id?{...j,status:"offline"}:j))}}async function B(){Ye(!0);try{const v=await Tl();G(v);const p=await Ll();p&&G(L=>[...L,p]),v.length===0&&!p&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(v){console.error("USB device discovery failed:",v),alert("Failed to discover USB devices. Please check device connections.")}finally{Ye(!1)}}async function Pe(v){try{G(L=>L.map(j=>j.id===v.id?{...j,status:"connecting"}:j));const p=await Ml(v);if(p&&S.current)S.current.srcObject=p,await S.current.play(),E(!0),ee("wifi"),ue(p,"wifi"),G(L=>L.map(j=>j.id===v.id?{...j,status:"online"}:j));else throw new Error("Failed to get video stream")}catch(p){console.error("Failed to connect to USB device:",p),alert(`Failed to connect to ${v.name}. Please check the device and try again.`),G(L=>L.map(j=>j.id===v.id?{...j,status:"offline"}:j))}}const Ge=n.useCallback(v=>{try{ee(v==="usb"?"wifi":v),tt(Date.now());try{if(v==="local"){try{fe($t,"Local",!0)}catch{}try{se(!0)}catch{}}else if(v==="phone"){try{fe(void 0,"Phone Camera",!0)}catch{}try{se(!0)}catch{}}else if(v==="wifi"||v==="usb"){try{fe(void 0,"WiFi/USB",!0)}catch{}try{se(!0)}catch{}}}catch{}v==="local"?oe().catch(()=>{}):v==="phone"?Ue():v==="wifi"?St():v==="usb"&&B()}catch(p){console.warn("[CameraTile] handleModeSelect failed",p)}},[oe,Ue,St,B,fe,se,$t]);n.useEffect(()=>{const v=p=>{try{const L=p&&p.detail&&p.detail.mode;L&&["local","phone","wifi","usb"].includes(L)?(Ge(L),oe().catch(()=>{})):oe().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",v),()=>{window.removeEventListener("ndn:start-camera",v)}},[oe,Ge]);function ut(){if($&&$.readyState===WebSocket.OPEN)return $;const v="ws://localhost:8787",p=v.length>0?v.endsWith("/ws")?v:v.replace(/\/$/,"")+"/ws":void 0,L=window.location.protocol==="https:"?"wss":"ws",j=`${L}://${window.location.host}/ws`,A=window.location.hostname,P=A==="localhost"||A==="127.0.0.1",_=A.endsWith("onrender.com"),qe="wss://ninedartnation.onrender.com/ws";let be=p;be||(P?be=`${L}://${A}:8787/ws`:_?be=j:be=qe),be||(be=j);const Ct=new WebSocket(be);return W(Ct),Ct}async function Ue(){ee("phone"),me(!1);const v=ut();v.readyState===WebSocket.OPEN?v.send(JSON.stringify({type:"cam-create"})):v.onopen=()=>v.send(JSON.stringify({type:"cam-create"})),v.onmessage=async p=>{const L=JSON.parse(p.data);if(L.type==="cam-code")w(L.code),L.expiresAt&&Ne(L.expiresAt);else if(L.type==="cam-peer-joined"){me(!0);const j=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});D(j),j.onicecandidate=P=>{P.candidate&&y&&v.send(JSON.stringify({type:"cam-ice",code:y,payload:P.candidate}))},j.ontrack=P=>{if(S.current){const _=P.streams?.[0];_&&(S.current.srcObject=_,S.current.play().catch(()=>{}),E(!0))}};const A=await j.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await j.setLocalDescription(A),y&&v.send(JSON.stringify({type:"cam-offer",code:y,payload:A}))}else if(L.type==="cam-answer")Z&&await Z.setRemoteDescription(new RTCSessionDescription(L.payload));else if(L.type==="cam-ice"&&Z)try{await Z.addIceCandidate(L.payload)}catch{}}}function We(){w(null),Ne(null),me(!1),$&&$.readyState===WebSocket.OPEN?$.send(JSON.stringify({type:"cam-create"})):Ue();try{se(!0)}catch{}}function Te(){if(lt(),w(null),me(!1),Ne(null),Z){try{Z.close()}catch{}D(null)}}return e.jsx(ql,{label:s,autoStart:r,start:oe,stopAll:Te,startPhonePairing:Ue,startWifiConnection:St,startUsbConnection:B,connectToWifiDevice:Be,connectToUsbDevice:Pe,videoRef:S,streaming:k,mode:M,setMode:ee,pairCode:y,mobileUrl:ps,regenerateCode:We,httpsInfo:we,showTips:T,setShowTips:ae,wifiDevices:g,usbDevices:te,discoveringWifi:z,discoveringUsb:xe,scaleOverride:o,className:m,aspect:l,style:u,fill:x,onModeSelect:Ge,preferredCameraLocked:ve})}function ql(s){const r=Ir(),{cameraScale:o,cameraAspect:m}=Qe(),{label:l,start:u,stopAll:x,startPhonePairing:S,startWifiConnection:C,startUsbConnection:k,connectToWifiDevice:E,connectToUsbDevice:$,videoRef:W,streaming:y,mode:w,setMode:Z,onModeSelect:D,pairCode:ge,mobileUrl:ue,regenerateCode:le,httpsInfo:M,showTips:ee,setShowTips:Ne,wifiDevices:me,usbDevices:Ee,discoveringWifi:Ve,discoveringUsb:we,className:he,aspect:T,style:ae,fill:g,preferredCameraLocked:Ze}=s,z={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},ct=n.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{D&&D("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{D&&D("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{D&&D("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{D&&D("usb")}}],[Z,u,S,C,k]),[te,G]=n.useState(null),xe=n.useRef(null);n.useEffect(()=>()=>{xe.current&&window.clearTimeout(xe.current)},[]);const{cameraFitMode:Ye}=Qe(),et=g?"fill":Ye||"fill",Ie=(()=>{const B=Number(s.scaleOverride??o??1),Pe=Math.max(.5,Math.min(1.25,B));return et==="fill"?Math.max(1,Pe):Pe})(),se=g&&et==="fill"?"free":T&&T!=="inherit"?T:m||"wide",ve=se!=="free",fe=ve?se==="square"?"aspect-square":se==="portrait"?"aspect-[3/4]":se==="classic"?"aspect-[4/3]":"aspect-video":"",ps=[g?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",he].filter(Boolean).join(" ").trim(),ze={...ae||{}},tt=g?"relative flex-1 min-h-[420px] bg-black":"relative w-full bg-black",oe={style:{transform:`scale(${Ie})`,transformOrigin:"center"}},lt=w==="wifi"&&Ee.some(B=>B.status==="online"),St=(()=>{const Pe=et==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return g?ve?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${fe}`,children:e.jsx("video",{ref:W,className:Pe,...oe})})}):e.jsx("video",{ref:W,className:Pe,...oe}):ve?e.jsx("div",{className:`relative w-full ${fe}`,children:e.jsx("video",{ref:W,className:Pe,...oe})}):e.jsx("div",{className:"relative w-full",children:e.jsx("video",{ref:W,className:Pe,...oe})})})();async function Be(B,Pe){if(B)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(B);else{const Ge=document.createElement("textarea");Ge.value=B,Ge.style.position="fixed",Ge.style.opacity="0",document.body.appendChild(Ge),Ge.focus(),Ge.select(),document.execCommand("copy"),document.body.removeChild(Ge)}G(Pe),xe.current&&window.clearTimeout(xe.current),xe.current=window.setTimeout(()=>G(null),1500)}catch(Ge){console.warn("Copy to clipboard failed:",Ge),G(null)}}return e.jsxs("div",{className:ps,style:ze,children:[e.jsxs("div",{className:tt,children:[St,r.isStreaming&&w==="phone"&&e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{children:"REC"})]})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[e.jsxs("span",{className:"truncate font-medium",children:[l||(y?w==="phone"?"PHONE LIVE":w==="wifi"?"WIFI LIVE":"LIVE":"Camera"),Ze&&e.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!y&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${w==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>D("local"),children:"Local"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${w==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>D("phone"),children:"Phone"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${w==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>D("wifi"),children:"WiFi"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${w==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>D("usb"),children:"USB"})]}),y?e.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:x,children:"Stop"}):null]})]}),w==="phone"&&ge&&!y&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>Be(ue,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:ue}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:te==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:ue,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>Be(ge,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:ge}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:te==="code"?"Copied!":"Copy"})]})]}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:le,children:"Regenerate"})}),ee&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and"," ",M?.https?M.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>Ne(!1),children:"Hide tips"})})]})]}),w==="wifi"&&!y&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),Ve?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):me.length>0?e.jsxs("div",{className:"space-y-1",children:[me.map(B=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:B.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[B.ip,":",B.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${B.status==="connecting"?"bg-yellow-600":B.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>E(B),disabled:B.status==="connecting",children:B.status==="connecting"?"...":"Connect"})]},B.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:C,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:C,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),we?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):Ee.length>0?e.jsxs("div",{className:"space-y-1",children:[Ee.map(B=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:B.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:B.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${B.status==="connecting"?"bg-yellow-600":B.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>$(B),disabled:B.status==="connecting",children:B.status==="connecting"?"...":"Connect"})]},B.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:k,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:k,children:"Scan USB"})]})]})]}),!y&&e.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",z[w]||"Local"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ct.map(B=>{const Pe=B.id==="usb"?lt:B.id===w;return e.jsxs("button",{type:"button",onClick:B.action,className:`text-left p-3 rounded-2xl border ${Pe?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:B.title}),e.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:B.description}),Pe&&e.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},B.id)})})]})]})}function Ci(s,r){const o=Al(s,r);return El(o)}class Xl{width=0;height=0;bg=null;lastAcceptTs=0;cooldownMs=600;roiRadius=0;roiCx=0;roiCy=0;initialized=!1;thresh=18;minArea=60;maxArea=6e3;angMaxDeg=70;prevTip=null;prevArea=0;stableCount=0;requireStableN=3;constructor(r){r?.thresh!==void 0&&(this.thresh=r.thresh),r?.minArea!==void 0&&(this.minArea=r.minArea),r?.maxArea!==void 0&&(this.maxArea=r.maxArea),r?.requireStableN!==void 0&&(this.requireStableN=r.requireStableN),r?.angMaxDeg!==void 0&&(this.angMaxDeg=r.angMaxDeg)}setROI(r,o,m){this.roiCx=r,this.roiCy=o,this.roiRadius=Math.max(0,m|0)}reset(r,o){this.width=r,this.height=o,this.bg=new Float32Array(r*o),this.initialized=!1}updateBackground(r,o=.05){const{width:m,height:l,data:u}=r;(!this.bg||m!==this.width||l!==this.height)&&this.reset(m,l);const x=this.bg,S=m*l;for(let C=0,k=0;C<S;C++,k+=4){const E=u[k],$=u[k+1],W=u[k+2],y=.299*E+.587*$+.114*W;this.initialized?x[C]=(1-o)*x[C]+o*y:x[C]=y}this.initialized=!0}inRoi(r,o){if(this.roiRadius<=0)return!0;const m=r-this.roiCx,l=o-this.roiCy;return m*m+l*l<=this.roiRadius*this.roiRadius}detect(r){const m=Date.now()-this.lastAcceptTs<this.cooldownMs,{width:l,height:u,data:x}=r;(!this.bg||l!==this.width||u!==this.height)&&this.reset(l,u);const S=this.bg;if(!this.initialized)return this.updateBackground(r,1),null;const C=l*u,k=new Uint8Array(C),E=new Float32Array(C);let $=0,W=0,y=0;const w=new Uint8Array(C);for(let j=0,A=0;j<C;j++,A+=4){const P=x[A],_=x[A+1],qe=x[A+2],be=Math.max(P,_,qe),Ct=Math.min(P,_,qe),st=.299*P+.587*_+.114*qe,Le=Math.abs(st-S[j]);E[j]=Le;const Gt=Math.floor(j/l),qt=j-Gt*l,ds=be===0?0:(be-Ct)/be,_e=be>=250&&ds<=.12;_e&&(w[j]=1),this.inRoi(qt,Gt)&&!_e&&($+=Le,W+=Le*Le,y++)}const Z=y?$/y:0,D=y?Math.max(0,W/y-Z*Z):0,ge=Math.sqrt(D),ue=Math.max(this.thresh,Z+1.2*ge);for(let j=0;j<C;j++){if(w[j]){k[j]=0;continue}if(E[j]>ue){const A=Math.floor(j/l),P=j-A*l;k[j]=this.inRoi(P,A)?1:0}}this._dilate(k,l,u),this._erode(k,l,u);const le=new Uint8Array(C);let M=0,ee=null;for(let j=0;j<C;j++){if(k[j]===0||le[j])continue;const A=[];let P=0,_=0;const qe=[j];for(le[j]=1;_<qe.length;){const be=qe[_++];A.push(be),P++;const Ct=be/l|0,st=[be-1,be+1,be-l,be+l];for(const Le of st)Le<0||Le>=C||le[Le]||(Le===be-1||Le===be+1)&&(Le/l|0)!==Ct||k[Le]&&(le[Le]=1,qe.push(Le))}P>M&&(M=P,ee=A)}if(!ee||M<this.minArea||M>this.maxArea)return m||this.updateBackground(r,.02),null;let Ne=l,me=u,Ee=0,Ve=0,we=0,he=0;for(const j of ee){const A=j/l|0,P=j-A*l;we+=P,he+=A,P<Ne&&(Ne=P),P>Ee&&(Ee=P),A<me&&(me=A),A>Ve&&(Ve=A)}we/=M,he/=M;let T=0,ae=0,g=0;for(const j of ee){const A=j/l|0,_=j-A*l-we,qe=A-he;T+=_*_,ae+=qe*qe,g+=_*qe}T/=M,ae/=M,g/=M;const Ze=T+ae,z=T*ae-g*g,ct=Math.sqrt(Math.max(0,Ze*Ze/4-z)),te=Ze/2+ct;let G=g,xe=te-T;Math.hypot(G,xe)<1e-6&&(G=te-ae,xe=g);const Ye=Math.hypot(G,xe)||1;G/=Ye,xe/=Ye;const et=we-this.roiCx,Ie=he-this.roiCy,se=et*G+Ie*xe>0?1:-1;G*=se,xe*=se;const ve=Math.hypot(et,Ie)||1,fe=et/ve,$t=Ie/ve,ps=Math.max(-1,Math.min(1,G*fe+xe*$t));if(Math.acos(ps)*180/Math.PI>this.angMaxDeg)return m||this.updateBackground(r,.02),null;let tt=-1/0,oe=we,lt=he;for(const j of ee){const A=j/l|0,P=j-A*l,_=(P-we)*G+(A-he)*xe;_>tt&&(tt=_,oe=P,lt=A)}const St=oe-this.roiCx,Be=lt-this.roiCy,B=St*St+Be*Be,Pe=Math.max(1,Ee-Ne+1),Ge=Math.max(1,Ve-me+1),ut=Pe*Ge,Ue=M/ut,We=Math.sqrt(B)/Math.max(1,this.roiRadius);let Te=.5;Ue<.45&&(Te+=.2),Ue<.25&&(Te+=.15),We<1.1&&(Te+=.1);const v=Ze-te;return(te>0?1-v/te:0)>.3&&(Te+=.1),Te=Math.max(0,Math.min(1,Te)),!this._isStable({x:oe+.5,y:lt+.5},M)||m?null:{tip:{x:oe+.5,y:lt+.5},axis:{x1:we-G*20,y1:he-xe*20,x2:we+G*20,y2:he+xe*20},area:M,bbox:{x:Ne,y:me,w:Pe,h:Ge},confidence:Te}}accept(r,o){if(this.lastAcceptTs=Date.now(),this.prevTip=null,this.prevArea=0,this.stableCount=0,!this.bg)return;const{width:m}=r,l=this.bg,{x:u,y:x,w:S,h:C}=o.bbox,k=.5;for(let E=x;E<x+C;E++)for(let $=u;$<u+S;$++){const W=E*m+$,y=W*4,w=r.data[y],Z=r.data[y+1],D=r.data[y+2],ge=.299*w+.587*Z+.114*D;l[W]=(1-k)*l[W]+k*ge}}_isStable(r,o){const m=(l,u)=>Math.hypot(l.x-u.x,l.y-u.y)<=6;if(!this.prevTip)return this.prevTip={...r},this.prevArea=o,this.stableCount=1,!1;if(m(this.prevTip,r)&&Math.abs(o-this.prevArea)/Math.max(1,o)<.3)this.prevTip={...r},this.prevArea=o,this.stableCount++;else return this.prevTip={...r},this.prevArea=o,this.stableCount=1,!1;return this.stableCount>=this.requireStableN}_dilate(r,o,m){const l=new Uint8Array(r.length);for(let u=0;u<m;u++)for(let x=0;x<o;x++){let S=0;for(let C=-1;C<=1;C++){for(let k=-1;k<=1;k++){const E=u+C,$=x+k;if(!(E<0||E>=m||$<0||$>=o)&&r[E*o+$]){S=1;break}}if(S)break}l[u*o+x]=S}r.set(l)}_erode(r,o,m){const l=new Uint8Array(r.length);for(let u=0;u<m;u++)for(let x=0;x<o;x++){let S=1;for(let C=-1;C<=1;C++){for(let k=-1;k<=1;k++){const E=u+C,$=x+k;if(!(E<0||E>=m||$<0||$>=o)&&!r[E*o+$]){S=0;break}}if(!S)break}l[u*o+x]=S}r.set(l)}}function Yl(s){try{if(!s||typeof s!="object")return null;if((s.type==="dart"||s.kind==="dart"||s.event==="dart")&&typeof s.value=="number"){const r=ki(s.ring);return Di(s.value,r)}if(typeof s.value=="number"&&s.ring){const r=ki(s.ring);return Di(s.value,r)}if(typeof s.score=="string"){const r=s.score.trim().toUpperCase();if(r==="50"||r==="DBULL"||r==="INNER_BULL")return{value:50,ring:"INNER_BULL",sector:null,mult:0};if(r==="25"||r==="BULL"||r==="OBULL")return{value:25,ring:"BULL",sector:null,mult:0};const o=r.match(/^(S|D|T)(\d{1,2})$/);if(o){const m=o[1]==="S"?1:o[1]==="D"?2:3,l=parseInt(o[2],10);if(l>=1&&l<=20)return{value:l*m,ring:m===1?"SINGLE":m===2?"DOUBLE":"TRIPLE",sector:l,mult:m}}}if(typeof s.sector=="number"&&typeof s.mult=="number"){const r=Math.max(1,Math.min(20,Math.floor(s.sector))),o=s.mult===1?1:s.mult===2?2:3;return{value:r*o,ring:o===1?"SINGLE":o===2?"DOUBLE":"TRIPLE",sector:r,mult:o}}if(s.bull){const r=String(s.bull).toLowerCase()==="inner"||s.bull===!0;return{value:r?50:25,ring:r?"INNER_BULL":"BULL",sector:null,mult:0}}}catch{}return null}function ki(s){const r=String(s||"").toUpperCase();return r.startsWith("TR")?"TRIPLE":r.startsWith("DO")?"DOUBLE":r.startsWith("SI")?"SINGLE":r==="INNER_BULL"||r==="DBULL"||r==="50"||r==="IBULL"?"INNER_BULL":r==="BULL"||r==="25"||r==="OBULL"||r==="OUTER_BULL"?"BULL":r==="MISS"||r==="0"?"MISS":"SINGLE"}function Di(s,r){const o=Math.max(0,Math.min(60,Math.round(Number(s)||0)));return r==="INNER_BULL"?{value:50,ring:r}:r==="BULL"?{value:25,ring:r}:{value:o,ring:r}}function Jl(s,r){let o=null,m=!0,l=null,u=0;const x=400,S=[],C=new Set;function k($,W){const y=typeof $?.id=="string"||typeof $?.id=="number"?String($.id):null;if(y){if(C.has(y))return;if(C.add(y),S.push(y),S.length>200){const D=S.shift();D&&C.delete(D)}}const w=`${W.value}|${W.ring}|${W.sector??""}|${W.mult??""}`,Z=Date.now();w===l&&Z-u<x||(l=w,u=Z,r(W))}function E(){if(m)try{o=new WebSocket(s),o.onmessage=$=>{try{const W=JSON.parse($.data),y=Yl(W);y&&k(W,y)}catch{}},o.onclose=()=>{o=null,setTimeout(E,1500)},o.onerror=()=>{}}catch{setTimeout(E,2e3)}}return E(),{close:()=>{m=!1;try{o?.close()}catch{}}}}function ja({storageKey:s,children:r,className:o,defaultWidth:m=640,defaultHeight:l=360,minWidth:u=320,minHeight:x=200,maxWidth:S=1600,maxHeight:C=1200,autoFill:k=!1}){const[E,$]=n.useState(()=>{try{const M=localStorage.getItem(s);if(M)return JSON.parse(M)}catch{}return k?{width:m}:{width:m,height:l}}),W=n.useRef(null),y=n.useRef(null);n.useEffect(()=>{function M(){try{localStorage.removeItem(s)}catch{}$({width:m,height:l})}return window.addEventListener("ndn:layout-reset",M),window.addEventListener("ndn:camera-reset",M),()=>{window.removeEventListener("ndn:layout-reset",M),window.removeEventListener("ndn:camera-reset",M)}},[s,m,l]),n.useEffect(()=>{try{localStorage.setItem(s,JSON.stringify(E))}catch{}},[E,s]);function w(M,ee,Ne){return Math.max(ee,Math.min(Ne,M))}function Z(M,ee){M.preventDefault();const Ne=y.current;if(!Ne)return;const me=Ne.getBoundingClientRect();W.current={x:M.clientX,y:M.clientY,w:me.width,h:me.height,dir:ee},window.addEventListener("mousemove",D),window.addEventListener("mouseup",ge)}function D(M){const ee=W.current;if(!ee)return;const Ne=M.clientX-ee.x,me=M.clientY-ee.y;let Ee=ee.w,Ve=ee.h;ee.dir.includes("e")&&(Ee=w(ee.w+Ne,u,S)),!k&&ee.dir.includes("s")&&(Ve=w(ee.h+me,x,C)),ee.dir.includes("w")&&(Ee=w(ee.w-Ne,u,S)),!k&&ee.dir.includes("n")&&(Ve=w(ee.h-me,x,C)),$({width:Math.round(Ee),height:Math.round(Ve)})}function ge(){window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",ge),W.current=null}function ue(M,ee){const me=M.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"," "].includes(me))return;M.preventDefault();const Ee=me==="ArrowLeft"||me==="ArrowUp"?-20:20;$(Ve=>{const we=Ve.width||m,he=Ve.height||l;let T=we,ae=he;return ee.includes("e")&&(T=w(we+Ee,u,S)),ee.includes("w")&&(T=w(we-Ee,u,S)),!k&&ee.includes("s")&&(ae=w(he+Ee,x,C)),!k&&ee.includes("n")&&(ae=w(he-Ee,x,C)),{width:Math.round(T),height:Math.round(ae)}})}const le={width:k?"100%":E.width?`${E.width}px`:void 0,height:k?"100%":E.height?`${E.height}px`:void 0,maxWidth:"100%",maxHeight:k?"100%":"80vh",position:"relative",...k?{display:"flex",flexDirection:"column",flex:"1 1 auto"}:{}};return e.jsxs("div",{ref:y,className:`${o||""}`,style:le,children:[r,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:M=>Z(M,"nw"),role:"button",tabIndex:0,"aria-label":"Resize north-west",onKeyDown:M=>ue(M,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:M=>Z(M,"ne"),role:"button",tabIndex:0,"aria-label":"Resize north-east",onKeyDown:M=>ue(M,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:M=>Z(M,"sw"),role:"button",tabIndex:0,"aria-label":"Resize south-west",onKeyDown:M=>ue(M,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:M=>Z(M,"se"),role:"button",tabIndex:0,"aria-label":"Resize south-east",onKeyDown:M=>ue(M,"se")})]})}const Hi=$i((s,r)=>({samples:[],addSample:o=>s(m=>({samples:[...m.samples,o]})),clear:()=>s({samples:[]}),export:()=>r().samples.slice()})),Ql=$i(s=>({paused:!1,pauseEndsAt:null,setPaused:(r,o=null)=>s({paused:r,pauseEndsAt:o??null})})),Zl=1,eo=120,er=400,to=450,so=5e3,no=150,ro=.85,ao=6500,De=n.forwardRef(function({onVisitCommitted:r,showToolbar:o=!0,onAutoDart:m,immediateAutoCommit:l=!1,hideInlinePanels:u=!1,scoringMode:x="x01",onGenericDart:S,onGenericReplace:C,x01DoubleInOverride:k,onAddVisit:E,onEndLeg:$,cameraAutoCommit:W="parent"},y){const w=n.useRef(null),{preferredCameraId:Z,preferredCameraLabel:D,setPreferredCamera:ge,autoscoreProvider:ue,autoscoreWsUrl:le,cameraAspect:M,cameraFitMode:ee,autoCommitMode:Ne="wait-for-clear",cameraEnabled:me,setCameraEnabled:Ee,preferredCameraLocked:Ve,hideCameraOverlay:we,setHideCameraOverlay:he}=Qe();Qe(a=>a.preserveCalibrationOverlay);const T=ue==="manual",[ae,g]=n.useState([]),Ze=n.useRef(null),z=n.useRef(null),[ct,te]=n.useState(!1),G=Ir(),xe=D==="Phone Camera",Ye=G.getMediaStream?.()||null,et=G.isStreaming,Ie=xe&&G.mode==="phone"&&et&&!!Ye,se=ct||et||!1,[ve,fe]=n.useState(!1),[$t,ps]=n.useState(null),{H:ze,imageSize:tt,overlaySize:oe,reset:lt,_hydrated:St,locked:Be}=Rl();n.useEffect(()=>{Ve&&!we&&he(!0)},[Ve,we,he]);const[B,Pe]=n.useState(""),[Ge,ut]=n.useState(""),[Ue,We]=n.useState(0),[Te,v]=n.useState("MISS"),[p,L]=n.useState(0),[j,A]=n.useState(0),[P,_]=n.useState([]),[qe,be]=n.useState(0),[Ct,st]=n.useState(0),[Le,Gt]=n.useState(!1),qt=n.useRef(null),ds=n.useRef(null),_e=!l&&Ne!=="immediate",[Ys,gs]=n.useState(0),[tr,La]=n.useState([]),rt=n.useRef(null),Oe=n.useRef([]),vs=n.useRef(0),ne=n.useRef(0),q=n.useRef(!1),kt=n.useRef(null),us=n.useRef(0),js=n.useRef(null),[Bs,ms]=n.useState([]),[kn,sr]=n.useState(!1),Ps=n.useCallback(()=>{ds.current&&(clearTimeout(ds.current),ds.current=null)},[]);n.useImperativeHandle(y,()=>({runDetectionTick:()=>{try{js.current&&js.current()}catch{}}}));const Ns=n.useCallback(a=>{const d=[...Oe.current.slice(-8),a];Oe.current=d,ms(d);try{window.ndnCameraDiagnostics=d}catch{}},[]),Ht=n.useCallback(a=>{const d=qt.current;if(d&&(qt.current=null,Ps(),Gt(!1),r))try{r(d.score,d.darts,d.finished)}catch{}},[r,Ps]),Rt=n.useCallback(a=>{if(r){if(!_e){try{r(a.score,a.darts,a.finished)}catch{}return}qt.current=a,Gt(!0),Ps(),ds.current=window.setTimeout(()=>Ht("timeout"),ao)}},[r,_e,Ps,Ht]),hs=n.useCallback(a=>{L(0),A(0),_([]),be(0),st(0),Je(!1);try{window.dispatchEvent(new CustomEvent("ndn:clear-visit-request",{detail:{source:"camera-view",reason:a,ts:Date.now()}}))}catch{}},[]);n.useEffect(()=>{if(!_e)return;const a=()=>Ht("event");return window.addEventListener("ndn:darts-cleared",a),()=>window.removeEventListener("ndn:darts-cleared",a)},[_e,Ht]),n.useEffect(()=>{_e||Ht("timeout")},[_e,Ht]),n.useEffect(()=>()=>Ht("teardown"),[Ht]);const Us=n.useCallback(()=>{hs("indicator"),gs(a=>a+1)},[hs]),Js=n.useCallback(()=>{p===0&&j===0||(hs("toolbar"),gs(a=>a+1))},[hs,p,j]),Qs=n.useCallback(()=>{if(!T)try{window.dispatchEvent(new CustomEvent("ndn:open-camera-manager",{detail:{source:"camera-view",ts:Date.now()}}))}catch(a){console.warn("[CameraView] Failed to request camera manager:",a)}},[T]),Zs=Qe(a=>a.x01DoubleIn),Os=typeof k=="boolean"?!!k:!!Zs,[Dt,Dn]=n.useState({}),ye=Er(a=>a),en=ye.players[ye.currentPlayerIdx]?.id,es=!!(en&&Dt[en]),Br=a=>{en&&Dn(d=>({...d,[en]:a}))},tn=ye?.inProgress,nr=yi(a=>a.setVisit),sn=yi(a=>a.reset);n.useEffect(()=>{try{nr(P,p,j)}catch{}},[P,p,j,nr]),n.useEffect(()=>()=>{try{sn()}catch{}},[sn]);const rr=Er(a=>a.addVisit),ar=Er(a=>a.endLeg),Xt=(a,d,b)=>{try{E?E(a,d,b):rr(a,d,b)}catch{}},Tn=a=>{try{$?$(a):ar(typeof a=="number"?a:0)}catch{}},Ln=Hi(a=>a.addSample),[Fs,Ma]=n.useState(""),[$s,Pr]=n.useState(""),[It,Fe]=n.useState(0),[Ur,ft]=n.useState(!1),[Vt,Je]=n.useState(!1),[ir,Hs]=n.useState(!1),Bt=n.useRef(null),[lr,Wt]=n.useState("auto"),[or,_t]=n.useState(!1),[Or,ws]=n.useState(!1),[Mn,An]=n.useState(!1),En=n.useRef(null),ys=Qe(a=>a.dartTimerEnabled),nn=Qe(a=>a.dartTimerSeconds)||10,[xs,rn]=n.useState(null),Tt=n.useRef(null),Ss=Ql(a=>a.paused),Cs=n.useRef(null),ts=n.useRef(null),Rn=n.useRef(null),In=n.useRef(0),ss=n.useRef(null),ns=n.useRef(0),[rs,an]=n.useState(0),ks=n.useCallback(()=>{try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{source:"camera-view",ts:Date.now()}}))}catch(a){console.warn("[CameraView] Phone camera reconnect dispatch failed:",a)}},[]);n.useEffect(()=>{const a=()=>{T||ws(!0)};return window.addEventListener("ndn:open-autoscore",a),()=>window.removeEventListener("ndn:open-autoscore",a)},[T]),n.useEffect(()=>()=>{try{Bt.current&&clearTimeout(Bt.current)}catch{}},[]),n.useEffect(()=>{const a=()=>An(!0);return window.addEventListener("ndn:open-scoring",a),()=>window.removeEventListener("ndn:open-scoring",a)},[]),n.useEffect(()=>{const a=()=>{gs(d=>d+1),L(0),A(0),_([]),be(0),st(0),Je(!1)};return window.addEventListener("ndn:darts-cleared",a),()=>window.removeEventListener("ndn:darts-cleared",a)},[]),n.useEffect(()=>{La(a=>{if(P.length>a.length){const d=P.length-a.length;return[...a,...Array(d).fill(Ys)]}return P.length<a.length?a.slice(0,P.length):a})},[P,Ys]),n.useEffect(()=>{if(kt.current&&(clearTimeout(kt.current),kt.current=null),T){q.current=!1,ne.current=0,rt.current=null;return}return se?(ne.current=performance.now(),rt.current=null,q.current=!1,us.current=0,kt.current=window.setTimeout(()=>{q.current=!0,kt.current=null},so)):(ne.current=0,rt.current=null,q.current=!1,us.current=0),()=>{kt.current&&(clearTimeout(kt.current),kt.current=null),q.current=!1,us.current=0,js.current=null}},[se,T]),n.useEffect(()=>{let a=!0;async function d(){try{if(!navigator?.mediaDevices?.enumerateDevices)return;const b=await navigator.mediaDevices.enumerateDevices();if(!a)return;g(b.filter(R=>R.kind==="videoinput"))}catch(b){console.warn("[CAMERA] enumerateDevices failed:",b)}}d();try{navigator.mediaDevices.addEventListener("devicechange",d)}catch{try{navigator.mediaDevices.ondevicechange=d}catch{}}return()=>{a=!1;try{navigator.mediaDevices.removeEventListener("devicechange",d)}catch{}}},[]),n.useEffect(()=>{const a=()=>{Wt("manual"),_t(!0)},d=()=>{Wt("auto"),_t(!1)};return window.addEventListener("ndn:open-manual",a),window.addEventListener("ndn:close-manual",d),()=>{window.removeEventListener("ndn:open-manual",a),window.removeEventListener("ndn:close-manual",d)}},[]),n.useEffect(()=>{T&&(Wt("manual"),ws(!1))},[T]),n.useEffect(()=>{try{const a=ye.players[ye.currentPlayerIdx],d=a?.legs?.[a.legs.length-1];if(!a)return;(!d||d.dartsThrown===0)&&Dn(b=>({...b,[a.id]:!1}))}catch{}},[ye.currentPlayerIdx,ye.players?.[ye.currentPlayerIdx]?.legs?.length]),n.useEffect(()=>{const a=!!ys&&tn&&!Ss&&p<3;if(Tt.current&&(clearInterval(Tt.current),Tt.current=null),!a){rn(null);return}return rn(nn),Tt.current=window.setInterval(()=>{rn(d=>{const b=(d??nn)-1;if(b<=0){try{bt(0,"MISS 0","MISS")}catch{}return Tt.current&&(clearInterval(Tt.current),Tt.current=null),0}return b})},1e3),()=>{Tt.current&&(clearInterval(Tt.current),Tt.current=null)}},[ys,nn,p,ye.currentPlayerIdx,ye?.inProgress,Ss]),n.useEffect(()=>{if(!or)return;const a=setInterval(()=>{try{const d=w.current,b=En.current;if(!d||!b)return;const R=d.videoWidth||0,X=d.videoHeight||0;if(!R||!X)return;const K=b.clientWidth||640,H=b.clientHeight||360;b.width!==K&&(b.width=K),b.height!==H&&(b.height=H);const re=b.getContext("2d");if(!re)return;re.imageSmoothingEnabled=!0;const pe=Math.min(K/R,H/X),Ke=Math.round(R*pe),Q=Math.round(X*pe),ce=Math.floor((K-Ke)/2),Se=Math.floor((H-Q)/2);re.fillStyle="#000",re.fillRect(0,0,K,H),re.drawImage(d,ce,Se,Ke,Q)}catch(d){console.warn("Manual preview update error:",d)}},120);return()=>clearInterval(a)},[or]),n.useEffect(()=>()=>{},[]);const ln=xe&&!Ie;async function Ds(){if(!(ve||ct)){if(xe&&Ie){fe(!1);return}fe(!0);try{const a=Z?{video:{deviceId:{exact:Z}},audio:!1}:{video:{facingMode:"environment"},audio:!1};xt("[CAMERA] Using constraints:",a);let d;try{d=await navigator.mediaDevices.getUserMedia(a),xt("[CAMERA] Got stream:",!!d)}catch(b){console.warn("[CAMERA] First attempt failed:",b);const R=b&&(b.name||b.code)||"";if(Z&&(R==="OverconstrainedError"||R==="NotFoundError"))xt("[CAMERA] Trying fallback without deviceId"),d=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else if(!Z&&(R==="OverconstrainedError"||R==="NotFoundError"||R==="NotSupportedError"))xt("[CAMERA] Trying fallback for facingMode not supported"),d=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw b}if(w.current){xt("[CAMERA] Setting stream to video element"),w.current.srcObject=d,xt("[CAMERA] Stream tracks:",d.getTracks().length,"video tracks:",d.getVideoTracks().length),w.current.addEventListener("loadeddata",()=>xt("[CAMERA] Video loadeddata")),w.current.addEventListener("canplay",()=>xt("[CAMERA] Video canplay")),w.current.addEventListener("play",()=>xt("[CAMERA] Video started playing")),w.current.addEventListener("error",b=>console.error("[CAMERA] Video error:",b));try{w.current.play(),xt("[CAMERA] Play called successfully")}catch(b){console.error("[CAMERA] Video play failed:",b),setTimeout(()=>{try{w.current?.play(),xt("[CAMERA] Retry play called")}catch(R){console.error("[CAMERA] Retry play failed:",R)}},100)}try{G.setVideoElementRef?.(w.current),G.setMediaStream?.(d),G.setMode?.("local"),G.setStreaming?.(!0)}catch(b){console.warn("[CAMERA] Failed to sync camera session with local stream:",b)}}else console.error("[CAMERA] Video element not found");te(!0);try{const b=await navigator.mediaDevices.enumerateDevices();g(b.filter(R=>R.kind==="videoinput")),xt("[CAMERA] Found cameras:",b.filter(R=>R.kind==="videoinput").length)}catch(b){console.warn("[CAMERA] Failed to enumerate devices:",b)}}catch(a){console.error("[CAMERA] Camera start failed:",a),alert("Camera permission denied or not available.")}finally{fe(!1)}}}function Vs(){try{const a=G.getMediaStream?.()||null;a&&a.getTracks().forEach(d=>d.stop())}catch{}if(w.current)try{w.current.srcObject=null}catch{}try{G.setMediaStream?.(null),G.setStreaming?.(!1),G.setVideoElementRef?.(null)}catch{}te(!1),fe(!1)}n.useEffect(()=>{const a=w.current;if(!a)return;const d=G.getMediaStream?.()||null,R=(G.getVideoElementRef?.()||null)?.srcObject||null,X=d||R;if(X){a.srcObject!==X&&(a.srcObject=X),a.muted=!0,a.playsInline=!0;try{a.play?.()}catch{}ct||te(!0)}},[G.mode,G.isStreaming,ct,G]);function Ts(){try{if(!Ze.current)return;const a=w.current,d=G.getVideoElementRef?.()||null,b=a&&a.videoWidth>0&&a.videoHeight>0?a:d||a;if(!b)return;const R=b,X=Ze.current;X.width=R.videoWidth,X.height=R.videoHeight;const K=X.getContext("2d");if(!K)return;K.drawImage(R,0,0,X.width,X.height);const H=X.toDataURL("image/png");ps(H)}catch(a){console.warn("Capture error:",a)}}function cr(){return ae.length?e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs",children:[e.jsx("span",{children:"Cam:"}),e.jsxs("select",{className:"bg-black/20 rounded px-1 py-0.5",value:Z||"",onChange:async a=>{if(ve)return;const d=a.target.value||void 0,b=ae.find(R=>R.deviceId===d)?.label;ge(d,b||"",!0),Vs(),await new Promise(R=>setTimeout(R,150));try{await Ds()}catch(R){console.warn("Failed to start camera after device switch:",R),setTimeout(async()=>{try{await Ds()}catch(X){console.error("Camera switch failed after retry:",X),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),ae.map(a=>e.jsx("option",{value:a.deviceId,children:a.label||(a.deviceId?`Camera (${a.deviceId.slice(0,6)})`:"Camera")},a.deviceId))]}),e.jsx("button",{className:"btn btn--ghost btn-sm ml-2",onClick:async()=>{try{const a=await navigator.mediaDevices.enumerateDevices();g(a.filter(d=>d.kind==="videoinput"))}catch(a){console.warn("Rescan failed:",a),alert("Failed to rescan devices. Ensure camera permissions are granted.")}},title:"Rescan connected cameras",children:"Rescan"})]}):null}n.useEffect(()=>{},[ze,tt,se,T,xe,Ve,we]),n.useEffect(()=>{if(T||ue!=="built-in")return;const a=Ir.getState();let b=Qe.getState().preferredCameraLabel==="Phone Camera"?a.getVideoElementRef?.()||null:w.current;if(!b||!ze||!tt)return;let R=!1;const X=b,K=X.videoWidth||0,H=X.videoHeight||0,re=Ze.current;if(!re)return;if(!Cs.current){let Ke=60,Q=18,ce=3;K>0&&H>0&&K*H<1280*720&&(Ke=40,Q=16,ce=2),Cs.current=new Xl({minArea:Ke,thresh:Q,requireStableN:ce,angMaxDeg:70})}const pe=()=>{let Ke=!1;if(!R){try{const Q=X.videoWidth||0,ce=X.videoHeight||0;if(!Q||!ce){ts.current=requestAnimationFrame(pe);return}re.width!==Q&&(re.width=Q),re.height!==ce&&(re.height=ce);const Se=re.getContext("2d",{willReadFrequently:!0});if(!Se){ts.current=requestAnimationFrame(pe);return}Se.drawImage(X,0,0,Q,ce);const pt=Se.getImageData(0,0,Q,ce);us.current++;const Pt=ji(ze,{x:0,y:0}),gt=ji(ze,{x:Is.doubleOuter,y:0}),Yt=Q/tt.w,fs=ce/tt.h,Fr=Pt.x*Yt,Lt=Pt.y*fs,Ks=gt.x*Yt,zs=gt.y*fs,Aa=Math.hypot(Ks-Fr,zs-Lt)*1.08,vt=Cs.current;if(rs>=0&&vt.setROI(Fr,Lt,Math.max(24,Math.min(Math.max(Q,ce),Aa))),!Ss&&p<3&&q.current&&us.current>no){const Xe=vt.detect(pt),Mt=performance.now();if(rt.current&&Mt-rt.current.firstTs>900&&(rt.current=null),Xe&&Xe.confidence>=ro){xt("CameraView: detected raw",Xe.confidence,Xe.tip),xt("CameraView: detected raw",Xe.confidence,Xe.tip);const as=ne.current>0&&Mt-ne.current<to,jt=Il(re,Xe.tip,6),Jt={x:jt.x/Yt,y:jt.y/fs},$e=Ci(ze,Jt),Ae=$e.ring,Nt=$e.base,Qt=`${Ae} ${Nt>0?Nt:""}`.trim(),At=$e.sector??null,ot=Math.max(0,Number($e.mult)||0);let Ut=!1;Pe(Qt),We(Nt),v(Ae);const zt=async J=>{xt("CameraView: applyAutoHit",J.value,J.ring,J.sector),xt("CameraView: applyAutoHit",J.value,J.ring,J.sector);const de=performance.now(),je=`${J.value}|${J.ring}|${J.mult}`;if(!(je===Rn.current&&de-In.current<er)){if(Rn.current=je,In.current=de,J.value>0){Je(!0),Hs(!0);try{Bt.current&&clearTimeout(Bt.current)}catch{}Bt.current=window.setTimeout(()=>{Hs(!1),Bt.current=null},1500);try{if(W==="camera"){try{bt(J.value,J.label,J.ring)}catch{}try{const mt=je,Ce=performance.now();!m||mt===ss.current&&Ce-ns.current<er||(m&&m(J.value,J.ring,{sector:J.sector,mult:J.mult}),ss.current=mt,ns.current=Ce)}catch{}}else if(W==="parent"){let mt=!1;if(m)try{const Ce=je,Re=performance.now();Ce===ss.current&&Re-ns.current<er||(mt=!!await Promise.resolve(m(J.value,J.ring,{sector:J.sector,mult:J.mult})),mt&&(ss.current=Ce,ns.current=Re))}catch{}mt||bt(J.value,J.label,J.ring),mt&&(ss.current=je,ns.current=performance.now())}else{try{bt(J.value,J.label,J.ring)}catch{}try{const mt=je,Ce=performance.now();!m||mt===ss.current&&Ce-ns.current<er||(m&&m(J.value,J.ring,{sector:J.sector,mult:J.mult}),ss.current=mt,ns.current=Ce)}catch{}}}catch{}}else Je(!1);if(J.value<=0)try{m&&m(J.value,J.ring,{sector:J.sector,mult:J.mult})}catch{}}};if(as)rt.current=null,Ut=!0;else if(Ae==="MISS"||Nt<=0){rt.current=null,Je(!1);try{m&&m(Nt,Ae,{sector:At,mult:ot})}catch{}Ut=!0}else{const J=rt.current;!J||J.value!==Nt||J.ring!==Ae?rt.current={value:Nt,ring:Ae,label:Qt,sector:At,mult:ot,firstTs:Mt,frames:1}:rt.current={...J,label:Qt,frames:J.frames+1};const de=rt.current,je=Mt-de.firstTs,mt=de.frames>=Zl||je>=eo,Ce=Mt-vs.current>=er;mt&&Ce&&(zt(de),Ke=!0,rt.current=null,vs.current=Mt,Ut=!0)}Ns({ts:Mt,label:Qt,value:Nt,ring:Ae,pCal:Jt,tip:jt,confidence:Xe.confidence,ready:Ut,accepted:Ut&&Nt>0&&Ae!=="MISS",warmup:as});try{if(Nt>0&&Ae!=="MISS"){const de=z.current;if(de){const je=de.getContext("2d");if(je){const mt=jt.x/Q*de.width,Ce=jt.y/ce*de.height;if(je.save(),je.beginPath(),je.strokeStyle="#f59e0b",je.lineWidth=2,je.arc(mt,Ce,6,0,Math.PI*2),je.stroke(),Xe.axis){const Re=Xe.axis,at=Re.x1/Q*de.width,Zt=Re.y1/ce*de.height,nt=Re.x2/Q*de.width,$r=Re.y2/ce*de.height;je.beginPath(),je.moveTo(at,Zt),je.lineTo(nt,$r),je.stroke()}if(Xe.bbox){const Re=Xe.bbox.x/Q*de.width,at=Xe.bbox.y/ce*de.height,Zt=Xe.bbox.w/Q*de.width,nt=Xe.bbox.h/ce*de.height;je.strokeStyle="#22d3ee",je.strokeRect(Re,at,Zt,nt)}je.restore()}}}}catch{}if(Ut&&!Ke){vt.accept(pt,Xe);try{zt({value:Nt,ring:Ae,label:Qt,sector:At,mult:ot,firstTs:Mt,frames:1})}catch{}}}else rt.current&&Mt-rt.current.firstTs>800&&(rt.current=null)}}catch{}ts.current=requestAnimationFrame(pe),js.current=pe}};return ts.current=requestAnimationFrame(pe),()=>{R=!0,ts.current&&cancelAnimationFrame(ts.current),ts.current=null}},[T,ue,se,ze,tt,Ss,p,rs,Ns]);const Ws=n.useCallback(async()=>{try{if(xe){const a=ae.find(d=>d.kind==="videoinput");a?ge(a.deviceId,a.label||"",!0):ge(void 0,"",!0)}await Ds()}catch(a){console.warn("[CameraView] Local camera fallback failed:",a)}},[ae,xe,ge]);n.useEffect(()=>{try{Cn.getState().setCalibrationStatus({hasHomography:!!ze,imageSize:tt,overlaySize:oe})}catch{}},[ze,tt]),n.useEffect(()=>{if(ue!=="external-ws"||!le)return;const a=Jl(le,d=>{if(!(!q.current||performance.now()-ne.current<5e3))if(m){try{m(d.value,d.ring,{sector:d.sector??null,mult:d.mult??0})}catch{}try{Ln({playerId:ye.players[ye.currentPlayerIdx]?.id??null,sector:d.sector??null,mult:d.mult??0,ring:d.ring,ts:Date.now()})}catch{}}else{const b=d.ring==="INNER_BULL"?"INNER_BULL 50":d.ring==="BULL"?"BULL 25":`${d.ring[0]}${d.value/(d.mult||1)||d.value} ${d.value}`;bt(d.value,b,d.ring);try{Ln({playerId:ye.players[ye.currentPlayerIdx]?.id??null,sector:d.sector??null,mult:d.mult??0,ring:d.ring,ts:Date.now()})}catch{}}});return()=>a.close()},[ue,le]);function on(a){if(!z.current||!ze||!tt)return;const d=z.current.getBoundingClientRect(),b=a.clientX-d.left,R=a.clientY-d.top,X=z.current.width/tt.w,K=z.current.height/tt.h,H={x:b/X,y:R/K},re=Ci(ze,H),pe=`${re.ring} ${re.base>0?re.base:""}`.trim();Pe(pe),We(re.base),v(re.ring),Je(!0);try{if(l&&m){m(re.base,re.ring,{sector:re.sector,mult:re.mult});try{Ln({playerId:ye.players[ye.currentPlayerIdx]?.id??null,sector:re.sector??null,mult:re.mult??0,ring:re.ring,ts:Date.now()})}catch{}Je(!1)}}catch{}}function Bn(a){const d=a.trim().toUpperCase();if(!d)return null;const b=d==="BULL"||d==="50"||d==="DBULL"||d==="IBULL",R=d==="25"||d==="OBULL";if(b)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(R)return{label:"BULL 25",value:25,ring:"BULL"};const X=d.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!X)return null;const K=X[1]||"S",H=parseInt(X[2],10);if(H<1||H>20)return null;const re=K==="S"?1:K==="D"?2:3,pe=K==="S"?"SINGLE":K==="D"?"DOUBLE":"TRIPLE";return{label:`${K}${H} ${H*re}`,value:H*re,ring:pe}}function Pn(){const a=ye;if(!a.players.length)return a.startingScore;const d=a.players[a.currentPlayerIdx],b=d.legs[d.legs.length-1];return b?b.totalScoreRemaining:a.startingScore}function bt(a,d,b){if(_e&&Le){if(!ir){Hs(!0);try{Bt.current&&clearTimeout(Bt.current)}catch{}Bt.current=window.setTimeout(()=>{Hs(!1),Bt.current=null},1200)}return}if(x==="custom"){if(S)try{S(a,b,{label:d})}catch{}if(p>=3){L(1),A(a),_([{label:d,value:a,ring:b}]);return}const ce=p+1;L(ce),A(Se=>Se+a),_(Se=>[...Se,{label:d,value:a,ring:b}]);return}if(p>=3){const ce=j,Se=p;Xt(ce,Se,{preOpenDarts:qe||0,doubleWindowDarts:Ct||0,finishedByDouble:!1,visitTotal:ce});try{const gt=ye.players[ye.currentPlayerIdx]?.name;gt&&Zn(gt,Se,ce)}catch{}const pt=!Os||es||b==="DOUBLE"||b==="INNER_BULL",Pt=pt?a:0;L(1),A(Pt),_([{label:d,value:Pt,ring:b}]),be(pt?0:1),st(0),Os&&!es&&(b==="DOUBLE"||b==="INNER_BULL")&&Br(!0),Rt({score:ce,darts:Se,finished:!1});return}const R=p+1,K=!Os||es||b==="DOUBLE"||b==="INNER_BULL"?a:0;Os&&!es&&(b==="DOUBLE"||b==="INNER_BULL")&&Br(!0);const H=j+K,pe=Pn()-H,Ke=pe===0&&(b==="DOUBLE"||b==="INNER_BULL");if(pe<0||pe===1||pe===0&&!Ke){const Se=(qe||0)+(Os&&!es&&!(b==="DOUBLE"||b==="INNER_BULL")?1:0),pt=pe,Pt=pe+K,gt=Pt>50&&pt<=50||Pt<=50?1:0,Yt=(Ct||0)+gt;Xt(0,R,{preOpenDarts:Se,doubleWindowDarts:Yt,finishedByDouble:!1,visitTotal:0}),L(0),A(0),_([]),be(0),st(0),Rt({score:0,darts:R,finished:!1});return}L(R),A(H),_(ce=>[...ce,{label:d,value:K,ring:b}]),Os&&!es&&!(b==="DOUBLE"||b==="INNER_BULL")&&be(ce=>(ce||0)+1);{const ce=pe,Se=pe+K;(Se>50&&ce<=50||Se<=50)&&st(Pt=>(Pt||0)+1)}if(Ke){Xt(H,R,{preOpenDarts:qe||0,doubleWindowDarts:Ct||0,finishedByDouble:!0,visitTotal:H}),Tn(H),L(0),A(0),_([]),be(0),st(0),Rt({score:H,darts:R,finished:!0});return}R>=3&&(Xt(H,R,{preOpenDarts:qe||0,doubleWindowDarts:Ct||0,finishedByDouble:!1,visitTotal:H}),L(0),A(0),_([]),be(0),st(0),Rt({score:H,darts:R,finished:!1}))}function Un(){if(!(_e&&Le)&&B){if(m)try{m(Ue,Te,void 0)}catch{}else bt(Ue,B,Te);Fe(0),Je(!1)}}function Kt(){if(_e&&Le)return;const a=Bn(Ge);if(!a){alert("Enter like T20, D16, 5, 25, 50");return}if(!Vt||!B||Te==="MISS"||Ue===0){const d=It+1;Fe(d),d>=5&&ft(!0)}else Fe(0);bt(a.value,a.label,a.ring),ut(""),Je(!1)}function On(){if(_e&&Le)return;const a=Bn(Ge);if(!a){alert("Enter like T20, D16, 5, 25, 50");return}if(p===0||P.length===0){Kt();return}if(x==="custom"){if(!Vt||!B||Te==="MISS"||Ue===0){const Q=It+1;Fe(Q),Q>=5&&ft(!0)}else Fe(0);if(_(Q=>[...Q.slice(0,-1),{label:a.label,value:a.value,ring:a.ring}]),C)try{C(a.value,a.ring,{label:a.label})}catch{}ut(""),Je(!1);return}if(!Vt||!B||Te==="MISS"||Ue===0){const Q=It+1;Fe(Q),Q>=5&&ft(!0)}else Fe(0);const d=P[P.length-1],b=p-1,R=j-(d?.value||0),X=Pn(),K=R+a.value,H=b+1,re=X-K,pe=re===0&&(a.ring==="DOUBLE"||a.ring==="INNER_BULL");if(re<0||re===1||re===0&&!pe){Xt(0,H);try{const Q=ye.players[ye.currentPlayerIdx]?.name;Q&&Zn(Q,H,0)}catch{}L(0),A(0),_([]),Rt({score:0,darts:H,finished:!1}),ut(""),Je(!1);return}if(L(H),A(K),_(Q=>[...Q.slice(0,-1),{label:a.label,value:a.value,ring:a.ring}]),pe){Xt(K,H),Tn(K);try{const Q=ye.players[ye.currentPlayerIdx]?.name;Q&&Zn(Q,H,K)}catch{}L(0),A(0),_([]),Rt({score:K,darts:H,finished:!0}),ut(""),Je(!1);return}if(H>=3){Xt(K,H);try{const Q=ye.players[ye.currentPlayerIdx]?.name;Q&&Zn(Q,H,K)}catch{}L(0),A(0),_([]),Rt({score:K,darts:H,finished:!1})}ut(""),Je(!1)}function Fn(){ft(!1),Fe(0);try{window.dispatchEvent(new CustomEvent("ndn:request-calibrate"))}catch{}}function dr(){lt(),ft(!1),Fe(0)}n.useEffect(()=>{function a(d){try{const R=document.activeElement?.tagName?.toLowerCase();d.key==="m"&&R!=="input"&&R!=="textarea"&&(Wt("manual"),_t(!0))}catch{}}return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]);function Me(a,d){if(p>=3||_e&&Le)return;const b=a*(d==="S"?1:d==="D"?2:3),R=d==="S"?"SINGLE":d==="D"?"DOUBLE":"TRIPLE";if(!Vt||!B||Te==="MISS"||Ue===0){const X=It+1;Fe(X),X>=5&&ft(!0)}else Fe(0);bt(b,`${d}${a} ${b}`,R),Je(!1)}function $n(){if(p===0)return;const a=P[P.length-1];L(d=>d-1),A(d=>d-(a?.value||0)),_(d=>d.slice(0,-1))}function _s(){if(p===0||_e&&Le)return;if(x==="custom"){L(0),A(0),_([]);return}const a=j,d=p;Xt(a,d);try{const b=ye.players[ye.currentPlayerIdx]?.name;b&&Zn(b,d,a)}catch{}L(0),A(0),_([]),Rt({score:a,darts:d,finished:!1})}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[o&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!T&&e.jsx("button",{className:`btn px-3 py-1 text-sm ${lr==="auto"?"tab--active":""}`,onClick:()=>{Wt("auto"),_t(!1),ws(!0)},children:"Autoscore"}),e.jsx("button",{className:`btn px-3 py-1 text-sm ${lr==="manual"?"tab--active":""}`,onClick:()=>{Wt("manual"),_t(!0)},title:"Open Manual Correction",children:"Manual Correction"}),T&&e.jsx("span",{className:"text-xs opacity-70",children:"Manual scoring mode active"})]})}),!u&&!T?e.jsxs("div",{className:"card relative camera-fullwidth-card lg:col-span-2",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(ja,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,autoFill:!0,children:[e.jsx(cr,{}),(()=>{const a=M||Qe.getState().cameraAspect||"wide",d=(ee||Qe.getState().cameraFitMode||"fit")==="fit",b=a==="square"?"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black":d?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",R=a==="square"?"relative w-full mx-auto aspect-square bg-black":"relative w-full aspect-[4/3] bg-black",X=()=>e.jsxs("div",{className:R,children:[e.jsx("video",{ref:w,className:b,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:z,className:"absolute inset-0 w-full h-full",onClick:on}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3 cursor-pointer select-none",onDoubleClick:Us,"aria-label":`Visit status: ${P[0]?P[0].value>0?"hit":"miss":"pending"}, ${P[1]?P[1].value>0?"hit":"miss":"pending"}, ${P[2]?P[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(K=>{const H=P[K],re=tr[K],pe=!H,Ke=!!H&&re===Ys,Q=typeof H?.value=="number"?H.value>0:!1,ce=(H?.ring&&H.ring!=="MISS")??!1,pt=Ke?Ke&&(Q||ce)?"bg-emerald-400":"bg-rose-500":"bg-gray-500/70",Pt=Ke&&!pe;return e.jsx("span",{className:`visit-dot ${Pt?"active":"inactive"} ${pt}`},K)}),ys&&xs!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,xs),"s"]})]}),_e&&Le?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return xe?Ie?X():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:ks,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{G.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Ws,disabled:!ae.length,children:"Use Local Camera"})]})]})}):X()})()]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsxs("button",{className:"btn btn--ghost px-3 py-1 text-xs font-semibold",onClick:()=>sr(a=>!a),children:[kn?"Hide":"Show"," detection log"]}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Recent detections: ",Bs.length]})]}),kn&&e.jsx("div",{className:"mt-2 rounded-2xl border border-white/15 bg-slate-900/80 p-3 text-xs text-white font-mono max-h-36 overflow-y-auto space-y-1",children:Bs.length===0?e.jsx("div",{className:"text-center text-slate-400",children:"No autoscore detections yet."}):Bs.slice().reverse().map(a=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"truncate flex-1",title:`Value ${a.value} ${a.ring}`,children:a.label.padEnd(6," ")}),e.jsx("span",{className:"text-slate-400",children:a.confidence.toFixed(2)}),e.jsx("span",{className:`px-2 rounded-full text-[10px] font-semibold ${a.accepted?"bg-emerald-500/80":a.ready?"bg-amber-500/80":"bg-rose-500/80"}`,children:a.accepted?"accepted":a.ready?"queued":"ignored"})]},a.ts))}),tn?e.jsx("div",{className:"absolute top-3 right-3 z-30",children:(()=>{let a="bg-white/90 text-slate-800",d="Manual Correction (M)";Vt&&(!!B&&Te!=="MISS"&&Ue>0?(a="bg-emerald-600 text-white",d=`Manual Correction (M) â€” Autoscore: ${B} (confirmed)`):(a="bg-amber-400 text-black",d=`Manual Correction (M) â€” Autoscore ambiguous: ${B||"â€”"}`));const b="px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90",R=Vt&&!!B&&Te!=="MISS"&&Ue>0,X=ir&&R?"ring-4 ring-emerald-400/60 animate-ping":Vt&&!R?"animate-pulse":"";return e.jsx("button",{className:`${b} ${a} ${X}`,onClick:()=>{Wt("manual"),_t(!0)},title:d,children:"Manual"})})()}):null,e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[xe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${Ie?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:Ie?"ðŸ“± Phone camera stream active":"ðŸ“± Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:ks,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{G.setShowOverlay?.(!G.showOverlay)}catch{}},children:G.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!Ie,onClick:()=>{try{G.clearSession?.()}catch{}},children:"Stop Phone Feed"}),ln&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Ws,disabled:!ae.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:ct?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:Vs,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:Ds,disabled:ve,children:ve?"Connecting Camera...":"Connect Camera"})}),!T&&e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:Qs,title:"Open phone, WiFi, and USB camera options",children:"Camera Devices"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>he(!we),title:"Toggle the board guide overlay",children:we?"Show board guides":"Hide board guides"}),e.jsx("button",{className:`btn ${me?"bg-rose-600 hover:bg-rose-700 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white"}`,onClick:()=>Ee(!me),title:"Toggle whether the camera is used for scoring",children:me?"Disable camera mode":"Enable camera mode"}),e.jsx("button",{className:"btn",onClick:Ts,disabled:!se,children:"Capture Still"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",disabled:!se,onClick:()=>{Cs.current=null,an(a=>a+1)},children:"Reset Autoscore Background"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}):null,tn?e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{className:"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg",title:"Open Manual Correction (M)",onClick:()=>{Wt("manual"),_t(!0)},children:"âœï¸"})}):null,!u&&T&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Manual Scoring"}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:"Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{_t(!0),Wt("manual")},children:"Open Manual Correction"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Manage Pending Visit"})]})]}),e.jsx("canvas",{ref:Ze,className:"hidden"}),Or&&!T&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(Sn,{storageKey:"ndn:autoscore:size",className:"w-full max-w-3xl",defaultWidth:720,defaultHeight:520,minWidth:420,minHeight:320,maxWidth:1400,maxHeight:900,initialFitHeight:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Autoscore"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn btn--ghost",onClick:()=>ws(!1),children:"Close"})})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Click the camera overlay to autoscore. Use Manual Correction if the last auto is off."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:B||"â€”"}),e.jsx("button",{className:"btn",onClick:Un,disabled:p>=3,children:"Add Auto Dart"}),It>0&&e.jsxs("span",{className:"text-sm opacity-80",children:["No-registers: ",It,"/3"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:p>=3,onClick:()=>{if(!Vt||!B||Te==="MISS"||Ue===0){const a=It+1;Fe(a),a>=5&&ft(!0)}else Fe(0);bt(25,"BULL 25","BULL"),Je(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:p>=3,onClick:()=>{if(!Vt||!B||Te==="MISS"||Ue===0){const a=It+1;Fe(a),a>=5&&ft(!0)}else Fe(0);bt(50,"INNER_BULL 50","INNER_BULL"),Je(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"autoscore-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:Fs,onChange:a=>Ma(a.target.value.toUpperCase()),onKeyDown:a=>{if(a.key==="Enter"){const d=Fs.match(/^(S|D|T)(\d{1,2})$/);d&&Me(parseInt(d[2],10),d[1])}}}),e.jsx("datalist",{id:"autoscore-quick-list",children:["D","S","T"].map(a=>Array.from({length:20},(d,b)=>b+1).map(d=>e.jsx("option",{value:`${a}${d}`},`${a}${d}`)))}),e.jsx("button",{className:"btn",disabled:!Fs||p>=3,onClick:()=>{const a=Fs.match(/^(S|D|T)(\d{1,2})$/);if(!a)return;const d=a[1],b=parseInt(a[2],10);Me(b,d)},children:"Add"})]})]})]})})}),or&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex flex-col",children:e.jsxs(vi,{returnFocus:!0,children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{_t(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:En,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:B||"â€”"}),e.jsx("button",{className:"btn",onClick:Un,disabled:p>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-[1.2]",placeholder:"Manual (T20, D16, 5, 25, 50)",value:Ge,onChange:a=>ut(a.target.value),onKeyDown:a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),Kt()),a.key==="Enter"&&a.shiftKey&&(a.preventDefault(),On())}}),e.jsx("button",{className:"btn btn--ghost",onClick:On,disabled:p===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:Kt,disabled:p>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add Â· Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Number pad"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 max-w-sm",children:[["7","8","9","4","5","6","1","2","3","0"].map(a=>e.jsx("button",{className:"btn text-lg",onClick:()=>{ut(d=>/^[SDT]/i.test(d)?d+a:(d||"")+a)},children:a},a)),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:()=>ut(""),children:"Clear"}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 text-white",onClick:()=>ut(a=>(a||"").slice(0,-1)),children:"âŒ«"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>Kt(),disabled:p>=3,children:"Enter"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Tap numbers then press Enter to submit. Use D/T prefixes for doubles/trebles (e.g., D16)."})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:p>=3,onClick:()=>{if(!Vt||!B||Te==="MISS"||Ue===0){const a=It+1;Fe(a),a>=5&&ft(!0)}else Fe(0);bt(25,"BULL 25","BULL"),Je(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:p>=3,onClick:()=>{if(!Vt||!B||Te==="MISS"||Ue===0){const a=It+1;Fe(a),a>=5&&ft(!0)}else Fe(0);bt(50,"INNER_BULL 50","INNER_BULL"),Je(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:$s,onChange:a=>Pr(a.target.value.toUpperCase()),onKeyDown:a=>{if(a.key==="Enter"){const d=$s.match(/^(S|D|T)(\d{1,2})$/);d&&Me(parseInt(d[2],10),d[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(a=>Array.from({length:20},(d,b)=>b+1).map(d=>e.jsx("option",{value:`${a}${d}`},`${a}${d}`)))}),e.jsx("button",{className:"btn",disabled:!$s||p>=3,onClick:()=>{const a=$s.match(/^(S|D|T)(\d{1,2})$/);if(!a)return;const d=a[1],b=parseInt(a[2],10);Me(b,d)},children:"Add"})]})]})]})]})})]})})}),Mn&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsx(vi,{returnFocus:!0,children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",role:"dialog","aria-modal":"true",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>An(!1),"aria-label":"Close scoring dialog",children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(ja,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,children:[e.jsx(cr,{}),(()=>{const d=(Qe.getState().cameraFitMode||"fit")==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",b=()=>e.jsxs("div",{className:"relative w-full aspect-[4/3] bg-black",children:[e.jsx("video",{ref:w,className:d,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:z,className:"absolute inset-0 w-full h-full",onClick:on}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${P[0]?P[0].value>0?"hit":"miss":"pending"}, ${P[1]?P[1].value>0?"hit":"miss":"pending"}, ${P[2]?P[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(R=>{const X=P[R],K=!X,H=!!X&&(typeof X.value=="number"?X.value>0:!0),re=K?"bg-gray-500/70":H?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${re}`},R)}),ys&&xs!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,xs),"s"]})]}),_e&&Le?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return xe?Ie?b():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:ks,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{G.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Ws,disabled:!ae.length,children:"Use Local Camera"})]})]})}):b()})()]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[xe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${Ie?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:Ie?"ðŸ“± Phone camera stream active":"ðŸ“± Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:ks,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{G.setShowOverlay?.(!G.showOverlay)}catch{}},children:G.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!Ie,onClick:()=>{try{G.clearSession?.()}catch{}},children:"Stop Phone Feed"}),ln&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Ws,disabled:!ae.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:ct?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:Vs,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Ds,children:"Connect Camera"})}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:Ts,disabled:!se,children:"Capture Still"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold",disabled:!se,onClick:()=>{Cs.current=null,an(a=>a+1)},children:"Reset Autoscore Background"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[0,1,2].map(a=>{const d=P[a],b=!d,R=!!d&&(typeof d.value=="number"?d.value>0:!0),X=b?"bg-gray-500/70":R?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-2.5 h-2.5 rounded-full shadow ${X}`},a)}),ys&&xs!==null&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold",children:[Math.max(0,xs),"s"]})]}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:P.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):P.map((a,d)=>e.jsx("li",{children:a.label},d))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",p,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",j]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:$n,disabled:p===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:_s,disabled:p===0,children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:Js,disabled:p===0,children:"Clear"})]})]})]})]})})}),Ur&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>{ft(!1),Fe(0)},children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-white",children:"Recalibration Recommended"}),e.jsx("div",{className:"mb-4 text-lg font-semibold text-indigo-200",children:"We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Fn,children:"Go to Calibrate"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:dr,children:"Reset Calibration"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{ft(!1),Fe(0)},children:"Dismiss"})]})]})})]})});function Ti(s,r,o,m){const l=(m-90)*Math.PI/180;return{x:s+o*Math.cos(l),y:r+o*Math.sin(l)}}function Li(s){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(s)*18+9}function io({width:s=320,height:r=320}){const o=Hi(l=>l.samples),m=n.useRef(null);return n.useEffect(()=>{const l=m.current;if(!l)return;const u=l.getContext("2d");if(!u)return;l.width=s,l.height=r,u.clearRect(0,0,s,r);const x=s/2,S=r/2,C=Math.min(s,r)/(Is.doubleOuter*2+20),k={bullInner:Is.bullInner*C,bullOuter:Is.bullOuter*C,trebleInner:Is.trebleInner*C,trebleOuter:Is.trebleOuter*C,doubleInner:Is.doubleInner*C,doubleOuter:Is.doubleOuter*C};u.strokeStyle="rgba(255,255,255,0.06)",u.lineWidth=1;const E=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const y of E)u.beginPath(),u.arc(x,S,k[y],0,Math.PI*2),u.stroke();const $=[];for(const y of o){let w=Math.random()*360,Z=Math.random()*k.doubleOuter;typeof y.sector=="number"&&y.sector>=1&&y.sector<=20&&(w=Li(y.sector),y.ring==="DOUBLE"?Z=(k.doubleInner+k.doubleOuter)/2:y.ring==="TRIPLE"?Z=(k.trebleInner+k.trebleOuter)/2:y.ring==="INNER_BULL"?Z=k.bullInner*.5:y.ring==="BULL"?Z=k.bullOuter*.8:Z=(k.trebleOuter+k.doubleInner)/2*(.6+Math.random()*.4));const D=Ti(x,S,Z,w);$.push({x:D.x,y:D.y,w:1})}for(const y of $){const w=u.createRadialGradient(y.x,y.y,1,y.x,y.y,60);w.addColorStop(0,"rgba(255,0,0,0.9)"),w.addColorStop(.3,"rgba(255,100,0,0.5)"),w.addColorStop(1,"rgba(255,100,0,0)"),u.fillStyle=w,u.beginPath(),u.arc(y.x,y.y,60,0,Math.PI*2),u.fill()}u.fillStyle="rgba(255,255,255,0.85)",u.font="12px ui-sans-serif";const W={};for(const y of o)y.sector&&(W[y.sector]=(W[y.sector]||0)+1);for(const y of Object.keys(W)){const w=Number(y),Z=Li(w),D=Ti(x,S,k.trebleOuter+18,Z);u.fillText(String(W[w]),D.x-6,D.y+4)}},[o,s,r]),e.jsx("canvas",{ref:m,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}const Rr=[...Array.from({length:20},(s,r)=>({label:`D${r+1}`,score:(r+1)*2})),{label:"DBULL",score:50,isBull:!0}];function Mi(s,r){const o=Rr[r];return!!o&&s===o.score}function yn(s){const r=s.trim().toUpperCase();if(!r)return null;if(r==="50"||r==="BULL"||r==="DBULL"||r==="IBULL")return 50;if(r==="25"||r==="OBULL")return 25;const o=r.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!o)return null;const m=o[1]||"S",l=parseInt(o[2],10);return l<1||l>20?null:l*(m==="S"?1:m==="D"?2:3)}const Rs=[...Array.from({length:20},(s,r)=>r+1),25,50],Da=[20,19,18,17,16,15,25];function fa(){const s={};return Da.forEach(r=>{s[r]=0}),{marks:s,points:0}}function lo(s,r,o,m,l=()=>!1){let u=null,x=0;if(o==="BULL"||o==="INNER_BULL"||r===25||r===50)u=25,x=o==="INNER_BULL"||r===50?2:1;else if(typeof m=="number"&&m>=15&&m<=20)u=m,o==="TRIPLE"?x=3:o==="DOUBLE"?x=2:x=1;else if(r){const y=[20,19,18,17,16,15];for(const w of y){if(r===w){u=w,x=1;break}if(r===w*2){u=w,x=2;break}if(r===w*3){u=w,x=3;break}}!u&&(r===25||r===50)&&(u=25,x=r===50?2:1)}if(!u)return 0;const S=s.marks[u],C=Math.max(0,3-S),k=Math.min(C,x),E=Math.max(0,x-k),$=S+k;s.marks[u]=$>3?3:$;let W=0;return E>0&&!l(u)&&(u===25?o==="INNER_BULL"?W+=50*E:W+=25*E:W+=u*E),s.points+=W,W}function oo(s){return Da.every(r=>(s.marks[r]||0)>=3)}function ba(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function co(s){return s.round}function uo(s,r,o,m){if(s.finished)return 0;const l=co(s);let u=0;return typeof m=="number"&&m===l?o==="TRIPLE"?(u=l*3,s.turnHits.triples++):o==="DOUBLE"?(u=l*2,s.turnHits.doubles++):o==="SINGLE"&&(u=l*1,s.turnHits.singles++):!m&&(r===l||r===l*2||r===l*3)&&(r===l*3?(u=l*3,s.turnHits.triples++):r===l*2?(u=l*2,s.turnHits.doubles++):r===l&&(u=l,s.turnHits.singles++)),s.score+=u,u}function mo(s){if(!s.finished){if(s.turnHits.singles>0&&s.turnHits.doubles>0&&s.turnHits.triples>0){s.shanghaiAchieved=!0,s.finished=!0;return}const r=s.round+1;r>20?s.finished=!0:s.round=r}s.turnHits={singles:0,doubles:0,triples:0}}function pa(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function Vi(s){return s.targets[s.stage]||null}function ho(s,r,o,m){if(s.finished)return 0;const l=Vi(s);if(!l)return 0;let u=0;switch(l.kind){case"NUMBER":{typeof m=="number"&&m===l.num?o==="TRIPLE"?u=l.num*3:o==="DOUBLE"?u=l.num*2:o==="SINGLE"&&(u=l.num):!m&&(r===l.num||r===l.num*2||r===l.num*3)&&(u=r),u>0&&(s.hitThisRound=!0);break}case"DOUBLE":{(o==="DOUBLE"&&m===l.num||r===l.num*2)&&(u=l.num*2,s.hitThisRound=!0);break}case"TRIPLE":{(o==="TRIPLE"&&m===l.num||r===l.num*3)&&(u=l.num*3,s.hitThisRound=!0);break}case"BULL":{(o==="BULL"||o==="INNER_BULL"||r===25||r===50)&&(u=o==="INNER_BULL"||r===50?50:25,s.hitThisRound=!0);break}case"ANY_NUMBER":{r>0&&(u=r,s.hitThisRound=!0);break}}return s.score+=u,u}function xo(s){s.finished||(s.hitThisRound||(s.score=Math.floor(s.score/2)),s.hitThisRound=!1,s.stage+=1,s.stage>=s.targets.length&&(s.finished=!0))}function ga(){return{round:1,score:0,target:"HIGH",finished:!1}}function fo(s,r,o,m){if(s.finished)return 0;let l=0;if(s.target==="HIGH")if(o==="INNER_BULL")l=50;else if(typeof m=="number"){const x=m*(o==="TRIPLE"?3:o==="DOUBLE"?2:1);m>=20&&(l=x)}else r>=40&&(l=r);else if(typeof m=="number"){const x=m*(o==="TRIPLE"?3:o==="DOUBLE"?2:1);m<=10&&(l=x)}else r>0&&r<=30&&(l=r);return s.score+=l,l}function bo(s){if(!s.finished){if(s.round+=1,s.round>10){s.finished=!0;return}s.target=s.target==="HIGH"?"LOW":"HIGH"}}function po(s,r=3){return{number:s,lives:r,isKiller:!1,eliminated:!1}}function go(s){const r=Array.from({length:20},(m,l)=>l+1),o={};for(const m of s){const l=Math.floor(Math.random()*r.length),u=r.splice(l,1)[0];o[m]=u}return o}function Ai(s,r,o,m){const l=r[s];if(!l||!m||!o)return{becameKiller:!1};if(!l.isKiller&&o==="DOUBLE"&&m===l.number)return l.isKiller=!0,{becameKiller:!0};if(l.isKiller&&(o==="DOUBLE"||o==="TRIPLE")){const u=Object.keys(r).find(x=>x!==s&&!r[x].eliminated&&r[x].number===m);if(u){const x=r[u],S=o==="TRIPLE"?2:1;return x.lives=Math.max(0,x.lives-S),x.lives===0&&(x.eliminated=!0),{becameKiller:!1,victimId:u,livesRemoved:S}}}return{becameKiller:!1}}function Ei(s){const r=Object.entries(s).filter(([,o])=>!o.eliminated&&o.lives>0);return r.length===1?r[0][0]:null}function Ri(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function vo(s,r,o,m){if(s.finished)return 0;let l=0;if(typeof m=="number"&&m===s.inning?o==="TRIPLE"?l=3:o==="DOUBLE"?l=2:l=1:!m&&(r===s.inning||r===s.inning*2||r===s.inning*3)&&(l=r===s.inning*3?3:r===s.inning*2?2:1),s.score+=l,s.dartsThisInning+=1,s.dartsThisInning>=3){const u=s.inning+1;u>9?s.finished=!0:(s.inning=u,s.dartsThisInning=0)}return l}const jo={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function Ii(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function No(s,r,o,m){if(s.finished)return!1;const l=jo[s.hole];if(s.dartsThisHole+=1,typeof m=="number"&&m===l&&(o==="SINGLE"||o==="DOUBLE"||o==="TRIPLE")||!m&&(r===l||r===l*2||r===l*3)){s.strokes+=s.dartsThisHole;const x=s.hole+1;return x>18?s.finished=!0:(s.hole=x,s.dartsThisHole=0),!0}if(s.dartsThisHole>=3){s.strokes+=3;const x=s.hole+1;x>18?s.finished=!0:(s.hole=x,s.dartsThisHole=0)}return!1}const Wi={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function Bi(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function wo(s){const r=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[o,m,l]of r)if(s[o]&&s[o]===s[m]&&s[o]===s[l])return s[o];return s.every(o=>o)?"Draw":null}function yo(s,r,o,m,l){if(s.finished||s.board[r])return!1;const u=Wi[r];let x=!1;if(u.type==="BULL"?x=m==="BULL"||m==="INNER_BULL"||o===25||o===50:u.type==="NUM"&&typeof u.num=="number"&&(typeof l=="number"&&l===u.num||!l&&(o===u.num||o===u.num*2||o===u.num*3))&&(x=!0),!x)return!1;s.board[r]=s.turn;const S=wo(s.board);return S?(s.finished=!0,s.winner=S,!0):(s.turn=s.turn==="X"?"O":"X",!0)}function Na(){return{targetIndex:0,darts:0,finished:!1}}const _i=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25],va=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","Bull"];function So(s){return _i[s.targetIndex]}function wa(s,r,o){if(s.finished)return s;const m=So(s);if(!(o==="SINGLE"&&r===m||o==="DOUBLE"&&r===m||o==="TRIPLE"&&r===m||o==="INNER_BULL"&&m===25))return s;const u=s.targetIndex+1,x=u>=_i.length;return{targetIndex:u,darts:s.darts+1,finished:x}}function Pi(s,r){return wa(s,r,"SINGLE")}function Co(){return Na()}function ya(s=50){return{score:0,darts:0,finished:!1,target:s}}const ko=[5,10,15,20,25,50];function Do(s){return ko.includes(s)}function Sa(s,r,o){if(s.finished)return s;if(!Do(r))return{...s,darts:s.darts+1};const m=s.score+r,l=m>=s.target;return{score:l?s.target:m,darts:s.darts+1,finished:l,target:s.target}}function Ui(s,r){return Sa(s,r)}function To(s=50){return ya(s)}function Ca(s=70){return{score:0,darts:0,finished:!1,target:s}}const Lo=[7,14,21];function Mo(s){return Lo.includes(s)}function ka(s,r,o){if(s.finished)return s;if(!Mo(r))return{...s,darts:s.darts+1};const m=s.score+r,l=m>=s.target;return{score:l?s.target:m,darts:s.darts+1,finished:l,target:s.target}}function Oi(s,r){return ka(s,r)}function Ao(s=70){return Ca(s)}const Ta=[20,19,18,17,16,15,14,13,12,25];function Fi(){const s={};return Ta.forEach(r=>{s[r]=0}),{marks:s,points:0}}function Eo(s,r,o,m,l=()=>!1){let u=null,x=0;if(o==="BULL"||o==="INNER_BULL"||r===25||r===50)u=25,x=o==="INNER_BULL"||r===50?2:1;else if(typeof m=="number"&&m>=12&&m<=20)u=m,o==="TRIPLE"?x=3:o==="DOUBLE"?x=2:x=1;else if(r){for(const y of[20,19,18,17,16,15,14,13,12]){if(r===y){u=y,x=1;break}if(r===y*2){u=y,x=2;break}if(r===y*3){u=y,x=3;break}}!u&&(r===25||r===50)&&(u=25,x=r===50?2:1)}if(!u)return 0;const S=s.marks[u],C=Math.max(0,3-S),k=Math.min(C,x),E=Math.max(0,x-k),$=S+k;s.marks[u]=$>3?3:$;let W=0;return E>0&&!l(u)&&(u===25?o==="INNER_BULL"?W+=50*E:W+=25*E:W+=u*E),s.points+=W,W}function Ro(s){return Ta.every(r=>(s.marks[r]||0)>=3)}function Io({left:s,right:r,className:o="",sticky:m=!0}){return e.jsxs("div",{className:`${m?"sticky top-0":""} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${o}`,children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:s}),e.jsx("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:r})]})}function os({gameMode:s,players:r,matchScore:o,gameRules:m}){return!r||r.length===0?null:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:r.map((l,u)=>e.jsxs("div",{className:`rounded-lg border p-3 ${l.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-2 uppercase tracking-wide ${l.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:l.name}),e.jsxs("div",{className:"space-y-1 text-sm",children:[s==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Legs Won",value:`â— ${l.legsWon||0}`,highlight:!0}),e.jsx(ie,{label:"Score",value:l.score||0,mono:!0,bold:!0}),e.jsx(ie,{label:"Last Score",value:l.lastScore||"0",mono:!0}),e.jsx(ie,{label:"C/Out Rate",value:`${l.checkoutRate||0}%`,mono:!0}),e.jsx(ie,{label:"Best Leg",value:l.bestLeg||"â€”",mono:!0}),l.matchAvg!==void 0&&l.allTimeAvg!==void 0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[e.jsx(ie,{label:"Match Avg",value:l.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:l.matchAvg>0}),e.jsx(Bo,{matchAvg:l.matchAvg,allTimeAvg:l.allTimeAvg})]})})]}),(s==="Cricket"||s==="American Cricket")&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Closed",value:Po(l.closed),mono:!0}),e.jsx(ie,{label:"Points",value:l.points||0,mono:!0,bold:!0}),e.jsx(ie,{label:"Status",value:Uo(l),highlight:l.isCurrentTurn})]}),(s==="Shanghai"||s==="Halve It")&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:s==="Shanghai"?"Round":"Stage",value:l.round||1,mono:!0}),e.jsx(ie,{label:"Target",value:l.target||"â€”",mono:!0}),e.jsx(ie,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Killer"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Target #",value:l.number||"â€”",mono:!0,bold:!0}),e.jsx(ie,{label:"Lives",value:l.lives||0,mono:!0,bold:!0}),l.eliminated&&e.jsx(ie,{label:"Status",value:"ELIMINATED",highlight:!1})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Round",value:l.round||1,mono:!0}),e.jsx(ie,{label:"Target",value:l.target||"High",mono:!0}),e.jsx(ie,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),(s==="Double Practice"||s==="Treble Practice"||s==="Around the Clock")&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Target",value:l.target||"â€”",mono:!0,bold:!0}),e.jsx(ie,{label:"Hits",value:l.hits||0,mono:!0,bold:!0}),l.totalNeeded&&e.jsx(ie,{label:"Progress",value:`${l.hits||0} / ${l.totalNeeded}`,mono:!0})]}),(s==="Count-Up"||s==="High Score"||s==="Low Score")&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Round",value:l.round||1,mono:!0}),e.jsx(ie,{label:"Score",value:l.score||0,mono:!0,bold:!0}),s==="High Score"&&e.jsx(ie,{label:"Best",value:l.bestScore||0,mono:!0})]}),(s==="Checkout 170"||s==="Checkout 121")&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Remaining",value:l.remaining||0,mono:!0,bold:!0}),e.jsx(ie,{label:"Attempts",value:l.attempts||0,mono:!0}),e.jsx(ie,{label:"Successes",value:l.successes||0,mono:!0})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Target",value:`D${l.target||1}`,mono:!0,bold:!0}),e.jsx(ie,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Inning",value:l.inning||1,mono:!0}),e.jsx(ie,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Hole",value:l.hole||1,mono:!0}),e.jsx(ie,{label:"Strokes",value:l.strokes||0,mono:!0,bold:!0})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Turn",value:l.turn||1,mono:!0}),l.winner&&e.jsx(ie,{label:"Result",value:"WINNER!",highlight:!0})]}),o&&(s==="X01"||s==="Cricket"||s==="American Cricket")&&u===1&&e.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:e.jsx(ie,{label:"Match",value:o,mono:!0,bold:!0,highlight:!0})})]})]},u))})}function ie({label:s,value:r,mono:o=!1,bold:m=!1,highlight:l=!1}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"opacity-70",children:[s,":"]}),e.jsx("span",{className:`${o?"font-mono":""} ${m?"font-semibold":""} ${l?"text-emerald-300":""}`,children:r})]})}function Bo({matchAvg:s,allTimeAvg:r}){const o=s-r,m=o>0,l=Math.abs(o)<.01;let u="",x="text-slate-300";return l?(u="= All-time",x="text-slate-300"):m?(u=`+${o.toFixed(2)} vs avg`,x="text-emerald-400"):(u=`${o.toFixed(2)} vs avg`,x="text-orange-400"),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-70",children:"AVG vs Avg:"}),e.jsx("span",{className:`font-mono font-semibold ${x}`,children:u})]})}function Po(s){return!s||Object.keys(s).length===0?"â€”":Object.entries(s).filter(([o,m])=>m===3).map(([o])=>o==="25"?"B":o).join(",")||"â€”"}function Uo(s){if(!s.closed)return"Starting";const r=Object.values(s.closed).filter(o=>o===3).length;return r===0?"No marks":r<7?`${r}/7`:"Closing in"}function Ft(s){return(r,o)=>{s(r)}}function Oo(s){const{match:r,commitManualVisitTotal:o,endTurn:m}=s;return{addVisit:(l,u=3,x)=>{if(o){o(l);return}try{r.addVisit(l,u,x)}catch{r.addVisit(l,u)}},undoVisit:()=>{r.undoVisit()},nextPlayer:()=>{if(m)try{m(0)}catch{r.nextPlayer()}else r.nextPlayer()},endLeg:l=>{typeof l=="number"?r.endLeg(l):r.endLeg(0)},endGame:()=>{r.endGame()}}}function Xs(s,r,o,m,l,u,x,S,C,k,E,$,W,y,w,Z,D,ge,ue,le,M,ee,Ne,me,Ee,Ve,we){return n.useMemo(()=>{const he=[];if(s==="X01"){let T=0,ae=0,g=0;if(ge&&ge.length>0){for(const Ye of ge)Ye.dartsThrown&&Ye.totalScored&&(ae+=Ye.dartsThrown,g+=Ye.totalScored);ae>0&&(T=g/ae*3)}const xe=($??0)>0?S??0:k??null??(u??0);if(he.push({name:"You",isCurrentTurn:!!ue,legsWon:m||0,score:r||0,lastScore:xe,checkoutRate:w&&w>0?Math.round((y||0)/w*100):0,bestLeg:ge&&ge.length>0?`${Math.min(...ge.map(Ye=>Ye.doubleDarts+(Ye.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:T,allTimeAvg:Bl("You")||0}),le&&le!=="None"){const fe=(W??0)>0?C??0:E??null??(x??0);he.push({name:`${le} AI`,isCurrentTurn:!ue,legsWon:l||0,score:o||0,lastScore:fe,checkoutRate:D&&D>0?Math.round((Z||0)/D*100):0,bestLeg:"â€”"})}}return s==="Cricket"&&(he.push({name:"You",isCurrentTurn:!!ue,closed:ee?.marks||{},points:ee?.points||0}),le&&le!=="None"&&he.push({name:`${le} AI`,isCurrentTurn:!ue,closed:{},points:0})),s==="Shanghai"&&(he.push({name:"You",isCurrentTurn:!!ue,round:Ne?.round||1,target:Ne?.target||1,score:Ne?.score||0}),le&&le!=="None"&&he.push({name:`${le} AI`,isCurrentTurn:!ue,round:Ne?.round||1,target:Ne?.target||1,score:0})),s==="Killer"&&me&&me.length>0&&me.forEach((T,ae)=>{const g=Ee?.[T.id];he.push({name:T.name,isCurrentTurn:ae===we,number:Ve?.[T.id],lives:g?.lives||0,eliminated:g?.eliminated||!1})}),he},[s,r,o,m,l,u,x,S,C,k,E,$,W,y,w,Z,D,ge,ue,le,ee,Ne,me,Ee,Ve,we])}const Fo=["Easy","Medium","Hardened"];function cs(s,r,o){return Math.max(r,Math.min(o,s))}const $o=6500;function Ho(s,r){let o=0;if(r==="Easy"){const m=[22,26,41,45,60];o=m[Math.floor(Math.random()*m.length)]}else r==="Medium"?o=Math.round(cs(60+(Math.random()*30-15),30,100)):o=Math.round(cs(80+(Math.random()*20-10),50,120));return s<=0?0:o>s?[100,85,81,60,57,45,41,26,22,20,1].find(l=>l<=s)??0:o}function Vo({onClose:s}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:s,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const Wo="http://localhost:8787";function tc({user:s}){const{offlineLayout:r,favoriteDouble:o,callerEnabled:m,callerVoice:l,callerVolume:u,speakCheckoutOnly:x,rememberLastOffline:S,setLastOffline:C,autoStartOffline:k,cameraScale:E,setCameraScale:$,cameraAspect:W="wide",setCameraAspect:y,cameraFitMode:w="fill",setCameraFitMode:Z,cameraEnabled:D,textSize:ge,boxSize:ue,autoscoreProvider:le,autoCommitMode:M="wait-for-clear",matchType:ee="singles",setMatchType:Ne,teamAName:me="Team A",setTeamAName:Ee,teamBName:Ve="Team B",setTeamBName:we}=Qe(),he=le==="manual",T=D&&!he,ae=D&&!he&&M!=="immediate",[g,Ze]=n.useState("X01"),[z,ct]=n.useState(501),[te,G]=n.useState("None"),[xe,Ye]=n.useState(!1),[et,Ie]=n.useState(!1),[se,ve]=n.useState(z),[fe,$t]=n.useState(z),[ps,ze]=n.useState(!1),[tt,oe]=n.useState(!1),[lt,St]=n.useState(1),[Be,B]=n.useState(0),Pe=Er(),[Ge,ut]=n.useState(!1),Ue=n.useRef(!1),[We,Te]=n.useState(0),[v,p]=n.useState(null),[L,j]=n.useState(1),[A,P]=n.useState(1),[_,qe]=n.useState([]),[be,Ct]=n.useState(2e3),st=Pl(),[Le,Gt]=n.useState(!1),[qt,ds]=n.useState(r==="modern"),[_e,Ys]=n.useState(r==="modern");n.useEffect(()=>{ds(r==="modern"),Ys(r==="modern")},[r]),n.useEffect(()=>{w!=="fit"&&Z("fit")},[w,Z]);const[gs,tr]=n.useState(1),[La,rt]=n.useState(!1),[Oe,vs]=n.useState(!0);n.useEffect(()=>{const t=()=>fn(!0);return window.addEventListener("ndn:open-camera-manager",t),()=>window.removeEventListener("ndn:open-camera-manager",t)},[]);const[ne,q]=n.useState(0),[kt,us]=n.useState(0),[js,Bs]=n.useState(0),[ms,kn]=n.useState(0),[sr,Ps]=n.useState(0),[Ns,Ht]=n.useState(fa()),[Rt,hs]=n.useState(ba()),[Us,Js]=n.useState(pa()),[Qs,Zs]=n.useState(ga()),[Os,Dt]=n.useState(0),[Dn,ye]=n.useState(1),[en,es]=n.useState(27),[Br,tn]=n.useState(0),[nr,sn]=n.useState(0),[rr,ar]=n.useState(!1),[Xt,Tn]=n.useState(1),[Ln,Fs]=n.useState(0),[Ma,$s]=n.useState(0),Pr=8,[It,Fe]=n.useState(1),[Ur,ft]=n.useState(0),[Vt,Je]=n.useState(0),ir=10,[Hs,Bt]=n.useState(1),[lr,Wt]=n.useState(0),[or,_t]=n.useState(0),Or=10,[ws,Mn]=n.useState(170),[An,En]=n.useState(0),[ys,nn]=n.useState(0),[xs,rn]=n.useState(0),[Tt,Ss]=n.useState(121),[Cs,ts]=n.useState(0),[Rn,In]=n.useState(0),[ss,ns]=n.useState(0),[rs,an]=n.useState(20),[ks,ln]=n.useState(0),[Ds,Vs]=n.useState(0),[Ts,cr]=n.useState(30),[Ws,on]=n.useState(!1),[Bn,Pn]=n.useState(Ri()),[bt,Un]=n.useState(Ii()),[Kt,On]=n.useState(Bi()),[Fn,dr]=n.useState(Fi()),[Me,$n]=n.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[_s,a]=n.useState({}),[d,b]=n.useState({}),[R,X]=n.useState(!1),[K,H]=n.useState(0),[re,pe]=n.useState(0),[Ke,Q]=n.useState(null),[ce,Se]=n.useState(""),[pt,Pt]=n.useState(Na()),[gt,Yt]=n.useState(Na()),[fs,Fr]=n.useState(ya(50)),[Lt,Ks]=n.useState(ya(50)),[zs,Aa]=n.useState(Ca(70)),[vt,Xe]=n.useState(Ca(70)),[Mt,as]=n.useState(0),[jt,Jt]=n.useState(0),[$e,Ae]=n.useState(0),[Nt,Qt]=n.useState(z),[At,ot]=n.useState(0),[Ut,zt]=n.useState(null),[J,de]=n.useState(0),je=n.useRef(0),mt=n.useRef(0),Ce=n.useRef(se),Re=n.useRef($e),at=n.useRef(At),Zt=n.useRef(Nt),nt=n.useRef(J);n.useEffect(()=>{Ce.current=se},[se]),n.useEffect(()=>{Re.current=$e},[$e]),n.useEffect(()=>{at.current=At},[At]),n.useEffect(()=>{Zt.current=Nt},[Nt]),n.useEffect(()=>{nt.current=J},[J]);const[$r,Hn]=n.useState(0);n.useRef(null);const[ur,Hr]=n.useState(0),[Gs,mr]=n.useState(0),[cn,qs]=n.useState(0),[dn,bs]=n.useState(0),[un,mn]=n.useState(null),[Vr,hn]=n.useState(0),[Vn,Wn]=n.useState(0),[Wr,hr]=n.useState(0),[_n,Ea]=n.useState(0),[_r,Ra]=n.useState(0),[Kn,xn]=n.useState(0),[zn,Ia]=n.useState(0),[Kr,Gn]=n.useState(0),[zr,Ba]=n.useState(0),[Pa,xr]=n.useState(0),[Ki,fr]=n.useState(0),[zi,br]=n.useState(0),[Ua,Gr]=n.useState(0),[Gi,qr]=n.useState(0),[qi,Xr]=n.useState(0),[Xi,pr]=n.useState(0),[Yi,Oa]=n.useState(0),[Ji,Yr]=n.useState(!1),[ht,dt]=n.useState(""),[Jr,qn]=n.useState(""),[_o,Ko]=n.useState(""),[Fa,$a]=n.useState(""),[Ha,Qr]=n.useState(""),[Va,Zr]=n.useState(""),[gr,ea]=n.useState(null),[Qi,fn]=n.useState(!1),[Zi,Wa]=n.useState({}),[el,Xn]=n.useState(!1),Ls=n.useRef(null),ta=n.useRef(null),is=n.useCallback(()=>{const t=ta.current;t&&(clearTimeout(t),ta.current=null)},[]),vr=n.useCallback(t=>{if(!m)return;const i=s?.username||"Player";try{Ar(i,t.visitTotal,Math.max(t.remaining,0),l,{volume:u,checkoutOnly:x})}catch{}},[m,l,u,x,s?.username]),jr=n.useCallback((t,i)=>{Xn(!1);const{visitTotal:c,darts:h,preRemaining:f,remaining:O,doubleAttempts:U,finished:Y,doubleWindow:I,highestCheckout:F}=t;Y?(ve(0),Ce.current=0,typeof F=="number"&&F>0&&pr(N=>Math.max(N,F))):(ve(O),Ce.current=O),zt(c),c===180?xr(N=>N+1):c>=140?fr(N=>N+1):c>=100&&br(N=>N+1),I&&U>0&&(Wn(N=>N+U),Y&&hr(N=>N+1)),t.announced||vr(t);try{Cn.getState().recordVisit("offline-x01",h,c,{preRemaining:f,postRemaining:Y?0:O,finish:Y,bust:!1})}catch{}Y&&(p("player"),oe(!0)),wn(Y?0:O),ot(0),at.current=0,Ae(0),Re.current=0,de(0),nt.current=0},[wn,pr,p,ve,zt,ot,Ae,de,oe,xr,fr,br,Wn,hr,vr]),bn=n.useCallback(t=>{const i=Ls.current;i&&(Ls.current=null,is(),jr(i,t))},[is,jr]),_a=n.useCallback(t=>{vr(t),Ls.current={...t,announced:!0},Xn(!0),is(),ta.current=setTimeout(()=>bn("timeout"),$o)},[is,bn,vr]);n.useEffect(()=>{if(!ae)return;const t=()=>bn("event");return window.addEventListener("ndn:darts-cleared",t),()=>window.removeEventListener("ndn:darts-cleared",t)},[ae,bn]),n.useEffect(()=>{ae||bn("timeout")},[ae,bn]),n.useEffect(()=>()=>is(),[is]),n.useEffect(()=>{if($e===0){try{window.dispatchEvent(new CustomEvent("ndn:darts-cleared",{detail:{source:"offline-play",ts:Date.now()}}))}catch{}je.current=0}mt.current=$e},[$e]);const Ms=s?.username||"Player 1",pn=te==="None"?"Player 2":te,Nr=Xs("X01",se,fe,Be,We,jt,Gs,At,cn,Ut,un,$e,dn,Wr,Vn,_r,_n,_,Oe,te),tl=Xs("Cricket",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ns),sl=Xs("Shanghai",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Oe,te,void 0,Ns,Rt),nl=Xs("Killer",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Me,_s,d,K),rl=Xs("Scam"),al=Xs("Fives"),il=Xs("Sevens"),wr=n.useMemo(()=>{const t=Nr||[],i=$e>0?At:Ut??jt,c=dn>0?cn:un??Gs;return t.length===0?{name:Oe?Ms:pn,isCurrentTurn:!0,legsWon:Oe?Be:We,score:Oe?se:fe,lastScore:Oe?i:c}:t.find(h=>h.isCurrentTurn)??t[0]},[Nr,Oe,Ms,pn,Be,We,se,fe,$e,At,Ut,jt,cn,un,Gs,dn]),Ka=n.useMemo(()=>{if(!wr)return[];const{matchAvg:t,allTimeAvg:i,...c}=wr;return[{...c,matchAvg:void 0,allTimeAvg:void 0}]},[wr]),ll=Oe?pn:Ms,ol=wr?.name??(Oe?Ms:pn),cl=Oe?se:fe,dl=Oe?$e>0?At:Ut??jt:dn>0?cn:un??Gs,ke=n.useCallback((t,i=1)=>{!t||i<=0||Wa(c=>({...c,[t]:(c[t]||0)+i}))},[]),He=n.useCallback(t=>{t&&Wa(i=>i[t]===void 0?i:{...i,[t]:0})},[]);Zi[g];const ul=t=>{if(!t.trim())return null;const i=Number(t);return Number.isFinite(i)?cs(Math.round(i),0,z):null},ml=t=>{if(!t.trim())return null;const i=Number(t);return Number.isFinite(i)?Math.max(0,Math.round(i)):null},za=n.useCallback(()=>{Ls.current&&(Ls.current=null),is(),Xn(!1)},[is]);n.useCallback(t=>{const i=cs(t,0,z);za(),ve(i),Ce.current=i;const c=i===0?z:i;Qt(c),Zt.current=c,ot(0),at.current=0,Ae(0),Re.current=0,de(0),nt.current=0,zt(null),Jt(0),q(0),je.current=0,i===0?(p("player"),oe(!0)):(p(null),oe(!1))},[za,ve,z,Qt,ot,Ae,de,zt,Jt,q,p,oe]);const Ga=t=>{const c=ul(Fa);if(c===null){st(`Enter a number between 0 and ${z}`,{type:"error",timeout:2500});return}$t(c),qs(0),bs(0),mn(null),hn(0),mr(0),$a(""),p(null),oe(!1)},qa=n.useCallback((t,i)=>{t==="player"?(B(i),Qr("")):(Te(i),Zr("")),p(null),oe(!1)},[Te,Zr,Qr,p,B,oe]),yr=t=>{const c=ml(t==="player"?Ha:Va);if(c===null){st("Enter a non-negative whole number for legs",{type:"error",timeout:2500});return}ea({target:t,value:c,stage:1})},hl=n.useCallback(()=>{ea(t=>t&&(t.stage===1?{...t,stage:2}:(qa(t.target,t.value),null)))},[qa]),Yn=n.useCallback(()=>{ea(null)},[]);n.useEffect(()=>{if(!gr)return;const t=i=>{i.key==="Escape"&&(i.preventDefault(),Yn())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Yn,gr]);const As=(t=>{switch(t){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(ge),gn=n.useRef(null),vn=n.useRef(null),sa=n.useRef(null),[jn,na]=n.useState("first"),[Sr,Xa]=n.useState(1),xl=n.useRef(null);n.useEffect(()=>{const t=Math.max(1,Math.floor(Number(Sr)||1)),i=jn==="first"?t:Math.max(1,Math.ceil(t/2));St(i)},[jn,Sr]),n.useEffect(()=>{if(!_e){tr(1),rt(!1);return}const t=()=>{const h=gn.current,f=vn.current;if(!h||!f)return;const O=sa.current?sa.current.getBoundingClientRect().height:0,U=Math.max(0,h.clientHeight-O-6),Y=Math.max(0,h.clientWidth-8),I=f.getBoundingClientRect(),F=gs||1,N=I.height/F,V=I.width/F,yt=U>0?U/N:1,ls=Y>0?Y/V:1,Es=Math.min(1,Math.max(.5,Math.min(yt,ls))),Et=N*Es,it=U>0&&Et-U>1;rt(it),tr(Es)};t();const i=window.ResizeObserver,c=i?new i(()=>t()):null;return c&&gn.current&&c.observe(gn.current),c&&vn.current&&c.observe(vn.current),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t);try{c&&gn.current&&c.unobserve(gn.current)}catch{}try{c&&vn.current&&c.unobserve(vn.current)}catch{}}},[_e,gs]),n.useEffect(()=>{const t=i=>{const c=i?.detail?.mode;c&&(Ze(c),Nn())};return window.addEventListener("ndn:auto-start",t),()=>window.removeEventListener("ndn:auto-start",t)},[]),n.useEffect(()=>{const t=i=>{const c=i?.detail?.formatType,h=i?.detail?.formatCount,f=i?.detail?.startScore;(c==="first"||c==="best")&&na(c),typeof h=="number"&&isFinite(h)&&Xa(Math.max(1,Math.floor(h))),typeof f=="number"&&isFinite(f)&&ct(Math.max(1,Math.floor(f)))};return window.addEventListener("ndn:offline-format",t),()=>window.removeEventListener("ndn:offline-format",t)},[]),n.useEffect(()=>{if(!k)return;const t=setTimeout(()=>Nn(),50);return()=>clearTimeout(t)},[k]),n.useEffect(()=>{if(!Le||Oe||te==="None"||$r<=0)return;let t,i=performance.now();const c=h=>{const f=h-i;i=h,Hn(O=>{const U=O-f;if(U<=0){let Y=0,I=0,F=fe;for(bs(0);Y<3&&F>0;){const N=Ho(F,te),V=cs(N-Y*20,0,Math.min(60,F)),yt=F-V;if(mr(V),Hr(Et=>Et+1),Ia(Et=>Et+1),yt<0){F=fe,qs(0),hn(0),I=0,mn(0),bs(0);break}I+=V,qs(Et=>Et+V),Ba(Et=>Et+V);const ls=F,Es=yt;if(ls>50&&Es<=50?hn(1):ls<=50&&hn(Et=>Et+1),F=yt,Y+=1,bs(Y),F===0)break}if($t(F),F===0){I===180?Gr(V=>V+1):I>=140?qr(V=>V+1):I>=100&&Xr(V=>V+1);const N=fe;N<=170&&Oa(V=>Math.max(V,N)),fe<=50&&(Ea(V=>V+(Vr>0?Vr:1)),Ra(V=>V+1)),mn(I),qs(0),hn(0),bs(0),p("ai"),oe(!0)}return F>0&&Y>=3&&(I===180?Gr(N=>N+1):I>=140?qr(N=>N+1):I>=100&&Xr(N=>N+1),mn(I),qs(0),hn(0),bs(0)),bs(0),vs(!0),0}return U}),t=requestAnimationFrame(c)};return t=requestAnimationFrame(c),()=>cancelAnimationFrame(t)},[Le,Oe,te,fe]),n.useEffect(()=>{Pe.inProgress&&(Ue.current||(ut(!0),Ue.current=!0))},[Pe.inProgress]);function Nn(){Ie(!0),ve(z),Ce.current=z,$t(z),ze(!1),Gt(!0),vs(!0),q(0),as(0),Jt(0),Ae(0),Re.current=0,Qt(z),ot(0),zt(null),de(0),Hn(0),Hr(0),mr(0),qs(0),bs(0),mn(null),p(null),B(0),Te(0),qe([]),ln(0),Vs(0),on(!1),xn(0),Ia(0),Gn(0),Ba(0),xr(0),fr(0),br(0),Gr(0),qr(0),Xr(0),pr(0),Oa(0),Wn(0),hr(0),Ea(0),Ra(0),He("X01");const t=Math.max(1,Math.floor(Number(Sr)||1));if(St(jn==="first"?t:Math.max(1,Math.ceil(t/2))),S)try{C({mode:g,x01Start:z,firstTo:lt,aiLevel:te})}catch{}}function fl(){ve(z),Ce.current=z,$t(z),ze(!1),Gt(!0),vs(!0),q(0),as(0),Jt(0),Ae(0),Re.current=0,Qt(z),ot(0),Zt.current=z,at.current=0,zt(null),de(0),nt.current=0,nt.current=0,Hn(0),Hr(0),mr(0),qs(0),bs(0),mn(null),p(null)}function wn(t){Ae(0),Re.current=0,Qt(t===0?z:t),Zt.current=t===0?z:t,de(0),nt.current=0,te!=="None"?(vs(!1),Hn(be)):(Hn(0),vs(!0))}function Jn(t){if(ae&&Ls.current){el||Xn(!0),st("Remove your darts before starting the next throw",{type:"info",timeout:1800});return}ke("X01");const i=Ce.current,c=Re.current,h=at.current,f=Zt.current,O=nt.current,U=i-t,Y=c+1;if(Jt(t),as(it=>it+1),xn(it=>it+1),U<0){try{const it=i,xa=f;Cn.getState().recordVisit("offline-x01",Y,0,{preRemaining:it,postRemaining:xa,bust:!0,finish:!1})}catch{}if(ve(f),Ce.current=f,i<=50){const it=(O||0)+1;Wn(xa=>xa+it)}if(m)try{Ar(s?.username||"Player",0,Math.max(f,0),l,{volume:u,checkoutOnly:x})}catch{}zt(0),q(0),ot(0),at.current=0,de(0),nt.current=0,wn(f);return}ve(U),Ce.current=U,Ae(Y),Re.current=Y;const I=h+t;ot(I),at.current=I,Gn(it=>it+t),q(0);const F=i,N=U,V=F>50&&N<=50,yt=F<=50;V?(de(1),nt.current=1):yt&&(de(it=>it+1),nt.current=(O||0)+1);const ls=nt.current||0,Es=F<=50,Et=Es?Math.max(ls,Math.min(Y,3)):0;if(U===0){const it={visitTotal:I,darts:Y,preRemaining:i,remaining:0,doubleAttempts:Et,finished:!0,doubleWindow:Es,highestCheckout:f<=170?f:null};ae?_a(it):jr(it,"immediate");return}if(Y>=3){const it={visitTotal:I,darts:Y,preRemaining:i,remaining:U,doubleAttempts:Et,finished:!1,doubleWindow:Es,highestCheckout:null};ae?_a(it):jr(it,"immediate");return}}function Cr(){const t=cs(Math.round(Number(ne)||0),0,60);Jn(t)}function wt(t){if(!Number.isFinite(t))return!1;const i=Zt.current,c=Ce.current,h=Re.current,f=at.current,O=h>0||f>0;O&&(ve(i),Ce.current=i,Ae(0),Re.current=0,ot(0),at.current=0,de(0),nt.current=0,Jt(0),q(0),as(N=>Math.max(0,N-h)),xn(N=>Math.max(0,N-h)),Gn(N=>Math.max(0,N-f)),je.current=0);const U=O?i:c,Y=U<=170?170:180,I=cs(Math.round(t),0,Y);ke("X01",3),as(N=>N+3),xn(N=>N+3),Ae(3),Re.current=3,ot(I),at.current=I,zt(I),I===180?xr(N=>N+1):I>=140?fr(N=>N+1):I>=100&&br(N=>N+1);const F=U-I;if(F<0){if(m)try{Ar(Ms,0,Math.max(i,0),l,{volume:u,checkoutOnly:x})}catch{}try{Cn.getState().recordVisit("offline-x01",3,0,{preRemaining:U,postRemaining:i,bust:!0,finish:!1})}catch{}return ve(i),Ce.current=i,zt(0),ot(0),at.current=0,Ae(0),Re.current=0,de(0),nt.current=0,wn(i),!0}if(ve(F),Ce.current=F,Gn(N=>N+I),m)try{Ar(Ms,I,Math.max(F,0),l,{volume:u,checkoutOnly:x})}catch{}if(U<=50&&(Wn(N=>N+3),F===0&&hr(N=>N+1)),F===0){U<=170&&pr(N=>Math.max(N,U));try{Cn.getState().recordVisit("offline-x01",3,I,{preRemaining:U,postRemaining:0,finish:!0,bust:!1})}catch{}return p("player"),oe(!0),Ae(0),Re.current=0,ot(0),at.current=0,de(0),nt.current=0,!0}try{Cn.getState().recordVisit("offline-x01",3,I,{preRemaining:U,postRemaining:F,finish:!1,bust:!1})}catch{}return wn(F),ot(0),at.current=0,Ae(0),Re.current=0,de(0),nt.current=0,!0}const Ot=Oo({match:Pe,commitManualVisitTotal:wt,endTurn:wn}),[kr,Dr]=n.useState(""),Ya=t=>{if(!t){Dr("");return}const i=t.replace(/[^0-9]/g,"");if(!i){Dr("");return}const c=Number(i);if(!Number.isFinite(c))return;const h=Ce.current<=170?170:180,f=cs(Math.round(c),0,h);Dr(String(f))};function Tr(){if(!kr){alert("Enter a number 0â€“180 for visit total");return}const t=Number(kr);if(!Number.isFinite(t)){alert("Enter a number 0â€“180 for visit total");return}const i=Ce.current<=170?170:180,c=cs(Math.round(t),0,i);t>i&&st(`Visit totals cannot exceed ${i}.`,{type:"info",timeout:2200}),wt(c)&&Dr("")}const ra=n.useCallback(()=>{Ls.current&&(Ls.current=null,is(),Xn(!1));const t=Re.current,i=at.current,c=Zt.current;t===0&&i===0||(ve(c),Ce.current=c,Ae(0),Re.current=0,ot(0),at.current=0,de(0),nt.current=0,Jt(0),q(0),as(h=>Math.max(0,h-t)),xn(h=>Math.max(0,h-t)),Gn(h=>Math.max(0,h-i)),je.current=0)},[is]);n.useEffect(()=>{const t=i=>{const c=i?.detail;!c||c?.source==="offline-play"||ra()};return window.addEventListener("ndn:clear-visit-request",t),()=>window.removeEventListener("ndn:clear-visit-request",t)},[ra]);function Ja(t){ke("Double Practice");const i=cs(Math.round(t||0),0,60);if(Jt(i),as(c=>c+1),xn(c=>c+1),Mi(i,kt)){const c=js+1;Bs(c),us(h=>Math.min(20,h+1)),c>=21&&(p("player"),oe(!0))}q(0)}function Qa(){Ja(Number(ne))}function Za(){const t=yn(ht);if(t==null){alert("Enter like D16, 50, 25, T20");return}Ja(t),dt("")}function ei(t,i,c){if(rr)return!1;ke("Bob's 27");const h=Dn,f=i==="DOUBLE"&&c===h||!i&&t===h*2;return f&&sn(O=>O+1),tn(O=>{const U=O+1;if(U>=3){const Y=nr+(f?1:0);Y>0?es(F=>F+Y*h*2):es(F=>F-h*2);const I=h+1;return ye(I),sn(0),I>20&&ar(!0),0}return U}),!0}function ti(){ei(Math.max(0,ne|0)),q(0)}function si(){ye(1),es(27),tn(0),sn(0),ar(!1),He("Bob's 27")}function aa(t){return ke("Count-Up"),Fs(i=>i+Math.max(0,t|0)),$s(i=>{const c=i+1;return c>=3?(Tn(h=>h+1),0):c}),!0}function ia(t){return ke("High Score"),ft(i=>i+Math.max(0,t|0)),Je(i=>{const c=i+1;return c>=3?(Fe(h=>h+1),0):c}),!0}function la(t){return ke("Low Score"),Wt(i=>i+Math.max(0,t|0)),_t(i=>{const c=i+1;return c>=3?(Bt(h=>h+1),0):c}),!0}function ni(t,i,c,h,f,O,U,Y){const I=t-U;if(!(I<0))if(I===0){if(Y==="DOUBLE"||Y==="INNER_BULL"){O(F=>F+1),f(F=>F+1),h(()=>0),i(t);return}i(I)}else i(I);h(F=>{const N=F+1;return N>=3?(f(V=>V+1),0):N})}function ri(t,i){return ke("Checkout 170"),ni(ws,Mn,An,En,nn,rn,t,i),An+1>=3&&Mn(170),!0}function ai(t,i){return ke("Checkout 121"),ni(Tt,Ss,Cs,ts,In,ns,t,i),Cs+1>=3&&Ss(121),!0}function Lr(t){const i=yn(ht);if(i==null){alert("Enter like T20, D16, 25, 50");return}const c=ht.trim().toUpperCase(),h=c.startsWith("D")||c==="50"||c==="BULL"||c==="DBULL"||c==="IBULL"||c.includes("INNER");t?ri(i,h?"DOUBLE":void 0):ai(i,h?"DOUBLE":void 0),dt("")}function bl(){Mn(170),En(0),nn(0),rn(0),He("Checkout 170")}function pl(){Ss(121),ts(0),In(0),ns(0),He("Checkout 121")}function oa(t,i,c){return Ws?!1:(ke("Treble Practice"),(i==="TRIPLE"&&c===rs||!i&&t===rs*3)&&ln(f=>f+1),Vs(f=>{const O=f+1;if(O%3===0&&[20,19,18].includes(rs)){const U=[20,19,18],Y=U.indexOf(rs),I=U[(Y+1)%U.length];an(I)}return Ts>0&&O>=Ts&&on(!0),O}),!0)}function ii(){ln(0),Vs(0),on(!1),He("Treble Practice")}function gl(t,i,c){return ke("Baseball"),Pn(h=>{const f={...h};return vo(f,t,i,c),f}),!0}function vl(){Pn(Ri()),He("Baseball")}function jl(t,i,c){return ke("Golf"),Un(h=>{const f={...h};return No(f,t,i,c),f}),!0}function Nl(){Un(Ii()),He("Golf")}function wl(t,i,c,h){return ke("Tic Tac Toe"),On(f=>{const O={...f,board:[...f.board]};return yo(O,t,i,c,h),O}),!0}function yl(){On(Bi()),He("Tic Tac Toe")}function Sl(t,i,c){return ke("American Cricket"),dr(h=>{const f={...h,marks:{...h.marks}};return Eo(f,t,i,c,()=>!1),f}),!0}function li(){dr(Fi()),He("American Cricket")}function ca(t,i,c){ke("Around the Clock");const h=Rs[ms];let f=!1;if(typeof c=="number"&&c===h&&(i==="SINGLE"||i==="DOUBLE"||i==="TRIPLE")&&(f=!0),h===25&&(i==="BULL"||t===25)&&(f=!0),h===50&&(i==="INNER_BULL"||t===50)&&(f=!0),f||(t===h||t===h*2||t===h*3)&&(f=!0),f){const O=sr+1;return Ps(O),kn(U=>U+1),!0}return!0}function oi(){ca(Math.max(0,ne|0)),q(0)}function ci(){const t=yn(ht);if(t==null){alert("Enter like T20, D5, 25, 50");return}ca(t),dt("")}function da(t,i,c){return ke("Cricket"),Ht(h=>{const f={...h,marks:{...h.marks}};return lo(f,t,i,c,()=>!1),f}),Dt(h=>{const f=h+1;return f>=3?0:f}),!0}function di(){da(Math.max(0,ne|0)),q(0)}function ua(t,i,c){return ke("Shanghai"),hs(h=>{const f={...h,turnHits:{...h.turnHits}};return uo(f,t,i,c),f}),Dt(h=>{const f=h+1;return f>=3?(hs(O=>{const U={...O,turnHits:{...O.turnHits}};return mo(U),U}),0):f}),!0}function ui(){ua(Math.max(0,ne|0)),q(0)}function mi(t,i,c){return ke("Halve It"),Js(h=>{const f={...h,targets:[...h.targets]};return ho(f,t,i,c),f}),Dt(h=>{const f=h+1;return f>=3?(Js(O=>{const U={...O,targets:[...O.targets]};return xo(U),U}),0):f}),!0}function hi(){mi(Math.max(0,ne|0)),q(0)}function xi(t,i,c){return ke("High-Low"),Zs(h=>{const f={...h};return fo(f,t,i,c),f}),Dt(h=>{const f=h+1;return f>=3?(Zs(O=>{const U={...O};return bo(U),U}),0):f}),!0}function fi(){xi(Math.max(0,ne|0)),q(0)}function bi(){const t=ht.trim().toUpperCase();if(!t)return null;if(t==="50"||t==="BULL"||t==="DBULL"||t==="IBULL")return 50;if(t==="25"||t==="OBULL")return 25;const i=t.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!i)return null;const c=i[1]||"S",h=parseInt(i[2],10);return h<1||h>20?null:h*(c==="S"?1:c==="D"?2:3)}function Qn(){const t=bi();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}Jn(t),dt("")}function pi(){const t=Jr.trim().split(`
`).map(i=>i.trim()).filter(i=>i);if(t.length!==0){for(const i of t){const c=yn(i);if(c==null){alert(`Invalid score: ${i}`);return}Jn(c)}qn("")}}function ma(){$e!==0&&(ve(t=>t+jt),Ae(t=>Math.max(0,t-1)))}function Mr(){const t=bi();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}if($e===0){Qn();return}const i=jt;ve(c=>c+i),Ae(c=>Math.max(0,c-1)),setTimeout(()=>Jn(t),0),dt("")}function Cl(){const t=v??"player",i=t==="player"?J||void 0:Vr||void 0,c=1,h=t==="player"?Mt:ur;qe([..._,{winner:t,doubleDarts:L,checkoutDarts:A,winnerDarts:h,doublesAtt:i,doublesHit:c}]),oe(!1);let f=Be,O=We;if(v==="player"?f+=1:v==="ai"&&(O+=1),B(f),Te(O),p(null),f>=lt||O>=lt){try{$l(g,t==="player")}catch{}Gt(!1),Ie(!1),ve(z),$t(z),Yr(!0);return}fl()}const ha=!wi.includes(g)&&!(s?.fullAccess||s?.admin);return e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[Ge&&e.jsx(Wl,{players:Pe.players||[],onDone:()=>ut(!1)}),e.jsxs("h2",{className:"text-3xl font-bold text-brand-700 mb-4",children:["Offline Mode"," ",r==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"ndn-shell-body",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsxs("select",{className:"input w-full",value:g,onChange:t=>Ze(t.target.value),children:[wi.map(t=>e.jsx("option",{value:t,children:t},t)),Ul.map(t=>e.jsxs("option",{value:t,disabled:!(s?.fullAccess||s?.admin),children:[t," ",s?.fullAccess||s?.admin?"":"(Premium)"]},t))]}),e.jsx(Hl,{gameMode:g,compact:!0}),g==="Treble Practice"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"font-semibold",children:"Throws per game"}),e.jsx("input",{className:"input w-full",type:"number",min:3,step:3,value:Ts,onChange:t=>cr(Math.max(3,Math.floor(Number(t.target.value)||30)))})]}),e.jsx("div",{className:"sm:col-span-2 text-xs text-slate-300",children:"Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws."})]}),!s?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),g==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:z,onChange:t=>ct(Number(t.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{className:"input w-full",value:te,onChange:t=>G(t.target.value),children:[e.jsx("option",{value:"None",children:"None"}),Fo.map(t=>e.jsx("option",{value:t,children:t},t))]}),te!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:be/1e3,onChange:t=>Ct(Math.round(Number(t.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>Ye(!0),children:"X01 Rules & Regulations!"})]}),g==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply."})]}),!et&&e.jsx("button",{className:"btn",disabled:ha,title:ha?"PREMIUM required for this mode":"",onClick:Nn,children:"Start Match"}),Le&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${qt?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(Sn,{storageKey:"ndn:modal:offline-match",className:`${qt?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:qt,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:"scroll"},ref:t=>{gn.current=t},children:[e.jsx("div",{ref:t=>{sa.current=t},children:e.jsx(Io,{left:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[g,g==="X01"?` / ${z}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",lt," Â· Legs ",Be,"-",We]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${r==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:r==="modern"?"Modern layout":"Classic layout"})]}),right:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>$(Math.max(.5,Math.round((E-.05)*100)/100)),title:"Decrease camera size",children:"âˆ’"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(E*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>$(Math.min(1.25,Math.round((E+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:_e?"Actual Size":"Fit All",onClick:()=>Ys(t=>!t),children:_e?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:qt?"Restore":"Maximize",onClick:()=>ds(t=>!t),children:qt?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Nn()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{Gt(!1),Ie(!1)},children:"Quit"})]})})}),e.jsxs("div",{ref:t=>{vn.current=t},className:"will-change-transform",style:_e?{transform:`scale(${gs})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,gs))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:g==="X01"?"X01 Match":g}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",g]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",z]}),e.jsxs("div",{ref:xl,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const t=se!==z||fe!==z||$e>0,i=`px-2 py-0.5 rounded border text-xs ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${i} ${jn==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||na("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${i} ${jn==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||na("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${t?"opacity-50":""}`,type:"number",min:1,step:1,value:Sr,onChange:c=>Xa(Math.max(1,Math.floor(Number(c.target.value)||1))),disabled:t,title:jn==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",Be,"â€“",We]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Match"}),e.jsxs("select",{className:`btn ${As}`,value:ee,onChange:t=>Ne(t.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${As} w-[7.5rem]`,value:me,onChange:t=>Ee(t.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${As} w-[7.5rem]`,value:Ve,onChange:t=>we(t.target.value),placeholder:"Team B"})]})]}),g!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[g==="Double Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Rr[kt]?.label||"â€”"})]})}),g==="Around the Clock"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Rs[ms]===25?"25 (Outer Bull)":Rs[ms]===50?"50 (Inner Bull)":Rs[ms]||"â€”"})]})}),g==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket â€” Close 20â€“15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:Da.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,Ns.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points:"," ",e.jsx("span",{className:"font-semibold",children:Ns.points})]}),oo(Ns)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Ht(fa()),Dt(0),He("Cricket")},children:"Reset"})]})]}),g==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Rt.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Rt.score]}),Rt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{hs(ba()),Dt(0),He("Shanghai")},children:"Reset"})]})]}),g==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[Us.stage+1,"/",Us.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target:"," ",e.jsx("span",{className:"font-semibold",children:(()=>{const t=Vi(Us);return t?t.kind==="ANY_NUMBER"?"Any":t.kind==="BULL"?"Bull":t.kind==="DOUBLE"||t.kind==="TRIPLE"||t.kind==="NUMBER"?`${t.kind} ${t.num}`:"â€”":"â€”"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Us.score]}),Us.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Js(pa()),Dt(0),He("Halve It")},children:"Reset"})]})]}),g==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Qs.round," Â· Target ",Qs.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Qs.score]}),Qs.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Zs(ga()),Dt(0),He("High-Low")},children:"Reset"})]})]}),g==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",Dn]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",en]}),rr&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:si,children:"Reset"})]})]}),g==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Xt,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ln]})]}),g==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",It,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ur]})]}),g==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Hs,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",lr]})]}),g==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ws}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",ys," Â· Successes:"," ",xs]})]}),g==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Tt}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",Rn," Â· Successes:"," ",ss]})]}),g==="Treble Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",rs]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",ks]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("div",{className:"inline-flex items-center gap-1",children:[20,19,18].map(t=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${rs===t?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>an(t),children:["T",t]},`tpick-header-${t}`))}),e.jsx("span",{className:"opacity-60 text-xs",children:"or"}),e.jsx("select",{className:"input w-24",value:rs,onChange:t=>an(parseInt(t.target.value,10)),children:Array.from({length:20},(t,i)=>i+1).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ii,children:"Reset"})]})]})}),g==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Bn.inning}),e.jsxs("div",{className:"text-sm",children:["Score:"," ",e.jsx("span",{className:"font-semibold",children:Bn.score})]})]}),g==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:bt.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes:"," ",e.jsx("span",{className:"font-semibold",children:bt.strokes})]})]}),g==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Kt.turn}),Kt.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",Kt.winner||"â€”"]})]}),g==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Target"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:va[pt.targetIndex]}),e.jsxs("div",{className:"text-sm",children:["Progress:"," ",e.jsxs("span",{className:"font-semibold",children:[pt.targetIndex+1,"/",va.length]})]}),pt.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["ðŸŽ‰ Finished in ",pt.darts," darts!"]})]}),g==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[fs.score,"/",fs.target]}),e.jsxs("div",{className:"text-sm",children:["Darts:"," ",e.jsx("span",{className:"font-semibold",children:fs.darts})]}),fs.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",fs.target,"!"]})]}),g==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[zs.score,"/",zs.target]}),e.jsxs("div",{className:"text-sm",children:["Darts:"," ",e.jsx("span",{className:"font-semibold",children:zs.darts})]}),zs.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",zs.target,"!"]})]}),g==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20â€“12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:Ta.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,Fn.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points:"," ",e.jsx("span",{className:"font-semibold",children:Fn.points})]}),Ro(Fn)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:li,children:"Reset"})]})]}),g==="Killer"&&e.jsx(e.Fragment,{children:R?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Me[K]?.name||"â€”"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Ke?`${Me.find(t=>t.id===Ke)?.name||"Winner"} Wins`:ce||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):r==="modern"?e.jsx("div",{className:"space-y-3 mb-2",children:he?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${As}`,onClick:()=>$(Math.max(.5,Math.round((E-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${As} min-w-[2.5rem] text-center`,children:[Math.round(E*100),"%"]}),e.jsx("button",{className:`btn ${As}`,onClick:()=>$(Math.min(1.25,Math.round((E+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${As}`,title:"Toggle fit/fill",onClick:()=>Z(w==="fill"?"fit":"fill"),children:w==="fill"?"Fill":"Fit"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${As}`,title:"Toggle camera aspect",onClick:()=>y(W==="square"?"wide":"square"),children:W==="square"?"Square":"Wide"})]})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6",children:[e.jsx("div",{className:"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]",children:e.jsx(De,{scoringMode:"x01",showToolbar:T,immediateAutoCommit:!0,cameraAutoCommit:"camera",onAutoDart:(t,i,c)=>{}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Current Shooter"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-white",children:ol}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Remaining"}),e.jsx("div",{className:"font-mono text-lg text-white",children:cl})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Last Dart"}),e.jsx("div",{className:"font-mono text-lg text-white",children:dl||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Match Legs"}),e.jsxs("div",{className:"font-semibold text-white",children:[Be,"-",We]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Next Up"}),e.jsx("div",{className:"font-medium text-white",children:ll})]})]})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(os,{gameMode:g,players:Ka,matchScore:`${Be}-${We}`})})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(os,{gameMode:g,players:Ka,matchScore:`${Be}-${We}`})}),g==="X01"&&e.jsxs("div",{className:"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Manual Scoreboard Override"}),e.jsxs("p",{className:"mt-1 text-xs text-white/40",children:["Adjust the live totals if a dart was misread. Values are clamped between 0 and"," ",z,"."]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:Ms}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Commit Visit"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx(Vl,{inProgress:!0,startingScore:z,onAddVisit:Ft(wt),quickButtons:[180,140,100,60],onNextPlayer:()=>Ot?.nextPlayer(),onEndLeg:()=>{},onUndo:()=>{},showDartsSelect:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:Ha,onChange:t=>Qr(t.target.value),onKeyDown:t=>{t.key==="Enter"&&yr("player")},placeholder:`${Be}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>yr("player"),children:"Set"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:pn}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Three Dart Edit"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:z,value:Fa,onChange:t=>$a(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Ga()},placeholder:`${fe}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Ga(),children:"Set"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:Va,onChange:t=>Zr(t.target.value),onKeyDown:t=>{t.key==="Enter"&&yr("ai")},placeholder:`${We}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>yr("ai"),children:"Set"})]})]})]})]})]})]})]})})]})}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),Oe?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:se}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-se/z)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart:"," ",e.jsx("span",{className:"font-semibold",children:jt})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score:"," ",e.jsx("span",{className:"font-semibold",children:$e>0?At:Ut??jt})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg:"," ",e.jsx("span",{className:"font-semibold",children:Kn>0?(Kr/Kn*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",Mt]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(t=>e.jsx("span",{className:`w-2 h-2 rounded-full ${t<$e?"bg-emerald-400":"bg-white/20"}`},t))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles:"," ",e.jsxs("span",{className:"font-semibold",children:["Att ",Vn," Â· Hit ",Wr]})]}),se<=170&&se>0&&(()=>{const i=Gl(se,o)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:i})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall",children:e.jsx(ja,{storageKey:"ndn:camera:tile:offline:center:v4",className:"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card",defaultWidth:0,defaultHeight:0,minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:1200,autoFill:!0,children:e.jsx(Si,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic",fill:!0})})}),e.jsxs("div",{className:`mt-2 ${ue==="small"?"p-2":ue==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${ge==="small"?"text-xs":ge==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const t=Oe?s?.username||"You":te==="None"?"â€”":`${te} AI`,i=Oe?se:te==="None"?0:fe,c=Oe?$e>0?At:Ut??jt:dn>0?cn:un??Gs,h=Oe?Mt:ur,f=z-(Oe?se:te==="None"?z:fe),O=h>0?f/h*3:0,U=`${Be}-${We}`,Y=_.length>0?`${Math.min(..._.map(I=>I.doubleDarts+(I.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:U}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:t}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:i}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:O.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:c}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:Y})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[te==="None"?"Opponent":`${te} AI`," Remain"]}),Oe?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:te!=="None"?fe:"N/A"}),te!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-fe/z)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart:"," ",e.jsx("span",{className:"font-semibold",children:te==="None"?0:Gs})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score:"," ",e.jsx("span",{className:"font-semibold",children:te==="None"?"â€”":dn>0?cn:un??Gs})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg:"," ",e.jsx("span",{className:"font-semibold",children:te!=="None"?zn>0?(zr/zn*3).toFixed(1):"0.0":"â€”"})]}),te!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",ur]}),te!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles:"," ",e.jsxs("span",{className:"font-semibold",children:["Att ",_n," Â· Hit ",_r]})]})]})]})}),g!=="X01"?e.jsxs("div",{className:"space-y-2",children:[g==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Rr[kt]?.label||"â€”"})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,onAutoDart:(t,i)=>{if((i==="DOUBLE"||i==="INNER_BULL")&&Mi(t,kt)){const h=js+1,f=kt+1;return Bs(h),us(f),h>=Rr.length&&setTimeout(()=>{Bs(0),us(0)},250),!0}return!1},immediateAutoCommit:!0,onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Qa()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Qa,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:ht,onChange:t=>dt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Za()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Za,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",js," of 21"]})]}),g==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Rs[ms]===25?"25 (Outer Bull)":Rs[ms]===50?"50 (Inner Bull)":Rs[ms]||"â€”"})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>ca(t,i==="MISS"?void 0:i,c?.sector??null),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&oi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:oi,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:ht,onChange:t=>dt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ci()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ci,children:"Add"})]}),sr>=Rs.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Ps(0),kn(0),He("Around the Clock")},children:"Reset"})]})]}),g==="Cricket"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>da(t,i==="MISS"?void 0:i,c?.sector??null),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&di()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:di,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ht(fa()),Dt(0),He("Cricket")},children:"Reset"})]})]}),g==="Shanghai"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>ua(t,i==="MISS"?void 0:i,c?.sector??null),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&ui()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ui,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{hs(ba()),Dt(0),He("Shanghai")},children:"Reset"})]})]}),g==="Halve It"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>mi(t,i==="MISS"?void 0:i,c?.sector??null),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&hi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:hi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Js(pa()),Dt(0),He("Halve It")},children:"Reset"})]})]}),g==="High-Low"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>xi(t,i==="MISS"?void 0:i,c?.sector??null),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&fi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:fi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Zs(ga()),Dt(0),He("High-Low")},children:"Reset"})]})]}),g==="Bob's 27"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>ei(t,i==="MISS"?void 0:i,c?.sector??null),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&ti()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ti,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:si,children:"Reset"})]})]}),g==="Count-Up"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>aa(t),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(aa(ne),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{aa(ne),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Tn(1),Fs(0),$s(0),He("Count-Up")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Xt,"/",Pr]})]}),g==="High Score"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>ia(t),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ia(ne),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ia(ne),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Fe(1),ft(0),Je(0),He("High Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",It,"/",ir]})]}),g==="Low Score"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>la(t),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(la(ne),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{la(ne),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Bt(1),Wt(0),_t(0),He("Low Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Hs,"/",Or]})]}),g==="Checkout 170"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i)=>ri(t,i==="MISS"?void 0:i),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:ht,onChange:t=>dt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Lr(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Lr(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:bl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",ws," Â· Attempts: ",ys," Â· Successes: ",xs]})]}),g==="Checkout 121"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i)=>ai(t,i==="MISS"?void 0:i),onAddVisit:Ft(wt),onEndLeg:t=>Ot.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:ht,onChange:t=>dt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Lr(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Lr(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:pl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",Tt," Â· Attempts: ",Rn," Â· Successes: ",ss]})]}),g==="Treble Practice"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>oa(t,i==="MISS"?void 0:i,c?.sector??null)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:ht,onChange:t=>dt(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const i=yn(ht);i!=null&&oa(i,void 0,void 0),dt("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const t=yn(ht);t!=null&&oa(t,void 0,void 0),dt("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",ks," Â· Misses:"," ",Math.max(0,Ds-ks)," Â· Darts:"," ",Ds,Ts>0?`/${Ts}`:""]}),Ws&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:ii,children:"Reset"})]})]}),g==="Baseball"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>gl(t,i==="MISS"?void 0:i,c?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:vl,children:"Reset"})})]}),g==="Golf"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>jl(t,i==="MISS"?void 0:i,c?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Nl,children:"Reset"})})]}),g==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(t,i)=>i).map(t=>e.jsx("button",{className:`h-16 rounded-xl border ${Kt.board[t]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(Kt.finished||Kt.board[t])return;const i=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),c=i%3===0?"TRIPLE":i%2===0?"DOUBLE":"SINGLE",h=t,f=Wi[h],O=f.type==="BULL"?null:f.num||null;wl(h,i,c,O)},children:Kt.board[t]||""},t))}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:yl,children:"Reset"})})]}),g==="American Cricket"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>Sl(t,i==="MISS"?void 0:i,c?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:li,children:"Reset"})})]}),g==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:va[gt.targetIndex]})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>{const h=i==="MISS"?void 0:i;return ke("Scam"),Yt(wa(gt,t,h)),!0}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:1,max:25,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ke("Scam"),Yt(Pi(gt,ne)),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ke("Scam"),Yt(Pi(gt,ne)),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Yt(Co()),He("Scam")},children:"Reset"})]}),gt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["ðŸŽ‰ Finished in ",gt.darts," darts!"]})]}),g==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[Lt.score,"/",Lt.target]})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>(ke("Fives"),Ks(Sa(Lt,t)),!0)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:5,max:50,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ke("Fives"),Ks(Ui(Lt,ne)),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ke("Fives"),Ks(Ui(Lt,ne)),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ks(To(Lt.target)),He("Fives")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:"," ",Lt.darts]}),Lt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",Lt.target," in"," ",Lt.darts," darts!"]})]}),g==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[vt.score,"/",vt.target]})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>(ke("Sevens"),Xe(ka(vt,t)),!0)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:7,max:21,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ke("Sevens"),Xe(Oi(vt,ne)),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ke("Sevens"),Xe(Oi(vt,ne)),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Xe(Ao(vt.target)),He("Sevens")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 7, 14, 21 Â· Darts:"," ",vt.darts]}),vt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",vt.target," in"," ",vt.darts," darts!"]})]}),g==="Killer"&&e.jsx(e.Fragment,{children:R?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Me.map(t=>{const i=_s[t.id],c=d[t.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${i?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${i?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:i?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number:"," ",e.jsx("span",{className:"font-semibold",children:c})]}),e.jsxs("div",{className:"text-sm",children:["Lives:"," ",e.jsx("span",{className:"font-semibold",children:i?.lives??0})]})]},t.id)})}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>{if(Ke)return!1;const h=i==="MISS"?void 0:i,f=c?.sector??null,O=Me[K];return O?(a(U=>{const Y={};Object.keys(U).forEach(N=>Y[N]={...U[N]});const I=Ai(O.id,Y,h,f);if(I.becameKiller)Se(`${O.name} became a Killer`);else if(I.victimId){const N=Me.find(V=>V.id===I.victimId);Se(`${O.name} hit ${N?.name}'s ${d[I.victimId]} (${I.livesRemoved} life${(I.livesRemoved||0)>1?"s":""})`)}else Se("No effect");const F=Ei(Y);return F&&Q(F),Y}),pe(U=>{const Y=U+1;if(Y>=3){let I=K;for(let F=1;F<=Me.length;F++){const N=(K+F)%Me.length,V=Me[N].id,yt=_s[V];if(yt&&!yt.eliminated&&yt.lives>0){I=N;break}}return H(I),0}return Y}),!0):!1}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:ht,onChange:t=>dt(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){if(Ke)return;const c=ht.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!c){dt("");return}const h=c[1]||"S",f=parseInt(c[2],10),O=h==="D"?"DOUBLE":h==="T"?"TRIPLE":"SINGLE",U=Me[K];a(Y=>{const I={};Object.keys(Y).forEach(V=>I[V]={...Y[V]});const F=Ai(U.id,I,O,f);if(F.becameKiller)Se(`${U.name} became a Killer`);else if(F.victimId){const V=Me.find(yt=>yt.id===F.victimId);Se(`${U.name} hit ${V?.name}'s ${d[F.victimId]} (${F.livesRemoved} life${(F.livesRemoved||0)>1?"s":""})`)}else Se("No effect");const N=Ei(I);return N&&Q(N),I}),dt(""),pe(Y=>{const I=Y+1;if(I>=3){let F=K;for(let N=1;N<=Me.length;N++){const V=(K+N)%Me.length,yt=Me[V].id,ls=_s[yt];if(ls&&!ls.eliminated&&ls.lives>0){F=V;break}}return H(F),0}return I})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let t=K;for(let i=1;i<=Me.length;i++){const c=(K+i)%Me.length,h=Me[c].id,f=_s[h];if(f&&!f.eliminated&&f.lives>0){t=c;break}}H(t),pe(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{a({}),b({}),X(!1),H(0),pe(0),Q(null),Se("")},children:"Reset"})]}),Ke&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner:"," ",Me.find(t=>t.id===Ke)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{a({}),b({}),X(!1),H(0),pe(0),Q(null),Se("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:Me.map((t,i)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:t.name,onChange:c=>{const h=c.target.value;$n(f=>f.map((O,U)=>U===i?{...O,name:h}:O))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>$n(c=>c.filter((h,f)=>f!==i)),disabled:Me.length<=2,children:"Remove"})]},t.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>$n(t=>{const i=`p${t.length+1}`;return[...t,{id:i,name:`Player ${t.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(Me.length<2){alert("Need at least 2 players");return}const t=Me.map(h=>h.id),i=go(t),c={};t.forEach(h=>{c[h]=po(i[h])}),b(i),a(c),H(0),pe(0),Q(null),Se("Assigned numbers"),X(!0)},children:"Assign Numbers & Start"})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-3 min-h-0 flex-1 text-[14px]",children:[e.jsxs("div",{className:"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm",children:[e.jsx("div",{className:"text-sm font-semibold opacity-80",children:"Scoreboard"}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(os,{gameMode:g,players:Nr,matchScore:`${Be}-${We}`})}),Oe&&e.jsxs("div",{className:"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h4",{className:"text-sm font-semibold tracking-wide uppercase text-indigo-200",children:"Manual Scoring"}),e.jsx("span",{className:"text-xs text-white/60",children:"Override a visit or enter dart-by-dart scores."})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Single Dart"}),e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:60,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?ma():Cr())},placeholder:"60"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Cr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Three Dart Edit"}),e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:se<=170?170:180,value:kr,onChange:t=>Ya(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Tr()},placeholder:"100"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Tr,children:"Commit Visit"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:ma,children:"Undo Visit"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Manual"}),e.jsx("input",{className:"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",value:ht,onChange:t=>dt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Mr():Qn())},placeholder:"T20"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Qn,children:"Apply"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Mr,disabled:$e===0,children:"Replace Last"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Multi-entry (one per line)"}),e.jsx("textarea",{className:"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30",rows:3,value:Jr,onChange:t=>qn(t.target.value),placeholder:`T20
D16
25`}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:pi,children:"Apply All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>qn(""),children:"Clear"})]})]}),e.jsx("div",{className:"pt-2 border-t border-white/10 mt-3",children:e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:ra,disabled:$e===0&&At===0,children:"Clear Current Visit"})})]})]})]}),D&&e.jsx("div",{className:"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i)=>{const c=i??"MISS",h=Number.isFinite(t)?Math.max(0,t):0,f=Date.now();if(h<=0){if(c!=="MISS"||f-(je.current||0)<1200)return;je.current=f}else je.current=0;Jn(h)}})})]}),g==="X01"&&!D&&e.jsx(e.Fragment,{children:e.jsx(os,{gameMode:g,players:Nr,matchScore:`${Be}-${We}`})}),g==="Cricket"&&e.jsx(e.Fragment,{children:e.jsx(os,{gameMode:"Cricket",players:tl})}),g==="Cricket"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>{if(t>0)return da(t,i==="MISS"?void 0:i,c?.sector??null),!0}})}),g==="Shanghai"&&e.jsx(e.Fragment,{children:e.jsx(os,{gameMode:"Shanghai",players:sl})}),g==="Shanghai"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>{if(t>0)return ua(t,i==="MISS"?void 0:i,c?.sector??null),!0}})}),g==="Killer"&&e.jsx(e.Fragment,{children:e.jsx(os,{gameMode:"Killer",players:nl})}),g==="Scam"&&e.jsx(e.Fragment,{children:e.jsx(os,{gameMode:"Scam",players:rl})}),g==="Scam"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>{if(t>0)return Yt(wa(gt,t,i)),!0}})}),g==="Fives"&&e.jsx(e.Fragment,{children:e.jsx(os,{gameMode:"Fives",players:al})}),g==="Fives"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>{if(t>0)return Ks(Sa(Lt,t)),!0}})}),g==="Sevens"&&e.jsx(e.Fragment,{children:e.jsx(os,{gameMode:"Sevens",players:il})}),g==="Sevens"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(De,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,i,c)=>{if(t>0)return Xe(ka(vt,t)),!0}})}),e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:ne,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?ma():Cr())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Cr,title:"Add a single dart (0â€“60)",children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,max:se<=170?170:180,placeholder:"Visit total (0â€“180)",value:kr,onChange:t=>Ya(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Tr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Tr,title:"Commit a full 3-dart total like 93",children:"Commit Visit"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:ht,onChange:t=>dt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Mr():Qn())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Mr,disabled:$e===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Qn,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:Jr,onChange:t=>qn(t.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:pi,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>qn(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add Â· Shift+Enter to Replace Last"})]}),e.jsx("div",{className:"h-1"})]})]})})}),xe&&e.jsx(Vo,{onClose:()=>Ye(!1)}),ha&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const i=await(await fetch(`${Wo}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s?.email})})).json();i.ok&&i.url?(window.location.href=i.url,i.development&&st("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):i.error==="STRIPE_NOT_CONFIGURED"?st("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):st("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{st("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â·"," ",Ol(Fl(),5)]})]})]}),Qi&&typeof document<"u"?Ni.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4",onClick:()=>fn(!1),children:e.jsx(Sn,{storageKey:"ndn:modal:offline-camera-manager",className:"relative",defaultWidth:640,defaultHeight:520,minWidth:480,minHeight:420,maxWidth:1200,maxHeight:900,initialFitHeight:!0,onClose:()=>fn(!1),children:e.jsxs("div",{className:"space-y-3",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Camera Devices"}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Manage Offline Camera Feeds"})]}),e.jsx("button",{className:"btn bg-slate-800 hover:bg-slate-700 text-white",onClick:()=>fn(!1),children:"Close"})]}),e.jsx(Si,{fill:!0,user:s,playerScore:se,aiScore:fe,x01Score:z,inMatch:et,showWinPopup:tt,pendingLegWinner:v,playerDartsThrown:Mt,aiDartsThrown:ur,totalPlayerDarts:Kn,totalAiDarts:zn,totalPlayerPoints:Kr,totalAiPoints:zr,player180s:Pa,player140s:Ki,player100s:zi,ai180s:Ua,ai140s:Gi,ai100s:qi,playerHighestCheckout:Xi,aiHighestCheckout:Yi,onClose:()=>fn(!1),onOpen:()=>fn(!0),layout:r})]})})}),document.body):null,gr&&typeof document<"u"?Ni.createPortal((()=>{const{target:t,value:i,stage:c}=gr,h=t==="player"?Ms:pn,f=t==="player"?Be:We;return e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4",onClick:Yn,children:e.jsx(Sn,{storageKey:"ndn:modal:offline-leg-override",className:"relative",defaultWidth:360,defaultHeight:240,minWidth:280,minHeight:200,maxWidth:420,maxHeight:360,initialFitHeight:!0,onClose:Yn,children:e.jsxs("div",{className:"space-y-3 max-w-[18rem] mx-auto",onClick:O=>O.stopPropagation(),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide text-white/50",children:["Step ",c," of 2"]}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Override legs?"})]}),e.jsx("div",{className:"text-sm text-slate-200 leading-relaxed",children:c===1?e.jsxs(e.Fragment,{children:["Set ",h,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:i}),"? Confirm to continue."]}):e.jsxs(e.Fragment,{children:["Final confirmation: set ",h,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:i}),". Select"," ",e.jsx("span",{className:"font-semibold text-emerald-200",children:"Yes"})," ","to apply immediately."]})}),e.jsxs("div",{className:"rounded-xl bg-black/40 border border-white/10 p-3 text-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50 mb-1",children:"Current legs"}),e.jsx("div",{className:"text-base font-semibold text-white",children:f})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:Yn,children:"No"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:hl,children:"Yes"})]})]})})})})(),document.body):null,tt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(Sn,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${L===t?"bg-brand-600":""}`,onClick:()=>j(t),children:t},t))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${A===t?"bg-brand-600":""}`,onClick:()=>P(t),children:t},t))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:Cl,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{oe(!1),Nn()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{oe(!1),Gt(!1),Ie(!1)},children:"Back to Menu"})]})]})}),Ji&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(Sn,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[g," Â· ",z," start Â· First to ",lt]}),(()=>{const t=Kn>0?Kr/Kn*3:0,i=t*3,c=(()=>{const N=_.filter(V=>V.winner==="player"&&typeof V.winnerDarts=="number").map(V=>V.winnerDarts);return N.length?`${Math.min(...N)} darts`:"â€”"})(),h=(()=>{const N=_.filter(V=>V.winner==="player"&&typeof V.winnerDarts=="number").map(V=>V.winnerDarts);return N.length?`${Math.max(...N)} darts`:"â€”"})(),f=Vn>0?Math.round(Wr/Vn*100):0,O=zn>0?zr/zn*3:0,U=O*3,Y=(()=>{const N=_.filter(V=>V.winner==="ai"&&typeof V.winnerDarts=="number").map(V=>V.winnerDarts);return N.length?`${Math.min(...N)} darts`:"â€”"})(),I=(()=>{const N=_.filter(V=>V.winner==="ai"&&typeof V.winnerDarts=="number").map(V=>V.winnerDarts);return N.length?`${Math.max(...N)} darts`:"â€”"})(),F=_n>0?Math.round(_r/_n*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:s?.username||"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:Be}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:t.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:i.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:Vn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[f,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:c})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:h})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Pa})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[Be," â€“ ",We]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:te==="None"?"Opponent":`${te} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:We}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:O.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:U.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:_n})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[F,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:Y})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:I})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Ua})]})]})]})]})})(),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map((t,i)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${t.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",i+1,":"," ",t.winner==="player"?"You":te==="None"?"Opp":"AI"," ","Â· Dbl ",t.doubleDarts," Â· CO ",t.checkoutDarts]},i))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(io,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>Yr(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{Yr(!1),Nn()},children:"Rematch"})]})]})}),_.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:_.map((t,i)=>e.jsxs("li",{children:["Leg ",i+1,": Double darts: ",t.doubleDarts,", Checkout darts:"," ",t.checkoutDarts]},i))})]})]})]})}export{tc as default};
//# sourceMappingURL=OfflinePlay-BQsp7RKZ.js.map

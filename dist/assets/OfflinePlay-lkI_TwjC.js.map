{"version":3,"file":"OfflinePlay-lkI_TwjC.js","sources":["../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/americanCricket.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/components/GameCalibrationStatus.tsx","../../src/components/CameraTile.tsx","../../src/components/HeatMap.tsx","../../src/game/scamFivesSevens.ts","../../src/components/matchControlAdapters.ts","../../src/logic/matchActions.ts","../../src/components/scoreboards/useGameStats.ts","../../src/components/OfflinePlay.tsx"],"sourcesContent":["export type CricketMark = 0 | 1 | 2 | 3\r\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25 // 25 is bull (outer+inner)\r\n\r\nexport type CricketState = {\r\n\t// marks per number\r\n\tmarks: Record<CricketNumber, CricketMark>\r\n\t// accumulated points when opponent hasn't closed a number\r\n\tpoints: number\r\n}\r\n\r\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25]\r\n\r\nexport function createCricketState(): CricketState {\r\n\tconst marks: any = {}\r\n\tCRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n\treturn { marks, points: 0 }\r\n}\r\n\r\n// Apply a single dart to a player's cricket state\r\n// Returns deltaPoints scored on this dart\r\nexport function applyCricketDart(state: CricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: CricketNumber) => boolean = () => false): number {\r\n\t// Map autoscore terms to logical hits\r\n\tlet num: CricketNumber | null = null\r\n\tlet hits = 0\r\n\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n\t\tnum = 25\r\n\t\thits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n\t} else if (typeof sector === 'number' && (sector as number) >= 15 && (sector as number) <= 20) {\r\n\t\tnum = sector as CricketNumber\r\n\t\tif (ring === 'TRIPLE') hits = 3\r\n\t\telse if (ring === 'DOUBLE') hits = 2\r\n\t\telse hits = 1\r\n\t} else if (value) {\r\n\t\t// Fallback when only numeric score provided (manual): infer by divisibility\r\n\t\tconst cand: CricketNumber[] = [20,19,18,17,16,15]\r\n\t\tfor (const c of cand) {\r\n\t\t\tif (value === c) { num = c; hits = 1; break }\r\n\t\t\tif (value === c*2) { num = c; hits = 2; break }\r\n\t\t\tif (value === c*3) { num = c; hits = 3; break }\r\n\t\t}\r\n\t\tif (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n\t}\r\n\tif (!num) return 0\r\n\r\n\tconst before = state.marks[num]\r\n\tlet remainToClose = Math.max(0, 3 - before)\r\n\tconst toApply = Math.min(remainToClose, hits)\r\n\tconst overflow = Math.max(0, hits - toApply)\r\n\t// Increase marks up to 3\r\n\tconst after = (before + toApply) as CricketMark\r\n\tstate.marks[num] = after > 3 ? 3 : after\r\n\r\n\t// Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\r\n\tlet points = 0\r\n\tif (overflow > 0 && !opponentClosed(num)) {\r\n\t\tif (num === 25) {\r\n\t\t\t// Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\r\n\t\t\tif (ring === 'INNER_BULL') points += 50 * overflow\r\n\t\t\telse points += 25 * overflow\r\n\t\t} else {\r\n\t\t\tpoints += num * overflow\r\n\t\t}\r\n\t}\r\n\r\n\tstate.points += points\r\n\treturn points\r\n}\r\n\r\nexport function hasClosedAll(state: CricketState): boolean {\r\n\treturn CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n\r\nexport function cricketWinner(self: CricketState, opponents: CricketState[]): boolean {\r\n\t// Win when all closed and you have >= opponents' points\r\n\tif (!hasClosedAll(self)) return false\r\n\tconst maxOppPoints = Math.max(0, ...opponents.map(o => o.points))\r\n\treturn self.points >= maxOppPoints\r\n}\r\n","export type ShanghaiRound = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20\r\n\r\nexport type ShanghaiState = {\r\n\tround: ShanghaiRound\r\n\tscore: number\r\n\tfinished: boolean\r\n\tshanghaiAchieved: boolean // single+double+triple of target in same 3-dart turn\r\n\tturnHits: { singles: number; doubles: number; triples: number }\r\n}\r\n\r\nexport function createShanghaiState(): ShanghaiState {\r\n\treturn { round: 1, score: 0, finished: false, shanghaiAchieved: false, turnHits: { singles: 0, doubles: 0, triples: 0 } }\r\n}\r\n\r\nexport function getRoundTarget(state: ShanghaiState): number { return state.round }\r\n\r\n// Apply one dart; returns points scored on this dart\r\nexport function applyShanghaiDart(state: ShanghaiState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst target = getRoundTarget(state)\r\n\tlet points = 0\r\n\tif (typeof sector === 'number' && sector === target) {\r\n\t\tif (ring === 'TRIPLE') { points = target * 3; state.turnHits.triples++ }\r\n\t\telse if (ring === 'DOUBLE') { points = target * 2; state.turnHits.doubles++ }\r\n\t\telse if (ring === 'SINGLE') { points = target * 1; state.turnHits.singles++ }\r\n\t} else if (!sector && (value === target || value === target*2 || value === target*3)) {\r\n\t\t// manual numeric entry fallback\r\n\t\tif (value === target*3) { points = target*3; state.turnHits.triples++ }\r\n\t\telse if (value === target*2) { points = target*2; state.turnHits.doubles++ }\r\n\t\telse if (value === target) { points = target; state.turnHits.singles++ }\r\n\t}\r\n\tstate.score += points\r\n\treturn points\r\n}\r\n\r\n// Call at end of 3-dart turn; advances round and checks Shanghai\r\nexport function endShanghaiTurn(state: ShanghaiState) {\r\n\tif (!state.finished) {\r\n\t\tif (state.turnHits.singles>0 && state.turnHits.doubles>0 && state.turnHits.triples>0) {\r\n\t\t\tstate.shanghaiAchieved = true\r\n\t\t\tstate.finished = true\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst next = (state.round + 1) as ShanghaiRound\r\n\t\tif (next > 20) { state.finished = true } else { state.round = next }\r\n\t}\r\n\t// reset per-turn hits\r\n\tstate.turnHits = { singles: 0, doubles: 0, triples: 0 }\r\n}\r\n","export type HalveItTarget =\r\n\t| { kind: 'ANY_NUMBER' }\r\n\t| { kind: 'DOUBLE'; num: number }\r\n\t| { kind: 'TRIPLE'; num: number }\r\n\t| { kind: 'BULL' }\r\n\t| { kind: 'NUMBER'; num: number }\r\n\r\nexport type HalveItState = {\r\n\tstage: number\r\n\ttargets: HalveItTarget[]\r\n\tscore: number\r\n\tfinished: boolean\r\n\thitThisRound: boolean\r\n}\r\n\r\nexport function createDefaultHalveIt(): HalveItState {\r\n\tconst targets: HalveItTarget[] = [\r\n\t\t{ kind: 'NUMBER', num: 20 },\r\n\t\t{ kind: 'DOUBLE', num: 16 },\r\n\t\t{ kind: 'TRIPLE', num: 14 },\r\n\t\t{ kind: 'NUMBER', num: 19 },\r\n\t\t{ kind: 'BULL' },\r\n\t\t{ kind: 'ANY_NUMBER' },\r\n\t]\r\n\treturn { stage: 0, targets, score: 0, finished: false, hitThisRound: false }\r\n}\r\n\r\nexport function getCurrentHalveTarget(state: HalveItState): HalveItTarget | null {\r\n\treturn state.targets[state.stage] || null\r\n}\r\n\r\nexport function applyHalveItDart(state: HalveItState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst t = getCurrentHalveTarget(state)\r\n\tif (!t) return 0\r\n\tlet scored = 0\r\n\tswitch (t.kind) {\r\n\t\tcase 'NUMBER': {\r\n\t\t\tif (typeof sector === 'number' && sector === t.num) {\r\n\t\t\t\tif (ring === 'TRIPLE') scored = t.num * 3\r\n\t\t\t\telse if (ring === 'DOUBLE') scored = t.num * 2\r\n\t\t\t\telse if (ring === 'SINGLE') scored = t.num\r\n\t\t\t} else if (!sector && (value === t.num || value === t.num*2 || value === t.num*3)) {\r\n\t\t\t\tscored = value\r\n\t\t\t}\r\n\t\t\tif (scored > 0) state.hitThisRound = true\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'DOUBLE': {\r\n\t\t\tif ((ring === 'DOUBLE' && sector === t.num) || value === t.num*2) { scored = t.num*2; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'TRIPLE': {\r\n\t\t\tif ((ring === 'TRIPLE' && sector === t.num) || value === t.num*3) { scored = t.num*3; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'BULL': {\r\n\t\t\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) { scored = (ring === 'INNER_BULL' || value === 50) ? 50 : 25; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'ANY_NUMBER': {\r\n\t\t\t// any valid score counts\r\n\t\t\tif (value > 0) { scored = value; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHalveItTurn(state: HalveItState) {\r\n\tif (state.finished) return\r\n\tif (!state.hitThisRound) {\r\n\t\tstate.score = Math.floor(state.score / 2)\r\n\t}\r\n\tstate.hitThisRound = false\r\n\tstate.stage += 1\r\n\tif (state.stage >= state.targets.length) state.finished = true\r\n}\r\n","export type HighLowState = {\r\n\tround: number\r\n\tscore: number\r\n\ttarget: 'HIGH' | 'LOW'\r\n\tfinished: boolean\r\n}\r\n\r\nexport function createHighLow(): HighLowState {\r\n\treturn { round: 1, score: 0, target: 'HIGH', finished: false }\r\n}\r\n\r\nexport function applyHighLowDart(state: HighLowState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\t// For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\r\n\t// When LOW, count only scores <= 10 (any ring) and bull does not count\r\n\tlet scored = 0\r\n\tif (state.target === 'HIGH') {\r\n\t\tif (ring === 'INNER_BULL') scored = 50\r\n\t\telse if (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector >= 20) scored = v\r\n\t\t} else {\r\n\t\t\t// manual numeric fallback\r\n\t\t\tif (value >= 40) scored = value\r\n\t\t}\r\n\t} else {\r\n\t\tif (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector <= 10) scored = v\r\n\t\t} else {\r\n\t\t\tif (value > 0 && value <= 30) scored = value\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHighLowTurn(state: HighLowState) {\r\n\tif (state.finished) return\r\n\tstate.round += 1\r\n\tif (state.round > 10) { state.finished = true; return }\r\n\tstate.target = state.target === 'HIGH' ? 'LOW' : 'HIGH'\r\n}\r\n","export type KillerState = {\r\n  number: number // assigned sector 1..20\r\n  lives: number // start with 3\r\n  isKiller: boolean // became killer by hitting own double\r\n  eliminated: boolean\r\n}\r\n\r\nexport function createKillerState(assigned: number, lives = 3): KillerState {\r\n  return { number: assigned, lives, isKiller: false, eliminated: false }\r\n}\r\n\r\n// Assign unique random numbers (1..20) to each player id\r\nexport function assignKillerNumbers<T extends string>(playerIds: T[]): Record<T, number> {\r\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1)\r\n  const res: any = {}\r\n  for (const id of playerIds) {\r\n    // pick a random remaining number\r\n    const idx = Math.floor(Math.random() * pool.length)\r\n    const num = pool.splice(idx, 1)[0]\r\n    res[id] = num\r\n  }\r\n  return res\r\n}\r\n\r\n// Apply a single dart in Killer context.\r\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\r\nexport function applyKillerDart(\r\n  selfId: string,\r\n  states: Record<string, KillerState>,\r\n  ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL',\r\n  sector?: number | null\r\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\r\n  const me = states[selfId]\r\n  if (!me || !sector || !ring) return { becameKiller: false }\r\n  // Becoming killer: hit your own DOUBLE only\r\n  if (!me.isKiller && ring === 'DOUBLE' && sector === me.number) {\r\n    me.isKiller = true\r\n    return { becameKiller: true }\r\n  }\r\n  // If already killer, hitting opponents' doubles/triples removes lives\r\n  if (me.isKiller && (ring === 'DOUBLE' || ring === 'TRIPLE')) {\r\n    const victimId = Object.keys(states).find(pid => pid !== selfId && !states[pid].eliminated && states[pid].number === sector)\r\n    if (victimId) {\r\n      const victim = states[victimId]\r\n      const delta = ring === 'TRIPLE' ? 2 : 1\r\n      victim.lives = Math.max(0, victim.lives - delta)\r\n      if (victim.lives === 0) victim.eliminated = true\r\n      return { becameKiller: false, victimId, livesRemoved: delta }\r\n    }\r\n  }\r\n  return { becameKiller: false }\r\n}\r\n\r\nexport function killerWinner(states: Record<string, KillerState>): string | null {\r\n  const alive = Object.entries(states).filter(([,st]) => !st.eliminated && st.lives > 0)\r\n  if (alive.length === 1) return alive[0][0]\r\n  return null\r\n}\r\n","export type AmCricketMark = 0 | 1 | 2 | 3\r\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25\r\n\r\nexport type AmCricketState = {\r\n  marks: Record<AmCricketNumber, AmCricketMark>\r\n  points: number\r\n}\r\n\r\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [20, 19, 18, 17, 16, 15, 14, 13, 12, 25]\r\n\r\nexport function createAmCricketState(): AmCricketState {\r\n  const marks: any = {}\r\n  AM_CRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n  return { marks, points: 0 }\r\n}\r\n\r\nexport function applyAmCricketDart(state: AmCricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: AmCricketNumber) => boolean = () => false): number {\r\n  let num: AmCricketNumber | null = null\r\n  let hits = 0\r\n  if (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n    num = 25\r\n    hits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n  } else if (typeof sector === 'number' && sector >= 12 && sector <= 20) {\r\n    num = sector as AmCricketNumber\r\n    if (ring === 'TRIPLE') hits = 3\r\n    else if (ring === 'DOUBLE') hits = 2\r\n    else hits = 1\r\n  } else if (value) {\r\n    for (const c of [20,19,18,17,16,15,14,13,12] as AmCricketNumber[]) {\r\n      if (value === c) { num = c; hits = 1; break }\r\n      if (value === c*2) { num = c; hits = 2; break }\r\n      if (value === c*3) { num = c; hits = 3; break }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n  }\r\n  if (!num) return 0\r\n\r\n  const before = state.marks[num]\r\n  const toClose = Math.max(0, 3 - before)\r\n  const toApply = Math.min(toClose, hits)\r\n  const overflow = Math.max(0, hits - toApply)\r\n  const after = (before + toApply) as AmCricketMark\r\n  state.marks[num] = after > 3 ? 3 : after\r\n\r\n  let points = 0\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      if (ring === 'INNER_BULL') points += 50 * overflow\r\n      else points += 25 * overflow\r\n    } else {\r\n      points += (num as number) * overflow\r\n    }\r\n  }\r\n  state.points += points\r\n  return points\r\n}\r\n\r\nexport function hasClosedAllAm(state: AmCricketState): boolean {\r\n  return AM_CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n","export type BaseballInning = 1|2|3|4|5|6|7|8|9\r\n\r\nexport type BaseballState = {\r\n  inning: BaseballInning\r\n  score: number\r\n  dartsThisInning: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createBaseball(): BaseballState {\r\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false }\r\n}\r\n\r\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\r\nexport function applyBaseballDart(state: BaseballState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): number {\r\n  if (state.finished) return 0\r\n  let runs = 0\r\n  if (typeof sector === 'number' && sector === state.inning) {\r\n    if (ring === 'TRIPLE') runs = 3\r\n    else if (ring === 'DOUBLE') runs = 2\r\n    else runs = 1\r\n  } else if (!sector && (value === state.inning || value === state.inning*2 || value === state.inning*3)) {\r\n    runs = value === state.inning*3 ? 3 : value === state.inning*2 ? 2 : 1\r\n  }\r\n  state.score += runs\r\n  state.dartsThisInning += 1\r\n  if (state.dartsThisInning >= 3) {\r\n    const next = (state.inning + 1) as BaseballInning\r\n    if (next > 9) state.finished = true\r\n    else { state.inning = next; state.dartsThisInning = 0 }\r\n  }\r\n  return runs\r\n}\r\n","export type GolfHole = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18\r\n\r\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\r\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\r\n\r\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\r\n  1: 5, 2: 20, 3: 1, 4: 18, 5: 4, 6: 13, 7: 6, 8: 10, 9: 15,\r\n  10: 2, 11: 17, 12: 3, 13: 19, 14: 7, 15: 16, 16: 8, 17: 11, 18: 14,\r\n}\r\n\r\nexport type GolfState = {\r\n  hole: GolfHole\r\n  strokes: number\r\n  dartsThisHole: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createGolf(): GolfState {\r\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false }\r\n}\r\n\r\nexport function applyGolfDart(state: GolfState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): boolean {\r\n  if (state.finished) return false\r\n  const target = GOLF_TARGETS[state.hole]\r\n  state.dartsThisHole += 1\r\n  const hit = (typeof sector === 'number' && sector === target && (ring==='SINGLE'||ring==='DOUBLE'||ring==='TRIPLE')) || (!sector && (value===target || value===target*2 || value===target*3))\r\n  if (hit) {\r\n    state.strokes += state.dartsThisHole\r\n    // advance to next hole\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n    return true\r\n  }\r\n  // If not finished and took 3 darts, score 3 and advance hole\r\n  if (state.dartsThisHole >= 3) {\r\n    state.strokes += 3\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n  }\r\n  return false\r\n}\r\n","import React from 'react'\r\nimport { AlertTriangle, CheckCircle, AlertCircle, Zap } from 'lucide-react'\r\nimport { useCalibration } from '../store/calibration'\r\nimport {\r\n  getCalibrationConfidenceForGame,\r\n  isCalibrationSuitableForGame,\r\n  getCalibrationQualityText,\r\n  getRecalibrationRecommendation,\r\n  GAME_CALIBRATION_REQUIREMENTS\r\n} from '../utils/gameCalibrationRequirements'\r\n\r\ninterface GameCalibrationStatusProps {\r\n  gameMode: string\r\n  compact?: boolean // Show minimal version\r\n  onRecalibrate?: () => void // Optional callback for recalibrate button\r\n}\r\n\r\nexport default function GameCalibrationStatus({\r\n  gameMode,\r\n  compact = false,\r\n  onRecalibrate\r\n}: GameCalibrationStatusProps) {\r\n  const { H, errorPx } = useCalibration()\r\n\r\n  const confidence = getCalibrationConfidenceForGame(gameMode, errorPx)\r\n  const suitable = isCalibrationSuitableForGame(gameMode, errorPx)\r\n  const { quality, text } = getCalibrationQualityText(gameMode, errorPx)\r\n  const recommendation = getRecalibrationRecommendation(gameMode)\r\n  const requirement = GAME_CALIBRATION_REQUIREMENTS[gameMode]\r\n\r\n  // Not calibrated\r\n  if (!H || !errorPx) {\r\n    if (compact) {\r\n      return (\r\n        <div className=\"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30\">\r\n          <AlertTriangle className=\"w-3 h-3\" />\r\n          Not calibrated\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className=\"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2\">\r\n        <AlertTriangle className=\"w-4 h-4 text-red-400 flex-shrink-0\" />\r\n        <div className=\"flex-1\">\r\n          <div className=\"font-medium text-red-300\">Calibration Required</div>\r\n          <div className=\"text-xs opacity-80\">Please calibrate before playing {gameMode}</div>\r\n        </div>\r\n        {onRecalibrate && (\r\n          <button\r\n            className=\"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700\"\r\n            onClick={onRecalibrate}\r\n          >\r\n            Calibrate\r\n          </button>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Determine colors based on suitability\r\n  const bgColor = suitable\r\n    ? 'bg-emerald-500/20 border-emerald-600/30'\r\n    : 'bg-amber-500/20 border-amber-600/30'\r\n\r\n  const textColor = suitable ? 'text-emerald-300' : 'text-amber-300'\r\n  const icon = suitable ? CheckCircle : AlertTriangle\r\n\r\n  if (compact) {\r\n    return (\r\n      <div className={`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${bgColor} ${textColor}`}>\r\n        {React.createElement(icon, { className: 'w-3 h-3' })}\r\n        <span>{text}</span>\r\n        {!suitable && recommendation && (\r\n          <span className=\"w-3 h-3 cursor-help\" title={recommendation}>\r\n            <AlertCircle className=\"w-3 h-3 inline\" />\r\n          </span>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Full version\r\n  return (\r\n    <div className={`px-3 py-2 rounded border ${bgColor} space-y-1`}>\r\n      <div className=\"flex items-center gap-2\">\r\n        {React.createElement(icon, {\r\n          className: `w-4 h-4 ${suitable ? 'text-emerald-400' : 'text-amber-400'} flex-shrink-0`\r\n        })}\r\n        <div className=\"flex-1\">\r\n          <div className={`font-medium ${suitable ? 'text-emerald-300' : 'text-amber-300'}`}>\r\n            Calibration for {gameMode}\r\n          </div>\r\n          <div className=\"text-xs opacity-80\">Error: {Math.round(errorPx)}px | {text}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Confidence bar */}\r\n      <div className=\"flex items-center gap-2\">\r\n        <div className=\"flex-1 h-1.5 rounded bg-black/30 overflow-hidden\">\r\n          <div\r\n            className={`h-full transition-all ${\r\n              suitable ? 'bg-emerald-500' : 'bg-amber-500'\r\n            }`}\r\n            style={{ width: `${Math.min(100, confidence)}%` }}\r\n          />\r\n        </div>\r\n        <span className=\"text-xs font-mono\">{Math.round(confidence)}%</span>\r\n      </div>\r\n\r\n      {/* Requirements */}\r\n      {requirement && (\r\n        <div className=\"text-xs opacity-75\">\r\n          <div>Tolerance: ±{requirement.tolerancePx}px | Min: {requirement.minConfidence}%</div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Warning and recommendation */}\r\n      <div className=\"space-y-1\">\r\n        {!suitable && (\r\n          <div className=\"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1\">\r\n            <AlertTriangle className=\"w-3 h-3 flex-shrink-0\" />\r\n            Calibration quality is below minimum for {gameMode}\r\n          </div>\r\n        )}\r\n\r\n        {recommendation && (\r\n          <div className=\"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1\">\r\n            <Zap className=\"w-3 h-3 flex-shrink-0\" />\r\n            {recommendation}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {!suitable && onRecalibrate && (\r\n        <button\r\n          className=\"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700\"\r\n          onClick={onRecalibrate}\r\n        >\r\n          Recalibrate for {gameMode}\r\n        </button>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","import { useCallback, useEffect, useMemo, useRef, useState, type CSSProperties } from 'react'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCameraSession, type CameraStreamMode } from '../store/cameraSession'\r\nimport { discoverNetworkDevices, connectToNetworkDevice, type NetworkDevice, discoverUSBDevices, requestUSBDevice, connectToUSBDevice, type USBDevice } from '../utils/networkDevices'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype CameraTileProps = {\r\n  label?: string\r\n  autoStart?: boolean\r\n  scale?: number\r\n  className?: string\r\n  aspect?: 'inherit' | 'wide' | 'square' | 'portrait' | 'classic' | 'free'\r\n  style?: CSSProperties\r\n  fill?: boolean\r\n  // Offline mode props\r\n  user?: any\r\n  playerScore?: number\r\n  aiScore?: number\r\n  x01Score?: number\r\n  inMatch?: boolean\r\n  showWinPopup?: boolean\r\n  pendingLegWinner?: \"player\" | \"ai\" | null\r\n  playerDartsThrown?: number\r\n  aiDartsThrown?: number\r\n  totalPlayerDarts?: number\r\n  totalAiDarts?: number\r\n  totalPlayerPoints?: number\r\n  totalAiPoints?: number\r\n  player180s?: number\r\n  player140s?: number\r\n  player100s?: number\r\n  ai180s?: number\r\n  ai140s?: number\r\n  ai100s?: number\r\n  playerHighestCheckout?: number\r\n  aiHighestCheckout?: number\r\n  onClose?: () => void\r\n  onOpen?: () => void\r\n  layout?: \"classic\" | \"modern\"\r\n}\r\n\r\nexport default function CameraTile({\r\n  label,\r\n  autoStart,\r\n  scale: scaleOverride,\r\n  className,\r\n  aspect = 'inherit',\r\n  style,\r\n  fill = false,\r\n}: CameraTileProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null)\r\n  const cameraSession = useCameraSession()\r\n  const [streaming, setStreaming] = useState(false)\r\n  const [ws, setWs] = useState<WebSocket | null>(null)\r\n  const [pairCode, setPairCode] = useState<string | null>(null)\r\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null)\r\n  const lastRegisteredModeRef = useRef<CameraStreamMode | null>(null)\r\n  const registerStream = useCallback((stream: MediaStream | null, modeOverride: CameraStreamMode = 'local') => {\r\n    try {\r\n      if (stream) {\r\n        cameraSession.setMediaStream(stream)\r\n        if (videoRef.current) {\r\n          cameraSession.setVideoElementRef(videoRef.current)\r\n        }\r\n        cameraSession.setMode(modeOverride)\r\n        cameraSession.setStreaming(true)\r\n        lastRegisteredModeRef.current = modeOverride\r\n      } else if (lastRegisteredModeRef.current && lastRegisteredModeRef.current !== 'phone') {\r\n        cameraSession.setStreaming(false)\r\n        cameraSession.setMediaStream(null)\r\n        lastRegisteredModeRef.current = null\r\n      }\r\n    } catch (err) {\r\n      console.warn('[CameraTile] Failed to register stream with camera session:', err)\r\n    }\r\n  }, [cameraSession])\r\n  \r\n  // Initialize mode: prioritize phone camera if preferred, otherwise use localStorage\r\n  const preferredCameraLabel = useUserSettings(s => s.preferredCameraLabel)\r\n  const [mode, setMode] = useState<'local'|'phone'|'wifi'>(() => {\r\n    // If phone camera is selected, start in phone mode\r\n    if (preferredCameraLabel === 'Phone Camera') {\r\n      console.log('[CAMERATILE] Initializing mode to phone (from preferred camera selection)')\r\n      return 'phone'\r\n    }\r\n    // Otherwise use saved mode or default to local\r\n    const saved = localStorage.getItem('ndn:camera:mode') as any\r\n    console.log('[CAMERATILE] Initializing mode to', saved || 'local', '(from localStorage)')\r\n    return saved || 'local'\r\n  })\r\n  \r\n  const [expiresAt, setExpiresAt] = useState<number | null>(null)\r\n  const [paired, setPaired] = useState<boolean>(false)\r\n  const [lanHost, setLanHost] = useState<string | null>(null)\r\n  const [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null)\r\n  const [showTips, setShowTips] = useState<boolean>(true)\r\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([])\r\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false)\r\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([])\r\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false)\r\n  const autoscoreProvider = useUserSettings(s => s.autoscoreProvider)\r\n  const cameraEnabledSetting = useUserSettings(s => s.cameraEnabled)\r\n  const setPreferredCameraLocked = useUserSettings(s => s.setPreferredCameraLocked)\r\n  const preferredCameraLocked = useUserSettings(s => s.preferredCameraLocked)\r\n  const setPreferredCamera = useUserSettings(s => s.setPreferredCamera)\r\n  const preferredCameraId = useUserSettings(s => s.preferredCameraId)\r\n\r\n  if (autoscoreProvider === 'manual') {\r\n    const fallbackBase = fill ? 'rounded-2xl overflow-hidden bg-black w-full flex flex-col' : 'rounded-2xl overflow-hidden bg-black w-full mx-auto'\r\n    const fallbackClass = [fallbackBase, className].filter(Boolean).join(' ').trim()\r\n    const fallbackStyle: CSSProperties = { ...(style || {}) }\r\n    if (!fill && fallbackStyle.aspectRatio === undefined && fallbackStyle.height === undefined && fallbackStyle.minHeight === undefined) {\r\n      fallbackStyle.aspectRatio = '4 / 3'\r\n    }\r\n    return (\r\n      <div className={fallbackClass} style={fallbackStyle}>\r\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\r\n          Manual scoring mode active — camera feeds are disabled.\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n  useEffect(() => {\r\n    const h = window.location.hostname\r\n    if (h === 'localhost' || h === '127.0.0.1') {\r\n      apiFetch(`/api/hosts`).then(r => r.json()).then(j => {\r\n        const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x)\r\n        if (ip) setLanHost(ip)\r\n      }).catch(()=>{})\r\n    }\r\n    // Detect HTTPS support for the phone link\r\n    apiFetch(`/api/https-info`).then(r=>r.json()).then(j=>{\r\n      if (j && typeof j.https === 'boolean') setHttpsInfo({ https: !!j.https, port: Number(j.port)||8788 })\r\n    }).catch(()=>{})\r\n  }, [])\r\n  const mobileUrl = useMemo(() => {\r\n    const code = pairCode || '____'\r\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    if (envUrl && envUrl.length > 0) {\r\n      try {\r\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\r\n        const u = new URL(envUrl)\r\n        const isSecure = u.protocol === 'wss:'\r\n        const origin = `${isSecure ? 'https' : 'http'}://${u.host}${u.pathname.endsWith('/ws') ? '' : u.pathname}`\r\n        const base = origin.replace(/\\/?ws$/i, '')\r\n        return `${base}/mobile-cam.html?code=${code}`\r\n      } catch {}\r\n    }\r\n    // Fallback to local development: prefer LAN host if detected\r\n    const host = (lanHost || window.location.hostname)\r\n    const useHttps = !!httpsInfo?.https\r\n    const port = useHttps ? (httpsInfo?.port || 8788) : 8787\r\n    const proto = useHttps ? 'https' : 'http'\r\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`\r\n  }, [pairCode, lanHost, httpsInfo])\r\n  useEffect(() => { \r\n    console.log('[CAMERATILE] Mode changed to:', mode, '- persisting to localStorage')\r\n    localStorage.setItem('ndn:camera:mode', mode) \r\n  }, [mode])\r\n  \r\n  const [manualModeSetAt, setManualModeSetAt] = useState<number | null>(null)\r\n  \r\n  // Sync phone camera selection from Calibrator into CameraTile mode state\r\n  // When user locks in phone camera in Calibrator, it updates preferredCameraLabel\r\n  // This effect ensures CameraTile's UI reflects that selection\r\n  useEffect(() => {\r\n    const ignore = useUserSettings.getState().ignorePreferredCameraSync\r\n    console.log('[CAMERATILE] Checking camera selection sync: preferredCameraLabel=', preferredCameraLabel, 'mode=', mode, 'ignoreSync=', ignore, 'manualModeSetAt=', manualModeSetAt)\r\n    if (ignore) return\r\n    // If user manually changed mode recently, avoid auto-syncing preferred camera\r\n    if (manualModeSetAt && Date.now() - manualModeSetAt < 30_000) return\r\n    if (preferredCameraLabel === 'Phone Camera' && mode !== 'phone') {\r\n      console.log('[CAMERATILE] Syncing mode to phone from Calibrator selection')\r\n      setMode('phone')\r\n    }\r\n  }, [preferredCameraLabel, mode, manualModeSetAt])\r\n  \r\n  // Intentionally disabled automatic regeneration of phone pairing codes.\r\n  // Codes will only be created when the user explicitly requests it (button click).\r\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\r\n\r\n  useEffect(() => {\r\n    if (!cameraEnabledSetting || (autoscoreProvider && autoscoreProvider !== 'built-in' && autoscoreProvider !== 'external-ws')) return\r\n    if (autoStart === undefined) return\r\n    if (autoStart) {\r\n      let cancelled = false\r\n      const desiredLabel = preferredCameraLabel || 'default'\r\n      const timer = window.setTimeout(() => {\r\n        if (cancelled || streaming) return\r\n        start().catch(err => console.warn(`[CameraTile] Auto-start failed for ${desiredLabel}:`, err))\r\n      }, 200)\r\n      return () => {\r\n        cancelled = true\r\n        window.clearTimeout(timer)\r\n      }\r\n    }\r\n    stop()\r\n  }, [autoStart, streaming, cameraEnabledSetting, autoscoreProvider, preferredCameraLabel, start, stop])\r\n\r\n  // If the user selected Phone Camera, bind the global stream into this tile\r\n  useEffect(() => {\r\n    const apply = async () => {\r\n      try {\r\n        const allowPhoneAttach = (preferredCameraLabel === 'Phone Camera' && (!manualModeSetAt || Date.now() - manualModeSetAt >= 30_000)) || mode === 'phone'\r\n        if (!allowPhoneAttach) return\r\n        const s = cameraSession.getMediaStream()\r\n        const v = videoRef.current\r\n        if (!v || !s) return\r\n        if (v.srcObject !== s) {\r\n          v.srcObject = s\r\n        }\r\n        v.muted = true\r\n        ;(v as any).playsInline = true\r\n        try { await v.play() } catch {}\r\n        setStreaming(true)\r\n      } catch {}\r\n    }\r\n    // Try immediately and poll briefly to catch late-arriving stream\r\n    apply()\r\n    const t = setInterval(apply, 800)\r\n    return () => clearInterval(t)\r\n  }, [preferredCameraLabel, mode, cameraSession, cameraSession.isStreaming])\r\n\r\n  async function start() {\r\n      console.log('[CameraTile] start() invoked with mode=', mode)\r\n    if (mode === 'wifi') {\r\n      return startWifiConnection()\r\n    }\r\n  console.log('[CameraTile] Attempting to attach global stream for phone mode...')\r\n\r\n    // If phone camera is selected and paired, don't try to start local camera\r\n    if (preferredCameraLabel === 'Phone Camera' || mode === 'phone') {\r\n      const s = cameraSession.getMediaStream()\r\n      if (s && videoRef.current) {\r\n        try {\r\n          videoRef.current.srcObject = s\r\n          await videoRef.current.play()\r\n          setStreaming(true)\r\n          return\r\n        } catch {}\r\n      }\r\n      // If no global stream yet, for phone mode we should attempt pairing\r\n      if (mode === 'phone') {\r\n        try { await startPhonePairing(); return } catch {}\r\n      }\r\n    }\r\n\r\n    try {\r\n      // Prefer saved camera if available\r\n      const { preferredCameraId, setPreferredCamera } = useUserSettings.getState()\r\n      const constraints: MediaStreamConstraints = preferredCameraId ? { video: { deviceId: { exact: preferredCameraId } }, audio: false } : { video: true, audio: false }\r\n      let stream: MediaStream\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints)\r\n      } catch (err: any) {\r\n        const name = (err && (err.name || err.code)) || ''\r\n        if (preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError')) {\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else {\r\n          throw err\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        registerStream(stream, 'local')\r\n      }\r\n      // Camera started successfully - no automatic preference updates\r\n    } catch {}\r\n  }\r\n  function stop() {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n      tracks.forEach(t => t.stop())\r\n      videoRef.current.srcObject = null\r\n      setStreaming(false)\r\n      registerStream(null)\r\n    }\r\n  }\r\n\r\n  async function startWifiConnection() {\r\n    setDiscoveringWifi(true)\r\n    try {\r\n      const devices = await discoverNetworkDevices()\r\n      setWifiDevices(devices)\r\n      if (devices.length === 0) {\r\n        alert('No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.')\r\n      }\r\n    } catch (error) {\r\n      console.error('Wifi device discovery failed:', error)\r\n      alert('Failed to discover wifi devices. Please check your network connection.')\r\n    } finally {\r\n      setDiscoveringWifi(false)\r\n    }\r\n  }\r\n\r\n  async function connectToWifiDevice(device: NetworkDevice) {\r\n    try {\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n\r\n      const stream = await connectToNetworkDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        registerStream(stream, 'wifi')\r\n        setWifiDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to wifi device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  async function startUsbConnection() {\r\n    setDiscoveringUsb(true)\r\n    try {\r\n      // First try to get already paired devices\r\n      const devices = await discoverUSBDevices()\r\n      setUsbDevices(devices)\r\n\r\n      // Then request user to select a new device\r\n      const newDevice = await requestUSBDevice()\r\n      if (newDevice) {\r\n        setUsbDevices(prev => [...prev, newDevice])\r\n      }\r\n\r\n      if (devices.length === 0 && !newDevice) {\r\n        alert('No USB scoring devices found. Please connect a device and try again.')\r\n      }\r\n    } catch (error) {\r\n      console.error('USB device discovery failed:', error)\r\n      alert('Failed to discover USB devices. Please check device connections.')\r\n    } finally {\r\n      setDiscoveringUsb(false)\r\n    }\r\n  }\r\n\r\n  async function connectToUsbDevice(device: USBDevice) {\r\n    try {\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n      const stream = await connectToUSBDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        setMode('wifi') // Using wifi mode for USB devices too\r\n        registerStream(stream, 'wifi')\r\n        setUsbDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to USB device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  // Listen for global event to start local camera from other UI components\r\n  const handleModeSelect = useCallback((newMode: 'local'|'phone'|'wifi'|'usb') => {\r\n    try {\r\n      setMode(newMode === 'usb' ? 'wifi' : newMode)\r\n      setManualModeSetAt(Date.now())\r\n      // Persist the user's selection and lock it to avoid auto-switching\r\n      try {\r\n        if (newMode === 'local') {\r\n          try { setPreferredCamera(preferredCameraId, 'Local', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        } else if (newMode === 'phone') {\r\n          try { setPreferredCamera(undefined, 'Phone Camera', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        } else if (newMode === 'wifi' || newMode === 'usb') {\r\n          try { setPreferredCamera(undefined, 'WiFi/USB', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        }\r\n      } catch {}\r\n      if (newMode === 'local') {\r\n        start().catch(() => {})\r\n      } else if (newMode === 'phone') {\r\n        startPhonePairing()\r\n      } else if (newMode === 'wifi') {\r\n        startWifiConnection()\r\n      } else if (newMode === 'usb') {\r\n        startUsbConnection()\r\n      }\r\n    } catch (err) { console.warn('[CameraTile] handleModeSelect failed', err) }\r\n  }, [start, startPhonePairing, startWifiConnection, startUsbConnection, setPreferredCamera, setPreferredCameraLocked, preferredCameraId])\r\n\r\n  useEffect(() => {\r\n    const onStart = (ev: any) => {\r\n      try {\r\n        const modeFromEvent = ev && ev.detail && ev.detail.mode\r\n        if (modeFromEvent && ['local', 'phone', 'wifi', 'usb'].includes(modeFromEvent)) {\r\n          // Respect explicit mode requests and treat as manual selection\r\n          handleModeSelect(modeFromEvent)\r\n          // Ensure start is invoked after selection is applied\r\n          start().catch(() => {})\r\n        } else {\r\n          // No explicit mode provided — just try to start current mode\r\n          start().catch(() => {})\r\n        }\r\n      } catch {}\r\n    }\r\n    window.addEventListener('ndn:start-camera' as any, onStart as any)\r\n    return () => { window.removeEventListener('ndn:start-camera' as any, onStart as any) }\r\n  }, [start, handleModeSelect])\r\n\r\n  // Phone pairing via WebRTC\r\n  function ensureWS() {\r\n    if (ws && ws.readyState === WebSocket.OPEN) return ws\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    const normalizedEnv = envUrl && envUrl.length > 0\r\n      ? (envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws')\r\n      : undefined\r\n    const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n    const sameOrigin = `${proto}://${window.location.host}/ws`\r\n    const host = window.location.hostname\r\n    const isLocalhost = host === 'localhost' || host === '127.0.0.1'\r\n    const isRenderHost = host.endsWith('onrender.com')\r\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\r\n    const renderWS = `wss://ninedartnation.onrender.com/ws`\r\n    let url = normalizedEnv\r\n    if (!url) {\r\n      if (isLocalhost) {\r\n        url = `${proto}://${host}:8787/ws`\r\n      } else if (isRenderHost) {\r\n        url = sameOrigin\r\n      } else {\r\n        url = renderWS\r\n      }\r\n    }\r\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\r\n    if (!url) url = sameOrigin\r\n    const socket = new WebSocket(url)\r\n    setWs(socket)\r\n    return socket\r\n  }\r\n  async function startPhonePairing() {\r\n    setMode('phone')\r\n    setPaired(false)\r\n    const socket = ensureWS()\r\n    if (socket.readyState === WebSocket.OPEN) {\r\n      socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      socket.onopen = () => socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    }\r\n    socket.onmessage = async (ev) => {\r\n      const data = JSON.parse(ev.data)\r\n      if (data.type === 'cam-code') {\r\n        setPairCode(data.code)\r\n        if (data.expiresAt) setExpiresAt(data.expiresAt)\r\n      } else if (data.type === 'cam-peer-joined') {\r\n        setPaired(true)\r\n        // Create offer to the phone\r\n        const peer = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] })\r\n        setPc(peer)\r\n        peer.onicecandidate = (e) => {\r\n          if (e.candidate && pairCode) socket.send(JSON.stringify({ type: 'cam-ice', code: pairCode, payload: e.candidate }))\r\n        }\r\n        peer.ontrack = (ev) => {\r\n          if (videoRef.current) {\r\n            const inbound = ev.streams?.[0]\r\n            if (inbound) {\r\n              videoRef.current.srcObject = inbound\r\n              videoRef.current.play().catch(()=>{})\r\n              setStreaming(true)\r\n            }\r\n          }\r\n        }\r\n        const offer = await peer.createOffer({ offerToReceiveAudio: false, offerToReceiveVideo: true })\r\n        await peer.setLocalDescription(offer)\r\n        if (pairCode) socket.send(JSON.stringify({ type: 'cam-offer', code: pairCode, payload: offer }))\r\n      } else if (data.type === 'cam-answer') {\r\n        if (pc) await pc.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n      } else if (data.type === 'cam-ice') {\r\n        if (pc) try { await pc.addIceCandidate(data.payload) } catch {}\r\n      }\r\n    }\r\n  }\r\n  function regenerateCode() {\r\n    setPairCode(null)\r\n    setExpiresAt(null)\r\n    setPaired(false)\r\n    if (ws && ws.readyState === WebSocket.OPEN) {\r\n      ws.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      startPhonePairing()\r\n    }\r\n    try { setPreferredCameraLocked(true) } catch {}\r\n  }\r\n\r\n  function stopAll() {\r\n    stop()\r\n    setPairCode(null)\r\n    setPaired(false)\r\n    setExpiresAt(null)\r\n    if (pc) { try { pc.close() } catch {}; setPc(null) }\r\n  }\r\n  return (\r\n  <CameraFrame \r\n      label={label} \r\n      autoStart={autoStart} \r\n      start={start} \r\n      stopAll={stopAll} \r\n      startPhonePairing={startPhonePairing} \r\n      startWifiConnection={startWifiConnection}\r\n      startUsbConnection={startUsbConnection}\r\n      connectToWifiDevice={connectToWifiDevice}\r\n      connectToUsbDevice={connectToUsbDevice}\r\n      videoRef={videoRef} \r\n      streaming={streaming} \r\n      mode={mode} \r\n      setMode={setMode} \r\n      pairCode={pairCode} \r\n      mobileUrl={mobileUrl} \r\n      regenerateCode={regenerateCode} \r\n      httpsInfo={httpsInfo} \r\n      showTips={showTips} \r\n      setShowTips={setShowTips} \r\n      wifiDevices={wifiDevices}\r\n      usbDevices={usbDevices}\r\n      discoveringWifi={discoveringWifi}\r\n      discoveringUsb={discoveringUsb}\r\n      scaleOverride={scaleOverride} \r\n      className={className}\r\n      aspect={aspect}\r\n      style={style}\r\n      fill={fill}\r\n        onModeSelect={handleModeSelect}\r\n      preferredCameraLocked={preferredCameraLocked}\r\n      />\r\n  )\r\n}\r\n\r\nfunction CameraFrame(props: any) {\r\n  const cameraSession = useCameraSession()\r\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings()\r\n  const {\r\n    label,\r\n    start,\r\n    stopAll,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n  startUsbConnection,\r\n    connectToWifiDevice,\r\n    connectToUsbDevice,\r\n    videoRef,\r\n    streaming,\r\n  mode,\r\n    setMode,\r\n  onModeSelect,\r\n    pairCode,\r\n    mobileUrl,\r\n    regenerateCode,\r\n    httpsInfo,\r\n    showTips,\r\n    setShowTips,\r\n    wifiDevices,\r\n    usbDevices,\r\n    discoveringWifi,\r\n    discoveringUsb,\r\n    className,\r\n    aspect,\r\n    style,\r\n    fill,\r\n  preferredCameraLocked,\r\n  } = props\r\n\r\n  const modeDisplayName: Record<string, string> = {\r\n    local: 'Local',\r\n    phone: 'PhoneCam',\r\n    wifi: 'Wi-Fi/USB',\r\n  }\r\n\r\n  const reconnectOptions = useMemo(() => {\r\n    return [\r\n      {\r\n        id: 'local',\r\n        title: 'Local camera',\r\n        description: 'Use the desktop webcam or capture card.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('local')\r\n          },\r\n      },\r\n      {\r\n        id: 'phone',\r\n        title: 'PhoneCam',\r\n        description: 'Stream from your phone via the mobile link.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('phone')\r\n          },\r\n      },\r\n      {\r\n        id: 'wifi',\r\n        title: 'Wi-Fi/USB',\r\n        description: 'Connect to scoring devices on your local network.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('wifi')\r\n          },\r\n      },\r\n      {\r\n        id: 'usb',\r\n        title: 'USB',\r\n        description: 'Connect a USB capture device (treated like WiFi mode).',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('usb')\r\n          },\r\n      },\r\n    ]\r\n  }, [setMode, start, startPhonePairing, startWifiConnection, startUsbConnection])\r\n\r\n  const [copyFeedback, setCopyFeedback] = useState<'link' | 'code' | null>(null)\r\n  const copyTimeoutRef = useRef<number | null>(null)\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n    }\r\n  }, [])\r\n\r\n  // Respect stored aspect unless we're explicitly in full-bleed fill mode,\r\n  // in which case drop the aspect box so the video can truly cover the area.\r\n  const { cameraFitMode: globalFitMode } = useUserSettings()\r\n  const effectiveFitMode: 'fit' | 'fill' = fill ? 'fill' : (globalFitMode || 'fill')\r\n  // In fill mode we guarantee no black bars: never allow downscaling below 1.0\r\n  const scale = (() => {\r\n    const raw = Number(props.scaleOverride ?? cameraScale ?? 1)\r\n    const clamped = Math.max(0.5, Math.min(1.25, raw))\r\n    return effectiveFitMode === 'fill' ? Math.max(1, clamped) : clamped\r\n  })()\r\n  const aspectChoice: 'wide' | 'square' | 'portrait' | 'classic' | 'free' = (fill && effectiveFitMode === 'fill')\r\n    ? 'free'\r\n    : (aspect && aspect !== 'inherit')\r\n      ? aspect\r\n      : ((storedAspect as any) || 'wide')\r\n\r\n  const shouldMaintainAspect = aspectChoice !== 'free'\r\n  const aspectClass = shouldMaintainAspect\r\n    ? aspectChoice === 'square'\r\n      ? 'aspect-square'\r\n      : aspectChoice === 'portrait'\r\n        ? 'aspect-[3/4]'\r\n        : aspectChoice === 'classic'\r\n          ? 'aspect-[4/3]'\r\n          : 'aspect-video'\r\n    : ''\r\n\r\n  const containerBase = fill\r\n    ? 'rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30'\r\n    : 'rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30'\r\n  const containerClass = [containerBase, className].filter(Boolean).join(' ').trim()\r\n  const containerStyle: CSSProperties = { ...(style || {}) }\r\n\r\n  const viewportClass = fill ? 'relative flex-1 min-h-[420px] bg-black' : 'relative w-full bg-black'\r\n\r\n  const commonVideoProps = {\r\n    style: { transform: `scale(${scale})`, transformOrigin: 'center' as const },\r\n  }\r\n\r\n  const usbActive = mode === 'wifi' && usbDevices.some((d: USBDevice) => d.status === 'online')\r\n\r\n  const videoElement = (() => {\r\n    // Apply Fit/Fill preference (fill prop hard-overrides to full-bleed)\r\n    const isFit = effectiveFitMode === 'fit'\r\n    const baseVideoClass = isFit\r\n      // Fit: preserve entire frame (may letterbox)\r\n      ? 'absolute inset-0 w-full h-full object-contain object-center bg-transparent'\r\n      // Fill: guarantee full coverage with object-cover so there are no black bars\r\n      : 'absolute inset-0 w-full h-full object-cover object-center bg-transparent'\r\n    if (fill) {\r\n      if (shouldMaintainAspect) {\r\n        return (\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div className={`relative w-full max-w-full max-h-full ${aspectClass}`}>\r\n              <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n      return <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n    }\r\n    if (shouldMaintainAspect) {\r\n      return (\r\n        <div className={`relative w-full ${aspectClass}`}>\r\n          <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n        </div>\r\n      )\r\n    }\r\n    return <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n  })()\r\n\r\n  async function copyValue(value: string | null | undefined, type: 'link' | 'code') {\r\n    if (!value) return\r\n    try {\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        await navigator.clipboard.writeText(value)\r\n      } else {\r\n        const textarea = document.createElement('textarea')\r\n        textarea.value = value\r\n        textarea.style.position = 'fixed'\r\n        textarea.style.opacity = '0'\r\n        document.body.appendChild(textarea)\r\n        textarea.focus()\r\n        textarea.select()\r\n        document.execCommand('copy')\r\n        document.body.removeChild(textarea)\r\n      }\r\n      setCopyFeedback(type)\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n      copyTimeoutRef.current = window.setTimeout(() => setCopyFeedback(null), 1500)\r\n    } catch (err) {\r\n      console.warn('Copy to clipboard failed:', err)\r\n      setCopyFeedback(null)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={containerClass} style={containerStyle}>\r\n      <div className={viewportClass}>\r\n        {videoElement}\r\n        {(cameraSession.isStreaming && (mode==='phone')) && (\r\n          <div className=\"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg\">\r\n            <span className=\"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse\" />\r\n            <span>REC</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n  <div className=\"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50\">\r\n  <span className=\"truncate font-medium\">{label || (streaming ? (mode==='phone' ? 'PHONE LIVE' : mode==='wifi' ? 'WIFI LIVE' : 'LIVE') : 'Camera')}{preferredCameraLocked && <span className=\"ml-2 text-xs opacity-80\">🔒</span>}</span>\r\n        <div className=\"flex items-center gap-2\">\r\n          {!streaming && (\r\n            <>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='local'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => onModeSelect('local')}>Local</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='phone'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => onModeSelect('phone')}>Phone</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='wifi'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => onModeSelect('wifi')}>WiFi</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='wifi'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => onModeSelect('usb')}>USB</button>\r\n            </>\r\n          )}\r\n          {streaming ? (\r\n            <button className=\"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all\" onClick={stopAll}>Stop</button>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n      {mode==='phone' && pairCode && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\r\n          <button\r\n            type=\"button\"\r\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\r\n            onClick={() => copyValue(mobileUrl, 'link')}\r\n            title=\"Copy mobile camera link\"\r\n          >\r\n            <span className=\"flex-1 min-w-0 font-mono break-all\">{mobileUrl}</span>\r\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'link' ? 'Copied!' : 'Copy'}</span>\r\n          </button>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <a\r\n              href={mobileUrl}\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\r\n            >\r\n              Open link\r\n            </a>\r\n            <button\r\n              type=\"button\"\r\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n              onClick={() => copyValue(pairCode, 'code')}\r\n              title=\"Copy pairing code\"\r\n            >\r\n              <span className=\"font-mono tracking-[0.3em] text-sm\">{pairCode}</span>\r\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'code' ? 'Copied!' : 'Copy'}</span>\r\n            </button>\r\n          </div>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <button className=\"px-1 py-0.5 rounded bg-slate-700\" onClick={regenerateCode}>Regenerate</button>\r\n          </div>\r\n          {showTips && (\r\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\r\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\r\n              <ul className=\"list-disc pl-4 space-y-1\">\r\n                <li>Phone and desktop must be on the same Wi‑Fi network.</li>\r\n                <li>Allow the server through your firewall (ports 8787 and {httpsInfo?.https ? httpsInfo.port : 8788}).</li>\r\n                <li>On iPhone, use HTTPS links (QR will prefer https when enabled).</li>\r\n              </ul>\r\n              <div className=\"mt-2 text-right\"><button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={()=>setShowTips(false)}>Hide tips</button></div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      {mode==='wifi' && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\r\n          \r\n          {/* WiFi Devices */}\r\n          <div className=\"mb-3\">\r\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\r\n            {discoveringWifi ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning network...</span>\r\n              </div>\r\n            ) : wifiDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {wifiDevices.map((device: NetworkDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.ip}:{device.port}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToWifiDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Rescan WiFi</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Scan WiFi</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n\r\n          {/* USB Devices */}\r\n          <div>\r\n            <div className=\"font-medium mb-1\">USB Devices</div>\r\n            {discoveringUsb ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning USB...</span>\r\n              </div>\r\n            ) : usbDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {usbDevices.map((device: USBDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.type.toUpperCase()}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToUsbDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Rescan USB</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Scan USB</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {!streaming && (\r\n        <div className=\"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div>\r\n              <div className=\"text-[10px] uppercase tracking-wide text-slate-500\">Camera modes</div>\r\n              <div className=\"text-sm font-semibold text-slate-900\">Reconnect camera</div>\r\n            </div>\r\n            <span className=\"text-xs text-slate-500\">Current: {modeDisplayName[mode] || 'Local'}</span>\r\n          </div>\r\n          <p className=\"text-xs text-slate-500 mb-2\">Tap a mode to restart the feed or switch inputs.</p>\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {reconnectOptions.map(option => {\r\n              const isActive = option.id === 'usb'\r\n                ? usbActive\r\n                : option.id === mode\r\n              return (\r\n                <button\r\n                  key={option.id}\r\n                  type=\"button\"\r\n                  onClick={option.action}\r\n                  className={`text-left p-3 rounded-2xl border ${isActive ? 'border-emerald-500 bg-emerald-50 shadow' : 'border-slate-200 bg-white/80 hover:bg-slate-50'} transition`}\r\n                >\r\n                  <div className=\"text-xs font-semibold uppercase tracking-wide text-slate-500\">{option.title}</div>\r\n                  <div className=\"text-[11px] text-slate-600 mt-1\">{option.description}</div>\r\n                  {isActive && <div className=\"text-[10px] text-emerald-500 mt-2\">Active</div>}\r\n                </button>\r\n              )\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}","import React, { useEffect, useRef } from 'react'\r\nimport useHeatmapStore from '../store/heatmap'\r\nimport { BoardRadii } from '../utils/vision'\r\n\r\nfunction polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {\r\n  const a = (angleDeg - 90) * Math.PI / 180.0\r\n  return { x: cx + (r * Math.cos(a)), y: cy + (r * Math.sin(a)) }\r\n}\r\n\r\nfunction sectorAngle(sector: number) {\r\n  // SectorOrder puts 20 at top; 360/20 = 18deg per sector\r\n  const SectorOrder = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5]\r\n  const idx = SectorOrder.indexOf(sector)\r\n  const mid = (idx * 18) + 9 // middle of sector\r\n  return mid\r\n}\r\n\r\nexport default function HeatMap({ width = 320, height = 320 }: { width?: number; height?: number }) {\r\n  const samples = useHeatmapStore(s => s.samples)\r\n  const ref = useRef<HTMLCanvasElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    const c = ref.current\r\n    if (!c) return\r\n    const ctx = c.getContext('2d')\r\n    if (!ctx) return\r\n    c.width = width; c.height = height\r\n    ctx.clearRect(0,0,width,height)\r\n    // Draw a faint dartboard backdrop (rings)\r\n    const cx = width / 2\r\n    const cy = height / 2\r\n    const scale = Math.min(width, height) / (BoardRadii.doubleOuter * 2 + 20)\r\n    const radii = {\r\n      bullInner: BoardRadii.bullInner * scale,\r\n      bullOuter: BoardRadii.bullOuter * scale,\r\n      trebleInner: BoardRadii.trebleInner * scale,\r\n      trebleOuter: BoardRadii.trebleOuter * scale,\r\n      doubleInner: BoardRadii.doubleInner * scale,\r\n      doubleOuter: BoardRadii.doubleOuter * scale,\r\n    }\r\n    // rings\r\n    ctx.strokeStyle = 'rgba(255,255,255,0.06)'\r\n    ctx.lineWidth = 1\r\n    const ringOrder = ['doubleOuter','doubleInner','trebleOuter','trebleInner','bullOuter','bullInner'] as const\r\n    for (const k of ringOrder) {\r\n      ctx.beginPath(); ctx.arc(cx, cy, (radii as any)[k], 0, Math.PI*2); ctx.stroke();\r\n    }\r\n\r\n    // Aggregate sample weights by approximate xy\r\n    const points: { x:number;y:number;w:number }[] = []\r\n    for (const s of samples) {\r\n      // if sector unknown, scatter in board\r\n      let angle = Math.random() * 360\r\n      let r = Math.random() * radii.doubleOuter\r\n      if (typeof s.sector === 'number' && s.sector >= 1 && s.sector <= 20) {\r\n        angle = sectorAngle(s.sector)\r\n        // choose radius by mult/ring\r\n        if (s.ring === 'DOUBLE') r = (radii.doubleInner + radii.doubleOuter)/2\r\n        else if (s.ring === 'TRIPLE') r = (radii.trebleInner + radii.trebleOuter)/2\r\n        else if (s.ring === 'INNER_BULL') r = radii.bullInner * 0.5\r\n        else if (s.ring === 'BULL') r = radii.bullOuter * 0.8\r\n        else r = (radii.trebleOuter + radii.doubleInner)/2 * (0.6 + Math.random()*0.4)\r\n      }\r\n      const p = polarToCartesian(cx, cy, r, angle)\r\n      points.push({ x: p.x, y: p.y, w: 1 })\r\n    }\r\n\r\n    // Draw heat circles additive\r\n    for (const p of points) {\r\n      const grd = ctx.createRadialGradient(p.x, p.y, 1, p.x, p.y, 60)\r\n      grd.addColorStop(0, 'rgba(255,0,0,0.9)')\r\n      grd.addColorStop(0.3, 'rgba(255,100,0,0.5)')\r\n      grd.addColorStop(1, 'rgba(255,100,0,0)')\r\n      ctx.fillStyle = grd\r\n      ctx.beginPath(); ctx.arc(p.x, p.y, 60, 0, Math.PI*2); ctx.fill()\r\n    }\r\n\r\n    // Optionally overlay counts per sector\r\n    ctx.fillStyle = 'rgba(255,255,255,0.85)'\r\n    ctx.font = '12px ui-sans-serif'\r\n    // compute counts per sector\r\n    const sectorCounts: Record<number, number> = {}\r\n    for (const s of samples) if (s.sector) sectorCounts[s.sector] = (sectorCounts[s.sector] || 0) + 1\r\n    for (const secStr of Object.keys(sectorCounts)) {\r\n      const sec = Number(secStr)\r\n      const a = sectorAngle(sec)\r\n      const pos = polarToCartesian(cx, cy, radii.trebleOuter + 18, a)\r\n      ctx.fillText(String(sectorCounts[sec]), pos.x-6, pos.y+4)\r\n    }\r\n  }, [samples, width, height])\r\n\r\n  return <canvas ref={ref} style={{ width: '100%', height: 'auto', borderRadius: 8, background: '#081018' }} />\r\n}\r\n","/**\r\n * Scam, Fives, and Sevens game logic\r\n * All three follow a similar score-race pattern:\r\n * - Players accumulate scores\r\n * - Only certain numbers count\r\n * - First to reach target wins\r\n */\r\n\r\n// SCAM/SCUM - Hit targets 1→20→Bull in sequence\r\nexport interface ScamState {\r\n  targetIndex: number // 0-20 for numbers 1-20, 21 for bull (25/50)\r\n  darts: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createScamState(): ScamState {\r\n  return {\r\n    targetIndex: 0,\r\n    darts: 0,\r\n    finished: false,\r\n  }\r\n}\r\n\r\nexport const SCAM_TARGETS = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25]\r\nexport const SCAM_TARGET_NAMES = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', 'Bull']\r\n\r\nexport function getScamTarget(state: ScamState): number {\r\n  return SCAM_TARGETS[state.targetIndex]\r\n}\r\n\r\nexport function addScamAuto(state: ScamState, value: number, ring?: string): ScamState {\r\n  if (state.finished) return state\r\n\r\n  const target = getScamTarget(state)\r\n  const targetHit = (ring === 'SINGLE' && value === target) || (ring === 'DOUBLE' && value === target) || (ring === 'TRIPLE' && value === target) || (ring === 'INNER_BULL' && target === 25)\r\n\r\n  if (!targetHit) return state\r\n\r\n  // Hit! Move to next target\r\n  const newIndex = state.targetIndex + 1\r\n  const finished = newIndex >= SCAM_TARGETS.length\r\n\r\n  return {\r\n    targetIndex: newIndex,\r\n    darts: state.darts + 1,\r\n    finished,\r\n  }\r\n}\r\n\r\nexport function addScamNumeric(state: ScamState, value: number): ScamState {\r\n  // For manual input, assume single ring hit\r\n  return addScamAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetScam(): ScamState {\r\n  return createScamState()\r\n}\r\n\r\n// FIVES - Only multiples of 5 count (5,10,15,20,25,50)\r\nexport interface FivesState {\r\n  score: number\r\n  darts: number\r\n  finished: boolean\r\n  target: number // default 50\r\n}\r\n\r\nexport function createFivesState(target: number = 50): FivesState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  }\r\n}\r\n\r\nexport const FIVES_VALID_NUMBERS = [5, 10, 15, 20, 25, 50]\r\n\r\nexport function isFivesValid(value: number): boolean {\r\n  return FIVES_VALID_NUMBERS.includes(value)\r\n}\r\n\r\nexport function addFivesAuto(state: FivesState, value: number, ring?: string): FivesState {\r\n  if (state.finished) return state\r\n\r\n  // Only multiples of 5 count\r\n  if (!isFivesValid(value)) {\r\n    return { ...state, darts: state.darts + 1 }\r\n  }\r\n\r\n  const newScore = state.score + value\r\n  const finished = newScore >= state.target\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  }\r\n}\r\n\r\nexport function addFivesNumeric(state: FivesState, value: number): FivesState {\r\n  return addFivesAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetFives(target: number = 50): FivesState {\r\n  return createFivesState(target)\r\n}\r\n\r\n// SEVENS - Only multiples of 7 count (7,14,21)\r\nexport interface SevensState {\r\n  score: number\r\n  darts: number\r\n  finished: boolean\r\n  target: number // default 70\r\n}\r\n\r\nexport function createSevensState(target: number = 70): SevensState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  }\r\n}\r\n\r\nexport const SEVENS_VALID_NUMBERS = [7, 14, 21]\r\n\r\nexport function isSevensValid(value: number): boolean {\r\n  return SEVENS_VALID_NUMBERS.includes(value)\r\n}\r\n\r\nexport function addSevensAuto(state: SevensState, value: number, ring?: string): SevensState {\r\n  if (state.finished) return state\r\n\r\n  // Only multiples of 7 count\r\n  if (!isSevensValid(value)) {\r\n    return { ...state, darts: state.darts + 1 }\r\n  }\r\n\r\n  const newScore = state.score + value\r\n  const finished = newScore >= state.target\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  }\r\n}\r\n\r\nexport function addSevensNumeric(state: SevensState, value: number): SevensState {\r\n  return addSevensAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetSevens(target: number = 70): SevensState {\r\n  return createSevensState(target)\r\n}\r\n","// Small adapter helpers to convert generic MatchControls onAddVisit callbacks to the local handlers\r\nexport function makeOnlineAddVisitAdapter(submitVisitManual: (v: number) => void) {\r\n  return (score: number, darts: number) => { submitVisitManual(score) }\r\n}\r\n\r\nexport function makeOfflineAddVisitAdapter(commitManualVisitTotal: (v: number) => boolean) {\r\n  return (score: number, darts: number) => { commitManualVisitTotal(score) }\r\n}\r\n","import type { Actions as MatchActions } from '../store/match'\r\n\r\nexport type UnifiedMatchActions = {\r\n  addVisit: (score: number, darts?: number, meta?: any) => void\r\n  undoVisit: () => void\r\n  nextPlayer: () => void\r\n  endLeg: (score?: number) => void\r\n  endGame: () => void\r\n}\r\n\r\nexport function createOnlineMatchActions(args: { match: MatchActions; sendState: () => void; submitVisitManual?: (v:number)=>void }) : UnifiedMatchActions {\r\n  const { match, sendState, submitVisitManual } = args\r\n  return {\r\n    addVisit: (score: number, darts = 3, meta?: any) => {\r\n      // Prefer the manual submit helper when available as it computes double/finish meta\r\n      if (submitVisitManual) { submitVisitManual(score); return }\r\n      try { match.addVisit(score, darts, meta) } catch { match.addVisit(score, darts) }\r\n      try { sendState() } catch {}\r\n    },\r\n    undoVisit: () => { match.undoVisit(); try { sendState() } catch {} },\r\n    nextPlayer: () => { match.nextPlayer(); try { sendState() } catch {} },\r\n    endLeg: (score?: number) => { if (typeof score === 'number') match.endLeg(score); else match.endLeg(0); try { sendState() } catch {} },\r\n    endGame: () => { match.endGame(); try { sendState() } catch {} },\r\n  }\r\n}\r\n\r\nexport function createOfflineMatchActions(args: { match: MatchActions; commitManualVisitTotal?: (v:number)=>boolean; endTurn?: (nextRemaining:number)=>void }) : UnifiedMatchActions {\r\n  const { match, commitManualVisitTotal, endTurn } = args\r\n  return {\r\n    addVisit: (score: number, darts = 3, meta?: any) => {\r\n      if (commitManualVisitTotal) { commitManualVisitTotal(score); return }\r\n      try { match.addVisit(score, darts, meta) } catch { match.addVisit(score, darts) }\r\n    },\r\n    undoVisit: () => { match.undoVisit() },\r\n    nextPlayer: () => { if (endTurn) { try { endTurn(0) } catch { match.nextPlayer() } } else { match.nextPlayer() } },\r\n    endLeg: (score?: number) => { if (typeof score === 'number') match.endLeg(score); else match.endLeg(0) },\r\n    endGame: () => { match.endGame() },\r\n  }\r\n}\r\n","/**\r\n * Hook to convert OfflinePlay game state to GameScoreboard format\r\n */\r\n\r\nimport { useMemo } from 'react';\r\nimport type { PlayerStats } from './GameScoreboard';\r\nimport type { GameMode } from './GameScoreboard';\r\nimport { getAllTimeAvg } from '../../store/profileStats';\r\n\r\nexport function useOfflineGameStats(\r\n  gameMode: GameMode,\r\n  // X01 state\r\n  playerScore?: number,\r\n  aiScore?: number,\r\n  playerLegs?: number,\r\n  aiLegs?: number,\r\n  playerLastDart?: number,\r\n  aiLastDart?: number,\r\n  playerVisitSum?: number,\r\n  aiVisitSum?: number,\r\n  playerLastVisitScore?: number | null,\r\n  aiLastVisitScore?: number | null,\r\n  playerVisitDartCount?: number,\r\n  aiVisitDartCount?: number,\r\n  playerDoublesHit?: number,\r\n  playerDoublesAtt?: number,\r\n  aiDoublesHit?: number,\r\n  aiDoublesAtt?: number,\r\n  legStats?: Array<any>,\r\n  isPlayerTurn?: boolean,\r\n  ai?: string,\r\n  x01Score?: number,\r\n  // Cricket state\r\n  cricket?: any,\r\n  // Shanghai state\r\n  shanghai?: any,\r\n  // Killer state\r\n  killerPlayers?: Array<any>,\r\n  killerStates?: Record<string, any>,\r\n  killerAssigned?: Record<string, number>,\r\n  killerTurnIdx?: number\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (gameMode === 'X01') {\r\n      // Calculate player match average\r\n      let playerMatchAvg = 0;\r\n      let playerDarts = 0;\r\n      let playerScored = 0;\r\n      if (legStats && legStats.length > 0) {\r\n        for (const leg of legStats) {\r\n          if (leg.dartsThrown && leg.totalScored) {\r\n            playerDarts += leg.dartsThrown;\r\n            playerScored += leg.totalScored;\r\n          }\r\n        }\r\n        if (playerDarts > 0) {\r\n          playerMatchAvg = (playerScored / playerDarts) * 3;\r\n        }\r\n      }\r\n\r\n      // Player card\r\n      const playerVisitDarts = playerVisitDartCount ?? 0\r\n      const playerCurrentVisitActive = playerVisitDarts > 0\r\n      const playerCurrentVisitSum = playerVisitSum ?? 0\r\n      const playerLastVisitTotal = playerLastVisitScore ?? null\r\n      const playerLastDartValue = playerLastDart ?? 0\r\n      const resolvedPlayerLastScore = playerCurrentVisitActive\r\n        ? playerCurrentVisitSum\r\n        : (playerLastVisitTotal ?? playerLastDartValue)\r\n\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        legsWon: playerLegs || 0,\r\n        score: playerScore || 0,\r\n        lastScore: resolvedPlayerLastScore,\r\n        checkoutRate: playerDoublesAtt && playerDoublesAtt > 0 \r\n          ? Math.round((playerDoublesHit || 0) / playerDoublesAtt * 100)\r\n          : 0,\r\n        bestLeg: legStats && legStats.length > 0 \r\n          ? `${Math.min(...legStats.map(l => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\r\n          : '—',\r\n        matchAvg: playerMatchAvg,\r\n        allTimeAvg: getAllTimeAvg('You') || 0\r\n      });\r\n\r\n      // AI card (if playing against AI)\r\n      if (ai && ai !== 'None') {\r\n        const aiVisitDarts = aiVisitDartCount ?? 0\r\n        const aiCurrentVisitActive = aiVisitDarts > 0\r\n        const aiCurrentVisitSum = aiVisitSum ?? 0\r\n        const aiLastVisitTotal = aiLastVisitScore ?? null\r\n        const aiLastDartValue = aiLastDart ?? 0\r\n        const resolvedAiLastScore = aiCurrentVisitActive\r\n          ? aiCurrentVisitSum\r\n          : (aiLastVisitTotal ?? aiLastDartValue)\r\n\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          legsWon: aiLegs || 0,\r\n          score: aiScore || 0,\r\n          lastScore: resolvedAiLastScore,\r\n          checkoutRate: aiDoublesAtt && aiDoublesAtt > 0 \r\n            ? Math.round((aiDoublesHit || 0) / aiDoublesAtt * 100)\r\n            : 0,\r\n          bestLeg: '—'\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Cricket') {\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        closed: cricket?.marks || {},\r\n        points: cricket?.points || 0\r\n      });\r\n\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          closed: {},\r\n          points: 0\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Shanghai') {\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        round: shanghai?.round || 1,\r\n        target: shanghai?.target || 1,\r\n        score: shanghai?.score || 0\r\n      });\r\n\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          round: shanghai?.round || 1,\r\n          target: shanghai?.target || 1,\r\n          score: 0\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Killer' && killerPlayers && killerPlayers.length > 0) {\r\n      killerPlayers.forEach((p, idx) => {\r\n        const state = killerStates?.[p.id];\r\n        players.push({\r\n          name: p.name,\r\n          isCurrentTurn: idx === killerTurnIdx,\r\n          number: killerAssigned?.[p.id],\r\n          lives: state?.lives || 0,\r\n          eliminated: state?.eliminated || false\r\n        });\r\n      });\r\n    }\r\n\r\n    return players;\r\n  }, [\r\n    gameMode,\r\n    playerScore, aiScore,\r\n    playerLegs, aiLegs,\r\n    playerLastDart, aiLastDart,\r\n  playerVisitSum, aiVisitSum,\r\n  playerLastVisitScore, aiLastVisitScore,\r\n  playerVisitDartCount, aiVisitDartCount,\r\n    playerDoublesHit, playerDoublesAtt,\r\n    aiDoublesHit, aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn, ai,\r\n    cricket,\r\n    shanghai,\r\n    killerPlayers, killerStates, killerAssigned, killerTurnIdx\r\n  ]);\r\n}\r\n\r\nexport function useOnlineGameStats(\r\n  gameMode: GameMode,\r\n  matchState?: any, // From useMatch() store\r\n  participants?: string[]\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (!matchState || !matchState.players || matchState.players.length === 0) {\r\n      return players;\r\n    }\r\n\r\n    matchState.players.forEach((player: any, idx: number) => {\r\n      const isCurrentTurn = idx === matchState.currentPlayerIdx;\r\n      \r\n      if (gameMode === 'X01') {\r\n        // Calculate match average for this player\r\n        let matchAvg = 0;\r\n        let totalDarts = 0;\r\n        let totalScored = 0;\r\n\r\n        if (player.legs && player.legs.length > 0) {\r\n          for (const leg of player.legs) {\r\n            if (leg.finished) {\r\n              const legDarts = leg.dartsThrown || 0;\r\n              const legScored = Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining) || 0;\r\n              totalDarts += legDarts;\r\n              totalScored += legScored;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (totalDarts > 0) {\r\n          matchAvg = (totalScored / totalDarts) * 3;\r\n        }\r\n\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          legsWon: player.legsWon || 0,\r\n          score: player.score || 0,\r\n          lastScore: player.lastVisitScore || 0,\r\n          checkoutRate: player.doublesAttempted > 0 \r\n            ? Math.round((player.doublesHit / player.doublesAttempted) * 100)\r\n            : 0,\r\n          bestLeg: player.bestLegDarts ? `${player.bestLegDarts} darts` : '—',\r\n          matchAvg: matchAvg,\r\n          allTimeAvg: player.name ? getAllTimeAvg(player.name) : 0\r\n        });\r\n      }\r\n\r\n      if (gameMode === 'Cricket') {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          closed: player.cricket?.marks || {},\r\n          points: player.cricket?.points || 0\r\n        });\r\n      }\r\n\r\n      if (gameMode === 'Killer') {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          number: player.killerNumber || null,\r\n          lives: player.killerLives || 3,\r\n          eliminated: player.killerEliminated || false\r\n        });\r\n      }\r\n    });\r\n\r\n    return players;\r\n  }, [gameMode, matchState, participants]);\r\n}\r\n","\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { suggestCheckouts, sayScore } from '../utils/checkout';\r\nimport { useUserSettings } from '../store/userSettings';\r\nimport { useToast } from '../store/toast';\r\nimport { useCalibration } from '../store/calibration';\r\nimport GameCalibrationStatus from './GameCalibrationStatus';\r\nimport CameraTile from './CameraTile';\r\nimport CameraView from './CameraView';\r\nimport HeatMap from './HeatMap';\r\nimport { getUserCurrency, formatPriceInCurrency } from '../utils/config';\r\nimport { bumpGameMode } from '../store/profileStats';\r\nimport { DOUBLE_PRACTICE_ORDER, isDoubleHit, parseManualDart } from '../game/types';\r\nimport { ATC_ORDER } from '../game/aroundTheClock';\r\nimport { createCricketState, applyCricketDart, CRICKET_NUMBERS, hasClosedAll as cricketClosedAll } from '../game/cricket';\r\nimport { createShanghaiState, applyShanghaiDart, endShanghaiTurn } from '../game/shanghai';\r\nimport { createDefaultHalveIt, getCurrentHalveTarget, applyHalveItDart, endHalveItTurn } from '../game/halveIt';\r\nimport { createHighLow, applyHighLowDart, endHighLowTurn } from '../game/highLow';\r\nimport { createKillerState, assignKillerNumbers, applyKillerDart, killerWinner, KillerState } from '../game/killer';\r\nimport { createBaseball, applyBaseballDart } from '../game/baseball';\r\nimport { createGolf, applyGolfDart } from '../game/golf';\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from '../game/ticTacToe';\r\nimport { createScamState, addScamAuto, addScamNumeric, resetScam, getScamTarget, SCAM_TARGET_NAMES, ScamState, createFivesState, addFivesAuto, addFivesNumeric, resetFives, FivesState, createSevensState, addSevensAuto, addSevensNumeric, resetSevens, SevensState } from '../game/scamFivesSevens';\r\nimport { createAmCricketState, applyAmCricketDart, AM_CRICKET_NUMBERS, hasClosedAllAm } from '../game/americanCricket';\r\nimport ResizableModal from './ui/ResizableModal';\r\nimport MatchStartShowcase from './ui/MatchStartShowcase'\r\nimport { useAudit } from '../store/audit';\r\nimport ResizablePanel from './ui/ResizablePanel';\r\nimport GameHeaderBar from './ui/GameHeaderBar';\r\nimport GameScoreboard, { type PlayerStats } from './scoreboards/GameScoreboard';\r\nimport MatchControls from './MatchControls'\r\nimport { makeOfflineAddVisitAdapter } from './matchControlAdapters'\r\nimport { createOfflineMatchActions, UnifiedMatchActions } from '../logic/matchActions'\r\nimport { useMatch } from '../store/match'\r\nimport { useOfflineGameStats } from './scoreboards/useGameStats';\r\nimport { freeGames, premiumGames, allGames } from '../utils/games';\r\n\r\nconst aiLevels = ['Easy', 'Medium', 'Hardened'];\r\n\r\nfunction clamp(n: number, min: number, max: number) {\r\n  return Math.max(min, Math.min(max, n));\r\n}\r\n\r\ntype PendingAutoVisit = {\r\n  visitTotal: number\r\n  darts: number\r\n  preRemaining: number\r\n  remaining: number\r\n  doubleAttempts: number\r\n  finished: boolean\r\n  doubleWindow: boolean\r\n  highestCheckout?: number | null\r\n  announced?: boolean\r\n}\r\n\r\nconst BOARD_CLEAR_GRACE_MS = 6500;\r\n\r\nfunction aiVisitScore(remaining: number, level: string): number {\r\n  let target = 0;\r\n  if (level === 'Easy') {\r\n    const candidates = [22, 26, 41, 45, 60];\r\n    target = candidates[Math.floor(Math.random() * candidates.length)];\r\n  } else if (level === 'Medium') {\r\n    target = Math.round(clamp(60 + (Math.random() * 30 - 15), 30, 100));\r\n  } else {\r\n    target = Math.round(clamp(80 + (Math.random() * 20 - 10), 50, 120));\r\n  }\r\n  if (remaining <= 0) return 0;\r\n  if (target > remaining) {\r\n    const safe = [100, 85, 81, 60, 57, 45, 41, 26, 22, 20, 1].find(v => v <= remaining);\r\n    return safe ?? 0;\r\n  }\r\n  return target;\r\n}\r\n\r\nfunction X01RulesPopup({ onClose }: { onClose: () => void }) {\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n      <div className=\"card max-w-lg w-full relative\">\r\n        <button className=\"absolute top-2 right-2 btn px-2 py-1\" onClick={onClose}>Close</button>\r\n        <h3 className=\"text-xl font-bold mb-2\">X01 Rules & Regulations</h3>\r\n        <ul className=\"list-disc pl-5 text-left mb-2\">\r\n          <li>Double In: Start scoring only after hitting a double.</li>\r\n          <li>Double Out: Finish the game by hitting a double to reach exactly zero.</li>\r\n          <li>Best Of: Play a set number of legs, winner is first to reach majority.</li>\r\n          <li>First To: Play until a player reaches a set number of legs.</li>\r\n          <li>No Cheating: All scores must be valid, no manual score changes mid-leg.</li>\r\n          <li>Competitive Standard: Follow latest WDF/PDC rules for match play.</li>\r\n        </ul>\r\n        <p className=\"text-sm text-slate-600\">For full details, see official darts governing body rules.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n\r\nexport default function OfflinePlay({ user }: { user: any }) {\r\n  const {\r\n    offlineLayout,\r\n    favoriteDouble,\r\n    callerEnabled,\r\n    callerVoice,\r\n    callerVolume,\r\n    speakCheckoutOnly,\r\n    rememberLastOffline,\r\n    setLastOffline,\r\n    autoStartOffline,\r\n    cameraScale,\r\n    setCameraScale,\r\n    cameraAspect = 'wide',\r\n    setCameraAspect,\r\n    cameraFitMode = 'fill',\r\n    setCameraFitMode,\r\n    cameraEnabled,\r\n    textSize,\r\n    boxSize,\r\n    autoscoreProvider,\r\n    autoCommitMode = 'wait-for-clear',\r\n    matchType = 'singles',\r\n    setMatchType,\r\n    teamAName = 'Team A',\r\n    setTeamAName,\r\n    teamBName = 'Team B',\r\n    setTeamBName,\r\n  } = useUserSettings()\r\n  const manualScoring = autoscoreProvider === 'manual'\r\n  const cameraToolbarVisible = cameraEnabled && !manualScoring\r\n  const waitForBoardClear = cameraEnabled && !manualScoring && autoCommitMode !== 'immediate'\r\n  const [selectedMode, setSelectedMode] = useState<string>('X01');\r\n  const [x01Score, setX01Score] = useState(501);\r\n  const [ai, setAI] = useState('None');\r\n  const [showRules, setShowRules] = useState(false);\r\n  const [inMatch, setInMatch] = useState(false);\r\n  const [playerScore, setPlayerScore] = useState(x01Score);\r\n  const [aiScore, setAiScore] = useState(x01Score);\r\n  const [onDouble, setOnDouble] = useState(false);\r\n  const [showWinPopup, setShowWinPopup] = useState(false);\r\n  // Match format: First-to selector and leg counters\r\n  const [firstTo, setFirstTo] = useState<number>(1)\r\n  const [playerLegs, setPlayerLegs] = useState<number>(0)\r\n  const match = useMatch()\r\n  const [showStartShowcase, setShowStartShowcase] = useState(false)\r\n  const startedShowcasedRef = useRef(false)\r\n  const [aiLegs, setAiLegs] = useState<number>(0)\r\n  // Placeholder for unified offline actions; once commitManualVisitTotal/endTurn defined, we'll assign\r\n  \r\n  const [pendingLegWinner, setPendingLegWinner] = useState<'player'|'ai'|null>(null)\r\n  const [doubleDarts, setDoubleDarts] = useState(1);\r\n  const [checkoutDarts, setCheckoutDarts] = useState(1);\r\n  const [legStats, setLegStats] = useState<{ winner: 'player'|'ai'; doubleDarts: number; checkoutDarts: number; winnerDarts: number; doublesAtt?: number; doublesHit?: number }[]>([]);\r\n  // New: pre-game adjustable AI delay (ms)\r\n  const [aiDelayMs, setAiDelayMs] = useState<number>(2000)\r\n  const toast = useToast();\r\n  // New: match popup state\r\n  const [showMatchModal, setShowMatchModal] = useState(false)\r\n  // Mirror Online layout defaults when in modern layout, otherwise keep classic feel\r\n  const [maximized, setMaximized] = useState(offlineLayout === 'modern')\r\n  const [fitAll, setFitAll] = useState(offlineLayout === 'modern')\r\n  // React to layout changes at runtime\r\n  useEffect(() => {\r\n    setMaximized(offlineLayout === 'modern')\r\n    setFitAll(offlineLayout === 'modern')\r\n  }, [offlineLayout])\r\n  useEffect(() => {\r\n    if (cameraFitMode !== 'fit') {\r\n      setCameraFitMode('fit')\r\n    }\r\n  }, [cameraFitMode, setCameraFitMode])\r\n  const [fitScale, setFitScale] = useState(1)\r\n  const [fitOverflowing, setFitOverflowing] = useState(false)\r\n  const [isPlayerTurn, setIsPlayerTurn] = useState(true)\r\n  useEffect(() => {\r\n    const handleOpenManager = () => setShowCameraManager(true)\r\n    window.addEventListener('ndn:open-camera-manager', handleOpenManager)\r\n    return () => window.removeEventListener('ndn:open-camera-manager', handleOpenManager)\r\n  }, [])\r\n  // Per-dart input and stats\r\n  const [playerDartPoints, setPlayerDartPoints] = useState<number>(0)\r\n  const [dpIndex, setDpIndex] = useState<number>(0) // 0..20 (DBULL at 20)\r\n  const [dpHits, setDpHits] = useState<number>(0)\r\n  // Around the Clock (offline practice)\r\n  const [atcIndex, setAtcIndex] = useState<number>(0)\r\n  const [atcHits, setAtcHits] = useState<number>(0)\r\n  // Practice mode states\r\n  const [cricket, setCricket] = useState(createCricketState())\r\n  const [shanghai, setShanghai] = useState(createShanghaiState())\r\n  const [halve, setHalve] = useState(createDefaultHalveIt())\r\n  const [highlow, setHighlow] = useState(createHighLow())\r\n  const [practiceTurnDarts, setPracticeTurnDarts] = useState<number>(0)\r\n  // Phase 1 practice modes\r\n  const [b27Stage, setB27Stage] = useState<number>(1)\r\n  const [b27Score, setB27Score] = useState<number>(27)\r\n  const [b27Darts, setB27Darts] = useState<number>(0)\r\n  const [b27Hits, setB27Hits] = useState<number>(0)\r\n  const [b27Finished, setB27Finished] = useState<boolean>(false)\r\n  const [cuRound, setCuRound] = useState<number>(1)\r\n  const [cuScore, setCuScore] = useState<number>(0)\r\n  const [cuDarts, setCuDarts] = useState<number>(0)\r\n  const cuMaxRounds = 8\r\n  const [hsRound, setHsRound] = useState<number>(1)\r\n  const [hsScore, setHsScore] = useState<number>(0)\r\n  const [hsDarts, setHsDarts] = useState<number>(0)\r\n  const hsMaxRounds = 10\r\n  const [lsRound, setLsRound] = useState<number>(1)\r\n  const [lsScore, setLsScore] = useState<number>(0)\r\n  const [lsDarts, setLsDarts] = useState<number>(0)\r\n  const lsMaxRounds = 10\r\n  const [co170Rem, setCo170Rem] = useState<number>(170)\r\n  const [co170Darts, setCo170Darts] = useState<number>(0)\r\n  const [co170Attempts, setCo170Attempts] = useState<number>(0)\r\n  const [co170Successes, setCo170Successes] = useState<number>(0)\r\n  const [co121Rem, setCo121Rem] = useState<number>(121)\r\n  const [co121Darts, setCo121Darts] = useState<number>(0)\r\n  const [co121Attempts, setCo121Attempts] = useState<number>(0)\r\n  const [co121Successes, setCo121Successes] = useState<number>(0)\r\n  const [trebleTarget, setTrebleTarget] = useState<number>(20)\r\n  const [trebleHits, setTrebleHits] = useState<number>(0)\r\n  const [trebleDarts, setTrebleDarts] = useState<number>(0)\r\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30)\r\n  const [trebleFinished, setTrebleFinished] = useState<boolean>(false)\r\n  // Phase 2 states\r\n  const [baseball, setBaseball] = useState(createBaseball())\r\n  const [golf, setGolf] = useState(createGolf())\r\n  const [ttt, setTTT] = useState(createTicTacToe())\r\n  const [amCricket, setAmCricket] = useState(createAmCricketState())\r\n  // Killer (hotseat) state\r\n  const [killerPlayers, setKillerPlayers] = useState<Array<{ id: string; name: string }>>([\r\n    { id: 'p1', name: 'Player 1' },\r\n    { id: 'p2', name: 'Player 2' },\r\n  ])\r\n  const [killerStates, setKillerStates] = useState<Record<string, KillerState>>({})\r\n  const [killerAssigned, setKillerAssigned] = useState<Record<string, number>>({})\r\n  const [killerSetupDone, setKillerSetupDone] = useState<boolean>(false)\r\n  const [killerTurnIdx, setKillerTurnIdx] = useState<number>(0)\r\n  const [killerDarts, setKillerDarts] = useState<number>(0)\r\n  const [killerWinnerId, setKillerWinnerId] = useState<string | null>(null)\r\n  const [killerLastEvent, setKillerLastEvent] = useState<string>('')\r\n  // Scam/Scum state\r\n  const [scam, setScam] = useState(createScamState())\r\n  const [scamPlayer, setScamPlayer] = useState(createScamState())\r\n  // Fives state\r\n  const [fives, setFives] = useState(createFivesState(50))\r\n  const [fivesPlayer, setFivesPlayer] = useState(createFivesState(50))\r\n  // Sevens state\r\n  const [sevens, setSevens] = useState(createSevensState(70))\r\n  const [sevensPlayer, setSevensPlayer] = useState(createSevensState(70))\r\n  const [playerDartsThrown, setPlayerDartsThrown] = useState<number>(0)\r\n  const [playerLastDart, setPlayerLastDart] = useState<number>(0)\r\n  const [playerVisitDarts, setPlayerVisitDarts] = useState<number>(0)\r\n  const [playerVisitStart, setPlayerVisitStart] = useState<number>(x01Score)\r\n  const [playerVisitSum, setPlayerVisitSum] = useState<number>(0)\r\n  const [playerLastVisitScore, setPlayerLastVisitScore] = useState<number | null>(null)\r\n  const [playerVisitDartsAtDouble, setPlayerVisitDartsAtDouble] = useState<number>(0)\r\n  const lastBounceMissTsRef = useRef<number>(0)\r\n  const lastVisitDartsRef = useRef<number>(0)\r\n  const playerScoreRef = useRef<number>(playerScore)\r\n  const playerVisitDartsRef = useRef<number>(playerVisitDarts)\r\n  const playerVisitSumRef = useRef<number>(playerVisitSum)\r\n  const playerVisitStartRef = useRef<number>(playerVisitStart)\r\n  const playerVisitDartsAtDoubleRef = useRef<number>(playerVisitDartsAtDouble)\r\n\r\n  useEffect(() => { playerScoreRef.current = playerScore }, [playerScore])\r\n  useEffect(() => { playerVisitDartsRef.current = playerVisitDarts }, [playerVisitDarts])\r\n  useEffect(() => { playerVisitSumRef.current = playerVisitSum }, [playerVisitSum])\r\n  useEffect(() => { playerVisitStartRef.current = playerVisitStart }, [playerVisitStart])\r\n  useEffect(() => { playerVisitDartsAtDoubleRef.current = playerVisitDartsAtDouble }, [playerVisitDartsAtDouble])\r\n  const [aiCountdownMs, setAiCountdownMs] = useState<number>(0)\r\n  const aiTimerRef = useRef<number | null>(null)\r\n  const [aiDartsThrown, setAiDartsThrown] = useState<number>(0)\r\n  const [aiLastDart, setAiLastDart] = useState<number>(0)\r\n  const [aiVisitSum, setAiVisitSum] = useState<number>(0)\r\n  const [aiVisitDarts, setAiVisitDarts] = useState<number>(0)\r\n  const [aiLastVisitScore, setAiLastVisitScore] = useState<number | null>(null)\r\n  const [aiVisitDartsAtDouble, setAiVisitDartsAtDouble] = useState<number>(0)\r\n  // Doubles attempts/hits\r\n  const [playerDoublesAtt, setPlayerDoublesAtt] = useState<number>(0)\r\n  const [playerDoublesHit, setPlayerDoublesHit] = useState<number>(0)\r\n  const [aiDoublesAtt, setAiDoublesAtt] = useState<number>(0)\r\n  const [aiDoublesHit, setAiDoublesHit] = useState<number>(0)\r\n  // Match-long totals for averages\r\n  const [totalPlayerDarts, setTotalPlayerDarts] = useState<number>(0)\r\n  const [totalAiDarts, setTotalAiDarts] = useState<number>(0)\r\n  const [totalPlayerPoints, setTotalPlayerPoints] = useState<number>(0)\r\n  const [totalAiPoints, setTotalAiPoints] = useState<number>(0)\r\n  // Power scoring and checkout highs\r\n  const [player180s, setPlayer180s] = useState<number>(0)\r\n  const [player140s, setPlayer140s] = useState<number>(0)\r\n  const [player100s, setPlayer100s] = useState<number>(0)\r\n  const [ai180s, setAi180s] = useState<number>(0)\r\n  const [ai140s, setAi140s] = useState<number>(0)\r\n  const [ai100s, setAi100s] = useState<number>(0)\r\n  const [playerHighestCheckout, setPlayerHighestCheckout] = useState<number>(0)\r\n  const [aiHighestCheckout, setAiHighestCheckout] = useState<number>(0)\r\n  // End-of-match summary modal\r\n  const [showMatchSummary, setShowMatchSummary] = useState<boolean>(false)\r\n  // Manual correction input for offline (matches CameraView UX)\r\n  const [manualBox, setManualBox] = useState<string>('')\r\n  const [manualTextarea, setManualTextarea] = useState<string>('')\r\n  const [manualPlayerScoreInput, setManualPlayerScoreInput] = useState<string>('')\r\n  const [manualOpponentScoreInput, setManualOpponentScoreInput] = useState<string>('')\r\n  const [manualPlayerLegsInput, setManualPlayerLegsInput] = useState<string>('')\r\n  const [manualOpponentLegsInput, setManualOpponentLegsInput] = useState<string>('')\r\n  const [legOverrideConfirm, setLegOverrideConfirm] = useState<{ target: 'player' | 'ai'; value: number; stage: 1 | 2 } | null>(null)\r\n  const [showCameraManager, setShowCameraManager] = useState<boolean>(false)\r\n  const [dartCounts, setDartCounts] = useState<Record<string, number>>({})\r\n  const [awaitingBoardClear, setAwaitingBoardClear] = useState<boolean>(false)\r\n  const pendingVisitRef = useRef<PendingAutoVisit | null>(null)\r\n  const pendingVisitTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\r\n\r\n  const clearPendingVisitTimer = useCallback(() => {\r\n    const timer = pendingVisitTimerRef.current\r\n    if (timer) {\r\n      clearTimeout(timer)\r\n      pendingVisitTimerRef.current = null\r\n    }\r\n  }, [])\r\n\r\n  const speakAutoVisit = useCallback((pending: PendingAutoVisit) => {\r\n    if (!callerEnabled) return\r\n    const speaker = user?.username || 'Player'\r\n    try {\r\n      sayScore(speaker, pending.visitTotal, Math.max(pending.remaining, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n    } catch {}\r\n  }, [callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, user?.username])\r\n\r\n  const commitPendingVisit = useCallback((pending: PendingAutoVisit, _trigger: 'immediate' | 'event' | 'timeout') => {\r\n    setAwaitingBoardClear(false)\r\n  const { visitTotal, darts, preRemaining, remaining, doubleAttempts, finished, doubleWindow, highestCheckout } = pending\r\n\r\n    if (!finished) {\r\n      setPlayerScore(remaining)\r\n      playerScoreRef.current = remaining\r\n    } else {\r\n      setPlayerScore(0)\r\n      playerScoreRef.current = 0\r\n      if (typeof highestCheckout === 'number' && highestCheckout > 0) {\r\n        setPlayerHighestCheckout(h => Math.max(h, highestCheckout))\r\n      }\r\n    }\r\n\r\n    setPlayerLastVisitScore(visitTotal)\r\n\r\n    if (visitTotal === 180) setPlayer180s(n => n + 1)\r\n    else if (visitTotal >= 140) setPlayer140s(n => n + 1)\r\n    else if (visitTotal >= 100) setPlayer100s(n => n + 1)\r\n\r\n    if (doubleWindow && doubleAttempts > 0) {\r\n      setPlayerDoublesAtt(a => a + doubleAttempts)\r\n      if (finished) setPlayerDoublesHit(h => h + 1)\r\n    }\r\n\r\n    if (!pending.announced) speakAutoVisit(pending)\r\n\r\n    try {\r\n      useAudit.getState().recordVisit('offline-x01', darts, visitTotal, { preRemaining, postRemaining: finished ? 0 : remaining, finish: finished, bust: false })\r\n    } catch {}\r\n\r\n    if (finished) {\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n    }\r\n\r\n    endTurn(finished ? 0 : remaining)\r\n\r\n    setPlayerVisitSum(0)\r\n    playerVisitSumRef.current = 0\r\n    setPlayerVisitDarts(0)\r\n    playerVisitDartsRef.current = 0\r\n    setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n  }, [endTurn, setPlayerHighestCheckout, setPendingLegWinner, setPlayerScore, setPlayerLastVisitScore, setPlayerVisitSum, setPlayerVisitDarts, setPlayerVisitDartsAtDouble, setShowWinPopup, setPlayer180s, setPlayer140s, setPlayer100s, setPlayerDoublesAtt, setPlayerDoublesHit, speakAutoVisit])\r\n\r\n  const finalizePendingVisit = useCallback((trigger: 'event' | 'timeout') => {\r\n    const pending = pendingVisitRef.current\r\n    if (!pending) return\r\n    pendingVisitRef.current = null\r\n    clearPendingVisitTimer()\r\n    commitPendingVisit(pending, trigger)\r\n  }, [clearPendingVisitTimer, commitPendingVisit])\r\n\r\n  const queuePendingVisit = useCallback((pending: PendingAutoVisit) => {\r\n    speakAutoVisit(pending)\r\n    pendingVisitRef.current = { ...pending, announced: true }\r\n    setAwaitingBoardClear(true)\r\n    clearPendingVisitTimer()\r\n    pendingVisitTimerRef.current = setTimeout(() => finalizePendingVisit('timeout'), BOARD_CLEAR_GRACE_MS)\r\n  }, [clearPendingVisitTimer, finalizePendingVisit, speakAutoVisit])\r\n\r\n  useEffect(() => {\r\n    if (!waitForBoardClear) return\r\n    const handler = () => finalizePendingVisit('event')\r\n    window.addEventListener('ndn:darts-cleared', handler as EventListener)\r\n    return () => window.removeEventListener('ndn:darts-cleared', handler as EventListener)\r\n  }, [waitForBoardClear, finalizePendingVisit])\r\n\r\n  useEffect(() => {\r\n    if (!waitForBoardClear) finalizePendingVisit('timeout')\r\n  }, [waitForBoardClear, finalizePendingVisit])\r\n\r\n  useEffect(() => () => clearPendingVisitTimer(), [clearPendingVisitTimer])\r\n\r\n  useEffect(() => {\r\n    if (playerVisitDarts === 0) {\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('ndn:darts-cleared', { detail: { source: 'offline-play', ts: Date.now() } }))\r\n      } catch {}\r\n      lastBounceMissTsRef.current = 0\r\n    }\r\n    lastVisitDartsRef.current = playerVisitDarts\r\n  }, [playerVisitDarts])\r\n\r\n\r\n  const humanName = user?.username || 'Player 1'\r\n  const aiDisplayName = ai === 'None' ? 'Player 2' : ai\r\n\r\n  // Call all game stat hooks unconditionally at component level (React hooks rules)\r\n  const statsX01 = useOfflineGameStats(\r\n    'X01' as any,\r\n    playerScore, aiScore,\r\n    playerLegs, aiLegs,\r\n    playerLastDart, aiLastDart,\r\n    playerVisitSum, aiVisitSum,\r\n    playerLastVisitScore, aiLastVisitScore,\r\n    playerVisitDarts, aiVisitDarts,\r\n    playerDoublesHit, playerDoublesAtt,\r\n    aiDoublesHit, aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn,\r\n    ai,\r\n    x01Score\r\n  )\r\n  const statsCricket = useOfflineGameStats(\r\n    'Cricket' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    cricket\r\n  )\r\n  const statsShanghai = useOfflineGameStats(\r\n    'Shanghai' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    isPlayerTurn, ai, undefined,\r\n    cricket, shanghai\r\n  )\r\n  const statsKiller = useOfflineGameStats(\r\n    'Killer' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    undefined, undefined,\r\n    killerPlayers, killerStates, killerAssigned, killerTurnIdx\r\n  )\r\n  const statsScam = useOfflineGameStats('Scam' as any)\r\n  const statsFives = useOfflineGameStats('Fives' as any)\r\n  const statsSevens = useOfflineGameStats('Sevens' as any)\r\n\r\n  const activeScoreboardStats = useMemo(() => {\r\n    const list = statsX01 || []\r\n    const playerResolvedLastScore = playerVisitDarts > 0\r\n      ? playerVisitSum\r\n      : (playerLastVisitScore ?? playerLastDart)\r\n    const aiResolvedLastScore = aiVisitDarts > 0\r\n      ? aiVisitSum\r\n      : (aiLastVisitScore ?? aiLastDart)\r\n    if (list.length === 0) {\r\n      return {\r\n        name: isPlayerTurn ? humanName : aiDisplayName,\r\n        isCurrentTurn: true,\r\n        legsWon: isPlayerTurn ? playerLegs : aiLegs,\r\n        score: isPlayerTurn ? playerScore : aiScore,\r\n        lastScore: isPlayerTurn ? playerResolvedLastScore : aiResolvedLastScore,\r\n      } as PlayerStats\r\n    }\r\n    return list.find(player => player.isCurrentTurn) ?? list[0]\r\n  }, [\r\n    statsX01,\r\n    isPlayerTurn,\r\n    humanName,\r\n    aiDisplayName,\r\n    playerLegs,\r\n    aiLegs,\r\n    playerScore,\r\n    aiScore,\r\n    playerVisitDarts,\r\n    playerVisitSum,\r\n    playerLastVisitScore,\r\n    playerLastDart,\r\n    aiVisitSum,\r\n    aiLastVisitScore,\r\n    aiLastDart,\r\n    aiVisitDarts,\r\n  ])\r\n\r\n  const singlePlayerScoreboard: PlayerStats[] = useMemo(() => {\r\n    if (!activeScoreboardStats) return []\r\n    const { matchAvg, allTimeAvg, ...rest } = activeScoreboardStats\r\n    return [{ ...rest, matchAvg: undefined, allTimeAvg: undefined } as PlayerStats]\r\n  }, [activeScoreboardStats])\r\n\r\n  const inactivePlayerName = isPlayerTurn ? aiDisplayName : humanName\r\n  const activePlayerName = activeScoreboardStats?.name ?? (isPlayerTurn ? humanName : aiDisplayName)\r\n  const activeRemaining = isPlayerTurn ? playerScore : aiScore\r\n  const activeLastScore = isPlayerTurn\r\n    ? (playerVisitDarts > 0 ? playerVisitSum : (playerLastVisitScore ?? playerLastDart))\r\n    : (aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart))\r\n\r\n  const recordDart = useCallback((mode: string, count = 1) => {\r\n    if (!mode || count <= 0) return\r\n    setDartCounts(prev => ({\r\n      ...prev,\r\n      [mode]: (prev[mode] || 0) + count\r\n    }))\r\n  }, [])\r\n\r\n  const resetDartCount = useCallback((mode: string) => {\r\n    if (!mode) return\r\n    setDartCounts(prev => {\r\n      if (prev[mode] === undefined) return prev\r\n      return { ...prev, [mode]: 0 }\r\n    })\r\n  }, [])\r\n\r\n  const activeModeDarts = dartCounts[selectedMode] || 0\r\n\r\n  const parseManualScoreOverride = (value: string): number | null => {\r\n    if (!value.trim()) return null\r\n    const parsed = Number(value)\r\n    if (!Number.isFinite(parsed)) return null\r\n    return clamp(Math.round(parsed), 0, x01Score)\r\n  }\r\n\r\n  const parseManualLegsOverride = (value: string): number | null => {\r\n    if (!value.trim()) return null\r\n    const parsed = Number(value)\r\n    if (!Number.isFinite(parsed)) return null\r\n    return Math.max(0, Math.round(parsed))\r\n  }\r\n\r\n  const cancelPendingAutoVisit = useCallback(() => {\r\n    if (pendingVisitRef.current) {\r\n      pendingVisitRef.current = null\r\n    }\r\n    clearPendingVisitTimer()\r\n    setAwaitingBoardClear(false)\r\n  }, [clearPendingVisitTimer])\r\n\r\n  const applyPlayerScoreOverride = useCallback((nextScore: number) => {\r\n    const safeScore = clamp(nextScore, 0, x01Score)\r\n    cancelPendingAutoVisit()\r\n    setPlayerScore(safeScore)\r\n    playerScoreRef.current = safeScore\r\n\r\n    const nextVisitStart = safeScore === 0 ? x01Score : safeScore\r\n    setPlayerVisitStart(nextVisitStart)\r\n    playerVisitStartRef.current = nextVisitStart\r\n\r\n    setPlayerVisitSum(0)\r\n    playerVisitSumRef.current = 0\r\n    setPlayerVisitDarts(0)\r\n    playerVisitDartsRef.current = 0\r\n    setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n\r\n    setPlayerLastVisitScore(null)\r\n    setPlayerLastDart(0)\r\n    setPlayerDartPoints(0)\r\n    lastBounceMissTsRef.current = 0\r\n\r\n    if (safeScore === 0) {\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n    } else {\r\n      setPendingLegWinner(null)\r\n      setShowWinPopup(false)\r\n    }\r\n  }, [cancelPendingAutoVisit, setPlayerScore, x01Score, setPlayerVisitStart, setPlayerVisitSum, setPlayerVisitDarts, setPlayerVisitDartsAtDouble, setPlayerLastVisitScore, setPlayerLastDart, setPlayerDartPoints, setPendingLegWinner, setShowWinPopup])\r\n\r\n  const handleManualScoreOverride = (target: 'player' | 'ai') => {\r\n    const source = target === 'player' ? manualPlayerScoreInput : manualOpponentScoreInput\r\n    const parsed = parseManualScoreOverride(source)\r\n    if (parsed === null) {\r\n      toast(`Enter a number between 0 and ${x01Score}`, { type: 'error', timeout: 2500 })\r\n      return\r\n    }\r\n    if (target === 'player') {\r\n      applyPlayerScoreOverride(parsed)\r\n      setManualPlayerScoreInput('')\r\n      return\r\n    } else {\r\n      setAiScore(parsed)\r\n      setAiVisitSum(0)\r\n      setAiVisitDarts(0)\r\n      setAiLastVisitScore(null)\r\n      setAiVisitDartsAtDouble(0)\r\n      setAiLastDart(0)\r\n      setManualOpponentScoreInput('')\r\n    }\r\n    setPendingLegWinner(null)\r\n    setShowWinPopup(false)\r\n  }\r\n\r\n  const applyManualLegOverride = useCallback((target: 'player' | 'ai', value: number) => {\r\n    if (target === 'player') {\r\n      setPlayerLegs(value)\r\n      setManualPlayerLegsInput('')\r\n    } else {\r\n      setAiLegs(value)\r\n      setManualOpponentLegsInput('')\r\n    }\r\n    setPendingLegWinner(null)\r\n    setShowWinPopup(false)\r\n  }, [setAiLegs, setManualOpponentLegsInput, setManualPlayerLegsInput, setPendingLegWinner, setPlayerLegs, setShowWinPopup])\r\n\r\n  const handleManualLegsOverride = (target: 'player' | 'ai') => {\r\n    const source = target === 'player' ? manualPlayerLegsInput : manualOpponentLegsInput\r\n    const parsed = parseManualLegsOverride(source)\r\n    if (parsed === null) {\r\n      toast('Enter a non-negative whole number for legs', { type: 'error', timeout: 2500 })\r\n      return\r\n    }\r\n    setLegOverrideConfirm({ target, value: parsed, stage: 1 })\r\n  }\r\n\r\n  const handleLegOverrideYes = useCallback(() => {\r\n    setLegOverrideConfirm(prev => {\r\n      if (!prev) return prev\r\n      if (prev.stage === 1) return { ...prev, stage: 2 }\r\n      applyManualLegOverride(prev.target, prev.value)\r\n      return null\r\n    })\r\n  }, [applyManualLegOverride])\r\n\r\n  const handleLegOverrideNo = useCallback(() => {\r\n    setLegOverrideConfirm(null)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (!legOverrideConfirm) return\r\n    const handleKey = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        event.preventDefault()\r\n        handleLegOverrideNo()\r\n      }\r\n    }\r\n    window.addEventListener('keydown', handleKey)\r\n    return () => window.removeEventListener('keydown', handleKey)\r\n  }, [handleLegOverrideNo, legOverrideConfirm])\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case 'small': return 'px-1.5 py-0.5 text-xs'\r\n      case 'large': return 'px-3 py-1 text-sm'\r\n      default: return 'px-2 py-0.5 text-sm'\r\n    }\r\n  }\r\n  const buttonSizeClass = getButtonSizeClasses(textSize)\r\n  // Fit-all scaling measurement\r\n  const scrollerRef = useRef<HTMLDivElement | null>(null)\r\n  const contentRef = useRef<HTMLDivElement | null>(null)\r\n  const headerBarRef = useRef<HTMLDivElement | null>(null)\r\n  // Match format controls (offline only): First to N or Best of N with editable count\r\n  const [formatType, setFormatType] = useState<'first'|'best'>('first')\r\n  const [formatCount, setFormatCount] = useState<number>(1)\r\n  const formatRef = useRef<HTMLDivElement | null>(null)\r\n  // Keep internal required wins (firstTo) in sync with format selection\r\n  useEffect(() => {\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1))\r\n    const wins = formatType === 'first' ? n : Math.max(1, Math.ceil(n / 2))\r\n    setFirstTo(wins)\r\n  }, [formatType, formatCount])\r\n  useEffect(() => {\r\n    if (!fitAll) {\r\n      setFitScale(1)\r\n      setFitOverflowing(false)\r\n      return\r\n    }\r\n    const measure = () => {\r\n      const scroller = scrollerRef.current\r\n      const content = contentRef.current\r\n      if (!scroller || !content) return\r\n      // Available size excludes the sticky header inside the scroller\r\n      const headerH = headerBarRef.current ? headerBarRef.current.getBoundingClientRect().height : 0\r\n      const availH = Math.max(0, scroller.clientHeight - headerH - 6) // small breathing room\r\n      const availW = Math.max(0, scroller.clientWidth - 8)\r\n      // Measure the content size without scale\r\n      const rect = content.getBoundingClientRect()\r\n      const currentScale = fitScale || 1\r\n      const naturalHeight = rect.height / currentScale\r\n      const naturalWidth = rect.width / currentScale\r\n      // Compute scale to fit both height and width\r\n      const scaleH = availH > 0 ? (availH / naturalHeight) : 1\r\n      const scaleW = availW > 0 ? (availW / naturalWidth) : 1\r\n  const next = Math.min(1, Math.max(0.5, Math.min(scaleH, scaleW)))\r\n  const scaledHeight = naturalHeight * next\r\n  const overflowing = availH > 0 && (scaledHeight - availH) > 1\r\n  setFitOverflowing(overflowing)\r\n  setFitScale(next)\r\n    }\r\n    measure()\r\n  const RO: any = (window as any).ResizeObserver\r\n  const ro = RO ? new RO(() => measure()) : null\r\n  ro && scrollerRef.current && ro.observe(scrollerRef.current as any)\r\n  ro && contentRef.current && ro.observe(contentRef.current as any)\r\n    window.addEventListener('resize', measure)\r\n    return () => {\r\n      window.removeEventListener('resize', measure)\r\n      try { ro && scrollerRef.current && ro.unobserve(scrollerRef.current as any) } catch {}\r\n      try { ro && contentRef.current && ro.unobserve(contentRef.current as any) } catch {}\r\n    }\r\n  }, [fitAll, fitScale])\r\n\r\n\r\n  // Auto-start handler (from Home or other tabs)\r\n  useEffect(() => {\r\n    const onAuto = (e: any) => {\r\n      const m = e?.detail?.mode as string | undefined\r\n      if (!m) return\r\n      setSelectedMode(m)\r\n      // For Double Practice we could load a specific flow. For now, we just open the X01-like modal with immediate start.\r\n      startMatch()\r\n    }\r\n    window.addEventListener('ndn:auto-start', onAuto as any)\r\n    return () => window.removeEventListener('ndn:auto-start', onAuto as any)\r\n  }, [])\r\n\r\n  // Accept demo parameters to preconfigure format and starting score before auto-start\r\n  useEffect(() => {\r\n    const onFmt = (e: any) => {\r\n      const t = e?.detail?.formatType\r\n      const c = e?.detail?.formatCount\r\n      const s = e?.detail?.startScore\r\n      if (t === 'first' || t === 'best') setFormatType(t)\r\n      if (typeof c === 'number' && isFinite(c)) setFormatCount(Math.max(1, Math.floor(c)))\r\n      if (typeof s === 'number' && isFinite(s)) setX01Score(Math.max(1, Math.floor(s)))\r\n    }\r\n    window.addEventListener('ndn:offline-format', onFmt as any)\r\n    return () => window.removeEventListener('ndn:offline-format', onFmt as any)\r\n  }, [])\r\n\r\n  // Auto-start last offline match when opening this tab, if enabled\r\n  useEffect(() => {\r\n    if (!autoStartOffline) return\r\n    // Kick off a match after initial render for a smooth modal open\r\n    const id = setTimeout(() => startMatch(), 50)\r\n    return () => clearTimeout(id)\r\n  }, [autoStartOffline])\r\n\r\n  // Drive AI countdown and perform AI visit when countdown elapses\r\n  useEffect(() => {\r\n    if (!showMatchModal || isPlayerTurn || ai === 'None' || aiCountdownMs <= 0) return\r\n    let raf: number\r\n    let last = performance.now()\r\n    const tick = (now: number) => {\r\n      const dt = now - last\r\n      last = now\r\n      setAiCountdownMs(prev => {\r\n        const next = prev - dt\r\n        if (next <= 0) {\r\n          // Execute AI visit per dart (up to 3 darts or until finish/bust)\r\n          let visitDarts = 0\r\n          let visitTotal = 0\r\n          let remaining = aiScore\r\n          setAiVisitDarts(0)\r\n          while (visitDarts < 3 && remaining > 0) {\r\n            const targetVisit = aiVisitScore(remaining, ai)\r\n            // break target into up to 3 darts (roughly 20 per dart for easy split)\r\n            const dart = clamp(targetVisit - visitDarts*20, 0, Math.min(60, remaining))\r\n            const after = remaining - dart\r\n            setAiLastDart(dart)\r\n            setAiDartsThrown(d => d + 1)\r\n            setTotalAiDarts(d => d + 1)\r\n            if (after < 0) {\r\n              // bust: revert to remaining before visit\r\n              remaining = aiScore\r\n              setAiVisitSum(0)\r\n              setAiVisitDartsAtDouble(0)\r\n              visitTotal = 0\r\n              setAiLastVisitScore(0)\r\n              setAiVisitDarts(0)\r\n              break\r\n            }\r\n            // Only add points after confirming not a bust\r\n            visitTotal += dart\r\n            setAiVisitSum(s => s + dart)\r\n            setTotalAiPoints(p => p + dart)\r\n            // Track darts at double window\r\n            const preRem = remaining\r\n            const postRem = after\r\n            if (preRem > 50 && postRem <= 50) setAiVisitDartsAtDouble(1)\r\n            else if (preRem <= 50) setAiVisitDartsAtDouble(c => c + 1)\r\n            remaining = after\r\n            visitDarts += 1\r\n            setAiVisitDarts(visitDarts)\r\n            if (remaining === 0) break\r\n          }\r\n          setAiScore(remaining)\r\n          if (remaining === 0) {\r\n            // Power score classification\r\n            if (visitTotal === 180) setAi180s(n => n + 1)\r\n            else if (visitTotal >= 140) setAi140s(n => n + 1)\r\n            else if (visitTotal >= 100) setAi100s(n => n + 1)\r\n            // Highest checkout\r\n            const checkout = aiScore\r\n            if (checkout <= 170) setAiHighestCheckout(h => Math.max(h, checkout))\r\n            // Doubles attempts/hit if finished from <= 50\r\n            if (aiScore <= 50) {\r\n              setAiDoublesAtt(a => a + (aiVisitDartsAtDouble > 0 ? aiVisitDartsAtDouble : 1))\r\n              setAiDoublesHit(h => h + 1)\r\n            }\r\n            setAiLastVisitScore(visitTotal)\r\n            setAiVisitSum(0)\r\n            setAiVisitDartsAtDouble(0)\r\n            setAiVisitDarts(0)\r\n            // AI won the leg\r\n            setPendingLegWinner('ai')\r\n            setShowWinPopup(true)\r\n          }\r\n          // If AI did not finish, but threw 3 darts this visit, classify power score and reset visit sum\r\n          if (remaining > 0 && visitDarts >= 3) {\r\n            if (visitTotal === 180) setAi180s(n => n + 1)\r\n            else if (visitTotal >= 140) setAi140s(n => n + 1)\r\n            else if (visitTotal >= 100) setAi100s(n => n + 1)\r\n            setAiLastVisitScore(visitTotal)\r\n            setAiVisitSum(0)\r\n            setAiVisitDartsAtDouble(0)\r\n            setAiVisitDarts(0)\r\n          }\r\n          // Hand turn back to player\r\n          setAiVisitDarts(0)\r\n          setIsPlayerTurn(true)\r\n          return 0\r\n        }\r\n        return next\r\n      })\r\n      raf = requestAnimationFrame(tick)\r\n    }\r\n    raf = requestAnimationFrame(tick)\r\n    return () => cancelAnimationFrame(raf)\r\n  }, [showMatchModal, isPlayerTurn, ai, aiScore])\r\n\r\n  useEffect(() => {\r\n    if (!match.inProgress) return\r\n    if (startedShowcasedRef.current) return\r\n    setShowStartShowcase(true)\r\n    startedShowcasedRef.current = true\r\n  }, [match.inProgress])\r\n\r\n  function startMatch() {\r\n    setInMatch(true);\r\n    setPlayerScore(x01Score);\r\n  playerScoreRef.current = x01Score\r\n    setAiScore(x01Score);\r\n    setOnDouble(false);\r\n    setShowMatchModal(true);\r\n    setIsPlayerTurn(true);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown(0);\r\n    setPlayerLastDart(0);\r\n    setPlayerVisitDarts(0);\r\n  playerVisitDartsRef.current = 0\r\n    setPlayerVisitStart(x01Score);\r\n    setPlayerVisitSum(0)\r\n    setPlayerLastVisitScore(null)\r\n  setPlayerVisitDartsAtDouble(0)\r\n    setAiCountdownMs(0);\r\n    setAiDartsThrown(0);\r\n    setAiLastDart(0);\r\n  setAiVisitSum(0)\r\n  setAiVisitDarts(0)\r\n    setAiLastVisitScore(null)\r\n    setPendingLegWinner(null)\r\n    // When starting a brand-new match from menu, reset legs\r\n  setPlayerLegs(0)\r\n  setAiLegs(0)\r\n    setLegStats([])\r\n  // Reset Treble Practice session state when starting a new match\r\n  setTrebleHits(0); setTrebleDarts(0); setTrebleFinished(false)\r\n    // Reset match-long totals\r\n    setTotalPlayerDarts(0); setTotalAiDarts(0)\r\n    setTotalPlayerPoints(0); setTotalAiPoints(0)\r\n    setPlayer180s(0); setPlayer140s(0); setPlayer100s(0)\r\n    setAi180s(0); setAi140s(0); setAi100s(0)\r\n    setPlayerHighestCheckout(0); setAiHighestCheckout(0)\r\n    setPlayerDoublesAtt(0); setPlayerDoublesHit(0)\r\n    setAiDoublesAtt(0); setAiDoublesHit(0)\r\n  resetDartCount('X01')\r\n    // Sync required wins from current format selection\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1))\r\n    setFirstTo(formatType === 'first' ? n : Math.max(1, Math.ceil(n/2)))\r\n    if (rememberLastOffline) {\r\n      try { setLastOffline({ mode: selectedMode, x01Start: x01Score, firstTo, aiLevel: ai }) } catch {}\r\n    }\r\n  }\r\n\r\n  function startNextLeg() {\r\n    setPlayerScore(x01Score)\r\n  playerScoreRef.current = x01Score\r\n    setAiScore(x01Score)\r\n    setOnDouble(false)\r\n    setShowMatchModal(true)\r\n    setIsPlayerTurn(true)\r\n    setPlayerDartPoints(0)\r\n    setPlayerDartsThrown(0)\r\n    setPlayerLastDart(0)\r\n    setPlayerVisitDarts(0)\r\n  playerVisitDartsRef.current = 0\r\n    setPlayerVisitStart(x01Score)\r\n    setPlayerVisitSum(0)\r\n    playerVisitStartRef.current = x01Score\r\n    playerVisitSumRef.current = 0\r\n    setPlayerLastVisitScore(null)\r\n  setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n    setAiCountdownMs(0)\r\n    setAiDartsThrown(0)\r\n    setAiLastDart(0)\r\n    setAiVisitSum(0)\r\n    setAiVisitDarts(0)\r\n    setAiLastVisitScore(null)\r\n    setPendingLegWinner(null)\r\n  }\r\n\r\n  // --- Offline per-dart helpers ---\r\n  function endTurn(nextRemaining: number) {\r\n    setPlayerVisitDarts(0)\r\n    playerVisitDartsRef.current = 0\r\n    setPlayerVisitStart(nextRemaining === 0 ? x01Score : nextRemaining)\r\n    playerVisitStartRef.current = (nextRemaining === 0 ? x01Score : nextRemaining)\r\n    setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n    if (ai !== 'None') {\r\n      setIsPlayerTurn(false)\r\n      setAiCountdownMs(aiDelayMs)\r\n    } else {\r\n      setAiCountdownMs(0)\r\n      setIsPlayerTurn(true)\r\n    }\r\n  }\r\n\r\n  function applyDartValue(dart: number) {\r\n    if (waitForBoardClear && pendingVisitRef.current) {\r\n      if (!awaitingBoardClear) setAwaitingBoardClear(true)\r\n      toast('Remove your darts before starting the next throw', { type: 'info', timeout: 1800 })\r\n      return\r\n    }\r\n    recordDart('X01')\r\n    const currentScore = playerScoreRef.current\r\n    const currentVisitDarts = playerVisitDartsRef.current\r\n    const currentVisitSum = playerVisitSumRef.current\r\n    const currentVisitStart = playerVisitStartRef.current\r\n    const currentVisitDartsAtDouble = playerVisitDartsAtDoubleRef.current\r\n    const remaining = currentScore - dart\r\n    const newVisitDarts = currentVisitDarts + 1\r\n\r\n    setPlayerLastDart(dart)\r\n    setPlayerDartsThrown(d => d + 1)\r\n    setTotalPlayerDarts(d => d + 1)\r\n\r\n    if (remaining < 0) {\r\n      try {\r\n        const preRemaining = currentScore\r\n        const postRemaining = currentVisitStart\r\n        useAudit.getState().recordVisit('offline-x01', newVisitDarts, 0, { preRemaining, postRemaining, bust: true, finish: false })\r\n      } catch {}\r\n      setPlayerScore(currentVisitStart)\r\n      playerScoreRef.current = currentVisitStart\r\n\r\n      if (currentScore <= 50) {\r\n        const attemptsThisVisit = (currentVisitDartsAtDouble || 0) + 1\r\n        setPlayerDoublesAtt(a => a + attemptsThisVisit)\r\n      }\r\n\r\n      if (callerEnabled) {\r\n        try { sayScore(user?.username || 'Player', 0, Math.max(currentVisitStart, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n      }\r\n\r\n      setPlayerLastVisitScore(0)\r\n      setPlayerDartPoints(0)\r\n      setPlayerVisitSum(0)\r\n      playerVisitSumRef.current = 0\r\n      setPlayerVisitDartsAtDouble(0)\r\n      playerVisitDartsAtDoubleRef.current = 0\r\n      endTurn(currentVisitStart)\r\n      return\r\n    }\r\n\r\n    setPlayerScore(remaining)\r\n    playerScoreRef.current = remaining\r\n\r\n    setPlayerVisitDarts(newVisitDarts)\r\n    playerVisitDartsRef.current = newVisitDarts\r\n    const newVisitSum = currentVisitSum + dart\r\n    setPlayerVisitSum(newVisitSum)\r\n    playerVisitSumRef.current = newVisitSum\r\n\r\n    setTotalPlayerPoints(p => p + dart)\r\n    setPlayerDartPoints(0)\r\n\r\n    const preRemaining = currentScore\r\n    const postRemaining = remaining\r\n    const startedDoubleWindow = preRemaining > 50 && postRemaining <= 50\r\n    const stillInDoubleWindow = preRemaining <= 50\r\n    if (startedDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(1)\r\n      playerVisitDartsAtDoubleRef.current = 1\r\n    } else if (stillInDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(c => c + 1)\r\n      playerVisitDartsAtDoubleRef.current = (currentVisitDartsAtDouble || 0) + 1\r\n    }\r\n\r\n    const doubleAttemptsNow = playerVisitDartsAtDoubleRef.current || 0\r\n    const inDoubleWindow = preRemaining <= 50\r\n    const attemptsForVisit = inDoubleWindow ? Math.max(doubleAttemptsNow, Math.min(newVisitDarts, 3)) : 0\r\n\r\n    if (remaining === 0) {\r\n      const pending: PendingAutoVisit = {\r\n        visitTotal: newVisitSum,\r\n        darts: newVisitDarts,\r\n        preRemaining: currentScore,\r\n        remaining: 0,\r\n        doubleAttempts: attemptsForVisit,\r\n        finished: true,\r\n        doubleWindow: inDoubleWindow,\r\n        highestCheckout: currentVisitStart <= 170 ? currentVisitStart : null,\r\n      }\r\n      if (waitForBoardClear) {\r\n        queuePendingVisit(pending)\r\n      } else {\r\n        commitPendingVisit(pending, 'immediate')\r\n      }\r\n      return\r\n    }\r\n\r\n    if (newVisitDarts >= 3) {\r\n      const pending: PendingAutoVisit = {\r\n        visitTotal: newVisitSum,\r\n        darts: newVisitDarts,\r\n        preRemaining: currentScore,\r\n        remaining,\r\n        doubleAttempts: attemptsForVisit,\r\n        finished: false,\r\n        doubleWindow: inDoubleWindow,\r\n        highestCheckout: null,\r\n      }\r\n      if (waitForBoardClear) {\r\n        queuePendingVisit(pending)\r\n      } else {\r\n        commitPendingVisit(pending, 'immediate')\r\n      }\r\n      return\r\n    }\r\n  }\r\n\r\n  function addDartNumeric() {\r\n    const dart = clamp(Math.round(Number(playerDartPoints) || 0), 0, 60)\r\n    applyDartValue(dart)\r\n  }\r\n\r\n  function commitManualVisitTotal(rawTotal: number): boolean {\r\n    if (!Number.isFinite(rawTotal)) return false\r\n\r\n    const visitStart = playerVisitStartRef.current\r\n    const liveScore = playerScoreRef.current\r\n    const existingDarts = playerVisitDartsRef.current\r\n    const existingSum = playerVisitSumRef.current\r\n    const hadPartialVisit = existingDarts > 0 || existingSum > 0\r\n\r\n    if (hadPartialVisit) {\r\n      setPlayerScore(visitStart)\r\n      playerScoreRef.current = visitStart\r\n      setPlayerVisitDarts(0)\r\n      playerVisitDartsRef.current = 0\r\n      setPlayerVisitSum(0)\r\n      playerVisitSumRef.current = 0\r\n      setPlayerVisitDartsAtDouble(0)\r\n      playerVisitDartsAtDoubleRef.current = 0\r\n      setPlayerLastDart(0)\r\n      setPlayerDartPoints(0)\r\n      setPlayerDartsThrown(d => Math.max(0, d - existingDarts))\r\n      setTotalPlayerDarts(d => Math.max(0, d - existingDarts))\r\n      setTotalPlayerPoints(p => Math.max(0, p - existingSum))\r\n      lastBounceMissTsRef.current = 0\r\n    }\r\n\r\n    const preRemaining = hadPartialVisit ? visitStart : liveScore\r\n    const checkoutCap = preRemaining <= 170 ? 170 : 180\r\n    const total = clamp(Math.round(rawTotal), 0, checkoutCap)\r\n\r\n    recordDart('X01', 3)\r\n    setPlayerDartsThrown(d => d + 3)\r\n    setTotalPlayerDarts(d => d + 3)\r\n    setPlayerVisitDarts(3)\r\n    playerVisitDartsRef.current = 3\r\n    setPlayerVisitSum(total)\r\n    playerVisitSumRef.current = total\r\n    setPlayerLastVisitScore(total)\r\n\r\n    if (total === 180) setPlayer180s(n => n + 1)\r\n    else if (total >= 140) setPlayer140s(n => n + 1)\r\n    else if (total >= 100) setPlayer100s(n => n + 1)\r\n\r\n    const remaining = preRemaining - total\r\n\r\n    if (remaining < 0) {\r\n      if (callerEnabled) {\r\n        try { sayScore(humanName, 0, Math.max(visitStart, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n      }\r\n      try {\r\n        useAudit.getState().recordVisit('offline-x01', 3, 0, { preRemaining, postRemaining: visitStart, bust: true, finish: false })\r\n      } catch {}\r\n      setPlayerScore(visitStart)\r\n      playerScoreRef.current = visitStart\r\n      setPlayerLastVisitScore(0)\r\n      setPlayerVisitSum(0)\r\n      playerVisitSumRef.current = 0\r\n      setPlayerVisitDarts(0)\r\n      playerVisitDartsRef.current = 0\r\n      setPlayerVisitDartsAtDouble(0)\r\n      playerVisitDartsAtDoubleRef.current = 0\r\n      endTurn(visitStart)\r\n      return true\r\n    }\r\n\r\n    setPlayerScore(remaining)\r\n    playerScoreRef.current = remaining\r\n    setTotalPlayerPoints(p => p + total)\r\n\r\n    if (callerEnabled) {\r\n      try { sayScore(humanName, total, Math.max(remaining, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n    }\r\n\r\n    if (preRemaining <= 50) {\r\n      setPlayerDoublesAtt(a => a + 3)\r\n      if (remaining === 0) setPlayerDoublesHit(h => h + 1)\r\n    }\r\n\r\n    if (remaining === 0) {\r\n      if (preRemaining <= 170) setPlayerHighestCheckout(h => Math.max(h, preRemaining))\r\n      try {\r\n        useAudit.getState().recordVisit('offline-x01', 3, total, { preRemaining, postRemaining: 0, finish: true, bust: false })\r\n      } catch {}\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n      setPlayerVisitDarts(0)\r\n      playerVisitDartsRef.current = 0\r\n      setPlayerVisitSum(0)\r\n      playerVisitSumRef.current = 0\r\n      setPlayerVisitDartsAtDouble(0)\r\n      playerVisitDartsAtDoubleRef.current = 0\r\n      return true\r\n    }\r\n\r\n    try {\r\n      useAudit.getState().recordVisit('offline-x01', 3, total, { preRemaining, postRemaining: remaining, finish: false, bust: false })\r\n    } catch {}\r\n    endTurn(remaining)\r\n    setPlayerVisitSum(0)\r\n    playerVisitSumRef.current = 0\r\n    setPlayerVisitDarts(0)\r\n    playerVisitDartsRef.current = 0\r\n    setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n    return true\r\n  }\r\n\r\n  // Once local commit and endTurn functions are defined, create the unified offline actions wrapper\r\n  const matchActions: UnifiedMatchActions = createOfflineMatchActions({ match, commitManualVisitTotal, endTurn })\r\n\r\n  // Optional: Add a full-visit total (0–180) input for quick entry like \"93\"\r\n  const [visitTotalInput, setVisitTotalInput] = useState<string>(\"\")\r\n  const handleVisitTotalChange = (raw: string) => {\r\n    if (!raw) {\r\n      setVisitTotalInput('')\r\n      return\r\n    }\r\n    const numericOnly = raw.replace(/[^0-9]/g, '')\r\n    if (!numericOnly) {\r\n      setVisitTotalInput('')\r\n      return\r\n    }\r\n    const parsed = Number(numericOnly)\r\n    if (!Number.isFinite(parsed)) return\r\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180\r\n    const safe = clamp(Math.round(parsed), 0, maxAllowed)\r\n    setVisitTotalInput(String(safe))\r\n  }\r\n  function addVisitTotal() {\r\n    if (!visitTotalInput) { alert('Enter a number 0–180 for visit total'); return }\r\n    const parsed = Number(visitTotalInput)\r\n    if (!Number.isFinite(parsed)) { alert('Enter a number 0–180 for visit total'); return }\r\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180\r\n    const bounded = clamp(Math.round(parsed), 0, maxAllowed)\r\n    if (parsed > maxAllowed) {\r\n      toast(`Visit totals cannot exceed ${maxAllowed}.`, { type: 'info', timeout: 2200 })\r\n    }\r\n    if (commitManualVisitTotal(bounded)) {\r\n      setVisitTotalInput(\"\")\r\n    }\r\n  }\r\n\r\n  const clearCurrentVisit = useCallback(() => {\r\n    if (pendingVisitRef.current) {\r\n      pendingVisitRef.current = null\r\n      clearPendingVisitTimer()\r\n      setAwaitingBoardClear(false)\r\n    }\r\n    const visitDarts = playerVisitDartsRef.current\r\n    const visitTotal = playerVisitSumRef.current\r\n    const visitStart = playerVisitStartRef.current\r\n    if (visitDarts === 0 && visitTotal === 0) return\r\n    setPlayerScore(visitStart)\r\n  playerScoreRef.current = visitStart\r\n    setPlayerVisitDarts(0)\r\n  playerVisitDartsRef.current = 0\r\n    setPlayerVisitSum(0)\r\n  playerVisitSumRef.current = 0\r\n    setPlayerVisitDartsAtDouble(0)\r\n  playerVisitDartsAtDoubleRef.current = 0\r\n    setPlayerLastDart(0)\r\n    setPlayerDartPoints(0)\r\n    setPlayerDartsThrown(d => Math.max(0, d - visitDarts))\r\n    setTotalPlayerDarts(d => Math.max(0, d - visitDarts))\r\n    setTotalPlayerPoints(p => Math.max(0, p - visitTotal))\r\n    lastBounceMissTsRef.current = 0\r\n  }, [clearPendingVisitTimer])\r\n\r\n  useEffect(() => {\r\n    const onClearRequest = (evt: Event) => {\r\n      const detail = (evt as CustomEvent)?.detail\r\n      if (!detail || detail?.source === 'offline-play') return\r\n      clearCurrentVisit()\r\n    }\r\n    window.addEventListener('ndn:clear-visit-request', onClearRequest as EventListener)\r\n    return () => window.removeEventListener('ndn:clear-visit-request', onClearRequest as EventListener)\r\n  }, [clearCurrentVisit])\r\n\r\n  // --- Double Practice helpers ---\r\n  function addDpValue(val: number) {\r\n    recordDart('Double Practice')\r\n    const dart = clamp(Math.round(val || 0), 0, 60)\r\n    setPlayerLastDart(dart)\r\n    setPlayerDartsThrown(d => d + 1)\r\n    setTotalPlayerDarts(d => d + 1)\r\n    if (isDoubleHit(dart, dpIndex)) {\r\n      const nextHits = dpHits + 1\r\n      setDpHits(nextHits)\r\n      setDpIndex(i => Math.min(20, i + 1))\r\n      // End when DBULL (index 20) is hit\r\n      if (nextHits >= 21) {\r\n        setPendingLegWinner('player')\r\n        setShowWinPopup(true)\r\n      }\r\n    }\r\n    setPlayerDartPoints(0)\r\n  }\r\n  function addDpNumeric() { addDpValue(Number(playerDartPoints)) }\r\n  function addDpManual() {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like D16, 50, 25, T20'); return }\r\n    addDpValue(v)\r\n    setManualBox('')\r\n  }\r\n\r\n  // Bob's 27\r\n  function addB27Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (b27Finished) return\r\n    recordDart(\"Bob's 27\")\r\n    const target = b27Stage\r\n    const hit = (ring === 'DOUBLE' && sector === target) || (!ring && value === target * 2)\r\n    if (hit) setB27Hits(h => h + 1)\r\n    setB27Darts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        const totalHits = b27Hits + (hit ? 1 : 0)\r\n        if (totalHits > 0) setB27Score(s => s + totalHits * target * 2)\r\n        else setB27Score(s => s - target * 2)\r\n        const next = target + 1\r\n        setB27Stage(next)\r\n        setB27Hits(0)\r\n        if (next > 20) setB27Finished(true)\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addB27Numeric() { addB27Auto(Math.max(0, playerDartPoints | 0)); setPlayerDartPoints(0) }\r\n  function resetB27() { setB27Stage(1); setB27Score(27); setB27Darts(0); setB27Hits(0); setB27Finished(false); resetDartCount(\"Bob's 27\") }\r\n\r\n  // Count-Up / High Score / Low Score\r\n  function addCountUpAuto(value: number) {\r\n    recordDart('Count-Up')\r\n    setCuScore(s => s + Math.max(0, value | 0))\r\n    setCuDarts(d => { const nd = d + 1; if (nd >= 3) { setCuRound(r => r + 1); return 0 } return nd })\r\n  }\r\n  function addHighScoreAuto(value: number) {\r\n    recordDart('High Score')\r\n    setHsScore(s => s + Math.max(0, value | 0))\r\n    setHsDarts(d => { const nd = d + 1; if (nd >= 3) { setHsRound(r => r + 1); return 0 } return nd })\r\n  }\r\n  function addLowScoreAuto(value: number) {\r\n    recordDart('Low Score')\r\n    setLsScore(s => s + Math.max(0, value | 0))\r\n    setLsDarts(d => { const nd = d + 1; if (nd >= 3) { setLsRound(r => r + 1); return 0 } return nd })\r\n  }\r\n\r\n  // Checkout routines (double out)\r\n  function applyCheckout(rem: number, setRem: (n:number)=>void, darts: number, setDarts: (f:(n:number)=>number)=>void, setAttempts: (f:(n:number)=>number)=>void, setSuccesses: (f:(n:number)=>number)=>void, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') {\r\n    const next = rem - value\r\n    if (next < 0) {\r\n      // bust: ignore progress during attempt\r\n    } else if (next === 0) {\r\n      if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n        setSuccesses(s => s + 1)\r\n        setAttempts(a => a + 1)\r\n        setDarts(() => 0)\r\n        setRem(rem) // caller will reset to initial value right after\r\n        return\r\n      }\r\n      setRem(next)\r\n    } else {\r\n      setRem(next)\r\n    }\r\n    setDarts(d => { const nd = d + 1; if (nd >= 3) { setAttempts(a => a + 1); return 0 } return nd })\r\n  }\r\n  function addCo170Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') {\r\n    recordDart('Checkout 170')\r\n    applyCheckout(co170Rem, setCo170Rem, co170Darts, setCo170Darts, setCo170Attempts, setCo170Successes, value, ring)\r\n    if (co170Darts + 1 >= 3) setCo170Rem(170)\r\n  }\r\n  function addCo121Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') {\r\n    recordDart('Checkout 121')\r\n    applyCheckout(co121Rem, setCo121Rem, co121Darts, setCo121Darts, setCo121Attempts, setCo121Successes, value, ring)\r\n    if (co121Darts + 1 >= 3) setCo121Rem(121)\r\n  }\r\n  function addCoManual(is170: boolean) {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like T20, D16, 25, 50'); return }\r\n    const t = manualBox.trim().toUpperCase()\r\n    const isDouble = t.startsWith('D') || t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL' || t.includes('INNER')\r\n    if (is170) addCo170Auto(v, isDouble ? 'DOUBLE' : undefined); else addCo121Auto(v, isDouble ? 'DOUBLE' : undefined)\r\n    setManualBox('')\r\n  }\r\n  function resetCo170() { setCo170Rem(170); setCo170Darts(0); setCo170Attempts(0); setCo170Successes(0); resetDartCount('Checkout 170') }\r\n  function resetCo121() { setCo121Rem(121); setCo121Darts(0); setCo121Attempts(0); setCo121Successes(0); resetDartCount('Checkout 121') }\r\n\r\n  // Treble practice\r\n  function addTrebleAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (trebleFinished) return\r\n    recordDart('Treble Practice')\r\n    const isHit = (ring === 'TRIPLE' && sector === trebleTarget) || (!ring && value === trebleTarget * 3)\r\n    if (isHit) setTrebleHits(h => h + 1)\r\n    setTrebleDarts(d => {\r\n      const nd = d + 1\r\n      // Auto-rotate target every 3 darts among T20→T19→T18\r\n      if (nd % 3 === 0 && [20, 19, 18].includes(trebleTarget)) {\r\n        const cycle = [20, 19, 18]\r\n        const idx = cycle.indexOf(trebleTarget)\r\n        const next = cycle[(idx + 1) % cycle.length]\r\n        setTrebleTarget(next)\r\n      }\r\n      // End session at configured throws\r\n      if (trebleMaxDarts > 0 && nd >= trebleMaxDarts) setTrebleFinished(true)\r\n      return nd\r\n    })\r\n  }\r\n  function resetTreble() { setTrebleHits(0); setTrebleDarts(0); setTrebleFinished(false); resetDartCount('Treble Practice') }\r\n\r\n  // Baseball\r\n  function addBaseballAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    recordDart('Baseball')\r\n    setBaseball(prev => { const cp = { ...prev }; applyBaseballDart(cp as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetBaseball() { setBaseball(createBaseball()); resetDartCount('Baseball') }\r\n\r\n  // Golf\r\n  function addGolfAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    recordDart('Golf')\r\n    setGolf(prev => { const cp = { ...prev }; applyGolfDart(cp as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetGolf() { setGolf(createGolf()); resetDartCount('Golf') }\r\n\r\n  // Tic Tac Toe\r\n  function addTttAuto(cell: number, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Tic Tac Toe')\r\n    setTTT(prev => { const cp = { ...prev, board: [...prev.board] as any }; tryClaimCell(cp as any, cell as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetTtt() { setTTT(createTicTacToe()); resetDartCount('Tic Tac Toe') }\r\n\r\n  // American Cricket\r\n  function addAmCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('American Cricket')\r\n    setAmCricket(prev => { const cp = { ...prev, marks: { ...prev.marks } }; applyAmCricketDart(cp as any, value, ring as any, sector, () => false); return cp })\r\n  }\r\n  function resetAmCricket() { setAmCricket(createAmCricketState()); resetDartCount('American Cricket') }\r\n\r\n  // --- Around the Clock helpers ---\r\n  function addAtcValue(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Around the Clock')\r\n    const target = ATC_ORDER[atcIndex]\r\n    let hit = false\r\n    if (typeof sector === 'number' && sector === target && (ring === 'SINGLE' || ring === 'DOUBLE' || ring === 'TRIPLE')) hit = true\r\n    if (target === 25 && (ring === 'BULL' || val === 25)) hit = true\r\n    if (target === 50 && (ring === 'INNER_BULL' || val === 50)) hit = true\r\n    if (!hit) {\r\n      // Fallback by value only\r\n      if (val === target || val === target * 2 || val === target * 3) hit = true\r\n    }\r\n    if (hit) {\r\n      const newHits = atcHits + 1\r\n      setAtcHits(newHits)\r\n      setAtcIndex(i => i + 1)\r\n    }\r\n  }\r\n  function addAtcNumeric() { addAtcValue(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n  function addAtcManual() {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like T20, D5, 25, 50'); return }\r\n    addAtcValue(v)\r\n    setManualBox('')\r\n  }\r\n\r\n  // --- Cricket helpers (solo practice) ---\r\n  function addCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Cricket')\r\n    setCricket(prev => {\r\n      const copy = { ...prev, marks: { ...prev.marks } }\r\n      applyCricketDart(copy as any, value, ring, sector, () => false)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1; if (nd >= 3) return 0; return nd\r\n    })\r\n  }\r\n  function addCricketNumeric() { addCricketAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- Shanghai helpers ---\r\n  function addShanghaiAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Shanghai')\r\n    setShanghai(prev => {\r\n      const copy = { ...prev, turnHits: { ...prev.turnHits } }\r\n      applyShanghaiDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setShanghai(prev => { const cp = { ...prev, turnHits: { ...prev.turnHits } }; endShanghaiTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addShanghaiNumeric() { addShanghaiAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- Halve It helpers ---\r\n  function addHalveAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Halve It')\r\n    setHalve(prev => {\r\n      const copy = { ...prev, targets: [...prev.targets] }\r\n      applyHalveItDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setHalve(prev => { const cp = { ...prev, targets: [...prev.targets] }; endHalveItTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addHalveNumeric() { addHalveAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- High-Low helpers ---\r\n  function addHighLowAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('High-Low')\r\n    setHighlow(prev => {\r\n      const copy = { ...prev }\r\n      applyHighLowDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setHighlow(prev => { const cp = { ...prev }; endHighLowTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addHighLowNumeric() { addHighLowAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  function parseManualBox(): number | null {\r\n    const t = manualBox.trim().toUpperCase()\r\n    if (!t) return null\r\n    if (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL') return 50\r\n    if (t === '25' || t === 'OBULL') return 25\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n    if (!m) return null\r\n    const mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n    const num = parseInt(m[2],10)\r\n    if (num < 1 || num > 20) return null\r\n    const multVal = mult==='S'?1:mult==='D'?2:3\r\n    return num * multVal\r\n  }\r\n\r\n  function addManual() {\r\n    const val = parseManualBox()\r\n    if (val == null) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    applyDartValue(val)\r\n    setManualBox('')\r\n  }\r\n\r\n  function addManualTextarea() {\r\n    const lines = manualTextarea.trim().split('\\n').map(l => l.trim()).filter(l => l)\r\n    if (lines.length === 0) return\r\n    for (const line of lines) {\r\n      const val = parseManualDart(line)\r\n      if (val == null) { alert(`Invalid score: ${line}`); return }\r\n      applyDartValue(val)\r\n    }\r\n    setManualTextarea('')\r\n  }\r\n\r\n  function replaceLast() {\r\n    if (playerVisitDarts === 0) return\r\n    // Rewind one dart: approximate by adding back last dart into score\r\n    setPlayerScore(s => s + playerLastDart)\r\n    setPlayerVisitDarts(d => Math.max(0, d - 1))\r\n  }\r\n\r\n  function replaceLastManual() {\r\n    const val = parseManualBox()\r\n    if (val == null) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    if (playerVisitDarts === 0) { addManual(); return }\r\n    // Rewind last then apply\r\n    const rewind = playerLastDart\r\n    setPlayerScore(s => s + rewind)\r\n    setPlayerVisitDarts(d => Math.max(0, d - 1))\r\n    // Apply new value in next microtask to ensure state has updated\r\n    setTimeout(() => applyDartValue(val), 0)\r\n    setManualBox('')\r\n  }\r\n\r\n  function playerThrow(points: number) {\r\n    let newScore = playerScore - points;\r\n    if (newScore < 0) {\r\n      setPlayerScore(playerScore); // bust\r\n      return;\r\n    }\r\n    setPlayerScore(newScore);\r\n    if (newScore === 0) {\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n    }\r\n    setOnDouble(newScore <= 40 && newScore % 2 === 0)\r\n  }\r\n\r\n  function aiTurn() {\r\n    // This is now automated inside the modal turn loop\r\n  }\r\n\r\n  function handleBust() {\r\n    setPlayerScore(playerScore); // bust, score unchanged\r\n    setOnDouble(false);\r\n  }\r\n\r\n  function handleWinPopupSubmit() {\r\n    const winner = pendingLegWinner ?? 'player'\r\n    // Approximate per-leg doubles attempts: if winner is player and they finished from <=50, attempts were counted in playerVisitDartsAtDouble; otherwise leave undefined\r\n    const legDoublesAtt = winner==='player' ? (playerVisitDartsAtDouble || undefined) : (aiVisitDartsAtDouble || undefined)\r\n    const legDoublesHit = 1\r\n    const winnerDarts = winner==='player' ? playerDartsThrown : aiDartsThrown\r\n    setLegStats([...legStats, { winner, doubleDarts, checkoutDarts, winnerDarts, doublesAtt: legDoublesAtt, doublesHit: legDoublesHit }]);\r\n    setShowWinPopup(false);\r\n    // Increment legs for the winner\r\n    let p = playerLegs\r\n    let a = aiLegs\r\n    if (pendingLegWinner === 'player') p += 1\r\n    else if (pendingLegWinner === 'ai') a += 1\r\n    setPlayerLegs(p)\r\n    setAiLegs(a)\r\n    setPendingLegWinner(null)\r\n    // Check if match is over\r\n    if (p >= firstTo || a >= firstTo) {\r\n      // End of match: close modal back to menu state\r\n      // Record per-game-mode result (local-only demo)\r\n      try { bumpGameMode(selectedMode, winner === 'player') } catch {}\r\n      setShowMatchModal(false)\r\n      setInMatch(false)\r\n      // Reset leg-specific stats for next match but keep the summary list visible\r\n      setPlayerScore(x01Score)\r\n      setAiScore(x01Score)\r\n      setShowMatchSummary(true)\r\n      return\r\n    }\r\n    // Otherwise, start the next leg immediately\r\n    startNextLeg()\r\n  }\r\n\r\n  const isFreeSelected = freeGames.includes(selectedMode as any)\r\n  const lockedPremium = !isFreeSelected && !(user?.fullAccess || user?.admin)\r\n\r\n  // no external overlay: we render the match modal as absolute inset-0 inside this card\r\n\r\n  return (\r\n  <div className=\"card ndn-game-shell relative overflow-hidden\">\r\n  {showStartShowcase && <MatchStartShowcase players={(match.players || []) as any} onDone={() => setShowStartShowcase(false)} />}\r\n  <h2 className=\"text-3xl font-bold text-brand-700 mb-4\">Offline Mode {offlineLayout==='classic' ? <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle\">Classic layout</span> : <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle\">Modern layout</span>}</h2>\r\n      <div className=\"ndn-shell-body\">\r\n      <div className=\"mb-4 flex flex-col gap-3\">\r\n        <select className=\"input w-full\" value={selectedMode} onChange={e => setSelectedMode(e.target.value)}>\r\n          {freeGames.map(mode => <option key={mode} value={mode}>{mode}</option>)}\r\n          {premiumGames.map(mode => (\r\n            <option key={mode} value={mode} disabled={!(user?.fullAccess || user?.admin)}>{mode} {(user?.fullAccess || user?.admin) ? '' : '(Premium)'}</option>\r\n          ))}\r\n        </select>\r\n\r\n        {/* Calibration Status - displayed below game mode selector */}\r\n        <GameCalibrationStatus \r\n          gameMode={selectedMode} \r\n          compact={true}\r\n        />\r\n\r\n        {selectedMode === 'Treble Practice' && (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end\">\r\n            <div className=\"sm:col-span-1\">\r\n              <label className=\"font-semibold\">Throws per game</label>\r\n              <input className=\"input w-full\" type=\"number\" min={3} step={3} value={trebleMaxDarts} onChange={e=>setTrebleMaxDarts(Math.max(3, Math.floor(Number(e.target.value)||30)))} />\r\n            </div>\r\n            <div className=\"sm:col-span-2 text-xs text-slate-300\">Target cycles T20→T19→T18 every 3 darts. Game ends after the selected number of throws.</div>\r\n          </div>\r\n        )}\r\n        {!user?.fullAccess && (\r\n          <div className=\"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2\">\r\n            <span>🔒</span>\r\n            <span>Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM.</span>\r\n          </div>\r\n        )}\r\n        {selectedMode === 'X01' && (\r\n          <>\r\n            <label className=\"font-semibold mt-2\">Enter starting score (1-1001):</label>\r\n            <input\r\n              className=\"input w-full\"\r\n              type=\"number\"\r\n              min={1}\r\n              max={1001}\r\n              value={x01Score}\r\n              onChange={e => setX01Score(Number(e.target.value))}\r\n            />\r\n            <label className=\"font-semibold mt-2\">Play against AI bot?</label>\r\n            <select className=\"input w-full\" value={ai} onChange={e => setAI(e.target.value)}>\r\n              <option value=\"None\">None</option>\r\n              {aiLevels.map(level => <option key={level} value={level}>{level}</option>)}\r\n            </select>\r\n            {ai !== 'None' && (\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2\">\r\n                <div className=\"sm:col-span-2\">\r\n                  <label className=\"font-semibold\">AI throw delay (seconds)</label>\r\n                  <input\r\n                    className=\"input w-full\"\r\n                    type=\"number\"\r\n                    min={0.5}\r\n                    max={10}\r\n                    step={0.5}\r\n                    value={aiDelayMs / 1000}\r\n                    onChange={e => setAiDelayMs(Math.round(Number(e.target.value) * 1000))}\r\n                  />\r\n                </div>\r\n                <div className=\"text-sm text-slate-300\">Controls how long the AI waits before its visit.</div>\r\n              </div>\r\n            )}\r\n            <button className=\"btn mt-2\" onClick={() => setShowRules(true)}>X01 Rules & Regulations!</button>\r\n          </>\r\n        )}\r\n        {selectedMode === 'Double Practice' && (\r\n          <div className=\"mt-2 text-brand-600\">Hit doubles D1 → D20 → DBULL in as few darts as possible. AI and X01 settings don’t apply.</div>\r\n        )}\r\n      </div>\r\n  {!inMatch && <button className=\"btn\" disabled={lockedPremium} title={lockedPremium ? 'PREMIUM required for this mode' : ''} onClick={startMatch}>Start Match</button>}\r\n      {/* Match Modal with turn-by-turn flow */}\r\n      {showMatchModal && (\r\n  <div className={`absolute inset-0 z-[1000] ${maximized ? '' : 'flex items-center justify-center p-3 sm:p-4'}` }>\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:offline-match\"\r\n            className={`${maximized ? 'w-full h-full ndn-modal-tight' : ''} relative flex flex-col overflow-hidden`}\r\n            fullScreen={maximized}\r\n            defaultWidth={1100}\r\n            defaultHeight={720}\r\n            minWidth={720}\r\n            minHeight={480}\r\n            maxWidth={1600}\r\n            maxHeight={1200}\r\n            initialFitHeight\r\n          >\r\n            {/* Header bar with visible mode and actions; sheen is clipped to this area */}\r\n            <div\r\n              className=\"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2\"\r\n              style={{ overflowY: 'scroll' }}\r\n              ref={(el) => { (scrollerRef as any).current = el }}\r\n            >\r\n              <div ref={(el)=>{ (headerBarRef as any).current = el }}>\r\n                <GameHeaderBar\r\n                  left={(\r\n                    <>\r\n                      <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">Game Mode</span>\r\n                      <span className=\"font-medium whitespace-nowrap\">{selectedMode}{selectedMode==='X01' ? ` / ${x01Score}` : ''}</span>\r\n                      <span className=\"opacity-80 whitespace-nowrap\">First to {firstTo} · Legs {playerLegs}-{aiLegs}</span>\r\n                      <span className={`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${offlineLayout==='modern' ? 'bg-emerald-500/15 text-emerald-200 border-emerald-400/30' : 'bg-white/10 text-white/70 border-white/20'}`}>{offlineLayout==='modern' ? 'Modern layout' : 'Classic layout'}</span>\r\n                    </>\r\n                  )}\r\n                  right={(\r\n                    <>\r\n                      {/* Camera scale controls (match Online UI) */}\r\n                      <div className=\"hidden items-center gap-2 mr-2 text-xs\">\r\n                        <span className=\"opacity-80\">Cam</span>\r\n                        <button\r\n                          className=\"btn btn--ghost px-2 py-1\"\r\n                          onClick={() => setCameraScale(Math.max(0.5, Math.round((cameraScale - 0.05) * 100) / 100))}\r\n                          title=\"Decrease camera size\"\r\n                        >−</button>\r\n                        <span className=\"w-9 text-center\">{Math.round(cameraScale * 100)}%</span>\r\n                        <button\r\n                          className=\"btn btn--ghost px-2 py-1\"\r\n                          onClick={() => setCameraScale(Math.min(1.25, Math.round((cameraScale + 0.05) * 100) / 100))}\r\n                          title=\"Increase camera size\"\r\n                        >+</button>\r\n                      </div>\r\n                      <button\r\n                        className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                        title={fitAll ? 'Actual Size' : 'Fit All'}\r\n                        onClick={() => setFitAll(v => !v)}\r\n                      >{fitAll ? 'Actual Size' : 'Fit All'}</button>\r\n                      <button\r\n                        className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                        title={maximized ? 'Restore' : 'Maximize'}\r\n                        onClick={() => setMaximized(m => !m)}\r\n                      >{maximized ? 'Restore' : 'Maximize'}</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={() => { startMatch() }}>Restart</button>\r\n                      <button className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\" onClick={() => { setShowMatchModal(false); setInMatch(false); }}>Quit</button>\r\n                    </>\r\n                  )}\r\n                />\r\n              </div>\r\n              <div\r\n                ref={(el) => { (contentRef as any).current = el }}\r\n                className=\"will-change-transform\"\r\n                style={fitAll ? { transform: `scale(${fitScale})`, transformOrigin: 'top left', width: '100%', fontSize: `${Math.max(0.8, Math.min(1, fitScale))}em` } : undefined}\r\n              >\r\n            <h3 className=\"text-xl font-bold mb-2 mt-1 leading-tight\">{selectedMode === 'X01' ? 'X01 Match' : selectedMode}</h3>\r\n            <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Mode: {selectedMode}</span>\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Start: {x01Score}</span>\r\n              <div ref={formatRef} className=\"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                <span>Format:</span>\r\n                {(() => {\r\n                  const disabled = (playerScore !== x01Score || aiScore !== x01Score || playerVisitDarts > 0)\r\n                  const pillCls = `px-2 py-0.5 rounded border text-xs ${disabled? 'opacity-50 cursor-not-allowed': 'cursor-pointer'} `\r\n                  return (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <button\r\n                          type=\"button\"\r\n                          className={`${pillCls} ${formatType==='first' ? 'bg-indigo-500/20 text-indigo-100 border-indigo-400/30' : 'bg-white/10 text-white/80 border-white/20'}`}\r\n                          onClick={() => { if (!disabled) setFormatType('first') }}\r\n                          title=\"First to N\"\r\n                        >First to</button>\r\n                        <button\r\n                          type=\"button\"\r\n                          className={`${pillCls} ${formatType==='best' ? 'bg-indigo-500/20 text-indigo-100 border-indigo-400/30' : 'bg-white/10 text-white/80 border-white/20'}`}\r\n                          onClick={() => { if (!disabled) setFormatType('best') }}\r\n                          title=\"Best of N (wins = ceil(N/2)\"\r\n                        >Best of</button>\r\n                      </div>\r\n                      <input\r\n                        className={`input w-16 text-center ${disabled ? 'opacity-50' : ''}`}\r\n                        type=\"number\"\r\n                        min={1}\r\n                        step={1}\r\n                        value={formatCount}\r\n                        onChange={e => setFormatCount(Math.max(1, Math.floor(Number(e.target.value)||1)))}\r\n                        disabled={disabled}\r\n                        title={formatType==='first' ? 'First to N' : 'Best of N (wins = ceil(N/2))'}\r\n                      />\r\n                    </div>\r\n                  )\r\n                })()}\r\n              </div>\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Legs: {playerLegs}–{aiLegs}</span>\r\n              {/* Move match type and team names to the right of Legs for a single-row header */}\r\n              <div className=\"ml-auto flex items-center gap-1 text-[10px] flex-wrap\">\r\n                <span className=\"opacity-70\">Match</span>\r\n                <select className={`btn ${buttonSizeClass}`} value={matchType} onChange={e=>setMatchType((e.target.value as 'singles'|'doubles'))}>\r\n                  <option value=\"singles\">Singles</option>\r\n                  <option value=\"doubles\">Doubles</option>\r\n                </select>\r\n                <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamAName} onChange={e=>setTeamAName(e.target.value)} placeholder=\"Team A\" />\r\n                <span className=\"opacity-50\">vs</span>\r\n                <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamBName} onChange={e=>setTeamBName(e.target.value)} placeholder=\"Team B\" />\r\n              </div>\r\n            </div>\r\n            {selectedMode !== 'X01' ? (\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2\">\r\n                {selectedMode === 'Double Practice' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">Current Target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || '—'}</span>\r\n                    </div>\r\n                    {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Around the Clock' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">Current Target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || '—')}</span>\r\n                    </div>\r\n                    {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Cricket' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 mb-1\">Cricket — Close 20–15 and Bull; overflow scores points</div>\r\n                    <div className=\"grid grid-cols-7 gap-1 text-center text-[11px] mb-2\">\r\n                      {CRICKET_NUMBERS.map(n => (\r\n                        <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                          <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                          <div className=\"font-semibold\">{Math.min(3, cricket.marks?.[n]||0)} / 3</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm\">Points: <span className=\"font-semibold\">{cricket.points}</span></div>\r\n                    {cricketClosedAll(cricket) && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setCricket(createCricketState())\r\n                        setPracticeTurnDarts(0)\r\n                        resetDartCount('Cricket')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Shanghai' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{shanghai.round}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {shanghai.score}</div>\r\n                    {shanghai.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setShanghai(createShanghaiState())\r\n                        setPracticeTurnDarts(0)\r\n                        resetDartCount('Shanghai')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Halve It' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Stage</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{halve.stage+1}/{halve.targets.length}</span></div>\r\n                    <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const t = getCurrentHalveTarget(halve); if (!t) return '—'; if (t.kind==='ANY_NUMBER') return 'Any'; if (t.kind==='BULL') return 'Bull'; if (t.kind==='DOUBLE' || t.kind==='TRIPLE' || t.kind==='NUMBER') return `${t.kind} ${(t as any).num}`; return '—' })()}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {halve.score}</div>\r\n                    {halve.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setHalve(createDefaultHalveIt())\r\n                        setPracticeTurnDarts(0)\r\n                        resetDartCount('Halve It')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High-Low' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {highlow.round} · Target {highlow.target}</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {highlow.score}</div>\r\n                    {highlow.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setHighlow(createHighLow())\r\n                        setPracticeTurnDarts(0)\r\n                        resetDartCount('High-Low')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === \"Bob's 27\" && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Target</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold\">D{b27Stage}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {b27Score}</div>\r\n                    {b27Finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetB27}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Count-Up' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {cuRound}/8</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {cuScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High Score' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {hsRound}/10</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {hsScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Low Score' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {lsRound}/10</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {lsScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 170' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Remaining</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{co170Rem}</div>\r\n                    <div className=\"text-xs text-slate-400 mt-1\">Attempts: {co170Attempts} · Successes: {co170Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 121' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Remaining</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{co121Rem}</div>\r\n                    <div className=\"text-xs text-slate-400 mt-1\">Attempts: {co121Attempts} · Successes: {co121Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Treble Practice' && (\r\n                  <>\r\n                    <div className=\"flex items-center justify-between gap-4\">\r\n                      <div>\r\n                        <div className=\"text-xs text-slate-600\">Treble Target: T{trebleTarget}</div>\r\n                        <div className=\"text-3xl font-extrabold tracking-tight\">Hits: {trebleHits}</div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 flex-wrap\">\r\n                        <label className=\"text-sm\">Target</label>\r\n                        <div className=\"inline-flex items-center gap-1\">\r\n                          {[20,19,18].map(n => (\r\n                            <button key={`tpick-header-${n}`} className={`btn px-2 py-0.5 text-xs ${trebleTarget===n?'bg-emerald-600/30 border border-emerald-400/30':''}`} onClick={()=>setTrebleTarget(n)}>T{n}</button>\r\n                          ))}\r\n                        </div>\r\n                        <span className=\"opacity-60 text-xs\">or</span>\r\n                        <select className=\"input w-24\" value={trebleTarget} onChange={e=> setTrebleTarget(parseInt(e.target.value,10))}>\r\n                          {Array.from({length:20},(_,i)=>i+1).map(n=> <option key={n} value={n}>{n}</option>)}\r\n                        </select>\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={resetTreble}>Reset</button>\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Baseball' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Inning</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{baseball.inning}</div>\r\n                    <div className=\"text-sm\">Score: <span className=\"font-semibold\">{baseball.score}</span></div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Golf' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Hole</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{golf.hole}</div>\r\n                    <div className=\"text-sm\">Strokes: <span className=\"font-semibold\">{golf.strokes}</span></div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Tic Tac Toe' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Turn</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{ttt.turn}</div>\r\n                    {ttt.finished && <div className=\"mt-1 text-xs\">Winner: {ttt.winner || '—'}</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Scam' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Target</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{SCAM_TARGET_NAMES[scam.targetIndex]}</div>\r\n                    <div className=\"text-sm\">Progress: <span className=\"font-semibold\">{scam.targetIndex + 1}/{SCAM_TARGET_NAMES.length}</span></div>\r\n                    {scam.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">🎉 Finished in {scam.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Fives' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Score</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{fives.score}/{fives.target}</div>\r\n                    <div className=\"text-sm\">Darts: <span className=\"font-semibold\">{fives.darts}</span></div>\r\n                    {fives.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">✓ Reached {fives.target}!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Sevens' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Score</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{sevens.score}/{sevens.target}</div>\r\n                    <div className=\"text-sm\">Darts: <span className=\"font-semibold\">{sevens.darts}</span></div>\r\n                    {sevens.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">✓ Reached {sevens.target}!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'American Cricket' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 mb-1\">Close 20–12 and Bull; overflow scores points</div>\r\n                    <div className=\"grid grid-cols-10 gap-1 text-center text-[11px] mb-2\">\r\n                      {AM_CRICKET_NUMBERS.map(n => (\r\n                        <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                          <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                          <div className=\"font-semibold\">{Math.min(3, amCricket.marks?.[n]||0)} / 3</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm\">Points: <span className=\"font-semibold\">{amCricket.points}</span></div>\r\n                    {hasClosedAllAm(amCricket) && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetAmCricket}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Killer' && (\r\n                  <>\r\n                    {!killerSetupDone ? (\r\n                      <div className=\"text-xs text-slate-600\">Setup players and assign numbers</div>\r\n                    ) : (\r\n                      <>\r\n                        <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                          <span>Turn</span>\r\n                          <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{killerPlayers[killerTurnIdx]?.name || '—'}</span>\r\n                        </div>\r\n                        <div className=\"text-3xl font-extrabold tracking-tight\">{killerWinnerId ? `${killerPlayers.find(p=>p.id===killerWinnerId)?.name || 'Winner'} Wins` : (killerLastEvent || 'Ready')}</div>\r\n                      </>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            ) : offlineLayout === 'modern' ? (\r\n              <div className=\"space-y-3 mb-2\">\r\n                {!manualScoring ? (\r\n                  <>\r\n                    <div className=\"flex items-center flex-wrap gap-1.5 mt-1\">\r\n                      <div className=\"ml-auto flex items-center gap-1 text-[10px]\">\r\n                        <span className=\"opacity-70\">Cam</span>\r\n                        <button className={`btn ${buttonSizeClass}`} onClick={() => setCameraScale(Math.max(0.5, Math.round((cameraScale - 0.05) * 100) / 100))}>−</button>\r\n                        <span className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}>{Math.round(cameraScale * 100)}%</span>\r\n                        <button className={`btn ${buttonSizeClass}`} onClick={() => setCameraScale(Math.min(1.25, Math.round((cameraScale + 0.05) * 100) / 100))}>+</button>\r\n                        <span className=\"opacity-50\">|</span>\r\n                        <button className={`btn ${buttonSizeClass}`} title=\"Toggle fit/fill\" onClick={() => setCameraFitMode(cameraFitMode === 'fill' ? 'fit' : 'fill')}>{cameraFitMode === 'fill' ? 'Fill' : 'Fit'}</button>\r\n                        <span className=\"opacity-50\">|</span>\r\n                        <button className={`btn ${buttonSizeClass}`} title=\"Toggle camera aspect\" onClick={() => setCameraAspect(cameraAspect === 'square' ? 'wide' : 'square')}>{cameraAspect === 'square' ? 'Square' : 'Wide'}</button>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"relative\">\r\n                      <div className=\"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6\">\r\n                        <div className=\"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]\">\r\n                            <CameraView \r\n                              scoringMode=\"x01\"\r\n                              showToolbar={cameraToolbarVisible}\r\n                              immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                applyDartValue(value)\r\n                              }}\r\n                            />\r\n                          </div>\r\n\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4\">\r\n                            <div className=\"space-y-4\">\r\n                              <div className=\"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\r\n                                <div className=\"text-xs uppercase tracking-wide text-white/50\">Current Shooter</div>\r\n                                <div className=\"mt-1 text-xl font-semibold text-white\">{activePlayerName}</div>\r\n                                <div className=\"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80\">\r\n                                  <div>\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/40\">Remaining</div>\r\n                                    <div className=\"font-mono text-lg text-white\">{activeRemaining}</div>\r\n                                  </div>\r\n                                  <div>\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/40\">Last Dart</div>\r\n                                    <div className=\"font-mono text-lg text-white\">{activeLastScore || 0}</div>\r\n                                  </div>\r\n                                  <div>\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/40\">Match Legs</div>\r\n                                    <div className=\"font-semibold text-white\">{playerLegs}-{aiLegs}</div>\r\n                                  </div>\r\n                                  <div>\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/40\">Next Up</div>\r\n                                    <div className=\"font-medium text-white\">{inactivePlayerName}</div>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n\r\n                            <div className=\"hidden md:block\">\r\n                              <GameScoreboard\r\n                                gameMode={selectedMode as any}\r\n                                players={singlePlayerScoreboard}\r\n                                matchScore={`${playerLegs}-${aiLegs}`}\r\n                              />\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"md:hidden\">\r\n                            <GameScoreboard\r\n                              gameMode={selectedMode as any}\r\n                              players={singlePlayerScoreboard}\r\n                              matchScore={`${playerLegs}-${aiLegs}`}\r\n                            />\r\n                          </div>\r\n\r\n                          {(selectedMode as any) === 'X01' && (\r\n                            <div className=\"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\r\n                              <div className=\"text-xs uppercase tracking-wide text-white/50\">Manual Scoreboard Override</div>\r\n                              <p className=\"mt-1 text-xs text-white/40\">Adjust the live totals if a dart was misread. Values are clamped between 0 and {x01Score}.</p>\r\n                              <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm\">\r\n                                <div className=\"space-y-3\">\r\n                                  <div className=\"text-sm font-semibold text-white\">{humanName}</div>\r\n                                  <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs uppercase tracking-wide text-white/50\">Commit Visit</label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                                      <MatchControls\r\n                                        inProgress={true}\r\n                                        startingScore={x01Score}\r\n                                        onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)}\r\n                                        quickButtons={[180,140,100,60]}\r\n                                        onNextPlayer={() => matchActions?.nextPlayer()}\r\n                                        onEndLeg={() => { /* End leg handled via commitManualVisitTotal / addVisitTotal */ }}\r\n                                        onUndo={() => { /* offline undo not implemented here; optionally reset pending visit */ }}\r\n                                        showDartsSelect={true}\r\n                                      />\r\n                                    </div>\r\n                                  </div>\r\n                                  <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs uppercase tracking-wide text-white/50\">Legs Override</label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                                      <input\r\n                                        className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                        type=\"number\"\r\n                                        min={0}\r\n                                        value={manualPlayerLegsInput}\r\n                                        onChange={e => setManualPlayerLegsInput(e.target.value)}\r\n                                        onKeyDown={e => { if (e.key === 'Enter') handleManualLegsOverride('player') }}\r\n                                        placeholder={`${playerLegs}`}\r\n                                      />\r\n                                      <button className=\"btn px-3 py-1 text-sm\" onClick={() => handleManualLegsOverride('player')}>Set</button>\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n                                <div className=\"space-y-3\">\r\n                                  <div className=\"text-sm font-semibold text-white\">{aiDisplayName}</div>\r\n                                  <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs uppercase tracking-wide text-white/50\">Three Dart Edit</label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                                      <input\r\n                                        className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                        type=\"number\"\r\n                                        min={0}\r\n                                        max={x01Score}\r\n                                        value={manualOpponentScoreInput}\r\n                                        onChange={e => setManualOpponentScoreInput(e.target.value)}\r\n                                        onKeyDown={e => { if (e.key === 'Enter') handleManualScoreOverride('ai') }}\r\n                                        placeholder={`${aiScore}`}\r\n                                      />\r\n                                      <button className=\"btn px-3 py-1 text-sm\" onClick={() => handleManualScoreOverride('ai')}>Set</button>\r\n                                    </div>\r\n                                  </div>\r\n                                  <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs uppercase tracking-wide text-white/50\">Legs Override</label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                                      <input\r\n                                        className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                        type=\"number\"\r\n                                        min={0}\r\n                                        value={manualOpponentLegsInput}\r\n                                        onChange={e => setManualOpponentLegsInput(e.target.value)}\r\n                                        onKeyDown={e => { if (e.key === 'Enter') handleManualLegsOverride('ai') }}\r\n                                        placeholder={`${aiLegs}`}\r\n                                      />\r\n                                      <button className=\"btn px-3 py-1 text-sm\" onClick={() => handleManualLegsOverride('ai')}>Set</button>\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <div className=\"card\">\r\n                    <div className=\"text-sm font-semibold mb-1\">Manual scoring active</div>\r\n                    <div className=\"text-xs opacity-70\">Camera previews are disabled. Use the manual entry controls below to record your turn.</div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0\">\r\n                <div className=\"flex items-stretch justify-center md:px-3 min-w-0\">\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                  <span className=\"opacity-80\">You Remain</span>\r\n                  {isPlayerTurn ? (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl font-extrabold tracking-tight\">{playerScore}</div>\r\n                <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                  <div className=\"h-full bg-emerald-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (playerScore / x01Score)) * 100))}%` }} />\r\n                </div>\r\n                <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{playerLastDart}</span></div>\r\n                <div className=\"text-sm opacity-90\">Last score: <span className=\"font-semibold\">{playerVisitDarts > 0 ? playerVisitSum : (playerLastVisitScore ?? playerLastDart)}</span></div>\r\n                <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{totalPlayerDarts>0 ? ((totalPlayerPoints/totalPlayerDarts)*3).toFixed(1) : '0.0'}</span></div>\r\n                <div className=\"text-xs opacity-70 flex items-center gap-2\">\r\n                  <span>Darts thrown: {playerDartsThrown}</span>\r\n                  <span className=\"inline-flex items-center gap-1\" aria-label=\"Visit darts\">\r\n                    {[0,1,2].map(i => (\r\n                      <span key={i} className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? 'bg-emerald-400' : 'bg-white/20'}`}></span>\r\n                    ))}\r\n                  </span>\r\n                </div>\r\n                <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {playerDoublesAtt} · Hit {playerDoublesHit}</span></div>\r\n                {playerScore <= 170 && playerScore > 0 && (\r\n                  (() => {\r\n                    const sugs = suggestCheckouts(playerScore, favoriteDouble)\r\n                    const first = sugs[0] || '—'\r\n                    return (\r\n                      <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\r\n                        <span className=\"opacity-70\">Checkout</span>\r\n                        <span className=\"font-semibold\">{first}</span>\r\n                      </div>\r\n                    )\r\n                  })()\r\n                )}\r\n              </div>\r\n              {/* Center camera preview: right-aligned and square when selected */}\r\n              <div className=\"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall\">\r\n                <ResizablePanel\r\n                  storageKey=\"ndn:camera:tile:offline:center:v4\"\r\n                  className=\"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card\"\r\n                  defaultWidth={0}\r\n                  defaultHeight={0}\r\n                  minWidth={300}\r\n                  minHeight={300}\r\n                  maxWidth={2000}\r\n                  maxHeight={1200}\r\n                  autoFill\r\n                >\r\n                  <CameraTile\r\n                    label=\"Your Board\"\r\n                    autoStart={true}\r\n                    className=\"min-w-0 h-full\"\r\n                    aspect=\"classic\"\r\n                    fill\r\n                  />\r\n                </ResizablePanel>\r\n              </div>\r\n              {/* Match summary (offline) */}\r\n              <div className={`mt-2 ${boxSize === 'small' ? 'p-2' : boxSize === 'large' ? 'p-4' : 'p-3'} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === 'small' ? 'text-xs' : textSize === 'large' ? 'text-base' : 'text-sm'}`}>\r\n                <div className=\"font-semibold mb-2\">Match Summary</div>\r\n                {(() => {\r\n                  // In offline X01, player is vs AI or practice\r\n                  const currentThrower = isPlayerTurn ? (user?.username || 'You') : (ai === 'None' ? '—' : `${ai} AI`)\r\n                  const currentRemaining = isPlayerTurn ? playerScore : (ai === 'None' ? 0 : aiScore)\r\n                  const lastScoreDisplay = isPlayerTurn\r\n                    ? (playerVisitDarts > 0 ? playerVisitSum : (playerLastVisitScore ?? playerLastDart))\r\n                    : (aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart))\r\n                  const dartsThrown = isPlayerTurn ? playerDartsThrown : aiDartsThrown\r\n                  const scored = (x01Score - (isPlayerTurn ? playerScore : (ai === 'None' ? x01Score : aiScore)))\r\n                  const avg3 = dartsThrown > 0 ? ((scored / dartsThrown) * 3) : 0\r\n                  const matchScore = `${playerLegs}-${aiLegs}`\r\n                  const bestLegText = legStats.length > 0 ? `${Math.min(...legStats.map(l=>l.doubleDarts + (l.checkoutDarts||0))) || 0} darts` : '—'\r\n                  return (\r\n                    <div className=\"grid grid-cols-2 gap-y-1\">\r\n                      <div className=\"opacity-80\">Current score</div>\r\n                      <div className=\"font-mono text-right\">{matchScore}</div>\r\n                      <div className=\"opacity-80\">Current thrower</div>\r\n                      <div className=\"text-right font-semibold text-lg\">{currentThrower}</div>\r\n                      <div className=\"opacity-80\">Score remaining</div>\r\n                      <div className=\"text-right font-mono font-bold text-xl\">{currentRemaining}</div>\r\n                      <div className=\"opacity-80\">3-dart avg</div>\r\n                      <div className=\"text-right font-mono\">{avg3.toFixed(1)}</div>\r\n                      <div className=\"opacity-80\">Last score</div>\r\n                      <div className=\"text-right font-mono\">{lastScoreDisplay}</div>\r\n                      <div className=\"opacity-80\">Best leg</div>\r\n                      <div className=\"text-right\">{bestLegText}</div>\r\n                    </div>\r\n                  )\r\n                })()}\r\n              </div>\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                <div className=\"text-xs flex items-center justify-between opacity-80\">\r\n                  <span>{ai === 'None' ? 'Opponent' : `${ai} AI`} Remain</span>\r\n                  {!isPlayerTurn ? (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl font-extrabold tracking-tight\">{ai !== 'None' ? aiScore : 'N/A'}</div>\r\n                {ai !== 'None' && (\r\n                  <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                    <div className=\"h-full bg-fuchsia-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (aiScore / x01Score)) * 100))}%` }} />\r\n                  </div>\r\n                )}\r\n                <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{ai === 'None' ? 0 : aiLastDart}</span></div>\r\n                <div className=\"text-sm opacity-90\">Last score: <span className=\"font-semibold\">{ai === 'None' ? '—' : (aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart))}</span></div>\r\n                <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{ai !== 'None' ? (totalAiDarts>0 ? ((totalAiPoints/totalAiDarts)*3).toFixed(1) : '0.0') : '—'}</span></div>\r\n                {ai !== 'None' && (\r\n                  <div className=\"text-xs opacity-70\">Darts thrown: {aiDartsThrown}</div>\r\n                )}\r\n                {ai !== 'None' && (\r\n                  <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {aiDoublesAtt} · Hit {aiDoublesHit}</span></div>\r\n                )}\r\n              </div>\r\n                </div>\r\n            </div>\r\n            )}\r\n            {/* Turn area */}\r\n            {selectedMode !== 'X01' ? (\r\n              <div className=\"space-y-2\">\r\n                {selectedMode === 'Double Practice' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || '—'}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} onAutoDart={(value, ring) => {\r\n                        if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                          const hit = isDoubleHit(value, dpIndex)\r\n                          if (hit) { const nh = dpHits + 1; const ni = dpIndex + 1; setDpHits(nh); setDpIndex(ni); if (nh >= DOUBLE_PRACTICE_ORDER.length) setTimeout(()=>{ setDpHits(0); setDpIndex(0) }, 250) }\r\n                        }\r\n                      }} immediateAutoCommit onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-24\" type=\"number\" min={0} max={60} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e => { if (e.key==='Enter') addDpNumeric() }} />\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={addDpNumeric}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-44\" placeholder=\"Manual (D16, 50, 25, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e => { if (e.key==='Enter') addDpManual() }} />\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={addDpManual}>Add</button>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-300\">Progress: {dpHits} of 21</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Around the Clock' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || '—')}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addAtcValue(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addAtcNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addAtcNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-44\" placeholder=\"Manual (T20, D5, 25, 50)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addAtcManual() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addAtcManual}>Add</button>\r\n                    </div>\r\n                    {atcHits >= ATC_ORDER.length && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setAtcHits(0)\r\n                        setAtcIndex(0)\r\n                        resetDartCount('Around the Clock')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Cricket' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addCricketAuto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addCricketNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addCricketNumeric}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setCricket(createCricketState())\r\n                          setPracticeTurnDarts(0)\r\n                          resetDartCount('Cricket')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Shanghai' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addShanghaiAuto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addShanghaiNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addShanghaiNumeric}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setShanghai(createShanghaiState())\r\n                          setPracticeTurnDarts(0)\r\n                          resetDartCount('Shanghai')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Halve It' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addHalveAuto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addHalveNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addHalveNumeric}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setHalve(createDefaultHalveIt())\r\n                          setPracticeTurnDarts(0)\r\n                          resetDartCount('Halve It')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High-Low' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addHighLowAuto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addHighLowNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addHighLowNumeric}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setHighlow(createHighLow())\r\n                          setPracticeTurnDarts(0)\r\n                          resetDartCount('High-Low')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === \"Bob's 27\" && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addB27Auto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addB27Numeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addB27Numeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetB27}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Count-Up' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value) => addCountUpAuto(value)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addCountUpAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addCountUpAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setCuRound(1)\r\n                          setCuScore(0)\r\n                          setCuDarts(0)\r\n                          resetDartCount('Count-Up')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {cuRound}/{cuMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High Score' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value) => addHighScoreAuto(value)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addHighScoreAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addHighScoreAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setHsRound(1)\r\n                          setHsScore(0)\r\n                          setHsDarts(0)\r\n                          resetDartCount('High Score')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {hsRound}/{hsMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Low Score' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value) => addLowScoreAuto(value)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addLowScoreAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addLowScoreAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setLsRound(1)\r\n                          setLsScore(0)\r\n                          setLsDarts(0)\r\n                          resetDartCount('Low Score')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {lsRound}/{lsMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 170' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring) => addCo170Auto(value, ring === 'MISS' ? undefined : ring)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (D16, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addCoManual(true) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>addCoManual(true)}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetCo170}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Remaining: {co170Rem} · Attempts: {co170Attempts} · Successes: {co170Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 121' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring) => addCo121Auto(value, ring === 'MISS' ? undefined : ring)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (D16, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addCoManual(false) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>addCoManual(false)}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetCo121}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Remaining: {co121Rem} · Attempts: {co121Attempts} · Successes: {co121Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Treble Practice' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addTrebleAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') { const v = parseManualDart(manualBox); if (v!=null) addTrebleAuto(v, undefined, undefined); setManualBox('') } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ const v = parseManualDart(manualBox); if (v!=null) addTrebleAuto(v, undefined, undefined); setManualBox('') }}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Hits: {trebleHits} · Misses: {Math.max(0, trebleDarts - trebleHits)} · Darts: {trebleDarts}{trebleMaxDarts>0?`/${trebleMaxDarts}`:''}</div>\r\n                    {trebleFinished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetTreble}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Baseball' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addBaseballAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetBaseball}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Golf' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addGolfAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetGolf}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Tic Tac Toe' && (\r\n                  <>\r\n                    <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                      {Array.from({length:9},(_,i)=>i).map(cell => (\r\n                        <button key={cell} className={`h-16 rounded-xl border ${ttt.board[cell]?'bg-emerald-500/20 border-emerald-400/30':'bg-slate-800/50 border-slate-700/50'}`} onClick={()=>{\r\n                          if (ttt.finished || ttt.board[cell]) return\r\n                          // One-tap claim attempt using autoscore last dart; fallback: prompt numeric\r\n                          // For simplicity here, we use a no-op value and rely on next autoscore dart; as a usable fallback, open a numeric prompt\r\n                          const promptVal = Number(prompt('Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)')||0)\r\n                          const ring = promptVal%3===0?'TRIPLE': promptVal%2===0?'DOUBLE':'SINGLE'\r\n                          const tcell = cell as unknown as 0|1|2|3|4|5|6|7|8\r\n                          const tgt = TTT_TARGETS[tcell]\r\n                          const num = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          addTttAuto(tcell, promptVal, ring as any, num as any)\r\n                        }}>{ttt.board[cell] || ''}</button>\r\n                      ))}\r\n                    </div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        // Attempt to claim the currently tapped-looking cell not tracked; as a simple flow, map by round-robin preference or let user click a cell button above.\r\n                        // No-op here; primary interaction is via buttons with prompt for now.\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetTtt}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'American Cricket' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addAmCricketAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetAmCricket}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Scam' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{SCAM_TARGET_NAMES[scamPlayer.targetIndex]}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        const r = ring === 'MISS' ? undefined : ring\r\n                        recordDart('Scam')\r\n                        setScamPlayer(addScamAuto(scamPlayer, value, r as any))\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        className=\"input w-24\"\r\n                        type=\"number\"\r\n                        min={1}\r\n                        max={25}\r\n                        value={playerDartPoints}\r\n                        onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                        onKeyDown={e=>{\r\n                          if(e.key==='Enter') {\r\n                            recordDart('Scam')\r\n                            setScamPlayer(addScamNumeric(scamPlayer, playerDartPoints))\r\n                            setPlayerDartPoints(0)\r\n                          }\r\n                        }}\r\n                      />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                        recordDart('Scam')\r\n                        setScamPlayer(addScamNumeric(scamPlayer, playerDartPoints))\r\n                        setPlayerDartPoints(0)\r\n                      }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                        setScamPlayer(resetScam())\r\n                        resetDartCount('Scam')\r\n                      }}>Reset</button>\r\n                    </div>\r\n                    {scamPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">🎉 Finished in {scamPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Fives' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Score: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{fivesPlayer.score}/{fivesPlayer.target}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        recordDart('Fives')\r\n                        setFivesPlayer(addFivesAuto(fivesPlayer, value, ring as any))\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        className=\"input w-24\"\r\n                        type=\"number\"\r\n                        min={5}\r\n                        max={50}\r\n                        value={playerDartPoints}\r\n                        onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                        onKeyDown={e=>{\r\n                          if(e.key==='Enter') {\r\n                            recordDart('Fives')\r\n                            setFivesPlayer(addFivesNumeric(fivesPlayer, playerDartPoints))\r\n                            setPlayerDartPoints(0)\r\n                          }\r\n                        }}\r\n                      />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                        recordDart('Fives')\r\n                        setFivesPlayer(addFivesNumeric(fivesPlayer, playerDartPoints))\r\n                        setPlayerDartPoints(0)\r\n                      }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                        setFivesPlayer(resetFives(fivesPlayer.target))\r\n                        resetDartCount('Fives')\r\n                      }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Valid scores: 5, 10, 15, 20, 25, 50 · Darts: {fivesPlayer.darts}</div>\r\n                    {fivesPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">✓ Reached {fivesPlayer.target} in {fivesPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Sevens' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Score: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{sevensPlayer.score}/{sevensPlayer.target}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        recordDart('Sevens')\r\n                        setSevensPlayer(addSevensAuto(sevensPlayer, value, ring as any))\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        className=\"input w-24\"\r\n                        type=\"number\"\r\n                        min={7}\r\n                        max={21}\r\n                        value={playerDartPoints}\r\n                        onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                        onKeyDown={e=>{\r\n                          if(e.key==='Enter') {\r\n                            recordDart('Sevens')\r\n                            setSevensPlayer(addSevensNumeric(sevensPlayer, playerDartPoints))\r\n                            setPlayerDartPoints(0)\r\n                          }\r\n                        }}\r\n                      />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                        recordDart('Sevens')\r\n                        setSevensPlayer(addSevensNumeric(sevensPlayer, playerDartPoints))\r\n                        setPlayerDartPoints(0)\r\n                      }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                        setSevensPlayer(resetSevens(sevensPlayer.target))\r\n                        resetDartCount('Sevens')\r\n                      }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Valid scores: 7, 14, 21 · Darts: {sevensPlayer.darts}</div>\r\n                    {sevensPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">✓ Reached {sevensPlayer.target} in {sevensPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Killer' && (\r\n                  <>\r\n                    {!killerSetupDone ? (\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"font-semibold\">Players</div>\r\n                        <div className=\"space-y-1\">\r\n                          {killerPlayers.map((p, idx) => (\r\n                            <div key={p.id} className=\"flex items-center gap-2\">\r\n                              <input className=\"input\" value={p.name} onChange={e=>{\r\n                                const name = e.target.value\r\n                                setKillerPlayers(list => list.map((it,i)=> i===idx?{...it,name}:it))\r\n                              }} />\r\n                              <button className=\"btn px-2 py-1\" onClick={()=> setKillerPlayers(list => list.filter((_,i)=>i!==idx))} disabled={killerPlayers.length<=2}>Remove</button>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <button className=\"btn px-2 py-1\" onClick={()=> setKillerPlayers(list => {\r\n                            const id = `p${list.length+1}`; return [...list, { id, name: `Player ${list.length+1}` }]\r\n                          })}>Add Player</button>\r\n                          <button className=\"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1\" onClick={()=>{\r\n                            if (killerPlayers.length < 2) { alert('Need at least 2 players'); return }\r\n                            const ids = killerPlayers.map(p=>p.id)\r\n                            const assigned = assignKillerNumbers(ids)\r\n                            const initStates: Record<string,KillerState> = {}\r\n                            ids.forEach(id => { initStates[id] = createKillerState(assigned[id]) })\r\n                            setKillerAssigned(assigned)\r\n                            setKillerStates(initStates)\r\n                            setKillerTurnIdx(0)\r\n                            setKillerDarts(0)\r\n                            setKillerWinnerId(null)\r\n                            setKillerLastEvent('Assigned numbers')\r\n                            setKillerSetupDone(true)\r\n                          }}>Assign Numbers & Start</button>\r\n                        </div>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"space-y-3\">\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                          {killerPlayers.map(p => {\r\n                            const st = killerStates[p.id]\r\n                            const num = killerAssigned[p.id]\r\n                            return (\r\n                              <div key={p.id} className={`p-2 rounded-xl border ${st?.eliminated? 'opacity-50 border-red-500/40 bg-red-500/10' : 'border-slate-700/50 bg-slate-800/50'}`}>\r\n                                <div className=\"flex items-center justify-between text-xs\">\r\n                                  <div className=\"font-semibold\">{p.name}</div>\r\n                                  <div className={`text-[10px] px-1.5 py-0.5 rounded ${st?.isKiller?'bg-purple-500/20 text-purple-200 border border-purple-400/30':'bg-slate-600/30 text-slate-300'}`}>{st?.isKiller? 'Killer' : 'Not Killer'}</div>\r\n                                </div>\r\n                                <div className=\"mt-1 text-sm\">Number: <span className=\"font-semibold\">{num}</span></div>\r\n                                <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{st?.lives ?? 0}</span></div>\r\n                              </div>\r\n                            )\r\n                          })}\r\n                        </div>\r\n                        {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                            if (killerWinnerId) return\r\n                            const r = ring === 'MISS' ? undefined : ring\r\n                            const sector = info?.sector ?? null\r\n                            const cur = killerPlayers[killerTurnIdx]\r\n                            if (!cur) return\r\n                            setKillerStates(prev => {\r\n                              const copy: Record<string,KillerState> = {}\r\n                              Object.keys(prev).forEach(k => copy[k] = { ...prev[k] })\r\n                              const res = applyKillerDart(cur.id, copy, r as any, sector)\r\n                              if (res.becameKiller) setKillerLastEvent(`${cur.name} became a Killer`)\r\n                              else if (res.victimId) {\r\n                                const v = killerPlayers.find(p=>p.id===res.victimId)\r\n                                setKillerLastEvent(`${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved||0)>1?'s':''})`)\r\n                              } else setKillerLastEvent('No effect')\r\n                              // Check winner\r\n                              const win = killerWinner(copy)\r\n                              if (win) setKillerWinnerId(win)\r\n                              return copy\r\n                            })\r\n                            setKillerDarts(d => {\r\n                              const nd = d + 1\r\n                              if (nd >= 3) {\r\n                                // advance to next alive\r\n                                let next = killerTurnIdx\r\n                                for (let i=1;i<=killerPlayers.length;i++) {\r\n                                  const idx = (killerTurnIdx + i) % killerPlayers.length\r\n                                  const pid = killerPlayers[idx].id\r\n                                  const st = killerStates[pid]\r\n                                  if (st && !st.eliminated && st.lives > 0) { next = idx; break }\r\n                                }\r\n                                setKillerTurnIdx(next)\r\n                                return 0\r\n                              }\r\n                              return nd\r\n                            })\r\n                          }} />\r\n                        </div>}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input className=\"input w-40\" placeholder=\"Manual (D16, T5)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') {\r\n                            if (killerWinnerId) return\r\n                            const t = manualBox.trim().toUpperCase()\r\n                            const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n                            if (!m) { setManualBox(''); return }\r\n                            const mult = (m[1]||'S') as 'S'|'D'|'T'\r\n                            const num = parseInt(m[2],10)\r\n                            const ring = mult==='D'?'DOUBLE': mult==='T'?'TRIPLE':'SINGLE'\r\n                            const cur = killerPlayers[killerTurnIdx]\r\n                            setKillerStates(prev => {\r\n                              const copy: Record<string,KillerState> = {}\r\n                              Object.keys(prev).forEach(k => copy[k] = { ...prev[k] })\r\n                              const res = applyKillerDart(cur.id, copy, ring as any, num)\r\n                              if (res.becameKiller) setKillerLastEvent(`${cur.name} became a Killer`)\r\n                              else if (res.victimId) {\r\n                                const v = killerPlayers.find(p=>p.id===res.victimId)\r\n                                setKillerLastEvent(`${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved||0)>1?'s':''})`)\r\n                              } else setKillerLastEvent('No effect')\r\n                              const win = killerWinner(copy); if (win) setKillerWinnerId(win)\r\n                              return copy\r\n                            })\r\n                            setManualBox('')\r\n                            setKillerDarts(d => {\r\n                              const nd = d + 1\r\n                              if (nd >= 3) { let next = killerTurnIdx; for (let i=1;i<=killerPlayers.length;i++){ const idx=(killerTurnIdx+i)%killerPlayers.length; const pid=killerPlayers[idx].id; const st=killerStates[pid]; if (st && !st.eliminated && st.lives>0) { next=idx; break } } setKillerTurnIdx(next); return 0 } return nd\r\n                            })\r\n                          } }} />\r\n                          <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                            // Skip to next alive player\r\n                            let next = killerTurnIdx\r\n                            for (let i=1;i<=killerPlayers.length;i++) {\r\n                              const idx = (killerTurnIdx + i) % killerPlayers.length\r\n                              const pid = killerPlayers[idx].id\r\n                              const st = killerStates[pid]\r\n                              if (st && !st.eliminated && st.lives > 0) { next = idx; break }\r\n                            }\r\n                            setKillerTurnIdx(next); setKillerDarts(0)\r\n                          }}>Next Player</button>\r\n                          <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                            // Reset Killer\r\n                            setKillerStates({}); setKillerAssigned({}); setKillerSetupDone(false); setKillerTurnIdx(0); setKillerDarts(0); setKillerWinnerId(null); setKillerLastEvent('')\r\n                          }}>Reset</button>\r\n                        </div>\r\n                        {killerWinnerId && (\r\n                          <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Winner: {killerPlayers.find(p=>p.id===killerWinnerId)?.name} <button className=\"ml-2 underline\" onClick={()=>{\r\n                            setKillerStates({}); setKillerAssigned({}); setKillerSetupDone(false); setKillerTurnIdx(0); setKillerDarts(0); setKillerWinnerId(null); setKillerLastEvent('')\r\n                          }}>Play Again</button></div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-2\">\r\n                {/* Scorecard + Camera split (Option A): Scoreboard LEFT, Camera RIGHT */}\r\n                <div className=\"flex gap-3 min-h-0 flex-1 text-[14px]\">\r\n                      {/* Left column: Scoreboard + Manual Scoring (50% width) */}\r\n                      <div className=\"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm\">\r\n                        <div className=\"text-sm font-semibold opacity-80\">Scoreboard</div>\r\n                        {/* Scoreboard */}\r\n                        <div className=\"flex-shrink-0\">\r\n                          <GameScoreboard\r\n                            gameMode={selectedMode as any}\r\n                            players={statsX01}\r\n                            matchScore={`${playerLegs}-${aiLegs}`}\r\n                          />\r\n                        </div>\r\n\r\n                        {/* Manual Scoring Section */}\r\n                        {isPlayerTurn && (\r\n                          <div className=\"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0\">\r\n                            <div className=\"flex flex-wrap items-center justify-between gap-3\">\r\n                              <h4 className=\"text-sm font-semibold tracking-wide uppercase text-indigo-200\">Manual Scoring</h4>\r\n                              <span className=\"text-xs text-white/60\">Override a visit or enter dart-by-dart scores.</span>\r\n                            </div>\r\n                            <div className=\"mt-3 space-y-3\">\r\n                              <div className=\"flex flex-wrap items-center gap-2\">\r\n                                <label className=\"text-xs uppercase tracking-wide text-white/60\">Single Dart</label>\r\n                                <input\r\n                                  className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                  type=\"number\"\r\n                                  min={0}\r\n                                  max={60}\r\n                                  value={playerDartPoints}\r\n                                  onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                                  onKeyDown={e => { if (e.key === 'Enter') (e.shiftKey ? replaceLast() : addDartNumeric()) }}\r\n                                  placeholder=\"60\"\r\n                                />\r\n                                <button className=\"btn px-3 py-1 text-sm\" onClick={addDartNumeric}>Add Dart</button>\r\n                              </div>\r\n\r\n                              <div className=\"flex flex-wrap items-center gap-2\">\r\n                                <label className=\"text-xs uppercase tracking-wide text-white/60\">Three Dart Edit</label>\r\n                                <input\r\n                                  className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                  type=\"number\"\r\n                                  min={0}\r\n                                  max={playerScore <= 170 ? 170 : 180}\r\n                                  value={visitTotalInput}\r\n                                  onChange={e=>handleVisitTotalChange(e.target.value)}\r\n                                  onKeyDown={e => { if (e.key==='Enter') addVisitTotal() }}\r\n                                  placeholder=\"100\"\r\n                                />\r\n                                <button className=\"btn px-3 py-1 text-sm\" onClick={addVisitTotal}>Commit Visit</button>\r\n                                <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={replaceLast}>Undo Visit</button>\r\n                              </div>\r\n\r\n                              <div className=\"flex flex-wrap items-center gap-2\">\r\n                                <label className=\"text-xs uppercase tracking-wide text-white/60\">Manual</label>\r\n                                <input\r\n                                  className=\"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                  value={manualBox}\r\n                                  onChange={e=>setManualBox(e.target.value)}\r\n                                  onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLastManual() : addManual()) }}\r\n                                  placeholder=\"T20\"\r\n                                />\r\n                                <button className=\"btn px-3 py-1 text-sm\" onClick={addManual}>Apply</button>\r\n                                <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={replaceLastManual} disabled={playerVisitDarts===0}>Replace Last</button>\r\n                              </div>\r\n\r\n                              <div>\r\n                                <label className=\"text-xs uppercase tracking-wide text-white/60\">Multi-entry (one per line)</label>\r\n                                <textarea\r\n                                  className=\"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30\"\r\n                                  rows={3}\r\n                                  value={manualTextarea}\r\n                                  onChange={e=>setManualTextarea(e.target.value)}\r\n                                  placeholder={'T20\\nD16\\n25'}\r\n                                />\r\n                                <div className=\"mt-2 flex flex-wrap gap-2\">\r\n                                  <button className=\"btn px-3 py-1 text-sm\" onClick={addManualTextarea}>Apply All</button>\r\n                                  <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={() => setManualTextarea('')}>Clear</button>\r\n                                </div>\r\n                              </div>\r\n\r\n                              <div className=\"pt-2 border-t border-white/10 mt-3\">\r\n                                <button\r\n                                  className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\r\n                                  onClick={clearCurrentVisit}\r\n                                  disabled={playerVisitDarts === 0 && playerVisitSum === 0}\r\n                                >Clear Current Visit</button>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Right column: Main Camera Feed (50% width) */}\r\n                      {cameraEnabled && (\r\n                        <div className=\"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                            onAutoDart={(value, ring) => {\r\n                              const ringLabel = ring ?? 'MISS'\r\n                              const safeValue = Number.isFinite(value) ? Math.max(0, value) : 0\r\n                              const now = Date.now()\r\n                              if (safeValue <= 0) {\r\n                                if (ringLabel !== 'MISS') return\r\n                                if (now - (lastBounceMissTsRef.current || 0) < 1200) {\r\n                                  return\r\n                                }\r\n                                lastBounceMissTsRef.current = now\r\n                              } else {\r\n                                lastBounceMissTsRef.current = 0\r\n                              }\r\n                              applyDartValue(safeValue)\r\n                            }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                </div>\r\n                {/* Remove the separate camera view below scoreboard */}\r\n                {(selectedMode as any) === 'X01' && !cameraEnabled && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode={selectedMode as any}\r\n                      players={statsX01}\r\n                      matchScore={`${playerLegs}-${aiLegs}`}\r\n                    />\r\n                  </>\r\n                )}\r\n                {(selectedMode as any) === 'Cricket' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Cricket\"\r\n                      players={statsCricket}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Cricket auto-scoring */}\r\n                {(selectedMode as any) === 'Cricket' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          const r = ring === 'MISS' ? undefined : ring\r\n                          addCricketAuto(value, r as any, info?.sector ?? null)\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Shanghai' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Shanghai\"\r\n                      players={statsShanghai}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Shanghai auto-scoring */}\r\n                {(selectedMode as any) === 'Shanghai' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          const r = ring === 'MISS' ? undefined : ring\r\n                          addShanghaiAuto(value, r as any, info?.sector ?? null)\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Killer' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Killer\"\r\n                      players={statsKiller}\r\n                    />\r\n                  </>\r\n                )}\r\n                {(selectedMode as any) === 'Scam' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Scam\"\r\n                      players={statsScam}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Scam auto-scoring */}\r\n                {(selectedMode as any) === 'Scam' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setScamPlayer(addScamAuto(scamPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Fives' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Fives\"\r\n                      players={statsFives}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Fives auto-scoring */}\r\n                {(selectedMode as any) === 'Fives' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setFivesPlayer(addFivesAuto(fivesPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Sevens' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Sevens\"\r\n                      players={statsSevens}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Sevens auto-scoring */}\r\n                {(selectedMode as any) === 'Sevens' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setSevensPlayer(addSevensAuto(sevensPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                <div className=\"font-semibold\">Your Turn</div>\r\n                <div className=\"flex flex-col gap-2\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-24\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      max={60}\r\n                      value={playerDartPoints}\r\n                      onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                      onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLast() : addDartNumeric()) }}\r\n                    />\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addDartNumeric} title=\"Add a single dart (0–60)\">Add Dart</button>\r\n                  </div>\r\n                  {/* Visit total entry */}\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-28\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      max={playerScore <= 170 ? 170 : 180}\r\n                      placeholder=\"Visit total (0–180)\"\r\n                      value={visitTotalInput}\r\n                      onChange={e=>handleVisitTotalChange(e.target.value)}\r\n                      onKeyDown={e => { if (e.key==='Enter') addVisitTotal() }}\r\n                    />\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addVisitTotal} title=\"Commit a full 3-dart total like 93\">Commit Visit</button>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-44\"\r\n                      placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                      value={manualBox}\r\n                      onChange={e=>setManualBox(e.target.value)}\r\n                      onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLastManual() : addManual()) }}\r\n                    />\r\n                    <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={replaceLastManual} disabled={playerVisitDarts===0}>Replace Last</button>\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addManual}>Add</button>\r\n                  </div>\r\n                  <div>\r\n                    <textarea\r\n                      className=\"input w-full h-24 resize-none\"\r\n                      placeholder=\"Type scores manually (one per line, e.g. T20&#10;D16&#10;5&#10;25&#10;50) - No camera needed!\"\r\n                      value={manualTextarea}\r\n                      onChange={e=>setManualTextarea(e.target.value)}\r\n                    />\r\n                    <div className=\"flex gap-2 mt-1\">\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addManualTextarea}>Add All Scores</button>\r\n                      <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={() => setManualTextarea('')}>Clear</button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-xs text-slate-300\">Tip: Enter to Add · Shift+Enter to Replace Last</div>\r\n              </div>\r\n            )}\r\n            <div className=\"h-1\" />\r\n              </div>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {showRules && <X01RulesPopup onClose={() => setShowRules(false)} />}\r\n      {/* Frosted overlay when selecting premium mode without access */}\r\n      {lockedPremium && (\r\n        <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n          <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n            <div className=\"text-3xl mb-2\">🔒</div>\r\n            <div className=\"font-semibold\">Premium mode locked</div>\r\n            <div className=\"text-sm text-slate-200/80\">Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more.</div>\r\n            <button\r\n              onClick={async () => {\r\n                try {\r\n                  const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ email: user?.email })\r\n                  });\r\n                  const data = await res.json();\r\n                  if (data.ok && data.url) {\r\n                    window.location.href = data.url;\r\n                    if (data.development) {\r\n                      toast(\"Opened Stripe test checkout (development mode)\", { type: 'info', timeout: 3000 });\r\n                    }\r\n                  } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                    toast(\"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\", { type: 'error', timeout: 4000 });\r\n                  } else {\r\n                    toast(\"Failed to create checkout session. Please try again.\", { type: 'error', timeout: 4000 });\r\n                  }\r\n                } catch (err) {\r\n                  toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n                }\r\n              }}\r\n              className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n            >\r\n              Upgrade to PREMIUM · {formatPriceInCurrency(getUserCurrency(), 5)}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showCameraManager && typeof document !== 'undefined' ? createPortal(\r\n        <div className=\"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4\" onClick={() => setShowCameraManager(false)}>\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:offline-camera-manager\"\r\n            className=\"relative\"\r\n            defaultWidth={640}\r\n            defaultHeight={520}\r\n            minWidth={480}\r\n            minHeight={420}\r\n            maxWidth={1200}\r\n            maxHeight={900}\r\n            initialFitHeight\r\n            onClose={() => setShowCameraManager(false)}\r\n          >\r\n            <div className=\"space-y-3\" onClick={e => e.stopPropagation()}>\r\n              <div className=\"flex items-center justify-between gap-3\">\r\n                <div>\r\n                  <div className=\"text-xs uppercase tracking-wide text-white/50\">Camera Devices</div>\r\n                  <div className=\"text-xl font-semibold text-white mt-1\">Manage Offline Camera Feeds</div>\r\n                </div>\r\n                <button className=\"btn bg-slate-800 hover:bg-slate-700 text-white\" onClick={() => setShowCameraManager(false)}>Close</button>\r\n              </div>\r\n              <CameraTile\r\n                fill\r\n                user={user}\r\n                playerScore={playerScore}\r\n                aiScore={aiScore}\r\n                x01Score={x01Score}\r\n                inMatch={inMatch}\r\n                showWinPopup={showWinPopup}\r\n                pendingLegWinner={pendingLegWinner}\r\n                playerDartsThrown={playerDartsThrown}\r\n                aiDartsThrown={aiDartsThrown}\r\n                totalPlayerDarts={totalPlayerDarts}\r\n                totalAiDarts={totalAiDarts}\r\n                totalPlayerPoints={totalPlayerPoints}\r\n                totalAiPoints={totalAiPoints}\r\n                player180s={player180s}\r\n                player140s={player140s}\r\n                player100s={player100s}\r\n                ai180s={ai180s}\r\n                ai140s={ai140s}\r\n                ai100s={ai100s}\r\n                playerHighestCheckout={playerHighestCheckout}\r\n                aiHighestCheckout={aiHighestCheckout}\r\n                onClose={() => setShowCameraManager(false)}\r\n                onOpen={() => setShowCameraManager(true)}\r\n                layout={offlineLayout}\r\n              />\r\n            </div>\r\n          </ResizableModal>\r\n        </div>,\r\n        document.body\r\n      ) : null}\r\n      {legOverrideConfirm && typeof document !== 'undefined' ? createPortal((() => {\r\n        const { target, value, stage } = legOverrideConfirm\r\n        const targetName = target === 'player' ? humanName : aiDisplayName\r\n        const currentLegs = target === 'player' ? playerLegs : aiLegs\r\n        return (\r\n          <div className=\"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4\" onClick={handleLegOverrideNo}>\r\n            <ResizableModal\r\n              storageKey=\"ndn:modal:offline-leg-override\"\r\n              className=\"relative\"\r\n              defaultWidth={360}\r\n              defaultHeight={240}\r\n              minWidth={280}\r\n              minHeight={200}\r\n              maxWidth={420}\r\n              maxHeight={360}\r\n              initialFitHeight\r\n              onClose={handleLegOverrideNo}\r\n            >\r\n              <div className=\"space-y-3 max-w-[18rem] mx-auto\" onClick={e => e.stopPropagation()}>\r\n                <div>\r\n                  <div className=\"text-xs uppercase tracking-wide text-white/50\">Step {stage} of 2</div>\r\n                  <div className=\"text-xl font-semibold text-white mt-1\">Override legs?</div>\r\n                </div>\r\n                <div className=\"text-sm text-slate-200 leading-relaxed\">\r\n                  {stage === 1 ? (\r\n                    <>Set {targetName}&apos;s legs to <span className=\"font-semibold text-white\">{value}</span>? Confirm to continue.</>\r\n                  ) : (\r\n                    <>Final confirmation: set {targetName}&apos;s legs to <span className=\"font-semibold text-white\">{value}</span>. Select <span className=\"font-semibold text-emerald-200\">Yes</span> to apply immediately.</>\r\n                  )}\r\n                </div>\r\n                <div className=\"rounded-xl bg-black/40 border border-white/10 p-3 text-sm\">\r\n                  <div className=\"text-xs uppercase tracking-wide text-white/50 mb-1\">Current legs</div>\r\n                  <div className=\"text-base font-semibold text-white\">{currentLegs}</div>\r\n                </div>\r\n                <div className=\"flex items-center justify-end gap-2 pt-2\">\r\n                  <button className=\"btn bg-rose-600 hover:bg-rose-700 text-white\" onClick={handleLegOverrideNo}>No</button>\r\n                  <button className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={handleLegOverrideYes}>Yes</button>\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        )\r\n      })(), document.body) : null}\r\n        {showWinPopup && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <ResizableModal storageKey=\"ndn:modal:offline-win\" className=\"w-full relative\" defaultWidth={420} defaultHeight={360} minWidth={360} minHeight={300} maxWidth={800} maxHeight={700} initialFitHeight>\r\n            <h3 className=\"text-lg font-bold mb-2\">Leg Won!</h3>\r\n            <label className=\"block mb-1\">Darts to hit double:</label>\r\n            <div className=\"flex gap-2 mb-2\">\r\n              {[1,2,3].map(n => (\r\n                <button key={n} className={`btn ${doubleDarts===n?'bg-brand-600':''}`} onClick={()=>setDoubleDarts(n)}>{n}</button>\r\n              ))}\r\n            </div>\r\n            <label className=\"block mb-1\">Darts for checkout:</label>\r\n            <div className=\"flex gap-2 mb-2\">\r\n              {[1,2,3].map(n => (\r\n                <button key={n} className={`btn ${checkoutDarts===n?'bg-brand-600':''}`} onClick={()=>setCheckoutDarts(n)}>{n}</button>\r\n              ))}\r\n            </div>\r\n            <div className=\"grid grid-cols-1 gap-2 mt-2\">\r\n              <button className=\"btn w-full\" onClick={handleWinPopupSubmit}>Submit</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700 w-full\" onClick={() => { setShowWinPopup(false); startMatch(); }}>Rematch</button>\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800 w-full\" onClick={() => { setShowWinPopup(false); setShowMatchModal(false); setInMatch(false); }}>Back to Menu</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {showMatchSummary && (\r\n        <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]\">\r\n          <ResizableModal storageKey=\"ndn:modal:offline-summary\" className=\"w-full relative\" defaultWidth={820} defaultHeight={520} minWidth={600} minHeight={400} maxWidth={1400} maxHeight={1000} initialFitHeight>\r\n            <h3 className=\"text-xl font-extrabold mb-2\">Match Summary</h3>\r\n            <div className=\"text-xs opacity-80 mb-3\">{selectedMode} · {x01Score} start · First to {firstTo}</div>\r\n            {(() => {\r\n              const player3da = totalPlayerDarts>0 ? ((totalPlayerPoints/totalPlayerDarts)*3) : 0\r\n              const player9da = player3da * 3\r\n              const playerBest = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='player' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return '—'\r\n                return `${Math.min(...darts)} darts`\r\n              })()\r\n              const playerWorst = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='player' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return '—'\r\n                return `${Math.max(...darts)} darts`\r\n              })()\r\n              const playerPct = playerDoublesAtt>0 ? Math.round((playerDoublesHit/playerDoublesAtt)*100) : 0\r\n\r\n              const ai3da = totalAiDarts>0 ? ((totalAiPoints/totalAiDarts)*3) : 0\r\n              const ai9da = ai3da * 3\r\n              const aiBest = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='ai' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return '—'\r\n                return `${Math.min(...darts)} darts`\r\n              })()\r\n              const aiWorst = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='ai' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return '—'\r\n                return `${Math.max(...darts)} darts`\r\n              })()\r\n              const aiPct = aiDoublesAtt>0 ? Math.round((aiDoublesHit/aiDoublesAtt)*100) : 0\r\n\r\n              return (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                  <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                    <div className=\"text-sm font-semibold mb-1\">{user?.username || 'You'}</div>\r\n                    <div className=\"text-3xl font-extrabold\">{playerLegs}</div>\r\n                    <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                    <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                      <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{player3da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{player9da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{playerDoublesAtt}</div></div>\r\n                      <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{playerPct}%</div></div>\r\n                      <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{playerBest}</div></div>\r\n                      <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{playerWorst}</div></div>\r\n                      <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{player180s}</div></div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"hidden md:flex items-center justify-center\">\r\n                    <div className=\"text-4xl font-black\">{playerLegs} – {aiLegs}</div>\r\n                  </div>\r\n                  <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                    <div className=\"text-sm font-semibold mb-1\">{ai==='None' ? 'Opponent' : `${ai} AI`}</div>\r\n                    <div className=\"text-3xl font-extrabold\">{aiLegs}</div>\r\n                    <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                    <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                      <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{ai3da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{ai9da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{aiDoublesAtt}</div></div>\r\n                      <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{aiPct}%</div></div>\r\n                      <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{aiBest}</div></div>\r\n                      <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{aiWorst}</div></div>\r\n                      <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{ai180s}</div></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            })()}\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm font-semibold mb-2\">Legs Timeline</div>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {legStats.map((leg, i) => (\r\n                  <div key={i} className={`px-3 py-1 rounded-full border text-xs ${leg.winner==='player' ? 'bg-emerald-500/15 border-emerald-400/30' : 'bg-fuchsia-500/15 border-fuchsia-400/30'}`}>\r\n                    Leg {i+1}: {leg.winner==='player' ? 'You' : (ai==='None'?'Opp':'AI')} · Dbl {leg.doubleDarts} · CO {leg.checkoutDarts}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm font-semibold mb-2\">Shot Heat Map</div>\r\n              <div className=\"rounded-2xl overflow-hidden bg-black p-3\">\r\n                {/* Lazy-load HeatMap component to avoid increasing initial bundle too much */}\r\n                <HeatMap />\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => setShowMatchSummary(false)}>Close</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={() => { setShowMatchSummary(false); startMatch(); }}>Rematch</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {legStats.length > 0 && (\r\n        <div className=\"mt-4\">\r\n          <h4 className=\"font-semibold mb-2\">Leg Stats</h4>\r\n          <ul>\r\n            {legStats.map((leg, i) => (\r\n              <li key={i}>Leg {i+1}: Double darts: {leg.doubleDarts}, Checkout darts: {leg.checkoutDarts}</li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n      \r\n  {/* Phone camera overlay removed per UX preference; use header badge preview only */}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":["CRICKET_NUMBERS","createCricketState","marks","n","applyCricketDart","state","value","ring","sector","opponentClosed","num","hits","cand","c","before","remainToClose","toApply","overflow","after","points","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","target","endShanghaiTurn","next","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","t","scored","endHalveItTurn","createHighLow","applyHighLowDart","v","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","_","i","res","id","idx","applyKillerDart","selfId","states","me","victimId","pid","victim","delta","killerWinner","alive","st","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","GameCalibrationStatus","gameMode","compact","onRecalibrate","H","errorPx","useCalibration","confidence","getCalibrationConfidenceForGame","suitable","isCalibrationSuitableForGame","quality","text","getCalibrationQualityText","recommendation","getRecalibrationRecommendation","requirement","GAME_CALIBRATION_REQUIREMENTS","jsxs","jsx","AlertTriangle","bgColor","textColor","icon","CheckCircle","React","AlertCircle","Zap","CameraTile","label","autoStart","scaleOverride","className","aspect","style","fill","videoRef","useRef","cameraSession","useCameraSession","streaming","setStreaming","useState","ws","setWs","pairCode","setPairCode","pc","setPc","lastRegisteredModeRef","registerStream","useCallback","stream","modeOverride","err","preferredCameraLabel","useUserSettings","s","mode","setMode","saved","expiresAt","setExpiresAt","paired","setPaired","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","cameraEnabledSetting","setPreferredCameraLocked","preferredCameraLocked","setPreferredCamera","preferredCameraId","fallbackClass","fallbackStyle","useEffect","h","apiFetch","r","j","ip","x","mobileUrl","useMemo","code","envUrl","u","host","useHttps","port","manualModeSetAt","setManualModeSetAt","ignore","cancelled","desiredLabel","timer","start","stop","apply","startWifiConnection","startPhonePairing","constraints","name","devices","discoverNetworkDevices","error","connectToWifiDevice","device","d","connectToNetworkDevice","startUsbConnection","discoverUSBDevices","newDevice","requestUSBDevice","prev","connectToUsbDevice","connectToUSBDevice","handleModeSelect","newMode","onStart","ev","modeFromEvent","ensureWS","normalizedEnv","proto","sameOrigin","isLocalhost","isRenderHost","renderWS","url","socket","data","peer","e","inbound","offer","regenerateCode","stopAll","CameraFrame","props","cameraScale","storedAspect","onModeSelect","modeDisplayName","reconnectOptions","copyFeedback","setCopyFeedback","copyTimeoutRef","globalFitMode","effectiveFitMode","scale","raw","clamped","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","usbActive","videoElement","baseVideoClass","copyValue","type","textarea","Fragment","option","isActive","polarToCartesian","cx","cy","angleDeg","a","sectorAngle","HeatMap","width","height","samples","useHeatmapStore","ref","ctx","BoardRadii","radii","ringOrder","k","angle","p","grd","sectorCounts","secStr","sec","pos","createScamState","SCAM_TARGETS","SCAM_TARGET_NAMES","getScamTarget","addScamAuto","newIndex","finished","addScamNumeric","resetScam","createFivesState","FIVES_VALID_NUMBERS","isFivesValid","addFivesAuto","newScore","addFivesNumeric","resetFives","createSevensState","SEVENS_VALID_NUMBERS","isSevensValid","addSevensAuto","addSevensNumeric","resetSevens","makeOfflineAddVisitAdapter","commitManualVisitTotal","score","darts","createOfflineMatchActions","args","match","endTurn","meta","useOfflineGameStats","playerScore","aiScore","playerLegs","aiLegs","playerLastDart","aiLastDart","playerVisitSum","aiVisitSum","playerLastVisitScore","aiLastVisitScore","playerVisitDartCount","aiVisitDartCount","playerDoublesHit","playerDoublesAtt","aiDoublesHit","aiDoublesAtt","legStats","isPlayerTurn","ai","x01Score","cricket","shanghai","killerPlayers","killerStates","killerAssigned","killerTurnIdx","players","playerMatchAvg","playerDarts","playerScored","leg","resolvedPlayerLastScore","l","getAllTimeAvg","resolvedAiLastScore","aiLevels","clamp","min","max","BOARD_CLEAR_GRACE_MS","aiVisitScore","remaining","level","candidates","X01RulesPopup","onClose","API_URL","OfflinePlay","user","offlineLayout","favoriteDouble","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","rememberLastOffline","setLastOffline","autoStartOffline","setCameraScale","cameraAspect","setCameraAspect","cameraFitMode","setCameraFitMode","cameraEnabled","textSize","boxSize","autoCommitMode","matchType","setMatchType","teamAName","setTeamAName","teamBName","setTeamBName","manualScoring","cameraToolbarVisible","waitForBoardClear","selectedMode","setSelectedMode","setX01Score","setAI","showRules","setShowRules","inMatch","setInMatch","setPlayerScore","setAiScore","onDouble","setOnDouble","showWinPopup","setShowWinPopup","firstTo","setFirstTo","setPlayerLegs","useMatch","showStartShowcase","setShowStartShowcase","startedShowcasedRef","setAiLegs","pendingLegWinner","setPendingLegWinner","doubleDarts","setDoubleDarts","checkoutDarts","setCheckoutDarts","setLegStats","aiDelayMs","setAiDelayMs","toast","useToast","showMatchModal","setShowMatchModal","maximized","setMaximized","fitAll","setFitAll","fitScale","setFitScale","fitOverflowing","setFitOverflowing","setIsPlayerTurn","handleOpenManager","setShowCameraManager","playerDartPoints","setPlayerDartPoints","dpIndex","setDpIndex","dpHits","setDpHits","atcIndex","setAtcIndex","atcHits","setAtcHits","setCricket","setShanghai","halve","setHalve","highlow","setHighlow","practiceTurnDarts","setPracticeTurnDarts","b27Stage","setB27Stage","b27Score","setB27Score","b27Darts","setB27Darts","b27Hits","setB27Hits","b27Finished","setB27Finished","cuRound","setCuRound","cuScore","setCuScore","cuDarts","setCuDarts","cuMaxRounds","hsRound","setHsRound","hsScore","setHsScore","hsDarts","setHsDarts","hsMaxRounds","lsRound","setLsRound","lsScore","setLsScore","lsDarts","setLsDarts","lsMaxRounds","co170Rem","setCo170Rem","co170Darts","setCo170Darts","co170Attempts","setCo170Attempts","co170Successes","setCo170Successes","co121Rem","setCo121Rem","co121Darts","setCo121Darts","co121Attempts","setCo121Attempts","co121Successes","setCo121Successes","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","trebleMaxDarts","setTrebleMaxDarts","trebleFinished","setTrebleFinished","baseball","setBaseball","golf","setGolf","ttt","setTTT","createTicTacToe","amCricket","setAmCricket","setKillerPlayers","setKillerStates","setKillerAssigned","killerSetupDone","setKillerSetupDone","setKillerTurnIdx","killerDarts","setKillerDarts","killerWinnerId","setKillerWinnerId","killerLastEvent","setKillerLastEvent","scam","setScam","scamPlayer","setScamPlayer","fives","setFives","fivesPlayer","setFivesPlayer","sevens","setSevens","sevensPlayer","setSevensPlayer","playerDartsThrown","setPlayerDartsThrown","setPlayerLastDart","playerVisitDarts","setPlayerVisitDarts","playerVisitStart","setPlayerVisitStart","setPlayerVisitSum","setPlayerLastVisitScore","playerVisitDartsAtDouble","setPlayerVisitDartsAtDouble","lastBounceMissTsRef","lastVisitDartsRef","playerScoreRef","playerVisitDartsRef","playerVisitSumRef","playerVisitStartRef","playerVisitDartsAtDoubleRef","aiCountdownMs","setAiCountdownMs","aiDartsThrown","setAiDartsThrown","setAiLastDart","setAiVisitSum","aiVisitDarts","setAiVisitDarts","setAiLastVisitScore","aiVisitDartsAtDouble","setAiVisitDartsAtDouble","setPlayerDoublesAtt","setPlayerDoublesHit","setAiDoublesAtt","setAiDoublesHit","totalPlayerDarts","setTotalPlayerDarts","totalAiDarts","setTotalAiDarts","totalPlayerPoints","setTotalPlayerPoints","totalAiPoints","setTotalAiPoints","player180s","setPlayer180s","player140s","setPlayer140s","player100s","setPlayer100s","ai180s","setAi180s","ai140s","setAi140s","ai100s","setAi100s","playerHighestCheckout","setPlayerHighestCheckout","aiHighestCheckout","setAiHighestCheckout","showMatchSummary","setShowMatchSummary","manualBox","setManualBox","manualTextarea","setManualTextarea","manualPlayerScoreInput","setManualPlayerScoreInput","manualOpponentScoreInput","setManualOpponentScoreInput","manualPlayerLegsInput","setManualPlayerLegsInput","manualOpponentLegsInput","setManualOpponentLegsInput","legOverrideConfirm","setLegOverrideConfirm","showCameraManager","dartCounts","setDartCounts","awaitingBoardClear","setAwaitingBoardClear","pendingVisitRef","pendingVisitTimerRef","clearPendingVisitTimer","speakAutoVisit","pending","speaker","sayScore","commitPendingVisit","_trigger","visitTotal","preRemaining","doubleAttempts","doubleWindow","highestCheckout","useAudit","finalizePendingVisit","trigger","queuePendingVisit","handler","humanName","aiDisplayName","statsX01","statsCricket","statsShanghai","statsKiller","statsScam","statsFives","statsSevens","activeScoreboardStats","list","playerResolvedLastScore","aiResolvedLastScore","player","singlePlayerScoreboard","matchAvg","allTimeAvg","rest","inactivePlayerName","activePlayerName","activeRemaining","activeLastScore","recordDart","count","resetDartCount","parseManualScoreOverride","parsed","parseManualLegsOverride","cancelPendingAutoVisit","nextScore","safeScore","nextVisitStart","handleManualScoreOverride","applyManualLegOverride","handleManualLegsOverride","handleLegOverrideYes","handleLegOverrideNo","handleKey","event","buttonSizeClass","size","scrollerRef","contentRef","headerBarRef","formatType","setFormatType","formatCount","setFormatCount","formatRef","wins","measure","scroller","content","headerH","availH","availW","rect","currentScale","naturalHeight","naturalWidth","scaleH","scaleW","scaledHeight","overflowing","RO","ro","onAuto","m","startMatch","onFmt","raf","last","tick","now","dt","visitDarts","targetVisit","dart","preRem","postRem","checkout","startNextLeg","nextRemaining","applyDartValue","currentScore","currentVisitDarts","currentVisitSum","currentVisitStart","currentVisitDartsAtDouble","newVisitDarts","postRemaining","attemptsThisVisit","newVisitSum","startedDoubleWindow","stillInDoubleWindow","doubleAttemptsNow","inDoubleWindow","attemptsForVisit","addDartNumeric","rawTotal","visitStart","liveScore","existingDarts","existingSum","hadPartialVisit","checkoutCap","total","matchActions","visitTotalInput","setVisitTotalInput","handleVisitTotalChange","numericOnly","maxAllowed","safe","addVisitTotal","bounded","clearCurrentVisit","onClearRequest","evt","detail","addDpValue","val","isDoubleHit","nextHits","addDpNumeric","addDpManual","parseManualDart","addB27Auto","hit","nd","totalHits","addB27Numeric","resetB27","addCountUpAuto","addHighScoreAuto","addLowScoreAuto","applyCheckout","rem","setRem","setDarts","setAttempts","setSuccesses","addCo170Auto","addCo121Auto","addCoManual","is170","isDouble","resetCo170","resetCo121","addTrebleAuto","cycle","resetTreble","addBaseballAuto","cp","resetBaseball","addGolfAuto","resetGolf","addTttAuto","cell","tryClaimCell","resetTtt","addAmCricketAuto","resetAmCricket","addAtcValue","ATC_ORDER","newHits","addAtcNumeric","addAtcManual","addCricketAuto","copy","addCricketNumeric","addShanghaiAuto","addShanghaiNumeric","addHalveAuto","addHalveNumeric","addHighLowAuto","addHighLowNumeric","parseManualBox","mult","addManual","addManualTextarea","lines","line","replaceLast","replaceLastManual","rewind","handleWinPopupSubmit","winner","legDoublesAtt","legDoublesHit","winnerDarts","bumpGameMode","lockedPremium","freeGames","MatchStartShowcase","premiumGames","ResizableModal","el","GameHeaderBar","disabled","pillCls","cricketClosedAll","CameraView","info","GameScoreboard","MatchControls","first","suggestCheckouts","ResizablePanel","currentThrower","currentRemaining","lastScoreDisplay","dartsThrown","avg3","matchScore","bestLegText","nh","ni","DOUBLE_PRACTICE_ORDER","promptVal","tcell","tgt","TTT_TARGETS","cur","win","it","ids","initStates","ringLabel","safeValue","formatPriceInCurrency","getUserCurrency","createPortal","stage","targetName","currentLegs","player3da","player9da","playerBest","playerWorst","playerPct","ai3da","ai9da","aiBest","aiWorst","aiPct"],"mappings":"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"}
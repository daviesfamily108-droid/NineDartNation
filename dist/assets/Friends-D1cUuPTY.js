import{z as Te,e as Ae,a as oe,g as Fe,b as $e,d as Oe,j as t,A as H}from"./index-mpf8T1Py.js";import{r as i}from"./ui-DygUIHRq.js";import"./vendor-D3F3s8fL.js";const de="ndn:messages:inbox",ce="ndn:messages:unread",me="ndn:messages:threads";function De(){try{const m=localStorage.getItem(de),l=m?JSON.parse(m):[],s=Number(localStorage.getItem(ce)||"0")||0,r=localStorage.getItem(me),o=r?JSON.parse(r):{};return{inbox:Array.isArray(l)?l.filter(g=>g&&typeof g.id=="string").slice(0,200):[],unread:s,threads:o&&typeof o=="object"?o:{}}}catch{return{inbox:[],unread:0,threads:{}}}}function A(m,l,s){try{localStorage.setItem(de,JSON.stringify(m))}catch{}try{localStorage.setItem(ce,String(l))}catch{}if(s)try{localStorage.setItem(me,JSON.stringify(s))}catch{}}const z=De(),Me=Te((m,l)=>({inbox:z.inbox,unread:z.unread,threads:z.threads,inGame:!1,setInGame:s=>m({inGame:s}),add:s=>m(r=>{const o=r.inbox.some(g=>g.id===s.id&&g.ts===s.ts),x=o?r.inbox:[s,...r.inbox].slice(0,200),f=r.unread+(o?0:1);return A(x,f,r.threads),{inbox:x,unread:f}}),load:s=>m(r=>{const o=[...s].sort((x,f)=>f.ts-x.ts).slice(0,200);return A(o,r.unread,r.threads),{inbox:o,unread:r.unread}}),loadThread:(s,r)=>m(o=>{const x=String(s||"").toLowerCase();if(!x)return o;const f=[...r].sort((w,y)=>w.ts-y.ts).slice(-400),g={...o.threads,[x]:{other:x,messages:f}};return A(o.inbox,o.unread,g),{threads:g}}),markAllRead:()=>{const s=l();A(s.inbox,0,s.threads),m({unread:0})},pushThread:(s,r)=>m(o=>{const x=String(s||"").toLowerCase();if(!x)return o;const g=[...o.threads[x]?.messages||[],r].sort((y,F)=>y.ts-F.ts).slice(-400),w={...o.threads,[x]:{other:x,messages:g}};return A(o.inbox,o.unread,w),{threads:w}}),remove:s=>m(r=>{const o=r.inbox.filter(f=>f.id!==s),x=r.unread;return A(o,x,r.threads),{inbox:o,unread:x}})})),We=[/\b(f+[\W_]*u+[\W_]*c+[\W_]*k+)\b/gi,/\b(s+[\W_]*h+[\W_]*i+[\W_]*t+)\b/gi,/\b(b+[\W_]*i+[\W_]*t+[\W_]*c+[\W_]*h+)\b/gi,/\b(a+[\W_]*s+[\W_]*s+[\W_]*h+[\W_]*o+[\W_]*l+[\W_]*e+)\b/gi,/\b(d+[\W_]*a+[\W_]*m+[\W_]*n+)\b/gi,/\b(c+[\W_]*r+[\W_]*a+[\W_]*p+)\b/gi,/\b(p+[\W_]*i+[\W_]*s+[\W_]*s+)\b/gi];function Ee(m){return m.replace(/[\p{L}\p{N}]/gu,"*")}function Re(m){if(!m)return m;let l=m;for(const s of We)l=l.replace(s,r=>Ee(r));return l}function Ie(m){if(!m)return"";const l=Math.floor((Date.now()-m)/1e3);if(l<60)return`${l}s ago`;const s=Math.floor(l/60);if(s<60)return`${s}m ago`;const r=Math.floor(s/60);return r<24?`${r}h ago`:`${Math.floor(r/24)}d ago`}function Ue({user:m}){const l=Ae(),s=String(m?.email||"").toLowerCase(),[r,o]=i.useState([]),[x,f]=i.useState([]),[g,w]=i.useState([]),[y,F]=i.useState(""),[p,xe]=i.useState("all"),[S,$]=i.useState(!1),b=Me(),[j,he]=i.useState(null),[K,V]=i.useState(""),Y=i.useRef(null),[I,ue]=i.useState([]),[Q,ge]=i.useState([]),[L,X]=i.useState({show:!1}),[n,O]=i.useState(null),[h,_]=i.useState(null),[Z,D]=i.useState(null),[C,M]=i.useState("profile"),q=i.useCallback(async e=>{const a=String(e||"").toLowerCase();if(!(!s||!a||a===s))try{const u=await(await fetch(`/api/friends/thread?email=${encodeURIComponent(s)}&other=${encodeURIComponent(a)}`)).json();u?.ok&&Array.isArray(u.thread)&&b.loadThread(a,u.thread)}catch{}},[s,b]),U=i.useMemo(()=>{if(!j?.email)return[];const e=j.email.toLowerCase(),a=b.threads?.[e]?.messages;return Array.isArray(a)&&a.length?a:b.inbox.filter(d=>String(d.from||"").toLowerCase()===e).slice().sort((d,u)=>d.ts-u.ts)},[j?.email,b.inbox,b.threads]),be=i.useMemo(()=>{const e=new Map;for(const a of b.inbox){const d=String(a.from||"").toLowerCase(),u=e.get(d);(!u||a.ts>u.ts)&&e.set(d,{ts:a.ts,message:a.message})}return e},[b.inbox]),fe=i.useMemo(()=>{const e=new Map,a=1e3*60*60*24*3,d=Date.now()-a;for(const u of b.inbox){if((u.ts||0)<d)continue;const v=String(u.from||"").toLowerCase();e.set(v,(e.get(v)||0)+1)}return e},[b.inbox]);async function k(){if(s)try{const[e,a,d,u]=await Promise.all([fetch(`/api/friends/list?email=${encodeURIComponent(s)}`).then(v=>v.json()),fetch(`/api/friends/suggested?email=${encodeURIComponent(s)}`).then(v=>v.json()),fetch(`/api/friends/requests?email=${encodeURIComponent(s)}`).then(v=>v.json()),fetch(`/api/friends/outgoing?email=${encodeURIComponent(s)}`).then(v=>v.json())]);o(e.friends||[]),f(a.suggestions||[]),ue(d.requests||[]),ge(u.requests||[])}catch{}}i.useEffect(()=>{k()},[s]),i.useEffect(()=>{s&&fetch(`/api/friends/messages?email=${encodeURIComponent(s)}`).then(e=>e.json()).then(e=>{e?.ok&&Array.isArray(e.messages)&&b.load(e.messages)}).catch(()=>{})},[s]),i.useEffect(()=>{j?.email&&q(j.email)},[j?.email,q]),i.useEffect(()=>{if(!j)return;const e=Y.current;e&&(e.scrollTop=e.scrollHeight)},[j?.email,U.length]);async function pe(e){if(F(e),!e){w([]);return}try{const d=await(await fetch(`/api/friends/search?q=${encodeURIComponent(e)}&email=${encodeURIComponent(s)}`)).json();w(d.results||[])}catch{}}i.useEffect(()=>{if(!n){_(null),D(null);return}const e=n.username||"";n.avatar?D(n.avatar):e&&oe(`/api/user/avatar/${encodeURIComponent(e)}`).then(a=>a.json()).then(a=>D(a.avatar||null)).catch(()=>D(null)),e&&oe(`/api/user/stats/public/${encodeURIComponent(e)}`).then(a=>a.json()).then(a=>_(a.stats||null)).catch(()=>_(null))},[n?.email]),i.useEffect(()=>{n&&C==="chat"&&(he({email:n.email,username:n.username}),q(n.email))},[n?.email,C]);async function ee(e){if(!(!s||!e)){$(!0);try{await fetch("/api/friends/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:e})}),await k(),F(""),w([]),l("Friend request sent",{type:"success"})}finally{$(!1)}}}async function je(e){if(!(!s||!e)){$(!0);try{await fetch("/api/friends/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:e})}),await k(),l("Friend removed",{type:"info"})}finally{$(!1)}}}async function te(e){try{await fetch("/api/friends/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requestId:e})}),await k(),l("Friend request accepted",{type:"success"})}catch{}}async function ve(e){try{await fetch("/api/friends/decline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requestId:e})}),await k(),l("Friend request declined",{type:"info"})}catch{}}async function Ne(e){try{await fetch("/api/friends/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requestId:e})}),await k(),l("Friend request cancelled",{type:"info"})}catch{}}async function we(){const a=document.getElementById("message-input")?.value;if(!(!a||!L.toEmail))try{await fetch("/api/friends/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:L.toEmail,message:a})}),X({show:!1}),l("Message sent",{type:"success"})}catch{}}async function se(){if(!s||!j?.email)return;const e=K.trim();if(e)try{await fetch("/api/friends/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:j.email,message:e})});const a=Date.now(),d=`${a}-${Math.random().toString(36).slice(2,8)}`;b.pushThread(j.email,{id:d,from:s,to:String(j.email).toLowerCase(),message:e,ts:a,readBy:[s]}),V(""),l("Message sent",{type:"success"})}catch{l("Failed to send message",{type:"error"})}}const P=i.useMemo(()=>p==="all"?r:r.filter(e=>(e.status||"offline")===p),[r,p]),J=i.useMemo(()=>{const e={online:0,ingame:0,offline:0};for(const a of r)a.status==="online"?e.online+=1:a.status==="ingame"?e.ingame+=1:e.offline+=1;return e},[r]);async function ae(e){if(!e){l("Room unavailable",{type:"error"});return}try{const a=new CustomEvent("ndn:spectate-request",{detail:{roomId:e}});window.dispatchEvent(a),l("Opening spectator view...",{type:"info"})}catch{}}const ne=I.length+Q.length,G=m?.username||"Player 1",B=Fe(G),ye=$e(G),re=Oe(G),Se=Object.values(re).reduce((e,a)=>e+(a.played||0),0),Ce=Object.values(re).reduce((e,a)=>e+(a.won||0),0);function ke(e){O(e),M("profile")}function W(e){return e==="online"?"bg-emerald-400":e==="ingame"?"bg-amber-400":"bg-slate-500"}function E(e){return e==="online"?"Online":e==="ingame"?"In-Game":"Offline"}function R(e){return e==="online"?"text-emerald-400":e==="ingame"?"text-amber-400":"text-slate-500"}return t.jsxs("div",{className:"card ndn-game-shell ndn-page",children:[t.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2 ndn-section-title",children:"Friends ðŸ‘¥"}),t.jsx("p",{className:"mb-2 text-brand-600",children:"Manage your friends. See who's online, in-game, or offline; find new teammates; and invite people to play."}),t.jsx("div",{className:"grid gap-3 mb-4 grid-cols-2 sm:grid-cols-5",children:[{key:"all",label:"All",value:r.length,accent:"bg-white/5 border-white/20",activeAccent:"bg-indigo-500/20 border-indigo-500/50 ring-2 ring-indigo-500/30"},{key:"online",label:"Online",value:J.online,accent:"bg-emerald-500/10 border-emerald-500/40",activeAccent:"bg-emerald-500/20 border-emerald-500/60 ring-2 ring-emerald-500/30"},{key:"ingame",label:"In-Game",value:J.ingame,accent:"bg-amber-500/10 border-amber-500/40",activeAccent:"bg-amber-500/20 border-amber-500/60 ring-2 ring-amber-500/30"},{key:"offline",label:"Offline",value:J.offline,accent:"bg-slate-500/10 border-slate-500/40",activeAccent:"bg-slate-500/20 border-slate-500/60 ring-2 ring-slate-500/30"},{key:"requests",label:"Requests",value:ne,accent:"bg-indigo-500/10 border-indigo-500/40",activeAccent:"bg-indigo-500/20 border-indigo-500/60 ring-2 ring-indigo-500/30"}].map(e=>t.jsxs("button",{type:"button",onClick:()=>{xe(e.key),O(null)},className:`rounded-2xl border px-3 py-2 text-center cursor-pointer transition-all ${p===e.key?e.activeAccent:e.accent} hover:scale-[1.02] active:scale-[0.98]`,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:e.label}),t.jsx("div",{className:"text-2xl font-semibold text-white",children:e.value})]},e.key))}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-3 mb-4",children:[t.jsxs("div",{className:`${n?"hidden lg:block":"block"} lg:col-span-2 space-y-3`,children:[(p==="requests"||p==="all")&&ne>0&&t.jsxs("div",{className:"p-4 rounded-[28px] bg-gradient-to-br from-slate-900/80 to-indigo-900/60 border border-white/10 shadow-2xl",children:[t.jsx("div",{className:"font-semibold text-white/90 mb-2",children:"Friend Requests"}),t.jsxs("ul",{className:"space-y-3",children:[I.map(e=>t.jsxs("li",{className:"p-3 rounded-2xl border border-white/10 bg-slate-900/40 flex flex-col gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-semibold text-lg",children:e.fromUsername||e.fromEmail||"Unknown User"}),t.jsx("span",{className:"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded",children:"Incoming"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>te(e.id),className:"px-3 py-1 rounded-lg bg-emerald-500/20 text-emerald-400 text-xs font-bold hover:bg-emerald-500/30 transition-colors",children:"Accept âœ…"}),t.jsx("button",{onClick:()=>ve(e.id),className:"px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 text-xs font-bold hover:bg-rose-500/30 transition-colors",children:"Decline âŒ"})]})]},`incoming-${e.id||e.fromEmail}`)),Q.map(e=>t.jsxs("li",{className:"p-3 rounded-2xl border border-white/10 bg-slate-900/40 flex flex-col gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-semibold text-lg",children:e.toUsername||e.toEmail||"Unknown User"}),t.jsx("div",{className:"px-3 py-1 rounded-lg bg-white/5 text-white/40 text-xs font-bold",children:"Pending â³"})]}),t.jsx("button",{onClick:()=>Ne(e.id),className:"px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 text-xs font-bold hover:bg-rose-500/30 transition-colors w-fit",children:"Cancel âœ–ï¸"})]},`outgoing-${e.id||e.toEmail}`))]})]}),p!=="requests"&&t.jsxs("div",{className:"p-4 rounded-[28px] bg-gradient-to-br from-slate-900/80 to-indigo-900/60 border border-white/10 shadow-2xl",children:[t.jsx("div",{className:"font-semibold text-white/90 mb-3 flex items-center justify-between",children:t.jsxs("span",{children:[p==="all"?"All Friends":p==="online"?"Online Friends":p==="ingame"?"In-Game Friends":"Offline Friends"," ","(",P.length,")"]})}),P.length===0?t.jsx("div",{className:"text-sm text-slate-400 py-6 text-center",children:r.length===0?"No friends yet. Search below to add some!":`No ${p==="all"?"":p+" "}friends right now.`}):t.jsx("ul",{className:"space-y-2 max-h-[50vh] overflow-auto",children:P.map(e=>{const a=be.get(e.email.toLowerCase()),d=fe.get(e.email.toLowerCase())||0,u=n?.email===e.email;return t.jsx("li",{children:t.jsx("button",{type:"button",onClick:()=>ke(e),className:`w-full text-left p-3 rounded-2xl border transition-all cursor-pointer ${u?"border-indigo-500/60 bg-indigo-500/15 ring-1 ring-indigo-500/30":"border-white/10 bg-slate-900/40 hover:bg-slate-800/60 hover:border-white/20"}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"relative shrink-0",children:[e.avatar?t.jsx("img",{src:e.avatar,alt:"",className:"w-11 h-11 rounded-full object-cover border-2 border-white/20"}):t.jsx("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",children:(e.username||e.email||"?")[0].toUpperCase()}),t.jsx("span",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${W(e.status)}`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-semibold text-white truncate",children:e.username||e.email}),d>0&&t.jsx("span",{className:"shrink-0 bg-indigo-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center",children:d>9?"9+":d})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.jsx("span",{className:R(e.status),children:E(e.status)}),e.status==="ingame"&&e.match&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-slate-600",children:"â€¢"}),t.jsxs("span",{className:"text-amber-300 truncate",children:[e.match.game," ",H(e.match.mode)," ",e.match.value]})]}),e.threeDartAvg?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-slate-600",children:"â€¢"}),t.jsxs("span",{className:"text-indigo-300",children:["3DA: ",e.threeDartAvg.toFixed(1)]})]}):null]}),a&&t.jsx("div",{className:"text-[11px] text-slate-400 mt-0.5 truncate",children:a.message})]}),t.jsx("div",{className:"text-slate-500 shrink-0",children:"â€º"})]})})},e.email)})})]})]}),t.jsx("div",{className:`${n?"block":"hidden lg:block"} lg:col-span-3`,children:n?t.jsxs("div",{className:"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-2xl",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("button",{className:"lg:hidden px-3 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/80 text-xs font-bold",onClick:()=>O(null),children:"â† Back"}),t.jsxs("div",{className:"relative shrink-0",children:[Z||n.avatar?t.jsx("img",{src:Z||n.avatar||"",alt:"",className:"w-14 h-14 rounded-full object-cover border-2 border-white/20"}):t.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg border-2 border-white/20",children:(n.username||n.email||"?")[0].toUpperCase()}),t.jsx("span",{className:`absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-slate-950 ${W(n.status)}`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-bold text-lg text-white truncate",children:n.username||n.email}),t.jsxs("div",{className:`text-sm ${R(n.status)}`,children:[E(n.status),n.status==="ingame"&&n.match&&t.jsxs("span",{className:"text-amber-300 ml-2",children:["â€” ",n.match.game," ",H(n.match.mode)," ",n.match.value]}),n.status==="offline"&&n.lastSeen?t.jsxs("span",{className:"text-slate-500 ml-2",children:["â€” last seen ",Ie(n.lastSeen)]}):null]})]})]}),t.jsx("div",{className:"flex gap-1 mb-4 rounded-xl bg-white/5 p-1",children:["profile","chat","compare"].map(e=>t.jsx("button",{type:"button",onClick:()=>M(e),className:`flex-1 py-2 rounded-lg text-sm font-semibold transition-colors ${C===e?"bg-indigo-600 text-white":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:e==="profile"?"Profile":e==="chat"?"Chat ðŸ’¬":"Compare ðŸ“Š"},e))}),C==="profile"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-lg font-bold text-indigo-300",children:n.threeDartAvg?n.threeDartAvg.toFixed(1):h?.allTime&&h.allTime.darts?(h.allTime.scored/h.allTime.darts*3).toFixed(1):"â€”"}),t.jsx("div",{className:"text-[10px] text-slate-400",children:"3-Dart Avg"})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-lg font-bold text-yellow-300",children:h?.allTime?.num180s??"â€”"}),t.jsx("div",{className:"text-[10px] text-slate-400",children:"180s"})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-lg font-bold text-orange-300",children:h?.allTime?.bestCheckout??"â€”"}),t.jsx("div",{className:"text-[10px] text-slate-400",children:"High Checkout"})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-lg font-bold text-rose-300",children:h?.allTime?.bestLegDarts??"â€”"}),t.jsx("div",{className:"text-[10px] text-slate-400",children:"Best Leg"})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{onClick:()=>M("chat"),className:"px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold transition-colors",children:"ðŸ’¬ Message"}),n.status==="ingame"&&n.roomId&&t.jsx("button",{onClick:()=>ae(n.roomId),className:"px-4 py-2 rounded-xl bg-amber-600 hover:bg-amber-500 text-white text-sm font-bold transition-colors",children:"ðŸ‘ï¸ Spectate"}),t.jsx("button",{onClick:()=>M("compare"),className:"px-4 py-2 rounded-xl bg-blue-600/80 hover:bg-blue-500 text-white text-sm font-bold transition-colors",children:"ðŸ“Š Compare Stats"}),t.jsx("button",{onClick:()=>{confirm(`Remove ${n.username||n.email} from friends?`)&&(je(n.email),O(null))},className:"px-4 py-2 rounded-xl bg-rose-500/20 hover:bg-rose-500/30 text-rose-400 text-sm font-bold transition-colors",children:"âœ– Remove"})]}),n.status==="ingame"&&n.match&&t.jsxs("div",{className:"rounded-xl border border-amber-500/30 bg-amber-500/10 p-3",children:[t.jsx("div",{className:"text-sm font-semibold text-amber-300 mb-1",children:"Currently Playing"}),t.jsxs("div",{className:"text-white font-bold",children:[n.match.game," ",H(n.match.mode)," ",n.match.value]}),n.roomId&&t.jsx("button",{onClick:()=>ae(n.roomId),className:"mt-2 px-4 py-1.5 rounded-lg bg-amber-600 hover:bg-amber-500 text-white text-xs font-bold transition-colors",children:"Watch Live ðŸ‘ï¸"})]})]}),C==="chat"&&t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{ref:Y,className:"flex-1 min-h-[260px] max-h-[55vh] overflow-auto rounded-2xl border border-white/10 bg-black/20 p-3",children:U.length===0?t.jsx("div",{className:"text-sm text-slate-400 p-3",children:"No messages yet. Say hi ðŸ‘‹"}):t.jsx("ul",{className:"space-y-2",children:U.map(e=>{const a=String(e.from||"").toLowerCase()===s;return t.jsx("li",{className:a?"flex justify-end":"flex",children:t.jsxs("div",{className:a?"max-w-[95%] rounded-2xl bg-indigo-600/80 border border-indigo-300/20 px-3 py-2":"max-w-[95%] rounded-2xl bg-slate-900/60 border border-white/10 px-3 py-2",children:[t.jsxs("div",{className:"text-[10px] text-slate-300/80 mb-1 flex items-center justify-between gap-2",children:[t.jsx("span",{className:"font-bold",children:a?"You":n.username||n.email}),t.jsx("span",{className:"shrink-0",children:new Date(e.ts).toLocaleString()})]}),t.jsx("div",{className:"text-sm whitespace-pre-wrap break-words text-white/90",children:Re(e.message)}),!a&&t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("button",{onClick:()=>b.remove(e.id),className:"px-3 py-1 rounded-lg bg-rose-500/15 text-rose-300 text-[11px] font-bold hover:bg-rose-500/25 transition-colors",children:"Delete ðŸ—‘ï¸"}),t.jsx("button",{className:"px-3 py-1 rounded-lg bg-rose-500/15 text-rose-300 text-[11px] font-bold hover:bg-rose-500/25 transition-colors",onClick:async()=>{const d=prompt("Report reason (what happened)?");if(d)try{await fetch("/api/friends/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reporterEmail:s,offenderEmail:e.from,reason:d,messageId:e.id})}),l("Report sent to admin",{type:"info"})}catch{}},children:"Report"})]})]})},e.id)})})}),t.jsxs("div",{className:"mt-3 rounded-2xl border border-white/10 bg-slate-900/30 p-3",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("textarea",{className:"w-full min-h-[44px] max-h-40 bg-slate-700/60 border border-slate-600 rounded-xl px-3 py-2 text-white placeholder-slate-400 resize-y",placeholder:`Message ${n.username||"friend"}...`,value:K,onChange:e=>V(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),se())}}),t.jsx("button",{onClick:se,className:"px-5 py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-colors",children:"Send"})]}),t.jsx("div",{className:"mt-2 text-[11px] text-slate-400",children:"Tip: Press Enter to send, Shift+Enter for a new line."})]})]}),C==="compare"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-sm text-slate-400 mb-2",children:["Head-to-head comparison between you and"," ",n.username||"friend"]}),(()=>{const e=h?.allTime?.darts?h.allTime.scored/h.allTime.darts*3:n.threeDartAvg||0,a=h?.allTime?.num180s??0,d=h?.allTime?.bestCheckout??0,u=h?.allTime?.bestLegDarts??0,v=[{label:"3-Dart Average",mine:ye,theirs:e,format:c=>c?c.toFixed(1):"â€”",higher:!0},{label:"180s",mine:B.num180s||0,theirs:a,format:c=>String(c||"â€”"),higher:!0},{label:"Highest Checkout",mine:B.bestCheckout||0,theirs:d,format:c=>String(c||"â€”"),higher:!0},{label:"Best Leg (darts)",mine:B.bestLegDarts||0,theirs:u,format:c=>String(c||"â€”"),higher:!1},{label:"Games Played",mine:Se,theirs:h?.gameModes?Object.values(h.gameModes).reduce((c,N)=>c+(N.played||0),0):0,format:c=>String(c||"â€”"),higher:!0},{label:"Wins",mine:Ce,theirs:h?.gameModes?Object.values(h.gameModes).reduce((c,N)=>c+(N.won||0),0):0,format:c=>String(c||"â€”"),higher:!0}];return t.jsxs("div",{className:"rounded-xl border border-white/10 overflow-hidden",children:[t.jsxs("div",{className:"grid grid-cols-3 bg-white/5 px-4 py-2 text-xs font-bold text-slate-400 uppercase tracking-wide",children:[t.jsx("div",{children:"You"}),t.jsx("div",{className:"text-center",children:"Stat"}),t.jsx("div",{className:"text-right",children:n.username||"Friend"})]}),v.map(c=>{const N=Number(c.mine)||0,T=Number(c.theirs)||0,ie=c.higher?N>T:N>0&&N<T,le=c.higher?T>N:T>0&&T<N;return t.jsxs("div",{className:"grid grid-cols-3 px-4 py-3 border-t border-white/5 items-center",children:[t.jsxs("div",{className:`font-bold text-sm ${ie?"text-emerald-400":"text-white"}`,children:[c.format(N),ie&&t.jsx("span",{className:"ml-1 text-[10px]",children:"ðŸ†"})]}),t.jsx("div",{className:"text-center text-xs text-slate-400 font-medium",children:c.label}),t.jsxs("div",{className:`text-right font-bold text-sm ${le?"text-emerald-400":"text-white"}`,children:[c.format(T),le&&t.jsx("span",{className:"ml-1 text-[10px]",children:"ðŸ†"})]})]},c.label)})]})})(),!h&&t.jsxs("div",{className:"text-center text-sm text-slate-500 py-3",children:["No stats available for"," ",n.username||"this player"," yet."]})]})]}):t.jsxs("div",{className:"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-2xl hidden lg:flex flex-col items-center justify-center min-h-[400px] text-center gap-3",children:[t.jsx("div",{className:"text-4xl",children:"ðŸ‘†"}),t.jsx("div",{className:"text-lg font-semibold text-white/90",children:"Select a friend"}),t.jsx("div",{className:"text-sm text-slate-400 max-w-sm",children:"Click on a friend from the list to view their profile, send messages, compare stats, or spectate their game."})]})})]}),t.jsxs("div",{className:"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-xl",children:[t.jsx("div",{className:"font-semibold mb-2 text-white/90",children:"Find Friends"}),t.jsx("input",{className:"input w-full mb-2",placeholder:"Search by name or email",value:y,onChange:e=>pe(e.target.value)}),t.jsxs("ul",{className:"space-y-2 mb-3 max-h-[320px] overflow-auto",children:[g.map(e=>t.jsxs("li",{className:"flex items-center gap-3 p-3 rounded-2xl border border-white/10 bg-slate-900/40",children:[t.jsxs("div",{className:"relative shrink-0",children:[e.avatar?t.jsx("img",{src:e.avatar,alt:"",className:"w-10 h-10 rounded-full object-cover border-2 border-white/20"}):t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",children:(e.username||e.email||"?")[0].toUpperCase()}),t.jsx("span",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${W(e.status)}`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold text-white truncate",children:e.username||e.email}),t.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2",children:[t.jsxs("span",{children:["3DA:"," ",t.jsx("span",{className:"text-indigo-300 font-semibold",children:e.threeDartAvg?e.threeDartAvg.toFixed(1):"â€”"})]}),t.jsx("span",{className:"text-slate-600",children:"â€¢"}),t.jsx("span",{className:R(e.status),children:E(e.status)})]})]}),t.jsx("div",{className:"shrink-0",children:e.relationship==="friend"?t.jsx("span",{className:"px-3 py-1.5 rounded-xl bg-emerald-500/20 text-emerald-400 text-xs font-bold",children:"Friends âœ“"}):e.relationship==="pending-outgoing"?t.jsx("span",{className:"px-3 py-1.5 rounded-xl bg-white/5 text-white/40 text-xs font-bold",children:"Pending â³"}):e.relationship==="pending-incoming"?t.jsx("button",{onClick:()=>{const a=I.find(d=>d.fromEmail.toLowerCase()===e.email.toLowerCase());a&&te(a.id)},className:"px-3 py-1.5 rounded-xl bg-emerald-500/20 text-emerald-400 text-xs font-bold hover:bg-emerald-500/30 transition-colors",children:"Accept âœ…"}):t.jsx("button",{onClick:()=>ee(e.email),disabled:S,className:`px-3 py-1.5 rounded-xl text-white text-xs font-bold transition-colors ${S?"bg-indigo-900/40 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:S?"Workingâ€¦":"Add âž•"})})]},e.email)),g.length===0&&y&&t.jsxs("li",{className:"text-sm text-slate-400 text-center py-4",children:['No accounts found for "',y,'"']}),g.length===0&&!y&&t.jsx("li",{className:"text-xs opacity-60",children:"Type to search..."})]}),t.jsx("div",{className:"font-semibold mb-1 text-white/90",children:"Suggested"}),t.jsxs("ul",{className:"space-y-2 max-h-[280px] overflow-auto",children:[x.map(e=>t.jsxs("li",{className:"flex items-center gap-3 p-3 rounded-2xl border border-white/10 bg-slate-900/40",children:[t.jsxs("div",{className:"relative shrink-0",children:[e.avatar?t.jsx("img",{src:e.avatar,alt:"",className:"w-10 h-10 rounded-full object-cover border-2 border-white/20"}):t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",children:(e.username||e.email||"?")[0].toUpperCase()}),t.jsx("span",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${W(e.status)}`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold text-white truncate",children:e.username||e.email}),t.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2",children:[t.jsxs("span",{children:["3DA:"," ",t.jsx("span",{className:"text-indigo-300 font-semibold",children:e.threeDartAvg?e.threeDartAvg.toFixed(1):"â€”"})]}),t.jsx("span",{className:"text-slate-600",children:"â€¢"}),t.jsx("span",{className:R(e.status),children:E(e.status)})]})]}),t.jsx("button",{onClick:()=>ee(e.email),disabled:S,className:`shrink-0 px-3 py-1.5 rounded-xl text-white text-xs font-bold transition-colors ${S?"bg-indigo-900/40 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:S?"Workingâ€¦":"Add âž•"})]},e.email)),x.length===0&&t.jsx("li",{className:"text-xs opacity-60",children:"No suggestions right now."})]})]}),L.show&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4",children:[t.jsx("div",{className:"text-center mb-4",children:t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Send Message âœ‰ï¸"})}),t.jsx("textarea",{className:"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none",placeholder:"Type your message here...",id:"message-input",autoFocus:!0}),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsx("button",{onClick:we,className:"px-6 py-2 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-colors",children:"Send Message ðŸ“¤"}),t.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700",onClick:()=>X({show:!1}),children:"Cancel"})]})]})})]})}export{Ue as default};
//# sourceMappingURL=Friends-D1cUuPTY.js.map

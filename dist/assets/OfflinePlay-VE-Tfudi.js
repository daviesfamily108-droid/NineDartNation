import{b as Ti,u as Ei,i as Ri,e as Pi,k as Ii,l as Hi,m as xn,n as St,o as bn,p as is,j as e,M as Bi,r as oa,q as pn,t as ca,R as Je,P as Vi,C as L,G as et,v as Fi,w as Ui,h as Oi,x as _i,y as Ki}from"./index-DunMGvSC.js";import{r}from"./ui-DygUIHRq.js";import{S as $i}from"./ScoreNumberPad-LETLfLZD.js";import{f as Wi}from"./stats-X3jz_E9o.js";import"./vendor-D3F3s8fL.js";const gn=[...Array.from({length:20},(n,i)=>({label:`D${i+1}`,score:(i+1)*2})),{label:"DBULL",score:50,isBull:!0}];function da(n,i){const o=gn[i];return!!o&&n===o.score}function Ct(n){const i=n.trim().toUpperCase();if(!i)return null;if(i==="50"||i==="BULL"||i==="DBULL"||i==="IBULL")return 50;if(i==="25"||i==="OBULL")return 25;const o=i.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!o)return null;const m=o[1]||"S",c=parseInt(o[2],10);return c<1||c>20?null:c*(m==="S"?1:m==="D"?2:3)}const kt=[...Array.from({length:20},(n,i)=>i+1),25,50],Gi=[20,19,18,17,16,15,25];function ua(){const n={};return Gi.forEach(i=>{n[i]=0}),{marks:n,points:0}}function zi(n,i,o,m,c=()=>!1){let u=null,x=0;if(o==="BULL"||o==="INNER_BULL"||i===25||i===50)u=25,x=o==="INNER_BULL"||i===50?2:1;else if(typeof m=="number"&&m>=15&&m<=20)u=m,o==="TRIPLE"?x=3:o==="DOUBLE"?x=2:x=1;else if(i){const _=[20,19,18,17,16,15];for(const K of _){if(i===K){u=K,x=1;break}if(i===K*2){u=K,x=2;break}if(i===K*3){u=K,x=3;break}}!u&&(i===25||i===50)&&(u=25,x=i===50?2:1)}if(!u)return 0;const I=n.marks[u],ge=Math.max(0,3-I),te=Math.min(ge,x),N=Math.max(0,x-te),ue=I+te;n.marks[u]=ue>3?3:ue;let B=0;return N>0&&!c(u)&&(u===25?o==="INNER_BULL"?B+=50*N:B+=25*N:B+=u*N),n.points+=B,B}function ma(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function Xi(n){return n.round}function Yi(n,i,o,m){if(n.finished)return 0;const c=Xi(n);let u=0;return typeof m=="number"&&m===c?o==="TRIPLE"?(u=c*3,n.turnHits.triples++):o==="DOUBLE"?(u=c*2,n.turnHits.doubles++):o==="SINGLE"&&(u=c*1,n.turnHits.singles++):!m&&(i===c||i===c*2||i===c*3)&&(i===c*3?(u=c*3,n.turnHits.triples++):i===c*2?(u=c*2,n.turnHits.doubles++):i===c&&(u=c,n.turnHits.singles++)),n.score+=u,u}function qi(n){if(!n.finished){if(n.turnHits.singles>0&&n.turnHits.doubles>0&&n.turnHits.triples>0){n.shanghaiAchieved=!0,n.finished=!0;return}const i=n.round+1;i>20?n.finished=!0:n.round=i}n.turnHits={singles:0,doubles:0,triples:0}}function ha(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function Qi(n){return n.targets[n.stage]||null}function Zi(n,i,o,m){if(n.finished)return 0;const c=Qi(n);if(!c)return 0;let u=0;switch(c.kind){case"NUMBER":{typeof m=="number"&&m===c.num?o==="TRIPLE"?u=c.num*3:o==="DOUBLE"?u=c.num*2:o==="SINGLE"&&(u=c.num):!m&&(i===c.num||i===c.num*2||i===c.num*3)&&(u=i),u>0&&(n.hitThisRound=!0);break}case"DOUBLE":{(o==="DOUBLE"&&m===c.num||i===c.num*2)&&(u=c.num*2,n.hitThisRound=!0);break}case"TRIPLE":{(o==="TRIPLE"&&m===c.num||i===c.num*3)&&(u=c.num*3,n.hitThisRound=!0);break}case"BULL":{(o==="BULL"||o==="INNER_BULL"||i===25||i===50)&&(u=o==="INNER_BULL"||i===50?50:25,n.hitThisRound=!0);break}case"ANY_NUMBER":{i>0&&(u=i,n.hitThisRound=!0);break}}return n.score+=u,u}function Ji(n){n.finished||(n.hitThisRound||(n.score=Math.floor(n.score/2)),n.hitThisRound=!1,n.stage+=1,n.stage>=n.targets.length&&(n.finished=!0))}function fa(){return{round:1,score:0,target:"HIGH",finished:!1}}function el(n,i,o,m){if(n.finished)return 0;let c=0;if(n.target==="HIGH")if(o==="INNER_BULL")c=50;else if(typeof m=="number"){const x=m*(o==="TRIPLE"?3:o==="DOUBLE"?2:1);m>=20&&(c=x)}else i>=40&&(c=i);else if(typeof m=="number"){const x=m*(o==="TRIPLE"?3:o==="DOUBLE"?2:1);m<=10&&(c=x)}else i>0&&i<=30&&(c=i);return n.score+=c,c}function tl(n){if(!n.finished){if(n.round+=1,n.round>10){n.finished=!0;return}n.target=n.target==="HIGH"?"LOW":"HIGH"}}function sl(n,i=3){return{number:n,lives:i,isKiller:!1,eliminated:!1}}function nl(n){const i=Array.from({length:20},(m,c)=>c+1),o={};for(const m of n){const c=Math.floor(Math.random()*i.length),u=i.splice(c,1)[0];o[m]=u}return o}function xa(n,i,o,m){const c=i[n];if(!c||!m||!o)return{becameKiller:!1};if(!c.isKiller&&o==="DOUBLE"&&m===c.number)return c.isKiller=!0,{becameKiller:!0};if(c.isKiller&&(o==="DOUBLE"||o==="TRIPLE")){const u=Object.keys(i).find(x=>x!==n&&!i[x].eliminated&&i[x].number===m);if(u){const x=i[u],I=o==="TRIPLE"?2:1;return x.lives=Math.max(0,x.lives-I),x.lives===0&&(x.eliminated=!0),{becameKiller:!1,victimId:u,livesRemoved:I}}}return{becameKiller:!1}}function ba(n){const i=Object.entries(n).filter(([,o])=>!o.eliminated&&o.lives>0);return i.length===1?i[0][0]:null}function pa(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function rl(n,i,o,m){if(n.finished)return 0;let c=0;if(typeof m=="number"&&m===n.inning?o==="TRIPLE"?c=3:o==="DOUBLE"?c=2:c=1:!m&&(i===n.inning||i===n.inning*2||i===n.inning*3)&&(c=i===n.inning*3?3:i===n.inning*2?2:1),n.score+=c,n.dartsThisInning+=1,n.dartsThisInning>=3){const u=n.inning+1;u>9?n.finished=!0:(n.inning=u,n.dartsThisInning=0)}return c}const al={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function ga(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function il(n,i,o,m){if(n.finished)return!1;const c=al[n.hole];if(n.dartsThisHole+=1,typeof m=="number"&&m===c&&(o==="SINGLE"||o==="DOUBLE"||o==="TRIPLE")||!m&&(i===c||i===c*2||i===c*3)){n.strokes+=n.dartsThisHole;const x=n.hole+1;return x>18?n.finished=!0:(n.hole=x,n.dartsThisHole=0),!0}if(n.dartsThisHole>=3){n.strokes+=3;const x=n.hole+1;x>18?n.finished=!0:(n.hole=x,n.dartsThisHole=0)}return!1}const ka={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function va(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function ll(n){const i=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[o,m,c]of i)if(n[o]&&n[o]===n[m]&&n[o]===n[c])return n[o];return n.every(o=>o)?"Draw":null}function ol(n,i,o,m,c){if(n.finished||n.board[i])return!1;const u=ka[i];let x=!1;if(u.type==="BULL"?x=m==="BULL"||m==="INNER_BULL"||o===25||o===50:u.type==="NUM"&&typeof u.num=="number"&&(typeof c=="number"&&c===u.num||!c&&(o===u.num||o===u.num*2||o===u.num*3))&&(x=!0),!x)return!1;n.board[i]=n.turn;const I=ll(n.board);return I?(n.finished=!0,n.winner=I,!0):(n.turn=n.turn==="X"?"O":"X",!0)}function vn(){return{targetIndex:0,darts:0,finished:!1}}const Da=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25],cl=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","Bull"];function dl(n){return Da[n.targetIndex]}function Nn(n,i,o){if(n.finished)return n;const m=dl(n);if(!(o==="SINGLE"&&i===m||o==="DOUBLE"&&i===m||o==="TRIPLE"&&i===m||o==="INNER_BULL"&&m===25))return n;const u=n.targetIndex+1,x=u>=Da.length;return{targetIndex:u,darts:n.darts+1,finished:x}}function Na(n,i){return Nn(n,i,"SINGLE")}function ul(){return vn()}function jn(n=50){return{score:0,darts:0,finished:!1,target:n}}const ml=[5,10,15,20,25,50];function hl(n){return ml.includes(n)}function yn(n,i,o){if(n.finished)return n;if(!hl(i))return{...n,darts:n.darts+1};const m=n.score+i,c=m>=n.target;return{score:c?n.target:m,darts:n.darts+1,finished:c,target:n.target}}function ja(n,i){return yn(n,i)}function fl(n=50){return jn(n)}function wn(n=70){return{score:0,darts:0,finished:!1,target:n}}const xl=[7,14,21];function bl(n){return xl.includes(n)}function Sn(n,i,o){if(n.finished)return n;if(!bl(i))return{...n,darts:n.darts+1};const m=n.score+i,c=m>=n.target;return{score:c?n.target:m,darts:n.darts+1,finished:c,target:n.target}}function ya(n,i){return Sn(n,i)}function pl(n=70){return wn(n)}const gl=[20,19,18,17,16,15,14,13,12,25];function wa(){const n={};return gl.forEach(i=>{n[i]=0}),{marks:n,points:0}}function vl(n,i,o,m,c=()=>!1){let u=null,x=0;if(o==="BULL"||o==="INNER_BULL"||i===25||i===50)u=25,x=o==="INNER_BULL"||i===50?2:1;else if(typeof m=="number"&&m>=12&&m<=20)u=m,o==="TRIPLE"?x=3:o==="DOUBLE"?x=2:x=1;else if(i){for(const _ of[20,19,18,17,16,15,14,13,12]){if(i===_){u=_,x=1;break}if(i===_*2){u=_,x=2;break}if(i===_*3){u=_,x=3;break}}!u&&(i===25||i===50)&&(u=25,x=i===50?2:1)}if(!u)return 0;const I=n.marks[u],ge=Math.max(0,3-I),te=Math.min(ge,x),N=Math.max(0,x-te),ue=I+te;n.marks[u]=ue>3?3:ue;let B=0;return N>0&&!c(u)&&(u===25?o==="INNER_BULL"?B+=50*N:B+=25*N:B+=u*N),n.points+=B,B}function Y(n){return(i,o)=>{n(i)}}function Nl(n){const{match:i,commitManualVisitTotal:o,endTurn:m}=n;return{addVisit:(c,u=3,x)=>{if(o){o(c);return}try{i.addVisit(c,u,x)}catch{i.addVisit(c,u)}},undoVisit:()=>{i.undoVisit()},nextPlayer:()=>{if(m)try{m(0)}catch{i.nextPlayer()}else i.nextPlayer()},endLeg:c=>{typeof c=="number"?i.endLeg(c):i.endLeg(0)},endGame:()=>{i.endGame()}}}function Pe(n,i,o,m,c,u,x,I,ge,te,N,ue,B,_,K,ls,tt,ve,Ne,se,st,Ie,C,je,Ae,p,He){return r.useMemo(()=>{const S=[];if(n==="X01"){let ne=0,A=0,ye=0;if(ve&&ve.length>0){for(const P of ve)P.dartsThrown&&P.totalScored&&(A+=P.dartsThrown,ye+=P.totalScored);A>0&&(ne=ye/A*3)}const U=(ue??0)>0?I??0:te??null??(u??0);if(S.push({name:"You",isCurrentTurn:!!Ne,legsWon:m||0,score:typeof i=="number"?i:typeof st=="number"?st:0,lastScore:U,avg:ne,checkoutRate:K&&K>0?Math.round((_||0)/K*100):0,bestLeg:ve&&ve.length>0?`${Math.min(...ve.map(P=>P.doubleDarts+(P.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:ne,allTimeAvg:Ti("You")||0}),se&&se!=="None"){const V=(B??0)>0?ge??0:N??null??(x??0);S.push({name:`${se} AI`,isCurrentTurn:!Ne,legsWon:c||0,score:typeof o=="number"?o:typeof st=="number"?st:0,lastScore:V,avg:void 0,checkoutRate:tt&&tt>0?Math.round((ls||0)/tt*100):0,bestLeg:"â€”"})}}return n==="Cricket"&&(S.push({name:"You",isCurrentTurn:!!Ne,closed:Ie?.marks||{},points:Ie?.points||0}),se&&se!=="None"&&S.push({name:`${se} AI`,isCurrentTurn:!Ne,closed:{},points:0})),n==="Shanghai"&&(S.push({name:"You",isCurrentTurn:!!Ne,round:C?.round||1,target:C?.target||1,score:C?.score||0}),se&&se!=="None"&&S.push({name:`${se} AI`,isCurrentTurn:!Ne,round:C?.round||1,target:C?.target||1,score:0})),n==="Killer"&&je&&je.length>0&&je.forEach((ne,A)=>{const ye=Ae?.[ne.id];S.push({name:ne.name,isCurrentTurn:A===He,number:p?.[ne.id],lives:ye?.lives||0,eliminated:ye?.eliminated||!1})}),S},[n,i,o,m,c,u,x,I,ge,te,N,ue,B,_,K,ls,tt,ve,Ne,se,Ie,C,je,Ae,p,He])}const Sa=r.memo(L),Ca=["Easy","Medium","Hardened"],jl=6500;function pe(n,i,o){return Math.max(i,Math.min(o,n))}function yl(n,i){let o=0;if(i==="Easy"){const m=[22,26,41,45,60];o=m[Math.floor(Math.random()*m.length)]}else i==="Medium"?o=Math.round(pe(60+(Math.random()*30-15),30,100)):o=Math.round(pe(80+(Math.random()*20-10),50,120));return n<=0?0:o>n?[100,85,81,60,57,45,41,26,22,20,1].find(c=>c<=n)??0:o}function wl({onClose:n}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:n,children:"Close âœ•"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations ðŸ“–"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const Sl=Oi();function ho({user:n}){const{offlineLayout:i,favoriteDouble:o,callerEnabled:m,callerVoice:c,callerVolume:u,speakCheckoutOnly:x,rememberLastOffline:I,setLastOffline:ge,autoStartOffline:te,cameraEnabled:N,textSize:ue,boxSize:B,autoscoreProvider:_,autoCommitMode:K="wait-for-clear",matchType:ls="singles",setMatchType:tt,teamAName:ve="Team A",setTeamAName:Ne,teamBName:se="Team B",setTeamBName:st}=Ei(),Ie=_==="manual",C=N&&!Ie,je="modern",Ae=N&&!Ie&&K!=="immediate",[p,He]=r.useState("X01"),[S,ne]=r.useState(501),[A,ye]=r.useState("None"),[Cn,os]=r.useState(!1),[nt,Be]=r.useState(!1),[oe,U]=r.useState(S),[P,rt]=r.useState(S),[Aa,cs]=r.useState(!1),[ds,V]=r.useState(!1),[Dt,kn]=r.useState(1),[me,At]=r.useState(0),H=Ri(),[Ma,Dn]=r.useState(!1),An=r.useRef(!1),[he,Mt]=r.useState(0),[Lt,$]=r.useState(null),[Tt,Mn]=r.useState(1),[Et,Ln]=r.useState(1),[fe,Tn]=r.useState([]),[En,La]=r.useState(2e3),Ve=Pi(),[Fe,Ue]=r.useState(!1),[Ta,Oe]=r.useState(!1),[us,ms]=r.useState(!1),[at,it]=r.useState({player:!1,opponent:!1}),Rn=Ii(t=>t.setPaused);r.useEffect(()=>{const t=()=>{Ue(!1),Be(!1),Oe(!1)};try{window.addEventListener("ndn:match-quit",t)}catch{}return()=>{try{window.removeEventListener("ndn:match-quit",t)}catch{}}},[]);const[hs,Cl]=r.useState(!1),[fs,kl]=r.useState(!1),[Rt,Pn]=r.useState(1),[Dl,In]=r.useState(!1),[re,lt]=r.useState(!0),[xs,Ea]=r.useState(()=>typeof window<"u"&&window.innerWidth<768),[Al,Ra]=r.useState(!1);r.useEffect(()=>{if(typeof window>"u")return;const t=()=>Ea(window.innerWidth<768);return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),r.useEffect(()=>{xs||Ra(!1)},[xs]),r.useEffect(()=>{const t=()=>ze(!0);return window.addEventListener("ndn:open-camera-manager",t),()=>window.removeEventListener("ndn:open-camera-manager",t)},[]);const[D,y]=r.useState(0),[Pt,bs]=r.useState(0),[ps,gs]=r.useState(0),[It,Hn]=r.useState(0),[Bn,Vn]=r.useState(0),[Fn,Un]=r.useState(ua()),[Pa,vs]=r.useState(ma()),[Ml,Ns]=r.useState(ha()),[Ll,js]=r.useState(fa()),[Tl,we]=r.useState(0),[Ia,On]=r.useState(1),[El,ys]=r.useState(27),[Rl,_n]=r.useState(0),[Ha,ws]=r.useState(0),[Ba,Kn]=r.useState(!1),[Va,$n]=r.useState(1),[Pl,Wn]=r.useState(0),[Il,Gn]=r.useState(0),Fa=8,[Ua,zn]=r.useState(1),[Hl,Xn]=r.useState(0),[Bl,Yn]=r.useState(0),Oa=10,[_a,qn]=r.useState(1),[Vl,Qn]=r.useState(0),[Fl,Zn]=r.useState(0),Ka=10,[Jn,Ss]=r.useState(170),[er,tr]=r.useState(0),[$a,sr]=r.useState(0),[Wa,nr]=r.useState(0),[rr,Cs]=r.useState(121),[ar,ir]=r.useState(0),[Ga,lr]=r.useState(0),[za,or]=r.useState(0),[Ht,Xa]=r.useState(20),[cr,ks]=r.useState(0),[dr,Ds]=r.useState(0),[ot,Ya]=r.useState(30),[ur,As]=r.useState(!1),[Ul,mr]=r.useState(pa()),[Ol,hr]=r.useState(ga()),[Bt,fr]=r.useState(va()),[_l,xr]=r.useState(wa()),[E,Ms]=r.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[ct,dt]=r.useState({}),[Vt,Ls]=r.useState({}),[qa,Ts]=r.useState(!1),[xe,_e]=r.useState(0),[Kl,Ke]=r.useState(0),[Ft,ut]=r.useState(null),[$l,be]=r.useState(""),[Wl,Gl]=r.useState(vn()),[Me,mt]=r.useState(vn()),[zl,Xl]=r.useState(jn(50)),[ae,ht]=r.useState(jn(50)),[Yl,ql]=r.useState(wn(70)),[ie,ft]=r.useState(wn(70)),[br,$e]=r.useState(0),[Es,Le]=r.useState(0),[ce,W]=r.useState(0),[Rs,xt]=r.useState(S),[Te,q]=r.useState(0),[Ps,Se]=r.useState(null),[Ut,G]=r.useState(0),Ot=r.useRef(0),Qa=r.useRef(0),Q=r.useRef(oe),O=r.useRef(ce),Z=r.useRef(Te),We=r.useRef(Rs),J=r.useRef(Ut);r.useEffect(()=>{Q.current=oe},[oe]),r.useEffect(()=>{O.current=ce},[ce]),r.useEffect(()=>{Z.current=Te},[Te]),r.useEffect(()=>{We.current=Rs},[Rs]),r.useEffect(()=>{J.current=Ut},[Ut]);const[Za,bt]=r.useState(0);r.useRef(null);const[pr,Is]=r.useState(0),[Hs,Bs]=r.useState(0),[Vs,Ge]=r.useState(0),[Fs,Ce]=r.useState(0),[Us,pt]=r.useState(null),[Os,gt]=r.useState(0),[_t,vt]=r.useState(0),[gr,Kt]=r.useState(0),[$t,vr]=r.useState(0),[Nr,jr]=r.useState(0),[_s,Nt]=r.useState(0),[Ks,yr]=r.useState(0),[wr,Wt]=r.useState(0),[Sr,Cr]=r.useState(0),[kr,Gt]=r.useState(0),[Ja,zt]=r.useState(0),[ei,Xt]=r.useState(0),[Dr,$s]=r.useState(0),[ti,Ws]=r.useState(0),[si,Gs]=r.useState(0),[ni,Yt]=r.useState(0),[ri,Ar]=r.useState(0),[qt,Qt]=r.useState(null),[ai,ke]=r.useState(!1),[ii,zs]=r.useState(!1),[z,X]=r.useState(""),[Ql,Zl]=r.useState(""),[Jl,eo]=r.useState(""),[to,so]=r.useState(""),[no,Mr]=r.useState(""),[ro,Lr]=r.useState(""),[Zt,Tr]=r.useState(null),[li,ze]=r.useState(!1),[Xs,Ys]=r.useState(!1),[oi,Er]=r.useState({}),[ao,Jt]=r.useState(!1),Ee=r.useRef(null),qs=r.useRef(null),de=r.useCallback(()=>{const t=qs.current;t&&(clearTimeout(t),qs.current=null)},[]),ci=r.useCallback(t=>{if(t>0&&t<=60){const s=Hi(t,o);Qt({remaining:t,routes:s}),ke(!0)}else Qt(null),ke(!1)},[o]),Qs=r.useCallback(()=>{try{xn({type:"quit"})}catch{}Ue(!1),Be(!1),Oe(!1),ms(!1),it({player:!1,opponent:!1})},[]);r.useEffect(()=>{us&&at.player&&at.opponent&&Qs()},[Qs,at,us]);const Rr=r.useCallback(t=>{if(!m)return;const s=St(n,"Player");try{bn(s,t.visitTotal,Math.max(t.remaining,0),c,{volume:u,checkoutOnly:x})}catch{}},[m,c,u,x,n]),Pr=r.useCallback((t,s)=>{Jt(!1);const{visitTotal:a,darts:l,preRemaining:d,remaining:b,doubleAttempts:g,finished:j,doubleWindow:f,highestCheckout:h}=t;j?(U(0),Q.current=0,typeof h=="number"&&h>0&&Yt(v=>Math.max(v,h))):(U(b),Q.current=b),Se(a),a===180?Gt(v=>v+1):a>=140?zt(v=>v+1):a>=100&&Xt(v=>v+1),f&&g>0&&(vt(v=>v+g),j&&Kt(v=>v+1)),t.announced||Rr(t);try{is.getState().recordVisit("offline-x01",l,a,{preRemaining:d,postRemaining:j?0:b,finish:j,bust:!1})}catch{}try{H.addVisit(a,l,{visitTotal:a}),j&&H.endLeg(d)}catch{}j&&($("player"),V(!0)),wt(j?0:b),q(0),Z.current=0,W(0),O.current=0,G(0),J.current=0},[wt,Yt,$,U,Se,q,W,G,V,Gt,zt,Xt,vt,Kt,Rr]),Xe=r.useCallback(t=>{const s=Ee.current;s&&(Ee.current=null,de(),Pr(s,t))},[de,Pr]);r.useCallback(t=>{Ee.current={...t,announced:!1},Jt(!0),de(),qs.current=setTimeout(()=>Xe("timeout"),jl)},[de,Xe]),r.useEffect(()=>{if(!Ae)return;const t=()=>Xe("event");return window.addEventListener("ndn:darts-cleared",t),()=>window.removeEventListener("ndn:darts-cleared",t)},[Ae,Xe]),r.useEffect(()=>{Ae||Xe("timeout")},[Ae,Xe]),r.useEffect(()=>()=>de(),[de]),r.useEffect(()=>{if(ce===0){try{window.dispatchEvent(new CustomEvent("ndn:darts-cleared",{detail:{source:"offline-play",ts:Date.now()}}))}catch{}Ot.current=0}Qa.current=ce},[ce]);const Ye=St(n,"Player 1"),es=A==="None"?"Player 2":A,ts=Pe("X01",oe,P,me,he,Es,Hs,Te,Vs,Ps,Us,ce,Fs,gr,_t,Nr,$t,fe,re,A,S),Ir=Pe("Cricket",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Fn),Zs=Pe("Shanghai",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,re,A,void 0,Fn,Pa),Js=Pe("Killer",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,E,ct,Vt,xe),en=Pe("Scam"),tn=Pe("Fives"),sn=Pe("Sevens");r.useMemo(()=>{switch(p){case"Cricket":return Ir;case"Shanghai":return Zs;case"Killer":return Js;case"Scam":return en;case"Fives":return tn;case"Sevens":return sn;default:return ts}},[p,Ir,Zs,Js,en,tn,sn,ts]);const di=p==="X01"?`${me}-${he}`:void 0,ss=r.useMemo(()=>{const t=ts||[],s=ce>0?Te:Ps??Es,a=Fs>0?Vs:Us??Hs;return t.length===0?{name:re?Ye:es,isCurrentTurn:!0,legsWon:re?me:he,score:re?oe:P,lastScore:re?s:a}:t.find(l=>l.isCurrentTurn)??t[0]},[ts,re,Ye,es,me,he,oe,P,ce,Te,Ps,Es,Vs,Us,Hs,Fs]),ui=r.useMemo(()=>{if(!ss)return[];const{matchAvg:t,allTimeAvg:s,...a}=ss;return[{...a,matchAvg:void 0,allTimeAvg:void 0}]},[ss]);ss?.name;const mi=re?oe:P,ns=H.players?.[H.currentPlayerIdx];let Hr=0,Br=0;if(ns&&ns.legs&&ns.legs.length>0){for(const t of ns.legs)if(Array.isArray(t.visits))for(const s of t.visits)Hr+=s.score||0,Br+=s.darts||0}const hi=Hr+(Te||0),Vr=Br+(ce||0),fi=Vr>0?hi/Vr*3:0,De=r.useCallback(t=>Math.max(0,Math.min(99,Math.round(t||0))).toString(),[]),M=r.useCallback((t,s=1)=>{!t||s<=0||Er(a=>({...a,[t]:(a[t]||0)+s}))},[]),R=r.useCallback(t=>{t&&Er(s=>s[t]===void 0?s:{...s,[t]:0})},[]);oi[p];const Fr=r.useCallback(()=>{Ee.current&&(Ee.current=null),de(),Jt(!1)},[de]);r.useCallback(t=>{const s=pe(t,0,S);Fr(),U(s),Q.current=s;const a=s===0?S:s;xt(a),We.current=a,q(0),Z.current=0,W(0),O.current=0,G(0),J.current=0,Se(null),Le(0),y(0),Ot.current=0,s===0?($("player"),V(!0)):($(null),V(!1))},[Fr,U,S,xt,q,W,G,Se,Le,y,$,V]);const Ur=r.useCallback((t,s)=>{t==="player"?(At(s),Mr("")):(Mt(s),Lr("")),$(null),V(!1)},[Mt,Lr,Mr,$,At,V]),xi=r.useCallback(()=>{Tr(t=>t&&(t.stage===1?{...t,stage:2}:(Ur(t.target,t.value),null)))},[Ur]),jt=r.useCallback(()=>{Tr(null)},[]);r.useEffect(()=>{if(!Zt)return;const t=s=>{s.key==="Escape"&&(s.preventDefault(),jt())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[jt,Zt]);const qe=r.useRef(null),Qe=r.useRef(null),Or=r.useRef(null),[Ze,nn]=r.useState("first"),[yt,_r]=r.useState(1);r.useRef(null),r.useEffect(()=>{const t=Math.max(1,Math.floor(Number(yt)||1)),s=Ze==="first"?t:Math.max(1,Math.ceil(t/2));kn(s)},[Ze,yt]),r.useEffect(()=>{if(!fs){Pn(1),In(!1);return}const t=()=>{const l=qe.current,d=Qe.current;if(!l||!d)return;const b=Or.current?Or.current.getBoundingClientRect().height:0,g=Math.max(0,l.clientHeight-b-6),j=Math.max(0,l.clientWidth-8),f=d.getBoundingClientRect(),h=Rt||1,v=f.height/h,w=f.width/h,T=g>0?g/v:1,k=j>0?j/w:1,as=Math.min(1,Math.max(.5,Math.min(T,k))),le=v*as,Li=g>0&&le-g>1;In(Li),Pn(as)};t();const s=window.ResizeObserver,a=s?new s(()=>t()):null;return a&&qe.current&&a.observe(qe.current),a&&Qe.current&&a.observe(Qe.current),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t);try{a&&qe.current&&a.unobserve(qe.current)}catch{}try{a&&Qe.current&&a.unobserve(Qe.current)}catch{}}},[fs,Rt]),r.useEffect(()=>{const t=s=>{const a=s?.detail?.mode;a&&(He(a),Re())};return window.addEventListener("ndn:auto-start",t),()=>window.removeEventListener("ndn:auto-start",t)},[]),r.useEffect(()=>{const t=s=>{const a=s?.detail?.formatType,l=s?.detail?.formatCount,d=s?.detail?.startScore;(a==="first"||a==="best")&&nn(a),typeof l=="number"&&isFinite(l)&&_r(Math.max(1,Math.floor(l))),typeof d=="number"&&isFinite(d)&&ne(Math.max(1,Math.floor(d)))};return window.addEventListener("ndn:offline-format",t),()=>window.removeEventListener("ndn:offline-format",t)},[]),r.useEffect(()=>{if(!te)return;const t=setTimeout(()=>Re(),50);return()=>clearTimeout(t)},[te]),r.useEffect(()=>{if(!Fe||re||A==="None"||Za<=0)return;let t,s=performance.now();const a=l=>{const d=l-s;s=l,bt(b=>{const g=b-d;if(g<=0){let j=0,f=0,h=P;for(Ce(0);j<3&&h>0;){const v=yl(h,A),w=pe(v-j*20,0,Math.min(60,h)),T=h-w;if(Bs(w),Is(le=>le+1),yr(le=>le+1),T<0){h=P,Ge(0),gt(0),f=0,pt(0),Ce(0);break}f+=w,Ge(le=>le+w),Cr(le=>le+w);const k=h,as=T;if(k>50&&as<=50?gt(1):k<=50&&gt(le=>le+1),h=T,j+=1,Ce(j),h===0)break}if(rt(h),h===0){f===180?$s(w=>w+1):f>=140?Ws(w=>w+1):f>=100&&Gs(w=>w+1);const v=P;v<=170&&Ar(w=>Math.max(w,v)),P<=50&&(vr(w=>w+(Os>0?Os:1)),jr(w=>w+1)),pt(f),Ge(0),gt(0),Ce(0),$("ai"),V(!0)}return h>0&&j>=3&&(f===180?$s(v=>v+1):f>=140?Ws(v=>v+1):f>=100&&Gs(v=>v+1),pt(f),Ge(0),gt(0),Ce(0)),Ce(0),lt(!0),0}return g}),t=requestAnimationFrame(a)};return t=requestAnimationFrame(a),()=>cancelAnimationFrame(t)},[Fe,re,A,P]),r.useEffect(()=>{H.inProgress&&(An.current||(Dn(!0),An.current=!0))},[H.inProgress]);function Re(){Be(!0),U(S),Q.current=S,rt(S),cs(!1),Ue(!0),lt(!0),y(0),$e(0),Le(0),W(0),O.current=0,xt(S),q(0),Se(null),G(0),bt(0),Is(0),Bs(0),Ge(0),Ce(0),pt(null),$(null),At(0),Mt(0),Tn([]),ks(0),Ds(0),As(!1),Nt(0),yr(0),Wt(0),Cr(0),Gt(0),zt(0),Xt(0),$s(0),Ws(0),Gs(0),Yt(0),Ar(0),vt(0),Kt(0),vr(0),jr(0),R("X01");const t=Math.max(1,Math.floor(Number(yt)||1));if(kn(Ze==="first"?t:Math.max(1,Math.ceil(t/2))),I)try{ge({mode:p,x01Start:S,firstTo:Dt,aiLevel:A})}catch{}const s=St(n,"You"),a=A!=="None"?`AI (${A})`:"Opponent",l=A!=="None"?[s,a]:[s];H.newMatch(l,S,`offline-${Date.now()}`)}function bi(){U(S),Q.current=S,rt(S),cs(!1),Qt(null),ke(!1),Ue(!0),lt(!0),y(0),$e(0),Le(0),W(0),O.current=0,xt(S),q(0),We.current=S,Z.current=0,Se(null),G(0),J.current=0,J.current=0,bt(0),Is(0),Bs(0),Ge(0),Ce(0),pt(null),$(null)}function wt(t){ci(t),W(0),O.current=0,xt(t===0?S:t),We.current=t===0?S:t,G(0),J.current=0,A!=="None"?(lt(!1),bt(En)):(bt(0),lt(!0))}function F(t){if(!Number.isFinite(t))return!1;const s=We.current,a=Q.current,l=O.current,d=Z.current,b=l>0||d>0;b&&(U(s),Q.current=s,W(0),O.current=0,q(0),Z.current=0,G(0),J.current=0,Le(0),y(0),$e(k=>Math.max(0,k-l)),Nt(k=>Math.max(0,k-l)),Wt(k=>Math.max(0,k-d)),Ot.current=0);const g=b?s:a,j=g<=170?170:180,f=pe(Math.round(t),0,j),h=g-f,v=pe(Math.round(Et||0),0,3),w=pe(Math.round(Tt||0),0,3),T=h===0?v:3;if(M("X01",T),$e(k=>k+T),Nt(k=>k+T),W(T),O.current=T,q(f),Z.current=f,Se(f),f===180?Gt(k=>k+1):f>=140?zt(k=>k+1):f>=100&&Xt(k=>k+1),h<0){if(m)try{bn(Ye,0,Math.max(s,0),c,{volume:u,checkoutOnly:x})}catch{}try{is.getState().recordVisit("offline-x01",T,0,{preRemaining:g,postRemaining:s,bust:!0,finish:!1})}catch{}U(s),Q.current=s,Se(0),q(0),Z.current=0,W(0),O.current=0,G(0),J.current=0;try{H.addVisit(0,T)}catch{}return wt(s),!0}if(U(h),Q.current=h,Wt(k=>k+f),m)try{bn(Ye,f,Math.max(h,0),c,{volume:u,checkoutOnly:x})}catch{}if(h===0?(vt(k=>k+w),Kt(k=>k+1),G(w),J.current=w):g<=50&&vt(k=>k+3),h===0){g<=170&&Yt(k=>Math.max(k,g)),Qt(null),ke(!1);try{is.getState().recordVisit("offline-x01",T,f,{preRemaining:g,postRemaining:0,finish:!0,bust:!1})}catch{}try{H.addVisit(f,T),H.endLeg(g)}catch{}return $("player"),V(!0),W(0),O.current=0,q(0),Z.current=0,G(0),J.current=0,!0}try{is.getState().recordVisit("offline-x01",T,f,{preRemaining:g,postRemaining:h,finish:!1,bust:!1})}catch{}try{H.addVisit(f,T)}catch{}return wt(h),q(0),Z.current=0,W(0),O.current=0,G(0),J.current=0,!0}const ee=Nl({match:H,commitManualVisitTotal:F,endTurn:wt}),[rn,Kr]=r.useState(""),$r=t=>{Kr(t)},an=()=>{const t=parseInt(rn,10);if(isNaN(t)||t<0||t>180){alert("Enter a number 0-180 for visit total");return}if(t>180){alert("Enter a number 0-180 for visit total");return}const s=Q.current<=170?170:180,a=pe(Math.round(t),0,s);t>s&&Ve(`Visit totals cannot exceed ${s}.`,{type:"info",timeout:2200}),F(a)&&Kr("")},Wr=r.useCallback(()=>{Ee.current&&(Ee.current=null,de(),Jt(!1));const t=O.current,s=Z.current,a=We.current;t===0&&s===0||(U(a),Q.current=a,W(0),O.current=0,q(0),Z.current=0,G(0),J.current=0,Le(0),y(0),$e(l=>Math.max(0,l-t)),Nt(l=>Math.max(0,l-t)),Wt(l=>Math.max(0,l-s)),Ot.current=0)},[de]);r.useEffect(()=>{const t=s=>{const a=s?.detail;!a||a?.source==="offline-play"||Wr()};return window.addEventListener("ndn:clear-visit-request",t),()=>window.removeEventListener("ndn:clear-visit-request",t)},[Wr]);function Gr(t){M("Double Practice");const s=pe(Math.round(t||0),0,60);if(Le(s),$e(a=>a+1),Nt(a=>a+1),da(s,Pt)){const a=ps+1;gs(a),bs(l=>Math.min(20,l+1)),a>=21&&($("player"),V(!0))}y(0)}function zr(){Gr(Number(D))}function Xr(){const t=Ct(z);if(t==null){alert("Enter like D16, 50, 25, T20");return}Gr(t),X("")}function Yr(t,s,a){if(Ba)return!1;M("Bob's 27");const l=Ia,d=s==="DOUBLE"&&a===l||!s&&t===l*2;return d&&ws(b=>b+1),_n(b=>{const g=b+1;if(g>=3){const j=Ha+(d?1:0);j>0?ys(h=>h+j*l*2):ys(h=>h-l*2);const f=l+1;return On(f),ws(0),f>20&&Kn(!0),0}return g}),!0}function qr(){Yr(Math.max(0,D|0)),y(0)}function pi(){On(1),ys(27),_n(0),ws(0),Kn(!1),R("Bob's 27")}function ln(t){return M("Count-Up"),Wn(s=>s+Math.max(0,t|0)),Gn(s=>{const a=s+1;return a>=3?($n(l=>l+1),0):a}),!0}function on(t){return M("High Score"),Xn(s=>s+Math.max(0,t|0)),Yn(s=>{const a=s+1;return a>=3?(zn(l=>l+1),0):a}),!0}function cn(t){return M("Low Score"),Qn(s=>s+Math.max(0,t|0)),Zn(s=>{const a=s+1;return a>=3?(qn(l=>l+1),0):a}),!0}function Qr(t,s,a,l,d,b,g,j){const f=t-g;if(!(f<0))if(f===0){if(j==="DOUBLE"||j==="INNER_BULL"){b(h=>h+1),d(h=>h+1),l(()=>0),s(t);return}s(f)}else s(f);l(h=>{const v=h+1;return v>=3?(d(w=>w+1),0):v})}function Zr(t,s){return M("Checkout 170"),Qr(Jn,Ss,er,tr,sr,nr,t,s),er+1>=3&&Ss(170),!0}function Jr(t,s){return M("Checkout 121"),Qr(rr,Cs,ar,ir,lr,or,t,s),ar+1>=3&&Cs(121),!0}function rs(t){const s=Ct(z);if(s==null){alert("Enter like T20, D16, 25, 50");return}const a=z.trim().toUpperCase(),l=a.startsWith("D")||a==="50"||a==="BULL"||a==="DBULL"||a==="IBULL"||a.includes("INNER");t?Zr(s,l?"DOUBLE":void 0):Jr(s,l?"DOUBLE":void 0),X("")}function gi(){Ss(170),tr(0),sr(0),nr(0),R("Checkout 170")}function vi(){Cs(121),ir(0),lr(0),or(0),R("Checkout 121")}function dn(t,s,a){return ur?!1:(M("Treble Practice"),(s==="TRIPLE"&&a===Ht||!s&&t===Ht*3)&&ks(d=>d+1),Ds(d=>{const b=d+1;if(b%3===0&&[20,19,18].includes(Ht)){const g=["T20","T19","T18"],j=g.indexOf(`T${Ht}`),f=g[(j+1)%g.length];Xa(Number(f.replace("T","")))}return ot>0&&b>=ot&&As(!0),b}),!0)}function Ni(){ks(0),Ds(0),As(!1),R("Treble Practice")}function ji(t,s,a){return M("Baseball"),mr(l=>{const d={...l};return rl(d,t,s,a),d}),!0}function yi(){mr(pa()),R("Baseball")}function wi(t,s,a){return M("Golf"),hr(l=>{const d={...l};return il(d,t,s,a),d}),!0}function Si(){hr(ga()),R("Golf")}function Ci(t,s,a,l){return M("Tic Tac Toe"),fr(d=>{const b={...d,board:[...d.board]};return ol(b,t,s,a,l),b}),!0}function ki(){fr(va()),R("Tic Tac Toe")}function Di(t,s,a){return M("American Cricket"),xr(l=>{const d={...l,marks:{...l.marks}};return vl(d,t,s,a,()=>!1),d}),!0}function Ai(){xr(wa()),R("American Cricket")}function un(t,s,a){M("Around the Clock");const l=kt[It];let d=!1;if(typeof a=="number"&&a===l&&(s==="SINGLE"||s==="DOUBLE"||s==="TRIPLE")&&(d=!0),l===25&&(s==="BULL"||t===25)&&(d=!0),l===50&&(s==="INNER_BULL"||t===50)&&(d=!0),d||(t===l||t===l*2||t===l*3)&&(d=!0),d){const b=Bn+1;return Vn(b),Hn(g=>g+1),!0}return!0}function ea(){un(Math.max(0,D|0)),y(0)}function ta(){const t=Ct(z);if(t==null){alert("Enter like T20, D5, 25, 50");return}un(t),X("")}function mn(t,s,a){return M("Cricket"),Un(l=>{const d={...l,marks:{...l.marks}};return zi(d,t,s,a,()=>!1),d}),we(l=>{const d=l+1;return d>=3?0:d}),!0}function sa(){mn(Math.max(0,D|0)),y(0)}function hn(t,s,a){return M("Shanghai"),vs(l=>{const d={...l,turnHits:{...l.turnHits}};return Yi(d,t,s,a),d}),we(l=>{const d=l+1;return d>=3?(vs(b=>{const g={...b,turnHits:{...b.turnHits}};return qi(g),g}),0):d}),!0}function na(){hn(Math.max(0,D|0)),y(0)}function ra(t,s,a){return M("Halve It"),Ns(l=>{const d={...l,targets:[...l.targets]};return Zi(d,t,s,a),d}),we(l=>{const d=l+1;return d>=3?(Ns(b=>{const g={...b,targets:[...b.targets]};return Ji(g),g}),0):d}),!0}function aa(){ra(Math.max(0,D|0)),y(0)}function ia(t,s,a){return M("High-Low"),js(l=>{const d={...l};return el(d,t,s,a),d}),we(l=>{const d=l+1;return d>=3?(js(b=>{const g={...b};return tl(g),g}),0):d}),!0}function la(){ia(Math.max(0,D|0)),y(0)}function Mi(){const t=Lt??"player",s=t==="player"?Ut||void 0:Os||void 0,a=1,l=t==="player"?br:pr;Tn([...fe,{winner:t,doubleDarts:Tt,checkoutDarts:Et,winnerDarts:l,doublesAtt:s,doublesHit:a}]),V(!1);let d=me,b=he;if(Lt==="player"?d+=1:Lt==="ai"&&(b+=1),At(d),Mt(b),$(null),d>=Dt||b>=Dt){try{Ki(p,t==="player")}catch{}try{H.endGame()}catch{}Ue(!1),Be(!1),U(S),rt(S),zs(!0);return}bi()}const fn=!pn.includes(p)&&!(n?.fullAccess||n?.admin);return e.jsxs("div",{className:"ndn-game-shell ndn-page relative overflow-hidden md:overflow-hidden overflow-y-auto bg-transparent shadow-none rounded-none",children:[Ma&&e.jsx(Bi,{players:H.players||[],user:n,onDone:()=>Dn(!1)}),!Fe&&!nt&&e.jsxs("h2",{className:"text-3xl font-bold text-brand-700 mb-4 ndn-section-title",children:["Offline Mode ï¿½"," ",e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"ndn-shell-body",children:[!Fe&&!nt&&e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsxs("select",{onPointerDown:t=>{t.stopPropagation()},onMouseDown:t=>{t.stopPropagation()},onTouchStart:t=>{t.stopPropagation?.()},className:"input w-full",value:p,onChange:t=>He(t.target.value),children:[pn.map(t=>e.jsx("option",{value:t,children:t},t)),ca.map(t=>e.jsxs("option",{value:t,disabled:!(n?.fullAccess||n?.admin),children:[t," ",n?.fullAccess||n?.admin?"":"(Premium)"]},t))]}),p==="Treble Practice"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"font-semibold",children:"Throws per game"}),e.jsx("input",{className:"input w-full",type:"number",min:3,step:3,value:ot,onChange:t=>Ya(Math.max(3,Math.floor(Number(t.target.value)||30)))})]}),e.jsx("div",{className:"sm:col-span-2 text-xs text-slate-300",children:"Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws."}),N&&!xs&&e.jsx("div",{className:"hidden md:block w-[360px] p-3 min-w-0",children:e.jsx("div",{"data-testid":"offline-camera-pane",className:"rounded-2xl overflow-hidden bg-black/70 p-2",style:{willChange:"transform, opacity"},children:e.jsx(Sa,{scoringMode:"x01",showToolbar:C,immediateAutoCommit:!0,cameraAutoCommit:"camera",onAddVisit:Y(F),onAutoDart:(t,s,a)=>{}})})})]}),!n?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),p==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:S,onChange:t=>ne(Number(t.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{onPointerDown:t=>{t.stopPropagation()},onMouseDown:t=>{t.stopPropagation()},onTouchStart:t=>{t.stopPropagation?.()},className:"input w-full",value:A,onChange:t=>ye(t.target.value),children:[e.jsx("option",{value:"None",children:"None"}),Ca.map(t=>e.jsx("option",{value:t,children:t},t))]}),A!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:En/1e3,onChange:t=>La(Math.round(Number(t.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>os(!0),children:"X01 Rules & Regulations! ðŸ“–"})]}),p==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings don't apply."})]}),!Fe&&!nt&&e.jsx("button",{className:"btn",disabled:fn,title:fn?"PREMIUM required for this mode":"",onClick:Re,children:"Start Match ðŸš€"}),Fe&&e.jsx("div",{className:`fixed inset-0 z-[1000] bg-slate-950/90 backdrop-blur-sm ${hs?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(Je,{storageKey:"ndn:modal:offline-match:v2",frameClassName:"relative",frameFullScreenClassName:"relative ndn-modal-full",className:`${hs?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:hs,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsx("div",{className:"flex h-full",children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pt-2 pb-2 pr-0 -ml-2 sm:-ml-3",style:{overflowY:"auto",willChange:"scroll-position",transform:"translateZ(0)",WebkitOverflowScrolling:"touch",contain:"layout style"},ref:t=>{qe.current=t},children:[je!=="modern",us&&e.jsx("div",{className:"fixed inset-0 z-[170] flex items-center justify-center bg-black/70 p-4",children:e.jsxs(Je,{storageKey:"ndn:modal:offline-quit-confirm",className:"w-full relative",defaultWidth:460,defaultHeight:320,minWidth:360,minHeight:260,maxWidth:720,maxHeight:520,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Confirm Quit (Both Players)"}),e.jsx("p",{className:"text-sm text-slate-200 mb-4",children:"Both players must accept to end the match. If either player wants to continue, the match will keep going."}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("button",{className:`btn w-full ${at.player?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-800"}`,onClick:()=>it(t=>({...t,player:!0})),children:[St(n,"Player 1")," Accepts"]}),e.jsxs("button",{className:`btn w-full ${at.opponent?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-800"}`,onClick:()=>it(t=>({...t,opponent:!0})),children:[A==="None"?"Opponent":`${A} AI`," Accepts"]}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 w-full",onClick:()=>{it({player:!1,opponent:!1}),ms(!1)},children:"Continue Match"})]})]})}),p==="X01"&&ai&&qt&&e.jsx("div",{className:"fixed inset-0 z-[160] flex items-center justify-center bg-black/70 p-4",onClick:()=>ke(!1),children:e.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-emerald-400/40 bg-slate-900/95 p-4 text-white shadow-2xl",onClick:t=>t.stopPropagation(),onKeyDown:t=>{(t.key==="Enter"||t.key==="Escape")&&(t.preventDefault(),ke(!1))},tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-emerald-200/70",children:"Checkout box"}),e.jsxs("div",{className:"text-2xl font-bold text-emerald-100",children:[qt.remaining," left"]})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>ke(!1),children:"Close"})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white/60 mb-1",children:"Darts used at double"}),e.jsx("div",{className:"flex gap-2",children:[0,1,2,3].map(t=>e.jsx("button",{className:`btn px-3 py-1 text-sm ${Tt===t?"bg-brand-600":"btn--ghost"}`,onClick:()=>Mn(t),children:De(t)},`double-${t}`))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white/60 mb-1",children:"Darts at checkout"}),e.jsx("div",{className:"flex gap-2",children:[0,1,2,3].map(t=>e.jsx("button",{className:`btn px-3 py-1 text-sm ${Et===t?"bg-brand-600":"btn--ghost"}`,onClick:()=>Ln(t),children:De(t)},`checkout-${t}`))})]}),qt.routes.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-emerald-200/80 mb-1",children:"Suggested checkout"}),e.jsx("div",{className:"space-y-1",children:qt.routes.map(t=>e.jsx("div",{className:"rounded-lg border border-emerald-400/30 bg-emerald-500/10 px-3 py-2 text-sm font-semibold",children:t},t))})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-4 py-1 text-sm",onClick:()=>ke(!1),children:"Enter"})})]})]})}),e.jsxs("div",{ref:t=>{Qe.current=t},className:"will-change-transform",style:fs?{transform:`scale(${Rt})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,Rt))}em`}:void 0,children:[je!=="modern",e.jsxs("div",{className:"space-y-3 mb-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap py-1",children:[e.jsx("button",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-rose-600/20 text-rose-200 border border-rose-400/30 hover:bg-rose-600/40 transition-colors",onClick:()=>Oe(!0),children:"Quit"}),e.jsx("button",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-amber-600/20 text-amber-200 border border-amber-400/30 hover:bg-amber-600/40 transition-colors",onClick:()=>{const t=Date.now()+3e5;try{Rn(!0,t),xn({type:"pause",pauseEndsAt:t,pauseStartedAt:Date.now()})}catch{}Ve("Match paused for 5 minutes",{type:"info",timeout:2500})},children:"Pause"}),e.jsx("button",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-slate-600/20 text-slate-200 border border-slate-400/30 hover:bg-slate-600/40 transition-colors",onClick:()=>Re(),children:"Restart"}),e.jsx("button",{className:`px-3 py-1 rounded-full text-xs font-semibold border transition-colors ${Xs?"bg-indigo-600/40 text-indigo-100 border-indigo-400/50":"bg-indigo-600/20 text-indigo-200 border-indigo-400/30 hover:bg-indigo-600/40"}`,onClick:()=>Ys(t=>!t),children:Xs?"Close Setup â–²":"New Match â–¼"})]}),Xs&&e.jsxs("div",{className:"rounded-2xl bg-slate-900/80 border border-white/10 p-3 space-y-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Match Setup"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/60 mb-1 block",children:"Game Mode"}),e.jsxs("select",{className:"input w-full text-sm",value:p,onChange:t=>He(t.target.value),children:[pn.map(t=>e.jsx("option",{value:t,children:t},t)),ca.map(t=>e.jsxs("option",{value:t,disabled:!(n?.fullAccess||n?.admin),children:[t,n?.fullAccess||n?.admin?"":" (Premium)"]},t))]})]}),p==="X01"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/60 mb-1 block",children:"Starting Score"}),e.jsx("input",{className:"input w-full text-sm",type:"number",min:1,max:1001,value:S,onChange:t=>ne(Number(t.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/60 mb-1 block",children:"Format"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`px-2 py-0.5 rounded-full text-xs border ${Ze==="first"?"bg-white/20 border-white/30":"bg-transparent border-white/10 opacity-60"}`,onClick:()=>nn("first"),children:"First to"}),e.jsx("button",{type:"button",className:`px-2 py-0.5 rounded-full text-xs border ${Ze==="best"?"bg-white/20 border-white/30":"bg-transparent border-white/10 opacity-60"}`,onClick:()=>nn("best"),children:"Best of"}),e.jsx("input",{className:"input w-14 text-center text-sm",type:"number",min:1,step:1,value:yt,onChange:t=>_r(Math.max(1,Math.floor(Number(t.target.value)||1)))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/60 mb-1 block",children:"AI Opponent"}),e.jsxs("select",{className:"input w-full text-sm",value:A,onChange:t=>ye(t.target.value),children:[e.jsx("option",{value:"None",children:"None"}),Ca.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-4 py-1 text-sm",onClick:()=>{Ys(!1),Re()},children:"Start New Match ðŸš€"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Ys(!1),children:"Cancel"})]})]}),Ta&&e.jsx(Vi,{onClose:()=>Oe(!1),onQuit:()=>{if(A==="None"){Oe(!1),it({player:!0,opponent:!1}),ms(!0);return}Qs()},onPause:t=>{const s=Date.now()+t*60*1e3;try{Rn(!0,s),xn({type:"pause",pauseEndsAt:s,pauseStartedAt:Date.now()})}catch{}Oe(!1)}})]}),p!=="X01"?e.jsxs("div",{className:"space-y-2",children:[p==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:gn[Pt]?.label||"â€”"})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,onAutoDart:(t,s)=>{if((s==="DOUBLE"||s==="INNER_BULL")&&da(t,Pt)){const l=ps+1,d=Pt+1;return gs(l),bs(d),l>=gn.length&&setTimeout(()=>{gs(0),bs(0)},250),!0}return!1},immediateAutoCommit:!0,onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&zr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:zr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:z,onChange:t=>X(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Xr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Xr,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",ps," of 21"]})]}),p==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:kt[It]===25?"25 (Outer Bull)":kt[It]===50?"50 (Inner Bull)":kt[It]||"â€”"})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>un(t,s==="MISS"?void 0:s,a?.sector??null),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&ea()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ea,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:z,onChange:t=>X(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ta()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ta,children:"Add"})]}),Bn>=kt.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Vn(0),Hn(0),R("Around the Clock")},children:"Reset"})]})]}),p==="Cricket"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>mn(t,s==="MISS"?void 0:s,a?.sector??null),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&sa()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:sa,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Un(ua()),we(0),R("Cricket")},children:"Reset"})]})]}),p==="Shanghai"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>hn(t,s==="MISS"?void 0:s,a?.sector??null),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&na()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:na,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{vs(ma()),we(0),R("Shanghai")},children:"Reset"})]})]}),p==="Halve It"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>ra(t,s==="MISS"?void 0:s,a?.sector??null),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&aa()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:aa,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ns(ha()),we(0),R("Halve It")},children:"Reset"})]})]}),p==="High-Low"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>ia(t,s==="MISS"?void 0:s,a?.sector??null),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&la()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:la,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{js(fa()),we(0),R("High-Low")},children:"Reset"})]})]}),p==="Bob's 27"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>Yr(t,s==="MISS"?void 0:s,a?.sector??null),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&qr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:qr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:pi,children:"Reset"})]})]}),p==="Count-Up"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:t=>ln(t),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ln(D),y(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ln(D),y(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{$n(1),Wn(0),Gn(0),R("Count-Up")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Va,"/",Fa]})]}),p==="High Score"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:t=>on(t),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(on(D),y(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{on(D),y(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{zn(1),Xn(0),Yn(0),R("High Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Ua,"/",Oa]})]}),p==="Low Score"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:t=>cn(t),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(cn(D),y(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{cn(D),y(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{qn(1),Qn(0),Zn(0),R("Low Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",_a,"/",Ka]})]}),p==="Checkout 170"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s)=>Zr(t,s==="MISS"?void 0:s),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:z,onChange:t=>X(t.target.value),onKeyDown:t=>{t.key==="Enter"&&rs(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>rs(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:gi,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",Jn," Â· Attempts: ",$a," ","Â· Successes: ",Wa]})]}),p==="Checkout 121"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s)=>Jr(t,s==="MISS"?void 0:s),onAddVisit:Y(F),onEndLeg:t=>ee.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:z,onChange:t=>X(t.target.value),onKeyDown:t=>{t.key==="Enter"&&rs(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>rs(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:vi,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",rr," Â· Attempts: ",Ga," ","Â· Successes: ",za]})]}),p==="Treble Practice"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>dn(t,s==="MISS"?void 0:s,a?.sector??null)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:z,onChange:t=>X(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=Ct(z);s!=null&&dn(s,void 0,void 0),X("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const t=Ct(z);t!=null&&dn(t,void 0,void 0),X("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",cr," Â· Misses:"," ",Math.max(0,dr-cr)," Â· Darts:"," ",dr,ot>0?`/${ot}`:""]}),ur&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:Ni,children:"Reset"})]})]}),p==="Baseball"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>ji(t,s==="MISS"?void 0:s,a?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:yi,children:"Reset"})})]}),p==="Golf"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>wi(t,s==="MISS"?void 0:s,a?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Si,children:"Reset"})})]}),p==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(t,s)=>s).map(t=>e.jsx("button",{className:`h-16 rounded-xl border ${Bt.board[t]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(Bt.finished||Bt.board[t])return;const s=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),a=s%3===0?"TRIPLE":s%2===0?"DOUBLE":"SINGLE",l=t,d=ka[l],b=d.type==="BULL"?null:d.num||null;Ci(l,s,a,b)},children:Bt.board[t]||""},t))}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:ki,children:"Reset"})})]}),p==="American Cricket"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>Di(t,s==="MISS"?void 0:s,a?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Ai,children:"Reset"})})]}),p==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:cl[Me.targetIndex]})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{const l=s==="MISS"?void 0:s;return M("Scam"),mt(Nn(Me,t,l)),!0}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:1,max:25,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(M("Scam"),mt(Na(Me,D)),y(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{M("Scam"),mt(Na(Me,D)),y(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{mt(ul()),R("Scam")},children:"Reset"})]}),Me.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["ðŸŽ‰ Finished in ",Me.darts," darts!"]})]}),p==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[ae.score,"/",ae.target]})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>(M("Fives"),ht(yn(ae,t)),!0)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:5,max:50,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(M("Fives"),ht(ja(ae,D)),y(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{M("Fives"),ht(ja(ae,D)),y(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ht(fl(ae.target)),R("Fives")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:"," ",ae.darts]}),ae.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",ae.target," in"," ",ae.darts," darts!"]})]}),p==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[ie.score,"/",ie.target]})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>(M("Sevens"),ft(Sn(ie,t)),!0)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:7,max:21,value:D,onChange:t=>y(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(M("Sevens"),ft(ya(ie,D)),y(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{M("Sevens"),ft(ya(ie,D)),y(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ft(pl(ie.target)),R("Sevens")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 7, 14, 21 Â· Darts:"," ",ie.darts]}),ie.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",ie.target," in"," ",ie.darts," darts!"]})]}),p==="Killer"&&e.jsx(e.Fragment,{children:qa?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:E.map(t=>{const s=ct[t.id],a=Vt[t.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${s?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${s?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:s?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number:"," ",e.jsx("span",{className:"font-semibold",children:a})]}),e.jsxs("div",{className:"text-sm",children:["Lives:"," ",e.jsx("span",{className:"font-semibold",children:s?.lives??0})]})]},t.id)})}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{if(Ft)return!1;const l=s==="MISS"?void 0:s,d=a?.sector??null,b=E[xe];return b?(dt(g=>{const j={};Object.keys(g).forEach(v=>j[v]={...g[v]});const f=xa(b.id,j,l,d);if(f.becameKiller)be(`${b.name} became a Killer`);else if(f.victimId){const v=E.find(w=>w.id===f.victimId);be(`${b.name} hit ${v?.name}'s ${Vt[f.victimId]} (${f.livesRemoved} life${(f.livesRemoved||0)>1?"s":""})`)}else be("No effect");const h=ba(j);return h&&ut(h),j}),Ke(g=>{const j=g+1;if(j>=3){let f=xe;for(let h=1;h<=E.length;h++){const v=(xe+h)%E.length,w=E[v].id,T=ct[w];if(T&&!T.eliminated&&T.lives>0){f=v;break}}return _e(f),0}return j}),!0):!1}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:z,onChange:t=>X(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){if(Ft)return;const a=z.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!a){X("");return}const l=a[1]||"S",d=parseInt(a[2],10),b=l==="D"?"DOUBLE":l==="T"?"TRIPLE":"SINGLE",g=E[xe];dt(j=>{const f={};Object.keys(j).forEach(w=>f[w]={...j[w]});const h=xa(g.id,f,b,d);if(h.becameKiller)be(`${g.name} became a Killer`);else if(h.victimId){const w=E.find(T=>T.id===h.victimId);be(`${g.name} hit ${w?.name}'s ${Vt[h.victimId]} (${h.livesRemoved} life${(h.livesRemoved||0)>1?"s":""})`)}else be("No effect");const v=ba(f);return v&&ut(v),f}),X(""),Ke(j=>{const f=j+1;if(f>=3){let h=xe;for(let v=1;v<=E.length;v++){const w=(xe+v)%E.length,T=E[w].id,k=ct[T];if(k&&!k.eliminated&&k.lives>0){h=w;break}}return _e(h),0}return f})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let t=xe;for(let s=1;s<=E.length;s++){const a=(xe+s)%E.length,l=E[a].id,d=ct[l];if(d&&!d.eliminated&&d.lives>0){t=a;break}}_e(t),Ke(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{dt({}),Ls({}),Ts(!1),_e(0),Ke(0),ut(null),be("")},children:"Reset"})]}),Ft&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner:"," ",E.find(t=>t.id===Ft)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{dt({}),Ls({}),Ts(!1),_e(0),Ke(0),ut(null),be("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:E.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:t.name,onChange:a=>{const l=a.target.value;Ms(d=>d.map((b,g)=>g===s?{...b,name:l}:b))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Ms(a=>a.filter((l,d)=>d!==s)),disabled:E.length<=2,children:"Remove"})]},t.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Ms(t=>{const s=`p${t.length+1}`;return[...t,{id:s,name:`Player ${t.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(E.length<2){alert("Need at least 2 players");return}const t=E.map(l=>l.id),s=nl(t),a={};t.forEach(l=>{a[l]=sl(s[l])}),Ls(s),dt(a),_e(0),Ke(0),ut(null),be("Assigned numbers"),Ts(!0)},children:"Assign Numbers & Start"})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col-reverse md:grid md:grid-cols-12 gap-4 items-start",children:[e.jsx("div",{className:"col-span-12 md:col-span-4 space-y-3",children:e.jsxs("div",{className:"rounded-2xl bg-slate-900/70 border border-white/10 p-4 shadow-lg",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50 mb-2",children:"Visit total"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,max:oe<=170?170:180,placeholder:"0â€“180",value:rn,onChange:t=>$r(t.target.value),onKeyDown:t=>{t.key==="Enter"&&an()}}),e.jsx("button",{className:"btn px-4 py-1 text-sm",onClick:an,title:"Commit a full 3-dart total like 93",children:"Commit Visit"})]}),e.jsx("div",{className:"mt-3",children:e.jsx($i,{value:rn,onChange:$r,onSubmit:an,helperText:"Tap numbers then Enter to commit the visit total."})})]})}),e.jsxs("div",{className:"col-span-12 md:col-span-4 space-y-3",children:[e.jsx("div",{className:"rounded-2xl bg-slate-900/70 border border-white/10 p-2 text-slate-100 shadow-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"rounded-lg bg-black/30 px-2 py-1",children:[e.jsx("div",{className:"uppercase tracking-wide text-white/50",children:"Current score"}),e.jsx("div",{className:"text-lg font-bold text-white",children:mi})]}),e.jsxs("div",{className:"rounded-lg bg-black/30 px-2 py-1",children:[e.jsx("div",{className:"uppercase tracking-wide text-white/50",children:"3-dart avg"}),e.jsx("div",{className:"text-lg font-bold text-emerald-300",children:fi.toFixed(1)})]})]})}),e.jsx("div",{className:"rounded-2xl bg-slate-900/70 border border-white/10 p-2 text-slate-100 shadow-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"rounded-lg bg-black/30 px-2 py-1",children:[e.jsx("div",{className:"uppercase tracking-wide text-white/50",children:"Game"}),e.jsxs("div",{className:"text-lg font-bold text-white",children:[p,p==="X01"?` / ${S}`:""]})]}),e.jsxs("div",{className:"rounded-lg bg-black/30 px-2 py-1",children:[e.jsx("div",{className:"uppercase tracking-wide text-white/50",children:"Format"}),e.jsxs("div",{className:"text-lg font-bold text-white",children:[Ze==="first"?"First to":"Best of"," ",yt," Â· ",me,"-",he]})]})]})}),e.jsxs("div",{className:"rounded-2xl bg-slate-900/70 border border-white/10 p-2 text-slate-100 shadow-lg",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50 mb-1",children:"Scoreboard"}),e.jsx(et,{gameMode:p,players:ui,matchScore:di})]})]}),e.jsx("div",{className:"col-span-12 md:col-span-4",children:e.jsxs("div",{className:"relative rounded-2xl bg-black/60 border border-white/10 overflow-hidden shadow-lg",children:[e.jsxs("div",{className:"absolute inset-x-0 top-0 z-10 flex items-center justify-between px-2 py-1 text-[11px] uppercase tracking-wide text-white/70 bg-black/40 backdrop-blur-sm",children:[e.jsx("span",{children:"Board camera"}),!N&&e.jsx("span",{className:"text-amber-300 font-semibold",children:"Camera disabled"})]}),N?e.jsx("div",{className:"bg-black aspect-video max-h-[420px]",children:e.jsx(Sa,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:()=>!1})}):e.jsx("div",{className:"p-4 text-sm text-slate-200/80",children:"Enable the camera to keep the board visible while you score."})]})})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Tap numbers then Enter to commit a 3-dart visit."})]}),e.jsx("div",{className:"flex flex-col gap-3 min-h-0 flex-1 text-[14px]",children:e.jsx("div",{className:"min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm",style:{willChange:"scroll-position",transform:"translateZ(0)",WebkitOverflowScrolling:"touch"}})}),p==="Cricket"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{if(t>0)return mn(t,s==="MISS"?void 0:s,a?.sector??null),!0}})}),p==="Shanghai"&&e.jsx(e.Fragment,{children:e.jsx(et,{gameMode:"Shanghai",players:Zs})}),p==="Shanghai"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{if(t>0)return hn(t,s==="MISS"?void 0:s,a?.sector??null),!0}})}),p==="Killer"&&e.jsx(e.Fragment,{children:e.jsx(et,{gameMode:"Killer",players:Js})}),p==="Scam"&&e.jsx(e.Fragment,{children:e.jsx(et,{gameMode:"Scam",players:en})}),p==="Scam"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{if(t>0)return mt(Nn(Me,t,s)),!0}})}),p==="Fives"&&e.jsx(e.Fragment,{children:e.jsx(et,{gameMode:"Fives",players:tn})}),p==="Fives"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{if(t>0)return ht(yn(ae,t)),!0}})}),p==="Sevens"&&e.jsx(e.Fragment,{children:e.jsx(et,{gameMode:"Sevens",players:sn})}),p==="Sevens"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(L,{scoringMode:"custom",showToolbar:C,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{if(t>0)return ft(Sn(ie,t)),!0}})})]}),e.jsx("div",{className:"h-1"})]})]})})})}),Cn&&e.jsx(wl,{onClose:()=>os(!1)}),fn&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const s=await(await fetch(`${Sl}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n?.email})})).json();s.ok&&s.url?(window.location.href=s.url,s.development&&Ve("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):s.error==="STRIPE_NOT_CONFIGURED"?Ve("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):Ve("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{Ve("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â·"," ",Fi(Ui(),5)]})]})]}),li&&typeof document<"u"?oa.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4",onClick:()=>ze(!1),children:e.jsx(Je,{storageKey:"ndn:modal:offline-camera-manager",className:"relative",defaultWidth:640,defaultHeight:520,minWidth:480,minHeight:420,maxWidth:1200,maxHeight:900,initialFitHeight:!0,onClose:()=>ze(!1),children:e.jsxs("div",{className:"space-y-3",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Camera Devices"}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Manage Offline Camera Feeds"})]}),e.jsx("button",{className:"btn bg-slate-800 hover:bg-slate-700 text-white",onClick:()=>ze(!1),children:"Close"})]}),e.jsx(_i,{fill:!0,user:n,playerScore:oe,aiScore:P,x01Score:S,inMatch:nt,showWinPopup:ds,pendingLegWinner:Lt,playerDartsThrown:br,aiDartsThrown:pr,totalPlayerDarts:_s,totalAiDarts:Ks,totalPlayerPoints:wr,totalAiPoints:Sr,player180s:kr,player140s:Ja,player100s:ei,ai180s:Dr,ai140s:ti,ai100s:si,playerHighestCheckout:ni,aiHighestCheckout:ri,onClose:()=>ze(!1),onOpen:()=>ze(!0),layout:je})]})})}),document.body):null,Zt&&typeof document<"u"?oa.createPortal((()=>{const{target:t,value:s,stage:a}=Zt,l=t==="player"?Ye:es,d=t==="player"?me:he;return e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4",onClick:jt,children:e.jsx(Je,{storageKey:"ndn:modal:offline-leg-override",className:"relative",defaultWidth:360,defaultHeight:240,minWidth:280,minHeight:200,maxWidth:420,maxHeight:360,initialFitHeight:!0,onClose:jt,children:e.jsxs("div",{className:"space-y-3 max-w-[18rem] mx-auto",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide text-white/50",children:["Step ",a," of 2"]}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Override legs?"})]}),e.jsx("div",{className:"text-sm text-slate-200 leading-relaxed",children:a===1?e.jsxs(e.Fragment,{children:["Set ",l,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:s}),"? Confirm to continue."]}):e.jsxs(e.Fragment,{children:["Final confirmation: set ",l,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:s}),". Select"," ",e.jsx("span",{className:"font-semibold text-emerald-200",children:"Yes"})," ","to apply immediately."]})}),e.jsxs("div",{className:"rounded-xl bg-black/40 border border-white/10 p-3 text-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50 mb-1",children:"Current legs"}),e.jsx("div",{className:"text-base font-semibold text-white",children:d})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:jt,children:"No"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:xi,children:"Yes"})]})]})})})})(),document.body):null,ds&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[99999]",children:e.jsxs(Je,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsxs("div",{className:"mb-2 text-sm text-slate-200",children:["Average:"," ",e.jsx("span",{className:"font-mono",children:Wi(H.players?.[H.currentPlayerIdx]?.currentThreeDartAvg??0)})]}),e.jsxs("div",{className:"grid gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white/60 mb-1",children:"Darts used at double"}),e.jsx("div",{className:"flex gap-2",children:[0,1,2,3].map(t=>e.jsx("button",{className:`btn px-3 py-1 text-sm ${Tt===t?"bg-brand-600":"btn--ghost"}`,onClick:()=>Mn(t),children:De(t)},`win-double-${t}`))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white/60 mb-1",children:"Darts at checkout"}),e.jsx("div",{className:"flex gap-2",children:[0,1,2,3].map(t=>e.jsx("button",{className:`btn px-3 py-1 text-sm ${Et===t?"bg-brand-600":"btn--ghost"}`,onClick:()=>Ln(t),children:De(t)},`win-checkout-${t}`))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:Mi,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{V(!1),Re()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{V(!1),Ue(!1),Be(!1)},children:"Back to Menu"})]})]})}),ii&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(Je,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[p," Â· ",S," start Â· First to ",Dt]}),(()=>{const t=_s>0?wr/_s*3:0,s=(()=>{const f=fe.filter(h=>h.winner==="player"&&typeof h.winnerDarts=="number").map(h=>h.winnerDarts);return f.length?`${Math.min(...f)} darts`:"â€”"})(),a=(()=>{const f=fe.filter(h=>h.winner==="player"&&typeof h.winnerDarts=="number").map(h=>h.winnerDarts);return f.length?`${Math.max(...f)} darts`:"â€”"})(),l=_t>0?Math.round(gr/_t*100):0,d=Ks>0?Sr/Ks*3:0,b=(()=>{const f=fe.filter(h=>h.winner==="ai"&&typeof h.winnerDarts=="number").map(h=>h.winnerDarts);return f.length?`${Math.min(...f)} darts`:"â€”"})(),g=(()=>{const f=fe.filter(h=>h.winner==="ai"&&typeof h.winnerDarts=="number").map(h=>h.winnerDarts);return f.length?`${Math.max(...f)} darts`:"â€”"})(),j=$t>0?Math.round(Nr/$t*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:St(n,"You")}),e.jsx("div",{className:"text-3xl font-extrabold",children:me}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:t.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:_t})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[l,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:s})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:a})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:kr})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[me," â€“ ",he]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:A==="None"?"Opponent":`${A} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:he}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:d.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:$t})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[j,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:b})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:g})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Dr})]})]})]})]})})(),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map((t,s)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${t.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",s+1,":"," ",t.winner==="player"?"You":A==="None"?"Opp":"AI"," ","Â· Dbl ",De(t.doubleDarts)," Â· CO"," ",De(t.checkoutDarts||0)]},s))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>zs(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{zs(!1),Re()},children:"Rematch"})]})]})}),fe.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:fe.map((t,s)=>e.jsxs("li",{children:["Leg ",s+1,": Double darts: ",De(t.doubleDarts),", Checkout darts: ",De(t.checkoutDarts||0)]},s))})]})]})]})}export{ho as default};
//# sourceMappingURL=OfflinePlay-VE-Tfudi.js.map

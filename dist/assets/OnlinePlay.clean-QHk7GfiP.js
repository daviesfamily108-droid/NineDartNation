import{y as Ke,i as ut,u as Ce,x as Lt,I as It,r as kt,j as e,t as le,J as Rt,K as ht,L as Pt,B as St,b as Ot,N as Bt,O as $t,Q as _t,g as At,S as Ft,k as K,l as de,T as Vt,o as lt,m as pt,M as Ct,U as Wt,G as Gt,C as Ut,P as zt,n as bt,p as Yt,F as Ht}from"./index-ALD5k1ur.js";import{r as n,X as Xt,p as Ye,I as qt,J as Qt,Z as dt,C as xt,o as Jt,R as De,T as Kt,K as Zt,U as ft,v as gt,h as wt}from"./ui-Cl5S-Tv0.js";import{A as _e,a as es,P as ts}from"./aroundTheClock-Cqqf9SE2.js";import{o as ss,l as as}from"./matchWindow-ByaZKbEG.js";import"./vendor-D3F3s8fL.js";function rs({open:o,onClose:c,onCreate:h}){const[p]=n.useState(()=>document.createElement("div")),[g,y]=n.useState("X01"),[d,A]=n.useState("bestof"),[G,w]=n.useState(3),k=n.useRef(null),[f,j]=n.useState(0),[x,O]=n.useState(()=>Ke(g)?.[0]),[R,b]=n.useState(()=>ut(g)),S=Ce().username||"Anonymous";function D(s){y(s);const l=Ke(s);O(l?.[0]),b(ut(s));const v=ht[s];if(v?.modeOptions?.length){const T=v.modeOptions.includes(d)?d:v.modeOptions[0];A(T)}}n.useLayoutEffect(()=>(p.className="ndn-create-match-portal",document.body.appendChild(p),()=>{try{p&&p.remove()}catch{}}),[p]),n.useLayoutEffect(()=>{function s(l){l.key==="Escape"&&c()}return o&&document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[o,c]);const U=Lt(g),u=It(g,d),N=le(g),C=()=>{const s={createdBy:S,game:g,modeType:d,legs:G,avgChoice:f,startingScore:x,...R};h(s),c()};return!o||!p?null:kt.createPortal(e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-2 sm:p-6",children:[e.jsx("button",{"aria-label":"Close dialog",className:"absolute inset-0 w-full h-full bg-transparent",onClick:c}),e.jsxs("div",{className:"rounded-2xl p-5 sm:p-6 max-w-lg w-full relative text-white shadow-2xl border border-indigo-500/30 max-h-[85vh] overflow-y-auto",style:{background:"var(--ndn-card-bg, #0f172a)"},role:"dialog",children:[e.jsx("button",{"aria-label":"Close",className:"absolute top-3 right-3 w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors",onClick:c,children:"‚úï"}),e.jsxs("h2",{className:"text-base sm:text-lg font-bold tracking-tight mb-3",children:[N.emoji," Create Match"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Created By"}),e.jsx("div",{className:"p-2 rounded-lg border border-indigo-500/20 bg-indigo-500/10 text-sm text-white",children:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-game",children:"Game"}),e.jsx("select",{id:"match-game",className:"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white",value:g,onChange:s=>D(s.target.value),onPointerDown:s=>{s.stopPropagation()},onMouseDown:s=>{s.stopPropagation()},onTouchStart:s=>{s.stopPropagation?.()},children:Rt.map(s=>{const l=le(s);return e.jsxs("option",{value:s,className:"bg-slate-900 text-white",children:[l.emoji," ",s]},s)})}),N.tagline&&e.jsx("div",{className:"text-[10px] mt-0.5 px-0.5",style:{color:N.color},children:N.tagline})]}),Ke(g).length>0?e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-start",children:`${g} Starting Score`}),e.jsx("select",{id:"match-start",className:"p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white w-full",value:x,onChange:s=>O(Number(s.target.value)),onPointerDown:s=>{s.stopPropagation()},onMouseDown:s=>{s.stopPropagation()},onTouchStart:s=>{s.stopPropagation?.()},children:Ke(g).map(s=>e.jsx("option",{value:s,className:"bg-slate-900 text-white",children:s},s))})]}):null,U.length>0&&e.jsx("div",{className:"space-y-2",children:U.map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:`match-extra-${s.key}`,children:s.label}),s.type==="select"&&s.options?e.jsx("select",{id:`match-extra-${s.key}`,className:"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white",value:R[s.key]??s.defaultValue,onChange:l=>b(v=>({...v,[s.key]:Number(l.target.value)})),onPointerDown:l=>{l.stopPropagation()},onMouseDown:l=>{l.stopPropagation()},onTouchStart:l=>{l.stopPropagation?.()},children:s.options.map(l=>e.jsx("option",{value:l,className:"bg-slate-900 text-white",children:l},l))}):e.jsx("input",{id:`match-extra-${s.key}`,type:"number",min:s.min??1,max:s.max,step:s.step??1,value:R[s.key]??s.defaultValue,onChange:l=>b(v=>({...v,[s.key]:Number(l.target.value)})),className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"}),s.hint&&e.jsx("div",{className:"text-[10px] text-slate-400 mt-0.5 px-0.5",children:s.hint})]},s.key))}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Mode"}),e.jsx("div",{className:"flex gap-2 mt-1 justify-center flex-wrap",children:(ht[g]?.modeOptions??["bestof","firstto"]).map(s=>e.jsxs("label",{className:`btn ${d===s?"btn-primary":"btn-ghost"}`,children:[e.jsx("input",{type:"radio",name:"mode",value:s,checked:d===s,onChange:()=>{A(s),w(s==="bestof"?l=>{const v=Math.max(1,l||3);return v%2===1?v:v+1}:l=>Math.max(1,l||3)),setTimeout(()=>k.current?.focus(),0)},className:"sr-only"})," ",s==="bestof"?"Best Of":s==="firstto"?"First To":s==="innings"?"Innings":s==="holes"?"Holes":s==="rounds"?"Rounds":s==="practice"?"Practice":s]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-legs",children:u}),e.jsx("input",{id:"match-legs",type:"number",min:1,value:G,onChange:s=>w(Math.max(1,Number(s.target.value||1))),ref:k,className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-avg",children:"Average Choice (¬±)"}),e.jsx("input",{id:"match-avg",type:"number",value:f,onChange:s=>j(Number(s.target.value||0)),className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-3 border-t border-indigo-500/20",children:[e.jsx("button",{className:"flex-1 btn btn-ghost text-xs",onClick:c,children:"Cancel"}),e.jsx("button",{className:"flex-1 btn text-xs",onClick:C,children:"Create Match"})]})]})]}),p)}const Le=400,_=Le/2,W=Le/2,ns=6.35,$e=15.9,it=99,ot=107,ct=162,et=170,te=(Le/2-15)/et,Tt=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5],Et={};Tt.forEach((o,c)=>{Et[o]=c%2===0?{dark:"#1a1a2e",light:"#c0392b"}:{dark:"#f0e6d3",light:"#27ae60"}});function vt(o){try{const c=Ot(o).toFixed(1),h=Bt(o).toFixed(1),p=$t(o),g=_t(o),y=At(o),d=Ft(o);return{avg3:c,best9:h,bestCheckout:p||"‚Äì",bestLeg:g||"‚Äì",lifetimeScored:y.scored||0,lifetimeDarts:y.darts||0,career180s:d||0}}catch{return{avg3:"0.0",best9:"0.0",bestCheckout:"‚Äì",bestLeg:"‚Äì",lifetimeScored:0,lifetimeDarts:0,career180s:0}}}function ze(o,c,h,p){const g=(p-90)*Math.PI/180;return{x:o+h*Math.cos(g),y:c+h*Math.sin(g)}}function ls(o,c){const h=o-_,p=c-W;return Math.sqrt(h*h+p*p)/te}function Ze({label:o,value:c,highlight:h}){return e.jsxs("div",{className:`flex flex-col items-center px-1.5 py-1 rounded-lg ${h?"bg-indigo-500/20 ring-1 ring-indigo-500/30":"bg-white/5"}`,children:[e.jsx("span",{className:"text-[7px] sm:text-[8px] uppercase tracking-wider font-bold text-white/50",children:o}),e.jsx("span",{className:`text-xs sm:text-sm font-black ${h?"text-indigo-300":"text-white"}`,children:c})]})}function is({onSelect:o,selectedPoint:c,disabled:h,label:p}){const g=n.useRef(null),y=n.useCallback((w,k)=>{const f=g.current;if(!f)return null;const j=f.getBoundingClientRect(),x=(w-j.left)/j.width*Le,O=(k-j.top)/j.height*Le,R=ls(x,O);return{x,y:O,dist:Math.round(R*10)/10}},[]),d=n.useCallback(w=>{if(h)return;const k=y(w.clientX,w.clientY);k&&o(k.x,k.y,k.dist)},[o,h,y]),A=n.useCallback(w=>{if(h)return;w.preventDefault();const k=w.changedTouches[0];if(!k)return;const f=y(k.clientX,k.clientY);f&&o(f.x,f.y,f.dist)},[o,h,y]),G=n.useMemo(()=>{const w=[];for(let f=0;f<20;f++){const j=Tt[f],x=f*18-18/2,O=x+18,R=Et[j];[{inner:ot,outer:ct,fill:R.dark},{inner:ct,outer:et,fill:R.light},{inner:$e,outer:it,fill:R.dark},{inner:it,outer:ot,fill:R.light}].forEach((D,U)=>{const u=D.inner*te,N=D.outer*te,C=ze(_,W,u,x),s=ze(_,W,N,x),l=ze(_,W,N,O),v=ze(_,W,u,O),T=0,L=[`M ${C.x} ${C.y}`,`L ${s.x} ${s.y}`,`A ${N} ${N} 0 ${T} 1 ${l.x} ${l.y}`,`L ${v.x} ${v.y}`,`A ${u} ${u} 0 ${T} 0 ${C.x} ${C.y}`,"Z"].join(" ");w.push(e.jsx("path",{d:L,fill:D.fill,stroke:"rgba(255,255,255,0.08)",strokeWidth:.5,opacity:.85},`s${j}-r${U}`))});const S=ze(_,W,(et+12)*te,f*18);w.push(e.jsx("text",{x:S.x,y:S.y,textAnchor:"middle",dominantBaseline:"central",fill:"rgba(255,255,255,0.8)",fontSize:"11",fontWeight:"bold",fontFamily:"system-ui, sans-serif",children:j},`label-${j}`))}return w},[]);return e.jsxs("div",{className:"relative",children:[p&&e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${h&&c?"text-emerald-400":"text-white/50"}`,children:p})}),e.jsxs("svg",{ref:g,viewBox:`0 0 ${Le} ${Le}`,className:`w-full h-full touch-none select-none ${h?"pointer-events-none":"cursor-crosshair"}`,style:{opacity:h&&!c?.5:1},onClick:d,onTouchEnd:A,children:[e.jsx("circle",{cx:_,cy:W,r:_,fill:"#0a0a1a"}),G,e.jsx("circle",{cx:_,cy:W,r:it*te,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:_,cy:W,r:ot*te,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:_,cy:W,r:ct*te,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:_,cy:W,r:et*te,fill:"none",stroke:"rgba(192,192,192,0.2)",strokeWidth:1}),e.jsx("circle",{cx:_,cy:W,r:$e*te,fill:"#27ae60",stroke:"rgba(192,192,192,0.2)",strokeWidth:.8}),e.jsx("circle",{cx:_,cy:W,r:ns*te,fill:"#c0392b",stroke:"rgba(192,192,192,0.2)",strokeWidth:.8}),!c&&!h&&e.jsxs("circle",{cx:_,cy:W,r:$e*te*1.8,fill:"none",stroke:"rgba(234,179,8,0.4)",strokeWidth:1.5,strokeDasharray:"4,4",children:[e.jsx("animate",{attributeName:"r",values:`${$e*te*1.5};${$e*te*2.2};${$e*te*1.5}`,dur:"2s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",values:"0.5;0.15;0.5",dur:"2s",repeatCount:"indefinite"})]}),e.jsx("line",{x1:_-6,y1:W,x2:_+6,y2:W,stroke:"rgba(255,255,255,0.25)",strokeWidth:.5}),e.jsx("line",{x1:_,y1:W-6,x2:_,y2:W+6,stroke:"rgba(255,255,255,0.25)",strokeWidth:.5}),c&&e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:_,y1:W,x2:c.x,y2:c.y,stroke:h?"rgba(34,197,94,0.6)":"rgba(234,179,8,0.5)",strokeWidth:1,strokeDasharray:"3,3"}),e.jsx("circle",{cx:c.x+1,cy:c.y+1,r:6,fill:"rgba(0,0,0,0.4)"}),e.jsx("circle",{cx:c.x,cy:c.y,r:6,fill:h?"#22c55e":"#eab308",stroke:"#fff",strokeWidth:2,className:"drop-shadow-lg"}),e.jsx("circle",{cx:c.x,cy:c.y,r:2.5,fill:"#fff"}),h&&e.jsx("text",{x:c.x,y:c.y-14,textAnchor:"middle",fill:"#22c55e",fontSize:"10",fontWeight:"bold",children:"üîí"})]})]})]})}function jt({name:o,stats:c,isLocal:h,showCamera:p,isWinner:g,legDiff:y}){const d=typeof y=="number"?`${y>0?"+":""}${y}`:null;return e.jsxs("div",{className:`relative rounded-xl border p-2 sm:p-3 transition-all duration-500 ${g?"border-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/5 shadow-xl shadow-amber-500/10 ring-1 ring-amber-400/30":"border-white/10 bg-white/5"}`,children:[g&&e.jsxs("div",{className:"absolute -top-2.5 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-amber-500 text-black text-[9px] font-black uppercase tracking-widest rounded-full shadow-lg",children:[e.jsx(Jt,{className:"w-2.5 h-2.5 inline mr-0.5"}),"Throws First"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-black ${h?"bg-gradient-to-br from-indigo-500 to-purple-600 text-white":"bg-gradient-to-br from-rose-500 to-orange-500 text-white"}`,children:o.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-sm sm:text-base tracking-tight",children:o}),e.jsx("div",{className:"text-[9px] text-white/50 font-semibold uppercase tracking-wider",children:h?"You":"Opponent"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 mb-2",children:[e.jsx(Ze,{label:"Avg",value:c.avg3,highlight:!0}),e.jsx(Ze,{label:"F9",value:c.best9}),e.jsx(Ze,{label:"CO",value:String(c.bestCheckout)}),e.jsx(Ze,{label:"Leg Diff",value:d??"0"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[9px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"180s"}),e.jsx("span",{className:"font-bold text-white",children:c.career180s})]}),e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Scored"}),e.jsx("span",{className:"font-bold text-white",children:c.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Darts"}),e.jsx("span",{className:"font-bold text-white",children:c.lifetimeDarts.toLocaleString()})]})]}),p&&e.jsxs("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/40",children:[e.jsxs("div",{className:"px-2 py-1 flex items-center gap-1.5 text-[9px] text-white/60 border-b border-white/5",children:[e.jsx(xt,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-semibold uppercase tracking-wider",children:h?"Your Camera":"Opponent Camera"}),e.jsx("span",{className:"ml-auto text-emerald-400 font-bold",children:"‚óè Live"})]}),e.jsx("div",{className:"aspect-video relative bg-black",children:h?e.jsx(St,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",tileFitModeOverride:"fit",scale:1}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/30 text-[10px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xt,{className:"w-6 h-6 mx-auto mb-1 opacity-30"}),"Waiting for opponent's feed‚Ä¶"]})})})]})]})}function os({open:o,matchInfo:c,localUser:h,opponentName:p,opponentStats:g,countdown:y=15,onChoice:d,onBullThrow:A,onAccept:G,onCancel:w,remoteChoice:k,bullActive:f,bullWinner:j,bullTied:x}){const[O,R]=n.useState(y),[b,S]=n.useState("preview"),[D,U]=n.useState(null),[u,N]=n.useState(null),[C,s]=n.useState(null),[l,v]=n.useState(!1),[T,L]=n.useState(!1),$=n.useRef(typeof document<"u"?document.createElement("div"):null),je=n.useMemo(()=>vt(h?.username||""),[h?.username]),ae=n.useMemo(()=>g?{avg3:g.avg3||"0.0",best9:g.best9||"0.0",bestCheckout:g.bestCheckout||"‚Äì",bestLeg:g.bestLeg||"‚Äì",career180s:g.career180s||0,lifetimeScored:0,lifetimeDarts:0}:vt(p),[p,g]);n.useEffect(()=>{const P=$.current;if(!(!P||typeof document>"u"))return P.className="ndn-match-prestart-portal",document.body.appendChild(P),()=>{try{P.parentNode?.removeChild(P)}catch{}}},[]),n.useEffect(()=>{o&&(R(y),S("preview"),U(null),N(null),s(null),v(!1),L(!1))},[o,y]),n.useEffect(()=>{if(!o||b==="result"||b==="go")return;const P=window.setInterval(()=>{R(ie=>{const ue=ie-1;return ue<=0?(window.clearInterval(P),b==="preview"?(S("choice"),y):(b==="choice"&&!D&&(U("skip"),d("skip")),0)):(b==="preview"&&y-ue>=5&&S("choice"),ue)})},1e3);return()=>window.clearInterval(P)},[o,b,y,D,d]),n.useEffect(()=>{f&&(S("bull"),N(null),s(null),v(!1),L(!1))},[f]),n.useEffect(()=>{if(j){S("result");const P=setTimeout(()=>S("go"),3e3);return()=>clearTimeout(P)}},[j]),n.useEffect(()=>{x&&(N(null),s(null),v(!1),L(!1),S("bull"))},[x]),n.useEffect(()=>{if(D==="skip"&&k==="skip"){S("result");const P=setTimeout(()=>S("go"),2e3);return()=>clearTimeout(P)}},[D,k]),n.useEffect(()=>{if(b!=="go")return;const P=setTimeout(()=>{G()},1500);return()=>clearTimeout(P)},[b,G]);const se=n.useCallback((P,ie,ue)=>{l||(N({x:P,y:ie}),s(ue),v(!0))},[l]),ye=n.useCallback(()=>{C!=null&&(L(!0),A(C))},[C,A]),Y=n.useCallback(P=>{U(P),d(P)},[d]),E=h?.username||"You",re=n.useMemo(()=>Pt(E,p),[E,p]),xe=re.played?re.diffA:null,Q=re.played?re.diffB:null;if(!o||!$.current||!c)return null;const Ae=j===E,ne=j===p,Te=D==="skip"&&k==="skip",me=e.jsxs("div",{className:"fixed inset-0 z-[9998] bg-black/95 backdrop-blur-xl flex flex-col",style:{height:"100dvh",maxHeight:"100dvh",overflow:"hidden"},role:"dialog","aria-modal":"true","aria-label":"Match pre-start",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-2 sm:p-4 min-h-0",children:e.jsxs("div",{className:"relative w-full max-w-5xl max-h-full flex flex-col",children:[e.jsx("button",{className:"absolute -top-2 -right-2 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition-all border border-white/10",onClick:w,"aria-label":"Cancel match",children:e.jsx(Xt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-2 sm:mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] sm:text-[11px] font-bold uppercase tracking-widest text-white/60 mb-2",children:[e.jsx(Ye,{className:"w-3 h-3"}),c.game," ¬∑"," ",c.modeType==="bestof"?"Best Of":"First To"," ",c.legs," ¬∑ ",c.startingScore||501]}),b==="preview"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tighter",children:"Match Found"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:"Reviewing opponent stats‚Ä¶"})]}),b==="choice"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white tracking-tighter",children:"Who Throws First?"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:"Bull up to decide, or skip and let the creator go first"})]}),b==="bull"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-amber-300 tracking-tighter",children:"üéØ Bull Up!"}),e.jsx("p",{className:"text-[10px] sm:text-xs text-white/50 mt-0.5",children:"Throw your dart at the bullseye, then tap where it landed on the board"}),e.jsx("p",{className:"text-[9px] text-white/30",children:"Both players mark their throw ‚Äî closest to the bull throws first"})]}),b==="result"&&e.jsx("div",{className:"animate-in fade-in zoom-in-95 duration-700",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-amber-500 tracking-tighter",children:["üéâ ",j," Wins the Bull!"]}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/50 mt-1",children:[j," throws first"]})]}):Te?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white tracking-tighter",children:"Both Players Skipped"}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:[c.createdBy||c.creatorName||E," ","throws first"]})]}):null}),b==="go"&&e.jsx("div",{className:"animate-in fade-in zoom-in-50 duration-300",children:e.jsx("h2",{className:"text-5xl sm:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500 tracking-tighter",children:"GO!"})})]}),b!=="result"&&b!=="go"&&e.jsxs("div",{className:"mb-2 sm:mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(qt,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white/40"}),e.jsx("span",{className:"text-xl sm:text-2xl font-black text-white tabular-nums",children:O}),e.jsx("span",{className:"text-[10px] sm:text-xs text-white/40 font-semibold",children:"seconds"})]}),e.jsx("div",{className:"h-0.5 sm:h-1 bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000 ease-linear",style:{width:`${O/y*100}%`}})})]}),(b==="preview"||b==="choice"||b==="result")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-2 sm:gap-4 items-start mb-2 sm:mb-4 flex-shrink-0",children:[e.jsx(jt,{name:E,stats:je,isLocal:!0,showCamera:b==="preview",legDiff:xe,isWinner:b==="result"&&(Ae||Te&&(c.createdBy===E||c.creatorName===E))}),e.jsxs("div",{className:"hidden md:flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-indigo-500/30 ring-2 ring-white/10",children:"VS"}),e.jsx("div",{className:"w-px h-12 bg-gradient-to-b from-indigo-500/30 to-transparent mt-2"})]}),e.jsx("div",{className:"flex md:hidden items-center justify-center py-2",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-xl shadow-indigo-500/30",children:"VS"})}),e.jsx(jt,{name:p,stats:ae,isLocal:!1,showCamera:b==="preview",legDiff:Q,isWinner:b==="result"&&(ne||Te&&(c.createdBy===p||c.creatorName===p))})]}),b==="choice"&&!D&&e.jsx("div",{className:"flex flex-col items-center gap-3 animate-in fade-in slide-in-from-bottom-4 duration-500 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{className:"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 text-white font-black text-base sm:text-lg hover:shadow-xl hover:shadow-amber-500/30 hover:scale-105 transition-all duration-200 border border-amber-400/30",onClick:()=>Y("bull"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Bull Up"})]}),e.jsx("div",{className:"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-80",children:"Throw at the bullseye to decide"})]}),e.jsxs("button",{className:"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-white/5 border border-white/10 text-white font-bold text-base sm:text-lg hover:bg-white/10 hover:border-white/20 hover:scale-105 transition-all duration-200",onClick:()=>Y("skip"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5"}),e.jsx("span",{children:"Skip"})]}),e.jsx("div",{className:"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-50",children:"Creator throws first"})]})]})}),b==="choice"&&D&&!f&&e.jsx("div",{className:"text-center animate-in fade-in duration-300",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-white/70",children:[e.jsx(dt,{className:"w-4 h-4 text-amber-400"}),"You chose"," ",e.jsx("span",{className:"font-bold text-white",children:D==="bull"?"Bull Up":"Skip"}),k?e.jsxs(e.Fragment,{children:[" ","¬∑ Opponent chose"," ",e.jsx("span",{className:"font-bold text-white",children:k==="bull"?"Bull Up":"Skip"})]}):e.jsxs(e.Fragment,{children:[" ","¬∑ Waiting for opponent",e.jsx("span",{className:"animate-pulse",children:"‚Ä¶"})]})]})}),b==="bull"&&e.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-3 animate-in fade-in zoom-in-95 duration-500 flex-1 min-h-0 overflow-hidden",children:[e.jsx("div",{className:"w-full max-w-[280px] sm:max-w-sm mx-auto rounded-xl border border-white/10 bg-black/60 overflow-hidden shadow-xl shadow-black/40 flex-shrink-0",children:e.jsxs("div",{className:"relative aspect-[16/10]",children:[e.jsx(St,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",className:"w-full h-full"}),e.jsxs("div",{className:"absolute top-1 left-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-black/60 backdrop-blur-sm border border-white/10",children:[e.jsx(xt,{className:"w-2.5 h-2.5 text-emerald-400"}),e.jsx("span",{className:"text-[9px] font-bold text-white/80 uppercase tracking-wider",children:"Live Feed"})]}),e.jsx("div",{className:"absolute top-1 right-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30",children:e.jsx("span",{className:"text-[9px] font-bold text-emerald-400",children:"‚óè LIVE"})})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] sm:text-xs text-white/50 flex-shrink-0",children:[e.jsx(Ye,{className:"w-3 h-3 text-amber-400"}),e.jsx("span",{children:"See your dart above, then tap the board below where it landed"})]}),e.jsx("div",{className:"w-full max-w-[240px] sm:max-w-[280px] md:max-w-xs mx-auto rounded-xl border border-white/10 bg-black/40 p-2 sm:p-3 shadow-2xl shadow-black/50 flex-1 min-h-0",children:e.jsx(is,{onSelect:se,selectedPoint:u,disabled:l||T,label:l?"Dart position locked":"Tap where your dart landed"})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-3 flex-shrink-0",children:[C!=null&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-xl bg-white/5 border border-white/10 animate-in fade-in duration-300",children:[e.jsx(Ye,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-xl font-black text-white tabular-nums",children:C.toFixed(1)}),e.jsx("span",{className:"text-sm text-white/50",children:"mm"})]}),T?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-xs text-white/70",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-amber-400/30 border-t-amber-400 rounded-full animate-spin"}),"Waiting for opponent‚Ä¶"]}):e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-emerald-500/30 hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:pointer-events-none border border-emerald-400/30",disabled:C==null,onClick:ye,children:"‚úÖ Confirm"})]}),x&&e.jsx("div",{className:"text-xs text-amber-300 font-bold animate-bounce px-3 py-1.5 rounded-lg bg-amber-500/10 border border-amber-500/20 flex-shrink-0",children:"üîÑ It's a tie! Throw again."})]}),b==="preview"&&e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 mt-2 sm:mt-4 flex-shrink-0",children:[e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-indigo-500/30 hover:scale-105 transition-all",onClick:()=>S("choice"),children:"Ready ‚Äî Continue"}),e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-white/5 border border-white/10 text-white/70 font-semibold text-sm sm:text-base hover:bg-white/10 transition-all",onClick:w,children:"Cancel"})]})]})})]});return kt.createPortal(me,$.current)}const cs=[..._e].reverse();function yt(o){return o===25?"Outer Bull":o===50?"Inner Bull":String(o)}function Nt({direction:o,onPickDirection:c,currentTargetIndex:h,isUsersTurn:p,onTurnComplete:g,onDartHit:y,completed:d,playerName:A}){const G=o==="bull-to-1"?cs:_e,w=G.length,k=h>=w,[f,j]=n.useState([null,null,null]),x=f.filter(l=>l!==null).length,O=f.filter(l=>l==="hit").length,[R,b]=n.useState([]),S=h,D=G[S]??null,U=n.useCallback(()=>{j([null,null,null]),b([])},[]),u=n.useCallback(l=>{if(x>=3||k)return;const v=[...f];v[x]=l,j(v);let T=0;if(l==="hit"&&(T=G[S]??0,b($=>[...$,T]),y()),x+1>=3){const $=v.filter(ae=>ae==="hit").length,je=l==="hit"?[...R,T].reduce((ae,se)=>ae+se,0):R.reduce((ae,se)=>ae+se,0);setTimeout(()=>{g($,je),U()},350)}},[f,x,k,G,S,R,y,g,U]);if(!o)return e.jsxs("div",{className:"relative w-full rounded-2xl border-2 border-dashed border-indigo-400/40 bg-indigo-500/5 p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"text-indigo-300/70 text-xs sm:text-sm uppercase tracking-widest font-semibold mb-4",children:"Choose Direction"}),e.jsx("p",{className:"text-white/70 text-sm mb-6",children:"The first thrower picks the order for both players."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs("button",{type:"button",className:"px-6 py-4 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 active:scale-95 transition-all text-center",onClick:()=>c("1-to-bull"),children:[e.jsx("div",{className:"font-bold text-emerald-200 text-lg",children:"1 ‚Üí Bull"}),e.jsx("div",{className:"text-emerald-300/60 text-xs mt-1",children:"Start at 1, finish on Bullseye"})]}),e.jsxs("button",{type:"button",className:"px-6 py-4 rounded-2xl border border-amber-400/40 bg-amber-500/10 hover:bg-amber-500/20 active:scale-95 transition-all text-center",onClick:()=>c("bull-to-1"),children:[e.jsx("div",{className:"font-bold text-amber-200 text-lg",children:"Bull ‚Üí 1"}),e.jsx("div",{className:"text-amber-300/60 text-xs mt-1",children:"Start at Bullseye, finish on 1"})]})]})]});if(k&&x===0)return e.jsxs("div",{className:"relative w-full rounded-2xl border border-emerald-400/30 bg-emerald-500/10 p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"üéØ"}),e.jsx("div",{className:"font-bold text-emerald-200 text-xl",children:"Around the Clock Complete!"}),e.jsxs("div",{className:"text-emerald-300/60 text-sm mt-2",children:["All ",w," targets hit"]})]});const N=w>0?Math.round(d/w*100):0,C=G.slice(S+1,S+6),s=x>=3;return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider text-slate-400 font-semibold",children:"Progress"}),e.jsxs("span",{className:"text-xs text-slate-400 tabular-nums font-medium",children:[d," / ",w," (",N,"%)"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-white/10 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-300",style:{width:`${N}%`}})}),e.jsxs("div",{className:"mt-2 text-[10px] text-slate-500",children:["Direction:"," ",o==="1-to-bull"?"1 ‚Üí 20 ‚Üí Bull":"Bull ‚Üí 20 ‚Üí 1"]})]}),p&&e.jsx("div",{className:"flex items-center justify-center gap-3",children:f.map((l,v)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"text-[9px] uppercase tracking-wider text-slate-500 font-semibold",children:["Dart ",v+1]}),e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold border-2 transition-all ${l==="hit"?"bg-emerald-500/20 border-emerald-400/60 text-emerald-300":l==="miss"?"bg-rose-500/20 border-rose-400/60 text-rose-300":v===x?"bg-white/10 border-white/30 text-white/60 animate-pulse":"bg-white/5 border-white/10 text-white/20"}`,children:l==="hit"?"‚úì":l==="miss"?"‚úó":"‚Ä¢"})]},v))}),e.jsxs("div",{className:`relative w-full rounded-2xl border-2 p-6 sm:p-8 text-center transition-all ${p&&!s?"border-emerald-400/40 bg-emerald-500/5":p&&s?"border-amber-400/40 bg-amber-500/5":"border-white/10 bg-white/5 opacity-60"}`,children:[A&&e.jsx("div",{className:"text-[10px] uppercase tracking-widest text-slate-400 mb-1",children:p?"Your target":`${A}'s target`}),e.jsx("div",{className:"text-emerald-300/60 text-xs sm:text-sm uppercase tracking-widest font-semibold mb-2",children:s?"Turn Complete":`Current Target ‚Äî Dart ${x+1} of 3`}),e.jsx("div",{className:"font-mono text-6xl sm:text-7xl font-black text-white leading-none mb-4",children:k?"‚úì":D!=null?yt(D):"‚Äî"}),p&&!s&&!k&&e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{type:"button",className:"flex-1 max-w-[10rem] py-4 rounded-2xl text-lg font-bold bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border border-emerald-400/30 text-white shadow-lg shadow-emerald-600/30 transition-all active:scale-95",onClick:()=>u("hit"),children:"‚úì Hit"}),e.jsx("button",{type:"button",className:"flex-1 max-w-[10rem] py-4 rounded-2xl text-lg font-bold bg-rose-600/80 hover:bg-rose-500 active:bg-rose-400 border border-rose-400/30 text-white shadow-lg shadow-rose-600/20 transition-all active:scale-95",onClick:()=>u("miss"),children:"‚úó Miss"})]}),p&&s&&e.jsx("div",{className:"text-sm text-amber-200/70 mt-2 animate-pulse",children:"Submitting turn‚Ä¶"}),!p&&e.jsx("div",{className:"text-sm text-white/40 mt-2",children:"Waiting for opponent‚Ä¶"})]}),p&&x>0&&e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-emerald-300 font-semibold",children:["Hits: ",O]}),e.jsxs("span",{className:"text-rose-300 font-semibold",children:["Misses: ",x-O]})]}),C.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wider text-slate-500 font-semibold whitespace-nowrap",children:"Next:"}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:C.map((l,v)=>e.jsx("span",{className:"px-2.5 py-1 rounded-lg bg-white/5 border border-white/10 text-xs text-white/60 font-medium tabular-nums",children:yt(l)},v))})]})]})}function ds({user:o,showStartShowcase:c,onShowStartShowcaseChange:h,onCommitVisit:p,onQuit:g,onPause:y,onResume:d,onPauseDurationSelected:A,onStateChange:G,localPlayerIndexOverride:w,gameModeOverride:k,isOnline:f,remoteStream:j}){const x=K();Ce(r=>r.hideInGameSidebar??!0),de(r=>r.setPaused),de(),Vt();const[O,R]=n.useState(null),[b]=n.useState(null),S=n.useRef(null);n.useEffect(()=>{const r=S.current;if(!(!r||!j))return r.srcObject=j,r.play().catch(()=>{}),()=>{r.srcObject=null}},[j]);const D=Ce(r=>r.lastOffline?.x01Start||501),U=Ce(r=>r.user),u=lt(o,"")||lt(U,"")||o?.email?.split("@")[0]||U?.email?.split("@")[0]||"You",N=typeof w=="number"&&w>=0?w:(x.players||[]).findIndex(r=>r?.name&&r.name===u),C=N>=0?N:0,s=(x.currentPlayerIdx??0)===C,l=x.players?.[C],v=l?.legs?.[l.legs.length-1],T=v?.totalScoreRemaining??x.startingScore??D,L=(x.players||[]).findIndex((r,m)=>m!==C),$=(x.players||[])[L>=0?L:0],je=$?.legs?.[$.legs.length-1],ae=je?.totalScoreRemaining??x.startingScore??D,se=n.useMemo(()=>{const r=m=>{if(!m)return{lastVisit:0,avg3:0};let F=0,I=0;for(const z of m.legs||[])F+=(z.totalScoreStart??0)-(z.totalScoreRemaining??0),I+=(z.visits||[]).reduce((H,X)=>H+(X.darts||0)-(X.preOpenDarts||0),0);const V=(m.legs?.[m.legs.length-1]?.visits||[]).slice(-1)[0];return{lastVisit:V?.score??V?.visitTotal??0,avg3:I>0?F/I*3:0}};return{local:r(l),away:r($)}},[l,$,v?.visits?.length,je?.visits?.length]),ye=s?T:ae,Y=k||x?.game||"X01",E=Y==="X01",re=es(Y,x),xe=Y==="Around the Clock",[Q,Ae]=n.useState(null),[ne,Te]=n.useState({});Q==="bull-to-1"?[..._e].reverse():_e;const me=ne[C]??0,P=ne[L>=0?L:1]??0,ie=n.useMemo(()=>{const r=(m,F)=>{const I=re[F];if(E){const V=m?.legs?.[m.legs.length-1];return{primary:String(V?.totalScoreRemaining??x.startingScore??D),primaryLabel:"Remaining"}}if(Y==="Around the Clock"){const V=F===0?C:L>=0?L:1,z=ne[V]??0,H=Q==="bull-to-1"?[..._e].reverse():_e,X=H[z],Me=z>=H.length?"Done!":X===25?"Outer Bull":X===50?"Inner Bull":String(X);return{primary:z>=H.length?"‚úì":Me,primaryLabel:z>=H.length?"Complete":`Target ${z+1}/${H.length}`}}if(Y==="Cricket"||Y==="American Cricket")return{primary:String(I?.points??0),primaryLabel:"Points"};if(Y==="Killer"){const V=I?.lives??0;return{primary:I?.eliminated?"OUT":String(V),primaryLabel:I?.eliminated?"Eliminated":"Lives"}}return{primary:String(I?.score??I?.points??0),primaryLabel:"Score"}};return{local:r(l,C),away:r($,L>=0?L:0)}},[E,Y,re,l,$,C,L,x.startingScore,D,ne,Q]),ue=Ce(r=>r.callerEnabled),Fe=Ce(r=>r.callerVoice),mt=Ce(r=>r.callerVolume),He=Ce(r=>r.speakCheckoutOnly),[tt,he]=n.useState(!1),Ie=de(r=>r.setPaused),Ne=de(r=>r.paused),Re=de(r=>r.pauseEndsAt);de(r=>r.pauseInitiator);const[Ve,st]=n.useState(Date.now());n.useEffect(()=>(document.documentElement.setAttribute("data-ndn-ingame","true"),()=>{document.documentElement.removeAttribute("data-ndn-ingame")}),[]),n.useEffect(()=>{if(!Ne||!Re)return;const r=setInterval(()=>{const m=Date.now();st(m),m>=Re&&Ie(!1,null)},250);return()=>clearInterval(r)},[Ne,Re,Ie]);const at=n.useMemo(()=>{if(!E||T>170||T<=0)return null;const r=pt(T);return r&&r.length>0?r:null},[E,T]),ke=n.useMemo(()=>{if(!E||ye>170||ye<=0)return null;const r=pt(ye);return r&&r.length>0?r:null},[E,ye]),oe=E?180:999,pe=n.useMemo(()=>(x.players||[]).map(m=>({name:m.name||"Player",legsWon:m.legsWon||0})),[x.players]),rt=n.useMemo(()=>(x.players||[]).some(r=>(r.legs||[]).some(m=>(m.visits||[]).length>0)),[x.players]),Se=typeof c=="boolean"?c&&!rt:!1,Xe=r=>{h?.(r)},[be,fe]=n.useState(!1),[B,J]=n.useState(""),ce=n.useRef(null);n.useEffect(()=>{be&&ce.current&&ce.current.focus()},[be]);const[ge,Ee]=n.useState(null),[We,we]=n.useState(0);n.useEffect(()=>{s?(Ee(null),we(0)):Ee(Date.now())},[s]),n.useEffect(()=>{if(!ge)return;const r=setInterval(()=>{we(Math.floor((Date.now()-ge)/1e3))},1e3);return()=>clearInterval(r)},[ge]);const Z=(r,m,F)=>{const I=x.players?.[x.currentPlayerIdx],V=I?.legs?.[I.legs.length-1],z=V?V.totalScoreRemaining:x.startingScore,H=typeof r=="number"?r:0;let X=z-H;(!Number.isFinite(X)||X<0)&&(X=0);const Me=X===0&&H>0,t={visitTotal:H,...F||{}};if(t.doubleWindowDarts==null){let a=0;z<=50?a=m:z<=170&&(a=Me||X<=50?1:0),t.doubleWindowDarts=a}if(t.finishedByDouble==null&&(t.finishedByDouble=Me),p){p(H,m,t);return}if(ue){const a=I?.name||lt(o,"Player");try{Yt(a,H,X,Fe,{volume:mt,checkoutOnly:He})}catch{}}x.addVisit(H,m,t),Me?x.endLeg(H):x.nextPlayer(),G?.()},ve=n.useCallback(()=>{const r=x.currentPlayerIdx??C;Te(m=>({...m,[r]:(m[r]??0)+1}))},[x.currentPlayerIdx,C]),nt=n.useCallback((r,m)=>{Z(m,3,{visitTotal:m,atcHit:r>0,atcHits:r})},[]),qe=n.useCallback(()=>{try{const r=[];if((x.players||[]).forEach(I=>{(I.legs||[]).forEach(V=>{if(V?.finished){const z=(V.visits||[]).slice(-1)[0];r.push({ts:V.endTime||Date.now(),visit:z,player:I})}})}),!r.length)return null;const m=r.sort((I,V)=>V.ts-I.ts)[0],F=(m.visit?.entries||[]).slice(-1)[0];if(F?.label)return F.label;if(F?.ring==="DOUBLE"&&typeof F?.value=="number")return`Double ${F.value/2}`;if(typeof m.visit?.visitTotal=="number")return`Checkout ${m.visit.visitTotal}`}catch{}return null},[x.players]);return n.useEffect(()=>{if(x.inProgress){R(null);return}if(!O?.label){const r=qe();r&&R(m=>({...m,label:r}))}},[x.inProgress,qe,O?.label]),e.jsxs("div",{className:"ndn-game-shell ndn-page ndn-ingame-active relative overflow-hidden",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-32 -left-32 w-96 h-96 rounded-full bg-indigo-600/10 blur-[120px]"}),e.jsx("div",{className:"absolute -bottom-32 -right-32 w-96 h-96 rounded-full bg-amber-500/8 blur-[120px]"})]}),Se&&e.jsx(Ct,{open:Se,players:x.players||[],onDone:()=>{Xe(!1)},onRequestClose:()=>{Xe(!1)},showCalibrationDefault:!0}),e.jsx("div",{className:"z-20 mb-1 shrink-0",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-2 px-3 sm:px-5 py-1.5 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-lg",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-r from-indigo-500/10 via-transparent to-amber-500/10"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm leading-none z-10",children:[f&&e.jsx("span",{className:"px-2.5 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-[10px] sm:text-xs font-semibold tracking-wide",children:"üåê Online"}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-xs font-semibold tracking-wide",children:[Y,E?` / ${x.startingScore||D}`:""]}),pe.length>=2&&e.jsxs("span",{className:"font-bold text-white/90 text-sm tabular-nums",children:["Legs: ",pe[0].legsWon," ‚Äì ",pe[1].legsWon]})]}),e.jsxs("div",{className:"flex items-center gap-2 z-10",children:[e.jsx(Wt,{}),e.jsx("button",{className:"px-4 py-1.5 rounded-xl text-sm font-semibold bg-rose-600/90 hover:bg-rose-500 text-white border border-rose-400/30 shadow-lg shadow-rose-500/20 transition-all",onClick:()=>he(!0),children:"‚è∏ Quit / Pause"})]})]})}),e.jsxs("div",{className:"relative mb-1 rounded-2xl border border-white/10 overflow-hidden shrink-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-950/80 via-slate-900/90 to-amber-950/80"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(255,255,255,0.03),transparent_70%)]"}),e.jsxs("div",{className:"relative grid grid-cols-[minmax(0,1fr)_auto_minmax(0,1fr)] items-center py-1.5 px-3 sm:px-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("div",{className:`text-xs font-bold uppercase tracking-widest ${s?"text-emerald-400":"text-slate-400"}`,children:l?.name||"You"}),E&&e.jsxs("span",{className:"text-[10px] font-semibold text-slate-400 tabular-nums",children:["(",l?.legsWon||0,")"]}),s&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"})]}),e.jsx("div",{className:`font-mono text-3xl sm:text-4xl font-black tabular-nums leading-none ${s?"text-white":"text-white/60"}`,children:ie.local.primary}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-[10px]",children:[e.jsx("span",{className:"uppercase tracking-wider text-slate-500 font-medium",children:ie.local.primaryLabel}),se.local.avg3>0&&e.jsxs("span",{className:"text-slate-400 tabular-nums",children:["Avg: ",se.local.avg3.toFixed(1)]})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center px-3",children:[e.jsx("div",{className:"w-px h-3 bg-gradient-to-b from-transparent via-white/20 to-transparent"}),e.jsx("div",{className:"text-xs font-black text-white/30 tracking-widest my-0.5",children:"VS"}),e.jsx("div",{className:"w-px h-3 bg-gradient-to-b from-transparent via-white/20 to-transparent"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("div",{className:`text-xs font-bold uppercase tracking-widest ${s?"text-slate-400":"text-amber-400"}`,children:$?.name||"Opponent"}),E&&e.jsxs("span",{className:"text-[10px] font-semibold text-slate-400 tabular-nums",children:["(",$?.legsWon||0,")"]}),!s&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-400 animate-pulse"})]}),e.jsx("div",{className:`font-mono text-3xl sm:text-4xl font-black tabular-nums leading-none ${s?"text-white/60":"text-white"}`,children:ie.away.primary}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-[10px]",children:[e.jsx("span",{className:"uppercase tracking-wider text-slate-500 font-medium",children:ie.away.primaryLabel}),se.away.avg3>0&&e.jsxs("span",{className:"text-slate-400 tabular-nums",children:["Avg: ",se.away.avg3.toFixed(1)]})]})]})]}),ke&&e.jsxs("div",{className:`relative border-t px-3 py-1 flex items-center gap-2 ${s?"border-emerald-400/20 bg-emerald-500/10":"border-amber-400/20 bg-amber-500/10"}`,children:[e.jsxs("span",{className:`text-[10px] sm:text-xs uppercase tracking-wider font-semibold whitespace-nowrap ${s?"text-emerald-300/80":"text-amber-300/80"}`,children:["Checkout ",ye,":"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:ke.map((r,m)=>e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs sm:text-sm font-medium ${s?"bg-emerald-500/20 border border-emerald-400/20 text-emerald-100":"bg-amber-500/20 border border-amber-400/20 text-amber-100"}`,children:r},m))})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pb-16",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_1fr] gap-2 min-h-0",children:[e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-2 sm:p-3 overflow-hidden",children:[e.jsx("div",{className:`pointer-events-none absolute inset-0 bg-gradient-to-br ${s?"from-emerald-500/[0.03]":"from-white/[0.02]"} to-transparent`}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-bold text-white/90 tracking-wide",children:"Scoreboard"}),e.jsx("div",{className:`px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold ${s?"bg-emerald-500/20 border border-emerald-400/30 text-emerald-300 animate-pulse":"bg-amber-500/20 border border-amber-400/30 text-amber-300"}`,children:s?"‚óè Your turn":`${$?.name||"Opponent"}‚Äôs turn`})]}),e.jsx(Gt,{gameMode:Y,players:re})]}),e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-1 border-b border-white/5 bg-white/5 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full shadow-lg animate-pulse ${s?"bg-emerald-400 shadow-emerald-400/50":"bg-amber-400 shadow-amber-400/50"}`}),e.jsx("span",{className:"text-xs font-semibold text-white/80",children:s?"Your Board":`${$?.name||"Opponent"}‚Äôs Board`})]}),e.jsx("span",{className:`text-[10px] font-medium ${s?"text-emerald-300":"text-amber-300"}`,children:s?"‚óè Live":"‚óè Waiting"})]}),e.jsxs("div",{className:"relative flex-1 min-h-0 bg-black",children:[e.jsx("div",{className:`h-full ${s||!j?"":"hidden"}`,children:e.jsx(Ut,{hideInlinePanels:!0,forceAutoStart:!0})}),!s&&j&&e.jsx("video",{ref:S,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-contain"}),!s&&!j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white/30 text-xs uppercase tracking-wider mb-1",children:"Opponent's camera not available"}),e.jsx("div",{className:"text-white/20 text-[10px]",children:"Showing your board instead"})]})})]})]})]}),!s&&xe&&Q&&e.jsx(Nt,{direction:Q,onPickDirection:()=>{},currentTargetIndex:P,isUsersTurn:!1,onTurnComplete:()=>{},onDartHit:()=>{},completed:P,playerName:$?.name||"Opponent"}),s&&xe&&e.jsx(Nt,{direction:Q,onPickDirection:r=>Ae(r),currentTargetIndex:me,isUsersTurn:s,onTurnComplete:nt,onDartHit:ve,completed:me,playerName:l?.name||"You"}),s&&!xe&&e.jsx("div",{className:"flex flex-wrap gap-1.5 justify-center",children:(E?[180,140,100,85,60,45,26,0]:[100,80,60,45,26,20,10,0]).map(r=>e.jsx("button",{className:"px-3 py-1.5 rounded-lg text-xs font-bold bg-white/5 hover:bg-white/10 active:bg-white/15 border border-white/10 text-white/90 transition-all active:scale-95",onClick:()=>Z(r,3,{visitTotal:r}),children:r},r))}),O?.label&&e.jsxs("div",{className:"rounded-2xl border border-emerald-400/30 bg-emerald-500/10 px-4 py-3 text-center",children:[e.jsx("span",{className:"text-xs text-emerald-400/70 uppercase tracking-wider font-semibold",children:E?"Winning Double":"Winning Shot"}),e.jsx("div",{className:"text-lg font-bold text-emerald-200 mt-0.5",children:O.label})]})]})}),be&&!xe&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-8",onClick:()=>fe(!1),onKeyDown:r=>{r.key==="Escape"&&fe(!1)},children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full max-w-sm mx-auto rounded-3xl border border-white/10 bg-slate-900/95 backdrop-blur-xl shadow-2xl p-4 sm:p-6 animate-[slideUp_0.2s_ease-out]",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"mb-4 rounded-2xl bg-black/40 border border-white/10 p-4 text-center",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-widest text-slate-400 mb-1",children:"Score"}),e.jsx("input",{ref:ce,type:"number",inputMode:"numeric",pattern:"[0-9]*",className:"w-full bg-transparent font-mono text-5xl sm:text-6xl font-black text-white tabular-nums min-h-[3.5rem] leading-none text-center outline-none border-none [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none placeholder:text-white/20",placeholder:"0",value:B,onChange:r=>{const m=r.target.value.replace(/[^0-9]/g,"");(m===""||Number(m)<=oe)&&J(m)},onKeyDown:r=>{if(r.key==="Enter"){r.preventDefault();const m=Math.max(0,Math.min(oe,Number(B)||0));Z(m,3,{visitTotal:m}),J(""),fe(!1)}}}),B&&at&&Number(B)===T&&e.jsx("div",{className:"mt-2 text-xs text-emerald-300 font-semibold",children:"‚úì Checkout!"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[[1,2,3,4,5,6,7,8,9].map(r=>e.jsx("button",{className:"py-3.5 rounded-xl text-xl font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white transition-all active:scale-95",onClick:()=>{const m=B+String(r);Number(m)<=oe&&J(m),ce.current?.focus()},children:r},r)),e.jsx("button",{className:"py-3.5 rounded-xl text-lg font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white/60 transition-all active:scale-95",onClick:()=>{J(r=>r.slice(0,-1)),ce.current?.focus()},children:"‚å´"}),e.jsx("button",{className:"py-3.5 rounded-xl text-xl font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white transition-all active:scale-95",onClick:()=>{const r=B+"0";Number(r)<=oe&&J(r),ce.current?.focus()},children:"0"}),e.jsx("button",{className:"py-3.5 rounded-xl text-lg font-bold bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border border-emerald-400/30 text-white shadow-lg shadow-emerald-600/30 transition-all active:scale-95",onClick:()=>{const r=Math.max(0,Math.min(oe,Number(B)||0));Z(r,3,{visitTotal:r}),J(""),fe(!1)},children:"‚úì"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center mb-3",children:(E?[180,140,100,85,60,45,26,0]:[100,80,60,45,26,20,10,0]).map(r=>e.jsx("button",{className:"px-3 py-1.5 rounded-lg text-xs font-bold bg-white/5 hover:bg-white/10 border border-white/10 text-white/80 transition-all active:scale-95",onClick:()=>{Z(r,3,{visitTotal:r}),J(""),fe(!1)},children:r},r))}),e.jsx("button",{className:"w-full py-2.5 rounded-xl text-sm font-semibold text-white/50 hover:text-white/80 hover:bg-white/5 transition-all",onClick:()=>fe(!1),children:"Cancel"})]})]}),!xe&&!be&&!tt&&!Ne&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-30 bg-slate-900/95 backdrop-blur-xl border-t border-white/10 px-3 py-2 safe-bottom",children:e.jsxs("div",{className:"flex items-center gap-2 max-w-lg mx-auto",children:[e.jsx("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",className:`flex-1 border rounded-xl px-4 py-3 font-mono text-xl font-bold text-center outline-none [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none placeholder:text-white/30 ${s?"bg-white/5 border-white/15 text-white focus:border-emerald-400/50 focus:ring-1 focus:ring-emerald-400/30":"bg-white/3 border-white/10 text-white/50"}`,placeholder:s?"Type score...":"Waiting for opponent...",value:B,disabled:!s,onChange:r=>{const m=r.target.value.replace(/[^0-9]/g,"");(m===""||Number(m)<=oe)&&J(m)},onKeyDown:r=>{if(r.key==="Enter"){r.preventDefault();const m=Math.max(0,Math.min(oe,Number(B)||0));B!==""&&(Z(m,3,{visitTotal:m}),J(""))}}}),e.jsx("button",{className:`px-5 py-3 rounded-xl text-sm font-bold text-white border transition-all active:scale-95 whitespace-nowrap ${s&&B!==""?"bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border-emerald-400/30 shadow-lg shadow-emerald-600/20":"bg-slate-700 border-white/10 opacity-50 cursor-not-allowed"}`,disabled:!s||B==="",onClick:()=>{const r=Math.max(0,Math.min(oe,Number(B)||0));Z(r,3,{visitTotal:r}),J("")},children:"Submit"}),s&&e.jsx("button",{className:"px-3 py-3 rounded-xl text-sm font-semibold bg-white/5 hover:bg-white/10 text-white/70 border border-white/10 transition-all",onClick:()=>{J(""),fe(!0)},children:"‚å®"})]})}),tt&&e.jsx(zt,{onClose:()=>he(!1),onQuit:()=>{if(he(!1),g)g();else{try{x.endGame()}catch{}try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}}},onPause:()=>{try{Ie(!0,null,u)}catch{}try{bt({type:"pause",pauseStartedAt:Date.now(),pauseInitiator:u})}catch{}y&&y(),he(!1)}}),e.jsx(ts,{localPlayerName:u,onResume:()=>{Ie(!1,null);try{bt({type:"unpause"})}catch{}d&&d()},onDurationSelected:(r,m)=>{A&&A(r,m)}})]})}function bs({user:o}){const c=o?.username||"You",[h,p]=n.useState(0),[g,y]=n.useState(()=>[{id:1,name:"room-1",matches:[]}]),d=(()=>{try{return Ht()}catch{return null}})(),[A,G]=n.useState([]),w=K(t=>t.inProgress),k=K(t=>t.players),[f,j]=n.useState(!1),x=n.useRef(null),O=String(o?.email||"").toLowerCase()==="daviesfamily108@gmail.com";n.useEffect(()=>{if(!f)return;function t(a){try{if(!x.current)return;x.current.contains(a.target)||j(!1)}catch{}}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[f]);const[R,b]=n.useState(!1),S=De.useRef(!1);n.useEffect(()=>{if(!w){S.current=!1,b(!1);return}S.current||(K.getState().players||[]).some(i=>(i.legs||[]).some(M=>(M.visits||[]).length>0))||(S.current=!0,b(!0))},[w]),n.useEffect(()=>{if(w)try{const t=K.getState();if((t?.game||"X01")!=="X01"||!t.roomId)return;const i=`ndn:matchWindowOpened:${t.roomId}`;if(window.sessionStorage.getItem(i)==="1")return;window.sessionStorage.setItem(i,"1"),ss()}catch{}},[w]),n.useEffect(()=>{w||(S.current=!1)},[w]),n.useEffect(()=>{if(d?.connected&&o?.username)try{d.send({type:"presence",username:o.username,email:o.email||""})}catch{}},[d?.connected,o]),n.useEffect(()=>(window.__ndn_online_mounted=!0,()=>{window.__ndn_online_mounted=!1}),[]),n.useEffect(()=>{const t=()=>{try{K.getState().endGame()}catch{}l(null),T(null),N(null),Q(null),Ve(null),L.current=null;try{window.__ndn_pending_invite=null}catch{}};try{window.addEventListener("ndn:match-quit",t)}catch{}return()=>{try{window.removeEventListener("ndn:match-quit",t)}catch{}}},[]);const[D,U]=n.useState(!1),[u,N]=n.useState(null),C=De.useRef(null),[s,l]=n.useState(null),[v,T]=n.useState(null),L=n.useRef(null),[$,je]=n.useState(null),[ae,se]=n.useState({}),[ye,Y]=n.useState(30),E=n.useRef([]);n.useEffect(()=>{E.current=A||[]},[A]),n.useEffect(()=>{u&&(L.current={...u})},[u]);const re=De.useRef(!1),[xe,Q]=n.useState(null),[Ae,ne]=n.useState({}),[Te,me]=n.useState(!1),[P,ie]=n.useState(null),[ue,Fe]=n.useState(null),[mt,He]=n.useState(null),[tt,he]=n.useState(!1),[Ie,Ne]=n.useState(!1),[Re,Ve]=n.useState(null),[st,at]=n.useState("X01"),[ke,oe]=n.useState(""),[pe,rt]=n.useState("all"),[Se,Xe]=n.useState("all"),[be,fe]=n.useState("newest"),[B,J]=n.useState(1),ce=12,ge=g[h],Ee=999,We=De.useCallback(t=>{if(!t)return t;const a=t.modeType||t.mode||"",i=t.legs??t.value??t.bestOf??t.sets??t.games??1,M=t.createdBy||t.creatorName||t.creator||t.host||"",q=t.createdAt||t.ts||Date.now();return{...t,modeType:a,mode:a||t.mode,legs:i,value:typeof t.value=="number"?t.value:i,createdBy:M,creatorName:t.creatorName||M,createdAt:q}},[]),we=n.useMemo(()=>(t=[])=>(t||[]).map(We).filter(a=>!(a?.isTest||a?.test||a?.migrated||a?.isMigration||a?.migration||a?.seeded||a?.status==="completed"||a?.status==="played"||a?.declineCount&&a.declineCount>=3||typeof a?.createdBy=="string"&&a.createdBy.toLowerCase().includes("test")||typeof a?.creatorName=="string"&&a.creatorName.toLowerCase().includes("test")||typeof a?.createdBy=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(a.createdBy)||typeof a?.creatorName=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(a.creatorName)||!(a?.game&&a?.modeType&&a?.legs))),[We]),Z=n.useMemo(()=>{let t=we(ge?.matches||[]);if((t?.length||0)===0&&(A?.length||0)>0&&(t=we(A)),(t?.length||0)===0&&(E.current?.length||0)>0&&(t=we(E.current)),ke.trim()){const a=ke.toLowerCase();t=t.filter(i=>(i.game||"").toLowerCase().includes(a)||(i.createdBy||i.creatorName||"").toLowerCase().includes(a)||(i.id||"").toLowerCase().includes(a))}return pe!=="all"&&(t=t.filter(a=>(a.game||"").toLowerCase()===pe)),Se!=="all"&&(t=t.filter(a=>{const i=(a.modeType||"").replace("_","").toLowerCase(),M=Se.replace("_","").toLowerCase();return i.includes(M)})),t=(t||[]).slice(),t.sort((a,i)=>{const M=a.createdAt||0,q=i.createdAt||0;return be==="newest"?q-M:M-q}),t.slice(0,Ee)},[ge,A,we,ke,pe,Se,be,Ee]);n.useEffect(()=>{J(1)},[ke,pe,Se,be,h]);const ve=Math.ceil(Z.length/ce),nt=Z.slice((B-1)*ce,B*ce),qe=()=>{Z.length>0&&z(Z[0])},r=t=>{const a={id:`m-${Date.now()}`,createdBy:t.createdBy||c,game:t.game,modeType:t.modeType,legs:t.legs,startingScore:t.startingScore,createdAt:Date.now()};d?.connected||y(i=>i.map((M,q)=>q===h?{...M,matches:[a,...M.matches]}:M));try{d?.connected&&(o?.username&&d.send({type:"presence",username:o.username,email:o.email||""}),d.send({type:"create-match",game:t.game,mode:t.modeType,value:t.legs,startingScore:t.startingScore,creatorAvg:t.avgChoice||0}))}catch{}},m=()=>{G([]),y(t=>{const a=t.length+1,i=[...t,{id:a,name:`room-${a}`,matches:[]}];return p(i.length-1),i})},F=De.useCallback(t=>{try{if(console.log("[OnlinePlay] handleInviteOrPrestart:",t?.type,t),t?.type==="invite"){const a={id:t.matchId,game:t.game,mode:t.mode||"firstto",value:t.value||1,startingScore:t.startingScore||501,fromName:t.fromName||"Opponent",fromId:t.fromId};l(a);try{const i=new Audio("/sounds/notify.mp3");i.volume=.5,i.play().catch(()=>{})}catch{}}if(t?.type==="invite-waiting"&&T(t.creatorName||"Creator"),t?.type==="match-prestart"){if(K.getState().inProgress)return;l(null),T(null);const a=We(t.match||null);if(a&&(a.prestartEndsAt=t.prestartEndsAt),a){const M=(o?.username||"").toLowerCase(),q=(a.creatorName||a.createdBy||"").toLowerCase();M&&q===M&&(a._isCreatorView=!0)}try{a?.creatorId&&a?.creatorName&&se(M=>({...M,[a.creatorId]:a.creatorName}))}catch{}re.current=!0,N(a);const i=t.prestartEndsAt||Date.now();Y(Math.max(0,Math.ceil(((i||Date.now())-Date.now())/1e3))),setTimeout(()=>{re.current=!1},0),Q(null),ne({}),me(!1),ie(null),Fe(null),Ne(!1)}t?.type==="invite-expired"&&(l(null),T(null),N(a=>a&&t.matchId===a.id?null:a)),t?.type==="declined"&&(l(null),T(null),N(a=>a&&t.matchId===a.id?null:a))}catch{}},[We,o]),I=De.useCallback(t=>{if(t?.type!=="match-start"||K.getState().inProgress)return;const a=t.match||{},i=L.current||{},M=t.roomId||i.id||"",q=a.startingScore||i.startingScore||501,ee=c,Ge=a.creatorName||i.creatorName||i.createdBy||"",Pe=a.joinerName||i.joinerName||"",Oe=t.firstThrowerId||t.firstPlayerId||null,Be=i._isCreatorView||Ge.toLowerCase()===ee.toLowerCase(),Qe=Be?Pe||"Opponent":Ge||"Opponent";let Ue;if(Oe){const Je=a.creatorId||i.creatorId;Ue=Be?Oe===Je:Oe!==Je}else Ue=Be;const Mt=Ue?[ee,Qe]:[Qe,ee];try{K.getState().newMatch(Mt,q,M)}catch(Je){console.error("[OnlinePlay] newMatch failed:",Je)}const Dt=a.game||i.game||"X01";at(Dt);try{d?.connected&&d.send({type:"join",roomId:M})}catch{}L.current=null,N(null),Q(null),ne({})},[c,d]);n.useEffect(()=>d?(d.connected&&d.send({type:"list-matches"}),d.addListener(a=>{try{if(a?.type==="joined"&&a.id&&je(a.id),a?.type==="presence")try{a.id&&se(i=>({...i,[a.id]:a.username||a.name||a.id}))}catch{}if(a?.type==="matches"){const i=we(a.matches||[]);G(i),E.current=i,y(M=>M.map((q,ee)=>ee===h?{...q,matches:i}:q))}if(F(a),a?.type==="match-start"&&I(a),a?.type==="prestart-choice-notify"){const{roomId:i,playerId:M,choice:q}=a;if(!i||!q)return;ne(ee=>({...ee||{},[M]:q}))}if(a?.type==="prestart-bull"&&(me(!0),he(!1),He(null)),a?.type==="prestart-bull-winner"&&(Fe(a.winnerName||a.winnerId||null),me(!1),he(!1),Ne(!1)),a?.type==="prestart-bull-tie"&&(Fe(null),me(!1),he(!1),Ne(!0),setTimeout(()=>Ne(!1),2e3)),a?.type==="opponent-quit"&&Ve(a.quitterName||"Opponent"),a?.type==="opponent-paused")try{de.getState().setPaused(!0,null,a.pauserName||"Opponent")}catch{}if(a?.type==="opponent-unpaused")try{de.getState().setPaused(!1,null)}catch{}}catch{}})):void 0,[d,xe,we,h,F,I]),n.useEffect(()=>{try{const a=window.__ndn_pending_invite;a&&(window.__ndn_pending_invite=null,a.type==="match-start"?I(a):F(a))}catch{}const t=a=>{try{const i=a.detail;if(!i)return;i.type==="match-start"?I(i):F(i)}catch{}};return window.addEventListener("ndn:match-invite",t),()=>window.removeEventListener("ndn:match-invite",t)},[F,I]),n.useEffect(()=>{if(!u||re.current||u.prestartEndsAt)return;Y(30),Q(null),ne({});const t=setInterval(()=>Y(a=>Math.max(0,a-1)),1e3);return()=>clearInterval(t)},[u]),n.useEffect(()=>{u&&setTimeout(()=>C.current?.focus(),0)},[u]);const V=()=>{b(!0),u&&(L.current={...u});try{if(d?.connected&&u?.id){const t=!!u._isCreatorView;d.send({type:"invite-response",matchId:u.id,accept:!0,toId:t?u.joinerId:u.creatorId})}}catch{}N(null)},z=t=>{N(t);try{d?.connected&&(o?.username&&d.send({type:"presence",username:o.username,email:o.email||""}),d.send({type:"join-match",matchId:t.id,calibrated:!0}))}catch{}},H=t=>{Q(t);try{d?.connected&&u?.id&&d.send({type:"prestart-choice",roomId:u.id,choice:t})}catch{}},X=De.useCallback(()=>{try{if(d?.connected){const t=K.getState();d.send({type:"state",payload:t})}}catch{}},[d]),Me=()=>{as({players:[c,"Opponent"],startingScore:501,roomId:"online-demo",visits:[{score:60},{score:85},{score:100}]})};if(w){const a=(K.getState().players||[]).findIndex(i=>i?.name&&i.name.toLowerCase()===c.toLowerCase());return e.jsxs(e.Fragment,{children:[e.jsx(ds,{user:o,showStartShowcase:R,onShowStartShowcaseChange:b,onCommitVisit:(i,M,q)=>{try{const ee=K.getState(),Ge=ee.players[ee.currentPlayerIdx],Pe=Ge?.legs?.[Ge.legs.length-1],Oe=Pe?Pe.totalScoreRemaining:ee.startingScore,Be=Math.max(0,Oe-i),Qe=Oe<=50?3:Be<=50?1:0,Ue=Be===0;ee.addVisit(i,3,{preOpenDarts:0,doubleWindowDarts:Qe,finishedByDouble:Ue,visitTotal:i}),Pe&&Pe.totalScoreRemaining===0?ee.endLeg(i):ee.nextPlayer()}catch{K.getState().addVisit(i,3),K.getState().nextPlayer()}X()},onQuit:()=>{try{K.getState().endGame()}catch{}try{d?.connected&&d.send({type:"match-quit"})}catch{}l(null),T(null),N(null),Q(null),Ve(null),L.current=null;try{window.__ndn_pending_invite=null}catch{}X();try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},onPause:()=>{try{de.getState().setPaused(!0,null,c)}catch{}try{d?.connected&&d.send({type:"match-pause"})}catch{}},onResume:()=>{try{de.getState().setPaused(!1,null)}catch{}try{d?.connected&&d.send({type:"match-unpause"})}catch{}},onStateChange:X,localPlayerIndexOverride:a>=0?a:void 0,gameModeOverride:st,isOnline:!0}),Re&&e.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl",children:[e.jsx("div",{className:"text-4xl mb-3",children:"üö™"}),e.jsxs("h3",{className:"text-lg font-bold text-white mb-2",children:[Re," left the match"]}),e.jsx("p",{className:"text-sm text-white/60 mb-5",children:"Your opponent has quit. You can leave the match now."}),e.jsx("button",{className:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all",onClick:()=>{try{K.getState().endGame()}catch{}Ve(null),l(null),T(null),N(null),Q(null),L.current=null;try{window.__ndn_pending_invite=null}catch{}try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},children:"Leave Match"})]})})]})}return e.jsx("div",{className:"flex-1 min-h-0 ndn-page",style:{position:"relative",marginTop:0},children:e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col",children:[R&&e.jsx(Ct,{players:k||[],user:o,onDone:()=>b(!1),onRequestClose:()=>b(!1)}),e.jsx("h2",{className:"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title",children:"Online Lobby üåê"}),e.jsx("div",{className:"ndn-shell-body flex-1 overflow-hidden p-3 pb-0",children:e.jsxs("div",{className:"h-full flex flex-col gap-3",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"text-sm text-white/70",children:"Room"}),e.jsxs("div",{className:"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium",children:["Room (",ge?.id,")"]}),e.jsx("button",{className:"btn btn-ghost btn-sm rounded-lg",onClick:m,children:"New Room"})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg",onClick:()=>U(!0),disabled:(ge?.matches?.length||0)>=Ee,children:[e.jsx(Kt,{className:"w-4 h-4"}),"Create Match +"]}),O&&e.jsx("button",{className:"btn btn-sm btn-ghost rounded-lg",onClick:Me,children:"Demo In-Play"}),(ge?.matches?.length||0)>=Ee&&e.jsx("div",{className:"text-xs text-rose-400",children:"Room full ‚Äî create a new room"})]})]}),!w&&e.jsx("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3",children:e.jsxs("div",{className:"ndn-filterbar",children:[e.jsxs("div",{className:"flex-1 min-w-[240px] relative",children:[e.jsx(Zt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",placeholder:"Search matches, players...",className:"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all",value:ke,onChange:t=>oe(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:pe,onChange:t=>rt(t.target.value),children:[e.jsx("option",{value:"all",children:"All Games"}),e.jsxs("option",{value:"x01",children:[le("X01").emoji," X01"]}),e.jsxs("option",{value:"cricket",children:[le("Cricket").emoji," Cricket"]}),e.jsxs("option",{value:"bermuda",children:[le("Bermuda").emoji," Bermuda"]}),e.jsxs("option",{value:"gotcha",children:[le("Gotcha").emoji," Gotcha"]})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:Se,onChange:t=>Xe(t.target.value),children:[e.jsx("option",{value:"all",children:"All Modes"}),e.jsx("option",{value:"first_to",children:"First To"}),e.jsx("option",{value:"best_of",children:"Best Of"})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:be,onChange:t=>fe(t.target.value),children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${f?"bg-red-600 text-white border-red-500":"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900"}`,onClick:()=>j(t=>!t),"aria-pressed":f,title:"Toggle focus mode: hide small details and show focused view",children:f?"Exit Focus":"Focus Mode"})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg",onClick:qe,disabled:Z.length===0,children:[e.jsx(dt,{className:"w-4 h-4 fill-current"}),"Quick Join"]})})]})}),e.jsxs("div",{className:"flex-1 overflow-auto flex flex-col",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(ft,{className:"w-5 h-5 text-indigo-400"}),"Active Matches ÔøΩÔ∏è"]}),e.jsx("div",{className:"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col",children:e.jsxs("div",{className:"flex-1 overflow-auto",children:[(Z.length||0)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center opacity-60",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4",children:e.jsx(Ye,{className:"w-8 h-8 text-white/20"})}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No matches found"}),e.jsx("p",{className:"text-sm max-w-xs mx-auto",children:"Create a new match to get started or try adjusting your filters."})]}):null,(Z.length||0)!==0&&e.jsxs("div",{className:"relative",children:[f&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out",children:e.jsx("button",{onClick:()=>j(!1),className:"w-full text-center",children:"FOCUS MODE ‚Äî Click to exit"})})}),e.jsx("div",{ref:x,className:`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 max-h-[28rem] overflow-auto p-1 ${f?"opacity-90":""}`,"data-testid":"matches-grid",children:nt.map(t=>e.jsxs("div",{className:"group relative p-4 rounded-lg border border-slate-700/30 bg-slate-950/40 hover:border-indigo-500/50 hover:bg-slate-900/50 transition-all duration-150 shadow-sm hover:shadow-[0_8px_24px_-12px_rgba(99,102,241,0.4)] flex flex-col gap-3 min-h-[6.5rem]","data-testid":`match-${t.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[!f&&e.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center border group-hover:border-opacity-60 transition-colors text-sm",style:{backgroundColor:`${le(t.game).color}15`,borderColor:`${le(t.game).color}30`},children:le(t.game).emoji}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"font-bold group-hover:text-indigo-300 transition-colors truncate",style:{color:le(t.game).color},children:[le(t.game).emoji," ",t.game]}),e.jsxs("div",{className:"text-xs text-white/50 flex items-center gap-1",children:[e.jsx(gt,{className:"w-3 h-3"}),new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})}),t.roomName&&e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-none bg-slate-950 border border-slate-850 text-white/70",children:t.roomName})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm text-white/70 bg-transparent border-t border-slate-850 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 rounded-none bg-white/5 text-xs font-medium border border-slate-850",children:t.modeType==="bestof"?"Best Of":"First To"}),e.jsx("span",{className:"font-mono text-indigo-300",children:t.legs}),e.jsx("span",{children:"legs"}),t.startingScore&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-white/20"}),e.jsx("span",{className:"font-mono text-amber-300",children:t.startingScore})]})]}),!f&&e.jsxs("div",{className:"text-xs text-white/40 flex items-center gap-1 mt-1",children:[e.jsx(ft,{className:"w-3 h-3"}),"Created by:"," ",e.jsx("span",{className:"text-white/60",children:t.createdBy||t.creatorName||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2 border-t border-white/5",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:!f&&e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white",children:(t.createdBy||t.creatorName||"U").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-xs text-white/60 truncate max-w-[120px]",children:t.createdBy||t.creatorName})]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-4 rounded-none",onClick:()=>z(t),children:"Join"})})]})]},t.id))})]}),ve>1&&e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5",children:[e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:B===1,onClick:()=>J(t=>Math.max(1,t-1)),children:[e.jsx(wt,{className:"w-4 h-4 rotate-90"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,ve)},(t,a)=>{let i=a+1;return ve>5&&(B>3&&(i=B-2+a),i>ve&&(i=ve-4+a)),e.jsx("button",{className:`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${B===i?"bg-indigo-600 text-white shadow-sm":"bg-slate-950 text-white/70 hover:bg-slate-900"}`,onClick:()=>J(i),children:i},i)})}),e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:B===ve,onClick:()=>J(t=>Math.min(ve,t+1)),children:["Next",e.jsx(wt,{className:"w-4 h-4 -rotate-90"})]})]})]})})]})]})}),e.jsx(rs,{open:D,onClose:()=>U(!1),onCreate:t=>{r(t),U(!1)}}),s&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-md mx-4 p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-indigo-500/30 shadow-2xl shadow-indigo-500/20",children:[e.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 ring-2 ring-indigo-500/30",children:e.jsx(dt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-white",children:"Match Invite!"}),e.jsx("p",{className:"text-sm text-white/60",children:"Someone wants to play"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold text-sm",children:(s.fromName||"?").substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-lg",children:s.fromName||"Opponent"}),e.jsx("div",{className:"text-xs text-white/50",children:"wants to join your match"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-sm text-white/70",children:[e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-medium",children:s.game||"X01"}),e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10",children:[s.mode==="bestof"?"Best Of":"First To"," ",s.value||1]}),e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-mono text-amber-300",children:s.startingScore||501})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{d?.connected&&s?.id&&d.send({type:"invite-accept",matchId:s.id})}catch{}l(null)},children:"‚úÖ Accept"}),e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-white/5 hover:bg-rose-600/80 text-white/80 hover:text-white font-bold text-lg border border-white/10 hover:border-rose-500/50 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{d?.connected&&s?.id&&d.send({type:"invite-decline",matchId:s.id})}catch{}l(null)},children:"‚ùå Decline"})]})]})]})}),v&&!u&&e.jsx("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-sm mx-4 p-6 rounded-2xl bg-slate-900 border border-slate-700/50 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-indigo-500/10 flex items-center justify-center",children:e.jsx(gt,{className:"w-8 h-8 text-indigo-400 animate-pulse"})}),e.jsxs("h3",{className:"text-xl font-bold text-white mb-2",children:["Waiting for ",v]}),e.jsx("p",{className:"text-sm text-white/50 mb-5",children:"The match creator needs to accept your request‚Ä¶"}),e.jsx("button",{className:"px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 transition-all text-sm font-medium",onClick:()=>T(null),children:"Cancel"})]})}),e.jsx(os,{open:!!u,matchInfo:u,localUser:o,opponentName:(()=>{if(!u)return"Opponent";const t=(o?.username||"").toLowerCase(),a=u.createdBy||u.creatorName||"";return u._isCreatorView||a.toLowerCase()===t?u.joinerName||(u.joinerId?ae[u.joinerId]||u.joinerId:"Opponent"):a||(u.creatorId?ae[u.creatorId]||u.creatorId:"Opponent")})(),countdown:15,onChoice:H,onBullThrow:t=>{try{d?.connected&&u?.id&&d.send({type:"prestart-bull-throw",roomId:u.id,score:t})}catch{}He(t),he(!0)},onAccept:V,onCancel:()=>{try{d?.connected&&u?.id&&u._isCreatorView&&d.send({type:"invite-decline",matchId:u.id})}catch{}N(null)},remoteChoice:Object.values(Ae)[0]||null,bullActive:Te,bullWinner:ue,bullTied:Ie})]})})}export{bs as default};
//# sourceMappingURL=OnlinePlay.clean-QHk7GfiP.js.map

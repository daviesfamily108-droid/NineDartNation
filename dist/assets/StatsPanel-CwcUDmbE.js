import{L as G,D as B,j as e,T as I,g as n,q as g,M as j,N as f,O as w,P as O}from"./index-Bx2Xb2t1.js";import{u as R}from"./match-BNL0c8h2.js";import{f as l}from"./stats-X3jz_E9o.js";import{r as i}from"./ui-gqBJRRJB.js";import"./vendor-D3F3s8fL.js";function _({user:M}){const{players:x,inProgress:$,startingScore:q,newMatch:U}=R(),[c,N]=i.useState("x01"),[V,z]=i.useState("Player 1, Player 2"),[Q,X]=i.useState(501),[h,E]=i.useState(""),[b,F]=i.useState([]),[r,p]=i.useState(""),[L,y]=i.useState(!1),[u,P]=i.useState(""),[k,S]=i.useState([]),[T,C]=i.useState(!1),o=String(M?.email||"").toLowerCase();i.useEffect(()=>{let s=!1;async function a(){try{if(!o)return;const m=await(await fetch(`/api/friends/list?email=${encodeURIComponent(o)}`)).json().catch(()=>({friends:[]}));s||F(m.friends||[])}catch{}}a();const t=setInterval(a,2e4);return()=>{s=!0,clearInterval(t)}},[o]),i.useEffect(()=>{try{const s=o?`ndn:stats:opponent:${o}`:"ndn:stats:opponent",a=localStorage.getItem(s);a&&p(a)}catch{}},[o]),i.useEffect(()=>{try{const s=o?`ndn:stats:opponent:${o}`:"ndn:stats:opponent";r?localStorage.setItem(s,r):localStorage.removeItem(s)}catch{}},[r,o]);async function D(s){if(P(s),!s.trim()){S([]);return}C(!0);try{const t=await(await fetch(`/api/friends/search?q=${encodeURIComponent(s)}`)).json().catch(()=>({results:[]}));S(t.results||[])}finally{C(!1)}}const W=i.useMemo(()=>{const s=new Map;if(c==="x01")for(const t of x)for(const d of t.legs)for(const m of d.visits){const A=Math.max(0,Math.min(180,m.score));s.set(A,(s.get(A)??0)+1)}const a=Array.from(s.entries()).sort((t,d)=>t[0]-d[0]);return a.length===0&&c==="x01"?([0,26,41,60,81,100,120,140,160,180].forEach(t=>s.set(t,0)),Array.from(s.entries()).sort((t,d)=>t[0]-d[0]).map(([t,d])=>({label:t,value:d}))):a.map(([t,d])=>({label:t,value:d}))},[x,c]),v=i.useMemo(()=>{const s=G(B);return B.map(a=>{const t=s[a]||{played:0,won:0};return{label:a,value:t.played,extra:t.won}})},[c]);return i.useEffect(()=>{const s=()=>N(a=>a);return window.addEventListener("ndn:stats-updated",s),()=>window.removeEventListener("ndn:stats-updated",s)},[]),e.jsxs("div",{className:"card ndn-game-shell",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-2xl font-extrabold text-white",children:"Match Stats"}),e.jsx("span",{className:"text-xs opacity-70",children:"View"})]}),e.jsx(I,{tabs:[{key:"x01",label:"X01"},{key:"other",label:"Other Modes"}],active:c,onChange:s=>N(s)})]}),$&&e.jsx("div",{className:"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200",children:"Note: Detailed leg stats are finalized at the end of the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[x.map((s,a)=>e.jsxs("div",{className:"p-4 rounded-2xl border border-indigo-500/20 bg-gradient-to-br from-indigo-700/6 to-indigo-900/6 shadow-sm transform transition-transform duration-200 hover:-translate-y-1 hover:shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:a===1&&!r?s.name||"Opponent":a===1&&r?r:s.name}),a===1&&e.jsxs("div",{className:"flex gap-2 items-center overflow-x-auto py-1",children:[e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10",onClick:()=>y(t=>!t),title:"Search user to compare",children:"Select Friend"}),b.slice(0,6).map(t=>{const d=t.username||t.email,m=r===d;return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${m?"bg-indigo-500/30 border-indigo-400/50":"bg-white/6 border-white/8 hover:bg-white/10 transform hover:-translate-y-0.5 transition-all duration-150"}`,onClick:()=>p(d),title:`Compare vs ${d}`,children:d},t.email)}),b.length===0&&e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10",disabled:!0,children:"Find friends to compare"})]})]}),a===1&&L&&e.jsxs("div",{className:"mb-2 p-2 rounded-lg bg-black/20 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1 py-1",placeholder:"Search by name or email",value:u,onChange:t=>D(t.target.value)}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>D(u),disabled:T,children:"Search"})]}),e.jsxs("ul",{className:"max-h-40 overflow-auto space-y-1",children:[k.map(t=>{const d=t.username||t.email;return e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm",onClick:()=>{p(d),y(!1)},children:d})},t.email)}),!k.length&&e.jsx("li",{className:"text-xs opacity-70",children:u.trim()?"No results":"Type to search…"})]})]}),a===1&&r?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:l(n(r).best3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:l(n(r).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const t=n(r);return t.bestLegDarts?`${t.bestLegDarts} darts`:"—"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:n(r).bestCheckout||"—"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",l(g(r))," ·"," ",l(j(r))]}),e.jsxs("span",{children:["First 9: ",l(f(r))," ·"," ",l(w(r))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const t=n(r);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",l(t.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",l(t.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",t.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",t.bestCheckout||0]})]})})()]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:l(s.bestThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:l(s.worstThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:s.bestNineDart?`${s.bestNineDart.darts} darts`:"—"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:s.bestCheckout??"—"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",l(g(s.name))," ·"," ",l(j(s.name))]}),e.jsxs("span",{children:["First 9: ",l(f(s.name))," ·"," ",l(w(s.name))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const t=n(s.name);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",l(t.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",l(t.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",t.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",t.bestCheckout||0]})]})})()]})]})]},s.id)),x.length<=1&&e.jsxs("div",{className:"p-3 rounded-2xl border border-purple-500/20 bg-gradient-to-r from-purple-800/6 to-pink-800/6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Opponent"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.slice(0,6).map(s=>{const a=s.username||s.email,t=r===(s.username||s.email);return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${t?"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-transparent shadow-sm":"bg-gradient-to-r from-purple-500/8 to-pink-500/8 border-white/10 hover:from-purple-500/12 hover:to-pink-500/12"}`,onClick:()=>p(a),title:`Compare vs ${a}`,children:a},s.email)}),b.length===0&&e.jsx("span",{className:"text-xs opacity-70",children:"Add friends to compare stats."})]})]}),r?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Comparing to"}),e.jsx("div",{className:"font-semibold",children:r})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:l(g(r))})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:l(n(r).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const s=n(r);return s.bestLegDarts?`${s.bestLegDarts} darts`:"—"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:n(r).bestCheckout||"—"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",l(g(r))," ·"," ",l(j(r))]}),e.jsxs("span",{children:["First 9: ",l(f(r))," ·"," ",l(w(r))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const s=n(r);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",l(s.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",l(s.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",s.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",s.bestCheckout||0]})]})})()]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Select a friend above to compare."})]})]}),c!=="other"?e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Score Distribution (",c.toUpperCase(),"): Visits by scored points"]}),e.jsx("div",{className:"rounded-xl border border-indigo-500/20 p-3 min-h-[220px] transform transition-shadow duration-200 hover:shadow-lg overflow-y-auto",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)",scrollbarColor:"#8F43EE #18122B"},children:e.jsx(O,{data:W,showValues:!1})})]}):h&&v.find(s=>s.label===h)?e.jsx("div",{className:"mt-6",children:(()=>{const s=v.find(a=>a.label===h);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Game Stats for ",s.label]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Games Played"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:s.value})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Games Won"}),e.jsx("div",{className:"text-3xl font-bold text-green-400",children:s.extra})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Win Rate"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[s.value>0?(s.extra/s.value*100).toFixed(1):0,"%"]})]})]})]})})()}):null,c==="other"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Other Modes: Click a game to view stats"}),e.jsx("div",{className:"rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar flex-wrap",children:v.map(s=>e.jsx("button",{onClick:()=>E(s.label),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] ${h===s.label?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gradient-to-r from-slate-700 to-slate-600 text-white hover:from-slate-600 hover:to-slate-500"}`,children:s.label},s.label))})]}),!h&&e.jsx("div",{className:"rounded-xl border border-indigo-500/20 p-4",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)"},children:e.jsx("div",{className:"text-center text-slate-300",children:"Select a game mode above to view detailed stats"})})]})]})}export{_ as default};
//# sourceMappingURL=StatsPanel-CwcUDmbE.js.map

{"version":3,"file":"GameCalibrationStatus-D4E7mOUN.js","sources":["../../src/components/GameCalibrationStatus.tsx"],"sourcesContent":["import React from \"react\";\nimport { AlertTriangle, CheckCircle, AlertCircle, Zap } from \"lucide-react\";\nimport { useCalibration } from \"../store/calibration\";\nimport {\n  getCalibrationConfidenceForGame,\n  isCalibrationSuitableForGame,\n  getCalibrationQualityText,\n  getRecalibrationRecommendation,\n  GAME_CALIBRATION_REQUIREMENTS,\n  getGlobalCalibrationConfidence,\n} from \"../utils/gameCalibrationRequirements\";\n\ninterface GameCalibrationStatusProps {\n  gameMode: string;\n  compact?: boolean; // Show minimal version\n  onRecalibrate?: () => void; // Optional callback for recalibrate button\n}\n\nexport default function GameCalibrationStatus({\n  gameMode,\n  compact = false,\n  onRecalibrate,\n}: GameCalibrationStatusProps) {\n  const { H, errorPx, confidence: storedConfidence, locked } = useCalibration();\n\n  const gameConfidence = getCalibrationConfidenceForGame(gameMode, errorPx);\n  const suitable = isCalibrationSuitableForGame(gameMode, errorPx);\n  const { text } = getCalibrationQualityText(gameMode, errorPx);\n  const recommendation = getRecalibrationRecommendation(gameMode);\n  const requirement = GAME_CALIBRATION_REQUIREMENTS[gameMode];\n\n  // Prefer a live computation from the current errorPx when available so the\n  // UI reflects the most recent measurement. Falling back to a stored\n  // confidence is useful when errorPx is missing (legacy/persisted state).\n  const baseConfidence =\n    typeof errorPx === \"number\" && !Number.isNaN(errorPx)\n      ? getGlobalCalibrationConfidence(errorPx)\n      : typeof storedConfidence === \"number\"\n        ? storedConfidence\n        : null;\n\n  const showConfidenceNote =\n    typeof baseConfidence === \"number\" &&\n    Math.abs(baseConfidence - gameConfidence) >= 0.5;\n\n  // Treat calibration as present if we have a homography.\n  // Some flows may not persist errorPx (or it may be 0/null) even though the\n  // board is calibrated enough to use for scoring.\n  const hasCalibration = !!H;\n\n  // If calibration is locked, always show \"Camera connected ‚úÖ\"\n  // When locked, we trust that the user has set up the camera properly\n  if (locked) {\n    if (compact) {\n      return (\n        <div className=\"text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-300 inline-flex items-center gap-1 border border-emerald-600/30\">\n          <CheckCircle className=\"w-3 h-3\" />\n          Camera connected ‚úÖ\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"px-3 py-2 rounded bg-emerald-500/20 border border-emerald-600/30 flex items-center gap-2\">\n        <CheckCircle className=\"w-4 h-4 text-emerald-400 flex-shrink-0\" />\n        <div className=\"flex-1\">\n          <div className=\"font-medium text-emerald-300\">\n            Camera Connected ‚úÖ\n          </div>\n          <div className=\"text-xs opacity-80\">\n            Camera is locked and ready for {gameMode}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Camera not connected\n  if (!hasCalibration) {\n    if (compact) {\n      return (\n        <div className=\"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30\">\n          <AlertTriangle className=\"w-3 h-3\" />\n          Camera not connected ‚ùå\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2\">\n        <AlertTriangle className=\"w-4 h-4 text-red-400 flex-shrink-0\" />\n        <div className=\"flex-1\">\n          <div className=\"font-medium text-red-300\">\n            Calibration Required ‚ö†Ô∏è\n          </div>\n          <div className=\"text-xs opacity-80\">\n            Please calibrate before playing {gameMode}\n          </div>\n        </div>\n        {onRecalibrate && (\n          <button\n            className=\"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700\"\n            onClick={onRecalibrate}\n          >\n            Calibrate üìç\n          </button>\n        )}\n      </div>\n    );\n  }\n\n  // If we have calibration but no errorPx, show a neutral \"Calibrated\" indicator.\n  // IMPORTANT: This should NOT be treated as \"verified\" quality.\n  if (hasCalibration && (errorPx == null || Number.isNaN(errorPx as any))) {\n    if (compact) {\n      return (\n        <div className=\"text-xs px-2 py-1 rounded inline-flex items-center gap-1 border bg-amber-500/20 border-amber-600/30 text-amber-200\">\n          <AlertCircle className=\"w-3 h-3\" />\n          Quality unknown\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"px-3 py-2 rounded border bg-amber-500/20 border-amber-600/30 space-y-1\">\n        <div className=\"flex items-center gap-2\">\n          <AlertCircle className=\"w-4 h-4 text-amber-300 flex-shrink-0\" />\n          <div className=\"flex-1\">\n            <div className=\"font-medium text-emerald-300\">\n              Calibration for {gameMode}\n            </div>\n            <div className=\"text-xs opacity-80\">\n              Calibrated, but quality is unknown (re-check recommended)\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Determine colors based on suitability\n  const isPerfect = text.includes(\"Perfect\");\n  const bgColor = isPerfect\n    ? \"bg-indigo-500/20 border-indigo-600/30\"\n    : suitable\n      ? \"bg-emerald-500/20 border-emerald-600/30\"\n      : \"bg-amber-500/20 border-amber-600/30\";\n\n  const textColor = isPerfect\n    ? \"text-indigo-300\"\n    : suitable\n      ? \"text-emerald-300\"\n      : \"text-amber-300\";\n  const icon = isPerfect ? Zap : suitable ? CheckCircle : AlertTriangle;\n\n  if (compact) {\n    return (\n      <div\n        className={`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${bgColor} ${textColor}`}\n      >\n        {React.createElement(icon, { className: \"w-3 h-3\" })}\n        <span className=\"flex flex-wrap gap-x-1\">\n          <span>{text}</span>\n          {typeof baseConfidence === \"number\" && (\n            <span>¬∑ Raw {baseConfidence.toFixed(1)}%</span>\n          )}\n          {showConfidenceNote && (\n            <span>{`¬∑ ${gameMode}: ${gameConfidence.toFixed(1)}%`}</span>\n          )}\n        </span>\n        {!suitable && recommendation && (\n          <span className=\"w-3 h-3 cursor-help\" title={recommendation}>\n            <AlertCircle className=\"w-3 h-3 inline\" />\n          </span>\n        )}\n      </div>\n    );\n  }\n\n  // Full version\n  return (\n    <div className={`px-3 py-2 rounded border ${bgColor} space-y-1`}>\n      <div className=\"flex items-center gap-2\">\n        {React.createElement(icon, {\n          className: `w-4 h-4 ${isPerfect ? \"text-indigo-400\" : suitable ? \"text-emerald-400\" : \"text-amber-400\"} flex-shrink-0`,\n        })}\n        <div className=\"flex-1\">\n          <div\n            className={`font-medium ${isPerfect ? \"text-indigo-300\" : suitable ? \"text-emerald-300\" : \"text-amber-300\"}`}\n          >\n            Calibration for {gameMode}\n          </div>\n          <div className=\"text-xs opacity-80 flex flex-wrap gap-x-2 gap-y-1\">\n            <span>\n              Error: {errorPx !== null ? `${errorPx.toFixed(2)}px` : \"Unknown\"}\n            </span>\n            <span>{text}</span>\n            {typeof baseConfidence === \"number\" && (\n              <span>Raw: {baseConfidence.toFixed(1)}%</span>\n            )}\n            {showConfidenceNote && (\n              <span>{`${gameMode}: ${gameConfidence.toFixed(1)}%`}</span>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Confidence bar */}\n      <div className=\"flex items-center gap-2\">\n        <div className=\"flex-1 h-1.5 rounded bg-black/30 overflow-hidden\">\n          <div\n            className={`h-full transition-all ${\n              isPerfect\n                ? \"bg-indigo-500\"\n                : suitable\n                  ? \"bg-emerald-500\"\n                  : \"bg-amber-500\"\n            }`}\n            style={{ width: `${Math.min(100, gameConfidence)}%` }}\n          />\n        </div>\n        <span className=\"text-xs font-mono\">{gameConfidence.toFixed(1)}%</span>\n      </div>\n\n      {/* Requirements */}\n      {requirement && (\n        <div className=\"text-xs opacity-75\">\n          <div>\n            Tolerance: ¬±{requirement.tolerancePx}px | Min:{\" \"}\n            {requirement.minConfidence}%\n          </div>\n        </div>\n      )}\n\n      {/* Warning and recommendation */}\n      <div className=\"space-y-1\">\n        {!suitable && (\n          <div className=\"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1\">\n            <AlertTriangle className=\"w-3 h-3 flex-shrink-0\" />\n            Calibration quality is below minimum for {gameMode}\n          </div>\n        )}\n\n        {recommendation && (\n          <div className=\"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1\">\n            <Zap className=\"w-3 h-3 flex-shrink-0\" />\n            {recommendation}\n          </div>\n        )}\n      </div>\n\n      {!suitable && onRecalibrate && (\n        <button\n          className=\"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700\"\n          onClick={onRecalibrate}\n        >\n          Recalibrate for {gameMode}\n        </button>\n      )}\n    </div>\n  );\n}\n"],"names":["GameCalibrationStatus","gameMode","compact","onRecalibrate","H","errorPx","storedConfidence","locked","useCalibration","gameConfidence","getCalibrationConfidenceForGame","suitable","isCalibrationSuitableForGame","text","getCalibrationQualityText","recommendation","getRecalibrationRecommendation","requirement","GAME_CALIBRATION_REQUIREMENTS","baseConfidence","getGlobalCalibrationConfidence","showConfidenceNote","hasCalibration","jsxs","jsx","CheckCircle","AlertTriangle","AlertCircle","isPerfect","bgColor","textColor","icon","Zap","React"],"mappings":"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"}
import{b as nl,c as al,i as rl,d as il,e as ll,j as e,G as ol,f as li,u as Re,h as Kr,k as cl,l as dl,m as ml,r as ul,n as xl,B as wt,o as hl,a as fl,p as _r,q as Gr,s as pl,R as ys,t as bl,v as gl,w as vl}from"./index-BjeBmmUT.js";import{l as sn,R as zr,m as jl,n as Nl,Z as yl,r as a}from"./ui-Vpbk6UnN.js";import{c as qr,s as nn,G as wl,D as Zn,A as ct,a as Ge,b as Sl,i as Xr,p as zt,T as Cl,t as kl}from"./GameScoreboard-BYIFdWae.js";import{u as Dl,C as K,R as Al}from"./CameraView-DjbB_S6n.js";import{M as Ml}from"./MatchStartShowcase-D24XUUPz.js";import{u as Tl,a as ws}from"./match-WHYhX1sr.js";import{M as Ll}from"./MatchControls-Bnt1uiBb.js";import"./vendor-D3F3s8fL.js";import"./pendingVisit-Bd9CY6yY.js";const ma=[20,19,18,17,16,15,25];function ea(){const n={};return ma.forEach(i=>{n[i]=0}),{marks:n,points:0}}function El(n,i,u,h,o=()=>!1){let d=null,p=0;if(u==="BULL"||u==="INNER_BULL"||i===25||i===50)d=25,p=u==="INNER_BULL"||i===50?2:1;else if(typeof h=="number"&&h>=15&&h<=20)d=h,u==="TRIPLE"?p=3:u==="DOUBLE"?p=2:p=1;else if(i){const y=[20,19,18,17,16,15];for(const M of y){if(i===M){d=M,p=1;break}if(i===M*2){d=M,p=2;break}if(i===M*3){d=M,p=3;break}}!d&&(i===25||i===50)&&(d=25,p=i===50?2:1)}if(!d)return 0;const A=n.marks[d];let B=Math.max(0,3-A);const I=Math.min(B,p),P=Math.max(0,p-I),$=A+I;n.marks[d]=$>3?3:$;let U=0;return P>0&&!o(d)&&(d===25?u==="INNER_BULL"?U+=50*P:U+=25*P:U+=d*P),n.points+=U,U}function Rl(n){return ma.every(i=>(n.marks[i]||0)>=3)}function ta(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function Il(n){return n.round}function Pl(n,i,u,h){if(n.finished)return 0;const o=Il(n);let d=0;return typeof h=="number"&&h===o?u==="TRIPLE"?(d=o*3,n.turnHits.triples++):u==="DOUBLE"?(d=o*2,n.turnHits.doubles++):u==="SINGLE"&&(d=o*1,n.turnHits.singles++):!h&&(i===o||i===o*2||i===o*3)&&(i===o*3?(d=o*3,n.turnHits.triples++):i===o*2?(d=o*2,n.turnHits.doubles++):i===o&&(d=o,n.turnHits.singles++)),n.score+=d,d}function Fl(n){if(!n.finished){if(n.turnHits.singles>0&&n.turnHits.doubles>0&&n.turnHits.triples>0){n.shanghaiAchieved=!0,n.finished=!0;return}const i=n.round+1;i>20?n.finished=!0:n.round=i}n.turnHits={singles:0,doubles:0,triples:0}}function sa(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function oi(n){return n.targets[n.stage]||null}function Bl(n,i,u,h){if(n.finished)return 0;const o=oi(n);if(!o)return 0;let d=0;switch(o.kind){case"NUMBER":{typeof h=="number"&&h===o.num?u==="TRIPLE"?d=o.num*3:u==="DOUBLE"?d=o.num*2:u==="SINGLE"&&(d=o.num):!h&&(i===o.num||i===o.num*2||i===o.num*3)&&(d=i),d>0&&(n.hitThisRound=!0);break}case"DOUBLE":{(u==="DOUBLE"&&h===o.num||i===o.num*2)&&(d=o.num*2,n.hitThisRound=!0);break}case"TRIPLE":{(u==="TRIPLE"&&h===o.num||i===o.num*3)&&(d=o.num*3,n.hitThisRound=!0);break}case"BULL":{(u==="BULL"||u==="INNER_BULL"||i===25||i===50)&&(d=u==="INNER_BULL"||i===50?50:25,n.hitThisRound=!0);break}case"ANY_NUMBER":{i>0&&(d=i,n.hitThisRound=!0);break}}return n.score+=d,d}function Ol(n){n.finished||(n.hitThisRound||(n.score=Math.floor(n.score/2)),n.hitThisRound=!1,n.stage+=1,n.stage>=n.targets.length&&(n.finished=!0))}function na(){return{round:1,score:0,target:"HIGH",finished:!1}}function Hl(n,i,u,h){if(n.finished)return 0;let o=0;if(n.target==="HIGH")if(u==="INNER_BULL")o=50;else if(typeof h=="number"){const p=h*(u==="TRIPLE"?3:u==="DOUBLE"?2:1);h>=20&&(o=p)}else i>=40&&(o=i);else if(typeof h=="number"){const p=h*(u==="TRIPLE"?3:u==="DOUBLE"?2:1);h<=10&&(o=p)}else i>0&&i<=30&&(o=i);return n.score+=o,o}function Ul(n){if(!n.finished){if(n.round+=1,n.round>10){n.finished=!0;return}n.target=n.target==="HIGH"?"LOW":"HIGH"}}function Vl(n,i=3){return{number:n,lives:i,isKiller:!1,eliminated:!1}}function $l(n){const i=Array.from({length:20},(h,o)=>o+1),u={};for(const h of n){const o=Math.floor(Math.random()*i.length),d=i.splice(o,1)[0];u[h]=d}return u}function Yr(n,i,u,h){const o=i[n];if(!o||!h||!u)return{becameKiller:!1};if(!o.isKiller&&u==="DOUBLE"&&h===o.number)return o.isKiller=!0,{becameKiller:!0};if(o.isKiller&&(u==="DOUBLE"||u==="TRIPLE")){const d=Object.keys(i).find(p=>p!==n&&!i[p].eliminated&&i[p].number===h);if(d){const p=i[d],A=u==="TRIPLE"?2:1;return p.lives=Math.max(0,p.lives-A),p.lives===0&&(p.eliminated=!0),{becameKiller:!1,victimId:d,livesRemoved:A}}}return{becameKiller:!1}}function Jr(n){const i=Object.entries(n).filter(([,u])=>!u.eliminated&&u.lives>0);return i.length===1?i[0][0]:null}const ua=[20,19,18,17,16,15,14,13,12,25];function Qr(){const n={};return ua.forEach(i=>{n[i]=0}),{marks:n,points:0}}function Wl(n,i,u,h,o=()=>!1){let d=null,p=0;if(u==="BULL"||u==="INNER_BULL"||i===25||i===50)d=25,p=u==="INNER_BULL"||i===50?2:1;else if(typeof h=="number"&&h>=12&&h<=20)d=h,u==="TRIPLE"?p=3:u==="DOUBLE"?p=2:p=1;else if(i){for(const y of[20,19,18,17,16,15,14,13,12]){if(i===y){d=y,p=1;break}if(i===y*2){d=y,p=2;break}if(i===y*3){d=y,p=3;break}}!d&&(i===25||i===50)&&(d=25,p=i===50?2:1)}if(!d)return 0;const A=n.marks[d],B=Math.max(0,3-A),I=Math.min(B,p),P=Math.max(0,p-I),$=A+I;n.marks[d]=$>3?3:$;let U=0;return P>0&&!o(d)&&(d===25?u==="INNER_BULL"?U+=50*P:U+=25*P:U+=d*P),n.points+=U,U}function Kl(n){return ua.every(i=>(n.marks[i]||0)>=3)}function Zr(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function _l(n,i,u,h){if(n.finished)return 0;let o=0;if(typeof h=="number"&&h===n.inning?u==="TRIPLE"?o=3:u==="DOUBLE"?o=2:o=1:!h&&(i===n.inning||i===n.inning*2||i===n.inning*3)&&(o=i===n.inning*3?3:i===n.inning*2?2:1),n.score+=o,n.dartsThisInning+=1,n.dartsThisInning>=3){const d=n.inning+1;d>9?n.finished=!0:(n.inning=d,n.dartsThisInning=0)}return o}const Gl={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function ei(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function zl(n,i,u,h){if(n.finished)return!1;const o=Gl[n.hole];if(n.dartsThisHole+=1,typeof h=="number"&&h===o&&(u==="SINGLE"||u==="DOUBLE"||u==="TRIPLE")||!h&&(i===o||i===o*2||i===o*3)){n.strokes+=n.dartsThisHole;const p=n.hole+1;return p>18?n.finished=!0:(n.hole=p,n.dartsThisHole=0),!0}if(n.dartsThisHole>=3){n.strokes+=3;const p=n.hole+1;p>18?n.finished=!0:(n.hole=p,n.dartsThisHole=0)}return!1}function ql({gameMode:n,compact:i=!1,onRecalibrate:u}){const{H:h,errorPx:o}=nl(),d=al(n,o),p=rl(n,o),{quality:A,text:B}=il(n,o),I=ll(n),P=ol[n];if(!h||!o)return i?e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30",children:[e.jsx(sn,{className:"w-3 h-3"}),"Not calibrated"]}):e.jsxs("div",{className:"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2",children:[e.jsx(sn,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-red-300",children:"Calibration Required"}),e.jsxs("div",{className:"text-xs opacity-80",children:["Please calibrate before playing ",n]})]}),u&&e.jsx("button",{className:"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700",onClick:u,children:"Calibrate"})]});const $=p?"bg-emerald-500/20 border-emerald-600/30":"bg-amber-500/20 border-amber-600/30",U=p?"text-emerald-300":"text-amber-300",y=p?jl:sn;return i?e.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${$} ${U}`,children:[zr.createElement(y,{className:"w-3 h-3"}),e.jsx("span",{children:B}),!p&&I&&e.jsx("span",{className:"w-3 h-3 cursor-help",title:I,children:e.jsx(Nl,{className:"w-3 h-3 inline"})})]}):e.jsxs("div",{className:`px-3 py-2 rounded border ${$} space-y-1`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[zr.createElement(y,{className:`w-4 h-4 ${p?"text-emerald-400":"text-amber-400"} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`font-medium ${p?"text-emerald-300":"text-amber-300"}`,children:["Calibration for ",n]}),e.jsxs("div",{className:"text-xs opacity-80",children:["Error: ",Math.round(o),"px | ",B]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 rounded bg-black/30 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${p?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Math.min(100,d)}%`}})}),e.jsxs("span",{className:"text-xs font-mono",children:[Math.round(d),"%"]})]}),P&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{children:["Tolerance: Â±",P.tolerancePx,"px | Min: ",P.minConfidence,"%"]})}),e.jsxs("div",{className:"space-y-1",children:[!p&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1",children:[e.jsx(sn,{className:"w-3 h-3 flex-shrink-0"}),"Calibration quality is below minimum for ",n]}),I&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1",children:[e.jsx(yl,{className:"w-3 h-3 flex-shrink-0"}),I]})]}),!p&&u&&e.jsxs("button",{className:"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700",onClick:u,children:["Recalibrate for ",n]})]})}function ti({label:n,autoStart:i,scale:u,className:h,aspect:o="inherit",style:d,fill:p=!1}){const A=a.useRef(null),B=li(),[I,P]=a.useState(!1),[$,U]=a.useState(null),[y,M]=a.useState(null),[z,N]=a.useState(null),ee=a.useRef(null),te=a.useCallback((m,S="local")=>{try{m?(B.setMediaStream(m),A.current&&B.setVideoElementRef(A.current),B.setMode(S),B.setStreaming(!0),ee.current=S):ee.current&&ee.current!=="phone"&&(B.setStreaming(!1),B.setMediaStream(null),ee.current=null)}catch(C){console.warn("[CameraTile] Failed to register stream with camera session:",C)}},[B]),q=Re(m=>m.preferredCameraLabel),[se,Ce]=a.useState(()=>{if(q==="Phone Camera")return console.log("[CAMERATILE] Initializing mode to phone (from preferred camera selection)"),"phone";const m=localStorage.getItem("ndn:camera:mode");return console.log("[CAMERATILE] Initializing mode to",m||"local","(from localStorage)"),m||"local"}),[Ie,ke]=a.useState(null),[qe,Pe]=a.useState(!1),[Xe,me]=a.useState(null),[T,oe]=a.useState(null),[x,dt]=a.useState(!0),[R,He]=a.useState([]),[O,Ye]=a.useState(!1),[Fe,ne]=a.useState([]),[Je,Ue]=a.useState(!1),V=Re(m=>m.autoscoreProvider),X=Re(m=>m.cameraEnabled),_=Re(m=>m.setPreferredCameraLocked),nt=Re(m=>m.preferredCameraLocked),mt=Re(m=>m.setPreferredCamera),ut=Re(m=>m.preferredCameraId);if(V==="manual"){const S=[p?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",h].filter(Boolean).join(" ").trim(),C={...d||{}};return!p&&C.aspectRatio===void 0&&C.height===void 0&&C.minHeight===void 0&&(C.aspectRatio="4 / 3"),e.jsx("div",{className:S,style:C,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}a.useEffect(()=>{const m=window.location.hostname;(m==="localhost"||m==="127.0.0.1")&&Kr("/api/hosts").then(S=>S.json()).then(S=>{const C=Array.isArray(S?.hosts)&&S.hosts.find(k=>k);C&&me(C)}).catch(()=>{}),Kr("/api/https-info").then(S=>S.json()).then(S=>{S&&typeof S.https=="boolean"&&oe({https:!!S.https,port:Number(S.port)||8788})}).catch(()=>{})},[]);const Ct=a.useMemo(()=>{const m=y||"____",S="ws://localhost:8787";if(S.length>0)try{const Le=new URL(S);return`${`${Le.protocol==="wss:"?"https":"http"}://${Le.host}${Le.pathname.endsWith("/ws")?"":Le.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${m}`}catch{}const C=Xe||window.location.hostname,k=!!T?.https,H=k?T?.port||8788:8787;return`${k?"https":"http"}://${C}:${H}/mobile-cam.html?code=${m}`},[y,Xe,T]);a.useEffect(()=>{console.log("[CAMERATILE] Mode changed to:",se,"- persisting to localStorage"),localStorage.setItem("ndn:camera:mode",se)},[se]);const[G,Qe]=a.useState(null);a.useEffect(()=>{const m=Re.getState().ignorePreferredCameraSync;console.log("[CAMERATILE] Checking camera selection sync: preferredCameraLabel=",q,"mode=",se,"ignoreSync=",m,"manualModeSetAt=",G),!m&&(G&&Date.now()-G<3e4||q==="Phone Camera"&&se!=="phone"&&(console.log("[CAMERATILE] Syncing mode to phone from Calibrator selection"),Ce("phone")))},[q,se,G]),a.useEffect(()=>{if(!(!X||V&&V!=="built-in"&&V!=="external-ws")&&i!==void 0){if(i){let m=!1;const S=q||"default",C=window.setTimeout(()=>{m||I||De().catch(k=>console.warn(`[CameraTile] Auto-start failed for ${S}:`,k))},200);return()=>{m=!0,window.clearTimeout(C)}}J()}},[i,I,X,V,q,De,J]),a.useEffect(()=>{const m=async()=>{try{if(!(q==="Phone Camera"&&(!G||Date.now()-G>=3e4)||se==="phone"))return;const k=B.getMediaStream(),H=A.current;if(!H||!k)return;H.srcObject!==k&&(H.srcObject=k),H.muted=!0,H.playsInline=!0;try{await H.play()}catch{}P(!0)}catch{}};m();const S=setInterval(m,800);return()=>clearInterval(S)},[q,se,B,B.isStreaming]);async function De(){if(console.log("[CameraTile] start() invoked with mode=",se),se==="wifi")return L();if(console.log("[CameraTile] Attempting to attach global stream for phone mode..."),q==="Phone Camera"||se==="phone"){const m=B.getMediaStream();if(m&&A.current)try{A.current.srcObject=m,await A.current.play(),P(!0);return}catch{}if(se==="phone")try{await Ve();return}catch{}}try{const{preferredCameraId:m,setPreferredCamera:S}=Re.getState(),C=m?{video:{deviceId:{exact:m}},audio:!1}:{video:!0,audio:!1};let k;try{k=await navigator.mediaDevices.getUserMedia(C)}catch(H){const Ae=H&&(H.name||H.code)||"";if(m&&(Ae==="OverconstrainedError"||Ae==="NotFoundError"))k=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw H}A.current&&(A.current.srcObject=k,await A.current.play(),P(!0),te(k,"local"))}catch{}}function J(){A.current&&A.current.srcObject&&(A.current.srcObject.getTracks().forEach(S=>S.stop()),A.current.srcObject=null,P(!1),te(null))}async function L(){Ye(!0);try{const m=await cl();He(m),m.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(m){console.error("Wifi device discovery failed:",m),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Ye(!1)}}async function ae(m){try{He(C=>C.map(k=>k.id===m.id?{...k,status:"connecting"}:k));const S=await dl(m);if(S&&A.current)A.current.srcObject=S,await A.current.play(),P(!0),te(S,"wifi"),He(C=>C.map(k=>k.id===m.id?{...k,status:"online"}:k));else throw new Error("Failed to get video stream")}catch(S){console.error("Failed to connect to wifi device:",S),alert(`Failed to connect to ${m.name}. Please check the device and try again.`),He(C=>C.map(k=>k.id===m.id?{...k,status:"offline"}:k))}}async function ge(){Ue(!0);try{const m=await ml();ne(m);const S=await ul();S&&ne(C=>[...C,S]),m.length===0&&!S&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(m){console.error("USB device discovery failed:",m),alert("Failed to discover USB devices. Please check device connections.")}finally{Ue(!1)}}async function Ss(m){try{ne(C=>C.map(k=>k.id===m.id?{...k,status:"connecting"}:k));const S=await xl(m);if(S&&A.current)A.current.srcObject=S,await A.current.play(),P(!0),Ce("wifi"),te(S,"wifi"),ne(C=>C.map(k=>k.id===m.id?{...k,status:"online"}:k));else throw new Error("Failed to get video stream")}catch(S){console.error("Failed to connect to USB device:",S),alert(`Failed to connect to ${m.name}. Please check the device and try again.`),ne(C=>C.map(k=>k.id===m.id?{...k,status:"offline"}:k))}}const kt=a.useCallback(m=>{try{Ce(m==="usb"?"wifi":m),Qe(Date.now());try{if(m==="local"){try{mt(ut,"Local",!0)}catch{}try{_(!0)}catch{}}else if(m==="phone"){try{mt(void 0,"Phone Camera",!0)}catch{}try{_(!0)}catch{}}else if(m==="wifi"||m==="usb"){try{mt(void 0,"WiFi/USB",!0)}catch{}try{_(!0)}catch{}}}catch{}m==="local"?De().catch(()=>{}):m==="phone"?Ve():m==="wifi"?L():m==="usb"&&ge()}catch(S){console.warn("[CameraTile] handleModeSelect failed",S)}},[De,Ve,L,ge,mt,_,ut]);a.useEffect(()=>{const m=S=>{try{const C=S&&S.detail&&S.detail.mode;C&&["local","phone","wifi","usb"].includes(C)?(kt(C),De().catch(()=>{})):De().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",m),()=>{window.removeEventListener("ndn:start-camera",m)}},[De,kt]);function le(){if($&&$.readyState===WebSocket.OPEN)return $;const m="ws://localhost:8787",S=m.length>0?m.endsWith("/ws")?m:m.replace(/\/$/,"")+"/ws":void 0,C=window.location.protocol==="https:"?"wss":"ws",k=`${C}://${window.location.host}/ws`,H=window.location.hostname,Ae=H==="localhost"||H==="127.0.0.1",Le=H.endsWith("onrender.com"),Cs="wss://ninedartnation.onrender.com/ws";let ce=S;ce||(Ae?ce=`${C}://${H}:8787/ws`:Le?ce=k:ce=Cs),ce||(ce=k);const xt=new WebSocket(ce);return U(xt),xt}async function Ve(){Ce("phone"),Pe(!1);const m=le();m.readyState===WebSocket.OPEN?m.send(JSON.stringify({type:"cam-create"})):m.onopen=()=>m.send(JSON.stringify({type:"cam-create"})),m.onmessage=async S=>{const C=JSON.parse(S.data);if(C.type==="cam-code")M(C.code),C.expiresAt&&ke(C.expiresAt);else if(C.type==="cam-peer-joined"){Pe(!0);const k=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});N(k),k.onicecandidate=Ae=>{Ae.candidate&&y&&m.send(JSON.stringify({type:"cam-ice",code:y,payload:Ae.candidate}))},k.ontrack=Ae=>{if(A.current){const Le=Ae.streams?.[0];Le&&(A.current.srcObject=Le,A.current.play().catch(()=>{}),P(!0))}};const H=await k.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await k.setLocalDescription(H),y&&m.send(JSON.stringify({type:"cam-offer",code:y,payload:H}))}else if(C.type==="cam-answer")z&&await z.setRemoteDescription(new RTCSessionDescription(C.payload));else if(C.type==="cam-ice"&&z)try{await z.addIceCandidate(C.payload)}catch{}}}function Dt(){M(null),ke(null),Pe(!1),$&&$.readyState===WebSocket.OPEN?$.send(JSON.stringify({type:"cam-create"})):Ve();try{_(!0)}catch{}}function ue(){if(J(),M(null),Pe(!1),ke(null),z){try{z.close()}catch{}N(null)}}return e.jsx(Xl,{label:n,autoStart:i,start:De,stopAll:ue,startPhonePairing:Ve,startWifiConnection:L,startUsbConnection:ge,connectToWifiDevice:ae,connectToUsbDevice:Ss,videoRef:A,streaming:I,mode:se,setMode:Ce,pairCode:y,mobileUrl:Ct,regenerateCode:Dt,httpsInfo:T,showTips:x,setShowTips:dt,wifiDevices:R,usbDevices:Fe,discoveringWifi:O,discoveringUsb:Je,scaleOverride:u,className:h,aspect:o,style:d,fill:p,onModeSelect:kt,preferredCameraLocked:nt})}function Xl(n){const i=li(),{cameraScale:u,cameraAspect:h}=Re(),{label:o,start:d,stopAll:p,startPhonePairing:A,startWifiConnection:B,startUsbConnection:I,connectToWifiDevice:P,connectToUsbDevice:$,videoRef:U,streaming:y,mode:M,setMode:z,onModeSelect:N,pairCode:ee,mobileUrl:te,regenerateCode:q,httpsInfo:se,showTips:Ce,setShowTips:Ie,wifiDevices:ke,usbDevices:qe,discoveringWifi:Pe,discoveringUsb:Xe,className:me,aspect:T,style:oe,fill:x,preferredCameraLocked:dt}=n,R={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},He=a.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{N&&N("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{N&&N("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{N&&N("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{N&&N("usb")}}],[z,d,A,B,I]),[O,Ye]=a.useState(null),Fe=a.useRef(null);a.useEffect(()=>()=>{Fe.current&&window.clearTimeout(Fe.current)},[]);const{cameraFitMode:ne}=Re(),Je=x?"fill":ne||"fill",Ue=(()=>{const L=Number(n.scaleOverride??u??1),ae=Math.max(.5,Math.min(1.25,L));return Je==="fill"?Math.max(1,ae):ae})(),V=x&&Je==="fill"?"free":T&&T!=="inherit"?T:h||"wide",X=V!=="free",_=X?V==="square"?"aspect-square":V==="portrait"?"aspect-[3/4]":V==="classic"?"aspect-[4/3]":"aspect-video":"",mt=[x?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",me].filter(Boolean).join(" ").trim(),ut={...oe||{}},Ct=x?"relative flex-1 min-h-[420px] bg-black":"relative w-full bg-black",G={style:{transform:`scale(${Ue})`,transformOrigin:"center"}},Qe=M==="wifi"&&qe.some(L=>L.status==="online"),De=(()=>{const ae=Je==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return x?X?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${_}`,children:e.jsx("video",{ref:U,className:ae,...G})})}):e.jsx("video",{ref:U,className:ae,...G}):X?e.jsx("div",{className:`relative w-full ${_}`,children:e.jsx("video",{ref:U,className:ae,...G})}):e.jsx("video",{ref:U,className:ae,...G})})();async function J(L,ae){if(L)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(L);else{const ge=document.createElement("textarea");ge.value=L,ge.style.position="fixed",ge.style.opacity="0",document.body.appendChild(ge),ge.focus(),ge.select(),document.execCommand("copy"),document.body.removeChild(ge)}Ye(ae),Fe.current&&window.clearTimeout(Fe.current),Fe.current=window.setTimeout(()=>Ye(null),1500)}catch(ge){console.warn("Copy to clipboard failed:",ge),Ye(null)}}return e.jsxs("div",{className:mt,style:ut,children:[e.jsxs("div",{className:Ct,children:[De,i.isStreaming&&M==="phone"&&e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{children:"REC"})]})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[e.jsxs("span",{className:"truncate font-medium",children:[o||(y?M==="phone"?"PHONE LIVE":M==="wifi"?"WIFI LIVE":"LIVE":"Camera"),dt&&e.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!y&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${M==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>N("local"),children:"Local"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${M==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>N("phone"),children:"Phone"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${M==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>N("wifi"),children:"WiFi"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${M==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>N("usb"),children:"USB"})]}),y?e.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:p,children:"Stop"}):null]})]}),M==="phone"&&ee&&!y&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>J(te,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:te}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:O==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:te,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>J(ee,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:ee}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:O==="code"?"Copied!":"Copy"})]})]}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:q,children:"Regenerate"})}),Ce&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",se?.https?se.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>Ie(!1),children:"Hide tips"})})]})]}),M==="wifi"&&!y&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),Pe?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):ke.length>0?e.jsxs("div",{className:"space-y-1",children:[ke.map(L=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:L.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[L.ip,":",L.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${L.status==="connecting"?"bg-yellow-600":L.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>P(L),disabled:L.status==="connecting",children:L.status==="connecting"?"...":"Connect"})]},L.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:B,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:B,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),Xe?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):qe.length>0?e.jsxs("div",{className:"space-y-1",children:[qe.map(L=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:L.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:L.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${L.status==="connecting"?"bg-yellow-600":L.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>$(L),disabled:L.status==="connecting",children:L.status==="connecting"?"...":"Connect"})]},L.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:I,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:I,children:"Scan USB"})]})]})]}),!y&&e.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",R[M]||"Local"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:He.map(L=>{const ae=L.id==="usb"?Qe:L.id===M;return e.jsxs("button",{type:"button",onClick:L.action,className:`text-left p-3 rounded-2xl border ${ae?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:L.title}),e.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:L.description}),ae&&e.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},L.id)})})]})]})}function si(n,i,u,h){const o=(h-90)*Math.PI/180;return{x:n+u*Math.cos(o),y:i+u*Math.sin(o)}}function ni(n){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(n)*18+9}function Yl({width:n=320,height:i=320}){const u=Dl(o=>o.samples),h=a.useRef(null);return a.useEffect(()=>{const o=h.current;if(!o)return;const d=o.getContext("2d");if(!d)return;o.width=n,o.height=i,d.clearRect(0,0,n,i);const p=n/2,A=i/2,B=Math.min(n,i)/(wt.doubleOuter*2+20),I={bullInner:wt.bullInner*B,bullOuter:wt.bullOuter*B,trebleInner:wt.trebleInner*B,trebleOuter:wt.trebleOuter*B,doubleInner:wt.doubleInner*B,doubleOuter:wt.doubleOuter*B};d.strokeStyle="rgba(255,255,255,0.06)",d.lineWidth=1;const P=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const y of P)d.beginPath(),d.arc(p,A,I[y],0,Math.PI*2),d.stroke();const $=[];for(const y of u){let M=Math.random()*360,z=Math.random()*I.doubleOuter;typeof y.sector=="number"&&y.sector>=1&&y.sector<=20&&(M=ni(y.sector),y.ring==="DOUBLE"?z=(I.doubleInner+I.doubleOuter)/2:y.ring==="TRIPLE"?z=(I.trebleInner+I.trebleOuter)/2:y.ring==="INNER_BULL"?z=I.bullInner*.5:y.ring==="BULL"?z=I.bullOuter*.8:z=(I.trebleOuter+I.doubleInner)/2*(.6+Math.random()*.4));const N=si(p,A,z,M);$.push({x:N.x,y:N.y,w:1})}for(const y of $){const M=d.createRadialGradient(y.x,y.y,1,y.x,y.y,60);M.addColorStop(0,"rgba(255,0,0,0.9)"),M.addColorStop(.3,"rgba(255,100,0,0.5)"),M.addColorStop(1,"rgba(255,100,0,0)"),d.fillStyle=M,d.beginPath(),d.arc(y.x,y.y,60,0,Math.PI*2),d.fill()}d.fillStyle="rgba(255,255,255,0.85)",d.font="12px ui-sans-serif";const U={};for(const y of u)y.sector&&(U[y.sector]=(U[y.sector]||0)+1);for(const y of Object.keys(U)){const M=Number(y),z=ni(M),N=si(p,A,I.trebleOuter+18,z);d.fillText(String(U[M]),N.x-6,N.y+4)}},[u,n,i]),e.jsx("canvas",{ref:h,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}function ra(){return{targetIndex:0,darts:0,finished:!1}}const ci=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25],aa=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","Bull"];function Jl(n){return ci[n.targetIndex]}function ia(n,i,u){if(n.finished)return n;const h=Jl(n);if(!(u==="SINGLE"&&i===h||u==="DOUBLE"&&i===h||u==="TRIPLE"&&i===h||u==="INNER_BULL"&&h===25))return n;const d=n.targetIndex+1,p=d>=ci.length;return{targetIndex:d,darts:n.darts+1,finished:p}}function ai(n,i){return ia(n,i,"SINGLE")}function Ql(){return ra()}function la(n=50){return{score:0,darts:0,finished:!1,target:n}}const Zl=[5,10,15,20,25,50];function eo(n){return Zl.includes(n)}function oa(n,i,u){if(n.finished)return n;if(!eo(i))return{...n,darts:n.darts+1};const h=n.score+i,o=h>=n.target;return{score:o?n.target:h,darts:n.darts+1,finished:o,target:n.target}}function ri(n,i){return oa(n,i)}function to(n=50){return la(n)}function ca(n=70){return{score:0,darts:0,finished:!1,target:n}}const so=[7,14,21];function no(n){return so.includes(n)}function da(n,i,u){if(n.finished)return n;if(!no(i))return{...n,darts:n.darts+1};const h=n.score+i,o=h>=n.target;return{score:o?n.target:h,darts:n.darts+1,finished:o,target:n.target}}function ii(n,i){return da(n,i)}function ao(n=70){return ca(n)}function Te(n){return(i,u)=>{n(i)}}function ro(n){const{match:i,commitManualVisitTotal:u,endTurn:h}=n;return{addVisit:(o,d=3,p)=>{if(u){u(o);return}try{i.addVisit(o,d,p)}catch{i.addVisit(o,d)}},undoVisit:()=>{i.undoVisit()},nextPlayer:()=>{if(h)try{h(0)}catch{i.nextPlayer()}else i.nextPlayer()},endLeg:o=>{typeof o=="number"?i.endLeg(o):i.endLeg(0)},endGame:()=>{i.endGame()}}}function St(n,i,u,h,o,d,p,A,B,I,P,$,U,y,M,z,N,ee,te,q,se,Ce,Ie,ke,qe,Pe,Xe){return a.useMemo(()=>{const me=[];if(n==="X01"){let T=0,oe=0,x=0;if(ee&&ee.length>0){for(const ne of ee)ne.dartsThrown&&ne.totalScored&&(oe+=ne.dartsThrown,x+=ne.totalScored);oe>0&&(T=x/oe*3)}const Fe=($??0)>0?A??0:I??null??(d??0);if(me.push({name:"You",isCurrentTurn:!!te,legsWon:h||0,score:i||0,lastScore:Fe,checkoutRate:M&&M>0?Math.round((y||0)/M*100):0,bestLeg:ee&&ee.length>0?`${Math.min(...ee.map(ne=>ne.doubleDarts+(ne.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:T,allTimeAvg:hl("You")||0}),q&&q!=="None"){const _=(U??0)>0?B??0:P??null??(p??0);me.push({name:`${q} AI`,isCurrentTurn:!te,legsWon:o||0,score:u||0,lastScore:_,checkoutRate:N&&N>0?Math.round((z||0)/N*100):0,bestLeg:"â€”"})}}return n==="Cricket"&&(me.push({name:"You",isCurrentTurn:!!te,closed:Ce?.marks||{},points:Ce?.points||0}),q&&q!=="None"&&me.push({name:`${q} AI`,isCurrentTurn:!te,closed:{},points:0})),n==="Shanghai"&&(me.push({name:"You",isCurrentTurn:!!te,round:Ie?.round||1,target:Ie?.target||1,score:Ie?.score||0}),q&&q!=="None"&&me.push({name:`${q} AI`,isCurrentTurn:!te,round:Ie?.round||1,target:Ie?.target||1,score:0})),n==="Killer"&&ke&&ke.length>0&&ke.forEach((T,oe)=>{const x=qe?.[T.id];me.push({name:T.name,isCurrentTurn:oe===Xe,number:Pe?.[T.id],lives:x?.lives||0,eliminated:x?.eliminated||!1})}),me},[n,i,u,h,o,d,p,A,B,I,P,$,U,y,M,z,N,ee,te,q,Ce,Ie,ke,qe,Pe,Xe])}const io=["Easy","Medium","Hardened"];function ze(n,i,u){return Math.max(i,Math.min(u,n))}const lo=6500;function oo(n,i){let u=0;if(i==="Easy"){const h=[22,26,41,45,60];u=h[Math.floor(Math.random()*h.length)]}else i==="Medium"?u=Math.round(ze(60+(Math.random()*30-15),30,100)):u=Math.round(ze(80+(Math.random()*20-10),50,120));return n<=0?0:u>n?[100,85,81,60,57,45,41,26,22,20,1].find(o=>o<=n)??0:u}function co({onClose:n}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:n,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const mo="http://localhost:8787";function Po({user:n}){const{offlineLayout:i,favoriteDouble:u,callerEnabled:h,callerVoice:o,callerVolume:d,speakCheckoutOnly:p,rememberLastOffline:A,setLastOffline:B,autoStartOffline:I,cameraScale:P,setCameraScale:$,cameraAspect:U="wide",setCameraAspect:y,cameraFitMode:M="fill",setCameraFitMode:z,cameraEnabled:N,textSize:ee,boxSize:te,autoscoreProvider:q,autoCommitMode:se="wait-for-clear",matchType:Ce="singles",setMatchType:Ie,teamAName:ke="Team A",setTeamAName:qe,teamBName:Pe="Team B",setTeamBName:Xe}=Re(),me=q==="manual",T=N&&!me,oe=N&&!me&&se!=="immediate",[x,dt]=a.useState("X01"),[R,He]=a.useState(501),[O,Ye]=a.useState("None"),[Fe,ne]=a.useState(!1),[Je,Ue]=a.useState(!1),[V,X]=a.useState(R),[_,nt]=a.useState(R),[mt,ut]=a.useState(!1),[Ct,G]=a.useState(!1),[Qe,De]=a.useState(1),[J,L]=a.useState(0),ae=Tl(),[ge,Ss]=a.useState(!1),kt=a.useRef(!1),[le,Ve]=a.useState(0),[Dt,ue]=a.useState(null),[m,S]=a.useState(1),[C,k]=a.useState(1),[H,Ae]=a.useState([]),[Le,Cs]=a.useState(2e3),ce=fl(),[xt,qt]=a.useState(!1),[Xt,xa]=a.useState(i==="modern"),[Yt,ha]=a.useState(i==="modern");a.useEffect(()=>{xa(i==="modern"),ha(i==="modern")},[i]),a.useEffect(()=>{M!=="fit"&&z("fit")},[M,z]);const[ks,fa]=a.useState(1),[uo,pa]=a.useState(!1),[Z,Jt]=a.useState(!0);a.useEffect(()=>{const t=()=>Ot(!0);return window.addEventListener("ndn:open-camera-manager",t),()=>window.removeEventListener("ndn:open-camera-manager",t)},[]);const[F,E]=a.useState(0),[Qt,an]=a.useState(0),[rn,ln]=a.useState(0),[ht,ba]=a.useState(0),[ga,va]=a.useState(0),[Zt,on]=a.useState(ea()),[Ds,As]=a.useState(ta()),[es,Ms]=a.useState(sa()),[Ts,Ls]=a.useState(na()),[xo,Ee]=a.useState(0),[ja,Na]=a.useState(1),[di,cn]=a.useState(27),[ho,ya]=a.useState(0),[mi,dn]=a.useState(0),[wa,Sa]=a.useState(!1),[Ca,ka]=a.useState(1),[ui,Da]=a.useState(0),[fo,Aa]=a.useState(0),xi=8,[Ma,Ta]=a.useState(1),[hi,La]=a.useState(0),[po,Ea]=a.useState(0),fi=10,[Ra,Ia]=a.useState(1),[pi,Pa]=a.useState(0),[bo,Fa]=a.useState(0),bi=10,[mn,un]=a.useState(170),[Ba,Oa]=a.useState(0),[Ha,Ua]=a.useState(0),[Va,$a]=a.useState(0),[xn,hn]=a.useState(121),[Wa,Ka]=a.useState(0),[_a,Ga]=a.useState(0),[za,qa]=a.useState(0),[ft,fn]=a.useState(20),[pn,bn]=a.useState(0),[Xa,gn]=a.useState(0),[ts,gi]=a.useState(30),[Ya,vn]=a.useState(!1),[Ja,Qa]=a.useState(Zr()),[Za,er]=a.useState(ei()),[pt,tr]=a.useState(qr()),[jn,sr]=a.useState(Qr()),[Q,Nn]=a.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[ss,ns]=a.useState({}),[Es,yn]=a.useState({}),[nr,wn]=a.useState(!1),[$e,At]=a.useState(0),[go,Mt]=a.useState(0),[Tt,as]=a.useState(null),[vi,Ze]=a.useState(""),[Rs,vo]=a.useState(ra()),[bt,rs]=a.useState(ra()),[is,jo]=a.useState(la(50)),[Be,ls]=a.useState(la(50)),[os,No]=a.useState(ca(70)),[Oe,cs]=a.useState(ca(70)),[Is,gt]=a.useState(0),[et,at]=a.useState(0),[re,xe]=a.useState(0),[Sn,ds]=a.useState(R),[We,we]=a.useState(0),[Lt,tt]=a.useState(null),[Ps,ve]=a.useState(0),vt=a.useRef(0),ji=a.useRef(0),he=a.useRef(V),fe=a.useRef(re),je=a.useRef(We),jt=a.useRef(Sn),pe=a.useRef(Ps);a.useEffect(()=>{he.current=V},[V]),a.useEffect(()=>{fe.current=re},[re]),a.useEffect(()=>{je.current=We},[We]),a.useEffect(()=>{jt.current=Sn},[Sn]),a.useEffect(()=>{pe.current=Ps},[Ps]);const[Ni,ms]=a.useState(0);a.useRef(null);const[Fs,Cn]=a.useState(0),[Nt,Bs]=a.useState(0),[Et,yt]=a.useState(0),[Rt,st]=a.useState(0),[It,Pt]=a.useState(null),[kn,Ft]=a.useState(0),[us,xs]=a.useState(0),[Dn,Os]=a.useState(0),[hs,ar]=a.useState(0),[An,rr]=a.useState(0),[fs,Bt]=a.useState(0),[ps,ir]=a.useState(0),[Mn,bs]=a.useState(0),[Tn,lr]=a.useState(0),[or,Hs]=a.useState(0),[yi,Us]=a.useState(0),[wi,Vs]=a.useState(0),[cr,Ln]=a.useState(0),[Si,En]=a.useState(0),[Ci,Rn]=a.useState(0),[ki,$s]=a.useState(0),[Di,dr]=a.useState(0),[Ai,In]=a.useState(!1),[be,de]=a.useState(""),[Pn,gs]=a.useState(""),[yo,wo]=a.useState(""),[mr,ur]=a.useState(""),[xr,Fn]=a.useState(""),[hr,Bn]=a.useState(""),[Ws,On]=a.useState(null),[Mi,Ot]=a.useState(!1),[Ti,fr]=a.useState({}),[Li,vs]=a.useState(!1),rt=a.useRef(null),Hn=a.useRef(null),Ke=a.useCallback(()=>{const t=Hn.current;t&&(clearTimeout(t),Hn.current=null)},[]),Ks=a.useCallback(t=>{if(!h)return;const s=n?.username||"Player";try{nn(s,t.visitTotal,Math.max(t.remaining,0),o,{volume:d,checkoutOnly:p})}catch{}},[h,o,d,p,n?.username]),_s=a.useCallback((t,s)=>{vs(!1);const{visitTotal:r,darts:l,preRemaining:c,remaining:v,doubleAttempts:g,finished:D,doubleWindow:b,highestCheckout:j}=t;D?(X(0),he.current=0,typeof j=="number"&&j>0&&$s(f=>Math.max(f,j))):(X(v),he.current=v),tt(r),r===180?Hs(f=>f+1):r>=140?Us(f=>f+1):r>=100&&Vs(f=>f+1),b&&g>0&&(xs(f=>f+g),D&&Os(f=>f+1)),t.announced||Ks(t);try{ws.getState().recordVisit("offline-x01",l,r,{preRemaining:c,postRemaining:D?0:v,finish:D,bust:!1})}catch{}D&&(ue("player"),G(!0)),_t(D?0:v),we(0),je.current=0,xe(0),fe.current=0,ve(0),pe.current=0},[_t,$s,ue,X,tt,we,xe,ve,G,Hs,Us,Vs,xs,Os,Ks]),Ht=a.useCallback(t=>{const s=rt.current;s&&(rt.current=null,Ke(),_s(s,t))},[Ke,_s]),pr=a.useCallback(t=>{Ks(t),rt.current={...t,announced:!0},vs(!0),Ke(),Hn.current=setTimeout(()=>Ht("timeout"),lo)},[Ke,Ht,Ks]);a.useEffect(()=>{if(!oe)return;const t=()=>Ht("event");return window.addEventListener("ndn:darts-cleared",t),()=>window.removeEventListener("ndn:darts-cleared",t)},[oe,Ht]),a.useEffect(()=>{oe||Ht("timeout")},[oe,Ht]),a.useEffect(()=>()=>Ke(),[Ke]),a.useEffect(()=>{if(re===0){try{window.dispatchEvent(new CustomEvent("ndn:darts-cleared",{detail:{source:"offline-play",ts:Date.now()}}))}catch{}vt.current=0}ji.current=re},[re]);const it=n?.username||"Player 1",Ut=O==="None"?"Player 2":O,Gs=St("X01",V,_,J,le,et,Nt,We,Et,Lt,It,re,Rt,Dn,us,An,hs,H,Z,O),Ei=St("Cricket",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Zt),Ri=St("Shanghai",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Z,O,void 0,Zt,Ds),Ii=St("Killer",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Q,ss,Es,$e),Pi=St("Scam"),Fi=St("Fives"),Bi=St("Sevens"),zs=a.useMemo(()=>{const t=Gs||[],s=re>0?We:Lt??et,r=Rt>0?Et:It??Nt;return t.length===0?{name:Z?it:Ut,isCurrentTurn:!0,legsWon:Z?J:le,score:Z?V:_,lastScore:Z?s:r}:t.find(l=>l.isCurrentTurn)??t[0]},[Gs,Z,it,Ut,J,le,V,_,re,We,Lt,et,Et,It,Nt,Rt]),br=a.useMemo(()=>{if(!zs)return[];const{matchAvg:t,allTimeAvg:s,...r}=zs;return[{...r,matchAvg:void 0,allTimeAvg:void 0}]},[zs]),Oi=Z?Ut:it,Hi=zs?.name??(Z?it:Ut),Ui=Z?V:_,Vi=Z?re>0?We:Lt??et:Rt>0?Et:It??Nt,W=a.useCallback((t,s=1)=>{!t||s<=0||fr(r=>({...r,[t]:(r[t]||0)+s}))},[]),Y=a.useCallback(t=>{t&&fr(s=>s[t]===void 0?s:{...s,[t]:0})},[]);Ti[x];const $i=t=>{if(!t.trim())return null;const s=Number(t);return Number.isFinite(s)?ze(Math.round(s),0,R):null},Wi=t=>{if(!t.trim())return null;const s=Number(t);return Number.isFinite(s)?Math.max(0,Math.round(s)):null},gr=a.useCallback(()=>{rt.current&&(rt.current=null),Ke(),vs(!1)},[Ke]);a.useCallback(t=>{const s=ze(t,0,R);gr(),X(s),he.current=s;const r=s===0?R:s;ds(r),jt.current=r,we(0),je.current=0,xe(0),fe.current=0,ve(0),pe.current=0,tt(null),at(0),E(0),vt.current=0,s===0?(ue("player"),G(!0)):(ue(null),G(!1))},[gr,X,R,ds,we,xe,ve,tt,at,E,ue,G]);const vr=t=>{const r=$i(mr);if(r===null){ce(`Enter a number between 0 and ${R}`,{type:"error",timeout:2500});return}nt(r),yt(0),st(0),Pt(null),Ft(0),Bs(0),ur(""),ue(null),G(!1)},jr=a.useCallback((t,s)=>{t==="player"?(L(s),Fn("")):(Ve(s),Bn("")),ue(null),G(!1)},[Ve,Bn,Fn,ue,L,G]),qs=t=>{const r=Wi(t==="player"?xr:hr);if(r===null){ce("Enter a non-negative whole number for legs",{type:"error",timeout:2500});return}On({target:t,value:r,stage:1})},Ki=a.useCallback(()=>{On(t=>t&&(t.stage===1?{...t,stage:2}:(jr(t.target,t.value),null)))},[jr]),js=a.useCallback(()=>{On(null)},[]);a.useEffect(()=>{if(!Ws)return;const t=s=>{s.key==="Escape"&&(s.preventDefault(),js())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[js,Ws]);const lt=(t=>{switch(t){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(ee),Vt=a.useRef(null),$t=a.useRef(null),Un=a.useRef(null),[Wt,Vn]=a.useState("first"),[Xs,Nr]=a.useState(1),_i=a.useRef(null);a.useEffect(()=>{const t=Math.max(1,Math.floor(Number(Xs)||1)),s=Wt==="first"?t:Math.max(1,Math.ceil(t/2));De(s)},[Wt,Xs]),a.useEffect(()=>{if(!Yt){fa(1),pa(!1);return}const t=()=>{const l=Vt.current,c=$t.current;if(!l||!c)return;const v=Un.current?Un.current.getBoundingClientRect().height:0,g=Math.max(0,l.clientHeight-v-6),D=Math.max(0,l.clientWidth-8),b=c.getBoundingClientRect(),j=ks||1,f=b.height/j,w=b.width/j,ye=g>0?g/f:1,_e=D>0?D/w:1,ot=Math.min(1,Math.max(.5,Math.min(ye,_e))),Se=f*ot,ie=g>0&&Se-g>1;pa(ie),fa(ot)};t();const s=window.ResizeObserver,r=s?new s(()=>t()):null;return r&&Vt.current&&r.observe(Vt.current),r&&$t.current&&r.observe($t.current),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t);try{r&&Vt.current&&r.unobserve(Vt.current)}catch{}try{r&&$t.current&&r.unobserve($t.current)}catch{}}},[Yt,ks]),a.useEffect(()=>{const t=s=>{const r=s?.detail?.mode;r&&(dt(r),Kt())};return window.addEventListener("ndn:auto-start",t),()=>window.removeEventListener("ndn:auto-start",t)},[]),a.useEffect(()=>{const t=s=>{const r=s?.detail?.formatType,l=s?.detail?.formatCount,c=s?.detail?.startScore;(r==="first"||r==="best")&&Vn(r),typeof l=="number"&&isFinite(l)&&Nr(Math.max(1,Math.floor(l))),typeof c=="number"&&isFinite(c)&&He(Math.max(1,Math.floor(c)))};return window.addEventListener("ndn:offline-format",t),()=>window.removeEventListener("ndn:offline-format",t)},[]),a.useEffect(()=>{if(!I)return;const t=setTimeout(()=>Kt(),50);return()=>clearTimeout(t)},[I]),a.useEffect(()=>{if(!xt||Z||O==="None"||Ni<=0)return;let t,s=performance.now();const r=l=>{const c=l-s;s=l,ms(v=>{const g=v-c;if(g<=0){let D=0,b=0,j=_;for(st(0);D<3&&j>0;){const f=oo(j,O),w=ze(f-D*20,0,Math.min(60,j)),ye=j-w;if(Bs(w),Cn(Se=>Se+1),ir(Se=>Se+1),ye<0){j=_,yt(0),Ft(0),b=0,Pt(0),st(0);break}b+=w,yt(Se=>Se+w),lr(Se=>Se+w);const _e=j,ot=ye;if(_e>50&&ot<=50?Ft(1):_e<=50&&Ft(Se=>Se+1),j=ye,D+=1,st(D),j===0)break}if(nt(j),j===0){b===180?Ln(w=>w+1):b>=140?En(w=>w+1):b>=100&&Rn(w=>w+1);const f=_;f<=170&&dr(w=>Math.max(w,f)),_<=50&&(ar(w=>w+(kn>0?kn:1)),rr(w=>w+1)),Pt(b),yt(0),Ft(0),st(0),ue("ai"),G(!0)}return j>0&&D>=3&&(b===180?Ln(f=>f+1):b>=140?En(f=>f+1):b>=100&&Rn(f=>f+1),Pt(b),yt(0),Ft(0),st(0)),st(0),Jt(!0),0}return g}),t=requestAnimationFrame(r)};return t=requestAnimationFrame(r),()=>cancelAnimationFrame(t)},[xt,Z,O,_]),a.useEffect(()=>{ae.inProgress&&(kt.current||(Ss(!0),kt.current=!0))},[ae.inProgress]);function Kt(){Ue(!0),X(R),he.current=R,nt(R),ut(!1),qt(!0),Jt(!0),E(0),gt(0),at(0),xe(0),fe.current=0,ds(R),we(0),tt(null),ve(0),ms(0),Cn(0),Bs(0),yt(0),st(0),Pt(null),ue(null),L(0),Ve(0),Ae([]),bn(0),gn(0),vn(!1),Bt(0),ir(0),bs(0),lr(0),Hs(0),Us(0),Vs(0),Ln(0),En(0),Rn(0),$s(0),dr(0),xs(0),Os(0),ar(0),rr(0),Y("X01");const t=Math.max(1,Math.floor(Number(Xs)||1));if(De(Wt==="first"?t:Math.max(1,Math.ceil(t/2))),A)try{B({mode:x,x01Start:R,firstTo:Qe,aiLevel:O})}catch{}}function Gi(){X(R),he.current=R,nt(R),ut(!1),qt(!0),Jt(!0),E(0),gt(0),at(0),xe(0),fe.current=0,ds(R),we(0),jt.current=R,je.current=0,tt(null),ve(0),pe.current=0,pe.current=0,ms(0),Cn(0),Bs(0),yt(0),st(0),Pt(null),ue(null)}function _t(t){xe(0),fe.current=0,ds(t===0?R:t),jt.current=t===0?R:t,ve(0),pe.current=0,O!=="None"?(Jt(!1),ms(Le)):(ms(0),Jt(!0))}function Gt(t){if(oe&&rt.current){Li||vs(!0),ce("Remove your darts before starting the next throw",{type:"info",timeout:1800});return}W("X01");const s=he.current,r=fe.current,l=je.current,c=jt.current,v=pe.current,g=s-t,D=r+1;if(at(t),gt(ie=>ie+1),Bt(ie=>ie+1),g<0){try{const ie=s,Qn=c;ws.getState().recordVisit("offline-x01",D,0,{preRemaining:ie,postRemaining:Qn,bust:!0,finish:!1})}catch{}if(X(c),he.current=c,s<=50){const ie=(v||0)+1;xs(Qn=>Qn+ie)}if(h)try{nn(n?.username||"Player",0,Math.max(c,0),o,{volume:d,checkoutOnly:p})}catch{}tt(0),E(0),we(0),je.current=0,ve(0),pe.current=0,_t(c);return}X(g),he.current=g,xe(D),fe.current=D;const b=l+t;we(b),je.current=b,bs(ie=>ie+t),E(0);const j=s,f=g,w=j>50&&f<=50,ye=j<=50;w?(ve(1),pe.current=1):ye&&(ve(ie=>ie+1),pe.current=(v||0)+1);const _e=pe.current||0,ot=j<=50,Se=ot?Math.max(_e,Math.min(D,3)):0;if(g===0){const ie={visitTotal:b,darts:D,preRemaining:s,remaining:0,doubleAttempts:Se,finished:!0,doubleWindow:ot,highestCheckout:c<=170?c:null};oe?pr(ie):_s(ie,"immediate");return}if(D>=3){const ie={visitTotal:b,darts:D,preRemaining:s,remaining:g,doubleAttempts:Se,finished:!1,doubleWindow:ot,highestCheckout:null};oe?pr(ie):_s(ie,"immediate");return}}function Ys(){const t=ze(Math.round(Number(F)||0),0,60);Gt(t)}function Ne(t){if(!Number.isFinite(t))return!1;const s=jt.current,r=he.current,l=fe.current,c=je.current,v=l>0||c>0;v&&(X(s),he.current=s,xe(0),fe.current=0,we(0),je.current=0,ve(0),pe.current=0,at(0),E(0),gt(f=>Math.max(0,f-l)),Bt(f=>Math.max(0,f-l)),bs(f=>Math.max(0,f-c)),vt.current=0);const g=v?s:r,D=g<=170?170:180,b=ze(Math.round(t),0,D);W("X01",3),gt(f=>f+3),Bt(f=>f+3),xe(3),fe.current=3,we(b),je.current=b,tt(b),b===180?Hs(f=>f+1):b>=140?Us(f=>f+1):b>=100&&Vs(f=>f+1);const j=g-b;if(j<0){if(h)try{nn(it,0,Math.max(s,0),o,{volume:d,checkoutOnly:p})}catch{}try{ws.getState().recordVisit("offline-x01",3,0,{preRemaining:g,postRemaining:s,bust:!0,finish:!1})}catch{}return X(s),he.current=s,tt(0),we(0),je.current=0,xe(0),fe.current=0,ve(0),pe.current=0,_t(s),!0}if(X(j),he.current=j,bs(f=>f+b),h)try{nn(it,b,Math.max(j,0),o,{volume:d,checkoutOnly:p})}catch{}if(g<=50&&(xs(f=>f+3),j===0&&Os(f=>f+1)),j===0){g<=170&&$s(f=>Math.max(f,g));try{ws.getState().recordVisit("offline-x01",3,b,{preRemaining:g,postRemaining:0,finish:!0,bust:!1})}catch{}return ue("player"),G(!0),xe(0),fe.current=0,we(0),je.current=0,ve(0),pe.current=0,!0}try{ws.getState().recordVisit("offline-x01",3,b,{preRemaining:g,postRemaining:j,finish:!1,bust:!1})}catch{}return _t(j),we(0),je.current=0,xe(0),fe.current=0,ve(0),pe.current=0,!0}const Me=ro({match:ae,commitManualVisitTotal:Ne,endTurn:_t}),[Js,Qs]=a.useState(""),yr=t=>{if(!t){Qs("");return}const s=t.replace(/[^0-9]/g,"");if(!s){Qs("");return}const r=Number(s);if(!Number.isFinite(r))return;const l=he.current<=170?170:180,c=ze(Math.round(r),0,l);Qs(String(c))};function Zs(){if(!Js){alert("Enter a number 0â€“180 for visit total");return}const t=Number(Js);if(!Number.isFinite(t)){alert("Enter a number 0â€“180 for visit total");return}const s=he.current<=170?170:180,r=ze(Math.round(t),0,s);t>s&&ce(`Visit totals cannot exceed ${s}.`,{type:"info",timeout:2200}),Ne(r)&&Qs("")}const $n=a.useCallback(()=>{rt.current&&(rt.current=null,Ke(),vs(!1));const t=fe.current,s=je.current,r=jt.current;t===0&&s===0||(X(r),he.current=r,xe(0),fe.current=0,we(0),je.current=0,ve(0),pe.current=0,at(0),E(0),gt(l=>Math.max(0,l-t)),Bt(l=>Math.max(0,l-t)),bs(l=>Math.max(0,l-s)),vt.current=0)},[Ke]);a.useEffect(()=>{const t=s=>{const r=s?.detail;!r||r?.source==="offline-play"||$n()};return window.addEventListener("ndn:clear-visit-request",t),()=>window.removeEventListener("ndn:clear-visit-request",t)},[$n]);function wr(t){W("Double Practice");const s=ze(Math.round(t||0),0,60);if(at(s),gt(r=>r+1),Bt(r=>r+1),Xr(s,Qt)){const r=rn+1;ln(r),an(l=>Math.min(20,l+1)),r>=21&&(ue("player"),G(!0))}E(0)}function Sr(){wr(Number(F))}function Cr(){const t=zt(be);if(t==null){alert("Enter like D16, 50, 25, T20");return}wr(t),de("")}function kr(t,s,r){if(wa)return;W("Bob's 27");const l=ja,c=s==="DOUBLE"&&r===l||!s&&t===l*2;c&&dn(v=>v+1),ya(v=>{const g=v+1;if(g>=3){const D=mi+(c?1:0);D>0?cn(j=>j+D*l*2):cn(j=>j-l*2);const b=l+1;return Na(b),dn(0),b>20&&Sa(!0),0}return g})}function Dr(){kr(Math.max(0,F|0)),E(0)}function Ar(){Na(1),cn(27),ya(0),dn(0),Sa(!1),Y("Bob's 27")}function Wn(t){W("Count-Up"),Da(s=>s+Math.max(0,t|0)),Aa(s=>{const r=s+1;return r>=3?(ka(l=>l+1),0):r})}function Kn(t){W("High Score"),La(s=>s+Math.max(0,t|0)),Ea(s=>{const r=s+1;return r>=3?(Ta(l=>l+1),0):r})}function _n(t){W("Low Score"),Pa(s=>s+Math.max(0,t|0)),Fa(s=>{const r=s+1;return r>=3?(Ia(l=>l+1),0):r})}function Mr(t,s,r,l,c,v,g,D){const b=t-g;if(!(b<0))if(b===0){if(D==="DOUBLE"||D==="INNER_BULL"){v(j=>j+1),c(j=>j+1),l(()=>0),s(t);return}s(b)}else s(b);l(j=>{const f=j+1;return f>=3?(c(w=>w+1),0):f})}function Tr(t,s){W("Checkout 170"),Mr(mn,un,Ba,Oa,Ua,$a,t,s),Ba+1>=3&&un(170)}function Lr(t,s){W("Checkout 121"),Mr(xn,hn,Wa,Ka,Ga,qa,t,s),Wa+1>=3&&hn(121)}function en(t){const s=zt(be);if(s==null){alert("Enter like T20, D16, 25, 50");return}const r=be.trim().toUpperCase(),l=r.startsWith("D")||r==="50"||r==="BULL"||r==="DBULL"||r==="IBULL"||r.includes("INNER");t?Tr(s,l?"DOUBLE":void 0):Lr(s,l?"DOUBLE":void 0),de("")}function zi(){un(170),Oa(0),Ua(0),$a(0),Y("Checkout 170")}function qi(){hn(121),Ka(0),Ga(0),qa(0),Y("Checkout 121")}function Gn(t,s,r){if(Ya)return;W("Treble Practice"),(s==="TRIPLE"&&r===ft||!s&&t===ft*3)&&bn(c=>c+1),gn(c=>{const v=c+1;if(v%3===0&&[20,19,18].includes(ft)){const g=[20,19,18],D=g.indexOf(ft),b=g[(D+1)%g.length];fn(b)}return ts>0&&v>=ts&&vn(!0),v})}function Er(){bn(0),gn(0),vn(!1),Y("Treble Practice")}function Xi(t,s,r){W("Baseball"),Qa(l=>{const c={...l};return _l(c,t,s,r),c})}function Yi(){Qa(Zr()),Y("Baseball")}function Ji(t,s,r){W("Golf"),er(l=>{const c={...l};return zl(c,t,s,r),c})}function Qi(){er(ei()),Y("Golf")}function Zi(t,s,r,l){W("Tic Tac Toe"),tr(c=>{const v={...c,board:[...c.board]};return kl(v,t,s,r,l),v})}function el(){tr(qr()),Y("Tic Tac Toe")}function tl(t,s,r){W("American Cricket"),sr(l=>{const c={...l,marks:{...l.marks}};return Wl(c,t,s,r,()=>!1),c})}function Rr(){sr(Qr()),Y("American Cricket")}function zn(t,s,r){W("Around the Clock");const l=ct[ht];let c=!1;if(typeof r=="number"&&r===l&&(s==="SINGLE"||s==="DOUBLE"||s==="TRIPLE")&&(c=!0),l===25&&(s==="BULL"||t===25)&&(c=!0),l===50&&(s==="INNER_BULL"||t===50)&&(c=!0),c||(t===l||t===l*2||t===l*3)&&(c=!0),c){const v=ga+1;va(v),ba(g=>g+1)}}function Ir(){zn(Math.max(0,F|0)),E(0)}function Pr(){const t=zt(be);if(t==null){alert("Enter like T20, D5, 25, 50");return}zn(t),de("")}function qn(t,s,r){W("Cricket"),on(l=>{const c={...l,marks:{...l.marks}};return El(c,t,s,r,()=>!1),c}),Ee(l=>{const c=l+1;return c>=3?0:c})}function Fr(){qn(Math.max(0,F|0)),E(0)}function Xn(t,s,r){W("Shanghai"),As(l=>{const c={...l,turnHits:{...l.turnHits}};return Pl(c,t,s,r),c}),Ee(l=>{const c=l+1;return c>=3?(As(v=>{const g={...v,turnHits:{...v.turnHits}};return Fl(g),g}),0):c})}function Br(){Xn(Math.max(0,F|0)),E(0)}function Or(t,s,r){W("Halve It"),Ms(l=>{const c={...l,targets:[...l.targets]};return Bl(c,t,s,r),c}),Ee(l=>{const c=l+1;return c>=3?(Ms(v=>{const g={...v,targets:[...v.targets]};return Ol(g),g}),0):c})}function Hr(){Or(Math.max(0,F|0)),E(0)}function Ur(t,s,r){W("High-Low"),Ls(l=>{const c={...l};return Hl(c,t,s,r),c}),Ee(l=>{const c=l+1;return c>=3?(Ls(v=>{const g={...v};return Ul(g),g}),0):c})}function Vr(){Ur(Math.max(0,F|0)),E(0)}function $r(){const t=be.trim().toUpperCase();if(!t)return null;if(t==="50"||t==="BULL"||t==="DBULL"||t==="IBULL")return 50;if(t==="25"||t==="OBULL")return 25;const s=t.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!s)return null;const r=s[1]||"S",l=parseInt(s[2],10);return l<1||l>20?null:l*(r==="S"?1:r==="D"?2:3)}function Ns(){const t=$r();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}Gt(t),de("")}function Wr(){const t=Pn.trim().split(`
`).map(s=>s.trim()).filter(s=>s);if(t.length!==0){for(const s of t){const r=zt(s);if(r==null){alert(`Invalid score: ${s}`);return}Gt(r)}gs("")}}function Yn(){re!==0&&(X(t=>t+et),xe(t=>Math.max(0,t-1)))}function tn(){const t=$r();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}if(re===0){Ns();return}const s=et;X(r=>r+s),xe(r=>Math.max(0,r-1)),setTimeout(()=>Gt(t),0),de("")}function sl(){const t=Dt??"player",s=t==="player"?Ps||void 0:kn||void 0,r=1,l=t==="player"?Is:Fs;Ae([...H,{winner:t,doubleDarts:m,checkoutDarts:C,winnerDarts:l,doublesAtt:s,doublesHit:r}]),G(!1);let c=J,v=le;if(Dt==="player"?c+=1:Dt==="ai"&&(v+=1),L(c),Ve(v),ue(null),c>=Qe||v>=Qe){try{vl(x,t==="player")}catch{}qt(!1),Ue(!1),X(R),nt(R),In(!0);return}Gi()}const Jn=!Gr.includes(x)&&!(n?.fullAccess||n?.admin);return e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[ge&&e.jsx(Ml,{players:ae.players||[],onDone:()=>Ss(!1)}),e.jsxs("h2",{className:"text-3xl font-bold text-brand-700 mb-4",children:["Offline Mode ",i==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"ndn-shell-body",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsxs("select",{className:"input w-full",value:x,onChange:t=>dt(t.target.value),children:[Gr.map(t=>e.jsx("option",{value:t,children:t},t)),pl.map(t=>e.jsxs("option",{value:t,disabled:!(n?.fullAccess||n?.admin),children:[t," ",n?.fullAccess||n?.admin?"":"(Premium)"]},t))]}),e.jsx(ql,{gameMode:x,compact:!0}),x==="Treble Practice"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"font-semibold",children:"Throws per game"}),e.jsx("input",{className:"input w-full",type:"number",min:3,step:3,value:ts,onChange:t=>gi(Math.max(3,Math.floor(Number(t.target.value)||30)))})]}),e.jsx("div",{className:"sm:col-span-2 text-xs text-slate-300",children:"Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws."})]}),!n?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),x==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:R,onChange:t=>He(Number(t.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{className:"input w-full",value:O,onChange:t=>Ye(t.target.value),children:[e.jsx("option",{value:"None",children:"None"}),io.map(t=>e.jsx("option",{value:t,children:t},t))]}),O!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:Le/1e3,onChange:t=>Cs(Math.round(Number(t.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>ne(!0),children:"X01 Rules & Regulations!"})]}),x==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply."})]}),!Je&&e.jsx("button",{className:"btn",disabled:Jn,title:Jn?"PREMIUM required for this mode":"",onClick:Kt,children:"Start Match"}),xt&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${Xt?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(ys,{storageKey:"ndn:modal:offline-match",className:`${Xt?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:Xt,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:"scroll"},ref:t=>{Vt.current=t},children:[e.jsx("div",{ref:t=>{Un.current=t},children:e.jsx(wl,{left:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[x,x==="X01"?` / ${R}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",Qe," Â· Legs ",J,"-",le]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${i==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:i==="modern"?"Modern layout":"Classic layout"})]}),right:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>$(Math.max(.5,Math.round((P-.05)*100)/100)),title:"Decrease camera size",children:"âˆ’"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(P*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>$(Math.min(1.25,Math.round((P+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:Yt?"Actual Size":"Fit All",onClick:()=>ha(t=>!t),children:Yt?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:Xt?"Restore":"Maximize",onClick:()=>xa(t=>!t),children:Xt?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Kt()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{qt(!1),Ue(!1)},children:"Quit"})]})})}),e.jsxs("div",{ref:t=>{$t.current=t},className:"will-change-transform",style:Yt?{transform:`scale(${ks})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,ks))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:x==="X01"?"X01 Match":x}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",x]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",R]}),e.jsxs("div",{ref:_i,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const t=V!==R||_!==R||re>0,s=`px-2 py-0.5 rounded border text-xs ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${s} ${Wt==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||Vn("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${s} ${Wt==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||Vn("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${t?"opacity-50":""}`,type:"number",min:1,step:1,value:Xs,onChange:r=>Nr(Math.max(1,Math.floor(Number(r.target.value)||1))),disabled:t,title:Wt==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",J,"â€“",le]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Match"}),e.jsxs("select",{className:`btn ${lt}`,value:Ce,onChange:t=>Ie(t.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${lt} w-[7.5rem]`,value:ke,onChange:t=>qe(t.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${lt} w-[7.5rem]`,value:Pe,onChange:t=>Xe(t.target.value),placeholder:"Team B"})]})]}),x!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[x==="Double Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Zn[Qt]?.label||"â€”"})]})}),x==="Around the Clock"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:ct[ht]===25?"25 (Outer Bull)":ct[ht]===50?"50 (Inner Bull)":ct[ht]||"â€”"})]})}),x==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket â€” Close 20â€“15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:ma.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,Zt.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:Zt.points})]}),Rl(Zt)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{on(ea()),Ee(0),Y("Cricket")},children:"Reset"})]})]}),x==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Ds.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ds.score]}),Ds.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{As(ta()),Ee(0),Y("Shanghai")},children:"Reset"})]})]}),x==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[es.stage+1,"/",es.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const t=oi(es);return t?t.kind==="ANY_NUMBER"?"Any":t.kind==="BULL"?"Bull":t.kind==="DOUBLE"||t.kind==="TRIPLE"||t.kind==="NUMBER"?`${t.kind} ${t.num}`:"â€”":"â€”"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",es.score]}),es.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Ms(sa()),Ee(0),Y("Halve It")},children:"Reset"})]})]}),x==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Ts.round," Â· Target ",Ts.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ts.score]}),Ts.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Ls(na()),Ee(0),Y("High-Low")},children:"Reset"})]})]}),x==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",ja]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",di]}),wa&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:Ar,children:"Reset"})]})]}),x==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Ca,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",ui]})]}),x==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Ma,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",hi]})]}),x==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Ra,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",pi]})]}),x==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:mn}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",Ha," Â· Successes: ",Va]})]}),x==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:xn}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",_a," Â· Successes: ",za]})]}),x==="Treble Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",ft]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",pn]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("div",{className:"inline-flex items-center gap-1",children:[20,19,18].map(t=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${ft===t?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>fn(t),children:["T",t]},`tpick-header-${t}`))}),e.jsx("span",{className:"opacity-60 text-xs",children:"or"}),e.jsx("select",{className:"input w-24",value:ft,onChange:t=>fn(parseInt(t.target.value,10)),children:Array.from({length:20},(t,s)=>s+1).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Er,children:"Reset"})]})]})}),x==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Ja.inning}),e.jsxs("div",{className:"text-sm",children:["Score: ",e.jsx("span",{className:"font-semibold",children:Ja.score})]})]}),x==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Za.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes: ",e.jsx("span",{className:"font-semibold",children:Za.strokes})]})]}),x==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:pt.turn}),pt.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",pt.winner||"â€”"]})]}),x==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Target"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:aa[Rs.targetIndex]}),e.jsxs("div",{className:"text-sm",children:["Progress: ",e.jsxs("span",{className:"font-semibold",children:[Rs.targetIndex+1,"/",aa.length]})]}),Rs.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["ðŸŽ‰ Finished in ",Rs.darts," darts!"]})]}),x==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[is.score,"/",is.target]}),e.jsxs("div",{className:"text-sm",children:["Darts: ",e.jsx("span",{className:"font-semibold",children:is.darts})]}),is.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",is.target,"!"]})]}),x==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[os.score,"/",os.target]}),e.jsxs("div",{className:"text-sm",children:["Darts: ",e.jsx("span",{className:"font-semibold",children:os.darts})]}),os.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",os.target,"!"]})]}),x==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20â€“12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:ua.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,jn.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:jn.points})]}),Kl(jn)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:Rr,children:"Reset"})]})]}),x==="Killer"&&e.jsx(e.Fragment,{children:nr?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Q[$e]?.name||"â€”"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Tt?`${Q.find(t=>t.id===Tt)?.name||"Winner"} Wins`:vi||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):i==="modern"?e.jsx("div",{className:"space-y-3 mb-2",children:me?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${lt}`,onClick:()=>$(Math.max(.5,Math.round((P-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${lt} min-w-[2.5rem] text-center`,children:[Math.round(P*100),"%"]}),e.jsx("button",{className:`btn ${lt}`,onClick:()=>$(Math.min(1.25,Math.round((P+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${lt}`,title:"Toggle fit/fill",onClick:()=>z(M==="fill"?"fit":"fill"),children:M==="fill"?"Fill":"Fit"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${lt}`,title:"Toggle camera aspect",onClick:()=>y(U==="square"?"wide":"square"),children:U==="square"?"Square":"Wide"})]})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6",children:[e.jsx("div",{className:"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]",children:e.jsx(K,{scoringMode:"x01",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{Gt(t)}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Current Shooter"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-white",children:Hi}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Remaining"}),e.jsx("div",{className:"font-mono text-lg text-white",children:Ui})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Last Dart"}),e.jsx("div",{className:"font-mono text-lg text-white",children:Vi||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Match Legs"}),e.jsxs("div",{className:"font-semibold text-white",children:[J,"-",le]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Next Up"}),e.jsx("div",{className:"font-medium text-white",children:Oi})]})]})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Ge,{gameMode:x,players:br,matchScore:`${J}-${le}`})})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(Ge,{gameMode:x,players:br,matchScore:`${J}-${le}`})}),x==="X01"&&e.jsxs("div",{className:"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Manual Scoreboard Override"}),e.jsxs("p",{className:"mt-1 text-xs text-white/40",children:["Adjust the live totals if a dart was misread. Values are clamped between 0 and ",R,"."]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:it}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Commit Visit"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx(Ll,{inProgress:!0,startingScore:R,onAddVisit:Te(Ne),quickButtons:[180,140,100,60],onNextPlayer:()=>Me?.nextPlayer(),onEndLeg:()=>{},onUndo:()=>{},showDartsSelect:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:xr,onChange:t=>Fn(t.target.value),onKeyDown:t=>{t.key==="Enter"&&qs("player")},placeholder:`${J}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>qs("player"),children:"Set"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:Ut}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Three Dart Edit"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:R,value:mr,onChange:t=>ur(t.target.value),onKeyDown:t=>{t.key==="Enter"&&vr()},placeholder:`${_}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>vr(),children:"Set"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:hr,onChange:t=>Bn(t.target.value),onKeyDown:t=>{t.key==="Enter"&&qs("ai")},placeholder:`${le}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>qs("ai"),children:"Set"})]})]})]})]})]})]})]})})]})}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),Z?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:V}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-V/R)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:et})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score: ",e.jsx("span",{className:"font-semibold",children:re>0?We:Lt??et})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:fs>0?(Mn/fs*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",Is]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(t=>e.jsx("span",{className:`w-2 h-2 rounded-full ${t<re?"bg-emerald-400":"bg-white/20"}`},t))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",us," Â· Hit ",Dn]})]}),V<=170&&V>0&&(()=>{const s=Sl(V,u)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:s})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall",children:e.jsx(Al,{storageKey:"ndn:camera:tile:offline:center:v4",className:"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card",defaultWidth:0,defaultHeight:0,minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:1200,autoFill:!0,children:e.jsx(ti,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic",fill:!0})})}),e.jsxs("div",{className:`mt-2 ${te==="small"?"p-2":te==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${ee==="small"?"text-xs":ee==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const t=Z?n?.username||"You":O==="None"?"â€”":`${O} AI`,s=Z?V:O==="None"?0:_,r=Z?re>0?We:Lt??et:Rt>0?Et:It??Nt,l=Z?Is:Fs,c=R-(Z?V:O==="None"?R:_),v=l>0?c/l*3:0,g=`${J}-${le}`,D=H.length>0?`${Math.min(...H.map(b=>b.doubleDarts+(b.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:g}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:t}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:s}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:v.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:r}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:D})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[O==="None"?"Opponent":`${O} AI`," Remain"]}),Z?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:O!=="None"?_:"N/A"}),O!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-_/R)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:O==="None"?0:Nt})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score: ",e.jsx("span",{className:"font-semibold",children:O==="None"?"â€”":Rt>0?Et:It??Nt})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:O!=="None"?ps>0?(Tn/ps*3).toFixed(1):"0.0":"â€”"})]}),O!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",Fs]}),O!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",hs," Â· Hit ",An]})]})]})]})}),x!=="X01"?e.jsxs("div",{className:"space-y-2",children:[x==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Zn[Qt]?.label||"â€”"})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,onAutoDart:(t,s)=>{if((s==="DOUBLE"||s==="INNER_BULL")&&Xr(t,Qt)){const l=rn+1,c=Qt+1;ln(l),an(c),l>=Zn.length&&setTimeout(()=>{ln(0),an(0)},250)}},immediateAutoCommit:!0,onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Sr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Sr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:be,onChange:t=>de(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Cr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Cr,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",rn," of 21"]})]}),x==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:ct[ht]===25?"25 (Outer Bull)":ct[ht]===50?"50 (Inner Bull)":ct[ht]||"â€”"})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{zn(t,s==="MISS"?void 0:s,r?.sector??null)},onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Ir()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ir,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:be,onChange:t=>de(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Pr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Pr,children:"Add"})]}),ga>=ct.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{va(0),ba(0),Y("Around the Clock")},children:"Reset"})]})]}),x==="Cricket"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{qn(t,s==="MISS"?void 0:s,r?.sector??null)},onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Fr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Fr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{on(ea()),Ee(0),Y("Cricket")},children:"Reset"})]})]}),x==="Shanghai"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{Xn(t,s==="MISS"?void 0:s,r?.sector??null)},onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Br()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Br,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{As(ta()),Ee(0),Y("Shanghai")},children:"Reset"})]})]}),x==="Halve It"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{Or(t,s==="MISS"?void 0:s,r?.sector??null)},onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Hr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Hr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ms(sa()),Ee(0),Y("Halve It")},children:"Reset"})]})]}),x==="High-Low"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{Ur(t,s==="MISS"?void 0:s,r?.sector??null)},onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Vr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Vr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ls(na()),Ee(0),Y("High-Low")},children:"Reset"})]})]}),x==="Bob's 27"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{kr(t,s==="MISS"?void 0:s,r?.sector??null)},onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Dr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Dr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Ar,children:"Reset"})]})]}),x==="Count-Up"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>Wn(t),onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(Wn(F),E(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Wn(F),E(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ka(1),Da(0),Aa(0),Y("Count-Up")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Ca,"/",xi]})]}),x==="High Score"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>Kn(t),onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(Kn(F),E(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Kn(F),E(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ta(1),La(0),Ea(0),Y("High Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Ma,"/",fi]})]}),x==="Low Score"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>_n(t),onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(_n(F),E(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{_n(F),E(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ia(1),Pa(0),Fa(0),Y("Low Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Ra,"/",bi]})]}),x==="Checkout 170"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s)=>Tr(t,s==="MISS"?void 0:s),onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:be,onChange:t=>de(t.target.value),onKeyDown:t=>{t.key==="Enter"&&en(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>en(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:zi,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",mn," Â· Attempts: ",Ha," Â· Successes: ",Va]})]}),x==="Checkout 121"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s)=>Lr(t,s==="MISS"?void 0:s),onAddVisit:Te(Ne),onEndLeg:t=>Me.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:be,onChange:t=>de(t.target.value),onKeyDown:t=>{t.key==="Enter"&&en(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>en(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:qi,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",xn," Â· Attempts: ",_a," Â· Successes: ",za]})]}),x==="Treble Practice"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{Gn(t,s==="MISS"?void 0:s,r?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:be,onChange:t=>de(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=zt(be);s!=null&&Gn(s,void 0,void 0),de("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const t=zt(be);t!=null&&Gn(t,void 0,void 0),de("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",pn," Â· Misses: ",Math.max(0,Xa-pn)," Â· Darts: ",Xa,ts>0?`/${ts}`:""]}),Ya&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:Er,children:"Reset"})]})]}),x==="Baseball"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{Xi(t,s==="MISS"?void 0:s,r?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Yi,children:"Reset"})})]}),x==="Golf"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{Ji(t,s==="MISS"?void 0:s,r?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Qi,children:"Reset"})})]}),x==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(t,s)=>s).map(t=>e.jsx("button",{className:`h-16 rounded-xl border ${pt.board[t]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(pt.finished||pt.board[t])return;const s=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),r=s%3===0?"TRIPLE":s%2===0?"DOUBLE":"SINGLE",l=t,c=Cl[l],v=c.type==="BULL"?null:c.num||null;Zi(l,s,r,v)},children:pt.board[t]||""},t))}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:el,children:"Reset"})})]}),x==="American Cricket"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{tl(t,s==="MISS"?void 0:s,r?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Rr,children:"Reset"})})]}),x==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:aa[bt.targetIndex]})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{const l=s==="MISS"?void 0:s;W("Scam"),rs(ia(bt,t,l))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:1,max:25,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(W("Scam"),rs(ai(bt,F)),E(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{W("Scam"),rs(ai(bt,F)),E(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{rs(Ql()),Y("Scam")},children:"Reset"})]}),bt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["ðŸŽ‰ Finished in ",bt.darts," darts!"]})]}),x==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score: ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[Be.score,"/",Be.target]})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{W("Fives"),ls(oa(Be,t))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:5,max:50,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(W("Fives"),ls(ri(Be,F)),E(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{W("Fives"),ls(ri(Be,F)),E(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ls(to(Be.target)),Y("Fives")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts: ",Be.darts]}),Be.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",Be.target," in ",Be.darts," darts!"]})]}),x==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score: ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[Oe.score,"/",Oe.target]})]}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{W("Sevens"),cs(da(Oe,t))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:7,max:21,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(W("Sevens"),cs(ii(Oe,F)),E(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{W("Sevens"),cs(ii(Oe,F)),E(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{cs(ao(Oe.target)),Y("Sevens")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 7, 14, 21 Â· Darts: ",Oe.darts]}),Oe.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",Oe.target," in ",Oe.darts," darts!"]})]}),x==="Killer"&&e.jsx(e.Fragment,{children:nr?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Q.map(t=>{const s=ss[t.id],r=Es[t.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${s?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${s?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:s?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number: ",e.jsx("span",{className:"font-semibold",children:r})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:s?.lives??0})]})]},t.id)})}),N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{if(Tt)return;const l=s==="MISS"?void 0:s,c=r?.sector??null,v=Q[$e];v&&(ns(g=>{const D={};Object.keys(g).forEach(f=>D[f]={...g[f]});const b=Yr(v.id,D,l,c);if(b.becameKiller)Ze(`${v.name} became a Killer`);else if(b.victimId){const f=Q.find(w=>w.id===b.victimId);Ze(`${v.name} hit ${f?.name}'s ${Es[b.victimId]} (${b.livesRemoved} life${(b.livesRemoved||0)>1?"s":""})`)}else Ze("No effect");const j=Jr(D);return j&&as(j),D}),Mt(g=>{const D=g+1;if(D>=3){let b=$e;for(let j=1;j<=Q.length;j++){const f=($e+j)%Q.length,w=Q[f].id,ye=ss[w];if(ye&&!ye.eliminated&&ye.lives>0){b=f;break}}return At(b),0}return D}))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:be,onChange:t=>de(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){if(Tt)return;const r=be.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!r){de("");return}const l=r[1]||"S",c=parseInt(r[2],10),v=l==="D"?"DOUBLE":l==="T"?"TRIPLE":"SINGLE",g=Q[$e];ns(D=>{const b={};Object.keys(D).forEach(w=>b[w]={...D[w]});const j=Yr(g.id,b,v,c);if(j.becameKiller)Ze(`${g.name} became a Killer`);else if(j.victimId){const w=Q.find(ye=>ye.id===j.victimId);Ze(`${g.name} hit ${w?.name}'s ${Es[j.victimId]} (${j.livesRemoved} life${(j.livesRemoved||0)>1?"s":""})`)}else Ze("No effect");const f=Jr(b);return f&&as(f),b}),de(""),Mt(D=>{const b=D+1;if(b>=3){let j=$e;for(let f=1;f<=Q.length;f++){const w=($e+f)%Q.length,ye=Q[w].id,_e=ss[ye];if(_e&&!_e.eliminated&&_e.lives>0){j=w;break}}return At(j),0}return b})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let t=$e;for(let s=1;s<=Q.length;s++){const r=($e+s)%Q.length,l=Q[r].id,c=ss[l];if(c&&!c.eliminated&&c.lives>0){t=r;break}}At(t),Mt(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ns({}),yn({}),wn(!1),At(0),Mt(0),as(null),Ze("")},children:"Reset"})]}),Tt&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner: ",Q.find(t=>t.id===Tt)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ns({}),yn({}),wn(!1),At(0),Mt(0),as(null),Ze("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:Q.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:t.name,onChange:r=>{const l=r.target.value;Nn(c=>c.map((v,g)=>g===s?{...v,name:l}:v))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Nn(r=>r.filter((l,c)=>c!==s)),disabled:Q.length<=2,children:"Remove"})]},t.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Nn(t=>{const s=`p${t.length+1}`;return[...t,{id:s,name:`Player ${t.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(Q.length<2){alert("Need at least 2 players");return}const t=Q.map(l=>l.id),s=$l(t),r={};t.forEach(l=>{r[l]=Vl(s[l])}),yn(s),ns(r),At(0),Mt(0),as(null),Ze("Assigned numbers"),wn(!0)},children:"Assign Numbers & Start"})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-3 min-h-0 flex-1 text-[14px]",children:[e.jsxs("div",{className:"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm",children:[e.jsx("div",{className:"text-sm font-semibold opacity-80",children:"Scoreboard"}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ge,{gameMode:x,players:Gs,matchScore:`${J}-${le}`})}),Z&&e.jsxs("div",{className:"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h4",{className:"text-sm font-semibold tracking-wide uppercase text-indigo-200",children:"Manual Scoring"}),e.jsx("span",{className:"text-xs text-white/60",children:"Override a visit or enter dart-by-dart scores."})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Single Dart"}),e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:60,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Yn():Ys())},placeholder:"60"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ys,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Three Dart Edit"}),e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:V<=170?170:180,value:Js,onChange:t=>yr(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Zs()},placeholder:"100"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Zs,children:"Commit Visit"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Yn,children:"Undo Visit"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Manual"}),e.jsx("input",{className:"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",value:be,onChange:t=>de(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?tn():Ns())},placeholder:"T20"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ns,children:"Apply"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:tn,disabled:re===0,children:"Replace Last"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Multi-entry (one per line)"}),e.jsx("textarea",{className:"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30",rows:3,value:Pn,onChange:t=>gs(t.target.value),placeholder:`T20
D16
25`}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Wr,children:"Apply All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>gs(""),children:"Clear"})]})]}),e.jsx("div",{className:"pt-2 border-t border-white/10 mt-3",children:e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:$n,disabled:re===0&&We===0,children:"Clear Current Visit"})})]})]})]}),N&&e.jsx("div",{className:"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s)=>{const r=s??"MISS",l=Number.isFinite(t)?Math.max(0,t):0,c=Date.now();if(l<=0){if(r!=="MISS"||c-(vt.current||0)<1200)return;vt.current=c}else vt.current=0;Gt(l)}})})]}),x==="X01"&&!N&&e.jsx(e.Fragment,{children:e.jsx(Ge,{gameMode:x,players:Gs,matchScore:`${J}-${le}`})}),x==="Cricket"&&e.jsx(e.Fragment,{children:e.jsx(Ge,{gameMode:"Cricket",players:Ei})}),x==="Cricket"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{t>0&&qn(t,s==="MISS"?void 0:s,r?.sector??null)}})}),x==="Shanghai"&&e.jsx(e.Fragment,{children:e.jsx(Ge,{gameMode:"Shanghai",players:Ri})}),x==="Shanghai"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{t>0&&Xn(t,s==="MISS"?void 0:s,r?.sector??null)}})}),x==="Killer"&&e.jsx(e.Fragment,{children:e.jsx(Ge,{gameMode:"Killer",players:Ii})}),x==="Scam"&&e.jsx(e.Fragment,{children:e.jsx(Ge,{gameMode:"Scam",players:Pi})}),x==="Scam"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{t>0&&rs(ia(bt,t,s))}})}),x==="Fives"&&e.jsx(e.Fragment,{children:e.jsx(Ge,{gameMode:"Fives",players:Fi})}),x==="Fives"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{t>0&&ls(oa(Be,t))}})}),x==="Sevens"&&e.jsx(e.Fragment,{children:e.jsx(Ge,{gameMode:"Sevens",players:Bi})}),x==="Sevens"&&N&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(K,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,s,r)=>{t>0&&cs(da(Oe,t))}})}),e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:F,onChange:t=>E(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Yn():Ys())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ys,title:"Add a single dart (0â€“60)",children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,max:V<=170?170:180,placeholder:"Visit total (0â€“180)",value:Js,onChange:t=>yr(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Zs()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Zs,title:"Commit a full 3-dart total like 93",children:"Commit Visit"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:be,onChange:t=>de(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?tn():Ns())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:tn,disabled:re===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ns,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:Pn,onChange:t=>gs(t.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Wr,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>gs(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add Â· Shift+Enter to Replace Last"})]}),e.jsx("div",{className:"h-1"})]})]})})}),Fe&&e.jsx(co,{onClose:()=>ne(!1)}),Jn&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const s=await(await fetch(`${mo}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n?.email})})).json();s.ok&&s.url?(window.location.href=s.url,s.development&&ce("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):s.error==="STRIPE_NOT_CONFIGURED"?ce("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):ce("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{ce("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â· ",bl(gl(),5)]})]})]}),Mi&&typeof document<"u"?_r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4",onClick:()=>Ot(!1),children:e.jsx(ys,{storageKey:"ndn:modal:offline-camera-manager",className:"relative",defaultWidth:640,defaultHeight:520,minWidth:480,minHeight:420,maxWidth:1200,maxHeight:900,initialFitHeight:!0,onClose:()=>Ot(!1),children:e.jsxs("div",{className:"space-y-3",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Camera Devices"}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Manage Offline Camera Feeds"})]}),e.jsx("button",{className:"btn bg-slate-800 hover:bg-slate-700 text-white",onClick:()=>Ot(!1),children:"Close"})]}),e.jsx(ti,{fill:!0,user:n,playerScore:V,aiScore:_,x01Score:R,inMatch:Je,showWinPopup:Ct,pendingLegWinner:Dt,playerDartsThrown:Is,aiDartsThrown:Fs,totalPlayerDarts:fs,totalAiDarts:ps,totalPlayerPoints:Mn,totalAiPoints:Tn,player180s:or,player140s:yi,player100s:wi,ai180s:cr,ai140s:Si,ai100s:Ci,playerHighestCheckout:ki,aiHighestCheckout:Di,onClose:()=>Ot(!1),onOpen:()=>Ot(!0),layout:i})]})})}),document.body):null,Ws&&typeof document<"u"?_r.createPortal((()=>{const{target:t,value:s,stage:r}=Ws,l=t==="player"?it:Ut,c=t==="player"?J:le;return e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4",onClick:js,children:e.jsx(ys,{storageKey:"ndn:modal:offline-leg-override",className:"relative",defaultWidth:360,defaultHeight:240,minWidth:280,minHeight:200,maxWidth:420,maxHeight:360,initialFitHeight:!0,onClose:js,children:e.jsxs("div",{className:"space-y-3 max-w-[18rem] mx-auto",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide text-white/50",children:["Step ",r," of 2"]}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Override legs?"})]}),e.jsx("div",{className:"text-sm text-slate-200 leading-relaxed",children:r===1?e.jsxs(e.Fragment,{children:["Set ",l,"'s legs to ",e.jsx("span",{className:"font-semibold text-white",children:s}),"? Confirm to continue."]}):e.jsxs(e.Fragment,{children:["Final confirmation: set ",l,"'s legs to ",e.jsx("span",{className:"font-semibold text-white",children:s}),". Select ",e.jsx("span",{className:"font-semibold text-emerald-200",children:"Yes"})," to apply immediately."]})}),e.jsxs("div",{className:"rounded-xl bg-black/40 border border-white/10 p-3 text-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50 mb-1",children:"Current legs"}),e.jsx("div",{className:"text-base font-semibold text-white",children:c})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:js,children:"No"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:Ki,children:"Yes"})]})]})})})})(),document.body):null,Ct&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(ys,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${m===t?"bg-brand-600":""}`,onClick:()=>S(t),children:t},t))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${C===t?"bg-brand-600":""}`,onClick:()=>k(t),children:t},t))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:sl,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{G(!1),Kt()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{G(!1),qt(!1),Ue(!1)},children:"Back to Menu"})]})]})}),Ai&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(ys,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[x," Â· ",R," start Â· First to ",Qe]}),(()=>{const t=fs>0?Mn/fs*3:0,s=t*3,r=(()=>{const f=H.filter(w=>w.winner==="player"&&typeof w.winnerDarts=="number").map(w=>w.winnerDarts);return f.length?`${Math.min(...f)} darts`:"â€”"})(),l=(()=>{const f=H.filter(w=>w.winner==="player"&&typeof w.winnerDarts=="number").map(w=>w.winnerDarts);return f.length?`${Math.max(...f)} darts`:"â€”"})(),c=us>0?Math.round(Dn/us*100):0,v=ps>0?Tn/ps*3:0,g=v*3,D=(()=>{const f=H.filter(w=>w.winner==="ai"&&typeof w.winnerDarts=="number").map(w=>w.winnerDarts);return f.length?`${Math.min(...f)} darts`:"â€”"})(),b=(()=>{const f=H.filter(w=>w.winner==="ai"&&typeof w.winnerDarts=="number").map(w=>w.winnerDarts);return f.length?`${Math.max(...f)} darts`:"â€”"})(),j=hs>0?Math.round(An/hs*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:n?.username||"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:J}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:t.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:s.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:us})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[c,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:r})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:l})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:or})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[J," â€“ ",le]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:O==="None"?"Opponent":`${O} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:le}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:v.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:g.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:hs})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[j,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:D})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:b})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:cr})]})]})]})]})})(),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:H.map((t,s)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${t.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",s+1,": ",t.winner==="player"?"You":O==="None"?"Opp":"AI"," Â· Dbl ",t.doubleDarts," Â· CO ",t.checkoutDarts]},s))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(Yl,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>In(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{In(!1),Kt()},children:"Rematch"})]})]})}),H.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:H.map((t,s)=>e.jsxs("li",{children:["Leg ",s+1,": Double darts: ",t.doubleDarts,", Checkout darts: ",t.checkoutDarts]},s))})]})]})]})}export{Po as default};
//# sourceMappingURL=OfflinePlay-lkI_TwjC.js.map

{"version":3,"file":"OpsDashboard-pllY7rQC.js","sources":["../../src/components/OpsDashboard.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useIsAdmin } from \"../utils/admin\";\nimport { apiFetch } from \"../utils/api\";\n\ntype Ready = {\n  ok: boolean;\n  ws?: boolean;\n  rooms?: number;\n  clients?: number;\n  mem?: { rss: number; heapUsed: number };\n};\n\nexport default function OpsDashboard({ user }: { user: any }) {\n  const isAdmin = useIsAdmin(user?.email);\n  const [ready, setReady] = useState<Ready | null>(null);\n  const [ann, setAnn] = useState<string>(\"\");\n  const [msg, setMsg] = useState<string>(\"\");\n\n  async function refresh() {\n    try {\n      const res = await apiFetch(\"/readyz\");\n      setReady(await res.json());\n    } catch {}\n  }\n  useEffect(() => {\n    refresh();\n    const id = setInterval(refresh, 5000);\n    return () => clearInterval(id);\n  }, []);\n\n  if (!isAdmin)\n    return (\n      <div className=\"card\">\n        <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\n        <div>Restricted</div>\n      </div>\n    );\n\n  async function toggleMaintenance(enabled: boolean) {\n    setMsg(\"\");\n    try {\n      const res = await apiFetch(\"/api/admin/maintenance\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ enabled, requesterEmail: user?.email }),\n      });\n      const j = await res.json();\n      if (!res.ok || !j?.ok) setMsg(j?.error || \"Failed\");\n      else setMsg(`Maintenance ${enabled ? \"enabled\" : \"disabled\"}`);\n    } catch {\n      setMsg(\"Network error\");\n    }\n  }\n\n  async function announce() {\n    setMsg(\"\");\n    const text = ann.trim();\n    if (!text) return;\n    try {\n      const res = await apiFetch(\"/api/admin/announce\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ message: text, requesterEmail: user?.email }),\n      });\n      const j = await res.json();\n      if (!res.ok || !j?.ok) setMsg(j?.error || \"Failed\");\n      else setMsg(\"Announcement broadcasted\");\n      setAnn(\"\");\n    } catch {\n      setMsg(\"Network error\");\n    }\n  }\n\n  return (\n    <div className=\"card\">\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\n          <div className=\"font-semibold mb-1\">Readiness</div>\n          <div className=\"text-sm\">\n            HTTP:{\" \"}\n            <span\n              className={`font-semibold ${ready?.ok ? \"text-emerald-300\" : \"text-rose-300\"}`}\n            >\n              {String(!!ready?.ok)}\n            </span>\n          </div>\n          <div className=\"text-sm\">\n            WS:{\" \"}\n            <span\n              className={`font-semibold ${ready?.ws ? \"text-emerald-300\" : \"text-rose-300\"}`}\n            >\n              {String(!!ready?.ws)}\n            </span>\n          </div>\n          <div className=\"text-sm\">\n            Clients:{\" \"}\n            <span className=\"font-semibold\">{ready?.clients ?? 0}</span>\n          </div>\n          <div className=\"text-sm\">\n            Rooms: <span className=\"font-semibold\">{ready?.rooms ?? 0}</span>\n          </div>\n          <div className=\"text-sm\">\n            Heap Used:{\" \"}\n            <span className=\"font-semibold\">\n              {ready?.mem ? Math.round(ready.mem.heapUsed / 1024 / 1024) : 0} MB\n            </span>\n          </div>\n        </div>\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\n          <div className=\"font-semibold mb-1\">Maintenance</div>\n          <div className=\"flex gap-2\">\n            <button className=\"btn\" onClick={() => toggleMaintenance(true)}>\n              Enable\n            </button>\n            <button\n              className=\"btn bg-slate-700 hover:bg-slate-800\"\n              onClick={() => toggleMaintenance(false)}\n            >\n              Disable\n            </button>\n          </div>\n        </div>\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\n          <div className=\"font-semibold mb-1\">Announcement</div>\n          <div className=\"flex gap-2\">\n            <input\n              className=\"input flex-1\"\n              placeholder=\"Message to broadcast\"\n              value={ann}\n              onChange={(e) => setAnn(e.target.value)}\n            />\n            <button className=\"btn\" onClick={announce}>\n              Send\n            </button>\n          </div>\n        </div>\n      </div>\n      {msg && <div className=\"text-xs mt-2\">{msg}</div>}\n      <div className=\"text-xs opacity-70 mt-2\">\n        âœ… Clustering enabled! For 1.5k+ concurrent users, deploy behind a\n        reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets.\n        Set NODE_WORKERS environment variable to control worker count.\n      </div>\n    </div>\n  );\n}\n"],"names":["OpsDashboard","user","isAdmin","useIsAdmin","ready","setReady","useState","ann","setAnn","msg","setMsg","refresh","res","apiFetch","useEffect","id","jsxs","jsx","toggleMaintenance","enabled","j","announce","text","e"],"mappings":"oHAYA,SAAwBA,EAAa,CAAE,KAAAC,GAAuB,CAC5D,MAAMC,EAAUC,EAAWF,GAAM,KAAK,EAChC,CAACG,EAAOC,CAAQ,EAAIC,EAAAA,SAAuB,IAAI,EAC/C,CAACC,EAAKC,CAAM,EAAIF,EAAAA,SAAiB,EAAE,EACnC,CAACG,EAAKC,CAAM,EAAIJ,EAAAA,SAAiB,EAAE,EAEzC,eAAeK,GAAU,CACvB,GAAI,CACF,MAAMC,EAAM,MAAMC,EAAS,SAAS,EACpCR,EAAS,MAAMO,EAAI,MAAM,CAC3B,MAAQ,CAAC,CACX,CAOA,GANAE,EAAAA,UAAU,IAAM,CACdH,EAAA,EACA,MAAMI,EAAK,YAAYJ,EAAS,GAAI,EACpC,MAAO,IAAM,cAAcI,CAAE,CAC/B,EAAG,CAAA,CAAE,EAED,CAACb,EACH,OACEc,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,yCAAyC,SAAA,MAAG,EAC1DA,EAAAA,IAAC,OAAI,SAAA,YAAA,CAAU,CAAA,EACjB,EAGJ,eAAeC,EAAkBC,EAAkB,CACjDT,EAAO,EAAE,EACT,GAAI,CACF,MAAME,EAAM,MAAMC,EAAS,yBAA0B,CACnD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,QAAAM,EAAS,eAAgBlB,GAAM,MAAO,CAAA,CAC9D,EACKmB,EAAI,MAAMR,EAAI,KAAA,EAChB,CAACA,EAAI,IAAM,CAACQ,GAAG,GAAIV,EAAOU,GAAG,OAAS,QAAQ,EAC7CV,EAAO,eAAeS,EAAU,UAAY,UAAU,EAAE,CAC/D,MAAQ,CACNT,EAAO,eAAe,CACxB,CACF,CAEA,eAAeW,GAAW,CACxBX,EAAO,EAAE,EACT,MAAMY,EAAOf,EAAI,KAAA,EACjB,GAAKe,EACL,GAAI,CACF,MAAMV,EAAM,MAAMC,EAAS,sBAAuB,CAChD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,QAASS,EAAM,eAAgBrB,GAAM,KAAA,CAAO,CAAA,CACpE,EACKmB,EAAI,MAAMR,EAAI,KAAA,EAChB,CAACA,EAAI,IAAM,CAACQ,GAAG,GAAIV,EAAOU,GAAG,OAAS,QAAQ,IACtC,0BAA0B,EACtCZ,EAAO,EAAE,CACX,MAAQ,CACNE,EAAO,eAAe,CACxB,CACF,CAEA,OACEM,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,yCAAyC,SAAA,MAAG,EAC1DD,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,8DACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,YAAS,EAC7CD,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,QACjB,IACNC,EAAAA,IAAC,OAAA,CACC,UAAW,iBAAiBb,GAAO,GAAK,mBAAqB,eAAe,GAE3E,SAAA,OAAO,CAAC,CAACA,GAAO,EAAE,CAAA,CAAA,CACrB,EACF,EACAY,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,MACnB,IACJC,EAAAA,IAAC,OAAA,CACC,UAAW,iBAAiBb,GAAO,GAAK,mBAAqB,eAAe,GAE3E,SAAA,OAAO,CAAC,CAACA,GAAO,EAAE,CAAA,CAAA,CACrB,EACF,EACAY,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,WACd,UACR,OAAA,CAAK,UAAU,gBAAiB,SAAAZ,GAAO,SAAW,CAAA,CAAE,CAAA,EACvD,EACAY,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,gBACf,OAAA,CAAK,UAAU,gBAAiB,SAAAZ,GAAO,OAAS,CAAA,CAAE,CAAA,EAC5D,EACAY,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,aACZ,IACXA,EAAAA,KAAC,OAAA,CAAK,UAAU,gBACb,SAAA,CAAAZ,GAAO,IAAM,KAAK,MAAMA,EAAM,IAAI,SAAW,KAAO,IAAI,EAAI,EAAE,KAAA,CAAA,CACjE,CAAA,CAAA,CACF,CAAA,EACF,EACAY,EAAAA,KAAC,MAAA,CAAI,UAAU,8DACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,cAAW,EAC/CD,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CAAO,UAAU,MAAM,QAAS,IAAMC,EAAkB,EAAI,EAAG,SAAA,QAAA,CAEhE,EACAD,EAAAA,IAAC,SAAA,CACC,UAAU,sCACV,QAAS,IAAMC,EAAkB,EAAK,EACvC,SAAA,SAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EACAF,EAAAA,KAAC,MAAA,CAAI,UAAU,8DACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,eAAY,EAChDD,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,UAAU,eACV,YAAY,uBACZ,MAAOV,EACP,SAAWgB,GAAMf,EAAOe,EAAE,OAAO,KAAK,CAAA,CAAA,QAEvC,SAAA,CAAO,UAAU,MAAM,QAASF,EAAU,SAAA,MAAA,CAE3C,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,EACCZ,GAAOQ,EAAAA,IAAC,MAAA,CAAI,UAAU,eAAgB,SAAAR,EAAI,EAC3CQ,EAAAA,IAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,wMAAA,CAIzC,CAAA,EACF,CAEJ"}
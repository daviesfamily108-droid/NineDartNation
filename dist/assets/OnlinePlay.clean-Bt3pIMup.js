import{x as Me,i as We,u as gt,w as bt,I as wt,r as He,j as e,q as B,J as vt,K as qe,L as jt,b as yt,N as Nt,O as St,Q as Ct,g as kt,S as Mt,C as Tt,F as It,k as v,l as Te,M as Pt}from"./index-zYyjKDd0.js";import{r as a,X as Et,p as Ke,I as Lt,Z as Re,o as _t,C as ze,R as se,T as Ot,J as Rt,U as Ft,v as Je,h as Qe}from"./ui-HJtpxRqe.js";import{o as At,I as Bt,M as Dt}from"./matchWindow-_tMJLG5T.js";import"./vendor-D3F3s8fL.js";import"./aroundTheClock-BzZ4LFMk.js";function $t({open:o,onClose:c,onCreate:x}){const[w]=a.useState(()=>document.createElement("div")),[h,j]=a.useState("X01"),[i,D]=a.useState("bestof"),[Q,g]=a.useState(3),y=a.useRef(null),[ce,I]=a.useState(0),[X,$]=a.useState(()=>Me(h)?.[0]),[q,u]=a.useState(()=>We(h)),G=gt().username||"Anonymous";function E(n){j(n);const m=Me(n);$(m?.[0]),u(We(n));const l=qe[n];if(l?.modeOptions?.length){const C=l.modeOptions.includes(i)?i:l.modeOptions[0];D(C)}}a.useLayoutEffect(()=>(w.className="ndn-create-match-portal",document.body.appendChild(w),()=>{try{w&&w.remove()}catch{}}),[w]),a.useLayoutEffect(()=>{function n(m){m.key==="Escape"&&c()}return o&&document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[o,c]);const L=bt(h),Y=wt(h,i),N=B(h),V=()=>{const n={createdBy:G,game:h,modeType:i,legs:Q,avgChoice:ce,startingScore:X,...q};x(n),c()};return!o||!w?null:He.createPortal(e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-2 sm:p-6",children:[e.jsx("button",{"aria-label":"Close dialog",className:"absolute inset-0 w-full h-full bg-transparent",onClick:c}),e.jsxs("div",{className:"rounded-2xl p-5 sm:p-6 max-w-lg w-full relative text-white shadow-2xl border border-indigo-500/30 max-h-[85vh] overflow-y-auto",style:{background:"var(--ndn-card-bg, #0f172a)"},role:"dialog",children:[e.jsx("button",{"aria-label":"Close",className:"absolute top-3 right-3 w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors",onClick:c,children:"‚úï"}),e.jsxs("h2",{className:"text-base sm:text-lg font-bold tracking-tight mb-3",children:[N.emoji," Create Match"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Created By"}),e.jsx("div",{className:"p-2 rounded-lg border border-indigo-500/20 bg-indigo-500/10 text-sm text-white",children:G})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-game",children:"Game"}),e.jsx("select",{id:"match-game",className:"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white",value:h,onChange:n=>E(n.target.value),onPointerDown:n=>{n.stopPropagation()},onMouseDown:n=>{n.stopPropagation()},onTouchStart:n=>{n.stopPropagation?.()},children:vt.map(n=>{const m=B(n);return e.jsxs("option",{value:n,className:"bg-slate-900 text-white",children:[m.emoji," ",n]},n)})}),N.tagline&&e.jsx("div",{className:"text-[10px] mt-0.5 px-0.5",style:{color:N.color},children:N.tagline})]}),Me(h).length>0?e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-start",children:`${h} Starting Score`}),e.jsx("select",{id:"match-start",className:"p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white w-full",value:X,onChange:n=>$(Number(n.target.value)),onPointerDown:n=>{n.stopPropagation()},onMouseDown:n=>{n.stopPropagation()},onTouchStart:n=>{n.stopPropagation?.()},children:Me(h).map(n=>e.jsx("option",{value:n,className:"bg-slate-900 text-white",children:n},n))})]}):null,L.length>0&&e.jsx("div",{className:"space-y-2",children:L.map(n=>e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:`match-extra-${n.key}`,children:n.label}),n.type==="select"&&n.options?e.jsx("select",{id:`match-extra-${n.key}`,className:"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white",value:q[n.key]??n.defaultValue,onChange:m=>u(l=>({...l,[n.key]:Number(m.target.value)})),onPointerDown:m=>{m.stopPropagation()},onMouseDown:m=>{m.stopPropagation()},onTouchStart:m=>{m.stopPropagation?.()},children:n.options.map(m=>e.jsx("option",{value:m,className:"bg-slate-900 text-white",children:m},m))}):e.jsx("input",{id:`match-extra-${n.key}`,type:"number",min:n.min??1,max:n.max,step:n.step??1,value:q[n.key]??n.defaultValue,onChange:m=>u(l=>({...l,[n.key]:Number(m.target.value)})),className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"}),n.hint&&e.jsx("div",{className:"text-[10px] text-slate-400 mt-0.5 px-0.5",children:n.hint})]},n.key))}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Mode"}),e.jsx("div",{className:"flex gap-2 mt-1 justify-center flex-wrap",children:(qe[h]?.modeOptions??["bestof","firstto"]).map(n=>e.jsxs("label",{className:`btn ${i===n?"btn-primary":"btn-ghost"}`,children:[e.jsx("input",{type:"radio",name:"mode",value:n,checked:i===n,onChange:()=>{D(n),g(n==="bestof"?m=>{const l=Math.max(1,m||3);return l%2===1?l:l+1}:m=>Math.max(1,m||3)),setTimeout(()=>y.current?.focus(),0)},className:"sr-only"})," ",n==="bestof"?"Best Of":n==="firstto"?"First To":n==="innings"?"Innings":n==="holes"?"Holes":n==="rounds"?"Rounds":n==="practice"?"Practice":n]},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-legs",children:Y}),e.jsx("input",{id:"match-legs",type:"number",min:1,value:Q,onChange:n=>g(Math.max(1,Number(n.target.value||1))),ref:y,className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-avg",children:"Average Choice (¬±)"}),e.jsx("input",{id:"match-avg",type:"number",value:ce,onChange:n=>I(Number(n.target.value||0)),className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-3 border-t border-indigo-500/20",children:[e.jsx("button",{className:"flex-1 btn btn-ghost text-xs",onClick:c,children:"Cancel"}),e.jsx("button",{className:"flex-1 btn text-xs",onClick:V,children:"Create Match"})]})]})]}),w)}function Xe(o){try{const c=yt(o).toFixed(1),x=Nt(o).toFixed(1),w=St(o),h=Ct(o),j=kt(o),i=Mt(o);return{avg3:c,best9:x,bestCheckout:w||"‚Äì",bestLeg:h||"‚Äì",lifetimeScored:j.scored||0,lifetimeDarts:j.darts||0,career180s:i||0}}catch{return{avg3:"0.0",best9:"0.0",bestCheckout:"‚Äì",bestLeg:"‚Äì",lifetimeScored:0,lifetimeDarts:0,career180s:0}}}function Ie({label:o,value:c,highlight:x}){return e.jsxs("div",{className:`flex flex-col items-center px-1.5 py-1 rounded-lg ${x?"bg-indigo-500/20 ring-1 ring-indigo-500/30":"bg-white/5"}`,children:[e.jsx("span",{className:"text-[7px] sm:text-[8px] uppercase tracking-wider font-bold text-white/50",children:o}),e.jsx("span",{className:`text-xs sm:text-sm font-black ${x?"text-indigo-300":"text-white"}`,children:c})]})}function Ye({name:o,stats:c,isLocal:x,showCamera:w,isWinner:h,legDiff:j}){const i=typeof j=="number"?`${j>0?"+":""}${j}`:null;return e.jsxs("div",{className:`relative rounded-xl border p-2 sm:p-3 transition-all duration-500 ${h?"border-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/5 shadow-xl shadow-amber-500/10 ring-1 ring-amber-400/30":"border-white/10 bg-white/5"}`,children:[h&&e.jsxs("div",{className:"absolute -top-2.5 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-amber-500 text-black text-[9px] font-black uppercase tracking-widest rounded-full shadow-lg",children:[e.jsx(_t,{className:"w-2.5 h-2.5 inline mr-0.5"}),"Throws First"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-black ${x?"bg-gradient-to-br from-indigo-500 to-purple-600 text-white":"bg-gradient-to-br from-rose-500 to-orange-500 text-white"}`,children:o.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-sm sm:text-base tracking-tight",children:o}),e.jsx("div",{className:"text-[9px] text-white/50 font-semibold uppercase tracking-wider",children:x?"You":"Opponent"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 mb-2",children:[e.jsx(Ie,{label:"Avg",value:c.avg3,highlight:!0}),e.jsx(Ie,{label:"F9",value:c.best9}),e.jsx(Ie,{label:"CO",value:String(c.bestCheckout)}),e.jsx(Ie,{label:"Leg Diff",value:i??"0"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[9px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"180s"}),e.jsx("span",{className:"font-bold text-white",children:c.career180s})]}),e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Scored"}),e.jsx("span",{className:"font-bold text-white",children:c.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Darts"}),e.jsx("span",{className:"font-bold text-white",children:c.lifetimeDarts.toLocaleString()})]})]}),w&&e.jsxs("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/40",children:[e.jsxs("div",{className:"px-2 py-1 flex items-center gap-1.5 text-[9px] text-white/60 border-b border-white/5",children:[e.jsx(ze,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-semibold uppercase tracking-wider",children:x?"Your Camera":"Opponent Camera"}),e.jsx("span",{className:"ml-auto text-emerald-400 font-bold",children:"‚óè Live"})]}),e.jsx("div",{className:"aspect-video relative bg-black",children:x?e.jsx(Tt,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",tileFitModeOverride:"fit",scale:1}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/30 text-[10px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"w-6 h-6 mx-auto mb-1 opacity-30"}),"Waiting for opponent's feed‚Ä¶"]})})})]})]})}function Gt({open:o,matchInfo:c,localUser:x,opponentName:w,opponentStats:h,countdown:j=15,onChoice:i,onBullThrow:D,onAccept:Q,onCancel:g,remoteChoice:y,bullActive:ce,bullWinner:I,bullTied:X}){const[$,q]=a.useState(j),[u,G]=a.useState("preview"),[E,L]=a.useState(0),[Y,N]=a.useState("rock"),[V,n]=a.useState("rock"),[m,l]=a.useState(0),[C,ae]=a.useState(!1),S=a.useRef(typeof document<"u"?document.createElement("div"):null),P={rock:"‚úä",paper:"‚úã",scissors:"‚úåÔ∏è"},de={rock:"Rock",paper:"Paper",scissors:"Scissors"},k=["rock","paper","scissors"],O=a.useMemo(()=>Xe(x?.username||""),[x?.username]),Fe=a.useMemo(()=>h?{avg3:h.avg3||"0.0",best9:h.best9||"0.0",bestCheckout:h.bestCheckout||"‚Äì",bestLeg:h.bestLeg||"‚Äì",career180s:h.career180s||0,lifetimeScored:0,lifetimeDarts:0}:Xe(w),[w,h]),ue=a.useMemo(()=>c?c.firstThrowerName||c.createdBy||c.creatorName||x?.username||"You":x?.username||"You",[c,x?.username]),R=a.useMemo(()=>ue.toLowerCase()===(x?.username||"You").toLowerCase(),[ue,x?.username]);a.useEffect(()=>{const f=S.current;if(!(!f||typeof document>"u"))return f.className="ndn-match-prestart-portal",document.body.appendChild(f),()=>{try{f.parentNode?.removeChild(f)}catch{}}},[]),a.useEffect(()=>{o&&(q(j),G("preview"),L(0),l(0),ae(!1))},[o,j]),a.useEffect(()=>{if(!o||u!=="preview")return;const f=setTimeout(()=>G("rps"),4e3);return()=>clearTimeout(f)},[o,u]),a.useEffect(()=>{if(!o||u!=="rps")return;L(0),ae(!1);let f=0;const ne=setInterval(()=>{if(f++,f>=9){clearInterval(ne);const M=k[Math.floor(Math.random()*3)],F=k[Math.floor(Math.random()*3)];M===F?(N(M),n(F),L(3),ae(!0),setTimeout(()=>{ae(!1),l(be=>be+1)},1800)):(M==="rock"&&F==="scissors"||M==="scissors"&&F==="paper"||M==="paper"&&F==="rock"?(N(R?M:F),n(R?F:M)):(N(R?F:M),n(R?M:F)),L(3),setTimeout(()=>G("result"),1500))}else N(k[f%3]),n(k[(f+1)%3]),L(f)},350);return()=>clearInterval(ne)},[o,u,m,R]),a.useEffect(()=>{if(u!=="result")return;const f=setTimeout(()=>G("go"),3e3);return()=>clearTimeout(f)},[u]),a.useEffect(()=>{if(u!=="go")return;const f=setTimeout(()=>{Q()},1500);return()=>clearTimeout(f)},[u,Q]),a.useEffect(()=>{if(!o||u!=="preview")return;const f=window.setInterval(()=>{q(ne=>Math.max(0,ne-1))},1e3);return()=>window.clearInterval(f)},[o,u]);const H=x?.username||"You",me=a.useMemo(()=>jt(H,w),[H,w]),he=me.played?me.diffA:null,re=me.played?me.diffB:null;if(!o||!S.current||!c)return null;const K=ue,Pe=R,W=!R,Ee=e.jsxs("div",{className:"fixed inset-0 z-[9998] bg-black/95 backdrop-blur-xl flex flex-col",style:{height:"100dvh",maxHeight:"100dvh",overflow:"hidden"},role:"dialog","aria-modal":"true","aria-label":"Match pre-start",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-2 sm:p-4 min-h-0",children:e.jsxs("div",{className:"relative w-full max-w-5xl max-h-full flex flex-col",children:[e.jsx("button",{className:"absolute -top-2 -right-2 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition-all border border-white/10",onClick:g,"aria-label":"Cancel match",children:e.jsx(Et,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-2 sm:mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] sm:text-[11px] font-bold uppercase tracking-widest text-white/60 mb-2",children:[e.jsx(Ke,{className:"w-3 h-3"}),c.game," ¬∑"," ",c.modeType==="bestof"?"Best Of":"First To"," ",c.legs," ¬∑ ",c.startingScore||501]}),u==="preview"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tighter",children:"Match Found"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:"Reviewing opponent stats‚Ä¶"})]}),u==="rps"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-amber-300 tracking-tighter",children:"‚úä Rock Paper Scissors! ‚úåÔ∏è"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:"Deciding who throws first‚Ä¶"})]}),u==="result"&&e.jsxs("div",{className:"animate-in fade-in zoom-in-95 duration-700",children:[e.jsxs("h2",{className:"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-amber-500 tracking-tighter",children:["üéâ ",K," Throws First!"]}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/50 mt-1",children:[K," won the coin toss"]})]}),u==="go"&&e.jsx("div",{className:"animate-in fade-in zoom-in-50 duration-300",children:e.jsx("h2",{className:"text-5xl sm:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500 tracking-tighter",children:"GO!"})})]}),u==="preview"&&e.jsxs("div",{className:"mb-2 sm:mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Lt,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white/40"}),e.jsx("span",{className:"text-xl sm:text-2xl font-black text-white tabular-nums",children:$}),e.jsx("span",{className:"text-[10px] sm:text-xs text-white/40 font-semibold",children:"seconds"})]}),e.jsx("div",{className:"h-0.5 sm:h-1 bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000 ease-linear",style:{width:`${$/j*100}%`}})})]}),(u==="preview"||u==="rps"||u==="result")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-2 sm:gap-4 items-start mb-2 sm:mb-4 flex-shrink-0",children:[e.jsx(Ye,{name:H,stats:O,isLocal:!0,showCamera:u==="preview",legDiff:he,isWinner:u==="result"&&Pe}),e.jsxs("div",{className:"hidden md:flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-indigo-500/30 ring-2 ring-white/10",children:"VS"}),e.jsx("div",{className:"w-px h-12 bg-gradient-to-b from-indigo-500/30 to-transparent mt-2"})]}),e.jsx("div",{className:"flex md:hidden items-center justify-center py-2",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-xl shadow-indigo-500/30",children:"VS"})}),e.jsx(Ye,{name:w,stats:Fe,isLocal:!1,showCamera:u==="preview",legDiff:re,isWinner:u==="result"&&W})]}),u==="rps"&&e.jsxs("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-500 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-center gap-8 sm:gap-12",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-6xl sm:text-7xl transition-transform duration-200 ${E<3?"animate-bounce":"scale-110"}`,children:P[Y]}),e.jsx("div",{className:"text-xs text-white/50 mt-2 font-semibold",children:H}),E>=3&&e.jsx("div",{className:"text-[10px] text-white/40 mt-0.5",children:de[Y]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"text-2xl sm:text-3xl font-black text-white/30",children:"VS"}),E<3&&e.jsx("div",{className:"w-3 h-3 border-2 border-amber-400/30 border-t-amber-400 rounded-full animate-spin"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-6xl sm:text-7xl transition-transform duration-200 ${E<3?"animate-bounce":"scale-110"}`,children:P[V]}),e.jsx("div",{className:"text-xs text-white/50 mt-2 font-semibold",children:w}),E>=3&&e.jsx("div",{className:"text-[10px] text-white/40 mt-0.5",children:de[V]})]})]}),E>=3&&!C&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/10 border border-amber-400/30 text-sm text-amber-200 font-semibold animate-in fade-in zoom-in-95 duration-500",children:[e.jsx(Re,{className:"w-4 h-4 text-amber-400"}),K," throws first!"]}),E>=3&&C&&e.jsx("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-rose-500/10 border border-rose-400/30 text-sm text-rose-200 font-semibold animate-in fade-in zoom-in-95 duration-500",children:"ü§ù Draw! Going again‚Ä¶"})]}),u==="preview"&&e.jsx("div",{className:"flex items-center justify-center mt-2 sm:mt-4 flex-shrink-0",children:e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-white/5 border border-white/10 text-white/70 font-semibold text-sm sm:text-base hover:bg-white/10 transition-all",onClick:g,children:"Cancel"})})]})})]});return He.createPortal(Ee,S.current)}function Yt({user:o}){const c=o?.username||"You",[x,w]=a.useState(0),[h,j]=a.useState(()=>[{id:1,name:"page-1",pageId:"default",matches:[]}]),i=(()=>{try{return It()}catch{return null}})(),[D,Q]=a.useState([]),g=v(t=>t.inProgress),y=v(t=>t.matchContext),ce=v(t=>t.players),[I,X]=a.useState(!1),$=a.useRef(null),[q,u]=a.useState(!1),[G,E]=a.useState([]),L=a.useRef(!1);a.useEffect(()=>{if(L.current&&!g&&y==="online"){const t=v.getState();t.players&&t.players.length>0&&(E(JSON.parse(JSON.stringify(t.players))),u(!0));try{const s=document.getElementById("ndn-main-scroll");s&&(s.scrollTop=0)}catch{}}L.current=g},[g,y]),a.useEffect(()=>{if(!I)return;function t(s){try{if(!$.current)return;$.current.contains(s.target)||X(!1)}catch{}}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[I]);const[Y,N]=a.useState(!1),V=se.useRef(!1);a.useEffect(()=>{if(!g||y!=="online"){V.current=!1,N(!1);return}V.current||(v.getState().players||[]).some(r=>(r.legs||[]).some(d=>(d.visits||[]).length>0))||(V.current=!0,N(!0))},[g,y]),a.useEffect(()=>{if(!(!g||y!=="online"))try{const t=v.getState();if((t?.game||"X01")!=="X01"||!t.roomId)return;const r=`ndn:matchWindowOpened:${t.roomId}`;if(window.sessionStorage.getItem(r)==="1")return;window.sessionStorage.setItem(r,"1"),At()}catch{}},[g,y]),a.useEffect(()=>{g&&y==="online"||(V.current=!1)},[g,y]),a.useEffect(()=>{if(i?.connected&&o?.username)try{i.send({type:"presence",username:o.username,email:o.email||""})}catch{}},[i?.connected,o]),a.useEffect(()=>(window.__ndn_online_mounted=!0,()=>{window.__ndn_online_mounted=!1}),[]),a.useEffect(()=>{const t=()=>{try{v.getState().endGame()}catch{}P(null),k(null),C(null),W(null),je(null),O.current=null;try{window.__ndn_pending_invite=null}catch{}};try{window.addEventListener("ndn:match-quit",t)}catch{}return()=>{try{window.removeEventListener("ndn:match-quit",t)}catch{}}},[]);const[n,m]=a.useState(!1),[l,C]=a.useState(null),ae=se.useRef(null),[S,P]=a.useState(null),[de,k]=a.useState(null),O=a.useRef(null),[Fe,ue]=a.useState(null),[R,H]=a.useState({}),[me,he]=a.useState(30),re=a.useRef([]);a.useEffect(()=>{re.current=D||[]},[D]),a.useEffect(()=>{l&&(O.current={...l})},[l]);const K=se.useRef(!1),[Pe,W]=a.useState(null),[Ee,f]=a.useState({}),[ne,M]=a.useState(!1),[F,be]=a.useState(null),[Ue,Le]=a.useState(null),[Vt,Ae]=a.useState(null),[Wt,we]=a.useState(!1),[Ze,ve]=a.useState(!1),[Be,je]=a.useState(null),[et,tt]=a.useState("X01"),st=a.useRef(null),[De,$e]=a.useState(null),[xe,at]=a.useState(""),[fe,rt]=a.useState("all"),[pe,nt]=a.useState("all"),[ye,it]=a.useState("newest"),[U,Ne]=a.useState(1),_e=12,Z=h[x],Se=999,Ce=se.useCallback(t=>{if(!t)return t;const s=t.modeType||t.mode||"",r=t.legs??t.value??t.bestOf??t.sets??t.games??1,d=t.createdBy||t.creatorName||t.creator||t.host||"",p=t.createdAt||t.ts||Date.now();return{...t,modeType:s,mode:s||t.mode,legs:r,value:typeof t.value=="number"?t.value:r,createdBy:d,creatorName:t.creatorName||d,createdAt:p}},[]),ie=a.useMemo(()=>(t=[])=>(t||[]).map(Ce).filter(s=>!(s?.isTest||s?.test||s?.migrated||s?.isMigration||s?.migration||s?.seeded||s?.status==="completed"||s?.status==="played"||s?.declineCount&&s.declineCount>=3||typeof s?.createdBy=="string"&&s.createdBy.toLowerCase().includes("test")||typeof s?.creatorName=="string"&&s.creatorName.toLowerCase().includes("test")||typeof s?.createdBy=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(s.createdBy)||typeof s?.creatorName=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(s.creatorName)||!(s?.game&&s?.modeType&&s?.legs))),[Ce]),ee=a.useMemo(()=>{const t=Z?.pageId||"default";let s=ie(Z?.matches||[]);if((s?.length||0)===0&&(D?.length||0)>0&&(s=ie(D.filter(r=>(r.pageId||"default")===t))),(s?.length||0)===0&&(re.current?.length||0)>0&&(s=ie(re.current.filter(r=>(r.pageId||"default")===t))),xe.trim()){const r=xe.toLowerCase();s=s.filter(d=>(d.game||"").toLowerCase().includes(r)||(d.createdBy||d.creatorName||"").toLowerCase().includes(r)||(d.id||"").toLowerCase().includes(r))}return fe!=="all"&&(s=s.filter(r=>(r.game||"").toLowerCase()===fe)),pe!=="all"&&(s=s.filter(r=>{const d=(r.modeType||"").replace("_","").toLowerCase(),p=pe.replace("_","").toLowerCase();return d.includes(p)})),s=(s||[]).slice(),s.sort((r,d)=>{const p=r.createdAt||0,b=d.createdAt||0;return ye==="newest"?b-p:p-b}),s.slice(0,Se)},[Z,D,ie,xe,fe,pe,ye,Se]);a.useEffect(()=>{Ne(1)},[xe,fe,pe,ye,x]);const te=Math.ceil(ee.length/_e),lt=ee.slice((U-1)*_e,U*_e),ot=()=>{ee.length>0&&Ge(ee[0])},ct=t=>{const s=Z?.pageId||"default",r={id:`m-${Date.now()}`,createdBy:t.createdBy||c,game:t.game,modeType:t.modeType,legs:t.legs,startingScore:t.startingScore,pageId:s,createdAt:Date.now()};i?.connected||j(d=>d.map((p,b)=>b===x?{...p,matches:[r,...p.matches]}:p));try{i?.connected&&(o?.username&&i.send({type:"presence",username:o.username,email:o.email||""}),i.send({type:"create-match",game:t.game,mode:t.modeType,value:t.legs,startingScore:t.startingScore,creatorAvg:t.avgChoice||0,pageId:s}))}catch{}},dt=()=>{j(t=>{const s=t.length+1,r=`page-${s}-${Date.now()}`,d=[...t,{id:s,name:`page-${s}`,pageId:r,matches:[]}];return w(d.length-1),d})},ge=se.useCallback(t=>{try{if(console.log("[OnlinePlay] handleInviteOrPrestart:",t?.type,t),t?.type==="invite"){const s={id:t.matchId,game:t.game,mode:t.mode||"firstto",value:t.value||1,startingScore:t.startingScore||501,fromName:t.fromName||"Opponent",fromId:t.fromId};P(s);try{const r=new Audio("/sounds/notify.mp3");r.volume=.5,r.play().catch(()=>{})}catch{}}if(t?.type==="invite-waiting"&&k(t.creatorName||"Creator"),t?.type==="match-prestart"){if(v.getState().inProgress)return;P(null),k(null);const s=Ce(t.match||null);if(s&&(s.prestartEndsAt=t.prestartEndsAt),s&&(s.firstThrowerId=t.firstThrowerId||null,s.firstThrowerName=t.firstThrowerName||null),s){const d=(o?.username||"").toLowerCase(),p=(s.creatorName||s.createdBy||"").toLowerCase();d&&p===d&&(s._isCreatorView=!0)}try{s?.creatorId&&s?.creatorName&&H(d=>({...d,[s.creatorId]:s.creatorName}))}catch{}K.current=!0,C(s);const r=t.prestartEndsAt||Date.now();he(Math.max(0,Math.ceil(((r||Date.now())-Date.now())/1e3))),setTimeout(()=>{K.current=!1},0),W(null),f({}),M(!1),be(null),Le(null),ve(!1)}t?.type==="invite-expired"&&(P(null),k(null),C(s=>s&&t.matchId===s.id?null:s)),t?.type==="declined"&&(P(null),k(null),C(s=>s&&t.matchId===s.id?null:s))}catch{}},[Ce,o]),le=se.useCallback(t=>{if(t?.type!=="match-start"||v.getState().inProgress)return;const s=t.match||{},r=O.current||{},d=t.roomId||r.id||"",p=s.startingScore||r.startingScore||501,b=c,A=s.creatorName||r.creatorName||r.createdBy||"",oe=s.joinerName||r.joinerName||"",T=t.firstThrowerId||t.firstPlayerId||null,_=r._isCreatorView||A.toLowerCase()===b.toLowerCase(),z=_?oe||"Opponent":A||"Opponent";let J;if(T){const ke=s.creatorId||r.creatorId;J=_?T===ke:T!==ke}else J=_;const ht=J?[b,z]:[z,b],xt=s.mode||r.mode||r.modeType||"bestof",Ve=Number(s.value||r.value||r.legs||1),ft=xt==="firstto"?Ve:Math.ceil(Ve/2);try{v.getState().newMatch(ht,p,d,"online",ft)}catch(ke){console.error("[OnlinePlay] newMatch failed:",ke)}const pt=s.game||r.game||"X01";tt(pt);try{i?.connected&&i.send({type:"join",roomId:d})}catch{}O.current=null,C(null),W(null),f({})},[c,i]);a.useEffect(()=>i?(i.connected&&i.send({type:"list-matches"}),i.addListener(s=>{try{if(s?.type==="joined"&&s.id&&ue(s.id),s?.type==="presence")try{s.id&&H(r=>({...r,[s.id]:s.username||s.name||s.id}))}catch{}if(s?.type==="matches"){const r=ie(s.matches||[]);Q(r),re.current=r,j(d=>d.map(p=>{const b=r.filter(A=>(A.pageId||"default")===p.pageId);return{...p,matches:b}}))}if(ge(s),s?.type==="match-start"&&le(s),s?.type==="prestart-choice-notify"){const{roomId:r,playerId:d,choice:p}=s;if(!r||!p)return;f(b=>({...b||{},[d]:p}))}if(s?.type==="prestart-bull"&&(M(!0),we(!1),Ae(null)),s?.type==="prestart-bull-winner"&&(Le(s.winnerName||s.winnerId||null),M(!1),we(!1),ve(!1)),s?.type==="prestart-bull-tie"&&(Le(null),M(!1),we(!1),ve(!0),setTimeout(()=>ve(!1),2e3)),s?.type==="opponent-quit"&&je(s.quitterName||"Opponent"),s?.type==="opponent-paused")try{Te.getState().setPaused(!0,null,s.pauserName||"Opponent")}catch{}if(s?.type==="opponent-unpaused")try{Te.getState().setPaused(!1,null)}catch{}if(s?.type==="state"&&s.payload)try{v.getState().importState(s.payload)}catch{}if(s?.type==="camera-frame"&&s.frame){st.current=s.frame;try{const r=document.getElementById("ndn-opponent-frame");r&&(r.src=s.frame)}catch{}De||$e(s.frame)}}catch{}})):void 0,[i,Pe,ie,x,ge,le]),a.useEffect(()=>{try{const s=window.__ndn_pending_invite;s&&(window.__ndn_pending_invite=null,s.type==="match-start"?le(s):ge(s))}catch{}const t=s=>{try{const r=s.detail;if(!r)return;r.type==="match-start"?le(r):ge(r)}catch{}};return window.addEventListener("ndn:match-invite",t),()=>window.removeEventListener("ndn:match-invite",t)},[ge,le]),a.useEffect(()=>{if(!l||K.current||l.prestartEndsAt)return;he(30),W(null),f({});const t=setInterval(()=>he(s=>Math.max(0,s-1)),1e3);return()=>clearInterval(t)},[l]),a.useEffect(()=>{l&&setTimeout(()=>ae.current?.focus(),0)},[l]);const ut=()=>{N(!0);const t=l?{...l}:null;t&&(O.current=t);try{if(i?.connected&&l?.id){const s=!!l._isCreatorView;i.send({type:"invite-response",matchId:l.id,accept:!0,toId:s?l.joinerId:l.creatorId})}}catch{}t?le({type:"match-start",match:t,roomId:t.id,firstThrowerId:t.firstThrowerId||null,firstPlayerId:t.firstThrowerId||null}):C(null)},Ge=t=>{k(t.creatorName||t.createdBy||"Creator"),O.current={...t};try{i?.connected&&(o?.username&&i.send({type:"presence",username:o.username,email:o.email||""}),i.send({type:"join-match",matchId:t.id,calibrated:!0}))}catch{}},mt=t=>{W(t);try{i?.connected&&l?.id&&i.send({type:"prestart-choice",roomId:l.id,choice:t})}catch{}},Oe=se.useCallback(()=>{try{if(i?.connected){const t=v.getState();i.send({type:"state",payload:t})}}catch{}},[i]);if(a.useEffect(()=>{if(!g||y!=="online"||!i?.connected)return;let t=!0;const s=document.createElement("canvas"),r=s.getContext("2d");let d=0;const p=42,b=()=>{if(!t)return;requestAnimationFrame(b);const A=performance.now();if(!(A-d<p))try{const T=window.__ndn_camera_debug?.videoEl?.();if(!T||!T.videoWidth||!T.videoHeight)return;const _=480,z=Math.round(T.videoHeight/T.videoWidth*_)||270;if(s.width!==_&&(s.width=_),s.height!==z&&(s.height=z),!r)return;r.drawImage(T,0,0,_,z),d=A;const J=s.toDataURL("image/jpeg",.55);try{i.send({type:"camera-frame",frame:J})}catch{}}catch{}};return requestAnimationFrame(b),()=>{t=!1}},[g,y,i]),a.useEffect(()=>{(!g||y!=="online")&&$e(null)},[g,y]),g&&y==="online"){const s=(v.getState().players||[]).findIndex(r=>r?.name&&r.name.toLowerCase()===c.toLowerCase());return e.jsxs(e.Fragment,{children:[e.jsx(Bt,{user:o,showStartShowcase:Y,onShowStartShowcaseChange:N,onCommitVisit:(r,d,p)=>{try{const b=v.getState(),A=b.players[b.currentPlayerIdx],oe=A?.legs?.[A.legs.length-1],T=oe?oe.totalScoreRemaining:b.startingScore,_=Math.max(0,T-r),z=T<=50?3:_<=50?1:0,J=_===0;b.addVisit(r,3,{preOpenDarts:0,doubleWindowDarts:z,finishedByDouble:J,visitTotal:r}),J&&r>0?b.endLeg(r):b.nextPlayer()}catch{v.getState().addVisit(r,3),v.getState().nextPlayer()}Oe()},onQuit:()=>{try{v.getState().endGame()}catch{}try{i?.connected&&i.send({type:"match-quit"})}catch{}P(null),k(null),C(null),W(null),je(null),O.current=null;try{window.__ndn_pending_invite=null}catch{}Oe();try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},onPause:()=>{try{Te.getState().setPaused(!0,null,c)}catch{}try{i?.connected&&i.send({type:"match-pause"})}catch{}},onResume:()=>{try{Te.getState().setPaused(!1,null)}catch{}try{i?.connected&&i.send({type:"match-unpause"})}catch{}},onStateChange:Oe,localPlayerIndexOverride:s>=0?s:void 0,gameModeOverride:et,isOnline:!0,remoteFrame:De}),Be&&e.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl",children:[e.jsx("div",{className:"text-4xl mb-3",children:"üö™"}),e.jsxs("h3",{className:"text-lg font-bold text-white mb-2",children:[Be," left the match"]}),e.jsx("p",{className:"text-sm text-white/60 mb-5",children:"Your opponent has quit. You can leave the match now."}),e.jsx("button",{className:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all",onClick:()=>{try{v.getState().endGame()}catch{}je(null),P(null),k(null),C(null),W(null),O.current=null;try{window.__ndn_pending_invite=null}catch{}try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},children:"Leave Match"})]})})]})}return e.jsxs("div",{className:"flex-1 min-h-0 ndn-page",style:{position:"relative",marginTop:0},children:[e.jsxs("div",{className:"card ndn-game-shell ndn-online-page relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col",children:[Y&&e.jsx(Pt,{players:ce||[],user:o,onDone:()=>N(!1),onRequestClose:()=>N(!1)}),e.jsx("h2",{className:"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title",children:"Online Lobby üåê"}),e.jsx("div",{className:"ndn-shell-body flex-1 overflow-hidden p-3 pb-0",children:e.jsxs("div",{className:"h-full flex flex-col gap-3",children:[e.jsxs("div",{className:"ndn-page-header p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"text-sm text-white/70",children:"Page"}),e.jsxs("div",{className:"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium",children:["Page ",Z?.id]}),e.jsx("button",{className:"ndn-new-page-btn btn btn-ghost btn-sm rounded-lg",onClick:dt,children:"New Page"})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg",onClick:()=>m(!0),disabled:(Z?.matches?.length||0)>=Se,children:[e.jsx(Ot,{className:"w-4 h-4"}),"Create Match +"]}),(Z?.matches?.length||0)>=Se&&e.jsx("div",{className:"text-xs text-rose-400",children:"Page full ‚Äî create a new page"})]})]}),!g&&e.jsx("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3",children:e.jsxs("div",{className:"ndn-filterbar",children:[e.jsxs("div",{className:"flex-1 min-w-[240px] relative",children:[e.jsx(Rt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",placeholder:"Search matches, players...",className:"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all",value:xe,onChange:t=>at(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:fe,onChange:t=>rt(t.target.value),children:[e.jsx("option",{value:"all",children:"All Games"}),e.jsxs("option",{value:"x01",children:[B("X01").emoji," X01"]}),e.jsxs("option",{value:"cricket",children:[B("Cricket").emoji," Cricket"]}),e.jsxs("option",{value:"bermuda",children:[B("Bermuda").emoji," Bermuda"]}),e.jsxs("option",{value:"gotcha",children:[B("Gotcha").emoji," Gotcha"]})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:pe,onChange:t=>nt(t.target.value),children:[e.jsx("option",{value:"all",children:"All Modes"}),e.jsx("option",{value:"first_to",children:"First To"}),e.jsx("option",{value:"best_of",children:"Best Of"})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:ye,onChange:t=>it(t.target.value),children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${I?"bg-red-600 text-white border-red-500":"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900"}`,onClick:()=>X(t=>!t),"aria-pressed":I,title:"Toggle focus mode: hide small details and show focused view",children:I?"Exit Focus":"Focus Mode"})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg",onClick:ot,disabled:ee.length===0,children:[e.jsx(Re,{className:"w-4 h-4 fill-current"}),"Quick Join"]})})]})}),e.jsxs("div",{className:"flex-1 overflow-auto flex flex-col",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(Ft,{className:"w-5 h-5 text-indigo-400"}),"Active Matches ÔøΩÔ∏è"]}),e.jsx("div",{className:"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col",children:e.jsxs("div",{className:"flex-1 overflow-auto",children:[(ee.length||0)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center opacity-60",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4",children:e.jsx(Ke,{className:"w-8 h-8 text-white/20"})}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No matches found"}),e.jsx("p",{className:"text-sm max-w-xs mx-auto",children:"Create a new match to get started or try adjusting your filters."})]}):null,(ee.length||0)!==0&&e.jsxs("div",{className:"relative",children:[I&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out",children:e.jsx("button",{onClick:()=>X(!1),className:"w-full text-center",children:"FOCUS MODE ‚Äî Click to exit"})})}),e.jsx("div",{ref:$,className:`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 max-h-[28rem] overflow-auto p-1 ${I?"opacity-90":""}`,"data-testid":"matches-grid",children:lt.map(t=>e.jsxs("div",{className:"group relative p-2.5 rounded-lg border ndn-lobby-card hover:border-indigo-500/50 transition-all duration-150 shadow-sm hover:shadow-[0_4px_16px_-8px_rgba(99,102,241,0.4)] flex flex-col gap-1.5","data-testid":`match-${t.id}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!I&&e.jsx("div",{className:"w-7 h-7 shrink-0 rounded-full flex items-center justify-center border group-hover:border-opacity-60 transition-colors text-xs",style:{backgroundColor:`${B(t.game).color}15`,borderColor:`${B(t.game).color}30`},children:B(t.game).emoji}),e.jsx("div",{className:"text-sm font-bold group-hover:text-indigo-300 transition-colors truncate",style:{color:B(t.game).color},children:t.game}),e.jsxs("div",{className:"text-[10px] text-white/40 flex items-center gap-0.5 shrink-0 ml-auto",children:[e.jsx(Je,{className:"w-2.5 h-2.5"}),new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-white/70",children:[e.jsx("span",{className:"px-1 py-px rounded-sm bg-white/5 text-[10px] font-medium border border-slate-800",children:t.modeType==="bestof"?"BO":"FT"}),e.jsx("span",{className:"font-mono text-indigo-300 text-xs",children:t.legs}),e.jsx("span",{className:"text-[10px]",children:"legs"}),t.startingScore&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-0.5 h-0.5 rounded-full bg-white/20"}),e.jsx("span",{className:"font-mono text-amber-300 text-xs",children:t.startingScore})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-white/5",children:[e.jsx("div",{className:"flex items-center gap-1.5 min-w-0",children:!I&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 shrink-0 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[8px] font-bold text-white",children:(t.createdBy||t.creatorName||"U").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-[10px] text-white/50 truncate max-w-[90px]",children:t.createdBy||t.creatorName})]})}),e.jsx("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-3 py-0.5 text-xs rounded-none",onClick:()=>Ge(t),children:"Join"})]})]},t.id))})]}),te>1&&e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5",children:[e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:U===1,onClick:()=>Ne(t=>Math.max(1,t-1)),children:[e.jsx(Qe,{className:"w-4 h-4 rotate-90"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,te)},(t,s)=>{let r=s+1;return te>5&&(U>3&&(r=U-2+s),r>te&&(r=te-4+s)),e.jsx("button",{className:`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${U===r?"bg-indigo-600 text-white shadow-sm":"bg-slate-950 text-white/70 hover:bg-slate-900"}`,onClick:()=>Ne(r),children:r},r)})}),e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:U===te,onClick:()=>Ne(t=>Math.min(te,t+1)),children:["Next",e.jsx(Qe,{className:"w-4 h-4 -rotate-90"})]})]})]})})]})]})}),e.jsx("div",{className:"ndn-page-tabs flex items-center justify-center gap-2 py-3 mt-auto",children:h.map((t,s)=>e.jsx("button",{className:`px-3 py-1.5 rounded-lg text-sm font-semibold transition-all ${s===x?"bg-white/20 text-white border border-white/30":"text-white/60 hover:text-white hover:bg-white/10"}`,onClick:()=>w(s),children:t.id},t.id))}),e.jsx($t,{open:n,onClose:()=>m(!1),onCreate:t=>{ct(t),m(!1)}})]}),S&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-md mx-4 p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-indigo-500/30 shadow-2xl shadow-indigo-500/20",children:[e.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 ring-2 ring-indigo-500/30",children:e.jsx(Re,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-white",children:"Match Invite!"}),e.jsx("p",{className:"text-sm text-white/60",children:"Someone wants to play"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold text-sm",children:(S.fromName||"?").substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-lg",children:S.fromName||"Opponent"}),e.jsx("div",{className:"text-xs text-white/50",children:"wants to join your match"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-sm text-white/70",children:[e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-medium",children:S.game||"X01"}),e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10",children:[S.mode==="bestof"?"Best Of":"First To"," ",S.value||1]}),e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-mono text-amber-300",children:S.startingScore||501})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{i?.connected&&S?.id&&i.send({type:"invite-accept",matchId:S.id})}catch{}P(null)},children:"‚úÖ Accept"}),e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-white/5 hover:bg-rose-600/80 text-white/80 hover:text-white font-bold text-lg border border-white/10 hover:border-rose-500/50 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{i?.connected&&S?.id&&i.send({type:"invite-decline",matchId:S.id})}catch{}P(null)},children:"‚ùå Decline"})]})]})]})}),de&&!l&&e.jsx("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-sm mx-4 p-6 rounded-2xl bg-slate-900 border border-slate-700/50 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-indigo-500/10 flex items-center justify-center",children:e.jsx(Je,{className:"w-8 h-8 text-indigo-400 animate-pulse"})}),e.jsxs("h3",{className:"text-xl font-bold text-white mb-2",children:["Waiting for ",de]}),e.jsx("p",{className:"text-sm text-white/50 mb-5",children:"The match creator needs to accept your request‚Ä¶"}),e.jsx("button",{className:"px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 transition-all text-sm font-medium",onClick:()=>k(null),children:"Cancel"})]})}),e.jsx(Gt,{open:!!l,matchInfo:l,localUser:o,opponentName:(()=>{if(!l)return"Opponent";const t=(o?.username||"").toLowerCase(),s=l.createdBy||l.creatorName||"";return l._isCreatorView||s.toLowerCase()===t?l.joinerName||(l.joinerId?R[l.joinerId]||l.joinerId:"Opponent"):s||(l.creatorId?R[l.creatorId]||l.creatorId:"Opponent")})(),countdown:15,onChoice:mt,onBullThrow:t=>{try{i?.connected&&l?.id&&i.send({type:"prestart-bull-throw",roomId:l.id,score:t})}catch{}Ae(t),we(!0)},onAccept:ut,onCancel:()=>{try{i?.connected&&l?.id&&l._isCreatorView&&i.send({type:"invite-decline",matchId:l.id})}catch{}C(null)},remoteChoice:Object.values(Ee)[0]||null,bullActive:ne,bullWinner:Ue,bullTied:Ze}),e.jsx(Dt,{open:q,onClose:()=>u(!1),title:"Match Summary",players:G})]})}export{Yt as default};
//# sourceMappingURL=OnlinePlay.clean-Bt3pIMup.js.map

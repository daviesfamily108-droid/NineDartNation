import{D as Ue,u as xe,r as dt,j as e,E as yt,x as mt,b as kt,F as St,H as Ct,I as Mt,g as Et,J as Lt,i as W,k as le,K as Tt,n as Qe,l as st,M as xt,L as Rt,C as Pt,N as It,G as at,P as _t,m as rt,o as Ot,A as Bt}from"./index-0oBsAK_j.js";import{r as a,X as Dt,p as Oe,I as At,J as $t,Z as Ke,C as Ze,o as Ft,R as we,T as Wt,K as Ut,U as nt,v as lt,h as it}from"./ui-Cl5S-Tv0.js";import{a as Vt,P as Gt}from"./PauseOverlay-DQ7Onp0Y.js";import{o as zt,l as qt}from"./matchWindow-C1qHGGn_.js";import"./vendor-D3F3s8fL.js";function Yt({open:m,onClose:d,onCreate:h}){const[u]=a.useState(()=>document.createElement("div")),[p,w]=a.useState("X01"),[i,F]=a.useState("bestof"),[U,g]=a.useState(3),N=a.useRef(null),[c,v]=a.useState(0),[R,V]=a.useState(()=>Ue(p)?.[0]),E=xe().username||"Anonymous";a.useLayoutEffect(()=>(u.className="ndn-create-match-portal",document.body.appendChild(u),()=>{try{u&&u.remove()}catch{}}),[u]),a.useLayoutEffect(()=>{function o(y){y.key==="Escape"&&d()}return m&&document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[m,d]);const x=()=>{h({createdBy:E,game:p,modeType:i,legs:U,avgChoice:c,startingScore:R}),d()};return!m||!u?null:dt.createPortal(e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-2 sm:p-6",children:[e.jsx("button",{"aria-label":"Close dialog",className:"absolute inset-0 w-full h-full bg-transparent",onClick:d}),e.jsxs("div",{className:"rounded-2xl p-5 sm:p-6 max-w-lg w-full relative text-white shadow-2xl border border-indigo-500/30 max-h-[85vh] overflow-y-auto",style:{background:"var(--ndn-card-bg, #0f172a)"},role:"dialog",children:[e.jsx("button",{"aria-label":"Close",className:"absolute top-3 right-3 w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors",onClick:d,children:"‚úï"}),e.jsx("h2",{className:"text-base sm:text-lg font-bold tracking-tight mb-3",children:"üéØ Create Match"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Created By"}),e.jsx("div",{className:"p-2 rounded-lg border border-indigo-500/20 bg-indigo-500/10 text-sm text-white",children:E})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-game",children:"Game"}),e.jsx("select",{id:"match-game",className:"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white",value:p,onChange:o=>{const y=o.target.value;w(y);const D=Ue(y);V(D?.[0])},onPointerDown:o=>{o.stopPropagation()},onMouseDown:o=>{o.stopPropagation()},onTouchStart:o=>{o.stopPropagation?.()},children:yt.map(o=>e.jsx("option",{value:o,className:"bg-slate-900 text-white",children:o},o))})]}),Ue(p).length>0?e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-start",children:`${p} Starting Score`}),e.jsx("select",{id:"match-start",className:"p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white w-full",value:R,onChange:o=>V(Number(o.target.value)),onPointerDown:o=>{o.stopPropagation()},onMouseDown:o=>{o.stopPropagation()},onTouchStart:o=>{o.stopPropagation?.()},children:Ue(p).map(o=>e.jsx("option",{value:o,className:"bg-slate-900 text-white",children:o},o))})]}):null,e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Mode"}),e.jsxs("div",{className:"flex gap-2 mt-1 justify-center",children:[e.jsxs("label",{className:`btn ${i==="bestof"?"btn-primary":"btn-ghost"}`,children:[e.jsx("input",{type:"radio",name:"mode",value:"bestof",checked:i==="bestof",onChange:()=>{F("bestof"),g(o=>{const y=Math.max(1,o||3);return y%2===1?y:y+1}),setTimeout(()=>N.current?.focus(),0)},className:"sr-only"})," ","Best Of"]}),e.jsxs("label",{className:`btn ${i==="firstto"?"btn-primary":"btn-ghost"}`,children:[e.jsx("input",{type:"radio",name:"mode",value:"firstto",checked:i==="firstto",onChange:()=>{F("firstto"),g(o=>Math.max(1,o||3)),setTimeout(()=>N.current?.focus(),0)},className:"sr-only"})," ","First To"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-legs",children:i==="bestof"?"Best Of":"First To"}),e.jsx("input",{id:"match-legs",type:"number",min:1,value:U,onChange:o=>g(Math.max(1,Number(o.target.value||1))),ref:N,className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-avg",children:"Average Choice (¬±)"}),e.jsx("input",{id:"match-avg",type:"number",value:c,onChange:o=>v(Number(o.target.value||0)),className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-3 border-t border-indigo-500/20",children:[e.jsx("button",{className:"flex-1 btn btn-ghost text-xs",onClick:d,children:"Cancel"}),e.jsx("button",{className:"flex-1 btn text-xs",onClick:x,children:"Create Match"})]})]})]}),u)}const ve=400,I=ve/2,_=ve/2,Qt=6.35,Me=15.9,Xe=99,Je=107,He=162,Ge=170,X=(ve/2-15)/Ge,ht=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5],ut={};ht.forEach((m,d)=>{ut[m]=d%2===0?{dark:"#1a1a2e",light:"#c0392b"}:{dark:"#f0e6d3",light:"#27ae60"}});function ot(m){try{const d=kt(m).toFixed(1),h=St(m).toFixed(1),u=Ct(m),p=Mt(m),w=Et(m),i=Lt(m);return{avg3:d,best9:h,bestCheckout:u||"‚Äì",bestLeg:p||"‚Äì",lifetimeScored:w.scored||0,lifetimeDarts:w.darts||0,career180s:i||0}}catch{return{avg3:"0.0",best9:"0.0",bestCheckout:"‚Äì",bestLeg:"‚Äì",lifetimeScored:0,lifetimeDarts:0,career180s:0}}}function _e(m,d,h,u){const p=(u-90)*Math.PI/180;return{x:m+h*Math.cos(p),y:d+h*Math.sin(p)}}function Xt(m,d){const h=m-I,u=d-_;return Math.sqrt(h*h+u*u)/X}function Ve({label:m,value:d,highlight:h}){return e.jsxs("div",{className:`flex flex-col items-center px-2 py-1.5 rounded-xl ${h?"bg-indigo-500/20 ring-1 ring-indigo-500/30":"bg-white/5"}`,children:[e.jsx("span",{className:"text-[8px] uppercase tracking-wider font-bold text-white/50",children:m}),e.jsx("span",{className:`text-sm font-black ${h?"text-indigo-300":"text-white"}`,children:d})]})}function Jt({onSelect:m,selectedPoint:d,disabled:h,label:u}){const p=a.useRef(null),w=a.useCallback((g,N)=>{const c=p.current;if(!c)return null;const v=c.getBoundingClientRect(),R=(g-v.left)/v.width*ve,V=(N-v.top)/v.height*ve,E=Xt(R,V);return{x:R,y:V,dist:Math.round(E*10)/10}},[]),i=a.useCallback(g=>{if(h)return;const N=w(g.clientX,g.clientY);N&&m(N.x,N.y,N.dist)},[m,h,w]),F=a.useCallback(g=>{if(h)return;g.preventDefault();const N=g.changedTouches[0];if(!N)return;const c=w(N.clientX,N.clientY);c&&m(c.x,c.y,c.dist)},[m,h,w]),U=a.useMemo(()=>{const g=[];for(let c=0;c<20;c++){const v=ht[c],R=c*18-18/2,V=R+18,E=ut[v];[{inner:Je,outer:He,fill:E.dark},{inner:He,outer:Ge,fill:E.light},{inner:Me,outer:Xe,fill:E.dark},{inner:Xe,outer:Je,fill:E.light}].forEach((y,D)=>{const l=y.inner*X,f=y.outer*X,$=_e(I,_,l,R),j=_e(I,_,f,R),L=_e(I,_,f,V),C=_e(I,_,l,V),O=0,G=[`M ${$.x} ${$.y}`,`L ${j.x} ${j.y}`,`A ${f} ${f} 0 ${O} 1 ${L.x} ${L.y}`,`L ${C.x} ${C.y}`,`A ${l} ${l} 0 ${O} 0 ${$.x} ${$.y}`,"Z"].join(" ");g.push(e.jsx("path",{d:G,fill:y.fill,stroke:"rgba(255,255,255,0.08)",strokeWidth:.5,opacity:.85},`s${v}-r${D}`))});const o=_e(I,_,(Ge+12)*X,c*18);g.push(e.jsx("text",{x:o.x,y:o.y,textAnchor:"middle",dominantBaseline:"central",fill:"rgba(255,255,255,0.8)",fontSize:"11",fontWeight:"bold",fontFamily:"system-ui, sans-serif",children:v},`label-${v}`))}return g},[]);return e.jsxs("div",{className:"relative",children:[u&&e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-white/50",children:u})}),e.jsxs("svg",{ref:p,viewBox:`0 0 ${ve} ${ve}`,className:`w-full h-full touch-none ${h?"opacity-50 pointer-events-none":"cursor-crosshair"}`,onClick:i,onTouchEnd:F,children:[e.jsx("circle",{cx:I,cy:_,r:I,fill:"#0a0a1a"}),U,e.jsx("circle",{cx:I,cy:_,r:Xe*X,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:I,cy:_,r:Je*X,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:I,cy:_,r:He*X,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:I,cy:_,r:Ge*X,fill:"none",stroke:"rgba(192,192,192,0.2)",strokeWidth:1}),e.jsx("circle",{cx:I,cy:_,r:Me*X,fill:"#27ae60",stroke:"rgba(192,192,192,0.2)",strokeWidth:.8}),e.jsx("circle",{cx:I,cy:_,r:Qt*X,fill:"#c0392b",stroke:"rgba(192,192,192,0.2)",strokeWidth:.8}),!d&&!h&&e.jsxs("circle",{cx:I,cy:_,r:Me*X*1.8,fill:"none",stroke:"rgba(234,179,8,0.4)",strokeWidth:1.5,strokeDasharray:"4,4",children:[e.jsx("animate",{attributeName:"r",values:`${Me*X*1.5};${Me*X*2.2};${Me*X*1.5}`,dur:"2s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",values:"0.5;0.15;0.5",dur:"2s",repeatCount:"indefinite"})]}),e.jsx("line",{x1:I-6,y1:_,x2:I+6,y2:_,stroke:"rgba(255,255,255,0.25)",strokeWidth:.5}),e.jsx("line",{x1:I,y1:_-6,x2:I,y2:_+6,stroke:"rgba(255,255,255,0.25)",strokeWidth:.5}),d&&e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:I,y1:_,x2:d.x,y2:d.y,stroke:"rgba(234,179,8,0.5)",strokeWidth:1,strokeDasharray:"3,3"}),e.jsx("circle",{cx:d.x+1,cy:d.y+1,r:6,fill:"rgba(0,0,0,0.4)"}),e.jsx("circle",{cx:d.x,cy:d.y,r:6,fill:"#eab308",stroke:"#fff",strokeWidth:2,className:"drop-shadow-lg"}),e.jsx("circle",{cx:d.x,cy:d.y,r:2.5,fill:"#fff"})]})]})]})}function ct({name:m,stats:d,isLocal:h,showCamera:u,isWinner:p,legDiff:w}){const i=typeof w=="number"?`${w>0?"+":""}${w}`:null;return e.jsxs("div",{className:`relative rounded-2xl border p-4 transition-all duration-500 ${p?"border-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/5 shadow-xl shadow-amber-500/10 ring-1 ring-amber-400/30":"border-white/10 bg-white/5"}`,children:[p&&e.jsxs("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 px-3 py-1 bg-amber-500 text-black text-[10px] font-black uppercase tracking-widest rounded-full shadow-lg",children:[e.jsx(Ft,{className:"w-3 h-3 inline mr-1"}),"Throws First"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-black ${h?"bg-gradient-to-br from-indigo-500 to-purple-600 text-white":"bg-gradient-to-br from-rose-500 to-orange-500 text-white"}`,children:m.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-lg tracking-tight",children:m}),e.jsx("div",{className:"text-[10px] text-white/50 font-semibold uppercase tracking-wider",children:h?"You":"Opponent"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1.5 mb-3",children:[e.jsx(Ve,{label:"Avg",value:d.avg3,highlight:!0}),e.jsx(Ve,{label:"F9",value:d.best9}),e.jsx(Ve,{label:"CO",value:String(d.bestCheckout)}),e.jsx(Ve,{label:i!==null?"Leg Œî":"Leg",value:i??String(d.bestLeg)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1.5 text-[10px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"180s"}),e.jsx("span",{className:"font-bold text-white",children:d.career180s})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Scored"}),e.jsx("span",{className:"font-bold text-white",children:d.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Darts"}),e.jsx("span",{className:"font-bold text-white",children:d.lifetimeDarts.toLocaleString()})]})]}),u&&e.jsxs("div",{className:"mt-3 rounded-xl overflow-hidden border border-white/10 bg-black/40",children:[e.jsxs("div",{className:"px-3 py-1.5 flex items-center gap-2 text-[10px] text-white/60 border-b border-white/5",children:[e.jsx(Ze,{className:"w-3 h-3"}),e.jsx("span",{className:"font-semibold uppercase tracking-wider",children:h?"Your Camera":"Opponent Camera"}),e.jsx("span",{className:"ml-auto text-emerald-400 font-bold",children:"‚óè Live"})]}),e.jsx("div",{className:"aspect-video relative bg-black",children:h?e.jsx(mt,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",tileFitModeOverride:"fit",scale:1}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/30 text-xs",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),"Waiting for opponent's feed‚Ä¶"]})})})]})]})}function Ht({open:m,matchInfo:d,localUser:h,opponentName:u,opponentStats:p,countdown:w=15,onChoice:i,onBullThrow:F,onAccept:U,onCancel:g,remoteChoice:N,bullActive:c,bullWinner:v,bullTied:R}){const[V,E]=a.useState(w),[x,o]=a.useState("preview"),[y,D]=a.useState(null),[l,f]=a.useState(null),[$,j]=a.useState(null),[L,C]=a.useState(!1),O=a.useRef(typeof document<"u"?document.createElement("div"):null),G=a.useMemo(()=>ot(h?.username||""),[h?.username]),Z=a.useMemo(()=>p?{avg3:p.avg3||"0.0",best9:p.best9||"0.0",bestCheckout:p.bestCheckout||"‚Äì",bestLeg:p.bestLeg||"‚Äì",career180s:p.career180s||0,lifetimeScored:0,lifetimeDarts:0}:ot(u),[u,p]);a.useEffect(()=>{const k=O.current;if(!(!k||typeof document>"u"))return k.className="ndn-match-prestart-portal",document.body.appendChild(k),()=>{try{k.parentNode?.removeChild(k)}catch{}}},[]),a.useEffect(()=>{m&&(E(w),o("preview"),D(null),f(null),j(null),C(!1))},[m,w]),a.useEffect(()=>{if(!m||x==="result"||x==="go")return;const k=window.setInterval(()=>{E(se=>{const ne=se-1;return ne<=0?(window.clearInterval(k),x==="preview"?(o("choice"),w):(x==="choice"&&!y&&(D("skip"),i("skip")),0)):(x==="preview"&&w-ne>=5&&o("choice"),ne)})},1e3);return()=>window.clearInterval(k)},[m,x,w,y,i]),a.useEffect(()=>{c&&(o("bull"),f(null),j(null),C(!1))},[c]),a.useEffect(()=>{if(v){o("result");const k=setTimeout(()=>o("go"),3e3);return()=>clearTimeout(k)}},[v]),a.useEffect(()=>{R&&(f(null),j(null),C(!1),o("bull"))},[R]),a.useEffect(()=>{if(y==="skip"&&N==="skip"){o("result");const k=setTimeout(()=>o("go"),2e3);return()=>clearTimeout(k)}},[y,N]),a.useEffect(()=>{if(x!=="go")return;const k=setTimeout(()=>{U()},1500);return()=>clearTimeout(k)},[x,U]);const ie=a.useCallback((k,se,ne)=>{f({x:k,y:se}),j(ne)},[]),z=a.useCallback(()=>{$!=null&&(C(!0),F($))},[$,F]),P=a.useCallback(k=>{D(k),i(k)},[i]),J=h?.username||"You",q=a.useMemo(()=>getHeadToHeadLegDiff(J,u),[J,u]),de=q.played?q.diffA:null,he=q.played?q.diffB:null;if(!m||!O.current||!d)return null;const Ee=v===J,ee=v===u,ue=y==="skip"&&N==="skip",te=e.jsxs("div",{className:"fixed inset-0 z-[9998] overflow-y-auto bg-black/95 backdrop-blur-xl",role:"dialog","aria-modal":"true","aria-label":"Match pre-start",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent"})]}),e.jsx("div",{className:"min-h-full flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-5xl",children:[e.jsx("button",{className:"absolute -top-2 -right-2 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition-all border border-white/10",onClick:g,"aria-label":"Cancel match",children:e.jsx(Dt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/5 border border-white/10 text-[11px] font-bold uppercase tracking-widest text-white/60 mb-3",children:[e.jsx(Oe,{className:"w-3.5 h-3.5"}),d.game," ¬∑"," ",d.modeType==="bestof"?"Best Of":"First To"," ",d.legs," ¬∑ ",d.startingScore||501]}),x==="preview"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-4xl sm:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tighter",children:"Match Found"}),e.jsx("p",{className:"text-sm text-white/50 mt-1",children:"Reviewing opponent stats‚Ä¶"})]}),x==="choice"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-black text-white tracking-tighter",children:"Who Throws First?"}),e.jsx("p",{className:"text-sm text-white/50 mt-1",children:"Bull up to decide, or skip and let the creator go first"})]}),x==="bull"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-black text-amber-300 tracking-tighter",children:"üéØ Bull Up!"}),e.jsx("p",{className:"text-sm text-white/50 mt-1",children:"Throw your dart at the bullseye, then tap where it landed on the board"}),e.jsx("p",{className:"text-[10px] text-white/30 mt-0.5",children:"Both players mark their throw ‚Äî closest to the bull throws first"})]}),x==="result"&&e.jsx("div",{className:"animate-in fade-in zoom-in-95 duration-700",children:v?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-4xl sm:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-amber-500 tracking-tighter",children:["üéâ ",v," Wins the Bull!"]}),e.jsxs("p",{className:"text-sm text-white/50 mt-2",children:[v," throws first"]})]}):ue?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-4xl font-black text-white tracking-tighter",children:"Both Players Skipped"}),e.jsxs("p",{className:"text-sm text-white/50 mt-1",children:[d.createdBy||d.creatorName||J," ","throws first"]})]}):null}),x==="go"&&e.jsx("div",{className:"animate-in fade-in zoom-in-50 duration-300",children:e.jsx("h2",{className:"text-7xl sm:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500 tracking-tighter",children:"GO!"})})]}),x!=="result"&&x!=="go"&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(At,{className:"w-4 h-4 text-white/40"}),e.jsx("span",{className:"text-2xl font-black text-white tabular-nums",children:V}),e.jsx("span",{className:"text-xs text-white/40 font-semibold",children:"seconds"})]}),e.jsx("div",{className:"h-1 bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000 ease-linear",style:{width:`${V/w*100}%`}})})]}),(x==="preview"||x==="choice"||x==="result")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-4 items-start mb-6",children:[e.jsx(ct,{name:J,stats:G,isLocal:!0,showCamera:x==="preview",legDiff:de,isWinner:x==="result"&&(Ee||ue&&(d.createdBy===J||d.creatorName===J))}),e.jsxs("div",{className:"hidden md:flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-indigo-500/30 ring-2 ring-white/10",children:"VS"}),e.jsx("div",{className:"w-px h-12 bg-gradient-to-b from-indigo-500/30 to-transparent mt-2"})]}),e.jsx("div",{className:"flex md:hidden items-center justify-center py-2",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-xl shadow-indigo-500/30",children:"VS"})}),e.jsx(ct,{name:u,stats:Z,isLocal:!1,showCamera:x==="preview",legDiff:he,isWinner:x==="result"&&(ee||ue&&(d.createdBy===u||d.creatorName===u))})]}),x==="choice"&&!y&&e.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{className:"group relative px-8 py-4 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 text-white font-black text-lg hover:shadow-xl hover:shadow-amber-500/30 hover:scale-105 transition-all duration-200 border border-amber-400/30",onClick:()=>P("bull"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"w-6 h-6"}),e.jsx("span",{children:"Bull Up"})]}),e.jsx("div",{className:"text-[10px] mt-1 font-medium opacity-80",children:"Throw at the bullseye to decide"})]}),e.jsxs("button",{className:"group relative px-8 py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-bold text-lg hover:bg-white/10 hover:border-white/20 hover:scale-105 transition-all duration-200",onClick:()=>P("skip"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($t,{className:"w-6 h-6"}),e.jsx("span",{children:"Skip"})]}),e.jsx("div",{className:"text-[10px] mt-1 font-medium opacity-50",children:"Creator throws first"})]})]})}),x==="choice"&&y&&!c&&e.jsx("div",{className:"text-center animate-in fade-in duration-300",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-white/70",children:[e.jsx(Ke,{className:"w-4 h-4 text-amber-400"}),"You chose"," ",e.jsx("span",{className:"font-bold text-white",children:y==="bull"?"Bull Up":"Skip"}),N?e.jsxs(e.Fragment,{children:[" ","¬∑ Opponent chose"," ",e.jsx("span",{className:"font-bold text-white",children:N==="bull"?"Bull Up":"Skip"})]}):e.jsxs(e.Fragment,{children:[" ","¬∑ Waiting for opponent",e.jsx("span",{className:"animate-pulse",children:"‚Ä¶"})]})]})}),x==="bull"&&e.jsxs("div",{className:"flex flex-col items-center gap-5 animate-in fade-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"w-full max-w-sm sm:max-w-md mx-auto rounded-2xl border border-white/10 bg-black/60 overflow-hidden shadow-xl shadow-black/40",children:e.jsxs("div",{className:"relative aspect-video",children:[e.jsx(mt,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",className:"w-full h-full"}),e.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-black/60 backdrop-blur-sm border border-white/10",children:[e.jsx(Ze,{className:"w-3 h-3 text-emerald-400"}),e.jsx("span",{className:"text-[10px] font-bold text-white/80 uppercase tracking-wider",children:"Live"})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/50",children:[e.jsx(Oe,{className:"w-3.5 h-3.5 text-amber-400"}),e.jsx("span",{children:"See your dart above, then tap the board below where it landed"})]}),e.jsx("div",{className:"w-full max-w-sm sm:max-w-md mx-auto rounded-2xl border border-white/10 bg-black/40 p-3 sm:p-4 shadow-2xl shadow-black/50",children:e.jsx(Jt,{onSelect:ie,selectedPoint:l,disabled:L,label:"Tap where your dart landed"})}),$!=null&&e.jsx("div",{className:"text-center animate-in fade-in slide-in-from-bottom-2 duration-300",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-5 py-2.5 rounded-2xl bg-white/5 border border-white/10",children:[e.jsx(Oe,{className:"w-5 h-5 text-amber-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-3xl font-black text-white tabular-nums",children:$.toFixed(1)}),e.jsx("span",{className:"text-base text-white/50 ml-1",children:"mm"})]}),e.jsx("span",{className:"text-xs text-white/40",children:"from bull"})]})}),L?e.jsxs("div",{className:"flex items-center gap-2 px-5 py-3 rounded-2xl bg-white/5 border border-white/10 text-sm text-white/70",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-amber-400/30 border-t-amber-400 rounded-full animate-spin"}),"Waiting for opponent's throw‚Ä¶"]}):e.jsx("button",{className:"px-10 py-4 rounded-2xl bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-black text-lg hover:shadow-xl hover:shadow-emerald-500/30 hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:pointer-events-none border border-emerald-400/30",disabled:$==null,onClick:z,children:"‚úÖ Confirm Dart Position"}),R&&e.jsx("div",{className:"text-sm text-amber-300 font-bold animate-bounce px-4 py-2 rounded-xl bg-amber-500/10 border border-amber-500/20",children:"üîÑ It's a tie! Throw again."})]}),x==="preview"&&e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4",children:[e.jsx("button",{className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold hover:shadow-xl hover:shadow-indigo-500/30 hover:scale-105 transition-all",onClick:()=>o("choice"),children:"Ready ‚Äî Continue"}),e.jsx("button",{className:"px-6 py-3 rounded-2xl bg-white/5 border border-white/10 text-white/70 font-semibold hover:bg-white/10 transition-all",onClick:g,children:"Cancel"})]})]})})]});return dt.createPortal(te,O.current)}function Kt({user:m,showStartShowcase:d,onShowStartShowcaseChange:h,onCommitVisit:u,onQuit:p,onPause:w,onResume:i,onStateChange:F,localPlayerIndexOverride:U,gameModeOverride:g,isOnline:N}){const c=W();xe(r=>r.hideInGameSidebar??!0),le(r=>r.setPaused),le(),Tt();const[v,R]=a.useState(null),[V]=a.useState(null),E=xe(r=>r.lastOffline?.x01Start||501),x=xe(r=>r.user),o=Qe(m,"")||Qe(x,"")||m?.email?.split("@")[0]||x?.email?.split("@")[0]||"You",y=typeof U=="number"&&U>=0?U:(c.players||[]).findIndex(r=>r?.name&&r.name===o),D=y>=0?y:0,l=(c.currentPlayerIdx??0)===D,f=c.players?.[D],$=f?.legs?.[f.legs.length-1],j=$?.totalScoreRemaining??c.startingScore??E,L=(c.players||[]).findIndex((r,b)=>b!==D),C=(c.players||[])[L>=0?L:0],O=C?.legs?.[C.legs.length-1],G=O?.totalScoreRemaining??c.startingScore??E,Z=a.useMemo(()=>{const r=b=>{if(!b)return{lastVisit:0,avg3:0};let B=0,T=0;for(const K of b.legs||[])B+=(K.totalScoreStart??0)-(K.totalScoreRemaining??0),T+=(K.visits||[]).reduce((re,Y)=>re+(Y.darts||0)-(Y.preOpenDarts||0),0);const M=(b.legs?.[b.legs.length-1]?.visits||[]).slice(-1)[0];return{lastVisit:M?.score??M?.visitTotal??0,avg3:T>0?B/T*3:0}};return{local:r(f),away:r(C)}},[f,C,$?.visits?.length,O?.visits?.length]),ie=l?j:G,z=g||c?.game||"X01",P=z==="X01",J=Vt(z,c),q=a.useMemo(()=>{const r=(b,B)=>{const T=J[B];if(P){const M=b?.legs?.[b.legs.length-1];return{primary:String(M?.totalScoreRemaining??c.startingScore??E),primaryLabel:"Remaining"}}if(z==="Cricket"||z==="American Cricket")return{primary:String(T?.points??0),primaryLabel:"Points"};if(z==="Killer"){const M=T?.lives??0;return{primary:T?.eliminated?"OUT":String(M),primaryLabel:T?.eliminated?"Eliminated":"Lives"}}return{primary:String(T?.score??T?.points??0),primaryLabel:"Score"}};return{local:r(f,D),away:r(C,L>=0?L:0)}},[P,z,J,f,C,D,L,c.startingScore,E]),de=xe(r=>r.callerEnabled),he=xe(r=>r.callerVoice),Ee=xe(r=>r.callerVolume),ee=xe(r=>r.speakCheckoutOnly),[ue,te]=a.useState(!1),k=le(r=>r.setPaused),se=le(r=>r.paused),ne=le(r=>r.pauseEndsAt);le(r=>r.pauseInitiator);const[et,ze]=a.useState(Date.now());a.useEffect(()=>(document.documentElement.setAttribute("data-ndn-ingame","true"),()=>{document.documentElement.removeAttribute("data-ndn-ingame")}),[]),a.useEffect(()=>{if(!se||!ne)return;const r=setInterval(()=>{const b=Date.now();ze(b),b>=ne&&k(!1,null)},250);return()=>clearInterval(r)},[se,ne,k]);const be=a.useMemo(()=>{if(!P||j>170||j<=0)return null;const r=st(j);return r&&r.length>0?r:null},[P,j]),qe=a.useMemo(()=>{if(!P||ie>170||ie<=0)return null;const r=st(ie);return r&&r.length>0?r:null},[P,ie]),je=P?180:999,Be=a.useMemo(()=>(c.players||[]).map(b=>({name:b.name||"Player",legsWon:b.legsWon||0})),[c.players]),fe=typeof d=="boolean"?d:!0,Le=r=>{h?.(r)},me=a.useRef(!0);a.useEffect(()=>{me.current&&Le(!0)},[]);const[De,ae]=a.useState(!1),[H,oe]=a.useState(""),ce=(r,b,B)=>{if(u){u(r,b,B);return}const T=c.players?.[c.currentPlayerIdx],M=T?.legs?.[T.legs.length-1],K=M?M.totalScoreRemaining:c.startingScore,re=typeof r=="number"?r:0;let Y=K-re;if((!Number.isFinite(Y)||Y<0)&&(Y=0),de){const Ne=T?.name||Qe(m,"Player");try{Ot(Ne,re,Y,he,{volume:Ee,checkoutOnly:ee})}catch{}}c.addVisit(re,b,B??{visitTotal:re}),Y===0?c.endLeg(re):c.nextPlayer(),F?.()},Ae=a.useCallback(()=>{try{const r=[];if((c.players||[]).forEach(T=>{(T.legs||[]).forEach(M=>{if(M?.finished){const K=(M.visits||[]).slice(-1)[0];r.push({ts:M.endTime||Date.now(),visit:K,player:T})}})}),!r.length)return null;const b=r.sort((T,M)=>M.ts-T.ts)[0],B=(b.visit?.entries||[]).slice(-1)[0];if(B?.label)return B.label;if(B?.ring==="DOUBLE"&&typeof B?.value=="number")return`Double ${B.value/2}`;if(typeof b.visit?.visitTotal=="number")return`Checkout ${b.visit.visitTotal}`}catch{}return null},[c.players]);return a.useEffect(()=>{if(c.inProgress){R(null);return}if(!v?.label){const r=Ae();r&&R(b=>({...b,label:r}))}},[c.inProgress,Ae,v?.label]),e.jsxs("div",{className:"card ndn-game-shell ndn-page ndn-ingame-active relative overflow-hidden md:overflow-hidden overflow-y-auto",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-32 -left-32 w-96 h-96 rounded-full bg-indigo-600/10 blur-[120px]"}),e.jsx("div",{className:"absolute -bottom-32 -right-32 w-96 h-96 rounded-full bg-amber-500/8 blur-[120px]"})]}),fe&&e.jsx(xt,{open:fe,players:c.players||[],onDone:()=>{me.current=!1,Le(!1)},onRequestClose:()=>{me.current=!1,Le(!1)},showCalibrationDefault:!0}),e.jsx("div",{className:"sticky top-0 z-20 mb-3",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-2 px-3 sm:px-5 py-2.5 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-lg",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-r from-indigo-500/10 via-transparent to-amber-500/10"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm leading-none z-10",children:[N&&e.jsx("span",{className:"px-2.5 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-[10px] sm:text-xs font-semibold tracking-wide",children:"üåê Online"}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-xs font-semibold tracking-wide",children:[z,P?` / ${c.startingScore||E}`:""]}),Be.length>=2&&e.jsxs("span",{className:"font-bold text-white/90 text-sm tabular-nums",children:["Legs: ",Be[0].legsWon," ‚Äì ",Be[1].legsWon]})]}),e.jsxs("div",{className:"flex items-center gap-2 z-10",children:[e.jsx(Rt,{}),e.jsx("button",{className:"px-4 py-1.5 rounded-xl text-sm font-semibold bg-rose-600/90 hover:bg-rose-500 text-white border border-rose-400/30 shadow-lg shadow-rose-500/20 transition-all",onClick:()=>te(!0),children:"‚è∏ Quit / Pause"})]})]})}),e.jsxs("div",{className:"relative mb-4 rounded-2xl border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-950/80 via-slate-900/90 to-amber-950/80"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(255,255,255,0.03),transparent_70%)]"}),e.jsxs("div",{className:"relative grid grid-cols-[minmax(0,1fr)_minmax(120px,auto)_minmax(0,1fr)] items-center py-4 sm:py-6 px-3 sm:px-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`text-xs sm:text-sm font-bold uppercase tracking-widest ${l?"text-emerald-400":"text-slate-400"}`,children:f?.name||"You"}),e.jsx("div",{className:"text-[10px] sm:text-xs uppercase tracking-wider text-slate-500 font-medium",children:q.local.primaryLabel}),e.jsx("div",{className:`font-mono text-5xl sm:text-7xl md:text-8xl font-black tabular-nums leading-none ${l?"text-white":"text-white/60"}`,children:q.local.primary}),l?e.jsx("div",{className:"mt-1 px-3 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/40 text-emerald-300 text-[10px] sm:text-xs font-semibold uppercase tracking-wider animate-pulse",children:"‚óè Throwing"}):e.jsx("div",{className:"mt-1 px-3 py-0.5 text-[10px] sm:text-xs invisible","aria-hidden":!0,children:"‚óè ¬†"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[P&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-400 tabular-nums",children:["Legs: ",f?.legsWon||0]}),Z.local.avg3>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-400 tabular-nums",children:["Avg: ",Z.local.avg3.toFixed(1)]}),Z.local.lastVisit>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-500 tabular-nums",children:["Last: ",Z.local.lastVisit]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 px-2 sm:px-4 min-w-[120px]",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-px h-6 sm:h-10 bg-gradient-to-b from-transparent via-white/20 to-transparent"}),e.jsx("div",{className:"text-xs sm:text-lg font-black text-white/30 tracking-widest",children:"VS"}),e.jsx("div",{className:"w-px h-6 sm:h-10 bg-gradient-to-b from-transparent via-white/20 to-transparent"})]}),N&&e.jsxs("button",{type:"button",className:`w-full rounded-xl border px-3 py-2 text-center transition-all ${l?"bg-emerald-500/15 border-emerald-400/30 text-emerald-100 hover:bg-emerald-500/25":"bg-white/5 border-white/10 text-white/40 cursor-not-allowed"}`,onClick:()=>{l&&(oe(""),ae(!0))},disabled:!l,children:[e.jsx("div",{className:"text-[9px] sm:text-[10px] uppercase tracking-widest font-semibold opacity-80",children:l?"Enter Score":"Waiting"}),e.jsx("div",{className:"font-mono text-2xl sm:text-3xl font-black tabular-nums",children:l?"Tap":"‚Äî"}),e.jsx("div",{className:"text-[9px] sm:text-[10px] uppercase tracking-wider opacity-70",children:l?"Open Numpad":"Opponent Turn"})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`text-xs sm:text-sm font-bold uppercase tracking-widest ${l?"text-slate-400":"text-amber-400"}`,children:C?.name||"Opponent"}),e.jsx("div",{className:"text-[10px] sm:text-xs uppercase tracking-wider text-slate-500 font-medium",children:q.away.primaryLabel}),e.jsx("div",{className:`font-mono text-5xl sm:text-7xl md:text-8xl font-black tabular-nums leading-none ${l?"text-white/60":"text-white"}`,children:q.away.primary}),l?e.jsx("div",{className:"mt-1 px-3 py-0.5 text-[10px] sm:text-xs invisible","aria-hidden":!0,children:"‚óè ¬†"}):e.jsx("div",{className:"mt-1 px-3 py-0.5 rounded-full bg-amber-500/20 border border-amber-400/40 text-amber-300 text-[10px] sm:text-xs font-semibold uppercase tracking-wider animate-pulse",children:"‚óè Throwing"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[P&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-400 tabular-nums",children:["Legs: ",C?.legsWon||0]}),Z.away.avg3>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-400 tabular-nums",children:["Avg: ",Z.away.avg3.toFixed(1)]}),Z.away.lastVisit>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-500 tabular-nums",children:["Last: ",Z.away.lastVisit]})]})]})]}),qe&&e.jsxs("div",{className:`relative border-t px-4 py-2 flex items-center gap-3 ${l?"border-emerald-400/20 bg-emerald-500/10":"border-amber-400/20 bg-amber-500/10"}`,children:[e.jsxs("span",{className:`text-[10px] sm:text-xs uppercase tracking-wider font-semibold whitespace-nowrap ${l?"text-emerald-300/80":"text-amber-300/80"}`,children:["Checkout ",ie,":"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:qe.map((r,b)=>e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs sm:text-sm font-medium ${l?"bg-emerald-500/20 border border-emerald-400/20 text-emerald-100":"bg-amber-500/20 border border-amber-400/20 text-amber-100"}`,children:r},b))})]})]}),e.jsxs("div",{className:"ndn-shell-body",children:[!l&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-400 shadow-lg shadow-amber-400/50 animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-white/80",children:"Opponent's Camera"})]}),e.jsxs("span",{className:"text-[10px] sm:text-xs font-medium text-amber-300",children:["Waiting for ",C?.name||"opponent","‚Ä¶"]})]}),e.jsxs("div",{className:"relative min-h-[12rem] max-h-[50vh] bg-black",children:[e.jsx(Pt,{hideInlinePanels:!0,forceAutoStart:!0}),P&&e.jsx(It,{checkoutRemaining:j,away:{side:"Away",name:C?.name||"Away",legsWon:C?.legsWon||0,remaining:G},home:{side:"Home",name:f?.name||"Home",legsWon:f?.legsWon||0,remaining:j}})]})]}),e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-3 sm:p-4 overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-br from-white/[0.02] to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm sm:text-base font-bold text-white/90 tracking-wide",children:"Scoreboard"}),e.jsxs("div",{className:"px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold bg-amber-500/20 border border-amber-400/30 text-amber-300",children:[C?.name||"Opponent","'s turn"]})]}),e.jsx(at,{gameMode:z,players:J})]})]}),l&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-3 sm:p-4 overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-br from-emerald-500/[0.03] to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm sm:text-base font-bold text-white/90 tracking-wide",children:"Scoreboard"}),e.jsx("div",{className:"px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold bg-emerald-500/20 border border-emerald-400/30 text-emerald-300 animate-pulse",children:"‚óè Your turn"})]}),e.jsx(at,{gameMode:z,players:J})]}),e.jsxs("button",{type:"button",className:"relative w-full rounded-2xl border-2 border-dashed border-emerald-400/40 bg-emerald-500/5 hover:bg-emerald-500/10 active:scale-[0.98] transition-all p-6 sm:p-8 text-center group cursor-pointer focus:outline-none focus:ring-2 focus:ring-emerald-400/50",onClick:()=>{oe(""),ae(!0)},children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-br from-emerald-500/[0.05] to-transparent"}),e.jsx("div",{className:"text-emerald-300/60 text-xs sm:text-sm uppercase tracking-widest font-semibold mb-2",children:"Enter Score"}),e.jsx("div",{className:"font-mono text-4xl sm:text-5xl font-black text-emerald-200 group-hover:text-emerald-100 transition-colors",children:q.local.primary}),e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 text-sm font-semibold",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),e.jsx("path",{d:"M8 8h.01M12 8h.01M16 8h.01M8 12h.01M12 12h.01M16 12h.01M8 16h.01M12 16h.01M16 16h.01",strokeLinecap:"round"})]}),"Tap to enter score"]}),be&&e.jsx("div",{className:"mt-3 flex flex-wrap justify-center gap-1.5",children:be.map((r,b)=>e.jsx("span",{className:"px-2 py-0.5 rounded-lg bg-emerald-500/20 border border-emerald-400/20 text-emerald-100 text-xs font-medium",children:r},b))})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:(P?[180,140,100,85,60,45,26,0]:[100,80,60,45,26,20,10,0]).map(r=>e.jsx("button",{className:"px-4 py-2.5 rounded-xl text-sm font-bold bg-white/5 hover:bg-white/10 active:bg-white/15 border border-white/10 text-white/90 transition-all active:scale-95",onClick:()=>ce(r,3,{visitTotal:r}),children:r},r))}),v?.label&&e.jsxs("div",{className:"rounded-2xl border border-emerald-400/30 bg-emerald-500/10 px-4 py-3 text-center",children:[e.jsx("span",{className:"text-xs text-emerald-400/70 uppercase tracking-wider font-semibold",children:P?"Winning Double":"Winning Shot"}),e.jsx("div",{className:"text-lg font-bold text-emerald-200 mt-0.5",children:v.label})]})]})]}),De&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",onClick:()=>ae(!1),children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full max-w-sm mx-auto mb-0 sm:mb-0 rounded-t-3xl sm:rounded-3xl border border-white/10 bg-slate-900/95 backdrop-blur-xl shadow-2xl p-4 sm:p-6 animate-[slideUp_0.2s_ease-out]",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"mb-4 rounded-2xl bg-black/40 border border-white/10 p-4 text-center",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-widest text-slate-400 mb-1",children:"Score"}),e.jsx("div",{className:"font-mono text-5xl sm:text-6xl font-black text-white tabular-nums min-h-[3.5rem] leading-none",children:H||e.jsx("span",{className:"text-white/20",children:"0"})}),H&&be&&Number(H)===j&&e.jsx("div",{className:"mt-2 text-xs text-emerald-300 font-semibold",children:"‚úì Checkout!"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[[1,2,3,4,5,6,7,8,9].map(r=>e.jsx("button",{className:"py-3.5 rounded-xl text-xl font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white transition-all active:scale-95",onClick:()=>{const b=H+String(r);Number(b)<=je&&oe(b)},children:r},r)),e.jsx("button",{className:"py-3.5 rounded-xl text-lg font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white/60 transition-all active:scale-95",onClick:()=>oe(r=>r.slice(0,-1)),children:"‚å´"}),e.jsx("button",{className:"py-3.5 rounded-xl text-xl font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white transition-all active:scale-95",onClick:()=>{const r=H+"0";Number(r)<=je&&oe(r)},children:"0"}),e.jsx("button",{className:"py-3.5 rounded-xl text-lg font-bold bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border border-emerald-400/30 text-white shadow-lg shadow-emerald-600/30 transition-all active:scale-95",onClick:()=>{const r=Math.max(0,Math.min(je,Number(H)||0));ce(r,3,{visitTotal:r}),oe(""),ae(!1)},children:"‚úì"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center mb-3",children:(P?[180,140,100,85,60,45,26,0]:[100,80,60,45,26,20,10,0]).map(r=>e.jsx("button",{className:"px-3 py-1.5 rounded-lg text-xs font-bold bg-white/5 hover:bg-white/10 border border-white/10 text-white/80 transition-all active:scale-95",onClick:()=>{ce(r,3,{visitTotal:r}),oe(""),ae(!1)},children:r},r))}),e.jsx("button",{className:"w-full py-2.5 rounded-xl text-sm font-semibold text-white/50 hover:text-white/80 hover:bg-white/5 transition-all",onClick:()=>ae(!1),children:"Cancel"})]})]}),ue&&e.jsx(_t,{onClose:()=>te(!1),onQuit:()=>{if(te(!1),p)p();else{try{c.endGame()}catch{}try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}}},onPause:()=>{try{k(!0,null,o)}catch{}try{rt({type:"pause",pauseStartedAt:Date.now(),pauseInitiator:o})}catch{}w&&w(),te(!1)}}),e.jsx(Gt,{localPlayerName:o,onResume:()=>{k(!1,null);try{rt({type:"unpause"})}catch{}i&&i()}})]})}function rs({user:m}){const d=m?.username||"You",[h,u]=a.useState(0),[p,w]=a.useState(()=>[{id:1,name:"room-1",matches:[]}]),i=(()=>{try{return Bt()}catch{return null}})(),[F,U]=a.useState([]),g=W(t=>t.inProgress),N=W(t=>t.players),[c,v]=a.useState(!1),R=a.useRef(null),V=String(m?.email||"").toLowerCase()==="daviesfamily108@gmail.com";a.useEffect(()=>{if(!c)return;function t(s){try{if(!R.current)return;R.current.contains(s.target)||v(!1)}catch{}}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[c]);const[E,x]=a.useState(!1),o=we.useRef(!1);a.useEffect(()=>{g&&(o.current||(o.current=!0,x(!0)))},[g]),a.useEffect(()=>{if(g)try{const t=W.getState();if((t?.game||"X01")!=="X01"||!t.roomId)return;const n=`ndn:matchWindowOpened:${t.roomId}`;if(window.sessionStorage.getItem(n)==="1")return;window.sessionStorage.setItem(n,"1"),zt()}catch{}},[g]),a.useEffect(()=>{g||(o.current=!1)},[g]),a.useEffect(()=>{if(i?.connected&&m?.username)try{i.send({type:"presence",username:m.username,email:m.email||""})}catch{}},[i?.connected,m]),a.useEffect(()=>(window.__ndn_online_mounted=!0,()=>{window.__ndn_online_mounted=!1}),[]),a.useEffect(()=>{const t=()=>{try{W.getState().endGame()}catch{}L(null),O(null),f(null),ee(null),ae(null),G.current=null;try{window.__ndn_pending_invite=null}catch{}};try{window.addEventListener("ndn:match-quit",t)}catch{}return()=>{try{window.removeEventListener("ndn:match-quit",t)}catch{}}},[]);const[y,D]=a.useState(!1),[l,f]=a.useState(null),$=we.useRef(null),[j,L]=a.useState(null),[C,O]=a.useState(null),G=a.useRef(null),[Z,ie]=a.useState(null),[z,P]=a.useState({}),[J,q]=a.useState(30),de=a.useRef([]);a.useEffect(()=>{de.current=F||[]},[F]),a.useEffect(()=>{l&&(G.current={...l})},[l]);const he=we.useRef(!1),[Ee,ee]=a.useState(null),[ue,te]=a.useState({}),[k,se]=a.useState(!1),[ne,et]=a.useState(null),[ze,be]=a.useState(null),[qe,je]=a.useState(null),[Be,fe]=a.useState(!1),[Le,me]=a.useState(!1),[De,ae]=a.useState(null),[H,oe]=a.useState(""),[ce,Ae]=a.useState("all"),[r,b]=a.useState("all"),[B,T]=a.useState("newest"),[M,K]=a.useState(1),re=16,Y=p[h],Ne=999,$e=we.useCallback(t=>{if(!t)return t;const s=t.modeType||t.mode||"",n=t.legs??t.value??t.bestOf??t.sets??t.games??1,S=t.createdBy||t.creatorName||t.creator||t.host||"",A=t.createdAt||t.ts||Date.now();return{...t,modeType:s,mode:s||t.mode,legs:n,value:typeof t.value=="number"?t.value:n,createdBy:S,creatorName:t.creatorName||S,createdAt:A}},[]),ye=a.useMemo(()=>(t=[])=>(t||[]).map($e).filter(s=>!(s?.isTest||s?.test||s?.migrated||s?.isMigration||s?.migration||s?.seeded||typeof s?.createdBy=="string"&&s.createdBy.toLowerCase().includes("test")||typeof s?.creatorName=="string"&&s.creatorName.toLowerCase().includes("test")||typeof s?.createdBy=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(s.createdBy)||typeof s?.creatorName=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(s.creatorName)||!(s?.game&&s?.modeType&&s?.legs))),[$e]),pe=a.useMemo(()=>{let t=ye(Y?.matches||[]);if((t?.length||0)===0&&(F?.length||0)>0&&(t=ye(F)),(t?.length||0)===0&&(de.current?.length||0)>0&&(t=ye(de.current)),H.trim()){const s=H.toLowerCase();t=t.filter(n=>(n.game||"").toLowerCase().includes(s)||(n.createdBy||n.creatorName||"").toLowerCase().includes(s)||(n.id||"").toLowerCase().includes(s))}return ce!=="all"&&(t=t.filter(s=>(s.game||"").toLowerCase()===ce)),r!=="all"&&(t=t.filter(s=>{const n=(s.modeType||"").replace("_","").toLowerCase(),S=r.replace("_","").toLowerCase();return n.includes(S)})),t=(t||[]).slice(),t.sort((s,n)=>{const S=s.createdAt||0,A=n.createdAt||0;return B==="newest"?A-S:S-A}),t.slice(0,Ne)},[Y,F,ye,H,ce,r,B,Ne]);a.useEffect(()=>{K(1)},[H,ce,r,B,h]);const ge=Math.ceil(pe.length/re),bt=pe.slice((M-1)*re,M*re),ft=()=>{pe.length>0&&tt(pe[0])},pt=t=>{const s={id:`m-${Date.now()}`,createdBy:t.createdBy||d,game:t.game,modeType:t.modeType,legs:t.legs,startingScore:t.startingScore,createdAt:Date.now()};i?.connected||w(n=>n.map((S,A)=>A===h?{...S,matches:[s,...S.matches]}:S));try{i?.connected&&(m?.username&&i.send({type:"presence",username:m.username,email:m.email||""}),i.send({type:"create-match",game:t.game,mode:t.modeType,value:t.legs,startingScore:t.startingScore,creatorAvg:t.avgChoice||0}))}catch{}},gt=()=>{U([]),w(t=>{const s=t.length+1,n=[...t,{id:s,name:`room-${s}`,matches:[]}];return u(n.length-1),n})},Te=we.useCallback(t=>{try{if(console.log("[OnlinePlay] handleInviteOrPrestart:",t?.type,t),t?.type==="invite"){const s={id:t.matchId,game:t.game,mode:t.mode||"firstto",value:t.value||1,startingScore:t.startingScore||501,fromName:t.fromName||"Opponent",fromId:t.fromId};L(s);try{const n=new Audio("/sounds/notify.mp3");n.volume=.5,n.play().catch(()=>{})}catch{}}if(t?.type==="invite-waiting"&&O(t.creatorName||"Creator"),t?.type==="match-prestart"){if(W.getState().inProgress)return;L(null),O(null);const s=$e(t.match||null);if(s&&(s.prestartEndsAt=t.prestartEndsAt),s){const S=(m?.username||"").toLowerCase(),A=(s.creatorName||s.createdBy||"").toLowerCase();S&&A===S&&(s._isCreatorView=!0)}try{s?.creatorId&&s?.creatorName&&P(S=>({...S,[s.creatorId]:s.creatorName}))}catch{}he.current=!0,f(s);const n=t.prestartEndsAt||Date.now();q(Math.max(0,Math.ceil(((n||Date.now())-Date.now())/1e3))),setTimeout(()=>{he.current=!1},0),ee(null),te({}),se(!1),et(null),be(null),me(!1)}t?.type==="invite-expired"&&(L(null),O(null),f(s=>s&&t.matchId===s.id?null:s)),t?.type==="declined"&&(L(null),O(null),f(s=>s&&t.matchId===s.id?null:s))}catch{}},[$e,m]),Re=we.useCallback(t=>{if(t?.type!=="match-start"||W.getState().inProgress)return;const s=t.match||{},n=G.current||{},S=t.roomId||n.id||"",A=s.startingScore||n.startingScore||501,Q=d,Pe=s.creatorName||n.creatorName||n.createdBy||"",ke=s.joinerName||n.joinerName||"",Se=t.firstThrowerId||t.firstPlayerId||null,Ce=n._isCreatorView||Pe.toLowerCase()===Q.toLowerCase(),Fe=Ce?ke||"Opponent":Pe||"Opponent";let Ie;if(Se){const We=s.creatorId||n.creatorId;Ie=Ce?Se===We:Se!==We}else Ie=Ce;const Nt=Ie?[Q,Fe]:[Fe,Q];try{W.getState().newMatch(Nt,A,S)}catch(We){console.error("[OnlinePlay] newMatch failed:",We)}try{i?.connected&&i.send({type:"join",roomId:S})}catch{}G.current=null,f(null),ee(null),te({})},[d,i]);a.useEffect(()=>i?(i.connected&&i.send({type:"list-matches"}),i.addListener(s=>{try{if(s?.type==="joined"&&s.id&&ie(s.id),s?.type==="presence")try{s.id&&P(n=>({...n,[s.id]:s.username||s.name||s.id}))}catch{}if(s?.type==="matches"){const n=ye(s.matches||[]);U(n),de.current=n,w(S=>S.map((A,Q)=>Q===h?{...A,matches:n}:A))}if(Te(s),s?.type==="match-start"&&Re(s),s?.type==="prestart-choice-notify"){const{roomId:n,playerId:S,choice:A}=s;if(!n||!A)return;te(Q=>({...Q||{},[S]:A}))}if(s?.type==="prestart-bull"&&(se(!0),fe(!1),je(null)),s?.type==="prestart-bull-winner"&&(be(s.winnerName||s.winnerId||null),se(!1),fe(!1),me(!1)),s?.type==="prestart-bull-tie"&&(be(null),se(!1),fe(!1),me(!0),setTimeout(()=>me(!1),2e3)),s?.type==="opponent-quit"&&ae(s.quitterName||"Opponent"),s?.type==="opponent-paused")try{le.getState().setPaused(!0,null,s.pauserName||"Opponent")}catch{}if(s?.type==="opponent-unpaused")try{le.getState().setPaused(!1,null)}catch{}}catch{}})):void 0,[i,Ee,ye,h,Te,Re]),a.useEffect(()=>{try{const s=window.__ndn_pending_invite;s&&(window.__ndn_pending_invite=null,s.type==="match-start"?Re(s):Te(s))}catch{}const t=s=>{try{const n=s.detail;if(!n)return;n.type==="match-start"?Re(n):Te(n)}catch{}};return window.addEventListener("ndn:match-invite",t),()=>window.removeEventListener("ndn:match-invite",t)},[Te,Re]),a.useEffect(()=>{if(!l||he.current||l.prestartEndsAt)return;q(30),ee(null),te({});const t=setInterval(()=>q(s=>Math.max(0,s-1)),1e3);return()=>clearInterval(t)},[l]),a.useEffect(()=>{l&&setTimeout(()=>$.current?.focus(),0)},[l]);const wt=()=>{x(!0),l&&(G.current={...l});try{if(i?.connected&&l?.id){const t=!!l._isCreatorView;i.send({type:"invite-response",matchId:l.id,accept:!0,toId:t?l.joinerId:l.creatorId})}}catch{}f(null)},tt=t=>{f(t);try{i?.connected&&(m?.username&&i.send({type:"presence",username:m.username,email:m.email||""}),i.send({type:"join-match",matchId:t.id,calibrated:!0}))}catch{}},vt=t=>{ee(t);try{i?.connected&&l?.id&&i.send({type:"prestart-choice",roomId:l.id,choice:t})}catch{}},Ye=we.useCallback(()=>{try{if(i?.connected){const t=W.getState();i.send({type:"sync",match:t})}}catch{}},[i]),jt=()=>{qt({players:[d,"Opponent"],startingScore:501,roomId:"online-demo",visits:[{score:60},{score:85},{score:100}]})};if(g){const s=(W.getState().players||[]).findIndex(n=>n?.name&&n.name.toLowerCase()===d.toLowerCase());return e.jsxs(e.Fragment,{children:[e.jsx(Kt,{user:m,showStartShowcase:E,onShowStartShowcaseChange:x,onCommitVisit:(n,S,A)=>{try{const Q=W.getState(),Pe=Q.players[Q.currentPlayerIdx],ke=Pe?.legs?.[Pe.legs.length-1],Se=ke?ke.totalScoreRemaining:Q.startingScore,Ce=Math.max(0,Se-n),Fe=Se<=50?3:Ce<=50?1:0,Ie=Ce===0;Q.addVisit(n,3,{preOpenDarts:0,doubleWindowDarts:Fe,finishedByDouble:Ie,visitTotal:n}),ke&&ke.totalScoreRemaining===0?Q.endLeg(n):Q.nextPlayer()}catch{W.getState().addVisit(n,3),W.getState().nextPlayer()}Ye()},onQuit:()=>{try{W.getState().endGame()}catch{}try{i?.connected&&i.send({type:"match-quit"})}catch{}L(null),O(null),f(null),ee(null),ae(null),G.current=null;try{window.__ndn_pending_invite=null}catch{}Ye();try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},onPause:()=>{try{le.getState().setPaused(!0,null,d)}catch{}try{i?.connected&&i.send({type:"match-pause"})}catch{}},onResume:()=>{try{le.getState().setPaused(!1,null)}catch{}try{i?.connected&&i.send({type:"match-unpause"})}catch{}},onStateChange:Ye,localPlayerIndexOverride:s>=0?s:void 0,isOnline:!0}),De&&e.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl",children:[e.jsx("div",{className:"text-4xl mb-3",children:"üö™"}),e.jsxs("h3",{className:"text-lg font-bold text-white mb-2",children:[De," left the match"]}),e.jsx("p",{className:"text-sm text-white/60 mb-5",children:"Your opponent has quit. You can leave the match now."}),e.jsx("button",{className:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all",onClick:()=>{try{W.getState().endGame()}catch{}ae(null),L(null),O(null),f(null),ee(null),G.current=null;try{window.__ndn_pending_invite=null}catch{}try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},children:"Leave Match"})]})})]})}return e.jsx("div",{className:"flex-1 min-h-0 ndn-page",style:{position:"relative",marginTop:0},children:e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col",children:[E&&e.jsx(xt,{players:N||[],user:m,onDone:()=>x(!1),onRequestClose:()=>x(!1)}),e.jsx("h2",{className:"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title",children:"Online Lobby üåê"}),e.jsx("div",{className:"ndn-shell-body flex-1 overflow-hidden p-3 pb-0",children:e.jsxs("div",{className:"h-full flex flex-col gap-3",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"text-sm text-white/70",children:"Room"}),e.jsxs("div",{className:"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium",children:["Room (",Y?.id,")"]}),e.jsx("button",{className:"btn btn-ghost btn-sm rounded-lg",onClick:gt,children:"New Room"})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg",onClick:()=>D(!0),disabled:(Y?.matches?.length||0)>=Ne,children:[e.jsx(Wt,{className:"w-4 h-4"}),"Create Match +"]}),V&&e.jsx("button",{className:"btn btn-sm btn-ghost rounded-lg",onClick:jt,children:"Demo In-Play"}),(Y?.matches?.length||0)>=Ne&&e.jsx("div",{className:"text-xs text-rose-400",children:"Room full ‚Äî create a new room"})]})]}),!g&&e.jsx("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3",children:e.jsxs("div",{className:"ndn-filterbar",children:[e.jsxs("div",{className:"flex-1 min-w-[240px] relative",children:[e.jsx(Ut,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",placeholder:"Search matches, players...",className:"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all",value:H,onChange:t=>oe(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:ce,onChange:t=>Ae(t.target.value),children:[e.jsx("option",{value:"all",children:"All Games"}),e.jsx("option",{value:"x01",children:"X01"}),e.jsx("option",{value:"cricket",children:"Cricket"}),e.jsx("option",{value:"bermuda",children:"Bermuda"}),e.jsx("option",{value:"gotcha",children:"Gotcha"})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:r,onChange:t=>b(t.target.value),children:[e.jsx("option",{value:"all",children:"All Modes"}),e.jsx("option",{value:"first_to",children:"First To"}),e.jsx("option",{value:"best_of",children:"Best Of"})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:B,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${c?"bg-red-600 text-white border-red-500":"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900"}`,onClick:()=>v(t=>!t),"aria-pressed":c,title:"Toggle focus mode: hide small details and show focused view",children:c?"Exit Focus":"Focus Mode"})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg",onClick:ft,disabled:pe.length===0,children:[e.jsx(Ke,{className:"w-4 h-4 fill-current"}),"Quick Join"]})})]})}),e.jsxs("div",{className:"flex-1 overflow-auto flex flex-col",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(nt,{className:"w-5 h-5 text-indigo-400"}),"Active Matches ÔøΩÔ∏è"]}),e.jsx("div",{className:"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col",children:e.jsxs("div",{className:"flex-1 overflow-auto",children:[(pe.length||0)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center opacity-60",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4",children:e.jsx(Oe,{className:"w-8 h-8 text-white/20"})}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No matches found"}),e.jsx("p",{className:"text-sm max-w-xs mx-auto",children:"Create a new match to get started or try adjusting your filters."})]}):null,(pe.length||0)!==0&&e.jsxs("div",{className:"relative",children:[c&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out",children:e.jsx("button",{onClick:()=>v(!1),className:"w-full text-center",children:"FOCUS MODE ‚Äî Click to exit"})})}),e.jsx("div",{ref:R,className:`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 max-h-[28rem] overflow-auto p-1 ${c?"opacity-90":""}`,"data-testid":"matches-grid",children:bt.map(t=>e.jsxs("div",{className:"group relative p-4 rounded-lg border border-slate-700/30 bg-slate-950/40 hover:border-indigo-500/50 hover:bg-slate-900/50 transition-all duration-150 shadow-sm hover:shadow-[0_8px_24px_-12px_rgba(99,102,241,0.4)] flex flex-col gap-3 min-h-[6.5rem]","data-testid":`match-${t.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[!c&&e.jsx("div",{className:"w-9 h-9 rounded-full bg-indigo-500/10 flex items-center justify-center border border-indigo-500/20 group-hover:border-indigo-500/40 transition-colors text-xs font-bold",children:t.createdBy?(t.createdBy||"U").substring(0,2).toUpperCase():(t.creatorName||"U").substring(0,2).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-bold text-white group-hover:text-indigo-300 transition-colors truncate",children:t.game}),e.jsxs("div",{className:"text-xs text-white/50 flex items-center gap-1",children:[e.jsx(lt,{className:"w-3 h-3"}),new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})}),t.roomName&&e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-none bg-slate-950 border border-slate-850 text-white/70",children:t.roomName})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm text-white/70 bg-transparent border-t border-slate-850 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 rounded-none bg-white/5 text-xs font-medium border border-slate-850",children:t.modeType==="bestof"?"Best Of":"First To"}),e.jsx("span",{className:"font-mono text-indigo-300",children:t.legs}),e.jsx("span",{children:"legs"}),t.startingScore&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-white/20"}),e.jsx("span",{className:"font-mono text-amber-300",children:t.startingScore})]})]}),!c&&e.jsxs("div",{className:"text-xs text-white/40 flex items-center gap-1 mt-1",children:[e.jsx(nt,{className:"w-3 h-3"}),"Created by:"," ",e.jsx("span",{className:"text-white/60",children:t.createdBy||t.creatorName||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2 border-t border-white/5",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:!c&&e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white",children:(t.createdBy||t.creatorName||"U").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-xs text-white/60 truncate max-w-[120px]",children:t.createdBy||t.creatorName})]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-4 rounded-none",onClick:()=>tt(t),children:"Join"})})]})]},t.id))})]}),ge>1&&e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5",children:[e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:M===1,onClick:()=>K(t=>Math.max(1,t-1)),children:[e.jsx(it,{className:"w-4 h-4 rotate-90"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,ge)},(t,s)=>{let n=s+1;return ge>5&&(M>3&&(n=M-2+s),n>ge&&(n=ge-4+s)),e.jsx("button",{className:`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${M===n?"bg-indigo-600 text-white shadow-sm":"bg-slate-950 text-white/70 hover:bg-slate-900"}`,onClick:()=>K(n),children:n},n)})}),e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:M===ge,onClick:()=>K(t=>Math.min(ge,t+1)),children:["Next",e.jsx(it,{className:"w-4 h-4 -rotate-90"})]})]})]})})]})]})}),e.jsx(Yt,{open:y,onClose:()=>D(!1),onCreate:t=>{pt(t),D(!1)}}),j&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-md mx-4 p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-indigo-500/30 shadow-2xl shadow-indigo-500/20",children:[e.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 ring-2 ring-indigo-500/30",children:e.jsx(Ke,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-white",children:"Match Invite!"}),e.jsx("p",{className:"text-sm text-white/60",children:"Someone wants to play"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold text-sm",children:(j.fromName||"?").substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-lg",children:j.fromName||"Opponent"}),e.jsx("div",{className:"text-xs text-white/50",children:"wants to join your match"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-sm text-white/70",children:[e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-medium",children:j.game||"X01"}),e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10",children:[j.mode==="bestof"?"Best Of":"First To"," ",j.value||1]}),e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-mono text-amber-300",children:j.startingScore||501})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{i?.connected&&j?.id&&i.send({type:"invite-accept",matchId:j.id})}catch{}L(null)},children:"‚úÖ Accept"}),e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-white/5 hover:bg-rose-600/80 text-white/80 hover:text-white font-bold text-lg border border-white/10 hover:border-rose-500/50 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{i?.connected&&j?.id&&i.send({type:"invite-decline",matchId:j.id})}catch{}L(null)},children:"‚ùå Decline"})]})]})]})}),C&&!l&&e.jsx("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-sm mx-4 p-6 rounded-2xl bg-slate-900 border border-slate-700/50 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-indigo-500/10 flex items-center justify-center",children:e.jsx(lt,{className:"w-8 h-8 text-indigo-400 animate-pulse"})}),e.jsxs("h3",{className:"text-xl font-bold text-white mb-2",children:["Waiting for ",C]}),e.jsx("p",{className:"text-sm text-white/50 mb-5",children:"The match creator needs to accept your request‚Ä¶"}),e.jsx("button",{className:"px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 transition-all text-sm font-medium",onClick:()=>O(null),children:"Cancel"})]})}),e.jsx(Ht,{open:!!l,matchInfo:l,localUser:m,opponentName:(()=>{if(!l)return"Opponent";const t=(m?.username||"").toLowerCase(),s=l.createdBy||l.creatorName||"";return l._isCreatorView||s.toLowerCase()===t?l.joinerName||(l.joinerId?z[l.joinerId]||l.joinerId:"Opponent"):s||(l.creatorId?z[l.creatorId]||l.creatorId:"Opponent")})(),countdown:15,onChoice:vt,onBullThrow:t=>{try{i?.connected&&l?.id&&i.send({type:"prestart-bull-throw",roomId:l.id,score:t})}catch{}je(t),fe(!0)},onAccept:wt,onCancel:()=>{try{i?.connected&&l?.id&&l._isCreatorView&&i.send({type:"invite-decline",matchId:l.id})}catch{}f(null)},remoteChoice:Object.values(ue)[0]||null,bullActive:k,bullWinner:ze,bullTied:Le})]})})}export{rs as default};
//# sourceMappingURL=OnlinePlay.clean-BQHrPip_.js.map

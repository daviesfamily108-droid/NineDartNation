{"version":3,"file":"OfflinePlay-C8ahSaJc.js","sources":["../../src/utils/checkout.ts","../../src/components/CameraTile.tsx","../../src/utils/autoscore.ts","../../src/utils/dartDetector.ts","../../src/utils/scoring.ts","../../src/components/ui/ResizablePanel.tsx","../../src/store/heatmap.ts","../../src/store/matchControl.ts","../../src/components/CameraView.tsx","../../src/components/HeatMap.tsx","../../src/game/types.ts","../../src/game/aroundTheClock.ts","../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/game/ticTacToe.ts","../../src/game/scamFivesSevens.ts","../../src/game/americanCricket.ts","../../src/components/ui/GameHeaderBar.tsx","../../src/components/scoreboards/GameScoreboard.tsx","../../src/components/matchControlAdapters.ts","../../src/logic/matchActions.ts","../../src/components/scoreboards/useGameStats.ts","../../src/components/OfflinePlay.tsx"],"sourcesContent":["// Very lightweight checkout suggestions. For proper coverage consider a full table.\r\n// Returns up to a few route strings like \"T20 T20 D20\" for a given remaining.\r\n\r\nconst doubles = [\r\n  \"D1\",\r\n  \"D2\",\r\n  \"D3\",\r\n  \"D4\",\r\n  \"D5\",\r\n  \"D6\",\r\n  \"D7\",\r\n  \"D8\",\r\n  \"D9\",\r\n  \"D10\",\r\n  \"D11\",\r\n  \"D12\",\r\n  \"D13\",\r\n  \"D14\",\r\n  \"D15\",\r\n  \"D16\",\r\n  \"D17\",\r\n  \"D18\",\r\n  \"D19\",\r\n  \"D20\",\r\n  \"DB\",\r\n];\r\n\r\nfunction dVal(tag: string): number {\r\n  if (tag === \"DB\") return 50;\r\n  const n = Number(tag.slice(1));\r\n  return n * 2;\r\n}\r\n\r\nfunction prefsDoubleScore(fav: string): number {\r\n  if (!doubles.includes(fav)) return 32; // default D16\r\n  return dVal(fav);\r\n}\r\n\r\nexport function suggestCheckouts(\r\n  remaining: number,\r\n  favoriteDouble: string = \"D16\",\r\n): string[] {\r\n  if (remaining > 170 || remaining <= 1) return [];\r\n  // Simple known highest routes for popular numbers, then fall back to greedy towards favourite double\r\n  const hardcoded: Record<number, string[]> = {\r\n    170: [\"T20 T20 DB\"],\r\n    167: [\"T20 T19 DB\"],\r\n    164: [\"T20 T18 DB\"],\r\n    161: [\"T20 T17 DB\"],\r\n    160: [\"T20 T20 D20\"],\r\n    158: [\"T20 T20 D19\"],\r\n    157: [\"T20 T19 D20\"],\r\n    156: [\"T20 T20 D18\"],\r\n    155: [\"T20 T19 D19\"],\r\n    154: [\"T20 T18 D20\"],\r\n    153: [\"T20 T19 D18\"],\r\n    152: [\"T20 T20 D16\"],\r\n    151: [\"T20 T17 D20\"],\r\n    150: [\"T20 T18 D18\"],\r\n    149: [\"T20 T19 D16\"],\r\n    148: [\"T20 T16 D20\"],\r\n    147: [\"T20 T17 D18\"],\r\n    146: [\"T20 T18 D16\"],\r\n    145: [\"T20 T15 D20\"],\r\n    144: [\"T20 T20 D12\"],\r\n    141: [\"T20 T19 D12\"],\r\n    140: [\"T20 T20 D10\"],\r\n    137: [\"T20 T19 D10\"],\r\n    136: [\"T20 T20 D8\"],\r\n    132: [\"BULL T14 D20\", \"T20 T12 D8\"],\r\n    130: [\"T20 T20 D5\", \"T20 T18 D8\"],\r\n    129: [\"T19 T16 D12\"],\r\n    128: [\"T18 T14 D16\"],\r\n    127: [\"T20 T17 D8\"],\r\n    126: [\"T19 T19 D6\"],\r\n    121: [\"T20 11 D20\", \"T20 T15 D8\"],\r\n    120: [\"T20 20 D20\", \"T20 S20 D20\"],\r\n    110: [\"T20 10 D20\"],\r\n    100: [\"T20 D20\"],\r\n    99: [\"T19 10 D16\", \"T19 S10 D16\"],\r\n    97: [\"T19 D20\"],\r\n    96: [\"T20 D18\"],\r\n    95: [\"T19 D19\"],\r\n    94: [\"T18 D20\"],\r\n    92: [\"T20 D16\"],\r\n    90: [\"T18 D18\", \"T20 D15\"],\r\n    86: [\"T18 D16\"],\r\n    84: [\"T20 D12\", \"T16 D18\"],\r\n    82: [\"BULL D16\", \"T14 D20\"],\r\n    81: [\"T19 D12\"],\r\n    80: [\"T20 D10\", \"D20 D20\"],\r\n    78: [\"T18 D12\"],\r\n    76: [\"T20 D8\", \"T16 D14\"],\r\n    74: [\"T14 D16\", \"T18 D10\"],\r\n    72: [\"T16 D12\", \"T20 D6\"],\r\n    70: [\"T18 D8\", \"S20 BULL\"],\r\n    68: [\"T20 D4\", \"T16 D10\"],\r\n    66: [\"T10 D18\", \"T14 D12\"],\r\n    64: [\"T16 D8\", \"D16 D16\"],\r\n    62: [\"T10 D16\", \"T12 D13\"],\r\n    60: [\"20 D20\", \"S20 D20\"],\r\n    58: [\"18 D20\", \"S18 D20\"],\r\n    56: [\"16 D20\", \"S16 D20\"],\r\n    54: [\"14 D20\", \"S14 D20\"],\r\n    52: [\"20 D16\", \"S20 D16\"],\r\n    50: [\"BULL\", \"10 D20\"],\r\n    48: [\"16 D16\", \"S16 D16\"],\r\n    46: [\"14 D16\"],\r\n    44: [\"12 D16\"],\r\n    42: [\"10 D16\"],\r\n    40: [\"D20\"],\r\n    38: [\"D19\"],\r\n    36: [\"D18\"],\r\n    34: [\"D17\"],\r\n    32: [\"D16\"],\r\n    30: [\"D15\"],\r\n    28: [\"D14\"],\r\n    26: [\"D13\"],\r\n    24: [\"D12\"],\r\n    22: [\"D11\"],\r\n    20: [\"D10\"],\r\n    18: [\"D9\"],\r\n    16: [\"D8\"],\r\n    14: [\"D7\"],\r\n    12: [\"D6\"],\r\n    10: [\"D5\"],\r\n    8: [\"D4\"],\r\n    6: [\"D3\"],\r\n    4: [\"D2\"],\r\n    2: [\"D1\"],\r\n  };\r\n  if (hardcoded[remaining]) return hardcoded[remaining];\r\n  // Greedy fallback: aim to leave favourite double if possible in two darts\r\n  const target = prefsDoubleScore(favoriteDouble);\r\n  const routes: string[] = [];\r\n  // Try to hit a treble/big single that leaves the fav double\r\n  for (const t of [60, 57, 54, 51, 48]) {\r\n    // T20..T16\r\n    const left = remaining - t;\r\n    if (left === target) {\r\n      routes.push(`T${t / 3} ${favoriteDouble}`);\r\n      break;\r\n    }\r\n  }\r\n  if (!routes.length) {\r\n    for (const s of [20, 19, 18, 17, 16, 15]) {\r\n      const left = remaining - s;\r\n      if (left === target) {\r\n        routes.push(`${s} ${favoriteDouble}`);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return routes;\r\n}\r\n\r\nexport function sayScore(\r\n  name: string,\r\n  scored: number,\r\n  remaining: number,\r\n  voiceName?: string,\r\n  opts?: { volume?: number; checkoutOnly?: boolean },\r\n) {\r\n  try {\r\n    const synth = window.speechSynthesis;\r\n    if (!synth) return;\r\n    const msg = new SpeechSynthesisUtterance();\r\n    const isCheckout = remaining <= 170 && remaining > 0;\r\n    const isOneEighty = scored === 180;\r\n    const shouldAnnounce = !opts?.checkoutOnly || isCheckout || isOneEighty;\r\n    if (!shouldAnnounce) return;\r\n\r\n    if (isOneEighty) {\r\n      msg.text = `${name}! One eighty!`;\r\n      msg.rate = 1.04;\r\n      msg.pitch = 1.15;\r\n    } else if (isCheckout) {\r\n      msg.text = `${name}, ${remaining} remaining.`;\r\n      msg.rate = 1.0;\r\n      msg.pitch = 1.0;\r\n    } else if (scored === 0) {\r\n      msg.text = `${name}, no score.`;\r\n      msg.rate = 1.0;\r\n      msg.pitch = 1.0;\r\n    } else {\r\n      msg.text = `${name}, ${scored}.`;\r\n      msg.rate = 1.0;\r\n      msg.pitch = 1.0;\r\n    }\r\n    if (voiceName) {\r\n      const v = synth.getVoices().find((v) => v.name === voiceName);\r\n      if (v) msg.voice = v;\r\n    }\r\n    if (typeof opts?.volume === \"number\")\r\n      msg.volume = Math.max(0, Math.min(1, opts.volume));\r\n    else msg.volume = 1;\r\n    try {\r\n      synth.cancel();\r\n    } catch {}\r\n    synth.speak(msg);\r\n  } catch {}\r\n}\r\n","/* eslint-disable jsx-a11y/media-has-caption */\r\nimport {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n  type CSSProperties,\r\n} from \"react\";\r\nimport { dlog } from \"../utils/logger\";\r\nimport { useUserSettings } from \"../store/userSettings\";\r\nimport {\r\n  useCameraSession,\r\n  type CameraStreamMode,\r\n} from \"../store/cameraSession\";\r\nimport {\r\n  discoverNetworkDevices,\r\n  connectToNetworkDevice,\r\n  type NetworkDevice,\r\n  discoverUSBDevices,\r\n  requestUSBDevice,\r\n  connectToUSBDevice,\r\n  type USBDevice,\r\n} from \"../utils/networkDevices\";\r\nimport { apiFetch } from \"../utils/api\";\r\n\r\ntype CameraTileProps = {\r\n  label?: string;\r\n  autoStart?: boolean;\r\n  scale?: number;\r\n  className?: string;\r\n  aspect?: \"inherit\" | \"wide\" | \"square\" | \"portrait\" | \"classic\" | \"free\";\r\n  style?: CSSProperties;\r\n  fill?: boolean;\r\n  // Offline mode props\r\n  user?: any;\r\n  playerScore?: number;\r\n  aiScore?: number;\r\n  x01Score?: number;\r\n  inMatch?: boolean;\r\n  showWinPopup?: boolean;\r\n  pendingLegWinner?: \"player\" | \"ai\" | null;\r\n  playerDartsThrown?: number;\r\n  aiDartsThrown?: number;\r\n  totalPlayerDarts?: number;\r\n  totalAiDarts?: number;\r\n  totalPlayerPoints?: number;\r\n  totalAiPoints?: number;\r\n  player180s?: number;\r\n  player140s?: number;\r\n  player100s?: number;\r\n  ai180s?: number;\r\n  ai140s?: number;\r\n  ai100s?: number;\r\n  playerHighestCheckout?: number;\r\n  aiHighestCheckout?: number;\r\n  onClose?: () => void;\r\n  onOpen?: () => void;\r\n  layout?: \"classic\" | \"modern\";\r\n};\r\n\r\nexport default function CameraTile({\r\n  label,\r\n  autoStart,\r\n  scale: scaleOverride,\r\n  className,\r\n  aspect = \"inherit\",\r\n  style,\r\n  fill = false,\r\n}: CameraTileProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const cameraSession = useCameraSession();\r\n  const [streaming, setStreaming] = useState(false);\r\n  const [ws, setWs] = useState<WebSocket | null>(null);\r\n  const [pairCode, setPairCode] = useState<string | null>(null);\r\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null);\r\n  const lastRegisteredModeRef = useRef<CameraStreamMode | null>(null);\r\n  const registerStream = useCallback(\r\n    (stream: MediaStream | null, modeOverride: CameraStreamMode = \"local\") => {\r\n      try {\r\n        if (stream) {\r\n          cameraSession.setMediaStream(stream);\r\n          if (videoRef.current) {\r\n            cameraSession.setVideoElementRef(videoRef.current);\r\n          }\r\n          cameraSession.setMode(modeOverride);\r\n          cameraSession.setStreaming(true);\r\n          lastRegisteredModeRef.current = modeOverride;\r\n        } else if (\r\n          lastRegisteredModeRef.current &&\r\n          lastRegisteredModeRef.current !== \"phone\"\r\n        ) {\r\n          cameraSession.setStreaming(false);\r\n          cameraSession.setMediaStream(null);\r\n          lastRegisteredModeRef.current = null;\r\n        }\r\n      } catch (err) {\r\n        console.warn(\r\n          \"[CameraTile] Failed to register stream with camera session:\",\r\n          err,\r\n        );\r\n      }\r\n    },\r\n    [cameraSession],\r\n  );\r\n\r\n  // Initialize mode: prioritize phone camera if preferred, otherwise use localStorage\r\n  const preferredCameraLabel = useUserSettings((s) => s.preferredCameraLabel);\r\n  const [mode, setMode] = useState<\"local\" | \"phone\" | \"wifi\">(() => {\r\n    // If phone camera is selected, start in phone mode\r\n    if (preferredCameraLabel === \"Phone Camera\") {\r\n      dlog(\r\n        \"[CAMERATILE] Initializing mode to phone (from preferred camera selection)\",\r\n      );\r\n      return \"phone\";\r\n    }\r\n    // Otherwise use saved mode or default to local\r\n    const saved = localStorage.getItem(\"ndn:camera:mode\") as any;\r\n    dlog(\r\n      \"[CAMERATILE] Initializing mode to\",\r\n      saved || \"local\",\r\n      \"(from localStorage)\",\r\n    );\r\n    return saved || \"local\";\r\n  });\r\n\r\n  const [, setExpiresAt] = useState<number | null>(null);\r\n  const [, setPaired] = useState<boolean>(false);\r\n  const [lanHost, setLanHost] = useState<string | null>(null);\r\n  const [httpsInfo, setHttpsInfo] = useState<{\r\n    https: boolean;\r\n    port: number;\r\n  } | null>(null);\r\n  const [showTips, setShowTips] = useState<boolean>(true);\r\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([]);\r\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false);\r\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([]);\r\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false);\r\n  const autoscoreProvider = useUserSettings((s) => s.autoscoreProvider);\r\n  const cameraEnabledSetting = useUserSettings((s) => s.cameraEnabled);\r\n  const setPreferredCameraLocked = useUserSettings(\r\n    (s) => s.setPreferredCameraLocked,\r\n  );\r\n  const preferredCameraLocked = useUserSettings((s) => s.preferredCameraLocked);\r\n  const setPreferredCamera = useUserSettings((s) => s.setPreferredCamera);\r\n  const preferredCameraId = useUserSettings((s) => s.preferredCameraId);\r\n\r\n  if (autoscoreProvider === \"manual\") {\r\n    const fallbackBase = fill\r\n      ? \"rounded-2xl overflow-hidden bg-black w-full flex flex-col\"\r\n      : \"rounded-2xl overflow-hidden bg-black w-full mx-auto\";\r\n    const fallbackClass = [fallbackBase, className]\r\n      .filter(Boolean)\r\n      .join(\" \")\r\n      .trim();\r\n    const fallbackStyle: CSSProperties = { ...(style || {}) };\r\n    if (\r\n      !fill &&\r\n      fallbackStyle.aspectRatio === undefined &&\r\n      fallbackStyle.height === undefined &&\r\n      fallbackStyle.minHeight === undefined\r\n    ) {\r\n      fallbackStyle.aspectRatio = \"4 / 3\";\r\n    }\r\n    return (\r\n      <div className={fallbackClass} style={fallbackStyle}>\r\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\r\n          Manual scoring mode active â€” camera feeds are disabled.\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  useEffect(() => {\r\n    const h = window.location.hostname;\r\n    if (h === \"localhost\" || h === \"127.0.0.1\") {\r\n      apiFetch(`/api/hosts`)\r\n        .then((r) => r.json())\r\n        .then((j) => {\r\n          const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x);\r\n          if (ip) setLanHost(ip);\r\n        })\r\n        .catch(() => {});\r\n    }\r\n    // Detect HTTPS support for the phone link\r\n    apiFetch(`/api/https-info`)\r\n      .then((r) => r.json())\r\n      .then((j) => {\r\n        if (j && typeof j.https === \"boolean\")\r\n          setHttpsInfo({ https: !!j.https, port: Number(j.port) || 8788 });\r\n      })\r\n      .catch(() => {});\r\n  }, []);\r\n  const mobileUrl = useMemo(() => {\r\n    const code = pairCode || \"____\";\r\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined;\r\n    if (envUrl && envUrl.length > 0) {\r\n      try {\r\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\r\n        const u = new URL(envUrl);\r\n        const isSecure = u.protocol === \"wss:\";\r\n        const origin = `${isSecure ? \"https\" : \"http\"}://${u.host}${u.pathname.endsWith(\"/ws\") ? \"\" : u.pathname}`;\r\n        const base = origin.replace(/\\/?ws$/i, \"\");\r\n        return `${base}/mobile-cam.html?code=${code}`;\r\n      } catch {}\r\n    }\r\n    // Fallback to local development: prefer LAN host if detected\r\n    const host = lanHost || window.location.hostname;\r\n    const useHttps = !!httpsInfo?.https;\r\n    const port = useHttps ? httpsInfo?.port || 8788 : 8787;\r\n    const proto = useHttps ? \"https\" : \"http\";\r\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`;\r\n  }, [pairCode, lanHost, httpsInfo]);\r\n  useEffect(() => {\r\n    dlog(\"[CAMERATILE] Mode changed to:\", mode, \"- persisting to localStorage\");\r\n    localStorage.setItem(\"ndn:camera:mode\", mode);\r\n  }, [mode]);\r\n\r\n  const [manualModeSetAt, setManualModeSetAt] = useState<number | null>(null);\r\n\r\n  // start/stop are implemented later (deduplicated); keep single definition below.\r\n\r\n  // Sync phone camera selection from Calibrator into CameraTile mode state\r\n  // When user locks in phone camera in Calibrator, it updates preferredCameraLabel\r\n  // This effect ensures CameraTile's UI reflects that selection\r\n  useEffect(() => {\r\n    const ignore = useUserSettings.getState().ignorePreferredCameraSync;\r\n    dlog(\r\n      \"[CAMERATILE] Checking camera selection sync: preferredCameraLabel=\",\r\n      preferredCameraLabel,\r\n      \"mode=\",\r\n      mode,\r\n      \"ignoreSync=\",\r\n      ignore,\r\n      \"manualModeSetAt=\",\r\n      manualModeSetAt,\r\n    );\r\n    if (ignore) return;\r\n    // If user manually changed mode recently, avoid auto-syncing preferred camera\r\n    if (manualModeSetAt && Date.now() - manualModeSetAt < 30_000) return;\r\n    if (preferredCameraLabel === \"Phone Camera\" && mode !== \"phone\") {\r\n      dlog(\"[CAMERATILE] Syncing mode to phone from Calibrator selection\");\r\n      setMode(\"phone\");\r\n    }\r\n  }, [preferredCameraLabel, mode, manualModeSetAt]);\r\n\r\n  // Intentionally disabled automatic regeneration of phone pairing codes.\r\n  // Codes will only be created when the user explicitly requests it (button click).\r\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\r\n\r\n  useEffect(() => {\r\n    if (\r\n      !cameraEnabledSetting ||\r\n      (autoscoreProvider &&\r\n        autoscoreProvider !== \"built-in\" &&\r\n        autoscoreProvider !== \"external-ws\")\r\n    )\r\n      return;\r\n    if (autoStart === undefined) return;\r\n    if (autoStart) {\r\n      let cancelled = false;\r\n      const desiredLabel = preferredCameraLabel || \"default\";\r\n      const timer = window.setTimeout(() => {\r\n        if (cancelled || streaming) return;\r\n        start().catch((err) =>\r\n          console.warn(\r\n            `[CameraTile] Auto-start failed for ${desiredLabel}:`,\r\n            err,\r\n          ),\r\n        );\r\n      }, 200);\r\n      return () => {\r\n        cancelled = true;\r\n        window.clearTimeout(timer);\r\n      };\r\n    }\r\n    stop();\r\n  }, [\r\n    autoStart,\r\n    streaming,\r\n    cameraEnabledSetting,\r\n    autoscoreProvider,\r\n    preferredCameraLabel,\r\n    start,\r\n    stop,\r\n  ]);\r\n\r\n  // If the user selected Phone Camera, bind the global stream into this tile\r\n  useEffect(() => {\r\n    const apply = async () => {\r\n      try {\r\n        const allowPhoneAttach =\r\n          (preferredCameraLabel === \"Phone Camera\" &&\r\n            (!manualModeSetAt || Date.now() - manualModeSetAt >= 30_000)) ||\r\n          mode === \"phone\";\r\n        if (!allowPhoneAttach) return;\r\n        const s = cameraSession.getMediaStream();\r\n        const v = videoRef.current;\r\n        if (!v || !s) return;\r\n        if (v.srcObject !== s) {\r\n          v.srcObject = s;\r\n        }\r\n        v.muted = true;\r\n        (v as any).playsInline = true;\r\n        try {\r\n          await v.play();\r\n        } catch {}\r\n        setStreaming(true);\r\n      } catch {}\r\n    };\r\n    // Try immediately and poll briefly to catch late-arriving stream\r\n    apply();\r\n    const t = setInterval(apply, 800);\r\n    return () => clearInterval(t);\r\n  }, [preferredCameraLabel, mode, cameraSession, cameraSession.isStreaming]);\r\n\r\n  const start = useCallback(async () => {\r\n    dlog(\"[CameraTile] start() invoked with mode=\", mode);\r\n    if (mode === \"wifi\") {\r\n      return startWifiConnection();\r\n    }\r\n    dlog(\"[CameraTile] Attempting to attach global stream for phone mode...\");\r\n\r\n    // If phone camera is selected and paired, don't try to start local camera\r\n    if (preferredCameraLabel === \"Phone Camera\" || mode === \"phone\") {\r\n      const s = cameraSession.getMediaStream();\r\n      if (s && videoRef.current) {\r\n        try {\r\n          videoRef.current.srcObject = s;\r\n          await videoRef.current.play();\r\n          setStreaming(true);\r\n          return;\r\n        } catch {}\r\n      }\r\n      // If no global stream yet, for phone mode we should attempt pairing\r\n      if (mode === \"phone\") {\r\n        try {\r\n          await startPhonePairing();\r\n          return;\r\n        } catch {}\r\n      }\r\n    }\r\n\r\n    try {\r\n      // Prefer saved camera if available\r\n      const { preferredCameraId, setPreferredCamera } =\r\n        useUserSettings.getState();\r\n      const constraints: MediaStreamConstraints = preferredCameraId\r\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false }\r\n        : { video: true, audio: false };\r\n      let stream: MediaStream;\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n      } catch (err: any) {\r\n        const name = (err && (err.name || err.code)) || \"\";\r\n        if (\r\n          preferredCameraId &&\r\n          (name === \"OverconstrainedError\" || name === \"NotFoundError\")\r\n        ) {\r\n          stream = await navigator.mediaDevices.getUserMedia({\r\n            video: true,\r\n            audio: false,\r\n          });\r\n        } else {\r\n          throw err;\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        await videoRef.current.play();\r\n        setStreaming(true);\r\n        registerStream(stream, \"local\");\r\n      }\r\n      // Camera started successfully - no automatic preference updates\r\n    } catch {}\r\n  }, [mode, preferredCameraLabel, cameraSession, registerStream, startPhonePairing, startWifiConnection]);\r\n  const stop = useCallback(() => {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks();\r\n      tracks.forEach((t) => t.stop());\r\n      videoRef.current.srcObject = null;\r\n      setStreaming(false);\r\n      registerStream(null);\r\n    }\r\n  }, [registerStream]);\r\n\r\n  async function startWifiConnection() {\r\n    setDiscoveringWifi(true);\r\n    try {\r\n      const devices = await discoverNetworkDevices();\r\n      setWifiDevices(devices);\r\n      if (devices.length === 0) {\r\n        alert(\r\n          \"No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.\",\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Wifi device discovery failed:\", error);\r\n      alert(\r\n        \"Failed to discover wifi devices. Please check your network connection.\",\r\n      );\r\n    } finally {\r\n      setDiscoveringWifi(false);\r\n    }\r\n  }\r\n\r\n  async function connectToWifiDevice(device: NetworkDevice) {\r\n    try {\r\n      setWifiDevices((devices) =>\r\n        devices.map((d) =>\r\n          d.id === device.id ? { ...d, status: \"connecting\" as const } : d,\r\n        ),\r\n      );\r\n\r\n      const stream = await connectToNetworkDevice(device);\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        await videoRef.current.play();\r\n        setStreaming(true);\r\n        registerStream(stream, \"wifi\");\r\n        setWifiDevices((devices) =>\r\n          devices.map((d) =>\r\n            d.id === device.id ? { ...d, status: \"online\" as const } : d,\r\n          ),\r\n        );\r\n      } else {\r\n        throw new Error(\"Failed to get video stream\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to connect to wifi device:\", error);\r\n      alert(\r\n        `Failed to connect to ${device.name}. Please check the device and try again.`,\r\n      );\r\n      setWifiDevices((devices) =>\r\n        devices.map((d) =>\r\n          d.id === device.id ? { ...d, status: \"offline\" as const } : d,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  async function startUsbConnection() {\r\n    setDiscoveringUsb(true);\r\n    try {\r\n      // First try to get already paired devices\r\n      const devices = await discoverUSBDevices();\r\n      setUsbDevices(devices);\r\n\r\n      // Then request user to select a new device\r\n      const newDevice = await requestUSBDevice();\r\n      if (newDevice) {\r\n        setUsbDevices((prev) => [...prev, newDevice]);\r\n      }\r\n\r\n      if (devices.length === 0 && !newDevice) {\r\n        alert(\r\n          \"No USB scoring devices found. Please connect a device and try again.\",\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"USB device discovery failed:\", error);\r\n      alert(\"Failed to discover USB devices. Please check device connections.\");\r\n    } finally {\r\n      setDiscoveringUsb(false);\r\n    }\r\n  }\r\n\r\n  async function connectToUsbDevice(device: USBDevice) {\r\n    try {\r\n      setUsbDevices((devices) =>\r\n        devices.map((d) =>\r\n          d.id === device.id ? { ...d, status: \"connecting\" as const } : d,\r\n        ),\r\n      );\r\n      const stream = await connectToUSBDevice(device);\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        await videoRef.current.play();\r\n        setStreaming(true);\r\n        setMode(\"wifi\"); // Using wifi mode for USB devices too\r\n        registerStream(stream, \"wifi\");\r\n        setUsbDevices((devices) =>\r\n          devices.map((d) =>\r\n            d.id === device.id ? { ...d, status: \"online\" as const } : d,\r\n          ),\r\n        );\r\n      } else {\r\n        throw new Error(\"Failed to get video stream\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to connect to USB device:\", error);\r\n      alert(\r\n        `Failed to connect to ${device.name}. Please check the device and try again.`,\r\n      );\r\n      setUsbDevices((devices) =>\r\n        devices.map((d) =>\r\n          d.id === device.id ? { ...d, status: \"offline\" as const } : d,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  // Listen for global event to start local camera from other UI components\r\n  const handleModeSelect = useCallback(\r\n    (newMode: \"local\" | \"phone\" | \"wifi\" | \"usb\") => {\r\n      try {\r\n        setMode(newMode === \"usb\" ? \"wifi\" : newMode);\r\n        setManualModeSetAt(Date.now());\r\n        // Persist the user's selection and lock it to avoid auto-switching\r\n        try {\r\n          if (newMode === \"local\") {\r\n            try {\r\n              setPreferredCamera(preferredCameraId, \"Local\", true);\r\n            } catch {}\r\n            try {\r\n              setPreferredCameraLocked(true);\r\n            } catch {}\r\n          } else if (newMode === \"phone\") {\r\n            try {\r\n              setPreferredCamera(undefined, \"Phone Camera\", true);\r\n            } catch {}\r\n            try {\r\n              setPreferredCameraLocked(true);\r\n            } catch {}\r\n          } else if (newMode === \"wifi\" || newMode === \"usb\") {\r\n            try {\r\n              setPreferredCamera(undefined, \"WiFi/USB\", true);\r\n            } catch {}\r\n            try {\r\n              setPreferredCameraLocked(true);\r\n            } catch {}\r\n          }\r\n        } catch {}\r\n        if (newMode === \"local\") {\r\n          start().catch(() => {});\r\n        } else if (newMode === \"phone\") {\r\n          startPhonePairing();\r\n        } else if (newMode === \"wifi\") {\r\n          startWifiConnection();\r\n        } else if (newMode === \"usb\") {\r\n          startUsbConnection();\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"[CameraTile] handleModeSelect failed\", err);\r\n      }\r\n    },\r\n    [\r\n      start,\r\n      startPhonePairing,\r\n      startWifiConnection,\r\n      startUsbConnection,\r\n      setPreferredCamera,\r\n      setPreferredCameraLocked,\r\n      preferredCameraId,\r\n    ],\r\n  );\r\n\r\n  useEffect(() => {\r\n    const onStart = (ev: any) => {\r\n      try {\r\n        const modeFromEvent = ev && ev.detail && ev.detail.mode;\r\n        if (\r\n          modeFromEvent &&\r\n          [\"local\", \"phone\", \"wifi\", \"usb\"].includes(modeFromEvent)\r\n        ) {\r\n          // Respect explicit mode requests and treat as manual selection\r\n          handleModeSelect(modeFromEvent);\r\n          // Ensure start is invoked after selection is applied\r\n          start().catch(() => {});\r\n        } else {\r\n          // No explicit mode provided â€” just try to start current mode\r\n          start().catch(() => {});\r\n        }\r\n      } catch {}\r\n    };\r\n    window.addEventListener(\"ndn:start-camera\" as any, onStart as any);\r\n    return () => {\r\n      window.removeEventListener(\"ndn:start-camera\" as any, onStart as any);\r\n    };\r\n  }, [start, handleModeSelect]);\r\n\r\n  // Phone pairing via WebRTC\r\n  function ensureWS() {\r\n    if (ws && ws.readyState === WebSocket.OPEN) return ws;\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined;\r\n    const normalizedEnv =\r\n      envUrl && envUrl.length > 0\r\n        ? envUrl.endsWith(\"/ws\")\r\n          ? envUrl\r\n          : envUrl.replace(/\\/$/, \"\") + \"/ws\"\r\n        : undefined;\r\n    const proto = window.location.protocol === \"https:\" ? \"wss\" : \"ws\";\r\n    const sameOrigin = `${proto}://${window.location.host}/ws`;\r\n    const host = window.location.hostname;\r\n    const isLocalhost = host === \"localhost\" || host === \"127.0.0.1\";\r\n    const isRenderHost = host.endsWith(\"onrender.com\");\r\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\r\n    const renderWS = `wss://ninedartnation.onrender.com/ws`;\r\n    let url = normalizedEnv;\r\n    if (!url) {\r\n      if (isLocalhost) {\r\n        url = `${proto}://${host}:8787/ws`;\r\n      } else if (isRenderHost) {\r\n        url = sameOrigin;\r\n      } else {\r\n        url = renderWS;\r\n      }\r\n    }\r\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\r\n    if (!url) url = sameOrigin;\r\n    const socket = new WebSocket(url);\r\n    setWs(socket);\r\n    return socket;\r\n  }\r\n  async function startPhonePairing() {\r\n    setMode(\"phone\");\r\n    setPaired(false);\r\n    const socket = ensureWS();\r\n    if (socket.readyState === WebSocket.OPEN) {\r\n      socket.send(JSON.stringify({ type: \"cam-create\" }));\r\n    } else {\r\n      socket.onopen = () => socket.send(JSON.stringify({ type: \"cam-create\" }));\r\n    }\r\n    socket.onmessage = async (ev) => {\r\n      const data = JSON.parse(ev.data);\r\n      if (data.type === \"cam-code\") {\r\n        setPairCode(data.code);\r\n        if (data.expiresAt) setExpiresAt(data.expiresAt);\r\n      } else if (data.type === \"cam-peer-joined\") {\r\n        setPaired(true);\r\n        // Create offer to the phone\r\n        const peer = new RTCPeerConnection({\r\n          iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }],\r\n        });\r\n        setPc(peer);\r\n        peer.onicecandidate = (e) => {\r\n          if (e.candidate && pairCode)\r\n            socket.send(\r\n              JSON.stringify({\r\n                type: \"cam-ice\",\r\n                code: pairCode,\r\n                payload: e.candidate,\r\n              }),\r\n            );\r\n        };\r\n        peer.ontrack = (ev) => {\r\n          if (videoRef.current) {\r\n            const inbound = ev.streams?.[0];\r\n            if (inbound) {\r\n              videoRef.current.srcObject = inbound;\r\n              videoRef.current.play().catch(() => {});\r\n              setStreaming(true);\r\n            }\r\n          }\r\n        };\r\n        const offer = await peer.createOffer({\r\n          offerToReceiveAudio: false,\r\n          offerToReceiveVideo: true,\r\n        });\r\n        await peer.setLocalDescription(offer);\r\n        if (pairCode)\r\n          socket.send(\r\n            JSON.stringify({\r\n              type: \"cam-offer\",\r\n              code: pairCode,\r\n              payload: offer,\r\n            }),\r\n          );\r\n      } else if (data.type === \"cam-answer\") {\r\n        if (pc)\r\n          await pc.setRemoteDescription(\r\n            new RTCSessionDescription(data.payload),\r\n          );\r\n      } else if (data.type === \"cam-ice\") {\r\n        if (pc)\r\n          try {\r\n            await pc.addIceCandidate(data.payload);\r\n          } catch {}\r\n      }\r\n    };\r\n  }\r\n  function regenerateCode() {\r\n    setPairCode(null);\r\n    setExpiresAt(null);\r\n    setPaired(false);\r\n    if (ws && ws.readyState === WebSocket.OPEN) {\r\n      ws.send(JSON.stringify({ type: \"cam-create\" }));\r\n    } else {\r\n      startPhonePairing();\r\n    }\r\n    try {\r\n      setPreferredCameraLocked(true);\r\n    } catch {}\r\n  }\r\n\r\n  function stopAll() {\r\n    stop();\r\n    setPairCode(null);\r\n    setPaired(false);\r\n    setExpiresAt(null);\r\n    if (pc) {\r\n      try {\r\n        pc.close();\r\n      } catch {}\r\n      setPc(null);\r\n    }\r\n  }\r\n  return (\r\n    <CameraFrame\r\n      label={label}\r\n      autoStart={autoStart}\r\n      start={start}\r\n      stopAll={stopAll}\r\n      startPhonePairing={startPhonePairing}\r\n      startWifiConnection={startWifiConnection}\r\n      startUsbConnection={startUsbConnection}\r\n      connectToWifiDevice={connectToWifiDevice}\r\n      connectToUsbDevice={connectToUsbDevice}\r\n      videoRef={videoRef}\r\n      streaming={streaming}\r\n      mode={mode}\r\n      setMode={setMode}\r\n      pairCode={pairCode}\r\n      mobileUrl={mobileUrl}\r\n      regenerateCode={regenerateCode}\r\n      httpsInfo={httpsInfo}\r\n      showTips={showTips}\r\n      setShowTips={setShowTips}\r\n      wifiDevices={wifiDevices}\r\n      usbDevices={usbDevices}\r\n      discoveringWifi={discoveringWifi}\r\n      discoveringUsb={discoveringUsb}\r\n      scaleOverride={scaleOverride}\r\n      className={className}\r\n      aspect={aspect}\r\n      style={style}\r\n      fill={fill}\r\n      onModeSelect={handleModeSelect}\r\n      preferredCameraLocked={preferredCameraLocked}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CameraFrame(props: any) {\r\n  const cameraSession = useCameraSession();\r\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings();\r\n  const {\r\n    label,\r\n    start,\r\n    stopAll,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n    startUsbConnection,\r\n    connectToWifiDevice,\r\n    connectToUsbDevice,\r\n    videoRef,\r\n    streaming,\r\n    mode,\r\n    setMode,\r\n    onModeSelect,\r\n    pairCode,\r\n    mobileUrl,\r\n    regenerateCode,\r\n    httpsInfo,\r\n    showTips,\r\n    setShowTips,\r\n    wifiDevices,\r\n    usbDevices,\r\n    discoveringWifi,\r\n    discoveringUsb,\r\n    className,\r\n    aspect,\r\n    style,\r\n    fill,\r\n    preferredCameraLocked,\r\n  } = props;\r\n\r\n  const modeDisplayName: Record<string, string> = {\r\n    local: \"Local\",\r\n    phone: \"PhoneCam\",\r\n    wifi: \"Wi-Fi/USB\",\r\n  };\r\n\r\n  const reconnectOptions = useMemo(() => {\r\n    return [\r\n      {\r\n        id: \"local\",\r\n        title: \"Local camera\",\r\n        description: \"Use the desktop webcam or capture card.\",\r\n        action: () => {\r\n          if (onModeSelect) onModeSelect(\"local\");\r\n        },\r\n      },\r\n      {\r\n        id: \"phone\",\r\n        title: \"PhoneCam\",\r\n        description: \"Stream from your phone via the mobile link.\",\r\n        action: () => {\r\n          if (onModeSelect) onModeSelect(\"phone\");\r\n        },\r\n      },\r\n      {\r\n        id: \"wifi\",\r\n        title: \"Wi-Fi/USB\",\r\n        description: \"Connect to scoring devices on your local network.\",\r\n        action: () => {\r\n          if (onModeSelect) onModeSelect(\"wifi\");\r\n        },\r\n      },\r\n      {\r\n        id: \"usb\",\r\n        title: \"USB\",\r\n        description: \"Connect a USB capture device (treated like WiFi mode).\",\r\n        action: () => {\r\n          if (onModeSelect) onModeSelect(\"usb\");\r\n        },\r\n      },\r\n    ];\r\n  }, [\r\n    setMode,\r\n    start,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n    startUsbConnection,\r\n  ]);\r\n\r\n  const [copyFeedback, setCopyFeedback] = useState<\"link\" | \"code\" | null>(\r\n    null,\r\n  );\r\n  const copyTimeoutRef = useRef<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current);\r\n    };\r\n  }, []);\r\n\r\n  // Respect stored aspect unless we're explicitly in full-bleed fill mode,\r\n  // in which case drop the aspect box so the video can truly cover the area.\r\n  const { cameraFitMode: globalFitMode } = useUserSettings();\r\n  const effectiveFitMode: \"fit\" | \"fill\" = fill\r\n    ? \"fill\"\r\n    : globalFitMode || \"fill\";\r\n  // In fill mode we guarantee no black bars: never allow downscaling below 1.0\r\n  const scale = (() => {\r\n    const raw = Number(props.scaleOverride ?? cameraScale ?? 1);\r\n    const clamped = Math.max(0.5, Math.min(1.25, raw));\r\n    return effectiveFitMode === \"fill\" ? Math.max(1, clamped) : clamped;\r\n  })();\r\n  const aspectChoice: \"wide\" | \"square\" | \"portrait\" | \"classic\" | \"free\" =\r\n    fill && effectiveFitMode === \"fill\"\r\n      ? \"free\"\r\n      : aspect && aspect !== \"inherit\"\r\n        ? aspect\r\n        : (storedAspect as any) || \"wide\";\r\n\r\n  const shouldMaintainAspect = aspectChoice !== \"free\";\r\n  const aspectClass = shouldMaintainAspect\r\n    ? aspectChoice === \"square\"\r\n      ? \"aspect-square\"\r\n      : aspectChoice === \"portrait\"\r\n        ? \"aspect-[3/4]\"\r\n        : aspectChoice === \"classic\"\r\n          ? \"aspect-[4/3]\"\r\n          : \"aspect-video\"\r\n    : \"\";\r\n\r\n  const containerBase = fill\r\n    ? \"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30\"\r\n    : \"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30\";\r\n  const containerClass = [containerBase, className]\r\n    .filter(Boolean)\r\n    .join(\" \")\r\n    .trim();\r\n  const containerStyle: CSSProperties = { ...(style || {}) };\r\n\r\n  const viewportClass = fill\r\n    ? \"relative flex-1 min-h-[420px] bg-black\"\r\n    : \"relative w-full bg-black\";\r\n\r\n  const commonVideoProps = {\r\n    style: { transform: `scale(${scale})`, transformOrigin: \"center\" as const },\r\n  };\r\n\r\n  const usbActive =\r\n    mode === \"wifi\" && usbDevices.some((d: USBDevice) => d.status === \"online\");\r\n\r\n  const videoElement = (() => {\r\n    // Apply Fit/Fill preference (fill prop hard-overrides to full-bleed)\r\n    const isFit = effectiveFitMode === \"fit\";\r\n    const baseVideoClass = isFit\r\n      ? // Fit: preserve entire frame (may letterbox)\r\n        \"absolute inset-0 w-full h-full object-contain object-center bg-transparent\"\r\n      : // Fill: guarantee full coverage with object-cover so there are no black bars\r\n        \"absolute inset-0 w-full h-full object-cover object-center bg-transparent\";\r\n    if (fill) {\r\n      if (shouldMaintainAspect) {\r\n        return (\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div\r\n              className={`relative w-full max-w-full max-h-full ${aspectClass}`}\r\n            >\r\n              <video\r\n                ref={videoRef}\r\n                className={baseVideoClass}\r\n                {...commonVideoProps}\r\n              />\r\n            </div>\r\n          </div>\r\n        );\r\n      }\r\n      return (\r\n        <video\r\n          ref={videoRef}\r\n          className={baseVideoClass}\r\n          {...commonVideoProps}\r\n        />\r\n      );\r\n    }\r\n    if (shouldMaintainAspect) {\r\n      return (\r\n        <div className={`relative w-full ${aspectClass}`}>\r\n          <video\r\n            ref={videoRef}\r\n            className={baseVideoClass}\r\n            {...commonVideoProps}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n    return (\r\n      <div className=\"relative w-full\">\r\n        <video\r\n          ref={videoRef}\r\n          className={baseVideoClass}\r\n          {...commonVideoProps}\r\n        />\r\n      </div>\r\n    );\r\n  })();\r\n\r\n  async function copyValue(\r\n    value: string | null | undefined,\r\n    type: \"link\" | \"code\",\r\n  ) {\r\n    if (!value) return;\r\n    try {\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        await navigator.clipboard.writeText(value);\r\n      } else {\r\n        const textarea = document.createElement(\"textarea\");\r\n        textarea.value = value;\r\n        textarea.style.position = \"fixed\";\r\n        textarea.style.opacity = \"0\";\r\n        document.body.appendChild(textarea);\r\n        textarea.focus();\r\n        textarea.select();\r\n        document.execCommand(\"copy\");\r\n        document.body.removeChild(textarea);\r\n      }\r\n      setCopyFeedback(type);\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current);\r\n      copyTimeoutRef.current = window.setTimeout(\r\n        () => setCopyFeedback(null),\r\n        1500,\r\n      );\r\n    } catch (err) {\r\n      console.warn(\"Copy to clipboard failed:\", err);\r\n      setCopyFeedback(null);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={containerClass} style={containerStyle}>\r\n      <div className={viewportClass}>\r\n        {videoElement}\r\n        {cameraSession.isStreaming && mode === \"phone\" && (\r\n          <div className=\"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg\">\r\n            <span className=\"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse\" />\r\n            <span>REC</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50\">\r\n        <span className=\"truncate font-medium\">\r\n          {label ||\r\n            (streaming\r\n              ? mode === \"phone\"\r\n                ? \"PHONE LIVE\"\r\n                : mode === \"wifi\"\r\n                  ? \"WIFI LIVE\"\r\n                  : \"LIVE\"\r\n              : \"Camera\")}\r\n          {preferredCameraLocked && (\r\n            <span className=\"ml-2 text-xs opacity-80\">ðŸ”’</span>\r\n          )}\r\n        </span>\r\n        <div className=\"flex items-center gap-2\">\r\n          {!streaming && (\r\n            <>\r\n              <button\r\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"local\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\r\n                onClick={() => onModeSelect(\"local\")}\r\n              >\r\n                Local\r\n              </button>\r\n              <button\r\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"phone\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\r\n                onClick={() => onModeSelect(\"phone\")}\r\n              >\r\n                Phone\r\n              </button>\r\n              <button\r\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"wifi\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\r\n                onClick={() => onModeSelect(\"wifi\")}\r\n              >\r\n                WiFi\r\n              </button>\r\n              <button\r\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"wifi\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\r\n                onClick={() => onModeSelect(\"usb\")}\r\n              >\r\n                USB\r\n              </button>\r\n            </>\r\n          )}\r\n          {streaming ? (\r\n            <button\r\n              className=\"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all\"\r\n              onClick={stopAll}\r\n            >\r\n              Stop\r\n            </button>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n      {mode === \"phone\" && pairCode && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\r\n          <button\r\n            type=\"button\"\r\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\r\n            onClick={() => copyValue(mobileUrl, \"link\")}\r\n            title=\"Copy mobile camera link\"\r\n          >\r\n            <span className=\"flex-1 min-w-0 font-mono break-all\">\r\n              {mobileUrl}\r\n            </span>\r\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">\r\n              {copyFeedback === \"link\" ? \"Copied!\" : \"Copy\"}\r\n            </span>\r\n          </button>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <a\r\n              href={mobileUrl}\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\r\n            >\r\n              Open link\r\n            </a>\r\n            <button\r\n              type=\"button\"\r\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n              onClick={() => copyValue(pairCode, \"code\")}\r\n              title=\"Copy pairing code\"\r\n            >\r\n              <span className=\"font-mono tracking-[0.3em] text-sm\">\r\n                {pairCode}\r\n              </span>\r\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">\r\n                {copyFeedback === \"code\" ? \"Copied!\" : \"Copy\"}\r\n              </span>\r\n            </button>\r\n          </div>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <button\r\n              className=\"px-1 py-0.5 rounded bg-slate-700\"\r\n              onClick={regenerateCode}\r\n            >\r\n              Regenerate\r\n            </button>\r\n          </div>\r\n          {showTips && (\r\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\r\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\r\n              <ul className=\"list-disc pl-4 space-y-1\">\r\n                <li>Phone and desktop must be on the same Wiâ€‘Fi network.</li>\r\n                <li>\r\n                  Allow the server through your firewall (ports 8787 and{\" \"}\r\n                  {httpsInfo?.https ? httpsInfo.port : 8788}).\r\n                </li>\r\n                <li>\r\n                  On iPhone, use HTTPS links (QR will prefer https when\r\n                  enabled).\r\n                </li>\r\n              </ul>\r\n              <div className=\"mt-2 text-right\">\r\n                <button\r\n                  className=\"btn btn--ghost px-2 py-1 text-xs\"\r\n                  onClick={() => setShowTips(false)}\r\n                >\r\n                  Hide tips\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      {mode === \"wifi\" && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\r\n\r\n          {/* WiFi Devices */}\r\n          <div className=\"mb-3\">\r\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\r\n            {discoveringWifi ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning network...</span>\r\n              </div>\r\n            ) : wifiDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {wifiDevices.map((device: NetworkDevice) => (\r\n                  <div\r\n                    key={device.id}\r\n                    className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\"\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">\r\n                        {device.ip}:{device.port}\r\n                      </div>\r\n                    </div>\r\n                    <button\r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === \"connecting\"\r\n                          ? \"bg-yellow-600\"\r\n                          : device.status === \"online\"\r\n                            ? \"bg-green-600\"\r\n                            : \"bg-blue-600\"\r\n                      }`}\r\n                      onClick={() => connectToWifiDevice(device)}\r\n                      disabled={device.status === \"connecting\"}\r\n                    >\r\n                      {device.status === \"connecting\" ? \"...\" : \"Connect\"}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button\r\n                    className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\r\n                    onClick={startWifiConnection}\r\n                  >\r\n                    Rescan WiFi\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\r\n                <button\r\n                  className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\r\n                  onClick={startWifiConnection}\r\n                >\r\n                  Scan WiFi\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* USB Devices */}\r\n          <div>\r\n            <div className=\"font-medium mb-1\">USB Devices</div>\r\n            {discoveringUsb ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning USB...</span>\r\n              </div>\r\n            ) : usbDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {usbDevices.map((device: USBDevice) => (\r\n                  <div\r\n                    key={device.id}\r\n                    className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\"\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">\r\n                        {device.type.toUpperCase()}\r\n                      </div>\r\n                    </div>\r\n                    <button\r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === \"connecting\"\r\n                          ? \"bg-yellow-600\"\r\n                          : device.status === \"online\"\r\n                            ? \"bg-green-600\"\r\n                            : \"bg-blue-600\"\r\n                      }`}\r\n                      onClick={() => connectToUsbDevice(device)}\r\n                      disabled={device.status === \"connecting\"}\r\n                    >\r\n                      {device.status === \"connecting\" ? \"...\" : \"Connect\"}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button\r\n                    className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\r\n                    onClick={startUsbConnection}\r\n                  >\r\n                    Rescan USB\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\r\n                <button\r\n                  className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\r\n                  onClick={startUsbConnection}\r\n                >\r\n                  Scan USB\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {!streaming && (\r\n        <div className=\"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div>\r\n              <div className=\"text-[10px] uppercase tracking-wide text-slate-500\">\r\n                Camera modes\r\n              </div>\r\n              <div className=\"text-sm font-semibold text-slate-900\">\r\n                Reconnect camera\r\n              </div>\r\n            </div>\r\n            <span className=\"text-xs text-slate-500\">\r\n              Current: {modeDisplayName[mode] || \"Local\"}\r\n            </span>\r\n          </div>\r\n          <p className=\"text-xs text-slate-500 mb-2\">\r\n            Tap a mode to restart the feed or switch inputs.\r\n          </p>\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {reconnectOptions.map((option) => {\r\n              const isActive =\r\n                option.id === \"usb\" ? usbActive : option.id === mode;\r\n              return (\r\n                <button\r\n                  key={option.id}\r\n                  type=\"button\"\r\n                  onClick={option.action}\r\n                  className={`text-left p-3 rounded-2xl border ${isActive ? \"border-emerald-500 bg-emerald-50 shadow\" : \"border-slate-200 bg-white/80 hover:bg-slate-50\"} transition`}\r\n                >\r\n                  <div className=\"text-xs font-semibold uppercase tracking-wide text-slate-500\">\r\n                    {option.title}\r\n                  </div>\r\n                  <div className=\"text-[11px] text-slate-600 mt-1\">\r\n                    {option.description}\r\n                  </div>\r\n                  {isActive && (\r\n                    <div className=\"text-[10px] text-emerald-500 mt-2\">\r\n                      Active\r\n                    </div>\r\n                  )}\r\n                </button>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import type { Homography, Point } from \"./vision\";\r\nimport { imageToBoard, scoreAtBoardPoint } from \"./vision\";\r\n\r\nexport function scoreFromImagePoint(H_boardToImage: Homography, pImg: Point) {\r\n  const pBoard = imageToBoard(H_boardToImage, pImg);\r\n  return scoreAtBoardPoint(pBoard);\r\n}\r\n","// High-accuracy dart detector for built-in autoscore\r\n// Strategy:\r\n// - Maintain a grayscale background model (running average) when no darts are present\r\n// - For each frame, compute abs-diff mask vs background and apply a 3x3 morphological closing to reduce noise\r\n// - Restrict detection to a circular ROI around board center (from calibration) to ignore background\r\n// - Find the largest foreground blob; compute PCA on blob pixels to estimate shaft orientation\r\n// - Estimate the tip as the extreme along the principal axis in the outward radial direction from board center\r\n// - Stabilize across consecutive frames (2+) before emitting a detection; debounce between darts\r\n\r\nexport type Point = { x: number; y: number };\r\n\r\nexport type DartDetection = {\r\n  tip: Point;\r\n  axis?: { x1: number; y1: number; x2: number; y2: number };\r\n  area: number;\r\n  bbox: { x: number; y: number; w: number; h: number };\r\n  confidence: number; // 0..1 heuristic\r\n};\r\n\r\nexport class DartDetector {\r\n  private width = 0;\r\n  private height = 0;\r\n  private bg: Float32Array | null = null; // grayscale background\r\n  private lastAcceptTs = 0;\r\n  private cooldownMs = 600;\r\n  private roiRadius = 0; // pixels; 0 means disabled\r\n  private roiCx = 0;\r\n  private roiCy = 0;\r\n  private initialized = false;\r\n\r\n  // Tuning (defaults intentionally more permissive)\r\n  private thresh = 18; // intensity threshold for foreground (was 28)\r\n  private minArea = 60; // min connected pixels to consider a dart (was 90)\r\n  private maxArea = 6000; // guard against massive motion\r\n  private angMaxDeg = 70; // how far from radial to tolerate\r\n  // temporal stabilization\r\n  private prevTip: Point | null = null;\r\n  private prevArea: number = 0;\r\n  private stableCount = 0;\r\n  private requireStableN = 3;\r\n\r\n  constructor(cfg?: {\r\n    thresh?: number;\r\n    minArea?: number;\r\n    maxArea?: number;\r\n    requireStableN?: number;\r\n    angMaxDeg?: number;\r\n  }) {\r\n    if (cfg?.thresh !== undefined) this.thresh = cfg.thresh;\r\n    if (cfg?.minArea !== undefined) this.minArea = cfg.minArea;\r\n    if (cfg?.maxArea !== undefined) this.maxArea = cfg.maxArea;\r\n    if (cfg?.requireStableN !== undefined)\r\n      this.requireStableN = cfg.requireStableN;\r\n    if (cfg?.angMaxDeg !== undefined) this.angMaxDeg = cfg.angMaxDeg;\r\n  }\r\n\r\n  setROI(cx: number, cy: number, radius: number) {\r\n    this.roiCx = cx;\r\n    this.roiCy = cy;\r\n    this.roiRadius = Math.max(0, radius | 0);\r\n  }\r\n\r\n  reset(width: number, height: number) {\r\n    this.width = width;\r\n    this.height = height;\r\n    this.bg = new Float32Array(width * height);\r\n    this.initialized = false;\r\n  }\r\n\r\n  // Seed or update background model with the provided frame\r\n  // If not initialized, copy; else running average with small alpha\r\n  updateBackground(frame: ImageData, alpha = 0.05) {\r\n    const { width: w, height: h, data } = frame;\r\n    if (!this.bg || w !== this.width || h !== this.height) {\r\n      this.reset(w, h);\r\n    }\r\n    const bg = this.bg!;\r\n    const n = w * h;\r\n    for (let i = 0, p = 0; i < n; i++, p += 4) {\r\n      const r = data[p],\r\n        g = data[p + 1],\r\n        b = data[p + 2];\r\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\r\n      if (!this.initialized) bg[i] = gray;\r\n      else bg[i] = (1 - alpha) * bg[i] + alpha * gray;\r\n    }\r\n    this.initialized = true;\r\n  }\r\n\r\n  private inRoi(x: number, y: number): boolean {\r\n    if (this.roiRadius <= 0) return true;\r\n    const dx = x - this.roiCx;\r\n    const dy = y - this.roiCy;\r\n    return dx * dx + dy * dy <= this.roiRadius * this.roiRadius;\r\n  }\r\n\r\n  // Returns a detection if a new dart-like blob is found; null otherwise\r\n  detect(frame: ImageData): DartDetection | null {\r\n    const now = Date.now();\r\n    const recent = now - this.lastAcceptTs < this.cooldownMs;\r\n    const { width: w, height: h, data } = frame;\r\n    if (!this.bg || w !== this.width || h !== this.height) this.reset(w, h);\r\n    const bg = this.bg!;\r\n    if (!this.initialized) {\r\n      this.updateBackground(frame, 1.0);\r\n      return null;\r\n    }\r\n\r\n    // Build diff buffer and compute dynamic threshold excluding specular highlights\r\n    const n = w * h;\r\n    const mask = new Uint8Array(n);\r\n    const diff = new Float32Array(n);\r\n    let sum = 0,\r\n      sum2 = 0,\r\n      cnt = 0;\r\n    const isHighlight = new Uint8Array(n);\r\n    for (let i = 0, p = 0; i < n; i++, p += 4) {\r\n      const r = data[p],\r\n        g = data[p + 1],\r\n        b = data[p + 2];\r\n      const maxc = Math.max(r, g, b);\r\n      const minc = Math.min(r, g, b);\r\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\r\n      const d = Math.abs(gray - bg[i]);\r\n      diff[i] = d;\r\n      const y = Math.floor(i / w);\r\n      const x = i - y * w;\r\n      // specular highlight heuristic: very bright with low chroma\r\n      const satApprox = maxc === 0 ? 0 : (maxc - minc) / maxc;\r\n      const isHi = maxc >= 250 && satApprox <= 0.12;\r\n      if (isHi) isHighlight[i] = 1;\r\n      if (this.inRoi(x, y) && !isHi) {\r\n        sum += d;\r\n        sum2 += d * d;\r\n        cnt++;\r\n      }\r\n    }\r\n    const mu = cnt ? sum / cnt : 0;\r\n    const var_ = cnt ? Math.max(0, sum2 / cnt - mu * mu) : 0;\r\n    const sigma = Math.sqrt(var_);\r\n    const dynamicThresh = Math.max(this.thresh, mu + 1.2 * sigma);\r\n    // Rebuild mask using dynamic threshold and ignoring highlights\r\n    for (let i = 0; i < n; i++) {\r\n      if (isHighlight[i]) {\r\n        mask[i] = 0;\r\n        continue;\r\n      }\r\n      if (diff[i] > dynamicThresh) {\r\n        const y = Math.floor(i / w);\r\n        const x = i - y * w;\r\n        mask[i] = this.inRoi(x, y) ? 1 : 0;\r\n      }\r\n    }\r\n\r\n    // Morphological closing (dilate then erode) to consolidate thin shapes\r\n    this._dilate(mask, w, h);\r\n    this._erode(mask, w, h);\r\n\r\n    // Connected components (single pass using queue BFS); track largest blob\r\n    const visited = new Uint8Array(n);\r\n    let bestArea = 0;\r\n    let bestIdxs: number[] | null = null;\r\n    for (let i = 0; i < n; i++) {\r\n      if (mask[i] === 0 || visited[i]) continue;\r\n      const idxs: number[] = [];\r\n      let area = 0;\r\n      let qh = 0;\r\n      const q: number[] = [i];\r\n      visited[i] = 1;\r\n      while (qh < q.length) {\r\n        const cur = q[qh++];\r\n        idxs.push(cur);\r\n        area++;\r\n        const y = (cur / w) | 0;\r\n        const x = cur - y * w;\r\n        // 4-neighborhood\r\n        const nbs = [cur - 1, cur + 1, cur - w, cur + w];\r\n        for (const nb of nbs) {\r\n          if (nb < 0 || nb >= n) continue;\r\n          if (visited[nb]) continue;\r\n          // bounds checks for left/right\r\n          if ((nb === cur - 1 || nb === cur + 1) && ((nb / w) | 0) !== y)\r\n            continue;\r\n          if (mask[nb]) {\r\n            visited[nb] = 1;\r\n            q.push(nb);\r\n          }\r\n        }\r\n      }\r\n      if (area > bestArea) {\r\n        bestArea = area;\r\n        bestIdxs = idxs;\r\n      }\r\n    }\r\n\r\n    if (!bestIdxs || bestArea < this.minArea || bestArea > this.maxArea) {\r\n      // Slowly update background when no valid detection to adapt lighting\r\n      if (!recent) this.updateBackground(frame, 0.02);\r\n      return null;\r\n    }\r\n\r\n    // Compute PCA (covariance) on blob pixels to estimate shaft orientation\r\n    let minX = w,\r\n      minY = h,\r\n      maxX = 0,\r\n      maxY = 0;\r\n    let meanX = 0,\r\n      meanY = 0;\r\n    for (const idx of bestIdxs) {\r\n      const y = (idx / w) | 0;\r\n      const x = idx - y * w;\r\n      meanX += x;\r\n      meanY += y;\r\n      if (x < minX) minX = x;\r\n      if (x > maxX) maxX = x;\r\n      if (y < minY) minY = y;\r\n      if (y > maxY) maxY = y;\r\n    }\r\n    meanX /= bestArea;\r\n    meanY /= bestArea;\r\n    let cxx = 0,\r\n      cyy = 0,\r\n      cxy = 0;\r\n    for (const idx of bestIdxs) {\r\n      const y = (idx / w) | 0;\r\n      const x = idx - y * w;\r\n      const dx = x - meanX;\r\n      const dy = y - meanY;\r\n      cxx += dx * dx;\r\n      cyy += dy * dy;\r\n      cxy += dx * dy;\r\n    }\r\n    cxx /= bestArea;\r\n    cyy /= bestArea;\r\n    cxy /= bestArea;\r\n    // Principal axis (eigenvector of covariance with largest eigenvalue)\r\n    // For 2x2 symmetric matrix [[cxx,cxy],[cxy,cyy]], eigenvector for largest eigenvalue lambda satisfies (cxx-l)x + cxy y = 0\r\n    const trace = cxx + cyy;\r\n    const det = cxx * cyy - cxy * cxy;\r\n    const tmp = Math.sqrt(Math.max(0, (trace * trace) / 4 - det));\r\n    const l1 = trace / 2 + tmp; // largest eigenvalue\r\n    // eigenvector v = (cxy, l1 - cxx) or (l1 - cyy, cxy); choose longer\r\n    let vx = cxy,\r\n      vy = l1 - cxx;\r\n    if (Math.hypot(vx, vy) < 1e-6) {\r\n      vx = l1 - cyy;\r\n      vy = cxy;\r\n    }\r\n    const vlen = Math.hypot(vx, vy) || 1;\r\n    vx /= vlen;\r\n    vy /= vlen;\r\n\r\n    // Determine which direction along the axis points outward from board center\r\n    const dxc = meanX - this.roiCx;\r\n    const dyc = meanY - this.roiCy;\r\n    const outward = dxc * vx + dyc * vy > 0 ? 1 : -1;\r\n    vx *= outward;\r\n    vy *= outward;\r\n\r\n    // Enforce radial alignment: reject if principal axis deviates too much from radial direction\r\n    const rlen = Math.hypot(dxc, dyc) || 1;\r\n    const rx = dxc / rlen,\r\n      ry = dyc / rlen;\r\n    const cosAng = Math.max(-1, Math.min(1, vx * rx + vy * ry));\r\n    const angDeg = (Math.acos(cosAng) * 180) / Math.PI;\r\n  if (angDeg > this.angMaxDeg) {\r\n      // likely glare or non-radial artifact\r\n      if (!recent) this.updateBackground(frame, 0.02);\r\n      return null;\r\n    }\r\n\r\n    // Project all blob points onto axis and pick extreme (max t) as tip candidate\r\n    let maxT = -Infinity;\r\n    let tipX = meanX,\r\n      tipY = meanY;\r\n    for (const idx of bestIdxs) {\r\n      const y = (idx / w) | 0;\r\n      const x = idx - y * w;\r\n      const t = (x - meanX) * vx + (y - meanY) * vy;\r\n      if (t > maxT) {\r\n        maxT = t;\r\n        tipX = x;\r\n        tipY = y;\r\n      }\r\n    }\r\n\r\n    // Distance to center for confidence heuristic\r\n    const dxr = tipX - this.roiCx;\r\n    const dyr = tipY - this.roiCy;\r\n    const minR2 = dxr * dxr + dyr * dyr;\r\n\r\n    // Confidence heuristic based on compactness and radial extent\r\n    const bboxW = Math.max(1, maxX - minX + 1);\r\n    const bboxH = Math.max(1, maxY - minY + 1);\r\n    const bboxArea = bboxW * bboxH;\r\n    const fill = bestArea / bboxArea; // 0..1 (thin dart should be small fill)\r\n    const radial = Math.sqrt(minR2) / Math.max(1, this.roiRadius);\r\n    let confidence = 0.5;\r\n    // Prefer thin elongated shapes with small fill and inside ROI\r\n    if (fill < 0.45) confidence += 0.2;\r\n    if (fill < 0.25) confidence += 0.15;\r\n    if (radial < 1.1) confidence += 0.1;\r\n    // Orientation confidence: larger principal eigenvalue vs minor\r\n    const l2 = trace - l1;\r\n    const elong = l1 > 0 ? 1 - l2 / l1 : 0;\r\n    if (elong > 0.3) confidence += 0.1;\r\n    confidence = Math.max(0, Math.min(1, confidence));\r\n\r\n    // Update background outside the blob to keep stability\r\n    // Optionally, we can inpaint the blob into background upon acceptance by caller\r\n\r\n    // Temporal stabilization: require 2+ consistent frames for the same dart\r\n  const stable = this._isStable({ x: tipX + 0.5, y: tipY + 0.5 }, bestArea);\r\n    if (!stable) return null;\r\n    // Debounce\r\n    if (recent) return null;\r\n\r\n    return {\r\n      tip: { x: tipX + 0.5, y: tipY + 0.5 },\r\n      axis: {\r\n        x1: meanX - vx * 20,\r\n        y1: meanY - vy * 20,\r\n        x2: meanX + vx * 20,\r\n        y2: meanY + vy * 20,\r\n      },\r\n      area: bestArea,\r\n      bbox: { x: minX, y: minY, w: bboxW, h: bboxH },\r\n      confidence,\r\n    };\r\n  }\r\n\r\n  // Incorporate the accepted detection into background so it won't trigger again\r\n  accept(frame: ImageData, det: DartDetection) {\r\n    this.lastAcceptTs = Date.now();\r\n    // reset temporal stabilization for next dart\r\n    this.prevTip = null;\r\n    this.prevArea = 0;\r\n    this.stableCount = 0;\r\n    if (!this.bg) return;\r\n    const { width: w } = frame;\r\n    const bg = this.bg;\r\n    const { x, y, w: bw, h: bh } = det.bbox;\r\n    const alpha = 0.5;\r\n    for (let yy = y; yy < y + bh; yy++) {\r\n      for (let xx = x; xx < x + bw; xx++) {\r\n        const i = yy * w + xx;\r\n        const p = i * 4;\r\n        const r = frame.data[p],\r\n          g = frame.data[p + 1],\r\n          b = frame.data[p + 2];\r\n        const gray = 0.299 * r + 0.587 * g + 0.114 * b;\r\n        bg[i] = (1 - alpha) * bg[i] + alpha * gray;\r\n      }\r\n    }\r\n  }\r\n\r\n  // --- helpers ---\r\n  private _isStable(tip: Point, area: number): boolean {\r\n    const close = (a: Point, b: Point) => Math.hypot(a.x - b.x, a.y - b.y) <= 6;\r\n    if (!this.prevTip) {\r\n      this.prevTip = { ...tip };\r\n      this.prevArea = area;\r\n      this.stableCount = 1;\r\n      return false;\r\n    }\r\n    if (\r\n      close(this.prevTip, tip) &&\r\n      Math.abs(area - this.prevArea) / Math.max(1, area) < 0.3\r\n    ) {\r\n      this.prevTip = { ...tip };\r\n      this.prevArea = area;\r\n      this.stableCount++;\r\n    } else {\r\n      this.prevTip = { ...tip };\r\n      this.prevArea = area;\r\n      this.stableCount = 1;\r\n      return false;\r\n    }\r\n    return this.stableCount >= this.requireStableN;\r\n  }\r\n\r\n  private _dilate(mask: Uint8Array, w: number, h: number) {\r\n    const out = new Uint8Array(mask.length);\r\n    for (let y = 0; y < h; y++) {\r\n      for (let x = 0; x < w; x++) {\r\n        let on = 0;\r\n        for (let j = -1; j <= 1; j++) {\r\n          for (let i = -1; i <= 1; i++) {\r\n            const yy = y + j,\r\n              xx = x + i;\r\n            if (yy < 0 || yy >= h || xx < 0 || xx >= w) continue;\r\n            if (mask[yy * w + xx]) {\r\n              on = 1;\r\n              break;\r\n            }\r\n          }\r\n          if (on) break;\r\n        }\r\n        out[y * w + x] = on;\r\n      }\r\n    }\r\n    mask.set(out);\r\n  }\r\n\r\n  private _erode(mask: Uint8Array, w: number, h: number) {\r\n    const out = new Uint8Array(mask.length);\r\n    for (let y = 0; y < h; y++) {\r\n      for (let x = 0; x < w; x++) {\r\n        let on = 1;\r\n        for (let j = -1; j <= 1; j++) {\r\n          for (let i = -1; i <= 1; i++) {\r\n            const yy = y + j,\r\n              xx = x + i;\r\n            if (yy < 0 || yy >= h || xx < 0 || xx >= w) continue;\r\n            if (!mask[yy * w + xx]) {\r\n              on = 0;\r\n              break;\r\n            }\r\n          }\r\n          if (!on) break;\r\n        }\r\n        out[y * w + x] = on;\r\n      }\r\n    }\r\n    mask.set(out);\r\n  }\r\n}\r\n","// Generic autoscore provider helpers: parse vendor-agnostic payloads and subscribe via WebSocket\r\n\r\nexport type Ring =\r\n  | \"MISS\"\r\n  | \"SINGLE\"\r\n  | \"DOUBLE\"\r\n  | \"TRIPLE\"\r\n  | \"BULL\"\r\n  | \"INNER_BULL\";\r\nexport type ParsedDart = {\r\n  value: number;\r\n  ring: Ring;\r\n  sector?: number | null;\r\n  mult?: 0 | 1 | 2 | 3;\r\n};\r\n\r\n// Try to parse a variety of vendor payload shapes\r\nexport function parseExternalDart(data: any): ParsedDart | null {\r\n  try {\r\n    if (!data || typeof data !== \"object\") return null;\r\n    // 1) { type:'dart', value: <0-60>, ring: 'SINGLE'|'DOUBLE'|... }\r\n    if (\r\n      (data.type === \"dart\" || data.kind === \"dart\" || data.event === \"dart\") &&\r\n      typeof data.value === \"number\"\r\n    ) {\r\n      const ring = normalizeRing(data.ring);\r\n      return finalizeFromValue(data.value, ring);\r\n    }\r\n    // 2) { value, ring }\r\n    if (typeof data.value === \"number\" && data.ring) {\r\n      const ring = normalizeRing(data.ring);\r\n      return finalizeFromValue(data.value, ring);\r\n    }\r\n    // 3) { score: 'T20'|'D16'|'S5'|'25'|'50' }\r\n    if (typeof data.score === \"string\") {\r\n      const s = data.score.trim().toUpperCase();\r\n      if (s === \"50\" || s === \"DBULL\" || s === \"INNER_BULL\")\r\n        return { value: 50, ring: \"INNER_BULL\", sector: null, mult: 0 };\r\n      if (s === \"25\" || s === \"BULL\" || s === \"OBULL\")\r\n        return { value: 25, ring: \"BULL\", sector: null, mult: 0 };\r\n      const m = s.match(/^(S|D|T)(\\d{1,2})$/);\r\n      if (m) {\r\n        const mult = m[1] === \"S\" ? 1 : m[1] === \"D\" ? 2 : 3;\r\n        const sec = parseInt(m[2], 10);\r\n        if (sec >= 1 && sec <= 20)\r\n          return {\r\n            value: sec * mult,\r\n            ring: mult === 1 ? \"SINGLE\" : mult === 2 ? \"DOUBLE\" : \"TRIPLE\",\r\n            sector: sec,\r\n            mult: mult as 1 | 2 | 3,\r\n          };\r\n      }\r\n    }\r\n    // 4) { sector: 1..20, mult: 1|2|3 }\r\n    if (typeof data.sector === \"number\" && typeof data.mult === \"number\") {\r\n      const sec = Math.max(1, Math.min(20, Math.floor(data.sector)));\r\n      const mul = data.mult === 1 ? 1 : data.mult === 2 ? 2 : 3;\r\n      return {\r\n        value: sec * mul,\r\n        ring: mul === 1 ? \"SINGLE\" : mul === 2 ? \"DOUBLE\" : \"TRIPLE\",\r\n        sector: sec,\r\n        mult: mul as 1 | 2 | 3,\r\n      };\r\n    }\r\n    // 5) { bull: 'outer'|'inner'|true }\r\n    if (data.bull) {\r\n      const inner =\r\n        String(data.bull).toLowerCase() === \"inner\" || data.bull === true;\r\n      return {\r\n        value: inner ? 50 : 25,\r\n        ring: inner ? \"INNER_BULL\" : \"BULL\",\r\n        sector: null,\r\n        mult: 0,\r\n      };\r\n    }\r\n  } catch {}\r\n  return null;\r\n}\r\n\r\nfunction normalizeRing(r: any): Ring {\r\n  const s = String(r || \"\").toUpperCase();\r\n  if (s.startsWith(\"TR\")) return \"TRIPLE\";\r\n  if (s.startsWith(\"DO\")) return \"DOUBLE\";\r\n  if (s.startsWith(\"SI\")) return \"SINGLE\";\r\n  if (s === \"INNER_BULL\" || s === \"DBULL\" || s === \"50\" || s === \"IBULL\")\r\n    return \"INNER_BULL\";\r\n  if (s === \"BULL\" || s === \"25\" || s === \"OBULL\" || s === \"OUTER_BULL\")\r\n    return \"BULL\";\r\n  if (s === \"MISS\" || s === \"0\") return \"MISS\";\r\n  return \"SINGLE\";\r\n}\r\n\r\nfunction finalizeFromValue(value: number, ring: Ring): ParsedDart | null {\r\n  const v = Math.max(0, Math.min(60, Math.round(Number(value) || 0)));\r\n  if (ring === \"INNER_BULL\") return { value: 50, ring };\r\n  if (ring === \"BULL\") return { value: 25, ring };\r\n  // Best-effort: preserve base if consistent with ring\r\n  return { value: v, ring };\r\n}\r\n\r\nexport type ExternalSub = { close: () => void };\r\n\r\nexport function subscribeExternalWS(\r\n  url: string,\r\n  onDart: (d: ParsedDart) => void,\r\n): ExternalSub {\r\n  let socket: WebSocket | null = null;\r\n  let alive = true;\r\n  // Lightweight duplicate suppression: ignore exact repeat within a short window\r\n  let lastSig: string | null = null;\r\n  let lastSigAt = 0;\r\n  const DEDUP_WINDOW_MS = 400;\r\n  // Optional ID-based dedup if provider sends unique ids\r\n  const seenIds: string[] = [];\r\n  const seenSet = new Set<string>();\r\n\r\n  function considerForward(payload: any, parsed: ParsedDart) {\r\n    // If payload has a stable id, drop if seen\r\n    const pid =\r\n      typeof payload?.id === \"string\" || typeof payload?.id === \"number\"\r\n        ? String(payload.id)\r\n        : null;\r\n    if (pid) {\r\n      if (seenSet.has(pid)) return;\r\n      seenSet.add(pid);\r\n      seenIds.push(pid);\r\n      if (seenIds.length > 200) {\r\n        const old = seenIds.shift();\r\n        if (old) seenSet.delete(old);\r\n      }\r\n    }\r\n    // Time-based dedup by signature (safe; darts cannot occur within <400ms)\r\n    const sig = `${parsed.value}|${parsed.ring}|${parsed.sector ?? \"\"}|${parsed.mult ?? \"\"}`;\r\n    const now = Date.now();\r\n    if (sig === lastSig && now - lastSigAt < DEDUP_WINDOW_MS) return;\r\n    lastSig = sig;\r\n    lastSigAt = now;\r\n    onDart(parsed);\r\n  }\r\n\r\n  function connect() {\r\n    if (!alive) return;\r\n    try {\r\n      socket = new WebSocket(url);\r\n      socket.onmessage = (ev) => {\r\n        try {\r\n          const payload = JSON.parse(ev.data);\r\n          const parsed = parseExternalDart(payload);\r\n          if (parsed) considerForward(payload, parsed);\r\n        } catch {}\r\n      };\r\n      socket.onclose = () => {\r\n        socket = null;\r\n        setTimeout(connect, 1500);\r\n      };\r\n      socket.onerror = () => {\r\n        /* ignore; will reconnect on close */\r\n      };\r\n    } catch {\r\n      setTimeout(connect, 2000);\r\n    }\r\n  }\r\n  connect();\r\n  return {\r\n    close: () => {\r\n      alive = false;\r\n      try {\r\n        socket?.close();\r\n      } catch {}\r\n    },\r\n  };\r\n}\r\n","import React, {\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n  type ReactNode,\r\n  type CSSProperties,\r\n} from \"react\";\r\n\r\ntype Props = {\r\n  storageKey: string;\r\n  children: ReactNode;\r\n  className?: string;\r\n  defaultWidth?: number;\r\n  defaultHeight?: number;\r\n  minWidth?: number;\r\n  minHeight?: number;\r\n  maxWidth?: number;\r\n  maxHeight?: number;\r\n  autoFill?: boolean;\r\n};\r\n\r\ntype Size = { width?: number; height?: number };\r\n\r\nexport default function ResizablePanel({\r\n  storageKey,\r\n  children,\r\n  className,\r\n  defaultWidth = 640,\r\n  defaultHeight = 360,\r\n  minWidth = 320,\r\n  minHeight = 200,\r\n  maxWidth = 1600,\r\n  maxHeight = 1200,\r\n  autoFill = false,\r\n}: Props) {\r\n  const [size, setSize] = useState<Size>(() => {\r\n    try {\r\n      const raw = localStorage.getItem(storageKey);\r\n      if (raw) return JSON.parse(raw);\r\n    } catch {}\r\n    // If autoFill is requested, don't persist a fixed height â€” let CSS stretch the panel\r\n    return autoFill\r\n      ? { width: defaultWidth }\r\n      : { width: defaultWidth, height: defaultHeight };\r\n  });\r\n  const startRef = useRef<{\r\n    x: number;\r\n    y: number;\r\n    w: number;\r\n    h: number;\r\n    dir: string;\r\n  } | null>(null);\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    function onReset() {\r\n      try {\r\n        localStorage.removeItem(storageKey);\r\n      } catch {}\r\n      setSize({ width: defaultWidth, height: defaultHeight });\r\n    }\r\n    window.addEventListener(\"ndn:layout-reset\" as any, onReset);\r\n    window.addEventListener(\"ndn:camera-reset\" as any, onReset);\r\n    return () => {\r\n      window.removeEventListener(\"ndn:layout-reset\" as any, onReset);\r\n      window.removeEventListener(\"ndn:camera-reset\" as any, onReset);\r\n    };\r\n  }, [storageKey, defaultWidth, defaultHeight]);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem(storageKey, JSON.stringify(size));\r\n    } catch {}\r\n  }, [size, storageKey]);\r\n\r\n  function clamp(n: number, min: number, max: number) {\r\n    return Math.max(min, Math.min(max, n));\r\n  }\r\n  function beginResize(e: React.MouseEvent, dir: string) {\r\n    e.preventDefault();\r\n    const el = containerRef.current;\r\n    if (!el) return;\r\n    const rect = el.getBoundingClientRect();\r\n    startRef.current = {\r\n      x: e.clientX,\r\n      y: e.clientY,\r\n      w: rect.width,\r\n      h: rect.height,\r\n      dir,\r\n    };\r\n    window.addEventListener(\"mousemove\", onMove);\r\n    window.addEventListener(\"mouseup\", endResize);\r\n  }\r\n  function onMove(e: globalThis.MouseEvent) {\r\n    const s = startRef.current;\r\n    if (!s) return;\r\n    const dx = e.clientX - s.x;\r\n    const dy = e.clientY - s.y;\r\n    let w = s.w;\r\n    let h = s.h;\r\n    if (s.dir.includes(\"e\")) w = clamp(s.w + dx, minWidth, maxWidth);\r\n    // If autoFill is enabled, ignore vertical resizing (panel should fill parent)\r\n    if (!autoFill && s.dir.includes(\"s\"))\r\n      h = clamp(s.h + dy, minHeight, maxHeight);\r\n    if (s.dir.includes(\"w\")) w = clamp(s.w - dx, minWidth, maxWidth);\r\n    if (!autoFill && s.dir.includes(\"n\"))\r\n      h = clamp(s.h - dy, minHeight, maxHeight);\r\n    setSize({ width: Math.round(w), height: Math.round(h) });\r\n  }\r\n  function endResize() {\r\n    window.removeEventListener(\"mousemove\", onMove);\r\n    window.removeEventListener(\"mouseup\", endResize);\r\n    startRef.current = null;\r\n  }\r\n\r\n  function handleKeyResize(e: React.KeyboardEvent, dir: string) {\r\n    const step = 20;\r\n    const k = e.key;\r\n    if (\r\n      ![\r\n        \"ArrowLeft\",\r\n        \"ArrowRight\",\r\n        \"ArrowUp\",\r\n        \"ArrowDown\",\r\n        \"Enter\",\r\n        \" \",\r\n      ].includes(k)\r\n    )\r\n      return;\r\n    e.preventDefault();\r\n    const delta = k === \"ArrowLeft\" || k === \"ArrowUp\" ? -step : step;\r\n    setSize((s) => {\r\n      const curW = s.width || defaultWidth;\r\n      const curH = s.height || defaultHeight;\r\n      let w = curW;\r\n      let h = curH;\r\n      if (dir.includes(\"e\")) w = clamp(curW + delta, minWidth, maxWidth);\r\n      if (dir.includes(\"w\")) w = clamp(curW - delta, minWidth, maxWidth);\r\n      if (!autoFill && dir.includes(\"s\"))\r\n        h = clamp(curH + delta, minHeight, maxHeight);\r\n      if (!autoFill && dir.includes(\"n\"))\r\n        h = clamp(curH - delta, minHeight, maxHeight);\r\n      return { width: Math.round(w), height: Math.round(h) };\r\n    });\r\n  }\r\n\r\n  const style: CSSProperties = {\r\n    width: autoFill ? \"100%\" : size.width ? `${size.width}px` : undefined,\r\n    height: autoFill ? \"100%\" : size.height ? `${size.height}px` : undefined,\r\n    maxWidth: \"100%\",\r\n    // Allow the panel to fill the parent when autoFill is enabled. Otherwise keep a sensible cap.\r\n    maxHeight: autoFill ? \"100%\" : \"80vh\",\r\n    position: \"relative\",\r\n    // Make it participate in flex layouts when filling\r\n    ...(autoFill\r\n      ? { display: \"flex\", flexDirection: \"column\", flex: \"1 1 auto\" }\r\n      : {}),\r\n  };\r\n\r\n  return (\r\n    <div ref={containerRef} className={`${className || \"\"}`} style={style}>\r\n      {children}\r\n      <div\r\n        className=\"resizer resizer-nw\"\r\n        onMouseDown={(e) => beginResize(e, \"nw\")}\r\n        role=\"button\"\r\n        tabIndex={0}\r\n        aria-label=\"Resize north-west\"\r\n        onKeyDown={(e) => handleKeyResize(e, \"nw\")}\r\n      />\r\n      <div\r\n        className=\"resizer resizer-ne\"\r\n        onMouseDown={(e) => beginResize(e, \"ne\")}\r\n        role=\"button\"\r\n        tabIndex={0}\r\n        aria-label=\"Resize north-east\"\r\n        onKeyDown={(e) => handleKeyResize(e, \"ne\")}\r\n      />\r\n      <div\r\n        className=\"resizer resizer-sw\"\r\n        onMouseDown={(e) => beginResize(e, \"sw\")}\r\n        role=\"button\"\r\n        tabIndex={0}\r\n        aria-label=\"Resize south-west\"\r\n        onKeyDown={(e) => handleKeyResize(e, \"sw\")}\r\n      />\r\n      <div\r\n        className=\"resizer resizer-se\"\r\n        onMouseDown={(e) => beginResize(e, \"se\")}\r\n        role=\"button\"\r\n        tabIndex={0}\r\n        aria-label=\"Resize south-east\"\r\n        onKeyDown={(e) => handleKeyResize(e, \"se\")}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import { create } from \"zustand\";\r\n\r\nexport type HeatSample = {\r\n  playerId: string | null;\r\n  sector: number | null;\r\n  mult: 0 | 1 | 2 | 3;\r\n  ring: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\";\r\n  ts: number;\r\n};\r\n\r\ntype HeatState = {\r\n  samples: HeatSample[];\r\n  addSample: (s: HeatSample) => void;\r\n  clear: () => void;\r\n  export: () => HeatSample[];\r\n};\r\n\r\nexport const useHeatmapStore = create<HeatState>((set, get) => ({\r\n  samples: [],\r\n  addSample: (s) => set((state) => ({ samples: [...state.samples, s] })),\r\n  clear: () => set({ samples: [] }),\r\n  export: () => get().samples.slice(),\r\n}));\r\n\r\nexport default useHeatmapStore;\r\n","import { create } from \"zustand\";\r\n\r\ntype MatchControlState = {\r\n  paused: boolean;\r\n  pauseEndsAt: number | null;\r\n  setPaused: (v: boolean, endsAt?: number | null) => void;\r\n};\r\n\r\nexport const useMatchControl = create<MatchControlState>((set) => ({\r\n  paused: false,\r\n  pauseEndsAt: null,\r\n  setPaused: (v, endsAt = null) =>\r\n    set({ paused: v, pauseEndsAt: endsAt ?? null }),\r\n}));\r\n","import {\r\n  useCallback,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n  forwardRef,\r\n  useImperativeHandle,\r\n} from \"react\";\r\nimport { dlog } from \"../utils/logger\";\r\nimport { useUserSettings } from \"../store/userSettings\";\r\nimport { useCalibration } from \"../store/calibration\";\r\nimport { useMatch } from \"../store/match\";\r\nimport {\r\n  BoardRadii,\r\n  drawPolyline,\r\n  sampleRing,\r\n  scaleHomography,\r\n  type Point,\r\n  applyHomography,\r\n  drawCross,\r\n  refinePointSobel,\r\n} from \"../utils/vision\";\r\nimport { scoreFromImagePoint } from \"../utils/autoscore\";\r\nimport { DartDetector } from \"../utils/dartDetector\";\r\nimport { addSample } from \"../store/profileStats\";\r\nimport { subscribeExternalWS } from \"../utils/scoring\";\r\nimport ResizablePanel from \"./ui/ResizablePanel\";\r\nimport ResizableModal from \"./ui/ResizableModal\";\r\nimport FocusLock from \"react-focus-lock\";\r\nimport useHeatmapStore from \"../store/heatmap\";\r\nimport { usePendingVisit } from \"../store/pendingVisit\";\r\nimport { useCameraSession } from \"../store/cameraSession\";\r\nimport { useMatchControl } from \"../store/matchControl\";\r\nimport { useAudit } from \"../store/audit\";\r\n\r\n// Shared ring type across autoscore/manual flows\r\ntype Ring = \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\";\r\n\r\nconst AUTO_COMMIT_MIN_FRAMES = 1;\r\nconst AUTO_COMMIT_HOLD_MS = 120;\r\nconst AUTO_COMMIT_COOLDOWN_MS = process.env.NODE_ENV === \"test\" ? 0 : 400;\r\nconst AUTO_STREAM_IGNORE_MS = process.env.NODE_ENV === \"test\" ? 0 : 450;\r\nconst DETECTION_ARM_DELAY_MS = process.env.NODE_ENV === \"test\" ? 0 : 5000;\r\nconst DETECTION_MIN_FRAMES = process.env.NODE_ENV === \"test\" ? 0 : 150;\r\nconst AUTO_COMMIT_CONFIDENCE = 0.85;\r\nconst BOARD_CLEAR_GRACE_MS = 6500;\r\nconst DISABLE_CAMERA_OVERLAY = true;\r\n\r\ntype AutoCandidate = {\r\n  value: number;\r\n  ring: Ring;\r\n  label: string;\r\n  sector: number | null;\r\n  mult: 0 | 1 | 2 | 3;\r\n  firstTs: number;\r\n  frames: number;\r\n};\r\n\r\ntype DetectionLogEntry = {\r\n  ts: number;\r\n  label: string;\r\n  value: number;\r\n  ring: Ring;\r\n  confidence: number;\r\n  ready: boolean;\r\n  accepted: boolean;\r\n  warmup: boolean;\r\n  pCal?: Point;\r\n  tip?: Point;\r\n};\r\n\r\nexport type CameraViewHandle = {\r\n  runDetectionTick: () => void;\r\n};\r\n\r\nexport default forwardRef(function CameraView(\r\n  {\r\n  onVisitCommitted,\r\n  showToolbar = true,\r\n  onAutoDart,\r\n  immediateAutoCommit = false,\r\n  hideInlinePanels = false,\r\n  scoringMode = \"x01\",\r\n  onGenericDart,\r\n  onGenericReplace,\r\n  x01DoubleInOverride,\r\n  onAddVisit,\r\n  onEndLeg,\r\n  cameraAutoCommit = \"parent\",\r\n  }: {\r\n  onVisitCommitted?: (score: number, darts: number, finished: boolean) => void;\r\n  showToolbar?: boolean;\r\n  onAutoDart?: (\r\n    value: number,\r\n    ring: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    info?: { sector: number | null; mult: 0 | 1 | 2 | 3 },\r\n  ) => boolean | void | Promise<boolean | void>;\r\n  immediateAutoCommit?: boolean;\r\n  hideInlinePanels?: boolean;\r\n  scoringMode?: \"x01\" | \"custom\";\r\n  onGenericDart?: (value: number, ring: Ring, meta: { label: string }) => void;\r\n  onGenericReplace?: (\r\n    value: number,\r\n    ring: Ring,\r\n    meta: { label: string },\r\n  ) => void;\r\n  x01DoubleInOverride?: boolean;\r\n  onAddVisit?: (score: number, darts: number, meta?: any) => void;\r\n  onEndLeg?: (score?: number) => void;\r\n    cameraAutoCommit?: \"camera\" | \"parent\" | \"both\";\r\n  },\r\n  ref: any,\r\n) {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const {\r\n    preferredCameraId,\r\n    preferredCameraLabel,\r\n    setPreferredCamera,\r\n    autoscoreProvider,\r\n    autoscoreWsUrl,\r\n    cameraAspect,\r\n    cameraFitMode,\r\n    autoCommitMode = \"wait-for-clear\",\r\n    cameraEnabled,\r\n    setCameraEnabled,\r\n    preferredCameraLocked,\r\n    hideCameraOverlay,\r\n    setHideCameraOverlay,\r\n  } = useUserSettings();\r\n  const preserveCalibrationOverlay = useUserSettings((s) => s.preserveCalibrationOverlay);\r\n  const manualOnly = autoscoreProvider === \"manual\";\r\n  const [availableCameras, setAvailableCameras] = useState<MediaDeviceInfo[]>(\r\n    [],\r\n  );\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const overlayRef = useRef<HTMLCanvasElement>(null);\r\n  const [streaming, setStreaming] = useState(false);\r\n  const cameraSession = useCameraSession();\r\n  const isPhoneCamera = preferredCameraLabel === \"Phone Camera\";\r\n  const sessionStream = cameraSession.getMediaStream?.() || null;\r\n  const sessionStreaming = cameraSession.isStreaming;\r\n  const phoneFeedActive =\r\n    isPhoneCamera &&\r\n    cameraSession.mode === \"phone\" &&\r\n    sessionStreaming &&\r\n    !!sessionStream;\r\n  const effectiveStreaming = streaming || sessionStreaming || process.env.NODE_ENV === \"test\";\r\n  const [cameraStarting, setCameraStarting] = useState(false);\r\n  const [snapshotUrl, setSnapshotUrl] = useState<string | null>(null);\r\n  const { H, imageSize, overlaySize, reset: resetCalibration, _hydrated, locked } = useCalibration();\r\n  useEffect(() => {\r\n    if (preferredCameraLocked && !hideCameraOverlay) {\r\n      setHideCameraOverlay(true);\r\n    }\r\n  }, [preferredCameraLocked, hideCameraOverlay, setHideCameraOverlay]);\r\n  const [lastAutoScore, setLastAutoScore] = useState<string>(\"\");\r\n  const [manualScore, setManualScore] = useState<string>(\"\");\r\n  const [lastAutoValue, setLastAutoValue] = useState<number>(0);\r\n  const [lastAutoRing, setLastAutoRing] = useState<Ring>(\"MISS\");\r\n  const [pendingDarts, setPendingDarts] = useState<number>(0);\r\n  const [pendingScore, setPendingScore] = useState<number>(0);\r\n  const [pendingEntries, setPendingEntries] = useState<\r\n    { label: string; value: number; ring: Ring }[]\r\n  >([]);\r\n  const [pendingPreOpenDarts, setPendingPreOpenDarts] = useState<number>(0);\r\n  const [pendingDartsAtDouble, setPendingDartsAtDouble] = useState<number>(0);\r\n  const [awaitingClear, setAwaitingClear] = useState(false);\r\n  const pendingCommitRef = useRef<{\r\n    score: number;\r\n    darts: number;\r\n    finished: boolean;\r\n  } | null>(null);\r\n  const pendingCommitTimerRef = useRef<number | null>(null);\r\n  const shouldDeferCommit =\r\n    !immediateAutoCommit && autoCommitMode !== \"immediate\";\r\n  const [indicatorVersion, setIndicatorVersion] = useState(0);\r\n  const [indicatorEntryVersions, setIndicatorEntryVersions] = useState<\r\n    number[]\r\n  >([]);\r\n  const autoCandidateRef = useRef<AutoCandidate | null>(null);\r\n  const detectionLogRef = useRef<DetectionLogEntry[]>([]);\r\n  const lastAutoCommitRef = useRef<number>(0);\r\n  const streamingStartMsRef = useRef<number>(0);\r\n  const detectionArmedRef = useRef<boolean>(false);\r\n  const detectionArmTimerRef = useRef<number | null>(null);\r\n  const frameCountRef = useRef<number>(0);\r\n  const tickRef = useRef<() => void | null>(null);\r\n  const [detectionLog, setDetectionLog] = useState<DetectionLogEntry[]>([]);\r\n  const [showDetectionLog, setShowDetectionLog] = useState(false);\r\n  const clearPendingCommitTimer = useCallback(() => {\r\n    if (pendingCommitTimerRef.current) {\r\n      clearTimeout(pendingCommitTimerRef.current);\r\n      pendingCommitTimerRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  useImperativeHandle(ref, () => ({\r\n    runDetectionTick: () => {\r\n      try {\r\n        if (tickRef.current) tickRef.current();\r\n      } catch {}\r\n    },\r\n  }));\r\n\r\n  const captureDetectionLog = useCallback((entry: DetectionLogEntry) => {\r\n    const next = [...detectionLogRef.current.slice(-8), entry];\r\n    detectionLogRef.current = next;\r\n    setDetectionLog(next);\r\n    try {\r\n      (window as any).ndnCameraDiagnostics = next;\r\n    } catch {}\r\n  }, []);\r\n  const finalizePendingCommit = useCallback(\r\n    (_trigger: \"event\" | \"timeout\" | \"teardown\") => {\r\n      const pending = pendingCommitRef.current;\r\n      if (!pending) return;\r\n      pendingCommitRef.current = null;\r\n      clearPendingCommitTimer();\r\n      setAwaitingClear(false);\r\n      if (onVisitCommitted) {\r\n        try {\r\n          onVisitCommitted(pending.score, pending.darts, pending.finished);\r\n        } catch {}\r\n      }\r\n    },\r\n    [onVisitCommitted, clearPendingCommitTimer],\r\n  );\r\n  const enqueueVisitCommit = useCallback(\r\n    (payload: { score: number; darts: number; finished: boolean }) => {\r\n      if (!onVisitCommitted) return;\r\n      if (!shouldDeferCommit) {\r\n        try {\r\n          onVisitCommitted(payload.score, payload.darts, payload.finished);\r\n        } catch {}\r\n        return;\r\n      }\r\n      pendingCommitRef.current = payload;\r\n      setAwaitingClear(true);\r\n      clearPendingCommitTimer();\r\n      pendingCommitTimerRef.current = window.setTimeout(\r\n        () => finalizePendingCommit(\"timeout\"),\r\n        BOARD_CLEAR_GRACE_MS,\r\n      );\r\n    },\r\n    [\r\n      onVisitCommitted,\r\n      shouldDeferCommit,\r\n      clearPendingCommitTimer,\r\n      finalizePendingCommit,\r\n    ],\r\n  );\r\n  const clearPendingManual = useCallback((reason: \"indicator\" | \"toolbar\") => {\r\n    setPendingDarts(0);\r\n    setPendingScore(0);\r\n    setPendingEntries([]);\r\n    setPendingPreOpenDarts(0);\r\n    setPendingDartsAtDouble(0);\r\n    setHadRecentAuto(false);\r\n    try {\r\n      window.dispatchEvent(\r\n        new CustomEvent(\"ndn:clear-visit-request\", {\r\n          detail: { source: \"camera-view\", reason, ts: Date.now() },\r\n        }),\r\n      );\r\n    } catch {}\r\n  }, []);\r\n  useEffect(() => {\r\n    if (!shouldDeferCommit) return;\r\n    const handler = () => finalizePendingCommit(\"event\");\r\n    window.addEventListener(\"ndn:darts-cleared\", handler as EventListener);\r\n    return () =>\r\n      window.removeEventListener(\"ndn:darts-cleared\", handler as EventListener);\r\n  }, [shouldDeferCommit, finalizePendingCommit]);\r\n  useEffect(() => {\r\n    if (!shouldDeferCommit) finalizePendingCommit(\"timeout\");\r\n  }, [shouldDeferCommit, finalizePendingCommit]);\r\n  useEffect(\r\n    () => () => finalizePendingCommit(\"teardown\"),\r\n    [finalizePendingCommit],\r\n  );\r\n  const handleIndicatorReset = useCallback(() => {\r\n    clearPendingManual(\"indicator\");\r\n    setIndicatorVersion((v) => v + 1);\r\n  }, [clearPendingManual]);\r\n  const handleToolbarClear = useCallback(() => {\r\n    if (pendingDarts === 0 && pendingScore === 0) return;\r\n    clearPendingManual(\"toolbar\");\r\n    setIndicatorVersion((v) => v + 1);\r\n  }, [clearPendingManual, pendingDarts, pendingScore]);\r\n  const requestDeviceManager = useCallback(() => {\r\n    if (manualOnly) return;\r\n    try {\r\n      window.dispatchEvent(\r\n        new CustomEvent(\"ndn:open-camera-manager\", {\r\n          detail: { source: \"camera-view\", ts: Date.now() },\r\n        }),\r\n      );\r\n    } catch (err) {\r\n      console.warn(\"[CameraView] Failed to request camera manager:\", err);\r\n    }\r\n  }, [manualOnly]);\r\n  // X01 Double-In handling: per-player opened state in this session\r\n  const x01DoubleInSetting = useUserSettings((s) => s.x01DoubleIn);\r\n  const x01DoubleIn =\r\n    typeof x01DoubleInOverride === \"boolean\"\r\n      ? !!x01DoubleInOverride\r\n      : !!x01DoubleInSetting;\r\n  const [openedById, setOpenedById] = useState<Record<string, boolean>>({});\r\n  const matchState = useMatch((s) => s);\r\n  const currentPlayerId = matchState.players[matchState.currentPlayerIdx]?.id;\r\n  const isOpened = !!(currentPlayerId && openedById[currentPlayerId]);\r\n  const setOpened = (v: boolean) => {\r\n    if (!currentPlayerId) return;\r\n    setOpenedById((m) => ({ ...m, [currentPlayerId]: v }));\r\n  };\r\n  const inProgress = (matchState as any)?.inProgress;\r\n  // Broadcast pending visit to global store so Scoreboard can visualize dots\r\n  const setVisit = usePendingVisit((s) => s.setVisit);\r\n  const resetPendingVisit = usePendingVisit((s) => s.reset);\r\n  useEffect(() => {\r\n    try {\r\n      setVisit(pendingEntries as any, pendingDarts, pendingScore);\r\n    } catch {}\r\n  }, [pendingEntries, pendingDarts, pendingScore, setVisit]);\r\n  useEffect(\r\n    () => () => {\r\n      try {\r\n        resetPendingVisit();\r\n      } catch {}\r\n    },\r\n    [resetPendingVisit],\r\n  );\r\n  const addVisit = useMatch((s) => s.addVisit);\r\n  const endLeg = useMatch((s) => s.endLeg);\r\n  // Prefer provided adapters (matchActions wrappers) when available\r\n  const callAddVisit = (score: number, darts: number, meta?: any) => {\r\n    try {\r\n      if (onAddVisit) onAddVisit(score, darts, meta);\r\n      else addVisit(score, darts, meta);\r\n    } catch {\r\n      /* noop */\r\n    }\r\n  };\r\n  const callEndLeg = (score?: number) => {\r\n    try {\r\n      if (onEndLeg) onEndLeg(score);\r\n      else endLeg(typeof score === \"number\" ? score : 0);\r\n    } catch {\r\n      /* noop */\r\n    }\r\n  };\r\n  const addHeatSample = useHeatmapStore((s) => s.addSample);\r\n  // Quick entry dropdown selections\r\n  const [quickSelAuto, setQuickSelAuto] = useState(\"\");\r\n  const [quickSelManual, setQuickSelManual] = useState(\"\");\r\n  const [nonRegCount, setNonRegCount] = useState(0);\r\n  const [showRecalModal, setShowRecalModal] = useState(false);\r\n  const [hadRecentAuto, setHadRecentAuto] = useState(false);\r\n  const [pulseManualPill, setPulseManualPill] = useState(false);\r\n  const pulseTimeoutRef = useRef<number | null>(null);\r\n  const [activeTab, setActiveTab] = useState<\"auto\" | \"manual\">(\"auto\");\r\n  const [showManualModal, setShowManualModal] = useState(false);\r\n  const [showAutoModal, setShowAutoModal] = useState(false);\r\n  const [showScoringModal, setShowScoringModal] = useState(false);\r\n  const manualPreviewRef = useRef<HTMLCanvasElement | null>(null);\r\n  // Dart timer\r\n  const dartTimerEnabled = useUserSettings((s) => s.dartTimerEnabled);\r\n  const dartTimerSeconds = useUserSettings((s) => s.dartTimerSeconds) || 10;\r\n  const [dartTimeLeft, setDartTimeLeft] = useState<number | null>(null);\r\n  const timerRef = useRef<number | null>(null);\r\n  const paused = useMatchControl((s) => s.paused);\r\n  // Built-in CV detector\r\n  const detectorRef = useRef<DartDetector | null>(null);\r\n  const rafRef = useRef<number | null>(null);\r\n  const lastAutoSigRef = useRef<string | null>(null);\r\n  const lastAutoSigAtRef = useRef<number>(0);\r\n  const lastParentSigRef = useRef<string | null>(null);\r\n  const lastParentSigAtRef = useRef<number>(0);\r\n  const [detectorSeedVersion, setDetectorSeedVersion] = useState(0);\r\n  const handlePhoneReconnect = useCallback(() => {\r\n    try {\r\n      window.dispatchEvent(\r\n        new CustomEvent(\"ndn:phone-camera-reconnect\", {\r\n          detail: { source: \"camera-view\", ts: Date.now() },\r\n        }),\r\n      );\r\n    } catch (err) {\r\n      console.warn(\"[CameraView] Phone camera reconnect dispatch failed:\", err);\r\n    }\r\n  }, []);\r\n  // Open Autoscore modal from parent via global event\r\n  useEffect(() => {\r\n    const onOpen = () => {\r\n      if (!manualOnly) setShowAutoModal(true);\r\n    };\r\n    window.addEventListener(\"ndn:open-autoscore\" as any, onOpen);\r\n    return () =>\r\n      window.removeEventListener(\"ndn:open-autoscore\" as any, onOpen);\r\n  }, [manualOnly]);\r\n\r\n  // cleanup pulse timer on unmount\r\n  useEffect(() => {\r\n  return () => {\r\n      try {\r\n        if (pulseTimeoutRef.current) clearTimeout(pulseTimeoutRef.current);\r\n      } catch {}\r\n    };\r\n  }, []);\r\n\r\n  // Open Scoring (Camera + Pending Visit) modal from parent via global event\r\n  useEffect(() => {\r\n    const onOpen = () => setShowScoringModal(true);\r\n    window.addEventListener(\"ndn:open-scoring\" as any, onOpen);\r\n    return () => window.removeEventListener(\"ndn:open-scoring\" as any, onOpen);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const onDartsCleared = () => {\r\n      setIndicatorVersion((v) => v + 1);\r\n      setPendingDarts(0);\r\n      setPendingScore(0);\r\n      setPendingEntries([]);\r\n      setPendingPreOpenDarts(0);\r\n      setPendingDartsAtDouble(0);\r\n      setHadRecentAuto(false);\r\n    };\r\n    window.addEventListener(\r\n      \"ndn:darts-cleared\",\r\n      onDartsCleared as EventListener,\r\n    );\r\n    return () =>\r\n      window.removeEventListener(\r\n        \"ndn:darts-cleared\",\r\n        onDartsCleared as EventListener,\r\n      );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setIndicatorEntryVersions((prev) => {\r\n      if (pendingEntries.length > prev.length) {\r\n        const diff = pendingEntries.length - prev.length;\r\n        return [...prev, ...Array(diff).fill(indicatorVersion)];\r\n      }\r\n      if (pendingEntries.length < prev.length) {\r\n        return prev.slice(0, pendingEntries.length);\r\n      }\r\n      return prev;\r\n    });\r\n  }, [pendingEntries, indicatorVersion]);\r\n\r\n  useEffect(() => {\r\n    if (detectionArmTimerRef.current) {\r\n      clearTimeout(detectionArmTimerRef.current);\r\n      detectionArmTimerRef.current = null;\r\n    }\r\n    if (manualOnly) {\r\n      detectionArmedRef.current = false;\r\n      streamingStartMsRef.current = 0;\r\n      autoCandidateRef.current = null;\r\n      return;\r\n    }\r\n    if (effectiveStreaming) {\r\n      streamingStartMsRef.current = performance.now();\r\n      autoCandidateRef.current = null;\r\n      detectionArmedRef.current = false;\r\n      frameCountRef.current = 0;\r\n      detectionArmTimerRef.current = window.setTimeout(() => {\r\n        detectionArmedRef.current = true;\r\n        detectionArmTimerRef.current = null;\r\n      }, DETECTION_ARM_DELAY_MS);\r\n    } else {\r\n      streamingStartMsRef.current = 0;\r\n      autoCandidateRef.current = null;\r\n      detectionArmedRef.current = false;\r\n      frameCountRef.current = 0;\r\n    }\r\n    return () => {\r\n      if (detectionArmTimerRef.current) {\r\n        clearTimeout(detectionArmTimerRef.current);\r\n        detectionArmTimerRef.current = null;\r\n      }\r\n      detectionArmedRef.current = false;\r\n      frameCountRef.current = 0;\r\n      tickRef.current = null;\r\n    };\r\n  }, [effectiveStreaming, manualOnly]);\r\n\r\n  // Enumerate devices on mount and when devices change so USB webcams appear quickly\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function refresh() {\r\n      try {\r\n        if (!navigator?.mediaDevices?.enumerateDevices) return;\r\n        const list = await navigator.mediaDevices.enumerateDevices();\r\n        if (!mounted) return;\r\n        setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\r\n      } catch (err) {\r\n        console.warn(\"[CAMERA] enumerateDevices failed:\", err);\r\n      }\r\n    }\r\n    refresh();\r\n    try {\r\n      navigator.mediaDevices.addEventListener(\"devicechange\", refresh);\r\n    } catch {\r\n      try {\r\n        (navigator.mediaDevices as any).ondevicechange = refresh;\r\n      } catch {}\r\n    }\r\n    return () => {\r\n      mounted = false;\r\n      try {\r\n        navigator.mediaDevices.removeEventListener(\"devicechange\", refresh);\r\n      } catch {}\r\n    };\r\n  }, []);\r\n\r\n  // Allow parent to open/close the manual modal via global events\r\n  useEffect(() => {\r\n    const onOpen = () => {\r\n      setActiveTab(\"manual\");\r\n      setShowManualModal(true);\r\n    };\r\n    const onClose = () => {\r\n      setActiveTab(\"auto\");\r\n      setShowManualModal(false);\r\n    };\r\n    window.addEventListener(\"ndn:open-manual\" as any, onOpen);\r\n    window.addEventListener(\"ndn:close-manual\" as any, onClose);\r\n    return () => {\r\n      window.removeEventListener(\"ndn:open-manual\" as any, onOpen);\r\n      window.removeEventListener(\"ndn:close-manual\" as any, onClose);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (manualOnly) {\r\n      setActiveTab(\"manual\");\r\n      setShowAutoModal(false);\r\n    }\r\n  }, [manualOnly]);\r\n\r\n  // Reset open state at the start of a leg (no darts thrown yet), keep across visits within leg\r\n  useEffect(() => {\r\n    try {\r\n      const p = matchState.players[matchState.currentPlayerIdx];\r\n      const leg = p?.legs?.[p.legs.length - 1];\r\n      if (!p) return;\r\n      if (!leg || leg.dartsThrown === 0) {\r\n        setOpenedById((m) => ({ ...m, [p.id]: false }));\r\n      }\r\n    } catch {}\r\n  }, [\r\n    matchState.currentPlayerIdx,\r\n    matchState.players?.[matchState.currentPlayerIdx]?.legs?.length,\r\n  ]);\r\n\r\n  // Manage per-dart timer lifecycle\r\n  useEffect(() => {\r\n    const shouldRun =\r\n      !!dartTimerEnabled && inProgress && !paused && pendingDarts < 3;\r\n    // Clear any existing interval\r\n    if (timerRef.current) {\r\n      clearInterval(timerRef.current as any);\r\n      timerRef.current = null;\r\n    }\r\n    if (!shouldRun) {\r\n      setDartTimeLeft(null);\r\n      return;\r\n    }\r\n    // Reset timer each time dependencies change (new dart, player change, setting change)\r\n    setDartTimeLeft(dartTimerSeconds);\r\n    timerRef.current = window.setInterval(() => {\r\n      setDartTimeLeft((prev) => {\r\n        const next = (prev ?? dartTimerSeconds) - 1;\r\n        if (next <= 0) {\r\n          // Time expired: record a MISS and reset will occur via pendingEntries change\r\n          try {\r\n            addDart(0, \"MISS 0\", \"MISS\");\r\n          } catch {}\r\n          // Stop interval until effect re-initializes on state change\r\n          if (timerRef.current) {\r\n            clearInterval(timerRef.current as any);\r\n            timerRef.current = null;\r\n          }\r\n          return 0;\r\n        }\r\n        return next;\r\n      });\r\n    }, 1000) as any;\r\n    return () => {\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current as any);\r\n        timerRef.current = null;\r\n      }\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    dartTimerEnabled,\r\n    dartTimerSeconds,\r\n    pendingDarts,\r\n    matchState.currentPlayerIdx,\r\n    (matchState as any)?.inProgress,\r\n    paused,\r\n  ]);\r\n\r\n  // Drive a lightweight live preview inside the manual modal from the main video element\r\n  useEffect(() => {\r\n    if (!showManualModal) return;\r\n    const id = setInterval(() => {\r\n      try {\r\n        const v = videoRef.current;\r\n        const c = manualPreviewRef.current;\r\n        if (!v || !c) return;\r\n        const vw = v.videoWidth || 0;\r\n        const vh = v.videoHeight || 0;\r\n        if (!vw || !vh) return;\r\n        const cw = c.clientWidth || 640;\r\n        const ch = c.clientHeight || 360;\r\n        // Set backing size to match display for crisp rendering\r\n        if (c.width !== cw) c.width = cw;\r\n        if (c.height !== ch) c.height = ch;\r\n        const ctx = c.getContext(\"2d\");\r\n        if (!ctx) return;\r\n        ctx.imageSmoothingEnabled = true;\r\n        // Letterbox fit\r\n        const scale = Math.min(cw / vw, ch / vh);\r\n        const dw = Math.round(vw * scale);\r\n        const dh = Math.round(vh * scale);\r\n        const dx = Math.floor((cw - dw) / 2);\r\n        const dy = Math.floor((ch - dh) / 2);\r\n        ctx.fillStyle = \"#000\";\r\n        ctx.fillRect(0, 0, cw, ch);\r\n        ctx.drawImage(v, dx, dy, dw, dh);\r\n      } catch (e) {\r\n        // Silently ignore preview update errors\r\n        console.warn(\"Manual preview update error:\", e);\r\n      }\r\n    }, 120);\r\n    return () => clearInterval(id);\r\n  }, [showManualModal]);\r\n\r\n  useEffect(() => {\r\n    // Do not auto-stop the camera when the view unmounts. We want the camera stream\r\n    // to persist across navigation so calibration and pairing aren't lost when switching\r\n    // between Offline/Online/Tournaments. This keeps the global cameraSession's\r\n    // mediaStream active and allows other views to reuse it.\r\n    return () => {\r\n      // intentionally no-op: camera continues running in global session\r\n    };\r\n  }, []);\r\n\r\n  const canFallbackToLocal = isPhoneCamera && !phoneFeedActive;\r\n\r\n  async function startCamera() {\r\n    if (cameraStarting || streaming) return;\r\n\r\n    // Only skip local startup when the phone feed is actively streaming\r\n    if (isPhoneCamera && phoneFeedActive) {\r\n      dlog(\"[CAMERA] Phone camera stream active - leaving local camera idle\");\r\n      setCameraStarting(false);\r\n      return;\r\n    }\r\n\r\n    setCameraStarting(true);\r\n    dlog(\"[CAMERA] Starting camera...\");\r\n    try {\r\n      // If a preferred camera is set, request it; otherwise default to back camera on mobile\r\n      const constraints: MediaStreamConstraints = preferredCameraId\r\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false }\r\n        : { video: { facingMode: \"environment\" }, audio: false }; // Prefer back camera on mobile\r\n      dlog(\"[CAMERA] Using constraints:\", constraints);\r\n      let stream: MediaStream;\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n        dlog(\"[CAMERA] Got stream:\", !!stream);\r\n      } catch (err: any) {\r\n        console.warn(\"[CAMERA] First attempt failed:\", err);\r\n        // Fallback if specific device isn't available or facingMode not supported\r\n        const name = (err && (err.name || err.code)) || \"\";\r\n        if (\r\n          preferredCameraId &&\r\n          (name === \"OverconstrainedError\" || name === \"NotFoundError\")\r\n        ) {\r\n          dlog(\"[CAMERA] Trying fallback without deviceId\");\r\n          stream = await navigator.mediaDevices.getUserMedia({\r\n            video: true,\r\n            audio: false,\r\n          });\r\n        } else if (\r\n          !preferredCameraId &&\r\n          (name === \"OverconstrainedError\" ||\r\n            name === \"NotFoundError\" ||\r\n            name === \"NotSupportedError\")\r\n        ) {\r\n          dlog(\"[CAMERA] Trying fallback for facingMode not supported\");\r\n          // Fallback for devices that don't support facingMode\r\n          stream = await navigator.mediaDevices.getUserMedia({\r\n            video: true,\r\n            audio: false,\r\n          });\r\n        } else {\r\n          throw err;\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        dlog(\"[CAMERA] Setting stream to video element\");\r\n        videoRef.current.srcObject = stream;\r\n        dlog(\r\n          \"[CAMERA] Stream tracks:\",\r\n          stream.getTracks().length,\r\n          \"video tracks:\",\r\n          stream.getVideoTracks().length,\r\n        );\r\n        // Add event listeners for debugging\r\n        videoRef.current.addEventListener(\"loadeddata\", () =>\r\n          dlog(\"[CAMERA] Video loadeddata\"),\r\n        );\r\n        videoRef.current.addEventListener(\"canplay\", () =>\r\n          dlog(\"[CAMERA] Video canplay\"),\r\n        );\r\n        videoRef.current.addEventListener(\"play\", () =>\r\n          dlog(\"[CAMERA] Video started playing\"),\r\n        );\r\n        videoRef.current.addEventListener(\"error\", (e) =>\r\n          console.error(\"[CAMERA] Video error:\", e),\r\n        );\r\n        try {\r\n          videoRef.current.play();\r\n          dlog(\"[CAMERA] Play called successfully\");\r\n        } catch (playErr) {\r\n          console.error(\"[CAMERA] Video play failed:\", playErr);\r\n          // Try again after a short delay\r\n          setTimeout(() => {\r\n            try {\r\n              videoRef.current?.play();\r\n              dlog(\"[CAMERA] Retry play called\");\r\n            } catch (retryErr) {\r\n              console.error(\"[CAMERA] Retry play failed:\", retryErr);\r\n            }\r\n          }, 100);\r\n        }\r\n        try {\r\n          cameraSession.setVideoElementRef?.(videoRef.current);\r\n          cameraSession.setMediaStream?.(stream);\r\n          cameraSession.setMode?.(\"local\");\r\n          cameraSession.setStreaming?.(true);\r\n        } catch (err) {\r\n          console.warn(\r\n            \"[CAMERA] Failed to sync camera session with local stream:\",\r\n            err,\r\n          );\r\n        }\r\n      } else {\r\n        console.error(\"[CAMERA] Video element not found\");\r\n      }\r\n      setStreaming(true);\r\n      // Capture device list for inline picker - no automatic preference updates\r\n      try {\r\n        const list = await navigator.mediaDevices.enumerateDevices();\r\n        setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\r\n        dlog(\r\n          \"[CAMERA] Found cameras:\",\r\n          list.filter((d) => d.kind === \"videoinput\").length,\r\n        );\r\n      } catch (enumErr) {\r\n        console.warn(\"[CAMERA] Failed to enumerate devices:\", enumErr);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"[CAMERA] Camera start failed:\", e);\r\n      alert(\"Camera permission denied or not available.\");\r\n    } finally {\r\n      setCameraStarting(false);\r\n    }\r\n  }\r\n\r\n  function stopCamera() {\r\n    try {\r\n      const sessionStream = cameraSession.getMediaStream?.() || null;\r\n      if (sessionStream) {\r\n        sessionStream.getTracks().forEach((t) => t.stop());\r\n      }\r\n    } catch (e) {\r\n      // ignore cleanup errors\r\n    }\r\n    if (videoRef.current) {\r\n      try {\r\n        videoRef.current.srcObject = null;\r\n      } catch {}\r\n    }\r\n    try {\r\n      cameraSession.setMediaStream?.(null);\r\n      cameraSession.setStreaming?.(false);\r\n      cameraSession.setVideoElementRef?.(null);\r\n    } catch {}\r\n    setStreaming(false);\r\n    setCameraStarting(false);\r\n  }\r\n\r\n  useEffect(() => {\r\n    const videoEl = videoRef.current;\r\n    if (!videoEl) return;\r\n    const sessionStream = cameraSession.getMediaStream?.() || null;\r\n    const sessionVideo = cameraSession.getVideoElementRef?.() || null;\r\n    const fallbackStream =\r\n      (sessionVideo?.srcObject as MediaStream | null) || null;\r\n    const activeStream = sessionStream || fallbackStream;\r\n    if (!activeStream) return;\r\n    if (videoEl.srcObject !== activeStream) {\r\n      videoEl.srcObject = activeStream;\r\n    }\r\n    videoEl.muted = true;\r\n    (videoEl as any).playsInline = true;\r\n    try {\r\n      videoEl.play?.();\r\n    } catch {}\r\n    if (!streaming) setStreaming(true);\r\n  }, [cameraSession.mode, cameraSession.isStreaming, streaming, cameraSession]);\r\n\r\n  function capture() {\r\n    try {\r\n      if (!canvasRef.current) return;\r\n      const primary = videoRef.current;\r\n      const sessionVideo = cameraSession.getVideoElementRef?.() || null;\r\n      const source =\r\n        primary && primary.videoWidth > 0 && primary.videoHeight > 0\r\n          ? primary\r\n          : sessionVideo || primary;\r\n      if (!source) return;\r\n      const video = source;\r\n      const canvas = canvasRef.current;\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      if (!ctx) return;\r\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n      const url = canvas.toDataURL(\"image/png\");\r\n      setSnapshotUrl(url);\r\n    } catch (e) {\r\n      console.warn(\"Capture error:\", e);\r\n    }\r\n  }\r\n\r\n  // Inline light-weight device switcher (optional)\r\n  function CameraSelector() {\r\n    if (!availableCameras.length) return null;\r\n    return (\r\n      <div className=\"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs\">\r\n        <span>Cam:</span>\r\n        <select\r\n          className=\"bg-black/20 rounded px-1 py-0.5\"\r\n          value={preferredCameraId || \"\"}\r\n          onChange={async (e) => {\r\n            if (cameraStarting) return;\r\n            const id = e.target.value || undefined;\r\n            const label = availableCameras.find(\r\n              (d) => d.deviceId === id,\r\n            )?.label;\r\n            // This is a user-initiated change so force the preference even when locked\r\n            setPreferredCamera(id, label || \"\", true);\r\n            // Stop current camera and wait for cleanup\r\n            stopCamera();\r\n            // Small delay to ensure camera device is fully released\r\n            await new Promise((resolve) => setTimeout(resolve, 150));\r\n            try {\r\n              await startCamera();\r\n            } catch (err) {\r\n              console.warn(\"Failed to start camera after device switch:\", err);\r\n              // Try one more time after a longer delay\r\n              setTimeout(async () => {\r\n                try {\r\n                  await startCamera();\r\n                } catch (retryErr) {\r\n                  console.error(\"Camera switch failed after retry:\", retryErr);\r\n                  alert(\r\n                    \"Failed to switch camera. Please try again or refresh the page.\",\r\n                  );\r\n                }\r\n              }, 500);\r\n            }\r\n          }}\r\n        >\r\n          <option value=\"\">Auto</option>\r\n          {availableCameras.map((d) => (\r\n            <option key={d.deviceId} value={d.deviceId}>\r\n              {d.label ||\r\n                (d.deviceId ? `Camera (${d.deviceId.slice(0, 6)})` : \"Camera\")}\r\n            </option>\r\n          ))}\r\n        </select>\r\n        <button\r\n          className=\"btn btn--ghost btn-sm ml-2\"\r\n          onClick={async () => {\r\n            try {\r\n              // quick user-triggered rescan\r\n              const list = await navigator.mediaDevices.enumerateDevices();\r\n              setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\r\n            } catch (err) {\r\n              console.warn(\"Rescan failed:\", err);\r\n              alert(\r\n                \"Failed to rescan devices. Ensure camera permissions are granted.\",\r\n              );\r\n            }\r\n          }}\r\n          title=\"Rescan connected cameras\"\r\n        >\r\n          Rescan\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  function drawOverlay() {\r\n    if (DISABLE_CAMERA_OVERLAY) {\r\n      if (overlayRef.current) {\r\n        const ctx = overlayRef.current.getContext(\"2d\");\r\n        if (ctx)\r\n          ctx.clearRect(\r\n            0,\r\n            0,\r\n            overlayRef.current.width,\r\n            overlayRef.current.height,\r\n          );\r\n      }\r\n      return;\r\n    }\r\n    try {\r\n      // Only render overlays when calibration data exists and the phone stream isn't providing the image\r\n      if (!overlayRef.current || !videoRef.current || !H || !imageSize) {\r\n        if (overlayRef.current) {\r\n          const ctx = overlayRef.current.getContext(\"2d\");\r\n          ctx?.clearRect(\r\n            0,\r\n            0,\r\n            overlayRef.current.width,\r\n            overlayRef.current.height,\r\n          );\r\n        }\r\n        return;\r\n      }\r\n      if (isPhoneCamera) return;\r\n      const o = overlayRef.current;\r\n      const v = videoRef.current;\r\n      const w = v.clientWidth;\r\n      const h = v.clientHeight;\r\n      o.width = w;\r\n      o.height = h;\r\n      const ctx = o.getContext(\"2d\");\r\n      if (!ctx) return;\r\n      ctx.clearRect(0, 0, w, h);\r\n      if (preferredCameraLocked || hideCameraOverlay) return;\r\n\r\n      // scale homography from calibration image size to current rendered size\r\n  // If calibration is locked and an overlaySize was saved at lock time, use that to preserve visual scale.\r\n  const useOverlay = locked && overlaySize && preserveCalibrationOverlay ? overlaySize : { w, h };\r\n  const sx = useOverlay.w / imageSize.w;\r\n  const sy = useOverlay.h / imageSize.h;\r\n  const Hs = scaleHomography(H, sx, sy);\r\n      const rings = [\r\n        BoardRadii.bullInner,\r\n        BoardRadii.bullOuter,\r\n        BoardRadii.trebleInner,\r\n        BoardRadii.trebleOuter,\r\n        BoardRadii.doubleInner,\r\n        BoardRadii.doubleOuter,\r\n      ];\r\n      // If useOverlay differs from actual canvas size, draw scale from useOverlay space to overlay space.\r\n      const drawScaleX = w / useOverlay.w;\r\n      const drawScaleY = h / useOverlay.h;\r\n      // Compute cropping offsets when video is 'fill' (object-cover) so we align homography to\r\n      // the visible portion of the video. When the video is letterboxed (fit), crop offsets are zero.\r\n      const videoIntrinsicW = (v.videoWidth && v.videoWidth > 0) ? v.videoWidth : imageSize.w;\r\n      const videoIntrinsicH = (v.videoHeight && v.videoHeight > 0) ? v.videoHeight : imageSize.h;\r\n      const vr = videoIntrinsicW / videoIntrinsicH;\r\n      const cr = useOverlay.w / useOverlay.h;\r\n      let cropSrcX = 0;\r\n      let cropSrcY = 0;\r\n      if (vr > cr) {\r\n        // video is wider than overlay - crop left/right\r\n        const targetW = videoIntrinsicH * cr;\r\n        cropSrcX = Math.max(0, (videoIntrinsicW - targetW) / 2);\r\n      } else if (vr < cr) {\r\n        // video is taller than overlay - crop top/bottom\r\n        const targetH = videoIntrinsicW / cr;\r\n        cropSrcY = Math.max(0, (videoIntrinsicH - targetH) / 2);\r\n      }\r\n      const cropOverlayX = (cropSrcX / imageSize.w) * useOverlay.w;\r\n      const cropOverlayY = (cropSrcY / imageSize.h) * useOverlay.h;\r\n      for (const r of rings) {\r\n        const poly = sampleRing(Hs, r, 720);\r\n        // Scale poly points according to drawScale\r\n  // Adjust for cropping offset and then scale to actual canvas\r\n  const scaledPoly = poly.map((p) => ({ x: (p.x - cropOverlayX) * drawScaleX, y: (p.y - cropOverlayY) * drawScaleY }));\r\n        drawPolyline(\r\n          ctx,\r\n          scaledPoly,\r\n          r === BoardRadii.doubleOuter ? \"#22d3ee\" : \"#a78bfa\",\r\n          r === BoardRadii.doubleOuter ? 3 : 2,\r\n        );\r\n      }\r\n    } catch (e) {\r\n      // Silently ignore drawing errors to prevent re-render loops\r\n      console.warn(\"Overlay drawing error:\", e);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (manualOnly || DISABLE_CAMERA_OVERLAY) return;\r\n    const id = setInterval(drawOverlay, 250);\r\n    return () => clearInterval(id);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    H,\r\n    imageSize,\r\n    effectiveStreaming,\r\n    manualOnly,\r\n    isPhoneCamera,\r\n    preferredCameraLocked,\r\n    hideCameraOverlay,\r\n  ]);\r\n\r\n  // Built-in autoscore loop (offline/local CV)\r\n  useEffect(() => {\r\n    if (manualOnly) return;\r\n    if (autoscoreProvider !== \"built-in\") return;\r\n    // Choose source: local video element, or paired phone camera element\r\n    const cameraSession = useCameraSession.getState();\r\n    const isPhone =\r\n      useUserSettings.getState().preferredCameraLabel === \"Phone Camera\";\r\n    let sourceVideo: any = isPhone\r\n      ? cameraSession.getVideoElementRef?.() || null\r\n      : videoRef.current;\r\n    // test harness: if running under test, fake a source video so detection can run\r\n    if (!sourceVideo && process.env.NODE_ENV === \"test\") {\r\n      sourceVideo = {\r\n        videoWidth: 320,\r\n        videoHeight: 240,\r\n        currentTime: 0,\r\n        play: async () => {},\r\n        paused: false,\r\n        srcObject: false,\r\n      } as unknown as HTMLVideoElement;\r\n    }\r\n  if (!sourceVideo) return;\r\n    if (!H || !imageSize) return;\r\n\r\n    let canceled = false;\r\n  const v = sourceVideo;\r\n  const initVw = v.videoWidth || 0;\r\n  const initVh = v.videoHeight || 0;\r\n    const proc = canvasRef.current;\r\n    if (!proc) return;\r\n\r\n    // Initialize or reset detector with tuned params for resolution/phone cameras\r\n    if (!detectorRef.current) {\r\n      // default tuning\r\n      let minArea = 60;\r\n      let thresh = 18;\r\n      let requireStableN = 3;\r\n      // if resolution is low (common for phone cameras), make detector more permissive\r\n  if (initVw > 0 && initVh > 0 && initVw * initVh < 1280 * 720) {\r\n        minArea = 40;\r\n        thresh = 16;\r\n        requireStableN = 2;\r\n      }\r\n      detectorRef.current = new DartDetector({\r\n        minArea,\r\n        thresh,\r\n        requireStableN,\r\n        angMaxDeg: 70,\r\n      });\r\n    }\r\n\r\n    const tick = () => {\r\n      let didApplyHitThisTick = false;\r\n      if (process.env.NODE_ENV === 'test') {\r\n        try { dlog('CameraView.tick invoked', { armed: detectionArmedRef.current, frameCount: frameCountRef.current }); } catch {};\r\n      }\r\n      if (canceled) return;\r\n      try {\r\n        const vw = v.videoWidth || 0;\r\n        const vh = v.videoHeight || 0;\r\n        if (!vw || !vh) {\r\n          rafRef.current = requestAnimationFrame(tick);\r\n          return;\r\n        }\r\n        if (proc.width !== vw) proc.width = vw;\r\n        if (proc.height !== vh) proc.height = vh;\r\n        const ctx = proc.getContext(\"2d\", { willReadFrequently: true });\r\n        if (!ctx) {\r\n          rafRef.current = requestAnimationFrame(tick);\r\n          return;\r\n        }\r\n        ctx.drawImage(v, 0, 0, vw, vh);\r\n        const frame = ctx.getImageData(0, 0, vw, vh);\r\n\r\n        frameCountRef.current++;\r\n\r\n        // Seed ROI from calibration homography (board center + double radius along X)\r\n        const cImg = applyHomography(H, { x: 0, y: 0 });\r\n        const rImg = applyHomography(H, { x: BoardRadii.doubleOuter, y: 0 });\r\n        // Scale calibration image coordinates to current video size\r\n        const sx = vw / imageSize.w;\r\n        const sy = vh / imageSize.h;\r\n        const cx = cImg.x * sx;\r\n        const cy = cImg.y * sy;\r\n        const rx = rImg.x * sx;\r\n        const ry = rImg.y * sy;\r\n        const roiR = Math.hypot(rx - cx, ry - cy) * 1.08;\r\n\r\n        const detector = detectorRef.current!;\r\n        if (detectorSeedVersion >= 0) {\r\n          detector.setROI(\r\n            cx,\r\n            cy,\r\n            Math.max(24, Math.min(Math.max(vw, vh), roiR)),\r\n          );\r\n        }\r\n\r\n        // Try to detect a new dart when not paused and visit has room\r\n        if (\r\n          !paused &&\r\n          pendingDarts < 3 &&\r\n          detectionArmedRef.current &&\r\n          frameCountRef.current > DETECTION_MIN_FRAMES\r\n        ) {\r\n          const det = detector.detect(frame);\r\n          const nowPerf = performance.now();\r\n          if (\r\n            autoCandidateRef.current &&\r\n            nowPerf - autoCandidateRef.current.firstTs > 900\r\n          ) {\r\n            autoCandidateRef.current = null;\r\n          }\r\n            if (det && det.confidence >= AUTO_COMMIT_CONFIDENCE) {\r\n              dlog(\"CameraView: detected raw\", det.confidence, det.tip);\r\n              // debug logging via dlog to avoid polluting test console\r\n              dlog(\"CameraView: detected raw\", det.confidence, det.tip);\r\n            const warmupActive =\r\n              streamingStartMsRef.current > 0 &&\r\n              nowPerf - streamingStartMsRef.current < AUTO_STREAM_IGNORE_MS;\r\n            // Refine tip on gradients\r\n            const tipRefined = refinePointSobel(proc, det.tip, 6);\r\n            // Map to calibration image space before scoring\r\n            const pCal = { x: tipRefined.x / sx, y: tipRefined.y / sy };\r\n            const score = scoreFromImagePoint(H, pCal);\r\n            const ring = score.ring as Ring;\r\n            const value = score.base;\r\n            const label = `${ring} ${value > 0 ? value : \"\"}`.trim();\r\n            const sector = (score.sector ?? null) as number | null;\r\n            const mult = Math.max(0, Number(score.mult) || 0) as 0 | 1 | 2 | 3;\r\n            let shouldAccept = false;\r\n\r\n            setLastAutoScore(label);\r\n            setLastAutoValue(value);\r\n            setLastAutoRing(ring);\r\n\r\n            const applyAutoHit = async (candidate: AutoCandidate) => {\r\n              dlog(\"CameraView: applyAutoHit\", candidate.value, candidate.ring, candidate.sector);\r\n              // debug logging via dlog to avoid polluting test console\r\n              dlog(\"CameraView: applyAutoHit\", candidate.value, candidate.ring, candidate.sector);\r\n              const now = performance.now();\r\n              // Only dedupe by value/ring/mult to avoid accidental false negatives when\r\n              // the sector or tip fluctuates slightly across frames for the same scoring\r\n              // result. This reduces noisy duplicate notifications while preserving\r\n              // distinct sector-based changes.\r\n              const sig = `${candidate.value}|${candidate.ring}|${candidate.mult}`;\r\n              if (sig === lastAutoSigRef.current && now - lastAutoSigAtRef.current < AUTO_COMMIT_COOLDOWN_MS) {\r\n                // Duplicate commit within cooldown; ignore\r\n                return;\r\n              }\r\n              lastAutoSigRef.current = sig;\r\n              lastAutoSigAtRef.current = now;\r\n              if (candidate.value > 0) {\r\n                setHadRecentAuto(true);\r\n                setPulseManualPill(true);\r\n                try {\r\n                  if (pulseTimeoutRef.current)\r\n                    clearTimeout(pulseTimeoutRef.current);\r\n                } catch {}\r\n                pulseTimeoutRef.current = window.setTimeout(() => {\r\n                  setPulseManualPill(false);\r\n                  pulseTimeoutRef.current = null;\r\n                }, 1500);\r\n                try {\r\n                  // If a parent provided an onAutoDart handler, prefer notifying it\r\n                  // and let the parent decide whether to apply the dart (to avoid\r\n                  // double-commits when both CameraView and parent add the dart).\r\n                  if (cameraAutoCommit === \"camera\") {\r\n                    // Camera is authoritative: commit locally\r\n                    try {\r\n                      addDart(candidate.value, candidate.label, candidate.ring);\r\n                    } catch {}\r\n                    // still optionally notify parent for telemetry (but parent should not commit)\r\n                    try {\r\n                      const pSig = sig;\r\n                      const pNow = performance.now();\r\n                      if (!onAutoDart || pSig === lastParentSigRef.current && pNow - lastParentSigAtRef.current < AUTO_COMMIT_COOLDOWN_MS) {\r\n                        // skip\r\n                      } else {\r\n                        if (onAutoDart) onAutoDart(candidate.value, candidate.ring, { sector: candidate.sector, mult: candidate.mult });\r\n                        lastParentSigRef.current = pSig;\r\n                        lastParentSigAtRef.current = pNow;\r\n                      }\r\n                    } catch {}\r\n                  } else if (cameraAutoCommit === \"parent\") {\r\n                    let ack = false;\r\n                    if (onAutoDart) {\r\n                      try {\r\n                        const pSig = sig;\r\n                        const pNow = performance.now();\r\n                        if (!(pSig === lastParentSigRef.current && pNow - lastParentSigAtRef.current < AUTO_COMMIT_COOLDOWN_MS)) {\r\n                          ack = Boolean(await Promise.resolve(onAutoDart(candidate.value, candidate.ring, { sector: candidate.sector, mult: candidate.mult })));\r\n                          if (ack) {\r\n                            lastParentSigRef.current = pSig;\r\n                            lastParentSigAtRef.current = pNow;\r\n                          }\r\n                        }\r\n                      } catch {}\r\n                    }\r\n                    if (!ack) {\r\n                      addDart(candidate.value, candidate.label, candidate.ring);\r\n                    }\r\n                    // if we got an ack from parent, record that we notified the parent so we don't spam\r\n                    if (ack) {\r\n                      lastParentSigRef.current = sig;\r\n                      lastParentSigAtRef.current = performance.now();\r\n                    }\r\n                  } else /* both */ {\r\n                    // Commit both (dedupe will avoid double commit) and notify parent\r\n                    try {\r\n                      addDart(candidate.value, candidate.label, candidate.ring);\r\n                    } catch {}\r\n                    try {\r\n                      const pSig = sig;\r\n                      const pNow = performance.now();\r\n                      if (!onAutoDart || pSig === lastParentSigRef.current && pNow - lastParentSigAtRef.current < AUTO_COMMIT_COOLDOWN_MS) {\r\n                        // skip\r\n                      } else {\r\n                        if (onAutoDart) onAutoDart(candidate.value, candidate.ring, { sector: candidate.sector, mult: candidate.mult });\r\n                        lastParentSigRef.current = pSig;\r\n                        lastParentSigAtRef.current = pNow;\r\n                      }\r\n                    } catch {}\r\n                  }\r\n                } catch {}\r\n              } else {\r\n                setHadRecentAuto(false);\r\n              }\r\n              // Notify parent for misses or when the candidate wasn't already\r\n              // dispatched to the parent above.\r\n              if (candidate.value <= 0) {\r\n                try {\r\n                  if (onAutoDart)\r\n                    onAutoDart(candidate.value, candidate.ring, {\r\n                      sector: candidate.sector,\r\n                      mult: candidate.mult,\r\n                    });\r\n                } catch {}\r\n              }\r\n            };\r\n\r\n            if (!warmupActive) {\r\n              if (ring === \"MISS\" || value <= 0) {\r\n                autoCandidateRef.current = null;\r\n                setHadRecentAuto(false);\r\n                try {\r\n                  if (onAutoDart) onAutoDart(value, ring, { sector, mult });\r\n                } catch {}\r\n                shouldAccept = true;\r\n              } else {\r\n                const existing = autoCandidateRef.current;\r\n                if (\r\n                  !existing ||\r\n                  existing.value !== value ||\r\n                  existing.ring !== ring\r\n                ) {\r\n                  autoCandidateRef.current = {\r\n                    value,\r\n                    ring,\r\n                    label,\r\n                    sector,\r\n                    mult,\r\n                    firstTs: nowPerf,\r\n                    frames: 1,\r\n                  };\r\n                } else {\r\n                  autoCandidateRef.current = {\r\n                    ...existing,\r\n                    label,\r\n                    frames: existing.frames + 1,\r\n                  };\r\n                }\r\n                const current = autoCandidateRef.current!;\r\n                const holdMs = nowPerf - current.firstTs;\r\n                const ready =\r\n                  current.frames >= AUTO_COMMIT_MIN_FRAMES ||\r\n                  holdMs >= AUTO_COMMIT_HOLD_MS;\r\n                const cooled =\r\n                  nowPerf - lastAutoCommitRef.current >=\r\n                  AUTO_COMMIT_COOLDOWN_MS;\r\n                if (ready && cooled) {\r\n                  applyAutoHit(current);\r\n                  didApplyHitThisTick = true;\r\n                  autoCandidateRef.current = null;\r\n                  lastAutoCommitRef.current = nowPerf;\r\n                  shouldAccept = true;\r\n                }\r\n              }\r\n            } else {\r\n              autoCandidateRef.current = null;\r\n              shouldAccept = true;\r\n            }\r\n\r\n            captureDetectionLog({\r\n              ts: nowPerf,\r\n              label,\r\n              value,\r\n              ring,\r\n              pCal,\r\n              tip: tipRefined,\r\n              confidence: det.confidence,\r\n              ready: shouldAccept,\r\n              accepted: shouldAccept && value > 0 && ring !== \"MISS\",\r\n              warmup: warmupActive,\r\n            });\r\n\r\n            // Draw debug tip and shaft axis on overlay (scaled to overlay canvas)\r\n            try {\r\n              const drawOverlayHint = value > 0 && ring !== \"MISS\";\r\n              if (drawOverlayHint) {\r\n                const o = overlayRef.current;\r\n                if (o) {\r\n                  const octx = o.getContext(\"2d\");\r\n                  if (octx) {\r\n                    // Maintain overlay size and clear a small area\r\n                    const ox = (tipRefined.x / vw) * o.width;\r\n                    const oy = (tipRefined.y / vh) * o.height;\r\n                    octx.save();\r\n                    octx.beginPath();\r\n                    octx.strokeStyle = \"#f59e0b\";\r\n                    octx.lineWidth = 2;\r\n                    octx.arc(ox, oy, 6, 0, Math.PI * 2);\r\n                    octx.stroke();\r\n                    // axis line if available\r\n                    if ((det as any).axis) {\r\n                      const ax = (det as any).axis;\r\n                      const ax1 = (ax.x1 / vw) * o.width;\r\n                      const ay1 = (ax.y1 / vh) * o.height;\r\n                      const ax2 = (ax.x2 / vw) * o.width;\r\n                      const ay2 = (ax.y2 / vh) * o.height;\r\n                      octx.beginPath();\r\n                      octx.moveTo(ax1, ay1);\r\n                      octx.lineTo(ax2, ay2);\r\n                      octx.stroke();\r\n                    }\r\n                    // bbox\r\n                    if ((det as any).bbox) {\r\n                      const bx = ((det as any).bbox.x / vw) * o.width;\r\n                      const by = ((det as any).bbox.y / vh) * o.height;\r\n                      const bw = ((det as any).bbox.w / vw) * o.width;\r\n                      const bh = ((det as any).bbox.h / vh) * o.height;\r\n                      octx.strokeStyle = \"#22d3ee\";\r\n                      octx.strokeRect(bx, by, bw, bh);\r\n                    }\r\n                    octx.restore();\r\n                  }\r\n                }\r\n              }\r\n            } catch {}\r\n\r\n            if (shouldAccept && !didApplyHitThisTick) {\r\n              detector.accept(frame, det);\r\n              // Strictly prefer camera committing when set to 'camera'. If parent has an onAutoDart\r\n              // handler we allow an ack to prevent duplicate commits; otherwise camera will assume commit.\r\n                try {\r\n                  // Do not await here; applyAutoHit handles async ack internally.\r\n                  void applyAutoHit({ value, ring, label, sector, mult, firstTs: nowPerf, frames: 1 });\r\n                } catch {}\r\n            }\r\n          } else {\r\n            if (\r\n              autoCandidateRef.current &&\r\n              nowPerf - autoCandidateRef.current.firstTs > 800\r\n            ) {\r\n              autoCandidateRef.current = null;\r\n            }\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // Soft-fail; continue next frame\r\n        // console.warn('Autoscore tick error:', e)\r\n      }\r\n  rafRef.current = requestAnimationFrame(tick);\r\n  // publish tick for test harnesses\r\n  tickRef.current = tick;\r\n    };\r\n\r\n    rafRef.current = requestAnimationFrame(tick);\r\n    return () => {\r\n      canceled = true;\r\n      if (rafRef.current) cancelAnimationFrame(rafRef.current);\r\n      rafRef.current = null;\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    manualOnly,\r\n    autoscoreProvider,\r\n    effectiveStreaming,\r\n    H,\r\n    imageSize,\r\n    paused,\r\n    pendingDarts,\r\n    detectorSeedVersion,\r\n    captureDetectionLog,\r\n  ]);\r\n\r\n  const handleUseLocalCamera = useCallback(async () => {\r\n    try {\r\n      if (isPhoneCamera) {\r\n        const fallback = availableCameras.find((c) => c.kind === \"videoinput\");\r\n        if (fallback) {\r\n          setPreferredCamera(fallback.deviceId, fallback.label || \"\", true);\r\n        } else {\r\n          setPreferredCamera(undefined, \"\", true);\r\n        }\r\n      }\r\n      await startCamera();\r\n    } catch (err) {\r\n      console.warn(\"[CameraView] Local camera fallback failed:\", err);\r\n    }\r\n  }, [availableCameras, isPhoneCamera, setPreferredCamera]);\r\n\r\n  // Update calibration audit status whenever homography or image size changes\r\n  useEffect(() => {\r\n    try {\r\n      useAudit\r\n        .getState()\r\n    .setCalibrationStatus({ hasHomography: !!H, imageSize, overlaySize });\r\n    } catch {}\r\n  }, [H, imageSize]);\r\n\r\n  // External autoscore subscription\r\n  useEffect(() => {\r\n    if (autoscoreProvider !== \"external-ws\" || !autoscoreWsUrl) return;\r\n    const sub = subscribeExternalWS(autoscoreWsUrl, (d) => {\r\n      if (\r\n        !detectionArmedRef.current ||\r\n        performance.now() - streamingStartMsRef.current < 5000\r\n      )\r\n        return;\r\n      // Prefer parent hook if provided; otherwise add to visit directly\r\n      if (onAutoDart) {\r\n        try {\r\n          onAutoDart(d.value, d.ring as any, {\r\n            sector: d.sector ?? null,\r\n            mult: (d.mult as any) ?? 0,\r\n          });\r\n        } catch {}\r\n        try {\r\n          addHeatSample({\r\n            playerId:\r\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\r\n            sector: d.sector ?? null,\r\n            mult: (d.mult as any) ?? 0,\r\n            ring: d.ring as any,\r\n            ts: Date.now(),\r\n          });\r\n        } catch {}\r\n      } else {\r\n        const label =\r\n          d.ring === \"INNER_BULL\"\r\n            ? \"INNER_BULL 50\"\r\n            : d.ring === \"BULL\"\r\n              ? \"BULL 25\"\r\n              : `${d.ring[0]}${d.value / (d.mult || 1) || d.value} ${d.value}`;\r\n        addDart(d.value, label, d.ring as any);\r\n        try {\r\n          addHeatSample({\r\n            playerId:\r\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\r\n            sector: d.sector ?? null,\r\n            mult: (d.mult as any) ?? 0,\r\n            ring: d.ring as any,\r\n            ts: Date.now(),\r\n          });\r\n        } catch {}\r\n      }\r\n    });\r\n    return () => sub.close();\r\n  }, [autoscoreProvider, autoscoreWsUrl]);\r\n\r\n  function onOverlayClick(e: React.MouseEvent<HTMLCanvasElement>) {\r\n    if (!overlayRef.current || !H || !imageSize) return;\r\n    const rect = overlayRef.current.getBoundingClientRect();\r\n    const x = e.clientX - rect.left;\r\n    const y = e.clientY - rect.top;\r\n    // Map to calibration coordinate space by reversing the display scaling\r\n    const sx = overlayRef.current.width / imageSize.w;\r\n    const sy = overlayRef.current.height / imageSize.h;\r\n    const pCal: Point = { x: x / sx, y: y / sy };\r\n    const score = scoreFromImagePoint(H, pCal);\r\n    const s = `${score.ring} ${score.base > 0 ? score.base : \"\"}`.trim();\r\n    setLastAutoScore(s);\r\n    setLastAutoValue(score.base);\r\n    setLastAutoRing(score.ring as Ring);\r\n    setHadRecentAuto(true);\r\n    // Optional immediate commit hook (e.g., Double Practice)\r\n    try {\r\n      if (immediateAutoCommit && onAutoDart) {\r\n        onAutoDart(score.base, score.ring as Ring, {\r\n          sector: score.sector,\r\n          mult: score.mult,\r\n        });\r\n        try {\r\n          addHeatSample({\r\n            playerId:\r\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\r\n            sector: score.sector ?? null,\r\n            mult: score.mult ?? 0,\r\n            ring: score.ring as any,\r\n            ts: Date.now(),\r\n          });\r\n        } catch {}\r\n        setHadRecentAuto(false);\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  function parseManual(\r\n    input: string,\r\n  ): { label: string; value: number; ring: Ring } | null {\r\n    const t = input.trim().toUpperCase();\r\n    if (!t) return null;\r\n    const bull = t === \"BULL\" || t === \"50\" || t === \"DBULL\" || t === \"IBULL\";\r\n    const outerBull = t === \"25\" || t === \"OBULL\";\r\n    if (bull) return { label: \"INNER_BULL 50\", value: 50, ring: \"INNER_BULL\" };\r\n    if (outerBull) return { label: \"BULL 25\", value: 25, ring: \"BULL\" };\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\r\n    if (!m) return null;\r\n    const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\r\n    const num = parseInt(m[2], 10);\r\n    if (num < 1 || num > 20) return null;\r\n    const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\r\n    const ring: Ring =\r\n      mult === \"S\" ? \"SINGLE\" : mult === \"D\" ? \"DOUBLE\" : \"TRIPLE\";\r\n    return {\r\n      label: `${mult}${num} ${num * multVal}`,\r\n      value: num * multVal,\r\n      ring,\r\n    };\r\n  }\r\n\r\n  function getCurrentRemaining(): number {\r\n    const s = matchState;\r\n    if (!s.players.length) return s.startingScore;\r\n    const p = s.players[s.currentPlayerIdx];\r\n    const leg = p.legs[p.legs.length - 1];\r\n    if (!leg) return s.startingScore;\r\n    return leg.totalScoreRemaining;\r\n  }\r\n\r\n  function addDart(value: number, label: string, ring: Ring) {\r\n    if (shouldDeferCommit && awaitingClear) {\r\n      if (!pulseManualPill) {\r\n        setPulseManualPill(true);\r\n        try {\r\n          if (pulseTimeoutRef.current) clearTimeout(pulseTimeoutRef.current);\r\n        } catch {}\r\n        pulseTimeoutRef.current = window.setTimeout(() => {\r\n          setPulseManualPill(false);\r\n          pulseTimeoutRef.current = null;\r\n        }, 1200);\r\n      }\r\n      return;\r\n    }\r\n    // In generic mode, delegate to parent without X01 bust/finish rules\r\n    if (scoringMode === \"custom\") {\r\n      if (onGenericDart)\r\n        try {\r\n          onGenericDart(value, ring, { label });\r\n        } catch {}\r\n      // Maintain a lightweight pending list for UI only\r\n      if (pendingDarts >= 3) {\r\n        // Rotate to next visit locally so we don't drop darts visually\r\n        setPendingDarts(1);\r\n        setPendingScore(value);\r\n        setPendingEntries([{ label, value, ring }]);\r\n        return;\r\n      }\r\n      const newDarts = pendingDarts + 1;\r\n      setPendingDarts(newDarts);\r\n      setPendingScore((s) => s + value);\r\n      setPendingEntries((e) => [...e, { label, value, ring }]);\r\n      return;\r\n    }\r\n\r\n    // If a new dart arrives while 3 are pending, auto-commit previous visit and start a new one\r\n    if (pendingDarts >= 3) {\r\n      const previousScore = pendingScore;\r\n      const previousDarts = pendingDarts;\r\n      // Commit previous full visit\r\n      callAddVisit(previousScore, previousDarts, {\r\n        preOpenDarts: pendingPreOpenDarts || 0,\r\n        doubleWindowDarts: pendingDartsAtDouble || 0,\r\n        finishedByDouble: false,\r\n        visitTotal: previousScore,\r\n      });\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\r\n        if (name) addSample(name, previousDarts, previousScore);\r\n      } catch {}\r\n      // Start next visit with this dart\r\n      const willCount =\r\n        !x01DoubleIn || isOpened || ring === \"DOUBLE\" || ring === \"INNER_BULL\";\r\n      const applied = willCount ? value : 0;\r\n      setPendingDarts(1);\r\n      setPendingScore(applied);\r\n      setPendingEntries([{ label, value: applied, ring }]);\r\n      setPendingPreOpenDarts(willCount ? 0 : 1);\r\n      setPendingDartsAtDouble(0);\r\n      if (\r\n        x01DoubleIn &&\r\n        !isOpened &&\r\n        (ring === \"DOUBLE\" || ring === \"INNER_BULL\")\r\n      ) {\r\n        setOpened(true);\r\n      }\r\n      enqueueVisitCommit({\r\n        score: previousScore,\r\n        darts: previousDarts,\r\n        finished: false,\r\n      });\r\n      return;\r\n    }\r\n    const newDarts = pendingDarts + 1;\r\n    // Apply X01 Double-In rule before scoring if enabled and not opened yet\r\n    const countsForScore =\r\n      !x01DoubleIn || isOpened || ring === \"DOUBLE\" || ring === \"INNER_BULL\";\r\n    const appliedValue = countsForScore ? value : 0;\r\n    if (\r\n      x01DoubleIn &&\r\n      !isOpened &&\r\n      (ring === \"DOUBLE\" || ring === \"INNER_BULL\")\r\n    ) {\r\n      setOpened(true);\r\n    }\r\n    const newScore = pendingScore + appliedValue;\r\n    const remaining = getCurrentRemaining();\r\n    const after = remaining - newScore;\r\n\r\n    // Bust conditions (double-out): negative or 1, or 0 without double/inner bull\r\n    const isFinish =\r\n      after === 0 && (ring === \"DOUBLE\" || ring === \"INNER_BULL\");\r\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish);\r\n\r\n    if (isBust) {\r\n      // Commit bust visit: 0 score, darts thrown so far including this one\r\n      const preOpenThis =\r\n        x01DoubleIn &&\r\n        !isOpened &&\r\n        !(ring === \"DOUBLE\" || ring === \"INNER_BULL\")\r\n          ? 1\r\n          : 0;\r\n      const preOpenTotal = (pendingPreOpenDarts || 0) + preOpenThis;\r\n      // Count attempts in double-out window\r\n      const postAfter = after;\r\n      const postBefore = after + appliedValue;\r\n      const attemptsThisDart =\r\n        (postBefore > 50 && postAfter <= 50) || postBefore <= 50 ? 1 : 0;\r\n      const attemptsTotal = (pendingDartsAtDouble || 0) + attemptsThisDart;\r\n      callAddVisit(0, newDarts, {\r\n        preOpenDarts: preOpenTotal,\r\n        doubleWindowDarts: attemptsTotal,\r\n        finishedByDouble: false,\r\n        visitTotal: 0,\r\n      });\r\n      setPendingDarts(0);\r\n      setPendingScore(0);\r\n      setPendingEntries([]);\r\n      setPendingPreOpenDarts(0);\r\n      setPendingDartsAtDouble(0);\r\n      enqueueVisitCommit({ score: 0, darts: newDarts, finished: false });\r\n      return;\r\n    }\r\n\r\n    // Normal add (value may be zero if not opened yet)\r\n    setPendingDarts(newDarts);\r\n    setPendingScore(newScore);\r\n    setPendingEntries((e) => [...e, { label, value: appliedValue, ring }]);\r\n    if (\r\n      x01DoubleIn &&\r\n      !isOpened &&\r\n      !(ring === \"DOUBLE\" || ring === \"INNER_BULL\")\r\n    ) {\r\n      setPendingPreOpenDarts((n) => (n || 0) + 1);\r\n    }\r\n    // Track double-out attempts within this visit\r\n    {\r\n      const postAfter = after;\r\n      const postBefore = after + appliedValue;\r\n      const countThisDart =\r\n        (postBefore > 50 && postAfter <= 50) || postBefore <= 50;\r\n      if (countThisDart) setPendingDartsAtDouble((c) => (c || 0) + 1);\r\n    }\r\n\r\n    if (isFinish) {\r\n      // Commit visit with current total and end leg\r\n      callAddVisit(newScore, newDarts, {\r\n        preOpenDarts: pendingPreOpenDarts || 0,\r\n        doubleWindowDarts: pendingDartsAtDouble || 0,\r\n        finishedByDouble: true,\r\n        visitTotal: newScore,\r\n      });\r\n      callEndLeg(newScore);\r\n      setPendingDarts(0);\r\n      setPendingScore(0);\r\n      setPendingEntries([]);\r\n      setPendingPreOpenDarts(0);\r\n      setPendingDartsAtDouble(0);\r\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: true });\r\n      return;\r\n    }\r\n\r\n    if (newDarts >= 3) {\r\n      callAddVisit(newScore, newDarts, {\r\n        preOpenDarts: pendingPreOpenDarts || 0,\r\n        doubleWindowDarts: pendingDartsAtDouble || 0,\r\n        finishedByDouble: false,\r\n        visitTotal: newScore,\r\n      });\r\n      setPendingDarts(0);\r\n      setPendingScore(0);\r\n      setPendingEntries([]);\r\n      setPendingPreOpenDarts(0);\r\n      setPendingDartsAtDouble(0);\r\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: false });\r\n    }\r\n  }\r\n\r\n  function onAddAutoDart() {\r\n    if (shouldDeferCommit && awaitingClear) return;\r\n    if (lastAutoScore) {\r\n      if (onAutoDart) {\r\n        try {\r\n          onAutoDart(lastAutoValue, lastAutoRing, undefined);\r\n        } catch {}\r\n      } else {\r\n        addDart(lastAutoValue, lastAutoScore, lastAutoRing);\r\n      }\r\n      setNonRegCount(0);\r\n      setHadRecentAuto(false);\r\n    }\r\n  }\r\n\r\n  function onApplyManual() {\r\n    if (shouldDeferCommit && awaitingClear) return;\r\n    const parsed = parseManual(manualScore);\r\n    if (!parsed) {\r\n      alert(\"Enter like T20, D16, 5, 25, 50\");\r\n      return;\r\n    }\r\n    // If autoscore didn't register recently, count toward recalibration\r\n    if (\r\n      !hadRecentAuto ||\r\n      !lastAutoScore ||\r\n      lastAutoRing === \"MISS\" ||\r\n      lastAutoValue === 0\r\n    ) {\r\n      const c = nonRegCount + 1;\r\n      setNonRegCount(c);\r\n      if (c >= 5) setShowRecalModal(true);\r\n    } else {\r\n      setNonRegCount(0);\r\n    }\r\n    addDart(parsed.value, parsed.label, parsed.ring);\r\n    setManualScore(\"\");\r\n    setHadRecentAuto(false);\r\n  }\r\n\r\n  // Replace the last pending dart with a manually typed correction\r\n  function onReplaceManual() {\r\n    if (shouldDeferCommit && awaitingClear) return;\r\n    const parsed = parseManual(manualScore);\r\n    if (!parsed) {\r\n      alert(\"Enter like T20, D16, 5, 25, 50\");\r\n      return;\r\n    }\r\n    if (pendingDarts === 0 || pendingEntries.length === 0) {\r\n      onApplyManual();\r\n      return;\r\n    }\r\n    if (scoringMode === \"custom\") {\r\n      // Let parent handle replacement semantics\r\n      if (\r\n        !hadRecentAuto ||\r\n        !lastAutoScore ||\r\n        lastAutoRing === \"MISS\" ||\r\n        lastAutoValue === 0\r\n      ) {\r\n        const c = nonRegCount + 1;\r\n        setNonRegCount(c);\r\n        if (c >= 5) setShowRecalModal(true);\r\n      } else setNonRegCount(0);\r\n\r\n      // Update local pending UI\r\n      setPendingEntries((e) => [\r\n        ...e.slice(0, -1),\r\n        { label: parsed.label, value: parsed.value, ring: parsed.ring },\r\n      ]);\r\n      if (onGenericReplace)\r\n        try {\r\n          onGenericReplace(parsed.value, parsed.ring, { label: parsed.label });\r\n        } catch {}\r\n      setManualScore(\"\");\r\n      setHadRecentAuto(false);\r\n      return;\r\n    }\r\n    if (\r\n      !hadRecentAuto ||\r\n      !lastAutoScore ||\r\n      lastAutoRing === \"MISS\" ||\r\n      lastAutoValue === 0\r\n    ) {\r\n      const c = nonRegCount + 1;\r\n      setNonRegCount(c);\r\n      if (c >= 5) setShowRecalModal(true);\r\n    } else setNonRegCount(0);\r\n\r\n    const last = pendingEntries[pendingEntries.length - 1];\r\n    const prevDarts = pendingDarts - 1;\r\n    const prevScore = pendingScore - (last?.value || 0);\r\n    const remaining = getCurrentRemaining();\r\n    const newScore = prevScore + parsed.value;\r\n    const newDarts = prevDarts + 1;\r\n    const after = remaining - newScore;\r\n    const isFinish =\r\n      after === 0 && (parsed.ring === \"DOUBLE\" || parsed.ring === \"INNER_BULL\");\r\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish);\r\n\r\n    if (isBust) {\r\n      callAddVisit(0, newDarts);\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\r\n        if (name) addSample(name, newDarts, 0);\r\n      } catch {}\r\n      setPendingDarts(0);\r\n      setPendingScore(0);\r\n      setPendingEntries([]);\r\n      enqueueVisitCommit({ score: 0, darts: newDarts, finished: false });\r\n      setManualScore(\"\");\r\n      setHadRecentAuto(false);\r\n      return;\r\n    }\r\n\r\n    setPendingDarts(newDarts);\r\n    setPendingScore(newScore);\r\n    setPendingEntries((e) => [\r\n      ...e.slice(0, -1),\r\n      { label: parsed.label, value: parsed.value, ring: parsed.ring },\r\n    ]);\r\n\r\n    if (isFinish) {\r\n      callAddVisit(newScore, newDarts);\r\n      callEndLeg(newScore);\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\r\n        if (name) addSample(name, newDarts, newScore);\r\n      } catch {}\r\n      setPendingDarts(0);\r\n      setPendingScore(0);\r\n      setPendingEntries([]);\r\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: true });\r\n      setManualScore(\"\");\r\n      setHadRecentAuto(false);\r\n      return;\r\n    }\r\n\r\n    if (newDarts >= 3) {\r\n      callAddVisit(newScore, newDarts);\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\r\n        if (name) addSample(name, newDarts, newScore);\r\n      } catch {}\r\n      setPendingDarts(0);\r\n      setPendingScore(0);\r\n      setPendingEntries([]);\r\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: false });\r\n    }\r\n    setManualScore(\"\");\r\n    setHadRecentAuto(false);\r\n  }\r\n\r\n  function onRecalibrateNow() {\r\n    setShowRecalModal(false);\r\n    setNonRegCount(0);\r\n    // Ask App to switch to calibrate tab\r\n    try {\r\n      window.dispatchEvent(new CustomEvent(\"ndn:request-calibrate\"));\r\n    } catch {}\r\n  }\r\n\r\n  function onResetCalibration() {\r\n    resetCalibration();\r\n    setShowRecalModal(false);\r\n    setNonRegCount(0);\r\n  }\r\n\r\n  // Keyboard shortcut: press 'm' to open Manual Correction (if not typing in an input)\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      try {\r\n        const active = document.activeElement as HTMLElement | null;\r\n        const tag = active?.tagName?.toLowerCase();\r\n        if (e.key === \"m\" && tag !== \"input\" && tag !== \"textarea\") {\r\n          setActiveTab(\"manual\");\r\n          setShowManualModal(true);\r\n        }\r\n      } catch {}\r\n    }\r\n    window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, []);\r\n\r\n  // Centralized quick-entry handler for S/D/T 1-20 buttons\r\n  function onQuickEntry(num: number, mult: \"S\" | \"D\" | \"T\") {\r\n    if (pendingDarts >= 3 || (shouldDeferCommit && awaitingClear)) return;\r\n    const val = num * (mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3);\r\n    const ring: Ring =\r\n      mult === \"S\" ? \"SINGLE\" : mult === \"D\" ? \"DOUBLE\" : \"TRIPLE\";\r\n    // If autoscore didn't register recently, count toward recalibration\r\n    if (\r\n      !hadRecentAuto ||\r\n      !lastAutoScore ||\r\n      lastAutoRing === \"MISS\" ||\r\n      lastAutoValue === 0\r\n    ) {\r\n      const c = nonRegCount + 1;\r\n      setNonRegCount(c);\r\n      if (c >= 5) setShowRecalModal(true);\r\n    } else {\r\n      setNonRegCount(0);\r\n    }\r\n    addDart(val, `${mult}${num} ${val}`, ring);\r\n    setHadRecentAuto(false);\r\n  }\r\n\r\n  function onUndoDart() {\r\n    if (pendingDarts === 0) return;\r\n    const last = pendingEntries[pendingEntries.length - 1];\r\n    setPendingDarts((d) => d - 1);\r\n    setPendingScore((s) => s - (last?.value || 0));\r\n    setPendingEntries((e) => e.slice(0, -1));\r\n  }\r\n\r\n  function onCommitVisit() {\r\n    if (pendingDarts === 0 || (shouldDeferCommit && awaitingClear)) return;\r\n    if (scoringMode === \"custom\") {\r\n      // For custom mode, simply clear local pending (parent maintains its own scoring)\r\n      setPendingDarts(0);\r\n      setPendingScore(0);\r\n      setPendingEntries([]);\r\n      return;\r\n    }\r\n    const visitScore = pendingScore;\r\n    const visitDarts = pendingDarts;\r\n    callAddVisit(visitScore, visitDarts);\r\n    try {\r\n      const name = matchState.players[matchState.currentPlayerIdx]?.name;\r\n      if (name) addSample(name, visitDarts, visitScore);\r\n    } catch {}\r\n    setPendingDarts(0);\r\n    setPendingScore(0);\r\n    setPendingEntries([]);\r\n    enqueueVisitCommit({\r\n      score: visitScore,\r\n      darts: visitDarts,\r\n      finished: false,\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n      {/* Pills (optional; can be hidden and controlled by parent) */}\r\n      {showToolbar && (\r\n        <div className=\"lg:col-span-2\">\r\n          <div className=\"flex items-center gap-2 mb-2\">\r\n            {!manualOnly && (\r\n              <button\r\n                className={`btn px-3 py-1 text-sm ${activeTab === \"auto\" ? \"tab--active\" : \"\"}`}\r\n                onClick={() => {\r\n                  setActiveTab(\"auto\");\r\n                  setShowManualModal(false);\r\n                  setShowAutoModal(true);\r\n                }}\r\n              >\r\n                Autoscore\r\n              </button>\r\n            )}\r\n            <button\r\n              className={`btn px-3 py-1 text-sm ${activeTab === \"manual\" ? \"tab--active\" : \"\"}`}\r\n              onClick={() => {\r\n                setActiveTab(\"manual\");\r\n                setShowManualModal(true);\r\n              }}\r\n              title=\"Open Manual Correction\"\r\n            >\r\n              Manual Correction\r\n            </button>\r\n            {manualOnly && (\r\n              <span className=\"text-xs opacity-70\">\r\n                Manual scoring mode active\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {!hideInlinePanels && !manualOnly ? (\r\n        <div className=\"card relative camera-fullwidth-card lg:col-span-2\">\r\n          <h2 className=\"text-xl font-semibold mb-3\">Camera</h2>\r\n          <ResizablePanel\r\n            storageKey=\"ndn:camera:size\"\r\n            className=\"relative rounded-2xl overflow-hidden bg-black\"\r\n            defaultWidth={480}\r\n            defaultHeight={360}\r\n            minWidth={360}\r\n            minHeight={270}\r\n            maxWidth={800}\r\n            maxHeight={600}\r\n            autoFill\r\n          >\r\n            <CameraSelector />\r\n            {(() => {\r\n              const aspect =\r\n                cameraAspect ||\r\n                useUserSettings.getState().cameraAspect ||\r\n                \"wide\";\r\n              const fit =\r\n                (cameraFitMode ||\r\n                  useUserSettings.getState().cameraFitMode ||\r\n                  \"fit\") === \"fit\";\r\n              const videoClass =\r\n                aspect === \"square\"\r\n                  ? \"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black\"\r\n                  : fit\r\n                    ? \"absolute inset-0 w-full h-full object-contain object-center bg-black\"\r\n                    : \"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black\";\r\n              const containerClass =\r\n                aspect === \"square\"\r\n                  ? \"relative w-full mx-auto aspect-square bg-black\"\r\n                  : \"relative w-full aspect-[4/3] bg-black\";\r\n              const renderVideoSurface = () => (\r\n                <div className={containerClass}>\r\n                  <video\r\n                    ref={videoRef}\r\n                    className={videoClass}\r\n                    playsInline\r\n                    muted\r\n                    autoPlay\r\n                  />\r\n                  <canvas\r\n                    ref={overlayRef}\r\n                    className=\"absolute inset-0 w-full h-full\"\r\n                    onClick={onOverlayClick}\r\n                  />\r\n                  <div\r\n                    className=\"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3 cursor-pointer select-none\"\r\n                    onDoubleClick={handleIndicatorReset}\r\n                    aria-label={`Visit status: ${pendingEntries[0] ? (pendingEntries[0].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[1] ? (pendingEntries[1].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[2] ? (pendingEntries[2].value > 0 ? \"hit\" : \"miss\") : \"pending\"}`}\r\n                  >\r\n                    {[0, 1, 2].map((i) => {\r\n                      const e = pendingEntries[i] as any;\r\n                      const entrySeq = indicatorEntryVersions[i];\r\n                      const isPending = !e;\r\n                      const isActive = !!e && entrySeq === indicatorVersion;\r\n                      const hasPositiveValue =\r\n                        typeof e?.value === \"number\" ? e.value > 0 : false;\r\n                      const hasHitRing =\r\n                        (e?.ring && e.ring !== \"MISS\") ?? false;\r\n                      const isHit =\r\n                        isActive && (hasPositiveValue || hasHitRing);\r\n                      const color = !isActive\r\n                        ? \"bg-gray-500/70\"\r\n                        : isHit\r\n                          ? \"bg-emerald-400\"\r\n                          : \"bg-rose-500\";\r\n                      const activeState = isActive && !isPending;\r\n                      return (\r\n                        <span\r\n                          key={i}\r\n                          className={`visit-dot ${activeState ? \"active\" : \"inactive\"} ${color}`}\r\n                        />\r\n                      );\r\n                    })}\r\n                    {dartTimerEnabled && dartTimeLeft !== null && (\r\n                      <span className=\"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold\">\r\n                        {Math.max(0, dartTimeLeft)}s\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  {shouldDeferCommit && awaitingClear ? (\r\n                    <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow\">\r\n                      Remove darts to continue\r\n                    </div>\r\n                  ) : null}\r\n                </div>\r\n              );\r\n              if (isPhoneCamera) {\r\n                if (!phoneFeedActive) {\r\n                  return (\r\n                    <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50\">\r\n                      <div className=\"text-center space-y-3 max-w-xs mx-auto\">\r\n                        <div className=\"text-4xl\">ðŸ“±</div>\r\n                        <div className=\"text-lg font-semibold text-blue-100\">\r\n                          Phone camera selected\r\n                        </div>\r\n                        <p className=\"text-sm text-slate-300\">\r\n                          Start streaming from the Calibrator tab or reconnect\r\n                          below.\r\n                        </p>\r\n                        <div className=\"flex items-center justify-center gap-2 flex-wrap\">\r\n                          <button\r\n                            className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\r\n                            onClick={handlePhoneReconnect}\r\n                          >\r\n                            Reconnect Phone\r\n                          </button>\r\n                          <button\r\n                            className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\r\n                            onClick={() => {\r\n                              try {\r\n                                cameraSession.setShowOverlay?.(true);\r\n                              } catch {}\r\n                            }}\r\n                          >\r\n                            Show Overlay\r\n                          </button>\r\n                          <button\r\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\r\n                            onClick={handleUseLocalCamera}\r\n                            disabled={!availableCameras.length}\r\n                          >\r\n                            Use Local Camera\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                }\r\n                return renderVideoSurface();\r\n              }\r\n              return renderVideoSurface();\r\n            })()}\r\n          </ResizablePanel>\r\n\r\n          <div className=\"mt-3 flex items-center justify-between gap-2\">\r\n            <button\r\n              className=\"btn btn--ghost px-3 py-1 text-xs font-semibold\"\r\n              onClick={() => setShowDetectionLog((prev) => !prev)}\r\n            >\r\n              {showDetectionLog ? \"Hide\" : \"Show\"} detection log\r\n            </button>\r\n            <span className=\"text-xs text-slate-400\">\r\n              Recent detections: {detectionLog.length}\r\n            </span>\r\n          </div>\r\n          {showDetectionLog && (\r\n            <div className=\"mt-2 rounded-2xl border border-white/15 bg-slate-900/80 p-3 text-xs text-white font-mono max-h-36 overflow-y-auto space-y-1\">\r\n              {detectionLog.length === 0 ? (\r\n                <div className=\"text-center text-slate-400\">\r\n                  No autoscore detections yet.\r\n                </div>\r\n              ) : (\r\n                detectionLog\r\n                  .slice()\r\n                  .reverse()\r\n                  .map((entry) => (\r\n                    <div\r\n                      key={entry.ts}\r\n                      className=\"flex items-center justify-between gap-3\"\r\n                    >\r\n                      <span\r\n                        className=\"truncate flex-1\"\r\n                        title={`Value ${entry.value} ${entry.ring}`}\r\n                      >\r\n                        {entry.label.padEnd(6, \" \")}\r\n                      </span>\r\n                      <span className=\"text-slate-400\">\r\n                        {entry.confidence.toFixed(2)}\r\n                      </span>\r\n                      <span\r\n                        className={`px-2 rounded-full text-[10px] font-semibold ${entry.accepted ? \"bg-emerald-500/80\" : entry.ready ? \"bg-amber-500/80\" : \"bg-rose-500/80\"}`}\r\n                      >\r\n                        {entry.accepted\r\n                          ? \"accepted\"\r\n                          : entry.ready\r\n                            ? \"queued\"\r\n                            : \"ignored\"}\r\n                      </span>\r\n                    </div>\r\n                  ))\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Small Manual pill in top-right of camera card so users in any game mode can open Manual Correction */}\r\n          {inProgress ? (\r\n            <div className=\"absolute top-3 right-3 z-30\">\r\n              {/**\r\n               * Autoscore state styles:\r\n               * - success: recent auto detected a valid non-miss score -> green\r\n               * - ambiguous: recent auto detected but result is miss/zero/empty -> amber\r\n               * - idle: default white/neutral\r\n               */}\r\n              {(() => {\r\n                let stateClass = \"bg-white/90 text-slate-800\";\r\n                let title = \"Manual Correction (M)\";\r\n                if (hadRecentAuto) {\r\n                  const ok =\r\n                    !!lastAutoScore &&\r\n                    lastAutoRing !== \"MISS\" &&\r\n                    lastAutoValue > 0;\r\n                  if (ok) {\r\n                    stateClass = \"bg-emerald-600 text-white\";\r\n                    title = `Manual Correction (M) â€” Autoscore: ${lastAutoScore} (confirmed)`;\r\n                  } else {\r\n                    stateClass = \"bg-amber-400 text-black\";\r\n                    title = `Manual Correction (M) â€” Autoscore ambiguous: ${lastAutoScore || \"â€”\"}`;\r\n                  }\r\n                }\r\n                // Larger, clearer pill text and padding\r\n                const baseClasses =\r\n                  \"px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90\";\r\n                const okNow =\r\n                  hadRecentAuto &&\r\n                  !!lastAutoScore &&\r\n                  lastAutoRing !== \"MISS\" &&\r\n                  lastAutoValue > 0;\r\n                const pulseClass =\r\n                  pulseManualPill && okNow\r\n                    ? \"ring-4 ring-emerald-400/60 animate-ping\"\r\n                    : hadRecentAuto && !okNow\r\n                      ? \"animate-pulse\"\r\n                      : \"\";\r\n                return (\r\n                  <button\r\n                    className={`${baseClasses} ${stateClass} ${pulseClass}`}\r\n                    onClick={() => {\r\n                      setActiveTab(\"manual\");\r\n                      setShowManualModal(true);\r\n                    }}\r\n                    title={title}\r\n                  >\r\n                    Manual\r\n                  </button>\r\n                );\r\n              })()}\r\n            </div>\r\n          ) : null}\r\n          <div className=\"flex flex-wrap items-center gap-2 mt-3\">\r\n            {isPhoneCamera ? (\r\n              <>\r\n                <div\r\n                  className={`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${phoneFeedActive ? \"bg-emerald-500/10 border-emerald-400/40 text-emerald-100\" : \"bg-amber-500/10 border-amber-400/40 text-amber-100\"}`}\r\n                >\r\n                  {phoneFeedActive\r\n                    ? \"ðŸ“± Phone camera stream active\"\r\n                    : \"ðŸ“± Waiting for phone camera stream\"}\r\n                </div>\r\n                <button\r\n                  className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\r\n                  onClick={handlePhoneReconnect}\r\n                >\r\n                  Reconnect Phone\r\n                </button>\r\n                <button\r\n                  className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\r\n                  onClick={() => {\r\n                    try {\r\n                      cameraSession.setShowOverlay?.(\r\n                        !cameraSession.showOverlay,\r\n                      );\r\n                    } catch {}\r\n                  }}\r\n                >\r\n                  {cameraSession.showOverlay ? \"Hide Overlay\" : \"Show Overlay\"}\r\n                </button>\r\n                <button\r\n                  className=\"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm\"\r\n                  disabled={!phoneFeedActive}\r\n                  onClick={() => {\r\n                    try {\r\n                      cameraSession.clearSession?.();\r\n                    } catch {}\r\n                  }}\r\n                >\r\n                  Stop Phone Feed\r\n                </button>\r\n                {canFallbackToLocal && (\r\n                  <button\r\n                    className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\r\n                    onClick={handleUseLocalCamera}\r\n                    disabled={!availableCameras.length}\r\n                  >\r\n                    Use Local Camera\r\n                  </button>\r\n                )}\r\n              </>\r\n            ) : (\r\n              <>\r\n                {!streaming ? (\r\n                  <button\r\n                    className=\"btn\"\r\n                    onClick={startCamera}\r\n                    disabled={cameraStarting}\r\n                  >\r\n                    {cameraStarting ? \"Connecting Camera...\" : \"Connect Camera\"}\r\n                  </button>\r\n                ) : (\r\n                  <button\r\n                    className=\"btn bg-rose-600 hover:bg-rose-700\"\r\n                    onClick={stopCamera}\r\n                  >\r\n                    Stop Camera\r\n                  </button>\r\n                )}\r\n              </>\r\n            )}\r\n            {!manualOnly && (\r\n              <button\r\n                className=\"btn bg-slate-700 hover:bg-slate-800\"\r\n                onClick={requestDeviceManager}\r\n                title=\"Open phone, WiFi, and USB camera options\"\r\n              >\r\n                Camera Devices\r\n              </button>\r\n            )}\r\n            <button\r\n              className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n              onClick={() => setHideCameraOverlay(!hideCameraOverlay)}\r\n              title=\"Toggle the board guide overlay\"\r\n            >\r\n              {hideCameraOverlay ? \"Show board guides\" : \"Hide board guides\"}\r\n            </button>\r\n            <button\r\n              className={`btn ${cameraEnabled ? \"bg-rose-600 hover:bg-rose-700 text-white\" : \"bg-emerald-600 hover:bg-emerald-700 text-white\"}`}\r\n              onClick={() => setCameraEnabled(!cameraEnabled)}\r\n              title=\"Toggle whether the camera is used for scoring\"\r\n            >\r\n              {cameraEnabled ? \"Disable camera mode\" : \"Enable camera mode\"}\r\n            </button>\r\n            <button\r\n              className=\"btn\"\r\n              onClick={capture}\r\n              disabled={!effectiveStreaming}\r\n            >\r\n              Capture Still\r\n            </button>\r\n            <button\r\n              className=\"btn bg-slate-700 hover:bg-slate-800\"\r\n              disabled={!effectiveStreaming}\r\n              onClick={() => {\r\n                detectorRef.current = null;\r\n                setDetectorSeedVersion((v) => v + 1);\r\n              }}\r\n            >\r\n              Reset Autoscore Background\r\n            </button>\r\n            <button\r\n              className=\"btn bg-slate-700 hover:bg-slate-800\"\r\n              onClick={() => {\r\n                try {\r\n                  window.dispatchEvent(new Event(\"ndn:camera-reset\" as any));\r\n                } catch {}\r\n              }}\r\n            >\r\n              Reset Camera Size\r\n            </button>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {/* Floating Manual Correction button (always available for quick manual typing during games) */}\r\n      {inProgress ? (\r\n        <div className=\"fixed bottom-6 right-6 z-50\">\r\n          <button\r\n            className=\"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg\"\r\n            title=\"Open Manual Correction (M)\"\r\n            onClick={() => {\r\n              setActiveTab(\"manual\");\r\n              setShowManualModal(true);\r\n            }}\r\n          >\r\n            âœï¸\r\n          </button>\r\n        </div>\r\n      ) : null}\r\n      {!hideInlinePanels && manualOnly && (\r\n        <div className=\"card\">\r\n          <h2 className=\"text-xl font-semibold mb-3\">Manual Scoring</h2>\r\n          <p className=\"text-sm opacity-80 mb-3\">\r\n            Camera-based autoscore is disabled. Use the manual visit input or\r\n            open the Manual Correction panel to record darts.\r\n          </p>\r\n          <div className=\"flex flex-wrap items-center gap-2\">\r\n            <button\r\n              className=\"btn\"\r\n              onClick={() => {\r\n                setShowManualModal(true);\r\n                setActiveTab(\"manual\");\r\n              }}\r\n            >\r\n              Open Manual Correction\r\n            </button>\r\n            <button\r\n              className=\"btn btn--ghost\"\r\n              onClick={() => {\r\n                try {\r\n                  window.dispatchEvent(new Event(\"ndn:open-scoring\" as any));\r\n                } catch {}\r\n              }}\r\n            >\r\n              Manage Pending Visit\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Snapshot panel removed to reduce unused space */}\r\n      <canvas ref={canvasRef} className=\"hidden\"></canvas>\r\n      {/* Autoscore moved into a pill-triggered modal to reduce on-screen clutter */}\r\n      {/* Modal: Autoscore */}\r\n      {showAutoModal && !manualOnly && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 z-[100]\"\r\n          role=\"dialog\"\r\n          aria-modal=\"true\"\r\n        >\r\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\r\n            <ResizableModal\r\n              storageKey=\"ndn:autoscore:size\"\r\n              className=\"w-full max-w-3xl\"\r\n              defaultWidth={720}\r\n              defaultHeight={520}\r\n              minWidth={420}\r\n              minHeight={320}\r\n              maxWidth={1400}\r\n              maxHeight={900}\r\n              initialFitHeight\r\n            >\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <h2 className=\"text-xl font-semibold\">Autoscore</h2>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    className=\"btn btn--ghost\"\r\n                    onClick={() => setShowAutoModal(false)}\r\n                  >\r\n                    Close\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-sm opacity-80 mb-3\">\r\n                Click the camera overlay to autoscore. Use Manual Correction if\r\n                the last auto is off.\r\n              </div>\r\n              <div className=\"flex items-center gap-2 mb-3 flex-wrap\">\r\n                <span className=\"font-semibold\">Last auto:</span>\r\n                <span>{lastAutoScore || \"â€”\"}</span>\r\n                <button\r\n                  className=\"btn\"\r\n                  onClick={onAddAutoDart}\r\n                  disabled={pendingDarts >= 3}\r\n                >\r\n                  Add Auto Dart\r\n                </button>\r\n                {nonRegCount > 0 && (\r\n                  <span className=\"text-sm opacity-80\">\r\n                    No-registers: {nonRegCount}/3\r\n                  </span>\r\n                )}\r\n              </div>\r\n              <div className=\"mt-2\">\r\n                <div className=\"text-sm font-semibold mb-2\">Quick entry</div>\r\n                {/* Bulls */}\r\n                <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                  <button\r\n                    className=\"btn\"\r\n                    disabled={pendingDarts >= 3}\r\n                    onClick={() => {\r\n                      if (\r\n                        !hadRecentAuto ||\r\n                        !lastAutoScore ||\r\n                        lastAutoRing === \"MISS\" ||\r\n                        lastAutoValue === 0\r\n                      ) {\r\n                        const c = nonRegCount + 1;\r\n                        setNonRegCount(c);\r\n                        if (c >= 5) setShowRecalModal(true);\r\n                      } else setNonRegCount(0);\r\n                      addDart(25, \"BULL 25\", \"BULL\");\r\n                      setHadRecentAuto(false);\r\n                    }}\r\n                  >\r\n                    25\r\n                  </button>\r\n                  <button\r\n                    className=\"btn\"\r\n                    disabled={pendingDarts >= 3}\r\n                    onClick={() => {\r\n                      if (\r\n                        !hadRecentAuto ||\r\n                        !lastAutoScore ||\r\n                        lastAutoRing === \"MISS\" ||\r\n                        lastAutoValue === 0\r\n                      ) {\r\n                        const c = nonRegCount + 1;\r\n                        setNonRegCount(c);\r\n                        if (c >= 5) setShowRecalModal(true);\r\n                      } else setNonRegCount(0);\r\n                      addDart(50, \"INNER_BULL 50\", \"INNER_BULL\");\r\n                      setHadRecentAuto(false);\r\n                    }}\r\n                  >\r\n                    50\r\n                  </button>\r\n                </div>\r\n                {/* Grouped dropdown: Doubles, Singles, Trebles */}\r\n                <div className=\"flex items-center gap-2 mb-3\">\r\n                  <input\r\n                    className=\"input w-full max-w-sm\"\r\n                    list=\"autoscore-quick-list\"\r\n                    placeholder=\"Type or select (e.g., D16, T20, S5)\"\r\n                    value={quickSelAuto}\r\n                    onChange={(e) =>\r\n                      setQuickSelAuto(e.target.value.toUpperCase())\r\n                    }\r\n                    onKeyDown={(e) => {\r\n                      if (e.key === \"Enter\") {\r\n                        const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/);\r\n                        if (m) {\r\n                          onQuickEntry(parseInt(m[2], 10), m[1] as any);\r\n                        }\r\n                      }\r\n                    }}\r\n                  />\r\n                  <datalist id=\"autoscore-quick-list\">\r\n                    {([\"D\", \"S\", \"T\"] as const).map((mult) =>\r\n                      Array.from({ length: 20 }, (_, i) => i + 1).map((num) => (\r\n                        <option key={`${mult}${num}`} value={`${mult}${num}`} />\r\n                      )),\r\n                    )}\r\n                  </datalist>\r\n                  <button\r\n                    className=\"btn\"\r\n                    disabled={!quickSelAuto || pendingDarts >= 3}\r\n                    onClick={() => {\r\n                      const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/);\r\n                      if (!m) return;\r\n                      const mult = m[1] as \"S\" | \"D\" | \"T\";\r\n                      const num = parseInt(m[2], 10);\r\n                      onQuickEntry(num, mult);\r\n                    }}\r\n                  >\r\n                    Add\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showManualModal && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 z-[100]\"\r\n          role=\"dialog\"\r\n          aria-modal=\"true\"\r\n        >\r\n          <div className=\"absolute inset-0 flex flex-col\">\r\n            <FocusLock returnFocus>\r\n              <div className=\"p-3 md:p-4 flex items-center justify-between\">\r\n                <h3 className=\"text-xl md:text-2xl font-semibold\">\r\n                  Manual Correction\r\n                </h3>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    className=\"btn bg-slate-700 hover:bg-slate-800\"\r\n                    onClick={() => {\r\n                      setShowManualModal(false);\r\n                    }}\r\n                  >\r\n                    Close\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1 p-3 md:p-4\">\r\n                <div className=\"h-full grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n                  {/* Live preview */}\r\n                  <div className=\"card relative flex flex-col\">\r\n                    <div className=\"text-sm font-semibold mb-2\">\r\n                      Live Preview\r\n                    </div>\r\n                    <div className=\"relative flex-1 rounded-2xl overflow-hidden bg-black\">\r\n                      <canvas\r\n                        ref={manualPreviewRef}\r\n                        className=\"absolute inset-0 w-full h-full\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  {/* Manual controls */}\r\n                  <div className=\"card flex flex-col\">\r\n                    <div className=\"text-sm opacity-80 mb-2\">\r\n                      Type a correction or replace the last dart. The preview\r\n                      updates live.\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                      <span className=\"font-semibold\">Last auto:</span>\r\n                      <span>{lastAutoScore || \"â€”\"}</span>\r\n                      <button\r\n                        className=\"btn\"\r\n                        onClick={onAddAutoDart}\r\n                        disabled={pendingDarts >= 3}\r\n                      >\r\n                        Add Auto Dart\r\n                      </button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                      <input\r\n                        className=\"input flex-[1.2]\"\r\n                        placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                        value={manualScore}\r\n                        onChange={(e) => setManualScore(e.target.value)}\r\n                        onKeyDown={(e) => {\r\n                          if (e.key === \"Enter\" && !e.shiftKey) {\r\n                            e.preventDefault();\r\n                            onApplyManual();\r\n                          }\r\n                          if (e.key === \"Enter\" && e.shiftKey) {\r\n                            e.preventDefault();\r\n                            onReplaceManual();\r\n                          }\r\n                        }}\r\n                      />\r\n                      <button\r\n                        className=\"btn btn--ghost\"\r\n                        onClick={onReplaceManual}\r\n                        disabled={pendingDarts === 0}\r\n                      >\r\n                        Replace Last\r\n                      </button>\r\n                      <button\r\n                        className=\"btn\"\r\n                        onClick={onApplyManual}\r\n                        disabled={pendingDarts >= 3}\r\n                      >\r\n                        Add\r\n                      </button>\r\n                    </div>\r\n                    <div className=\"text-xs opacity-70 mb-4\">\r\n                      Press Enter to Add Â· Shift+Enter to Replace Last\r\n                    </div>\r\n                    {/* Numeric keypad for quick manual numeric entry */}\r\n                    <div className=\"mb-4\">\r\n                      <div className=\"text-sm font-semibold mb-2\">\r\n                        Number pad\r\n                      </div>\r\n                      <div className=\"grid grid-cols-3 gap-2 max-w-sm\">\r\n                        {[\"7\", \"8\", \"9\", \"4\", \"5\", \"6\", \"1\", \"2\", \"3\", \"0\"].map(\r\n                          (d) => (\r\n                            <button\r\n                              key={d}\r\n                              className=\"btn text-lg\"\r\n                              onClick={() => {\r\n                                // Append digit to manualScore (keep T/D/T prefixes if present)\r\n                                setManualScore((ms) => {\r\n                                  // If existing starts with letter (S/D/T), append after it\r\n                                  if (/^[SDT]/i.test(ms)) return ms + d;\r\n                                  return (ms || \"\") + d;\r\n                                });\r\n                              }}\r\n                            >\r\n                              {d}\r\n                            </button>\r\n                          ),\r\n                        )}\r\n                        <button\r\n                          className=\"btn bg-rose-600 hover:bg-rose-700 text-white\"\r\n                          onClick={() => setManualScore(\"\")}\r\n                        >\r\n                          Clear\r\n                        </button>\r\n                        <button\r\n                          className=\"btn bg-slate-600 hover:bg-slate-700 text-white\"\r\n                          onClick={() =>\r\n                            setManualScore((ms) => (ms || \"\").slice(0, -1))\r\n                          }\r\n                        >\r\n                          âŒ«\r\n                        </button>\r\n                        <button\r\n                          className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n                          onClick={() => onApplyManual()}\r\n                          disabled={pendingDarts >= 3}\r\n                        >\r\n                          Enter\r\n                        </button>\r\n                      </div>\r\n                      <div className=\"text-xs opacity-70 mt-2\">\r\n                        Tap numbers then press Enter to submit. Use D/T prefixes\r\n                        for doubles/trebles (e.g., D16).\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"mt-auto\">\r\n                      <div className=\"text-sm font-semibold mb-2\">\r\n                        Quick entry\r\n                      </div>\r\n                      {/* Bulls */}\r\n                      <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                        <button\r\n                          className=\"btn\"\r\n                          disabled={pendingDarts >= 3}\r\n                          onClick={() => {\r\n                            if (\r\n                              !hadRecentAuto ||\r\n                              !lastAutoScore ||\r\n                              lastAutoRing === \"MISS\" ||\r\n                              lastAutoValue === 0\r\n                            ) {\r\n                              const c = nonRegCount + 1;\r\n                              setNonRegCount(c);\r\n                              if (c >= 5) setShowRecalModal(true);\r\n                            } else setNonRegCount(0);\r\n                            addDart(25, \"BULL 25\", \"BULL\");\r\n                            setHadRecentAuto(false);\r\n                          }}\r\n                        >\r\n                          25\r\n                        </button>\r\n                        <button\r\n                          className=\"btn\"\r\n                          disabled={pendingDarts >= 3}\r\n                          onClick={() => {\r\n                            if (\r\n                              !hadRecentAuto ||\r\n                              !lastAutoScore ||\r\n                              lastAutoRing === \"MISS\" ||\r\n                              lastAutoValue === 0\r\n                            ) {\r\n                              const c = nonRegCount + 1;\r\n                              setNonRegCount(c);\r\n                              if (c >= 5) setShowRecalModal(true);\r\n                            } else setNonRegCount(0);\r\n                            addDart(50, \"INNER_BULL 50\", \"INNER_BULL\");\r\n                            setHadRecentAuto(false);\r\n                          }}\r\n                        >\r\n                          50\r\n                        </button>\r\n                      </div>\r\n                      {/* Grouped dropdown: Doubles, Singles, Trebles */}\r\n                      <div className=\"flex items-center gap-2 mb-3\">\r\n                        <input\r\n                          className=\"input w-full max-w-sm\"\r\n                          list=\"manual-quick-list\"\r\n                          placeholder=\"Type or select (e.g., D16, T20, S5)\"\r\n                          value={quickSelManual}\r\n                          onChange={(e) =>\r\n                            setQuickSelManual(e.target.value.toUpperCase())\r\n                          }\r\n                          onKeyDown={(e) => {\r\n                            if (e.key === \"Enter\") {\r\n                              const m =\r\n                                quickSelManual.match(/^(S|D|T)(\\d{1,2})$/);\r\n                              if (m) {\r\n                                onQuickEntry(parseInt(m[2], 10), m[1] as any);\r\n                              }\r\n                            }\r\n                          }}\r\n                        />\r\n                        <datalist id=\"manual-quick-list\">\r\n                          {([\"D\", \"S\", \"T\"] as const).map((mult) =>\r\n                            Array.from({ length: 20 }, (_, i) => i + 1).map(\r\n                              (num) => (\r\n                                <option\r\n                                  key={`${mult}${num}`}\r\n                                  value={`${mult}${num}`}\r\n                                />\r\n                              ),\r\n                            ),\r\n                          )}\r\n                        </datalist>\r\n                        <button\r\n                          className=\"btn\"\r\n                          disabled={!quickSelManual || pendingDarts >= 3}\r\n                          onClick={() => {\r\n                            const m =\r\n                              quickSelManual.match(/^(S|D|T)(\\d{1,2})$/);\r\n                            if (!m) return;\r\n                            const mult = m[1] as \"S\" | \"D\" | \"T\";\r\n                            const num = parseInt(m[2], 10);\r\n                            onQuickEntry(num, mult);\r\n                          }}\r\n                        >\r\n                          Add\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </FocusLock>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showScoringModal && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center\">\r\n          <FocusLock returnFocus>\r\n            <div\r\n              className=\"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\"\r\n              role=\"dialog\"\r\n              aria-modal=\"true\"\r\n            >\r\n              <button\r\n                className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\"\r\n                onClick={() => setShowScoringModal(false)}\r\n                aria-label=\"Close scoring dialog\"\r\n              >\r\n                Close\r\n              </button>\r\n              <h2 className=\"text-xl font-bold mb-4 flex items-center gap-2 text-white\">\r\n                Scoring\r\n              </h2>\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Camera section */}\r\n                <div className=\"bg-black/30 rounded-2xl p-4\">\r\n                  <h2 className=\"text-lg font-semibold mb-3\">Camera</h2>\r\n                  <ResizablePanel\r\n                    storageKey=\"ndn:camera:size:modal\"\r\n                    className=\"relative rounded-2xl overflow-hidden bg-black\"\r\n                    defaultWidth={480}\r\n                    defaultHeight={360}\r\n                    minWidth={360}\r\n                    minHeight={270}\r\n                    maxWidth={800}\r\n                    maxHeight={600}\r\n                  >\r\n                    <CameraSelector />\r\n                    {(() => {\r\n                      const fit =\r\n                        (useUserSettings.getState().cameraFitMode || \"fit\") ===\r\n                        \"fit\";\r\n                      const videoClass = fit\r\n                        ? \"absolute inset-0 w-full h-full object-contain object-center bg-black\"\r\n                        : \"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black\";\r\n                      const renderVideoSurface = () => (\r\n                        <div className=\"relative w-full aspect-[4/3] bg-black\">\r\n                          <video\r\n                            ref={videoRef}\r\n                            className={videoClass}\r\n                            playsInline\r\n                            muted\r\n                            autoPlay\r\n                          />\r\n                          <canvas\r\n                            ref={overlayRef}\r\n                            className=\"absolute inset-0 w-full h-full\"\r\n                            onClick={onOverlayClick}\r\n                          />\r\n                          <div\r\n                            className=\"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3\"\r\n                            aria-label={`Visit status: ${pendingEntries[0] ? (pendingEntries[0].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[1] ? (pendingEntries[1].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[2] ? (pendingEntries[2].value > 0 ? \"hit\" : \"miss\") : \"pending\"}`}\r\n                          >\r\n                            {[0, 1, 2].map((i) => {\r\n                              const e = pendingEntries[i] as any;\r\n                              const isPending = !e;\r\n                              const isHit =\r\n                                !!e &&\r\n                                (typeof e.value === \"number\"\r\n                                  ? e.value > 0\r\n                                  : true);\r\n                              const color = isPending\r\n                                ? \"bg-gray-500/70\"\r\n                                : isHit\r\n                                  ? \"bg-emerald-400\"\r\n                                  : \"bg-rose-500\";\r\n                              return (\r\n                                <span\r\n                                  key={i}\r\n                                  className={`w-3 h-3 rounded-full shadow ${color}`}\r\n                                />\r\n                              );\r\n                            })}\r\n                            {dartTimerEnabled && dartTimeLeft !== null && (\r\n                              <span className=\"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold\">\r\n                                {Math.max(0, dartTimeLeft)}s\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          {shouldDeferCommit && awaitingClear ? (\r\n                            <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow\">\r\n                              Remove darts to continue\r\n                            </div>\r\n                          ) : null}\r\n                        </div>\r\n                      );\r\n                      if (isPhoneCamera) {\r\n                        if (!phoneFeedActive) {\r\n                          return (\r\n                            <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50\">\r\n                              <div className=\"text-center space-y-3 max-w-xs mx-auto\">\r\n                                <div className=\"text-4xl\">ðŸ“±</div>\r\n                                <div className=\"text-lg font-semibold text-blue-100\">\r\n                                  Phone camera selected\r\n                                </div>\r\n                                <p className=\"text-sm text-slate-300\">\r\n                                  Start streaming from the Calibrator tab or\r\n                                  reconnect below.\r\n                                </p>\r\n                                <div className=\"flex items-center justify-center gap-2 flex-wrap\">\r\n                                  <button\r\n                                    className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\r\n                                    onClick={handlePhoneReconnect}\r\n                                  >\r\n                                    Reconnect Phone\r\n                                  </button>\r\n                                  <button\r\n                                    className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\r\n                                    onClick={() => {\r\n                                      try {\r\n                                        cameraSession.setShowOverlay?.(true);\r\n                                      } catch {}\r\n                                    }}\r\n                                  >\r\n                                    Show Overlay\r\n                                  </button>\r\n                                  <button\r\n                                    className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\r\n                                    onClick={handleUseLocalCamera}\r\n                                    disabled={!availableCameras.length}\r\n                                  >\r\n                                    Use Local Camera\r\n                                  </button>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        }\r\n                        return renderVideoSurface();\r\n                      }\r\n                      return renderVideoSurface();\r\n                    })()}\r\n                  </ResizablePanel>\r\n                  <div className=\"flex flex-wrap items-center gap-2 mt-3\">\r\n                    {isPhoneCamera ? (\r\n                      <>\r\n                        <div\r\n                          className={`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${phoneFeedActive ? \"bg-emerald-500/10 border-emerald-400/40 text-emerald-100\" : \"bg-amber-500/10 border-amber-400/40 text-amber-100\"}`}\r\n                        >\r\n                          {phoneFeedActive\r\n                            ? \"ðŸ“± Phone camera stream active\"\r\n                            : \"ðŸ“± Waiting for phone camera stream\"}\r\n                        </div>\r\n                        <button\r\n                          className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\r\n                          onClick={handlePhoneReconnect}\r\n                        >\r\n                          Reconnect Phone\r\n                        </button>\r\n                        <button\r\n                          className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\r\n                          onClick={() => {\r\n                            try {\r\n                              cameraSession.setShowOverlay?.(\r\n                                !cameraSession.showOverlay,\r\n                              );\r\n                            } catch {}\r\n                          }}\r\n                        >\r\n                          {cameraSession.showOverlay\r\n                            ? \"Hide Overlay\"\r\n                            : \"Show Overlay\"}\r\n                        </button>\r\n                        <button\r\n                          className=\"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm\"\r\n                          disabled={!phoneFeedActive}\r\n                          onClick={() => {\r\n                            try {\r\n                              cameraSession.clearSession?.();\r\n                            } catch {}\r\n                          }}\r\n                        >\r\n                          Stop Phone Feed\r\n                        </button>\r\n                        {canFallbackToLocal && (\r\n                          <button\r\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\r\n                            onClick={handleUseLocalCamera}\r\n                            disabled={!availableCameras.length}\r\n                          >\r\n                            Use Local Camera\r\n                          </button>\r\n                        )}\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        {!streaming ? (\r\n                          <button\r\n                            className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\r\n                            onClick={startCamera}\r\n                          >\r\n                            Connect Camera\r\n                          </button>\r\n                        ) : (\r\n                          <button\r\n                            className=\"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold\"\r\n                            onClick={stopCamera}\r\n                          >\r\n                            Stop Camera\r\n                          </button>\r\n                        )}\r\n                      </>\r\n                    )}\r\n                    <button\r\n                      className=\"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold\"\r\n                      onClick={capture}\r\n                      disabled={!effectiveStreaming}\r\n                    >\r\n                      Capture Still\r\n                    </button>\r\n                    <button\r\n                      className=\"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold\"\r\n                      disabled={!effectiveStreaming}\r\n                      onClick={() => {\r\n                        detectorRef.current = null;\r\n                        setDetectorSeedVersion((v) => v + 1);\r\n                      }}\r\n                    >\r\n                      Reset Autoscore Background\r\n                    </button>\r\n                    <button\r\n                      className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\r\n                      onClick={() => {\r\n                        try {\r\n                          window.dispatchEvent(\r\n                            new Event(\"ndn:camera-reset\" as any),\r\n                          );\r\n                        } catch {}\r\n                      }}\r\n                    >\r\n                      Reset Camera Size\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                {/* Pending Visit section */}\r\n                <div className=\"bg-black/30 rounded-2xl p-4\">\r\n                  <h2 className=\"text-lg font-semibold mb-3\">Pending Visit</h2>\r\n                  <div className=\"text-sm opacity-80 mb-2\">\r\n                    Up to 3 darts per visit.\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2 mb-2\">\r\n                    {[0, 1, 2].map((i) => {\r\n                      const e = pendingEntries[i] as any;\r\n                      const isPending = !e;\r\n                      const isHit =\r\n                        !!e &&\r\n                        (typeof e.value === \"number\" ? e.value > 0 : true);\r\n                      const color = isPending\r\n                        ? \"bg-gray-500/70\"\r\n                        : isHit\r\n                          ? \"bg-emerald-400\"\r\n                          : \"bg-rose-500\";\r\n                      return (\r\n                        <span\r\n                          key={i}\r\n                          className={`w-2.5 h-2.5 rounded-full shadow ${color}`}\r\n                        />\r\n                      );\r\n                    })}\r\n                    {dartTimerEnabled && dartTimeLeft !== null && (\r\n                      <span className=\"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold\">\r\n                        {Math.max(0, dartTimeLeft)}s\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  <ul className=\"text-sm mb-2 list-disc pl-5\">\r\n                    {pendingEntries.length === 0 ? (\r\n                      <li className=\"opacity-60\">No darts yet</li>\r\n                    ) : (\r\n                      pendingEntries.map((e, i) => <li key={i}>{e.label}</li>)\r\n                    )}\r\n                  </ul>\r\n                  <div className=\"flex items-center gap-4 mb-2\">\r\n                    <div className=\"font-semibold\">Darts: {pendingDarts}/3</div>\r\n                    <div className=\"font-semibold\">Total: {pendingScore}</div>\r\n                  </div>\r\n                  <div className=\"flex gap-2\">\r\n                    <button\r\n                      className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\r\n                      onClick={onUndoDart}\r\n                      disabled={pendingDarts === 0}\r\n                    >\r\n                      Undo Dart\r\n                    </button>\r\n                    <button\r\n                      className=\"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold\"\r\n                      onClick={onCommitVisit}\r\n                      disabled={pendingDarts === 0}\r\n                    >\r\n                      Commit Visit\r\n                    </button>\r\n                    <button\r\n                      className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\r\n                      onClick={handleToolbarClear}\r\n                      disabled={pendingDarts === 0}\r\n                    >\r\n                      Clear\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </FocusLock>\r\n        </div>\r\n      )}\r\n      {showRecalModal && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <div className=\"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button\r\n              className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\"\r\n              onClick={() => {\r\n                setShowRecalModal(false);\r\n                setNonRegCount(0);\r\n              }}\r\n            >\r\n              Close\r\n            </button>\r\n            <h3 className=\"text-xl font-bold mb-2 flex items-center gap-2 text-white\">\r\n              Recalibration Recommended\r\n            </h3>\r\n            <div className=\"mb-4 text-lg font-semibold text-indigo-200\">\r\n              We detected 3 incorrect autoscores in a row. You can recalibrate\r\n              now or reset calibration and try again.\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\r\n                onClick={onRecalibrateNow}\r\n              >\r\n                Go to Calibrate\r\n              </button>\r\n              <button\r\n                className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\r\n                onClick={onResetCalibration}\r\n              >\r\n                Reset Calibration\r\n              </button>\r\n              <button\r\n                className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\r\n                onClick={() => {\r\n                  setShowRecalModal(false);\r\n                  setNonRegCount(0);\r\n                }}\r\n              >\r\n                Dismiss\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Duplicate Pending Visit panel removed to avoid showing the same controls twice when inline panels are visible. */}\r\n    </div>\r\n  );\r\n});\r\n","import React, { useEffect, useRef } from \"react\";\r\nimport useHeatmapStore from \"../store/heatmap\";\r\nimport { BoardRadii } from \"../utils/vision\";\r\n\r\nfunction polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {\r\n  const a = ((angleDeg - 90) * Math.PI) / 180.0;\r\n  return { x: cx + r * Math.cos(a), y: cy + r * Math.sin(a) };\r\n}\r\n\r\nfunction sectorAngle(sector: number) {\r\n  // SectorOrder puts 20 at top; 360/20 = 18deg per sector\r\n  const SectorOrder = [\r\n    20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5,\r\n  ];\r\n  const idx = SectorOrder.indexOf(sector);\r\n  const mid = idx * 18 + 9; // middle of sector\r\n  return mid;\r\n}\r\n\r\nexport default function HeatMap({\r\n  width = 320,\r\n  height = 320,\r\n}: {\r\n  width?: number;\r\n  height?: number;\r\n}) {\r\n  const samples = useHeatmapStore((s) => s.samples);\r\n  const ref = useRef<HTMLCanvasElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    const c = ref.current;\r\n    if (!c) return;\r\n    const ctx = c.getContext(\"2d\");\r\n    if (!ctx) return;\r\n    c.width = width;\r\n    c.height = height;\r\n    ctx.clearRect(0, 0, width, height);\r\n    // Draw a faint dartboard backdrop (rings)\r\n    const cx = width / 2;\r\n    const cy = height / 2;\r\n    const scale = Math.min(width, height) / (BoardRadii.doubleOuter * 2 + 20);\r\n    const radii = {\r\n      bullInner: BoardRadii.bullInner * scale,\r\n      bullOuter: BoardRadii.bullOuter * scale,\r\n      trebleInner: BoardRadii.trebleInner * scale,\r\n      trebleOuter: BoardRadii.trebleOuter * scale,\r\n      doubleInner: BoardRadii.doubleInner * scale,\r\n      doubleOuter: BoardRadii.doubleOuter * scale,\r\n    };\r\n    // rings\r\n    ctx.strokeStyle = \"rgba(255,255,255,0.06)\";\r\n    ctx.lineWidth = 1;\r\n    const ringOrder = [\r\n      \"doubleOuter\",\r\n      \"doubleInner\",\r\n      \"trebleOuter\",\r\n      \"trebleInner\",\r\n      \"bullOuter\",\r\n      \"bullInner\",\r\n    ] as const;\r\n    for (const k of ringOrder) {\r\n      ctx.beginPath();\r\n      ctx.arc(cx, cy, (radii as any)[k], 0, Math.PI * 2);\r\n      ctx.stroke();\r\n    }\r\n\r\n    // Aggregate sample weights by approximate xy\r\n    const points: { x: number; y: number; w: number }[] = [];\r\n    for (const s of samples) {\r\n      // if sector unknown, scatter in board\r\n      let angle = Math.random() * 360;\r\n      let r = Math.random() * radii.doubleOuter;\r\n      if (typeof s.sector === \"number\" && s.sector >= 1 && s.sector <= 20) {\r\n        angle = sectorAngle(s.sector);\r\n        // choose radius by mult/ring\r\n        if (s.ring === \"DOUBLE\")\r\n          r = (radii.doubleInner + radii.doubleOuter) / 2;\r\n        else if (s.ring === \"TRIPLE\")\r\n          r = (radii.trebleInner + radii.trebleOuter) / 2;\r\n        else if (s.ring === \"INNER_BULL\") r = radii.bullInner * 0.5;\r\n        else if (s.ring === \"BULL\") r = radii.bullOuter * 0.8;\r\n        else\r\n          r =\r\n            ((radii.trebleOuter + radii.doubleInner) / 2) *\r\n            (0.6 + Math.random() * 0.4);\r\n      }\r\n      const p = polarToCartesian(cx, cy, r, angle);\r\n      points.push({ x: p.x, y: p.y, w: 1 });\r\n    }\r\n\r\n    // Draw heat circles additive\r\n    for (const p of points) {\r\n      const grd = ctx.createRadialGradient(p.x, p.y, 1, p.x, p.y, 60);\r\n      grd.addColorStop(0, \"rgba(255,0,0,0.9)\");\r\n      grd.addColorStop(0.3, \"rgba(255,100,0,0.5)\");\r\n      grd.addColorStop(1, \"rgba(255,100,0,0)\");\r\n      ctx.fillStyle = grd;\r\n      ctx.beginPath();\r\n      ctx.arc(p.x, p.y, 60, 0, Math.PI * 2);\r\n      ctx.fill();\r\n    }\r\n\r\n    // Optionally overlay counts per sector\r\n    ctx.fillStyle = \"rgba(255,255,255,0.85)\";\r\n    ctx.font = \"12px ui-sans-serif\";\r\n    // compute counts per sector\r\n    const sectorCounts: Record<number, number> = {};\r\n    for (const s of samples)\r\n      if (s.sector) sectorCounts[s.sector] = (sectorCounts[s.sector] || 0) + 1;\r\n    for (const secStr of Object.keys(sectorCounts)) {\r\n      const sec = Number(secStr);\r\n      const a = sectorAngle(sec);\r\n      const pos = polarToCartesian(cx, cy, radii.trebleOuter + 18, a);\r\n      ctx.fillText(String(sectorCounts[sec]), pos.x - 6, pos.y + 4);\r\n    }\r\n  }, [samples, width, height]);\r\n\r\n  return (\r\n    <canvas\r\n      ref={ref}\r\n      style={{\r\n        width: \"100%\",\r\n        height: \"auto\",\r\n        borderRadius: 8,\r\n        background: \"#081018\",\r\n      }}\r\n    />\r\n  );\r\n}\r\n","export type DartMult = \"S\" | \"D\" | \"T\";\r\nexport type Dart = { mult: DartMult; num: number } | { bull: 25 | 50 };\r\n\r\nexport type DoublePracticeState = {\r\n  targetIndex: number; // 0..20 for D1..D20 then 21 for DBULL\r\n  completed: boolean;\r\n};\r\n\r\nexport const DOUBLE_PRACTICE_TARGETS: Array<{\r\n  label: string;\r\n  score: number;\r\n  isBull?: boolean;\r\n}>[] = [] as any;\r\n\r\nexport const DOUBLE_PRACTICE_ORDER: {\r\n  label: string;\r\n  score: number;\r\n  isBull?: boolean;\r\n}[] = [\r\n  ...Array.from({ length: 20 }, (_, i) => ({\r\n    label: `D${i + 1}`,\r\n    score: (i + 1) * 2,\r\n  })),\r\n  { label: \"DBULL\", score: 50, isBull: true },\r\n];\r\n\r\nexport function isDoubleHit(value: number, targetIdx: number): boolean {\r\n  const t = DOUBLE_PRACTICE_ORDER[targetIdx];\r\n  return !!t && value === t.score;\r\n}\r\n\r\nexport function parseManualDart(input: string): number | null {\r\n  const t = input.trim().toUpperCase();\r\n  if (!t) return null;\r\n  if (t === \"50\" || t === \"BULL\" || t === \"DBULL\" || t === \"IBULL\") return 50;\r\n  if (t === \"25\" || t === \"OBULL\") return 25;\r\n  const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\r\n  if (!m) return null;\r\n  const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\r\n  const num = parseInt(m[2], 10);\r\n  if (num < 1 || num > 20) return null;\r\n  const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\r\n  return num * multVal;\r\n}\r\n\r\n// Parse a detailed dart string like \"T20\", \"D16\", \"S5\", \"25\", \"50\", \"BULL\", returning a structured Dart.\r\nexport function parseDartDetailed(input: string): Dart | null {\r\n  const t = input.trim().toUpperCase();\r\n  if (!t) return null;\r\n  if (\r\n    t === \"50\" ||\r\n    t === \"BULL\" ||\r\n    t === \"DBULL\" ||\r\n    t === \"IBULL\" ||\r\n    t === \"INNER BULL\" ||\r\n    t === \"INNER_BULL\"\r\n  )\r\n    return { bull: 50 };\r\n  if (t === \"25\" || t === \"OBULL\" || t === \"OUTER BULL\" || t === \"BULL25\")\r\n    return { bull: 25 };\r\n  const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\r\n  if (!m) return null;\r\n  const mult = (m[1] || \"S\") as DartMult;\r\n  const num = parseInt(m[2], 10);\r\n  if (num < 1 || num > 20) return null;\r\n  return { mult, num };\r\n}\r\n\r\n// Convert autoscore ring+sector data into a structured Dart\r\n// ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n// sector: 1..20 for numbered segments; null/undefined for bull/miss\r\nexport function ringSectorToDart(\r\n  ring?: string,\r\n  sector?: number | null,\r\n): Dart | null {\r\n  if (!ring || ring === \"MISS\") return null;\r\n  if (ring === \"BULL\") return { bull: 25 };\r\n  if (ring === \"INNER_BULL\") return { bull: 50 };\r\n  if (typeof sector === \"number\" && sector >= 1 && sector <= 20) {\r\n    const mult: DartMult =\r\n      ring === \"DOUBLE\" ? \"D\" : ring === \"TRIPLE\" ? \"T\" : \"S\";\r\n    return { mult, num: sector };\r\n  }\r\n  return null;\r\n}\r\n","export type ATCState = {\r\n  target: number; // 1..20 then 25 (outer bull) then 50 (inner)\r\n  finished: boolean;\r\n};\r\n\r\nexport const ATC_ORDER: number[] = [\r\n  ...Array.from({ length: 20 }, (_, i) => i + 1),\r\n  25,\r\n  50,\r\n];\r\n\r\nexport function nextTarget(current: number): number | null {\r\n  const idx = ATC_ORDER.indexOf(current);\r\n  if (idx < 0) return ATC_ORDER[0];\r\n  if (idx >= ATC_ORDER.length - 1) return null;\r\n  return ATC_ORDER[idx + 1];\r\n}\r\n\r\nexport function isCorrectHit(value: number, target: number): boolean {\r\n  return value === target;\r\n}\r\n","export type CricketMark = 0 | 1 | 2 | 3;\r\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25; // 25 is bull (outer+inner)\r\n\r\nexport type CricketState = {\r\n  // marks per number\r\n  marks: Record<CricketNumber, CricketMark>;\r\n  // accumulated points when opponent hasn't closed a number\r\n  points: number;\r\n};\r\n\r\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25];\r\n\r\nexport function createCricketState(): CricketState {\r\n  const marks: any = {};\r\n  CRICKET_NUMBERS.forEach((n) => {\r\n    marks[n] = 0;\r\n  });\r\n  return { marks, points: 0 };\r\n}\r\n\r\n// Apply a single dart to a player's cricket state\r\n// Returns deltaPoints scored on this dart\r\nexport function applyCricketDart(\r\n  state: CricketState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n  opponentClosed: (n: CricketNumber) => boolean = () => false,\r\n): number {\r\n  // Map autoscore terms to logical hits\r\n  let num: CricketNumber | null = null;\r\n  let hits = 0;\r\n  if (\r\n    ring === \"BULL\" ||\r\n    ring === \"INNER_BULL\" ||\r\n    value === 25 ||\r\n    value === 50\r\n  ) {\r\n    num = 25;\r\n    hits = ring === \"INNER_BULL\" || value === 50 ? 2 : 1;\r\n  } else if (\r\n    typeof sector === \"number\" &&\r\n    (sector as number) >= 15 &&\r\n    (sector as number) <= 20\r\n  ) {\r\n    num = sector as CricketNumber;\r\n    if (ring === \"TRIPLE\") hits = 3;\r\n    else if (ring === \"DOUBLE\") hits = 2;\r\n    else hits = 1;\r\n  } else if (value) {\r\n    // Fallback when only numeric score provided (manual): infer by divisibility\r\n    const cand: CricketNumber[] = [20, 19, 18, 17, 16, 15];\r\n    for (const c of cand) {\r\n      if (value === c) {\r\n        num = c;\r\n        hits = 1;\r\n        break;\r\n      }\r\n      if (value === c * 2) {\r\n        num = c;\r\n        hits = 2;\r\n        break;\r\n      }\r\n      if (value === c * 3) {\r\n        num = c;\r\n        hits = 3;\r\n        break;\r\n      }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) {\r\n      num = 25;\r\n      hits = value === 50 ? 2 : 1;\r\n    }\r\n  }\r\n  if (!num) return 0;\r\n\r\n  const before = state.marks[num];\r\n  const remainToClose = Math.max(0, 3 - before);\r\n  const toApply = Math.min(remainToClose, hits);\r\n  const overflow = Math.max(0, hits - toApply);\r\n  // Increase marks up to 3\r\n  const after = (before + toApply) as CricketMark;\r\n  state.marks[num] = after > 3 ? 3 : after;\r\n\r\n  // Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\r\n  let points = 0;\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      // Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\r\n      if (ring === \"INNER_BULL\") points += 50 * overflow;\r\n      else points += 25 * overflow;\r\n    } else {\r\n      points += num * overflow;\r\n    }\r\n  }\r\n\r\n  state.points += points;\r\n  return points;\r\n}\r\n\r\nexport function hasClosedAll(state: CricketState): boolean {\r\n  return CRICKET_NUMBERS.every((n) => (state.marks[n] || 0) >= 3);\r\n}\r\n\r\nexport function cricketWinner(\r\n  self: CricketState,\r\n  opponents: CricketState[],\r\n): boolean {\r\n  // Win when all closed and you have >= opponents' points\r\n  if (!hasClosedAll(self)) return false;\r\n  const maxOppPoints = Math.max(0, ...opponents.map((o) => o.points));\r\n  return self.points >= maxOppPoints;\r\n}\r\n","export type ShanghaiRound =\r\n  | 1\r\n  | 2\r\n  | 3\r\n  | 4\r\n  | 5\r\n  | 6\r\n  | 7\r\n  | 8\r\n  | 9\r\n  | 10\r\n  | 11\r\n  | 12\r\n  | 13\r\n  | 14\r\n  | 15\r\n  | 16\r\n  | 17\r\n  | 18\r\n  | 19\r\n  | 20;\r\n\r\nexport type ShanghaiState = {\r\n  round: ShanghaiRound;\r\n  score: number;\r\n  finished: boolean;\r\n  shanghaiAchieved: boolean; // single+double+triple of target in same 3-dart turn\r\n  turnHits: { singles: number; doubles: number; triples: number };\r\n};\r\n\r\nexport function createShanghaiState(): ShanghaiState {\r\n  return {\r\n    round: 1,\r\n    score: 0,\r\n    finished: false,\r\n    shanghaiAchieved: false,\r\n    turnHits: { singles: 0, doubles: 0, triples: 0 },\r\n  };\r\n}\r\n\r\nexport function getRoundTarget(state: ShanghaiState): number {\r\n  return state.round;\r\n}\r\n\r\n// Apply one dart; returns points scored on this dart\r\nexport function applyShanghaiDart(\r\n  state: ShanghaiState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): number {\r\n  if (state.finished) return 0;\r\n  const target = getRoundTarget(state);\r\n  let points = 0;\r\n  if (typeof sector === \"number\" && sector === target) {\r\n    if (ring === \"TRIPLE\") {\r\n      points = target * 3;\r\n      state.turnHits.triples++;\r\n    } else if (ring === \"DOUBLE\") {\r\n      points = target * 2;\r\n      state.turnHits.doubles++;\r\n    } else if (ring === \"SINGLE\") {\r\n      points = target * 1;\r\n      state.turnHits.singles++;\r\n    }\r\n  } else if (\r\n    !sector &&\r\n    (value === target || value === target * 2 || value === target * 3)\r\n  ) {\r\n    // manual numeric entry fallback\r\n    if (value === target * 3) {\r\n      points = target * 3;\r\n      state.turnHits.triples++;\r\n    } else if (value === target * 2) {\r\n      points = target * 2;\r\n      state.turnHits.doubles++;\r\n    } else if (value === target) {\r\n      points = target;\r\n      state.turnHits.singles++;\r\n    }\r\n  }\r\n  state.score += points;\r\n  return points;\r\n}\r\n\r\n// Call at end of 3-dart turn; advances round and checks Shanghai\r\nexport function endShanghaiTurn(state: ShanghaiState) {\r\n  if (!state.finished) {\r\n    if (\r\n      state.turnHits.singles > 0 &&\r\n      state.turnHits.doubles > 0 &&\r\n      state.turnHits.triples > 0\r\n    ) {\r\n      state.shanghaiAchieved = true;\r\n      state.finished = true;\r\n      return;\r\n    }\r\n    const next = (state.round + 1) as ShanghaiRound;\r\n    if (next > 20) {\r\n      state.finished = true;\r\n    } else {\r\n      state.round = next;\r\n    }\r\n  }\r\n  // reset per-turn hits\r\n  state.turnHits = { singles: 0, doubles: 0, triples: 0 };\r\n}\r\n","export type HalveItTarget =\r\n  | { kind: \"ANY_NUMBER\" }\r\n  | { kind: \"DOUBLE\"; num: number }\r\n  | { kind: \"TRIPLE\"; num: number }\r\n  | { kind: \"BULL\" }\r\n  | { kind: \"NUMBER\"; num: number };\r\n\r\nexport type HalveItState = {\r\n  stage: number;\r\n  targets: HalveItTarget[];\r\n  score: number;\r\n  finished: boolean;\r\n  hitThisRound: boolean;\r\n};\r\n\r\nexport function createDefaultHalveIt(): HalveItState {\r\n  const targets: HalveItTarget[] = [\r\n    { kind: \"NUMBER\", num: 20 },\r\n    { kind: \"DOUBLE\", num: 16 },\r\n    { kind: \"TRIPLE\", num: 14 },\r\n    { kind: \"NUMBER\", num: 19 },\r\n    { kind: \"BULL\" },\r\n    { kind: \"ANY_NUMBER\" },\r\n  ];\r\n  return { stage: 0, targets, score: 0, finished: false, hitThisRound: false };\r\n}\r\n\r\nexport function getCurrentHalveTarget(\r\n  state: HalveItState,\r\n): HalveItTarget | null {\r\n  return state.targets[state.stage] || null;\r\n}\r\n\r\nexport function applyHalveItDart(\r\n  state: HalveItState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): number {\r\n  if (state.finished) return 0;\r\n  const t = getCurrentHalveTarget(state);\r\n  if (!t) return 0;\r\n  let scored = 0;\r\n  switch (t.kind) {\r\n    case \"NUMBER\": {\r\n      if (typeof sector === \"number\" && sector === t.num) {\r\n        if (ring === \"TRIPLE\") scored = t.num * 3;\r\n        else if (ring === \"DOUBLE\") scored = t.num * 2;\r\n        else if (ring === \"SINGLE\") scored = t.num;\r\n      } else if (\r\n        !sector &&\r\n        (value === t.num || value === t.num * 2 || value === t.num * 3)\r\n      ) {\r\n        scored = value;\r\n      }\r\n      if (scored > 0) state.hitThisRound = true;\r\n      break;\r\n    }\r\n    case \"DOUBLE\": {\r\n      if ((ring === \"DOUBLE\" && sector === t.num) || value === t.num * 2) {\r\n        scored = t.num * 2;\r\n        state.hitThisRound = true;\r\n      }\r\n      break;\r\n    }\r\n    case \"TRIPLE\": {\r\n      if ((ring === \"TRIPLE\" && sector === t.num) || value === t.num * 3) {\r\n        scored = t.num * 3;\r\n        state.hitThisRound = true;\r\n      }\r\n      break;\r\n    }\r\n    case \"BULL\": {\r\n      if (\r\n        ring === \"BULL\" ||\r\n        ring === \"INNER_BULL\" ||\r\n        value === 25 ||\r\n        value === 50\r\n      ) {\r\n        scored = ring === \"INNER_BULL\" || value === 50 ? 50 : 25;\r\n        state.hitThisRound = true;\r\n      }\r\n      break;\r\n    }\r\n    case \"ANY_NUMBER\": {\r\n      // any valid score counts\r\n      if (value > 0) {\r\n        scored = value;\r\n        state.hitThisRound = true;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  state.score += scored;\r\n  return scored;\r\n}\r\n\r\nexport function endHalveItTurn(state: HalveItState) {\r\n  if (state.finished) return;\r\n  if (!state.hitThisRound) {\r\n    state.score = Math.floor(state.score / 2);\r\n  }\r\n  state.hitThisRound = false;\r\n  state.stage += 1;\r\n  if (state.stage >= state.targets.length) state.finished = true;\r\n}\r\n","export type HighLowState = {\r\n  round: number;\r\n  score: number;\r\n  target: \"HIGH\" | \"LOW\";\r\n  finished: boolean;\r\n};\r\n\r\nexport function createHighLow(): HighLowState {\r\n  return { round: 1, score: 0, target: \"HIGH\", finished: false };\r\n}\r\n\r\nexport function applyHighLowDart(\r\n  state: HighLowState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): number {\r\n  if (state.finished) return 0;\r\n  // For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\r\n  // When LOW, count only scores <= 10 (any ring) and bull does not count\r\n  let scored = 0;\r\n  if (state.target === \"HIGH\") {\r\n    if (ring === \"INNER_BULL\") scored = 50;\r\n    else if (typeof sector === \"number\") {\r\n      const mult = ring === \"TRIPLE\" ? 3 : ring === \"DOUBLE\" ? 2 : 1;\r\n      const v = sector * mult;\r\n      if (sector >= 20) scored = v;\r\n    } else {\r\n      // manual numeric fallback\r\n      if (value >= 40) scored = value;\r\n    }\r\n  } else {\r\n    if (typeof sector === \"number\") {\r\n      const mult = ring === \"TRIPLE\" ? 3 : ring === \"DOUBLE\" ? 2 : 1;\r\n      const v = sector * mult;\r\n      if (sector <= 10) scored = v;\r\n    } else {\r\n      if (value > 0 && value <= 30) scored = value;\r\n    }\r\n  }\r\n  state.score += scored;\r\n  return scored;\r\n}\r\n\r\nexport function endHighLowTurn(state: HighLowState) {\r\n  if (state.finished) return;\r\n  state.round += 1;\r\n  if (state.round > 10) {\r\n    state.finished = true;\r\n    return;\r\n  }\r\n  state.target = state.target === \"HIGH\" ? \"LOW\" : \"HIGH\";\r\n}\r\n","export type KillerState = {\r\n  number: number; // assigned sector 1..20\r\n  lives: number; // start with 3\r\n  isKiller: boolean; // became killer by hitting own double\r\n  eliminated: boolean;\r\n};\r\n\r\nexport function createKillerState(assigned: number, lives = 3): KillerState {\r\n  return { number: assigned, lives, isKiller: false, eliminated: false };\r\n}\r\n\r\n// Assign unique random numbers (1..20) to each player id\r\nexport function assignKillerNumbers<T extends string>(\r\n  playerIds: T[],\r\n): Record<T, number> {\r\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1);\r\n  const res: any = {};\r\n  for (const id of playerIds) {\r\n    // pick a random remaining number\r\n    const idx = Math.floor(Math.random() * pool.length);\r\n    const num = pool.splice(idx, 1)[0];\r\n    res[id] = num;\r\n  }\r\n  return res;\r\n}\r\n\r\n// Apply a single dart in Killer context.\r\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\r\nexport function applyKillerDart(\r\n  selfId: string,\r\n  states: Record<string, KillerState>,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\r\n  const me = states[selfId];\r\n  if (!me || !sector || !ring) return { becameKiller: false };\r\n  // Becoming killer: hit your own DOUBLE only\r\n  if (!me.isKiller && ring === \"DOUBLE\" && sector === me.number) {\r\n    me.isKiller = true;\r\n    return { becameKiller: true };\r\n  }\r\n  // If already killer, hitting opponents' doubles/triples removes lives\r\n  if (me.isKiller && (ring === \"DOUBLE\" || ring === \"TRIPLE\")) {\r\n    const victimId = Object.keys(states).find(\r\n      (pid) =>\r\n        pid !== selfId &&\r\n        !states[pid].eliminated &&\r\n        states[pid].number === sector,\r\n    );\r\n    if (victimId) {\r\n      const victim = states[victimId];\r\n      const delta = ring === \"TRIPLE\" ? 2 : 1;\r\n      victim.lives = Math.max(0, victim.lives - delta);\r\n      if (victim.lives === 0) victim.eliminated = true;\r\n      return { becameKiller: false, victimId, livesRemoved: delta };\r\n    }\r\n  }\r\n  return { becameKiller: false };\r\n}\r\n\r\nexport function killerWinner(\r\n  states: Record<string, KillerState>,\r\n): string | null {\r\n  const alive = Object.entries(states).filter(\r\n    ([, st]) => !st.eliminated && st.lives > 0,\r\n  );\r\n  if (alive.length === 1) return alive[0][0];\r\n  return null;\r\n}\r\n","export type BaseballInning = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9;\r\n\r\nexport type BaseballState = {\r\n  inning: BaseballInning;\r\n  score: number;\r\n  dartsThisInning: number;\r\n  finished: boolean;\r\n};\r\n\r\nexport function createBaseball(): BaseballState {\r\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false };\r\n}\r\n\r\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\r\nexport function applyBaseballDart(\r\n  state: BaseballState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\r\n  sector?: number | null,\r\n): number {\r\n  if (state.finished) return 0;\r\n  let runs = 0;\r\n  if (typeof sector === \"number\" && sector === state.inning) {\r\n    if (ring === \"TRIPLE\") runs = 3;\r\n    else if (ring === \"DOUBLE\") runs = 2;\r\n    else runs = 1;\r\n  } else if (\r\n    !sector &&\r\n    (value === state.inning ||\r\n      value === state.inning * 2 ||\r\n      value === state.inning * 3)\r\n  ) {\r\n    runs = value === state.inning * 3 ? 3 : value === state.inning * 2 ? 2 : 1;\r\n  }\r\n  state.score += runs;\r\n  state.dartsThisInning += 1;\r\n  if (state.dartsThisInning >= 3) {\r\n    const next = (state.inning + 1) as BaseballInning;\r\n    if (next > 9) state.finished = true;\r\n    else {\r\n      state.inning = next;\r\n      state.dartsThisInning = 0;\r\n    }\r\n  }\r\n  return runs;\r\n}\r\n","export type GolfHole =\r\n  | 1\r\n  | 2\r\n  | 3\r\n  | 4\r\n  | 5\r\n  | 6\r\n  | 7\r\n  | 8\r\n  | 9\r\n  | 10\r\n  | 11\r\n  | 12\r\n  | 13\r\n  | 14\r\n  | 15\r\n  | 16\r\n  | 17\r\n  | 18;\r\n\r\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\r\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\r\n\r\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\r\n  1: 5,\r\n  2: 20,\r\n  3: 1,\r\n  4: 18,\r\n  5: 4,\r\n  6: 13,\r\n  7: 6,\r\n  8: 10,\r\n  9: 15,\r\n  10: 2,\r\n  11: 17,\r\n  12: 3,\r\n  13: 19,\r\n  14: 7,\r\n  15: 16,\r\n  16: 8,\r\n  17: 11,\r\n  18: 14,\r\n};\r\n\r\nexport type GolfState = {\r\n  hole: GolfHole;\r\n  strokes: number;\r\n  dartsThisHole: number;\r\n  finished: boolean;\r\n};\r\n\r\nexport function createGolf(): GolfState {\r\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false };\r\n}\r\n\r\nexport function applyGolfDart(\r\n  state: GolfState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\r\n  sector?: number | null,\r\n): boolean {\r\n  if (state.finished) return false;\r\n  const target = GOLF_TARGETS[state.hole];\r\n  state.dartsThisHole += 1;\r\n  const hit =\r\n    (typeof sector === \"number\" &&\r\n      sector === target &&\r\n      (ring === \"SINGLE\" || ring === \"DOUBLE\" || ring === \"TRIPLE\")) ||\r\n    (!sector &&\r\n      (value === target || value === target * 2 || value === target * 3));\r\n  if (hit) {\r\n    state.strokes += state.dartsThisHole;\r\n    // advance to next hole\r\n    const next = (state.hole + 1) as GolfHole;\r\n    if (next > 18) state.finished = true;\r\n    else {\r\n      state.hole = next;\r\n      state.dartsThisHole = 0;\r\n    }\r\n    return true;\r\n  }\r\n  // If not finished and took 3 darts, score 3 and advance hole\r\n  if (state.dartsThisHole >= 3) {\r\n    state.strokes += 3;\r\n    const next = (state.hole + 1) as GolfHole;\r\n    if (next > 18) state.finished = true;\r\n    else {\r\n      state.hole = next;\r\n      state.dartsThisHole = 0;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n","export type TicCell = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8;\r\n\r\n// Map grid cells to targets: center uses Bull; edges/corners use numbers.\r\nexport const TTT_TARGETS: Record<\r\n  TicCell,\r\n  { type: \"NUM\" | \"BULL\"; num?: number }\r\n> = {\r\n  0: { type: \"NUM\", num: 20 },\r\n  1: { type: \"NUM\", num: 19 },\r\n  2: { type: \"NUM\", num: 18 },\r\n  3: { type: \"NUM\", num: 17 },\r\n  4: { type: \"BULL\" },\r\n  5: { type: \"NUM\", num: 16 },\r\n  6: { type: \"NUM\", num: 15 },\r\n  7: { type: \"NUM\", num: 14 },\r\n  8: { type: \"NUM\", num: 13 },\r\n};\r\n\r\nexport type TicTacToeState = {\r\n  board: Array<\"X\" | \"O\" | null>;\r\n  turn: \"X\" | \"O\";\r\n  finished: boolean;\r\n  winner: \"X\" | \"O\" | \"Draw\" | null;\r\n};\r\n\r\nexport function createTicTacToe(): TicTacToeState {\r\n  return {\r\n    board: Array(9).fill(null),\r\n    turn: \"X\",\r\n    finished: false,\r\n    winner: null,\r\n  };\r\n}\r\n\r\nfunction checkWin(board: Array<\"X\" | \"O\" | null>): \"X\" | \"O\" | \"Draw\" | null {\r\n  const lines = [\r\n    [0, 1, 2],\r\n    [3, 4, 5],\r\n    [6, 7, 8],\r\n    [0, 3, 6],\r\n    [1, 4, 7],\r\n    [2, 5, 8],\r\n    [0, 4, 8],\r\n    [2, 4, 6],\r\n  ];\r\n  for (const [a, b, c] of lines) {\r\n    if (board[a] && board[a] === board[b] && board[a] === board[c])\r\n      return board[a] as \"X\" | \"O\";\r\n  }\r\n  if (board.every((c) => c)) return \"Draw\";\r\n  return null;\r\n}\r\n\r\nexport function tryClaimCell(\r\n  state: TicTacToeState,\r\n  cell: TicCell,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): boolean {\r\n  if (state.finished || state.board[cell]) return false;\r\n  const tgt = TTT_TARGETS[cell];\r\n  let ok = false;\r\n  if (tgt.type === \"BULL\")\r\n    ok =\r\n      ring === \"BULL\" || ring === \"INNER_BULL\" || value === 25 || value === 50;\r\n  else if (tgt.type === \"NUM\" && typeof tgt.num === \"number\") {\r\n    if (typeof sector === \"number\" && sector === tgt.num) ok = true;\r\n    else if (\r\n      !sector &&\r\n      (value === tgt.num || value === tgt.num * 2 || value === tgt.num * 3)\r\n    )\r\n      ok = true;\r\n  }\r\n  if (!ok) return false;\r\n  state.board[cell] = state.turn;\r\n  const w = checkWin(state.board);\r\n  if (w) {\r\n    state.finished = true;\r\n    state.winner = w;\r\n    return true;\r\n  }\r\n  state.turn = state.turn === \"X\" ? \"O\" : \"X\";\r\n  return true;\r\n}\r\n","/**\r\n * Scam, Fives, and Sevens game logic\r\n * All three follow a similar score-race pattern:\r\n * - Players accumulate scores\r\n * - Only certain numbers count\r\n * - First to reach target wins\r\n */\r\n\r\n// SCAM/SCUM - Hit targets 1â†’20â†’Bull in sequence\r\nexport interface ScamState {\r\n  targetIndex: number; // 0-20 for numbers 1-20, 21 for bull (25/50)\r\n  darts: number;\r\n  finished: boolean;\r\n}\r\n\r\nexport function createScamState(): ScamState {\r\n  return {\r\n    targetIndex: 0,\r\n    darts: 0,\r\n    finished: false,\r\n  };\r\n}\r\n\r\nexport const SCAM_TARGETS = [\r\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25,\r\n];\r\nexport const SCAM_TARGET_NAMES = [\r\n  \"1\",\r\n  \"2\",\r\n  \"3\",\r\n  \"4\",\r\n  \"5\",\r\n  \"6\",\r\n  \"7\",\r\n  \"8\",\r\n  \"9\",\r\n  \"10\",\r\n  \"11\",\r\n  \"12\",\r\n  \"13\",\r\n  \"14\",\r\n  \"15\",\r\n  \"16\",\r\n  \"17\",\r\n  \"18\",\r\n  \"19\",\r\n  \"20\",\r\n  \"Bull\",\r\n];\r\n\r\nexport function getScamTarget(state: ScamState): number {\r\n  return SCAM_TARGETS[state.targetIndex];\r\n}\r\n\r\nexport function addScamAuto(\r\n  state: ScamState,\r\n  value: number,\r\n  ring?: string,\r\n): ScamState {\r\n  if (state.finished) return state;\r\n\r\n  const target = getScamTarget(state);\r\n  const targetHit =\r\n    (ring === \"SINGLE\" && value === target) ||\r\n    (ring === \"DOUBLE\" && value === target) ||\r\n    (ring === \"TRIPLE\" && value === target) ||\r\n    (ring === \"INNER_BULL\" && target === 25);\r\n\r\n  if (!targetHit) return state;\r\n\r\n  // Hit! Move to next target\r\n  const newIndex = state.targetIndex + 1;\r\n  const finished = newIndex >= SCAM_TARGETS.length;\r\n\r\n  return {\r\n    targetIndex: newIndex,\r\n    darts: state.darts + 1,\r\n    finished,\r\n  };\r\n}\r\n\r\nexport function addScamNumeric(state: ScamState, value: number): ScamState {\r\n  // For manual input, assume single ring hit\r\n  return addScamAuto(state, value, \"SINGLE\");\r\n}\r\n\r\nexport function resetScam(): ScamState {\r\n  return createScamState();\r\n}\r\n\r\n// FIVES - Only multiples of 5 count (5,10,15,20,25,50)\r\nexport interface FivesState {\r\n  score: number;\r\n  darts: number;\r\n  finished: boolean;\r\n  target: number; // default 50\r\n}\r\n\r\nexport function createFivesState(target: number = 50): FivesState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  };\r\n}\r\n\r\nexport const FIVES_VALID_NUMBERS = [5, 10, 15, 20, 25, 50];\r\n\r\nexport function isFivesValid(value: number): boolean {\r\n  return FIVES_VALID_NUMBERS.includes(value);\r\n}\r\n\r\nexport function addFivesAuto(\r\n  state: FivesState,\r\n  value: number,\r\n  ring?: string,\r\n): FivesState {\r\n  if (state.finished) return state;\r\n\r\n  // Only multiples of 5 count\r\n  if (!isFivesValid(value)) {\r\n    return { ...state, darts: state.darts + 1 };\r\n  }\r\n\r\n  const newScore = state.score + value;\r\n  const finished = newScore >= state.target;\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  };\r\n}\r\n\r\nexport function addFivesNumeric(state: FivesState, value: number): FivesState {\r\n  return addFivesAuto(state, value, \"SINGLE\");\r\n}\r\n\r\nexport function resetFives(target: number = 50): FivesState {\r\n  return createFivesState(target);\r\n}\r\n\r\n// SEVENS - Only multiples of 7 count (7,14,21)\r\nexport interface SevensState {\r\n  score: number;\r\n  darts: number;\r\n  finished: boolean;\r\n  target: number; // default 70\r\n}\r\n\r\nexport function createSevensState(target: number = 70): SevensState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  };\r\n}\r\n\r\nexport const SEVENS_VALID_NUMBERS = [7, 14, 21];\r\n\r\nexport function isSevensValid(value: number): boolean {\r\n  return SEVENS_VALID_NUMBERS.includes(value);\r\n}\r\n\r\nexport function addSevensAuto(\r\n  state: SevensState,\r\n  value: number,\r\n  ring?: string,\r\n): SevensState {\r\n  if (state.finished) return state;\r\n\r\n  // Only multiples of 7 count\r\n  if (!isSevensValid(value)) {\r\n    return { ...state, darts: state.darts + 1 };\r\n  }\r\n\r\n  const newScore = state.score + value;\r\n  const finished = newScore >= state.target;\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  };\r\n}\r\n\r\nexport function addSevensNumeric(\r\n  state: SevensState,\r\n  value: number,\r\n): SevensState {\r\n  return addSevensAuto(state, value, \"SINGLE\");\r\n}\r\n\r\nexport function resetSevens(target: number = 70): SevensState {\r\n  return createSevensState(target);\r\n}\r\n","export type AmCricketMark = 0 | 1 | 2 | 3;\r\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25;\r\n\r\nexport type AmCricketState = {\r\n  marks: Record<AmCricketNumber, AmCricketMark>;\r\n  points: number;\r\n};\r\n\r\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [\r\n  20, 19, 18, 17, 16, 15, 14, 13, 12, 25,\r\n];\r\n\r\nexport function createAmCricketState(): AmCricketState {\r\n  const marks: any = {};\r\n  AM_CRICKET_NUMBERS.forEach((n) => {\r\n    marks[n] = 0;\r\n  });\r\n  return { marks, points: 0 };\r\n}\r\n\r\nexport function applyAmCricketDart(\r\n  state: AmCricketState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n  opponentClosed: (n: AmCricketNumber) => boolean = () => false,\r\n): number {\r\n  let num: AmCricketNumber | null = null;\r\n  let hits = 0;\r\n  if (\r\n    ring === \"BULL\" ||\r\n    ring === \"INNER_BULL\" ||\r\n    value === 25 ||\r\n    value === 50\r\n  ) {\r\n    num = 25;\r\n    hits = ring === \"INNER_BULL\" || value === 50 ? 2 : 1;\r\n  } else if (typeof sector === \"number\" && sector >= 12 && sector <= 20) {\r\n    num = sector as AmCricketNumber;\r\n    if (ring === \"TRIPLE\") hits = 3;\r\n    else if (ring === \"DOUBLE\") hits = 2;\r\n    else hits = 1;\r\n  } else if (value) {\r\n    for (const c of [20, 19, 18, 17, 16, 15, 14, 13, 12] as AmCricketNumber[]) {\r\n      if (value === c) {\r\n        num = c;\r\n        hits = 1;\r\n        break;\r\n      }\r\n      if (value === c * 2) {\r\n        num = c;\r\n        hits = 2;\r\n        break;\r\n      }\r\n      if (value === c * 3) {\r\n        num = c;\r\n        hits = 3;\r\n        break;\r\n      }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) {\r\n      num = 25;\r\n      hits = value === 50 ? 2 : 1;\r\n    }\r\n  }\r\n  if (!num) return 0;\r\n\r\n  const before = state.marks[num];\r\n  const toClose = Math.max(0, 3 - before);\r\n  const toApply = Math.min(toClose, hits);\r\n  const overflow = Math.max(0, hits - toApply);\r\n  const after = (before + toApply) as AmCricketMark;\r\n  state.marks[num] = after > 3 ? 3 : after;\r\n\r\n  let points = 0;\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      if (ring === \"INNER_BULL\") points += 50 * overflow;\r\n      else points += 25 * overflow;\r\n    } else {\r\n      points += (num as number) * overflow;\r\n    }\r\n  }\r\n  state.points += points;\r\n  return points;\r\n}\r\n\r\nexport function hasClosedAllAm(state: AmCricketState): boolean {\r\n  return AM_CRICKET_NUMBERS.every((n) => (state.marks[n] || 0) >= 3);\r\n}\r\n","import type { ReactNode } from \"react\";\r\n\r\n// Glassy sticky header bar used across Offline and Online match UIs for visual parity\r\nexport default function GameHeaderBar({\r\n  left,\r\n  right,\r\n  className = \"\",\r\n  sticky = true,\r\n}: {\r\n  left: ReactNode;\r\n  right?: ReactNode;\r\n  className?: string;\r\n  sticky?: boolean;\r\n}) {\r\n  return (\r\n    <div\r\n      className={`${sticky ? \"sticky top-0\" : \"\"} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${className}`}\r\n    >\r\n      <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent\" />\r\n      <div className=\"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap\">\r\n        {left}\r\n      </div>\r\n      <div className=\"flex items-center gap-1 flex-wrap justify-end\">\r\n        {right}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Universal Game Scoreboard Component\r\n * Displays game-specific stats based on the game mode and current game state\r\n * Works for Online, Offline, and Tournament modes\r\n */\r\n\r\nimport React from \"react\";\r\n\r\nexport type GameMode =\r\n  | \"X01\"\r\n  | \"Cricket\"\r\n  | \"Shanghai\"\r\n  | \"Killer\"\r\n  | \"High-Low\"\r\n  | \"Halve It\"\r\n  | \"Around the Clock\"\r\n  | \"Double Practice\"\r\n  | \"Treble Practice\"\r\n  | \"Count-Up\"\r\n  | \"High Score\"\r\n  | \"Low Score\"\r\n  | \"Checkout 170\"\r\n  | \"Checkout 121\"\r\n  | \"American Cricket\"\r\n  | \"Baseball\"\r\n  | \"Golf\"\r\n  | \"Tic Tac Toe\"\r\n  | \"Bob's 27\"\r\n  | \"Scam\"\r\n  | \"Fives\"\r\n  | \"Sevens\";\r\n\r\nexport interface PlayerStats {\r\n  name: string;\r\n  isCurrentTurn: boolean;\r\n  legsWon?: number;\r\n  score?: number;\r\n  lastScore?: number;\r\n  checkoutRate?: number; // 0-100\r\n  bestLeg?: number | string;\r\n  // Cricket-specific\r\n  closed?: Record<number, number>; // { 20: 3, 19: 2, etc }\r\n  points?: number;\r\n  // Shanghai-specific\r\n  round?: number;\r\n  target?: number;\r\n  // Killer-specific\r\n  number?: number;\r\n  lives?: number;\r\n  eliminated?: boolean;\r\n  // Match statistics\r\n  matchAvg?: number; // Current match 3-dart average\r\n  allTimeAvg?: number; // Player's all-time 3-dart average\r\n  // Other generics\r\n  [key: string]: any;\r\n}\r\n\r\ninterface GameScoreboardProps {\r\n  gameMode: GameMode;\r\n  players: PlayerStats[];\r\n  matchScore?: string; // e.g., \"3-1\"\r\n  gameRules?: any; // Additional rules/config for the game\r\n}\r\n\r\nexport default function GameScoreboard({\r\n  gameMode,\r\n  players,\r\n  matchScore,\r\n  gameRules,\r\n}: GameScoreboardProps) {\r\n  if (!players || players.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3\">\r\n      {players.map((player, idx) => (\r\n        <div\r\n          key={idx}\r\n          className={`rounded-lg border p-3 ${\r\n            player.isCurrentTurn\r\n              ? \"border-emerald-500/40 bg-emerald-500/10\"\r\n              : \"border-slate-500/40 bg-slate-500/10\"\r\n          }`}\r\n        >\r\n          <div\r\n            className={`text-sm font-semibold mb-2 uppercase tracking-wide ${\r\n              player.isCurrentTurn ? \"text-emerald-300\" : \"text-slate-300\"\r\n            }`}\r\n          >\r\n            {player.name}\r\n          </div>\r\n\r\n          <div className=\"space-y-1 text-sm\">\r\n            {/* X01 specific */}\r\n            {gameMode === \"X01\" && (\r\n              <>\r\n                <ScoreRow\r\n                  label=\"Legs Won\"\r\n                  value={`â— ${player.legsWon || 0}`}\r\n                  highlight\r\n                />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n                <ScoreRow\r\n                  label=\"Last Score\"\r\n                  value={player.lastScore || \"0\"}\r\n                  mono\r\n                />\r\n                <ScoreRow\r\n                  label=\"C/Out Rate\"\r\n                  value={`${player.checkoutRate || 0}%`}\r\n                  mono\r\n                />\r\n                <ScoreRow label=\"Best Leg\" value={player.bestLeg || \"â€”\"} mono />\r\n                {/* AVG +/- feature */}\r\n                {player.matchAvg !== undefined &&\r\n                  player.allTimeAvg !== undefined && (\r\n                    <>\r\n                      <div className=\"border-t border-white/20 pt-1 mt-1\">\r\n                        <ScoreRow\r\n                          label=\"Match Avg\"\r\n                          value={player.matchAvg.toFixed(2)}\r\n                          mono\r\n                          bold\r\n                          highlight={player.matchAvg > 0}\r\n                        />\r\n                        <AvgDifferenceRow\r\n                          matchAvg={player.matchAvg}\r\n                          allTimeAvg={player.allTimeAvg}\r\n                        />\r\n                      </div>\r\n                    </>\r\n                  )}\r\n              </>\r\n            )}\r\n\r\n            {/* Cricket & American Cricket specific */}\r\n            {(gameMode === \"Cricket\" || gameMode === \"American Cricket\") && (\r\n              <>\r\n                <ScoreRow\r\n                  label=\"Closed\"\r\n                  value={formatCricketClosed(player.closed)}\r\n                  mono\r\n                />\r\n                <ScoreRow label=\"Points\" value={player.points || 0} mono bold />\r\n                <ScoreRow\r\n                  label=\"Status\"\r\n                  value={getCricketStatus(player)}\r\n                  highlight={player.isCurrentTurn}\r\n                />\r\n              </>\r\n            )}\r\n\r\n            {/* Shanghai & Halve It - Round-based */}\r\n            {(gameMode === \"Shanghai\" || gameMode === \"Halve It\") && (\r\n              <>\r\n                <ScoreRow\r\n                  label={gameMode === \"Shanghai\" ? \"Round\" : \"Stage\"}\r\n                  value={player.round || 1}\r\n                  mono\r\n                />\r\n                <ScoreRow label=\"Target\" value={player.target || \"â€”\"} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Killer specific */}\r\n            {gameMode === \"Killer\" && (\r\n              <>\r\n                <ScoreRow\r\n                  label=\"Target #\"\r\n                  value={player.number || \"â€”\"}\r\n                  mono\r\n                  bold\r\n                />\r\n                <ScoreRow label=\"Lives\" value={player.lives || 0} mono bold />\r\n                {player.eliminated && (\r\n                  <ScoreRow\r\n                    label=\"Status\"\r\n                    value=\"ELIMINATED\"\r\n                    highlight={false}\r\n                  />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* High-Low specific */}\r\n            {gameMode === \"High-Low\" && (\r\n              <>\r\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\r\n                <ScoreRow label=\"Target\" value={player.target || \"High\"} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Practice games */}\r\n            {(gameMode === \"Double Practice\" ||\r\n              gameMode === \"Treble Practice\" ||\r\n              gameMode === \"Around the Clock\") && (\r\n              <>\r\n                <ScoreRow\r\n                  label=\"Target\"\r\n                  value={player.target || \"â€”\"}\r\n                  mono\r\n                  bold\r\n                />\r\n                <ScoreRow label=\"Hits\" value={player.hits || 0} mono bold />\r\n                {player.totalNeeded && (\r\n                  <ScoreRow\r\n                    label=\"Progress\"\r\n                    value={`${player.hits || 0} / ${player.totalNeeded}`}\r\n                    mono\r\n                  />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Count-Up, High Score, Low Score */}\r\n            {(gameMode === \"Count-Up\" ||\r\n              gameMode === \"High Score\" ||\r\n              gameMode === \"Low Score\") && (\r\n              <>\r\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n                {gameMode === \"High Score\" && (\r\n                  <ScoreRow label=\"Best\" value={player.bestScore || 0} mono />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Checkout challenges */}\r\n            {(gameMode === \"Checkout 170\" || gameMode === \"Checkout 121\") && (\r\n              <>\r\n                <ScoreRow\r\n                  label=\"Remaining\"\r\n                  value={player.remaining || 0}\r\n                  mono\r\n                  bold\r\n                />\r\n                <ScoreRow label=\"Attempts\" value={player.attempts || 0} mono />\r\n                <ScoreRow\r\n                  label=\"Successes\"\r\n                  value={player.successes || 0}\r\n                  mono\r\n                />\r\n              </>\r\n            )}\r\n\r\n            {/* Bob's 27 */}\r\n            {gameMode === \"Bob's 27\" && (\r\n              <>\r\n                <ScoreRow\r\n                  label=\"Target\"\r\n                  value={`D${player.target || 1}`}\r\n                  mono\r\n                  bold\r\n                />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Baseball & Golf */}\r\n            {gameMode === \"Baseball\" && (\r\n              <>\r\n                <ScoreRow label=\"Inning\" value={player.inning || 1} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {gameMode === \"Golf\" && (\r\n              <>\r\n                <ScoreRow label=\"Hole\" value={player.hole || 1} mono />\r\n                <ScoreRow\r\n                  label=\"Strokes\"\r\n                  value={player.strokes || 0}\r\n                  mono\r\n                  bold\r\n                />\r\n              </>\r\n            )}\r\n\r\n            {/* Tic Tac Toe */}\r\n            {gameMode === \"Tic Tac Toe\" && (\r\n              <>\r\n                <ScoreRow label=\"Turn\" value={player.turn || 1} mono />\r\n                {player.winner && (\r\n                  <ScoreRow label=\"Result\" value=\"WINNER!\" highlight />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Match score display for competitive games */}\r\n            {matchScore &&\r\n              (gameMode === \"X01\" ||\r\n                gameMode === \"Cricket\" ||\r\n                gameMode === \"American Cricket\") &&\r\n              idx === 1 && (\r\n                <div className=\"border-t border-white/10 pt-1 mt-1\">\r\n                  <ScoreRow\r\n                    label=\"Match\"\r\n                    value={matchScore}\r\n                    mono\r\n                    bold\r\n                    highlight\r\n                  />\r\n                </div>\r\n              )}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Helper component for consistent score row display\r\nfunction ScoreRow({\r\n  label,\r\n  value,\r\n  mono = false,\r\n  bold = false,\r\n  highlight = false,\r\n}: {\r\n  label: string;\r\n  value: string | number;\r\n  mono?: boolean;\r\n  bold?: boolean;\r\n  highlight?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"flex justify-between\">\r\n      <span className=\"opacity-70\">{label}:</span>\r\n      <span\r\n        className={`${mono ? \"font-mono\" : \"\"} ${bold ? \"font-semibold\" : \"\"} ${\r\n          highlight ? \"text-emerald-300\" : \"\"\r\n        }`}\r\n      >\r\n        {value}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// AVG +/- component showing difference from all-time average\r\nfunction AvgDifferenceRow({\r\n  matchAvg,\r\n  allTimeAvg,\r\n}: {\r\n  matchAvg: number;\r\n  allTimeAvg: number;\r\n}) {\r\n  const diff = matchAvg - allTimeAvg;\r\n  const isPositive = diff > 0;\r\n  const isNeutral = Math.abs(diff) < 0.01;\r\n\r\n  let diffText = \"\";\r\n  let diffColor = \"text-slate-300\";\r\n\r\n  if (isNeutral) {\r\n    diffText = \"= All-time\";\r\n    diffColor = \"text-slate-300\";\r\n  } else if (isPositive) {\r\n    diffText = `+${diff.toFixed(2)} vs avg`;\r\n    diffColor = \"text-emerald-400\";\r\n  } else {\r\n    diffText = `${diff.toFixed(2)} vs avg`;\r\n    diffColor = \"text-orange-400\";\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex justify-between\">\r\n      <span className=\"opacity-70\">AVG vs Avg:</span>\r\n      <span className={`font-mono font-semibold ${diffColor}`}>{diffText}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Cricket helpers\r\nfunction formatCricketClosed(closed?: Record<number, number>): string {\r\n  if (!closed || Object.keys(closed).length === 0) return \"â€”\";\r\n  const closedNumbers = Object.entries(closed)\r\n    .filter(([_, count]) => count === 3)\r\n    .map(([num]) => (num === \"25\" ? \"B\" : num))\r\n    .join(\",\");\r\n  return closedNumbers || \"â€”\";\r\n}\r\n\r\nfunction getCricketStatus(player: PlayerStats): string {\r\n  if (!player.closed) return \"Starting\";\r\n  const closedCount = Object.values(player.closed).filter(\r\n    (c) => c === 3,\r\n  ).length;\r\n  if (closedCount === 0) return \"No marks\";\r\n  if (closedCount < 7) return `${closedCount}/7`;\r\n  return \"Closing in\";\r\n}\r\n","// Small adapter helpers to convert generic MatchControls onAddVisit callbacks to the local handlers\r\nexport function makeOnlineAddVisitAdapter(\r\n  submitVisitManual: (v: number) => void,\r\n) {\r\n  return (score: number, darts: number) => {\r\n    submitVisitManual(score);\r\n  };\r\n}\r\n\r\nexport function makeOfflineAddVisitAdapter(\r\n  commitManualVisitTotal: (v: number) => boolean,\r\n) {\r\n  return (score: number, darts: number) => {\r\n    commitManualVisitTotal(score);\r\n  };\r\n}\r\n","import type { Actions as MatchActions } from \"../store/match\";\r\n\r\nexport type UnifiedMatchActions = {\r\n  addVisit: (score: number, darts?: number, meta?: any) => void;\r\n  undoVisit: () => void;\r\n  nextPlayer: () => void;\r\n  endLeg: (score?: number) => void;\r\n  endGame: () => void;\r\n};\r\n\r\nexport function createOnlineMatchActions(args: {\r\n  match: MatchActions;\r\n  sendState: () => void;\r\n  submitVisitManual?: (v: number) => void;\r\n}): UnifiedMatchActions {\r\n  const { match, sendState, submitVisitManual } = args;\r\n  return {\r\n    addVisit: (score: number, darts = 3, meta?: any) => {\r\n      // Prefer the manual submit helper when available as it computes double/finish meta\r\n      if (submitVisitManual) {\r\n        submitVisitManual(score);\r\n        return;\r\n      }\r\n      try {\r\n        match.addVisit(score, darts, meta);\r\n      } catch {\r\n        match.addVisit(score, darts);\r\n      }\r\n      try {\r\n        sendState();\r\n      } catch {}\r\n    },\r\n    undoVisit: () => {\r\n      match.undoVisit();\r\n      try {\r\n        sendState();\r\n      } catch {}\r\n    },\r\n    nextPlayer: () => {\r\n      match.nextPlayer();\r\n      try {\r\n        sendState();\r\n      } catch {}\r\n    },\r\n    endLeg: (score?: number) => {\r\n      if (typeof score === \"number\") match.endLeg(score);\r\n      else match.endLeg(0);\r\n      try {\r\n        sendState();\r\n      } catch {}\r\n    },\r\n    endGame: () => {\r\n      match.endGame();\r\n      try {\r\n        sendState();\r\n      } catch {}\r\n    },\r\n  };\r\n}\r\n\r\nexport function createOfflineMatchActions(args: {\r\n  match: MatchActions;\r\n  commitManualVisitTotal?: (v: number) => boolean;\r\n  endTurn?: (nextRemaining: number) => void;\r\n}): UnifiedMatchActions {\r\n  const { match, commitManualVisitTotal, endTurn } = args;\r\n  return {\r\n    addVisit: (score: number, darts = 3, meta?: any) => {\r\n      if (commitManualVisitTotal) {\r\n        commitManualVisitTotal(score);\r\n        return;\r\n      }\r\n      try {\r\n        match.addVisit(score, darts, meta);\r\n      } catch {\r\n        match.addVisit(score, darts);\r\n      }\r\n    },\r\n    undoVisit: () => {\r\n      match.undoVisit();\r\n    },\r\n    nextPlayer: () => {\r\n      if (endTurn) {\r\n        try {\r\n          endTurn(0);\r\n        } catch {\r\n          match.nextPlayer();\r\n        }\r\n      } else {\r\n        match.nextPlayer();\r\n      }\r\n    },\r\n    endLeg: (score?: number) => {\r\n      if (typeof score === \"number\") match.endLeg(score);\r\n      else match.endLeg(0);\r\n    },\r\n    endGame: () => {\r\n      match.endGame();\r\n    },\r\n  };\r\n}\r\n","/**\r\n * Hook to convert OfflinePlay game state to GameScoreboard format\r\n */\r\n\r\nimport { useMemo } from \"react\";\r\nimport type { PlayerStats } from \"./GameScoreboard\";\r\nimport type { GameMode } from \"./GameScoreboard\";\r\nimport { getAllTimeAvg } from \"../../store/profileStats\";\r\n\r\nexport function useOfflineGameStats(\r\n  gameMode: GameMode,\r\n  // X01 state\r\n  playerScore?: number,\r\n  aiScore?: number,\r\n  playerLegs?: number,\r\n  aiLegs?: number,\r\n  playerLastDart?: number,\r\n  aiLastDart?: number,\r\n  playerVisitSum?: number,\r\n  aiVisitSum?: number,\r\n  playerLastVisitScore?: number | null,\r\n  aiLastVisitScore?: number | null,\r\n  playerVisitDartCount?: number,\r\n  aiVisitDartCount?: number,\r\n  playerDoublesHit?: number,\r\n  playerDoublesAtt?: number,\r\n  aiDoublesHit?: number,\r\n  aiDoublesAtt?: number,\r\n  legStats?: Array<any>,\r\n  isPlayerTurn?: boolean,\r\n  ai?: string,\r\n  x01Score?: number,\r\n  // Cricket state\r\n  cricket?: any,\r\n  // Shanghai state\r\n  shanghai?: any,\r\n  // Killer state\r\n  killerPlayers?: Array<any>,\r\n  killerStates?: Record<string, any>,\r\n  killerAssigned?: Record<string, number>,\r\n  killerTurnIdx?: number,\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (gameMode === \"X01\") {\r\n      // Calculate player match average\r\n      let playerMatchAvg = 0;\r\n      let playerDarts = 0;\r\n      let playerScored = 0;\r\n      if (legStats && legStats.length > 0) {\r\n        for (const leg of legStats) {\r\n          if (leg.dartsThrown && leg.totalScored) {\r\n            playerDarts += leg.dartsThrown;\r\n            playerScored += leg.totalScored;\r\n          }\r\n        }\r\n        if (playerDarts > 0) {\r\n          playerMatchAvg = (playerScored / playerDarts) * 3;\r\n        }\r\n      }\r\n\r\n      // Player card\r\n      const playerVisitDarts = playerVisitDartCount ?? 0;\r\n      const playerCurrentVisitActive = playerVisitDarts > 0;\r\n      const playerCurrentVisitSum = playerVisitSum ?? 0;\r\n      const playerLastVisitTotal = playerLastVisitScore ?? null;\r\n      const playerLastDartValue = playerLastDart ?? 0;\r\n      const resolvedPlayerLastScore = playerCurrentVisitActive\r\n        ? playerCurrentVisitSum\r\n        : (playerLastVisitTotal ?? playerLastDartValue);\r\n\r\n      players.push({\r\n        name: \"You\",\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        legsWon: playerLegs || 0,\r\n        score: playerScore || 0,\r\n        lastScore: resolvedPlayerLastScore,\r\n        checkoutRate:\r\n          playerDoublesAtt && playerDoublesAtt > 0\r\n            ? Math.round(((playerDoublesHit || 0) / playerDoublesAtt) * 100)\r\n            : 0,\r\n        bestLeg:\r\n          legStats && legStats.length > 0\r\n            ? `${Math.min(...legStats.map((l) => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\r\n            : \"â€”\",\r\n        matchAvg: playerMatchAvg,\r\n        allTimeAvg: getAllTimeAvg(\"You\") || 0,\r\n      });\r\n\r\n      // AI card (if playing against AI)\r\n      if (ai && ai !== \"None\") {\r\n        const aiVisitDarts = aiVisitDartCount ?? 0;\r\n        const aiCurrentVisitActive = aiVisitDarts > 0;\r\n        const aiCurrentVisitSum = aiVisitSum ?? 0;\r\n        const aiLastVisitTotal = aiLastVisitScore ?? null;\r\n        const aiLastDartValue = aiLastDart ?? 0;\r\n        const resolvedAiLastScore = aiCurrentVisitActive\r\n          ? aiCurrentVisitSum\r\n          : (aiLastVisitTotal ?? aiLastDartValue);\r\n\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          legsWon: aiLegs || 0,\r\n          score: aiScore || 0,\r\n          lastScore: resolvedAiLastScore,\r\n          checkoutRate:\r\n            aiDoublesAtt && aiDoublesAtt > 0\r\n              ? Math.round(((aiDoublesHit || 0) / aiDoublesAtt) * 100)\r\n              : 0,\r\n          bestLeg: \"â€”\",\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === \"Cricket\") {\r\n      players.push({\r\n        name: \"You\",\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        closed: cricket?.marks || {},\r\n        points: cricket?.points || 0,\r\n      });\r\n\r\n      if (ai && ai !== \"None\") {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          closed: {},\r\n          points: 0,\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === \"Shanghai\") {\r\n      players.push({\r\n        name: \"You\",\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        round: shanghai?.round || 1,\r\n        target: shanghai?.target || 1,\r\n        score: shanghai?.score || 0,\r\n      });\r\n\r\n      if (ai && ai !== \"None\") {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          round: shanghai?.round || 1,\r\n          target: shanghai?.target || 1,\r\n          score: 0,\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === \"Killer\" && killerPlayers && killerPlayers.length > 0) {\r\n      killerPlayers.forEach((p, idx) => {\r\n        const state = killerStates?.[p.id];\r\n        players.push({\r\n          name: p.name,\r\n          isCurrentTurn: idx === killerTurnIdx,\r\n          number: killerAssigned?.[p.id],\r\n          lives: state?.lives || 0,\r\n          eliminated: state?.eliminated || false,\r\n        });\r\n      });\r\n    }\r\n\r\n    return players;\r\n  }, [\r\n    gameMode,\r\n    playerScore,\r\n    aiScore,\r\n    playerLegs,\r\n    aiLegs,\r\n    playerLastDart,\r\n    aiLastDart,\r\n    playerVisitSum,\r\n    aiVisitSum,\r\n    playerLastVisitScore,\r\n    aiLastVisitScore,\r\n    playerVisitDartCount,\r\n    aiVisitDartCount,\r\n    playerDoublesHit,\r\n    playerDoublesAtt,\r\n    aiDoublesHit,\r\n    aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn,\r\n    ai,\r\n    cricket,\r\n    shanghai,\r\n    killerPlayers,\r\n    killerStates,\r\n    killerAssigned,\r\n    killerTurnIdx,\r\n  ]);\r\n}\r\n\r\nexport function useOnlineGameStats(\r\n  gameMode: GameMode,\r\n  matchState?: any, // From useMatch() store\r\n  participants?: string[],\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (!matchState || !matchState.players || matchState.players.length === 0) {\r\n      return players;\r\n    }\r\n\r\n    matchState.players.forEach((player: any, idx: number) => {\r\n      const isCurrentTurn = idx === matchState.currentPlayerIdx;\r\n\r\n      if (gameMode === \"X01\") {\r\n        // Calculate match average for this player\r\n        let matchAvg = 0;\r\n        let totalDarts = 0;\r\n        let totalScored = 0;\r\n\r\n        if (player.legs && player.legs.length > 0) {\r\n          for (const leg of player.legs) {\r\n            if (leg.finished) {\r\n              const legDarts = leg.dartsThrown || 0;\r\n              const legScored =\r\n                Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining) || 0;\r\n              totalDarts += legDarts;\r\n              totalScored += legScored;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (totalDarts > 0) {\r\n          matchAvg = (totalScored / totalDarts) * 3;\r\n        }\r\n\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          legsWon: player.legsWon || 0,\r\n          score: player.score || 0,\r\n          lastScore: player.lastVisitScore || 0,\r\n          checkoutRate:\r\n            player.doublesAttempted > 0\r\n              ? Math.round((player.doublesHit / player.doublesAttempted) * 100)\r\n              : 0,\r\n          bestLeg: player.bestLegDarts ? `${player.bestLegDarts} darts` : \"â€”\",\r\n          matchAvg: matchAvg,\r\n          allTimeAvg: player.name ? getAllTimeAvg(player.name) : 0,\r\n        });\r\n      }\r\n\r\n      if (gameMode === \"Cricket\") {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          closed: player.cricket?.marks || {},\r\n          points: player.cricket?.points || 0,\r\n        });\r\n      }\r\n\r\n      if (gameMode === \"Killer\") {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          number: player.killerNumber || null,\r\n          lives: player.killerLives || 3,\r\n          eliminated: player.killerEliminated || false,\r\n        });\r\n      }\r\n    });\r\n\r\n    return players;\r\n  }, [gameMode, matchState, participants]);\r\n}\r\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { suggestCheckouts, sayScore } from \"../utils/checkout\";\r\nimport { useUserSettings } from \"../store/userSettings\";\r\nimport { useToast } from \"../store/toast\";\r\nimport { useCalibration } from \"../store/calibration\";\r\nimport GameCalibrationStatus from \"./GameCalibrationStatus\";\r\nimport CameraTile from \"./CameraTile\";\r\nimport CameraView from \"./CameraView\";\r\nimport HeatMap from \"./HeatMap\";\r\nimport { getUserCurrency, formatPriceInCurrency } from \"../utils/config\";\r\nimport { bumpGameMode } from \"../store/profileStats\";\r\nimport {\r\n  DOUBLE_PRACTICE_ORDER,\r\n  isDoubleHit,\r\n  parseManualDart,\r\n} from \"../game/types\";\r\nimport { ATC_ORDER } from \"../game/aroundTheClock\";\r\nimport {\r\n  createCricketState,\r\n  applyCricketDart,\r\n  CRICKET_NUMBERS,\r\n  hasClosedAll as cricketClosedAll,\r\n} from \"../game/cricket\";\r\nimport {\r\n  createShanghaiState,\r\n  applyShanghaiDart,\r\n  endShanghaiTurn,\r\n} from \"../game/shanghai\";\r\nimport {\r\n  createDefaultHalveIt,\r\n  getCurrentHalveTarget,\r\n  applyHalveItDart,\r\n  endHalveItTurn,\r\n} from \"../game/halveIt\";\r\nimport {\r\n  createHighLow,\r\n  applyHighLowDart,\r\n  endHighLowTurn,\r\n} from \"../game/highLow\";\r\nimport {\r\n  createKillerState,\r\n  assignKillerNumbers,\r\n  applyKillerDart,\r\n  killerWinner,\r\n  KillerState,\r\n} from \"../game/killer\";\r\nimport { createBaseball, applyBaseballDart } from \"../game/baseball\";\r\nimport { createGolf, applyGolfDart } from \"../game/golf\";\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from \"../game/ticTacToe\";\r\nimport {\r\n  createScamState,\r\n  addScamAuto,\r\n  addScamNumeric,\r\n  resetScam,\r\n  getScamTarget,\r\n  SCAM_TARGET_NAMES,\r\n  ScamState,\r\n  createFivesState,\r\n  addFivesAuto,\r\n  addFivesNumeric,\r\n  resetFives,\r\n  FivesState,\r\n  createSevensState,\r\n  addSevensAuto,\r\n  addSevensNumeric,\r\n  resetSevens,\r\n  SevensState,\r\n} from \"../game/scamFivesSevens\";\r\nimport {\r\n  createAmCricketState,\r\n  applyAmCricketDart,\r\n  AM_CRICKET_NUMBERS,\r\n  hasClosedAllAm,\r\n} from \"../game/americanCricket\";\r\nimport ResizableModal from \"./ui/ResizableModal\";\r\nimport MatchStartShowcase from \"./ui/MatchStartShowcase\";\r\nimport { useAudit } from \"../store/audit\";\r\nimport ResizablePanel from \"./ui/ResizablePanel\";\r\nimport GameHeaderBar from \"./ui/GameHeaderBar\";\r\nimport GameScoreboard, { type PlayerStats } from \"./scoreboards/GameScoreboard\";\r\nimport MatchControls from \"./MatchControls\";\r\nimport { makeOfflineAddVisitAdapter } from \"./matchControlAdapters\";\r\nimport {\r\n  createOfflineMatchActions,\r\n  UnifiedMatchActions,\r\n} from \"../logic/matchActions\";\r\nimport { useMatch } from \"../store/match\";\r\nimport { useOfflineGameStats } from \"./scoreboards/useGameStats\";\r\nimport { freeGames, premiumGames, allGames } from \"../utils/games\";\r\n\r\nconst aiLevels = [\"Easy\", \"Medium\", \"Hardened\"];\r\n\r\nfunction clamp(n: number, min: number, max: number) {\r\n  return Math.max(min, Math.min(max, n));\r\n}\r\n\r\ntype PendingAutoVisit = {\r\n  visitTotal: number;\r\n  darts: number;\r\n  preRemaining: number;\r\n  remaining: number;\r\n  doubleAttempts: number;\r\n  finished: boolean;\r\n  doubleWindow: boolean;\r\n  highestCheckout?: number | null;\r\n  announced?: boolean;\r\n};\r\n\r\nconst BOARD_CLEAR_GRACE_MS = 6500;\r\n\r\nfunction aiVisitScore(remaining: number, level: string): number {\r\n  let target = 0;\r\n  if (level === \"Easy\") {\r\n    const candidates = [22, 26, 41, 45, 60];\r\n    target = candidates[Math.floor(Math.random() * candidates.length)];\r\n  } else if (level === \"Medium\") {\r\n    target = Math.round(clamp(60 + (Math.random() * 30 - 15), 30, 100));\r\n  } else {\r\n    target = Math.round(clamp(80 + (Math.random() * 20 - 10), 50, 120));\r\n  }\r\n  if (remaining <= 0) return 0;\r\n  if (target > remaining) {\r\n    const safe = [100, 85, 81, 60, 57, 45, 41, 26, 22, 20, 1].find(\r\n      (v) => v <= remaining,\r\n    );\r\n    return safe ?? 0;\r\n  }\r\n  return target;\r\n}\r\n\r\nfunction X01RulesPopup({ onClose }: { onClose: () => void }) {\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n      <div className=\"card max-w-lg w-full relative\">\r\n        <button\r\n          className=\"absolute top-2 right-2 btn px-2 py-1\"\r\n          onClick={onClose}\r\n        >\r\n          Close\r\n        </button>\r\n        <h3 className=\"text-xl font-bold mb-2\">X01 Rules & Regulations</h3>\r\n        <ul className=\"list-disc pl-5 text-left mb-2\">\r\n          <li>Double In: Start scoring only after hitting a double.</li>\r\n          <li>\r\n            Double Out: Finish the game by hitting a double to reach exactly\r\n            zero.\r\n          </li>\r\n          <li>\r\n            Best Of: Play a set number of legs, winner is first to reach\r\n            majority.\r\n          </li>\r\n          <li>First To: Play until a player reaches a set number of legs.</li>\r\n          <li>\r\n            No Cheating: All scores must be valid, no manual score changes\r\n            mid-leg.\r\n          </li>\r\n          <li>\r\n            Competitive Standard: Follow latest WDF/PDC rules for match play.\r\n          </li>\r\n        </ul>\r\n        <p className=\"text-sm text-slate-600\">\r\n          For full details, see official darts governing body rules.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst API_URL = (import.meta as any).env?.VITE_API_URL || \"\";\r\n\r\nexport default function OfflinePlay({ user }: { user: any }) {\r\n  const {\r\n    offlineLayout,\r\n    favoriteDouble,\r\n    callerEnabled,\r\n    callerVoice,\r\n    callerVolume,\r\n    speakCheckoutOnly,\r\n    rememberLastOffline,\r\n    setLastOffline,\r\n    autoStartOffline,\r\n    cameraScale,\r\n    setCameraScale,\r\n    cameraAspect = \"wide\",\r\n    setCameraAspect,\r\n    cameraFitMode = \"fill\",\r\n    setCameraFitMode,\r\n    cameraEnabled,\r\n    textSize,\r\n    boxSize,\r\n    autoscoreProvider,\r\n    autoCommitMode = \"wait-for-clear\",\r\n    matchType = \"singles\",\r\n    setMatchType,\r\n    teamAName = \"Team A\",\r\n    setTeamAName,\r\n    teamBName = \"Team B\",\r\n    setTeamBName,\r\n  } = useUserSettings();\r\n  const manualScoring = autoscoreProvider === \"manual\";\r\n  const cameraToolbarVisible = cameraEnabled && !manualScoring;\r\n  const waitForBoardClear =\r\n    cameraEnabled && !manualScoring && autoCommitMode !== \"immediate\";\r\n  const [selectedMode, setSelectedMode] = useState<string>(\"X01\");\r\n  const [x01Score, setX01Score] = useState(501);\r\n  const [ai, setAI] = useState(\"None\");\r\n  const [showRules, setShowRules] = useState(false);\r\n  const [inMatch, setInMatch] = useState(false);\r\n  const [playerScore, setPlayerScore] = useState(x01Score);\r\n  const [aiScore, setAiScore] = useState(x01Score);\r\n  const [onDouble, setOnDouble] = useState(false);\r\n  const [showWinPopup, setShowWinPopup] = useState(false);\r\n  // Match format: First-to selector and leg counters\r\n  const [firstTo, setFirstTo] = useState<number>(1);\r\n  const [playerLegs, setPlayerLegs] = useState<number>(0);\r\n  const match = useMatch();\r\n  const [showStartShowcase, setShowStartShowcase] = useState(false);\r\n  const startedShowcasedRef = useRef(false);\r\n  const [aiLegs, setAiLegs] = useState<number>(0);\r\n  // Placeholder for unified offline actions; once commitManualVisitTotal/endTurn defined, we'll assign\r\n\r\n  const [pendingLegWinner, setPendingLegWinner] = useState<\r\n    \"player\" | \"ai\" | null\r\n  >(null);\r\n  const [doubleDarts, setDoubleDarts] = useState(1);\r\n  const [checkoutDarts, setCheckoutDarts] = useState(1);\r\n  const [legStats, setLegStats] = useState<\r\n    {\r\n      winner: \"player\" | \"ai\";\r\n      doubleDarts: number;\r\n      checkoutDarts: number;\r\n      winnerDarts: number;\r\n      doublesAtt?: number;\r\n      doublesHit?: number;\r\n    }[]\r\n  >([]);\r\n  // New: pre-game adjustable AI delay (ms)\r\n  const [aiDelayMs, setAiDelayMs] = useState<number>(2000);\r\n  const toast = useToast();\r\n  // New: match popup state\r\n  const [showMatchModal, setShowMatchModal] = useState(false);\r\n  // Mirror Online layout defaults when in modern layout, otherwise keep classic feel\r\n  const [maximized, setMaximized] = useState(offlineLayout === \"modern\");\r\n  const [fitAll, setFitAll] = useState(offlineLayout === \"modern\");\r\n  // React to layout changes at runtime\r\n  useEffect(() => {\r\n    setMaximized(offlineLayout === \"modern\");\r\n    setFitAll(offlineLayout === \"modern\");\r\n  }, [offlineLayout]);\r\n  useEffect(() => {\r\n    if (cameraFitMode !== \"fit\") {\r\n      setCameraFitMode(\"fit\");\r\n    }\r\n  }, [cameraFitMode, setCameraFitMode]);\r\n  const [fitScale, setFitScale] = useState(1);\r\n  const [fitOverflowing, setFitOverflowing] = useState(false);\r\n  const [isPlayerTurn, setIsPlayerTurn] = useState(true);\r\n  useEffect(() => {\r\n    const handleOpenManager = () => setShowCameraManager(true);\r\n    window.addEventListener(\"ndn:open-camera-manager\", handleOpenManager);\r\n    return () =>\r\n      window.removeEventListener(\"ndn:open-camera-manager\", handleOpenManager);\r\n  }, []);\r\n  // Per-dart input and stats\r\n  const [playerDartPoints, setPlayerDartPoints] = useState<number>(0);\r\n  const [dpIndex, setDpIndex] = useState<number>(0); // 0..20 (DBULL at 20)\r\n  const [dpHits, setDpHits] = useState<number>(0);\r\n  // Around the Clock (offline practice)\r\n  const [atcIndex, setAtcIndex] = useState<number>(0);\r\n  const [atcHits, setAtcHits] = useState<number>(0);\r\n  // Practice mode states\r\n  const [cricket, setCricket] = useState(createCricketState());\r\n  const [shanghai, setShanghai] = useState(createShanghaiState());\r\n  const [halve, setHalve] = useState(createDefaultHalveIt());\r\n  const [highlow, setHighlow] = useState(createHighLow());\r\n  const [practiceTurnDarts, setPracticeTurnDarts] = useState<number>(0);\r\n  // Phase 1 practice modes\r\n  const [b27Stage, setB27Stage] = useState<number>(1);\r\n  const [b27Score, setB27Score] = useState<number>(27);\r\n  const [b27Darts, setB27Darts] = useState<number>(0);\r\n  const [b27Hits, setB27Hits] = useState<number>(0);\r\n  const [b27Finished, setB27Finished] = useState<boolean>(false);\r\n  const [cuRound, setCuRound] = useState<number>(1);\r\n  const [cuScore, setCuScore] = useState<number>(0);\r\n  const [cuDarts, setCuDarts] = useState<number>(0);\r\n  const cuMaxRounds = 8;\r\n  const [hsRound, setHsRound] = useState<number>(1);\r\n  const [hsScore, setHsScore] = useState<number>(0);\r\n  const [hsDarts, setHsDarts] = useState<number>(0);\r\n  const hsMaxRounds = 10;\r\n  const [lsRound, setLsRound] = useState<number>(1);\r\n  const [lsScore, setLsScore] = useState<number>(0);\r\n  const [lsDarts, setLsDarts] = useState<number>(0);\r\n  const lsMaxRounds = 10;\r\n  const [co170Rem, setCo170Rem] = useState<number>(170);\r\n  const [co170Darts, setCo170Darts] = useState<number>(0);\r\n  const [co170Attempts, setCo170Attempts] = useState<number>(0);\r\n  const [co170Successes, setCo170Successes] = useState<number>(0);\r\n  const [co121Rem, setCo121Rem] = useState<number>(121);\r\n  const [co121Darts, setCo121Darts] = useState<number>(0);\r\n  const [co121Attempts, setCo121Attempts] = useState<number>(0);\r\n  const [co121Successes, setCo121Successes] = useState<number>(0);\r\n  const [trebleTarget, setTrebleTarget] = useState<number>(20);\r\n  const [trebleHits, setTrebleHits] = useState<number>(0);\r\n  const [trebleDarts, setTrebleDarts] = useState<number>(0);\r\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30);\r\n  const [trebleFinished, setTrebleFinished] = useState<boolean>(false);\r\n  // Phase 2 states\r\n  const [baseball, setBaseball] = useState(createBaseball());\r\n  const [golf, setGolf] = useState(createGolf());\r\n  const [ttt, setTTT] = useState(createTicTacToe());\r\n  const [amCricket, setAmCricket] = useState(createAmCricketState());\r\n  // Killer (hotseat) state\r\n  const [killerPlayers, setKillerPlayers] = useState<\r\n    Array<{ id: string; name: string }>\r\n  >([\r\n    { id: \"p1\", name: \"Player 1\" },\r\n    { id: \"p2\", name: \"Player 2\" },\r\n  ]);\r\n  const [killerStates, setKillerStates] = useState<Record<string, KillerState>>(\r\n    {},\r\n  );\r\n  const [killerAssigned, setKillerAssigned] = useState<Record<string, number>>(\r\n    {},\r\n  );\r\n  const [killerSetupDone, setKillerSetupDone] = useState<boolean>(false);\r\n  const [killerTurnIdx, setKillerTurnIdx] = useState<number>(0);\r\n  const [killerDarts, setKillerDarts] = useState<number>(0);\r\n  const [killerWinnerId, setKillerWinnerId] = useState<string | null>(null);\r\n  const [killerLastEvent, setKillerLastEvent] = useState<string>(\"\");\r\n  // Scam/Scum state\r\n  const [scam, setScam] = useState(createScamState());\r\n  const [scamPlayer, setScamPlayer] = useState(createScamState());\r\n  // Fives state\r\n  const [fives, setFives] = useState(createFivesState(50));\r\n  const [fivesPlayer, setFivesPlayer] = useState(createFivesState(50));\r\n  // Sevens state\r\n  const [sevens, setSevens] = useState(createSevensState(70));\r\n  const [sevensPlayer, setSevensPlayer] = useState(createSevensState(70));\r\n  const [playerDartsThrown, setPlayerDartsThrown] = useState<number>(0);\r\n  const [playerLastDart, setPlayerLastDart] = useState<number>(0);\r\n  const [playerVisitDarts, setPlayerVisitDarts] = useState<number>(0);\r\n  const [playerVisitStart, setPlayerVisitStart] = useState<number>(x01Score);\r\n  const [playerVisitSum, setPlayerVisitSum] = useState<number>(0);\r\n  const [playerLastVisitScore, setPlayerLastVisitScore] = useState<\r\n    number | null\r\n  >(null);\r\n  const [playerVisitDartsAtDouble, setPlayerVisitDartsAtDouble] =\r\n    useState<number>(0);\r\n  const lastBounceMissTsRef = useRef<number>(0);\r\n  const lastVisitDartsRef = useRef<number>(0);\r\n  const playerScoreRef = useRef<number>(playerScore);\r\n  const playerVisitDartsRef = useRef<number>(playerVisitDarts);\r\n  const playerVisitSumRef = useRef<number>(playerVisitSum);\r\n  const playerVisitStartRef = useRef<number>(playerVisitStart);\r\n  const playerVisitDartsAtDoubleRef = useRef<number>(playerVisitDartsAtDouble);\r\n\r\n  useEffect(() => {\r\n    playerScoreRef.current = playerScore;\r\n  }, [playerScore]);\r\n  useEffect(() => {\r\n    playerVisitDartsRef.current = playerVisitDarts;\r\n  }, [playerVisitDarts]);\r\n  useEffect(() => {\r\n    playerVisitSumRef.current = playerVisitSum;\r\n  }, [playerVisitSum]);\r\n  useEffect(() => {\r\n    playerVisitStartRef.current = playerVisitStart;\r\n  }, [playerVisitStart]);\r\n  useEffect(() => {\r\n    playerVisitDartsAtDoubleRef.current = playerVisitDartsAtDouble;\r\n  }, [playerVisitDartsAtDouble]);\r\n  const [aiCountdownMs, setAiCountdownMs] = useState<number>(0);\r\n  const aiTimerRef = useRef<number | null>(null);\r\n  const [aiDartsThrown, setAiDartsThrown] = useState<number>(0);\r\n  const [aiLastDart, setAiLastDart] = useState<number>(0);\r\n  const [aiVisitSum, setAiVisitSum] = useState<number>(0);\r\n  const [aiVisitDarts, setAiVisitDarts] = useState<number>(0);\r\n  const [aiLastVisitScore, setAiLastVisitScore] = useState<number | null>(null);\r\n  const [aiVisitDartsAtDouble, setAiVisitDartsAtDouble] = useState<number>(0);\r\n  // Doubles attempts/hits\r\n  const [playerDoublesAtt, setPlayerDoublesAtt] = useState<number>(0);\r\n  const [playerDoublesHit, setPlayerDoublesHit] = useState<number>(0);\r\n  const [aiDoublesAtt, setAiDoublesAtt] = useState<number>(0);\r\n  const [aiDoublesHit, setAiDoublesHit] = useState<number>(0);\r\n  // Match-long totals for averages\r\n  const [totalPlayerDarts, setTotalPlayerDarts] = useState<number>(0);\r\n  const [totalAiDarts, setTotalAiDarts] = useState<number>(0);\r\n  const [totalPlayerPoints, setTotalPlayerPoints] = useState<number>(0);\r\n  const [totalAiPoints, setTotalAiPoints] = useState<number>(0);\r\n  // Power scoring and checkout highs\r\n  const [player180s, setPlayer180s] = useState<number>(0);\r\n  const [player140s, setPlayer140s] = useState<number>(0);\r\n  const [player100s, setPlayer100s] = useState<number>(0);\r\n  const [ai180s, setAi180s] = useState<number>(0);\r\n  const [ai140s, setAi140s] = useState<number>(0);\r\n  const [ai100s, setAi100s] = useState<number>(0);\r\n  const [playerHighestCheckout, setPlayerHighestCheckout] = useState<number>(0);\r\n  const [aiHighestCheckout, setAiHighestCheckout] = useState<number>(0);\r\n  // End-of-match summary modal\r\n  const [showMatchSummary, setShowMatchSummary] = useState<boolean>(false);\r\n  // Manual correction input for offline (matches CameraView UX)\r\n  const [manualBox, setManualBox] = useState<string>(\"\");\r\n  const [manualTextarea, setManualTextarea] = useState<string>(\"\");\r\n  const [manualPlayerScoreInput, setManualPlayerScoreInput] =\r\n    useState<string>(\"\");\r\n  const [manualOpponentScoreInput, setManualOpponentScoreInput] =\r\n    useState<string>(\"\");\r\n  const [manualPlayerLegsInput, setManualPlayerLegsInput] =\r\n    useState<string>(\"\");\r\n  const [manualOpponentLegsInput, setManualOpponentLegsInput] =\r\n    useState<string>(\"\");\r\n  const [legOverrideConfirm, setLegOverrideConfirm] = useState<{\r\n    target: \"player\" | \"ai\";\r\n    value: number;\r\n    stage: 1 | 2;\r\n  } | null>(null);\r\n  const [showCameraManager, setShowCameraManager] = useState<boolean>(false);\r\n  const [dartCounts, setDartCounts] = useState<Record<string, number>>({});\r\n  const [awaitingBoardClear, setAwaitingBoardClear] = useState<boolean>(false);\r\n  const pendingVisitRef = useRef<PendingAutoVisit | null>(null);\r\n  const pendingVisitTimerRef = useRef<ReturnType<typeof setTimeout> | null>(\r\n    null,\r\n  );\r\n\r\n  const clearPendingVisitTimer = useCallback(() => {\r\n    const timer = pendingVisitTimerRef.current;\r\n    if (timer) {\r\n      clearTimeout(timer);\r\n      pendingVisitTimerRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const speakAutoVisit = useCallback(\r\n    (pending: PendingAutoVisit) => {\r\n      if (!callerEnabled) return;\r\n      const speaker = user?.username || \"Player\";\r\n      try {\r\n        sayScore(\r\n          speaker,\r\n          pending.visitTotal,\r\n          Math.max(pending.remaining, 0),\r\n          callerVoice,\r\n          { volume: callerVolume, checkoutOnly: speakCheckoutOnly },\r\n        );\r\n      } catch {}\r\n    },\r\n    [\r\n      callerEnabled,\r\n      callerVoice,\r\n      callerVolume,\r\n      speakCheckoutOnly,\r\n      user?.username,\r\n    ],\r\n  );\r\n\r\n  const commitPendingVisit = useCallback(\r\n    (\r\n      pending: PendingAutoVisit,\r\n      _trigger: \"immediate\" | \"event\" | \"timeout\",\r\n    ) => {\r\n      setAwaitingBoardClear(false);\r\n      const {\r\n        visitTotal,\r\n        darts,\r\n        preRemaining,\r\n        remaining,\r\n        doubleAttempts,\r\n        finished,\r\n        doubleWindow,\r\n        highestCheckout,\r\n      } = pending;\r\n\r\n      if (!finished) {\r\n        setPlayerScore(remaining);\r\n        playerScoreRef.current = remaining;\r\n      } else {\r\n        setPlayerScore(0);\r\n        playerScoreRef.current = 0;\r\n        if (typeof highestCheckout === \"number\" && highestCheckout > 0) {\r\n          setPlayerHighestCheckout((h) => Math.max(h, highestCheckout));\r\n        }\r\n      }\r\n\r\n      setPlayerLastVisitScore(visitTotal);\r\n\r\n      if (visitTotal === 180) setPlayer180s((n) => n + 1);\r\n      else if (visitTotal >= 140) setPlayer140s((n) => n + 1);\r\n      else if (visitTotal >= 100) setPlayer100s((n) => n + 1);\r\n\r\n      if (doubleWindow && doubleAttempts > 0) {\r\n        setPlayerDoublesAtt((a) => a + doubleAttempts);\r\n        if (finished) setPlayerDoublesHit((h) => h + 1);\r\n      }\r\n\r\n      if (!pending.announced) speakAutoVisit(pending);\r\n\r\n      try {\r\n        useAudit.getState().recordVisit(\"offline-x01\", darts, visitTotal, {\r\n          preRemaining,\r\n          postRemaining: finished ? 0 : remaining,\r\n          finish: finished,\r\n          bust: false,\r\n        });\r\n      } catch {}\r\n\r\n      if (finished) {\r\n        setPendingLegWinner(\"player\");\r\n        setShowWinPopup(true);\r\n      }\r\n\r\n      endTurn(finished ? 0 : remaining);\r\n\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n    },\r\n    [\r\n      endTurn,\r\n      setPlayerHighestCheckout,\r\n      setPendingLegWinner,\r\n      setPlayerScore,\r\n      setPlayerLastVisitScore,\r\n      setPlayerVisitSum,\r\n      setPlayerVisitDarts,\r\n      setPlayerVisitDartsAtDouble,\r\n      setShowWinPopup,\r\n      setPlayer180s,\r\n      setPlayer140s,\r\n      setPlayer100s,\r\n      setPlayerDoublesAtt,\r\n      setPlayerDoublesHit,\r\n      speakAutoVisit,\r\n    ],\r\n  );\r\n\r\n  const finalizePendingVisit = useCallback(\r\n    (trigger: \"event\" | \"timeout\") => {\r\n      const pending = pendingVisitRef.current;\r\n      if (!pending) return;\r\n      pendingVisitRef.current = null;\r\n      clearPendingVisitTimer();\r\n      commitPendingVisit(pending, trigger);\r\n    },\r\n    [clearPendingVisitTimer, commitPendingVisit],\r\n  );\r\n\r\n  const queuePendingVisit = useCallback(\r\n    (pending: PendingAutoVisit) => {\r\n      speakAutoVisit(pending);\r\n      pendingVisitRef.current = { ...pending, announced: true };\r\n      setAwaitingBoardClear(true);\r\n      clearPendingVisitTimer();\r\n      pendingVisitTimerRef.current = setTimeout(\r\n        () => finalizePendingVisit(\"timeout\"),\r\n        BOARD_CLEAR_GRACE_MS,\r\n      );\r\n    },\r\n    [clearPendingVisitTimer, finalizePendingVisit, speakAutoVisit],\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!waitForBoardClear) return;\r\n    const handler = () => finalizePendingVisit(\"event\");\r\n    window.addEventListener(\"ndn:darts-cleared\", handler as EventListener);\r\n    return () =>\r\n      window.removeEventListener(\"ndn:darts-cleared\", handler as EventListener);\r\n  }, [waitForBoardClear, finalizePendingVisit]);\r\n\r\n  useEffect(() => {\r\n    if (!waitForBoardClear) finalizePendingVisit(\"timeout\");\r\n  }, [waitForBoardClear, finalizePendingVisit]);\r\n\r\n  useEffect(() => () => clearPendingVisitTimer(), [clearPendingVisitTimer]);\r\n\r\n  useEffect(() => {\r\n    if (playerVisitDarts === 0) {\r\n      try {\r\n        window.dispatchEvent(\r\n          new CustomEvent(\"ndn:darts-cleared\", {\r\n            detail: { source: \"offline-play\", ts: Date.now() },\r\n          }),\r\n        );\r\n      } catch {}\r\n      lastBounceMissTsRef.current = 0;\r\n    }\r\n    lastVisitDartsRef.current = playerVisitDarts;\r\n  }, [playerVisitDarts]);\r\n\r\n  const humanName = user?.username || \"Player 1\";\r\n  const aiDisplayName = ai === \"None\" ? \"Player 2\" : ai;\r\n\r\n  // Call all game stat hooks unconditionally at component level (React hooks rules)\r\n  const statsX01 = useOfflineGameStats(\r\n    \"X01\" as any,\r\n    playerScore,\r\n    aiScore,\r\n    playerLegs,\r\n    aiLegs,\r\n    playerLastDart,\r\n    aiLastDart,\r\n    playerVisitSum,\r\n    aiVisitSum,\r\n    playerLastVisitScore,\r\n    aiLastVisitScore,\r\n    playerVisitDarts,\r\n    aiVisitDarts,\r\n    playerDoublesHit,\r\n    playerDoublesAtt,\r\n    aiDoublesHit,\r\n    aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn,\r\n    ai,\r\n    x01Score,\r\n  );\r\n  const statsCricket = useOfflineGameStats(\r\n    \"Cricket\" as any,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    cricket,\r\n  );\r\n  const statsShanghai = useOfflineGameStats(\r\n    \"Shanghai\" as any,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    isPlayerTurn,\r\n    ai,\r\n    undefined,\r\n    cricket,\r\n    shanghai,\r\n  );\r\n  const statsKiller = useOfflineGameStats(\r\n    \"Killer\" as any,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    killerPlayers,\r\n    killerStates,\r\n    killerAssigned,\r\n    killerTurnIdx,\r\n  );\r\n  const statsScam = useOfflineGameStats(\"Scam\" as any);\r\n  const statsFives = useOfflineGameStats(\"Fives\" as any);\r\n  const statsSevens = useOfflineGameStats(\"Sevens\" as any);\r\n\r\n  const activeScoreboardStats = useMemo(() => {\r\n    const list = statsX01 || [];\r\n    const playerResolvedLastScore =\r\n      playerVisitDarts > 0\r\n        ? playerVisitSum\r\n        : (playerLastVisitScore ?? playerLastDart);\r\n    const aiResolvedLastScore =\r\n      aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart);\r\n    if (list.length === 0) {\r\n      return {\r\n        name: isPlayerTurn ? humanName : aiDisplayName,\r\n        isCurrentTurn: true,\r\n        legsWon: isPlayerTurn ? playerLegs : aiLegs,\r\n        score: isPlayerTurn ? playerScore : aiScore,\r\n        lastScore: isPlayerTurn ? playerResolvedLastScore : aiResolvedLastScore,\r\n      } as PlayerStats;\r\n    }\r\n    return list.find((player) => player.isCurrentTurn) ?? list[0];\r\n  }, [\r\n    statsX01,\r\n    isPlayerTurn,\r\n    humanName,\r\n    aiDisplayName,\r\n    playerLegs,\r\n    aiLegs,\r\n    playerScore,\r\n    aiScore,\r\n    playerVisitDarts,\r\n    playerVisitSum,\r\n    playerLastVisitScore,\r\n    playerLastDart,\r\n    aiVisitSum,\r\n    aiLastVisitScore,\r\n    aiLastDart,\r\n    aiVisitDarts,\r\n  ]);\r\n\r\n  const singlePlayerScoreboard: PlayerStats[] = useMemo(() => {\r\n    if (!activeScoreboardStats) return [];\r\n    const { matchAvg, allTimeAvg, ...rest } = activeScoreboardStats;\r\n    return [\r\n      { ...rest, matchAvg: undefined, allTimeAvg: undefined } as PlayerStats,\r\n    ];\r\n  }, [activeScoreboardStats]);\r\n\r\n  const inactivePlayerName = isPlayerTurn ? aiDisplayName : humanName;\r\n  const activePlayerName =\r\n    activeScoreboardStats?.name ?? (isPlayerTurn ? humanName : aiDisplayName);\r\n  const activeRemaining = isPlayerTurn ? playerScore : aiScore;\r\n  const activeLastScore = isPlayerTurn\r\n    ? playerVisitDarts > 0\r\n      ? playerVisitSum\r\n      : (playerLastVisitScore ?? playerLastDart)\r\n    : aiVisitDarts > 0\r\n      ? aiVisitSum\r\n      : (aiLastVisitScore ?? aiLastDart);\r\n\r\n  const recordDart = useCallback((mode: string, count = 1) => {\r\n    if (!mode || count <= 0) return;\r\n    setDartCounts((prev) => ({\r\n      ...prev,\r\n      [mode]: (prev[mode] || 0) + count,\r\n    }));\r\n  }, []);\r\n\r\n  const resetDartCount = useCallback((mode: string) => {\r\n    if (!mode) return;\r\n    setDartCounts((prev) => {\r\n      if (prev[mode] === undefined) return prev;\r\n      return { ...prev, [mode]: 0 };\r\n    });\r\n  }, []);\r\n\r\n  const activeModeDarts = dartCounts[selectedMode] || 0;\r\n\r\n  const parseManualScoreOverride = (value: string): number | null => {\r\n    if (!value.trim()) return null;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) return null;\r\n    return clamp(Math.round(parsed), 0, x01Score);\r\n  };\r\n\r\n  const parseManualLegsOverride = (value: string): number | null => {\r\n    if (!value.trim()) return null;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) return null;\r\n    return Math.max(0, Math.round(parsed));\r\n  };\r\n\r\n  const cancelPendingAutoVisit = useCallback(() => {\r\n    if (pendingVisitRef.current) {\r\n      pendingVisitRef.current = null;\r\n    }\r\n    clearPendingVisitTimer();\r\n    setAwaitingBoardClear(false);\r\n  }, [clearPendingVisitTimer]);\r\n\r\n  const applyPlayerScoreOverride = useCallback(\r\n    (nextScore: number) => {\r\n      const safeScore = clamp(nextScore, 0, x01Score);\r\n      cancelPendingAutoVisit();\r\n      setPlayerScore(safeScore);\r\n      playerScoreRef.current = safeScore;\r\n\r\n      const nextVisitStart = safeScore === 0 ? x01Score : safeScore;\r\n      setPlayerVisitStart(nextVisitStart);\r\n      playerVisitStartRef.current = nextVisitStart;\r\n\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n\r\n      setPlayerLastVisitScore(null);\r\n      setPlayerLastDart(0);\r\n      setPlayerDartPoints(0);\r\n      lastBounceMissTsRef.current = 0;\r\n\r\n      if (safeScore === 0) {\r\n        setPendingLegWinner(\"player\");\r\n        setShowWinPopup(true);\r\n      } else {\r\n        setPendingLegWinner(null);\r\n        setShowWinPopup(false);\r\n      }\r\n    },\r\n    [\r\n      cancelPendingAutoVisit,\r\n      setPlayerScore,\r\n      x01Score,\r\n      setPlayerVisitStart,\r\n      setPlayerVisitSum,\r\n      setPlayerVisitDarts,\r\n      setPlayerVisitDartsAtDouble,\r\n      setPlayerLastVisitScore,\r\n      setPlayerLastDart,\r\n      setPlayerDartPoints,\r\n      setPendingLegWinner,\r\n      setShowWinPopup,\r\n    ],\r\n  );\r\n\r\n  const handleManualScoreOverride = (target: \"player\" | \"ai\") => {\r\n    const source =\r\n      target === \"player\" ? manualPlayerScoreInput : manualOpponentScoreInput;\r\n    const parsed = parseManualScoreOverride(source);\r\n    if (parsed === null) {\r\n      toast(`Enter a number between 0 and ${x01Score}`, {\r\n        type: \"error\",\r\n        timeout: 2500,\r\n      });\r\n      return;\r\n    }\r\n    if (target === \"player\") {\r\n      applyPlayerScoreOverride(parsed);\r\n      setManualPlayerScoreInput(\"\");\r\n      return;\r\n    } else {\r\n      setAiScore(parsed);\r\n      setAiVisitSum(0);\r\n      setAiVisitDarts(0);\r\n      setAiLastVisitScore(null);\r\n      setAiVisitDartsAtDouble(0);\r\n      setAiLastDart(0);\r\n      setManualOpponentScoreInput(\"\");\r\n    }\r\n    setPendingLegWinner(null);\r\n    setShowWinPopup(false);\r\n  };\r\n\r\n  const applyManualLegOverride = useCallback(\r\n    (target: \"player\" | \"ai\", value: number) => {\r\n      if (target === \"player\") {\r\n        setPlayerLegs(value);\r\n        setManualPlayerLegsInput(\"\");\r\n      } else {\r\n        setAiLegs(value);\r\n        setManualOpponentLegsInput(\"\");\r\n      }\r\n      setPendingLegWinner(null);\r\n      setShowWinPopup(false);\r\n    },\r\n    [\r\n      setAiLegs,\r\n      setManualOpponentLegsInput,\r\n      setManualPlayerLegsInput,\r\n      setPendingLegWinner,\r\n      setPlayerLegs,\r\n      setShowWinPopup,\r\n    ],\r\n  );\r\n\r\n  const handleManualLegsOverride = (target: \"player\" | \"ai\") => {\r\n    const source =\r\n      target === \"player\" ? manualPlayerLegsInput : manualOpponentLegsInput;\r\n    const parsed = parseManualLegsOverride(source);\r\n    if (parsed === null) {\r\n      toast(\"Enter a non-negative whole number for legs\", {\r\n        type: \"error\",\r\n        timeout: 2500,\r\n      });\r\n      return;\r\n    }\r\n    setLegOverrideConfirm({ target, value: parsed, stage: 1 });\r\n  };\r\n\r\n  const handleLegOverrideYes = useCallback(() => {\r\n    setLegOverrideConfirm((prev) => {\r\n      if (!prev) return prev;\r\n      if (prev.stage === 1) return { ...prev, stage: 2 };\r\n      applyManualLegOverride(prev.target, prev.value);\r\n      return null;\r\n    });\r\n  }, [applyManualLegOverride]);\r\n\r\n  const handleLegOverrideNo = useCallback(() => {\r\n    setLegOverrideConfirm(null);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!legOverrideConfirm) return;\r\n    const handleKey = (event: KeyboardEvent) => {\r\n      if (event.key === \"Escape\") {\r\n        event.preventDefault();\r\n        handleLegOverrideNo();\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", handleKey);\r\n    return () => window.removeEventListener(\"keydown\", handleKey);\r\n  }, [handleLegOverrideNo, legOverrideConfirm]);\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case \"small\":\r\n        return \"px-1.5 py-0.5 text-xs\";\r\n      case \"large\":\r\n        return \"px-3 py-1 text-sm\";\r\n      default:\r\n        return \"px-2 py-0.5 text-sm\";\r\n    }\r\n  };\r\n  const buttonSizeClass = getButtonSizeClasses(textSize);\r\n  // Fit-all scaling measurement\r\n  const scrollerRef = useRef<HTMLDivElement | null>(null);\r\n  const contentRef = useRef<HTMLDivElement | null>(null);\r\n  const headerBarRef = useRef<HTMLDivElement | null>(null);\r\n  // Match format controls (offline only): First to N or Best of N with editable count\r\n  const [formatType, setFormatType] = useState<\"first\" | \"best\">(\"first\");\r\n  const [formatCount, setFormatCount] = useState<number>(1);\r\n  const formatRef = useRef<HTMLDivElement | null>(null);\r\n  // Keep internal required wins (firstTo) in sync with format selection\r\n  useEffect(() => {\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1));\r\n    const wins = formatType === \"first\" ? n : Math.max(1, Math.ceil(n / 2));\r\n    setFirstTo(wins);\r\n  }, [formatType, formatCount]);\r\n  useEffect(() => {\r\n    if (!fitAll) {\r\n      setFitScale(1);\r\n      setFitOverflowing(false);\r\n      return;\r\n    }\r\n    const measure = () => {\r\n      const scroller = scrollerRef.current;\r\n      const content = contentRef.current;\r\n      if (!scroller || !content) return;\r\n      // Available size excludes the sticky header inside the scroller\r\n      const headerH = headerBarRef.current\r\n        ? headerBarRef.current.getBoundingClientRect().height\r\n        : 0;\r\n      const availH = Math.max(0, scroller.clientHeight - headerH - 6); // small breathing room\r\n      const availW = Math.max(0, scroller.clientWidth - 8);\r\n      // Measure the content size without scale\r\n      const rect = content.getBoundingClientRect();\r\n      const currentScale = fitScale || 1;\r\n      const naturalHeight = rect.height / currentScale;\r\n      const naturalWidth = rect.width / currentScale;\r\n      // Compute scale to fit both height and width\r\n      const scaleH = availH > 0 ? availH / naturalHeight : 1;\r\n      const scaleW = availW > 0 ? availW / naturalWidth : 1;\r\n      const next = Math.min(1, Math.max(0.5, Math.min(scaleH, scaleW)));\r\n      const scaledHeight = naturalHeight * next;\r\n      const overflowing = availH > 0 && scaledHeight - availH > 1;\r\n      setFitOverflowing(overflowing);\r\n      setFitScale(next);\r\n    };\r\n    measure();\r\n    const RO: any = (window as any).ResizeObserver;\r\n    const ro = RO ? new RO(() => measure()) : null;\r\n    ro && scrollerRef.current && ro.observe(scrollerRef.current as any);\r\n    ro && contentRef.current && ro.observe(contentRef.current as any);\r\n    window.addEventListener(\"resize\", measure);\r\n    return () => {\r\n      window.removeEventListener(\"resize\", measure);\r\n      try {\r\n        ro && scrollerRef.current && ro.unobserve(scrollerRef.current as any);\r\n      } catch {}\r\n      try {\r\n        ro && contentRef.current && ro.unobserve(contentRef.current as any);\r\n      } catch {}\r\n    };\r\n  }, [fitAll, fitScale]);\r\n\r\n  // Auto-start handler (from Home or other tabs)\r\n  useEffect(() => {\r\n    const onAuto = (e: any) => {\r\n      const m = e?.detail?.mode as string | undefined;\r\n      if (!m) return;\r\n      setSelectedMode(m);\r\n      // For Double Practice we could load a specific flow. For now, we just open the X01-like modal with immediate start.\r\n      startMatch();\r\n    };\r\n    window.addEventListener(\"ndn:auto-start\", onAuto as any);\r\n    return () => window.removeEventListener(\"ndn:auto-start\", onAuto as any);\r\n  }, []);\r\n\r\n  // Accept demo parameters to preconfigure format and starting score before auto-start\r\n  useEffect(() => {\r\n    const onFmt = (e: any) => {\r\n      const t = e?.detail?.formatType;\r\n      const c = e?.detail?.formatCount;\r\n      const s = e?.detail?.startScore;\r\n      if (t === \"first\" || t === \"best\") setFormatType(t);\r\n      if (typeof c === \"number\" && isFinite(c))\r\n        setFormatCount(Math.max(1, Math.floor(c)));\r\n      if (typeof s === \"number\" && isFinite(s))\r\n        setX01Score(Math.max(1, Math.floor(s)));\r\n    };\r\n    window.addEventListener(\"ndn:offline-format\", onFmt as any);\r\n    return () => window.removeEventListener(\"ndn:offline-format\", onFmt as any);\r\n  }, []);\r\n\r\n  // Auto-start last offline match when opening this tab, if enabled\r\n  useEffect(() => {\r\n    if (!autoStartOffline) return;\r\n    // Kick off a match after initial render for a smooth modal open\r\n    const id = setTimeout(() => startMatch(), 50);\r\n    return () => clearTimeout(id);\r\n  }, [autoStartOffline]);\r\n\r\n  // Drive AI countdown and perform AI visit when countdown elapses\r\n  useEffect(() => {\r\n    if (!showMatchModal || isPlayerTurn || ai === \"None\" || aiCountdownMs <= 0)\r\n      return;\r\n    let raf: number;\r\n    let last = performance.now();\r\n    const tick = (now: number) => {\r\n      const dt = now - last;\r\n      last = now;\r\n      setAiCountdownMs((prev) => {\r\n        const next = prev - dt;\r\n        if (next <= 0) {\r\n          // Execute AI visit per dart (up to 3 darts or until finish/bust)\r\n          let visitDarts = 0;\r\n          let visitTotal = 0;\r\n          let remaining = aiScore;\r\n          setAiVisitDarts(0);\r\n          while (visitDarts < 3 && remaining > 0) {\r\n            const targetVisit = aiVisitScore(remaining, ai);\r\n            // break target into up to 3 darts (roughly 20 per dart for easy split)\r\n            const dart = clamp(\r\n              targetVisit - visitDarts * 20,\r\n              0,\r\n              Math.min(60, remaining),\r\n            );\r\n            const after = remaining - dart;\r\n            setAiLastDart(dart);\r\n            setAiDartsThrown((d) => d + 1);\r\n            setTotalAiDarts((d) => d + 1);\r\n            if (after < 0) {\r\n              // bust: revert to remaining before visit\r\n              remaining = aiScore;\r\n              setAiVisitSum(0);\r\n              setAiVisitDartsAtDouble(0);\r\n              visitTotal = 0;\r\n              setAiLastVisitScore(0);\r\n              setAiVisitDarts(0);\r\n              break;\r\n            }\r\n            // Only add points after confirming not a bust\r\n            visitTotal += dart;\r\n            setAiVisitSum((s) => s + dart);\r\n            setTotalAiPoints((p) => p + dart);\r\n            // Track darts at double window\r\n            const preRem = remaining;\r\n            const postRem = after;\r\n            if (preRem > 50 && postRem <= 50) setAiVisitDartsAtDouble(1);\r\n            else if (preRem <= 50) setAiVisitDartsAtDouble((c) => c + 1);\r\n            remaining = after;\r\n            visitDarts += 1;\r\n            setAiVisitDarts(visitDarts);\r\n            if (remaining === 0) break;\r\n          }\r\n          setAiScore(remaining);\r\n          if (remaining === 0) {\r\n            // Power score classification\r\n            if (visitTotal === 180) setAi180s((n) => n + 1);\r\n            else if (visitTotal >= 140) setAi140s((n) => n + 1);\r\n            else if (visitTotal >= 100) setAi100s((n) => n + 1);\r\n            // Highest checkout\r\n            const checkout = aiScore;\r\n            if (checkout <= 170)\r\n              setAiHighestCheckout((h) => Math.max(h, checkout));\r\n            // Doubles attempts/hit if finished from <= 50\r\n            if (aiScore <= 50) {\r\n              setAiDoublesAtt(\r\n                (a) =>\r\n                  a + (aiVisitDartsAtDouble > 0 ? aiVisitDartsAtDouble : 1),\r\n              );\r\n              setAiDoublesHit((h) => h + 1);\r\n            }\r\n            setAiLastVisitScore(visitTotal);\r\n            setAiVisitSum(0);\r\n            setAiVisitDartsAtDouble(0);\r\n            setAiVisitDarts(0);\r\n            // AI won the leg\r\n            setPendingLegWinner(\"ai\");\r\n            setShowWinPopup(true);\r\n          }\r\n          // If AI did not finish, but threw 3 darts this visit, classify power score and reset visit sum\r\n          if (remaining > 0 && visitDarts >= 3) {\r\n            if (visitTotal === 180) setAi180s((n) => n + 1);\r\n            else if (visitTotal >= 140) setAi140s((n) => n + 1);\r\n            else if (visitTotal >= 100) setAi100s((n) => n + 1);\r\n            setAiLastVisitScore(visitTotal);\r\n            setAiVisitSum(0);\r\n            setAiVisitDartsAtDouble(0);\r\n            setAiVisitDarts(0);\r\n          }\r\n          // Hand turn back to player\r\n          setAiVisitDarts(0);\r\n          setIsPlayerTurn(true);\r\n          return 0;\r\n        }\r\n        return next;\r\n      });\r\n      raf = requestAnimationFrame(tick);\r\n    };\r\n    raf = requestAnimationFrame(tick);\r\n    return () => cancelAnimationFrame(raf);\r\n  }, [showMatchModal, isPlayerTurn, ai, aiScore]);\r\n\r\n  useEffect(() => {\r\n    if (!match.inProgress) return;\r\n    if (startedShowcasedRef.current) return;\r\n    setShowStartShowcase(true);\r\n    startedShowcasedRef.current = true;\r\n  }, [match.inProgress]);\r\n\r\n  function startMatch() {\r\n    setInMatch(true);\r\n    setPlayerScore(x01Score);\r\n    playerScoreRef.current = x01Score;\r\n    setAiScore(x01Score);\r\n    setOnDouble(false);\r\n    setShowMatchModal(true);\r\n    setIsPlayerTurn(true);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown(0);\r\n    setPlayerLastDart(0);\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitStart(x01Score);\r\n    setPlayerVisitSum(0);\r\n    setPlayerLastVisitScore(null);\r\n    setPlayerVisitDartsAtDouble(0);\r\n    setAiCountdownMs(0);\r\n    setAiDartsThrown(0);\r\n    setAiLastDart(0);\r\n    setAiVisitSum(0);\r\n    setAiVisitDarts(0);\r\n    setAiLastVisitScore(null);\r\n    setPendingLegWinner(null);\r\n    // When starting a brand-new match from menu, reset legs\r\n    setPlayerLegs(0);\r\n    setAiLegs(0);\r\n    setLegStats([]);\r\n    // Reset Treble Practice session state when starting a new match\r\n    setTrebleHits(0);\r\n    setTrebleDarts(0);\r\n    setTrebleFinished(false);\r\n    // Reset match-long totals\r\n    setTotalPlayerDarts(0);\r\n    setTotalAiDarts(0);\r\n    setTotalPlayerPoints(0);\r\n    setTotalAiPoints(0);\r\n    setPlayer180s(0);\r\n    setPlayer140s(0);\r\n    setPlayer100s(0);\r\n    setAi180s(0);\r\n    setAi140s(0);\r\n    setAi100s(0);\r\n    setPlayerHighestCheckout(0);\r\n    setAiHighestCheckout(0);\r\n    setPlayerDoublesAtt(0);\r\n    setPlayerDoublesHit(0);\r\n    setAiDoublesAtt(0);\r\n    setAiDoublesHit(0);\r\n    resetDartCount(\"X01\");\r\n    // Sync required wins from current format selection\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1));\r\n    setFirstTo(formatType === \"first\" ? n : Math.max(1, Math.ceil(n / 2)));\r\n    if (rememberLastOffline) {\r\n      try {\r\n        setLastOffline({\r\n          mode: selectedMode,\r\n          x01Start: x01Score,\r\n          firstTo,\r\n          aiLevel: ai,\r\n        });\r\n      } catch {}\r\n    }\r\n  }\r\n\r\n  function startNextLeg() {\r\n    setPlayerScore(x01Score);\r\n    playerScoreRef.current = x01Score;\r\n    setAiScore(x01Score);\r\n    setOnDouble(false);\r\n    setShowMatchModal(true);\r\n    setIsPlayerTurn(true);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown(0);\r\n    setPlayerLastDart(0);\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitStart(x01Score);\r\n    setPlayerVisitSum(0);\r\n    playerVisitStartRef.current = x01Score;\r\n    playerVisitSumRef.current = 0;\r\n    setPlayerLastVisitScore(null);\r\n    setPlayerVisitDartsAtDouble(0);\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    setAiCountdownMs(0);\r\n    setAiDartsThrown(0);\r\n    setAiLastDart(0);\r\n    setAiVisitSum(0);\r\n    setAiVisitDarts(0);\r\n    setAiLastVisitScore(null);\r\n    setPendingLegWinner(null);\r\n  }\r\n\r\n  // --- Offline per-dart helpers ---\r\n  function endTurn(nextRemaining: number) {\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitStart(nextRemaining === 0 ? x01Score : nextRemaining);\r\n    playerVisitStartRef.current =\r\n      nextRemaining === 0 ? x01Score : nextRemaining;\r\n    setPlayerVisitDartsAtDouble(0);\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    if (ai !== \"None\") {\r\n      setIsPlayerTurn(false);\r\n      setAiCountdownMs(aiDelayMs);\r\n    } else {\r\n      setAiCountdownMs(0);\r\n      setIsPlayerTurn(true);\r\n    }\r\n  }\r\n\r\n  function applyDartValue(dart: number) {\r\n    if (waitForBoardClear && pendingVisitRef.current) {\r\n      if (!awaitingBoardClear) setAwaitingBoardClear(true);\r\n      toast(\"Remove your darts before starting the next throw\", {\r\n        type: \"info\",\r\n        timeout: 1800,\r\n      });\r\n      return;\r\n    }\r\n    recordDart(\"X01\");\r\n    const currentScore = playerScoreRef.current;\r\n    const currentVisitDarts = playerVisitDartsRef.current;\r\n    const currentVisitSum = playerVisitSumRef.current;\r\n    const currentVisitStart = playerVisitStartRef.current;\r\n    const currentVisitDartsAtDouble = playerVisitDartsAtDoubleRef.current;\r\n    const remaining = currentScore - dart;\r\n    const newVisitDarts = currentVisitDarts + 1;\r\n\r\n    setPlayerLastDart(dart);\r\n    setPlayerDartsThrown((d) => d + 1);\r\n    setTotalPlayerDarts((d) => d + 1);\r\n\r\n    if (remaining < 0) {\r\n      try {\r\n        const preRemaining = currentScore;\r\n        const postRemaining = currentVisitStart;\r\n        useAudit.getState().recordVisit(\"offline-x01\", newVisitDarts, 0, {\r\n          preRemaining,\r\n          postRemaining,\r\n          bust: true,\r\n          finish: false,\r\n        });\r\n      } catch {}\r\n      setPlayerScore(currentVisitStart);\r\n      playerScoreRef.current = currentVisitStart;\r\n\r\n      if (currentScore <= 50) {\r\n        const attemptsThisVisit = (currentVisitDartsAtDouble || 0) + 1;\r\n        setPlayerDoublesAtt((a) => a + attemptsThisVisit);\r\n      }\r\n\r\n      if (callerEnabled) {\r\n        try {\r\n          sayScore(\r\n            user?.username || \"Player\",\r\n            0,\r\n            Math.max(currentVisitStart, 0),\r\n            callerVoice,\r\n            { volume: callerVolume, checkoutOnly: speakCheckoutOnly },\r\n          );\r\n        } catch {}\r\n      }\r\n\r\n      setPlayerLastVisitScore(0);\r\n      setPlayerDartPoints(0);\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n      endTurn(currentVisitStart);\r\n      return;\r\n    }\r\n\r\n    setPlayerScore(remaining);\r\n    playerScoreRef.current = remaining;\r\n\r\n    setPlayerVisitDarts(newVisitDarts);\r\n    playerVisitDartsRef.current = newVisitDarts;\r\n    const newVisitSum = currentVisitSum + dart;\r\n    setPlayerVisitSum(newVisitSum);\r\n    playerVisitSumRef.current = newVisitSum;\r\n\r\n    setTotalPlayerPoints((p) => p + dart);\r\n    setPlayerDartPoints(0);\r\n\r\n    const preRemaining = currentScore;\r\n    const postRemaining = remaining;\r\n    const startedDoubleWindow = preRemaining > 50 && postRemaining <= 50;\r\n    const stillInDoubleWindow = preRemaining <= 50;\r\n    if (startedDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(1);\r\n      playerVisitDartsAtDoubleRef.current = 1;\r\n    } else if (stillInDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble((c) => c + 1);\r\n      playerVisitDartsAtDoubleRef.current =\r\n        (currentVisitDartsAtDouble || 0) + 1;\r\n    }\r\n\r\n    const doubleAttemptsNow = playerVisitDartsAtDoubleRef.current || 0;\r\n    const inDoubleWindow = preRemaining <= 50;\r\n    const attemptsForVisit = inDoubleWindow\r\n      ? Math.max(doubleAttemptsNow, Math.min(newVisitDarts, 3))\r\n      : 0;\r\n\r\n    if (remaining === 0) {\r\n      const pending: PendingAutoVisit = {\r\n        visitTotal: newVisitSum,\r\n        darts: newVisitDarts,\r\n        preRemaining: currentScore,\r\n        remaining: 0,\r\n        doubleAttempts: attemptsForVisit,\r\n        finished: true,\r\n        doubleWindow: inDoubleWindow,\r\n        highestCheckout: currentVisitStart <= 170 ? currentVisitStart : null,\r\n      };\r\n      if (waitForBoardClear) {\r\n        queuePendingVisit(pending);\r\n      } else {\r\n        commitPendingVisit(pending, \"immediate\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (newVisitDarts >= 3) {\r\n      const pending: PendingAutoVisit = {\r\n        visitTotal: newVisitSum,\r\n        darts: newVisitDarts,\r\n        preRemaining: currentScore,\r\n        remaining,\r\n        doubleAttempts: attemptsForVisit,\r\n        finished: false,\r\n        doubleWindow: inDoubleWindow,\r\n        highestCheckout: null,\r\n      };\r\n      if (waitForBoardClear) {\r\n        queuePendingVisit(pending);\r\n      } else {\r\n        commitPendingVisit(pending, \"immediate\");\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  function addDartNumeric() {\r\n    const dart = clamp(Math.round(Number(playerDartPoints) || 0), 0, 60);\r\n    applyDartValue(dart);\r\n  }\r\n\r\n  function commitManualVisitTotal(rawTotal: number): boolean {\r\n    if (!Number.isFinite(rawTotal)) return false;\r\n\r\n    const visitStart = playerVisitStartRef.current;\r\n    const liveScore = playerScoreRef.current;\r\n    const existingDarts = playerVisitDartsRef.current;\r\n    const existingSum = playerVisitSumRef.current;\r\n    const hadPartialVisit = existingDarts > 0 || existingSum > 0;\r\n\r\n    if (hadPartialVisit) {\r\n      setPlayerScore(visitStart);\r\n      playerScoreRef.current = visitStart;\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n      setPlayerLastDart(0);\r\n      setPlayerDartPoints(0);\r\n      setPlayerDartsThrown((d) => Math.max(0, d - existingDarts));\r\n      setTotalPlayerDarts((d) => Math.max(0, d - existingDarts));\r\n      setTotalPlayerPoints((p) => Math.max(0, p - existingSum));\r\n      lastBounceMissTsRef.current = 0;\r\n    }\r\n\r\n    const preRemaining = hadPartialVisit ? visitStart : liveScore;\r\n    const checkoutCap = preRemaining <= 170 ? 170 : 180;\r\n    const total = clamp(Math.round(rawTotal), 0, checkoutCap);\r\n\r\n    recordDart(\"X01\", 3);\r\n    setPlayerDartsThrown((d) => d + 3);\r\n    setTotalPlayerDarts((d) => d + 3);\r\n    setPlayerVisitDarts(3);\r\n    playerVisitDartsRef.current = 3;\r\n    setPlayerVisitSum(total);\r\n    playerVisitSumRef.current = total;\r\n    setPlayerLastVisitScore(total);\r\n\r\n    if (total === 180) setPlayer180s((n) => n + 1);\r\n    else if (total >= 140) setPlayer140s((n) => n + 1);\r\n    else if (total >= 100) setPlayer100s((n) => n + 1);\r\n\r\n    const remaining = preRemaining - total;\r\n\r\n    if (remaining < 0) {\r\n      if (callerEnabled) {\r\n        try {\r\n          sayScore(humanName, 0, Math.max(visitStart, 0), callerVoice, {\r\n            volume: callerVolume,\r\n            checkoutOnly: speakCheckoutOnly,\r\n          });\r\n        } catch {}\r\n      }\r\n      try {\r\n        useAudit.getState().recordVisit(\"offline-x01\", 3, 0, {\r\n          preRemaining,\r\n          postRemaining: visitStart,\r\n          bust: true,\r\n          finish: false,\r\n        });\r\n      } catch {}\r\n      setPlayerScore(visitStart);\r\n      playerScoreRef.current = visitStart;\r\n      setPlayerLastVisitScore(0);\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n      endTurn(visitStart);\r\n      return true;\r\n    }\r\n\r\n    setPlayerScore(remaining);\r\n    playerScoreRef.current = remaining;\r\n    setTotalPlayerPoints((p) => p + total);\r\n\r\n    if (callerEnabled) {\r\n      try {\r\n        sayScore(humanName, total, Math.max(remaining, 0), callerVoice, {\r\n          volume: callerVolume,\r\n          checkoutOnly: speakCheckoutOnly,\r\n        });\r\n      } catch {}\r\n    }\r\n\r\n    if (preRemaining <= 50) {\r\n      setPlayerDoublesAtt((a) => a + 3);\r\n      if (remaining === 0) setPlayerDoublesHit((h) => h + 1);\r\n    }\r\n\r\n    if (remaining === 0) {\r\n      if (preRemaining <= 170)\r\n        setPlayerHighestCheckout((h) => Math.max(h, preRemaining));\r\n      try {\r\n        useAudit.getState().recordVisit(\"offline-x01\", 3, total, {\r\n          preRemaining,\r\n          postRemaining: 0,\r\n          finish: true,\r\n          bust: false,\r\n        });\r\n      } catch {}\r\n      setPendingLegWinner(\"player\");\r\n      setShowWinPopup(true);\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n      return true;\r\n    }\r\n\r\n    try {\r\n      useAudit.getState().recordVisit(\"offline-x01\", 3, total, {\r\n        preRemaining,\r\n        postRemaining: remaining,\r\n        finish: false,\r\n        bust: false,\r\n      });\r\n    } catch {}\r\n    endTurn(remaining);\r\n    setPlayerVisitSum(0);\r\n    playerVisitSumRef.current = 0;\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitDartsAtDouble(0);\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    return true;\r\n  }\r\n\r\n  // Once local commit and endTurn functions are defined, create the unified offline actions wrapper\r\n  const matchActions: UnifiedMatchActions = createOfflineMatchActions({\r\n    match,\r\n    commitManualVisitTotal,\r\n    endTurn,\r\n  });\r\n\r\n  // Optional: Add a full-visit total (0â€“180) input for quick entry like \"93\"\r\n  const [visitTotalInput, setVisitTotalInput] = useState<string>(\"\");\r\n  const handleVisitTotalChange = (raw: string) => {\r\n    if (!raw) {\r\n      setVisitTotalInput(\"\");\r\n      return;\r\n    }\r\n    const numericOnly = raw.replace(/[^0-9]/g, \"\");\r\n    if (!numericOnly) {\r\n      setVisitTotalInput(\"\");\r\n      return;\r\n    }\r\n    const parsed = Number(numericOnly);\r\n    if (!Number.isFinite(parsed)) return;\r\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180;\r\n    const safe = clamp(Math.round(parsed), 0, maxAllowed);\r\n    setVisitTotalInput(String(safe));\r\n  };\r\n  function addVisitTotal() {\r\n    if (!visitTotalInput) {\r\n      alert(\"Enter a number 0â€“180 for visit total\");\r\n      return;\r\n    }\r\n    const parsed = Number(visitTotalInput);\r\n    if (!Number.isFinite(parsed)) {\r\n      alert(\"Enter a number 0â€“180 for visit total\");\r\n      return;\r\n    }\r\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180;\r\n    const bounded = clamp(Math.round(parsed), 0, maxAllowed);\r\n    if (parsed > maxAllowed) {\r\n      toast(`Visit totals cannot exceed ${maxAllowed}.`, {\r\n        type: \"info\",\r\n        timeout: 2200,\r\n      });\r\n    }\r\n    if (commitManualVisitTotal(bounded)) {\r\n      setVisitTotalInput(\"\");\r\n    }\r\n  }\r\n\r\n  const clearCurrentVisit = useCallback(() => {\r\n    if (pendingVisitRef.current) {\r\n      pendingVisitRef.current = null;\r\n      clearPendingVisitTimer();\r\n      setAwaitingBoardClear(false);\r\n    }\r\n    const visitDarts = playerVisitDartsRef.current;\r\n    const visitTotal = playerVisitSumRef.current;\r\n    const visitStart = playerVisitStartRef.current;\r\n    if (visitDarts === 0 && visitTotal === 0) return;\r\n    setPlayerScore(visitStart);\r\n    playerScoreRef.current = visitStart;\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitSum(0);\r\n    playerVisitSumRef.current = 0;\r\n    setPlayerVisitDartsAtDouble(0);\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    setPlayerLastDart(0);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown((d) => Math.max(0, d - visitDarts));\r\n    setTotalPlayerDarts((d) => Math.max(0, d - visitDarts));\r\n    setTotalPlayerPoints((p) => Math.max(0, p - visitTotal));\r\n    lastBounceMissTsRef.current = 0;\r\n  }, [clearPendingVisitTimer]);\r\n\r\n  useEffect(() => {\r\n    const onClearRequest = (evt: Event) => {\r\n      const detail = (evt as CustomEvent)?.detail;\r\n      if (!detail || detail?.source === \"offline-play\") return;\r\n      clearCurrentVisit();\r\n    };\r\n    window.addEventListener(\r\n      \"ndn:clear-visit-request\",\r\n      onClearRequest as EventListener,\r\n    );\r\n    return () =>\r\n      window.removeEventListener(\r\n        \"ndn:clear-visit-request\",\r\n        onClearRequest as EventListener,\r\n      );\r\n  }, [clearCurrentVisit]);\r\n\r\n  // --- Double Practice helpers ---\r\n  function addDpValue(val: number) {\r\n    recordDart(\"Double Practice\");\r\n    const dart = clamp(Math.round(val || 0), 0, 60);\r\n    setPlayerLastDart(dart);\r\n    setPlayerDartsThrown((d) => d + 1);\r\n    setTotalPlayerDarts((d) => d + 1);\r\n    if (isDoubleHit(dart, dpIndex)) {\r\n      const nextHits = dpHits + 1;\r\n      setDpHits(nextHits);\r\n      setDpIndex((i) => Math.min(20, i + 1));\r\n      // End when DBULL (index 20) is hit\r\n      if (nextHits >= 21) {\r\n        setPendingLegWinner(\"player\");\r\n        setShowWinPopup(true);\r\n      }\r\n    }\r\n    setPlayerDartPoints(0);\r\n  }\r\n  function addDpNumeric() {\r\n    addDpValue(Number(playerDartPoints));\r\n  }\r\n  function addDpManual() {\r\n    const v = parseManualDart(manualBox);\r\n    if (v == null) {\r\n      alert(\"Enter like D16, 50, 25, T20\");\r\n      return;\r\n    }\r\n    addDpValue(v);\r\n    setManualBox(\"\");\r\n  }\r\n\r\n  // Bob's 27\r\n  function addB27Auto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    if (b27Finished) return false;\r\n    recordDart(\"Bob's 27\");\r\n    const target = b27Stage;\r\n    const hit =\r\n      (ring === \"DOUBLE\" && sector === target) ||\r\n      (!ring && value === target * 2);\r\n    if (hit) setB27Hits((h) => h + 1);\r\n    setB27Darts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        const totalHits = b27Hits + (hit ? 1 : 0);\r\n        if (totalHits > 0) setB27Score((s) => s + totalHits * target * 2);\r\n        else setB27Score((s) => s - target * 2);\r\n        const next = target + 1;\r\n        setB27Stage(next);\r\n        setB27Hits(0);\r\n        if (next > 20) setB27Finished(true);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addB27Numeric() {\r\n    addB27Auto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n  function resetB27() {\r\n    setB27Stage(1);\r\n    setB27Score(27);\r\n    setB27Darts(0);\r\n    setB27Hits(0);\r\n    setB27Finished(false);\r\n    resetDartCount(\"Bob's 27\");\r\n  }\r\n\r\n  // Count-Up / High Score / Low Score\r\n  function addCountUpAuto(value: number): boolean {\r\n    recordDart(\"Count-Up\");\r\n    setCuScore((s) => s + Math.max(0, value | 0));\r\n    setCuDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setCuRound((r) => r + 1);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addHighScoreAuto(value: number): boolean {\r\n    recordDart(\"High Score\");\r\n    setHsScore((s) => s + Math.max(0, value | 0));\r\n    setHsDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setHsRound((r) => r + 1);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addLowScoreAuto(value: number): boolean {\r\n    recordDart(\"Low Score\");\r\n    setLsScore((s) => s + Math.max(0, value | 0));\r\n    setLsDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setLsRound((r) => r + 1);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n\r\n  // Checkout routines (double out)\r\n  function applyCheckout(\r\n    rem: number,\r\n    setRem: (n: number) => void,\r\n    darts: number,\r\n    setDarts: (f: (n: number) => number) => void,\r\n    setAttempts: (f: (n: number) => number) => void,\r\n    setSuccesses: (f: (n: number) => number) => void,\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  ) {\r\n    const next = rem - value;\r\n    if (next < 0) {\r\n      // bust: ignore progress during attempt\r\n    } else if (next === 0) {\r\n      if (ring === \"DOUBLE\" || ring === \"INNER_BULL\") {\r\n        setSuccesses((s) => s + 1);\r\n        setAttempts((a) => a + 1);\r\n        setDarts(() => 0);\r\n        setRem(rem); // caller will reset to initial value right after\r\n        return;\r\n      }\r\n      setRem(next);\r\n    } else {\r\n      setRem(next);\r\n    }\r\n    setDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setAttempts((a) => a + 1);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n  }\r\n  function addCo170Auto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  ): boolean {\r\n    recordDart(\"Checkout 170\");\r\n    applyCheckout(\r\n      co170Rem,\r\n      setCo170Rem,\r\n      co170Darts,\r\n      setCo170Darts,\r\n      setCo170Attempts,\r\n      setCo170Successes,\r\n      value,\r\n      ring,\r\n    );\r\n    if (co170Darts + 1 >= 3) setCo170Rem(170);\r\n    return true;\r\n  }\r\n  function addCo121Auto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  ): boolean {\r\n    recordDart(\"Checkout 121\");\r\n    applyCheckout(\r\n      co121Rem,\r\n      setCo121Rem,\r\n      co121Darts,\r\n      setCo121Darts,\r\n      setCo121Attempts,\r\n      setCo121Successes,\r\n      value,\r\n      ring,\r\n    );\r\n    if (co121Darts + 1 >= 3) setCo121Rem(121);\r\n    return true;\r\n  }\r\n  function addCoManual(is170: boolean) {\r\n    const v = parseManualDart(manualBox);\r\n    if (v == null) {\r\n      alert(\"Enter like T20, D16, 25, 50\");\r\n      return;\r\n    }\r\n    const t = manualBox.trim().toUpperCase();\r\n    const isDouble =\r\n      t.startsWith(\"D\") ||\r\n      t === \"50\" ||\r\n      t === \"BULL\" ||\r\n      t === \"DBULL\" ||\r\n      t === \"IBULL\" ||\r\n      t.includes(\"INNER\");\r\n    if (is170) addCo170Auto(v, isDouble ? \"DOUBLE\" : undefined);\r\n    else addCo121Auto(v, isDouble ? \"DOUBLE\" : undefined);\r\n    setManualBox(\"\");\r\n  }\r\n  function resetCo170() {\r\n    setCo170Rem(170);\r\n    setCo170Darts(0);\r\n    setCo170Attempts(0);\r\n    setCo170Successes(0);\r\n    resetDartCount(\"Checkout 170\");\r\n  }\r\n  function resetCo121() {\r\n    setCo121Rem(121);\r\n    setCo121Darts(0);\r\n    setCo121Attempts(0);\r\n    setCo121Successes(0);\r\n    resetDartCount(\"Checkout 121\");\r\n  }\r\n\r\n  // Treble practice\r\n  function addTrebleAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    if (trebleFinished) return false;\r\n    recordDart(\"Treble Practice\");\r\n    const isHit =\r\n      (ring === \"TRIPLE\" && sector === trebleTarget) ||\r\n      (!ring && value === trebleTarget * 3);\r\n    if (isHit) setTrebleHits((h) => h + 1);\r\n    setTrebleDarts((d) => {\r\n      const nd = d + 1;\r\n      // Auto-rotate target every 3 darts among T20â†’T19â†’T18\r\n      if (nd % 3 === 0 && [20, 19, 18].includes(trebleTarget)) {\r\n        const cycle = [20, 19, 18];\r\n        const idx = cycle.indexOf(trebleTarget);\r\n        const next = cycle[(idx + 1) % cycle.length];\r\n        setTrebleTarget(next);\r\n      }\r\n      // End session at configured throws\r\n      if (trebleMaxDarts > 0 && nd >= trebleMaxDarts) setTrebleFinished(true);\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function resetTreble() {\r\n    setTrebleHits(0);\r\n    setTrebleDarts(0);\r\n    setTrebleFinished(false);\r\n    resetDartCount(\"Treble Practice\");\r\n  }\r\n\r\n  // Baseball\r\n  function addBaseballAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Baseball\");\r\n    setBaseball((prev) => {\r\n      const cp = { ...prev };\r\n      applyBaseballDart(cp as any, value, ring as any, sector);\r\n      return cp;\r\n    });\r\n    return true;\r\n  }\r\n  function resetBaseball() {\r\n    setBaseball(createBaseball());\r\n    resetDartCount(\"Baseball\");\r\n  }\r\n\r\n  // Golf\r\n  function addGolfAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Golf\");\r\n    setGolf((prev) => {\r\n      const cp = { ...prev };\r\n      applyGolfDart(cp as any, value, ring as any, sector);\r\n      return cp;\r\n    });\r\n    return true;\r\n  }\r\n  function resetGolf() {\r\n    setGolf(createGolf());\r\n    resetDartCount(\"Golf\");\r\n  }\r\n\r\n  // Tic Tac Toe\r\n  function addTttAuto(\r\n    cell: number,\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Tic Tac Toe\");\r\n    setTTT((prev) => {\r\n      const cp = { ...prev, board: [...prev.board] as any };\r\n      tryClaimCell(cp as any, cell as any, value, ring as any, sector);\r\n      return cp;\r\n    });\r\n    return true;\r\n  }\r\n  function resetTtt() {\r\n    setTTT(createTicTacToe());\r\n    resetDartCount(\"Tic Tac Toe\");\r\n  }\r\n\r\n  // American Cricket\r\n  function addAmCricketAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"American Cricket\");\r\n    setAmCricket((prev) => {\r\n      const cp = { ...prev, marks: { ...prev.marks } };\r\n      applyAmCricketDart(cp as any, value, ring as any, sector, () => false);\r\n      return cp;\r\n    });\r\n    return true;\r\n  }\r\n  function resetAmCricket() {\r\n    setAmCricket(createAmCricketState());\r\n    resetDartCount(\"American Cricket\");\r\n  }\r\n\r\n  // --- Around the Clock helpers ---\r\n  function addAtcValue(\r\n    val: number,\r\n    ring?: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Around the Clock\");\r\n    const target = ATC_ORDER[atcIndex];\r\n    let hit = false;\r\n    if (\r\n      typeof sector === \"number\" &&\r\n      sector === target &&\r\n      (ring === \"SINGLE\" || ring === \"DOUBLE\" || ring === \"TRIPLE\")\r\n    )\r\n      hit = true;\r\n    if (target === 25 && (ring === \"BULL\" || val === 25)) hit = true;\r\n    if (target === 50 && (ring === \"INNER_BULL\" || val === 50)) hit = true;\r\n    if (!hit) {\r\n      // Fallback by value only\r\n      if (val === target || val === target * 2 || val === target * 3)\r\n        hit = true;\r\n    }\r\n  if (hit) {\r\n      const newHits = atcHits + 1;\r\n      setAtcHits(newHits);\r\n      setAtcIndex((i) => i + 1);\r\n      return true;\r\n    }\r\n    return true;\r\n  }\r\n  function addAtcNumeric() {\r\n    addAtcValue(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n  function addAtcManual() {\r\n    const v = parseManualDart(manualBox);\r\n    if (v == null) {\r\n      alert(\"Enter like T20, D5, 25, 50\");\r\n      return;\r\n    }\r\n    addAtcValue(v);\r\n    setManualBox(\"\");\r\n  }\r\n\r\n  // --- Cricket helpers (solo practice) ---\r\n  function addCricketAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Cricket\");\r\n    setCricket((prev) => {\r\n      const copy = { ...prev, marks: { ...prev.marks } };\r\n      applyCricketDart(copy as any, value, ring, sector, () => false);\r\n      return copy;\r\n    });\r\n    setPracticeTurnDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) return 0;\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addCricketNumeric() {\r\n    addCricketAuto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n\r\n  // --- Shanghai helpers ---\r\n  function addShanghaiAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Shanghai\");\r\n    setShanghai((prev) => {\r\n      const copy = { ...prev, turnHits: { ...prev.turnHits } };\r\n      applyShanghaiDart(copy as any, value, ring, sector);\r\n      return copy;\r\n    });\r\n    setPracticeTurnDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setShanghai((prev) => {\r\n          const cp = { ...prev, turnHits: { ...prev.turnHits } };\r\n          endShanghaiTurn(cp as any);\r\n          return cp;\r\n        });\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addShanghaiNumeric() {\r\n    addShanghaiAuto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n\r\n  // --- Halve It helpers ---\r\n  function addHalveAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Halve It\");\r\n    setHalve((prev) => {\r\n      const copy = { ...prev, targets: [...prev.targets] };\r\n      applyHalveItDart(copy as any, value, ring, sector);\r\n      return copy;\r\n    });\r\n    setPracticeTurnDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setHalve((prev) => {\r\n          const cp = { ...prev, targets: [...prev.targets] };\r\n          endHalveItTurn(cp as any);\r\n          return cp;\r\n        });\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addHalveNumeric() {\r\n    addHalveAuto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n\r\n  // --- High-Low helpers ---\r\n  function addHighLowAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"High-Low\");\r\n    setHighlow((prev) => {\r\n      const copy = { ...prev };\r\n      applyHighLowDart(copy as any, value, ring, sector);\r\n      return copy;\r\n    });\r\n    setPracticeTurnDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setHighlow((prev) => {\r\n          const cp = { ...prev };\r\n          endHighLowTurn(cp as any);\r\n          return cp;\r\n        });\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addHighLowNumeric() {\r\n    addHighLowAuto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n\r\n  function parseManualBox(): number | null {\r\n    const t = manualBox.trim().toUpperCase();\r\n    if (!t) return null;\r\n    if (t === \"50\" || t === \"BULL\" || t === \"DBULL\" || t === \"IBULL\") return 50;\r\n    if (t === \"25\" || t === \"OBULL\") return 25;\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\r\n    if (!m) return null;\r\n    const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\r\n    const num = parseInt(m[2], 10);\r\n    if (num < 1 || num > 20) return null;\r\n    const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\r\n    return num * multVal;\r\n  }\r\n\r\n  function addManual() {\r\n    const val = parseManualBox();\r\n    if (val == null) {\r\n      alert(\"Enter like T20, D16, 5, 25, 50\");\r\n      return;\r\n    }\r\n    applyDartValue(val);\r\n    setManualBox(\"\");\r\n  }\r\n\r\n  function addManualTextarea() {\r\n    const lines = manualTextarea\r\n      .trim()\r\n      .split(\"\\n\")\r\n      .map((l) => l.trim())\r\n      .filter((l) => l);\r\n    if (lines.length === 0) return;\r\n    for (const line of lines) {\r\n      const val = parseManualDart(line);\r\n      if (val == null) {\r\n        alert(`Invalid score: ${line}`);\r\n        return;\r\n      }\r\n      applyDartValue(val);\r\n    }\r\n    setManualTextarea(\"\");\r\n  }\r\n\r\n  function replaceLast() {\r\n    if (playerVisitDarts === 0) return;\r\n    // Rewind one dart: approximate by adding back last dart into score\r\n    setPlayerScore((s) => s + playerLastDart);\r\n    setPlayerVisitDarts((d) => Math.max(0, d - 1));\r\n  }\r\n\r\n  function replaceLastManual() {\r\n    const val = parseManualBox();\r\n    if (val == null) {\r\n      alert(\"Enter like T20, D16, 5, 25, 50\");\r\n      return;\r\n    }\r\n    if (playerVisitDarts === 0) {\r\n      addManual();\r\n      return;\r\n    }\r\n    // Rewind last then apply\r\n    const rewind = playerLastDart;\r\n    setPlayerScore((s) => s + rewind);\r\n    setPlayerVisitDarts((d) => Math.max(0, d - 1));\r\n    // Apply new value in next microtask to ensure state has updated\r\n    setTimeout(() => applyDartValue(val), 0);\r\n    setManualBox(\"\");\r\n  }\r\n\r\n  function playerThrow(points: number) {\r\n    const newScore = playerScore - points;\r\n    if (newScore < 0) {\r\n      setPlayerScore(playerScore); // bust\r\n      return;\r\n    }\r\n    setPlayerScore(newScore);\r\n    if (newScore === 0) {\r\n      setPendingLegWinner(\"player\");\r\n      setShowWinPopup(true);\r\n    }\r\n    setOnDouble(newScore <= 40 && newScore % 2 === 0);\r\n  }\r\n\r\n  function aiTurn() {\r\n    // This is now automated inside the modal turn loop\r\n  }\r\n\r\n  function handleBust() {\r\n    setPlayerScore(playerScore); // bust, score unchanged\r\n    setOnDouble(false);\r\n  }\r\n\r\n  function handleWinPopupSubmit() {\r\n    const winner = pendingLegWinner ?? \"player\";\r\n    // Approximate per-leg doubles attempts: if winner is player and they finished from <=50, attempts were counted in playerVisitDartsAtDouble; otherwise leave undefined\r\n    const legDoublesAtt =\r\n      winner === \"player\"\r\n        ? playerVisitDartsAtDouble || undefined\r\n        : aiVisitDartsAtDouble || undefined;\r\n    const legDoublesHit = 1;\r\n    const winnerDarts = winner === \"player\" ? playerDartsThrown : aiDartsThrown;\r\n    setLegStats([\r\n      ...legStats,\r\n      {\r\n        winner,\r\n        doubleDarts,\r\n        checkoutDarts,\r\n        winnerDarts,\r\n        doublesAtt: legDoublesAtt,\r\n        doublesHit: legDoublesHit,\r\n      },\r\n    ]);\r\n    setShowWinPopup(false);\r\n    // Increment legs for the winner\r\n    let p = playerLegs;\r\n    let a = aiLegs;\r\n    if (pendingLegWinner === \"player\") p += 1;\r\n    else if (pendingLegWinner === \"ai\") a += 1;\r\n    setPlayerLegs(p);\r\n    setAiLegs(a);\r\n    setPendingLegWinner(null);\r\n    // Check if match is over\r\n    if (p >= firstTo || a >= firstTo) {\r\n      // End of match: close modal back to menu state\r\n      // Record per-game-mode result (local-only demo)\r\n      try {\r\n        bumpGameMode(selectedMode, winner === \"player\");\r\n      } catch {}\r\n      setShowMatchModal(false);\r\n      setInMatch(false);\r\n      // Reset leg-specific stats for next match but keep the summary list visible\r\n      setPlayerScore(x01Score);\r\n      setAiScore(x01Score);\r\n      setShowMatchSummary(true);\r\n      return;\r\n    }\r\n    // Otherwise, start the next leg immediately\r\n    startNextLeg();\r\n  }\r\n\r\n  const isFreeSelected = freeGames.includes(selectedMode as any);\r\n  const lockedPremium = !isFreeSelected && !(user?.fullAccess || user?.admin);\r\n\r\n  // no external overlay: we render the match modal as absolute inset-0 inside this card\r\n\r\n  return (\r\n    <div className=\"card ndn-game-shell relative overflow-hidden\">\r\n      {showStartShowcase && (\r\n        <MatchStartShowcase\r\n          players={(match.players || []) as any}\r\n          onDone={() => setShowStartShowcase(false)}\r\n        />\r\n      )}\r\n      <h2 className=\"text-3xl font-bold text-brand-700 mb-4\">\r\n        Offline Mode{\" \"}\r\n        {offlineLayout === \"classic\" ? (\r\n          <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle\">\r\n            Classic layout\r\n          </span>\r\n        ) : (\r\n          <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle\">\r\n            Modern layout\r\n          </span>\r\n        )}\r\n      </h2>\r\n      <div className=\"ndn-shell-body\">\r\n        <div className=\"mb-4 flex flex-col gap-3\">\r\n          <select\r\n            className=\"input w-full\"\r\n            value={selectedMode}\r\n            onChange={(e) => setSelectedMode(e.target.value)}\r\n          >\r\n            {freeGames.map((mode) => (\r\n              <option key={mode} value={mode}>\r\n                {mode}\r\n              </option>\r\n            ))}\r\n            {premiumGames.map((mode) => (\r\n              <option\r\n                key={mode}\r\n                value={mode}\r\n                disabled={!(user?.fullAccess || user?.admin)}\r\n              >\r\n                {mode} {user?.fullAccess || user?.admin ? \"\" : \"(Premium)\"}\r\n              </option>\r\n            ))}\r\n          </select>\r\n\r\n          {/* Calibration Status - displayed below game mode selector */}\r\n          <GameCalibrationStatus gameMode={selectedMode} compact={true} />\r\n\r\n          {selectedMode === \"Treble Practice\" && (\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end\">\r\n              <div className=\"sm:col-span-1\">\r\n                <label className=\"font-semibold\">Throws per game</label>\r\n                <input\r\n                  className=\"input w-full\"\r\n                  type=\"number\"\r\n                  min={3}\r\n                  step={3}\r\n                  value={trebleMaxDarts}\r\n                  onChange={(e) =>\r\n                    setTrebleMaxDarts(\r\n                      Math.max(3, Math.floor(Number(e.target.value) || 30)),\r\n                    )\r\n                  }\r\n                />\r\n              </div>\r\n              <div className=\"sm:col-span-2 text-xs text-slate-300\">\r\n                Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the\r\n                selected number of throws.\r\n              </div>\r\n            </div>\r\n          )}\r\n          {!user?.fullAccess && (\r\n            <div className=\"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2\">\r\n              <span>ðŸ”’</span>\r\n              <span>\r\n                Only X01 and Double Practice are free. Advanced modes (Killer,\r\n                Cricket, Shanghai, etc.) require PREMIUM.\r\n              </span>\r\n            </div>\r\n          )}\r\n          {selectedMode === \"X01\" && (\r\n            <>\r\n              <label className=\"font-semibold mt-2\">\r\n                Enter starting score (1-1001):\r\n              </label>\r\n              <input\r\n                className=\"input w-full\"\r\n                type=\"number\"\r\n                min={1}\r\n                max={1001}\r\n                value={x01Score}\r\n                onChange={(e) => setX01Score(Number(e.target.value))}\r\n              />\r\n              <label className=\"font-semibold mt-2\">Play against AI bot?</label>\r\n              <select\r\n                className=\"input w-full\"\r\n                value={ai}\r\n                onChange={(e) => setAI(e.target.value)}\r\n              >\r\n                <option value=\"None\">None</option>\r\n                {aiLevels.map((level) => (\r\n                  <option key={level} value={level}>\r\n                    {level}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              {ai !== \"None\" && (\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2\">\r\n                  <div className=\"sm:col-span-2\">\r\n                    <label className=\"font-semibold\">\r\n                      AI throw delay (seconds)\r\n                    </label>\r\n                    <input\r\n                      className=\"input w-full\"\r\n                      type=\"number\"\r\n                      min={0.5}\r\n                      max={10}\r\n                      step={0.5}\r\n                      value={aiDelayMs / 1000}\r\n                      onChange={(e) =>\r\n                        setAiDelayMs(Math.round(Number(e.target.value) * 1000))\r\n                      }\r\n                    />\r\n                  </div>\r\n                  <div className=\"text-sm text-slate-300\">\r\n                    Controls how long the AI waits before its visit.\r\n                  </div>\r\n                </div>\r\n              )}\r\n              <button className=\"btn mt-2\" onClick={() => setShowRules(true)}>\r\n                X01 Rules & Regulations!\r\n              </button>\r\n            </>\r\n          )}\r\n          {selectedMode === \"Double Practice\" && (\r\n            <div className=\"mt-2 text-brand-600\">\r\n              Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and\r\n              X01 settings donâ€™t apply.\r\n            </div>\r\n          )}\r\n        </div>\r\n        {!inMatch && (\r\n          <button\r\n            className=\"btn\"\r\n            disabled={lockedPremium}\r\n            title={lockedPremium ? \"PREMIUM required for this mode\" : \"\"}\r\n            onClick={startMatch}\r\n          >\r\n            Start Match\r\n          </button>\r\n        )}\r\n        {/* Match Modal with turn-by-turn flow */}\r\n        {showMatchModal && (\r\n          <div\r\n            className={`absolute inset-0 z-[1000] ${maximized ? \"\" : \"flex items-center justify-center p-3 sm:p-4\"}`}\r\n          >\r\n            <ResizableModal\r\n              storageKey=\"ndn:modal:offline-match\"\r\n              className={`${maximized ? \"w-full h-full ndn-modal-tight\" : \"\"} relative flex flex-col overflow-hidden`}\r\n              fullScreen={maximized}\r\n              defaultWidth={1100}\r\n              defaultHeight={720}\r\n              minWidth={720}\r\n              minHeight={480}\r\n              maxWidth={1600}\r\n              maxHeight={1200}\r\n              initialFitHeight\r\n            >\r\n              {/* Header bar with visible mode and actions; sheen is clipped to this area */}\r\n              <div\r\n                className=\"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2\"\r\n                style={{ overflowY: \"scroll\" }}\r\n                ref={(el) => {\r\n                  (scrollerRef as any).current = el;\r\n                }}\r\n              >\r\n                <div\r\n                  ref={(el) => {\r\n                    (headerBarRef as any).current = el;\r\n                  }}\r\n                >\r\n                  <GameHeaderBar\r\n                    left={\r\n                      <>\r\n                        <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">\r\n                          Game Mode\r\n                        </span>\r\n                        <span className=\"font-medium whitespace-nowrap\">\r\n                          {selectedMode}\r\n                          {selectedMode === \"X01\" ? ` / ${x01Score}` : \"\"}\r\n                        </span>\r\n                        <span className=\"opacity-80 whitespace-nowrap\">\r\n                          First to {firstTo} Â· Legs {playerLegs}-{aiLegs}\r\n                        </span>\r\n                        <span\r\n                          className={`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${offlineLayout === \"modern\" ? \"bg-emerald-500/15 text-emerald-200 border-emerald-400/30\" : \"bg-white/10 text-white/70 border-white/20\"}`}\r\n                        >\r\n                          {offlineLayout === \"modern\"\r\n                            ? \"Modern layout\"\r\n                            : \"Classic layout\"}\r\n                        </span>\r\n                      </>\r\n                    }\r\n                    right={\r\n                      <>\r\n                        {/* Camera scale controls (match Online UI) */}\r\n                        <div className=\"hidden items-center gap-2 mr-2 text-xs\">\r\n                          <span className=\"opacity-80\">Cam</span>\r\n                          <button\r\n                            className=\"btn btn--ghost px-2 py-1\"\r\n                            onClick={() =>\r\n                              setCameraScale(\r\n                                Math.max(\r\n                                  0.5,\r\n                                  Math.round((cameraScale - 0.05) * 100) / 100,\r\n                                ),\r\n                              )\r\n                            }\r\n                            title=\"Decrease camera size\"\r\n                          >\r\n                            âˆ’\r\n                          </button>\r\n                          <span className=\"w-9 text-center\">\r\n                            {Math.round(cameraScale * 100)}%\r\n                          </span>\r\n                          <button\r\n                            className=\"btn btn--ghost px-2 py-1\"\r\n                            onClick={() =>\r\n                              setCameraScale(\r\n                                Math.min(\r\n                                  1.25,\r\n                                  Math.round((cameraScale + 0.05) * 100) / 100,\r\n                                ),\r\n                              )\r\n                            }\r\n                            title=\"Increase camera size\"\r\n                          >\r\n                            +\r\n                          </button>\r\n                        </div>\r\n                        <button\r\n                          className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                          title={fitAll ? \"Actual Size\" : \"Fit All\"}\r\n                          onClick={() => setFitAll((v) => !v)}\r\n                        >\r\n                          {fitAll ? \"Actual Size\" : \"Fit All\"}\r\n                        </button>\r\n                        <button\r\n                          className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                          title={maximized ? \"Restore\" : \"Maximize\"}\r\n                          onClick={() => setMaximized((m) => !m)}\r\n                        >\r\n                          {maximized ? \"Restore\" : \"Maximize\"}\r\n                        </button>\r\n                        <button\r\n                          className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                          onClick={() => {\r\n                            startMatch();\r\n                          }}\r\n                        >\r\n                          Restart\r\n                        </button>\r\n                        <button\r\n                          className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\r\n                          onClick={() => {\r\n                            setShowMatchModal(false);\r\n                            setInMatch(false);\r\n                          }}\r\n                        >\r\n                          Quit\r\n                        </button>\r\n                      </>\r\n                    }\r\n                  />\r\n                </div>\r\n                <div\r\n                  ref={(el) => {\r\n                    (contentRef as any).current = el;\r\n                  }}\r\n                  className=\"will-change-transform\"\r\n                  style={\r\n                    fitAll\r\n                      ? {\r\n                          transform: `scale(${fitScale})`,\r\n                          transformOrigin: \"top left\",\r\n                          width: \"100%\",\r\n                          fontSize: `${Math.max(0.8, Math.min(1, fitScale))}em`,\r\n                        }\r\n                      : undefined\r\n                  }\r\n                >\r\n                  <h3 className=\"text-xl font-bold mb-2 mt-1 leading-tight\">\r\n                    {selectedMode === \"X01\" ? \"X01 Match\" : selectedMode}\r\n                  </h3>\r\n                  <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                      Mode: {selectedMode}\r\n                    </span>\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                      Start: {x01Score}\r\n                    </span>\r\n                    <div\r\n                      ref={formatRef}\r\n                      className=\"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10\"\r\n                    >\r\n                      <span>Format:</span>\r\n                      {(() => {\r\n                        const disabled =\r\n                          playerScore !== x01Score ||\r\n                          aiScore !== x01Score ||\r\n                          playerVisitDarts > 0;\r\n                        const pillCls = `px-2 py-0.5 rounded border text-xs ${disabled ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer\"} `;\r\n                        return (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className=\"flex items-center gap-1\">\r\n                              <button\r\n                                type=\"button\"\r\n                                className={`${pillCls} ${formatType === \"first\" ? \"bg-indigo-500/20 text-indigo-100 border-indigo-400/30\" : \"bg-white/10 text-white/80 border-white/20\"}`}\r\n                                onClick={() => {\r\n                                  if (!disabled) setFormatType(\"first\");\r\n                                }}\r\n                                title=\"First to N\"\r\n                              >\r\n                                First to\r\n                              </button>\r\n                              <button\r\n                                type=\"button\"\r\n                                className={`${pillCls} ${formatType === \"best\" ? \"bg-indigo-500/20 text-indigo-100 border-indigo-400/30\" : \"bg-white/10 text-white/80 border-white/20\"}`}\r\n                                onClick={() => {\r\n                                  if (!disabled) setFormatType(\"best\");\r\n                                }}\r\n                                title=\"Best of N (wins = ceil(N/2)\"\r\n                              >\r\n                                Best of\r\n                              </button>\r\n                            </div>\r\n                            <input\r\n                              className={`input w-16 text-center ${disabled ? \"opacity-50\" : \"\"}`}\r\n                              type=\"number\"\r\n                              min={1}\r\n                              step={1}\r\n                              value={formatCount}\r\n                              onChange={(e) =>\r\n                                setFormatCount(\r\n                                  Math.max(\r\n                                    1,\r\n                                    Math.floor(Number(e.target.value) || 1),\r\n                                  ),\r\n                                )\r\n                              }\r\n                              disabled={disabled}\r\n                              title={\r\n                                formatType === \"first\"\r\n                                  ? \"First to N\"\r\n                                  : \"Best of N (wins = ceil(N/2))\"\r\n                              }\r\n                            />\r\n                          </div>\r\n                        );\r\n                      })()}\r\n                    </div>\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                      Legs: {playerLegs}â€“{aiLegs}\r\n                    </span>\r\n                    {/* Move match type and team names to the right of Legs for a single-row header */}\r\n                    <div className=\"ml-auto flex items-center gap-1 text-[10px] flex-wrap\">\r\n                      <span className=\"opacity-70\">Match</span>\r\n                      <select\r\n                        className={`btn ${buttonSizeClass}`}\r\n                        value={matchType}\r\n                        onChange={(e) =>\r\n                          setMatchType(e.target.value as \"singles\" | \"doubles\")\r\n                        }\r\n                      >\r\n                        <option value=\"singles\">Singles</option>\r\n                        <option value=\"doubles\">Doubles</option>\r\n                      </select>\r\n                      <input\r\n                        className={`input ${buttonSizeClass} w-[7.5rem]`}\r\n                        value={teamAName}\r\n                        onChange={(e) => setTeamAName(e.target.value)}\r\n                        placeholder=\"Team A\"\r\n                      />\r\n                      <span className=\"opacity-50\">vs</span>\r\n                      <input\r\n                        className={`input ${buttonSizeClass} w-[7.5rem]`}\r\n                        value={teamBName}\r\n                        onChange={(e) => setTeamBName(e.target.value)}\r\n                        placeholder=\"Team B\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  {selectedMode !== \"X01\" ? (\r\n                    <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2\">\r\n                      {selectedMode === \"Double Practice\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span className=\"opacity-80\">Current Target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                              {DOUBLE_PRACTICE_ORDER[dpIndex]?.label || \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Around the Clock\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span className=\"opacity-80\">Current Target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                              {ATC_ORDER[atcIndex] === 25\r\n                                ? \"25 (Outer Bull)\"\r\n                                : ATC_ORDER[atcIndex] === 50\r\n                                  ? \"50 (Inner Bull)\"\r\n                                  : ATC_ORDER[atcIndex] || \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Cricket\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 mb-1\">\r\n                            Cricket â€” Close 20â€“15 and Bull; overflow scores\r\n                            points\r\n                          </div>\r\n                          <div className=\"grid grid-cols-7 gap-1 text-center text-[11px] mb-2\">\r\n                            {CRICKET_NUMBERS.map((n) => (\r\n                              <div\r\n                                key={n}\r\n                                className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\"\r\n                              >\r\n                                <div className=\"opacity-70\">\r\n                                  {n === 25 ? \"Bull\" : n}\r\n                                </div>\r\n                                <div className=\"font-semibold\">\r\n                                  {Math.min(3, cricket.marks?.[n] || 0)} / 3\r\n                                </div>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Points:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {cricket.points}\r\n                            </span>\r\n                          </div>\r\n                          {cricketClosedAll(cricket) && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setCricket(createCricketState());\r\n                                  setPracticeTurnDarts(0);\r\n                                  resetDartCount(\"Cricket\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Shanghai\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span>Round</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">\r\n                              {shanghai.round}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {shanghai.score}\r\n                          </div>\r\n                          {shanghai.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setShanghai(createShanghaiState());\r\n                                  setPracticeTurnDarts(0);\r\n                                  resetDartCount(\"Shanghai\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Halve It\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span>Stage</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">\r\n                              {halve.stage + 1}/{halve.targets.length}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Target:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {(() => {\r\n                                const t = getCurrentHalveTarget(halve);\r\n                                if (!t) return \"â€”\";\r\n                                if (t.kind === \"ANY_NUMBER\") return \"Any\";\r\n                                if (t.kind === \"BULL\") return \"Bull\";\r\n                                if (\r\n                                  t.kind === \"DOUBLE\" ||\r\n                                  t.kind === \"TRIPLE\" ||\r\n                                  t.kind === \"NUMBER\"\r\n                                )\r\n                                  return `${t.kind} ${(t as any).num}`;\r\n                                return \"â€”\";\r\n                              })()}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {halve.score}\r\n                          </div>\r\n                          {halve.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setHalve(createDefaultHalveIt());\r\n                                  setPracticeTurnDarts(0);\r\n                                  resetDartCount(\"Halve It\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"High-Low\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Round {highlow.round} Â· Target {highlow.target}\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {highlow.score}\r\n                          </div>\r\n                          {highlow.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setHighlow(createHighLow());\r\n                                  setPracticeTurnDarts(0);\r\n                                  resetDartCount(\"High-Low\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Bob's 27\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span>Target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold\">\r\n                              D{b27Stage}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {b27Score}\r\n                          </div>\r\n                          {b27Finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={resetB27}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Count-Up\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Round {cuRound}/8\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {cuScore}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"High Score\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Round {hsRound}/10\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {hsScore}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Low Score\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Round {lsRound}/10\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {lsScore}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Checkout 170\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Remaining\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {co170Rem}\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400 mt-1\">\r\n                            Attempts: {co170Attempts} Â· Successes:{\" \"}\r\n                            {co170Successes}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Checkout 121\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Remaining\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {co121Rem}\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400 mt-1\">\r\n                            Attempts: {co121Attempts} Â· Successes:{\" \"}\r\n                            {co121Successes}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Treble Practice\" && (\r\n                        <>\r\n                          <div className=\"flex items-center justify-between gap-4\">\r\n                            <div>\r\n                              <div className=\"text-xs text-slate-600\">\r\n                                Treble Target: T{trebleTarget}\r\n                              </div>\r\n                              <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                                Hits: {trebleHits}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 flex-wrap\">\r\n                              <label className=\"text-sm\">Target</label>\r\n                              <div className=\"inline-flex items-center gap-1\">\r\n                                {[20, 19, 18].map((n) => (\r\n                                  <button\r\n                                    key={`tpick-header-${n}`}\r\n                                    className={`btn px-2 py-0.5 text-xs ${trebleTarget === n ? \"bg-emerald-600/30 border border-emerald-400/30\" : \"\"}`}\r\n                                    onClick={() => setTrebleTarget(n)}\r\n                                  >\r\n                                    T{n}\r\n                                  </button>\r\n                                ))}\r\n                              </div>\r\n                              <span className=\"opacity-60 text-xs\">or</span>\r\n                              <select\r\n                                className=\"input w-24\"\r\n                                value={trebleTarget}\r\n                                onChange={(e) =>\r\n                                  setTrebleTarget(parseInt(e.target.value, 10))\r\n                                }\r\n                              >\r\n                                {Array.from(\r\n                                  { length: 20 },\r\n                                  (_, i) => i + 1,\r\n                                ).map((n) => (\r\n                                  <option key={n} value={n}>\r\n                                    {n}\r\n                                  </option>\r\n                                ))}\r\n                              </select>\r\n                              <button\r\n                                className=\"btn px-3 py-1 text-sm\"\r\n                                onClick={resetTreble}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Baseball\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Inning</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {baseball.inning}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Score:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {baseball.score}\r\n                            </span>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Golf\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Hole</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {golf.hole}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Strokes:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {golf.strokes}\r\n                            </span>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Tic Tac Toe\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Turn</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {ttt.turn}\r\n                          </div>\r\n                          {ttt.finished && (\r\n                            <div className=\"mt-1 text-xs\">\r\n                              Winner: {ttt.winner || \"â€”\"}\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Scam\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Target</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {SCAM_TARGET_NAMES[scam.targetIndex]}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Progress:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {scam.targetIndex + 1}/{SCAM_TARGET_NAMES.length}\r\n                            </span>\r\n                          </div>\r\n                          {scam.finished && (\r\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\r\n                              ðŸŽ‰ Finished in {scam.darts} darts!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Fives\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Score</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {fives.score}/{fives.target}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Darts:{\" \"}\r\n                            <span className=\"font-semibold\">{fives.darts}</span>\r\n                          </div>\r\n                          {fives.finished && (\r\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\r\n                              âœ“ Reached {fives.target}!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Sevens\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Score</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {sevens.score}/{sevens.target}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Darts:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {sevens.darts}\r\n                            </span>\r\n                          </div>\r\n                          {sevens.finished && (\r\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\r\n                              âœ“ Reached {sevens.target}!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"American Cricket\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 mb-1\">\r\n                            Close 20â€“12 and Bull; overflow scores points\r\n                          </div>\r\n                          <div className=\"grid grid-cols-10 gap-1 text-center text-[11px] mb-2\">\r\n                            {AM_CRICKET_NUMBERS.map((n) => (\r\n                              <div\r\n                                key={n}\r\n                                className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\"\r\n                              >\r\n                                <div className=\"opacity-70\">\r\n                                  {n === 25 ? \"Bull\" : n}\r\n                                </div>\r\n                                <div className=\"font-semibold\">\r\n                                  {Math.min(3, amCricket.marks?.[n] || 0)} / 3\r\n                                </div>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Points:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {amCricket.points}\r\n                            </span>\r\n                          </div>\r\n                          {hasClosedAllAm(amCricket) && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={resetAmCricket}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Killer\" && (\r\n                        <>\r\n                          {!killerSetupDone ? (\r\n                            <div className=\"text-xs text-slate-600\">\r\n                              Setup players and assign numbers\r\n                            </div>\r\n                          ) : (\r\n                            <>\r\n                              <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                                <span>Turn</span>\r\n                                <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                                  {killerPlayers[killerTurnIdx]?.name || \"â€”\"}\r\n                                </span>\r\n                              </div>\r\n                              <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                                {killerWinnerId\r\n                                  ? `${killerPlayers.find((p) => p.id === killerWinnerId)?.name || \"Winner\"} Wins`\r\n                                  : killerLastEvent || \"Ready\"}\r\n                              </div>\r\n                            </>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  ) : offlineLayout === \"modern\" ? (\r\n                    <div className=\"space-y-3 mb-2\">\r\n                      {!manualScoring ? (\r\n                        <>\r\n                          <div className=\"flex items-center flex-wrap gap-1.5 mt-1\">\r\n                            <div className=\"ml-auto flex items-center gap-1 text-[10px]\">\r\n                              <span className=\"opacity-70\">Cam</span>\r\n                              <button\r\n                                className={`btn ${buttonSizeClass}`}\r\n                                onClick={() =>\r\n                                  setCameraScale(\r\n                                    Math.max(\r\n                                      0.5,\r\n                                      Math.round((cameraScale - 0.05) * 100) /\r\n                                        100,\r\n                                    ),\r\n                                  )\r\n                                }\r\n                              >\r\n                                âˆ’\r\n                              </button>\r\n                              <span\r\n                                className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}\r\n                              >\r\n                                {Math.round(cameraScale * 100)}%\r\n                              </span>\r\n                              <button\r\n                                className={`btn ${buttonSizeClass}`}\r\n                                onClick={() =>\r\n                                  setCameraScale(\r\n                                    Math.min(\r\n                                      1.25,\r\n                                      Math.round((cameraScale + 0.05) * 100) /\r\n                                        100,\r\n                                    ),\r\n                                  )\r\n                                }\r\n                              >\r\n                                +\r\n                              </button>\r\n                              <span className=\"opacity-50\">|</span>\r\n                              <button\r\n                                className={`btn ${buttonSizeClass}`}\r\n                                title=\"Toggle fit/fill\"\r\n                                onClick={() =>\r\n                                  setCameraFitMode(\r\n                                    cameraFitMode === \"fill\" ? \"fit\" : \"fill\",\r\n                                  )\r\n                                }\r\n                              >\r\n                                {cameraFitMode === \"fill\" ? \"Fill\" : \"Fit\"}\r\n                              </button>\r\n                              <span className=\"opacity-50\">|</span>\r\n                              <button\r\n                                className={`btn ${buttonSizeClass}`}\r\n                                title=\"Toggle camera aspect\"\r\n                                onClick={() =>\r\n                                  setCameraAspect(\r\n                                    cameraAspect === \"square\"\r\n                                      ? \"wide\"\r\n                                      : \"square\",\r\n                                  )\r\n                                }\r\n                              >\r\n                                {cameraAspect === \"square\" ? \"Square\" : \"Wide\"}\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"relative\">\r\n                            <div className=\"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6\">\r\n                              <div className=\"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]\">\r\n                                <CameraView\r\n                                  scoringMode=\"x01\"\r\n                                  showToolbar={cameraToolbarVisible}\r\n                                  immediateAutoCommit\r\n                                  cameraAutoCommit=\"camera\"\r\n                                  onAutoDart={(value, ring, info) => {\r\n                                    // Camera owns commits for X01; parent should not applyDartValue to avoid duplicates.\r\n                                    // We can optionally log or provide telemetry here.\r\n                                  }}\r\n                                />\r\n                              </div>\r\n\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4\">\r\n                                  <div className=\"space-y-4\">\r\n                                    <div className=\"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\r\n                                      <div className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                        Current Shooter\r\n                                      </div>\r\n                                      <div className=\"mt-1 text-xl font-semibold text-white\">\r\n                                        {activePlayerName}\r\n                                      </div>\r\n                                      <div className=\"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80\">\r\n                                        <div>\r\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\r\n                                            Remaining\r\n                                          </div>\r\n                                          <div className=\"font-mono text-lg text-white\">\r\n                                            {activeRemaining}\r\n                                          </div>\r\n                                        </div>\r\n                                        <div>\r\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\r\n                                            Last Dart\r\n                                          </div>\r\n                                          <div className=\"font-mono text-lg text-white\">\r\n                                            {activeLastScore || 0}\r\n                                          </div>\r\n                                        </div>\r\n                                        <div>\r\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\r\n                                            Match Legs\r\n                                          </div>\r\n                                          <div className=\"font-semibold text-white\">\r\n                                            {playerLegs}-{aiLegs}\r\n                                          </div>\r\n                                        </div>\r\n                                        <div>\r\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\r\n                                            Next Up\r\n                                          </div>\r\n                                          <div className=\"font-medium text-white\">\r\n                                            {inactivePlayerName}\r\n                                          </div>\r\n                                        </div>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n\r\n                                  <div className=\"hidden md:block\">\r\n                                    <GameScoreboard\r\n                                      gameMode={selectedMode as any}\r\n                                      players={singlePlayerScoreboard}\r\n                                      matchScore={`${playerLegs}-${aiLegs}`}\r\n                                    />\r\n                                  </div>\r\n                                </div>\r\n\r\n                                <div className=\"md:hidden\">\r\n                                  <GameScoreboard\r\n                                    gameMode={selectedMode as any}\r\n                                    players={singlePlayerScoreboard}\r\n                                    matchScore={`${playerLegs}-${aiLegs}`}\r\n                                  />\r\n                                </div>\r\n\r\n                                {(selectedMode as any) === \"X01\" && (\r\n                                  <div className=\"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                      Manual Scoreboard Override\r\n                                    </div>\r\n                                    <p className=\"mt-1 text-xs text-white/40\">\r\n                                      Adjust the live totals if a dart was\r\n                                      misread. Values are clamped between 0 and{\" \"}\r\n                                      {x01Score}.\r\n                                    </p>\r\n                                    <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm\">\r\n                                      <div className=\"space-y-3\">\r\n                                        <div className=\"text-sm font-semibold text-white\">\r\n                                          {humanName}\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                            Commit Visit\r\n                                          </label>\r\n                                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                                            <MatchControls\r\n                                              inProgress={true}\r\n                                              startingScore={x01Score}\r\n                                              onAddVisit={makeOfflineAddVisitAdapter(\r\n                                                commitManualVisitTotal,\r\n                                              )}\r\n                                              quickButtons={[180, 140, 100, 60]}\r\n                                              onNextPlayer={() =>\r\n                                                matchActions?.nextPlayer()\r\n                                              }\r\n                                              onEndLeg={() => {\r\n                                                /* End leg handled via commitManualVisitTotal / addVisitTotal */\r\n                                              }}\r\n                                              onUndo={() => {\r\n                                                /* offline undo not implemented here; optionally reset pending visit */\r\n                                              }}\r\n                                              showDartsSelect={true}\r\n                                            />\r\n                                          </div>\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                            Legs Override\r\n                                          </label>\r\n                                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                                            <input\r\n                                              className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                              type=\"number\"\r\n                                              min={0}\r\n                                              value={manualPlayerLegsInput}\r\n                                              onChange={(e) =>\r\n                                                setManualPlayerLegsInput(\r\n                                                  e.target.value,\r\n                                                )\r\n                                              }\r\n                                              onKeyDown={(e) => {\r\n                                                if (e.key === \"Enter\")\r\n                                                  handleManualLegsOverride(\r\n                                                    \"player\",\r\n                                                  );\r\n                                              }}\r\n                                              placeholder={`${playerLegs}`}\r\n                                            />\r\n                                            <button\r\n                                              className=\"btn px-3 py-1 text-sm\"\r\n                                              onClick={() =>\r\n                                                handleManualLegsOverride(\r\n                                                  \"player\",\r\n                                                )\r\n                                              }\r\n                                            >\r\n                                              Set\r\n                                            </button>\r\n                                          </div>\r\n                                        </div>\r\n                                      </div>\r\n                                      <div className=\"space-y-3\">\r\n                                        <div className=\"text-sm font-semibold text-white\">\r\n                                          {aiDisplayName}\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                            Three Dart Edit\r\n                                          </label>\r\n                                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                                            <input\r\n                                              className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                              type=\"number\"\r\n                                              min={0}\r\n                                              max={x01Score}\r\n                                              value={manualOpponentScoreInput}\r\n                                              onChange={(e) =>\r\n                                                setManualOpponentScoreInput(\r\n                                                  e.target.value,\r\n                                                )\r\n                                              }\r\n                                              onKeyDown={(e) => {\r\n                                                if (e.key === \"Enter\")\r\n                                                  handleManualScoreOverride(\r\n                                                    \"ai\",\r\n                                                  );\r\n                                              }}\r\n                                              placeholder={`${aiScore}`}\r\n                                            />\r\n                                            <button\r\n                                              className=\"btn px-3 py-1 text-sm\"\r\n                                              onClick={() =>\r\n                                                handleManualScoreOverride(\"ai\")\r\n                                              }\r\n                                            >\r\n                                              Set\r\n                                            </button>\r\n                                          </div>\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                            Legs Override\r\n                                          </label>\r\n                                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                                            <input\r\n                                              className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                              type=\"number\"\r\n                                              min={0}\r\n                                              value={manualOpponentLegsInput}\r\n                                              onChange={(e) =>\r\n                                                setManualOpponentLegsInput(\r\n                                                  e.target.value,\r\n                                                )\r\n                                              }\r\n                                              onKeyDown={(e) => {\r\n                                                if (e.key === \"Enter\")\r\n                                                  handleManualLegsOverride(\r\n                                                    \"ai\",\r\n                                                  );\r\n                                              }}\r\n                                              placeholder={`${aiLegs}`}\r\n                                            />\r\n                                            <button\r\n                                              className=\"btn px-3 py-1 text-sm\"\r\n                                              onClick={() =>\r\n                                                handleManualLegsOverride(\"ai\")\r\n                                              }\r\n                                            >\r\n                                              Set\r\n                                            </button>\r\n                                          </div>\r\n                                        </div>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </>\r\n                      ) : (\r\n                        <div className=\"card\">\r\n                          <div className=\"text-sm font-semibold mb-1\">\r\n                            Manual scoring active\r\n                          </div>\r\n                          <div className=\"text-xs opacity-70\">\r\n                            Camera previews are disabled. Use the manual entry\r\n                            controls below to record your turn.\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0\">\r\n                      <div className=\"flex items-stretch justify-center md:px-3 min-w-0\">\r\n                        <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span className=\"opacity-80\">You Remain</span>\r\n                            {isPlayerTurn ? (\r\n                              <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                                THROWING\r\n                              </span>\r\n                            ) : (\r\n                              <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">\r\n                                WAITING TO THROW\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {playerScore}\r\n                          </div>\r\n                          <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                            <div\r\n                              className=\"h-full bg-emerald-400/70\"\r\n                              style={{\r\n                                width: `${Math.max(0, Math.min(100, (1 - playerScore / x01Score) * 100))}%`,\r\n                              }}\r\n                            />\r\n                          </div>\r\n                          <div className=\"text-sm mt-1 opacity-90\">\r\n                            Last dart:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {playerLastDart}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm opacity-90\">\r\n                            Last score:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {playerVisitDarts > 0\r\n                                ? playerVisitSum\r\n                                : (playerLastVisitScore ?? playerLastDart)}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm opacity-90\">\r\n                            3-Dart Avg:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {totalPlayerDarts > 0\r\n                                ? (\r\n                                    (totalPlayerPoints / totalPlayerDarts) *\r\n                                    3\r\n                                  ).toFixed(1)\r\n                                : \"0.0\"}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-xs opacity-70 flex items-center gap-2\">\r\n                            <span>Darts thrown: {playerDartsThrown}</span>\r\n                            <span\r\n                              className=\"inline-flex items-center gap-1\"\r\n                              aria-label=\"Visit darts\"\r\n                            >\r\n                              {[0, 1, 2].map((i) => (\r\n                                <span\r\n                                  key={i}\r\n                                  className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? \"bg-emerald-400\" : \"bg-white/20\"}`}\r\n                                ></span>\r\n                              ))}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-xs opacity-80 mt-1\">\r\n                            Doubles:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              Att {playerDoublesAtt} Â· Hit {playerDoublesHit}\r\n                            </span>\r\n                          </div>\r\n                          {playerScore <= 170 &&\r\n                            playerScore > 0 &&\r\n                            (() => {\r\n                              const sugs = suggestCheckouts(\r\n                                playerScore,\r\n                                favoriteDouble,\r\n                              );\r\n                              const first = sugs[0] || \"â€”\";\r\n                              return (\r\n                                <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\r\n                                  <span className=\"opacity-70\">Checkout</span>\r\n                                  <span className=\"font-semibold\">{first}</span>\r\n                                </div>\r\n                              );\r\n                            })()}\r\n                        </div>\r\n                        {/* Center camera preview: right-aligned and square when selected */}\r\n                        <div className=\"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall\">\r\n                          <ResizablePanel\r\n                            storageKey=\"ndn:camera:tile:offline:center:v4\"\r\n                            className=\"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card\"\r\n                            defaultWidth={0}\r\n                            defaultHeight={0}\r\n                            minWidth={300}\r\n                            minHeight={300}\r\n                            maxWidth={2000}\r\n                            maxHeight={1200}\r\n                            autoFill\r\n                          >\r\n                            <CameraTile\r\n                              label=\"Your Board\"\r\n                              autoStart={true}\r\n                              className=\"min-w-0 h-full\"\r\n                              aspect=\"classic\"\r\n                              fill\r\n                            />\r\n                          </ResizablePanel>\r\n                        </div>\r\n                        {/* Match summary (offline) */}\r\n                        <div\r\n                          className={`mt-2 ${boxSize === \"small\" ? \"p-2\" : boxSize === \"large\" ? \"p-4\" : \"p-3\"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === \"small\" ? \"text-xs\" : textSize === \"large\" ? \"text-base\" : \"text-sm\"}`}\r\n                        >\r\n                          <div className=\"font-semibold mb-2\">\r\n                            Match Summary\r\n                          </div>\r\n                          {(() => {\r\n                            // In offline X01, player is vs AI or practice\r\n                            const currentThrower = isPlayerTurn\r\n                              ? user?.username || \"You\"\r\n                              : ai === \"None\"\r\n                                ? \"â€”\"\r\n                                : `${ai} AI`;\r\n                            const currentRemaining = isPlayerTurn\r\n                              ? playerScore\r\n                              : ai === \"None\"\r\n                                ? 0\r\n                                : aiScore;\r\n                            const lastScoreDisplay = isPlayerTurn\r\n                              ? playerVisitDarts > 0\r\n                                ? playerVisitSum\r\n                                : (playerLastVisitScore ?? playerLastDart)\r\n                              : aiVisitDarts > 0\r\n                                ? aiVisitSum\r\n                                : (aiLastVisitScore ?? aiLastDart);\r\n                            const dartsThrown = isPlayerTurn\r\n                              ? playerDartsThrown\r\n                              : aiDartsThrown;\r\n                            const scored =\r\n                              x01Score -\r\n                              (isPlayerTurn\r\n                                ? playerScore\r\n                                : ai === \"None\"\r\n                                  ? x01Score\r\n                                  : aiScore);\r\n                            const avg3 =\r\n                              dartsThrown > 0 ? (scored / dartsThrown) * 3 : 0;\r\n                            const matchScore = `${playerLegs}-${aiLegs}`;\r\n                            const bestLegText =\r\n                              legStats.length > 0\r\n                                ? `${Math.min(...legStats.map((l) => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\r\n                                : \"â€”\";\r\n                            return (\r\n                              <div className=\"grid grid-cols-2 gap-y-1\">\r\n                                <div className=\"opacity-80\">Current score</div>\r\n                                <div className=\"font-mono text-right\">\r\n                                  {matchScore}\r\n                                </div>\r\n                                <div className=\"opacity-80\">\r\n                                  Current thrower\r\n                                </div>\r\n                                <div className=\"text-right font-semibold text-lg\">\r\n                                  {currentThrower}\r\n                                </div>\r\n                                <div className=\"opacity-80\">\r\n                                  Score remaining\r\n                                </div>\r\n                                <div className=\"text-right font-mono font-bold text-xl\">\r\n                                  {currentRemaining}\r\n                                </div>\r\n                                <div className=\"opacity-80\">3-dart avg</div>\r\n                                <div className=\"text-right font-mono\">\r\n                                  {avg3.toFixed(1)}\r\n                                </div>\r\n                                <div className=\"opacity-80\">Last score</div>\r\n                                <div className=\"text-right font-mono\">\r\n                                  {lastScoreDisplay}\r\n                                </div>\r\n                                <div className=\"opacity-80\">Best leg</div>\r\n                                <div className=\"text-right\">{bestLegText}</div>\r\n                              </div>\r\n                            );\r\n                          })()}\r\n                        </div>\r\n                        <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                          <div className=\"text-xs flex items-center justify-between opacity-80\">\r\n                            <span>\r\n                              {ai === \"None\" ? \"Opponent\" : `${ai} AI`} Remain\r\n                            </span>\r\n                            {!isPlayerTurn ? (\r\n                              <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                                THROWING\r\n                              </span>\r\n                            ) : (\r\n                              <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">\r\n                                WAITING TO THROW\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {ai !== \"None\" ? aiScore : \"N/A\"}\r\n                          </div>\r\n                          {ai !== \"None\" && (\r\n                            <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                              <div\r\n                                className=\"h-full bg-fuchsia-400/70\"\r\n                                style={{\r\n                                  width: `${Math.max(0, Math.min(100, (1 - aiScore / x01Score) * 100))}%`,\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"text-sm mt-1 opacity-90\">\r\n                            Last dart:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {ai === \"None\" ? 0 : aiLastDart}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm opacity-90\">\r\n                            Last score:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {ai === \"None\"\r\n                                ? \"â€”\"\r\n                                : aiVisitDarts > 0\r\n                                  ? aiVisitSum\r\n                                  : (aiLastVisitScore ?? aiLastDart)}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm opacity-90\">\r\n                            3-Dart Avg:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {ai !== \"None\"\r\n                                ? totalAiDarts > 0\r\n                                  ? (\r\n                                      (totalAiPoints / totalAiDarts) *\r\n                                      3\r\n                                    ).toFixed(1)\r\n                                  : \"0.0\"\r\n                                : \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {ai !== \"None\" && (\r\n                            <div className=\"text-xs opacity-70\">\r\n                              Darts thrown: {aiDartsThrown}\r\n                            </div>\r\n                          )}\r\n                          {ai !== \"None\" && (\r\n                            <div className=\"text-xs opacity-80 mt-1\">\r\n                              Doubles:{\" \"}\r\n                              <span className=\"font-semibold\">\r\n                                Att {aiDoublesAtt} Â· Hit {aiDoublesHit}\r\n                              </span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  {/* Turn area */}\r\n                  {selectedMode !== \"X01\" ? (\r\n                    <div className=\"space-y-2\">\r\n                      {selectedMode === \"Double Practice\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Target:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {DOUBLE_PRACTICE_ORDER[dpIndex]?.label || \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                onAutoDart={(value, ring) => {\r\n                                  if (\r\n                                    ring === \"DOUBLE\" ||\r\n                                    ring === \"INNER_BULL\"\r\n                                  ) {\r\n                                    const hit = isDoubleHit(value, dpIndex);\r\n                                    if (hit) {\r\n                                      const nh = dpHits + 1;\r\n                                      const ni = dpIndex + 1;\r\n                                      setDpHits(nh);\r\n                                      setDpIndex(ni);\r\n                                      if (nh >= DOUBLE_PRACTICE_ORDER.length)\r\n                                        setTimeout(() => {\r\n                                          setDpHits(0);\r\n                                          setDpIndex(0);\r\n                                        }, 250);\r\n                                      return true;\r\n                                    }\r\n                                  }\r\n                                  return false;\r\n                                }}\r\n                                immediateAutoCommit\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-col gap-2\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <input\r\n                                className=\"input w-24\"\r\n                                type=\"number\"\r\n                                min={0}\r\n                                max={60}\r\n                                value={playerDartPoints}\r\n                                onChange={(e) =>\r\n                                  setPlayerDartPoints(\r\n                                    Number(e.target.value || 0),\r\n                                  )\r\n                                }\r\n                                onKeyDown={(e) => {\r\n                                  if (e.key === \"Enter\") addDpNumeric();\r\n                                }}\r\n                              />\r\n                              <button\r\n                                className=\"btn px-3 py-1 text-sm\"\r\n                                onClick={addDpNumeric}\r\n                              >\r\n                                Add Dart\r\n                              </button>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <input\r\n                                className=\"input w-44\"\r\n                                placeholder=\"Manual (D16, 50, 25, T20)\"\r\n                                value={manualBox}\r\n                                onChange={(e) => setManualBox(e.target.value)}\r\n                                onKeyDown={(e) => {\r\n                                  if (e.key === \"Enter\") addDpManual();\r\n                                }}\r\n                              />\r\n                              <button\r\n                                className=\"btn px-3 py-1 text-sm\"\r\n                                onClick={addDpManual}\r\n                              >\r\n                                Add\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-300\">\r\n                            Progress: {dpHits} of 21\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Around the Clock\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Target:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {ATC_ORDER[atcIndex] === 25\r\n                                ? \"25 (Outer Bull)\"\r\n                                : ATC_ORDER[atcIndex] === 50\r\n                                  ? \"50 (Inner Bull)\"\r\n                                  : ATC_ORDER[atcIndex] || \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addAtcValue(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addAtcNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addAtcNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-44\"\r\n                              placeholder=\"Manual (T20, D5, 25, 50)\"\r\n                              value={manualBox}\r\n                              onChange={(e) => setManualBox(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addAtcManual();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addAtcManual}\r\n                            >\r\n                              Add\r\n                            </button>\r\n                          </div>\r\n                          {atcHits >= ATC_ORDER.length && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setAtcHits(0);\r\n                                  setAtcIndex(0);\r\n                                  resetDartCount(\"Around the Clock\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Cricket\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addCricketAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addCricketNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addCricketNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setCricket(createCricketState());\r\n                                setPracticeTurnDarts(0);\r\n                                resetDartCount(\"Cricket\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Shanghai\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addShanghaiAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addShanghaiNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addShanghaiNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setShanghai(createShanghaiState());\r\n                                setPracticeTurnDarts(0);\r\n                                resetDartCount(\"Shanghai\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Halve It\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addHalveAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addHalveNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addHalveNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setHalve(createDefaultHalveIt());\r\n                                setPracticeTurnDarts(0);\r\n                                resetDartCount(\"Halve It\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"High-Low\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addHighLowAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addHighLowNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addHighLowNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setHighlow(createHighLow());\r\n                                setPracticeTurnDarts(0);\r\n                                resetDartCount(\"High-Low\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Bob's 27\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addB27Auto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addB27Numeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addB27Numeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetB27}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Count-Up\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value) => addCountUpAuto(value)}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  addCountUpAuto(playerDartPoints);\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                addCountUpAuto(playerDartPoints);\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setCuRound(1);\r\n                                setCuScore(0);\r\n                                setCuDarts(0);\r\n                                resetDartCount(\"Count-Up\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Round {cuRound}/{cuMaxRounds}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"High Score\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value) => addHighScoreAuto(value)}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  addHighScoreAuto(playerDartPoints);\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                addHighScoreAuto(playerDartPoints);\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setHsRound(1);\r\n                                setHsScore(0);\r\n                                setHsDarts(0);\r\n                                resetDartCount(\"High Score\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Round {hsRound}/{hsMaxRounds}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Low Score\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value) => addLowScoreAuto(value)}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  addLowScoreAuto(playerDartPoints);\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                addLowScoreAuto(playerDartPoints);\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setLsRound(1);\r\n                                setLsScore(0);\r\n                                setLsDarts(0);\r\n                                resetDartCount(\"Low Score\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Round {lsRound}/{lsMaxRounds}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Checkout 170\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring) =>\r\n                                  addCo170Auto(\r\n                                    value,\r\n                                    ring === \"MISS\" ? undefined : ring,\r\n                                  )\r\n                                }\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"text\"\r\n                              placeholder=\"Manual (D16, T20)\"\r\n                              value={manualBox}\r\n                              onChange={(e) => setManualBox(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addCoManual(true);\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => addCoManual(true)}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetCo170}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Remaining: {co170Rem} Â· Attempts: {co170Attempts} Â·\r\n                            Successes: {co170Successes}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Checkout 121\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring) =>\r\n                                  addCo121Auto(\r\n                                    value,\r\n                                    ring === \"MISS\" ? undefined : ring,\r\n                                  )\r\n                                }\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"text\"\r\n                              placeholder=\"Manual (D16, T20)\"\r\n                              value={manualBox}\r\n                              onChange={(e) => setManualBox(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addCoManual(false);\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => addCoManual(false)}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetCo121}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Remaining: {co121Rem} Â· Attempts: {co121Attempts} Â·\r\n                            Successes: {co121Successes}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Treble Practice\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addTrebleAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"text\"\r\n                              placeholder=\"Manual (T20)\"\r\n                              value={manualBox}\r\n                              onChange={(e) => setManualBox(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  const v = parseManualDart(manualBox);\r\n                                  if (v != null)\r\n                                    addTrebleAuto(v, undefined, undefined);\r\n                                  setManualBox(\"\");\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                const v = parseManualDart(manualBox);\r\n                                if (v != null)\r\n                                  addTrebleAuto(v, undefined, undefined);\r\n                                setManualBox(\"\");\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Hits: {trebleHits} Â· Misses:{\" \"}\r\n                            {Math.max(0, trebleDarts - trebleHits)} Â· Darts:{\" \"}\r\n                            {trebleDarts}\r\n                            {trebleMaxDarts > 0 ? `/${trebleMaxDarts}` : \"\"}\r\n                          </div>\r\n                          {trebleFinished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={resetTreble}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Baseball\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addBaseballAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetBaseball}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Golf\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addGolfAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetGolf}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Tic Tac Toe\" && (\r\n                        <>\r\n                          <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                            {Array.from({ length: 9 }, (_, i) => i).map(\r\n                              (cell) => (\r\n                                <button\r\n                                  key={cell}\r\n                                  className={`h-16 rounded-xl border ${ttt.board[cell] ? \"bg-emerald-500/20 border-emerald-400/30\" : \"bg-slate-800/50 border-slate-700/50\"}`}\r\n                                  onClick={() => {\r\n                                    if (ttt.finished || ttt.board[cell]) return;\r\n                                    // One-tap claim attempt using autoscore last dart; fallback: prompt numeric\r\n                                    // For simplicity here, we use a no-op value and rely on next autoscore dart; as a usable fallback, open a numeric prompt\r\n                                    const promptVal = Number(\r\n                                      prompt(\r\n                                        \"Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)\",\r\n                                      ) || 0,\r\n                                    );\r\n                                    const ring =\r\n                                      promptVal % 3 === 0\r\n                                        ? \"TRIPLE\"\r\n                                        : promptVal % 2 === 0\r\n                                          ? \"DOUBLE\"\r\n                                          : \"SINGLE\";\r\n                                    const tcell = cell as unknown as\r\n                                      | 0\r\n                                      | 1\r\n                                      | 2\r\n                                      | 3\r\n                                      | 4\r\n                                      | 5\r\n                                      | 6\r\n                                      | 7\r\n                                      | 8;\r\n                                    const tgt = TTT_TARGETS[tcell];\r\n                                    const num =\r\n                                      tgt.type === \"BULL\"\r\n                                        ? null\r\n                                        : tgt.num || null;\r\n                                    addTttAuto(\r\n                                      tcell,\r\n                                      promptVal,\r\n                                      ring as any,\r\n                                      num as any,\r\n                                    );\r\n                                  }}\r\n                                >\r\n                                  {ttt.board[cell] || \"\"}\r\n                                </button>\r\n                              ),\r\n                            )}\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) => {\r\n                                  // Attempt to claim the currently tapped-looking cell not tracked; as a simple flow, map by round-robin preference or let user click a cell button above.\r\n                                  // No-op here; primary interaction is via buttons with prompt for now.\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetTtt}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"American Cricket\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addAmCricketAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetAmCricket}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Scam\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Target:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {SCAM_TARGET_NAMES[scamPlayer.targetIndex]}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) => {\r\n                                  const r = ring === \"MISS\" ? undefined : ring;\r\n                                  recordDart(\"Scam\");\r\n                                  setScamPlayer(\r\n                                    addScamAuto(scamPlayer, value, r as any),\r\n                                  );\r\n                                  return true;\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={1}\r\n                              max={25}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  recordDart(\"Scam\");\r\n                                  setScamPlayer(\r\n                                    addScamNumeric(\r\n                                      scamPlayer,\r\n                                      playerDartPoints,\r\n                                    ),\r\n                                  );\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                recordDart(\"Scam\");\r\n                                setScamPlayer(\r\n                                  addScamNumeric(scamPlayer, playerDartPoints),\r\n                                );\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setScamPlayer(resetScam());\r\n                                resetDartCount(\"Scam\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          {scamPlayer.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              ðŸŽ‰ Finished in {scamPlayer.darts} darts!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Fives\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Score:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {fivesPlayer.score}/{fivesPlayer.target}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) => {\r\n                                  recordDart(\"Fives\");\r\n                                  setFivesPlayer(\r\n                                    addFivesAuto(fivesPlayer, value, ring as any),\r\n                                  );\r\n                                  return true;\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={5}\r\n                              max={50}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  recordDart(\"Fives\");\r\n                                  setFivesPlayer(\r\n                                    addFivesNumeric(\r\n                                      fivesPlayer,\r\n                                      playerDartPoints,\r\n                                    ),\r\n                                  );\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                recordDart(\"Fives\");\r\n                                setFivesPlayer(\r\n                                  addFivesNumeric(\r\n                                    fivesPlayer,\r\n                                    playerDartPoints,\r\n                                  ),\r\n                                );\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setFivesPlayer(resetFives(fivesPlayer.target));\r\n                                resetDartCount(\"Fives\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:{\" \"}\r\n                            {fivesPlayer.darts}\r\n                          </div>\r\n                          {fivesPlayer.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              âœ“ Reached {fivesPlayer.target} in{\" \"}\r\n                              {fivesPlayer.darts} darts!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Sevens\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Score:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {sevensPlayer.score}/{sevensPlayer.target}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) => {\r\n                                  recordDart(\"Sevens\");\r\n                                  setSevensPlayer(\r\n                                    addSevensAuto(sevensPlayer, value, ring as any),\r\n                                  );\r\n                                  return true;\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={7}\r\n                              max={21}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  recordDart(\"Sevens\");\r\n                                  setSevensPlayer(\r\n                                    addSevensNumeric(\r\n                                      sevensPlayer,\r\n                                      playerDartPoints,\r\n                                    ),\r\n                                  );\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                recordDart(\"Sevens\");\r\n                                setSevensPlayer(\r\n                                  addSevensNumeric(\r\n                                    sevensPlayer,\r\n                                    playerDartPoints,\r\n                                  ),\r\n                                );\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setSevensPlayer(\r\n                                  resetSevens(sevensPlayer.target),\r\n                                );\r\n                                resetDartCount(\"Sevens\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Valid scores: 7, 14, 21 Â· Darts:{\" \"}\r\n                            {sevensPlayer.darts}\r\n                          </div>\r\n                          {sevensPlayer.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              âœ“ Reached {sevensPlayer.target} in{\" \"}\r\n                              {sevensPlayer.darts} darts!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Killer\" && (\r\n                        <>\r\n                          {!killerSetupDone ? (\r\n                            <div className=\"space-y-2\">\r\n                              <div className=\"font-semibold\">Players</div>\r\n                              <div className=\"space-y-1\">\r\n                                {killerPlayers.map((p, idx) => (\r\n                                  <div\r\n                                    key={p.id}\r\n                                    className=\"flex items-center gap-2\"\r\n                                  >\r\n                                    <input\r\n                                      className=\"input\"\r\n                                      value={p.name}\r\n                                      onChange={(e) => {\r\n                                        const name = e.target.value;\r\n                                        setKillerPlayers((list) =>\r\n                                          list.map((it, i) =>\r\n                                            i === idx ? { ...it, name } : it,\r\n                                          ),\r\n                                        );\r\n                                      }}\r\n                                    />\r\n                                    <button\r\n                                      className=\"btn px-2 py-1\"\r\n                                      onClick={() =>\r\n                                        setKillerPlayers((list) =>\r\n                                          list.filter((_, i) => i !== idx),\r\n                                        )\r\n                                      }\r\n                                      disabled={killerPlayers.length <= 2}\r\n                                    >\r\n                                      Remove\r\n                                    </button>\r\n                                  </div>\r\n                                ))}\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <button\r\n                                  className=\"btn px-2 py-1\"\r\n                                  onClick={() =>\r\n                                    setKillerPlayers((list) => {\r\n                                      const id = `p${list.length + 1}`;\r\n                                      return [\r\n                                        ...list,\r\n                                        {\r\n                                          id,\r\n                                          name: `Player ${list.length + 1}`,\r\n                                        },\r\n                                      ];\r\n                                    })\r\n                                  }\r\n                                >\r\n                                  Add Player\r\n                                </button>\r\n                                <button\r\n                                  className=\"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1\"\r\n                                  onClick={() => {\r\n                                    if (killerPlayers.length < 2) {\r\n                                      alert(\"Need at least 2 players\");\r\n                                      return;\r\n                                    }\r\n                                    const ids = killerPlayers.map((p) => p.id);\r\n                                    const assigned = assignKillerNumbers(ids);\r\n                                    const initStates: Record<\r\n                                      string,\r\n                                      KillerState\r\n                                    > = {};\r\n                                    ids.forEach((id) => {\r\n                                      initStates[id] = createKillerState(\r\n                                        assigned[id],\r\n                                      );\r\n                                    });\r\n                                    setKillerAssigned(assigned);\r\n                                    setKillerStates(initStates);\r\n                                    setKillerTurnIdx(0);\r\n                                    setKillerDarts(0);\r\n                                    setKillerWinnerId(null);\r\n                                    setKillerLastEvent(\"Assigned numbers\");\r\n                                    setKillerSetupDone(true);\r\n                                  }}\r\n                                >\r\n                                  Assign Numbers & Start\r\n                                </button>\r\n                              </div>\r\n                            </div>\r\n                          ) : (\r\n                            <div className=\"space-y-3\">\r\n                              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                                {killerPlayers.map((p) => {\r\n                                  const st = killerStates[p.id];\r\n                                  const num = killerAssigned[p.id];\r\n                                  return (\r\n                                    <div\r\n                                      key={p.id}\r\n                                      className={`p-2 rounded-xl border ${st?.eliminated ? \"opacity-50 border-red-500/40 bg-red-500/10\" : \"border-slate-700/50 bg-slate-800/50\"}`}\r\n                                    >\r\n                                      <div className=\"flex items-center justify-between text-xs\">\r\n                                        <div className=\"font-semibold\">\r\n                                          {p.name}\r\n                                        </div>\r\n                                        <div\r\n                                          className={`text-[10px] px-1.5 py-0.5 rounded ${st?.isKiller ? \"bg-purple-500/20 text-purple-200 border border-purple-400/30\" : \"bg-slate-600/30 text-slate-300\"}`}\r\n                                        >\r\n                                          {st?.isKiller\r\n                                            ? \"Killer\"\r\n                                            : \"Not Killer\"}\r\n                                        </div>\r\n                                      </div>\r\n                                      <div className=\"mt-1 text-sm\">\r\n                                        Number:{\" \"}\r\n                                        <span className=\"font-semibold\">\r\n                                          {num}\r\n                                        </span>\r\n                                      </div>\r\n                                      <div className=\"text-sm\">\r\n                                        Lives:{\" \"}\r\n                                        <span className=\"font-semibold\">\r\n                                          {st?.lives ?? 0}\r\n                                        </span>\r\n                                      </div>\r\n                                    </div>\r\n                                  );\r\n                                })}\r\n                              </div>\r\n                              {cameraEnabled && (\r\n                                <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                                  <CameraView\r\n                                    scoringMode=\"custom\"\r\n                                    showToolbar={cameraToolbarVisible}\r\n                                    immediateAutoCommit\r\n                                    onAutoDart={(value, ring, info) => {\r\n                                      if (killerWinnerId) return false;\r\n                                      const r =\r\n                                        ring === \"MISS\" ? undefined : ring;\r\n                                      const sector = info?.sector ?? null;\r\n                                      const cur = killerPlayers[killerTurnIdx];\r\n                                      if (!cur) return false;\r\n                                      setKillerStates((prev) => {\r\n                                        const copy: Record<\r\n                                          string,\r\n                                          KillerState\r\n                                        > = {};\r\n                                        Object.keys(prev).forEach(\r\n                                          (k) => (copy[k] = { ...prev[k] }),\r\n                                        );\r\n                                        const res = applyKillerDart(\r\n                                          cur.id,\r\n                                          copy,\r\n                                          r as any,\r\n                                          sector,\r\n                                        );\r\n                                        if (res.becameKiller)\r\n                                          setKillerLastEvent(\r\n                                            `${cur.name} became a Killer`,\r\n                                          );\r\n                                        else if (res.victimId) {\r\n                                          const v = killerPlayers.find(\r\n                                            (p) => p.id === res.victimId,\r\n                                          );\r\n                                          setKillerLastEvent(\r\n                                            `${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved || 0) > 1 ? \"s\" : \"\"})`,\r\n                                          );\r\n                                        } else setKillerLastEvent(\"No effect\");\r\n                                        // Check winner\r\n                                        const win = killerWinner(copy);\r\n                                        if (win) setKillerWinnerId(win);\r\n                                        return copy;\r\n                                      });\r\n                                      setKillerDarts((d) => {\r\n                                        const nd = d + 1;\r\n                                        if (nd >= 3) {\r\n                                          // advance to next alive\r\n                                          let next = killerTurnIdx;\r\n                                          for (\r\n                                            let i = 1;\r\n                                            i <= killerPlayers.length;\r\n                                            i++\r\n                                          ) {\r\n                                            const idx =\r\n                                              (killerTurnIdx + i) %\r\n                                              killerPlayers.length;\r\n                                            const pid = killerPlayers[idx].id;\r\n                                            const st = killerStates[pid];\r\n                                            if (\r\n                                              st &&\r\n                                              !st.eliminated &&\r\n                                              st.lives > 0\r\n                                            ) {\r\n                                              next = idx;\r\n                                              break;\r\n                                            }\r\n                                          }\r\n                                          setKillerTurnIdx(next);\r\n                                          return 0;\r\n                                        }\r\n                                        return nd;\r\n                                      });\r\n                                      return true;\r\n                                    }}\r\n                                  />\r\n                                </div>\r\n                              )}\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <input\r\n                                  className=\"input w-40\"\r\n                                  placeholder=\"Manual (D16, T5)\"\r\n                                  value={manualBox}\r\n                                  onChange={(e) => setManualBox(e.target.value)}\r\n                                  onKeyDown={(e) => {\r\n                                    if (e.key === \"Enter\") {\r\n                                      if (killerWinnerId) return;\r\n                                      const t = manualBox.trim().toUpperCase();\r\n                                      const m = t.match(\r\n                                        /^(S|D|T)?\\s*(\\d{1,2})$/,\r\n                                      );\r\n                                      if (!m) {\r\n                                        setManualBox(\"\");\r\n                                        return;\r\n                                      }\r\n                                      const mult = (m[1] || \"S\") as\r\n                                        | \"S\"\r\n                                        | \"D\"\r\n                                        | \"T\";\r\n                                      const num = parseInt(m[2], 10);\r\n                                      const ring =\r\n                                        mult === \"D\"\r\n                                          ? \"DOUBLE\"\r\n                                          : mult === \"T\"\r\n                                            ? \"TRIPLE\"\r\n                                            : \"SINGLE\";\r\n                                      const cur = killerPlayers[killerTurnIdx];\r\n                                      setKillerStates((prev) => {\r\n                                        const copy: Record<\r\n                                          string,\r\n                                          KillerState\r\n                                        > = {};\r\n                                        Object.keys(prev).forEach(\r\n                                          (k) => (copy[k] = { ...prev[k] }),\r\n                                        );\r\n                                        const res = applyKillerDart(\r\n                                          cur.id,\r\n                                          copy,\r\n                                          ring as any,\r\n                                          num,\r\n                                        );\r\n                                        if (res.becameKiller)\r\n                                          setKillerLastEvent(\r\n                                            `${cur.name} became a Killer`,\r\n                                          );\r\n                                        else if (res.victimId) {\r\n                                          const v = killerPlayers.find(\r\n                                            (p) => p.id === res.victimId,\r\n                                          );\r\n                                          setKillerLastEvent(\r\n                                            `${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved || 0) > 1 ? \"s\" : \"\"})`,\r\n                                          );\r\n                                        } else setKillerLastEvent(\"No effect\");\r\n                                        const win = killerWinner(copy);\r\n                                        if (win) setKillerWinnerId(win);\r\n                                        return copy;\r\n                                      });\r\n                                      setManualBox(\"\");\r\n                                      setKillerDarts((d) => {\r\n                                        const nd = d + 1;\r\n                                        if (nd >= 3) {\r\n                                          let next = killerTurnIdx;\r\n                                          for (\r\n                                            let i = 1;\r\n                                            i <= killerPlayers.length;\r\n                                            i++\r\n                                          ) {\r\n                                            const idx =\r\n                                              (killerTurnIdx + i) %\r\n                                              killerPlayers.length;\r\n                                            const pid = killerPlayers[idx].id;\r\n                                            const st = killerStates[pid];\r\n                                            if (\r\n                                              st &&\r\n                                              !st.eliminated &&\r\n                                              st.lives > 0\r\n                                            ) {\r\n                                              next = idx;\r\n                                              break;\r\n                                            }\r\n                                          }\r\n                                          setKillerTurnIdx(next);\r\n                                          return 0;\r\n                                        }\r\n                                        return nd;\r\n                                      });\r\n                                    }\r\n                                  }}\r\n                                />\r\n                                <button\r\n                                  className=\"btn px-3 py-1 text-sm\"\r\n                                  onClick={() => {\r\n                                    // Skip to next alive player\r\n                                    let next = killerTurnIdx;\r\n                                    for (\r\n                                      let i = 1;\r\n                                      i <= killerPlayers.length;\r\n                                      i++\r\n                                    ) {\r\n                                      const idx =\r\n                                        (killerTurnIdx + i) %\r\n                                        killerPlayers.length;\r\n                                      const pid = killerPlayers[idx].id;\r\n                                      const st = killerStates[pid];\r\n                                      if (\r\n                                        st &&\r\n                                        !st.eliminated &&\r\n                                        st.lives > 0\r\n                                      ) {\r\n                                        next = idx;\r\n                                        break;\r\n                                      }\r\n                                    }\r\n                                    setKillerTurnIdx(next);\r\n                                    setKillerDarts(0);\r\n                                  }}\r\n                                >\r\n                                  Next Player\r\n                                </button>\r\n                                <button\r\n                                  className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                                  onClick={() => {\r\n                                    // Reset Killer\r\n                                    setKillerStates({});\r\n                                    setKillerAssigned({});\r\n                                    setKillerSetupDone(false);\r\n                                    setKillerTurnIdx(0);\r\n                                    setKillerDarts(0);\r\n                                    setKillerWinnerId(null);\r\n                                    setKillerLastEvent(\"\");\r\n                                  }}\r\n                                >\r\n                                  Reset\r\n                                </button>\r\n                              </div>\r\n                              {killerWinnerId && (\r\n                                <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                                  Winner:{\" \"}\r\n                                  {\r\n                                    killerPlayers.find(\r\n                                      (p) => p.id === killerWinnerId,\r\n                                    )?.name\r\n                                  }{\" \"}\r\n                                  <button\r\n                                    className=\"ml-2 underline\"\r\n                                    onClick={() => {\r\n                                      setKillerStates({});\r\n                                      setKillerAssigned({});\r\n                                      setKillerSetupDone(false);\r\n                                      setKillerTurnIdx(0);\r\n                                      setKillerDarts(0);\r\n                                      setKillerWinnerId(null);\r\n                                      setKillerLastEvent(\"\");\r\n                                    }}\r\n                                  >\r\n                                    Play Again\r\n                                  </button>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-2\">\r\n                      {/* Scorecard + Camera split (Option A): Scoreboard LEFT, Camera RIGHT */}\r\n                      <div className=\"flex gap-3 min-h-0 flex-1 text-[14px]\">\r\n                        {/* Left column: Scoreboard + Manual Scoring (50% width) */}\r\n                        <div className=\"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm\">\r\n                          <div className=\"text-sm font-semibold opacity-80\">\r\n                            Scoreboard\r\n                          </div>\r\n                          {/* Scoreboard */}\r\n                          <div className=\"flex-shrink-0\">\r\n                            <GameScoreboard\r\n                              gameMode={selectedMode as any}\r\n                              players={statsX01}\r\n                              matchScore={`${playerLegs}-${aiLegs}`}\r\n                            />\r\n                          </div>\r\n\r\n                          {/* Manual Scoring Section */}\r\n                          {isPlayerTurn && (\r\n                            <div className=\"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0\">\r\n                              <div className=\"flex flex-wrap items-center justify-between gap-3\">\r\n                                <h4 className=\"text-sm font-semibold tracking-wide uppercase text-indigo-200\">\r\n                                  Manual Scoring\r\n                                </h4>\r\n                                <span className=\"text-xs text-white/60\">\r\n                                  Override a visit or enter dart-by-dart scores.\r\n                                </span>\r\n                              </div>\r\n                              <div className=\"mt-3 space-y-3\">\r\n                                <div className=\"flex flex-wrap items-center gap-2\">\r\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                                    Single Dart\r\n                                  </label>\r\n                                  <input\r\n                                    className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                    type=\"number\"\r\n                                    min={0}\r\n                                    max={60}\r\n                                    value={playerDartPoints}\r\n                                    onChange={(e) =>\r\n                                      setPlayerDartPoints(\r\n                                        Number(e.target.value || 0),\r\n                                      )\r\n                                    }\r\n                                    onKeyDown={(e) => {\r\n                                      if (e.key === \"Enter\")\r\n                                        e.shiftKey\r\n                                          ? replaceLast()\r\n                                          : addDartNumeric();\r\n                                    }}\r\n                                    placeholder=\"60\"\r\n                                  />\r\n                                  <button\r\n                                    className=\"btn px-3 py-1 text-sm\"\r\n                                    onClick={addDartNumeric}\r\n                                  >\r\n                                    Add Dart\r\n                                  </button>\r\n                                </div>\r\n\r\n                                <div className=\"flex flex-wrap items-center gap-2\">\r\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                                    Three Dart Edit\r\n                                  </label>\r\n                                  <input\r\n                                    className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                    type=\"number\"\r\n                                    min={0}\r\n                                    max={playerScore <= 170 ? 170 : 180}\r\n                                    value={visitTotalInput}\r\n                                    onChange={(e) =>\r\n                                      handleVisitTotalChange(e.target.value)\r\n                                    }\r\n                                    onKeyDown={(e) => {\r\n                                      if (e.key === \"Enter\") addVisitTotal();\r\n                                    }}\r\n                                    placeholder=\"100\"\r\n                                  />\r\n                                  <button\r\n                                    className=\"btn px-3 py-1 text-sm\"\r\n                                    onClick={addVisitTotal}\r\n                                  >\r\n                                    Commit Visit\r\n                                  </button>\r\n                                  <button\r\n                                    className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                                    onClick={replaceLast}\r\n                                  >\r\n                                    Undo Visit\r\n                                  </button>\r\n                                </div>\r\n\r\n                                <div className=\"flex flex-wrap items-center gap-2\">\r\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                                    Manual\r\n                                  </label>\r\n                                  <input\r\n                                    className=\"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                    value={manualBox}\r\n                                    onChange={(e) =>\r\n                                      setManualBox(e.target.value)\r\n                                    }\r\n                                    onKeyDown={(e) => {\r\n                                      if (e.key === \"Enter\")\r\n                                        e.shiftKey\r\n                                          ? replaceLastManual()\r\n                                          : addManual();\r\n                                    }}\r\n                                    placeholder=\"T20\"\r\n                                  />\r\n                                  <button\r\n                                    className=\"btn px-3 py-1 text-sm\"\r\n                                    onClick={addManual}\r\n                                  >\r\n                                    Apply\r\n                                  </button>\r\n                                  <button\r\n                                    className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                                    onClick={replaceLastManual}\r\n                                    disabled={playerVisitDarts === 0}\r\n                                  >\r\n                                    Replace Last\r\n                                  </button>\r\n                                </div>\r\n\r\n                                <div>\r\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                                    Multi-entry (one per line)\r\n                                  </label>\r\n                                  <textarea\r\n                                    className=\"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30\"\r\n                                    rows={3}\r\n                                    value={manualTextarea}\r\n                                    onChange={(e) =>\r\n                                      setManualTextarea(e.target.value)\r\n                                    }\r\n                                    placeholder={\"T20\\nD16\\n25\"}\r\n                                  />\r\n                                  <div className=\"mt-2 flex flex-wrap gap-2\">\r\n                                    <button\r\n                                      className=\"btn px-3 py-1 text-sm\"\r\n                                      onClick={addManualTextarea}\r\n                                    >\r\n                                      Apply All\r\n                                    </button>\r\n                                    <button\r\n                                      className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                                      onClick={() => setManualTextarea(\"\")}\r\n                                    >\r\n                                      Clear\r\n                                    </button>\r\n                                  </div>\r\n                                </div>\r\n\r\n                                <div className=\"pt-2 border-t border-white/10 mt-3\">\r\n                                  <button\r\n                                    className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\r\n                                    onClick={clearCurrentVisit}\r\n                                    disabled={\r\n                                      playerVisitDarts === 0 &&\r\n                                      playerVisitSum === 0\r\n                                    }\r\n                                  >\r\n                                    Clear Current Visit\r\n                                  </button>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* Right column: Main Camera Feed (50% width) */}\r\n                        {cameraEnabled && (\r\n                          <div className=\"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black\">\r\n                            <CameraView\r\n                              scoringMode=\"custom\"\r\n                              showToolbar={cameraToolbarVisible}\r\n                              immediateAutoCommit\r\n                              onAutoDart={(value, ring) => {\r\n                                const ringLabel = ring ?? \"MISS\";\r\n                                const safeValue = Number.isFinite(value)\r\n                                  ? Math.max(0, value)\r\n                                  : 0;\r\n                                const now = Date.now();\r\n                                if (safeValue <= 0) {\r\n                                  if (ringLabel !== \"MISS\") return;\r\n                                  if (\r\n                                    now - (lastBounceMissTsRef.current || 0) <\r\n                                    1200\r\n                                  ) {\r\n                                    return;\r\n                                  }\r\n                                  lastBounceMissTsRef.current = now;\r\n                                } else {\r\n                                  lastBounceMissTsRef.current = 0;\r\n                                }\r\n                                applyDartValue(safeValue);\r\n                              }}\r\n                            />\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      {/* Remove the separate camera view below scoreboard */}\r\n                      {(selectedMode as any) === \"X01\" && !cameraEnabled && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode={selectedMode as any}\r\n                            players={statsX01}\r\n                            matchScore={`${playerLegs}-${aiLegs}`}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {(selectedMode as any) === \"Cricket\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Cricket\"\r\n                            players={statsCricket}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Cricket auto-scoring */}\r\n                      {(selectedMode as any) === \"Cricket\" && cameraEnabled && (\r\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  const r = ring === \"MISS\" ? undefined : ring;\r\n                                  addCricketAuto(\r\n                                    value,\r\n                                    r as any,\r\n                                    info?.sector ?? null,\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      {(selectedMode as any) === \"Shanghai\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Shanghai\"\r\n                            players={statsShanghai}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Shanghai auto-scoring */}\r\n                      {(selectedMode as any) === \"Shanghai\" &&\r\n                        cameraEnabled && (\r\n                          <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                            <CameraView\r\n                              scoringMode=\"custom\"\r\n                              showToolbar={cameraToolbarVisible}\r\n                              immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  const r = ring === \"MISS\" ? undefined : ring;\r\n                                  addShanghaiAuto(\r\n                                    value,\r\n                                    r as any,\r\n                                    info?.sector ?? null,\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                            />\r\n                          </div>\r\n                        )}\r\n                      {(selectedMode as any) === \"Killer\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Killer\"\r\n                            players={statsKiller}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {(selectedMode as any) === \"Scam\" && (\r\n                        <>\r\n                          <GameScoreboard gameMode=\"Scam\" players={statsScam} />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Scam auto-scoring */}\r\n                      {(selectedMode as any) === \"Scam\" && cameraEnabled && (\r\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  setScamPlayer(\r\n                                    addScamAuto(scamPlayer, value, ring as any),\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      {(selectedMode as any) === \"Fives\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Fives\"\r\n                            players={statsFives}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Fives auto-scoring */}\r\n                      {(selectedMode as any) === \"Fives\" && cameraEnabled && (\r\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  setFivesPlayer(\r\n                                    addFivesAuto(fivesPlayer, value, ring as any),\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      {(selectedMode as any) === \"Sevens\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Sevens\"\r\n                            players={statsSevens}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Sevens auto-scoring */}\r\n                      {(selectedMode as any) === \"Sevens\" && cameraEnabled && (\r\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  setSevensPlayer(\r\n                                    addSevensAuto(\r\n                                      sevensPlayer,\r\n                                      value,\r\n                                      ring as any,\r\n                                    ),\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      <div className=\"font-semibold\">Your Turn</div>\r\n                      <div className=\"flex flex-col gap-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input\r\n                            className=\"input w-24\"\r\n                            type=\"number\"\r\n                            min={0}\r\n                            max={60}\r\n                            value={playerDartPoints}\r\n                            onChange={(e) =>\r\n                              setPlayerDartPoints(Number(e.target.value || 0))\r\n                            }\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\")\r\n                                e.shiftKey ? replaceLast() : addDartNumeric();\r\n                            }}\r\n                          />\r\n                          <button\r\n                            className=\"btn px-3 py-1 text-sm\"\r\n                            onClick={addDartNumeric}\r\n                            title=\"Add a single dart (0â€“60)\"\r\n                          >\r\n                            Add Dart\r\n                          </button>\r\n                        </div>\r\n                        {/* Visit total entry */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input\r\n                            className=\"input w-28\"\r\n                            type=\"number\"\r\n                            min={0}\r\n                            max={playerScore <= 170 ? 170 : 180}\r\n                            placeholder=\"Visit total (0â€“180)\"\r\n                            value={visitTotalInput}\r\n                            onChange={(e) =>\r\n                              handleVisitTotalChange(e.target.value)\r\n                            }\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\") addVisitTotal();\r\n                            }}\r\n                          />\r\n                          <button\r\n                            className=\"btn px-3 py-1 text-sm\"\r\n                            onClick={addVisitTotal}\r\n                            title=\"Commit a full 3-dart total like 93\"\r\n                          >\r\n                            Commit Visit\r\n                          </button>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input\r\n                            className=\"input w-44\"\r\n                            placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                            value={manualBox}\r\n                            onChange={(e) => setManualBox(e.target.value)}\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\")\r\n                                e.shiftKey ? replaceLastManual() : addManual();\r\n                            }}\r\n                          />\r\n                          <button\r\n                            className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                            onClick={replaceLastManual}\r\n                            disabled={playerVisitDarts === 0}\r\n                          >\r\n                            Replace Last\r\n                          </button>\r\n                          <button\r\n                            className=\"btn px-3 py-1 text-sm\"\r\n                            onClick={addManual}\r\n                          >\r\n                            Add\r\n                          </button>\r\n                        </div>\r\n                        <div>\r\n                          <textarea\r\n                            className=\"input w-full h-24 resize-none\"\r\n                            placeholder=\"Type scores manually (one per line, e.g. T20&#10;D16&#10;5&#10;25&#10;50) - No camera needed!\"\r\n                            value={manualTextarea}\r\n                            onChange={(e) => setManualTextarea(e.target.value)}\r\n                          />\r\n                          <div className=\"flex gap-2 mt-1\">\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addManualTextarea}\r\n                            >\r\n                              Add All Scores\r\n                            </button>\r\n                            <button\r\n                              className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                              onClick={() => setManualTextarea(\"\")}\r\n                            >\r\n                              Clear\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-xs text-slate-300\">\r\n                        Tip: Enter to Add Â· Shift+Enter to Replace Last\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"h-1\" />\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        )}\r\n        {showRules && <X01RulesPopup onClose={() => setShowRules(false)} />}\r\n        {/* Frosted overlay when selecting premium mode without access */}\r\n        {lockedPremium && (\r\n          <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n            <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n            <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n              <div className=\"text-3xl mb-2\">ðŸ”’</div>\r\n              <div className=\"font-semibold\">Premium mode locked</div>\r\n              <div className=\"text-sm text-slate-200/80\">\r\n                Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai,\r\n                and more.\r\n              </div>\r\n              <button\r\n                onClick={async () => {\r\n                  try {\r\n                    const res = await fetch(\r\n                      `${API_URL}/api/stripe/create-checkout-session`,\r\n                      {\r\n                        method: \"POST\",\r\n                        headers: { \"Content-Type\": \"application/json\" },\r\n                        body: JSON.stringify({ email: user?.email }),\r\n                      },\r\n                    );\r\n                    const data = await res.json();\r\n                    if (data.ok && data.url) {\r\n                      window.location.href = data.url;\r\n                      if (data.development) {\r\n                        toast(\r\n                          \"Opened Stripe test checkout (development mode)\",\r\n                          { type: \"info\", timeout: 3000 },\r\n                        );\r\n                      }\r\n                    } else if (data.error === \"STRIPE_NOT_CONFIGURED\") {\r\n                      toast(\r\n                        \"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\",\r\n                        { type: \"error\", timeout: 4000 },\r\n                      );\r\n                    } else {\r\n                      toast(\r\n                        \"Failed to create checkout session. Please try again.\",\r\n                        { type: \"error\", timeout: 4000 },\r\n                      );\r\n                    }\r\n                  } catch (err) {\r\n                    toast(\"Error creating checkout. Please try again.\", {\r\n                      type: \"error\",\r\n                      timeout: 4000,\r\n                    });\r\n                  }\r\n                }}\r\n                className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n              >\r\n                Upgrade to PREMIUM Â·{\" \"}\r\n                {formatPriceInCurrency(getUserCurrency(), 5)}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n        {showCameraManager && typeof document !== \"undefined\"\r\n          ? createPortal(\r\n              <div\r\n                className=\"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4\"\r\n                onClick={() => setShowCameraManager(false)}\r\n              >\r\n                <ResizableModal\r\n                  storageKey=\"ndn:modal:offline-camera-manager\"\r\n                  className=\"relative\"\r\n                  defaultWidth={640}\r\n                  defaultHeight={520}\r\n                  minWidth={480}\r\n                  minHeight={420}\r\n                  maxWidth={1200}\r\n                  maxHeight={900}\r\n                  initialFitHeight\r\n                  onClose={() => setShowCameraManager(false)}\r\n                >\r\n                  <div\r\n                    className=\"space-y-3\"\r\n                    onClick={(e) => e.stopPropagation()}\r\n                  >\r\n                    <div className=\"flex items-center justify-between gap-3\">\r\n                      <div>\r\n                        <div className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                          Camera Devices\r\n                        </div>\r\n                        <div className=\"text-xl font-semibold text-white mt-1\">\r\n                          Manage Offline Camera Feeds\r\n                        </div>\r\n                      </div>\r\n                      <button\r\n                        className=\"btn bg-slate-800 hover:bg-slate-700 text-white\"\r\n                        onClick={() => setShowCameraManager(false)}\r\n                      >\r\n                        Close\r\n                      </button>\r\n                    </div>\r\n                    <CameraTile\r\n                      fill\r\n                      user={user}\r\n                      playerScore={playerScore}\r\n                      aiScore={aiScore}\r\n                      x01Score={x01Score}\r\n                      inMatch={inMatch}\r\n                      showWinPopup={showWinPopup}\r\n                      pendingLegWinner={pendingLegWinner}\r\n                      playerDartsThrown={playerDartsThrown}\r\n                      aiDartsThrown={aiDartsThrown}\r\n                      totalPlayerDarts={totalPlayerDarts}\r\n                      totalAiDarts={totalAiDarts}\r\n                      totalPlayerPoints={totalPlayerPoints}\r\n                      totalAiPoints={totalAiPoints}\r\n                      player180s={player180s}\r\n                      player140s={player140s}\r\n                      player100s={player100s}\r\n                      ai180s={ai180s}\r\n                      ai140s={ai140s}\r\n                      ai100s={ai100s}\r\n                      playerHighestCheckout={playerHighestCheckout}\r\n                      aiHighestCheckout={aiHighestCheckout}\r\n                      onClose={() => setShowCameraManager(false)}\r\n                      onOpen={() => setShowCameraManager(true)}\r\n                      layout={offlineLayout}\r\n                    />\r\n                  </div>\r\n                </ResizableModal>\r\n              </div>,\r\n              document.body,\r\n            )\r\n          : null}\r\n        {legOverrideConfirm && typeof document !== \"undefined\"\r\n          ? createPortal(\r\n              (() => {\r\n                const { target, value, stage } = legOverrideConfirm;\r\n                const targetName =\r\n                  target === \"player\" ? humanName : aiDisplayName;\r\n                const currentLegs = target === \"player\" ? playerLegs : aiLegs;\r\n                return (\r\n                  <div\r\n                    className=\"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4\"\r\n                    onClick={handleLegOverrideNo}\r\n                  >\r\n                    <ResizableModal\r\n                      storageKey=\"ndn:modal:offline-leg-override\"\r\n                      className=\"relative\"\r\n                      defaultWidth={360}\r\n                      defaultHeight={240}\r\n                      minWidth={280}\r\n                      minHeight={200}\r\n                      maxWidth={420}\r\n                      maxHeight={360}\r\n                      initialFitHeight\r\n                      onClose={handleLegOverrideNo}\r\n                    >\r\n                      <div\r\n                        className=\"space-y-3 max-w-[18rem] mx-auto\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                      >\r\n                        <div>\r\n                          <div className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                            Step {stage} of 2\r\n                          </div>\r\n                          <div className=\"text-xl font-semibold text-white mt-1\">\r\n                            Override legs?\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-sm text-slate-200 leading-relaxed\">\r\n                          {stage === 1 ? (\r\n                            <>\r\n                              Set {targetName}&apos;s legs to{\" \"}\r\n                              <span className=\"font-semibold text-white\">\r\n                                {value}\r\n                              </span>\r\n                              ? Confirm to continue.\r\n                            </>\r\n                          ) : (\r\n                            <>\r\n                              Final confirmation: set {targetName}&apos;s legs\r\n                              to{\" \"}\r\n                              <span className=\"font-semibold text-white\">\r\n                                {value}\r\n                              </span>\r\n                              . Select{\" \"}\r\n                              <span className=\"font-semibold text-emerald-200\">\r\n                                Yes\r\n                              </span>{\" \"}\r\n                              to apply immediately.\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"rounded-xl bg-black/40 border border-white/10 p-3 text-sm\">\r\n                          <div className=\"text-xs uppercase tracking-wide text-white/50 mb-1\">\r\n                            Current legs\r\n                          </div>\r\n                          <div className=\"text-base font-semibold text-white\">\r\n                            {currentLegs}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center justify-end gap-2 pt-2\">\r\n                          <button\r\n                            className=\"btn bg-rose-600 hover:bg-rose-700 text-white\"\r\n                            onClick={handleLegOverrideNo}\r\n                          >\r\n                            No\r\n                          </button>\r\n                          <button\r\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n                            onClick={handleLegOverrideYes}\r\n                          >\r\n                            Yes\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </ResizableModal>\r\n                  </div>\r\n                );\r\n              })(),\r\n              document.body,\r\n            )\r\n          : null}\r\n        {showWinPopup && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n            <ResizableModal\r\n              storageKey=\"ndn:modal:offline-win\"\r\n              className=\"w-full relative\"\r\n              defaultWidth={420}\r\n              defaultHeight={360}\r\n              minWidth={360}\r\n              minHeight={300}\r\n              maxWidth={800}\r\n              maxHeight={700}\r\n              initialFitHeight\r\n            >\r\n              <h3 className=\"text-lg font-bold mb-2\">Leg Won!</h3>\r\n              <label className=\"block mb-1\">Darts to hit double:</label>\r\n              <div className=\"flex gap-2 mb-2\">\r\n                {[1, 2, 3].map((n) => (\r\n                  <button\r\n                    key={n}\r\n                    className={`btn ${doubleDarts === n ? \"bg-brand-600\" : \"\"}`}\r\n                    onClick={() => setDoubleDarts(n)}\r\n                  >\r\n                    {n}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <label className=\"block mb-1\">Darts for checkout:</label>\r\n              <div className=\"flex gap-2 mb-2\">\r\n                {[1, 2, 3].map((n) => (\r\n                  <button\r\n                    key={n}\r\n                    className={`btn ${checkoutDarts === n ? \"bg-brand-600\" : \"\"}`}\r\n                    onClick={() => setCheckoutDarts(n)}\r\n                  >\r\n                    {n}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <div className=\"grid grid-cols-1 gap-2 mt-2\">\r\n                <button className=\"btn w-full\" onClick={handleWinPopupSubmit}>\r\n                  Submit\r\n                </button>\r\n                <button\r\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700 w-full\"\r\n                  onClick={() => {\r\n                    setShowWinPopup(false);\r\n                    startMatch();\r\n                  }}\r\n                >\r\n                  Rematch\r\n                </button>\r\n                <button\r\n                  className=\"btn bg-slate-700 hover:bg-slate-800 w-full\"\r\n                  onClick={() => {\r\n                    setShowWinPopup(false);\r\n                    setShowMatchModal(false);\r\n                    setInMatch(false);\r\n                  }}\r\n                >\r\n                  Back to Menu\r\n                </button>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        )}\r\n        {showMatchSummary && (\r\n          <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]\">\r\n            <ResizableModal\r\n              storageKey=\"ndn:modal:offline-summary\"\r\n              className=\"w-full relative\"\r\n              defaultWidth={820}\r\n              defaultHeight={520}\r\n              minWidth={600}\r\n              minHeight={400}\r\n              maxWidth={1400}\r\n              maxHeight={1000}\r\n              initialFitHeight\r\n            >\r\n              <h3 className=\"text-xl font-extrabold mb-2\">Match Summary</h3>\r\n              <div className=\"text-xs opacity-80 mb-3\">\r\n                {selectedMode} Â· {x01Score} start Â· First to {firstTo}\r\n              </div>\r\n              {(() => {\r\n                const player3da =\r\n                  totalPlayerDarts > 0\r\n                    ? (totalPlayerPoints / totalPlayerDarts) * 3\r\n                    : 0;\r\n                const player9da = player3da * 3;\r\n                const playerBest = (() => {\r\n                  const darts = legStats\r\n                    .filter(\r\n                      (l) =>\r\n                        l.winner === \"player\" &&\r\n                        typeof l.winnerDarts === \"number\",\r\n                    )\r\n                    .map((l) => l.winnerDarts);\r\n                  if (!darts.length) return \"â€”\";\r\n                  return `${Math.min(...darts)} darts`;\r\n                })();\r\n                const playerWorst = (() => {\r\n                  const darts = legStats\r\n                    .filter(\r\n                      (l) =>\r\n                        l.winner === \"player\" &&\r\n                        typeof l.winnerDarts === \"number\",\r\n                    )\r\n                    .map((l) => l.winnerDarts);\r\n                  if (!darts.length) return \"â€”\";\r\n                  return `${Math.max(...darts)} darts`;\r\n                })();\r\n                const playerPct =\r\n                  playerDoublesAtt > 0\r\n                    ? Math.round((playerDoublesHit / playerDoublesAtt) * 100)\r\n                    : 0;\r\n\r\n                const ai3da =\r\n                  totalAiDarts > 0 ? (totalAiPoints / totalAiDarts) * 3 : 0;\r\n                const ai9da = ai3da * 3;\r\n                const aiBest = (() => {\r\n                  const darts = legStats\r\n                    .filter(\r\n                      (l) =>\r\n                        l.winner === \"ai\" && typeof l.winnerDarts === \"number\",\r\n                    )\r\n                    .map((l) => l.winnerDarts);\r\n                  if (!darts.length) return \"â€”\";\r\n                  return `${Math.min(...darts)} darts`;\r\n                })();\r\n                const aiWorst = (() => {\r\n                  const darts = legStats\r\n                    .filter(\r\n                      (l) =>\r\n                        l.winner === \"ai\" && typeof l.winnerDarts === \"number\",\r\n                    )\r\n                    .map((l) => l.winnerDarts);\r\n                  if (!darts.length) return \"â€”\";\r\n                  return `${Math.max(...darts)} darts`;\r\n                })();\r\n                const aiPct =\r\n                  aiDoublesAtt > 0\r\n                    ? Math.round((aiDoublesHit / aiDoublesAtt) * 100)\r\n                    : 0;\r\n\r\n                return (\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                    <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                      <div className=\"text-sm font-semibold mb-1\">\r\n                        {user?.username || \"You\"}\r\n                      </div>\r\n                      <div className=\"text-3xl font-extrabold\">\r\n                        {playerLegs}\r\n                      </div>\r\n                      <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                      <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                        <div>\r\n                          <span className=\"opacity-70\">Final 3DA</span>\r\n                          <div className=\"font-semibold\">\r\n                            {player3da.toFixed(1)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Final 9DA</span>\r\n                          <div className=\"font-semibold\">\r\n                            {player9da.toFixed(1)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Darts At Double</span>\r\n                          <div className=\"font-semibold\">\r\n                            {playerDoublesAtt}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Double %</span>\r\n                          <div className=\"font-semibold\">{playerPct}%</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Best Dart Leg</span>\r\n                          <div className=\"font-semibold\">{playerBest}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Worst Dart Leg</span>\r\n                          <div className=\"font-semibold\">{playerWorst}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">180's Hit</span>\r\n                          <div className=\"font-semibold\">{player180s}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"hidden md:flex items-center justify-center\">\r\n                      <div className=\"text-4xl font-black\">\r\n                        {playerLegs} â€“ {aiLegs}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                      <div className=\"text-sm font-semibold mb-1\">\r\n                        {ai === \"None\" ? \"Opponent\" : `${ai} AI`}\r\n                      </div>\r\n                      <div className=\"text-3xl font-extrabold\">{aiLegs}</div>\r\n                      <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                      <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                        <div>\r\n                          <span className=\"opacity-70\">Final 3DA</span>\r\n                          <div className=\"font-semibold\">\r\n                            {ai3da.toFixed(1)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Final 9DA</span>\r\n                          <div className=\"font-semibold\">\r\n                            {ai9da.toFixed(1)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Darts At Double</span>\r\n                          <div className=\"font-semibold\">{aiDoublesAtt}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Double %</span>\r\n                          <div className=\"font-semibold\">{aiPct}%</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Best Dart Leg</span>\r\n                          <div className=\"font-semibold\">{aiBest}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Worst Dart Leg</span>\r\n                          <div className=\"font-semibold\">{aiWorst}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">180's Hit</span>\r\n                          <div className=\"font-semibold\">{ai180s}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })()}\r\n              <div className=\"mt-4\">\r\n                <div className=\"text-sm font-semibold mb-2\">Legs Timeline</div>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  {legStats.map((leg, i) => (\r\n                    <div\r\n                      key={i}\r\n                      className={`px-3 py-1 rounded-full border text-xs ${leg.winner === \"player\" ? \"bg-emerald-500/15 border-emerald-400/30\" : \"bg-fuchsia-500/15 border-fuchsia-400/30\"}`}\r\n                    >\r\n                      Leg {i + 1}:{\" \"}\r\n                      {leg.winner === \"player\"\r\n                        ? \"You\"\r\n                        : ai === \"None\"\r\n                          ? \"Opp\"\r\n                          : \"AI\"}{\" \"}\r\n                      Â· Dbl {leg.doubleDarts} Â· CO {leg.checkoutDarts}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              <div className=\"mt-4\">\r\n                <div className=\"text-sm font-semibold mb-2\">Shot Heat Map</div>\r\n                <div className=\"rounded-2xl overflow-hidden bg-black p-3\">\r\n                  {/* Lazy-load HeatMap component to avoid increasing initial bundle too much */}\r\n                  <HeatMap />\r\n                </div>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n                <button\r\n                  className=\"btn bg-slate-700 hover:bg-slate-800\"\r\n                  onClick={() => setShowMatchSummary(false)}\r\n                >\r\n                  Close\r\n                </button>\r\n                <button\r\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700\"\r\n                  onClick={() => {\r\n                    setShowMatchSummary(false);\r\n                    startMatch();\r\n                  }}\r\n                >\r\n                  Rematch\r\n                </button>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        )}\r\n        {legStats.length > 0 && (\r\n          <div className=\"mt-4\">\r\n            <h4 className=\"font-semibold mb-2\">Leg Stats</h4>\r\n            <ul>\r\n              {legStats.map((leg, i) => (\r\n                <li key={i}>\r\n                  Leg {i + 1}: Double darts: {leg.doubleDarts}, Checkout darts:{\" \"}\r\n                  {leg.checkoutDarts}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n        )}\r\n\r\n        {/* Phone camera overlay removed per UX preference; use header badge preview only */}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["doubles","dVal","tag","prefsDoubleScore","fav","suggestCheckouts","remaining","favoriteDouble","hardcoded","target","routes","t","s","sayScore","name","scored","voiceName","opts","synth","msg","isCheckout","isOneEighty","v","CameraTile","label","autoStart","scaleOverride","className","aspect","style","fill","videoRef","useRef","cameraSession","useCameraSession","streaming","setStreaming","useState","ws","setWs","pairCode","setPairCode","pc","setPc","lastRegisteredModeRef","registerStream","useCallback","stream","modeOverride","err","preferredCameraLabel","useUserSettings","mode","setMode","setExpiresAt","setPaired","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","cameraEnabledSetting","setPreferredCameraLocked","preferredCameraLocked","setPreferredCamera","preferredCameraId","fallbackClass","fallbackStyle","jsx","useEffect","h","apiFetch","r","j","ip","x","mobileUrl","useMemo","code","envUrl","u","host","useHttps","port","manualModeSetAt","setManualModeSetAt","cancelled","desiredLabel","timer","start","stop","apply","startWifiConnection","startPhonePairing","constraints","devices","discoverNetworkDevices","error","connectToWifiDevice","device","d","connectToNetworkDevice","startUsbConnection","discoverUSBDevices","newDevice","requestUSBDevice","prev","connectToUsbDevice","connectToUSBDevice","handleModeSelect","newMode","onStart","ev","modeFromEvent","ensureWS","normalizedEnv","proto","sameOrigin","isLocalhost","isRenderHost","renderWS","url","socket","data","peer","e","inbound","offer","regenerateCode","stopAll","CameraFrame","props","cameraScale","storedAspect","onModeSelect","modeDisplayName","reconnectOptions","copyFeedback","setCopyFeedback","copyTimeoutRef","globalFitMode","effectiveFitMode","scale","raw","clamped","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","usbActive","videoElement","baseVideoClass","copyValue","value","type","textarea","jsxs","Fragment","option","isActive","scoreFromImagePoint","H_boardToImage","pImg","pBoard","imageToBoard","scoreAtBoardPoint","DartDetector","cfg","cx","cy","radius","width","height","frame","alpha","w","bg","n","i","p","g","b","gray","y","dx","dy","recent","mask","diff","sum","sum2","cnt","isHighlight","maxc","minc","satApprox","isHi","mu","var_","sigma","dynamicThresh","visited","bestArea","bestIdxs","idxs","area","qh","q","cur","nbs","nb","minX","minY","maxX","maxY","meanX","meanY","idx","cxx","cyy","cxy","trace","det","tmp","l1","vx","vy","vlen","dxc","dyc","outward","rlen","rx","ry","cosAng","maxT","tipX","tipY","dxr","dyr","minR2","bboxW","bboxH","bboxArea","radial","confidence","l2","bw","bh","yy","xx","tip","close","a","out","on","parseExternalDart","ring","normalizeRing","finalizeFromValue","m","mult","sec","mul","inner","subscribeExternalWS","onDart","alive","lastSig","lastSigAt","DEDUP_WINDOW_MS","seenIds","seenSet","considerForward","payload","parsed","pid","old","sig","now","connect","ResizablePanel","storageKey","children","defaultWidth","defaultHeight","minWidth","minHeight","maxWidth","maxHeight","autoFill","size","setSize","startRef","containerRef","onReset","clamp","min","max","beginResize","dir","el","rect","onMove","endResize","handleKeyResize","k","delta","curW","curH","useHeatmapStore","create","set","get","state","useMatchControl","endsAt","AUTO_COMMIT_MIN_FRAMES","AUTO_COMMIT_HOLD_MS","AUTO_COMMIT_COOLDOWN_MS","AUTO_STREAM_IGNORE_MS","DETECTION_ARM_DELAY_MS","DETECTION_MIN_FRAMES","AUTO_COMMIT_CONFIDENCE","BOARD_CLEAR_GRACE_MS","CameraView","forwardRef","onVisitCommitted","showToolbar","onAutoDart","immediateAutoCommit","hideInlinePanels","scoringMode","onGenericDart","onGenericReplace","x01DoubleInOverride","onAddVisit","onEndLeg","cameraAutoCommit","ref","autoscoreWsUrl","cameraAspect","cameraFitMode","autoCommitMode","cameraEnabled","setCameraEnabled","hideCameraOverlay","setHideCameraOverlay","manualOnly","availableCameras","setAvailableCameras","canvasRef","overlayRef","isPhoneCamera","sessionStream","sessionStreaming","phoneFeedActive","effectiveStreaming","cameraStarting","setCameraStarting","snapshotUrl","setSnapshotUrl","H","imageSize","overlaySize","resetCalibration","_hydrated","locked","useCalibration","lastAutoScore","setLastAutoScore","manualScore","setManualScore","lastAutoValue","setLastAutoValue","lastAutoRing","setLastAutoRing","pendingDarts","setPendingDarts","pendingScore","setPendingScore","pendingEntries","setPendingEntries","pendingPreOpenDarts","setPendingPreOpenDarts","pendingDartsAtDouble","setPendingDartsAtDouble","awaitingClear","setAwaitingClear","pendingCommitRef","pendingCommitTimerRef","shouldDeferCommit","indicatorVersion","setIndicatorVersion","indicatorEntryVersions","setIndicatorEntryVersions","autoCandidateRef","detectionLogRef","lastAutoCommitRef","streamingStartMsRef","detectionArmedRef","detectionArmTimerRef","frameCountRef","tickRef","detectionLog","setDetectionLog","showDetectionLog","setShowDetectionLog","clearPendingCommitTimer","useImperativeHandle","captureDetectionLog","entry","next","finalizePendingCommit","_trigger","pending","enqueueVisitCommit","clearPendingManual","reason","setHadRecentAuto","handler","handleIndicatorReset","handleToolbarClear","requestDeviceManager","x01DoubleInSetting","x01DoubleIn","openedById","setOpenedById","matchState","useMatch","currentPlayerId","isOpened","setOpened","inProgress","setVisit","usePendingVisit","resetPendingVisit","addVisit","endLeg","callAddVisit","score","darts","meta","callEndLeg","addHeatSample","quickSelAuto","setQuickSelAuto","quickSelManual","setQuickSelManual","nonRegCount","setNonRegCount","showRecalModal","setShowRecalModal","hadRecentAuto","pulseManualPill","setPulseManualPill","pulseTimeoutRef","activeTab","setActiveTab","showManualModal","setShowManualModal","showAutoModal","setShowAutoModal","showScoringModal","setShowScoringModal","manualPreviewRef","dartTimerEnabled","dartTimerSeconds","dartTimeLeft","setDartTimeLeft","timerRef","paused","detectorRef","rafRef","lastAutoSigRef","lastAutoSigAtRef","lastParentSigRef","lastParentSigAtRef","detectorSeedVersion","setDetectorSeedVersion","handlePhoneReconnect","onOpen","onDartsCleared","mounted","refresh","list","onClose","leg","shouldRun","addDart","id","c","vw","vh","cw","ch","ctx","dw","dh","canFallbackToLocal","startCamera","dlog","playErr","retryErr","enumErr","stopCamera","videoEl","fallbackStream","activeStream","capture","primary","sessionVideo","source","video","canvas","CameraSelector","resolve","sourceVideo","canceled","initVw","initVh","proc","minArea","thresh","requireStableN","tick","didApplyHitThisTick","cImg","applyHomography","rImg","BoardRadii","sx","sy","roiR","detector","nowPerf","warmupActive","tipRefined","refinePointSobel","pCal","sector","shouldAccept","applyAutoHit","candidate","pSig","pNow","ack","existing","current","holdMs","ready","cooled","o","octx","ox","oy","ax","ax1","ay1","ax2","ay2","bx","by","handleUseLocalCamera","fallback","useAudit","sub","onOverlayClick","parseManual","input","bull","outerBull","num","multVal","getCurrentRemaining","newDarts","previousScore","previousDarts","addSample","willCount","applied","appliedValue","newScore","after","isFinish","preOpenTotal","postAfter","postBefore","attemptsThisDart","attemptsTotal","onAddAutoDart","onApplyManual","onReplaceManual","last","prevDarts","prevScore","onRecalibrateNow","onResetCalibration","onKey","onQuickEntry","val","onUndoDart","onCommitVisit","visitScore","visitDarts","fit","videoClass","renderVideoSurface","entrySeq","isPending","hasPositiveValue","hasHitRing","color","activeState","stateClass","title","baseClasses","okNow","pulseClass","ResizableModal","_","FocusLock","ms","isHit","polarToCartesian","angleDeg","sectorAngle","HeatMap","samples","radii","ringOrder","points","angle","grd","sectorCounts","secStr","pos","DOUBLE_PRACTICE_ORDER","isDoubleHit","targetIdx","parseManualDart","ATC_ORDER","CRICKET_NUMBERS","createCricketState","marks","applyCricketDart","opponentClosed","hits","cand","before","remainToClose","toApply","overflow","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","endShanghaiTurn","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","endHalveItTurn","createHighLow","applyHighLowDart","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","res","applyKillerDart","selfId","states","me","victimId","victim","killerWinner","st","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","TTT_TARGETS","createTicTacToe","checkWin","board","lines","tryClaimCell","cell","tgt","ok","createScamState","SCAM_TARGETS","SCAM_TARGET_NAMES","getScamTarget","addScamAuto","newIndex","finished","addScamNumeric","resetScam","createFivesState","FIVES_VALID_NUMBERS","isFivesValid","addFivesAuto","addFivesNumeric","resetFives","createSevensState","SEVENS_VALID_NUMBERS","isSevensValid","addSevensAuto","addSevensNumeric","resetSevens","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","GameHeaderBar","left","right","sticky","GameScoreboard","gameMode","players","matchScore","gameRules","player","ScoreRow","AvgDifferenceRow","formatCricketClosed","getCricketStatus","mono","bold","highlight","matchAvg","allTimeAvg","isPositive","isNeutral","diffText","diffColor","closed","count","closedCount","makeOfflineAddVisitAdapter","commitManualVisitTotal","createOfflineMatchActions","args","match","endTurn","useOfflineGameStats","playerScore","aiScore","playerLegs","aiLegs","playerLastDart","aiLastDart","playerVisitSum","aiVisitSum","playerLastVisitScore","aiLastVisitScore","playerVisitDartCount","aiVisitDartCount","playerDoublesHit","playerDoublesAtt","aiDoublesHit","aiDoublesAtt","legStats","isPlayerTurn","ai","x01Score","cricket","shanghai","killerPlayers","killerStates","killerAssigned","killerTurnIdx","playerMatchAvg","playerDarts","playerScored","resolvedPlayerLastScore","l","getAllTimeAvg","resolvedAiLastScore","aiLevels","aiVisitScore","level","candidates","X01RulesPopup","API_URL","OfflinePlay","user","offlineLayout","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","rememberLastOffline","setLastOffline","autoStartOffline","setCameraScale","setCameraAspect","setCameraFitMode","textSize","boxSize","matchType","setMatchType","teamAName","setTeamAName","teamBName","setTeamBName","manualScoring","cameraToolbarVisible","waitForBoardClear","selectedMode","setSelectedMode","setX01Score","setAI","showRules","setShowRules","inMatch","setInMatch","setPlayerScore","setAiScore","onDouble","setOnDouble","showWinPopup","setShowWinPopup","firstTo","setFirstTo","setPlayerLegs","showStartShowcase","setShowStartShowcase","startedShowcasedRef","setAiLegs","pendingLegWinner","setPendingLegWinner","doubleDarts","setDoubleDarts","checkoutDarts","setCheckoutDarts","setLegStats","aiDelayMs","setAiDelayMs","toast","useToast","showMatchModal","setShowMatchModal","maximized","setMaximized","fitAll","setFitAll","fitScale","setFitScale","fitOverflowing","setFitOverflowing","setIsPlayerTurn","handleOpenManager","setShowCameraManager","playerDartPoints","setPlayerDartPoints","dpIndex","setDpIndex","dpHits","setDpHits","atcIndex","setAtcIndex","atcHits","setAtcHits","setCricket","setShanghai","halve","setHalve","highlow","setHighlow","practiceTurnDarts","setPracticeTurnDarts","b27Stage","setB27Stage","b27Score","setB27Score","b27Darts","setB27Darts","b27Hits","setB27Hits","b27Finished","setB27Finished","cuRound","setCuRound","cuScore","setCuScore","cuDarts","setCuDarts","cuMaxRounds","hsRound","setHsRound","hsScore","setHsScore","hsDarts","setHsDarts","hsMaxRounds","lsRound","setLsRound","lsScore","setLsScore","lsDarts","setLsDarts","lsMaxRounds","co170Rem","setCo170Rem","co170Darts","setCo170Darts","co170Attempts","setCo170Attempts","co170Successes","setCo170Successes","co121Rem","setCo121Rem","co121Darts","setCo121Darts","co121Attempts","setCo121Attempts","co121Successes","setCo121Successes","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","trebleMaxDarts","setTrebleMaxDarts","trebleFinished","setTrebleFinished","baseball","setBaseball","golf","setGolf","ttt","setTTT","amCricket","setAmCricket","setKillerPlayers","setKillerStates","setKillerAssigned","killerSetupDone","setKillerSetupDone","setKillerTurnIdx","killerDarts","setKillerDarts","killerWinnerId","setKillerWinnerId","killerLastEvent","setKillerLastEvent","scam","setScam","scamPlayer","setScamPlayer","fives","setFives","fivesPlayer","setFivesPlayer","sevens","setSevens","sevensPlayer","setSevensPlayer","playerDartsThrown","setPlayerDartsThrown","setPlayerLastDart","playerVisitDarts","setPlayerVisitDarts","playerVisitStart","setPlayerVisitStart","setPlayerVisitSum","setPlayerLastVisitScore","playerVisitDartsAtDouble","setPlayerVisitDartsAtDouble","lastBounceMissTsRef","lastVisitDartsRef","playerScoreRef","playerVisitDartsRef","playerVisitSumRef","playerVisitStartRef","playerVisitDartsAtDoubleRef","aiCountdownMs","setAiCountdownMs","aiDartsThrown","setAiDartsThrown","setAiLastDart","setAiVisitSum","aiVisitDarts","setAiVisitDarts","setAiLastVisitScore","aiVisitDartsAtDouble","setAiVisitDartsAtDouble","setPlayerDoublesAtt","setPlayerDoublesHit","setAiDoublesAtt","setAiDoublesHit","totalPlayerDarts","setTotalPlayerDarts","totalAiDarts","setTotalAiDarts","totalPlayerPoints","setTotalPlayerPoints","totalAiPoints","setTotalAiPoints","player180s","setPlayer180s","player140s","setPlayer140s","player100s","setPlayer100s","ai180s","setAi180s","ai140s","setAi140s","ai100s","setAi100s","playerHighestCheckout","setPlayerHighestCheckout","aiHighestCheckout","setAiHighestCheckout","showMatchSummary","setShowMatchSummary","manualBox","setManualBox","manualTextarea","setManualTextarea","manualPlayerScoreInput","setManualPlayerScoreInput","manualOpponentScoreInput","setManualOpponentScoreInput","manualPlayerLegsInput","setManualPlayerLegsInput","manualOpponentLegsInput","setManualOpponentLegsInput","legOverrideConfirm","setLegOverrideConfirm","showCameraManager","dartCounts","setDartCounts","awaitingBoardClear","setAwaitingBoardClear","pendingVisitRef","pendingVisitTimerRef","clearPendingVisitTimer","speakAutoVisit","speaker","commitPendingVisit","visitTotal","preRemaining","doubleAttempts","doubleWindow","highestCheckout","finalizePendingVisit","trigger","queuePendingVisit","humanName","aiDisplayName","statsX01","statsCricket","statsShanghai","statsKiller","statsScam","statsFives","statsSevens","activeScoreboardStats","playerResolvedLastScore","aiResolvedLastScore","singlePlayerScoreboard","rest","inactivePlayerName","activePlayerName","activeRemaining","activeLastScore","recordDart","resetDartCount","parseManualScoreOverride","parseManualLegsOverride","cancelPendingAutoVisit","nextScore","safeScore","nextVisitStart","handleManualScoreOverride","applyManualLegOverride","handleManualLegsOverride","handleLegOverrideYes","handleLegOverrideNo","handleKey","event","buttonSizeClass","scrollerRef","contentRef","headerBarRef","formatType","setFormatType","formatCount","setFormatCount","formatRef","wins","measure","scroller","content","headerH","availH","availW","currentScale","naturalHeight","naturalWidth","scaleH","scaleW","scaledHeight","overflowing","RO","ro","onAuto","startMatch","onFmt","raf","dt","targetVisit","dart","preRem","postRem","checkout","startNextLeg","nextRemaining","applyDartValue","currentScore","currentVisitDarts","currentVisitSum","currentVisitStart","currentVisitDartsAtDouble","newVisitDarts","postRemaining","attemptsThisVisit","newVisitSum","startedDoubleWindow","stillInDoubleWindow","doubleAttemptsNow","inDoubleWindow","attemptsForVisit","addDartNumeric","rawTotal","visitStart","liveScore","existingDarts","existingSum","hadPartialVisit","checkoutCap","total","matchActions","visitTotalInput","setVisitTotalInput","handleVisitTotalChange","numericOnly","maxAllowed","safe","addVisitTotal","bounded","clearCurrentVisit","onClearRequest","evt","detail","addDpValue","nextHits","addDpNumeric","addDpManual","addB27Auto","hit","nd","totalHits","addB27Numeric","resetB27","addCountUpAuto","addHighScoreAuto","addLowScoreAuto","applyCheckout","rem","setRem","setDarts","setAttempts","setSuccesses","addCo170Auto","addCo121Auto","addCoManual","is170","isDouble","resetCo170","resetCo121","addTrebleAuto","cycle","resetTreble","addBaseballAuto","cp","resetBaseball","addGolfAuto","resetGolf","addTttAuto","resetTtt","addAmCricketAuto","resetAmCricket","addAtcValue","newHits","addAtcNumeric","addAtcManual","addCricketAuto","copy","addCricketNumeric","addShanghaiAuto","addShanghaiNumeric","addHalveAuto","addHalveNumeric","addHighLowAuto","addHighLowNumeric","parseManualBox","addManual","addManualTextarea","line","replaceLast","replaceLastManual","rewind","handleWinPopupSubmit","winner","legDoublesAtt","legDoublesHit","winnerDarts","bumpGameMode","lockedPremium","freeGames","MatchStartShowcase","premiumGames","GameCalibrationStatus","disabled","pillCls","cricketClosedAll","info","MatchControls","first","currentThrower","currentRemaining","lastScoreDisplay","dartsThrown","avg3","bestLegText","nh","ni","promptVal","tcell","win","it","ids","initStates","ringLabel","safeValue","formatPriceInCurrency","getUserCurrency","createPortal","stage","targetName","currentLegs","player3da","player9da","playerBest","playerWorst","playerPct","ai3da","ai9da","aiBest","aiWorst","aiPct"],"mappings":"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UT,EAC9B,EAAG,CAACA,EAAgB,CAAC,EAErB,MAAMyF,GAAY3Q,GAAM,UAAY,WAC9B4Q,GAAgBlS,KAAO,OAAS,WAAaA,GAG7CmS,GAAWtT,GACf,MACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAiN,GACAqB,GACAnO,GACAC,GACAC,GACAC,GACAC,EACAC,GACAC,EAEF,EACMoS,GAAevT,GACnB,UACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAqB,EAAA,EAEImS,GAAgBxT,GACpB,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAkB,GACAC,GACA,OACAE,GACAC,EAAA,EAEImS,GAAczT,GAClB,SACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAuB,GACAC,GACAC,EACAC,CAAA,EAEIgS,GAAY1T,GAAoB,MAAa,EAC7C2T,GAAa3T,GAAoB,OAAc,EAC/C4T,GAAc5T,GAAoB,QAAe,EAEjD6T,GAAwBp+B,EAAAA,QAAQ,IAAM,CAC1C,MAAM2Z,EAAOkkB,IAAY,CAAA,EACnBQ,EACJnG,GAAmB,EACfpN,GACCE,IAAwBJ,GACzB0T,EACJ/E,GAAe,EAAIxO,GAAcE,IAAoBJ,GACvD,OAAIlR,EAAK,SAAW,EACX,CACL,KAAM8R,GAAekS,GAAYC,GACjC,cAAe,GACf,QAASnS,GAAef,GAAaC,GACrC,MAAOc,GAAejB,GAAcC,GACpC,UAAWgB,GAAe4S,EAA0BC,CAAA,EAGjD3kB,EAAK,KAAMqP,GAAWA,EAAO,aAAa,GAAKrP,EAAK,CAAC,CAC9D,EAAG,CACDkkB,GACApS,GACAkS,GACAC,GACAlT,GACAC,GACAH,GACAC,GACAyN,GACApN,GACAE,GACAJ,GACAG,GACAE,GACAJ,GACA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"}
import{z as Ee,A as $e,e as Re,a as b,g as De,b as Oe,d as Le,j as t,B as H}from"./index-0oBsAK_j.js";import{r as o}from"./ui-Cl5S-Tv0.js";import"./vendor-D3F3s8fL.js";const me="ndn:messages:inbox",xe="ndn:messages:unread",he="ndn:messages:threads";function Me(){try{const c=localStorage.getItem(me),h=c?JSON.parse(c):[],r=Number(localStorage.getItem(xe)||"0")||0,a=localStorage.getItem(he),l=a?JSON.parse(a):{};return{inbox:Array.isArray(h)?h.filter(j=>j&&typeof j.id=="string").slice(0,200):[],unread:r,threads:l&&typeof l=="object"?l:{}}}catch{return{inbox:[],unread:0,threads:{}}}}function E(c,h,r){try{localStorage.setItem(me,JSON.stringify(c))}catch{}try{localStorage.setItem(xe,String(h))}catch{}if(r)try{localStorage.setItem(he,JSON.stringify(r))}catch{}}const z=Me(),We=Ee((c,h)=>({inbox:z.inbox,unread:z.unread,threads:z.threads,inGame:!1,setInGame:r=>c({inGame:r}),add:r=>c(a=>{const l=a.inbox.some(j=>j.id===r.id&&j.ts===r.ts),x=l?a.inbox:[r,...a.inbox].slice(0,200),p=a.unread+(l?0:1);return E(x,p,a.threads),{inbox:x,unread:p}}),load:r=>c(a=>{const l=[...r].sort((x,p)=>p.ts-x.ts).slice(0,200);return E(l,a.unread,a.threads),{inbox:l,unread:a.unread}}),loadThread:(r,a)=>c(l=>{const x=String(r||"").toLowerCase();if(!x)return l;const p=[...a].sort((C,k)=>C.ts-k.ts).slice(-400),j={...l.threads,[x]:{other:x,messages:p}};return E(l.inbox,l.unread,j),{threads:j}}),markAllRead:()=>{const r=h();E(r.inbox,0,r.threads),c({unread:0})},pushThread:(r,a)=>c(l=>{const x=String(r||"").toLowerCase();if(!x)return l;const j=[...l.threads[x]?.messages||[],a].sort((k,T)=>k.ts-T.ts).slice(-400),C={...l.threads,[x]:{other:x,messages:j}};return E(l.inbox,l.unread,C),{threads:C}}),remove:r=>c(a=>{const l=a.inbox.filter(p=>p.id!==r),x=a.unread;return E(l,x,a.threads),{inbox:l,unread:x}})})),qe=[/\b(f+[\W_]*u+[\W_]*c+[\W_]*k+)\b/gi,/\b(s+[\W_]*h+[\W_]*i+[\W_]*t+)\b/gi,/\b(b+[\W_]*i+[\W_]*t+[\W_]*c+[\W_]*h+)\b/gi,/\b(a+[\W_]*s+[\W_]*s+[\W_]*h+[\W_]*o+[\W_]*l+[\W_]*e+)\b/gi,/\b(d+[\W_]*a+[\W_]*m+[\W_]*n+)\b/gi,/\b(c+[\W_]*r+[\W_]*a+[\W_]*p+)\b/gi,/\b(p+[\W_]*i+[\W_]*s+[\W_]*s+)\b/gi];function _e(c){return c.replace(/[\p{L}\p{N}]/gu,"*")}function Ie(c){if(!c)return c;let h=c;for(const r of qe)h=h.replace(r,a=>_e(a));return h}function Ue(c){if(!c)return"";const h=Math.floor((Date.now()-c)/1e3);if(h<60)return`${h}s ago`;const r=Math.floor(h/60);if(r<60)return`${r}m ago`;const a=Math.floor(r/60);return a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`}function Ge({user:c}){const h=(()=>{try{return $e()}catch{return null}})(),r=Re(),a=String(c?.email||"").toLowerCase(),[l,x]=o.useState([]),[p,j]=o.useState([]),[C,k]=o.useState([]),[T,K]=o.useState(""),[w,ue]=o.useState("all"),[A,$]=o.useState(!1),v=We(),[y,ge]=o.useState(null),[V,Y]=o.useState(""),Q=o.useRef(null),[X,be]=o.useState([]),[Z,fe]=o.useState([]),[q,ee]=o.useState({show:!1}),[n,R]=o.useState(null),[u,_]=o.useState(null),[te,D]=o.useState(null),[F,O]=o.useState("profile"),I=o.useCallback(async e=>{const s=String(e||"").toLowerCase();if(!(!a||!s||s===a))try{const m=await(await b(`/api/friends/thread?email=${encodeURIComponent(a)}&other=${encodeURIComponent(s)}`)).json();m?.ok&&Array.isArray(m.thread)&&v.loadThread(s,m.thread)}catch{}},[a,v]),U=o.useMemo(()=>{if(!y?.email)return[];const e=y.email.toLowerCase(),s=v.threads?.[e]?.messages;return Array.isArray(s)&&s.length?s:v.inbox.filter(i=>String(i.from||"").toLowerCase()===e).slice().sort((i,m)=>i.ts-m.ts)},[y?.email,v.inbox,v.threads]),pe=o.useMemo(()=>{const e=new Map;for(const s of v.inbox){const i=String(s.from||"").toLowerCase(),m=e.get(i);(!m||s.ts>m.ts)&&e.set(i,{ts:s.ts,message:s.message})}return e},[v.inbox]),ve=o.useMemo(()=>{const e=new Map,s=1e3*60*60*24*3,i=Date.now()-s;for(const m of v.inbox){if((m.ts||0)<i)continue;const f=String(m.from||"").toLowerCase();e.set(f,(e.get(f)||0)+1)}return e},[v.inbox]);async function N(){if(a){try{window.__ndnApiDisabled=!1,window.__ndnApiDisabledAt=0}catch{}try{const[e,s,i,m]=await Promise.all([b(`/api/friends/list?email=${encodeURIComponent(a)}`).then(f=>f.json()),b(`/api/friends/suggested?email=${encodeURIComponent(a)}`).then(f=>f.json()),b(`/api/friends/requests?email=${encodeURIComponent(a)}`).then(f=>f.json()),b(`/api/friends/outgoing?email=${encodeURIComponent(a)}`).then(f=>f.json())]);e.ok!==!1&&x(e.friends||[]),s.ok!==!1&&j(s.suggestions||[]),i.ok!==!1&&be(i.requests||[]),m.ok!==!1&&fe(m.requests||[])}catch{}}}o.useEffect(()=>{if(!a)return;let e=!1;async function s(){await N();for(let i=0;i<2;i++){if(e||(await new Promise(m=>setTimeout(m,3e3)),e))return;await N()}}return s(),()=>{e=!0}},[a]),o.useEffect(()=>{if(!a)return;const e=setInterval(()=>{N()},3e4);return()=>clearInterval(e)},[a]),o.useEffect(()=>{if(!h)return;const e=h.addListener(s=>{try{(s?.type==="friend-accepted"||s?.type==="friend-removed"||s?.type==="friend-request"||s?.type==="friend-declined")&&N()}catch{}});return()=>{try{e()}catch{}}},[h,a]),o.useEffect(()=>{a&&b(`/api/friends/messages?email=${encodeURIComponent(a)}`).then(e=>e.json()).then(e=>{e?.ok&&Array.isArray(e.messages)&&v.load(e.messages)}).catch(()=>{})},[a]),o.useEffect(()=>{y?.email&&I(y.email)},[y?.email,I]),o.useEffect(()=>{if(!y)return;const e=Q.current;e&&(e.scrollTop=e.scrollHeight)},[y?.email,U.length]);async function je(e){if(K(e),!e){k([]);return}try{const i=await(await b(`/api/friends/search?q=${encodeURIComponent(e)}&email=${encodeURIComponent(a)}`)).json();k(i.results||[])}catch{}}o.useEffect(()=>{if(!n){_(null),D(null);return}const e=n.username||"";n.avatar?D(n.avatar):e&&b(`/api/user/avatar/${encodeURIComponent(e)}`).then(s=>s.json()).then(s=>D(s.avatar||null)).catch(()=>D(null)),e&&b(`/api/user/stats/public/${encodeURIComponent(e)}`).then(s=>s.json()).then(s=>_(s.stats||null)).catch(()=>_(null))},[n?.email]),o.useEffect(()=>{n&&F==="chat"&&(ge({email:n.email,username:n.username}),I(n.email))},[n?.email,F]);async function se(e){if(!(!a||!e)){$(!0);try{await b("/api/friends/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,friend:e})}),await N(),K(""),k([]),r("Friend request sent",{type:"success"})}finally{$(!1)}}}async function we(e){if(!(!a||!e)){$(!0);try{await b("/api/friends/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,friend:e})}),await N(),r("Friend removed",{type:"info"})}finally{$(!1)}}}async function ae(e,s){try{await b("/api/friends/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,requestId:e,fromEmail:s})}),await N(),r("Friend request accepted",{type:"success"})}catch{r("Failed to accept request",{type:"error"})}}async function ye(e){try{await b("/api/friends/decline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,requestId:e})}),await N(),r("Friend request declined",{type:"info"})}catch{}}async function Ne(e){try{await b("/api/friends/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,requestId:e})}),await N(),r("Friend request cancelled",{type:"info"})}catch{}}async function Se(){const s=document.getElementById("message-input")?.value;if(!(!s||!q.toEmail))try{await b("/api/friends/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:a,toEmail:q.toEmail,message:s})}),ee({show:!1}),r("Message sent",{type:"success"})}catch{}}async function ne(){if(!a||!y?.email)return;const e=V.trim();if(e)try{await b("/api/friends/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:a,toEmail:y.email,message:e})});const s=Date.now(),i=`${s}-${Math.random().toString(36).slice(2,8)}`;v.pushThread(y.email,{id:i,from:a,to:String(y.email).toLowerCase(),message:e,ts:s,readBy:[a]}),Y(""),r("Message sent",{type:"success"})}catch{r("Failed to send message",{type:"error"})}}const P=o.useMemo(()=>w==="all"?l:l.filter(e=>(e.status||"offline")===w),[l,w]),J=o.useMemo(()=>{const e={online:0,ingame:0,offline:0};for(const s of l)s.status==="online"?e.online+=1:s.status==="ingame"?e.ingame+=1:e.offline+=1;return e},[l]);async function re(e){if(!e){r("Room unavailable",{type:"error"});return}try{const s=new CustomEvent("ndn:spectate-request",{detail:{roomId:e}});window.dispatchEvent(s),r("Opening spectator view...",{type:"info"})}catch{}}const{incomingRequests:ie,outgoingRequests:Ce,requestsCount:le}=o.useMemo(()=>{const e=String(a||"").toLowerCase(),s=[...X,...Z],i=new Set,m=s.filter(g=>{const S=g.id||`${g.fromEmail}|${g.toEmail}`;return i.has(S)?!1:(i.add(S),!0)}),f=m.filter(g=>String(g.fromEmail||"").toLowerCase()!==e),d=m.filter(g=>String(g.fromEmail||"").toLowerCase()===e);return{incomingRequests:f,outgoingRequests:d,requestsCount:f.length+d.length}},[a,X,Z]),B=c?.username||"Player 1",G=De(B),ke=Oe(B),oe=Le(B),Te=Object.values(oe).reduce((e,s)=>e+(s.played||0),0),Ae=Object.values(oe).reduce((e,s)=>e+(s.won||0),0);function Fe(e){R(e),O("profile")}function L(e){return e==="online"?"bg-emerald-400":e==="ingame"?"bg-amber-400":"bg-slate-500"}function M(e){return e==="online"?"Online":e==="ingame"?"In-Game":"Offline"}function W(e){return e==="online"?"text-emerald-400":e==="ingame"?"text-amber-400":"text-slate-500"}return t.jsxs("div",{className:"card ndn-game-shell ndn-page",style:{minHeight:"calc(100% + 100px)",paddingBottom:"100px"},children:[t.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2 ndn-section-title",children:"Friends ðŸ‘¥"}),t.jsx("p",{className:"mb-2 text-brand-600",children:"Manage your friends. See who's online, in-game, or offline; find new teammates; and invite people to play."}),t.jsx("div",{className:"grid gap-3 mb-4 grid-cols-2 sm:grid-cols-5",children:[{key:"all",label:"All",value:l.length,accent:"bg-white/5 border-white/20",activeAccent:"bg-indigo-500/20 border-indigo-500/50 ring-2 ring-indigo-500/30"},{key:"online",label:"Online",value:J.online,accent:"bg-emerald-500/10 border-emerald-500/40",activeAccent:"bg-emerald-500/20 border-emerald-500/60 ring-2 ring-emerald-500/30"},{key:"ingame",label:"In-Game",value:J.ingame,accent:"bg-amber-500/10 border-amber-500/40",activeAccent:"bg-amber-500/20 border-amber-500/60 ring-2 ring-amber-500/30"},{key:"offline",label:"Offline",value:J.offline,accent:"bg-slate-500/10 border-slate-500/40",activeAccent:"bg-slate-500/20 border-slate-500/60 ring-2 ring-slate-500/30"},{key:"requests",label:"Requests",value:le,accent:"bg-indigo-500/10 border-indigo-500/40",activeAccent:"bg-indigo-500/20 border-indigo-500/60 ring-2 ring-indigo-500/30"}].map(e=>t.jsxs("button",{type:"button",onClick:()=>{ue(e.key),R(null)},className:`rounded-2xl border px-3 py-2 text-center cursor-pointer transition-all ${w===e.key?e.activeAccent:e.accent} hover:scale-[1.02] active:scale-[0.98]`,children:[t.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:e.label}),t.jsx("div",{className:"text-2xl font-semibold text-white",children:e.value})]},e.key))}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-3 mb-4",children:[t.jsxs("div",{className:`${n?"hidden lg:block":"block"} lg:col-span-2 space-y-3`,children:[(w==="requests"||w==="all")&&le>0&&t.jsxs("div",{className:"p-4 rounded-[28px] bg-gradient-to-br from-slate-900/80 to-indigo-900/60 border border-white/10 shadow-2xl",children:[t.jsx("div",{className:"font-semibold text-white/90 mb-2",children:"Friend Requests"}),t.jsxs("ul",{className:"space-y-3",children:[ie.map(e=>t.jsxs("li",{className:"p-3 rounded-2xl border border-white/10 bg-slate-900/40 flex flex-col gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-semibold text-lg",children:e.fromUsername||e.fromEmail||"Unknown User"}),t.jsx("span",{className:"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded",children:"Incoming"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>ae(e.id,e.fromEmail),className:"px-3 py-1 rounded-lg bg-emerald-500/20 text-emerald-400 text-xs font-bold hover:bg-emerald-500/30 transition-colors",children:"Accept âœ…"}),t.jsx("button",{onClick:()=>ye(e.id),className:"px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 text-xs font-bold hover:bg-rose-500/30 transition-colors",children:"Decline âŒ"})]})]},`incoming-${e.id||e.fromEmail}`)),Ce.map(e=>t.jsxs("li",{className:"p-3 rounded-2xl border border-white/10 bg-slate-900/40 flex flex-col gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-semibold text-lg",children:e.toUsername||e.toEmail||"Unknown User"}),t.jsx("div",{className:"px-3 py-1 rounded-lg bg-white/5 text-white/40 text-xs font-bold",children:"Pending â³"})]}),t.jsx("button",{onClick:()=>Ne(e.id),className:"px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 text-xs font-bold hover:bg-rose-500/30 transition-colors w-fit",children:"Cancel âœ–ï¸"})]},`outgoing-${e.id||e.toEmail}`))]})]}),w!=="requests"&&t.jsxs("div",{className:"p-4 rounded-[28px] bg-gradient-to-br from-slate-900/80 to-indigo-900/60 border border-white/10 shadow-2xl",children:[t.jsx("div",{className:"font-semibold text-white/90 mb-3 flex items-center justify-between",children:t.jsxs("span",{children:[w==="all"?"All Friends":w==="online"?"Online Friends":w==="ingame"?"In-Game Friends":"Offline Friends"," ","(",P.length,")"]})}),P.length===0?t.jsx("div",{className:"text-sm text-slate-400 py-6 text-center",children:l.length===0?"No friends yet. Search below to add some!":`No ${w==="all"?"":w+" "}friends right now.`}):t.jsx("ul",{className:"space-y-2 max-h-[50vh] overflow-auto",children:P.map(e=>{const s=pe.get(e.email.toLowerCase()),i=ve.get(e.email.toLowerCase())||0,m=n?.email===e.email;return t.jsx("li",{children:t.jsx("button",{type:"button",onClick:()=>Fe(e),className:`w-full text-left p-3 rounded-2xl border transition-all cursor-pointer ${m?"border-indigo-500/60 bg-indigo-500/15 ring-1 ring-indigo-500/30":"border-white/10 bg-slate-900/40 hover:bg-slate-800/60 hover:border-white/20"}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"relative shrink-0",children:[e.avatar?t.jsx("img",{src:e.avatar,alt:"",className:"w-11 h-11 rounded-full object-cover border-2 border-white/20"}):t.jsx("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",children:(e.username||e.email||"?")[0].toUpperCase()}),t.jsx("span",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${L(e.status)}`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-semibold text-white truncate",children:e.username||e.email}),i>0&&t.jsx("span",{className:"shrink-0 bg-indigo-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center",children:i>9?"9+":i})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.jsx("span",{className:W(e.status),children:M(e.status)}),e.status==="ingame"&&e.match&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-slate-600",children:"â€¢"}),t.jsxs("span",{className:"text-amber-300 truncate",children:[e.match.game," ",H(e.match.mode)," ",e.match.value]})]}),e.threeDartAvg?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-slate-600",children:"â€¢"}),t.jsxs("span",{className:"text-indigo-300",children:["3DA: ",e.threeDartAvg.toFixed(1)]})]}):null]}),s&&t.jsx("div",{className:"text-[11px] text-slate-400 mt-0.5 truncate",children:s.message})]}),t.jsx("div",{className:"text-slate-500 shrink-0",children:"â€º"})]})})},e.email)})})]})]}),t.jsx("div",{className:`${n?"block":"hidden lg:block"} lg:col-span-3`,children:n?t.jsxs("div",{className:"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-2xl",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("button",{className:"lg:hidden px-3 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/80 text-xs font-bold",onClick:()=>R(null),children:"â† Back"}),t.jsxs("div",{className:"relative shrink-0",children:[te||n.avatar?t.jsx("img",{src:te||n.avatar||"",alt:"",className:"w-14 h-14 rounded-full object-cover border-2 border-white/20"}):t.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg border-2 border-white/20",children:(n.username||n.email||"?")[0].toUpperCase()}),t.jsx("span",{className:`absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-slate-950 ${L(n.status)}`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-bold text-lg text-white truncate",children:n.username||n.email}),t.jsxs("div",{className:`text-sm ${W(n.status)}`,children:[M(n.status),n.status==="ingame"&&n.match&&t.jsxs("span",{className:"text-amber-300 ml-2",children:["â€” ",n.match.game," ",H(n.match.mode)," ",n.match.value]}),n.status==="offline"&&n.lastSeen?t.jsxs("span",{className:"text-slate-500 ml-2",children:["â€” last seen ",Ue(n.lastSeen)]}):null]})]})]}),t.jsx("div",{className:"flex gap-1 mb-4 rounded-xl bg-white/5 p-1",children:["profile","chat","compare"].map(e=>t.jsx("button",{type:"button",onClick:()=>O(e),className:`flex-1 py-2 rounded-lg text-sm font-semibold transition-colors ${F===e?"bg-indigo-600 text-white":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:e==="profile"?"Profile":e==="chat"?"Chat ðŸ’¬":"Compare ðŸ“Š"},e))}),F==="profile"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-lg font-bold text-indigo-300",children:n.threeDartAvg?n.threeDartAvg.toFixed(1):u?.allTime&&u.allTime.darts?(u.allTime.scored/u.allTime.darts*3).toFixed(1):"â€”"}),t.jsx("div",{className:"text-[10px] text-slate-400",children:"3-Dart Avg"})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-lg font-bold text-yellow-300",children:u?.allTime?.num180s??"â€”"}),t.jsx("div",{className:"text-[10px] text-slate-400",children:"180s"})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-lg font-bold text-orange-300",children:u?.allTime?.bestCheckout??"â€”"}),t.jsx("div",{className:"text-[10px] text-slate-400",children:"High Checkout"})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-lg font-bold text-rose-300",children:u?.allTime?.bestLegDarts??"â€”"}),t.jsx("div",{className:"text-[10px] text-slate-400",children:"Best Leg"})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{onClick:()=>O("chat"),className:"px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold transition-colors",children:"ðŸ’¬ Message"}),n.status==="ingame"&&n.roomId&&t.jsx("button",{onClick:()=>re(n.roomId),className:"px-4 py-2 rounded-xl bg-amber-600 hover:bg-amber-500 text-white text-sm font-bold transition-colors",children:"ðŸ‘ï¸ Spectate"}),t.jsx("button",{onClick:()=>O("compare"),className:"px-4 py-2 rounded-xl bg-blue-600/80 hover:bg-blue-500 text-white text-sm font-bold transition-colors",children:"ðŸ“Š Compare Stats"}),t.jsx("button",{onClick:()=>{confirm(`Remove ${n.username||n.email} from friends?`)&&(we(n.email),R(null))},className:"px-4 py-2 rounded-xl bg-rose-500/20 hover:bg-rose-500/30 text-rose-400 text-sm font-bold transition-colors",children:"âœ– Remove"})]}),n.status==="ingame"&&n.match&&t.jsxs("div",{className:"rounded-xl border border-amber-500/30 bg-amber-500/10 p-3",children:[t.jsx("div",{className:"text-sm font-semibold text-amber-300 mb-1",children:"Currently Playing"}),t.jsxs("div",{className:"text-white font-bold",children:[n.match.game," ",H(n.match.mode)," ",n.match.value]}),n.roomId&&t.jsx("button",{onClick:()=>re(n.roomId),className:"mt-2 px-4 py-1.5 rounded-lg bg-amber-600 hover:bg-amber-500 text-white text-xs font-bold transition-colors",children:"Watch Live ðŸ‘ï¸"})]})]}),F==="chat"&&t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{ref:Q,className:"flex-1 min-h-[260px] max-h-[55vh] overflow-auto rounded-2xl border border-white/10 bg-black/20 p-3",children:U.length===0?t.jsx("div",{className:"text-sm text-slate-400 p-3",children:"No messages yet. Say hi ðŸ‘‹"}):t.jsx("ul",{className:"space-y-2",children:U.map(e=>{const s=String(e.from||"").toLowerCase()===a;return t.jsx("li",{className:s?"flex justify-end":"flex",children:t.jsxs("div",{className:s?"max-w-[95%] rounded-2xl bg-indigo-600/80 border border-indigo-300/20 px-3 py-2":"max-w-[95%] rounded-2xl bg-slate-900/60 border border-white/10 px-3 py-2",children:[t.jsxs("div",{className:"text-[10px] text-slate-300/80 mb-1 flex items-center justify-between gap-2",children:[t.jsx("span",{className:"font-bold",children:s?"You":n.username||n.email}),t.jsx("span",{className:"shrink-0",children:new Date(e.ts).toLocaleString()})]}),t.jsx("div",{className:"text-sm whitespace-pre-wrap break-words text-white/90",children:Ie(e.message)}),!s&&t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("button",{onClick:()=>v.remove(e.id),className:"px-3 py-1 rounded-lg bg-rose-500/15 text-rose-300 text-[11px] font-bold hover:bg-rose-500/25 transition-colors",children:"Delete ðŸ—‘ï¸"}),t.jsx("button",{className:"px-3 py-1 rounded-lg bg-rose-500/15 text-rose-300 text-[11px] font-bold hover:bg-rose-500/25 transition-colors",onClick:async()=>{const i=prompt("Report reason (what happened)?");if(i)try{await b("/api/friends/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reporterEmail:a,offenderEmail:e.from,reason:i,messageId:e.id})}),r("Report sent to admin",{type:"info"})}catch{}},children:"Report"})]})]})},e.id)})})}),t.jsxs("div",{className:"mt-3 rounded-2xl border border-white/10 bg-slate-900/30 p-3",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("textarea",{className:"w-full min-h-[44px] max-h-40 bg-slate-700/60 border border-slate-600 rounded-xl px-3 py-2 text-white placeholder-slate-400 resize-y",placeholder:`Message ${n.username||"friend"}...`,value:V,onChange:e=>Y(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),ne())}}),t.jsx("button",{onClick:ne,className:"px-5 py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-colors",children:"Send"})]}),t.jsx("div",{className:"mt-2 text-[11px] text-slate-400",children:"Tip: Press Enter to send, Shift+Enter for a new line."})]})]}),F==="compare"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-sm text-slate-400 mb-2",children:["Head-to-head comparison between you and"," ",n.username||"friend"]}),(()=>{const e=u?.allTime?.darts?u.allTime.scored/u.allTime.darts*3:n.threeDartAvg||0,s=u?.allTime?.num180s??0,i=u?.allTime?.bestCheckout??0,m=u?.allTime?.bestLegDarts??0,f=[{label:"3-Dart Average",mine:ke,theirs:e,format:d=>d?d.toFixed(1):"â€”",higher:!0},{label:"180s",mine:G.num180s||0,theirs:s,format:d=>String(d||"â€”"),higher:!0},{label:"Highest Checkout",mine:G.bestCheckout||0,theirs:i,format:d=>String(d||"â€”"),higher:!0},{label:"Best Leg (darts)",mine:G.bestLegDarts||0,theirs:m,format:d=>String(d||"â€”"),higher:!1},{label:"Games Played",mine:Te,theirs:u?.gameModes?Object.values(u.gameModes).reduce((d,g)=>d+(g.played||0),0):0,format:d=>String(d||"â€”"),higher:!0},{label:"Wins",mine:Ae,theirs:u?.gameModes?Object.values(u.gameModes).reduce((d,g)=>d+(g.won||0),0):0,format:d=>String(d||"â€”"),higher:!0}];return t.jsxs("div",{className:"rounded-xl border border-white/10 overflow-hidden",children:[t.jsxs("div",{className:"grid grid-cols-3 bg-white/5 px-4 py-2 text-xs font-bold text-slate-400 uppercase tracking-wide",children:[t.jsx("div",{children:"You"}),t.jsx("div",{className:"text-center",children:"Stat"}),t.jsx("div",{className:"text-right",children:n.username||"Friend"})]}),f.map(d=>{const g=Number(d.mine)||0,S=Number(d.theirs)||0,de=d.higher?g>S:g>0&&g<S,ce=d.higher?S>g:S>0&&S<g;return t.jsxs("div",{className:"grid grid-cols-3 px-4 py-3 border-t border-white/5 items-center",children:[t.jsxs("div",{className:`font-bold text-sm ${de?"text-emerald-400":"text-white"}`,children:[d.format(g),de&&t.jsx("span",{className:"ml-1 text-[10px]",children:"ðŸ†"})]}),t.jsx("div",{className:"text-center text-xs text-slate-400 font-medium",children:d.label}),t.jsxs("div",{className:`text-right font-bold text-sm ${ce?"text-emerald-400":"text-white"}`,children:[d.format(S),ce&&t.jsx("span",{className:"ml-1 text-[10px]",children:"ðŸ†"})]})]},d.label)})]})})(),!u&&t.jsxs("div",{className:"text-center text-sm text-slate-500 py-3",children:["No stats available for"," ",n.username||"this player"," yet."]})]})]}):t.jsxs("div",{className:"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-2xl hidden lg:flex flex-col items-center justify-center min-h-[400px] text-center gap-3",children:[t.jsx("div",{className:"text-4xl",children:"ðŸ‘†"}),t.jsx("div",{className:"text-lg font-semibold text-white/90",children:"Select a friend"}),t.jsx("div",{className:"text-sm text-slate-400 max-w-sm",children:"Click on a friend from the list to view their profile, send messages, compare stats, or spectate their game."})]})})]}),t.jsxs("div",{className:"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-xl",children:[t.jsx("div",{className:"font-semibold mb-2 text-white/90",children:"Find Friends"}),t.jsx("input",{className:"input w-full mb-2",placeholder:"Search by name or email",value:T,onChange:e=>je(e.target.value)}),t.jsxs("ul",{className:"space-y-2 mb-3 max-h-[320px] overflow-auto",children:[C.map(e=>t.jsxs("li",{className:"flex items-center gap-3 p-3 rounded-2xl border border-white/10 bg-slate-900/40",children:[t.jsxs("div",{className:"relative shrink-0",children:[e.avatar?t.jsx("img",{src:e.avatar,alt:"",className:"w-10 h-10 rounded-full object-cover border-2 border-white/20"}):t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",children:(e.username||e.email||"?")[0].toUpperCase()}),t.jsx("span",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${L(e.status)}`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold text-white truncate",children:e.username||e.email}),t.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2",children:[t.jsxs("span",{children:["3DA:"," ",t.jsx("span",{className:"text-indigo-300 font-semibold",children:e.threeDartAvg?e.threeDartAvg.toFixed(1):"â€”"})]}),t.jsx("span",{className:"text-slate-600",children:"â€¢"}),t.jsx("span",{className:W(e.status),children:M(e.status)})]})]}),t.jsx("div",{className:"shrink-0",children:e.relationship==="friend"?t.jsx("span",{className:"px-3 py-1.5 rounded-xl bg-emerald-500/20 text-emerald-400 text-xs font-bold",children:"Friends âœ“"}):e.relationship==="pending-outgoing"?t.jsx("span",{className:"px-3 py-1.5 rounded-xl bg-white/5 text-white/40 text-xs font-bold",children:"Pending â³"}):e.relationship==="pending-incoming"?t.jsx("button",{onClick:()=>{const s=ie.find(i=>i.fromEmail.toLowerCase()===e.email.toLowerCase());s&&ae(s.id,s.fromEmail)},className:"px-3 py-1.5 rounded-xl bg-emerald-500/20 text-emerald-400 text-xs font-bold hover:bg-emerald-500/30 transition-colors",children:"Accept âœ…"}):t.jsx("button",{onClick:()=>se(e.email),disabled:A,className:`px-3 py-1.5 rounded-xl text-white text-xs font-bold transition-colors ${A?"bg-indigo-900/40 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:A?"Workingâ€¦":"Add âž•"})})]},e.email)),C.length===0&&T&&t.jsxs("li",{className:"text-sm text-slate-400 text-center py-4",children:['No accounts found for "',T,'"']}),C.length===0&&!T&&t.jsx("li",{className:"text-xs opacity-60",children:"Type to search..."})]}),t.jsx("div",{className:"font-semibold mb-1 text-white/90",children:"Suggested"}),t.jsxs("ul",{className:"space-y-2 max-h-[280px] overflow-auto",children:[p.map(e=>t.jsxs("li",{className:"flex items-center gap-3 p-3 rounded-2xl border border-white/10 bg-slate-900/40",children:[t.jsxs("div",{className:"relative shrink-0",children:[e.avatar?t.jsx("img",{src:e.avatar,alt:"",className:"w-10 h-10 rounded-full object-cover border-2 border-white/20"}):t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20",children:(e.username||e.email||"?")[0].toUpperCase()}),t.jsx("span",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${L(e.status)}`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold text-white truncate",children:e.username||e.email}),t.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2",children:[t.jsxs("span",{children:["3DA:"," ",t.jsx("span",{className:"text-indigo-300 font-semibold",children:e.threeDartAvg?e.threeDartAvg.toFixed(1):"â€”"})]}),t.jsx("span",{className:"text-slate-600",children:"â€¢"}),t.jsx("span",{className:W(e.status),children:M(e.status)})]})]}),t.jsx("button",{onClick:()=>se(e.email),disabled:A,className:`shrink-0 px-3 py-1.5 rounded-xl text-white text-xs font-bold transition-colors ${A?"bg-indigo-900/40 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}`,children:A?"Workingâ€¦":"Add âž•"})]},e.email)),p.length===0&&t.jsx("li",{className:"text-xs opacity-60",children:"No suggestions right now."})]})]}),q.show&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4",children:[t.jsx("div",{className:"text-center mb-4",children:t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Send Message âœ‰ï¸"})}),t.jsx("textarea",{className:"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none",placeholder:"Type your message here...",id:"message-input",autoFocus:!0}),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsx("button",{onClick:Se,className:"px-6 py-2 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-colors",children:"Send Message ðŸ“¤"}),t.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700",onClick:()=>ee({show:!1}),children:"Cancel"})]})]})})]})}export{Ge as default};
//# sourceMappingURL=Friends-BtIw83iV.js.map

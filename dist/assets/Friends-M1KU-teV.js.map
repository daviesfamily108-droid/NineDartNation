{"version":3,"file":"Friends-M1KU-teV.js","sources":["../../src/components/Friends.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react'\r\nimport { useToast } from '../store/toast'\r\nimport { useMessages } from '../store/messages'\r\nimport { censorProfanity } from '../utils/profanity'\r\nimport TabPills from './ui/TabPills'\r\n\r\ntype Friend = { email: string, username?: string, status?: 'online'|'offline'|'ingame', lastSeen?: number, roomId?: string|null, match?: { game: string, mode: string, value: number, startingScore?: number } | null }\r\n\r\nfunction timeAgo(ts?: number) {\r\n  if (!ts) return ''\r\n  const s = Math.floor((Date.now() - ts) / 1000)\r\n  if (s < 60) return `${s}s ago`\r\n  const m = Math.floor(s/60)\r\n  if (m < 60) return `${m}m ago`\r\n  const h = Math.floor(m/60)\r\n  if (h < 24) return `${h}h ago`\r\n  const d = Math.floor(h/24)\r\n  return `${d}d ago`\r\n}\r\n\r\nexport default function Friends({ user }: { user?: any }) {\r\n  const toast = useToast()\r\n  const email = String(user?.email || '').toLowerCase()\r\n  const [friends, setFriends] = useState<Friend[]>([])\r\n  const [suggested, setSuggested] = useState<Friend[]>([])\r\n  const [results, setResults] = useState<Friend[]>([])\r\n  const [q, setQ] = useState('')\r\n  const [filter, setFilter] = useState<'all'|'online'|'offline'|'ingame'|'requests'>('all')\r\n  const [loading, setLoading] = useState(false)\r\n  const msgs = useMessages()\r\n  const [requests, setRequests] = useState<Array<{ id: string; fromEmail: string; fromUsername: string; toEmail: string; toUsername: string; requestedAt: number }>>([])\r\n  const [outgoingRequests, setOutgoingRequests] = useState<Array<{ id: string; fromEmail: string; fromUsername: string; toEmail: string; toUsername: string; requestedAt: number }>>([])\r\n  const [messagePopup, setMessagePopup] = useState<{ show: boolean; toUser?: string; toEmail?: string; replyTo?: string }>({ show: false })\r\n\r\n  async function refresh() {\r\n    if (!email) return\r\n    try {\r\n      const [fl, sg, rq, out] = await Promise.all([\r\n        fetch(`/api/friends/list?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/suggested?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/requests?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/outgoing?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n      ])\r\n      setFriends(fl.friends || [])\r\n      setSuggested(sg.suggestions || [])\r\n      setRequests(rq.requests || [])\r\n      setOutgoingRequests(out.requests || [])\r\n    } catch {}\r\n  }\r\n\r\n  useEffect(() => { refresh() }, [email])\r\n\r\n  async function search(term: string) {\r\n    setQ(term)\r\n    if (!term) { setResults([]); return }\r\n    try {\r\n      const res = await fetch(`/api/friends/search?q=${encodeURIComponent(term)}`)\r\n      const data = await res.json()\r\n      setResults(data.results || [])\r\n    } catch {}\r\n  }\r\n\r\n  async function addFriend(target: string) {\r\n    if (!email || !target) return\r\n    setLoading(true)\r\n    try {\r\n      await fetch('/api/friends/add', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, friend: target }) })\r\n      await refresh()\r\n      setQ(''); setResults([])\r\n      toast('Friend added', { type: 'success' })\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  async function removeFriend(target: string) {\r\n    if (!email || !target) return\r\n    setLoading(true)\r\n    try {\r\n      await fetch('/api/friends/remove', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, friend: target }) })\r\n      await refresh()\r\n      toast('Friend removed', { type: 'info' })\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  const filtered = useMemo(() => {\r\n    if (filter === 'all') return friends\r\n    return friends.filter(f => (f.status || 'offline') === filter)\r\n  }, [friends, filter])\r\n\r\n  async function spectate(roomId?: string|null) {\r\n    if (!roomId) { toast('Room unavailable', { type: 'error' }); return }\r\n    try {\r\n      const ev = new CustomEvent('ndn:spectate-request', { detail: { roomId } })\r\n      window.dispatchEvent(ev)\r\n      toast('Opening spectator view…', { type: 'info' })\r\n    } catch {}\r\n  }\r\n\r\n  // Friend Requests pill: use real requests data\r\n  const requestsCount = requests.length + outgoingRequests.length;\r\n  return (\r\n    <div className=\"card ndn-game-shell\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Friends</h2>\r\n      <p className=\"mb-2 text-brand-600\">Manage your friends. See who’s online, in-game, or offline; find new teammates; and invite people to play.</p>\r\n      <div className=\"text-xs opacity-70 mb-3\">Online: {friends.filter(f=>f.status==='online').length} · In-game: {friends.filter(f=>f.status==='ingame').length} · Offline: {friends.filter(f=>!f.status || f.status==='offline').length}</div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4\">\r\n        <div className=\"md:col-span-2 p-3 rounded-2xl bg-black/30 border border-white/10\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div className=\"font-semibold text-white/90\">Your Friends</div>\r\n          </div>\r\n          <TabPills\r\n            tabs={[\r\n              { key: 'all', label: 'All' },\r\n              { key: 'online', label: 'Online' },\r\n              { key: 'ingame', label: 'In-Game' },\r\n              { key: 'offline', label: 'Offline' },\r\n              { key: 'requests', label: `Requests ${requestsCount > 0 ? '(' + requestsCount + ')' : ''}` },\r\n            ]}\r\n            active={filter}\r\n            onChange={(k)=>setFilter(k as any)}\r\n            className=\"mb-3\"\r\n          />\r\n          {filter === 'requests' ? (\r\n            <ul className=\"space-y-2\">\r\n              {requestsCount > 0 ? (\r\n                <>\r\n                  {/* Incoming requests */}\r\n                  {requests.length > 0 && requests.map(r => (\r\n                    <li key={`incoming-${r.id || r.fromEmail}`} className=\"p-3 rounded bg-black/20 flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-semibold text-lg\">{r.fromUsername || r.fromEmail || 'Unknown User'}</span>\r\n                        <span className=\"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded\">Incoming</span>\r\n                      </div>\r\n                      <div className=\"flex gap-2\">\r\n                        <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={async()=>{\r\n                          setLoading(true)\r\n                          try {\r\n                            const res = await fetch('/api/friends/accept', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, requester: r.fromEmail }) })\r\n                            if (res.ok) {\r\n                              // Remove from requests and add to friends immediately for better UX\r\n                              setRequests(prev => prev.filter(req => req.id !== r.id))\r\n                              // Add to friends list (we'll get the full data on next refresh, but show basic info now)\r\n                              const newFriend = { email: r.fromEmail, username: r.fromUsername, status: 'offline' as const }\r\n                              setFriends(prev => [...prev, newFriend])\r\n                              // Also remove from outgoing if it exists\r\n                              setOutgoingRequests(prev => prev.filter(req => req.toEmail !== r.fromEmail))\r\n                              toast('Friend request accepted', { type: 'success' })\r\n                              // Refresh in background to get complete data\r\n                              setTimeout(() => refresh(), 100)\r\n                            } else {\r\n                              toast('Failed to accept request', { type: 'error' })\r\n                            }\r\n                          } catch (error) {\r\n                            toast('Error accepting request', { type: 'error' })\r\n                          } finally { setLoading(false) }\r\n                        }}>Accept</button>\r\n                        <button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={async()=>{\r\n                          setLoading(true)\r\n                          try {\r\n                            const res = await fetch('/api/friends/decline', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, requester: r.fromEmail }) })\r\n                            if (res.ok) {\r\n                              // Remove from requests immediately for better UX\r\n                              setRequests(prev => prev.filter(req => req.id !== r.id))\r\n                              // Also remove from outgoing if it exists\r\n                              setOutgoingRequests(prev => prev.filter(req => req.toEmail !== r.fromEmail))\r\n                              toast('Friend request declined', { type: 'info' })\r\n                              // Refresh in background to ensure consistency\r\n                              setTimeout(() => refresh(), 100)\r\n                            } else {\r\n                              toast('Failed to decline request', { type: 'error' })\r\n                            }\r\n                          } finally { setLoading(false) }\r\n                        }}>Decline</button>\r\n                      </div>\r\n                    </li>\r\n                  ))}\r\n                  {/* Outgoing requests */}\r\n                  {outgoingRequests.length > 0 && outgoingRequests.map(r => (\r\n                    <li key={`outgoing-${r.id || r.toEmail}`} className=\"p-3 rounded bg-black/20 flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-semibold text-lg\">{r.toUsername || r.toEmail || 'Unknown User'}</span>\r\n                        <span className=\"text-xs bg-amber-600/20 text-amber-400 px-2 py-1 rounded\">Pending</span>\r\n                      </div>\r\n                      <button className=\"btn bg-slate-600 hover:bg-slate-700 self-start\" onClick={async()=>{\r\n                        setLoading(true)\r\n                        try {\r\n                          const res = await fetch('/api/friends/cancel', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, friend: r.toEmail }) })\r\n                          if (res.ok) {\r\n                            // Remove from outgoing requests immediately for better UX\r\n                            setOutgoingRequests(prev => prev.filter(req => req.id !== r.id))\r\n                            toast('Friend request cancelled', { type: 'info' })\r\n                            // Refresh in background to ensure consistency\r\n                            setTimeout(() => refresh(), 100)\r\n                          } else {\r\n                            toast('Failed to cancel request', { type: 'error' })\r\n                          }\r\n                        } finally { setLoading(false) }\r\n                      }}>Cancel</button>\r\n                    </li>\r\n                  ))}\r\n                </>\r\n              ) : (\r\n                <li className=\"text-sm opacity-70\">No friend requests yet.</li>\r\n              )}\r\n            </ul>\r\n          ) : (\r\n            <ul className=\"space-y-2\">\r\n              {filtered.map(f => (\r\n                <li key={f.email} className=\"p-2 rounded bg-black/20 flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className={`inline-block w-2 h-2 rounded-full ${f.status==='online'?'bg-emerald-400':f.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                    <span className=\"font-semibold\">{f.username || f.email}</span>\r\n                    <span className=\"text-xs opacity-70\">{f.status || 'offline'}{(f.status!=='online' && f.lastSeen) ? ` · ${timeAgo(f.lastSeen)}` : ''}</span>\r\n                    {f.status==='ingame' && f.match && (\r\n                      <span className=\"text-[10px] opacity-70 px-2 py-0.5 rounded bg-indigo-500/20 border border-indigo-600/30\">{f.match.game} {f.match.mode==='firstto'?'FT':'BO'} {f.match.value}{f.match.game==='X01' && f.match.startingScore ? ` · ${f.match.startingScore}`:''}</span>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {f.status==='ingame' && f.roomId && (\r\n                      <button className=\"btn\" onClick={()=>spectate(f.roomId!)}>Spectate</button>\r\n                    )}\r\n                    <button className=\"btn\" disabled={loading || (f.status!=='online' && f.status!=='ingame')} onClick={async()=>{\r\n                      setLoading(true)\r\n                      try {\r\n                        const res = await fetch('/api/friends/invite', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ fromEmail: email, toEmail: f.email, game: 'X01', mode: 'bestof', value: 3, startingScore: 501 }) })\r\n                        const data = await res.json().catch(()=>({}))\r\n                        if (data?.delivered) toast('Invite sent', { type: 'success' })\r\n                        else toast('Friend is offline; invite queued', { type: 'info' })\r\n                      } finally { setLoading(false) }\r\n                    }}>Invite</button>\r\n                    <button className=\"btn\" disabled={loading} onClick={()=>setMessagePopup({ show: true, toUser: f.username || f.email, toEmail: f.email })}>Message</button>\r\n                    <button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={()=>removeFriend(f.email)}>Remove</button>\r\n                  </div>\r\n                </li>\r\n              ))}\r\n              {filtered.length === 0 && (\r\n                <li className=\"text-sm opacity-70\">No friends {filter !== 'all' ? `in ${filter}` : ''} yet.</li>\r\n              )}\r\n            </ul>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"p-3 rounded-2xl bg-black/20 border border-white/10\">\r\n          <div className=\"font-semibold mb-2 text-white/90\">Find Friends</div>\r\n          <input className=\"input w-full mb-2\" placeholder=\"Search by name or email\" value={q} onChange={e=>search(e.target.value)} />\r\n          <ul className=\"space-y-1 mb-3 max-h-48 overflow-auto\">\r\n            {results.map(r => (\r\n              <li key={r.email} className=\"flex items-center justify-between p-2 rounded bg-black/10\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className={`inline-block w-2 h-2 rounded-full ${r.status==='online'?'bg-emerald-400':r.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                  <span>{r.username || r.email}</span>\r\n                </div>\r\n                <button className=\"btn\" disabled={loading} onClick={()=>addFriend(r.email)}>Add</button>\r\n              </li>\r\n            ))}\r\n            {results.length === 0 && <li className=\"text-xs opacity-60\">Type to search…</li>}\r\n          </ul>\r\n          <div className=\"font-semibold mb-1 text-white/90\">Suggested</div>\r\n          <ul className=\"space-y-1 max-h-48 overflow-auto\">\r\n            {suggested.map(s => (\r\n              <li key={s.email} className=\"flex items-center justify-between p-2 rounded bg-black/10\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className={`inline-block w-2 h-2 rounded-full ${s.status==='online'?'bg-emerald-400':s.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                  <span>{s.username || s.email}</span>\r\n                </div>\r\n                <button className=\"btn\" disabled={loading} onClick={()=>addFriend(s.email)}>Add</button>\r\n              </li>\r\n            ))}\r\n            {suggested.length === 0 && <li className=\"text-xs opacity-60\">No suggestions right now.</li>}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Direct Messages */}\r\n      <div className=\"p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <div className=\"font-semibold\">Messages</div>\r\n          <button className=\"btn px-3 py-1 text-sm\" onClick={()=>msgs.markAllRead()}>Mark all read</button>\r\n        </div>\r\n        {msgs.inbox.length === 0 ? (\r\n          <div className=\"text-sm opacity-70\">No messages yet.</div>\r\n        ) : (\r\n          <ul className=\"space-y-2 max-h-72 overflow-auto\">\r\n            {msgs.inbox.map(m => (\r\n              <li key={m.id} className=\"p-2 rounded bg-black/20 text-sm\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div><span className=\"font-semibold\">{m.from}</span> <span className=\"opacity-70 text-xs\">· {new Date(m.ts).toLocaleString()}</span></div>\r\n                  <div className=\"flex gap-2\">\r\n                    <button className=\"btn px-2 py-1 text-xs\" onClick={()=>setMessagePopup({ show: true, toUser: m.from, toEmail: m.from, replyTo: m.from })}>Reply</button>\r\n                    <button className=\"btn bg-slate-700 hover:bg-slate-800 px-2 py-1 text-xs\" title=\"Delete this message\" onClick={()=>msgs.remove(m.id)}>Delete</button>\r\n                    <button className=\"btn bg-rose-600 hover:bg-rose-700 px-2 py-1 text-xs\" onClick={async()=>{\r\n                      const reason = prompt('Report reason (what happened)?')\r\n                      if (!reason) return\r\n                      try {\r\n                        await fetch('/api/friends/report', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ reporterEmail: email, offenderEmail: m.from, reason, messageId: m.id }) })\r\n                        toast('Report sent to admin', { type: 'info' })\r\n                      } catch {}\r\n                    }}>Report</button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"mt-1 whitespace-pre-wrap break-words\">{censorProfanity(m.message)}</div>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        )}\r\n      </div>\r\n\r\n      {/* Message Popup */}\r\n      {messagePopup.show && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4\">\r\n            <div className=\"text-center mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-white\">\r\n                Type Message To {messagePopup.toUser}\r\n              </h3>\r\n            </div>\r\n            <textarea\r\n              className=\"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none\"\r\n              placeholder=\"Type your message here...\"\r\n              id=\"message-input\"\r\n              autoFocus\r\n            />\r\n            <div className=\"flex gap-3 mt-4\">\r\n              <button\r\n                className=\"flex-1 btn bg-emerald-600 hover:bg-emerald-700\"\r\n                onClick={async () => {\r\n                  const input = document.getElementById('message-input') as HTMLTextAreaElement\r\n                  const message = input?.value?.trim()\r\n                  if (!message) return\r\n\r\n                  setLoading(true)\r\n                  try {\r\n                    await fetch('/api/friends/message', {\r\n                      method: 'POST',\r\n                      headers: { 'Content-Type': 'application/json' },\r\n                      body: JSON.stringify({\r\n                        fromEmail: email,\r\n                        toEmail: messagePopup.toEmail,\r\n                        message\r\n                      })\r\n                    })\r\n                    toast('Message sent', { type: 'success' })\r\n                    setMessagePopup({ show: false })\r\n                  } catch (error) {\r\n                    toast('Failed to send message', { type: 'error' })\r\n                  } finally {\r\n                    setLoading(false)\r\n                  }\r\n                }}\r\n                disabled={loading}\r\n              >\r\n                Send\r\n              </button>\r\n              <button\r\n                className=\"flex-1 btn bg-slate-600 hover:bg-slate-700\"\r\n                onClick={() => setMessagePopup({ show: false })}\r\n              >\r\n                Cancel\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}"],"names":["timeAgo","ts","s","m","h","Friends","user","toast","useToast","email","friends","setFriends","useState","suggested","setSuggested","results","setResults","q","setQ","filter","setFilter","loading","setLoading","msgs","useMessages","requests","setRequests","outgoingRequests","setOutgoingRequests","messagePopup","setMessagePopup","refresh","fl","sg","rq","out","r","useEffect","search","term","data","addFriend","target","removeFriend","filtered","useMemo","f","spectate","roomId","ev","requestsCount","jsxs","jsx","TabPills","k","Fragment","prev","req","newFriend","reason","censorProfanity","message"],"mappings":"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"}
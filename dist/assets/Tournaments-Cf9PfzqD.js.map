{"version":3,"file":"Tournaments-Cf9PfzqD.js","sources":["../../src/components/MatchCard.tsx","../../src/components/Tournaments.tsx"],"sourcesContent":["import React from \"react\";\nimport { labelForMode, type ModeKey } from \"../utils/games.js\";\n\ntype Tournament = {\n  id: string;\n  title: string;\n  game: string;\n  mode: ModeKey;\n  value: number;\n  startAt: number;\n  capacity: number;\n  participants: { email: string; username: string }[];\n  creatorName?: string;\n  creatorEmail?: string;\n  official?: boolean;\n};\n\nexport default function MatchCard({\n  t,\n  onJoin,\n  onLeave,\n  joined,\n  disabled,\n}: {\n  t: Tournament;\n  onJoin?: (t: any) => void;\n  onLeave?: (t: any) => void;\n  joined?: boolean;\n  disabled?: boolean;\n}) {\n  return (\n    <li className=\"p-3 rounded-xl border flex items-center justify-between relative ndn-lobby-card\">\n      <div className=\"space-y-0.5\">\n        <div className=\"font-semibold\">\n          {t.title}\n          {t.official && (\n            <span className=\"ml-2 inline-flex items-center px-2 py-0.5 rounded bg-amber-500 text-black text-xs\">\n              Official\n            </span>\n          )}\n        </div>\n        <div className=\"text-sm opacity-80\">\n          {t.game}\n          {t.game === \"X01\" ? `/501` : \"\"} ¬∑ {labelForMode(t.mode)} {t.value} ¬∑{\" \"}\n          {new Date(t.startAt).toLocaleString()} ¬∑ Cap {t.capacity} ¬∑ Joined{\" \"}\n          {t.participants?.length || 0}\n        </div>\n        <div className=\"text-xs opacity-60 mt-1\">\n          Created by: {t.creatorName || t.creatorEmail || \"Unknown\"}\n        </div>\n      </div>\n      <div className=\"flex items-center gap-2\">\n        <button\n          className={`btn ${joined ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n          disabled={disabled}\n          onClick={() => (joined ? onLeave && onLeave(t) : onJoin && onJoin(t))}\n        >\n          {joined ? \"Already Joined! ‚úÖ\" : \"Join Now ‚öîÔ∏è\"}\n        </button>\n      </div>\n    </li>\n  );\n}\n","import { useCallback, useEffect, useMemo, useState, useRef } from \"react\";\nimport {\n  getModeOptionsForGame,\n  labelForMode,\n  getGameDisplay,\n  getExtraFieldsForGame,\n  getValueLabelForGame,\n  getDefaultExtraValues,\n  gameConfig,\n  type GameKey,\n  type ModeKey,\n} from \"../utils/games.js\";\nimport { useMatch } from \"../store/match.js\";\nimport { useMatchControl } from \"../store/matchControl.js\";\nimport MatchCard from \"./MatchCard.js\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase.js\";\nimport InGameShell from \"./InGameShell.js\";\nimport MatchSummaryModal from \"./MatchSummaryModal.js\";\nimport { useToast } from \"../store/toast.js\";\nimport { useWS } from \"./WSProvider.js\";\nimport { apiFetch } from \"../utils/api.js\";\nimport { useUserSettings } from \"../store/userSettings.js\";\nimport { openMatchWindow } from \"../utils/matchWindow.js\";\n\ntype Tournament = {\n  id: string;\n  title: string;\n  game: string;\n  mode: ModeKey;\n  value: number;\n  description: string;\n  startAt: number;\n  checkinMinutes: number;\n  capacity: number;\n  participants: { email: string; username: string }[];\n  official?: boolean;\n  prize?: boolean;\n  prizeType?: \"premium\" | \"none\";\n  status: \"scheduled\" | \"running\" | \"completed\";\n  winnerEmail?: string | null;\n  startingScore?: number;\n  creatorEmail?: string;\n  creatorName?: string;\n};\n\nconst containsIntegrationMarker = (value: unknown) => {\n  if (typeof value === \"string\") {\n    return value.toLowerCase().includes(\"integration\");\n  }\n  if (typeof value === \"number\") {\n    return value.toString().toLowerCase().includes(\"integration\");\n  }\n  return false;\n};\n\nconst isIntegrationTournament = (t: Tournament) => {\n  if (!t) return false;\n  const candidates = [t.title, t.description, t.creatorName, t.creatorEmail];\n  return candidates.some((value) => containsIntegrationMarker(value));\n};\n\nconst isTouch =\n  typeof window !== \"undefined\" &&\n  (\"ontouchstart\" in window || navigator.maxTouchPoints > 0);\n\nexport default function Tournaments({ user }: { user: any }) {\n  const toast = useToast();\n  const wsGlobal = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  // Persisted match preferences (used when creating or joining)\n  const {\n    matchType: _matchType = \"singles\",\n    setMatchType: _setMatchType,\n    teamAName: _teamAName = \"Team A\",\n    setTeamAName: _setTeamAName,\n    teamBName: _teamBName = \"Team B\",\n    setTeamBName: _setTeamBName,\n  } = useUserSettings();\n  // Independent pages system ‚Äî each page has its own set of tournaments\n  const [currentPageIdx, setCurrentPageIdx] = useState(0);\n  const [pages, setPages] = useState(() => [\n    { id: 1, name: \"page-1\", pageId: \"default\" },\n  ]);\n  const activePageId = pages[currentPageIdx]?.pageId || \"default\";\n\n  const newPage = () => {\n    setPages((prev) => {\n      const id = prev.length + 1;\n      const newPages = [\n        ...prev,\n        { id, name: `page-${id}`, pageId: `page-${id}-${Date.now()}` },\n      ];\n      setCurrentPageIdx(newPages.length - 1);\n      return newPages;\n    });\n  };\n\n  const [list, setList] = useState<Tournament[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [errorMsg, setErrorMsg] = useState(\"\");\n  const [_fetchError, setFetchError] = useState<string | null>(null);\n  const [lastRefresh, setLastRefresh] = useState<number | null>(null);\n  const [cooldownUntil, setCooldownUntil] = useState<number | null>(null);\n  const [showCreate, setShowCreate] = useState(false);\n  const [showStartShowcase, setShowStartShowcase] = useState(false);\n  const _startedShowcasedRef = useRef(false);\n\n  const inProgress = useMatch((s) => s.inProgress);\n  const matchContext = useMatch((s) => s.matchContext);\n  const roomId = useMatch((s) => s.roomId);\n\n  // ‚îÄ‚îÄ Match summary modal (shown when a tournament match ends) ‚îÄ‚îÄ\n  const [showMatchSummary, setShowMatchSummary] = useState(false);\n  const [summaryPlayers, setSummaryPlayers] = useState<any[]>([]);\n  const prevInProgressRef = useRef(false);\n  const resultReportedRef = useRef<string | null>(null);\n  useEffect(() => {\n    if (\n      prevInProgressRef.current &&\n      !inProgress &&\n      matchContext === \"tournament\"\n    ) {\n      const st = useMatch.getState();\n      if (st.players && st.players.length > 0) {\n        setSummaryPlayers(JSON.parse(JSON.stringify(st.players)));\n        setShowMatchSummary(true);\n        // Report match result to the server for bracket advancement\n        const matchInfo = activeTournamentMatchRef.current;\n        if (matchInfo && wsGlobal?.connected) {\n          const reportKey = `${matchInfo.tournamentId}-r${matchInfo.round}-m${matchInfo.matchIndex}`;\n          if (resultReportedRef.current !== reportKey) {\n            resultReportedRef.current = reportKey;\n            // Determine winner: the player with most legs won\n            const winner = st.players.reduce((a: any, b: any) =>\n              (a.legsWon || 0) > (b.legsWon || 0) ? a : b,\n            );\n            const loser = st.players.find((p: any) => p !== winner);\n            const localEmail = String(user?.email || \"\").toLowerCase();\n            // Resolve email: match player1/player2 from the matchInfo\n            const isWinnerLocal =\n              winner.name?.toLowerCase() ===\n              (user?.username || \"\").toLowerCase();\n            const winnerEmail = isWinnerLocal\n              ? localEmail\n              : matchInfo.player1.email === localEmail\n                ? matchInfo.player2.email\n                : matchInfo.player1.email;\n            const loserEmail = isWinnerLocal\n              ? matchInfo.player1.email === localEmail\n                ? matchInfo.player2.email\n                : matchInfo.player1.email\n              : localEmail;\n            wsGlobal.send({\n              type: \"tournament-match-result\",\n              tournamentId: matchInfo.tournamentId,\n              round: matchInfo.round,\n              matchIndex: matchInfo.matchIndex,\n              winnerEmail,\n              winnerUsername: winner.name || \"Winner\",\n              loserEmail,\n            });\n          }\n        }\n      }\n    }\n    prevInProgressRef.current = inProgress;\n  }, [inProgress, matchContext, wsGlobal, user?.email, user?.username]);\n\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"tournament\") return;\n    try {\n      const st = useMatch.getState();\n      const game = ((st as any)?.game || \"X01\") as string;\n      if (game !== \"X01\") return;\n      if (!st.roomId) return;\n      const flagKey = `ndn:matchWindowOpened:${st.roomId}`;\n      if (window.sessionStorage.getItem(flagKey) === \"1\") return;\n      window.sessionStorage.setItem(flagKey, \"1\");\n      openMatchWindow();\n    } catch {}\n  }, [inProgress, matchContext, roomId]);\n\n  const [form, setForm] = useState({\n    title: \"\",\n    game: \"X01\" as string,\n    mode: \"bestof\",\n    value: 3,\n    description: \"\",\n    startAt: new Date().toISOString().slice(0, 16),\n    checkinMinutes: 15,\n    capacity: 16,\n    startingScore: 501,\n    requireCalibration: false,\n    extras: {} as Record<string, number>,\n  });\n\n  // Prestart / Bull Up Logic for Tournaments\n  const [joinMatch, setJoinMatch] = useState<any>(null);\n  const [joinTimer, setJoinTimer] = useState(30);\n  const [joinChoice, setJoinChoice] = useState<\"bull\" | \"skip\" | null>(null);\n  const [remoteChoices, setRemoteChoices] = useState<Record<string, string>>(\n    {},\n  );\n  const [_bullActive, setBullActive] = useState(false);\n  const [_bullThrown, setBullThrown] = useState(false);\n  const [_bullLocalThrow, setBullLocalThrow] = useState<any>(null);\n  const [_bullWinner, setBullWinner] = useState<string | null>(null);\n  const [leaveAsk, setLeaveAsk] = useState<{\n    open: boolean;\n    t: Tournament | null;\n  }>({ open: false, t: null });\n  const [deleteConfirm, setDeleteConfirm] = useState<{\n    open: boolean;\n    t: Tournament | null;\n  }>({ open: false, t: null });\n  // Track the active game mode for the current tournament match\n  const [currentGame, setCurrentGame] = useState<string>(\"X01\");\n  // Opponent quit notification\n  const [opponentQuitName, setOpponentQuitName] = useState<string | null>(null);\n  // Opponent camera frame ‚Äî use a ref to avoid React re-renders on every frame\n  const opponentFrameRef = useRef<string | null>(null);\n  const [opponentFrame, setOpponentFrame] = useState<string | null>(null);\n  const serverPrestartRef = useRef(false);\n  const _joinAcceptRef = useRef<HTMLButtonElement>(null);\n  const [participants, setParticipants] = useState<Record<string, string>>({});\n\n  // ‚îÄ‚îÄ Between-round waiting state ‚îÄ‚îÄ\n  const [tournamentWaiting, setTournamentWaiting] = useState<{\n    tournamentId: string;\n    nextRound: number;\n    waitEndsAt: number;\n  } | null>(null);\n  const [waitSecondsLeft, setWaitSecondsLeft] = useState(0);\n  const [tournamentComplete, setTournamentComplete] = useState<{\n    winnerUsername: string;\n    title: string;\n  } | null>(null);\n  // Track the current tournament match info for result reporting\n  const activeTournamentMatchRef = useRef<{\n    tournamentId: string;\n    round: number;\n    matchIndex: number;\n    player1: { email: string; username: string };\n    player2: { email: string; username: string };\n  } | null>(null);\n\n  // Listen for match-prestart and tournament-match-start events\n  useEffect(() => {\n    if (!wsGlobal) return;\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg?.type === \"match-prestart\") {\n          // Someone accepted the invite; show prestart and update join match if it matches\n          const m = msg.match || null;\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\n          // Ensure we know the creator's username\n          try {\n            if (m?.creatorId && m?.creatorName)\n              setParticipants((prev) => ({\n                ...prev,\n                [m.creatorId]: m.creatorName,\n              }));\n          } catch {}\n          serverPrestartRef.current = true;\n          setJoinMatch(m);\n          const endsAt = msg.prestartEndsAt || Date.now();\n          setJoinTimer(\n            Math.max(\n              0,\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\n            ),\n          );\n          setTimeout(() => {\n            serverPrestartRef.current = false;\n          }, 0);\n          // reset diffuse state\n          setJoinChoice(null);\n          setRemoteChoices({});\n          setBullActive(false);\n          setBullThrown(false);\n          setBullWinner(null);\n        }\n        if (msg?.type === \"match-start\") {\n          // If the started match matches our current join request, close the modal\n          if (joinMatch && msg.roomId === joinMatch.id) {\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setRemoteChoices({});\n          }\n        }\n        // Tournament bracket match start ‚Äî server paired us with an opponent\n        if (msg?.type === \"tournament-match-start\") {\n          try {\n            if (useMatch.getState().inProgress) return;\n            const localEmail = String(user?.email || \"\").toLowerCase();\n            const localName = user?.username || \"You\";\n            const p1 = msg.player1 || {};\n            const p2 = msg.player2 || {};\n            const isP1 =\n              localEmail && p1.email && p1.email.toLowerCase() === localEmail;\n            const opponentName = isP1\n              ? p2.username || \"Opponent\"\n              : p1.username || \"Opponent\";\n            const playerNames = isP1\n              ? [localName, opponentName]\n              : [opponentName, localName];\n            const startScore = msg.startingScore || 501;\n            const roomId = msg.roomId || \"\";\n            // Compute legsToWin from match format (bestof / firstto)\n            const tMode = msg.mode || \"bestof\";\n            const tValue = Number(msg.value || 1);\n            const tLegsToWin =\n              tMode === \"firstto\" ? tValue : Math.ceil(tValue / 2);\n            useMatch\n              .getState()\n              .newMatch(\n                playerNames,\n                startScore,\n                roomId,\n                \"tournament\",\n                tLegsToWin,\n              );\n            setCurrentGame(msg.game || \"X01\");\n            // Store match info for result reporting when match ends\n            activeTournamentMatchRef.current = {\n              tournamentId: msg.tournamentId,\n              round: msg.round,\n              matchIndex: msg.matchIndex,\n              player1: {\n                email: (p1.email || \"\").toLowerCase(),\n                username: p1.username || \"\",\n              },\n              player2: {\n                email: (p2.email || \"\").toLowerCase(),\n                username: p2.username || \"\",\n              },\n            };\n            resultReportedRef.current = null;\n            // Clear any waiting state since we're starting a new match\n            setTournamentWaiting(null);\n            setTournamentComplete(null);\n            // Join the WS room for state sync\n            if (wsGlobal?.connected && roomId) {\n              wsGlobal.send({ type: \"join\", roomId });\n            }\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setRemoteChoices({});\n          } catch (e) {\n            console.error(\"[Tournaments] tournament-match-start failed:\", e);\n          }\n        }\n        // Between-round waiting notification from server\n        if (msg?.type === \"tournament-waiting\") {\n          setTournamentWaiting({\n            tournamentId: msg.tournamentId,\n            nextRound: msg.nextRound,\n            waitEndsAt: msg.waitEndsAt,\n          });\n        }\n        // Tournament complete ‚Äî winner declared\n        if (msg?.type === \"tournament-complete\") {\n          setTournamentComplete({\n            winnerUsername: msg.winnerUsername || \"Unknown\",\n            title: msg.title || \"Tournament\",\n          });\n          setTournamentWaiting(null);\n          activeTournamentMatchRef.current = null;\n        }\n        // Skip wait acknowledged\n        if (msg?.type === \"tournament-skip-ack\") {\n          // Server acknowledged our skip ‚Äî just wait for tournament-match-start\n        }\n        // Match result acknowledged\n        if (msg?.type === \"tournament-match-result-ack\") {\n          // Result recorded by server\n        }\n        // Incoming match state from opponent ‚Äî sync scores/turns\n        if (msg?.type === \"state\" && msg.payload) {\n          try {\n            useMatch.getState().importState(msg.payload);\n          } catch {}\n        }\n        // Opponent camera frame snapshot ‚Äî update ref directly to bypass React re-renders\n        if (msg?.type === \"camera-frame\" && msg.frame) {\n          opponentFrameRef.current = msg.frame;\n          try {\n            const el = document.getElementById(\n              \"ndn-opponent-frame\",\n            ) as HTMLImageElement | null;\n            if (el) el.src = msg.frame;\n          } catch {}\n          if (!opponentFrame) setOpponentFrame(msg.frame);\n        }\n        // Opponent quit\n        if (msg?.type === \"opponent-quit\") {\n          setOpponentQuitName(msg.quitterName || \"Opponent\");\n        }\n        // Opponent paused\n        if (msg?.type === \"opponent-paused\") {\n          try {\n            useMatchControl\n              .getState()\n              .setPaused(true, null, msg.pauserName || \"Opponent\");\n          } catch {}\n        }\n        // Opponent resumed\n        if (msg?.type === \"opponent-unpaused\") {\n          try {\n            useMatchControl.getState().setPaused(false, null);\n          } catch {}\n        }\n        if (msg?.type === \"prestart-choice-notify\") {\n          const { roomId, playerId, choice } = msg;\n          if (!roomId || !choice) return;\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\n        }\n        if (msg?.type === \"prestart-bull\") {\n          setBullActive(true);\n          setBullThrown(false);\n          setBullLocalThrow(null);\n        }\n        if (msg?.type === \"prestart-bull-winner\") {\n          setBullWinner(msg.winnerId || null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n        if (msg?.type === \"prestart-bull-tie\") {\n          // reset to allow another round\n          setBullWinner(null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n      } catch (err) {}\n    });\n    return unsub;\n  }, [wsGlobal, joinChoice, joinMatch]);\n\n  // Join timer\n  useEffect(() => {\n    if (!joinMatch) return;\n    if (serverPrestartRef.current) return;\n    // If a server-supplied prestart exists, do not override joinTimer\n    if ((joinMatch as any).prestartEndsAt) return;\n    setJoinTimer(30);\n    setJoinChoice(null);\n    setRemoteChoices({});\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\n    return () => clearInterval(t);\n  }, [joinMatch]);\n\n  // Between-round wait countdown timer\n  useEffect(() => {\n    if (!tournamentWaiting) {\n      setWaitSecondsLeft(0);\n      return;\n    }\n    const tick = () => {\n      const remaining = Math.max(\n        0,\n        Math.ceil((tournamentWaiting.waitEndsAt - Date.now()) / 1000),\n      );\n      setWaitSecondsLeft(remaining);\n      if (remaining <= 0) {\n        setTournamentWaiting(null);\n      }\n    };\n    tick();\n    const iv = setInterval(tick, 1000);\n    return () => clearInterval(iv);\n  }, [tournamentWaiting]);\n\n  // Watch for match start (inProgress)\n  const match = useMatch((s) => ({\n    players: s.players,\n    currentPlayerIdx: s.currentPlayerIdx,\n    roomId: s.roomId,\n  }));\n  useEffect(() => {\n    if (!inProgress) return;\n    setShowStartShowcase(true);\n  }, [inProgress]);\n\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\n    setJoinChoice(choice);\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"prestart-choice\",\n          roomId: joinMatch.id,\n          choice,\n        });\n      }\n    } catch {}\n  };\n\n  const sendState = useCallback(() => {\n    try {\n      if (wsGlobal?.connected) {\n        const st = useMatch.getState();\n        wsGlobal.send({ type: \"state\", payload: st });\n      }\n    } catch {}\n  }, [wsGlobal]);\n\n  async function refresh() {\n    try {\n      // Avoid multiple quick refreshes which can cause load spikes\n      if (lastRefresh && Date.now() - lastRefresh < 3000) return;\n      const res = await apiFetch(\"/api/tournaments\");\n      const data = await res.json();\n      const newList = Array.isArray(data.tournaments) ? data.tournaments : [];\n      setList(newList);\n      try {\n        console.debug(\n          \"[Tournaments] refresh fetched\",\n          newList.length,\n          \"tournaments\",\n        );\n        console.log(\"[Tournaments] fetched list:\", newList);\n      } catch {}\n      setFetchError(null);\n      setLastRefresh(Date.now());\n    } catch (err: any) {\n      try {\n        if (typeof window !== \"undefined\") {\n          setFetchError(String(err?.message || err));\n        }\n      } catch {\n        if (typeof window !== \"undefined\") {\n          setFetchError(\"unknown\");\n        }\n      }\n    }\n  }\n  useEffect(() => {\n    refresh();\n  }, []);\n\n  // Re-fetch tournaments when we have a fresh WS connection so clients resync after reconnects/server restarts\n  useEffect(() => {\n    try {\n      if (wsGlobal?.connected) refresh();\n    } catch {}\n  }, [wsGlobal?.connected]);\n\n  // Listen for WS push updates from global provider if available\n  useEffect(() => {\n    if (!wsGlobal) return;\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg.type === \"tournaments\") {\n          setList(msg.tournaments || []);\n          setLastRefresh(Date.now());\n        }\n        if (msg.type === \"tournaments\") {\n          try {\n            console.debug(\n              \"[Tournaments] WS tournaments update, num=\",\n              (msg.tournaments || []).length,\n            );\n          } catch {}\n        }\n        if (msg.type === \"tournament-win\" && msg.message) {\n          toast(msg.message, { type: \"success\", timeout: 10000 }); // Show for 10 seconds\n        }\n        // tournament-reminder handled optionally here if desired\n      } catch {}\n    });\n    return () => {\n      unsub();\n    };\n  }, [wsGlobal?.connected]);\n\n  // If WS connects, ask for a fresh list via WS; this will prompt server to send a tournaments snapshot.\n  useEffect(() => {\n    try {\n      if (wsGlobal?.connected) {\n        try {\n          wsGlobal.send({ type: \"list-tournaments\" });\n        } catch {}\n        // Also ensure we refresh as a fallback\n        refresh();\n      }\n    } catch {}\n  }, [wsGlobal?.connected]);\n\n  // Polling fallback: if WS is unavailable, poll the API every 10s to keep lobby up-to-date\n  useEffect(() => {\n    let iv: number | null = null;\n    try {\n      if (!wsGlobal || !wsGlobal.connected) {\n        iv = window.setInterval(() => {\n          refresh();\n        }, 10000);\n      }\n    } catch {}\n    return () => {\n      if (iv) clearInterval(iv);\n    };\n  }, [wsGlobal?.connected]);\n\n  const email = String(user?.email || \"\").toLowerCase();\n\n  const hasJoined = useCallback(\n    (t: Tournament | null | undefined) => {\n      if (!t || !email) return false;\n      const ps = Array.isArray(t.participants) ? t.participants : [];\n      return ps.some((p) => String(p?.email || \"\").toLowerCase() === email);\n    },\n    [email],\n  );\n\n  const [prestartPreview, setPrestartPreview] = useState<Tournament | null>(\n    null,\n  );\n  const [dismissedPrestart, setDismissedPrestart] = useState<\n    Record<string, boolean>\n  >({});\n  const [prestartNow, setPrestartNow] = useState(() => Date.now());\n\n  const buildBracketPairs = useCallback((t: Tournament) => {\n    const names = (t.participants || []).map(\n      (p) => p.username || p.email || \"Player\",\n    );\n    const size = Math.max(\n      1,\n      2 ** Math.ceil(Math.log2(Math.max(1, names.length))),\n    );\n    // Standard tournament seeding: seed 1 vs seed N, seed 2 vs seed N-1, etc.\n    // This places BYEs opposite the top seeds so they get free passes.\n    const seeded: string[] = new Array(size).fill(\"BYE\");\n    for (let i = 0; i < names.length; i++) {\n      seeded[i] = names[i];\n    }\n    const pairs: Array<[string, string]> = [];\n    for (let i = 0; i < size / 2; i++) {\n      pairs.push([seeded[i], seeded[size - 1 - i]]);\n    }\n    return pairs;\n  }, []);\n\n  // Simple, persistent match preference UI\n  const MatchPrefs = () => (\n    <div className=\"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap\">\n      <span className=\"opacity-70\">Default match</span>\n      <span className=\"btn py-1 px-2 bg-indigo-500/30 border border-indigo-400/50 text-indigo-100\">\n        Singles\n      </span>\n      <span className=\"text-xs opacity-60 ml-2\">\n        (tournaments use Singles only)\n      </span>\n    </div>\n  );\n  // Fetch subscription to detect if user is a recent tournament winner (cooldown)\n  useEffect(() => {\n    let abort = false;\n    async function check() {\n      if (!email) {\n        setCooldownUntil(null);\n        return;\n      }\n      try {\n        const res = await apiFetch(\n          `/api/subscription?email=${encodeURIComponent(email)}`,\n        );\n        const data = await res.json();\n        if (!abort) {\n          if (\n            data?.source === \"tournament\" &&\n            typeof data.expiresAt === \"number\" &&\n            data.expiresAt > Date.now()\n          ) {\n            setCooldownUntil(data.expiresAt);\n          } else {\n            setCooldownUntil(null);\n          }\n        }\n      } catch {\n        if (!abort) setCooldownUntil(null);\n      }\n    }\n    check();\n    return () => {\n      abort = true;\n    };\n  }, [email]);\n\n  // Helper to delete a tournament with proper error handling and owner fallback\n  async function deleteTournament(t: Tournament) {\n    if (!email) return;\n    setDeleteConfirm({ open: true, t });\n  }\n\n  async function confirmDeleteTournament() {\n    const t = deleteConfirm.t;\n    if (!t || !email) return;\n    setDeleteConfirm({ open: false, t: null });\n    setLoading(true);\n    try {\n      // First try creator/owner shared endpoint\n      let res = await apiFetch(\"/api/tournaments/delete\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ tournamentId: t.id, requesterEmail: email }),\n      });\n\n      // If forbidden but user is the owner, try the admin endpoint as a fallback\n      if (\n        !res.ok &&\n        res.status === 403 &&\n        String(email) === \"daviesfamily108@gmail.com\"\n      ) {\n        res = await apiFetch(\"/api/admin/tournaments/delete\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ tournamentId: t.id, requesterEmail: email }),\n        });\n      }\n\n      if (!res.ok) {\n        let msg = \"Delete failed\";\n        try {\n          const data = await res.json();\n          if (data?.error) msg = `Delete failed: ${String(data.error)}`;\n        } catch {}\n        toast(msg, { type: \"error\" });\n        return;\n      }\n\n      toast(\"Tournament deleted\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function join(t: Tournament) {\n    if (!email) return;\n    setLoading(true);\n    try {\n      const res = await apiFetch(\"/api/tournaments/join\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          tournamentId: t.id,\n          email,\n          username: user?.username,\n        }),\n      });\n      if (!res.ok) {\n        let data: any = {};\n        try {\n          data = await res.json();\n        } catch {}\n        if (\n          data?.error === \"WINNER_COOLDOWN\" &&\n          typeof data.until === \"number\"\n        ) {\n          setErrorMsg(\n            `You're a recent NDN tournament winner. You can re-enter after ${fmt(data.until)}.`,\n          );\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          toast(\"Join blocked: winner cooldown active\", { type: \"error\" });\n        } else if (data?.error === \"ALREADY_IN_TOURNAMENT\") {\n          setErrorMsg(\n            String(\n              data.message || \"You can only join one tournament at a time.\",\n            ),\n          );\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          toast(\"Join blocked: already in another tournament\", {\n            type: \"error\",\n          });\n        } else if (data?.error) {\n          setErrorMsg(String(data.error));\n          setTimeout(() => setErrorMsg(\"\"), 3500);\n          toast(`Join failed: ${String(data.error)}`, { type: \"error\" });\n        }\n        return;\n      }\n      toast(\"Joined tournament\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function leave(t: Tournament) {\n    if (!email) return;\n    setLoading(true);\n    try {\n      const res = await apiFetch(\"/api/tournaments/leave\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ tournamentId: t.id, email }),\n      });\n      if (!res.ok) {\n        let data: any = {};\n        try {\n          data = await res.json();\n        } catch {}\n        if (data?.error) {\n          toast(`Leave failed: ${String(data.error)}`, { type: \"error\" });\n        } else if (res.status === 404) {\n          toast(\n            \"Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.\",\n            { type: \"error\" },\n          );\n        } else {\n          toast(\"Leave failed. Please try again.\", { type: \"error\" });\n        }\n        return;\n      }\n      toast(\"Left tournament\", { type: \"success\" });\n      // Optimistic local update\n      setList((prev) =>\n        prev.map((it) =>\n          it.id === t.id\n            ? {\n                ...it,\n                participants: (it.participants || []).filter(\n                  (p) => p.email !== email,\n                ),\n              }\n            : it,\n        ),\n      );\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function createTournament() {\n    setLoading(true);\n    try {\n      const start = new Date(form.startAt).getTime();\n      const res = await apiFetch(\"/api/tournaments/create\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          title: form.title,\n          game: form.game,\n          mode: form.mode,\n          value: Number(form.value),\n          description: form.description,\n          startAt: start,\n          checkinMinutes: Number(form.checkinMinutes),\n          capacity: Number(form.capacity),\n          startingScore:\n            form.game === \"X01\" ? Number(form.startingScore || 501) : undefined,\n          requireCalibration: !!form.requireCalibration,\n          creatorEmail: user?.email,\n          creatorName: user?.username,\n          pageId: activePageId,\n        }),\n      });\n      if (!res.ok) {\n        let details = \"\";\n        try {\n          const data = await res.json();\n          if (data?.error) details = String(data.error);\n          else if (data?.details) details = String(data.details);\n        } catch {}\n        const msg = details\n          ? `Create failed: ${details}`\n          : \"Create failed. Please try again.\";\n        setErrorMsg(msg);\n        toast(msg, { type: \"error\" });\n        setTimeout(() => setErrorMsg(\"\"), 6000);\n        return;\n      }\n      try {\n        const data = await res.json();\n        if (!data?.ok) {\n          const msg = data?.error\n            ? `Create failed: ${String(data.error)}`\n            : \"Create failed. Please try again.\";\n          setErrorMsg(msg);\n          toast(msg, { type: \"error\" });\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          return;\n        }\n      } catch {}\n      setShowCreate(false);\n      toast(\"Tournament created\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Close the create modal on Escape\n  useEffect(() => {\n    if (!showCreate) return;\n    const onKey = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") setShowCreate(false);\n    };\n    document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [showCreate]);\n\n  const visibleTournaments = useMemo(\n    () =>\n      list\n        .filter((t) => !isIntegrationTournament(t))\n        .filter(\n          (t) =>\n            (t as any).pageId === activePageId ||\n            (!(t as any).pageId && activePageId === \"default\"),\n        ),\n    [list, activePageId],\n  );\n  const official = useMemo(\n    () => visibleTournaments.filter((t) => t.official),\n    [visibleTournaments],\n  );\n  const community = useMemo(\n    () => visibleTournaments.filter((t) => !t.official),\n    [visibleTournaments],\n  );\n  const created = useMemo(\n    () =>\n      visibleTournaments.filter((t) => t.status === \"scheduled\" && !t.official),\n    [visibleTournaments],\n  );\n\n  useEffect(() => {\n    const check = () => {\n      const now = Date.now();\n      const upcoming = visibleTournaments.find((t) => {\n        if (!hasJoined(t)) return false;\n        if (t.status !== \"scheduled\") return false;\n        if (dismissedPrestart[t.id]) return false;\n        const delta = t.startAt - now;\n        return delta > 0 && delta <= 5 * 60 * 1000;\n      });\n      setPrestartPreview(upcoming ?? null);\n    };\n    check();\n    const id = window.setInterval(check, 15000);\n    return () => window.clearInterval(id);\n  }, [dismissedPrestart, hasJoined, visibleTournaments]);\n\n  useEffect(() => {\n    if (!prestartPreview) return;\n    setPrestartNow(Date.now());\n    const id = window.setInterval(() => setPrestartNow(Date.now()), 1000);\n    return () => window.clearInterval(id);\n  }, [prestartPreview]);\n\n  // Pagination for Created Game Lobby\n  const [createdPage, setCreatedPage] = useState(1);\n  const itemsPerPage = 16;\n  const createdTotalPages = Math.ceil(created.length / itemsPerPage);\n  const paginatedCreated = created.slice(\n    (createdPage - 1) * itemsPerPage,\n    createdPage * itemsPerPage,\n  );\n\n  // Pagination for Community List\n  const [communityPage, setCommunityPage] = useState(1);\n  const communityTotalPages = Math.ceil(community.length / itemsPerPage);\n  const paginatedCommunity = community.slice(\n    (communityPage - 1) * itemsPerPage,\n    communityPage * itemsPerPage,\n  );\n\n  const nextOfficial = useMemo(() => {\n    const upcoming = official\n      .filter((t) => t.status === \"scheduled\")\n      .sort((a, b) => a.startAt - b.startAt);\n    return upcoming[0] || null;\n  }, [official]);\n\n  function fmt(ts: number) {\n    const d = new Date(ts);\n    return d.toLocaleString();\n  }\n\n  const username = user?.username || \"You\";\n\n  // Stream local camera frames to opponent via WS at ~24 FPS for smooth video\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"tournament\") return;\n    if (!wsGlobal?.connected) return;\n    let alive = true;\n    const c = document.createElement(\"canvas\");\n    const ctx = c.getContext(\"2d\");\n    let lastSendTs = 0;\n    const FRAME_INTERVAL = 42; // ~24 FPS\n\n    const loop = () => {\n      if (!alive) return;\n      requestAnimationFrame(loop);\n      const now = performance.now();\n      if (now - lastSendTs < FRAME_INTERVAL) return;\n      try {\n        const dbg = (window as any).__ndn_camera_debug;\n        const video = dbg?.videoEl?.() as HTMLVideoElement | null;\n        if (!video || !video.videoWidth || !video.videoHeight) return;\n        const w = 480;\n        const h = Math.round((video.videoHeight / video.videoWidth) * w) || 270;\n        if (c.width !== w) c.width = w;\n        if (c.height !== h) c.height = h;\n        if (!ctx) return;\n        ctx.drawImage(video, 0, 0, w, h);\n        lastSendTs = now;\n        const frame = c.toDataURL(\"image/jpeg\", 0.55);\n        try {\n          wsGlobal.send({ type: \"camera-frame\", frame });\n        } catch {}\n      } catch {}\n    };\n    requestAnimationFrame(loop);\n    return () => {\n      alive = false;\n    };\n  }, [inProgress, matchContext, wsGlobal]);\n\n  // Clear opponent frame when match ends\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"tournament\") {\n      setOpponentFrame(null);\n    }\n  }, [inProgress, matchContext]);\n\n  // ‚îÄ‚îÄ When a tournament match is in progress, render the full in-game shell ‚îÄ‚îÄ\n  // Only show InGameShell if the match was started from Tournaments (context === 'tournament').\n  // This prevents offline or online matches from falsely rendering here.\n  if (inProgress && matchContext === \"tournament\") {\n    const matchState = useMatch.getState();\n    const localIdx = (matchState.players || []).findIndex(\n      (p: any) => p?.name && p.name.toLowerCase() === username.toLowerCase(),\n    );\n    return (\n      <>\n        <InGameShell\n          user={user}\n          showStartShowcase={showStartShowcase}\n          onShowStartShowcaseChange={setShowStartShowcase}\n          onCommitVisit={(score, _darts, _meta) => {\n            try {\n              const m = useMatch.getState();\n              const p = m.players[m.currentPlayerIdx];\n              const leg = p?.legs?.[p.legs.length - 1];\n              const preRem = leg ? leg.totalScoreRemaining : m.startingScore;\n              const postRem = Math.max(0, preRem - score);\n              const attempts = preRem <= 50 ? 3 : postRem <= 50 ? 1 : 0;\n              const finished = postRem === 0;\n              m.addVisit(score, 3, {\n                preOpenDarts: 0,\n                doubleWindowDarts: attempts,\n                finishedByDouble: finished,\n                visitTotal: score,\n              });\n              if (finished && score > 0) {\n                m.endLeg(score);\n              } else {\n                m.nextPlayer();\n              }\n            } catch {\n              useMatch.getState().addVisit(score, 3);\n              useMatch.getState().nextPlayer();\n            }\n            sendState();\n          }}\n          onQuit={() => {\n            try {\n              useMatch.getState().endGame();\n            } catch {}\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-quit\" });\n              }\n            } catch {}\n            setOpponentQuitName(null);\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setRemoteChoices({});\n            sendState();\n            try {\n              window.dispatchEvent(new Event(\"ndn:match-quit\"));\n            } catch {}\n          }}\n          onPause={() => {\n            try {\n              useMatchControl.getState().setPaused(true, null, username);\n            } catch {}\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-pause\" });\n              }\n            } catch {}\n          }}\n          onResume={() => {\n            try {\n              useMatchControl.getState().setPaused(false, null);\n            } catch {}\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-unpause\" });\n              }\n            } catch {}\n          }}\n          onStateChange={sendState}\n          localPlayerIndexOverride={localIdx >= 0 ? localIdx : undefined}\n          gameModeOverride={currentGame}\n          isOnline={true}\n          remoteFrame={opponentFrame}\n        />\n        {/* Opponent quit overlay */}\n        {opponentQuitName && (\n          <div className=\"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm\">\n            <div className=\"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl\">\n              <div className=\"text-4xl mb-3\">üö™</div>\n              <h3 className=\"text-lg font-bold text-white mb-2\">\n                {opponentQuitName} left the match\n              </h3>\n              <p className=\"text-sm text-white/60 mb-5\">\n                Your opponent has quit. You can leave the match now.\n              </p>\n              <button\n                className=\"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all\"\n                onClick={() => {\n                  try {\n                    useMatch.getState().endGame();\n                  } catch {}\n                  setOpponentQuitName(null);\n                  setJoinMatch(null);\n                  setJoinChoice(null);\n                  setRemoteChoices({});\n                  try {\n                    window.dispatchEvent(new Event(\"ndn:match-quit\"));\n                  } catch {}\n                }}\n              >\n                Leave Match\n              </button>\n            </div>\n          </div>\n        )}\n      </>\n    );\n  }\n\n  // ‚îÄ‚îÄ Tournament complete screen ‚îÄ‚îÄ\n  if (tournamentComplete) {\n    return (\n      <div\n        className=\"card ndn-game-shell ndn-page flex flex-col items-center justify-center min-h-[400px] text-center\"\n        style={{ paddingBottom: 80 }}\n      >\n        <div className=\"text-6xl mb-4\">üèÜ</div>\n        <h2 className=\"text-3xl font-black text-white mb-2\">\n          {tournamentComplete.title}\n        </h2>\n        <p className=\"text-xl text-emerald-400 font-bold mb-6\">\n          Winner: {tournamentComplete.winnerUsername}\n        </p>\n        {tournamentComplete.winnerUsername.toLowerCase() ===\n        username.toLowerCase() ? (\n          <p className=\"text-lg text-amber-300 font-semibold mb-8\">\n            üéâ Congratulations! You won the tournament!\n          </p>\n        ) : (\n          <p className=\"text-lg text-white/60 mb-8\">Better luck next time!</p>\n        )}\n        <button\n          className=\"px-8 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all\"\n          onClick={() => setTournamentComplete(null)}\n        >\n          Back to Tournaments\n        </button>\n      </div>\n    );\n  }\n\n  // ‚îÄ‚îÄ Between-round waiting screen ‚îÄ‚îÄ\n  if (tournamentWaiting) {\n    const mins = Math.floor(waitSecondsLeft / 60);\n    const secs = waitSecondsLeft % 60;\n    return (\n      <div\n        className=\"card ndn-game-shell ndn-page flex flex-col items-center justify-center min-h-[400px] text-center\"\n        style={{ paddingBottom: 80 }}\n      >\n        <div className=\"text-5xl mb-4\">‚è≥</div>\n        <h2 className=\"text-2xl font-bold text-white mb-2\">\n          Round {tournamentWaiting.nextRound} Starting Soon\n        </h2>\n        <p className=\"text-white/60 mb-6\">\n          Waiting for other matches to finish. Next round begins automatically.\n        </p>\n        <div className=\"text-4xl font-black text-white mb-8 tabular-nums\">\n          {mins}:{secs.toString().padStart(2, \"0\")}\n        </div>\n        <button\n          className=\"px-8 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all\"\n          onClick={() => {\n            if (wsGlobal?.connected) {\n              wsGlobal.send({\n                type: \"tournament-skip-wait\",\n                tournamentId: tournamentWaiting.tournamentId,\n              });\n            }\n            setTournamentWaiting(null);\n          }}\n        >\n          Skip Wait ‚Äî I'm Ready!\n        </button>\n        <p className=\"text-xs text-white/40 mt-4\">\n          All players must skip or timer must expire before the next round\n          starts.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"card ndn-game-shell ndn-page flex flex-col min-h-0\">\n      <div className=\"flex items-center justify-between mb-3\">\n        <h2 className=\"text-2xl font-bold ndn-section-title\">Tournaments üéØ</h2>\n      </div>\n      <div className=\"ndn-shell-body overflow-visible flex-1 min-h-0\">\n        {/* Page selector + Create Tournament header row */}\n        <div className=\"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap\">\n          <div className=\"flex items-center gap-3 flex-wrap min-w-0\">\n            <div className=\"text-sm text-white/70\">Page</div>\n            <div className=\"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium\">\n              Page {pages[currentPageIdx]?.id}\n            </div>\n            <button\n              className=\"btn btn-ghost btn-sm rounded-lg\"\n              onClick={newPage}\n            >\n              New Page\n            </button>\n          </div>\n          <div className=\"shrink-0 flex items-center gap-2\">\n            <button className=\"btn\" onClick={() => setShowCreate(true)}>\n              Create Tournament + üéØ\n            </button>\n          </div>\n        </div>\n        <MatchPrefs />\n        {/* Show overlay when a tournament match starts while on the tournaments page */}\n        {showStartShowcase && (\n          <MatchStartShowcase\n            players={(match.players || []) as any}\n            user={user}\n            onDone={() => setShowStartShowcase(false)}\n          />\n        )}\n        <div className=\"mb-2 text-sm font-semibold text-slate-300\">\n          World Lobby\n        </div>\n        {/* Created Game Lobby: show all created tournaments (scheduled) */}\n        <div className=\"mb-3 p-3 rounded-xl border border-indigo-500/20 bg-indigo-500/5\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"font-semibold\">Created Game Lobby</div>\n            <div className=\"text-xs opacity-60\">\n              All tournaments created by users and admins\n            </div>\n          </div>\n          <ul className=\"space-y-2\">\n            {created.length === 0 && (\n              <li className=\"text-sm opacity-60\">\n                No created tournaments yet.\n              </li>\n            )}\n            {paginatedCreated.map((t) => (\n              <MatchCard\n                key={t.id}\n                t={t}\n                onJoin={(m) => join(m)}\n                onLeave={(m) => leave(m)}\n                joined={hasJoined(t)}\n                disabled={\n                  loading ||\n                  t.status !== \"scheduled\" ||\n                  (!hasJoined(t) && t.participants.length >= t.capacity)\n                }\n              />\n            ))}\n          </ul>\n          {/* Pagination controls for Created Game Lobby */}\n          {createdTotalPages > 1 && (\n            <div className=\"mt-4 flex items-center justify-between text-sm\">\n              <button\n                className=\"text-slate-300 hover:text-white transition-colors\"\n                onClick={() => setCreatedPage((p) => Math.max(p - 1, 1))}\n                disabled={createdPage === 1}\n              >\n                &larr; Previous\n              </button>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-slate-400\">\n                  Page {createdPage} of {createdTotalPages}\n                </span>\n                <button\n                  className=\"text-slate-300 hover:text-white transition-colors\"\n                  onClick={() =>\n                    setCreatedPage((p) => Math.min(p + 1, createdTotalPages))\n                  }\n                  disabled={createdPage === createdTotalPages}\n                >\n                  Next &rarr;\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n        {/* Persistent banner for next official weekly tournament */}\n        {nextOfficial && (\n          <div className=\"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\n            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2\">\n              <div>\n                <div className=\"text-sm uppercase tracking-wide text-indigo-300 font-semibold\">\n                  Weekly Official Tournament üéØ\n                </div>\n                <div className=\"font-bold\">{nextOfficial.title}</div>\n                <div className=\"text-sm opacity-80\">\n                  {nextOfficial.game}\n                  {nextOfficial.game === \"X01\" && nextOfficial.startingScore\n                    ? `/${nextOfficial.startingScore}`\n                    : \"\"}{\" \"}\n                  ¬∑ {labelForMode(nextOfficial.mode)} {nextOfficial.value} ¬∑\n                  Starts {fmt(nextOfficial.startAt)} ¬∑ Cap{\" \"}\n                  {nextOfficial.capacity} ¬∑ Joined{\" \"}\n                  {nextOfficial.participants.length}\n                </div>\n                {nextOfficial.prize && (\n                  <div className=\"text-xs mt-1\">Prize: 3 months PREMIUM</div>\n                )}\n                {nextOfficial.status !== \"scheduled\" && (\n                  <div className=\"text-xs\">Status: {nextOfficial.status}</div>\n                )}\n                {cooldownUntil && cooldownUntil > Date.now() && (\n                  <div className=\"text-xs text-rose-300\">\n                    Recent winners can re-enter after {fmt(cooldownUntil)}.\n                  </div>\n                )}\n              </div>\n              <div className=\"shrink-0\">\n                <button\n                  className={`btn ${hasJoined(nextOfficial) ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n                  title={\n                    hasJoined(nextOfficial)\n                      ? \"Double-click to leave this tournament\"\n                      : nextOfficial.official &&\n                          cooldownUntil &&\n                          cooldownUntil > Date.now()\n                        ? `Recent winners can re-enter after ${fmt(cooldownUntil)}`\n                        : \"\"\n                  }\n                  disabled={\n                    loading ||\n                    nextOfficial.status !== \"scheduled\" ||\n                    (!hasJoined(nextOfficial) &&\n                      (nextOfficial.participants.length >=\n                        nextOfficial.capacity ||\n                        (!!cooldownUntil && cooldownUntil > Date.now())))\n                  }\n                  onClick={() => {\n                    if (!hasJoined(nextOfficial)) {\n                      join(nextOfficial);\n                    } else if (isTouch) {\n                      setLeaveAsk({ open: true, t: nextOfficial });\n                    }\n                  }}\n                  onDoubleClick={() => {\n                    if (!isTouch && hasJoined(nextOfficial))\n                      setLeaveAsk({ open: true, t: nextOfficial });\n                  }}\n                  aria-label={\n                    hasJoined(nextOfficial) ? \"Already Joined\" : \"Join Now\"\n                  }\n                >\n                  {hasJoined(nextOfficial)\n                    ? \"Already Joined! üéØ\"\n                    : \"Join Now üéØ\"}\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n        {errorMsg && (\n          <div className=\"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm\">\n            {errorMsg}\n          </div>\n        )}\n        <div className=\"space-y-4\">\n          <section>\n            <div className=\"font-semibold mb-1\">Official üéØ</div>\n            <div className=\"text-xs opacity-70 mb-2\">\n              {cooldownUntil && cooldownUntil > Date.now() ? (\n                <>\n                  You‚Äôre a recent NDN tournament winner ‚Äî to keep it fair, you\n                  can re-enter after {fmt(cooldownUntil)}.\n                </>\n              ) : (\n                <>\n                  Note: Weekly winners can re-enter once their 3 months of\n                  PREMIUM ends.\n                </>\n              )}\n            </div>\n            <ul className=\"space-y-2\">\n              {official.map((t) => (\n                <li\n                  key={t.id}\n                  className=\"p-3 rounded-lg border flex items-center justify-between relative\"\n                  style={{\n                    backgroundColor: `${getGameDisplay(t.game).color}10`,\n                    borderColor: `${getGameDisplay(t.game).color}30`,\n                  }}\n                >\n                  <div className=\"space-y-0.5\">\n                    <div className=\"font-semibold flex items-center gap-2\">\n                      <span\n                        className=\"px-2 py-0.5 rounded-full text-[10px] sm:text-xs border\"\n                        style={{\n                          backgroundColor: `${getGameDisplay(t.game).color}20`,\n                          color: getGameDisplay(t.game).color,\n                          borderColor: `${getGameDisplay(t.game).color}50`,\n                        }}\n                      >\n                        {getGameDisplay(t.game).emoji} {t.game}\n                      </span>\n                      {t.title}{\" \"}\n                      {t.prize && (\n                        <span className=\"inline-flex items-center gap-1 ml-2 align-middle\">\n                          <span className=\"text-xs px-2 py-0.5 rounded bg-amber-500 text-black\">\n                            Prize\n                          </span>\n                          <span\n                            className=\"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help\"\n                            title=\"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.\"\n                            aria-label=\"Prize info\"\n                          >\n                            i\n                          </span>\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"text-sm opacity-80\">\n                      {t.game}\n                      {t.game === \"X01\" && t.startingScore\n                        ? `/${t.startingScore}`\n                        : \"\"}{\" \"}\n                      ¬∑ {labelForMode(t.mode)} {t.value} ¬∑ {fmt(t.startAt)} ¬∑\n                      Cap {t.capacity} ¬∑ Joined {t.participants.length}\n                    </div>\n                    <div className=\"text-xs opacity-60\">\n                      {getGameDisplay(t.game).tagline}\n                    </div>\n                    {t.prize && (\n                      <div className=\"text-xs\">Prize: 3 months PREMIUM</div>\n                    )}\n                    {t.status !== \"scheduled\" && (\n                      <div className=\"text-xs\">Status: {t.status}</div>\n                    )}\n                    {hasJoined(t) && (\n                      <div className=\"text-xs text-emerald-400 font-semibold\">\n                        Already Joined\n                      </div>\n                    )}\n                    {t.official &&\n                      cooldownUntil &&\n                      cooldownUntil > Date.now() && (\n                        <div className=\"text-xs text-rose-300\">\n                          Cooldown active until {fmt(cooldownUntil)}.\n                        </div>\n                      )}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className={`btn ${hasJoined(t) ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n                      title={\n                        hasJoined(t)\n                          ? \"Double-click to leave this tournament\"\n                          : t.official &&\n                              cooldownUntil &&\n                              cooldownUntil > Date.now()\n                            ? `Recent winners can re-enter after ${fmt(cooldownUntil)}`\n                            : \"\"\n                      }\n                      disabled={\n                        loading ||\n                        t.status !== \"scheduled\" ||\n                        (!hasJoined(t) &&\n                          (t.participants.length >= t.capacity ||\n                            (t.official &&\n                              !!cooldownUntil &&\n                              cooldownUntil > Date.now())))\n                      }\n                      onClick={() => {\n                        if (!hasJoined(t)) {\n                          join(t);\n                        } else if (isTouch) {\n                          setLeaveAsk({ open: true, t });\n                        }\n                      }}\n                      onDoubleClick={() => {\n                        if (!isTouch && hasJoined(t))\n                          setLeaveAsk({ open: true, t });\n                      }}\n                      aria-label={hasJoined(t) ? \"Already Joined\" : \"Join Now\"}\n                    >\n                      {hasJoined(t) ? \"Already Joined! üéØ\" : \"Join Now üéØ\"}\n                    </button>\n                    {/* Delete button when you are the creator (owner-created official) and it hasn't started */}\n                    {t.status === \"scheduled\" &&\n                      email &&\n                      ((t.creatorEmail &&\n                        String(t.creatorEmail).toLowerCase() === email) ||\n                        email === \"daviesfamily108@gmail.com\") && (\n                        <button\n                          className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\n                          title=\"Delete this tournament\"\n                          onClick={() => deleteTournament(t)}\n                          aria-label=\"Delete tournament\"\n                        >\n                          √ó\n                        </button>\n                      )}\n                  </div>\n                </li>\n              ))}\n              {official.length === 0 && (\n                <li className=\"text-sm opacity-60\">\n                  No official tournaments yet.\n                </li>\n              )}\n            </ul>\n          </section>\n\n          <section>\n            <div className=\"font-semibold mb-1\">Community üéØ</div>\n            <ul className=\"space-y-2\">\n              {paginatedCommunity.map((t) => (\n                <li\n                  key={t.id}\n                  className=\"p-3 rounded-lg border flex items-center justify-between relative\"\n                  style={{\n                    backgroundColor: `${getGameDisplay(t.game).color}10`,\n                    borderColor: `${getGameDisplay(t.game).color}30`,\n                  }}\n                >\n                  <div className=\"space-y-0.5\">\n                    <div className=\"font-semibold flex items-center gap-2\">\n                      <span\n                        className=\"px-2 py-0.5 rounded-full text-[10px] sm:text-xs border\"\n                        style={{\n                          backgroundColor: `${getGameDisplay(t.game).color}20`,\n                          color: getGameDisplay(t.game).color,\n                          borderColor: `${getGameDisplay(t.game).color}50`,\n                        }}\n                      >\n                        {getGameDisplay(t.game).emoji} {t.game}\n                      </span>\n                      {t.title}\n                    </div>\n                    <div className=\"text-sm opacity-80\">\n                      {t.game}\n                      {t.game === \"X01\" && t.startingScore\n                        ? `/${t.startingScore}`\n                        : \"\"}{\" \"}\n                      ¬∑ {labelForMode(t.mode)} {t.value} ¬∑ {fmt(t.startAt)} ¬∑\n                      Cap {t.capacity} ¬∑ Joined {t.participants.length}\n                    </div>\n                    <div className=\"text-xs opacity-60\">\n                      {getGameDisplay(t.game).tagline}\n                    </div>\n                    {t.description && (\n                      <div className=\"text-xs opacity-80\">{t.description}</div>\n                    )}\n                    {hasJoined(t) && (\n                      <div className=\"text-xs text-emerald-400 font-semibold\">\n                        Already Joined\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className=\"btn\"\n                      title={\n                        hasJoined(t)\n                          ? \"Double-click to leave this tournament\"\n                          : \"\"\n                      }\n                      disabled={\n                        loading ||\n                        t.status !== \"scheduled\" ||\n                        (!hasJoined(t) && t.participants.length >= t.capacity)\n                      }\n                      onClick={() => {\n                        if (!hasJoined(t)) {\n                          join(t);\n                        } else if (isTouch) {\n                          setLeaveAsk({ open: true, t });\n                        }\n                      }}\n                      onDoubleClick={() => {\n                        if (!isTouch && hasJoined(t))\n                          setLeaveAsk({ open: true, t });\n                      }}\n                    >\n                      {hasJoined(t) ? \"Already Joined\" : \"Join Now\"}\n                    </button>\n                    {/* Delete button for creator to delete their own scheduled tournament */}\n                    {t.status === \"scheduled\" &&\n                      email &&\n                      ((t.creatorEmail &&\n                        String(t.creatorEmail).toLowerCase() === email) ||\n                        email === \"daviesfamily108@gmail.com\") && (\n                        <button\n                          className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\n                          title=\"Delete this tournament\"\n                          onClick={() => deleteTournament(t)}\n                          aria-label=\"Delete tournament\"\n                        >\n                          √ó\n                        </button>\n                      )}\n                  </div>\n                </li>\n              ))}\n              {community.length === 0 && (\n                <li className=\"text-sm opacity-60\">\n                  No community tournaments yet.\n                </li>\n              )}\n            </ul>\n            {/* Pagination Controls for Community */}\n            {communityTotalPages > 1 && (\n              <div className=\"flex items-center justify-center gap-2 mt-4 pt-2 border-t border-white/10\">\n                <button\n                  className=\"btn btn-sm btn-ghost\"\n                  disabled={communityPage === 1}\n                  onClick={() => setCommunityPage((p) => Math.max(1, p - 1))}\n                >\n                  Previous\n                </button>\n                <span className=\"text-sm opacity-70\">\n                  Page {communityPage} of {communityTotalPages}\n                </span>\n                <button\n                  className=\"btn btn-sm btn-ghost\"\n                  disabled={communityPage === communityTotalPages}\n                  onClick={() =>\n                    setCommunityPage((p) =>\n                      Math.min(communityTotalPages, p + 1),\n                    )\n                  }\n                >\n                  Next\n                </button>\n              </div>\n            )}\n          </section>\n        </div>\n\n        {prestartPreview && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"tournament-prestart-heading\"\n            className=\"fixed inset-0 z-[80] flex items-start justify-center pt-8 bg-black/70 p-4\"\n            onClick={(e) => {\n              if (e.target === e.currentTarget) {\n                setDismissedPrestart((prev) => ({\n                  ...prev,\n                  [prestartPreview.id]: true,\n                }));\n                setPrestartPreview(null);\n              }\n            }}\n          >\n            <div className=\"bg-slate-900 rounded-2xl p-6 max-w-2xl w-full max-h-[85vh] overflow-y-auto\">\n              <div className=\"flex items-center justify-between gap-3 mb-4\">\n                <div>\n                  <h3\n                    id=\"tournament-prestart-heading\"\n                    className=\"text-xl font-semibold\"\n                  >\n                    Bracket Preview\n                  </h3>\n                  <div className=\"text-sm opacity-70\">\n                    {prestartPreview.title} starts in{\" \"}\n                    {Math.max(\n                      0,\n                      Math.ceil((prestartPreview.startAt - prestartNow) / 1000),\n                    )}\n                    s\n                  </div>\n                </div>\n                <button\n                  className=\"btn btn-ghost\"\n                  onClick={() => {\n                    setDismissedPrestart((prev) => ({\n                      ...prev,\n                      [prestartPreview.id]: true,\n                    }));\n                    setPrestartPreview(null);\n                  }}\n                >\n                  Close\n                </button>\n              </div>\n              <div className=\"text-xs uppercase tracking-wide text-slate-400 mb-3\">\n                Round 1\n              </div>\n              <div className=\"space-y-2\">\n                {buildBracketPairs(prestartPreview).map((pair, idx) => (\n                  <div\n                    key={`${prestartPreview.id}-pair-${idx}`}\n                    className=\"flex items-center justify-between gap-3 rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm\"\n                  >\n                    <span className=\"font-semibold\">Match {idx + 1}</span>\n                    <span className=\"text-slate-200\">\n                      {pair[0]} vs {pair[1]}\n                    </span>\n                  </div>\n                ))}\n              </div>\n              <div className=\"mt-4 text-xs text-slate-400\">\n                Byes are shown so everyone can see their bracket position.\n              </div>\n            </div>\n          </div>\n        )}\n        {showCreate && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"create-tournament-heading\"\n            tabIndex={-1}\n            className=\"fixed inset-0 z-[70] flex items-start justify-center pt-8 bg-black/80 p-2 sm:p-6\"\n            onClick={(e) => {\n              if (e.target === e.currentTarget) setShowCreate(false);\n            }}\n          >\n            <div\n              className=\"rounded-2xl w-full sm:max-w-2xl max-h-[82vh] flex flex-col shadow-2xl border border-indigo-500/30 overflow-hidden\"\n              style={{ background: \"var(--ndn-card-bg, #0f172a)\" }}\n            >\n              {/* Header */}\n              <div\n                className=\"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20 shrink-0\"\n                style={{ background: \"var(--ndn-card-bg, #0f172a)\" }}\n              >\n                <h3\n                  id=\"create-tournament-heading\"\n                  className=\"text-sm sm:text-lg font-bold tracking-tight\"\n                >\n                  üéØ New Tournament\n                </h3>\n                <button\n                  className=\"w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors\"\n                  onClick={() => setShowCreate(false)}\n                  aria-label=\"Close\"\n                >\n                  ‚úï\n                </button>\n              </div>\n              {/* Scrollable form */}\n              <div\n                className=\"flex-1 overflow-y-auto px-4 py-3 space-y-3\"\n                style={{ background: \"var(--ndn-card-bg, #0f172a)\" }}\n              >\n                {/* Title */}\n                <div>\n                  <label className=\"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n                    Title\n                  </label>\n                  <input\n                    className=\"input w-full text-sm\"\n                    value={form.title}\n                    onChange={(e) =>\n                      setForm((f) => ({ ...f, title: e.target.value }))\n                    }\n                    placeholder=\"e.g. Friday Night 501\"\n                  />\n                </div>\n                {/* Game settings row */}\n                <div>\n                  <label className=\"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n                    Game Settings\n                  </label>\n                  <div className=\"grid grid-cols-3 gap-1.5\">\n                    <div>\n                      <select\n                        className=\"input w-full text-xs\"\n                        value={form.game}\n                        onChange={(e) => {\n                          const g = e.target.value as GameKey;\n                          const cfg = gameConfig[g];\n                          const validMode = cfg?.modeOptions?.includes(\n                            form.mode as ModeKey,\n                          )\n                            ? form.mode\n                            : (cfg?.modeOptions?.[0] ?? \"bestof\");\n                          setForm((f) => ({\n                            ...f,\n                            game: g,\n                            mode: validMode,\n                            extras: getDefaultExtraValues(g),\n                            startingScore:\n                              cfg?.startOptions?.[0] ?? f.startingScore,\n                          }));\n                        }}\n                      >\n                        {/* Only X01 is available for tournaments for now */}\n                        <option value=\"X01\">\n                          {getGameDisplay(\"X01\").emoji} X01\n                        </option>\n                      </select>\n                      <div\n                        className=\"text-[9px] mt-0.5 px-0.5\"\n                        style={{ color: getGameDisplay(form.game).color }}\n                      >\n                        {getGameDisplay(form.game).tagline || \"Game\"}\n                      </div>\n                    </div>\n                    <div>\n                      <select\n                        className=\"input w-full text-xs\"\n                        value={form.mode}\n                        onChange={(e) =>\n                          setForm((f) => ({\n                            ...f,\n                            mode: e.target.value as any,\n                          }))\n                        }\n                      >\n                        {getModeOptionsForGame(\n                          form.game as import(\"../utils/games.js\").GameKey,\n                        )\n                          .filter((o) => o !== \"all\")\n                          .map((o) => (\n                            <option key={String(o)} value={String(o)}>\n                              {labelForMode(String(o))}\n                            </option>\n                          ))}\n                      </select>\n                      <div className=\"text-[9px] text-slate-500 mt-0.5 px-0.5\">\n                        Mode\n                      </div>\n                    </div>\n                    <div>\n                      <input\n                        className=\"input w-full text-xs\"\n                        type=\"number\"\n                        min={1}\n                        value={form.value}\n                        onChange={(e) =>\n                          setForm((f) => ({\n                            ...f,\n                            value: Number(e.target.value),\n                          }))\n                        }\n                        placeholder=\"0\"\n                      />\n                      <div className=\"text-[9px] text-slate-500 mt-0.5 px-0.5\">\n                        {getValueLabelForGame(\n                          form.game as GameKey,\n                          form.mode as ModeKey,\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                {/* Description */}\n                <div>\n                  <label className=\"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n                    Description\n                  </label>\n                  <textarea\n                    className=\"input w-full text-xs\"\n                    rows={2}\n                    value={form.description}\n                    onChange={(e) =>\n                      setForm((f) => ({ ...f, description: e.target.value }))\n                    }\n                    placeholder=\"Optional details‚Ä¶\"\n                  />\n                </div>\n                {/* Schedule ‚Äî stacked on mobile, side-by-side on sm+ */}\n                <div>\n                  <label className=\"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n                    Schedule\n                  </label>\n                  <div className=\"space-y-1.5 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-2\">\n                    <div>\n                      <input\n                        className=\"input w-full text-xs\"\n                        type=\"datetime-local\"\n                        value={form.startAt}\n                        onChange={(e) =>\n                          setForm((f) => ({ ...f, startAt: e.target.value }))\n                        }\n                      />\n                      <div className=\"text-[9px] text-slate-500 mt-0.5 px-0.5\">\n                        Start time\n                      </div>\n                    </div>\n                    <div>\n                      <input\n                        className=\"input w-full text-xs\"\n                        type=\"number\"\n                        min={0}\n                        value={form.checkinMinutes}\n                        onChange={(e) =>\n                          setForm((f) => ({\n                            ...f,\n                            checkinMinutes: Number(e.target.value),\n                          }))\n                        }\n                      />\n                      <div className=\"text-[9px] text-slate-500 mt-0.5 px-0.5\">\n                        Check-in (min)\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                {/* Per-game extra config fields */}\n                {getExtraFieldsForGame(form.game as GameKey).length > 0 && (\n                  <div>\n                    <label className=\"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n                      {form.game} Settings\n                    </label>\n                    <div className=\"grid grid-cols-2 gap-1.5\">\n                      {getExtraFieldsForGame(form.game as GameKey).map((f) => (\n                        <div key={f.key}>\n                          {f.type === \"select\" && f.options ? (\n                            <select\n                              className=\"input w-full text-xs\"\n                              value={form.extras[f.key] ?? f.defaultValue}\n                              onChange={(e) =>\n                                setForm((prev) => ({\n                                  ...prev,\n                                  extras: {\n                                    ...prev.extras,\n                                    [f.key]: Number(e.target.value),\n                                  },\n                                }))\n                              }\n                            >\n                              {f.options.map((o) => (\n                                <option key={o} value={o}>\n                                  {o}\n                                </option>\n                              ))}\n                            </select>\n                          ) : (\n                            <input\n                              className=\"input w-full text-xs\"\n                              type=\"number\"\n                              min={f.min ?? 1}\n                              max={f.max}\n                              step={f.step ?? 1}\n                              value={form.extras[f.key] ?? f.defaultValue}\n                              onChange={(e) =>\n                                setForm((prev) => ({\n                                  ...prev,\n                                  extras: {\n                                    ...prev.extras,\n                                    [f.key]: Number(e.target.value),\n                                  },\n                                }))\n                              }\n                            />\n                          )}\n                          <div className=\"text-[9px] text-slate-500 mt-0.5 px-0.5\">\n                            {f.label}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n                {/* Score & Capacity row */}\n                <div>\n                  <label className=\"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n                    Players\n                  </label>\n                  <div className=\"grid grid-cols-2 gap-1.5\">\n                    {(gameConfig[form.game as GameKey]?.startOptions ?? [])\n                      .length > 0 ? (\n                      <div>\n                        <select\n                          className=\"input w-full text-xs\"\n                          value={String(form.startingScore)}\n                          onChange={(e) =>\n                            setForm((f) => ({\n                              ...f,\n                              startingScore: Number(e.target.value),\n                            }))\n                          }\n                        >\n                          {(\n                            gameConfig[form.game as GameKey]?.startOptions ?? [\n                              301, 501, 701,\n                            ]\n                          ).map((s) => (\n                            <option key={s} value={s}>\n                              {s}\n                            </option>\n                          ))}\n                        </select>\n                        <div className=\"text-[9px] text-slate-500 mt-0.5 px-0.5\">\n                          Starting score\n                        </div>\n                      </div>\n                    ) : (\n                      <div />\n                    )}\n                    <div>\n                      <input\n                        className=\"input w-full text-xs\"\n                        type=\"number\"\n                        min={6}\n                        max={64}\n                        value={form.capacity}\n                        onChange={(e) =>\n                          setForm((f) => ({\n                            ...f,\n                            capacity: Number(e.target.value),\n                          }))\n                        }\n                      />\n                      <div className=\"text-[9px] text-slate-500 mt-0.5 px-0.5\">\n                        Max players\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                {/* Camera toggle */}\n                <div className=\"flex items-center gap-3 rounded-lg bg-indigo-500/10 border border-indigo-500/20 px-3 py-2\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"accent-purple-500 w-4 h-4 shrink-0\"\n                    checked={!!form.requireCalibration}\n                    onChange={(e) =>\n                      setForm((f) => ({\n                        ...f,\n                        requireCalibration: !!e.target.checked,\n                      }))\n                    }\n                    id=\"require-camera\"\n                  />\n                  <label\n                    htmlFor=\"require-camera\"\n                    className=\"text-xs leading-tight\"\n                  >\n                    <span className=\"font-semibold\">Require Camera</span>\n                    <span className=\"block text-[10px] text-slate-400 mt-0.5\">\n                      Players must have a camera to join\n                    </span>\n                  </label>\n                </div>\n                <div className=\"text-[10px] text-slate-500 text-center pb-1\">\n                  Community tournaments do not award prizes.\n                </div>\n              </div>\n              {/* Footer */}\n              <div\n                className=\"flex gap-2 px-4 py-3 border-t border-indigo-500/20 shrink-0\"\n                style={{ background: \"var(--ndn-card-bg, #0f172a)\" }}\n              >\n                <button\n                  className=\"flex-1 btn btn-ghost text-xs\"\n                  onClick={() => setShowCreate(false)}\n                >\n                  Cancel\n                </button>\n                <button\n                  className=\"flex-1 btn text-xs\"\n                  disabled={loading}\n                  onClick={createTournament}\n                >\n                  {loading ? \"Creating‚Ä¶\" : \"Create Tournament\"}\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Join Modal (simplified) */}\n        {joinMatch && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"join-heading\"\n            tabIndex={-1}\n            className=\"fixed inset-0 z-60 flex items-start justify-center pt-8 bg-black/60 p-4\"\n          >\n            <div className=\"bg-slate-800 rounded-2xl p-6 max-w-md w-full\">\n              <div id=\"join-heading\" className=\"text-lg font-bold mb-2\">\n                Match Ready\n              </div>\n              <div className=\"mb-3\">\n                {joinMatch.game} - {joinMatch.modeType} ¬∑ {joinMatch.legs} legs\n              </div>\n              <div className=\"text-sm opacity-80 mb-3\">\n                Created by {joinMatch.createdBy}\n              </div>\n              {joinMatch.startingScore && (\n                <div className=\"mb-3\">\n                  Starting score:{\" \"}\n                  <span className=\"font-mono\">{joinMatch.startingScore}</span>\n                </div>\n              )}\n              {/* Match start showcase overlay */}\n              <MatchStartShowcase\n                open={showStartShowcase}\n                players={match.players as any}\n                user={user}\n                onRequestClose={() => {}}\n                onDone={() => {}}\n              />\n              <div className=\"mb-3\">\n                Timer: <span className=\"font-mono\">{joinTimer}s</span>\n              </div>\n              {(joinTimer <= 15 || (joinMatch as any)?.prestartEndsAt) && (\n                <div className=\"mb-3\">\n                  Choose:{\" \"}\n                  <div className=\"flex gap-2\">\n                    <button\n                      className={`btn ${joinChoice === \"bull\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"bull\")}\n                    >\n                      Bull Up\n                    </button>\n                    <button\n                      className={`btn ${joinChoice === \"skip\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"skip\")}\n                    >\n                      Skip\n                    </button>\n                  </div>\n                  <div className=\"text-xs opacity-70 mt-2\">\n                    {joinChoice\n                      ? `You chose: ${joinChoice}`\n                      : \"Please choose Bull Up or Skip before accepting\"}\n                  </div>\n                  {Object.keys(remoteChoices).length > 0 && (\n                    <div\n                      className=\"text-xs opacity-70 mt-2\"\n                      role=\"status\"\n                      aria-live=\"polite\"\n                    >\n                      {Object.entries(remoteChoices).map(([pid, choice]) => (\n                        <div key={pid}>\n                          {participants[pid] || pid} chose: {choice}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  {joinChoice === \"skip\" && (\n                    <div className=\"text-xs opacity-70 mt-2\">\n                      Skip requires both players to click Skip. Waiting for\n                      opponent...\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {leaveAsk.open && leaveAsk.t && (\n          <div className=\"fixed inset-0 z-50 flex items-start justify-center pt-8\">\n            <div\n              className=\"absolute inset-0 bg-black/40\"\n              onClick={() => setLeaveAsk({ open: false, t: null })}\n            />\n            <div className=\"relative card p-4 w-[360px] max-w-[90vw]\">\n              <div className=\"text-lg font-semibold mb-2\">\n                Leave tournament?\n              </div>\n              <div className=\"text-sm opacity-80 mb-4\">\n                Are you sure you want to remove yourself from ‚Äú\n                {leaveAsk.t.title}‚Äù?\n              </div>\n              <div className=\"flex items-center justify-end gap-2\">\n                <button\n                  className=\"btn bg-rose-600 hover:bg-rose-700\"\n                  onClick={() => setLeaveAsk({ open: false, t: null })}\n                >\n                  Decline\n                </button>\n                <button\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700\"\n                  onClick={async () => {\n                    const t = leaveAsk.t!;\n                    setLeaveAsk({ open: false, t: null });\n                    await leave(t);\n                  }}\n                >\n                  Accept\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Delete Tournament Confirmation Modal */}\n        {deleteConfirm.open && deleteConfirm.t && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-start justify-center pt-8 z-50\">\n            <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\n              <div className=\"text-center\">\n                <div className=\"text-xl font-semibold mb-4 text-white\">\n                  Delete Tournament\n                </div>\n                <div className=\"text-slate-300 mb-6\">\n                  Are you sure you want to delete{\" \"}\n                  <span className=\"font-semibold text-white\">\n                    \"{deleteConfirm.t.title}\"\n                  </span>\n                  ?\n                  <br />\n                  <span className=\"text-sm text-slate-400\">\n                    This action cannot be undone.\n                  </span>\n                </div>\n                <div className=\"flex gap-3 justify-center\">\n                  <button\n                    className=\"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\n                    onClick={() => setDeleteConfirm({ open: false, t: null })}\n                  >\n                    Decline\n                  </button>\n                  <button\n                    className=\"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors\"\n                    onClick={confirmDeleteTournament}\n                  >\n                    Continue\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Phone camera overlay removed per UX preference; header badge preview only */}\n      </div>\n\n      {/* ‚îÄ‚îÄ Page pagination at bottom of the card ‚îÄ‚îÄ */}\n      <div className=\"flex items-center justify-center gap-2 py-3 mt-auto\">\n        {pages.map((p, idx) => (\n          <button\n            key={p.id}\n            className={`px-3 py-1.5 rounded-lg text-sm font-semibold transition-all ${\n              idx === currentPageIdx\n                ? \"bg-white/20 text-white border border-white/30\"\n                : \"text-white/60 hover:text-white hover:bg-white/10\"\n            }`}\n            onClick={() => setCurrentPageIdx(idx)}\n          >\n            {p.id}\n          </button>\n        ))}\n      </div>\n\n      {/* Match Summary Modal */}\n      <MatchSummaryModal\n        open={showMatchSummary}\n        onClose={() => setShowMatchSummary(false)}\n        title=\"Match Summary\"\n        players={summaryPlayers}\n      />\n    </div>\n  );\n}\n"],"names":["MatchCard","t","onJoin","onLeave","joined","disabled","jsxs","jsx","labelForMode","containsIntegrationMarker","value","isIntegrationTournament","isTouch","Tournaments","user","toast","useToast","wsGlobal","useWS","_matchType","_setMatchType","_teamAName","_setTeamAName","_teamBName","_setTeamBName","useUserSettings","currentPageIdx","setCurrentPageIdx","useState","pages","setPages","activePageId","newPage","prev","id","newPages","list","setList","loading","setLoading","errorMsg","setErrorMsg","_fetchError","setFetchError","lastRefresh","setLastRefresh","cooldownUntil","setCooldownUntil","showCreate","setShowCreate","showStartShowcase","setShowStartShowcase","useRef","inProgress","useMatch","s","matchContext","roomId","showMatchSummary","setShowMatchSummary","summaryPlayers","setSummaryPlayers","prevInProgressRef","resultReportedRef","useEffect","st","matchInfo","activeTournamentMatchRef","reportKey","winner","a","b","p","localEmail","isWinnerLocal","winnerEmail","loserEmail","flagKey","openMatchWindow","form","setForm","joinMatch","setJoinMatch","joinTimer","setJoinTimer","joinChoice","setJoinChoice","remoteChoices","setRemoteChoices","_bullActive","setBullActive","_bullThrown","setBullThrown","_bullLocalThrow","setBullLocalThrow","_bullWinner","setBullWinner","leaveAsk","setLeaveAsk","deleteConfirm","setDeleteConfirm","currentGame","setCurrentGame","opponentQuitName","setOpponentQuitName","opponentFrameRef","opponentFrame","setOpponentFrame","serverPrestartRef","participants","setParticipants","tournamentWaiting","setTournamentWaiting","waitSecondsLeft","setWaitSecondsLeft","tournamentComplete","setTournamentComplete","msg","m","endsAt","localName","p1","p2","isP1","opponentName","playerNames","startScore","tMode","tValue","tLegsToWin","e","el","useMatchControl","playerId","choice","v","tick","remaining","iv","match","sendPrestartChoice","sendState","useCallback","refresh","data","apiFetch","newList","err","unsub","email","hasJoined","prestartPreview","setPrestartPreview","dismissedPrestart","setDismissedPrestart","prestartNow","setPrestartNow","buildBracketPairs","names","size","seeded","i","pairs","MatchPrefs","abort","check","deleteTournament","confirmDeleteTournament","res","join","fmt","leave","it","createTournament","start","details","onKey","visibleTournaments","useMemo","official","community","created","now","upcoming","delta","createdPage","setCreatedPage","itemsPerPage","createdTotalPages","paginatedCreated","communityPage","setCommunityPage","communityTotalPages","paginatedCommunity","nextOfficial","ts","username","alive","c","ctx","lastSendTs","FRAME_INTERVAL","loop","video","w","h","frame","localIdx","Fragment","InGameShell","score","_darts","_meta","leg","preRem","postRem","attempts","finished","mins","secs","MatchStartShowcase","getGameDisplay","pair","idx","f","g","cfg","gameConfig","validMode","getDefaultExtraValues","getModeOptionsForGame","o","getValueLabelForGame","getExtraFieldsForGame","pid","MatchSummaryModal"],"mappings":"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"}
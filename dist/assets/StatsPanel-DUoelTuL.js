import{i as se,d as te,D as q,F as re,c as ae,b as k,H as C,I as le,j as e,T as ie,g as b,J as I,K as L,L as ne}from"./index-BsD5Xt31.js";import{f as n}from"./stats-X3jz_E9o.js";import{r as d}from"./ui-DygUIHRq.js";import"./vendor-D3F3s8fL.js";function ve({user:Y}){const{players:M,inProgress:F,startingScore:de,newMatch:oe}=se(),[p,P]=d.useState("x01"),[ce,he]=d.useState("Player 1, Player 2"),[me,xe]=d.useState(501),[j,U]=d.useState(""),[S,z]=d.useState([]),[l,D]=d.useState(""),[w,E]=d.useState(!1),[A,H]=d.useState(""),[R,O]=d.useState([]),[J,W]=d.useState(!1),N=d.useRef(null),o=String(Y?.email||"").toLowerCase(),K=["Daily","Monthly","All-Time"],[u,Q]=d.useState("Daily");d.useEffect(()=>{if(!w||!o)return;let s=!1;async function r(){try{const m=await(await fetch(`/api/friends/list?email=${encodeURIComponent(o)}`)).json().catch(()=>({friends:[]}));s||z(m.friends||[])}catch{}}r();const a=window.setInterval(r,2e4);return()=>{s=!0,clearInterval(a)}},[o,w]),d.useEffect(()=>{try{const s=o?`ndn:stats:opponent:${o}`:"ndn:stats:opponent",r=localStorage.getItem(s);r&&D(r)}catch{}},[o]),d.useEffect(()=>{try{const s=o?`ndn:stats:opponent:${o}`:"ndn:stats:opponent";l?localStorage.setItem(s,l):localStorage.removeItem(s)}catch{}},[l,o]);const _=d.useCallback(s=>{if(H(s),!s.trim()){O([]);return}w&&(N.current&&clearTimeout(N.current),N.current=window.setTimeout(async()=>{W(!0);try{const a=await(await fetch(`/api/friends/search?q=${encodeURIComponent(s)}`)).json().catch(()=>({results:[]}));O(a.results||[])}finally{W(!1)}},350))},[w]);d.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]);const f=d.useMemo(()=>{const s=new Map;if(p==="x01")for(const a of M)for(const i of a.legs)for(const m of i.visits){const g=Math.max(0,Math.min(180,m.score));s.set(g,(s.get(g)??0)+1)}const r=Array.from(s.entries()).sort((a,i)=>a[0]-i[0]);return r.length===0&&p==="x01"?([0,26,41,60,81,100,120,140,160,180].forEach(a=>s.set(a,0)),Array.from(s.entries()).sort((a,i)=>a[0]-i[0]).map(([a,i])=>({label:a,value:i}))):r.map(([a,i])=>({label:a,value:i}))},[M,p]),B=d.useMemo(()=>{const s=te(q);return q.map(r=>{const a=s[r]||{played:0,won:0};return{label:r,value:a.played,extra:a.won}})},[p]),h=d.useMemo(()=>{if(!f.length)return null;let s=0,r=f[0],a=f[0];for(const i of f)s+=i.value,i.value>r.value&&(r=i),i.value<a.value&&(a=i);return{total:s,most:r,least:a}},[f]),T=d.useMemo(()=>o?re(o):[],[o]),X=d.useMemo(()=>o?ae(o):0,[o]),Z=d.useMemo(()=>{if(!o)return 0;switch(u){case"Daily":return le(o);case"Monthly":return C(o);default:return k(o)}},[o,u]),y=d.useMemo(()=>{if(!T.length)return[];const s=Date.now(),r=1e3*60*60*24,a=r*30,i=u==="Daily"?r:u==="Monthly"?a:Number.POSITIVE_INFINITY,m=T.filter(c=>i===Number.POSITIVE_INFINITY||s-c.t<=i).map(c=>({t:c.t,value:c.darts?c.scored/c.darts*3:0})).sort((c,t)=>c.t-t.t);if(!m.length)return[];const v=Math.max(1,Math.floor(m.length/32));return m.filter((c,t)=>t%v===0||t===m.length-1)},[T,u]),G=d.useMemo(()=>{if(!y.length)return"";const s=220,r=40,a=y.map(c=>c.value),i=Math.min(...a),g=Math.max(...a)-i||1,v=y.length;return y.map((c,t)=>{const x=v===1?s/2:t/(v-1)*s,$=(c.value-i)/g,ee=r-$*r;return`${x},${ee}`}).join(" ")},[y]),V=d.useMemo(()=>`ndn-stats-sparkline-${Math.random().toString(36).slice(2)}`,[]);return d.useEffect(()=>{const s=()=>P(r=>r);return window.addEventListener("ndn:stats-updated",s),()=>window.removeEventListener("ndn:stats-updated",s)},[]),e.jsxs("div",{className:"card ndn-game-shell ndn-page ndn-stats-page pb-6 overflow-visible",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-2xl font-extrabold text-white ndn-section-title",children:"Match Stats ðŸŽ¯"}),e.jsx("span",{className:"text-xs opacity-70",children:"View ðŸŽ¯"})]}),e.jsx("div",{className:"relative z-20 mt-2",children:e.jsx(ie,{tabs:[{key:"x01",label:"X01 ðŸŽ¯"},{key:"other",label:"Other Modes ðŸŽ¯"}],active:p,onChange:s=>P(s)})})]}),F&&e.jsx("div",{className:"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200",children:"Note: Detailed leg stats are finalized at the end of the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[M.map((s,r)=>{const a=s.name||`Player ${r+1}`,i=b(a),m=Math.max(s.bestThreeDartAvg??0,i.best3??0),g=(()=>{const t=[s.worstThreeDartAvg??0,i.worst3??0].filter(x=>x>0);return t.length?Math.min(...t):0})(),v=(()=>{const t=[];return typeof s.bestNineDart?.darts=="number"&&t.push(s.bestNineDart.darts),typeof i.bestLegDarts=="number"&&i.bestLegDarts>0&&t.push(i.bestLegDarts),t.length?Math.min(...t):0})(),c=Math.max(s.bestCheckout??0,i.bestCheckout??0);return e.jsxs("div",{className:"p-4 rounded-2xl border border-indigo-500/20 bg-gradient-to-br from-indigo-700/6 to-indigo-900/6 shadow-sm transform transition-transform duration-200 hover:-translate-y-1 hover:shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:r===1&&!l?s.name||"Opponent":r===1&&l?l:a}),r===1&&e.jsxs("div",{className:"flex gap-2 items-center overflow-x-auto py-1",children:[e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10",onClick:()=>E(t=>!t),title:"Search user to compare",children:"Select Friend ðŸŽ¯"}),S.slice(0,6).map(t=>{const x=t.username||t.email,$=l===x;return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${$?"bg-indigo-500/30 border-indigo-400/50":"bg-white/6 border-white/8 hover:bg-white/10 transform hover:-translate-y-0.5 transition-all duration-150"}`,onClick:()=>D(x),title:`Compare vs ${x}`,children:x},t.email)}),S.length===0&&e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10",disabled:!0,children:"Find friends to compare"})]})]}),r===1&&w&&e.jsxs("div",{className:"mb-2 p-2 rounded-lg bg-black/20 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1 py-1",placeholder:"Search by name or email",value:A,onChange:t=>_(t.target.value)}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>_(A),disabled:J,children:"Search ðŸŽ¯"})]}),e.jsxs("ul",{className:"max-h-40 overflow-auto space-y-1",children:[R.map(t=>{const x=t.username||t.email;return e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm",onClick:()=>{D(x),E(!1)},children:x})},t.email)}),!R.length&&e.jsx("li",{className:"text-xs opacity-70",children:A.trim()?"No results":"Type to searchâ€¦"})]})]}),r===1&&l?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:n(b(l).best3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:n(b(l).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const t=b(l);return t.bestLegDarts?`${t.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:b(l).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",n(k(l))," Â·"," ",n(C(l))]}),e.jsxs("span",{children:["First 9: ",n(I(l))," Â·"," ",n(L(l))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const t=b(l);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",n(t.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",n(t.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",t.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",t.bestCheckout||0]})]})})()]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:n(m)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:n(g)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:v?`${v} darts`:"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:c||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",n(k(a))," Â·"," ",n(C(a))]}),e.jsxs("span",{children:["First 9: ",n(I(a))," ","Â· ",n(L(a))]})]})]}),F&&e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Current 3-Dart (live)"}),e.jsx("div",{className:"font-semibold",children:n(s.currentThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const t=b(a);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",n(t.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",n(t.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",t.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",t.bestCheckout||0]})]})})()]})]})]},s.id)}),M.length<=1&&e.jsxs("div",{className:"p-3 rounded-2xl border border-purple-500/20 bg-gradient-to-r from-purple-800/6 to-pink-800/6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Opponent"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.slice(0,6).map(s=>{const r=s.username||s.email,a=l===(s.username||s.email);return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${a?"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-transparent shadow-sm":"bg-gradient-to-r from-purple-500/8 to-pink-500/8 border-white/10 hover:from-purple-500/12 hover:to-pink-500/12"}`,onClick:()=>D(r),title:`Compare vs ${r}`,children:r},s.email)}),S.length===0&&e.jsx("span",{className:"text-xs opacity-70",children:"Add friends to compare stats."})]})]}),l?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Comparing to"}),e.jsx("div",{className:"font-semibold",children:l})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:n(k(l))})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:n(b(l).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const s=b(l);return s.bestLegDarts?`${s.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:b(l).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",n(k(l))," Â·"," ",n(C(l))]}),e.jsxs("span",{children:["First 9: ",n(I(l))," Â·"," ",n(L(l))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const s=b(l);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",n(s.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",n(s.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",s.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",s.bestCheckout||0]})]})})()]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Select a friend above to compare."})]})]}),p!=="other"?e.jsxs("div",{className:"mt-6 rounded-2xl border border-white/10 bg-black/20 p-4 space-y-4",children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Score Distribution (",p.toUpperCase(),"): Visits by scored points"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] uppercase tracking-widest text-slate-300",children:[K.map(s=>e.jsx("button",{className:`px-3 py-1 rounded-full border transition-all duration-200 ${u===s?"bg-white/20 border-white/40 text-white":"bg-white/5 border-white/10 text-slate-200"}`,onClick:()=>Q(s),children:s},s)),e.jsx("span",{className:"text-xs opacity-50",children:"sparkline window"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs text-slate-300",children:[e.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 p-3",children:[e.jsx("div",{className:"text-[10px] uppercase opacity-70",children:"Average"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:n(Z)}),e.jsx("div",{className:"text-[10px] opacity-50",children:u})]}),e.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 p-3",children:[e.jsx("div",{className:"text-[10px] uppercase opacity-70",children:"Rolling 24h"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:n(X)}),e.jsx("div",{className:"text-[10px] opacity-50",children:"live trend"})]}),e.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 p-3",children:[e.jsx("div",{className:"text-[10px] uppercase opacity-70",children:"Visits"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:h?h.total:0}),e.jsx("div",{className:"text-[10px] opacity-50",children:"Match legs"})]}),e.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 p-3",children:[e.jsx("div",{className:"text-[10px] uppercase opacity-70",children:"Range"}),e.jsx("div",{className:"text-[10px] text-slate-200",children:h?`${h.most.label} â†’ ${h.least.label}`:"â€”"}),e.jsx("div",{className:"text-[10px] opacity-50",children:"Most â†’ Least"})]})]}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3",children:G?e.jsxs("svg",{viewBox:"0 0 220 40",className:"w-full h-12",role:"presentation",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:V,x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"#a855f7",stopOpacity:"0.35"}),e.jsx("stop",{offset:"100%",stopColor:"#ec4899",stopOpacity:"0.9"})]})}),e.jsx("polyline",{fill:"none",stroke:`url(#${V})`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",points:G})]}):e.jsx("div",{className:"text-xs text-slate-400",children:"No historical trend data yet. Finish more legs to seed the sparkline."})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[11px] text-slate-300/80 mb-2",children:[e.jsxs("span",{className:"text-left",children:["Most frequent:"," ",h?`${h.most.label} (${h.most.value})`:"â€”"]}),e.jsxs("span",{className:"text-right",children:["Least frequent:"," ",h?`${h.least.label} (${h.least.value})`:"â€”"]})]}),e.jsx("div",{className:"rounded-xl border border-indigo-500/20 p-3 min-h-[220px] transform transition-shadow duration-200 hover:shadow-lg overflow-y-auto",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)",scrollbarColor:"#8F43EE #18122B"},children:e.jsx(ne,{data:f,showValues:!1})})]}):j&&B.find(s=>s.label===j)?e.jsx("div",{className:"mt-6 rounded-2xl border border-white/10 bg-black/20 p-4",children:(()=>{const s=B.find(r=>r.label===j);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Game Stats for ",s.label]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Games Played"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:s.value})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Games Won"}),e.jsx("div",{className:"text-3xl font-bold text-green-400",children:s.extra})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Win Rate"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[s.value>0?(s.extra/s.value*100).toFixed(1):0,"%"]})]})]})]})})()}):null,p==="other"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Other Modes: Click a game to view stats"}),e.jsx("div",{className:"rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar flex-wrap",children:B.map(s=>e.jsxs("button",{onClick:()=>U(s.label),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] ${j===s.label?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gradient-to-r from-slate-700 to-slate-600 text-white hover:from-slate-600 hover:to-slate-500"}`,children:[s.label," ðŸŽ¯"]},s.label))})]}),!j&&e.jsx("div",{className:"rounded-xl border border-indigo-500/20 p-4",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)"},children:e.jsx("div",{className:"text-center text-slate-300",children:"Select a game mode above to view detailed stats"})})]})]})}export{ve as default};
//# sourceMappingURL=StatsPanel-DUoelTuL.js.map

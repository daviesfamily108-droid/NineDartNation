{"version":3,"file":"Scoreboard-BL8YO7Rk.js","sources":["../../src/components/Scoreboard.tsx"],"sourcesContent":["import { useMatch } from '../store/match'\r\nimport { formatAvg } from '../utils/stats'\r\n// Icons not used directly in Scoreboard; MatchControls has its own icons\r\nimport MatchControls from './MatchControls'\r\nimport { addMatchToAllTime } from '../store/profileStats'\r\nimport { usePendingVisit } from '../store/pendingVisit'\r\nimport type { UnifiedMatchActions } from '../logic/matchActions'\r\nimport ResizableModal from './ui/ResizableModal'\r\n\r\nexport default function Scoreboard({ matchActions }: { matchActions?: UnifiedMatchActions } = {}) {\r\n  const { players, currentPlayerIdx, addVisit, undoVisit, endLeg, nextPlayer, endGame, inProgress, startingScore, bestLegThisMatch } = useMatch()\r\n  const pendingEntries = usePendingVisit(s => s.entries)\r\n\r\n  const current = players[currentPlayerIdx]\r\n\r\n  function handleEndGame() {\r\n    try {\r\n      const summary = {\r\n        ts: Date.now(),\r\n        players: players.map(p => {\r\n          const totals = p.legs.reduce((acc, L) => {\r\n            acc.points += (L.totalScoreStart - L.totalScoreRemaining)\r\n            const legDarts = (L.visits || []).reduce((a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0), 0)\r\n            acc.darts += legDarts\r\n            return acc\r\n          }, { points: 0, darts: 0 })\r\n          const dartsThrown = totals.darts\r\n          const avg = dartsThrown > 0 ? ((totals.points / dartsThrown) * 3) : 0\r\n          return {\r\n            id: p.id,\r\n            name: p.name,\r\n            legsWon: p.legsWon,\r\n            dartsThrown,\r\n            avg: Math.round(avg * 100) / 100,\r\n          }\r\n        }),\r\n        winner: players.reduce((best, p) => p.legsWon > (best?.legsWon || 0) ? p : best, players[0])?.name,\r\n      }\r\n      try { localStorage.setItem('ndn_last_match', JSON.stringify(summary)) } catch {}\r\n    } catch (err) {}\r\n    addMatchToAllTime(players); (matchActions?.endGame ?? endGame)()\r\n  }\r\n\r\n  return (\r\n    <ResizableModal storageKey=\"ndn:modal:scoreboard\" className=\"w-full h-full relative\" defaultWidth={1100} defaultHeight={720} minWidth={720} minHeight={480} maxWidth={1600} maxHeight={1200} initialFitHeight>\r\n      <div className=\"flex-1 min-h-0 overflow-y-auto p-3\">\r\n        <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-3\">\r\n      <div className=\"col-span-2 card\">\r\n        <h2 className=\"text-lg font-semibold mb-3\">Score Input</h2>\r\n        {inProgress ? (\r\n            <MatchControls\r\n            inProgress={inProgress}\r\n            startingScore={startingScore}\r\n            pendingEntries={pendingEntries}\r\n            onAddVisit={(score, darts) => {\r\n              // Compute remaining before we update store, to decide auto-advance\r\n              const p = players[currentPlayerIdx]\r\n              const leg = p.legs[p.legs.length - 1]\r\n              const prevRemaining = leg ? leg.totalScoreRemaining : startingScore\r\n              const numericScore = (typeof score === 'number' ? score : 0)\r\n              let newRemaining = prevRemaining - numericScore\r\n              if (!Number.isFinite(newRemaining) || newRemaining < 0) newRemaining = 0\r\n              // Call provided matchActions.addVisit if available, otherwise the store's addVisit\r\n              // Call provided matchActions.addVisit if available, otherwise the store's addVisit\r\n              if (matchActions?.addVisit) { matchActions.addVisit(score, darts) }\r\n              else { addVisit(score, darts) }\r\n              if (newRemaining === 0) {\r\n                if (matchActions?.endLeg) { matchActions.endLeg(score) } else { endLeg(score) }\r\n              } else {\r\n                (matchActions?.nextPlayer ?? nextPlayer)()\r\n              }\r\n            }}\r\n            onUndo={() => (matchActions?.undoVisit ?? undoVisit)()}\r\n            onEndLeg={(score) => { (matchActions?.endLeg ?? endLeg)(score ?? 0) }}\r\n            onNextPlayer={() => (matchActions?.nextPlayer ?? nextPlayer)()}\r\n            onEndGame={handleEndGame}\r\n            quickButtons={[180,140,100,60]}\r\n          />\r\n        ) : (\r\n          <p className=\"text-slate-600\">No game in progress.</p>\r\n        )}\r\n\r\n  <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n          {players.map((p, idx) => {\r\n            const currentLeg = p.legs[p.legs.length-1]\r\n            const remaining = currentLeg ? currentLeg.totalScoreRemaining : startingScore\r\n            // TV-style 3-dart avg across the entire match (all legs): sum(points)/sum(darts)*3\r\n            const totals = p.legs.reduce((acc, L) => {\r\n              acc.points += (L.totalScoreStart - L.totalScoreRemaining)\r\n              const legDarts = (L.visits || []).reduce((a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0), 0)\r\n              acc.darts += legDarts\r\n              return acc\r\n            }, { points: 0, darts: 0 })\r\n            const dartsThrown = totals.darts\r\n            const avg = dartsThrown > 0 ? ((totals.points / dartsThrown) * 3) : 0\r\n\r\n            return (\r\n              <div key={p.id} className={`card glass transition-shadow transition-all duration-150 ease-out ${idx === currentPlayerIdx ? 'ring-2 ring-brand-400' : ''}`}>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-base font-semibold\">{p.name}</h3>\r\n                  <span className=\"badge w-32 justify-center\">Legs Won: {p.legsWon}</span>\r\n                </div>\r\n                <div className=\"mt-2 grid grid-cols-3 gap-2 text-center\">\r\n                  <div className=\"p-2 rounded-xl bg-white/10 border border-white/10 metric-tile\">\r\n                    <div className=\"text-xs text-slate-500\">Remaining</div>\r\n                    <div className={`flex items-center justify-center gap-2 mt-1 h-3 w-full`} aria-hidden>\r\n                      {[0,1,2].map(i => {\r\n                        // Only active/current player's pendingEntries matter; other players get translucent placeholders\r\n                        const e = idx === currentPlayerIdx ? (pendingEntries[i] as any) : null\r\n                        const isPending = !e\r\n                        const isHit = !!e && (typeof e.value === 'number' ? e.value > 0 : true)\r\n                        const color = isPending ? 'bg-gray-400/60' : (isHit ? 'bg-emerald-400' : 'bg-rose-500')\r\n                        const active = idx === currentPlayerIdx && !isPending && isHit\r\n                        const classes = `visit-dot ${active ? 'active' : 'inactive'} ${color}`\r\n                        return <span key={i} className={classes} />\r\n                      })}\r\n                    </div>\r\n                    <div className=\"text-2xl font-bold\">{remaining}</div>\r\n                    <div className=\"h-1 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                      <div className=\"h-full bg-emerald-400/70 transition-all duration-200 ease-out\" style={{ width: `${Math.max(0, Math.min(100, (1 - (remaining / startingScore)) * 100))}%` }} />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"p-2 rounded-xl bg-white/10 border border-white/10 metric-tile\">\r\n                    <div className=\"text-xs text-slate-500\">Darts</div>\r\n                    <div className=\"text-xl font-bold\">{dartsThrown}</div>\r\n                  </div>\r\n                  <div className=\"p-2 rounded-xl bg-white/10 border border-white/10 metric-tile\">\r\n                    <div className=\"text-xs text-slate-500\">3-Dart Avg</div>\r\n                    <div className=\"text-xl font-bold\">{formatAvg(avg)}</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n\r\n        {bestLegThisMatch && (\r\n          <div className=\"mt-4 p-3 rounded-xl bg-emerald-50 border border-emerald-200\">\r\n            <strong>Best Leg (this match):</strong> Player {players.find(p => p.id === bestLegThisMatch.playerId)?.name} in {bestLegThisMatch.darts} darts\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n      </div>\r\n    </ResizableModal>\r\n  )\r\n}\r\n"],"names":["Scoreboard","matchActions","players","currentPlayerIdx","addVisit","undoVisit","endLeg","nextPlayer","endGame","inProgress","startingScore","bestLegThisMatch","useMatch","pendingEntries","usePendingVisit","handleEndGame","summary","p","totals","acc","L","legDarts","a","v","dartsThrown","avg","best","addMatchToAllTime","jsx","ResizableModal","jsxs","MatchControls","score","darts","leg","newRemaining","idx","currentLeg","remaining","i","e","isPending","isHit","classes","formatAvg"],"mappings":"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"}
{"version":3,"file":"Tournaments-Cn-j6rye.js","sources":["../../src/components/MatchCard.tsx","../../src/components/InGameShell.tsx","../../src/components/Tournaments.tsx"],"sourcesContent":["import React from \"react\";\nimport { labelForMode, type ModeKey } from \"../utils/games.js\";\n\ntype Tournament = {\n  id: string;\n  title: string;\n  game: string;\n  mode: ModeKey;\n  value: number;\n  startAt: number;\n  capacity: number;\n  participants: { email: string; username: string }[];\n  creatorName?: string;\n  creatorEmail?: string;\n  official?: boolean;\n};\n\nexport default function MatchCard({\n  t,\n  onJoin,\n  onLeave,\n  joined,\n  disabled,\n}: {\n  t: Tournament;\n  onJoin?: (t: any) => void;\n  onLeave?: (t: any) => void;\n  joined?: boolean;\n  disabled?: boolean;\n}) {\n  return (\n    <li className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\">\n      <div className=\"space-y-0.5\">\n        <div className=\"font-semibold\">\n          {t.title}\n          {t.official && (\n            <span className=\"ml-2 inline-flex items-center px-2 py-0.5 rounded bg-amber-500 text-black text-xs\">\n              Official\n            </span>\n          )}\n        </div>\n        <div className=\"text-sm opacity-80\">\n          {t.game}\n          {t.game === \"X01\" ? `/501` : \"\"} · {labelForMode(t.mode)} {t.value} ·{\" \"}\n          {new Date(t.startAt).toLocaleString()} · Cap {t.capacity} · Joined{\" \"}\n          {t.participants?.length || 0}\n        </div>\n        <div className=\"text-xs opacity-60 mt-1\">\n          Created by: {t.creatorName || t.creatorEmail || \"Unknown\"}\n        </div>\n      </div>\n      <div className=\"flex items-center gap-2\">\n        <button\n          className={`btn ${joined ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n          disabled={disabled}\n          onClick={() => (joined ? onLeave && onLeave(t) : onJoin && onJoin(t))}\n        >\n          {joined ? \"Already Joined! ✅\" : \"Join Now ⚔️\"}\n        </button>\n      </div>\n    </li>\n  );\n}\n","import React, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport CameraView from \"./CameraView.js\";\nimport GameScoreboard from \"./scoreboards/GameScoreboard.js\";\r\nimport { useOnlineGameStats } from \"./scoreboards/useGameStats.js\";\r\nimport { useMatch } from \"../store/match.js\";\r\nimport { useMatchControl } from \"../store/matchControl.js\";\r\nimport { usePendingVisit } from \"../store/pendingVisit.js\";\r\nimport PauseTimerBadge from \"./ui/PauseTimerBadge.js\";\r\nimport PauseQuitModal from \"./ui/PauseQuitModal.js\";\r\nimport { useUserSettings } from \"../store/userSettings.js\";\r\nimport MatchStartShowcase from \"./ui/MatchStartShowcase.js\";\r\nimport MatchControls from \"./MatchControls.js\";\r\nimport { suggestCheckouts, sayScore } from \"../utils/checkout.js\";\r\nimport { getPreferredUserName } from \"../utils/userName.js\";\r\nimport LetterboxScoreboardOverlay from \"./ui/LetterboxScoreboardOverlay.js\";\r\nimport { broadcastMessage } from \"../utils/broadcast.js\";\r\n\r\nexport default function InGameShell({\r\n  user,\r\n  showStartShowcase: showStartShowcaseProp,\r\n  onShowStartShowcaseChange,\r\n}: {\r\n  user: any;\r\n  showStartShowcase?: boolean;\r\n  onShowStartShowcaseChange?: (open: boolean) => void;\r\n}) {\r\n  const match = useMatch();\r\n  useUserSettings((s: any) => s.hideInGameSidebar ?? true);\r\n  useMatchControl((s: any) => s.setPaused);\r\n  useMatchControl();\r\n  usePendingVisit();\r\n\r\n  const [winningShot, setWinningShot] = useState<{\r\n    label?: string;\r\n    ring?: string;\r\n    frame?: string | null;\r\n    ts?: number;\r\n  } | null>(null);\r\n  const [remoteFrame] = useState<string | null>(null);\r\n\r\n  const lastOfflineStart = useUserSettings(\r\n    (s: any) => s.lastOffline?.x01Start || 501,\r\n  );\r\n\r\n  const settingsUser = useUserSettings((s: any) => s.user);\r\n  const localPlayerName =\r\n    user?.username ||\r\n    user?.name ||\r\n    user?.displayName ||\r\n    user?.email?.split(\"@\")[0] ||\r\n    settingsUser?.username ||\r\n    settingsUser?.name ||\r\n    settingsUser?.displayName ||\r\n    settingsUser?.email?.split(\"@\")[0];\r\n\r\n  const resolvedLocalIndex = (match.players || []).findIndex(\r\n    (p: any) => p?.name && p.name === localPlayerName,\r\n  );\r\n  const localPlayerIndex = resolvedLocalIndex >= 0 ? resolvedLocalIndex : 0;\r\n  const isUsersTurn = (match.currentPlayerIdx ?? 0) === localPlayerIndex;\r\n\r\n  const localPlayer = match.players?.[localPlayerIndex];\r\n  const localLeg = localPlayer?.legs?.[localPlayer.legs.length - 1];\r\n  const localRemaining =\r\n    localLeg?.totalScoreRemaining ?? match.startingScore ?? lastOfflineStart;\r\n  const awayIdx = (match.players || []).findIndex(\r\n    (_p: any, idx: number) => idx !== localPlayerIndex,\r\n  );\r\n  const awayPlayer = (match.players || [])[awayIdx >= 0 ? awayIdx : 0];\r\n  const awayLeg = awayPlayer?.legs?.[awayPlayer.legs.length - 1];\r\n  const awayRemaining =\r\n    awayLeg?.totalScoreRemaining ?? match.startingScore ?? lastOfflineStart;\r\n\r\n  const gameMode = (((match as any)?.game || \"X01\") as any) ?? \"X01\";\r\n  const scoreboardPlayers = useOnlineGameStats(gameMode, match as any);\r\n\r\n  const callerEnabled = useUserSettings((s: any) => s.callerEnabled);\r\n  const callerVoice = useUserSettings((s: any) => s.callerVoice);\r\n  const callerVolume = useUserSettings((s: any) => s.callerVolume);\r\n  const speakCheckoutOnly = useUserSettings((s: any) => s.speakCheckoutOnly);\r\n\r\n  const [showQuitPause, setShowQuitPause] = useState(false);\r\n  const setPaused = useMatchControl((s: any) => s.setPaused);\r\n  const paused = useMatchControl((s: any) => s.paused);\r\n  const pauseEndsAt = useMatchControl((s: any) => s.pauseEndsAt);\r\n  const pauseInitiator = useMatchControl((s: any) => s.pauseInitiator);\r\n  const [pauseNow, setPauseNow] = useState(Date.now());\r\n\r\n  // Signal the app shell to go full-screen on mobile while in-game\r\n  useEffect(() => {\r\n    document.documentElement.setAttribute('data-ndn-ingame', 'true');\r\n    return () => {\r\n      document.documentElement.removeAttribute('data-ndn-ingame');\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!paused || !pauseEndsAt) return;\r\n    const t = setInterval(() => {\r\n      const now = Date.now();\r\n      setPauseNow(now);\r\n      if (now >= pauseEndsAt) {\r\n        setPaused(false, null);\r\n      }\r\n    }, 250);\r\n    return () => clearInterval(t);\r\n  }, [paused, pauseEndsAt, setPaused]);\r\n\r\n  const checkoutRoutes = useMemo(() => {\r\n    if (gameMode !== \"X01\" || localRemaining > 170 || localRemaining <= 0) return null;\r\n    const routes = suggestCheckouts(localRemaining);\r\n    return routes && routes.length > 0 ? routes : null;\r\n  }, [gameMode, localRemaining]);\r\n\r\n  const legsInfo = useMemo(() => {\r\n    const players = match.players || [];\r\n    return players.map((p: any) => ({\r\n      name: p.name || \"Player\",\r\n      legsWon: p.legsWon || 0,\r\n    }));\r\n  }, [match.players]);\r\n\r\n  const showStartShowcaseLocal =\r\n    typeof showStartShowcaseProp === \"boolean\" ? showStartShowcaseProp : true;\r\n  const setShowStartShowcase = (open: boolean) => {\r\n    onShowStartShowcaseChange?.(open);\r\n  };\r\n  const showcaseLockedOpenRef = useRef(true);\r\n  useEffect(() => {\r\n    if (!showcaseLockedOpenRef.current) return;\r\n    setShowStartShowcase(true);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const commitVisit = (score: number, darts: number, meta?: any) => {\r\n    const p = match.players?.[match.currentPlayerIdx];\r\n    const leg = p?.legs?.[p.legs.length - 1];\r\n    const prevRemaining = leg ? leg.totalScoreRemaining : match.startingScore;\r\n    const numericScore = typeof score === \"number\" ? score : 0;\r\n    let newRemaining = prevRemaining - numericScore;\r\n    if (!Number.isFinite(newRemaining) || newRemaining < 0) newRemaining = 0;\r\n\r\n    if (callerEnabled) {\r\n      const playerName = p?.name || getPreferredUserName(user, \"Player\");\r\n      try {\r\n        sayScore(playerName, numericScore, newRemaining, callerVoice, {\r\n          volume: callerVolume,\r\n          checkoutOnly: speakCheckoutOnly,\r\n        });\r\n      } catch {}\r\n    }\r\n\r\n    match.addVisit(numericScore, darts, meta ?? { visitTotal: numericScore });\r\n    if (newRemaining === 0) {\r\n      match.endLeg(numericScore);\r\n    } else {\r\n      match.nextPlayer();\r\n    }\r\n  };\r\n\r\n  const deriveWinningLabel = useCallback(() => {\r\n    try {\r\n      const legs: Array<{ ts: number; visit?: any; player?: any }> = [];\r\n      (match.players || []).forEach((p: any) => {\r\n        (p.legs || []).forEach((leg: any) => {\r\n          if (leg?.finished) {\r\n            const lastVisit = (leg.visits || []).slice(-1)[0];\r\n            legs.push({\r\n              ts: leg.endTime || Date.now(),\r\n              visit: lastVisit,\r\n              player: p,\r\n            });\r\n          }\r\n        });\r\n      });\r\n      if (!legs.length) return null;\r\n      const latest = legs.sort((a, b) => b.ts - a.ts)[0];\r\n      const entry = (latest.visit?.entries || []).slice(-1)[0];\r\n      if (entry?.label) return entry.label as string;\r\n      if (entry?.ring === \"DOUBLE\" && typeof entry?.value === \"number\")\r\n        return `Double ${entry.value / 2}`;\r\n      if (typeof latest.visit?.visitTotal === \"number\")\r\n        return `Checkout ${latest.visit.visitTotal}`;\r\n    } catch {}\r\n    return null;\r\n  }, [match.players]);\r\n\r\n  useEffect(() => {\r\n    if (match.inProgress) {\r\n      setWinningShot(null);\r\n      return;\r\n    }\r\n    if (!winningShot?.label) {\r\n      const derived = deriveWinningLabel();\r\n      if (derived) setWinningShot((prev) => ({ ...prev, label: derived }));\r\n    }\r\n  }, [match.inProgress, deriveWinningLabel, winningShot?.label]);\r\n\r\n  return (\r\n    <div className=\"card ndn-game-shell ndn-page ndn-ingame-active relative overflow-hidden md:overflow-hidden overflow-y-auto\">\r\n      {/* ── Ambient background glow ── */}\r\n      <div className=\"pointer-events-none absolute inset-0 overflow-hidden\">\r\n        <div className=\"absolute -top-32 -left-32 w-96 h-96 rounded-full bg-indigo-600/10 blur-[120px]\" />\r\n        <div className=\"absolute -bottom-32 -right-32 w-96 h-96 rounded-full bg-amber-500/8 blur-[120px]\" />\r\n      </div>\r\n\r\n      {showStartShowcaseLocal && (\r\n        <MatchStartShowcase\r\n          open={showStartShowcaseLocal}\r\n          players={(match.players || []) as any}\r\n          onDone={() => {\r\n            showcaseLockedOpenRef.current = false;\r\n            setShowStartShowcase(false);\r\n          }}\r\n          onRequestClose={() => {\r\n            showcaseLockedOpenRef.current = false;\r\n            setShowStartShowcase(false);\r\n          }}\r\n          showCalibrationDefault={true}\r\n        />\r\n      )}\r\n\r\n      {/* ── Premium sticky header ── */}\r\n      <div className=\"sticky top-0 z-20 mb-3\">\r\n        <div className=\"relative flex items-center justify-between gap-2 px-3 sm:px-5 py-2.5 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-lg\">\r\n          <div className=\"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-r from-indigo-500/10 via-transparent to-amber-500/10\" />\r\n          <div className=\"flex items-center gap-3 text-sm leading-none z-10\">\r\n            <span className=\"px-3 py-1 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-xs font-semibold tracking-wide\">\r\n              {gameMode}{gameMode === \"X01\" ? ` / ${match.startingScore || lastOfflineStart}` : \"\"}\r\n            </span>\r\n            {legsInfo.length >= 2 && (\r\n              <span className=\"font-bold text-white/90 text-sm tabular-nums\">\r\n                Legs: {legsInfo[0].legsWon} – {legsInfo[1].legsWon}\r\n              </span>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-2 z-10\">\r\n            <PauseTimerBadge />\r\n            <button\r\n              className=\"px-4 py-1.5 rounded-xl text-sm font-semibold bg-rose-600/90 hover:bg-rose-500 text-white border border-rose-400/30 shadow-lg shadow-rose-500/20 transition-all\"\r\n              onClick={() => setShowQuitPause(true)}\r\n            >\r\n              ⏸ Quit / Pause\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ── Hero scoreboard banner — big remaining scores ── */}\r\n      <div className=\"relative mb-4 rounded-2xl border border-white/10 overflow-hidden\">\r\n        {/* Gradient backdrop */}\r\n        <div className=\"absolute inset-0 bg-gradient-to-r from-indigo-950/80 via-slate-900/90 to-amber-950/80\" />\r\n        <div className=\"absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(255,255,255,0.03),transparent_70%)]\" />\r\n\r\n        <div className=\"relative grid grid-cols-[1fr_auto_1fr] items-center py-4 sm:py-6 px-3 sm:px-8\">\r\n          {/* Player 1 (local) */}\r\n          <div className=\"flex flex-col items-center gap-1\">\r\n            <div className={`text-xs sm:text-sm font-bold uppercase tracking-widest ${isUsersTurn ? \"text-emerald-400\" : \"text-slate-400\"}`}>\r\n              {localPlayer?.name || \"You\"}\r\n            </div>\r\n            <div className={`font-mono text-5xl sm:text-7xl md:text-8xl font-black tabular-nums leading-none ${isUsersTurn ? \"text-white\" : \"text-white/60\"}`}>\r\n              {localRemaining}\r\n            </div>\r\n            {isUsersTurn && (\r\n              <div className=\"mt-1 px-3 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/40 text-emerald-300 text-[10px] sm:text-xs font-semibold uppercase tracking-wider animate-pulse\">\r\n                ● Throwing\r\n              </div>\r\n            )}\r\n            <div className=\"text-[10px] sm:text-xs text-slate-400 tabular-nums\">\r\n              Legs: {localPlayer?.legsWon || 0}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Centre divider — VS */}\r\n          <div className=\"flex flex-col items-center gap-1 px-3 sm:px-6\">\r\n            <div className=\"w-px h-8 sm:h-12 bg-gradient-to-b from-transparent via-white/20 to-transparent\" />\r\n            <div className=\"text-lg sm:text-2xl font-black text-white/30 tracking-widest\">VS</div>\r\n            <div className=\"w-px h-8 sm:h-12 bg-gradient-to-b from-transparent via-white/20 to-transparent\" />\r\n          </div>\r\n\r\n          {/* Player 2 (away) */}\r\n          <div className=\"flex flex-col items-center gap-1\">\r\n            <div className={`text-xs sm:text-sm font-bold uppercase tracking-widest ${!isUsersTurn ? \"text-amber-400\" : \"text-slate-400\"}`}>\r\n              {awayPlayer?.name || \"Opponent\"}\r\n            </div>\r\n            <div className={`font-mono text-5xl sm:text-7xl md:text-8xl font-black tabular-nums leading-none ${!isUsersTurn ? \"text-white\" : \"text-white/60\"}`}>\r\n              {awayRemaining}\r\n            </div>\r\n            {!isUsersTurn && (\r\n              <div className=\"mt-1 px-3 py-0.5 rounded-full bg-amber-500/20 border border-amber-400/40 text-amber-300 text-[10px] sm:text-xs font-semibold uppercase tracking-wider animate-pulse\">\r\n                ● Throwing\r\n              </div>\r\n            )}\r\n            <div className=\"text-[10px] sm:text-xs text-slate-400 tabular-nums\">\r\n              Legs: {awayPlayer?.legsWon || 0}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Checkout suggestion strip */}\r\n        {checkoutRoutes && (\r\n          <div className=\"relative border-t border-emerald-400/20 bg-emerald-500/10 px-4 py-2 flex items-center gap-3\">\r\n            <span className=\"text-[10px] sm:text-xs uppercase tracking-wider text-emerald-300/80 font-semibold whitespace-nowrap\">\r\n              Checkout {localRemaining}:\r\n            </span>\r\n            <div className=\"flex flex-wrap gap-1.5\">\r\n              {checkoutRoutes.map((route: string, i: number) => (\r\n                <span key={i} className=\"px-2 py-0.5 rounded-lg bg-emerald-500/20 border border-emerald-400/20 text-emerald-100 text-xs sm:text-sm font-medium\">\r\n                  {route}\r\n                </span>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* ── Main content: Camera + Scoreboard + Controls ── */}\r\n      <div className=\"ndn-shell-body\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-[1fr_1fr] gap-3 md:gap-4 items-stretch\">\r\n          {/* Left column: Camera */}\r\n          <div className=\"min-w-0\">\r\n            <div className=\"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 h-full flex flex-col overflow-hidden\">\r\n              {/* Camera label bar */}\r\n              <div className=\"flex items-center justify-between px-3 py-2 border-b border-white/5 bg-white/5\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className={`w-2 h-2 rounded-full ${isUsersTurn ? \"bg-emerald-400 shadow-lg shadow-emerald-400/50\" : \"bg-amber-400 shadow-lg shadow-amber-400/50\"}`} />\r\n                  <span className=\"text-xs sm:text-sm font-semibold text-white/80\">\r\n                    {isUsersTurn ? \"Your Camera\" : \"Opponent Camera\"}\r\n                  </span>\r\n                </div>\r\n                <span className={`text-[10px] sm:text-xs font-medium ${isUsersTurn ? \"text-emerald-300\" : \"text-amber-300\"}`}>\r\n                  {isUsersTurn ? \"LIVE — Your turn\" : \"Waiting…\"}\r\n                </span>\r\n              </div>\r\n              {/* Camera viewport */}\r\n              <div className=\"relative min-h-[10rem] max-h-[40vh] md:max-h-none md:flex-1 bg-black\">\r\n                {isUsersTurn ? (\r\n                  <CameraView\r\n                    hideInlinePanels={true}\r\n                    forceAutoStart={true}\r\n                    onAddVisit={commitVisit}\r\n                    onEndLeg={(score: any) => {\r\n                      try { match.endLeg(score ?? 0); } catch {}\r\n                    }}\r\n                    onVisitCommitted={(\r\n                      _score: any,\r\n                      _darts: any,\r\n                      finished: any,\r\n                      meta: any,\r\n                    ) => {\r\n                      if (!finished) return;\r\n                      const frame = meta?.frame ?? remoteFrame ?? null;\r\n                      setWinningShot({\r\n                        label: meta?.label || deriveWinningLabel() || undefined,\r\n                        ring: meta?.ring,\r\n                        frame,\r\n                        ts: Date.now(),\r\n                      });\r\n                      try { match.endGame(); } catch {}\r\n                    }}\r\n                  />\r\n                ) : (\r\n                  <CameraView hideInlinePanels={true} forceAutoStart={true} />\r\n                )}\r\n                {gameMode === \"X01\" && !isUsersTurn && (\r\n                  <LetterboxScoreboardOverlay\r\n                    checkoutRemaining={localRemaining}\r\n                    away={{\r\n                      side: \"Away\",\r\n                      name: awayPlayer?.name || \"Away\",\r\n                      legsWon: awayPlayer?.legsWon || 0,\r\n                      remaining: awayRemaining,\r\n                    }}\r\n                    home={{\r\n                      side: \"Home\",\r\n                      name: localPlayer?.name || \"Home\",\r\n                      legsWon: localPlayer?.legsWon || 0,\r\n                      remaining: localRemaining,\r\n                    }}\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Right column: Scoreboard + Controls */}\r\n          <div className=\"min-w-0 flex flex-col gap-3\">\r\n            {/* Scoreboard card */}\r\n            <div className=\"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-3 sm:p-4 overflow-hidden\">\r\n              <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-br from-white/[0.02] to-transparent\" />\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <h3 className=\"text-sm sm:text-base font-bold text-white/90 tracking-wide\">Your Scoreboard</h3>\r\n                <div className={`px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold ${\r\n                  isUsersTurn\r\n                    ? \"bg-emerald-500/20 border border-emerald-400/30 text-emerald-300\"\r\n                    : \"bg-slate-500/20 border border-slate-400/20 text-slate-400\"\r\n                }`}>\r\n                  {isUsersTurn ? \"Your turn\" : \"Opponent's turn\"}\r\n                </div>\r\n              </div>\r\n              <GameScoreboard gameMode={gameMode} players={scoreboardPlayers} />\r\n            </div>\r\n\r\n            {/* Controls card — always visible, locked when opponent's turn */}\r\n            <div className={`relative rounded-2xl border shadow-2xl ring-1 ring-white/5 p-3 sm:p-4 overflow-hidden transition-all ${\r\n              isUsersTurn\r\n                ? \"border-white/10 bg-slate-950/70\"\r\n                : \"border-white/5 bg-slate-950/40 opacity-60\"\r\n            }`}>\r\n              <div className={`pointer-events-none absolute inset-0 bg-gradient-to-br ${isUsersTurn ? \"from-emerald-500/[0.03]\" : \"from-slate-500/[0.02]\"} to-transparent`} />\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <div className={`text-xs font-semibold uppercase tracking-wider ${isUsersTurn ? \"text-emerald-300/60\" : \"text-slate-400/60\"}`}>\r\n                  Score Entry\r\n                </div>\r\n                {!isUsersTurn && (\r\n                  <div className=\"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-slate-500/10 border border-slate-400/20\">\r\n                    <svg className=\"w-3 h-3 text-slate-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2.5}>\r\n                      <rect x=\"5\" y=\"11\" width=\"14\" height=\"11\" rx=\"2\" />\r\n                      <path d=\"M12 3a4 4 0 0 0-4 4v4h8V7a4 4 0 0 0-4-4z\" />\r\n                    </svg>\r\n                    <span className=\"text-[10px] font-semibold text-slate-400 uppercase tracking-wider\">Waiting for opponent</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              {isUsersTurn ? (\r\n                <MatchControls\r\n                  inProgress={true}\r\n                  startingScore={match.startingScore || lastOfflineStart}\r\n                  onAddVisit={(score, darts) => commitVisit(score, darts, { visitTotal: score })}\r\n                  quickButtons={[180, 140, 100, 60]}\r\n                  onNextPlayer={() => match.nextPlayer()}\r\n                  onEndLeg={(score) => {\r\n                    try { match.endLeg(score ?? 0); } catch {}\r\n                  }}\r\n                  onEndGame={() => {\r\n                    try { match.endGame(); } catch {}\r\n                  }}\r\n                  onUndo={() => {}}\r\n                  showDartsSelect={true}\r\n                />\r\n              ) : (\r\n                <div className=\"flex flex-col gap-3\">\r\n                  <input\r\n                    type=\"text\"\r\n                    className=\"w-full text-center text-xl font-bold rounded-xl border border-white/5 bg-white/5 text-white/30 px-4 py-3 cursor-not-allowed\"\r\n                    placeholder=\"Locked\"\r\n                    disabled\r\n                    readOnly\r\n                  />\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    <span className=\"text-[10px] text-white/30 uppercase tracking-wider self-center\">Quick:</span>\r\n                    {[180, 140, 100, 60].map((v) => (\r\n                      <button\r\n                        key={v}\r\n                        className=\"px-3 py-1.5 rounded-lg text-xs font-semibold border border-white/5 bg-white/[0.02] text-white/20 cursor-not-allowed\"\r\n                        disabled\r\n                      >\r\n                        {v}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Winning shot banner */}\r\n            {winningShot?.label && (\r\n              <div className=\"rounded-2xl border border-emerald-400/30 bg-emerald-500/10 px-4 py-3 text-center\">\r\n                <span className=\"text-xs text-emerald-400/70 uppercase tracking-wider font-semibold\">Winning Double</span>\r\n                <div className=\"text-lg font-bold text-emerald-200 mt-0.5\">{winningShot.label}</div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ── Quit / Pause modal ── */}\r\n      {showQuitPause && (\r\n        <PauseQuitModal\r\n          onClose={() => setShowQuitPause(false)}\r\n          onQuit={() => {\r\n            setShowQuitPause(false);\r\n            try { match.endGame(); } catch {}\r\n            try { window.dispatchEvent(new Event(\"ndn:match-quit\")); } catch {}\r\n          }}\r\n          onPause={(minutes: number) => {\r\n            const endsAt = Date.now() + minutes * 60 * 1000;\r\n            try { setPaused(true, endsAt, localPlayerName); } catch {}\r\n            try {\r\n              broadcastMessage({\r\n                type: \"pause\",\r\n                pauseEndsAt: endsAt,\r\n                pauseStartedAt: Date.now(),\r\n                pauseInitiator: localPlayerName,\r\n              });\r\n            } catch {}\r\n            setShowQuitPause(false);\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* ── Glass pause overlay — blocks all interaction while paused ── */}\r\n      {paused && pauseEndsAt && (() => {\r\n        const remaining = Math.max(0, pauseEndsAt - pauseNow);\r\n        const secs = Math.ceil(remaining / 1000);\r\n        const mm = Math.floor(secs / 60).toString().padStart(2, \"0\");\r\n        const ss = (secs % 60).toString().padStart(2, \"0\");\r\n        const started = useMatchControl.getState().pauseStartedAt ?? pauseNow;\r\n        const total = Math.max(1, pauseEndsAt - started);\r\n        const pct = Math.max(0, Math.min(100, (remaining / total) * 100));\r\n        const isInitiator = !pauseInitiator || pauseInitiator === localPlayerName;\r\n        return (\r\n          <div className=\"fixed inset-0 z-[1100] flex items-center justify-center bg-black/80 backdrop-blur-md\">\r\n            {/* Ambient glow behind the card */}\r\n            <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\r\n              <div className=\"w-80 h-80 rounded-full bg-amber-500/10 blur-[100px]\" />\r\n            </div>\r\n\r\n            <div className=\"relative rounded-3xl border border-amber-400/20 bg-slate-900/95 p-8 sm:p-10 shadow-2xl shadow-amber-500/10 max-w-sm w-full mx-4\">\r\n              <div className=\"pointer-events-none absolute inset-0 rounded-3xl bg-gradient-to-b from-white/[0.04] to-transparent\" />\r\n\r\n              <div className=\"relative flex flex-col items-center gap-5\">\r\n                {/* Pause icon */}\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-5 h-14 sm:w-6 sm:h-16 rounded-md bg-amber-400 shadow-lg shadow-amber-400/30\" />\r\n                  <div className=\"w-5 h-14 sm:w-6 sm:h-16 rounded-md bg-amber-400 shadow-lg shadow-amber-400/30\" />\r\n                </div>\r\n\r\n                <div className=\"text-amber-300 text-lg sm:text-xl font-bold uppercase tracking-[0.2em]\">\r\n                  Match Paused\r\n                </div>\r\n\r\n                {pauseInitiator && (\r\n                  <div className=\"text-sm text-amber-200/60\">\r\n                    Paused by <span className=\"font-semibold text-amber-200/90\">{pauseInitiator}</span>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Big countdown */}\r\n                <div className=\"font-mono text-6xl sm:text-7xl font-black text-white tabular-nums leading-none\">\r\n                  {mm}:{ss}\r\n                </div>\r\n\r\n                {/* Progress bar */}\r\n                <div className=\"w-full h-2 rounded-full bg-white/10 overflow-hidden\">\r\n                  <div\r\n                    className=\"h-full rounded-full bg-gradient-to-r from-amber-400 to-amber-500 transition-all duration-300\"\r\n                    style={{ width: `${pct}%` }}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"text-[10px] sm:text-xs text-amber-200/40 uppercase tracking-wider\">\r\n                  Resuming when timer expires\r\n                </div>\r\n\r\n                {isInitiator ? (\r\n                  <button\r\n                    className=\"mt-1 px-8 py-3 rounded-2xl text-base font-bold bg-emerald-600 hover:bg-emerald-500 text-white border border-emerald-400/30 shadow-lg shadow-emerald-500/20 transition-all\"\r\n                    onClick={() => {\r\n                      setPaused(false, null);\r\n                      try { broadcastMessage({ type: \"unpause\" }); } catch {}\r\n                    }}\r\n                  >\r\n                    ▶ Resume Match\r\n                  </button>\r\n                ) : (\r\n                  <div className=\"mt-1 text-sm text-amber-200/50 italic\">\r\n                    Only <span className=\"font-semibold text-amber-200/80\">{pauseInitiator}</span> can resume\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        );\r\n      })()}\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useMemo, useState, useRef } from \"react\";\nimport {\n  allGames,\n  getModeOptionsForGame,\n  labelForMode,\n  type ModeKey,\n  type GameKey,\n} from \"../utils/games.js\";\nimport { useMatch } from \"../store/match.js\";\nimport MatchCard from \"./MatchCard.js\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase.js\";\nimport { useToast } from \"../store/toast.js\";\nimport { useWS } from \"./WSProvider.js\";\nimport { apiFetch } from \"../utils/api.js\";\nimport { useUserSettings } from \"../store/userSettings.js\";\nimport { launchInPlayDemo } from \"../utils/inPlayDemo.js\";\nimport { openMatchWindow } from \"../utils/matchWindow.js\";\nimport InGameShell from \"./InGameShell.js\";\n\ntype Tournament = {\n  id: string;\n  title: string;\n  game: string;\n  mode: ModeKey;\n  value: number;\n  description: string;\n  startAt: number;\n  checkinMinutes: number;\n  capacity: number;\n  participants: { email: string; username: string }[];\n  bracket?: any;\n  official?: boolean;\n  prize?: boolean;\n  prizeType?: \"premium\" | \"none\";\n  status: \"scheduled\" | \"running\" | \"completed\";\n  winnerEmail?: string | null;\n  startingScore?: number;\n  creatorEmail?: string;\n  creatorName?: string;\n};\n\nconst DEFAULT_TOURNAMENT_GAMES: GameKey[] = [\"X01\", \"Cricket\", \"Killer\"];\n\nconst containsIntegrationMarker = (value: unknown) => {\n  if (typeof value === \"string\") {\n    return value.toLowerCase().includes(\"integration\");\n  }\n  if (typeof value === \"number\") {\n    return value.toString().toLowerCase().includes(\"integration\");\n  }\n  return false;\n};\n\nconst isIntegrationTournament = (t: Tournament) => {\n  if (!t) return false;\n  const candidates = [t.title, t.description, t.creatorName, t.creatorEmail];\n  return candidates.some((value) => containsIntegrationMarker(value));\n};\n\nconst isTouch =\n  typeof window !== \"undefined\" &&\n  (\"ontouchstart\" in window || navigator.maxTouchPoints > 0);\n\nexport default function Tournaments({ user }: { user: any }) {\n  const toast = useToast();\n  const wsGlobal = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  // Persisted match preferences (used when creating or joining)\n  const {\n    matchType: _matchType = \"singles\",\n    setMatchType: _setMatchType,\n    teamAName: _teamAName = \"Team A\",\n    setTeamAName: _setTeamAName,\n    teamBName: _teamBName = \"Team B\",\n    setTeamBName: _setTeamBName,\n  } = useUserSettings();\n  const [list, setList] = useState<Tournament[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [errorMsg, setErrorMsg] = useState(\"\");\n  const [_fetchError, setFetchError] = useState<string | null>(null);\n  const [lastRefresh, setLastRefresh] = useState<number | null>(null);\n  const [cooldownUntil, setCooldownUntil] = useState<number | null>(null);\n  const [showCreate, setShowCreate] = useState(false);\n  const [showDemoStart, setShowDemoStart] = useState(false);\n  const [showStartShowcase, setShowStartShowcase] = useState(false);\n  const _startedShowcasedRef = useRef(false);\n\n  const inProgress = useMatch((s: any) => s.inProgress);\n  const roomId = useMatch((s: any) => s.roomId);\n\n  if (inProgress) {\n    return <InGameShell user={user} />;\n  }\n\n  useEffect(() => {\n    if (!inProgress) return;\n    try {\n      const st = useMatch.getState();\n      const game = ((st as any)?.game || \"X01\") as string;\n      if (game !== \"X01\") return;\n      if (!st.roomId) return;\n      const flagKey = `ndn:matchWindowOpened:${st.roomId}`;\n      if (window.sessionStorage.getItem(flagKey) === \"1\") return;\n      window.sessionStorage.setItem(flagKey, \"1\");\n      openMatchWindow();\n    } catch {}\n  }, [inProgress, roomId]);\n\n  const [form, setForm] = useState({\n    title: \"\",\n    game: \"X01\",\n    mode: \"501\",\n    value: 0,\n    description: \"\",\n    startAt: new Date().toISOString().slice(0, 16),\n    checkinMinutes: 15,\n    capacity: 16,\n    startingScore: 501,\n    requireCalibration: false,\n  });\n\n  // Prestart / Bull Up Logic for Tournaments\n  const [joinMatch, setJoinMatch] = useState<any>(null);\n  const [joinTimer, setJoinTimer] = useState(30);\n  const [joinChoice, setJoinChoice] = useState<\"bull\" | \"skip\" | null>(null);\n  const [remoteChoices, setRemoteChoices] = useState<Record<string, string>>(\n    {},\n  );\n  const [_bullActive, setBullActive] = useState(false);\n  const [_bullThrown, setBullThrown] = useState(false);\n  const [_bullLocalThrow, setBullLocalThrow] = useState<any>(null);\n  const [_bullWinner, setBullWinner] = useState<string | null>(null);\n  const [leaveAsk, setLeaveAsk] = useState<{\n    open: boolean;\n    t: Tournament | null;\n  }>({ open: false, t: null });\n  const [deleteConfirm, setDeleteConfirm] = useState<{\n    open: boolean;\n    t: Tournament | null;\n  }>({ open: false, t: null });\n  const serverPrestartRef = useRef(false);\n  const _joinAcceptRef = useRef<HTMLButtonElement>(null);\n  const [participants, setParticipants] = useState<Record<string, string>>({});\n\n  // Listen for match-prestart events (same as OnlinePlay)\n  useEffect(() => {\n    if (!wsGlobal) return;\n    const unsub = wsGlobal.addListener((msg: any) => {\n      try {\n        if (msg?.type === \"match-prestart\") {\n          // Someone accepted the invite; show prestart and update join match if it matches\n          const m = msg.match || null;\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\n          // Ensure we know the creator's username\n          try {\n            if (m?.creatorId && m?.creatorName)\n              setParticipants((prev) => ({\n                ...prev,\n                [m.creatorId]: m.creatorName,\n              }));\n          } catch {}\n          serverPrestartRef.current = true;\n          setJoinMatch(m);\n          const endsAt = msg.prestartEndsAt || Date.now();\n          setJoinTimer(\n            Math.max(\n              0,\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\n            ),\n          );\n          setTimeout(() => {\n            serverPrestartRef.current = false;\n          }, 0);\n          // reset diffuse state\n          setJoinChoice(null);\n          setRemoteChoices({});\n          setBullActive(false);\n          setBullThrown(false);\n          setBullWinner(null);\n        }\n        if (msg?.type === \"match-start\") {\n          // If the started match matches our current join request, close the modal\n          if (joinMatch && msg.roomId === joinMatch.id) {\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setRemoteChoices({});\n          }\n        }\n        if (msg?.type === \"prestart-choice-notify\") {\n          const { roomId, playerId, choice } = msg;\n          if (!roomId || !choice) return;\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\n        }\n        if (msg?.type === \"prestart-bull\") {\n          setBullActive(true);\n          setBullThrown(false);\n          setBullLocalThrow(null);\n        }\n        if (msg?.type === \"prestart-bull-winner\") {\n          setBullWinner(msg.winnerId || null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n        if (msg?.type === \"prestart-bull-tie\") {\n          // reset to allow another round\n          setBullWinner(null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n      } catch (err) {}\n    });\n    return unsub;\n  }, [wsGlobal, joinChoice, joinMatch]);\n\n  // Join timer\n  useEffect(() => {\n    if (!joinMatch) return;\n    if (serverPrestartRef.current) return;\n    // If a server-supplied prestart exists, do not override joinTimer\n    if ((joinMatch as any).prestartEndsAt) return;\n    setJoinTimer(30);\n    setJoinChoice(null);\n    setRemoteChoices({});\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\n    return () => clearInterval(t);\n  }, [joinMatch]);\n\n  // Watch for match start (inProgress)\n  const match = useMatch((s: any) => ({\n    players: s.players,\n    currentPlayerIdx: s.currentPlayerIdx,\n    roomId: s.roomId,\n  }));\n  useEffect(() => {\n    if (!inProgress) return;\n    setShowStartShowcase(true);\n  }, [inProgress]);\n\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\n    setJoinChoice(choice);\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"prestart-choice\",\n          roomId: joinMatch.id,\n          choice,\n        });\n      }\n    } catch {}\n  };\n\n  async function refresh() {\n    try {\n      // Avoid multiple quick refreshes which can cause load spikes\n      if (lastRefresh && Date.now() - lastRefresh < 3000) return;\n      const res = await apiFetch(\"/api/tournaments\");\n      const data = await res.json();\n      const newList = Array.isArray(data.tournaments) ? data.tournaments : [];\n      setList(newList);\n      try {\n        console.debug(\n          \"[Tournaments] refresh fetched\",\n          newList.length,\n          \"tournaments\",\n        );\n        console.log(\"[Tournaments] fetched list:\", newList);\n      } catch {}\n      setFetchError(null);\n      setLastRefresh(Date.now());\n    } catch (err: any) {\n      try {\n        if (typeof window !== \"undefined\") {\n          setFetchError(String(err?.message || err));\n        }\n      } catch {\n        if (typeof window !== \"undefined\") {\n          setFetchError(\"unknown\");\n        }\n      }\n    }\n  }\n  useEffect(() => {\n    refresh();\n  }, []);\n\n  // Re-fetch tournaments when we have a fresh WS connection so clients resync after reconnects/server restarts\n  useEffect(() => {\n    try {\n      if (wsGlobal?.connected) refresh();\n    } catch {}\n  }, [wsGlobal?.connected]);\n\n  // Listen for WS push updates from global provider if available\n  useEffect(() => {\n    if (!wsGlobal) return;\n    const unsub = wsGlobal.addListener((msg: any) => {\n      try {\n        if (msg.type === \"tournaments\") {\n          setList(msg.tournaments || []);\n          setLastRefresh(Date.now());\n        }\n        if (msg.type === \"tournaments\") {\n          try {\n            console.debug(\n              \"[Tournaments] WS tournaments update, num=\",\n              (msg.tournaments || []).length,\n            );\n          } catch {}\n        }\n        if (msg.type === \"tournament-win\" && msg.message) {\n          toast(msg.message, { type: \"success\", timeout: 10000 }); // Show for 10 seconds\n        }\n        // tournament-reminder handled optionally here if desired\n      } catch {}\n    });\n    return () => {\n      unsub();\n    };\n  }, [wsGlobal?.connected]);\n\n  // If WS connects, ask for a fresh list via WS; this will prompt server to send a tournaments snapshot.\n  useEffect(() => {\n    try {\n      if (wsGlobal?.connected) {\n        try {\n          wsGlobal.send({ type: \"list-tournaments\" });\n        } catch {}\n        // Also ensure we refresh as a fallback\n        refresh();\n      }\n    } catch {}\n  }, [wsGlobal?.connected]);\n\n  // Polling fallback: if WS is unavailable, poll the API every 10s to keep lobby up-to-date\n  useEffect(() => {\n    let iv: number | null = null;\n    try {\n      if (!wsGlobal || !wsGlobal.connected) {\n        iv = window.setInterval(() => {\n          refresh();\n        }, 10000);\n      }\n    } catch {}\n    return () => {\n      if (iv) clearInterval(iv);\n    };\n  }, [wsGlobal?.connected]);\n\n  const email = String(user?.email || \"\").toLowerCase();\n  const showDemoControls =\n    (import.meta as any).env?.DEV || email === \"daviesfamily108@gmail.com\";\n\n  const runTournamentInPlayDemo = () => {\n    launchInPlayDemo({\n      players: [\"Tournament A\", \"Tournament B\"],\n      startingScore: 501,\n      roomId: \"tournament-demo\",\n      visits: [{ score: 45 }, { score: 81 }, { score: 140 }],\n    });\n  };\n\n  const hasJoined = (t: Tournament | null | undefined) => {\n    if (!t || !email) return false;\n    const ps = Array.isArray(t.participants) ? t.participants : [];\n    return ps.some((p) => String(p?.email || \"\").toLowerCase() === email);\n  };\n\n  // Simple, persistent match preference UI\n  const MatchPrefs = () => (\n    <div className=\"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap\">\n      <span className=\"opacity-70\">Default match</span>\n      <span className=\"btn py-1 px-2 bg-indigo-500/30 border border-indigo-400/50 text-indigo-100\">\n        Singles\n      </span>\n      <span className=\"text-xs opacity-60 ml-2\">\n        (tournaments use Singles only)\n      </span>\n    </div>\n  );\n  // Fetch subscription to detect if user is a recent tournament winner (cooldown)\n  useEffect(() => {\n    let abort = false;\n    async function check() {\n      if (!email) {\n        setCooldownUntil(null);\n        return;\n      }\n      try {\n        const res = await apiFetch(\n          `/api/subscription?email=${encodeURIComponent(email)}`,\n        );\n        const data = await res.json();\n        if (!abort) {\n          if (\n            data?.source === \"tournament\" &&\n            typeof data.expiresAt === \"number\" &&\n            data.expiresAt > Date.now()\n          ) {\n            setCooldownUntil(data.expiresAt);\n          } else {\n            setCooldownUntil(null);\n          }\n        }\n      } catch {\n        if (!abort) setCooldownUntil(null);\n      }\n    }\n    check();\n    return () => {\n      abort = true;\n    };\n  }, [email]);\n\n  // Helper to delete a tournament with proper error handling and owner fallback\n  async function deleteTournament(t: Tournament) {\n    if (!email) return;\n    setDeleteConfirm({ open: true, t });\n  }\n\n  async function confirmDeleteTournament() {\n    const t = deleteConfirm.t;\n    if (!t || !email) return;\n    setDeleteConfirm({ open: false, t: null });\n    setLoading(true);\n    try {\n      // First try creator/owner shared endpoint\n      let res = await apiFetch(\"/api/tournaments/delete\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ tournamentId: t.id, requesterEmail: email }),\n      });\n\n      // If forbidden but user is the owner, try the admin endpoint as a fallback\n      if (\n        !res.ok &&\n        res.status === 403 &&\n        String(email) === \"daviesfamily108@gmail.com\"\n      ) {\n        res = await apiFetch(\"/api/admin/tournaments/delete\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ tournamentId: t.id, requesterEmail: email }),\n        });\n      }\n\n      if (!res.ok) {\n        let msg = \"Delete failed\";\n        try {\n          const data = await res.json();\n          if (data?.error) msg = `Delete failed: ${String(data.error)}`;\n        } catch {}\n        toast(msg, { type: \"error\" });\n        return;\n      }\n\n      toast(\"Tournament deleted\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function join(t: Tournament) {\n    if (!email) return;\n    setLoading(true);\n    try {\n      const res = await apiFetch(\"/api/tournaments/join\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          tournamentId: t.id,\n          email,\n          username: user?.username,\n        }),\n      });\n      if (!res.ok) {\n        let data: any = {};\n        try {\n          data = await res.json();\n        } catch {}\n        if (\n          data?.error === \"WINNER_COOLDOWN\" &&\n          typeof data.until === \"number\"\n        ) {\n          setErrorMsg(\n            `You're a recent NDN tournament winner. You can re-enter after ${fmt(data.until)}.`,\n          );\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          toast(\"Join blocked: winner cooldown active\", { type: \"error\" });\n        } else if (data?.error === \"ALREADY_IN_TOURNAMENT\") {\n          setErrorMsg(\n            String(\n              data.message || \"You can only join one tournament at a time.\",\n            ),\n          );\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          toast(\"Join blocked: already in another tournament\", {\n            type: \"error\",\n          });\n        } else if (data?.error) {\n          setErrorMsg(String(data.error));\n          setTimeout(() => setErrorMsg(\"\"), 3500);\n          toast(`Join failed: ${String(data.error)}`, { type: \"error\" });\n        }\n        return;\n      }\n      toast(\"Joined tournament\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function leave(t: Tournament) {\n    if (!email) return;\n    setLoading(true);\n    try {\n      const res = await apiFetch(\"/api/tournaments/leave\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ tournamentId: t.id, email }),\n      });\n      if (!res.ok) {\n        let data: any = {};\n        try {\n          data = await res.json();\n        } catch {}\n        if (data?.error) {\n          toast(`Leave failed: ${String(data.error)}`, { type: \"error\" });\n        } else if (res.status === 404) {\n          toast(\n            \"Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.\",\n            { type: \"error\" },\n          );\n        } else {\n          toast(\"Leave failed. Please try again.\", { type: \"error\" });\n        }\n        return;\n      }\n      toast(\"Left tournament\", { type: \"success\" });\n      // Optimistic local update\n      setList((prev) =>\n        prev.map((it) =>\n          it.id === t.id\n            ? {\n                ...it,\n                participants: (it.participants || []).filter(\n                  (p) => p.email !== email,\n                ),\n              }\n            : it,\n        ),\n      );\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function createTournament() {\n    setLoading(true);\n    try {\n      const start = new Date(form.startAt).getTime();\n      const res = await apiFetch(\"/api/tournaments/create\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          title: form.title,\n          game: form.game,\n          mode: form.mode,\n          value: Number(form.value),\n          description: form.description,\n          startAt: start,\n          checkinMinutes: Number(form.checkinMinutes),\n          capacity: Number(form.capacity),\n          startingScore:\n            form.game === \"X01\" ? Number(form.startingScore || 501) : undefined,\n          requireCalibration: !!form.requireCalibration,\n          creatorEmail: user?.email,\n          creatorName: user?.username,\n        }),\n      });\n      if (!res.ok) {\n        let details = \"\";\n        try {\n          const data = await res.json();\n          if (data?.error) details = String(data.error);\n          else if (data?.details) details = String(data.details);\n        } catch {}\n        const msg = details\n          ? `Create failed: ${details}`\n          : \"Create failed. Please try again.\";\n        setErrorMsg(msg);\n        toast(msg, { type: \"error\" });\n        setTimeout(() => setErrorMsg(\"\"), 6000);\n        return;\n      }\n      try {\n        const data = await res.json();\n        if (!data?.ok) {\n          const msg = data?.error\n            ? `Create failed: ${String(data.error)}`\n            : \"Create failed. Please try again.\";\n          setErrorMsg(msg);\n          toast(msg, { type: \"error\" });\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          return;\n        }\n      } catch {}\n      setShowCreate(false);\n      toast(\"Tournament created\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Close the create modal on Escape\n  useEffect(() => {\n    if (!showCreate) return;\n    const onKey = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") setShowCreate(false);\n    };\n    document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [showCreate]);\n\n  const visibleTournaments = useMemo(\n    () => list.filter((t) => !isIntegrationTournament(t)),\n    [list],\n  );\n  const official = useMemo(\n    () => visibleTournaments.filter((t) => t.official),\n    [visibleTournaments],\n  );\n  const community = useMemo(\n    () => visibleTournaments.filter((t) => !t.official),\n    [visibleTournaments],\n  );\n  const created = useMemo(\n    () =>\n      visibleTournaments.filter((t) => t.status === \"scheduled\" && !t.official),\n    [visibleTournaments],\n  );\n\n  // Pagination for Created Game Lobby\n  const [createdPage, setCreatedPage] = useState(1);\n  const itemsPerPage = 16;\n  const createdTotalPages = Math.ceil(created.length / itemsPerPage);\n  const paginatedCreated = created.slice(\n    (createdPage - 1) * itemsPerPage,\n    createdPage * itemsPerPage,\n  );\n\n  // Pagination for Community List\n  const [communityPage, setCommunityPage] = useState(1);\n  const communityTotalPages = Math.ceil(community.length / itemsPerPage);\n  const paginatedCommunity = community.slice(\n    (communityPage - 1) * itemsPerPage,\n    communityPage * itemsPerPage,\n  );\n\n  const nextOfficial = useMemo(() => {\n    const upcoming = official\n      .filter((t) => t.status === \"scheduled\")\n      .sort((a, b) => a.startAt - b.startAt);\n    return upcoming[0] || null;\n  }, [official]);\n\n  function fmt(ts: number) {\n    const d = new Date(ts);\n    return d.toLocaleString();\n  }\n\n  return (\n    <div className=\"card ndn-game-shell ndn-page\">\n      <div className=\"flex items-center justify-between mb-3\">\n        <h2 className=\"text-2xl font-bold ndn-section-title\">Tournaments 🎯</h2>\n      </div>\n      <div className=\"ndn-shell-body\">\n        {/* Create Tournament + and default match prefs on a single header row */}\n        <div className=\"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap\">\n          <div className=\"min-w-0\">\n            <MatchPrefs />\n          </div>\n          <div className=\"shrink-0\">\n            <button className=\"btn\" onClick={() => setShowCreate(true)}>\n              Create Tournament + 🎯\n            </button>\n            {showDemoControls && (\n              <button\n                className=\"btn btn-ghost ml-2\"\n                onClick={() => setShowDemoStart(true)}\n              >\n                Demo Start Showcase 🎯\n              </button>\n            )}\n            {showDemoControls && (\n              <button\n                className=\"btn btn-ghost ml-2\"\n                onClick={runTournamentInPlayDemo}\n              >\n                Demo In-Game 🎮\n              </button>\n            )}\n          </div>\n        </div>\n        {/* DEV-only start showcase demo */}\n        {showDemoStart && (\n          <MatchStartShowcase\n            players={[\n              { id: \"0\", name: \"Demo A\", legsWon: 0, legs: [] },\n              { id: \"1\", name: \"Demo B\", legsWon: 0, legs: [] },\n            ]}\n            user={user}\n            onDone={() => setShowDemoStart(false)}\n          />\n        )}\n        {/* Show overlay when a tournament match starts while on the tournaments page */}\n        {showStartShowcase && (\n          <MatchStartShowcase\n            players={(match.players || []) as any}\n            user={user}\n            onDone={() => setShowStartShowcase(false)}\n          />\n        )}\n        <div className=\"mb-2 text-sm font-semibold text-slate-300\">\n          World Lobby\n        </div>\n        {/* Created Game Lobby: show all created tournaments (scheduled) */}\n        <div className=\"mb-3 p-3 rounded-xl border border-slate-700 bg-black/10\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"font-semibold\">Created Game Lobby</div>\n            <div className=\"text-xs opacity-60\">\n              All tournaments created by users and admins\n            </div>\n          </div>\n          <ul className=\"space-y-2\">\n            {created.length === 0 && (\n              <li className=\"text-sm opacity-60\">\n                No created tournaments yet.\n              </li>\n            )}\n            {paginatedCreated.map((t) => (\n              <MatchCard\n                key={t.id}\n                t={t}\n                  onJoin={(m: any) => join(m)}\n                  onLeave={(m: any) => leave(m)}\n                joined={hasJoined(t)}\n                disabled={\n                  loading ||\n                  t.status !== \"scheduled\" ||\n                  (!hasJoined(t) && t.participants.length >= t.capacity)\n                }\n              />\n            ))}\n          </ul>\n          {/* Pagination controls for Created Game Lobby */}\n          {createdTotalPages > 1 && (\n            <div className=\"mt-4 flex items-center justify-between text-sm\">\n              <button\n                className=\"text-slate-300 hover:text-white transition-colors\"\n                onClick={() => setCreatedPage((p) => Math.max(p - 1, 1))}\n                disabled={createdPage === 1}\n              >\n                &larr; Previous\n              </button>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-slate-400\">\n                  Page {createdPage} of {createdTotalPages}\n                </span>\n                <button\n                  className=\"text-slate-300 hover:text-white transition-colors\"\n                  onClick={() =>\n                    setCreatedPage((p) => Math.min(p + 1, createdTotalPages))\n                  }\n                  disabled={createdPage === createdTotalPages}\n                >\n                  Next &rarr;\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n        {/* Persistent banner for next official weekly tournament */}\n        {nextOfficial && (\n          <div className=\"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\n            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2\">\n              <div>\n                <div className=\"text-sm uppercase tracking-wide text-indigo-300 font-semibold\">\n                  Weekly Official Tournament 🎯\n                </div>\n                <div className=\"font-bold\">{nextOfficial.title}</div>\n                <div className=\"text-sm opacity-80\">\n                  {nextOfficial.game}\n                  {nextOfficial.game === \"X01\" && nextOfficial.startingScore\n                    ? `/${nextOfficial.startingScore}`\n                    : \"\"}{\" \"}\n                  · {labelForMode(nextOfficial.mode)} {nextOfficial.value} ·\n                  Starts {fmt(nextOfficial.startAt)} · Cap{\" \"}\n                  {nextOfficial.capacity} · Joined{\" \"}\n                  {nextOfficial.participants.length}\n                </div>\n                {nextOfficial.prize && (\n                  <div className=\"text-xs mt-1\">Prize: 3 months PREMIUM</div>\n                )}\n                {nextOfficial.status !== \"scheduled\" && (\n                  <div className=\"text-xs\">Status: {nextOfficial.status}</div>\n                )}\n                {cooldownUntil && cooldownUntil > Date.now() && (\n                  <div className=\"text-xs text-rose-300\">\n                    Recent winners can re-enter after {fmt(cooldownUntil)}.\n                  </div>\n                )}\n              </div>\n              <div className=\"shrink-0\">\n                <button\n                  className={`btn ${hasJoined(nextOfficial) ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n                  title={\n                    hasJoined(nextOfficial)\n                      ? \"Double-click to leave this tournament\"\n                      : nextOfficial.official &&\n                          cooldownUntil &&\n                          cooldownUntil > Date.now()\n                        ? `Recent winners can re-enter after ${fmt(cooldownUntil)}`\n                        : \"\"\n                  }\n                  disabled={\n                    loading ||\n                    nextOfficial.status !== \"scheduled\" ||\n                    (!hasJoined(nextOfficial) &&\n                      (nextOfficial.participants.length >=\n                        nextOfficial.capacity ||\n                        (!!cooldownUntil && cooldownUntil > Date.now())))\n                  }\n                  onClick={() => {\n                    if (!hasJoined(nextOfficial)) {\n                      join(nextOfficial);\n                    } else if (isTouch) {\n                      setLeaveAsk({ open: true, t: nextOfficial });\n                    }\n                  }}\n                  onDoubleClick={() => {\n                    if (!isTouch && hasJoined(nextOfficial))\n                      setLeaveAsk({ open: true, t: nextOfficial });\n                  }}\n                  aria-label={\n                    hasJoined(nextOfficial) ? \"Already Joined\" : \"Join Now\"\n                  }\n                >\n                  {hasJoined(nextOfficial)\n                    ? \"Already Joined! 🎯\"\n                    : \"Join Now 🎯\"}\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n        {errorMsg && (\n          <div className=\"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm\">\n            {errorMsg}\n          </div>\n        )}\n        <div className=\"space-y-4\">\n          <section>\n            <div className=\"font-semibold mb-1\">Official 🎯</div>\n            <div className=\"text-xs opacity-70 mb-2\">\n              {cooldownUntil && cooldownUntil > Date.now() ? (\n                <>\n                  You’re a recent NDN tournament winner — to keep it fair, you\n                  can re-enter after {fmt(cooldownUntil)}.\n                </>\n              ) : (\n                <>\n                  Note: Weekly winners can re-enter once their 3 months of\n                  PREMIUM ends.\n                </>\n              )}\n            </div>\n            <ul className=\"space-y-2\">\n              {official.map((t) => (\n                <li\n                  key={t.id}\n                  className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\"\n                >\n                  <div className=\"space-y-0.5\">\n                    <div className=\"font-semibold\">\n                      {t.title}{\" \"}\n                      {t.prize && (\n                        <span className=\"inline-flex items-center gap-1 ml-2 align-middle\">\n                          <span className=\"text-xs px-2 py-0.5 rounded bg-amber-500 text-black\">\n                            Prize\n                          </span>\n                          <span\n                            className=\"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help\"\n                            title=\"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.\"\n                            aria-label=\"Prize info\"\n                          >\n                            i\n                          </span>\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"text-sm opacity-80\">\n                      {t.game}\n                      {t.game === \"X01\" && t.startingScore\n                        ? `/${t.startingScore}`\n                        : \"\"}{\" \"}\n                      · {labelForMode(t.mode)} {t.value} · {fmt(t.startAt)} ·\n                      Cap {t.capacity} · Joined {t.participants.length}\n                    </div>\n                    {t.prize && (\n                      <div className=\"text-xs\">Prize: 3 months PREMIUM</div>\n                    )}\n                    {t.status !== \"scheduled\" && (\n                      <div className=\"text-xs\">Status: {t.status}</div>\n                    )}\n                    {hasJoined(t) && (\n                      <div className=\"text-xs text-emerald-400 font-semibold\">\n                        Already Joined\n                      </div>\n                    )}\n                    {t.official &&\n                      cooldownUntil &&\n                      cooldownUntil > Date.now() && (\n                        <div className=\"text-xs text-rose-300\">\n                          Cooldown active until {fmt(cooldownUntil)}.\n                        </div>\n                      )}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className={`btn ${hasJoined(t) ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n                      title={\n                        hasJoined(t)\n                          ? \"Double-click to leave this tournament\"\n                          : t.official &&\n                              cooldownUntil &&\n                              cooldownUntil > Date.now()\n                            ? `Recent winners can re-enter after ${fmt(cooldownUntil)}`\n                            : \"\"\n                      }\n                      disabled={\n                        loading ||\n                        t.status !== \"scheduled\" ||\n                        (!hasJoined(t) &&\n                          (t.participants.length >= t.capacity ||\n                            (t.official &&\n                              !!cooldownUntil &&\n                              cooldownUntil > Date.now())))\n                      }\n                      onClick={() => {\n                        if (!hasJoined(t)) {\n                          join(t);\n                        } else if (isTouch) {\n                          setLeaveAsk({ open: true, t });\n                        }\n                      }}\n                      onDoubleClick={() => {\n                        if (!isTouch && hasJoined(t))\n                          setLeaveAsk({ open: true, t });\n                      }}\n                      aria-label={hasJoined(t) ? \"Already Joined\" : \"Join Now\"}\n                    >\n                      {hasJoined(t) ? \"Already Joined! 🎯\" : \"Join Now 🎯\"}\n                    </button>\n                    {/* Delete button when you are the creator (owner-created official) and it hasn't started */}\n                    {t.status === \"scheduled\" &&\n                      email &&\n                      ((t.creatorEmail &&\n                        String(t.creatorEmail).toLowerCase() === email) ||\n                        email === \"daviesfamily108@gmail.com\") && (\n                        <button\n                          className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\n                          title=\"Delete this tournament\"\n                          onClick={() => deleteTournament(t)}\n                          aria-label=\"Delete tournament\"\n                        >\n                          ×\n                        </button>\n                      )}\n                  </div>\n                </li>\n              ))}\n              {official.length === 0 && (\n                <li className=\"text-sm opacity-60\">\n                  No official tournaments yet.\n                </li>\n              )}\n            </ul>\n          </section>\n\n          <section>\n            <div className=\"font-semibold mb-1\">Community 🎯</div>\n            <ul className=\"space-y-2\">\n              {paginatedCommunity.map((t) => (\n                <li\n                  key={t.id}\n                  className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\"\n                >\n                  <div className=\"space-y-0.5\">\n                    <div className=\"font-semibold\">{t.title}</div>\n                    <div className=\"text-sm opacity-80\">\n                      {t.game}\n                      {t.game === \"X01\" && t.startingScore\n                        ? `/${t.startingScore}`\n                        : \"\"}{\" \"}\n                      · {labelForMode(t.mode)} {t.value} · {fmt(t.startAt)} ·\n                      Cap {t.capacity} · Joined {t.participants.length}\n                    </div>\n                    {t.description && (\n                      <div className=\"text-xs opacity-80\">{t.description}</div>\n                    )}\n                    {hasJoined(t) && (\n                      <div className=\"text-xs text-emerald-400 font-semibold\">\n                        Already Joined\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className=\"btn\"\n                      title={\n                        hasJoined(t)\n                          ? \"Double-click to leave this tournament\"\n                          : \"\"\n                      }\n                      disabled={\n                        loading ||\n                        t.status !== \"scheduled\" ||\n                        (!hasJoined(t) && t.participants.length >= t.capacity)\n                      }\n                      onClick={() => {\n                        if (!hasJoined(t)) {\n                          join(t);\n                        } else if (isTouch) {\n                          setLeaveAsk({ open: true, t });\n                        }\n                      }}\n                      onDoubleClick={() => {\n                        if (!isTouch && hasJoined(t))\n                          setLeaveAsk({ open: true, t });\n                      }}\n                    >\n                      {hasJoined(t) ? \"Already Joined\" : \"Join Now\"}\n                    </button>\n                    {/* Delete button for creator to delete their own scheduled tournament */}\n                    {t.status === \"scheduled\" &&\n                      email &&\n                      ((t.creatorEmail &&\n                        String(t.creatorEmail).toLowerCase() === email) ||\n                        email === \"daviesfamily108@gmail.com\") && (\n                        <button\n                          className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\n                          title=\"Delete this tournament\"\n                          onClick={() => deleteTournament(t)}\n                          aria-label=\"Delete tournament\"\n                        >\n                          ×\n                        </button>\n                      )}\n                  </div>\n                </li>\n              ))}\n              {community.length === 0 && (\n                <li className=\"text-sm opacity-60\">\n                  No community tournaments yet.\n                </li>\n              )}\n            </ul>\n            {/* Pagination Controls for Community */}\n            {communityTotalPages > 1 && (\n              <div className=\"flex items-center justify-center gap-2 mt-4 pt-2 border-t border-white/10\">\n                <button\n                  className=\"btn btn-sm btn-ghost\"\n                  disabled={communityPage === 1}\n                  onClick={() => setCommunityPage((p) => Math.max(1, p - 1))}\n                >\n                  Previous\n                </button>\n                <span className=\"text-sm opacity-70\">\n                  Page {communityPage} of {communityTotalPages}\n                </span>\n                <button\n                  className=\"btn btn-sm btn-ghost\"\n                  disabled={communityPage === communityTotalPages}\n                  onClick={() =>\n                    setCommunityPage((p) =>\n                      Math.min(communityTotalPages, p + 1),\n                    )\n                  }\n                >\n                  Next\n                </button>\n              </div>\n            )}\n          </section>\n        </div>\n\n        {showCreate && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"create-tournament-heading\"\n            tabIndex={-1}\n            className=\"fixed inset-0 z-[70] flex items-center justify-center bg-black/60 p-4\"\n            onClick={(e) => {\n              if (e.target === e.currentTarget) setShowCreate(false);\n            }}\n          >\n            <div className=\"bg-slate-800 rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3\n                  id=\"create-tournament-heading\"\n                  className=\"text-2xl font-semibold\"\n                >\n                  Create Tournament 🎯\n                </h3>\n                <button className=\"btn\" onClick={() => setShowCreate(false)}>\n                  Close ✕\n                </button>\n              </div>\n              <div className=\"space-y-4 md:space-y-0 md:grid md:grid-cols-2 md:gap-4\">\n                <div>\n                  <label className=\"block text-sm font-semibold mb-2\">\n                    Title\n                  </label>\n                  <input\n                    className=\"input w-full\"\n                    value={form.title}\n                    onChange={(e) =>\n                      setForm((f) => ({ ...f, title: e.target.value }))\n                    }\n                    placeholder=\"Enter tournament title\"\n                  />\n                </div>\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Game\n                    </label>\n                    <select\n                      className=\"input w-full\"\n                      value={form.game}\n                      onChange={(e) =>\n                        setForm((f) => ({ ...f, game: e.target.value }))\n                      }\n                    >\n                      {(DEFAULT_TOURNAMENT_GAMES.filter((g) =>\n                        (allGames as readonly string[]).includes(g),\n                      ).length\n                        ? DEFAULT_TOURNAMENT_GAMES\n                        : allGames\n                      ).map((g) => (\n                        <option key={g} value={g}>\n                          {g}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Mode\n                    </label>\n                    <select\n                      className=\"input w-full\"\n                      value={form.mode}\n                      onChange={(e) =>\n                        setForm((f) => ({ ...f, mode: e.target.value as any }))\n                      }\n                    >\n                      {getModeOptionsForGame(\n                        form.game as import(\"../utils/games.js\").GameKey,\n                      ).map((o: unknown) => (\n                        <option key={String(o)} value={String(o)}>\n                          {labelForMode(String(o))}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Number\n                    </label>\n                    <input\n                      className=\"input w-full\"\n                      type=\"number\"\n                      min={1}\n                      value={form.value}\n                      onChange={(e) =>\n                        setForm((f) => ({\n                          ...f,\n                          value: Number(e.target.value),\n                        }))\n                      }\n                    />\n                  </div>\n                </div>\n                <div>\n                  <label className=\"block text-sm font-semibold mb-1\">\n                    Description\n                  </label>\n                  <textarea\n                    className=\"input w-full\"\n                    rows={5}\n                    value={form.description}\n                    onChange={(e) =>\n                      setForm((f) => ({ ...f, description: e.target.value }))\n                    }\n                  />\n                </div>\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Start time\n                    </label>\n                    <input\n                      className=\"input w-full\"\n                      type=\"datetime-local\"\n                      value={form.startAt}\n                      onChange={(e) =>\n                        setForm((f) => ({ ...f, startAt: e.target.value }))\n                      }\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Check-in reminder (min)\n                    </label>\n                    <input\n                      className=\"input w-full\"\n                      type=\"number\"\n                      min={0}\n                      value={form.checkinMinutes}\n                      onChange={(e) =>\n                        setForm((f) => ({\n                          ...f,\n                          checkinMinutes: Number(e.target.value),\n                        }))\n                      }\n                    />\n                  </div>\n                </div>\n                {form.game === \"X01\" && (\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      X01 Starting Score\n                    </label>\n                    <select\n                      className=\"input w-full\"\n                      value={String(form.startingScore)}\n                      onChange={(e) =>\n                        setForm((f) => ({\n                          ...f,\n                          startingScore: Number(e.target.value),\n                        }))\n                      }\n                    >\n                      {[301, 501, 701].map((s) => (\n                        <option key={s} value={s}>\n                          {s}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                )}\n                <div>\n                  <label className=\"inline-flex items-center gap-2 text-sm\">\n                    <input\n                      type=\"checkbox\"\n                      className=\"accent-purple-500\"\n                      checked={!!form.requireCalibration}\n                      onChange={(e) =>\n                        setForm((f) => ({\n                          ...f,\n                          requireCalibration: !!e.target.checked,\n                        }))\n                      }\n                    />\n                    <span className=\"font-semibold\">Require Camera</span>\n                  </label>\n                  <div className=\"text-xs opacity-70 mt-1\">\n                    If checked, players must have a camera connected to join\n                    matches spawned from this tournament.\n                  </div>\n                </div>\n                <div>\n                  <label className=\"block text-sm font-semibold mb-1\">\n                    Capacity\n                  </label>\n                  <input\n                    className=\"input w-full\"\n                    type=\"number\"\n                    min={6}\n                    max={64}\n                    value={form.capacity}\n                    onChange={(e) =>\n                      setForm((f) => ({\n                        ...f,\n                        capacity: Number(e.target.value),\n                      }))\n                    }\n                  />\n                </div>\n                <div className=\"text-xs opacity-70\">\n                  Note: community tournaments do not award prizes.\n                </div>\n                <div className=\"flex justify-end gap-3 mt-6\">\n                  <button\n                    className=\"btn btn-ghost\"\n                    onClick={() => setShowCreate(false)}\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    className=\"btn\"\n                    disabled={loading}\n                    onClick={createTournament}\n                  >\n                    {loading ? \"Creating...\" : \"Create Tournament\"}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Join Modal (simplified) */}\n        {joinMatch && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"join-heading\"\n            tabIndex={-1}\n            className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4\"\n          >\n            <div className=\"bg-slate-800 rounded-2xl p-6 max-w-md w-full\">\n              <div id=\"join-heading\" className=\"text-lg font-bold mb-2\">\n                Match Ready\n              </div>\n              <div className=\"mb-3\">\n                {joinMatch.game} - {joinMatch.modeType} · {joinMatch.legs} legs\n              </div>\n              <div className=\"text-sm opacity-80 mb-3\">\n                Created by {joinMatch.createdBy}\n              </div>\n              {joinMatch.startingScore && (\n                <div className=\"mb-3\">\n                  Starting score:{\" \"}\n                  <span className=\"font-mono\">{joinMatch.startingScore}</span>\n                </div>\n              )}\n              {/* Match start showcase overlay */}\n              <MatchStartShowcase\n                open={showStartShowcase}\n                players={match.players as any}\n                user={user}\n                onRequestClose={() => {}}\n                onDone={() => {}}\n              />\n              <div className=\"mb-3\">\n                Timer: <span className=\"font-mono\">{joinTimer}s</span>\n              </div>\n              {(joinTimer <= 15 || (joinMatch as any)?.prestartEndsAt) && (\n                <div className=\"mb-3\">\n                  Choose:{\" \"}\n                  <div className=\"flex gap-2\">\n                    <button\n                      className={`btn ${joinChoice === \"bull\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"bull\")}\n                    >\n                      Bull Up\n                    </button>\n                    <button\n                      className={`btn ${joinChoice === \"skip\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"skip\")}\n                    >\n                      Skip\n                    </button>\n                  </div>\n                  <div className=\"text-xs opacity-70 mt-2\">\n                    {joinChoice\n                      ? `You chose: ${joinChoice}`\n                      : \"Please choose Bull Up or Skip before accepting\"}\n                  </div>\n                  {Object.keys(remoteChoices).length > 0 && (\n                    <div\n                      className=\"text-xs opacity-70 mt-2\"\n                      role=\"status\"\n                      aria-live=\"polite\"\n                    >\n                      {Object.entries(remoteChoices).map(([pid, choice]) => (\n                        <div key={pid}>\n                          {participants[pid] || pid} chose: {choice}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  {joinChoice === \"skip\" && (\n                    <div className=\"text-xs opacity-70 mt-2\">\n                      Skip requires both players to click Skip. Waiting for\n                      opponent...\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {leaveAsk.open && leaveAsk.t && (\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n            <div\n              className=\"absolute inset-0 bg-black/40\"\n              onClick={() => setLeaveAsk({ open: false, t: null })}\n            />\n            <div className=\"relative card p-4 w-[360px] max-w-[90vw]\">\n              <div className=\"text-lg font-semibold mb-2\">\n                Leave tournament?\n              </div>\n              <div className=\"text-sm opacity-80 mb-4\">\n                Are you sure you want to remove yourself from “\n                {leaveAsk.t.title}”?\n              </div>\n              <div className=\"flex items-center justify-end gap-2\">\n                <button\n                  className=\"btn bg-rose-600 hover:bg-rose-700\"\n                  onClick={() => setLeaveAsk({ open: false, t: null })}\n                >\n                  Decline\n                </button>\n                <button\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700\"\n                  onClick={async () => {\n                    const t = leaveAsk.t!;\n                    setLeaveAsk({ open: false, t: null });\n                    await leave(t);\n                  }}\n                >\n                  Accept\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Delete Tournament Confirmation Modal */}\n        {deleteConfirm.open && deleteConfirm.t && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n            <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\n              <div className=\"text-center\">\n                <div className=\"text-xl font-semibold mb-4 text-white\">\n                  Delete Tournament\n                </div>\n                <div className=\"text-slate-300 mb-6\">\n                  Are you sure you want to delete{\" \"}\n                  <span className=\"font-semibold text-white\">\n                    \"{deleteConfirm.t.title}\"\n                  </span>\n                  ?\n                  <br />\n                  <span className=\"text-sm text-slate-400\">\n                    This action cannot be undone.\n                  </span>\n                </div>\n                <div className=\"flex gap-3 justify-center\">\n                  <button\n                    className=\"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\n                    onClick={() => setDeleteConfirm({ open: false, t: null })}\n                  >\n                    Decline\n                  </button>\n                  <button\n                    className=\"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors\"\n                    onClick={confirmDeleteTournament}\n                  >\n                    Continue\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Phone camera overlay removed per UX preference; header badge preview only */}\n      </div>\n    </div>\n  );\n}\n"],"names":["MatchCard","t","onJoin","onLeave","joined","disabled","jsxs","jsx","labelForMode","InGameShell","user","showStartShowcaseProp","onShowStartShowcaseChange","match","useMatch","useUserSettings","s","useMatchControl","usePendingVisit","winningShot","setWinningShot","useState","remoteFrame","lastOfflineStart","settingsUser","localPlayerName","resolvedLocalIndex","p","localPlayerIndex","isUsersTurn","localPlayer","localRemaining","awayIdx","_p","idx","awayPlayer","awayRemaining","gameMode","scoreboardPlayers","useOnlineGameStats","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","showQuitPause","setShowQuitPause","setPaused","paused","pauseEndsAt","pauseInitiator","pauseNow","setPauseNow","useEffect","now","checkoutRoutes","useMemo","routes","suggestCheckouts","legsInfo","showStartShowcaseLocal","setShowStartShowcase","open","showcaseLockedOpenRef","useRef","commitVisit","score","darts","meta","leg","prevRemaining","numericScore","newRemaining","playerName","getPreferredUserName","sayScore","deriveWinningLabel","useCallback","legs","lastVisit","latest","a","b","entry","derived","prev","MatchStartShowcase","PauseTimerBadge","route","i","CameraView","_score","_darts","finished","frame","LetterboxScoreboardOverlay","GameScoreboard","MatchControls","v","PauseQuitModal","minutes","endsAt","broadcastMessage","remaining","secs","mm","ss","started","total","pct","isInitiator","DEFAULT_TOURNAMENT_GAMES","containsIntegrationMarker","value","isIntegrationTournament","isTouch","Tournaments","toast","useToast","wsGlobal","useWS","_matchType","_setMatchType","_teamAName","_setTeamAName","_teamBName","_setTeamBName","list","setList","loading","setLoading","errorMsg","setErrorMsg","_fetchError","setFetchError","lastRefresh","setLastRefresh","cooldownUntil","setCooldownUntil","showCreate","setShowCreate","showDemoStart","setShowDemoStart","showStartShowcase","inProgress","roomId","st","flagKey","openMatchWindow","form","setForm","joinMatch","setJoinMatch","joinTimer","setJoinTimer","joinChoice","setJoinChoice","remoteChoices","setRemoteChoices","_bullActive","setBullActive","_bullThrown","setBullThrown","_bullLocalThrow","setBullLocalThrow","_bullWinner","setBullWinner","leaveAsk","setLeaveAsk","deleteConfirm","setDeleteConfirm","serverPrestartRef","participants","setParticipants","msg","m","playerId","choice","sendPrestartChoice","refresh","data","apiFetch","newList","err","unsub","iv","email","showDemoControls","runTournamentInPlayDemo","launchInPlayDemo","hasJoined","MatchPrefs","abort","check","deleteTournament","confirmDeleteTournament","res","join","fmt","leave","it","createTournament","start","details","onKey","e","visibleTournaments","official","community","created","createdPage","setCreatedPage","itemsPerPage","createdTotalPages","paginatedCreated","communityPage","setCommunityPage","communityTotalPages","paginatedCommunity","nextOfficial","ts","Fragment","f","g","allGames","getModeOptionsForGame","o","pid"],"mappings":"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"}
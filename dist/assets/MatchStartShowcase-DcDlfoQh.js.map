{"version":3,"file":"MatchStartShowcase-DcDlfoQh.js","sources":["../../src/components/ui/CalibrationPopup.tsx","../../src/components/ui/MatchStartShowcase.tsx"],"sourcesContent":["import React from 'react'\r\nimport type { Player } from '../../store/match'\r\n\r\nexport default function CalibrationPopup({ players, playerCalibrations, calibrationSkipped, onSkip, onOpenCalibrator, onClose }: { players: Player[]; playerCalibrations: {[k:string]: any}; calibrationSkipped: Record<string, boolean>; onSkip: (id: string) => void; onOpenCalibrator: (id: string) => void; onClose: () => void }) {\r\n  const skippedPlayers = players.filter(p => calibrationSkipped[p.id])\r\n  const remainingPlayers = players.filter(p => !calibrationSkipped[p.id])\r\n  const canStartMatch = remainingPlayers.length === 0\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/90 p-4\">\r\n      <div className=\"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full\">\r\n        <h3 className=\"text-xl font-bold mb-4 text-center\">Calibration Check</h3>\r\n        <p className=\"text-sm opacity-70 mb-6 text-center\">Check your dartboard calibration before the match starts. Both players must skip or confirm to begin.</p>\r\n        {skippedPlayers.length > 0 && remainingPlayers.length > 0 && (\r\n          <div className=\"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg\">\r\n            <p className=\"text-sm text-blue-200\">{skippedPlayers.map(p => p.name).join(', ')} {skippedPlayers.length === 1 ? 'has' : 'have'} chosen to skip. {remainingPlayers.map(p => p.name).join(', ')}, would you like to skip as well?</p>\r\n          </div>\r\n        )}\r\n        <div className=\"space-y-4\">\r\n          {players.map(player => (\r\n            <div key={player.id} className=\"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white\">{player.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)}</div>\r\n                <div>\r\n                  <div className=\"font-medium\">{player.name}</div>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <button className=\"btn btn-sm btn-ghost\" onClick={() => onOpenCalibrator(player.id)}>Bull Up</button>\r\n                <button className=\"btn btn-sm btn-primary\" onClick={() => onSkip(player.id)} disabled={!!calibrationSkipped[player.id]}>{calibrationSkipped[player.id] ? 'Skipped âœ“' : 'Skip'}</button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"mt-6 flex justify-center gap-4\">\r\n          <button className={`btn ${canStartMatch ? 'btn-primary' : 'btn-ghost opacity-50 cursor-not-allowed'}`} disabled={!canStartMatch} onClick={onClose}>Start Match</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useMemo, useState, useRef, useLayoutEffect } from 'react'\r\nimport { createPortal } from 'react-dom'\r\nimport { getAllTimeAvg, getAllTimeFirstNineAvg, getAllTimeBestCheckout, getAllTimeBestLeg, getAllTime, getAllTime180s } from '../../store/profileStats'\r\nimport type { Player } from '../../store/match'\r\nimport { useCalibration } from '../../store/calibration'\r\n\r\nfunction StatBlock({ label, value, className = '', scale = 1 }: { label: string; value: string | number; className?: string; scale?: number }) {\r\n  return (\r\n    <div className={`flex flex-col items-center gap-1 ${className}`}>\r\n      <div className=\"text-xs opacity-70\">{label}</div>\r\n      <div className=\"text-2xl sm:text-3xl font-bold transform transition-transform duration-200 ease-out\" style={{ transform: `scale(${scale})` }}>{value}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction PlayerCalibrationPreview({ player, user, playerCalibrations }: { player: Player; user?: any; playerCalibrations: {[playerName: string]: any} }) {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null)\r\n  const calib = playerCalibrations[player.name]\r\n  const isCalibrated = !!calib\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current\r\n    if (!canvas) return\r\n    const ctx = canvas.getContext('2d')\r\n    if (!ctx) return\r\n\r\n    // Clear canvas\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n\r\n    // Draw a simple dartboard circle\r\n    const centerX = canvas.width / 2\r\n    const centerY = canvas.height / 2\r\n    const radius = Math.min(centerX, centerY) - 2\r\n\r\n    // Outer circle\r\n    ctx.strokeStyle = '#fff'\r\n    ctx.lineWidth = 1\r\n    ctx.beginPath()\r\n    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI)\r\n    ctx.stroke()\r\n\r\n    // Bullseye\r\n    ctx.fillStyle = '#f00'\r\n    ctx.beginPath()\r\n    ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI)\r\n    ctx.fill()\r\n\r\n    // If calibrated, draw calibration points\r\n    if (isCalibrated) {\r\n      ctx.fillStyle = '#0f0'\r\n      // Draw some sample points (simplified)\r\n      const points = [\r\n        [centerX - radius * 0.5, centerY],\r\n        [centerX + radius * 0.5, centerY],\r\n        [centerX, centerY - radius * 0.5],\r\n        [centerX, centerY + radius * 0.5]\r\n      ]\r\n      points.forEach(([x, y]) => {\r\n        ctx.beginPath()\r\n        ctx.arc(x, y, 2, 0, 2 * Math.PI)\r\n        ctx.fill()\r\n      })\r\n    }\r\n  }, [isCalibrated])\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 mt-1\">\r\n      <canvas ref={canvasRef} width={40} height={40} className=\"border border-white/20 rounded\" />\r\n      <span className={`text-xs ${isCalibrated ? 'text-green-400' : 'text-gray-400'}`}>\r\n        {isCalibrated ? 'Calibrated' : 'Not Calibrated'}\r\n      </span>\r\n    </div>\r\n  )\r\n}\r\n\r\nimport FocusLock from 'react-focus-lock'\r\nimport CalibrationPopup from './CalibrationPopup'\r\nexport default function MatchStartShowcase({ open = true, players, user, onDone, onRequestClose, initialSeconds = 15, roomId, onChoice, choices = {}, bullActive = false, onBullThrow, showCalibrationDefault = false, disableEscClose = false }: { open?: boolean; players: Player[]; user?: any; onDone?: () => void; onRequestClose?: () => void; initialSeconds?: number; roomId?: string; onChoice?: (choice: 'bull'|'skip') => void; choices?: Record<string, string>; bullActive?: boolean; onBullThrow?: (score: number) => void; showCalibrationDefault?: boolean; disableEscClose?: boolean }) {\r\n  // Debug logs removed\r\n  const [seconds, setSeconds] = useState(initialSeconds || 15)\r\n  const [scaleState, setScaleState] = useState(1)\r\n  // Overlay visibility is controlled by parent; the component should be controlled using `open` and `onRequestClose`.\r\n  const visible = !!open\r\n  const [showCalibration, setShowCalibration] = useState(false)\r\n  const [calibrationSkipped, setCalibrationSkipped] = useState<{[playerId: string]: boolean}>(() => {\r\n    const map: {[k: string]: boolean} = {}\r\n    if (!showCalibrationDefault) {\r\n      for (const p of players) map[p.id] = true\r\n    }\r\n    return map\r\n  })\r\n  const [playerCalibrations, setPlayerCalibrations] = useState<{[playerName: string]: any}>({})\r\n  const hostRef = useRef<HTMLDivElement | null>(null)\r\n  const startNowRef = useRef<HTMLButtonElement | null>(null)\r\n  const closeRef = useRef<HTMLButtonElement | null>(null)\r\n  const prevActiveElement = useRef<HTMLElement | null>(null)\r\n  // mountedRef ensures keyboard events that fire during render/mount don't prematurely close the overlay\r\n  const mountedRef = useRef(false)\r\n\r\n  \r\n\r\n  useEffect(() => {\r\n    // mark mounted after first paint to ensure early key events don't trigger a close mid-render\r\n    mountedRef.current = true\r\n    return () => { mountedRef.current = false }\r\n  }, [])\r\n\r\n  \r\n\r\n  // If players list widens after mount, ensure new players inherit the skip state\r\n  useEffect(() => {\r\n    if (!showCalibrationDefault) {\r\n      setCalibrationSkipped(prev => {\r\n        const next = { ...prev }\r\n        for (const p of players) if (!next[p.id]) next[p.id] = true\r\n        return next\r\n      })\r\n    }\r\n  }, [players, showCalibrationDefault])\r\n\r\n  const allPlayersSkipped = players.every(p => calibrationSkipped[p.id])\r\n  const canStartMatch = allPlayersSkipped\r\n\r\n  // visibility is controlled by parent via `open` prop\r\n\r\n  useEffect(() => {\r\n    if (!visible) return\r\n  // useEffect(visible) entered\r\n    // Ensure initial focus is on the Start Now button for convenience\r\n    try { setTimeout(() => { try { startNowRef.current?.focus() } catch {} }, 0) } catch {}\r\n    // remember previous active element so we can restore on close\r\n    try { prevActiveElement.current = document.activeElement as HTMLElement } catch {}\r\n    // Hide app content from screen readers while overlay is open\r\n    const appRoot = document.getElementById('root')\r\n    const prevAria: string | null = appRoot ? (appRoot.getAttribute('aria-hidden')) : null\r\n     try { if (appRoot) appRoot.setAttribute('aria-hidden', 'true') } catch {}\r\n  const t = allPlayersSkipped ? setInterval(() => setSeconds(s => s - 1), 1000) : null\r\n  const onKey = (e: KeyboardEvent) => {\r\n      if (!mountedRef.current) return\r\n      if (!disableEscClose && (e.key === 'Escape' || e.key === 'Esc')) {\r\n        e.preventDefault()\r\n        // Ensure parent handlers are invoked asynchronously so we don't unmount during render\r\n    try { setTimeout(() => { try { onRequestClose?.() } catch {} }, 0) } catch {}\r\n        try { prevActiveElement.current?.focus() } catch {}\r\n      }\r\n    }\r\n    document.addEventListener('keydown', onKey)\r\n    // Cleanup and restore aria-hidden\r\n    return () => {\r\n  // useEffect(visible) cleanup\r\n       try { \r\n        if (appRoot) { appRoot.removeAttribute('aria-hidden') }\r\n      } catch {}\r\n      if (t) clearInterval(t)\r\n      document.removeEventListener('keydown', onKey)\r\n    }\r\n  }, [visible, onDone, allPlayersSkipped])\r\n\r\n  useEffect(() => {\r\n    if (!visible) return\r\n    // Show calibration popup immediately when countdown starts\r\n  if (showCalibrationDefault && seconds === (initialSeconds || 15) && !showCalibration) {\r\n      setShowCalibration(true)\r\n      // Fetch calibrations for all players\r\n      const fetchCalibrations = async () => {\r\n        const calibs: {[playerName: string]: any} = {}\r\n        for (const player of players) {\r\n          if (user?.username && player.name === user.username) {\r\n            // Local user: use store\r\n            const { H, imageSize, locked } = useCalibration.getState()\r\n            if (H && locked) calibs[player.name] = { H, imageSize, locked }\r\n          } else {\r\n            // Remote user: fetch from server\r\n            try {\r\n              const res = await fetch(`/api/users/${encodeURIComponent(player.name)}/calibration`)\r\n              if (res.ok) {\r\n                const data = await res.json()\r\n                if (data.calibration) calibs[player.name] = data.calibration\r\n              }\r\n            } catch (err) {\r\n              console.warn('Failed to fetch calibration for', player.name, err)\r\n            }\r\n          }\r\n        }\r\n        setPlayerCalibrations(calibs)\r\n      }\r\n      fetchCalibrations()\r\n    }\r\n    // Only start countdown when all players have skipped calibration\r\n    if (allPlayersSkipped) {\r\n      if (seconds <= 3 && seconds > 0) {\r\n         setScaleState(s => s + 0.4)\r\n      }\r\n      if (seconds <= 0) {\r\n  // countdown reached 0, scheduling close\r\n        // Done; small delay to let the \"Game On\" message show\r\n        setTimeout(() => {\r\n          // Do not set local visible state here when controlled; delegate close to parent via onRequestClose/onDone\r\n          // calling onDone/onRequestClose\r\n          try { onDone?.() } catch {}\r\n          try { setTimeout(() => { try { onRequestClose?.() } catch {} }, 0) } catch {}\r\n          // Return focus to previous element\r\n          try { prevActiveElement.current?.focus() } catch {}\r\n        }, 1000)\r\n      }\r\n    }\r\n  }, [seconds, onDone, visible, showCalibration, allPlayersSkipped, players, user])\r\n\r\n  const stats = useMemo(() => players.map(p => {\r\n    try {\r\n    const avg3 = getAllTimeAvg(p.name)\r\n    const best9 = getAllTimeFirstNineAvg(p.name)\r\n    const bestCheckout = getAllTimeBestCheckout(p.name)\r\n    const bestLeg = getAllTimeBestLeg(p.name)\r\n    const all = getAllTime(p.name)\r\n    const career180s = getAllTime180s(p.name)\r\n    // Count match 180s for the provided player\r\n    let match180s = 0\r\n    try {\r\n      for (const L of (p.legs || [])) {\r\n        for (const v of (L.visits || [])) {\r\n          if (Number(v.score || 0) === 180) match180s += 1\r\n        }\r\n      }\r\n    } catch {}\r\n    const one80s = `${match180s}/${career180s}`\r\n    return { id: p.id, name: p.name, avg3: avg3.toFixed(1), best9: best9.toFixed(1), bestCheckout, bestLeg, one80s }\r\n    } catch (err) {\r\n      // Swallow errors computing stats to avoid breaking render in tests\r\n      return { id: p.id, name: p.name, avg3: 'â€”', best9: 'â€”', bestCheckout: 'â€”', bestLeg: 'â€”', one80s: 'â€”' }\r\n    }\r\n  }), [players])\r\n  // Create and manage a portal container so overlays appended to body are cleaned up and avoid duplicates in tests\r\n  const portalElRef = useRef<HTMLDivElement | null>(typeof document !== 'undefined' ? document.createElement('div') : null)\r\n  useLayoutEffect(() => {\r\n    if (!portalElRef.current) return\r\n    const el = portalElRef.current\r\n    el.className = 'ndn-match-start-portal'\r\n    try {\r\n      const old = Array.from(document.querySelectorAll('.ndn-match-start-portal'))\r\n      old.forEach(o => { try { o.parentNode?.removeChild(o) } catch {} })\r\n    } catch {}\r\n    document.body.appendChild(el)\r\n    return () => { try { if (el && el.parentNode) el.parentNode.removeChild(el) } catch {} }\r\n  }, [])\r\n\r\n  if (!visible) return null\r\n\r\n  // Render the extracted CalibrationPopup component, passing required handlers\r\n\r\n  const getScaleFor = (s: number) => {\r\n    if (s <= 0) return 1.8\r\n    if (s === 1) return 1.6\r\n    if (s === 2) return 1.4\r\n    if (s === 3) return 1.2\r\n    return 1\r\n  }\r\n\r\n  const overlay = (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4\">\r\n      <div role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"match-start-heading\" tabIndex={-1}>\r\n        <FocusLock returnFocus={true}>\r\n          <div ref={hostRef}>\r\n            <div className=\"bg-white/5 border border-white/10 rounded-3xl p-8 md:p-12 max-w-7xl w-full backdrop-blur-sm shadow-2xl\">\r\n            <div className=\"flex items-center justify-between mb-8\">\r\n            <div id=\"match-start-heading\" className=\"text-2xl font-bold opacity-90\">Match Starting Soon</div>\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"text-6xl font-extrabold text-emerald-400\" aria-live=\"polite\">{seconds > 0 ? seconds : 'GO'}</div>\r\n              <div className=\"flex flex-col gap-2\">\r\n                <button ref={startNowRef} className=\"btn btn-lg\" onClick={() => { try { onDone?.() } catch {}; try { try { document.getElementById('root')?.removeAttribute('aria-hidden') } catch {}; setTimeout(() => { try { onRequestClose?.() } catch {} }, 0) } catch {} }} aria-label=\"Start match now\">Start Now</button>\r\n                <button ref={closeRef} className=\"btn btn-ghost btn-sm\" onClick={() => { try { onDone?.() } catch {}; try { document.getElementById('root')?.removeAttribute('aria-hidden') } catch {}; try { setTimeout(() => { try { onRequestClose?.() } catch {} }, 0) } catch {} }} aria-label=\"Close match start showcase\">Close</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\r\n          {stats.map(st => (\r\n            <div key={st.id} className=\"p-6 rounded-2xl bg-white/8 border border-white/12 flex flex-col items-center shadow-xl\">\r\n              <div className=\"w-20 h-20 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-2xl font-bold text-white mb-4 shadow-lg\">\r\n                {st.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)}\r\n              </div>\r\n              <div className=\"text-xl font-semibold mb-4 text-center\">{st.name}</div>\r\n              <div className=\"grid grid-cols-2 gap-4 w-full\">\r\n                <StatBlock label=\"3-Dart Avg\" value={st.avg3} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"First-9 Avg\" value={st.best9} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"Best Checkout\" value={st.bestCheckout || 'â€”'} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"Best Leg\" value={st.bestLeg || 'â€”'} scale={getScaleFor(seconds)} />\r\n              </div>\r\n              <div className=\"mt-4 opacity-70 text-sm\">180s (match / career): {st.one80s}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n  <div className=\"text-center\">\r\n          {seconds <= 1 ? (\r\n            <div className=\"text-3xl font-bold text-emerald-400\">Good luck â€” Game on! ðŸŽ¯</div>\r\n          ) : (\r\n            <div className=\"text-lg opacity-70\">{players.map(p=>p.name).join(' vs ')}</div>\r\n          )}\r\n        </div>\r\n            </div>\r\n          </div>\r\n        </FocusLock>\r\n      </div>\r\n    </div>\r\n  )\r\n  return createPortal(\r\n    <>\r\n      {showCalibration && (\r\n        <CalibrationPopup\r\n          players={players}\r\n          playerCalibrations={playerCalibrations}\r\n          calibrationSkipped={calibrationSkipped}\r\n          onSkip={(id: string) => setCalibrationSkipped(prev => ({ ...prev, [id]: true }))}\r\n          onOpenCalibrator={(id: string) => { try { window.dispatchEvent(new CustomEvent('ndn:change-tab', { detail: { tab: 'calibrate' } })) } catch {};\r\n            // Tell parent to close the overlay so the user can calibrate\r\n            try { setTimeout(() => { try { onRequestClose?.() } catch {} }, 0) } catch {}\r\n          }}\r\n          onClose={() => { setShowCalibration(false) }}\r\n        />\r\n      )}\r\n      {overlay}\r\n    </>,\r\n    portalElRef.current as HTMLDivElement\r\n  )\r\n}\r\n"],"names":["CalibrationPopup","players","playerCalibrations","calibrationSkipped","onSkip","onOpenCalibrator","onClose","skippedPlayers","p","remainingPlayers","canStartMatch","jsxs","jsx","player","n","StatBlock","label","value","className","scale","MatchStartShowcase","open","user","onDone","onRequestClose","initialSeconds","roomId","onChoice","choices","bullActive","onBullThrow","showCalibrationDefault","disableEscClose","seconds","setSeconds","useState","scaleState","setScaleState","visible","showCalibration","setShowCalibration","setCalibrationSkipped","map","setPlayerCalibrations","hostRef","useRef","startNowRef","closeRef","prevActiveElement","mountedRef","useEffect","prev","next","allPlayersSkipped","appRoot","t","s","onKey","e","calibs","H","imageSize","locked","useCalibration","res","data","err","stats","useMemo","avg3","getAllTimeAvg","best9","getAllTimeFirstNineAvg","bestCheckout","getAllTimeBestCheckout","bestLeg","getAllTimeBestLeg","all","getAllTime","career180s","getAllTime180s","match180s","L","v","one80s","portalElRef","useLayoutEffect","el","o","getScaleFor","overlay","FocusLock","st","createPortal","Fragment","id"],"mappings":"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"}
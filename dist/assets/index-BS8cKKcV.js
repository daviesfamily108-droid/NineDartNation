import{r as qi,a as Ml,g as zi}from"./vendor-D3F3s8fL.js";import{r as u,S as Vi,L as ed,M as on,a as td,U as Ni,T as sr,C as wi,P as sd,R as Si,b as Xa,c as nd,d as ad,Z as ki,X as Al,e as nr,f as Gi,g as La,E as Ci,V as rd,h as id,i as od,G as ld,j as Ti,k as cd,l as dd,m as ud,n as md}from"./ui-6zOrijiD.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var Rr={exports:{}},Oa={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var So;function hd(){if(So)return Oa;So=1;var t=qi(),a=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(o,d,c){var h,m={},x=null,b=null;c!==void 0&&(x=""+c),d.key!==void 0&&(x=""+d.key),d.ref!==void 0&&(b=d.ref);for(h in d)r.call(d,h)&&!i.hasOwnProperty(h)&&(m[h]=d[h]);if(o&&o.defaultProps)for(h in d=o.defaultProps,d)m[h]===void 0&&(m[h]=d[h]);return{$$typeof:a,type:o,key:x,ref:b,props:m,_owner:n.current}}return Oa.Fragment=s,Oa.jsx=l,Oa.jsxs=l,Oa}var ko;function fd(){return ko||(ko=1,Rr.exports=hd()),Rr.exports}var e=fd(),Qa={},Co;function xd(){if(Co)return Qa;Co=1;var t=Ml();return Qa.createRoot=t.createRoot,Qa.hydrateRoot=t.hydrateRoot,Qa}var pd=xd();const bd=zi(pd);var To=Ml();const Rl=t=>`ndn_online_quota_${t}`;function ar(t=new Date){const a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),s=a.getUTCDay()||7;a.setUTCDate(a.getUTCDate()+4-s);const r=new Date(Date.UTC(a.getUTCFullYear(),0,1)),n=Math.ceil(((a.getTime()-r.getTime())/864e5+1)/7),i=String(n).padStart(2,"0");return`${a.getUTCFullYear()}-${i}`}function Pl(t){try{const a=localStorage.getItem(Rl(t));if(!a)return{week:ar(),used:0};const s=JSON.parse(a),r=ar();return!s.week||s.week!==r?{week:r,used:0}:{week:String(s.week),used:Number(s.used)||0}}catch{return{week:ar(),used:0}}}function gd(t,a){try{localStorage.setItem(Rl(t),JSON.stringify(a))}catch{}}function Eo(t,a=3){const s=ar(),r=Pl(t),n={week:s,used:(r.week===s?r.used:0)+1};return gd(t,n),n}function Ll(t,a=3){const s=Pl(t);return Math.max(0,a-(s.used||0))}const Ol={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8787",VITE_WS_URL:"ws://localhost:8787"},Bl="ndn:isAdmin:v1";function Ul(){try{const t=localStorage.getItem(Bl);return t?JSON.parse(t):{}}catch{return{}}}function yd(t,a){try{const s=Ul();s[(t||"").toLowerCase()]={v:a,ts:Date.now()},localStorage.setItem(Bl,JSON.stringify(s))}catch{}}async function vd(t){const a=String(t||"").toLowerCase();if(!a)return!1;try{const n=String(Ol?.VITE_OWNER_EMAIL||"").toLowerCase();if(n&&a===n)return!0}catch{}if(a==="daviesfamily108@gmail.com")return!0;try{const n=localStorage.getItem("ndn:forceAdmin");if(n==="1"||n==="true")return!0}catch{}const r=Ul()[a];if(r&&Date.now()-r.ts<300*1e3)return!!r.v;try{const l=!!(await(await fetch(`/api/admins/check?email=${encodeURIComponent(a)}`)).json().catch(()=>({})))?.isAdmin;return yd(a,l),l}catch{return!!r?.v}}function $l(t){const a=String(t||"").toLowerCase(),[s,r]=u.useState(!1);return u.useEffect(()=>{let n=!0;if(!a){r(!1);return}try{const i=String(Ol?.VITE_OWNER_EMAIL||"").toLowerCase(),l=(()=>{try{const o=localStorage.getItem("ndn:forceAdmin");return o==="1"||o==="true"}catch{return!1}})();if(i&&a===i){r(!0);return}if(l){r(!0);return}}catch{}if(a==="daviesfamily108@gmail.com"){r(!0);return}return vd(a).then(i=>{n&&r(!!i)}),()=>{n=!1}},[a]),s}const jd={},Nd=5,wd={GBP:1,EUR:1.16,USD:1.26,AUD:1.92,NZD:2.08,CAD:1.73};function Fl(t,a=Nd){const s=(t||"GBP").toUpperCase(),r=wd[s]??1,n=a*r;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s}).format(n)}catch{return`${s} ${n.toFixed(2)}`}}function _l(){try{const t=new Intl.NumberFormat().resolvedOptions(),a=String(t.locale).toLowerCase();return a.includes("-gb")?"GBP":a.includes("-ie")||a.includes("-de")||a.includes("-fr")||a.includes("-es")||a.includes("-it")||a.includes("-nl")?"EUR":a.includes("-us")?"USD":a.includes("-au")?"AUD":a.includes("-nz")?"NZD":a.includes("-ca")?"CAD":"GBP"}catch{return"GBP"}}const Sd=jd?.VITE_DISCORD_INVITE_URL||"https://discord.gg/nCfT4hJz";let pn=null;function kd(){if(pn)return pn;const t="http://localhost:8787".trim();if(t)return pn=t.replace(/\/$/,""),pn;if(typeof window<"u"){const{protocol:a,host:s,hostname:r}=window.location,n=`${a}//${s}`;return r.endsWith("onrender.com")||r==="localhost"||r==="127.0.0.1"?pn=n.replace(/\/$/,""):pn="https://ninedartnation.onrender.com",pn}return pn="https://ninedartnation.onrender.com",pn}function Cd(t){if(/^https?:\/\//i.test(t))return t;const a=kd(),s=t.startsWith("/")?t:`/${t}`;return`${a}${s}`}function rr(t){return Cd(t)}function Kt(t,a){const s=rr(t);return fetch(s,a)}function Td(){if(typeof window>"u"||typeof window.fetch!="function")return;const t=window;if(t.__ndnApiPatched)return;const a=window.fetch.bind(window);window.fetch=(s,r)=>{try{if(typeof s=="string")return s.startsWith("/")?a(rr(s),r):a(s,r);if(s instanceof Request){const n=s.url.startsWith("/")?rr(s.url):s.url;if(n===s.url)return a(s,r);const i=new Request(n,s);return a(i,r)}if(s instanceof URL){const n=s.href.startsWith("/")?rr(s.href):s.href;return a(n,r)}}catch(n){console.warn("[API] Interceptor failed, falling back to original fetch",n)}return a(s,r)},t.__ndnApiPatched=!0}function Ed(t){const a=[{key:"score",label:"Home",icon:td},{key:"online",label:"Online",icon:Ni},{key:"offline",label:"Offline",icon:sr},{key:"tournaments",label:"Tournaments",icon:sr},{key:"friends",label:"Friends",icon:Ni},{key:"stats",label:"Stats",icon:sr},{key:"calibrate",label:"Calibrate",icon:wi},{key:"settings",label:"Settings",icon:Vi}];return t?.fullAccess||a.push({key:"fullaccess",label:"PREMIUM Â£â‚¬$",icon:sd}),a}function Hl({active:t,onChange:a,user:s,className:r}){const n=Ed(s),i=$l(s?.email);if(i&&!n.some(b=>b.key==="admin")){const b=n.findIndex(N=>N.key==="settings"),y={key:"admin",label:"Admin",icon:Vi};b>=0?n.splice(b,0,y):n.push(y)}const[l,o]=u.useState(!1),[d,c]=u.useState(!1),h=s?.username&&!s?.fullAccess?Ll(s.username):1/0,[m,x]=u.useState({friendRequests:0,messages:0,tournaments:0});return u.useEffect(()=>{if(!s?.email)return;const b=async()=>{try{const[N,C]=await Promise.all([Kt(`/api/friends/requests?email=${encodeURIComponent(s.email)}`),Kt(`/api/friends/messages?email=${encodeURIComponent(s.email)}`)]),w=N.ok?await N.json():{requests:[]},I=(C.ok?await C.json():{messages:[]}).messages?.filter(M=>!M.read).length||0;x({friendRequests:w.requests?.length||0,messages:I,tournaments:0})}catch(N){console.error("Failed to fetch notifications:",N)}};b();const y=setInterval(b,3e4);return()=>clearInterval(y)},[s?.email]),u.useEffect(()=>{if(!l)return;const b=y=>{(y.key==="Escape"||y.key==="Enter")&&o(!1)};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[l]),e.jsxs("aside",{className:`${s?.fullAccess?"premium-sidebar":""} sidebar glass ${r?"":"w-60"} p-2 sm:p-4 rounded-2xl ${r??"hidden sm:flex"} flex-col gap-2 overflow-y-auto overflow-x-hidden ${r?"":"fixed top-2 bottom-2 sm:top-4 sm:bottom-4"}`,children:[n.map(({key:b,label:y,icon:N})=>b==="admin"&&!i?null:e.jsxs("button",{className:`tab whitespace-nowrap flex items-center justify-start gap-3 ${t===b?"tab--active":"tab--inactive"} `,onClick:()=>a(b),title:y,style:{fontWeight:700,fontSize:"1.1rem",color:t===b?"#fff":"#E5E7EB",letterSpacing:"0.02em"},children:[e.jsx(N,{className:"w-6 h-6"}),e.jsxs("span",{className:"flex items-center gap-2",children:[y,b==="online"&&!s?.fullAccess&&h<=0&&e.jsxs("span",{title:"Weekly free games used",className:"inline-flex items-center gap-1 text-[0.65rem] px-2 py-0.5 rounded-full bg-rose-600 text-white",children:[e.jsx(ed,{className:"w-3 h-3"}),"Locked"]}),b==="friends"&&m.friendRequests>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:m.friendRequests>9?"9+":m.friendRequests}),b==="score"&&(m.messages>0||m.tournaments>0)&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:m.messages+m.tournaments>9?"9+":m.messages+m.tournaments})]})]},b)),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-2",onClick:()=>o(!0),title:"BullseyeDartsLeague",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(on,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"BullseyeDartsLeague"})]}),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-1",onClick:()=>c(!0),title:"NineDartNation",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(on,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"NineDartNation"})]}),l&&To.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>o(!1),onTouchStart:()=>o(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>o(!1),children:"âœ•"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(on,{className:"w-6 h-6"})," BullseyeDartsLeague"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join this fantastic Online Darts League with divisions and other cool stuff included"}),e.jsx("a",{href:Sd,target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body),d&&To.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>c(!1),onTouchStart:()=>c(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>c(!1),children:"âœ•"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(on,{className:"w-6 h-6"})," NineDartNation"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join the NineDartNation Discord community"}),e.jsx("a",{href:"https://discord.gg/Q33J5FTVve",target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body)]})}const Dd={},Do=t=>{let a;const s=new Set,r=(h,m)=>{const x=typeof h=="function"?h(a):h;if(!Object.is(x,a)){const b=a;a=m??(typeof x!="object"||x===null)?x:Object.assign({},a,x),s.forEach(y=>y(a,b))}},n=()=>a,d={setState:r,getState:n,getInitialState:()=>c,subscribe:h=>(s.add(h),()=>s.delete(h)),destroy:()=>{(Dd?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},c=a=t(r,n,d);return d},Id=t=>t?Do(t):Do;var Pr={exports:{}},Lr={},Or={exports:{}},Br={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Io;function Md(){if(Io)return Br;Io=1;var t=qi();function a(m,x){return m===x&&(m!==0||1/m===1/x)||m!==m&&x!==x}var s=typeof Object.is=="function"?Object.is:a,r=t.useState,n=t.useEffect,i=t.useLayoutEffect,l=t.useDebugValue;function o(m,x){var b=x(),y=r({inst:{value:b,getSnapshot:x}}),N=y[0].inst,C=y[1];return i(function(){N.value=b,N.getSnapshot=x,d(N)&&C({inst:N})},[m,b,x]),n(function(){return d(N)&&C({inst:N}),m(function(){d(N)&&C({inst:N})})},[m]),l(b),b}function d(m){var x=m.getSnapshot;m=m.value;try{var b=x();return!s(m,b)}catch{return!0}}function c(m,x){return x()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return Br.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:h,Br}var Mo;function Ad(){return Mo||(Mo=1,Or.exports=Md()),Or.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ao;function Rd(){if(Ao)return Lr;Ao=1;var t=qi(),a=Ad();function s(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var r=typeof Object.is=="function"?Object.is:s,n=a.useSyncExternalStore,i=t.useRef,l=t.useEffect,o=t.useMemo,d=t.useDebugValue;return Lr.useSyncExternalStoreWithSelector=function(c,h,m,x,b){var y=i(null);if(y.current===null){var N={hasValue:!1,value:null};y.current=N}else N=y.current;y=o(function(){function w(A){if(!D){if(D=!0,I=A,A=x(A),b!==void 0&&N.hasValue){var v=N.value;if(b(v,A))return M=v}return M=A}if(v=M,r(I,A))return v;var p=x(A);return b!==void 0&&b(v,p)?(I=A,v):(I=A,M=p)}var D=!1,I,M,R=m===void 0?null:m;return[function(){return w(h())},R===null?void 0:function(){return w(R())}]},[h,m,x,b]);var C=n(c,y[0],y[1]);return l(function(){N.hasValue=!0,N.value=C},[C]),d(C),C},Lr}var Ro;function Pd(){return Ro||(Ro=1,Pr.exports=Rd()),Pr.exports}var Ld=Pd();const Od=zi(Ld),Wl={},{useDebugValue:Bd}=Si,{useSyncExternalStoreWithSelector:Ud}=Od;let Po=!1;const $d=t=>t;function Fd(t,a=$d,s){(Wl?"production":void 0)!=="production"&&s&&!Po&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Po=!0);const r=Ud(t.subscribe,t.getState,t.getServerState||t.getInitialState,a,s);return Bd(r),r}const Lo=t=>{(Wl?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof t=="function"?Id(t):t,s=(r,n)=>Fd(a,r,n);return Object.assign(s,a),s},Qs=t=>t?Lo(t):Lo;let _d=1;const Ei=Qs(t=>({toasts:[],push:(a,s)=>t(r=>{const n=_d++,i={id:n,message:a,type:s?.type||"info",timeout:s?.timeout??3e3};return i.timeout&&i.timeout>0&&setTimeout(()=>{t(l=>({toasts:l.toasts.filter(o=>o.id!==n)}))},i.timeout),{toasts:[...r.toasts,i]}}),remove:a=>t(s=>({toasts:s.toasts.filter(r=>r.id!==a)})),clear:()=>t({toasts:[]})}));function Na(){return Ei(a=>a.push)}function Dt(t){return(t??0).toFixed(2)}const Hd=t=>`ndn_stats_${t}`,ql=t=>`ndn_stats_ts_${t}`;function Ws(t){try{const a=localStorage.getItem(Hd(t));if(!a)return{darts:0,scored:0};const s=JSON.parse(a);return{darts:Number(s.darts)||0,scored:Number(s.scored)||0,fnDarts:Number(s.fnDarts)||0,fnScored:Number(s.fnScored)||0,best3:typeof s.best3=="number"?s.best3:0,worst3:typeof s.worst3=="number"?s.worst3:0,bestLegDarts:typeof s.bestLegDarts=="number"?s.bestLegDarts:0,bestCheckout:typeof s.bestCheckout=="number"?s.bestCheckout:0,worstLegDarts:typeof s.worstLegDarts=="number"?s.worstLegDarts:0,bestFNAvg:typeof s.bestFNAvg=="number"?s.bestFNAvg:0,worstFNAvg:typeof s.worstFNAvg=="number"?s.worstFNAvg:0}}catch{return{darts:0,scored:0}}}function ln(t){const{darts:a,scored:s}=Ws(t);return a?s/a*3:0}function Ur(t){const{fnDarts:a=0,fnScored:s=0}=Ws(t);return a?s/a*3:0}const zl="ndn_game_mode_stats";function Ji(t){let a={};try{const s=localStorage.getItem(zl);s&&(a=JSON.parse(s))}catch{}if(Array.isArray(t))for(const s of t)a[s]||(a[s]={played:0,won:0});return a}function Wd(t){try{localStorage.setItem(zl,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{gameModes:!0}}))}catch{}}function qd(t,a){const s=Ji(),r=s[t]||{played:0,won:0};r.played+=1,a&&(r.won+=1),s[t]=r,Wd(s)}function ur(t){try{const a=localStorage.getItem(ql(t));if(!a)return[];const s=JSON.parse(a);return Array.isArray(s)?s.map(r=>({t:Number(r.t)||0,darts:Number(r.darts)||0,scored:Number(r.scored)||0,fnDarts:Number(r.fnDarts)||0,fnScored:Number(r.fnScored)||0})).filter(r=>r.t>0):[]}catch{return[]}}function zd(t,a){try{localStorage.setItem(ql(t),JSON.stringify(a)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t}}))}catch{}}function Vd(t,a){const s=Date.now();return t.filter(r=>s-r.t<=a)}function In(t,a,s,r=Date.now(),n,i){if(a<=0)return;const l=ur(t),o=Vd([...l,{t:r,darts:a,scored:s,fnDarts:n,fnScored:i}],1e3*60*60*24*30);zd(t,o)}function Gd(t,a=1e3*60*60*24){const s=ur(t);if(!s.length)return 0;const r=Date.now();let n=0,i=0;for(const l of s)r-l.t<=a&&(n+=l.darts,i+=l.scored);return n<=0?0:i/n*3}function Jd(t,a=1e3*60*60*24*30){const s=ur(t);if(!s.length)return 0;const r=Date.now();let n=0,i=0;for(const l of s)r-l.t<=a&&(n+=l.fnDarts||0,i+=l.fnScored||0);return n<=0?0:i/n*3}function $r(t){const s=ur(t);if(!s.length)return 0;const r=Date.now(),n=s.filter(c=>r-c.t<=2592e6),i=n.filter(c=>typeof c.fnDarts=="number"),l=i.length?i:n;let o=0,d=0;for(const c of l)o+=c.darts,d+=c.scored;return o<=0?0:d/o*3}function Fr(t){return Jd(t,2592e6)}const Vl="ndn_user_settings";function Di(){try{const t=localStorage.getItem(Vl);if(!t)return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,cameraEnabled:!0,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",textSize:"medium",boxSize:"medium",matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1};const a=JSON.parse(t);return{favoriteDouble:a.favoriteDouble||"D16",callerEnabled:typeof a.callerEnabled=="boolean"?a.callerEnabled:!0,callerVoice:a.callerVoice||"",callerVolume:typeof a.callerVolume=="number"?Math.max(0,Math.min(1,a.callerVolume)):1,speakCheckoutOnly:!!a.speakCheckoutOnly,avgMode:a.avgMode==="24h"?"24h":"all-time",autoStartOffline:!!a.autoStartOffline,rememberLastOffline:typeof a.rememberLastOffline=="boolean"?a.rememberLastOffline:!0,lastOffline:a.lastOffline&&typeof a.lastOffline=="object"?{mode:a.lastOffline.mode||"X01",x01Start:Number(a.lastOffline.x01Start)||501,firstTo:Number(a.lastOffline.firstTo)||1,aiLevel:a.lastOffline.aiLevel||"None"}:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!!a.reducedMotion,compactHeader:!!a.compactHeader,allowSpectate:typeof a.allowSpectate=="boolean"?a.allowSpectate:!0,cameraScale:typeof a.cameraScale=="number"&&isFinite(a.cameraScale)?Math.max(.5,Math.min(1.25,a.cameraScale)):1,cameraAspect:a.cameraAspect==="square"?"square":"wide",cameraFitMode:a.cameraFitMode==="fit"||a.cameraFitMode==="fill"?a.cameraFitMode:"fit",autoscoreProvider:a.autoscoreProvider==="external-ws"?"external-ws":a.autoscoreProvider==="manual"?"manual":"built-in",autoscoreWsUrl:typeof a.autoscoreWsUrl=="string"?a.autoscoreWsUrl:"",calibrationGuide:typeof a.calibrationGuide=="boolean"?a.calibrationGuide:!0,preferredCameraId:typeof a.preferredCameraId=="string"?a.preferredCameraId:void 0,preferredCameraLabel:typeof a.preferredCameraLabel=="string"?a.preferredCameraLabel:void 0,preferredCameraLocked:typeof a.preferredCameraLocked=="boolean"?a.preferredCameraLocked:!1,cameraEnabled:typeof a.cameraEnabled=="boolean"?a.cameraEnabled:!0,offlineLayout:a.offlineLayout==="classic"?"classic":"modern",textSize:a.textSize==="small"||a.textSize==="large"?a.textSize:"medium",boxSize:a.boxSize==="small"||a.boxSize==="large"?a.boxSize:"medium",matchType:a.matchType==="doubles"?"doubles":"singles",teamAName:typeof a.teamAName=="string"?a.teamAName:"Team A",teamBName:typeof a.teamBName=="string"?a.teamBName:"Team B",dartTimerEnabled:typeof a.dartTimerEnabled=="boolean"?a.dartTimerEnabled:!1,dartTimerSeconds:typeof a.dartTimerSeconds=="number"&&isFinite(a.dartTimerSeconds)?Math.max(3,Math.min(60,a.dartTimerSeconds)):10,x01DoubleIn:typeof a.x01DoubleIn=="boolean"?a.x01DoubleIn:!1}}catch{return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preferredCameraLocked:!1,cameraEnabled:!0,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",textSize:"medium",boxSize:"medium",matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1}}}function St(t){try{const a=Di();localStorage.setItem(Vl,JSON.stringify({...a,...t}))}catch{}}const qt=Qs((t,a)=>({...Di(),setFavoriteDouble:s=>{St({favoriteDouble:s}),t({favoriteDouble:s})},setCallerEnabled:s=>{St({callerEnabled:s}),t({callerEnabled:s})},setCallerVoice:s=>{St({callerVoice:s}),t({callerVoice:s})},setAvgMode:s=>{St({avgMode:s}),t({avgMode:s})},setCallerVolume:s=>{const r=Math.max(0,Math.min(1,s));St({callerVolume:r}),t({callerVolume:r})},setSpeakCheckoutOnly:s=>{St({speakCheckoutOnly:s}),t({speakCheckoutOnly:s})},setAutoStartOffline:s=>{St({autoStartOffline:s}),t({autoStartOffline:s})},setRememberLastOffline:s=>{St({rememberLastOffline:s}),t({rememberLastOffline:s})},setLastOffline:s=>{const n={...Di().lastOffline,...s};St({lastOffline:n}),t({lastOffline:n})},setReducedMotion:s=>{St({reducedMotion:s}),t({reducedMotion:s})},setCompactHeader:s=>{St({compactHeader:s}),t({compactHeader:s})},setAllowSpectate:s=>{St({allowSpectate:s}),t({allowSpectate:s})},ignorePreferredCameraSync:!1,setIgnorePreferredCameraSync:s=>{St({}),t({ignorePreferredCameraSync:s})},setCameraScale:s=>{const r=Math.max(.5,Math.min(1.25,s));St({cameraScale:r}),t({cameraScale:r})},setCameraAspect:s=>{const r=s==="square"?"square":"wide";St({cameraAspect:r}),t({cameraAspect:r})},setCameraFitMode:s=>{const r=s==="fit"?"fit":"fill";St({cameraFitMode:r}),t({cameraFitMode:r})},setAutoscoreProvider:s=>{St({autoscoreProvider:s}),t({autoscoreProvider:s})},setAutoscoreWsUrl:s=>{St({autoscoreWsUrl:s}),t({autoscoreWsUrl:s})},setCalibrationGuide:s=>{St({calibrationGuide:s}),t({calibrationGuide:s})},setPreferredCamera:(s,r,n=!1)=>{try{const i=a();if(console.log("[USERSETTINGS] setPreferredCamera called:",{id:s,label:r,force:n,locked:i.preferredCameraLocked}),i.preferredCameraLocked&&!n){console.log("[USERSETTINGS] Camera selection locked and force=false, ignoring update");return}}catch{}console.log("[USERSETTINGS] Saving preferred camera:",{id:s,label:r}),St({preferredCameraId:s,preferredCameraLabel:r}),t({preferredCameraId:s,preferredCameraLabel:r})},setPreferredCameraLocked:s=>{St({preferredCameraLocked:s}),t({preferredCameraLocked:s})},setCameraEnabled:s=>{St({cameraEnabled:s}),t({cameraEnabled:s})},setOfflineLayout:s=>{St({offlineLayout:s}),t({offlineLayout:s})},setTextSize:s=>{St({textSize:s}),t({textSize:s})},setBoxSize:s=>{St({boxSize:s}),t({boxSize:s})},setMatchType:s=>{const r=s==="doubles"?"doubles":"singles";St({matchType:r}),t({matchType:r})},setTeamAName:s=>{const r=s?.trim()||"Team A";St({teamAName:r}),t({teamAName:r})},setTeamBName:s=>{const r=s?.trim()||"Team B";St({teamBName:r}),t({teamBName:r})},setDartTimerEnabled:s=>{St({dartTimerEnabled:s}),t({dartTimerEnabled:s})},setDartTimerSeconds:s=>{const r=Math.max(3,Math.min(60,Math.round(s)));St({dartTimerSeconds:r}),t({dartTimerSeconds:r})},setX01DoubleIn:s=>{St({x01DoubleIn:s}),t({x01DoubleIn:s})}}));function Za(t){try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:t}}))}catch{}}const Kd="http://localhost:8787";function Yd({user:t}){const[a,s]=u.useState(!1),[r,n]=u.useState(!1),[i,l]=u.useState(""),{lastOffline:o}=qt(),d=Na();return u.useEffect(()=>{const c=["The fastest televised 9-darter took roughly 25 seconds!","A perfect leg (501) can be finished in nine darts.","The inner bull is worth 50; the outer bull is 25.","Standard dartboards are made from compressed sisal fibers.","Doubles and trebles are the thin outer and middle rings.","Professional oche (throw line) distance is 7 ft 9Â¼ in (2.37 m).","â€œDartitisâ€ is a real condition affecting a playerâ€™s throwing motion.","Phil Taylor holds a record number of World Championship titles.","Checkout routes often end on a doubleâ€”classic â€œdouble-outâ€.","The highest 3-dart score is 180 (triple 20, triple 20, triple 20)."],h=Math.floor(Math.random()*c.length);l(c[h])},[]),e.jsxs("div",{className:`${t?.fullAccess?"premium-main":""} relative min-h-[600px] flex flex-col items-center justify-center overflow-hidden`,children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-700 via-indigo-500 to-blue-600 opacity-60 blur-2xl"}),e.jsx("div",{className:"absolute top-20 left-1/4 w-40 h-40 bg-pink-400 rounded-full opacity-30 blur-2xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-10 right-1/4 w-32 h-32 bg-blue-400 rounded-full opacity-30 blur-2xl animate-pulse"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-6xl mx-auto bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 lg:p-10 flex flex-col items-center",children:[e.jsx("h2",{className:"text-2xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-400 to-blue-400 mb-2 sm:mb-3 md:mb-4 drop-shadow-xl text-center leading-tight",children:"Welcome to Nine Dart Nation"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl lg:text-2xl text-white/80 mb-2 font-semibold text-center px-2",children:"Your home for competitive darts, stats, and online play."}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg text-white/60 mb-3 sm:mb-4 italic text-center px-2",children:'"Where every dart counts and every player matters."'}),i&&e.jsx("div",{className:"w-full mb-4 sm:mb-6 px-2 sm:px-0",children:e.jsxs("div",{className:"mx-auto max-w-xs sm:max-w-xl rounded-full px-3 sm:px-5 py-2 text-center text-indigo-100 bg-gradient-to-r from-indigo-600/80 to-fuchsia-600/80 shadow-md",children:[e.jsx("span",{className:"font-semibold text-sm sm:text-base",children:"Did you know?"})," ",e.jsx("span",{className:"opacity-90 text-sm sm:text-base",children:i})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4 md:gap-6 justify-center mb-6 md:mb-8 w-full max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>{Za("offline");try{window.dispatchEvent(new CustomEvent("ndn:offline-format",{detail:{formatType:"first",formatCount:Number(o?.firstTo)||1,startScore:Number(o?.x01Start)||501}}))}catch{}try{setTimeout(()=>{window.dispatchEvent(new CustomEvent("ndn:auto-start",{detail:{mode:o?.mode||"X01"}}))},50)}catch{}},className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸŽ¯"})," Start New Match"]}),e.jsxs("button",{onClick:()=>Za("stats"),className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ“Š"})," View Stats"]}),e.jsxs("button",{onClick:()=>Za("online"),className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-green-500 to-blue-400 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ†"})," Join Online Match"]}),e.jsxs("button",{onClick:()=>{Za("offline");try{window.dispatchEvent(new CustomEvent("ndn:auto-start",{detail:{mode:"Double Practice"}}))}catch{}},className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-pink-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ’¡"})," Practice Doubles"]})]}),(()=>{const c=t?.username||"Player 1",h=Ws(c),m=!!t?.fullAccess,x="grid grid-cols-[120px,1fr,1fr] sm:grid-cols-[160px,1fr,1fr]",b=({label:y,left:N,right:C,lock:w})=>e.jsxs("div",{className:`relative ${x} gap-2 items-center p-2 rounded-lg ${w?"bg-white/5 border border-white/10 overflow-hidden":"bg-indigo-500/10 border border-indigo-500/40"} mb-2`,children:[e.jsx("div",{className:"text-[12px] opacity-80 pl-2 text-left",children:y}),e.jsx("div",{className:`text-sm font-semibold text-center ${w?"opacity-50 blur-[0.5px]":""}`,children:N}),e.jsx("div",{className:`text-sm font-semibold text-center ${w?"opacity-50 blur-[0.5px]":""}`,children:C}),w&&e.jsx("button",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-slate-900/35 hover:bg-slate-900/45 transition",onClick:async()=>{try{const I=await(await fetch(`${Kd}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})})).json();I.ok&&I.url?window.location.href=I.url:I.error==="STRIPE_NOT_CONFIGURED"?d("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):d("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{d("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},title:"Unlock with PREMIUM",children:e.jsx("span",{className:"text-[12px] font-semibold",children:"Unlock PREMIUM"})})]});return e.jsxs("div",{className:"w-full mt-2 rounded-2xl p-2 sm:p-3 bg-white/5 border border-white/10 overflow-x-auto",children:[e.jsxs("div",{className:`${x} gap-2 mb-2 px-1 items-center min-w-[280px] sm:min-w-0`,children:[e.jsx("div",{className:"text-[12px] opacity-0 select-none",children:"label"}),e.jsx("div",{className:"text-[12px] font-semibold text-center",children:"BEST"}),e.jsx("div",{className:"text-[12px] font-semibold text-center",children:"WORST"})]}),e.jsx(b,{label:"3-dart avg",left:Dt(h.best3||0),right:Dt(h.worst3||0)}),e.jsx(b,{label:"9-dart avg",left:Dt(h.bestFNAvg||0),right:Dt(h.worstFNAvg||0),lock:!m}),e.jsx(b,{label:"Leg (darts)",left:String(h.bestLegDarts||0),right:String(h.worstLegDarts||0),lock:!m}),e.jsx(b,{label:"Checkout",left:String(h.bestCheckout||0),right:"â€”",lock:!m})]})})(),e.jsx("button",{className:"mt-6 sm:mt-8 md:mt-10 px-6 sm:px-8 md:px-10 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 text-base sm:text-lg md:text-xl touch-manipulation",onClick:()=>n(!0),children:"How to Play / Getting Started"})]}),e.jsx("footer",{className:"w-full py-2 md:py-2 text-center text-white/80 text-xs md:text-sm font-medium absolute bottom-0 left-0 z-20 flex items-center justify-center gap-1 md:gap-2",children:e.jsxs("button",{className:"flex items-center gap-1 md:gap-2 hover:text-white transition",onClick:()=>s(!0),children:[e.jsx("span",{children:"Â©"}),e.jsx("span",{style:{letterSpacing:"0.05em"},children:"NINEDARTNATION"})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>s(!1),children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Legal Information"}),e.jsxs("ul",{className:"list-disc pl-5 mb-2",children:[e.jsx("li",{children:"Terms & Conditions: All users must follow fair play and site rules."}),e.jsx("li",{children:"Privacy Policy: Your data is protected and never shared without consent."}),e.jsxs("li",{children:["Copyright Â© ",new Date().getFullYear()," NINEDARTNATION. All rights reserved."]}),e.jsx("li",{children:"Contact: support@ninedartnation.com"})]}),e.jsx("p",{className:"text-sm text-purple-200",children:"For full legal details, please contact us or visit our legal page."})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>n(!1),children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Getting Started"}),e.jsxs("ul",{className:"list-disc pl-5 mb-2",children:[e.jsx("li",{children:"Choose a game mode and invite friends or play solo."}),e.jsx("li",{children:"Track your stats and progress in the Stats tab."}),e.jsx("li",{children:"Join the BullseyeDartsLeague for online competition."}),e.jsx("li",{children:"Upgrade to PREMIUM for advanced features and modes."}),e.jsx("li",{children:"Need help? Visit the Settings tab for support and tips."})]}),e.jsx("p",{className:"text-sm text-purple-200",children:'Ready to play? Hit "Start New Match" and let the darts fly!'})]})})]})}function an({children:t,className:a,style:s}){const r=u.useRef(null);return u.useEffect(()=>{let n=0;const i=()=>{const d=r.current;if(!d)return;const c=document.getElementById("ndn-header");if(!c){d.style.clipPath="";return}const h=document.getElementById("ndn-main-scroll"),m=h?h.scrollTop:window.scrollY||0,x=c.getBoundingClientRect().height,b=m>0?x:0;try{let y=d.querySelector("[data-ndn-top-mask]");y||(y=document.createElement("div"),y.setAttribute("data-ndn-top-mask","1"),Object.assign(y.style,{position:"absolute",left:"0px",right:"0px",top:"0px",height:"0px",pointerEvents:"none",zIndex:"20",background:"linear-gradient(to bottom, rgba(17,24,39,1), rgba(17,24,39,0))"}),d.style.position=d.style.position||"relative",d.insertBefore(y,d.firstChild)),b>0?(y.style.height=`${b}px`,y.style.display=""):(y.style.height="0px",y.style.display="none"),d.style.marginTop="0px"}catch{d.style.marginTop="0px"}};i();const l=()=>{n&&cancelAnimationFrame(n),n=requestAnimationFrame(i)},o=document.getElementById("ndn-main-scroll");return o?.addEventListener("scroll",l,{passive:!0}),window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l),()=>{o?.removeEventListener("scroll",l),window.removeEventListener("scroll",l),window.removeEventListener("resize",l),n&&cancelAnimationFrame(n)}},[]),e.jsx("div",{ref:r,className:a,style:s,children:t})}const Xd=({calibrationComplete:t})=>{const[a,s]=u.useState(!1),[r,n]=u.useState(!1);return u.useEffect(()=>{t?(s(!0),setTimeout(()=>n(!0),1200)):(s(!1),n(!1))},[t]),e.jsxs("div",{className:`flex flex-col items-center justify-center w-full h-full transition-opacity duration-700 ${r?"opacity-0":"opacity-100"}`,style:{pointerEvents:"none",position:"absolute",inset:0,zIndex:10},children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("svg",{width:"80",height:"80",viewBox:"0 0 80 80",className:`animate-spin-slow ${a?"opacity-0":"opacity-100"} transition-opacity duration-500`,style:{transition:"opacity 0.5s"},children:e.jsxs("g",{children:[e.jsx("rect",{x:"36",y:"10",width:"8",height:"40",rx:"3",fill:"#a78bfa"}),e.jsx("polygon",{points:"40,10 44,22 36,22",fill:"#f472b6"}),e.jsx("rect",{x:"36",y:"50",width:"8",height:"18",rx:"2",fill:"#22d3ee"}),e.jsx("polygon",{points:"36,68 44,68 40,78",fill:"#10b981"})]})}),a&&e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",className:"absolute",style:{left:0,top:0},children:[e.jsx("circle",{cx:"40",cy:"40",r:"32",fill:"none",stroke:"#10b981",strokeWidth:"6"}),e.jsx("polyline",{points:"28,44 38,54 54,30",fill:"none",stroke:"#10b981",strokeWidth:"6",strokeLinecap:"round",strokeLinejoin:"round"})]})]}),e.jsx("div",{className:"mt-4 text-lg font-semibold text-indigo-200",children:a?"Calibration Complete!":"Initializing Camera..."})]})};var pa={},_r,Oo;function Qd(){return Oo||(Oo=1,_r=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),_r}var Hr={},En={},Bo;function Xn(){if(Bo)return En;Bo=1;let t;const a=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return En.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},En.getSymbolTotalCodewords=function(r){return a[r]},En.getBCHDigit=function(s){let r=0;for(;s!==0;)r++,s>>>=1;return r},En.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');t=r},En.isKanjiModeEnabled=function(){return typeof t<"u"},En.toSJIS=function(r){return t(r)},En}var Wr={},Uo;function Ki(){return Uo||(Uo=1,(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function a(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+s)}}t.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},t.from=function(r,n){if(t.isValid(r))return r;try{return a(r)}catch{return n}}})(Wr)),Wr}var qr,$o;function Zd(){if($o)return qr;$o=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(a){const s=Math.floor(a/8);return(this.buffer[s]>>>7-a%8&1)===1},put:function(a,s){for(let r=0;r<s;r++)this.putBit((a>>>s-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(a){const s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),a&&(this.buffer[s]|=128>>>this.length%8),this.length++}},qr=t,qr}var zr,Fo;function eu(){if(Fo)return zr;Fo=1;function t(a){if(!a||a<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=a,this.data=new Uint8Array(a*a),this.reservedBit=new Uint8Array(a*a)}return t.prototype.set=function(a,s,r,n){const i=a*this.size+s;this.data[i]=r,n&&(this.reservedBit[i]=!0)},t.prototype.get=function(a,s){return this.data[a*this.size+s]},t.prototype.xor=function(a,s,r){this.data[a*this.size+s]^=r},t.prototype.isReserved=function(a,s){return this.reservedBit[a*this.size+s]},zr=t,zr}var Vr={},_o;function tu(){return _o||(_o=1,(function(t){const a=Xn().getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const n=Math.floor(r/7)+2,i=a(r),l=i===145?26:Math.ceil((i-13)/(2*n-2))*2,o=[i-7];for(let d=1;d<n-1;d++)o[d]=o[d-1]-l;return o.push(6),o.reverse()},t.getPositions=function(r){const n=[],i=t.getRowColCoords(r),l=i.length;for(let o=0;o<l;o++)for(let d=0;d<l;d++)o===0&&d===0||o===0&&d===l-1||o===l-1&&d===0||n.push([i[o],i[d]]);return n}})(Vr)),Vr}var Gr={},Ho;function su(){if(Ho)return Gr;Ho=1;const t=Xn().getSymbolSize,a=7;return Gr.getPositions=function(r){const n=t(r);return[[0,0],[n-a,0],[0,n-a]]},Gr}var Jr={},Wo;function nu(){return Wo||(Wo=1,(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const a={N1:3,N2:3,N3:40,N4:10};t.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7},t.from=function(n){return t.isValid(n)?parseInt(n,10):void 0},t.getPenaltyN1=function(n){const i=n.size;let l=0,o=0,d=0,c=null,h=null;for(let m=0;m<i;m++){o=d=0,c=h=null;for(let x=0;x<i;x++){let b=n.get(m,x);b===c?o++:(o>=5&&(l+=a.N1+(o-5)),c=b,o=1),b=n.get(x,m),b===h?d++:(d>=5&&(l+=a.N1+(d-5)),h=b,d=1)}o>=5&&(l+=a.N1+(o-5)),d>=5&&(l+=a.N1+(d-5))}return l},t.getPenaltyN2=function(n){const i=n.size;let l=0;for(let o=0;o<i-1;o++)for(let d=0;d<i-1;d++){const c=n.get(o,d)+n.get(o,d+1)+n.get(o+1,d)+n.get(o+1,d+1);(c===4||c===0)&&l++}return l*a.N2},t.getPenaltyN3=function(n){const i=n.size;let l=0,o=0,d=0;for(let c=0;c<i;c++){o=d=0;for(let h=0;h<i;h++)o=o<<1&2047|n.get(c,h),h>=10&&(o===1488||o===93)&&l++,d=d<<1&2047|n.get(h,c),h>=10&&(d===1488||d===93)&&l++}return l*a.N3},t.getPenaltyN4=function(n){let i=0;const l=n.data.length;for(let d=0;d<l;d++)i+=n.data[d];return Math.abs(Math.ceil(i*100/l/5)-10)*a.N4};function s(r,n,i){switch(r){case t.Patterns.PATTERN000:return(n+i)%2===0;case t.Patterns.PATTERN001:return n%2===0;case t.Patterns.PATTERN010:return i%3===0;case t.Patterns.PATTERN011:return(n+i)%3===0;case t.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(i/3))%2===0;case t.Patterns.PATTERN101:return n*i%2+n*i%3===0;case t.Patterns.PATTERN110:return(n*i%2+n*i%3)%2===0;case t.Patterns.PATTERN111:return(n*i%3+(n+i)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(n,i){const l=i.size;for(let o=0;o<l;o++)for(let d=0;d<l;d++)i.isReserved(d,o)||i.xor(d,o,s(n,d,o))},t.getBestMask=function(n,i){const l=Object.keys(t.Patterns).length;let o=0,d=1/0;for(let c=0;c<l;c++){i(c),t.applyMask(c,n);const h=t.getPenaltyN1(n)+t.getPenaltyN2(n)+t.getPenaltyN3(n)+t.getPenaltyN4(n);t.applyMask(c,n),h<d&&(d=h,o=c)}return o}})(Jr)),Jr}var er={},qo;function Gl(){if(qo)return er;qo=1;const t=Ki(),a=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return er.getBlocksCount=function(n,i){switch(i){case t.L:return a[(n-1)*4+0];case t.M:return a[(n-1)*4+1];case t.Q:return a[(n-1)*4+2];case t.H:return a[(n-1)*4+3];default:return}},er.getTotalCodewordsCount=function(n,i){switch(i){case t.L:return s[(n-1)*4+0];case t.M:return s[(n-1)*4+1];case t.Q:return s[(n-1)*4+2];case t.H:return s[(n-1)*4+3];default:return}},er}var Kr={},Ba={},zo;function au(){if(zo)return Ba;zo=1;const t=new Uint8Array(512),a=new Uint8Array(256);return(function(){let r=1;for(let n=0;n<255;n++)t[n]=r,a[r]=n,r<<=1,r&256&&(r^=285);for(let n=255;n<512;n++)t[n]=t[n-255]})(),Ba.log=function(r){if(r<1)throw new Error("log("+r+")");return a[r]},Ba.exp=function(r){return t[r]},Ba.mul=function(r,n){return r===0||n===0?0:t[a[r]+a[n]]},Ba}var Vo;function ru(){return Vo||(Vo=1,(function(t){const a=au();t.mul=function(r,n){const i=new Uint8Array(r.length+n.length-1);for(let l=0;l<r.length;l++)for(let o=0;o<n.length;o++)i[l+o]^=a.mul(r[l],n[o]);return i},t.mod=function(r,n){let i=new Uint8Array(r);for(;i.length-n.length>=0;){const l=i[0];for(let d=0;d<n.length;d++)i[d]^=a.mul(n[d],l);let o=0;for(;o<i.length&&i[o]===0;)o++;i=i.slice(o)}return i},t.generateECPolynomial=function(r){let n=new Uint8Array([1]);for(let i=0;i<r;i++)n=t.mul(n,new Uint8Array([1,a.exp(i)]));return n}})(Kr)),Kr}var Yr,Go;function iu(){if(Go)return Yr;Go=1;const t=ru();function a(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}return a.prototype.initialize=function(r){this.degree=r,this.genPoly=t.generateECPolynomial(this.degree)},a.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(r.length+this.degree);n.set(r);const i=t.mod(n,this.genPoly),l=this.degree-i.length;if(l>0){const o=new Uint8Array(this.degree);return o.set(i,l),o}return i},Yr=a,Yr}var Xr={},Qr={},Zr={},Jo;function Jl(){return Jo||(Jo=1,Zr.isValid=function(a){return!isNaN(a)&&a>=1&&a<=40}),Zr}var rn={},Ko;function Kl(){if(Ko)return rn;Ko=1;const t="[0-9]+",a="[A-Z $%*+\\-./:]+";let s="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";s=s.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+s+`)(?:.|[\r
]))+`;rn.KANJI=new RegExp(s,"g"),rn.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),rn.BYTE=new RegExp(r,"g"),rn.NUMERIC=new RegExp(t,"g"),rn.ALPHANUMERIC=new RegExp(a,"g");const n=new RegExp("^"+s+"$"),i=new RegExp("^"+t+"$"),l=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return rn.testKanji=function(d){return n.test(d)},rn.testNumeric=function(d){return i.test(d)},rn.testAlphanumeric=function(d){return l.test(d)},rn}var Yo;function Qn(){return Yo||(Yo=1,(function(t){const a=Jl(),s=Kl();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(i,l){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!a.isValid(l))throw new Error("Invalid version: "+l);return l>=1&&l<10?i.ccBits[0]:l<27?i.ccBits[1]:i.ccBits[2]},t.getBestModeForData=function(i){return s.testNumeric(i)?t.NUMERIC:s.testAlphanumeric(i)?t.ALPHANUMERIC:s.testKanji(i)?t.KANJI:t.BYTE},t.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},t.isValid=function(i){return i&&i.bit&&i.ccBits};function r(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+n)}}t.from=function(i,l){if(t.isValid(i))return i;try{return r(i)}catch{return l}}})(Qr)),Qr}var Xo;function ou(){return Xo||(Xo=1,(function(t){const a=Xn(),s=Gl(),r=Ki(),n=Qn(),i=Jl(),l=7973,o=a.getBCHDigit(l);function d(x,b,y){for(let N=1;N<=40;N++)if(b<=t.getCapacity(N,y,x))return N}function c(x,b){return n.getCharCountIndicator(x,b)+4}function h(x,b){let y=0;return x.forEach(function(N){const C=c(N.mode,b);y+=C+N.getBitsLength()}),y}function m(x,b){for(let y=1;y<=40;y++)if(h(x,y)<=t.getCapacity(y,b,n.MIXED))return y}t.from=function(b,y){return i.isValid(b)?parseInt(b,10):y},t.getCapacity=function(b,y,N){if(!i.isValid(b))throw new Error("Invalid QR Code version");typeof N>"u"&&(N=n.BYTE);const C=a.getSymbolTotalCodewords(b),w=s.getTotalCodewordsCount(b,y),D=(C-w)*8;if(N===n.MIXED)return D;const I=D-c(N,b);switch(N){case n.NUMERIC:return Math.floor(I/10*3);case n.ALPHANUMERIC:return Math.floor(I/11*2);case n.KANJI:return Math.floor(I/13);case n.BYTE:default:return Math.floor(I/8)}},t.getBestVersionForData=function(b,y){let N;const C=r.from(y,r.M);if(Array.isArray(b)){if(b.length>1)return m(b,C);if(b.length===0)return 1;N=b[0]}else N=b;return d(N.mode,N.getLength(),C)},t.getEncodedBits=function(b){if(!i.isValid(b)||b<7)throw new Error("Invalid QR Code version");let y=b<<12;for(;a.getBCHDigit(y)-o>=0;)y^=l<<a.getBCHDigit(y)-o;return b<<12|y}})(Xr)),Xr}var ei={},Qo;function lu(){if(Qo)return ei;Qo=1;const t=Xn(),a=1335,s=21522,r=t.getBCHDigit(a);return ei.getEncodedBits=function(i,l){const o=i.bit<<3|l;let d=o<<10;for(;t.getBCHDigit(d)-r>=0;)d^=a<<t.getBCHDigit(d)-r;return(o<<10|d)^s},ei}var ti={},si,Zo;function cu(){if(Zo)return si;Zo=1;const t=Qn();function a(s){this.mode=t.NUMERIC,this.data=s.toString()}return a.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(r){let n,i,l;for(n=0;n+3<=this.data.length;n+=3)i=this.data.substr(n,3),l=parseInt(i,10),r.put(l,10);const o=this.data.length-n;o>0&&(i=this.data.substr(n),l=parseInt(i,10),r.put(l,o*3+1))},si=a,si}var ni,el;function du(){if(el)return ni;el=1;const t=Qn(),a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(r){this.mode=t.ALPHANUMERIC,this.data=r}return s.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(n){let i;for(i=0;i+2<=this.data.length;i+=2){let l=a.indexOf(this.data[i])*45;l+=a.indexOf(this.data[i+1]),n.put(l,11)}this.data.length%2&&n.put(a.indexOf(this.data[i]),6)},ni=s,ni}var ai,tl;function uu(){if(tl)return ai;tl=1;const t=Qn();function a(s){this.mode=t.BYTE,typeof s=="string"?this.data=new TextEncoder().encode(s):this.data=new Uint8Array(s)}return a.getBitsLength=function(r){return r*8},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(s){for(let r=0,n=this.data.length;r<n;r++)s.put(this.data[r],8)},ai=a,ai}var ri,sl;function mu(){if(sl)return ri;sl=1;const t=Qn(),a=Xn();function s(r){this.mode=t.KANJI,this.data=r}return s.getBitsLength=function(n){return n*13},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(r){let n;for(n=0;n<this.data.length;n++){let i=a.toSJIS(this.data[n]);if(i>=33088&&i<=40956)i-=33088;else if(i>=57408&&i<=60351)i-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);i=(i>>>8&255)*192+(i&255),r.put(i,13)}},ri=s,ri}var ii={exports:{}},nl;function hu(){return nl||(nl=1,(function(t){var a={single_source_shortest_paths:function(s,r,n){var i={},l={};l[r]=0;var o=a.PriorityQueue.make();o.push(r,0);for(var d,c,h,m,x,b,y,N,C;!o.empty();){d=o.pop(),c=d.value,m=d.cost,x=s[c]||{};for(h in x)x.hasOwnProperty(h)&&(b=x[h],y=m+b,N=l[h],C=typeof l[h]>"u",(C||N>y)&&(l[h]=y,o.push(h,y),i[h]=c))}if(typeof n<"u"&&typeof l[n]>"u"){var w=["Could not find a path from ",r," to ",n,"."].join("");throw new Error(w)}return i},extract_shortest_path_from_predecessor_list:function(s,r){for(var n=[],i=r;i;)n.push(i),s[i],i=s[i];return n.reverse(),n},find_path:function(s,r,n){var i=a.single_source_shortest_paths(s,r,n);return a.extract_shortest_path_from_predecessor_list(i,n)},PriorityQueue:{make:function(s){var r=a.PriorityQueue,n={},i;s=s||{};for(i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);return n.queue=[],n.sorter=s.sorter||r.default_sorter,n},default_sorter:function(s,r){return s.cost-r.cost},push:function(s,r){var n={value:s,cost:r};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=a})(ii)),ii.exports}var al;function fu(){return al||(al=1,(function(t){const a=Qn(),s=cu(),r=du(),n=uu(),i=mu(),l=Kl(),o=Xn(),d=hu();function c(w){return unescape(encodeURIComponent(w)).length}function h(w,D,I){const M=[];let R;for(;(R=w.exec(I))!==null;)M.push({data:R[0],index:R.index,mode:D,length:R[0].length});return M}function m(w){const D=h(l.NUMERIC,a.NUMERIC,w),I=h(l.ALPHANUMERIC,a.ALPHANUMERIC,w);let M,R;return o.isKanjiModeEnabled()?(M=h(l.BYTE,a.BYTE,w),R=h(l.KANJI,a.KANJI,w)):(M=h(l.BYTE_KANJI,a.BYTE,w),R=[]),D.concat(I,M,R).sort(function(v,p){return v.index-p.index}).map(function(v){return{data:v.data,mode:v.mode,length:v.length}})}function x(w,D){switch(D){case a.NUMERIC:return s.getBitsLength(w);case a.ALPHANUMERIC:return r.getBitsLength(w);case a.KANJI:return i.getBitsLength(w);case a.BYTE:return n.getBitsLength(w)}}function b(w){return w.reduce(function(D,I){const M=D.length-1>=0?D[D.length-1]:null;return M&&M.mode===I.mode?(D[D.length-1].data+=I.data,D):(D.push(I),D)},[])}function y(w){const D=[];for(let I=0;I<w.length;I++){const M=w[I];switch(M.mode){case a.NUMERIC:D.push([M,{data:M.data,mode:a.ALPHANUMERIC,length:M.length},{data:M.data,mode:a.BYTE,length:M.length}]);break;case a.ALPHANUMERIC:D.push([M,{data:M.data,mode:a.BYTE,length:M.length}]);break;case a.KANJI:D.push([M,{data:M.data,mode:a.BYTE,length:c(M.data)}]);break;case a.BYTE:D.push([{data:M.data,mode:a.BYTE,length:c(M.data)}])}}return D}function N(w,D){const I={},M={start:{}};let R=["start"];for(let A=0;A<w.length;A++){const v=w[A],p=[];for(let F=0;F<v.length;F++){const H=v[F],_=""+A+F;p.push(_),I[_]={node:H,lastCount:0},M[_]={};for(let z=0;z<R.length;z++){const T=R[z];I[T]&&I[T].node.mode===H.mode?(M[T][_]=x(I[T].lastCount+H.length,H.mode)-x(I[T].lastCount,H.mode),I[T].lastCount+=H.length):(I[T]&&(I[T].lastCount=H.length),M[T][_]=x(H.length,H.mode)+4+a.getCharCountIndicator(H.mode,D))}}R=p}for(let A=0;A<R.length;A++)M[R[A]].end=0;return{map:M,table:I}}function C(w,D){let I;const M=a.getBestModeForData(w);if(I=a.from(D,M),I!==a.BYTE&&I.bit<M.bit)throw new Error('"'+w+'" cannot be encoded with mode '+a.toString(I)+`.
 Suggested mode is: `+a.toString(M));switch(I===a.KANJI&&!o.isKanjiModeEnabled()&&(I=a.BYTE),I){case a.NUMERIC:return new s(w);case a.ALPHANUMERIC:return new r(w);case a.KANJI:return new i(w);case a.BYTE:return new n(w)}}t.fromArray=function(D){return D.reduce(function(I,M){return typeof M=="string"?I.push(C(M,null)):M.data&&I.push(C(M.data,M.mode)),I},[])},t.fromString=function(D,I){const M=m(D,o.isKanjiModeEnabled()),R=y(M),A=N(R,I),v=d.find_path(A.map,"start","end"),p=[];for(let F=1;F<v.length-1;F++)p.push(A.table[v[F]].node);return t.fromArray(b(p))},t.rawSplit=function(D){return t.fromArray(m(D,o.isKanjiModeEnabled()))}})(ti)),ti}var rl;function xu(){if(rl)return Hr;rl=1;const t=Xn(),a=Ki(),s=Zd(),r=eu(),n=tu(),i=su(),l=nu(),o=Gl(),d=iu(),c=ou(),h=lu(),m=Qn(),x=fu();function b(A,v){const p=A.size,F=i.getPositions(v);for(let H=0;H<F.length;H++){const _=F[H][0],z=F[H][1];for(let T=-1;T<=7;T++)if(!(_+T<=-1||p<=_+T))for(let K=-1;K<=7;K++)z+K<=-1||p<=z+K||(T>=0&&T<=6&&(K===0||K===6)||K>=0&&K<=6&&(T===0||T===6)||T>=2&&T<=4&&K>=2&&K<=4?A.set(_+T,z+K,!0,!0):A.set(_+T,z+K,!1,!0))}}function y(A){const v=A.size;for(let p=8;p<v-8;p++){const F=p%2===0;A.set(p,6,F,!0),A.set(6,p,F,!0)}}function N(A,v){const p=n.getPositions(v);for(let F=0;F<p.length;F++){const H=p[F][0],_=p[F][1];for(let z=-2;z<=2;z++)for(let T=-2;T<=2;T++)z===-2||z===2||T===-2||T===2||z===0&&T===0?A.set(H+z,_+T,!0,!0):A.set(H+z,_+T,!1,!0)}}function C(A,v){const p=A.size,F=c.getEncodedBits(v);let H,_,z;for(let T=0;T<18;T++)H=Math.floor(T/3),_=T%3+p-8-3,z=(F>>T&1)===1,A.set(H,_,z,!0),A.set(_,H,z,!0)}function w(A,v,p){const F=A.size,H=h.getEncodedBits(v,p);let _,z;for(_=0;_<15;_++)z=(H>>_&1)===1,_<6?A.set(_,8,z,!0):_<8?A.set(_+1,8,z,!0):A.set(F-15+_,8,z,!0),_<8?A.set(8,F-_-1,z,!0):_<9?A.set(8,15-_-1+1,z,!0):A.set(8,15-_-1,z,!0);A.set(F-8,8,1,!0)}function D(A,v){const p=A.size;let F=-1,H=p-1,_=7,z=0;for(let T=p-1;T>0;T-=2)for(T===6&&T--;;){for(let K=0;K<2;K++)if(!A.isReserved(H,T-K)){let ee=!1;z<v.length&&(ee=(v[z]>>>_&1)===1),A.set(H,T-K,ee),_--,_===-1&&(z++,_=7)}if(H+=F,H<0||p<=H){H-=F,F=-F;break}}}function I(A,v,p){const F=new s;p.forEach(function(K){F.put(K.mode.bit,4),F.put(K.getLength(),m.getCharCountIndicator(K.mode,A)),K.write(F)});const H=t.getSymbolTotalCodewords(A),_=o.getTotalCodewordsCount(A,v),z=(H-_)*8;for(F.getLengthInBits()+4<=z&&F.put(0,4);F.getLengthInBits()%8!==0;)F.putBit(0);const T=(z-F.getLengthInBits())/8;for(let K=0;K<T;K++)F.put(K%2?17:236,8);return M(F,A,v)}function M(A,v,p){const F=t.getSymbolTotalCodewords(v),H=o.getTotalCodewordsCount(v,p),_=F-H,z=o.getBlocksCount(v,p),T=F%z,K=z-T,ee=Math.floor(F/z),ie=Math.floor(_/z),ke=ie+1,Be=ee-ie,Ue=new d(Be);let Oe=0;const je=new Array(z),Re=new Array(z);let $=0;const te=new Uint8Array(A.buffer);for(let Ee=0;Ee<z;Ee++){const ht=Ee<K?ie:ke;je[Ee]=te.slice(Oe,Oe+ht),Re[Ee]=Ue.encode(je[Ee]),Oe+=ht,$=Math.max($,ht)}const ce=new Uint8Array(F);let ze=0,Pe,Te;for(Pe=0;Pe<$;Pe++)for(Te=0;Te<z;Te++)Pe<je[Te].length&&(ce[ze++]=je[Te][Pe]);for(Pe=0;Pe<Be;Pe++)for(Te=0;Te<z;Te++)ce[ze++]=Re[Te][Pe];return ce}function R(A,v,p,F){let H;if(Array.isArray(A))H=x.fromArray(A);else if(typeof A=="string"){let ee=v;if(!ee){const ie=x.rawSplit(A);ee=c.getBestVersionForData(ie,p)}H=x.fromString(A,ee||40)}else throw new Error("Invalid data");const _=c.getBestVersionForData(H,p);if(!_)throw new Error("The amount of data is too big to be stored in a QR Code");if(!v)v=_;else if(v<_)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+_+`.
`);const z=I(v,p,H),T=t.getSymbolSize(v),K=new r(T);return b(K,v),y(K),N(K,v),w(K,p,0),v>=7&&C(K,v),D(K,z),isNaN(F)&&(F=l.getBestMask(K,w.bind(null,K,p))),l.applyMask(F,K),w(K,p,F),{modules:K,version:v,errorCorrectionLevel:p,maskPattern:F,segments:H}}return Hr.create=function(v,p){if(typeof v>"u"||v==="")throw new Error("No input text");let F=a.M,H,_;return typeof p<"u"&&(F=a.from(p.errorCorrectionLevel,a.M),H=c.from(p.version),_=l.from(p.maskPattern),p.toSJISFunc&&t.setToSJISFunction(p.toSJISFunc)),R(v,H,F,_)},Hr}var oi={},li={},il;function Yl(){return il||(il=1,(function(t){function a(s){if(typeof s=="number"&&(s=s.toString()),typeof s!="string")throw new Error("Color should be defined as hex string");let r=s.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+s);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(i){return[i,i]}))),r.length===6&&r.push("F","F");const n=parseInt(r.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const n=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,i=r.width&&r.width>=21?r.width:void 0,l=r.scale||4;return{width:i,scale:i?4:l,margin:n,color:{dark:a(r.color.dark||"#000000ff"),light:a(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,n){return n.width&&n.width>=r+n.margin*2?n.width/(r+n.margin*2):n.scale},t.getImageWidth=function(r,n){const i=t.getScale(r,n);return Math.floor((r+n.margin*2)*i)},t.qrToImageData=function(r,n,i){const l=n.modules.size,o=n.modules.data,d=t.getScale(l,i),c=Math.floor((l+i.margin*2)*d),h=i.margin*d,m=[i.color.light,i.color.dark];for(let x=0;x<c;x++)for(let b=0;b<c;b++){let y=(x*c+b)*4,N=i.color.light;if(x>=h&&b>=h&&x<c-h&&b<c-h){const C=Math.floor((x-h)/d),w=Math.floor((b-h)/d);N=m[o[C*l+w]?1:0]}r[y++]=N.r,r[y++]=N.g,r[y++]=N.b,r[y]=N.a}}})(li)),li}var ol;function pu(){return ol||(ol=1,(function(t){const a=Yl();function s(n,i,l){n.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=l,i.width=l,i.style.height=l+"px",i.style.width=l+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(i,l,o){let d=o,c=l;typeof d>"u"&&(!l||!l.getContext)&&(d=l,l=void 0),l||(c=r()),d=a.getOptions(d);const h=a.getImageWidth(i.modules.size,d),m=c.getContext("2d"),x=m.createImageData(h,h);return a.qrToImageData(x.data,i,d),s(m,c,h),m.putImageData(x,0,0),c},t.renderToDataURL=function(i,l,o){let d=o;typeof d>"u"&&(!l||!l.getContext)&&(d=l,l=void 0),d||(d={});const c=t.render(i,l,d),h=d.type||"image/png",m=d.rendererOpts||{};return c.toDataURL(h,m.quality)}})(oi)),oi}var ci={},ll;function bu(){if(ll)return ci;ll=1;const t=Yl();function a(n,i){const l=n.a/255,o=i+'="'+n.hex+'"';return l<1?o+" "+i+'-opacity="'+l.toFixed(2).slice(1)+'"':o}function s(n,i,l){let o=n+i;return typeof l<"u"&&(o+=" "+l),o}function r(n,i,l){let o="",d=0,c=!1,h=0;for(let m=0;m<n.length;m++){const x=Math.floor(m%i),b=Math.floor(m/i);!x&&!c&&(c=!0),n[m]?(h++,m>0&&x>0&&n[m-1]||(o+=c?s("M",x+l,.5+b+l):s("m",d,0),d=0,c=!1),x+1<i&&n[m+1]||(o+=s("h",h),h=0)):d++}return o}return ci.render=function(i,l,o){const d=t.getOptions(l),c=i.modules.size,h=i.modules.data,m=c+d.margin*2,x=d.color.light.a?"<path "+a(d.color.light,"fill")+' d="M0 0h'+m+"v"+m+'H0z"/>':"",b="<path "+a(d.color.dark,"stroke")+' d="'+r(h,c,d.margin)+'"/>',y='viewBox="0 0 '+m+" "+m+'"',C='<svg xmlns="http://www.w3.org/2000/svg" '+(d.width?'width="'+d.width+'" height="'+d.width+'" ':"")+y+' shape-rendering="crispEdges">'+x+b+`</svg>
`;return typeof o=="function"&&o(null,C),C},ci}var cl;function gu(){if(cl)return pa;cl=1;const t=Qd(),a=xu(),s=pu(),r=bu();function n(i,l,o,d,c){const h=[].slice.call(arguments,1),m=h.length,x=typeof h[m-1]=="function";if(!x&&!t())throw new Error("Callback required as last argument");if(x){if(m<2)throw new Error("Too few arguments provided");m===2?(c=o,o=l,l=d=void 0):m===3&&(l.getContext&&typeof c>"u"?(c=d,d=void 0):(c=d,d=o,o=l,l=void 0))}else{if(m<1)throw new Error("Too few arguments provided");return m===1?(o=l,l=d=void 0):m===2&&!l.getContext&&(d=o,o=l,l=void 0),new Promise(function(b,y){try{const N=a.create(o,d);b(i(N,l,d))}catch(N){y(N)}})}try{const b=a.create(o,d);c(null,i(b,l,d))}catch(b){c(b)}}return pa.create=a.create,pa.toCanvas=n.bind(null,s.render),pa.toDataURL=n.bind(null,s.renderToDataURL),pa.toString=n.bind(null,function(i,l,o){return r.render(i,o)}),pa}var yu=gu();const vu=zi(yu);async function dl(t){return new Promise((a,s)=>{const r=new Image;r.onload=()=>a(r),r.onerror=n=>s(n),r.src=t})}async function ju(t,a){const[s,r]=await Promise.all([dl(t),dl(a.logoUrl)]),n=Math.max(160,s.width||160),i=Math.max(160,s.height||160),l=document.createElement("canvas");l.width=n,l.height=i;const o=l.getContext("2d");o.fillStyle="#ffffff",o.fillRect(0,0,n,i),o.imageSmoothingEnabled=!1,o.drawImage(s,0,0,n,i);const d=n/2,c=i/2,h=Math.max(.14,Math.min(.28,a.logoScale??.2)),m=Math.round(Math.min(n,i)*h),x=Math.round(d-m/2),b=Math.round(c-m/2);if(a.mask!==!1){const y=a.shape||"rounded-rect",N=Math.max(2,Math.round(m*.08)),C=x-N,w=b-N,D=m+N*2,I=m+N*2;if(o.beginPath(),y==="circle"){const M=Math.min(D,I)/2;o.arc(C+D/2,w+I/2,M,0,Math.PI*2)}else if(y==="rect")o.rect(C,w,D,I);else{const M=Math.max(4,a.radiusPx??Math.round(m*.12)),R=Math.min(M,D/2,I/2);o.moveTo(C+R,w),o.arcTo(C+D,w,C+D,w+I,R),o.arcTo(C+D,w+I,C,w+I,R),o.arcTo(C,w+I,C,w,R),o.arcTo(C,w,C+D,w,R),o.closePath()}o.fillStyle="#ffffff",o.fill(),o.lineWidth=1,o.strokeStyle=a.maskStroke||"rgba(0,0,0,0.12)",o.stroke()}if(o.save(),a.shape==="circle"){const y=m/2;o.beginPath(),o.arc(x+y,b+y,y,0,Math.PI*2),o.clip()}return o.imageSmoothingEnabled=!0,o.drawImage(r,x,b,m,m),o.restore(),l.toDataURL("image/png")}async function Xl(t,a){const{width:s=256,margin:r=2,errorCorrectionLevel:n="H",color:i={dark:"#000000",light:"#ffffff"},logo:l}=a||{},o=await vu.toDataURL(t,{width:s,margin:r,errorCorrectionLevel:n,color:i});return l?ju(o,l):o}const Nu={};function Yi(t,a){let s;try{s=t()}catch{return}return{getItem:n=>{var i;const l=d=>d===null?null:JSON.parse(d,void 0),o=(i=s.getItem(n))!=null?i:null;return o instanceof Promise?o.then(l):l(o)},setItem:(n,i)=>s.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>s.removeItem(n)}}const Ha=t=>a=>{try{const s=t(a);return s instanceof Promise?s:{then(r){return Ha(r)(s)},catch(r){return this}}}catch(s){return{then(r){return this},catch(r){return Ha(r)(s)}}}},wu=(t,a)=>(s,r,n)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:C=>C,version:0,merge:(C,w)=>({...w,...C}),...a},l=!1;const o=new Set,d=new Set;let c;try{c=i.getStorage()}catch{}if(!c)return t((...C)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),s(...C)},r,n);const h=Ha(i.serialize),m=()=>{const C=i.partialize({...r()});let w;const D=h({state:C,version:i.version}).then(I=>c.setItem(i.name,I)).catch(I=>{w=I});if(w)throw w;return D},x=n.setState;n.setState=(C,w)=>{x(C,w),m()};const b=t((...C)=>{s(...C),m()},r,n);let y;const N=()=>{var C;if(!c)return;l=!1,o.forEach(D=>D(r()));const w=((C=i.onRehydrateStorage)==null?void 0:C.call(i,r()))||void 0;return Ha(c.getItem.bind(c))(i.name).then(D=>{if(D)return i.deserialize(D)}).then(D=>{if(D)if(typeof D.version=="number"&&D.version!==i.version){if(i.migrate)return i.migrate(D.state,D.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return D.state}).then(D=>{var I;return y=i.merge(D,(I=r())!=null?I:b),s(y,!0),m()}).then(()=>{w?.(y,void 0),l=!0,d.forEach(D=>D(y))}).catch(D=>{w?.(void 0,D)})};return n.persist={setOptions:C=>{i={...i,...C},C.getStorage&&(c=C.getStorage())},clearStorage:()=>{c?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>N(),hasHydrated:()=>l,onHydrate:C=>(o.add(C),()=>{o.delete(C)}),onFinishHydration:C=>(d.add(C),()=>{d.delete(C)})},N(),y||b},Su=(t,a)=>(s,r,n)=>{let i={storage:Yi(()=>localStorage),partialize:N=>N,version:0,merge:(N,C)=>({...C,...N}),...a},l=!1;const o=new Set,d=new Set;let c=i.storage;if(!c)return t((...N)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),s(...N)},r,n);const h=()=>{const N=i.partialize({...r()});return c.setItem(i.name,{state:N,version:i.version})},m=n.setState;n.setState=(N,C)=>{m(N,C),h()};const x=t((...N)=>{s(...N),h()},r,n);n.getInitialState=()=>x;let b;const y=()=>{var N,C;if(!c)return;l=!1,o.forEach(D=>{var I;return D((I=r())!=null?I:x)});const w=((C=i.onRehydrateStorage)==null?void 0:C.call(i,(N=r())!=null?N:x))||void 0;return Ha(c.getItem.bind(c))(i.name).then(D=>{if(D)if(typeof D.version=="number"&&D.version!==i.version){if(i.migrate)return[!0,i.migrate(D.state,D.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,D.state];return[!1,void 0]}).then(D=>{var I;const[M,R]=D;if(b=i.merge(R,(I=r())!=null?I:x),s(b,!0),M)return h()}).then(()=>{w?.(b,void 0),b=r(),l=!0,d.forEach(D=>D(b))}).catch(D=>{w?.(void 0,D)})};return n.persist={setOptions:N=>{i={...i,...N},N.storage&&(c=N.storage)},clearStorage:()=>{c?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>y(),hasHydrated:()=>l,onHydrate:N=>(o.add(N),()=>{o.delete(N)}),onFinishHydration:N=>(d.add(N),()=>{d.delete(N)})},i.skipHydration||y(),b||x},ku=(t,a)=>"getStorage"in a||"serialize"in a||"deserialize"in a?((Nu?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),wu(t,a)):Su(t,a),Ql=ku,wa=Qs()(Ql((t,a)=>({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1,_hydrated:!1,setCalibration:s=>t(r=>({...r,...s})),reset:()=>t({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1})}),{name:"ndn-calibration-v1",storage:Yi(()=>localStorage),onRehydrateStorage:()=>(t,a)=>{if(!(a||!t))try{if(t&&!t.H){const s=localStorage.getItem("ndn:calibration:v1");if(s){const r=JSON.parse(s);r&&(r.H||r.imageSize)&&t.setCalibration({H:r.H??null,createdAt:r.createdAt??null,errorPx:r.errorPx??null,imageSize:r.imageSize??null,anchors:r.anchors??null,locked:!!r.locked})}}t._hydrated=!0}catch{}}}));let di=null,ui=null,mi=null,hi=null;const Zn=Qs()(Ql((t,a)=>({isStreaming:!1,mode:"local",pairingCode:null,expiresAt:null,isPaired:!1,mobileUrl:null,showOverlay:!0,setStreaming:s=>{console.log("[CAMERA_SESSION] setStreaming:",s),t({isStreaming:s})},setMode:s=>{console.log("[CAMERA_SESSION] setMode:",s),t({mode:s})},setPairingCode:s=>t({pairingCode:s}),setExpiresAt:s=>t({expiresAt:s}),setPaired:s=>t({isPaired:s}),setMobileUrl:s=>t({mobileUrl:s}),setShowOverlay:s=>t({showOverlay:!!s}),setMediaStream:s=>{ui=s},getMediaStream:()=>ui,setPcRef:s=>{mi=s},getPcRef:()=>mi,setWsRef:s=>{hi=s},getWsRef:()=>hi,getVideoElementRef:()=>{const s=di;return s||console.warn("[cameraSession] âš ï¸ getVideoElementRef called but ref is NULL"),s},setVideoElementRef:s=>{s?console.log("[cameraSession] âœ… setVideoElementRef called - storing HTMLVideoElement",{tagName:s.tagName,hasStream:!!s.srcObject}):console.log("[cameraSession] ðŸ›‘ setVideoElementRef called - clearing ref"),di=s},clearSession:()=>{di=null,ui=null,mi=null,hi=null,t({isStreaming:!1,pairingCode:null,expiresAt:null,isPaired:!1,mobileUrl:null})}}),{name:"ndn-camera-session",storage:Yi(()=>localStorage),partialize:t=>({isStreaming:t.isStreaming,mode:t.mode,pairingCode:t.pairingCode,expiresAt:t.expiresAt,isPaired:t.isPaired,mobileUrl:t.mobileUrl,showOverlay:t.showOverlay})})),pe={bullInner:6.35,bullOuter:15.9,trebleInner:99,trebleOuter:107,doubleInner:162,doubleOuter:170},Cu=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];function Yn(t,a){const s=a.x,r=a.y,n=t[6]*s+t[7]*r+t[8],i=(t[0]*s+t[1]*r+t[2])/n,l=(t[3]*s+t[4]*r+t[5])/n;return{x:i,y:l}}function Tu(t,a,s){return[a*t[0],a*t[1],a*t[2],s*t[3],s*t[4],s*t[5],t[6],t[7],t[8]]}function Eu(t){const a=t,s=a[0],r=a[1],n=a[2],i=a[3],l=a[4],o=a[5],d=a[6],c=a[7],h=a[8],m=l*h-o*c,x=n*c-r*h,b=r*o-n*l,y=o*d-i*h,N=s*h-n*d,C=n*i-s*o,w=i*c-l*d,D=r*d-s*c,I=s*l-r*i,M=s*m+r*y+n*w;if(Math.abs(M)<1e-12)throw new Error("Singular homography");return[m/M,x/M,b/M,y/M,N/M,C/M,w/M,D/M,I/M]}function ir(t,a){if(t.length<4||a.length<4)throw new Error("Need at least 4 correspondences");if(t.length!==a.length)throw new Error("Correspondences must have equal length");const s=[],r=[];for(let l=0;l<t.length;l++){const{x:o,y:d}=t[l],{x:c,y:h}=a[l];s.push([o,d,1,0,0,0,-c*o,-c*d]),r.push(c),s.push([0,0,0,o,d,1,-h*o,-h*d]),r.push(h)}const n=Du(s,r);return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],1]}function Du(t,a){const s=t.length,r=t[0].length,n=Array.from({length:r},()=>new Array(r).fill(0)),i=new Array(r).fill(0);for(let l=0;l<s;l++)for(let o=0;o<r;o++){i[o]+=t[l][o]*a[l];for(let d=0;d<r;d++)n[o][d]+=t[l][o]*t[l][d]}return Iu(n,i)}function Iu(t,a){const s=a.length,r=t.map((i,l)=>i.concat([a[l]]));for(let i=0;i<s;i++){let l=i;for(let o=i+1;o<s;o++)Math.abs(r[o][i])>Math.abs(r[l][i])&&(l=o);if(Math.abs(r[l][i])<1e-12)throw new Error("Singular matrix");if(l!==i){const o=r[i];r[i]=r[l],r[l]=o}for(let o=i+1;o<s;o++){const d=r[o][i]/r[i][i];for(let c=i;c<=s;c++)r[o][c]-=d*r[i][c]}}const n=new Array(s).fill(0);for(let i=s-1;i>=0;i--){let l=r[i][s];for(let o=i+1;o<s;o++)l-=r[i][o]*n[o];n[i]=l/r[i][i]}return n}function ba(){const t=pe.doubleOuter;return[{x:0,y:-t},{x:t,y:0},{x:0,y:t},{x:-t,y:0},{x:0,y:0}]}function Zl(t,a,s=256){const r=[];for(let n=0;n<s;n++){const i=n/s*Math.PI*2,l=Yn(t,{x:a*Math.cos(i),y:a*Math.sin(i)});r.push(l)}return r}function or(t,a,s){let r=0;for(let n=0;n<a.length;n++){const i=Yn(t,a[n]),l=i.x-s[n].x,o=i.y-s[n].y;r+=l*l+o*o}return Math.sqrt(r/a.length)}function ec(t,a){const s=Eu(t);return Yn(s,a)}function Ii(t){const a=Math.hypot(t.x,t.y);let r=Math.atan2(t.y,t.x)*180/Math.PI;r=(r+360+90)%360;const n=Cu[Math.floor((360-r)%360/18)];return a<=pe.bullInner?{base:50,ring:"INNER_BULL",sector:25,mult:2}:a<=pe.bullOuter?{base:25,ring:"BULL",sector:25,mult:1}:a>=pe.doubleOuter?{base:0,ring:"MISS",sector:null,mult:0}:a>=pe.doubleInner?{base:n*2,ring:"DOUBLE",sector:n,mult:2}:a>=pe.trebleOuter?{base:n,ring:"SINGLE",sector:n,mult:1}:a>=pe.trebleInner?{base:n*3,ring:"TRIPLE",sector:n,mult:3}:{base:n,ring:"SINGLE",sector:n,mult:1}}function tc(t,a,s="#10b981",r=2){if(a.length){t.save(),t.strokeStyle=s,t.lineWidth=r,t.beginPath(),t.moveTo(a[0].x,a[0].y);for(let n=1;n<a.length;n++)t.lineTo(a[n].x,a[n].y);t.closePath(),t.stroke(),t.restore()}}function ul(t,a,s="#f59e0b"){t.save(),t.strokeStyle=s,t.lineWidth=2,t.beginPath(),t.moveTo(a.x-8,a.y),t.lineTo(a.x+8,a.y),t.moveTo(a.x,a.y-8),t.lineTo(a.x,a.y+8),t.stroke(),t.restore()}function lr(t,a,s){return Math.max(a,Math.min(s,t))}function Mu(t,a,s){const{width:r,data:n}=t,i=[[-1,0,1],[-2,0,2],[-1,0,1]],l=[[-1,-2,-1],[0,0,0],[1,2,1]];let o=0,d=0;for(let c=-1;c<=1;c++)for(let h=-1;h<=1;h++){const m=lr(a+h,0,r-1),b=(lr(s+c,0,t.height-1)*r+m)*4,y=n[b],N=n[b+1],C=n[b+2],w=.299*y+.587*N+.114*C;o+=w*i[c+1][h+1],d+=w*l[c+1][h+1]}return Math.hypot(o,d)}function Au(t,a,s=6){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),i=lr(Math.round(a.x),1,t.width-2),l=lr(Math.round(a.y),1,t.height-2);let o={x:i,y:l,mag:-1};for(let d=l-s;d<=l+s;d++)for(let c=i-s;c<=i+s;c++){if(c<=0||d<=0||c>=t.width-1||d>=t.height-1)continue;const h=Mu(n,c,d);h>o.mag&&(o={x:c,y:d,mag:h})}return{x:o.x,y:o.y}}var fi,ml;function sc(){if(ml)return fi;ml=1;var t=t||{};return t.Image=function(a,s,r){this.width=a||0,this.height=s||0,this.data=r||[]},t.grayscale=function(a,s){for(var r=a.data,n=s.data,i=r.length,l=0,o=0;l<i;l+=4)n[o++]=r[l]*.299+r[l+1]*.587+r[l+2]*.114+.5&255;return s.width=a.width,s.height=a.height,s},t.threshold=function(a,s,r){var n=a.data,i=s.data,l=n.length,o=[],d;for(d=0;d<256;++d)o[d]=d<=r?0:255;for(d=0;d<l;++d)i[d]=o[n[d]];return s.width=a.width,s.height=a.height,s},t.adaptiveThreshold=function(a,s,r,n){var i=a.data,l=s.data,o=i.length,d=[],c;for(t.stackBoxBlur(a,s,r),c=0;c<768;++c)d[c]=c-255<=-n?255:0;for(c=0;c<o;++c)l[c]=d[i[c]-l[c]+255];return s.width=a.width,s.height=a.height,s},t.otsu=function(a){var s=a.data,r=s.length,n=[],i=0,l=0,o=0,d=0,c=0,h=0,m,x,b;for(b=0;b<256;++b)n[b]=0;for(b=0;b<r;++b)n[s[b]]++;for(b=0;b<256;++b)l+=n[b]*b;for(b=0;b<256;++b)if(d+=n[b],d!==0){if(c=r-d,c===0)break;o+=n[b]*b,m=o/d-(l-o)/c,x=d*c*m*m,x>h&&(h=x,i=b)}return i},t.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265],t.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13],t.BlurStack=function(){this.color=0,this.next=null},t.stackBoxBlur=function(a,s,r){var n=a.data,i=s.data,l=a.height,o=a.width,d=l-1,c=o-1,h=r+r+1,m=r+1,x=t.stackBoxBlurMult[r],b=t.stackBoxBlurShift[r],y,N,C,w,D,I,M,R,A,v;for(y=N=new t.BlurStack,v=1;v<h;++v)y=y.next=new t.BlurStack;for(y.next=N,D=0,A=0;A<l;++A){for(I=D,C=n[D],w=m*C,y=N,v=0;v<m;++v)y.color=C,y=y.next;for(v=1;v<m;++v)y.color=n[D+v],w+=y.color,y=y.next;for(y=N,R=0;R<o;++R)i[D++]=w*x>>>b,M=R+m,M=I+(M<c?M:c),w-=y.color-n[M],y.color=n[M],y=y.next}for(R=0;R<o;++R){for(D=R,I=D+o,C=i[D],w=m*C,y=N,v=0;v<m;++v)y.color=C,y=y.next;for(v=1;v<m;++v)y.color=i[I],w+=y.color,y=y.next,I+=o;for(y=N,A=0;A<l;++A)i[D]=w*x>>>b,M=A+m,M=R+(M<d?M:d)*o,w-=y.color-i[M],y.color=i[M],y=y.next,D+=o}return s},t.gaussianBlur=function(a,s,r,n){var i=t.gaussianKernel(n);return s.width=a.width,s.height=a.height,r.width=a.width,r.height=a.height,t.gaussianBlurFilter(a,r,i,!0),t.gaussianBlurFilter(r,s,i,!1),s},t.gaussianBlurFilter=function(a,s,r,n){var i=a.data,l=s.data,o=a.height,d=a.width,c=0,h=r.length>>1,m,x,b,y,N;for(b=0;b<o;++b)for(y=0;y<d;++y){for(x=0,N=-h;N<=h;++N)n?(m=c+N,(y+N<0||y+N>=d)&&(m=c)):(m=c+N*d,(b+N<0||b+N>=o)&&(m=c)),x+=r[h+N]*i[m];l[c++]=n?x:x+.5&255}return s},t.gaussianKernel=function(a){var s=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],r=[],n,i,l,o,d,c;if(a<=7&&a%2===1)r=s[a>>1];else{for(n=(a-1)*.5,i=.8+.3*(n-1),l=-.5/(i*i),o=0,c=0;c<a;++c)d=c-n,o+=r[c]=Math.exp(l*d*d);for(o=1/o,c=0;c<a;++c)r[c]*=o}return r},t.findContours=function(a,s){var r=a.width,n=a.height,i=[],l,o,d,c,h,m,x,b,y;for(l=t.binaryBorder(a,s),o=t.neighborhoodDeltas(r+2),d=r+3,h=1,b=0;b<n;++b,d+=2)for(y=0;y<r;++y,++d)c=l[d],c!==0&&(m=x=!1,c===1&&l[d-1]===0?m=!0:c>=1&&l[d+1]===0&&(x=!0),(m||x)&&(++h,i.push(t.borderFollowing(l,d,h,{x:y,y:b},x,o))));return i},t.borderFollowing=function(a,s,r,n,i,l){var o=[],d,c,h,m,x;o.hole=i,m=x=i?0:4;do if(m=m-1&7,d=s+l[m],a[d]!==0)break;while(m!==x);if(m===x)a[s]=-r,o.push({x:n.x,y:n.y});else for(c=s;;){x=m;do h=c+l[++m];while(a[h]===0);if(m&=7,m-1>>>0<x>>>0?a[c]=-r:a[c]===1&&(a[c]=r),o.push({x:n.x,y:n.y}),n.x+=t.neighborhood[m][0],n.y+=t.neighborhood[m][1],h===s&&c===d)break;c=h,m=m+4&7}return o},t.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],t.neighborhoodDeltas=function(a){for(var s=[],r=t.neighborhood.length,n=0;n<r;++n)s[n]=t.neighborhood[n][0]+t.neighborhood[n][1]*a;return s.concat(s)},t.approxPolyDP=function(a,s){var r={start_index:0,end_index:0},n={start_index:0,end_index:0},i=[],l=[],o=a.length,d,c,h,m,x,b,y,N,C,w,D;for(s*=s,D=0,C=0;C<3;++C)for(x=0,D=(D+n.start_index)%o,c=a[D],++D===o&&(D=0),w=1;w<o;++w)d=a[D],++D===o&&(D=0),y=d.x-c.x,N=d.y-c.y,m=y*y+N*N,m>x&&(x=m,n.start_index=w);for(x<=s?i.push({x:c.x,y:c.y}):(r.start_index=D,r.end_index=n.start_index+=r.start_index,n.start_index-=n.start_index>=o?o:0,n.end_index=r.start_index,n.end_index<n.start_index&&(n.end_index+=o),l.push({start_index:n.start_index,end_index:n.end_index}),l.push({start_index:r.start_index,end_index:r.end_index}));l.length!==0;){if(r=l.pop(),h=a[r.end_index%o],c=a[D=r.start_index%o],++D===o&&(D=0),r.end_index<=r.start_index+1)b=!0;else{for(x=0,y=h.x-c.x,N=h.y-c.y,C=r.start_index+1;C<r.end_index;++C)d=a[D],++D===o&&(D=0),m=Math.abs((d.y-c.y)*y-(d.x-c.x)*N),m>x&&(x=m,n.start_index=C);b=x*x<=s*(y*y+N*N)}b?i.push({x:c.x,y:c.y}):(n.end_index=r.end_index,r.end_index=n.start_index,l.push({start_index:n.start_index,end_index:n.end_index}),l.push({start_index:r.start_index,end_index:r.end_index}))}return i},t.warp=function(a,s,r,n){var i=a.data,l=s.data,o=a.width,d=a.height,c=0,h,m,x,b,y,N,C,w,D,I,M,R,A,v,p,F,H,_,z,T,K,ee,ie;for(A=t.getPerspectiveTransform(r,n-1),v=A[8],p=A[2],F=A[5],ee=0;ee<n;++ee)for(v+=A[7],p+=A[1],F+=A[4],H=v,_=p,z=F,ie=0;ie<n;++ie)H+=A[6],_+=A[0],z+=A[3],T=_/H,K=z/H,h=T>>>0,m=h===o-1?h:h+1,x=T-h,b=1-x,y=K>>>0,N=y===d-1?y:y+1,C=K-y,w=1-C,D=I=y*o,M=R=N*o,l[c++]=w*(b*i[D+h]+x*i[I+m])+C*(b*i[M+h]+x*i[R+m])&255;return s.width=n,s.height=n,s},t.getPerspectiveTransform=function(a,s){var r=t.square2quad(a);return r[0]/=s,r[1]/=s,r[3]/=s,r[4]/=s,r[6]/=s,r[7]/=s,r},t.square2quad=function(a){var s=[],r,n,i,l,o,d,c;return r=a[0].x-a[1].x+a[2].x-a[3].x,n=a[0].y-a[1].y+a[2].y-a[3].y,r===0&&n===0?(s[0]=a[1].x-a[0].x,s[1]=a[2].x-a[1].x,s[2]=a[0].x,s[3]=a[1].y-a[0].y,s[4]=a[2].y-a[1].y,s[5]=a[0].y,s[6]=0,s[7]=0,s[8]=1):(i=a[1].x-a[2].x,l=a[3].x-a[2].x,o=a[1].y-a[2].y,d=a[3].y-a[2].y,c=i*d-l*o,s[6]=(r*d-l*n)/c,s[7]=(i*n-r*o)/c,s[8]=1,s[0]=a[1].x-a[0].x+s[6]*a[1].x,s[1]=a[3].x-a[0].x+s[7]*a[3].x,s[2]=a[0].x,s[3]=a[1].y-a[0].y+s[6]*a[1].y,s[4]=a[3].y-a[0].y+s[7]*a[3].y,s[5]=a[0].y),s},t.isContourConvex=function(a){var s=0,r=!0,n=a.length,i=0,l=0,o,d,c,h,m,x,b,y;for(d=a[n-1],o=a[0],m=o.x-d.x,x=o.y-d.y;i<n;++i){if(++l===n&&(l=0),d=o,o=a[l],b=o.x-d.x,y=o.y-d.y,c=b*x,h=y*m,s|=h>c?1:h<c?2:3,s===3){r=!1;break}m=b,x=y}return r},t.perimeter=function(a){for(var s=a.length,r=0,n=s-1,i=0,l,o;r<s;n=r++)l=a[r].x-a[n].x,o=a[r].y-a[n].y,i+=Math.sqrt(l*l+o*o);return i},t.minEdgeLength=function(a){for(var s=a.length,r=0,n=s-1,i=1/0,l,o,d;r<s;n=r++)o=a[r].x-a[n].x,d=a[r].y-a[n].y,l=o*o+d*d,l<i&&(i=l);return Math.sqrt(i)},t.countNonZero=function(a,s){var r=a.data,n=s.height,i=s.width,l=s.x+s.y*a.width,o=a.width-i,d=0,c,h;for(c=0;c<n;++c){for(h=0;h<i;++h)r[l++]!==0&&++d;l+=o}return d},t.binaryBorder=function(a,s){var r=a.data,n=a.height,i=a.width,l=0,o=0,d,c;for(c=-2;c<i;++c)s[o++]=0;for(d=0;d<n;++d){for(s[o++]=0,c=0;c<i;++c)s[o++]=r[l++]===0?0:1;s[o++]=0}for(c=-2;c<i;++c)s[o++]=0;return s},fi=t,fi}var xi,hl;function Ru(){if(hl)return xi;hl=1;var t=sc(),a=a||{};return a.Marker=function(s,r){this.id=s,this.corners=r},a.Detector=function(){this.grey=new t.Image,this.thres=new t.Image,this.homography=new t.Image,this.binary=[],this.contours=[],this.polys=[],this.candidates=[]},a.Detector.prototype.detect=function(s){return t.grayscale(s,this.grey),t.adaptiveThreshold(this.grey,this.thres,2,7),this.contours=t.findContours(this.thres,this.binary),this.candidates=this.findCandidates(this.contours,s.width*.2,.05,10),this.candidates=this.clockwiseCorners(this.candidates),this.candidates=this.notTooNear(this.candidates,10),this.findMarkers(this.grey,this.candidates,49)},a.Detector.prototype.findCandidates=function(s,r,n,i){var l=[],o=s.length,d,c,h;for(this.polys=[],h=0;h<o;++h)d=s[h],d.length>=r&&(c=t.approxPolyDP(d,d.length*n),this.polys.push(c),c.length===4&&t.isContourConvex(c)&&t.minEdgeLength(c)>=i&&l.push(c));return l},a.Detector.prototype.clockwiseCorners=function(s){var r=s.length,n,i,l,o,d,c;for(c=0;c<r;++c)n=s[c][1].x-s[c][0].x,l=s[c][1].y-s[c][0].y,i=s[c][2].x-s[c][0].x,o=s[c][2].y-s[c][0].y,n*o-l*i<0&&(d=s[c][1],s[c][1]=s[c][3],s[c][3]=d);return s},a.Detector.prototype.notTooNear=function(s,r){var n=[],i=s.length,l,o,d,c,h,m;for(c=0;c<i;++c)for(h=c+1;h<i;++h){for(l=0,m=0;m<4;++m)o=s[c][m].x-s[h][m].x,d=s[c][m].y-s[h][m].y,l+=o*o+d*d;l/4<r*r&&(t.perimeter(s[c])<t.perimeter(s[h])?s[c].tooNear=!0:s[h].tooNear=!0)}for(c=0;c<i;++c)s[c].tooNear||n.push(s[c]);return n},a.Detector.prototype.findMarkers=function(s,r,n){var i=[],l=r.length,o,d,c;for(c=0;c<l;++c)o=r[c],t.warp(s,this.homography,o,n),t.threshold(this.homography,this.homography,t.otsu(this.homography)),d=this.getMarker(this.homography,o),d&&i.push(d);return i},a.Detector.prototype.getMarker=function(s,r){var n=s.width/7>>>0,i=n*n>>1,l=[],o=[],d=[],c,h,m,x,b;for(x=0;x<7;++x)for(m=x===0||x===6?1:6,b=0;b<7;b+=m)if(c={x:b*n,y:x*n,width:n,height:n},t.countNonZero(s,c)>i)return null;for(x=0;x<5;++x)for(l[x]=[],b=0;b<5;++b)c={x:(b+1)*n,y:(x+1)*n,width:n,height:n},l[x][b]=t.countNonZero(s,c)>i?1:0;for(o[0]=l,d[0]=this.hammingDistance(o[0]),h={first:d[0],second:0},x=1;x<4;++x)o[x]=this.rotate(o[x-1]),d[x]=this.hammingDistance(o[x]),d[x]<h.first&&(h.first=d[x],h.second=x);return h.first!==0?null:new a.Marker(this.mat2id(o[h.second]),this.rotate2(r,4-h.second))},a.Detector.prototype.hammingDistance=function(s){var r=[[1,0,0,0,0],[1,0,1,1,1],[0,1,0,0,1],[0,1,1,1,0]],n=0,i,l,o,d,c;for(o=0;o<5;++o){for(l=1/0,d=0;d<4;++d){for(i=0,c=0;c<5;++c)i+=s[o][c]===r[d][c]?0:1;i<l&&(l=i)}n+=l}return n},a.Detector.prototype.mat2id=function(s){var r=0,n;for(n=0;n<5;++n)r<<=1,r|=s[n][1],r<<=1,r|=s[n][3];return r},a.Detector.prototype.rotate=function(s){var r=[],n=s.length,i,l;for(i=0;i<n;++i)for(r[i]=[],l=0;l<s[i].length;++l)r[i][l]=s[s[i].length-l-1][i];return r},a.Detector.prototype.rotate2=function(s,r){var n=[],i=s.length,l;for(l=0;l<i;++l)n[l]=s[(r+l)%i];return n},xi=a,xi}var pi,fl;function Xi(){if(fl)return pi;fl=1;var t=t||{};return t.svdcmp=function(a,s,r,n,i){var l,o,d,c,h,m,x,b,y=0,N,C,w=0,D,I,M=0,R,A,v,p=[];for(o=0;o<r;++o){if(x=o+1,p[o]=M*w,w=I=M=0,o<s){for(m=o;m<s;++m)M+=Math.abs(a[m][o]);if(M!==0){for(m=o;m<s;++m)a[m][o]/=M,I+=a[m][o]*a[m][o];for(C=a[o][o],w=-t.sign(Math.sqrt(I),C),D=C*w-I,a[o][o]=C-w,c=x;c<r;++c){for(I=0,m=o;m<s;++m)I+=a[m][o]*a[m][c];for(C=I/D,m=o;m<s;++m)a[m][c]+=C*a[m][o]}for(m=o;m<s;++m)a[m][o]*=M}}if(n[o]=M*w,w=I=M=0,o<s&&o!==r-1){for(m=x;m<r;++m)M+=Math.abs(a[o][m]);if(M!==0){for(m=x;m<r;++m)a[o][m]/=M,I+=a[o][m]*a[o][m];for(C=a[o][x],w=-t.sign(Math.sqrt(I),C),D=C*w-I,a[o][x]=C-w,m=x;m<r;++m)p[m]=a[o][m]/D;for(c=x;c<s;++c){for(I=0,m=x;m<r;++m)I+=a[c][m]*a[o][m];for(m=x;m<r;++m)a[c][m]+=I*p[m]}for(m=x;m<r;++m)a[o][m]*=M}}y=Math.max(y,Math.abs(n[o])+Math.abs(p[o]))}for(o=r-1;o>=0;--o){if(o<r-1){if(w!==0){for(c=x;c<r;++c)i[c][o]=a[o][c]/a[o][x]/w;for(c=x;c<r;++c){for(I=0,m=x;m<r;++m)I+=a[o][m]*i[m][c];for(m=x;m<r;++m)i[m][c]+=I*i[m][o]}}for(c=x;c<r;++c)i[o][c]=i[c][o]=0}i[o][o]=1,w=p[o],x=o}for(o=Math.min(r,s)-1;o>=0;--o){for(x=o+1,w=n[o],c=x;c<r;++c)a[o][c]=0;if(w!==0){for(w=1/w,c=x;c<r;++c){for(I=0,m=x;m<s;++m)I+=a[m][o]*a[m][c];for(C=I/a[o][o]*w,m=o;m<s;++m)a[m][c]+=C*a[m][o]}for(c=o;c<s;++c)a[c][o]*=w}else for(c=o;c<s;++c)a[c][o]=0;++a[o][o]}for(m=r-1;m>=0;--m)for(d=1;d<=30;++d){for(l=!0,x=m;x>=0;--x){if(b=x-1,Math.abs(p[x])+y===y){l=!1;break}if(Math.abs(n[b])+y===y)break}if(l)for(N=0,I=1,o=x;o<=m&&(C=I*p[o],Math.abs(C)+y!==y);++o)for(w=n[o],D=t.pythag(C,w),n[o]=D,D=1/D,N=w*D,I=-C*D,c=1;c<=s;++c)A=a[c][b],v=a[c][o],a[c][b]=A*N+v*I,a[c][o]=v*N-A*I;if(v=n[m],x===m){if(v<0)for(n[m]=-v,c=0;c<r;++c)i[c][m]=-i[c][m];break}if(d===30)return!1;for(R=n[x],b=m-1,A=n[b],w=p[b],D=p[m],C=((A-v)*(A+v)+(w-D)*(w+D))/(2*D*A),w=t.pythag(C,1),C=((R-v)*(R+v)+D*(A/(C+t.sign(w,C))-D))/R,N=I=1,c=x;c<=b;++c){for(o=c+1,w=p[o],A=n[o],D=I*w,w=N*w,v=t.pythag(C,D),p[c]=v,N=C/v,I=D/v,C=R*N+w*I,w=w*N-R*I,D=A*I,A*=N,h=0;h<r;++h)R=i[h][c],v=i[h][o],i[h][c]=R*N+v*I,i[h][o]=v*N-R*I;for(v=t.pythag(C,D),n[c]=v,v!==0&&(v=1/v,N=C*v,I=D*v),C=N*w+I*A,R=N*A-I*w,h=0;h<s;++h)A=a[h][c],v=a[h][o],a[h][c]=A*N+v*I,a[h][o]=v*N-A*I}p[x]=0,p[m]=C,n[m]=R}return!0},t.pythag=function(a,s){var r=Math.abs(a),n=Math.abs(s),i;return r>n?(i=n/r,r*Math.sqrt(1+i*i)):n===0?0:(i=r/n,n*Math.sqrt(1+i*i))},t.sign=function(a,s){return s>=0?Math.abs(a):-Math.abs(a)},pi=t,pi}var bi,xl;function Pu(){if(xl)return bi;xl=1;var t=Xi(),a=a||{};return a.Posit=function(s,r){this.objectPoints=this.buildModel(s),this.focalLength=r,this.objectVectors=[],this.objectNormal=[],this.objectMatrix=[[],[],[]],this.init()},a.Posit.prototype.buildModel=function(s){var r=s/2;return[[-r,r,0],[r,r,0],[r,-r,0],[-r,-r,0]]},a.Posit.prototype.init=function(){var s=this.objectPoints.length,r=[],n=[],i=0,l=2,o;for(o=0;o<s;++o)this.objectVectors[o]=[this.objectPoints[o][0]-this.objectPoints[0][0],this.objectPoints[o][1]-this.objectPoints[0][1],this.objectPoints[o][2]-this.objectPoints[0][2]],r[o]=[this.objectVectors[o][0],this.objectVectors[o][1],this.objectVectors[o][2]];for(;i===0;)n[0]=this.objectVectors[1][1]*this.objectVectors[l][2]-this.objectVectors[1][2]*this.objectVectors[l][1],n[1]=this.objectVectors[1][2]*this.objectVectors[l][0]-this.objectVectors[1][0]*this.objectVectors[l][2],n[2]=this.objectVectors[1][0]*this.objectVectors[l][1]-this.objectVectors[1][1]*this.objectVectors[l][0],i=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),++l;for(o=0;o<3;++o)this.objectNormal[o]=n[o]/i;a.pseudoInverse(r,s,this.objectMatrix)},a.Posit.prototype.pose=function(s){var r=[[],[],[]],n=[[],[],[]],i=[],l=[[],[],[]],o=[[],[],[]],d=[],c=[],h,m,x,b,y,N;for(this.pos(s,r,n,i),x=this.isValid(r,i),x?h=this.iterate(s,r,i,l,d):h={euclidean:-1,pixels:-1,maximum:-1},b=this.isValid(n,i),b?m=this.iterate(s,n,i,o,c):m={euclidean:-1,pixels:-1,maximum:-1},y=0;y<3;++y)for(N=0;N<3;++N)x&&(d[y]-=l[y][N]*this.objectPoints[0][N]),b&&(c[y]-=o[y][N]*this.objectPoints[0][N]);return h.euclidean<m.euclidean?new a.Pose(h.pixels,l,d,m.pixels,o,c):new a.Pose(m.pixels,o,c,h.pixels,l,d)},a.Posit.prototype.pos=function(s,r,n,i){var l=this.objectPoints.length,o=[],d=[],c=[],h=[],m=[],x=[],b=[],y=[],N,C,w,D,I,M,R,A,v,p;for(v=0;v<l;++v)o[v]=[s[v].x-s[0].x,s[v].y-s[0].y];for(v=0;v<3;++v)for(d[v]=0,c[v]=0,p=0;p<l;++p)d[v]+=this.objectMatrix[v][p]*o[p][0],c[v]+=this.objectMatrix[v][p]*o[p][1];for(N=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],C=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],w=d[0]*c[0]+d[1]*c[1]+d[2]*c[2],D=(C-N)*(C-N)+4*(w*w),C-N>=0?I=(C-N+Math.sqrt(D))/2:I=(C-N-Math.sqrt(D))/2,I>=0?(M=Math.sqrt(I),M===0?R=0:R=-w/M):(M=Math.sqrt(-(w*w)/I),M===0?R=Math.sqrt(N-C):R=-w/M),v=0;v<3;++v)h[v]=d[v]+M*this.objectNormal[v],m[v]=c[v]+R*this.objectNormal[v];for(A=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),v=0;v<3;++v)x[v]=h[v]/A,b[v]=m[v]/A;for(y[0]=x[1]*b[2]-x[2]*b[1],y[1]=x[2]*b[0]-x[0]*b[2],y[2]=x[0]*b[1]-x[1]*b[0],v=0;v<3;++v)r[0][v]=x[v],r[1][v]=b[v],r[2][v]=y[v];for(v=0;v<3;++v)h[v]=d[v]-M*this.objectNormal[v],m[v]=c[v]-R*this.objectNormal[v];for(v=0;v<3;++v)x[v]=h[v]/A,b[v]=m[v]/A;for(y[0]=x[1]*b[2]-x[2]*b[1],y[1]=x[2]*b[0]-x[0]*b[2],y[2]=x[0]*b[1]-x[1]*b[0],v=0;v<3;++v)n[0][v]=x[v],n[1][v]=b[v],n[2][v]=y[v];i[0]=s[0].x/A,i[1]=s[0].y/A,i[2]=this.focalLength/A},a.Posit.prototype.isValid=function(s,r){for(var n=this.objectPoints.length,i=1/0,l=0,o;l<n;++l)o=r[2]+(s[2][0]*this.objectVectors[l][0]+s[2][1]*this.objectVectors[l][1]+s[2][2]*this.objectVectors[l][2]),o<i&&(i=o);return i>=0},a.Posit.prototype.iterate=function(s,r,n,i,l){var o=this.objectPoints.length,d=[],c=[],h=[[],[],[]],m=[[],[],[]],x=[],b=[],y=!1,N=0,C,w,D,I,M,R,A,v,p;for(v=0;v<o;++v)d[v]={x:s[v].x,y:s[v].y};for(v=0;v<3;++v){for(p=0;p<3;++p)i[v][p]=r[v][p];l[v]=n[v]}for(v=0;v<o;++v){for(D=0,p=0;p<3;++p)D+=this.objectVectors[v][p]*i[2][p]/l[2];c[v]={x:(1+D)*s[v].x,y:(1+D)*s[v].y}}for(w=0,v=0;v<o;++v)w+=Math.abs(c[v].x-d[v].x),w+=Math.abs(c[v].y-d[v].y);for(v=0;v<3;++v)x[v]=l[v]-(i[v][0]*this.objectPoints[0][0]+i[v][1]*this.objectPoints[0][1]+i[v][2]*this.objectPoints[0][2]);for(I=M=this.error(s,i,x),y=M.pixels===0||w<.01;N++<100&&!y;){for(v=0;v<o;++v)d[v].x=c[v].x,d[v].y=c[v].y;for(this.pos(c,h,m,l),v=0;v<3;++v)x[v]=l[v]-(h[v][0]*this.objectPoints[0][0]+h[v][1]*this.objectPoints[0][1]+h[v][2]*this.objectPoints[0][2]),b[v]=l[v]-(m[v][0]*this.objectPoints[0][0]+m[v][1]*this.objectPoints[0][1]+m[v][2]*this.objectPoints[0][2]);if(M=this.error(s,h,x),R=this.error(s,m,b),M.euclidean>=0&&R.euclidean>=0)if(R.euclidean<M.euclidean)for(I=R,v=0;v<3;++v)for(p=0;p<3;++p)i[v][p]=m[v][p];else for(I=M,v=0;v<3;++v)for(p=0;p<3;++p)i[v][p]=h[v][p];if(M.euclidean<0&&R.euclidean>=0)for(I=R,v=0;v<3;++v)for(p=0;p<3;++p)i[v][p]=m[v][p];if(R.euclidean<0&&M.euclidean>=0)for(I=M,v=0;v<3;++v)for(p=0;p<3;++p)i[v][p]=h[v][p];for(v=0;v<o;++v){for(D=0,p=0;p<3;++p)D+=this.objectVectors[v][p]*i[2][p]/l[2];c[v].x=(1+D)*s[v].x,c[v].y=(1+D)*s[v].y}for(C=w,w=0,v=0;v<o;++v)w+=Math.abs(c[v].x-d[v].x),w+=Math.abs(c[v].y-d[v].y);A=Math.abs(w-C),y=I.pixels===0||A<.01}return I},a.Posit.prototype.error=function(s,r,n){var i=this.objectPoints.length,l=[],o=[],d=[],c=0,h=0,m=0,x,b,y;if(!this.isValid(r,n))return{euclidean:-1,pixels:-1,maximum:-1};for(x=0;x<i;++x)for(l[x]=[],b=0;b<3;++b)l[x][b]=n[b];for(x=0;x<i;++x)for(b=0;b<3;++b)for(y=0;y<3;++y)l[x][b]+=r[b][y]*this.objectPoints[x][y];for(x=0;x<i;++x)for(o[x]=[],b=0;b<2;++b)o[x][b]=this.focalLength*l[x][b]/l[x][2];for(x=0;x<i;++x)d[x]=[o[x][0]-s[x].x,o[x][1]-s[x].y];for(x=0;x<i;++x)c+=Math.sqrt(d[x][0]*d[x][0]+d[x][1]*d[x][1]),h+=Math.abs(Math.round(o[x][0])-Math.round(s[x].x))+Math.abs(Math.round(o[x][1])-Math.round(s[x].y)),Math.abs(d[x][0])>m&&(m=Math.abs(d[x][0])),Math.abs(d[x][1])>m&&(m=Math.abs(d[x][1]));return{euclidean:c/i,pixels:h,maximum:m}},a.pseudoInverse=function(s,r,n){var i=[],l=[[],[],[]],o=[[],[],[]],d=0,c=0,h,m,x;for(t.svdcmp(s,r,3,i,l),h=0;h<3;++h)i[h]>d&&(d=i[h]);for(d*=.01,h=0;h<3;++h)i[h]<d&&(i[h]=0);for(m=0;m<3;++m)if(i[m]===0)for(++c,x=m;x<2;++x){for(h=0;h<r;++h)s[h][x]=s[h][x+1];for(h=0;h<3;++h)l[h][x]=l[h][x+1]}for(m=0;m<2;++m)i[m]===0&&(i[m]=i[m+1]);for(h=0;h<3;++h)for(m=0;m<3-c;++m)o[h][m]=l[h][m]/i[m];for(h=0;h<3;++h)for(m=0;m<r;++m)for(n[h][m]=0,x=0;x<3-c;++x)n[h][m]+=o[h][x]*s[m][x]},a.Pose=function(s,r,n,i,l,o){this.bestError=s,this.bestRotation=r,this.bestTranslation=n,this.alternativeError=i,this.alternativeRotation=l,this.alternativeTranslation=o},bi=a,bi}var gi,pl;function Lu(){if(pl)return gi;pl=1;var t=Xi(),a=a||{};a.Posit=function(n,i){this.model=this.buildModel(n),this.focalLength=i,this.init()},a.Posit.prototype.buildModel=function(n){var i=n/2;return[new s(-i,i,0),new s(i,i,0),new s(i,-i,0),new s(-i,-i,0)]},a.Posit.prototype.init=function(){var n=new s,i=new r,l;this.modelVectors=r.fromRows(s.sub(this.model[1],this.model[0]),s.sub(this.model[2],this.model[0]),s.sub(this.model[3],this.model[0])),l=r.clone(this.modelVectors),t.svdcmp(l.m,3,3,n.v,i.m),this.modelPseudoInverse=r.mult(r.mult(i,r.fromDiagonal(s.inverse(n))),r.transpose(l)),this.modelNormal=i.column(n.minIndex())},a.Posit.prototype.pose=function(n){var i=new s(1,1,1),l=new r,o=new r,d=new s,c=new s,h,m;return this.pos(n,i,l,o,d,c),h=this.iterate(n,l,d),m=this.iterate(n,o,c),h<m?new a.Pose(h,l.m,d.v,m,o.m,c.v):new a.Pose(m,o.m,c.v,h,l.m,d.v)},a.Posit.prototype.pos=function(n,i,l,o,d,c){var h=new s(n[1].x,n[2].x,n[3].x),m=new s(n[1].y,n[2].y,n[3].y),x=s.addScalar(s.mult(h,i),-n[0].x),b=s.addScalar(s.mult(m,i),-n[0].y),y=r.multVector(this.modelPseudoInverse,x),N=r.multVector(this.modelPseudoInverse,b),C=N.square()-y.square(),w=s.dot(y,N),D=0,I=0,M,R,A,v,p,F,H,_,z;C===0?(D=Math.sqrt(Math.abs(2*w)),I=-Math.PI/2*(w<0?-1:w>0?1:0)):(D=Math.sqrt(Math.sqrt(C*C+4*w*w)),I=Math.atan(-2*w/C),C<0&&(I+=Math.PI),I/=2),_=D*Math.cos(I),z=D*Math.sin(I),M=s.add(y,s.multScalar(this.modelNormal,_)),R=s.add(N,s.multScalar(this.modelNormal,z)),v=M.normalize(),p=R.normalize(),A=s.cross(M,R),l.copy(r.fromRows(M,R,A)),F=(v+p)/2,H=r.multVector(l,this.model[0]),d.v=[n[0].x/F-H.v[0],n[0].y/F-H.v[1],this.focalLength/F],M=s.sub(y,s.multScalar(this.modelNormal,_)),R=s.sub(N,s.multScalar(this.modelNormal,z)),v=M.normalize(),p=R.normalize(),A=s.cross(M,R),o.copy(r.fromRows(M,R,A)),F=(v+p)/2,H=r.multVector(o,this.model[0]),c.v=[n[0].x/F-H.v[0],n[0].y/F-H.v[1],this.focalLength/F]},a.Posit.prototype.iterate=function(n,i,l){for(var o=1/0,d=new r,c=new r,h=new s,m=new s,x=0,b,y,N,C;x<100&&(b=s.addScalar(s.multScalar(r.multVector(this.modelVectors,i.row(2)),1/l.v[2]),1),this.pos(n,b,d,c,h,m),N=this.getError(n,d,h),C=this.getError(n,c,m),N<C?(i.copy(d),l.copy(h),y=N):(i.copy(c),l.copy(m),y=C),!(y<=2||y>o));++x)o=y;return y},a.Posit.prototype.getError=function(n,i,l){var o=s.add(r.multVector(i,this.model[0]),l),d=s.add(r.multVector(i,this.model[1]),l),c=s.add(r.multVector(i,this.model[2]),l),h=s.add(r.multVector(i,this.model[3]),l),m,x,b,y,N,C,w,D,I;return o=o.v,d=d.v,c=c.v,h=h.v,o[0]*=this.focalLength/o[2],o[1]*=this.focalLength/o[2],d[0]*=this.focalLength/d[2],d[1]*=this.focalLength/d[2],c[0]*=this.focalLength/c[2],c[1]*=this.focalLength/c[2],h[0]*=this.focalLength/h[2],h[1]*=this.focalLength/h[2],m=[{x:o[0],y:o[1]},{x:d[0],y:d[1]},{x:c[0],y:c[1]},{x:h[0],y:h[1]}],x=this.angle(n[0],n[1],n[3]),b=this.angle(n[1],n[2],n[0]),y=this.angle(n[2],n[3],n[1]),N=this.angle(n[3],n[0],n[2]),C=this.angle(m[0],m[1],m[3]),w=this.angle(m[1],m[2],m[0]),D=this.angle(m[2],m[3],m[1]),I=this.angle(m[3],m[0],m[2]),(Math.abs(x-C)+Math.abs(b-w)+Math.abs(y-D)+Math.abs(N-I))/4},a.Posit.prototype.angle=function(n,i,l){var o=i.x-n.x,d=i.y-n.y,c=l.x-n.x,h=l.y-n.y;return Math.acos((o*c+d*h)/(Math.sqrt(o*o+d*d)*Math.sqrt(c*c+h*h)))*180/Math.PI},a.Pose=function(n,i,l,o,d,c){this.bestError=n,this.bestRotation=i,this.bestTranslation=l,this.alternativeError=o,this.alternativeRotation=d,this.alternativeTranslation=c};var s=function(n,i,l){this.v=[n||0,i||0,l||0]};s.prototype.copy=function(n){var i=this.v;return n=n.v,i[0]=n[0],i[1]=n[1],i[2]=n[2],this},s.add=function(n,i){var l=new s,o=l.v;return n=n.v,i=i.v,o[0]=n[0]+i[0],o[1]=n[1]+i[1],o[2]=n[2]+i[2],l},s.sub=function(n,i){var l=new s,o=l.v;return n=n.v,i=i.v,o[0]=n[0]-i[0],o[1]=n[1]-i[1],o[2]=n[2]-i[2],l},s.mult=function(n,i){var l=new s,o=l.v;return n=n.v,i=i.v,o[0]=n[0]*i[0],o[1]=n[1]*i[1],o[2]=n[2]*i[2],l},s.addScalar=function(n,i){var l=new s,o=l.v;return n=n.v,o[0]=n[0]+i,o[1]=n[1]+i,o[2]=n[2]+i,l},s.multScalar=function(n,i){var l=new s,o=l.v;return n=n.v,o[0]=n[0]*i,o[1]=n[1]*i,o[2]=n[2]*i,l},s.dot=function(n,i){return n=n.v,i=i.v,n[0]*i[0]+n[1]*i[1]+n[2]*i[2]},s.cross=function(n,i){return n=n.v,i=i.v,new s(n[1]*i[2]-n[2]*i[1],n[2]*i[0]-n[0]*i[2],n[0]*i[1]-n[1]*i[0])},s.prototype.normalize=function(){var n=this.v,i=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return i>0&&(n[0]/=i,n[1]/=i,n[2]/=i),i},s.inverse=function(n){var i=new s,l=i.v;return n=n.v,n[0]!==0&&(l[0]=1/n[0]),n[1]!==0&&(l[1]=1/n[1]),n[2]!==0&&(l[2]=1/n[2]),i},s.prototype.square=function(){var n=this.v;return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},s.prototype.minIndex=function(){var n=this.v;return n[0]<n[1]?n[0]<n[2]?0:2:n[1]<n[2]?1:2};var r=function(){this.m=[[0,0,0],[0,0,0],[0,0,0]]};return r.clone=function(n){var i=new r,l=i.m;return n=n.m,l[0][0]=n[0][0],l[0][1]=n[0][1],l[0][2]=n[0][2],l[1][0]=n[1][0],l[1][1]=n[1][1],l[1][2]=n[1][2],l[2][0]=n[2][0],l[2][1]=n[2][1],l[2][2]=n[2][2],i},r.prototype.copy=function(n){var i=this.m;return n=n.m,i[0][0]=n[0][0],i[0][1]=n[0][1],i[0][2]=n[0][2],i[1][0]=n[1][0],i[1][1]=n[1][1],i[1][2]=n[1][2],i[2][0]=n[2][0],i[2][1]=n[2][1],i[2][2]=n[2][2],this},r.fromRows=function(n,i,l){var o=new r,d=o.m;return n=n.v,i=i.v,l=l.v,d[0][0]=n[0],d[0][1]=n[1],d[0][2]=n[2],d[1][0]=i[0],d[1][1]=i[1],d[1][2]=i[2],d[2][0]=l[0],d[2][1]=l[1],d[2][2]=l[2],o},r.fromDiagonal=function(n){var i=new r,l=i.m;return n=n.v,l[0][0]=n[0],l[1][1]=n[1],l[2][2]=n[2],i},r.transpose=function(n){var i=new r,l=i.m;return n=n.m,l[0][0]=n[0][0],l[0][1]=n[1][0],l[0][2]=n[2][0],l[1][0]=n[0][1],l[1][1]=n[1][1],l[1][2]=n[2][1],l[2][0]=n[0][2],l[2][1]=n[1][2],l[2][2]=n[2][2],i},r.mult=function(n,i){var l=new r,o=l.m;return n=n.m,i=i.m,o[0][0]=n[0][0]*i[0][0]+n[0][1]*i[1][0]+n[0][2]*i[2][0],o[0][1]=n[0][0]*i[0][1]+n[0][1]*i[1][1]+n[0][2]*i[2][1],o[0][2]=n[0][0]*i[0][2]+n[0][1]*i[1][2]+n[0][2]*i[2][2],o[1][0]=n[1][0]*i[0][0]+n[1][1]*i[1][0]+n[1][2]*i[2][0],o[1][1]=n[1][0]*i[0][1]+n[1][1]*i[1][1]+n[1][2]*i[2][1],o[1][2]=n[1][0]*i[0][2]+n[1][1]*i[1][2]+n[1][2]*i[2][2],o[2][0]=n[2][0]*i[0][0]+n[2][1]*i[1][0]+n[2][2]*i[2][0],o[2][1]=n[2][0]*i[0][1]+n[2][1]*i[1][1]+n[2][2]*i[2][1],o[2][2]=n[2][0]*i[0][2]+n[2][1]*i[1][2]+n[2][2]*i[2][2],l},r.multVector=function(n,i){return n=n.m,i=i.v,new s(n[0][0]*i[0]+n[0][1]*i[1]+n[0][2]*i[2],n[1][0]*i[0]+n[1][1]*i[1]+n[1][2]*i[2],n[2][0]*i[0]+n[2][1]*i[1]+n[2][2]*i[2])},r.prototype.column=function(n){var i=this.m;return new s(i[0][n],i[1][n],i[2][n])},r.prototype.row=function(n){var i=this.m;return new s(i[n][0],i[n][1],i[n][2])},gi=a,gi}var yi,bl;function Ou(){return bl||(bl=1,yi={CV:sc(),AR:Ru(),SVD:Xi(),POS1:Pu(),POS2:Lu()}),yi}var Bu=Ou();const Jn={top:0,right:1,bottom:2,left:3};let vi=null;function Uu(){return vi||(vi=new Bu.AR.Detector),vi}function $u(t){const a=t.reduce((r,n)=>({x:r.x+n.x,y:r.y+n.y}),{x:0,y:0}),s=t.length||1;return{x:a.x/s,y:a.y/s}}function Fu(t){try{const s=Uu().detect(t)||[],r={},n=[];for(const m of s){const x=$u(m.corners);n.push({id:m.id,center:x});const b=Object.keys(Jn).find(y=>Jn[y]===m.id);b&&(r[b]={id:m.id,center:x})}const i=Object.keys(Jn).filter(m=>!r[m]);if(i.length>0)return{success:!1,points:[],missing:i,markersFound:n,assignments:r,homography:null,errorPx:null,message:n.length>0?`Detected ${n.length} of 4 markers. Some markers may have incorrect IDs or be unclear.`:"Not all calibration markers were detected."};const l=[r.top.center,r.right.center,r.bottom.center,r.left.center],d=ba().slice(0,4),c=ir(d,l),h=or(c,d,l);return{success:!0,points:l,missing:[],markersFound:n,assignments:r,homography:c,errorPx:h}}catch(a){return{success:!1,points:[],missing:Object.keys(Jn),markersFound:[],assignments:{},homography:null,errorPx:null,message:a instanceof Error?a.message:"Marker detection failed"}}}function _u(t){const a=t.getContext("2d");if(!a)return{success:!1,points:[],missing:Object.keys(Jn),markersFound:[],assignments:{},homography:null,errorPx:null,message:"Canvas context unavailable for marker detection."};const s=i=>Fu(i);let r=a.getImageData(0,0,t.width,t.height),n=s(r);if(n.success||(n.markersFound?.length||0)>0)return n;try{const l=document.createElement("canvas");l.width=Math.round(t.width*1.75),l.height=Math.round(t.height*1.75);const o=l.getContext("2d");if(o.imageSmoothingEnabled=!1,o.drawImage(t,0,0,l.width,l.height),r=o.getImageData(0,0,l.width,l.height),n=s(r),n.success||(n.markersFound?.length||0)>0)return n}catch{}try{const i=t.width,l=t.height,o=a.getImageData(0,0,i,l),d=o.data;let c=255,h=0;for(let x=0;x<d.length;x+=4){const b=.2126*d[x]+.7152*d[x+1]+.0722*d[x+2];b<c&&(c=b),b>h&&(h=b)}const m=Math.max(1,h-c);for(let x=0;x<d.length;x+=4){const b=.2126*d[x]+.7152*d[x+1]+.0722*d[x+2],y=Math.max(0,Math.min(255,(b-c)*255/m));d[x]=d[x+1]=d[x+2]=y}if(n=s(o),n.success||(n.markersFound?.length||0)>0)return n}catch{}try{const i=t.width,l=t.height,o=a.getImageData(0,0,i,l),d=o.data;let c=0,h=0;for(let x=0;x<d.length;x+=4){const b=.2126*d[x]+.7152*d[x+1]+.0722*d[x+2];c+=b,h++}const m=c/h;for(let x=0;x<d.length;x+=4){const y=.2126*d[x]+.7152*d[x+1]+.0722*d[x+2]>m?255:0;d[x]=d[x+1]=d[x+2]=y}if(n=s(o),n.success||(n.markersFound?.length||0)>0)return n}catch{}return{success:!1,points:[],missing:Object.keys(Jn),markersFound:n.markersFound||[],assignments:n.assignments||{},homography:null,errorPx:null,message:n.message||"No calibration markers detected. Ensure you are using the provided TOP/RIGHT/BOTTOM/LEFT ArUco markers printed at 100% on white paper."}}const Hu={"0,0":[1,0,0,0,0],"0,1":[1,0,1,1,1],"1,0":[0,1,0,0,1],"1,1":[0,1,1,1,0]};function Wu(t){const a=new Array(5);let s=t>>>0;for(let n=4;n>=0;n--){const i=s&1;s>>=1;const l=s&1;s>>=1;const o=Hu[`${l},${i}`];if(!o)throw new Error(`Unsupported marker id pattern for row ${n}`);a[n]=o.slice()}const r=Array.from({length:7},()=>new Array(7).fill(0));for(let n=0;n<5;n++)for(let i=0;i<5;i++)r[n+1][i+1]=a[n][i];return r}function qu(t){const a=t.getContext("2d");if(!a)return null;const s=t.width,r=t.height,i=a.getImageData(0,0,s,r).data,l=[];for(let N=2;N<r-2;N++)for(let C=2;C<s-2;C++){let w=0,D=0;for(let M=-1;M<=1;M++)for(let R=-1;R<=1;R++){const A=((N+M)*s+(C+R))*4,v=i[A]*.299+i[A+1]*.587+i[A+2]*.114;R!==0&&(w+=(R>0?1:-1)*v),M!==0&&(D+=(M>0?1:-1)*v)}const I=Math.hypot(w,D);I>20&&l.push({x:C,y:N,mag:I})}if(l.length===0)return null;let o=null,d=0;for(let N=r*.3;N<r*.7;N+=10)for(let C=s*.3;C<s*.7;C+=10){let w=0,D=0;const I=[15,30,150,162,180,205];for(const M of I){let R=0,A=0;for(const v of l){const p=Math.hypot(v.x-C,v.y-N);Math.abs(p-M)<3&&(R+=v.mag,A++)}A>10&&R>500&&(w++,D+=R)}w>=4&&D>d&&(d=D,o={cx:C,cy:N})}if(!o)return null;const c=o.cx,h=o.cy;let m=170,x=0;for(let N=120;N<=250;N+=5){let C=0,w=0;for(const D of l){const I=Math.hypot(D.x-c,D.y-h);Math.abs(I-N)<2&&(C+=D.mag,w++)}w>20&&C>x&&(x=C,m=N)}let b=0;const y=m/pe.doubleOuter;for(const N of[pe.bullInner,pe.bullOuter,pe.trebleInner,pe.trebleOuter,pe.doubleInner,pe.doubleOuter]){const C=N*y;for(const w of l){const D=Math.hypot(w.x-c,w.y-h);if(Math.abs(D-C)<3){b+=15;break}}}return b=Math.min(100,b),{cx:c,cy:h,r:m,confidence:b}}function zu(t){try{const a=t.width,s=t.height,r=a/2,n=s/2,i=qu(t);if(!i)return{success:!1,cx:r,cy:n,bullInner:0,bullOuter:0,trebleInner:0,trebleOuter:0,doubleInner:0,doubleOuter:0,confidence:0,homography:null,errorPx:null,calibrationPoints:[],message:"No dartboard detected. Ensure board is clearly visible with good contrast between rings and background."};const l=i.r/pe.doubleOuter,o={cx:i.cx,cy:i.cy,bullInner:pe.bullInner*l,bullOuter:pe.bullOuter*l,trebleInner:pe.trebleInner*l,trebleOuter:pe.trebleOuter*l,doubleInner:pe.doubleInner*l,doubleOuter:i.r},d=[{x:o.cx,y:o.cy-o.doubleOuter},{x:o.cx+o.doubleOuter,y:o.cy},{x:o.cx,y:o.cy+o.doubleOuter},{x:o.cx-o.doubleOuter,y:o.cy}],c=[{x:0,y:-pe.doubleOuter},{x:pe.doubleOuter,y:0},{x:0,y:pe.doubleOuter},{x:-pe.doubleOuter,y:0}];let h=null,m=null,x=i.confidence;try{h=ir(c,d),m=or(h,c,d);const b=Math.max(10,Math.min(95,100-Math.max(0,m-1)*10));x=(x+b)/2}catch{x=Math.max(40,x)}return{success:!!h&&x>50,cx:o.cx,cy:o.cy,bullInner:o.bullInner,bullOuter:o.bullOuter,trebleInner:o.trebleInner,trebleOuter:o.trebleOuter,doubleInner:o.doubleInner,doubleOuter:o.doubleOuter,confidence:x,homography:h,errorPx:m,calibrationPoints:d,message:x>80?"âœ… High confidence detection":x>50?"âš ï¸ Detection found but could be better":"âŒ Low confidence - try better lighting"}}catch(a){return{success:!1,cx:t.width/2,cy:t.height/2,bullInner:0,bullOuter:0,trebleInner:0,trebleOuter:0,doubleInner:0,doubleOuter:0,confidence:0,homography:null,errorPx:null,calibrationPoints:[],message:a instanceof Error?a.message:"Board detection failed"}}}function Vu(t){if(t.confidence>70)return t;const a={bullInner_to_bullOuter:pe.bullInner/pe.bullOuter,bullOuter_to_trebleInner:pe.bullOuter/pe.trebleInner,trebleOuter_to_doubleInner:pe.trebleOuter/pe.doubleInner,doubleInner_to_doubleOuter:pe.doubleInner/pe.doubleOuter},s={bullInner_to_bullOuter:t.bullInner/t.bullOuter,bullOuter_to_trebleInner:t.bullOuter/t.trebleInner,trebleOuter_to_doubleInner:t.trebleOuter/t.doubleInner,doubleInner_to_doubleOuter:t.doubleInner/t.doubleOuter};let r=0,n=0;for(const[o,d]of Object.entries(a)){const c=s[o],h=Math.abs(c-d)/d;r+=h,n++}const i=r/n,l=Math.max(10,t.confidence-i*100);return{...t,confidence:l,message:l>70?"âœ… High confidence detection":l>50?"âš ï¸ Rings detected but ratios off - may need refinement":"âŒ Low confidence - try repositioning camera"}}async function nc(){const t=[];try{const a=await Gu();for(const s of a){const r=await Ku(s,[80,8080,8787,8788,3e3,5e3]);for(const n of r){const i=await Xu(n.ip,n.port);i&&t.push(i)}}}catch(a){console.error("Network discovery failed:",a)}return t}async function Gu(){const t=[];try{const a=new RTCPeerConnection({iceServers:[]});a.createDataChannel("");const s=await a.createOffer();return await a.setLocalDescription(s),new Promise(r=>{const n=setTimeout(()=>{a.close(),r(t)},5e3);a.onicecandidate=i=>{if(i.candidate){const o=i.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(o&&o[1]&&!t.includes(o[1])){const d=o[1];Ju(d)&&t.push(d)}}else clearTimeout(n),a.close(),r(t)}})}catch(a){return console.error("Failed to get local IPs:",a),["192.168.1.0"]}}function Ju(t){const a=t.split(".").map(Number);return a[0]===10||a[0]===172&&a[1]>=16&&a[1]<=31||a[0]===192&&a[1]===168}async function Ku(t,a){const s=[],r=t.split(".").slice(0,3).join("."),n=[];for(let l=1;l<=254;l++){const o=`${r}.${l}`;for(const d of a)n.push(Yu(o,d))}return(await Promise.allSettled(n)).forEach((l,o)=>{if(l.status==="fulfilled"&&l.value){const d=o%a.length,c=Math.floor(o/a.length),h=`${r}.${c+1}`;s.push({ip:h,port:a[d]})}}),s}async function Yu(t,a){try{const s=await fetch(`http://${t}:${a}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(2e3)});return!0}catch{return!1}}async function Xu(t,a){try{const s=["/","/api/info","/api/status","/camera","/stream"];for(const r of s)try{const n=await fetch(`http://${t}:${a}${r}`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(n.ok){const i=n.headers.get("content-type")||"",l=await n.text();if(l.includes("OMNI")||l.includes("omni")||r.includes("omni"))return{id:`omni-${t}-${a}`,name:`OMNI Camera (${t})`,ip:t,port:a,type:"omni",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(l.includes("VERT")||l.includes("vert")||r.includes("vert"))return{id:`vert-${t}-${a}`,name:`VERT Camera (${t})`,ip:t,port:a,type:"vert",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(i.includes("video")||l.includes("stream")||r==="/stream")return{id:`generic-${t}-${a}`,name:`Network Camera (${t})`,ip:t,port:a,type:"generic",capabilities:["video"],status:"online",connectionType:"wifi"}}}catch{}}catch(s){console.error(`Failed to probe device ${t}:${a}:`,s)}return null}async function Qu(){const t=[];try{if(!("serial"in navigator))return console.warn("Web Serial API not supported in this browser"),t;const a=await navigator.serial.getPorts();for(const s of a){const r=await ac(s);r&&t.push(r)}}catch(a){console.error("USB device discovery failed:",a)}return t}async function Zu(){try{if(!("serial"in navigator))return alert("Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge."),null;const t=await navigator.serial.requestPort();return await ac(t)}catch(t){return t.name!=="NotFoundError"&&console.error("USB device request failed:",t),null}}async function ac(t){try{await t.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none"});const a=t.readable?.getReader();if(a)try{const s=setTimeout(()=>a.cancel(),2e3),{value:r,done:n}=await a.read();if(clearTimeout(s),!n&&r){const i=new TextDecoder().decode(r);if(i.includes("OMNI")||i.includes("omni"))return a.releaseLock(),{id:`usb-omni-${Date.now()}`,name:"OMNI Camera (USB)",type:"omni",capabilities:["video","calibration"],status:"online",port:t};if(i.includes("VERT")||i.includes("vert"))return a.releaseLock(),{id:`usb-vert-${Date.now()}`,name:"VERT Camera (USB)",type:"vert",capabilities:["video","calibration"],status:"online",port:t}}}catch{}finally{try{a.releaseLock()}catch{}}return{id:`usb-generic-${Date.now()}`,name:"USB Scoring Device",type:"generic",capabilities:["video"],status:"online",port:t}}catch(a){return console.error("Failed to probe USB device:",a),null}}async function rc(t){try{const a=`http://${t.ip}:${t.port}/stream`,s=document.createElement("video");return s.src=a,s.crossOrigin="anonymous",new Promise((r,n)=>{s.onloadeddata=()=>{const i=document.createElement("canvas"),l=i.getContext("2d");i.width=s.videoWidth,i.height=s.videoHeight;const o=i.captureStream(30),d=()=>{s.readyState>=2&&l.drawImage(s,0,0),requestAnimationFrame(d)};d(),r(o)},s.onerror=()=>n(new Error("Failed to load video stream")),s.load()})}catch(a){return console.error("Failed to connect to network device:",a),null}}async function em(t){try{if(!t.port)throw new Error("No serial port available");return console.log("USB device connection not fully implemented yet"),null}catch(a){return console.error("Failed to connect to USB device:",a),null}}const tm={};function sm(){const t=u.useRef(null),a=u.useRef(null),s=u.useRef(null),r=u.useRef(null),[n,i]=u.useState("unknown"),[l,o]=u.useState([]),[d,c]=u.useState(null),[h,m]=u.useState(!1),[x,b]=u.useState(!1),[y,N]=u.useState("camera"),[C,w]=u.useState(()=>localStorage.getItem("ndn:cal:mode")||"local"),[D,I]=u.useState([]),[M,R]=u.useState(!1),[A,v]=u.useState(null),[p,F]=u.useState(1),[H,_]=u.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("ndn:cal:forceDesktop")==="1"}catch{return!1}}),[z,T]=u.useState(()=>typeof navigator>"u"?!1:/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)),{H:K,setCalibration:ee,reset:ie,errorPx:ke,locked:Be}=wa(),Ue=Zn(),{calibrationGuide:Oe,setCalibrationGuide:je,preferredCameraId:Re,cameraEnabled:$,setCameraEnabled:te,preferredCameraLocked:ce,setPreferredCameraLocked:ze,setPreferredCamera:Pe}=qt(),[Te,Ee]=u.useState(null),[ht,Ce]=u.useState(!1),[me,Le]=u.useState(0),[pt,It]=u.useState(null),[is,Ke]=u.useState([]);u.useCallback((B,Q=480)=>{if(typeof document>"u")throw new Error("Marker rendering only available in browser context");const se=Wu(B),G=document.createElement("canvas");G.width=Q,G.height=Q;const S=G.getContext("2d");if(!S)return"";S.fillStyle="#ffffff",S.fillRect(0,0,Q,Q);const O=se.length,U=se[0]?.length||O,Y=Q/U,re=Q/O;for(let he=0;he<O;he++)for(let ge=0;ge<U;ge++)se[he][ge]&&(S.fillStyle="#000000",S.fillRect(Math.round(ge*Y),Math.round(he*re),Math.ceil(Y),Math.ceil(re)));return G.toDataURL("image/png")},[]);const[De,Pt]=u.useState(null),le=u.useRef(null),[fe,ne]=u.useState(null),Z=u.useRef(null),He=u.useRef([]),[ye,Ne]=u.useState(null),[Xe,rt]=u.useState(Date.now()),[ft,Ve]=u.useState(!1);function yt(B){try{Pt(B),le.current=B}catch{}}const[We,wt]=u.useState(""),[kt,$t]=u.useState(null),[et,zt]=u.useState(null),[os,ls]=u.useState(!0),[es,Rt]=u.useState([]),[Yt,Ft]=u.useState(!1),[E,ae]=u.useState(null),xe=u.useRef(null);u.useEffect(()=>{console.log("[Calibrator] ðŸ”„ STREAMING STATE CHANGED:",{streaming:h,phase:y,videoRefExists:!!t.current})},[h,y]),u.useEffect(()=>{const B=window.location.hostname;(B==="localhost"||B==="127.0.0.1")&&Kt("/api/hosts").then(Q=>Q.json()).then(Q=>{const se=Array.isArray(Q?.hosts)&&Q.hosts.find(G=>G);se&&$t(se)}).catch(()=>{}),Kt("/api/https-info").then(Q=>Q.json()).then(Q=>{Q&&typeof Q.https=="boolean"&&zt({https:!!Q.https,port:Number(Q.port)||8788})}).catch(()=>{})},[]);const $e=u.useMemo(()=>{const B=De||"____",Q="ws://localhost:8787";if(Q.length>0)try{const U=new URL(Q);return`${`${U.protocol==="wss:"?"https":"http"}://${U.host}${U.pathname.endsWith("/ws")?"":U.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${B}`}catch{}const se=kt||window.location.hostname,G=!!et?.https,S=G?et?.port||8788:8787;return`${G?"https":"http"}://${se}:${S}/mobile-cam.html?code=${B}`},[De,kt,et]),Qe=u.useMemo(()=>{if(!$e)return null;try{const B=new URL($e);return B.searchParams.delete("code"),B.toString().replace(/\?$/,"")}catch{return typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html"}},[$e]);u.useEffect(()=>{localStorage.setItem("ndn:cal:mode",C)},[C]),u.useEffect(()=>{if(!(typeof window>"u"))try{H?window.localStorage.setItem("ndn:cal:forceDesktop","1"):window.localStorage.removeItem("ndn:cal:forceDesktop")}catch{}},[H]),u.useEffect(()=>{if(typeof window>"u")return;const B=window.matchMedia("(pointer: coarse)"),Q=()=>{const se=typeof navigator<"u"&&/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent),G=typeof B.matches=="boolean"?B.matches:!1,S=window.innerWidth<=820;T(se||G||S)};Q();try{typeof B.addEventListener=="function"?B.addEventListener("change",Q):typeof B.addListener=="function"&&B.addListener(Q)}catch{}return window.addEventListener("resize",Q),()=>{try{typeof B.removeEventListener=="function"?B.removeEventListener("change",Q):typeof B.removeListener=="function"&&B.removeListener(Q)}catch{}window.removeEventListener("resize",Q)}},[]),u.useEffect(()=>{if(!De){wt("");return}const B=tm?.VITE_QR_LOGO_URL||"/dart-thrower.svg";Xl($e,{width:256,margin:2,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"},logo:{logoUrl:B,logoScale:.2,mask:!0,shape:"circle"}}).then(wt).catch(()=>wt(""))},[$e,De]),u.useEffect(()=>{if(typeof navigator>"u"||!navigator.permissions){i("unsupported");return}let B=!0;return(async()=>{try{const Q=await navigator.permissions.query({name:"camera"});if(!B)return;i(Q.state||"unknown"),Q.onchange=()=>{B&&i(Q.state)}}catch{B&&i("unknown")}})(),()=>{B=!1}},[]);async function Mt(B){if(typeof navigator>"u"||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("getUserMedia is not available in this browser");return}const Q={video:B?{deviceId:{exact:B}}:{facingMode:"environment"}};let se=null;try{se=await navigator.mediaDevices.getUserMedia(Q),se.getTracks().forEach(G=>G.stop()),i("granted");try{B&&typeof Pe=="function"&&Pe(B)}catch{}alert("Camera access granted â€” your webcam is available and set as preferred.")}catch(G){console.error("[Calibrator] testCamera failed",G),G&&(G.name==="NotAllowedError"||G.name==="PermissionDeniedError")?(i("denied"),alert("Camera permission denied. Please allow camera access in your browser settings and try again.")):G&&(G.name==="NotFoundError"||G.name==="DevicesNotFoundError")?alert("No camera devices found. Ensure your USB webcam is connected and not in use by another app."):alert("Unable to access the camera: "+(G?.message||G))}finally{se&&se.getTracks().forEach(G=>G.stop())}}u.useEffect(()=>{if(!ye)return;const B=setInterval(()=>rt(Date.now()),1e3);return()=>clearInterval(B)},[ye]);const Lt=u.useMemo(()=>ye?Math.max(0,Math.ceil((ye-Xe)/1e3)):null,[ye,Xe]);u.useEffect(()=>()=>{xe.current&&window.clearTimeout(xe.current)},[]);const ts=u.useCallback(async(B,Q)=>{if(B)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(B);else{const se=document.createElement("textarea");se.value=B,se.style.position="fixed",se.style.opacity="0",document.body.appendChild(se),se.focus(),se.select(),document.execCommand("copy"),document.body.removeChild(se)}ae(Q),xe.current&&window.clearTimeout(xe.current),xe.current=window.setTimeout(()=>ae(null),1500)}catch(se){console.warn("[Calibrator] Copy failed:",se),ae(null)}},[]);u.useEffect(()=>()=>{},[]),u.useEffect(()=>{const B=Q=>{console.log("[Calibrator] Received reconnect request from PhoneCameraOverlay"),C==="phone"&&ft&&(ot(!1),setTimeout(()=>{Tt()},500))};return window.addEventListener("ndn:phone-camera-reconnect",B),()=>{window.removeEventListener("ndn:phone-camera-reconnect",B)}},[C,ft]),u.useEffect(()=>{console.log("[Calibrator] ðŸ”„ STREAMING CHANGED:",{streaming:h,videoRefAvailable:!!t.current}),t.current?(console.log("[Calibrator] âœ… Syncing videoElementRef on streaming change"),Ue.setVideoElementRef(t.current),t.current.srcObject instanceof MediaStream&&(console.log("[Calibrator] âœ… Setting mediaStream from video element"),Ue.setMediaStream(t.current.srcObject))):console.warn("[Calibrator] âš ï¸ videoRef.current is null on streaming change!")},[h]),u.useEffect(()=>(console.log("[Calibrator] ðŸš€ MOUNT: Initial mount - syncing videoRef"),console.log("[Calibrator] videoRef.current available:",!!t.current),console.log("[Calibrator] videoRef.current type:",t.current?.constructor?.name),t.current?(console.log("[Calibrator] âœ… Setting videoElementRef on mount"),console.log("[Calibrator] Video element:",{tagName:t.current.tagName,srcObject:!!t.current.srcObject,videoWidth:t.current.videoWidth,videoHeight:t.current.videoHeight}),Ue.setVideoElementRef(t.current),console.log("[Calibrator] âœ… videoElementRef set successfully")):console.error("[Calibrator] âŒ CRITICAL: videoRef.current is NULL at mount!"),()=>{}),[]);function ps(){if(fe&&(fe.readyState===WebSocket.OPEN||fe.readyState===WebSocket.CONNECTING))return console.log("[Calibrator] ensureWS: Reusing existing WebSocket (state:",fe.readyState,")"),fe;const B="ws://localhost:8787",Q=B.length>0?B.endsWith("/ws")?B:B.replace(/\/$/,"")+"/ws":void 0,G=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws`,S=window.location.hostname,U=Q||(S.endsWith("onrender.com")?G:"wss://ninedartnation.onrender.com/ws");console.log("[Calibrator] ensureWS: Creating new WebSocket to:",U);let Y=new WebSocket(U);return Y.onerror=re=>{console.error("[Calibrator] WebSocket connection error:",re),alert("Failed to connect to camera pairing service. Please check your internet connection and try again.")},Y.onclose=re=>{if(console.log("[Calibrator] WebSocket closed:",re.code,re.reason),Z.current){try{Z.current.close()}catch{}Z.current=null}yt(null),Ne(null),Ve(!1),re.code!==1e3&&(alert("Camera pairing connection lost. Please try pairing again."),C==="phone"&&w("local"))},ne(Y),Y}async function Tt(){w("phone"),ot(!1),Rs();try{te(!0)}catch{}const B=ps();B.readyState===WebSocket.OPEN?(console.log("[Calibrator] WebSocket open, sending cam-create"),B.send(JSON.stringify({type:"cam-create"}))):(console.log("[Calibrator] WebSocket connecting, will send cam-create on open"),B.onopen=()=>{console.log("[Calibrator] WebSocket now open, sending cam-create"),B.send(JSON.stringify({type:"cam-create"}))}),B.onmessage=async Q=>{const se=JSON.parse(Q.data);if(se.type==="cam-code")yt(se.code),se.expiresAt&&Ne(se.expiresAt);else if(se.type==="cam-peer-joined"){!le.current&&se.code&&yt(se.code),Ve(!0);const G=le.current||se.code||null;G&&(le.current=G);try{if(Be&&G){const O=a.current?{w:a.current.width,h:a.current.height}:null,U={H:K,imageSize:O,errorPx:ke??null,createdAt:Date.now()};B.send(JSON.stringify({type:"cam-calibration",code:G,payload:U})),console.log("[Calibrator] Sent calibration to joined phone for code",G)}}catch(O){console.warn("[Calibrator] Failed to send calibration on peer join",O)}const S=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceCandidatePoolSize:10});Z.current=S,S.onconnectionstatechange=()=>{console.log("WebRTC connection state:",S.connectionState),S.connectionState==="failed"||S.connectionState==="disconnected"?(console.error("WebRTC connection failed"),alert("Camera connection lost. Please try pairing again."),ot(!1)):S.connectionState==="connected"&&console.log("WebRTC connection established")},S.onicecandidate=O=>{O.candidate&&G&&B.send(JSON.stringify({type:"cam-ice",code:G,payload:O.candidate}))},S.ontrack=O=>{if(console.log("[Calibrator] WebRTC ontrack received:",O.streams?.length,"streams, track kind:",O.track?.kind),t.current){const U=O.streams?.[0];U?(console.log("[Calibrator] Assigning video stream (tracks:",U.getTracks().length,") to video element"),R(!1),setTimeout(()=>{t.current&&(console.log("[Calibrator] Setting srcObject and attempting play"),t.current.srcObject&&t.current.srcObject.getTracks().forEach(re=>re.stop()),t.current.srcObject=U,t.current.muted=!0,t.current.playsInline=!0,t.current.play().then(()=>{console.log("[Calibrator] Video playback started successfully"),m(!0),N("capture"),Ue.setStreaming(!0),Ue.setMode("phone"),Ue.setMediaStream(U);try{Pe(void 0,"Phone Camera",!0)}catch{}if(!ce)try{ze(!0)}catch{}try{te(!0)}catch{}b(!1)}).catch(Y=>{console.error("[Calibrator] Video play failed:",Y),b(!0),console.warn("[Calibrator] video play blocked â€” prompting user interaction")}))},100)):console.error("[Calibrator] No inbound stream received in ontrack")}else console.error("[Calibrator] Video element not available")};try{const O=await S.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await S.setLocalDescription(O),console.log("[Calibrator] Sending cam-offer for code:",G),G?B.send(JSON.stringify({type:"cam-offer",code:G,payload:O})):console.warn("[Calibrator] Missing pairing code when sending offer")}catch(O){console.error("Failed to create WebRTC offer:",O),alert("Failed to establish camera connection. Please try again."),ot(!1)}}else if(se.type==="cam-answer"){console.log("[Calibrator] Received cam-answer");const G=Z.current;if(G)try{await G.setRemoteDescription(new RTCSessionDescription(se.payload)),console.log("[Calibrator] Remote description set (answer)");const S=He.current;console.log(`[Calibrator] Processing ${S.length} pending ICE candidates`);for(const O of S)try{await G.addIceCandidate(O),console.log("[Calibrator] Queued ICE candidate added")}catch(U){console.error("Failed to add queued ICE candidate:",U)}He.current=[]}catch(S){console.error("Failed to set remote description:",S),alert("Camera pairing failed. Please try again."),ot(!1)}else console.warn("[Calibrator] Received cam-answer but no peer connection exists")}else if(se.type==="cam-ice"){console.log("[Calibrator] Received cam-ice");const G=Z.current;if(G)if(G.remoteDescription)try{await G.addIceCandidate(se.payload),console.log("[Calibrator] ICE candidate added")}catch(S){console.error("Failed to add ICE candidate:",S)}else console.log("[Calibrator] Remote description not set yet, queuing ICE candidate"),He.current.push(se.payload);else console.warn("[Calibrator] Received ICE candidate but no peer connection exists")}else if(se.type==="cam-error")console.error("Camera pairing error:",se.code),alert(se.code==="EXPIRED"?"Code expired. Generate a new code.":`Camera error: ${se.code||"Unknown error"}`),ot(!1);else if(se.type==="cam-calibration"){console.log("[Calibrator] Received calibration from peer:",se.payload);try{se.payload&&se.payload.H&&Array.isArray(se.payload.H)&&(ee({H:se.payload.H,createdAt:se.payload.createdAt||Date.now(),errorPx:se.payload.errorPx,imageSize:se.payload.imageSize,locked:!0}),console.log("[Calibrator] Applied received calibration"))}catch(G){console.error("[Calibrator] Failed to apply received calibration",G)}}}}async function _t(){Ft(!0);try{const B=await nc();Rt(B),B.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(B){console.error("Wifi device discovery failed:",B),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Ft(!1)}N("camera")}async function V(B){try{Rt(se=>se.map(G=>G.id===B.id?{...G,status:"connecting"}:G));const Q=await rc(B);if(Q&&t.current)t.current.srcObject&&t.current.srcObject.getTracks().forEach(G=>G.stop()),t.current.srcObject=Q,await t.current.play(),m(!0),N("capture"),Rt(se=>se.map(G=>G.id===B.id?{...G,status:"online"}:G));else throw new Error("Failed to get video stream")}catch(Q){console.error("Failed to connect to wifi device:",Q),alert(`Failed to connect to ${B.name}. Please check the device and try again.`),Rt(se=>se.map(G=>G.id===B.id?{...G,status:"offline"}:G))}}async function we(){if(C==="phone")return Tt();if(C==="wifi")return _t();console.log("[Calibrator] ðŸŽ¬ START_CAMERA: mode=",C,"preferredCameraId=",Re);try{let B=null;if(Re)try{console.log("[Calibrator] ðŸ“¹ Attempt 1: Using preferred camera ID:",Re),B=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:Re}},audio:!1}),console.log("[Calibrator] âœ… SUCCESS with preferred camera:",B.getTracks().length,"tracks")}catch(Q){console.warn("[Calibrator] âš ï¸ Preferred camera failed:",Q?.name,Q?.message)}if(!B)try{console.log("[Calibrator] ðŸ“¹ Attempt 2: Using ANY available camera"),B=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),console.log("[Calibrator] âœ… SUCCESS with fallback camera:",B.getTracks().length,"tracks")}catch(Q){throw console.error("[Calibrator] âŒ BOTH attempts failed:",Q?.name,Q?.message),Q}if(!B)throw new Error("No stream obtained");if(!t.current)throw new Error("Video element ref is null");console.log("[Calibrator] ðŸ“º Assigning stream to video element"),t.current.srcObject=B,console.log("[Calibrator] â–¶ï¸ Calling play()");try{await t.current.play(),console.log("[Calibrator] âœ… Play succeeded")}catch(Q){console.warn("[Calibrator] âš ï¸ Play failed, retrying in 100ms:",Q?.message),await new Promise(se=>setTimeout(se,100)),await t.current.play(),console.log("[Calibrator] âœ… Play succeeded on retry")}console.log("[Calibrator] ðŸŸ¢ Setting streaming = true"),m(!0),N("capture"),console.log("[Calibrator] ðŸŸ¢ State updated")}catch(B){console.error("[Calibrator] ðŸ”´ FATAL:",B?.message||B),alert(`Camera failed: ${B?.message||"Unknown error"}`),t.current?.srcObject&&(t.current.srcObject.getTracks().forEach(Q=>Q.stop()),t.current.srcObject=null)}}function ot(B=!1){if(t.current&&t.current.srcObject&&(t.current.srcObject.getTracks().forEach(se=>se.stop()),t.current.srcObject=null,m(!1)),Z.current){try{Z.current.close()}catch{}Z.current=null}He.current=[],yt(null),Ne(null),Ve(!1),It(null),Ue.setStreaming(!1),Ue.setMediaStream(null),B&&(C==="phone"||C==="wifi")&&w("local")}function us(){fe&&fe.readyState===WebSocket.OPEN?fe.send(JSON.stringify({type:"cam-create"})):Tt(),Rs()}function Rs(){try{ce||ze(!0)}catch{}}function ks(){try{r.current?.click()}catch{}}function vs(){const B=`${window.location.origin}/marker-sheet.html`;window.open(B,"_blank")}function Cs(){if(!t.current||!a.current)return;const B=t.current,Q=a.current;Q.width=B.videoWidth,Q.height=B.videoHeight,Q.getContext("2d").drawImage(B,0,0,Q.width,Q.height),R(!0),v({w:Q.width,h:Q.height}),N("select"),I([]),It(null),ht&&setTimeout(()=>{Vt()},0)}function Xt(B=D,Q=null){if(!a.current||!s.current)return;const se=a.current,G=s.current;G.width=se.width,G.height=se.height;const S=G.getContext("2d");S.clearRect(0,0,G.width,G.height);const O=Q||K;if(O){const U=[pe.bullInner,pe.bullOuter,pe.trebleInner,pe.trebleOuter,pe.doubleInner,pe.doubleOuter];for(const Y of U){const re=Be?"#10b981":Y===pe.doubleOuter?"#22d3ee":"#a78bfa",he=Be||Y===pe.doubleOuter?3:2,ge=Zl(O,Y,360);tc(S,ge,re,he)}}if(!O&&Te){const U=(Y,re,he=2)=>{S.save(),S.strokeStyle=re,S.lineWidth=he,S.beginPath(),S.arc(Te.cx,Te.cy,Y,0,Math.PI*2),S.stroke(),S.restore()};U(Te.doubleOuter,"#22d3ee",3),U(Te.doubleInner,"#22d3ee",2),U(Te.trebleOuter,"#fde047",2),U(Te.trebleInner,"#fde047",2),U(Te.bullOuter,"#34d399",2),U(Te.bullInner,"#10b981",3)}if(B.length<6&&O){S.save(),S.strokeStyle="rgba(255,193,7,0.4)",S.lineWidth=2,S.setLineDash([4,4]);const U=ba();for(let Y=B.length;Y<6&&Y<U.length;Y++)try{const re=Yn(O,U[Y]);S.beginPath(),S.arc(re.x,re.y,12,0,Math.PI*2),S.stroke()}catch{}S.restore()}if(B.forEach((U,Y)=>{ul(S,U,"#f472b6"),S.save(),S.fillStyle="#f472b6",S.font="14px sans-serif",S.fillText(String(Y+1),U.x+6,U.y-6),S.restore()}),Oe&&!Be){S.save(),S.fillStyle="rgba(59,130,246,0.10)";const U=Math.round(Math.min(G.width,G.height)*.08),Y=G.width-U*2,re=G.height-U*2;S.fillRect(U,U,Y,re),S.strokeStyle="rgba(34,197,94,0.9)",S.lineWidth=2,S.beginPath(),S.moveTo(U,G.height/2),S.lineTo(G.width-U,G.height/2),S.stroke(),S.beginPath(),S.moveTo(G.width/2,U),S.lineTo(G.width/2,G.height-U),S.stroke(),S.strokeStyle="rgba(234,179,8,0.9)",S.setLineDash([6,4]);const he=U+30,ge=U+30;S.beginPath(),S.moveTo(he,ge+30),S.lineTo(he+60,ge),S.stroke(),S.beginPath(),S.moveTo(G.width-he,ge+30),S.lineTo(G.width-he-60,ge),S.stroke(),S.restore(),S.save(),S.scale(1/p,1/p),S.fillStyle="rgba(255,255,255,0.85)",S.font="12px sans-serif",S.fillText("Tip: Frame board centered, edges parallel; slight top-down is okay. Keep bull near center.",U*p,(U+18)*p),S.restore()}}function Ps(B){if(y!=="select")return;const Q=B.target,se=Q.getBoundingClientRect(),G=B.clientX-se.left,S=B.clientY-se.top,O=Q.width>0?Q.width/se.width:1,U=Q.height>0?Q.height/se.height:1,Y=G*O,re=S*U,he=[...D,{x:Y,y:re}];he.length<=6&&(I(he),Xt(he))}function ws(){if(!a.current)return;if(D.length<5)return alert("Please click all 5 calibration points: the 4 corners of the double ring plus the CENTER of the bull.");const B=ba(),Q=ir(B,D);Xt(D,Q);const se=or(Q,B,D);ee({H:Q,createdAt:Date.now(),errorPx:se,imageSize:{w:a.current.width,h:a.current.height},anchors:{src:B,dst:D}}),N("computed")}function Ls(){if(!K||!s.current)return alert("Please compute calibration first (lock) before running verification.");try{const B=[{label:"Bull (50)",p:{x:0,y:0}},{label:"Outer Bull (25)",p:{x:0,y:-pe.bullOuter}},{label:"Triple 20",p:{x:0,y:-((pe.trebleInner+pe.trebleOuter)/2)}},{label:"Single 5 (near 5 sector)",p:{x:(pe.trebleInner+pe.trebleOuter)/2*Math.cos(Math.PI*.1),y:(pe.trebleInner+pe.trebleOuter)/2*Math.sin(Math.PI*.1)}}],Q=s.current.getContext("2d");Xt(D,K);const se=[];for(const G of B){const S=Yn(K,{x:G.p.x,y:G.p.y}),O=ec(K,S),U=Ii(O),Y=Ii(G.p),re=Y.base===U.base&&Y.mult===U.mult||Y.base===U.base;se.push({label:G.label,expected:Y,detected:U,match:re}),ul(Q,S,re?"#10b981":"#ef4444"),Q.fillStyle=re?"#10b981":"#ef4444",Q.font="12px sans-serif",Q.fillText(G.label,S.x+6,S.y-6)}Ke(se)}catch(B){console.error("Verification failed",B),alert("Verification failed: "+B?.message)}}async function Vt(){if(!a.current)return alert("Load a photo or capture a frame first.");It(null);const B=a.current,se=Math.min(1,800/B.width),G=Math.max(1,Math.round(B.width*se)),S=Math.max(1,Math.round(B.height*se)),O=document.createElement("canvas");O.width=G,O.height=S;const U=O.getContext("2d");U.drawImage(B,0,0,G,S);const Y=U.getImageData(0,0,G,S),re=new Float32Array(G*S);for(let Ye=0,jt=0;Ye<Y.data.length;Ye+=4,jt++){const st=Y.data[Ye],Bt=Y.data[Ye+1],Ze=Y.data[Ye+2];re[jt]=.299*st+.587*Bt+.114*Ze}const he=new Float32Array(G*S),ge=new Float32Array(G*S);for(let Ye=1;Ye<S-1;Ye++)for(let jt=1;jt<G-1;jt++){const st=Ye*G+jt,Bt=re[st-G-1],Ze=re[st-G],Zt=re[st-G+1],Nt=re[st-1],Ut=re[st+1],Ms=re[st+G-1],Us=re[st+G],js=re[st+G+1];he[st]=-Bt-2*Nt-Ms+(Zt+2*Ut+js),ge[st]=-Bt-2*Ze-Zt+(Ms+2*Us+js)}const Se=new Float32Array(G*S);let Ie=1;for(let Ye=0;Ye<Se.length;Ye++){const jt=Math.hypot(he[Ye],ge[Ye]);Se[Ye]=jt,jt>Ie&&(Ie=jt)}const Et=Math.floor(G/2),at=Math.floor(S/2),xt=Math.floor(Math.min(G,S)*.35),ut=Math.floor(Math.min(G,S)*.52);let bt={score:-1,cx:Et,cy:at,r:Math.floor((xt+ut)/2)};const cs=Math.max(2,Math.floor(Math.min(G,S)*.01)),ms=Math.max(2,Math.floor(Math.min(G,S)*.01));for(let Ye=at-Math.floor(S*.08);Ye<=at+Math.floor(S*.08);Ye+=cs)for(let jt=Et-Math.floor(G*.08);jt<=Et+Math.floor(G*.08);jt+=cs)for(let st=xt;st<=ut;st+=ms){let Bt=0;const Ze=360;for(let Zt=0;Zt<Ze;Zt++){const Nt=Zt*Math.PI/180,Ut=Math.round(jt+st*Math.cos(Nt)),Ms=Math.round(Ye+st*Math.sin(Nt));Ut<=0||Ut>=G-1||Ms<=0||Ms>=S-1||(Bt+=Se[Ms*G+Ut])}Bt>bt.score&&(bt={score:Bt,cx:jt,cy:Ye,r:st})}const Gt=1/se,hs=bt.cx*Gt,fs=bt.cy*Gt,Zs=bt.r*Gt;function vt(Ye){let jt=0;const st=Ye*se,Bt=360;for(let Ze=0;Ze<Bt;Ze++){const Zt=Ze*Math.PI/180,Nt=Math.round(bt.cx+st*Math.cos(Zt)),Ut=Math.round(bt.cy+st*Math.sin(Zt));Nt<=0||Nt>=G-1||Ut<=0||Ut>=S-1||(jt+=Se[Ut*G+Nt])}return jt}const Ot={bullInner:pe.bullInner/pe.doubleOuter,bullOuter:pe.bullOuter/pe.doubleOuter,trebleInner:pe.trebleInner/pe.doubleOuter,trebleOuter:pe.trebleOuter/pe.doubleOuter,doubleInner:pe.doubleInner/pe.doubleOuter};function tt(Ye,jt=.08){const st=Math.max(1,Math.floor(Ye*(1-jt))),Bt=Math.max(st+1,Math.floor(Ye*(1+jt)));let Ze=st,Zt=-1;for(let Nt=st;Nt<=Bt;Nt++){const Ut=vt(Nt);Ut>Zt&&(Zt=Ut,Ze=Nt)}return Ze}const mt=Zs,ct=tt(mt*Ot.doubleInner),ss=tt(mt*Ot.trebleOuter),Ht=tt(mt*Ot.trebleInner),Ct=tt(mt*Ot.bullOuter),xs=tt(mt*Ot.bullInner);Ee({cx:hs,cy:fs,bullInner:xs,bullOuter:Ct,trebleInner:Ht,trebleOuter:ss,doubleInner:ct,doubleOuter:mt});const gt=Ye=>{let st=0;for(let Bt=0;Bt<180;Bt++){const Ze=Bt*Math.PI/90,Zt=Math.round(bt.cx+Ye*se*Math.cos(Ze)),Nt=Math.round(bt.cy+Ye*se*Math.sin(Ze));Zt<=0||Zt>=G-1||Nt<=0||Nt>=S-1||(st+=Se[Nt*G+Zt])}return st/180},Qt=(gt(bt.r)+gt(ss)+gt(Ht)+gt(ct)+gt(Ct)+gt(xs))/(Ie*6),Es=Math.max(0,Math.min(1,Qt)),Ss=Math.min(Es,Math.min(gt(bt.r)/Ie,gt(ss)/Ie,gt(Ht)/Ie,gt(ct)/Ie,gt(Ct)/Ie,gt(xs)/Ie));Le(Math.round(Ss*100));const Ds=[{x:hs,y:fs-mt},{x:hs+mt,y:fs},{x:hs,y:fs+mt},{x:hs-mt,y:fs},{x:hs,y:fs},{x:hs,y:fs-Ct}];I(Ds),Xt(Ds);try{const Ye=ba(),jt=ir(Ye,Ds);Xt(Ds,jt);const st=or(jt,Ye,Ds);ee({H:jt,createdAt:Date.now(),errorPx:st,imageSize:{w:a.current.width,h:a.current.height},anchors:{src:Ye,dst:Ds}}),N("computed")}catch(Ye){console.error("[Calibrator] Auto-detect compute failed:",Ye)}const Is=Ss>=.95;ee({locked:Is})}function Os(){if(!a.current)return alert("Capture a frame or upload a photo first.");let B=zu(a.current);if(B=Vu(B),!B.success||!B.homography||B.confidence<50){alert(`âŒ Board Detection Failed

Confidence: ${Math.round(B.confidence)}%

${B.message}

Try:
â€¢ Better lighting
â€¢ Closer camera angle
â€¢ Make sure entire board is visible
â€¢ Use manual calibration instead (click 5 points)`);return}Ee({cx:B.cx,cy:B.cy,bullInner:B.bullInner,bullOuter:B.bullOuter,trebleInner:B.trebleInner,trebleOuter:B.trebleOuter,doubleInner:B.doubleInner,doubleOuter:B.doubleOuter}),I(B.calibrationPoints),Xt(B.calibrationPoints,B.homography);const Q=(B.errorPx??Number.POSITIVE_INFINITY)<=2;ee({H:B.homography,createdAt:Date.now(),errorPx:B.errorPx??null,imageSize:{w:a.current.width,h:a.current.height},anchors:{src:ba().slice(0,4),dst:B.calibrationPoints},locked:Q?!0:Be}),N("computed");const se=B.confidence>90?"ðŸŸ¢ Excellent":B.confidence>80?"ðŸŸ¢ Good":B.confidence>70?"ðŸŸ¡ Fair":"ðŸŸ¡ Acceptable";alert(`âœ… Auto-Calibration Successful!

Confidence: ${se} (${Math.round(B.confidence)}%)
Error: ${B.errorPx?.toFixed(2)??"?"} pixels

Calibration has been ${Q?"locked":"computed (not locked yet)"}.`)}function as(){if(!a.current)return alert("Capture a frame or upload a photo first.");const B=_u(a.current);if(It(B),!B.success||!B.homography){const S=B.missing.length?` Missing markers: ${B.missing.map(Y=>`${Y.toUpperCase()} (ID ${Jn[Y]})`).join(", ")}`:"",O=B.markersFound.length>0?`

Detected ${B.markersFound.length} markers with IDs: ${B.markersFound.map(Y=>Y.id).join(", ")}`:`

No markers detected. Make sure markers are on white paper, fully visible, and well-lit.`,U=`${B.message}${S}${O}

You can still use manual calibration: click 5 points on the board instead.`;alert(U);return}Ee(null),I(B.points),Xt(B.points,B.homography);const Q=ba(),se={w:a.current.width,h:a.current.height},G=(B.errorPx??Number.POSITIVE_INFINITY)<=1.2;ee({H:B.homography,createdAt:Date.now(),errorPx:B.errorPx??null,imageSize:se,anchors:{src:Q,dst:B.points},locked:G?!0:Be}),N("computed")}u.useEffect(()=>{Xt()},[M,K]),u.useEffect(()=>{if(!ht||!h)return;let B=0;const Q=()=>{try{Cs()}catch{}B=requestAnimationFrame(Q)};return B=requestAnimationFrame(Q),()=>cancelAnimationFrame(B)},[ht,h]),u.useEffect(()=>{(async()=>{try{if(!Be||!De)return;const B=a.current?{w:a.current.width,h:a.current.height}:null,Q=JSON.stringify({H:K,anchors:null,imageSize:B,errorPx:ke??null});try{await Kt(`/cam/calibration/${De}`,{method:"POST",headers:{"Content-Type":"application/json"},body:Q}),console.log("[Calibrator] Posted calibration for code",De)}catch(se){console.warn("[Calibrator] Upload calibration failed",se)}try{const se=localStorage.getItem("authToken");se&&(await Kt("/api/user/calibration",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se}`},body:Q}),console.log("[Calibrator] Synced calibration to user account"))}catch(se){console.warn("[Calibrator] User calibration sync failed",se)}}catch{}})()},[Be,De]);function Bs(){const{preferredCameraId:Q,preferredCameraLabel:se,setPreferredCamera:G,cameraEnabled:S,setCameraEnabled:O,preferredCameraLocked:U,setPreferredCameraLocked:Y}=qt(),[re,he]=u.useState([]),[ge,Se]=u.useState(null),[Ie,Et]=u.useState(""),[at,xt]=u.useState(!1),ut=u.useRef(null),bt=u.useRef(0),cs=u.useRef(!1),ms=document.getElementById("dropdown-portal-root")||(()=>{const tt=document.createElement("div");return tt.id="dropdown-portal-root",document.body.appendChild(tt),tt})();async function Gt(){console.debug("[DevicePicker] enumerate start",Date.now()),Et("");try{try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(ss=>ss.stop())}catch{}const mt=(await navigator.mediaDevices.enumerateDevices()).filter(ct=>ct.kind==="videoinput");he(mt),ut.current&&ut.current.dataset?.open==="true"&&Se(mt),console.debug("[DevicePicker] enumerate -> devices",mt.map(ct=>ct.deviceId),"snapshot?",!!(ut.current&&ut.current.dataset?.open==="true"))}catch{Et("Unable to list cameras. Grant camera permission in your browser.")}}u.useEffect(()=>{Gt()},[]),u.useEffect(()=>{function tt(mt){try{if(console.debug("[DevicePicker] document.mousedown",{target:(mt&&mt.target)?.tagName||String(mt.target),time:Date.now(),ignoreUntil:bt.current}),cs.current){console.debug("[DevicePicker] document.mousedown ignored because suspendDocHandlerRef is true",Date.now());return}if(Date.now()<(bt.current||0))return;const ct=mt.target,ss=ut.current&&ut.current.contains(ct),Ht=ms&&ms.contains&&ms.contains(ct);!ss&&!Ht&&(console.debug("[DevicePicker] document.mousedown -> closing dropdown (outside both main+portal)",Date.now()),xt(!1))}catch{}}return document.addEventListener("mousedown",tt),()=>document.removeEventListener("mousedown",tt)},[]);const hs=re.find(tt=>tt.deviceId===Q),fs=hs?`${hs.label||"Camera"}`:Q?"Camera (unavailable)":"Auto (browser default)",[Zs,vt]=u.useState(fs),Ot=Q&&!hs;return e.jsxs("div",{className:"mt-3 p-3 rounded-lg border border-indigo-500/30 bg-indigo-500/5",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Select camera device"}),Ie&&e.jsx("div",{className:"text-rose-400 text-sm mb-2",children:Ie}),Ot&&e.jsxs("div",{className:"text-amber-400 text-sm mb-2",children:["Selected camera is no longer available.",e.jsx("button",{className:"underline ml-1",onClick:()=>G(void 0,"",!0),disabled:h,children:"Use auto-selection"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[U?e.jsx("div",{className:"text-xs text-emerald-400",children:"ðŸ”’ Camera selection locked"}):e.jsx("div",{className:"text-xs text-slate-400",children:"Camera selection unlocked"}),e.jsx("button",{className:"btn btn--ghost px-2 py-0.5 text-xs ml-2",onClick:()=>{Y(!U)},children:U?"Unlock":"Lock"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled-calibrator",checked:S,onChange:tt=>O(tt.target.checked),className:"w-4 h-4",disabled:h}),e.jsx("label",{htmlFor:"cameraEnabled-calibrator",className:"text-sm",children:"Enable camera for scoring"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center text-sm",children:[e.jsxs("select",{className:"input col-span-2",value:Q||"auto",onChange:tt=>{const mt=tt.target.value;if(console.debug("[DevicePicker] select onChange",mt,Date.now()),mt==="auto")try{G(void 0,"",!0)}catch{}else if(mt==="phone"){try{G(void 0,"Phone Camera",!0)}catch{}try{w("phone"),N("camera"),m(!1),R(!1)}catch{}}else{const ct=re.find(ss=>ss.deviceId===mt);if(ct)try{G(ct.deviceId,ct.label||"",!0)}catch{}}},children:[e.jsx("option",{value:"auto",children:"Auto (browser default)"}),re.map(tt=>e.jsx("option",{value:tt.deviceId,children:tt.label||"Camera"},tt.deviceId)),e.jsx("option",{value:"phone",children:"ðŸ“± Phone Camera"})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn px-2 py-1",onClick:()=>{Mt(Q||void 0)},disabled:h,children:"Test"})})]}),se&&e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["Selected: ",se]}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Tip: All camera technology is supported for autoscoring needsâ€”select your camera here and then open Calibrator to align."})]})}if(z&&!H){const B=Qe??(typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html");return e.jsxs("div",{className:"mx-auto flex min-h-[calc(100vh-140px)] w-full max-w-xl flex-col justify-center gap-6 p-6",children:[e.jsxs("div",{className:"space-y-5 rounded-3xl border border-indigo-400/30 bg-slate-900/70 p-6 text-slate-100 shadow-xl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-indigo-300",children:"Mobile camera"}),e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-white",children:"This device is ready to stream as your dartboard camera"}),e.jsx("p",{className:"text-sm text-slate-200/80",children:"Open the lightweight mobile camera page to stream video to your desktop calibrator. You can still come back here if you need the full desktop tools."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:B,className:"btn w-full justify-center px-4 py-2 text-base",children:"Open mobile camera"}),e.jsx("button",{type:"button",className:"btn btn--ghost w-full justify-center px-4 py-2 text-sm",onClick:()=>ts(B,"link"),children:E==="link"?"Link copied!":"Copy link"})]}),e.jsxs("p",{className:"text-xs text-slate-300/70",children:["On a desktop, open Calibrator and generate a pairing code. Then tap ",e.jsx("span",{className:"font-semibold",children:"Pair with Desktop"})," from the mobile camera page to connect this device."]})]}),e.jsx("button",{type:"button",className:"self-center text-xs font-medium text-indigo-200 underline decoration-dotted decoration-indigo-300/70 transition hover:text-indigo-100",onClick:()=>_(!0),children:"Continue to desktop calibrator"})]})}return e.jsxs("div",{className:"space-y-6",children:[z&&H&&e.jsx("div",{className:"rounded-2xl border border-indigo-400/30 bg-indigo-500/10 p-4 text-sm text-indigo-100",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"leading-relaxed",children:"Using a phone? Switch back to the streamlined mobile camera interface for an easier pairing flow."}),e.jsx("button",{type:"button",className:"btn btn--ghost px-3 py-1 text-xs",onClick:()=>_(!1),children:"Open mobile camera mode"})]})}),e.jsxs("div",{className:"card space-y-6 p-6",children:[e.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-indigo-300",children:"Marker calibration"}),e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-white",children:"Align your board with the autoscoring overlay"}),e.jsx("p",{className:"max-w-2xl text-sm opacity-80",children:"Place the printable fiducial markers around the double ring, capture a clear frame, and let the calibrator compute a precise homography."})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 text-xs font-medium",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-indigo-400/50 bg-indigo-500/10 px-3 py-1",children:[e.jsx("span",{className:"opacity-60",children:"Mode"}),e.jsx("span",{children:C==="local"?"Desktop camera":C==="phone"?"Phone camera":"Wifi device"})]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 ${h?"border-emerald-400/60 bg-emerald-500/10 text-emerald-100":"border-white/20 bg-white/5 text-slate-200"}`,children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${h?"bg-emerald-400":"bg-slate-400"}`}),h?"Live stream active":"Stream idle"]}),Be?e.jsxs("div",{className:"space-y-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 p-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-emerald-500/20",children:e.jsx("span",{className:"text-lg",children:"âœ“"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-emerald-100",children:"Calibration active"}),e.jsx("p",{className:"text-xs opacity-80",children:"Your calibration is saved and active across all game modes. It will be used in Online, Offline, and Tournaments."})]})]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs whitespace-nowrap",onClick:()=>ee({locked:!1}),title:"Unlock to recalibrate",children:"Unlock"})]}),ke!=null&&e.jsxs("div",{className:"text-xs opacity-75",children:["Precision: ",ke.toFixed(2)," px RMS error"]})]}):null]})]}),e.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(320px,1fr)]",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4 rounded-2xl border border-white/10 bg-black/40 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"uppercase tracking-wide opacity-60",children:"Video source"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:`btn px-3 py-1 ${C==="local"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{w("local"),ot(!1)},title:"Use local camera",children:"Local"}),e.jsx("button",{className:`btn px-3 py-1 ${C==="phone"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{w("phone"),ot(!1)},title:"Pair phone camera",children:"Phone"}),e.jsx("button",{className:`btn px-3 py-1 ${C==="wifi"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{w("wifi"),ot(!1),_t()},title:"Discover wifi/USB autoscoring devices",children:"Wifi"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-70",children:"Zoom"}),e.jsx("input",{type:"range",min:50,max:200,step:5,value:Math.round((p||1)*100),onChange:B=>F(Math.max(.5,Math.min(2,Number(B.target.value)/100)))}),e.jsxs("span",{className:"w-12 text-right",children:[Math.round((p||1)*100),"%"]})]}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>F(1),children:"Actual"})]})]}),e.jsxs("div",{className:"relative w-full overflow-hidden rounded-2xl border border-indigo-400/30 bg-black",style:{aspectRatio:A?`${A.w} / ${A.h}`:"16 / 9"},children:[(C==="phone"?!h||!ft:!h)&&e.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-gradient-to-br from-black/40 to-black/10",children:e.jsx(Xd,{calibrationComplete:y==="computed"})}),e.jsxs("div",{className:"absolute inset-0",style:{transform:`scale(${p||1})`,transformOrigin:"center center"},children:[e.jsx("video",{ref:t,onLoadedMetadata:B=>{try{const Q=B.currentTarget;Q.videoWidth&&Q.videoHeight&&v({w:Q.videoWidth,h:Q.videoHeight})}catch{}},className:`absolute inset-0 h-full w-full object-cover transition-opacity duration-300 ${M?"opacity-0 -z-10":"opacity-100 z-10"}`,autoPlay:!0,playsInline:!0,muted:!0,controls:!1}),x&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur",children:e.jsx("button",{className:"rounded-lg bg-white px-4 py-2 font-semibold text-slate-900 shadow-lg",onClick:async()=>{try{await t.current?.play(),b(!1),m(!0),N("capture")}catch(B){console.warn("Tap-to-play retry failed",B),alert("Tap to enable video failed. Please check browser settings or reload the page.")}},children:"Tap to allow video"})}),e.jsx("canvas",{ref:a,className:`absolute inset-0 h-full w-full transition-opacity duration-300 ${M?"opacity-100 z-10":"opacity-0 -z-10"}`}),e.jsx("canvas",{ref:s,onClick:Ps,className:"absolute inset-0 z-30 h-full w-full cursor-crosshair"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",className:"accent-indigo-600",checked:Oe,onChange:B=>je(B.target.checked)}),"Show preferred-view guide overlay"]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-3 overflow-visible",children:[e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 overflow-visible",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Stage 1 Â· Capture"}),e.jsx("p",{className:"text-xs opacity-70",children:"Start your camera or upload a photo to capture the board."}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[C==="local"&&e.jsx("button",{className:"btn",onClick:we,children:"Enable camera"}),C==="phone"&&e.jsx("button",{className:"btn",onClick:Tt,children:"Pair phone camera"}),C==="wifi"&&e.jsx("button",{className:"btn",onClick:_t,children:"Connect wifi camera"}),e.jsx("button",{className:"btn",onClick:Cs,disabled:!h,children:"Capture frame"}),e.jsx("button",{className:"btn",onClick:ks,children:"Upload photo"})]})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Stage 2 Â· Auto-Calibrate"}),e.jsx("p",{className:"text-xs opacity-70",children:"Automatically detect dartboard rings and compute calibration without any markers or clicking."}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 font-semibold",disabled:!M,onClick:Os,children:"ðŸŽ¯ Auto-Calibrate (Advanced)"}),e.jsx("button",{className:"btn",disabled:!M,onClick:Vt,children:"Legacy: Auto detect rings"}),e.jsx("button",{className:"btn",disabled:!M,onClick:as,children:"Legacy: Detect markers (print required)"}),e.jsx("button",{className:"btn btn--ghost",onClick:vs,children:"Print markers"})]}),e.jsxs("div",{className:"mt-2 text-xs opacity-70",children:["Confidence: ",me,"%"]})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Stage 3 Â· Align & lock"}),e.jsx("p",{className:"text-xs opacity-70",children:"Click the board points, refine edges and lock calibration when satisfied."}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsx("button",{className:"btn",disabled:D.length<4,onClick:ws,children:"Compute"}),e.jsx("button",{className:`btn ${Be?"bg-emerald-600 hover:bg-emerald-700":""}`,onClick:()=>ee({locked:!Be}),children:Be?"Unlock":"Lock in"}),e.jsx("button",{className:"btn",onClick:()=>Ls(),children:"Verify"})]})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-lg border border-blue-500/30 bg-blue-500/10 p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-blue-300 mb-1",children:"ðŸ’¡ Pro Tip for Perfect Calibration"}),e.jsxs("div",{className:"text-xs opacity-80",children:["Click the 4 corners of the double ring at ",e.jsx("span",{className:"font-semibold",children:"D20, D6, D3, and D11"}),", then click the ",e.jsx("span",{className:"font-semibold",children:"center bull"}),". This evenly-spaced layout provides the most accurate calibration."]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Phase"}),e.jsx("div",{className:"text-sm font-semibold capitalize",children:y})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Points selected"}),e.jsxs("div",{className:"text-sm font-semibold",children:[D.length," / 5"]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Fit error"}),e.jsx("div",{className:"text-sm font-semibold",children:ke!=null?`${ke.toFixed(2)} px`:"â€”"})]})]})]}),e.jsxs("aside",{className:"space-y-4",children:[e.jsx(Bs,{}),C==="phone"&&e.jsxs("section",{className:"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white",children:[e.jsx("div",{className:"font-semibold",children:"Phone pairing"}),e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>ts($e,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all text-[11px]",children:$e}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:E==="link"?"Copied!":"Copy link"})]}),e.jsx("div",{className:"flex items-center gap-2 text-[11px]",children:e.jsx("a",{href:$e,target:"_blank",rel:"noreferrer",className:"underline decoration-dotted text-indigo-200 hover:text-indigo-100 transition",children:"Open link in new tab"})}),e.jsxs("div",{className:"opacity-80",children:["WS: ",fe?fe.readyState===1?"open":fe.readyState===0?"connecting":fe.readyState===2?"closing":"closed":"not started"," Â· ",et?.https?"HTTPS on":"HTTP only"]}),De&&e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>ts(De,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:De}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:E==="code"?"Copied!":"Copy code"})]}),We&&e.jsx("img",{className:"mt-1 h-40 w-40 bg-white",alt:"Scan to open",src:We}),e.jsxs("div",{className:"flex items-center gap-2",children:[Lt!==null&&e.jsxs("span",{children:["Expires in ",Lt,"s"]}),e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:us,children:"Regenerate"})]}),os&&e.jsxs("div",{className:"space-y-2 rounded-lg border border-slate-700/50 bg-slate-900/60 p-3 text-slate-200",children:[e.jsx("div",{className:"font-semibold",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc space-y-1 pl-4",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",et?.https?et.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer HTTPS when enabled)."})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>ls(!1),children:"Hide tips"})})]})]})]})]}),C==="wifi"&&!h&&e.jsxs("div",{className:"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white",children:[e.jsx("div",{className:"font-semibold",children:"Wifi scoring devices"}),Yt?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-white"}),e.jsx("span",{children:"Scanning network for devicesâ€¦"})]}):es.length>0?e.jsxs("div",{className:"space-y-2",children:[es.map(B=>e.jsxs("div",{className:"flex items-center justify-between rounded border border-slate-700/50 bg-slate-900/60 p-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:B.name}),e.jsxs("div",{className:"opacity-70",children:[B.ip,":",B.port," Â· ",B.type.toUpperCase()]}),e.jsxs("div",{className:"opacity-70 text-xs",children:["Capabilities: ",B.capabilities.join(", ")]})]}),e.jsx("button",{className:`btn px-2 py-1 text-xs ${B.status==="connecting"?"bg-yellow-600":B.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>V(B),disabled:B.status==="connecting",children:B.status==="connecting"?"Connectingâ€¦":"Connect"})]},B.id)),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:_t,children:"Rescan network"})})]}):e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("div",{children:"No wifi scoring devices found."}),e.jsx("div",{className:"opacity-70",children:"Ensure your wifi cameras are powered on and on the same network."}),e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:_t,children:"Scan again"})]})]})]})]})}const nm=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function am(t){return t==="DB"?50:Number(t.slice(1))*2}function rm(t){return nm.includes(t)?am(t):32}function Mi(t,a="D16"){if(t>170||t<=1)return[];const s={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(s[t])return s[t];const r=rm(a),n=[];for(const i of[60,57,54,51,48])if(t-i===r){n.push(`T${i/3} ${a}`);break}if(!n.length){for(const i of[20,19,18,17,16,15])if(t-i===r){n.push(`${i} ${a}`);break}}return n}function Mn(t,a,s,r,n){try{const i=window.speechSynthesis;if(!i)return;const l=new SpeechSynthesisUtterance,o=s<=170&&s>0;if(n?.checkoutOnly&&!o)return;if(l.text=o?`${t}, you have ${s} remaining.`:`${a}`,r){const d=i.getVoices().find(c=>c.name===r);d&&(l.voice=d)}typeof n?.volume=="number"&&(l.volume=Math.max(0,Math.min(1,n.volume))),l.rate=1,l.pitch=1,i.speak(l)}catch{}}const mr={X01:{tolerancePx:10,requiredTargets:["SINGLE","DOUBLE","TREBLE","BULL","OUTER_BULL"],criticalZones:["D20","D1","BULLSEYE","T20","SINGLE_20"],minConfidence:80},"Double Practice":{tolerancePx:12,requiredTargets:["DOUBLE","BULL"],criticalZones:["D20","D1","D6","D17"],minConfidence:75},"Treble Practice":{tolerancePx:8,requiredTargets:["TREBLE"],criticalZones:["T20","T1","T5"],minConfidence:85},"Checkout 170":{tolerancePx:9,requiredTargets:["DOUBLE"],criticalZones:["D25","D20","D8"],minConfidence:82},"Checkout 121":{tolerancePx:9,requiredTargets:["DOUBLE"],criticalZones:["D20","D5","D1"],minConfidence:82},Cricket:{tolerancePx:15,requiredTargets:["20","19","18","17","16","15","BULL"],criticalZones:["20","15","BULL"],minConfidence:70},"American Cricket":{tolerancePx:15,requiredTargets:["20","19","18","17","16","15","BULL"],criticalZones:["20","15","BULL"],minConfidence:70},"Around the Clock":{tolerancePx:12,requiredTargets:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],criticalZones:["1","20","6","15"],minConfidence:78},Shanghai:{tolerancePx:13,requiredTargets:["1","2","3","4","5","6","7","SINGLE","DOUBLE","TREBLE"],criticalZones:["1","7","S1","D1","T1"],minConfidence:75},"High Score":{tolerancePx:14,requiredTargets:["TREBLE","DOUBLE","BULL"],criticalZones:["T20","BULL","D20"],minConfidence:72},"Low Score":{tolerancePx:11,requiredTargets:["SINGLE"],criticalZones:["1","2","3"],minConfidence:76},"Count-Up":{tolerancePx:13,requiredTargets:["SINGLE","DOUBLE","TREBLE"],criticalZones:["20","DOUBLE","TREBLE"],minConfidence:74},"Halve It":{tolerancePx:12,requiredTargets:["TREBLE","SINGLE"],criticalZones:["T20","T5","SINGLE"],minConfidence:73},"High-Low":{tolerancePx:13,requiredTargets:["SINGLE","DOUBLE","BULL"],criticalZones:["HIGH (>10)","LOW (<5)","BULL"],minConfidence:72},Killer:{tolerancePx:12,requiredTargets:["ALL_NUMBERS"],criticalZones:["RANDOM_TARGETS"],minConfidence:74},Baseball:{tolerancePx:14,requiredTargets:["1-9","SINGLE","DOUBLE","TREBLE"],criticalZones:["1","9","TRIPLE"],minConfidence:71},Golf:{tolerancePx:14,requiredTargets:["1-18","TREBLE"],criticalZones:["T1","T18"],minConfidence:71},"Tic Tac Toe":{tolerancePx:16,requiredTargets:["1-9","SINGLE"],criticalZones:["CENTER","CORNERS"],minConfidence:68},"Bob's 27":{tolerancePx:13,requiredTargets:["SINGLE","DOUBLE"],criticalZones:["1-20","BULL"],minConfidence:73},Scam:{tolerancePx:14,requiredTargets:["ALL_NUMBERS","OUTER_BULL"],criticalZones:["TARGET_NUMBER","OUTER_BULL"],minConfidence:70},Fives:{tolerancePx:14,requiredTargets:["ALL_NUMBERS","OUTER_BULL"],criticalZones:["5","10","15","20"],minConfidence:70},Sevens:{tolerancePx:14,requiredTargets:["ALL_NUMBERS","OUTER_BULL"],criticalZones:["7","14"],minConfidence:70}};function hr(t,a){if(!a||a<0)return 0;const s=mr[t];if(!s)return 50;if(a<=s.tolerancePx)return Math.min(100,100-a/s.tolerancePx*20);{const r=a-s.tolerancePx;return Math.max(0,50-r*2)}}function im(t,a){if(!a)return!1;const s=mr[t];return s?hr(t,a)>=s.minConfidence:!0}function ic(t,a){if(!a)return{quality:"none",text:"Not calibrated"};const s=hr(t,a);return s>=90?{quality:"excellent",text:`Excellent (${Math.round(s)}%)`}:s>=75?{quality:"good",text:`Good (${Math.round(s)}%)`}:s>=50?{quality:"fair",text:`Fair (${Math.round(s)}%)`}:{quality:"poor",text:`Poor (${Math.round(s)}%)`}}function om(t){const a=mr[t];return!a||a.criticalZones.length===0?null:`Recalibrate focusing on: ${a.criticalZones.join(", ")}`}function oc({gameMode:t,compact:a=!1,onRecalibrate:s}){const{H:r,errorPx:n}=wa(),i=hr(t,n),l=im(t,n),{quality:o,text:d}=ic(t,n),c=om(t),h=mr[t];if(!r||!n)return a?e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30",children:[e.jsx(Xa,{className:"w-3 h-3"}),"Not calibrated"]}):e.jsxs("div",{className:"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2",children:[e.jsx(Xa,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-red-300",children:"Calibration Required"}),e.jsxs("div",{className:"text-xs opacity-80",children:["Please calibrate before playing ",t]})]}),s&&e.jsx("button",{className:"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700",onClick:s,children:"Calibrate"})]});const m=l?"bg-emerald-500/20 border-emerald-600/30":"bg-amber-500/20 border-amber-600/30",x=l?"text-emerald-300":"text-amber-300",b=l?nd:Xa;return a?e.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${m} ${x}`,children:[Si.createElement(b,{className:"w-3 h-3"}),e.jsx("span",{children:d}),!l&&c&&e.jsx("span",{className:"w-3 h-3 cursor-help",title:c,children:e.jsx(ad,{className:"w-3 h-3 inline"})})]}):e.jsxs("div",{className:`px-3 py-2 rounded border ${m} space-y-1`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Si.createElement(b,{className:`w-4 h-4 ${l?"text-emerald-400":"text-amber-400"} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`font-medium ${l?"text-emerald-300":"text-amber-300"}`,children:["Calibration for ",t]}),e.jsxs("div",{className:"text-xs opacity-80",children:["Error: ",Math.round(n),"px | ",d]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 rounded bg-black/30 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${l?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Math.min(100,i)}%`}})}),e.jsxs("span",{className:"text-xs font-mono",children:[Math.round(i),"%"]})]}),h&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{children:["Tolerance: Â±",h.tolerancePx,"px | Min: ",h.minConfidence,"%"]})}),e.jsxs("div",{className:"space-y-1",children:[!l&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1",children:[e.jsx(Xa,{className:"w-3 h-3 flex-shrink-0"}),"Calibration quality is below minimum for ",t]}),c&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1",children:[e.jsx(ki,{className:"w-3 h-3 flex-shrink-0"}),c]})]}),!l&&s&&e.jsxs("button",{className:"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700",onClick:s,children:["Recalibrate for ",t]})]})}const lm={};function cr({label:t,autoStart:a=!1,scale:s,className:r,aspect:n="inherit",style:i,fill:l=!1}){const o=u.useRef(null),d=Zn(),[c,h]=u.useState(!1),[m,x]=u.useState(null),[b,y]=u.useState(null),[N,C]=u.useState(null),w=qt(le=>le.preferredCameraLabel),[D,I]=u.useState(()=>{if(w==="Phone Camera")return console.log("[CAMERATILE] Initializing mode to phone (from preferred camera selection)"),"phone";const le=localStorage.getItem("ndn:camera:mode");return console.log("[CAMERATILE] Initializing mode to",le||"local","(from localStorage)"),le||"local"}),[M,R]=u.useState(null),[A,v]=u.useState(Date.now()),[p,F]=u.useState(!1),[H,_]=u.useState(null),[z,T]=u.useState(null),[K,ee]=u.useState(!0),[ie,ke]=u.useState([]),[Be,Ue]=u.useState(!1),[Oe,je]=u.useState([]),[Re,$]=u.useState(!1),te=qt(le=>le.autoscoreProvider),ce=qt(le=>le.setPreferredCameraLocked);if(te==="manual"){const fe=[l?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",r].filter(Boolean).join(" ").trim(),ne={...i||{}};return!l&&ne.aspectRatio===void 0&&ne.height===void 0&&ne.minHeight===void 0&&(ne.aspectRatio="4 / 3"),e.jsx("div",{className:fe,style:ne,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}u.useEffect(()=>{const le=window.location.hostname;(le==="localhost"||le==="127.0.0.1")&&Kt("/api/hosts").then(fe=>fe.json()).then(fe=>{const ne=Array.isArray(fe?.hosts)&&fe.hosts.find(Z=>Z);ne&&_(ne)}).catch(()=>{}),Kt("/api/https-info").then(fe=>fe.json()).then(fe=>{fe&&typeof fe.https=="boolean"&&T({https:!!fe.https,port:Number(fe.port)||8788})}).catch(()=>{})},[]);const ze=u.useMemo(()=>{const le=b||"____",fe="ws://localhost:8787";if(fe.length>0)try{const Ne=new URL(fe);return`${`${Ne.protocol==="wss:"?"https":"http"}://${Ne.host}${Ne.pathname.endsWith("/ws")?"":Ne.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${le}`}catch{}const ne=H||window.location.hostname,Z=!!z?.https,He=Z?z?.port||8788:8787;return`${Z?"https":"http"}://${ne}:${He}/mobile-cam.html?code=${le}`},[b,H,z]);u.useEffect(()=>{console.log("[CAMERATILE] Mode changed to:",D,"- persisting to localStorage"),localStorage.setItem("ndn:camera:mode",D)},[D]),u.useEffect(()=>{const le=qt.getState().ignorePreferredCameraSync;console.log("[CAMERATILE] Checking camera selection sync: preferredCameraLabel=",w,"mode=",D,"ignoreSync=",le),!le&&w==="Phone Camera"&&D!=="phone"&&(console.log("[CAMERATILE] Syncing mode to phone from Calibrator selection"),I("phone"))},[w,D]);const[Pe,Te]=u.useState("");u.useEffect(()=>{if(!b){Te("");return}const le=lm?.VITE_QR_LOGO_URL||"/dart-thrower.svg";Xl(ze,{width:160,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"},logo:{logoUrl:le,logoScale:.2,mask:!0,shape:"circle"}}).then(Te).catch(()=>Te(""))},[ze,b]),u.useEffect(()=>{if(!M)return;const le=setInterval(()=>v(Date.now()),1e3);return()=>clearInterval(le)},[M]);const Ee=u.useMemo(()=>M?Math.max(0,Math.ceil((M-A)/1e3)):null,[M,A]);u.useEffect(()=>{a?ht().catch(()=>{}):Ce()},[a,w]),u.useEffect(()=>{const le=async()=>{try{if(w!=="Phone Camera"&&D!=="phone")return;const ne=d.getMediaStream(),Z=o.current;if(!Z||!ne)return;Z.srcObject!==ne&&(Z.srcObject=ne),Z.muted=!0,Z.playsInline=!0;try{await Z.play()}catch{}h(!0)}catch{}};le();const fe=setInterval(le,800);return()=>clearInterval(fe)},[w,D,d,d.isStreaming]);async function ht(){if(D==="wifi")return me();if(w==="Phone Camera"||D==="phone"){const le=d.getMediaStream();if(le&&o.current)try{o.current.srcObject=le,await o.current.play(),h(!0);return}catch{}}try{const{preferredCameraId:le,setPreferredCamera:fe}=qt.getState(),ne=le?{video:{deviceId:{exact:le}},audio:!1}:{video:!0,audio:!1};let Z;try{Z=await navigator.mediaDevices.getUserMedia(ne)}catch(He){const ye=He&&(He.name||He.code)||"";if(le&&(ye==="OverconstrainedError"||ye==="NotFoundError"))Z=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw He}o.current&&(o.current.srcObject=Z,await o.current.play(),h(!0))}catch{}}function Ce(){o.current&&o.current.srcObject&&(o.current.srcObject.getTracks().forEach(fe=>fe.stop()),o.current.srcObject=null,h(!1))}async function me(){Ue(!0);try{const le=await nc();ke(le),le.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(le){console.error("Wifi device discovery failed:",le),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Ue(!1)}}async function Le(le){try{ke(ne=>ne.map(Z=>Z.id===le.id?{...Z,status:"connecting"}:Z));const fe=await rc(le);if(fe&&o.current)o.current.srcObject=fe,await o.current.play(),h(!0),ke(ne=>ne.map(Z=>Z.id===le.id?{...Z,status:"online"}:Z));else throw new Error("Failed to get video stream")}catch(fe){console.error("Failed to connect to wifi device:",fe),alert(`Failed to connect to ${le.name}. Please check the device and try again.`),ke(ne=>ne.map(Z=>Z.id===le.id?{...Z,status:"offline"}:Z))}}async function pt(){$(!0);try{const le=await Qu();je(le);const fe=await Zu();fe&&je(ne=>[...ne,fe]),le.length===0&&!fe&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(le){console.error("USB device discovery failed:",le),alert("Failed to discover USB devices. Please check device connections.")}finally{$(!1)}}async function It(le){try{je(ne=>ne.map(Z=>Z.id===le.id?{...Z,status:"connecting"}:Z));const fe=await em(le);if(fe&&o.current)o.current.srcObject=fe,await o.current.play(),h(!0),I("wifi"),je(ne=>ne.map(Z=>Z.id===le.id?{...Z,status:"online"}:Z));else throw new Error("Failed to get video stream")}catch(fe){console.error("Failed to connect to USB device:",fe),alert(`Failed to connect to ${le.name}. Please check the device and try again.`),je(ne=>ne.map(Z=>Z.id===le.id?{...Z,status:"offline"}:Z))}}function is(){if(m&&m.readyState===WebSocket.OPEN)return m;const le="ws://localhost:8787",fe=le.length>0?le.endsWith("/ws")?le:le.replace(/\/$/,"")+"/ws":void 0,ne=window.location.protocol==="https:"?"wss":"ws",Z=`${ne}://${window.location.host}/ws`,He=window.location.hostname,ye=He==="localhost"||He==="127.0.0.1",Ne=He.endsWith("onrender.com"),Xe="wss://ninedartnation.onrender.com/ws";let rt=fe;rt||(ye?rt=`${ne}://${He}:8787/ws`:Ne?rt=Z:rt=Xe),rt||(rt=Z);const ft=new WebSocket(rt);return x(ft),ft}async function Ke(){I("phone"),F(!1);const le=is();le.readyState===WebSocket.OPEN?le.send(JSON.stringify({type:"cam-create"})):le.onopen=()=>le.send(JSON.stringify({type:"cam-create"})),le.onmessage=async fe=>{const ne=JSON.parse(fe.data);if(ne.type==="cam-code")y(ne.code),ne.expiresAt&&R(ne.expiresAt);else if(ne.type==="cam-peer-joined"){F(!0);const Z=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});C(Z),Z.onicecandidate=ye=>{ye.candidate&&b&&le.send(JSON.stringify({type:"cam-ice",code:b,payload:ye.candidate}))},Z.ontrack=ye=>{if(o.current){const Ne=ye.streams?.[0];Ne&&(o.current.srcObject=Ne,o.current.play().catch(()=>{}),h(!0))}};const He=await Z.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await Z.setLocalDescription(He),b&&le.send(JSON.stringify({type:"cam-offer",code:b,payload:He}))}else if(ne.type==="cam-answer")N&&await N.setRemoteDescription(new RTCSessionDescription(ne.payload));else if(ne.type==="cam-ice"&&N)try{await N.addIceCandidate(ne.payload)}catch{}}}function De(){y(null),R(null),F(!1),m&&m.readyState===WebSocket.OPEN?m.send(JSON.stringify({type:"cam-create"})):Ke();try{ce(!0)}catch{}}function Pt(){if(Ce(),y(null),F(!1),R(null),N){try{N.close()}catch{}C(null)}}return e.jsx(cm,{label:t,autoStart:a,start:ht,stopAll:Pt,startPhonePairing:Ke,startWifiConnection:me,startUsbConnection:pt,connectToWifiDevice:Le,connectToUsbDevice:It,videoRef:o,streaming:c,mode:D,setMode:I,pairCode:b,mobileUrl:ze,ttl:Ee,qrDataUrl:Pe,regenerateCode:De,httpsInfo:z,showTips:K,setShowTips:ee,wifiDevices:ie,usbDevices:Oe,discoveringWifi:Be,discoveringUsb:Re,scaleOverride:s,className:r,aspect:n,style:i,fill:l})}function cm(t){const a=Zn(),{cameraScale:s,cameraAspect:r}=qt(),{label:n,start:i,stopAll:l,startPhonePairing:o,startWifiConnection:d,startUsbConnection:c,connectToWifiDevice:h,connectToUsbDevice:m,videoRef:x,streaming:b,mode:y,setMode:N,pairCode:C,mobileUrl:w,ttl:D,qrDataUrl:I,regenerateCode:M,httpsInfo:R,showTips:A,setShowTips:v,wifiDevices:p,usbDevices:F,discoveringWifi:H,discoveringUsb:_,className:z,aspect:T,style:K,fill:ee}=t,[ie,ke]=u.useState(null),Be=u.useRef(null);u.useEffect(()=>()=>{Be.current&&window.clearTimeout(Be.current)},[]);const{cameraFitMode:Ue}=qt(),Oe=ee?"fill":Ue||"fill",je=(()=>{const me=Number(t.scaleOverride??s??1),Le=Math.max(.5,Math.min(1.25,me));return Oe==="fill"?Math.max(1,Le):Le})(),Re=ee&&Oe==="fill"?"free":T&&T!=="inherit"?T:r||"wide",$=Re!=="free",te=$?Re==="square"?"aspect-square":Re==="portrait"?"aspect-[3/4]":Re==="classic"?"aspect-[4/3]":"aspect-video":"",ze=[ee?"rounded-2xl overflow-hidden bg-transparent w-full flex flex-col":"rounded-2xl overflow-hidden bg-transparent w-full mx-auto flex flex-col",z].filter(Boolean).join(" ").trim(),Pe={...K||{}},Te=ee?"relative flex-1 min-h-[220px] bg-black":"relative w-full bg-black",Ee={style:{transform:`scale(${je})`,transformOrigin:"center"}},ht=(()=>{const Le=Oe==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return ee?$?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${te}`,children:e.jsx("video",{ref:x,className:Le,...Ee})})}):e.jsx("video",{ref:x,className:Le,...Ee}):$?e.jsx("div",{className:`relative w-full ${te}`,children:e.jsx("video",{ref:x,className:Le,...Ee})}):e.jsx("video",{ref:x,className:Le,...Ee})})();async function Ce(me,Le){if(me)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(me);else{const pt=document.createElement("textarea");pt.value=me,pt.style.position="fixed",pt.style.opacity="0",document.body.appendChild(pt),pt.focus(),pt.select(),document.execCommand("copy"),document.body.removeChild(pt)}ke(Le),Be.current&&window.clearTimeout(Be.current),Be.current=window.setTimeout(()=>ke(null),1500)}catch(pt){console.warn("Copy to clipboard failed:",pt),ke(null)}}return e.jsxs("div",{className:ze,style:Pe,children:[e.jsxs("div",{className:Te,children:[ht,a.isStreaming&&y==="phone"&&e.jsxs("div",{className:"absolute top-2 left-2 z-10 flex items-center gap-1 px-2 py-0.5 rounded-full bg-black/60 border border-rose-500/50 text-[10px] text-rose-200",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"REC"})]})]}),e.jsxs("div",{className:"p-1 flex items-center justify-between bg-black/60 text-white text-[10px] gap-1",children:[e.jsx("span",{className:"truncate",children:n||(b?y==="phone"?"PHONE LIVE":y==="wifi"?"WIFI LIVE":"LIVE":"Camera")}),e.jsxs("div",{className:"flex items-center gap-1",children:[!b&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-1 py-0.5 rounded ${y==="local"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{N("local"),i()},children:"Local"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${y==="phone"?"bg-emerald-600":"bg-slate-700"}`,onClick:o,children:"Phone"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${y==="wifi"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{N("wifi"),d()},children:"Wifi"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${y==="wifi"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{N("wifi"),c()},children:"USB"})]}),b?e.jsx("button",{className:"px-1 py-0.5 rounded bg-rose-600",onClick:l,children:"Stop"}):null]})]}),y==="phone"&&C&&!b&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>Ce(w,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:w}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:ie==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:w,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>Ce(C,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:C}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:ie==="code"?"Copied!":"Copy"})]})]}),I&&e.jsx("img",{className:"mt-1 w-[160px] h-[160px] bg-white rounded",alt:"Scan to open",src:I}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[D!==null&&e.jsxs("span",{children:["Expires in ",D,"s"]}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:M,children:"Regenerate"})]}),A&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",R?.https?R.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>v(!1),children:"Hide tips"})})]})]}),y==="wifi"&&!b&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),H?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):p.length>0?e.jsxs("div",{className:"space-y-1",children:[p.map(me=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:me.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[me.ip,":",me.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${me.status==="connecting"?"bg-yellow-600":me.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>h(me),disabled:me.status==="connecting",children:me.status==="connecting"?"...":"Connect"})]},me.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:d,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:d,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),_?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):F.length>0?e.jsxs("div",{className:"space-y-1",children:[F.map(me=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:me.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:me.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${me.status==="connecting"?"bg-yellow-600":me.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>m(me),disabled:me.status==="connecting",children:me.status==="connecting"?"...":"Connect"})]},me.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:c,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:c,children:"Scan USB"})]})]})]})]})}const Js=Qs((t,a)=>({recent:[],totals:{visits:0,darts:0,points:0,finishes:0,busts:0,byMode:{}},calibration:{hasHomography:!1,imageSize:null,lastUpdated:void 0},recordVisit:(s,r,n,i)=>t(l=>{const d={ts:Date.now(),mode:s,darts:r,visitTotal:n,preOpenDarts:i?.preOpenDarts,preRemaining:i?.preRemaining,postRemaining:i?.postRemaining,bust:i?.bust,finish:i?.finish},c=[...l.recent,d].slice(-50),h={...l.totals};h.visits+=1,h.darts+=r,h.points+=n,d.finish&&(h.finishes+=1),d.bust&&(h.busts+=1);const m=h.byMode[s]||{visits:0,darts:0,points:0};m.visits+=1,m.darts+=r,m.points+=n,h.byMode[s]=m;try{const x=d.finish?"FINISH":d.bust?"BUST":"VISIT";console.info(`[Audit:${x}]`,{mode:s,darts:r,visitTotal:n,preOpenDarts:d.preOpenDarts??0,preRemaining:d.preRemaining,postRemaining:d.postRemaining})}catch{}try{localStorage.setItem("ndn_audit_recent",JSON.stringify(c))}catch{}return{...l,recent:c,totals:h}}),setCalibrationStatus:s=>t(r=>{const n={hasHomography:s.hasHomography??r.calibration.hasHomography,imageSize:s.imageSize===void 0?r.calibration.imageSize:s.imageSize,lastUpdated:Date.now()};try{console.info("[Audit:Calibration]",n)}catch{}return{...r,calibration:n}}),reset:()=>t({recent:[],totals:{visits:0,darts:0,points:0,finishes:0,busts:0,byMode:{}},calibration:{hasHomography:!1,imageSize:null,lastUpdated:void 0}})}));try{typeof window<"u"&&(window.__NDN_AUDIT__={get:()=>Js.getState(),subscribe:Js.subscribe,reset:()=>Js.getState().reset()})}catch{}try{if(typeof window<"u"){const t=localStorage.getItem("ndn_audit_recent");if(t){const a=JSON.parse(t);Array.isArray(a)&&a.length&&Js.setState(s=>({...s,recent:a.slice(-50)}))}}}catch{}function dm(t){return t.dartsThrown===0?0:(t.totalScoreStart-t.totalScoreRemaining)/t.dartsThrown*3}function um(t){const a=dm(t),s=t.finished;return{avg:a,isCompleted:s,darts:t.dartsThrown,checkout:t.checkoutScore??0}}function mm(t){if(t.legs.length===0)return;const a=[];let s,r=t.bestCheckout??0;for(const n of t.legs){if(!n.finished)continue;const i=um(n);a.push(i.avg),(!s||i.darts<s.darts||i.darts===s.darts&&(n.endTime??0)<s.timestamp)&&(s={darts:i.darts,timestamp:n.endTime??Date.now()}),i.checkout>r&&(r=i.checkout)}a.length&&(t.bestThreeDartAvg=Math.max(...a),t.worstThreeDartAvg=Math.min(...a)),s&&(t.bestNineDart=s),t.bestCheckout=r}const ya=Qs((t,a)=>({roomId:"",players:[],currentPlayerIdx:0,startingScore:501,inProgress:!1,newMatch:(s,r,n="")=>t(()=>({players:s.map((l,o)=>({id:`${o}`,name:l,legsWon:0,legs:[]})),currentPlayerIdx:0,startingScore:r,inProgress:!0,roomId:n,bestLegThisMatch:void 0})),addVisit:(s,r,n)=>t(i=>{if(!i.inProgress)return i;const l=i.players[i.currentPlayerIdx];let o=l.legs[l.legs.length-1];(!o||o.finished)&&(o={visits:[],totalScoreStart:i.startingScore,totalScoreRemaining:i.startingScore,dartsThrown:0,finished:!1,checkoutScore:null,startTime:Date.now()},l.legs.push(o));const d=o.totalScoreRemaining,c=Math.max(0,d-s);o.visits.push({darts:r,score:s,preOpenDarts:n?.preOpenDarts,doubleWindowDarts:n?.doubleWindowDarts,finishedByDouble:n?.finishedByDouble,visitTotal:n?.visitTotal??s}),o.dartsThrown+=r,o.totalScoreRemaining=c;try{const h=s===0&&r>0&&c===d,m=c===0;Js.getState().recordVisit("x01-match",r,s,{preOpenDarts:n?.preOpenDarts??0,preRemaining:d,postRemaining:c,bust:h,finish:m})}catch{}return{...i}}),undoVisit:()=>t(s=>{const r=s.players[s.currentPlayerIdx],n=r.legs[r.legs.length-1];if(!n||n.finished||n.visits.length===0)return s;const i=n.visits.pop();return n.dartsThrown-=i.darts,n.totalScoreRemaining+=i.score,{...s}}),endLeg:s=>t(r=>{const n=r.players[r.currentPlayerIdx],i=n.legs[n.legs.length-1];if(!i||i.finished)return r;if(i.finished=!0,i.checkoutScore=s,i.endTime=Date.now(),i.totalScoreRemaining===0){n.legsWon+=1;const l=r.bestLegThisMatch;(!l||i.dartsThrown<l.darts)&&(r.bestLegThisMatch={playerId:n.id,darts:i.dartsThrown,timestamp:i.endTime})}return{...r}}),nextPlayer:()=>t(s=>({...s,currentPlayerIdx:(s.currentPlayerIdx+1)%s.players.length})),endGame:()=>t(s=>{for(const r of s.players)mm(r);return{...s,inProgress:!1}}),importState:s=>t(()=>({...s}))}));function gl(t,a){const s=ec(t,a);return Ii(s)}class hm{width=0;height=0;bg=null;lastAcceptTs=0;cooldownMs=600;roiRadius=0;roiCx=0;roiCy=0;initialized=!1;thresh=28;minArea=90;maxArea=6e3;prevTip=null;prevArea=0;stableCount=0;requireStableN=2;constructor(){}setROI(a,s,r){this.roiCx=a,this.roiCy=s,this.roiRadius=Math.max(0,r|0)}reset(a,s){this.width=a,this.height=s,this.bg=new Float32Array(a*s),this.initialized=!1}updateBackground(a,s=.05){const{width:r,height:n,data:i}=a;(!this.bg||r!==this.width||n!==this.height)&&this.reset(r,n);const l=this.bg,o=r*n;for(let d=0,c=0;d<o;d++,c+=4){const h=i[c],m=i[c+1],x=i[c+2],b=.299*h+.587*m+.114*x;this.initialized?l[d]=(1-s)*l[d]+s*b:l[d]=b}this.initialized=!0}inRoi(a,s){if(this.roiRadius<=0)return!0;const r=a-this.roiCx,n=s-this.roiCy;return r*r+n*n<=this.roiRadius*this.roiRadius}detect(a){const r=Date.now()-this.lastAcceptTs<this.cooldownMs,{width:n,height:i,data:l}=a;(!this.bg||n!==this.width||i!==this.height)&&this.reset(n,i);const o=this.bg;if(!this.initialized)return this.updateBackground(a,1),null;const d=n*i,c=new Uint8Array(d),h=new Float32Array(d);let m=0,x=0,b=0;const y=new Uint8Array(d);for(let ye=0,Ne=0;ye<d;ye++,Ne+=4){const Xe=l[Ne],rt=l[Ne+1],ft=l[Ne+2],Ve=Math.max(Xe,rt,ft),yt=Math.min(Xe,rt,ft),We=.299*Xe+.587*rt+.114*ft,wt=Math.abs(We-o[ye]);h[ye]=wt;const kt=Math.floor(ye/n),$t=ye-kt*n,et=Ve===0?0:(Ve-yt)/Ve,zt=Ve>=250&&et<=.12;zt&&(y[ye]=1),this.inRoi($t,kt)&&!zt&&(m+=wt,x+=wt*wt,b++)}const N=b?m/b:0,C=b?Math.max(0,x/b-N*N):0,w=Math.sqrt(C),D=Math.max(this.thresh,N+1.2*w);for(let ye=0;ye<d;ye++){if(y[ye]){c[ye]=0;continue}if(h[ye]>D){const Ne=Math.floor(ye/n),Xe=ye-Ne*n;c[ye]=this.inRoi(Xe,Ne)?1:0}}this._dilate(c,n,i),this._erode(c,n,i);const I=new Uint8Array(d);let M=0,R=null;for(let ye=0;ye<d;ye++){if(c[ye]===0||I[ye])continue;const Ne=[];let Xe=0,rt=0;const ft=[ye];for(I[ye]=1;rt<ft.length;){const Ve=ft[rt++];Ne.push(Ve),Xe++;const yt=Ve/n|0,We=[Ve-1,Ve+1,Ve-n,Ve+n];for(const wt of We)wt<0||wt>=d||I[wt]||(wt===Ve-1||wt===Ve+1)&&(wt/n|0)!==yt||c[wt]&&(I[wt]=1,ft.push(wt))}Xe>M&&(M=Xe,R=Ne)}if(!R||M<this.minArea||M>this.maxArea)return r||this.updateBackground(a,.02),null;let A=n,v=i,p=0,F=0,H=0,_=0;for(const ye of R){const Ne=ye/n|0,Xe=ye-Ne*n;H+=Xe,_+=Ne,Xe<A&&(A=Xe),Xe>p&&(p=Xe),Ne<v&&(v=Ne),Ne>F&&(F=Ne)}H/=M,_/=M;let z=0,T=0,K=0;for(const ye of R){const Ne=ye/n|0,rt=ye-Ne*n-H,ft=Ne-_;z+=rt*rt,T+=ft*ft,K+=rt*ft}z/=M,T/=M,K/=M;const ee=z+T,ie=z*T-K*K,ke=Math.sqrt(Math.max(0,ee*ee/4-ie)),Be=ee/2+ke;let Ue=K,Oe=Be-z;Math.hypot(Ue,Oe)<1e-6&&(Ue=Be-T,Oe=K);const je=Math.hypot(Ue,Oe)||1;Ue/=je,Oe/=je;const Re=H-this.roiCx,$=_-this.roiCy,te=Re*Ue+$*Oe>0?1:-1;Ue*=te,Oe*=te;const ce=Math.hypot(Re,$)||1,ze=Re/ce,Pe=$/ce,Te=Math.max(-1,Math.min(1,Ue*ze+Oe*Pe));if(Math.acos(Te)*180/Math.PI>55)return r||this.updateBackground(a,.02),null;let ht=-1/0,Ce=H,me=_;for(const ye of R){const Ne=ye/n|0,Xe=ye-Ne*n,rt=(Xe-H)*Ue+(Ne-_)*Oe;rt>ht&&(ht=rt,Ce=Xe,me=Ne)}const Le=Ce-this.roiCx,pt=me-this.roiCy,It=Le*Le+pt*pt,is=Math.max(1,p-A+1),Ke=Math.max(1,F-v+1),De=is*Ke,Pt=M/De,le=Math.sqrt(It)/Math.max(1,this.roiRadius);let fe=.5;Pt<.45&&(fe+=.2),Pt<.25&&(fe+=.15),le<1.1&&(fe+=.1);const ne=ee-Be;return(Be>0?1-ne/Be:0)>.3&&(fe+=.1),fe=Math.max(0,Math.min(1,fe)),!this._isStable({x:Ce+.5,y:me+.5},M)||r?null:{tip:{x:Ce+.5,y:me+.5},axis:{x1:H-Ue*20,y1:_-Oe*20,x2:H+Ue*20,y2:_+Oe*20},area:M,bbox:{x:A,y:v,w:is,h:Ke},confidence:fe}}accept(a,s){if(this.lastAcceptTs=Date.now(),this.prevTip=null,this.prevArea=0,this.stableCount=0,!this.bg)return;const{width:r}=a,n=this.bg,{x:i,y:l,w:o,h:d}=s.bbox,c=.5;for(let h=l;h<l+d;h++)for(let m=i;m<i+o;m++){const x=h*r+m,b=x*4,y=a.data[b],N=a.data[b+1],C=a.data[b+2],w=.299*y+.587*N+.114*C;n[x]=(1-c)*n[x]+c*w}}_isStable(a,s){const r=(n,i)=>Math.hypot(n.x-i.x,n.y-i.y)<=6;if(!this.prevTip)return this.prevTip={...a},this.prevArea=s,this.stableCount=1,!1;if(r(this.prevTip,a)&&Math.abs(s-this.prevArea)/Math.max(1,s)<.3)this.prevTip={...a},this.prevArea=s,this.stableCount++;else return this.prevTip={...a},this.prevArea=s,this.stableCount=1,!1;return this.stableCount>=this.requireStableN}_dilate(a,s,r){const n=new Uint8Array(a.length);for(let i=0;i<r;i++)for(let l=0;l<s;l++){let o=0;for(let d=-1;d<=1;d++){for(let c=-1;c<=1;c++){const h=i+d,m=l+c;if(!(h<0||h>=r||m<0||m>=s)&&a[h*s+m]){o=1;break}}if(o)break}n[i*s+l]=o}a.set(n)}_erode(a,s,r){const n=new Uint8Array(a.length);for(let i=0;i<r;i++)for(let l=0;l<s;l++){let o=1;for(let d=-1;d<=1;d++){for(let c=-1;c<=1;c++){const h=i+d,m=l+c;if(!(h<0||h>=r||m<0||m>=s)&&!a[h*s+m]){o=0;break}}if(!o)break}n[i*s+l]=o}a.set(n)}}function fm(t){try{if(!t||typeof t!="object")return null;if((t.type==="dart"||t.kind==="dart"||t.event==="dart")&&typeof t.value=="number"){const a=yl(t.ring);return vl(t.value,a)}if(typeof t.value=="number"&&t.ring){const a=yl(t.ring);return vl(t.value,a)}if(typeof t.score=="string"){const a=t.score.trim().toUpperCase();if(a==="50"||a==="DBULL"||a==="INNER_BULL")return{value:50,ring:"INNER_BULL",sector:null,mult:0};if(a==="25"||a==="BULL"||a==="OBULL")return{value:25,ring:"BULL",sector:null,mult:0};const s=a.match(/^(S|D|T)(\d{1,2})$/);if(s){const r=s[1]==="S"?1:s[1]==="D"?2:3,n=parseInt(s[2],10);if(n>=1&&n<=20)return{value:n*r,ring:r===1?"SINGLE":r===2?"DOUBLE":"TRIPLE",sector:n,mult:r}}}if(typeof t.sector=="number"&&typeof t.mult=="number"){const a=Math.max(1,Math.min(20,Math.floor(t.sector))),s=t.mult===1?1:t.mult===2?2:3;return{value:a*s,ring:s===1?"SINGLE":s===2?"DOUBLE":"TRIPLE",sector:a,mult:s}}if(t.bull){const a=String(t.bull).toLowerCase()==="inner"||t.bull===!0;return{value:a?50:25,ring:a?"INNER_BULL":"BULL",sector:null,mult:0}}}catch{}return null}function yl(t){const a=String(t||"").toUpperCase();return a.startsWith("TR")?"TRIPLE":a.startsWith("DO")?"DOUBLE":a.startsWith("SI")?"SINGLE":a==="INNER_BULL"||a==="DBULL"||a==="50"||a==="IBULL"?"INNER_BULL":a==="BULL"||a==="25"||a==="OBULL"||a==="OUTER_BULL"?"BULL":a==="MISS"||a==="0"?"MISS":"SINGLE"}function vl(t,a){const s=Math.max(0,Math.min(60,Math.round(Number(t)||0)));return a==="INNER_BULL"?{value:50,ring:a}:a==="BULL"?{value:25,ring:a}:{value:s,ring:a}}function xm(t,a){let s=null,r=!0,n=null,i=0;const l=400,o=[],d=new Set;function c(m,x){const b=typeof m?.id=="string"||typeof m?.id=="number"?String(m.id):null;if(b){if(d.has(b))return;if(d.add(b),o.push(b),o.length>200){const C=o.shift();C&&d.delete(C)}}const y=`${x.value}|${x.ring}|${x.sector??""}|${x.mult??""}`,N=Date.now();y===n&&N-i<l||(n=y,i=N,a(x))}function h(){if(r)try{s=new WebSocket(t),s.onmessage=m=>{try{const x=JSON.parse(m.data),b=fm(x);b&&c(x,b)}catch{}},s.onclose=()=>{s=null,setTimeout(h,1500)},s.onerror=()=>{}}catch{setTimeout(h,2e3)}}return h(),{close:()=>{r=!1;try{s?.close()}catch{}}}}function va({storageKey:t,children:a,className:s,defaultWidth:r=640,defaultHeight:n=360,minWidth:i=320,minHeight:l=200,maxWidth:o=1600,maxHeight:d=1200,autoFill:c=!1}){const[h,m]=u.useState(()=>{try{const I=localStorage.getItem(t);if(I)return JSON.parse(I)}catch{}return c?{width:r}:{width:r,height:n}}),x=u.useRef(null),b=u.useRef(null);u.useEffect(()=>{function I(){try{localStorage.removeItem(t)}catch{}m({width:r,height:n})}return window.addEventListener("ndn:layout-reset",I),window.addEventListener("ndn:camera-reset",I),()=>{window.removeEventListener("ndn:layout-reset",I),window.removeEventListener("ndn:camera-reset",I)}},[t,r,n]),u.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(h))}catch{}},[h,t]);function y(I,M,R){return Math.max(M,Math.min(R,I))}function N(I,M){I.preventDefault();const R=b.current;if(!R)return;const A=R.getBoundingClientRect();x.current={x:I.clientX,y:I.clientY,w:A.width,h:A.height,dir:M},window.addEventListener("mousemove",C),window.addEventListener("mouseup",w)}function C(I){const M=x.current;if(!M)return;const R=I.clientX-M.x,A=I.clientY-M.y;let v=M.w,p=M.h;M.dir.includes("e")&&(v=y(M.w+R,i,o)),!c&&M.dir.includes("s")&&(p=y(M.h+A,l,d)),M.dir.includes("w")&&(v=y(M.w-R,i,o)),!c&&M.dir.includes("n")&&(p=y(M.h-A,l,d)),m({width:Math.round(v),height:Math.round(p)})}function w(){window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",w),x.current=null}const D={width:h.width?`${h.width}px`:void 0,height:c?"100%":h.height?`${h.height}px`:void 0,maxWidth:"100%",maxHeight:c?"100%":"80vh",position:"relative",...c?{display:"flex",flexDirection:"column",flex:"1 1 auto"}:{}};return e.jsxs("div",{ref:b,className:`${s||""}`,style:D,children:[a,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:I=>N(I,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:I=>N(I,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:I=>N(I,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:I=>N(I,"se")})]})}function Xs({storageKey:t,children:a,className:s,defaultWidth:r=520,defaultHeight:n,minWidth:i=360,minHeight:l=200,maxWidth:o=1100,maxHeight:d=900,fullScreen:c=!1,initialFitHeight:h=!1}){const[m,x]=u.useState(()=>{if(!c){try{const R=localStorage.getItem(t);if(R)return JSON.parse(R)}catch{}return{width:r,height:n}}return{}}),b=u.useRef(null);u.useEffect(()=>{if(c)return;function R(){try{localStorage.removeItem(t)}catch{}if(h&&D.current?.parentElement){const A=D.current.parentElement,v=window.getComputedStyle(A),p=parseFloat(v.paddingTop||"0")||0,F=parseFloat(v.paddingBottom||"0")||0,H=Math.max(0,A.clientHeight-p-F),_=Math.max(l,Math.min(d,Math.round(H)));x({width:r,height:_});return}x({width:r,height:n})}return window.addEventListener("ndn:layout-reset",R),()=>window.removeEventListener("ndn:layout-reset",R)},[t,r,n,c]),u.useEffect(()=>{if(!c)try{localStorage.setItem(t,JSON.stringify(m))}catch{}},[m,t,c]),u.useEffect(()=>{if(c||!h)return;const R=D.current?.parentElement;if(!R)return;const A=window.getComputedStyle(R),v=parseFloat(A.paddingTop||"0")||0,p=parseFloat(A.paddingBottom||"0")||0,F=Math.max(0,R.clientHeight-v-p),H=Math.max(l,Math.min(d,Math.round(F)));try{const _=localStorage.getItem(t);if(_){const T=JSON.parse(_)?.height||0;(!T||T<H)&&x(K=>({...K,height:H}));return}}catch{}x(_=>({..._,height:H}))},[h,c,t,l,d]);function y(R,A,v){return Math.max(A,Math.min(v,R))}function N(R,A){R.preventDefault();const v=D.current;if(!v)return;const p=v.getBoundingClientRect();b.current={x:R.clientX,y:R.clientY,w:p.width,h:p.height,dir:A},window.addEventListener("mousemove",C),window.addEventListener("mouseup",w)}function C(R){const A=b.current;if(!A)return;const v=R.clientX-A.x,p=R.clientY-A.y,F=A.dir;let H=A.w,_=A.h,z=1/0;const T=D.current?.parentElement;if(T){const ee=window.getComputedStyle(T),ie=parseFloat(ee.paddingTop||"0")||0,ke=parseFloat(ee.paddingBottom||"0")||0;z=Math.max(0,T.clientHeight-ie-ke)}const K=Math.min(d,isFinite(z)?z:d);F.includes("e")&&(H=y(A.w+v,i,o)),F.includes("s")&&(_=y(A.h+p,l,K)),F.includes("w")&&(H=y(A.w-v,i,o)),F.includes("n")&&(_=y(A.h-p,l,K)),x({width:Math.round(H),height:Math.round(_)})}function w(){window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",w),b.current=null}const D=u.useRef(null),I=c?{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%"}:{width:m.width?`${m.width}px`:void 0,height:m.height?`${m.height}px`:void 0,maxWidth:`${o}px`,maxHeight:"100%"},M=c?"card relative ndn-modal-full":"card relative";return e.jsxs("div",{ref:D,className:`${M} ${s||""}`,style:I,children:[a,!c&&e.jsx("div",{className:"resizer resizer-nw",onMouseDown:R=>N(R,"nw")}),!c&&e.jsx("div",{className:"resizer resizer-ne",onMouseDown:R=>N(R,"ne")}),!c&&e.jsx("div",{className:"resizer resizer-sw",onMouseDown:R=>N(R,"sw")}),!c&&e.jsx("div",{className:"resizer resizer-se",onMouseDown:R=>N(R,"se")}),!c&&e.jsx("div",{className:"resizer-edge resizer-s",onMouseDown:R=>N(R,"s")})]})}const lc=Qs((t,a)=>({samples:[],addSample:s=>t(r=>({samples:[...r.samples,s]})),clear:()=>t({samples:[]}),export:()=>a().samples.slice()})),jl=Qs(t=>({darts:0,total:0,entries:[],setVisit:(a,s,r)=>t({entries:a,darts:s,total:r}),reset:()=>t({darts:0,total:0,entries:[]})})),cc=Qs(t=>({paused:!1,pauseEndsAt:null,setPaused:(a,s=null)=>t({paused:a,pauseEndsAt:s??null})}));function Je({onVisitCommitted:t,showToolbar:a=!0,onAutoDart:s,immediateAutoCommit:r=!1,hideInlinePanels:n=!1,scoringMode:i="x01",onGenericDart:l,onGenericReplace:o,x01DoubleInOverride:d}){const c=u.useRef(null),{preferredCameraId:h,preferredCameraLabel:m,setPreferredCamera:x,autoscoreProvider:b,autoscoreWsUrl:y,cameraAspect:N,cameraFitMode:C}=qt(),w=b==="manual",[D,I]=u.useState([]),M=u.useRef(null),R=u.useRef(null),[A,v]=u.useState(!1),[p,F]=u.useState(!1),[H,_]=u.useState(null),{H:z,imageSize:T,reset:K,_hydrated:ee}=wa(),[ie,ke]=u.useState(""),[Be,Ue]=u.useState(""),[Oe,je]=u.useState(0),[Re,$]=u.useState("MISS"),[te,ce]=u.useState(0),[ze,Pe]=u.useState(0),[Te,Ee]=u.useState([]),[ht,Ce]=u.useState(0),[me,Le]=u.useState(0),pt=qt(S=>S.x01DoubleIn),It=typeof d=="boolean"?!!d:!!pt,[is,Ke]=u.useState({}),De=ya(S=>S),Pt=De.players[De.currentPlayerIdx]?.id,le=!!(Pt&&is[Pt]),fe=S=>{Pt&&Ke(O=>({...O,[Pt]:S}))},ne=jl(S=>S.setVisit),Z=jl(S=>S.reset);u.useEffect(()=>{try{ne(Te,te,ze)}catch{}},[Te,te,ze,ne]),u.useEffect(()=>()=>{try{Z()}catch{}},[Z]);const He=ya(S=>S.addVisit),ye=ya(S=>S.endLeg),Ne=lc(S=>S.addSample),[Xe,rt]=u.useState(""),[ft,Ve]=u.useState(""),[yt,We]=u.useState(0),[wt,kt]=u.useState(!1),[$t,et]=u.useState(!1),[zt,os]=u.useState(!1),ls=u.useRef(null),[es,Rt]=u.useState("auto"),[Yt,Ft]=u.useState(!1),[E,ae]=u.useState(!1),[xe,$e]=u.useState(!1),Qe=u.useRef(null),Mt=qt(S=>S.dartTimerEnabled),Lt=qt(S=>S.dartTimerSeconds)||10,[ts,ps]=u.useState(null),Tt=u.useRef(null),_t=cc(S=>S.paused),V=u.useRef(null),we=u.useRef(null),[ot,us]=u.useState(0);u.useEffect(()=>{const S=()=>{w||ae(!0)};return window.addEventListener("ndn:open-autoscore",S),()=>window.removeEventListener("ndn:open-autoscore",S)},[w]),u.useEffect(()=>()=>{try{ls.current&&clearTimeout(ls.current)}catch{}},[]),u.useEffect(()=>{const S=()=>$e(!0);return window.addEventListener("ndn:open-scoring",S),()=>window.removeEventListener("ndn:open-scoring",S)},[]),u.useEffect(()=>{let S=!0;async function O(){try{if(!navigator?.mediaDevices?.enumerateDevices)return;const U=await navigator.mediaDevices.enumerateDevices();if(!S)return;I(U.filter(Y=>Y.kind==="videoinput"))}catch(U){console.warn("[CAMERA] enumerateDevices failed:",U)}}O();try{navigator.mediaDevices.addEventListener("devicechange",O)}catch{try{navigator.mediaDevices.ondevicechange=O}catch{}}return()=>{S=!1;try{navigator.mediaDevices.removeEventListener("devicechange",O)}catch{}}},[]),u.useEffect(()=>{const S=()=>{Rt("manual"),Ft(!0)},O=()=>{Rt("auto"),Ft(!1)};return window.addEventListener("ndn:open-manual",S),window.addEventListener("ndn:close-manual",O),()=>{window.removeEventListener("ndn:open-manual",S),window.removeEventListener("ndn:close-manual",O)}},[]),u.useEffect(()=>{w&&(Rt("manual"),ae(!1))},[w]),u.useEffect(()=>{try{const S=De.players[De.currentPlayerIdx],O=S?.legs?.[S.legs.length-1];if(!S)return;(!O||O.dartsThrown===0)&&Ke(U=>({...U,[S.id]:!1}))}catch{}},[De.currentPlayerIdx,De.players?.[De.currentPlayerIdx]?.legs?.length]),u.useEffect(()=>{const S=De?.inProgress,O=!!Mt&&S&&!_t&&te<3;if(Tt.current&&(clearInterval(Tt.current),Tt.current=null),!O){ps(null);return}return ps(Lt),Tt.current=window.setInterval(()=>{ps(U=>{const Y=(U??Lt)-1;if(Y<=0){try{Vt(0,"MISS 0","MISS")}catch{}return Tt.current&&(clearInterval(Tt.current),Tt.current=null),0}return Y})},1e3),()=>{Tt.current&&(clearInterval(Tt.current),Tt.current=null)}},[Mt,Lt,te,De.currentPlayerIdx,De?.inProgress,_t]),u.useEffect(()=>{if(!Yt)return;const S=setInterval(()=>{try{const O=c.current,U=Qe.current;if(!O||!U)return;const Y=O.videoWidth||0,re=O.videoHeight||0;if(!Y||!re)return;const he=U.clientWidth||640,ge=U.clientHeight||360;U.width!==he&&(U.width=he),U.height!==ge&&(U.height=ge);const Se=U.getContext("2d");if(!Se)return;Se.imageSmoothingEnabled=!0;const Ie=Math.min(he/Y,ge/re),Et=Math.round(Y*Ie),at=Math.round(re*Ie),xt=Math.floor((he-Et)/2),ut=Math.floor((ge-at)/2);Se.fillStyle="#000",Se.fillRect(0,0,he,ge),Se.drawImage(O,xt,ut,Et,at)}catch(O){console.warn("Manual preview update error:",O)}},120);return()=>clearInterval(S)},[Yt]),u.useEffect(()=>()=>ks(),[]);async function Rs(){if(!(p||A)){if(m==="Phone Camera"){console.log("[CAMERA] Phone camera is selected - skipping local camera startup"),console.log("[CAMERA] Phone camera feed shown via overlay in game tabs"),F(!1);return}F(!0),console.log("[CAMERA] Starting camera...");try{const S=h?{video:{deviceId:{exact:h}},audio:!1}:{video:{facingMode:"environment"},audio:!1};console.log("[CAMERA] Using constraints:",S);let O;try{O=await navigator.mediaDevices.getUserMedia(S),console.log("[CAMERA] Got stream:",!!O)}catch(U){console.warn("[CAMERA] First attempt failed:",U);const Y=U&&(U.name||U.code)||"";if(h&&(Y==="OverconstrainedError"||Y==="NotFoundError"))console.log("[CAMERA] Trying fallback without deviceId"),O=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else if(!h&&(Y==="OverconstrainedError"||Y==="NotFoundError"||Y==="NotSupportedError"))console.log("[CAMERA] Trying fallback for facingMode not supported"),O=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw U}if(c.current){console.log("[CAMERA] Setting stream to video element"),c.current.srcObject=O,console.log("[CAMERA] Stream tracks:",O.getTracks().length,"video tracks:",O.getVideoTracks().length),c.current.addEventListener("loadeddata",()=>console.log("[CAMERA] Video loadeddata")),c.current.addEventListener("canplay",()=>console.log("[CAMERA] Video canplay")),c.current.addEventListener("play",()=>console.log("[CAMERA] Video started playing")),c.current.addEventListener("error",U=>console.error("[CAMERA] Video error:",U));try{c.current.play(),console.log("[CAMERA] Play called successfully")}catch(U){console.error("[CAMERA] Video play failed:",U),setTimeout(()=>{try{c.current?.play(),console.log("[CAMERA] Retry play called")}catch(Y){console.error("[CAMERA] Retry play failed:",Y)}},100)}}else console.error("[CAMERA] Video element not found");v(!0);try{const U=await navigator.mediaDevices.enumerateDevices();I(U.filter(Y=>Y.kind==="videoinput")),console.log("[CAMERA] Found cameras:",U.filter(Y=>Y.kind==="videoinput").length)}catch(U){console.warn("[CAMERA] Failed to enumerate devices:",U)}}catch(S){console.error("[CAMERA] Camera start failed:",S),alert("Camera permission denied or not available.")}finally{F(!1)}}}function ks(){c.current&&c.current.srcObject&&(c.current.srcObject.getTracks().forEach(O=>O.stop()),c.current.srcObject=null,v(!1),F(!1))}function vs(){try{if(!c.current||!M.current)return;const S=c.current,O=M.current;O.width=S.videoWidth,O.height=S.videoHeight;const U=O.getContext("2d");if(!U)return;U.drawImage(S,0,0,O.width,O.height);const Y=O.toDataURL("image/png");_(Y)}catch(S){console.warn("Capture error:",S)}}function Cs(){return D.length?e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs",children:[e.jsx("span",{children:"Cam:"}),e.jsxs("select",{className:"bg-black/20 rounded px-1 py-0.5",value:h||"",onChange:async S=>{if(p)return;const O=S.target.value||void 0,U=D.find(Y=>Y.deviceId===O)?.label;x(O,U||"",!0),ks(),await new Promise(Y=>setTimeout(Y,150));try{await Rs()}catch(Y){console.warn("Failed to start camera after device switch:",Y),setTimeout(async()=>{try{await Rs()}catch(re){console.error("Camera switch failed after retry:",re),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),D.map(S=>e.jsx("option",{value:S.deviceId,children:S.label||(S.deviceId?`Camera (${S.deviceId.slice(0,6)})`:"Camera")},S.deviceId))]}),e.jsx("button",{className:"btn btn--ghost btn-sm ml-2",onClick:async()=>{try{const S=await navigator.mediaDevices.enumerateDevices();I(S.filter(O=>O.kind==="videoinput"))}catch(S){console.warn("Rescan failed:",S),alert("Failed to rescan devices. Ensure camera permissions are granted.")}},title:"Rescan connected cameras",children:"Rescan"})]}):null}function Xt(){try{if(!R.current||!c.current||!z||!T)return;const S=R.current,O=c.current,U=O.clientWidth,Y=O.clientHeight;S.width=U,S.height=Y;const re=S.getContext("2d");if(!re)return;re.clearRect(0,0,U,Y);const he=U/T.w,ge=Y/T.h,Se=Tu(z,he,ge),Ie=[pe.bullInner,pe.bullOuter,pe.trebleInner,pe.trebleOuter,pe.doubleInner,pe.doubleOuter];for(const Et of Ie){const at=Zl(Se,Et,360);tc(re,at,Et===pe.doubleOuter?"#22d3ee":"#a78bfa",Et===pe.doubleOuter?3:2)}}catch(S){console.warn("Overlay drawing error:",S)}}u.useEffect(()=>{if(w)return;const S=setInterval(Xt,250);return()=>clearInterval(S)},[z,T,A,w]),u.useEffect(()=>{if(w||b!=="built-in")return;const S=Zn.getState(),U=qt.getState().preferredCameraLabel==="Phone Camera"?S.getVideoElementRef?.()||null:c.current;if(!U||!z||!T)return;let Y=!1;const re=U,he=M.current;if(!he)return;V.current||(V.current=new hm);const ge=()=>{if(!Y){try{const Se=re.videoWidth||0,Ie=re.videoHeight||0;if(!Se||!Ie){we.current=requestAnimationFrame(ge);return}he.width!==Se&&(he.width=Se),he.height!==Ie&&(he.height=Ie);const Et=he.getContext("2d");if(!Et){we.current=requestAnimationFrame(ge);return}Et.drawImage(re,0,0,Se,Ie);const at=Et.getImageData(0,0,Se,Ie),xt=Yn(z,{x:0,y:0}),ut=Yn(z,{x:pe.doubleOuter,y:0}),bt=Se/T.w,cs=Ie/T.h,ms=xt.x*bt,Gt=xt.y*cs,hs=ut.x*bt,fs=ut.y*cs,Zs=Math.hypot(hs-ms,fs-Gt)*1.08,vt=V.current;if(ot>=0&&vt.setROI(ms,Gt,Math.max(24,Math.min(Math.max(Se,Ie),Zs))),!_t&&te<3){const Ot=vt.detect(at);if(Ot&&Ot.confidence>=.6){const tt=Au(he,Ot.tip,6),mt={x:tt.x/bt,y:tt.y/cs},ct=gl(z,mt),ss=`${ct.ring} ${ct.base>0?ct.base:""}`.trim();ke(ss),je(ct.base),$(ct.ring),et(!0);try{if(!!ct&&ct.ring!=="MISS"&&(ct.base||0)>0){os(!0);try{ls.current&&clearTimeout(ls.current)}catch{}ls.current=window.setTimeout(()=>{os(!1),ls.current=null},1500)}}catch{}try{const Ht=R.current;if(Ht){const Ct=Ht.getContext("2d");if(Ct){const xs=tt.x/Se*Ht.width,gt=tt.y/Ie*Ht.height;if(Ct.save(),Ct.beginPath(),Ct.strokeStyle="#f59e0b",Ct.lineWidth=2,Ct.arc(xs,gt,6,0,Math.PI*2),Ct.stroke(),Ot.axis){const en=Ot.axis,Qt=en.x1/Se*Ht.width,Es=en.y1/Ie*Ht.height,Ss=en.x2/Se*Ht.width,Ds=en.y2/Ie*Ht.height;Ct.beginPath(),Ct.moveTo(Qt,Es),Ct.lineTo(Ss,Ds),Ct.stroke()}if(Ot.bbox){const en=Ot.bbox.x/Se*Ht.width,Qt=Ot.bbox.y/Ie*Ht.height,Es=Ot.bbox.w/Se*Ht.width,Ss=Ot.bbox.h/Ie*Ht.height;Ct.strokeStyle="#22d3ee",Ct.strokeRect(en,Qt,Es,Ss)}Ct.restore()}}}catch{}try{s&&s(ct.base,ct.ring,{sector:ct.sector??null,mult:ct.mult??0})}catch{}vt.accept(at,Ot)}}}catch{}we.current=requestAnimationFrame(ge)}};return we.current=requestAnimationFrame(ge),()=>{Y=!0,we.current&&cancelAnimationFrame(we.current),we.current=null}},[w,b,A,z,T,_t,te,ot]),u.useEffect(()=>{try{Js.getState().setCalibrationStatus({hasHomography:!!z,imageSize:T})}catch{}},[z,T]),u.useEffect(()=>{if(b!=="external-ws"||!y)return;const S=xm(y,O=>{if(s){try{s(O.value,O.ring,{sector:O.sector??null,mult:O.mult??0})}catch{}try{Ne({playerId:De.players[De.currentPlayerIdx]?.id??null,sector:O.sector??null,mult:O.mult??0,ring:O.ring,ts:Date.now()})}catch{}}else{const U=O.ring==="INNER_BULL"?"INNER_BULL 50":O.ring==="BULL"?"BULL 25":`${O.ring[0]}${O.value/(O.mult||1)||O.value} ${O.value}`;Vt(O.value,U,O.ring);try{Ne({playerId:De.players[De.currentPlayerIdx]?.id??null,sector:O.sector??null,mult:O.mult??0,ring:O.ring,ts:Date.now()})}catch{}}});return()=>S.close()},[b,y]);function Ps(S){if(!R.current||!z||!T)return;const O=R.current.getBoundingClientRect(),U=S.clientX-O.left,Y=S.clientY-O.top,re=R.current.width/T.w,he=R.current.height/T.h,ge={x:U/re,y:Y/he},Se=gl(z,ge),Ie=`${Se.ring} ${Se.base>0?Se.base:""}`.trim();ke(Ie),je(Se.base),$(Se.ring),et(!0);try{if(r&&s){s(Se.base,Se.ring,{sector:Se.sector,mult:Se.mult});try{Ne({playerId:De.players[De.currentPlayerIdx]?.id??null,sector:Se.sector??null,mult:Se.mult??0,ring:Se.ring,ts:Date.now()})}catch{}et(!1)}}catch{}}function ws(S){const O=S.trim().toUpperCase();if(!O)return null;const U=O==="BULL"||O==="50"||O==="DBULL"||O==="IBULL",Y=O==="25"||O==="OBULL";if(U)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(Y)return{label:"BULL 25",value:25,ring:"BULL"};const re=O.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!re)return null;const he=re[1]||"S",ge=parseInt(re[2],10);if(ge<1||ge>20)return null;const Se=he==="S"?1:he==="D"?2:3,Ie=he==="S"?"SINGLE":he==="D"?"DOUBLE":"TRIPLE";return{label:`${he}${ge} ${ge*Se}`,value:ge*Se,ring:Ie}}function Ls(){const S=De;if(!S.players.length)return S.startingScore;const O=S.players[S.currentPlayerIdx],U=O.legs[O.legs.length-1];return U?U.totalScoreRemaining:S.startingScore}function Vt(S,O,U){if(i==="custom"){if(l)try{l(S,U,{label:O})}catch{}if(te>=3){ce(1),Pe(S),Ee([{label:O,value:S,ring:U}]);return}const xt=te+1;ce(xt),Pe(ut=>ut+S),Ee(ut=>[...ut,{label:O,value:S,ring:U}]);return}if(te>=3){He(ze,te,{preOpenDarts:ht||0,doubleWindowDarts:me||0,finishedByDouble:!1,visitTotal:ze});try{const bt=De.players[De.currentPlayerIdx]?.name;bt&&In(bt,te,ze)}catch{}const xt=!It||le||U==="DOUBLE"||U==="INNER_BULL",ut=xt?S:0;ce(1),Pe(ut),Ee([{label:O,value:ut,ring:U}]),Ce(xt?0:1),Le(0),It&&!le&&(U==="DOUBLE"||U==="INNER_BULL")&&fe(!0),t&&t(ze,te,!1);return}const Y=te+1,he=!It||le||U==="DOUBLE"||U==="INNER_BULL"?S:0;It&&!le&&(U==="DOUBLE"||U==="INNER_BULL")&&fe(!0);const ge=ze+he,Ie=Ls()-ge,Et=Ie===0&&(U==="DOUBLE"||U==="INNER_BULL");if(Ie<0||Ie===1||Ie===0&&!Et){const ut=(ht||0)+(It&&!le&&!(U==="DOUBLE"||U==="INNER_BULL")?1:0),bt=Ie,cs=Ie+he,ms=cs>50&&bt<=50||cs<=50?1:0,Gt=(me||0)+ms;He(0,Y,{preOpenDarts:ut,doubleWindowDarts:Gt,finishedByDouble:!1,visitTotal:0}),ce(0),Pe(0),Ee([]),Ce(0),Le(0),t&&t(0,Y,!1);return}ce(Y),Pe(ge),Ee(xt=>[...xt,{label:O,value:he,ring:U}]),It&&!le&&!(U==="DOUBLE"||U==="INNER_BULL")&&Ce(xt=>(xt||0)+1);{const xt=Ie,ut=Ie+he;(ut>50&&xt<=50||ut<=50)&&Le(cs=>(cs||0)+1)}if(Et){He(ge,Y,{preOpenDarts:ht||0,doubleWindowDarts:me||0,finishedByDouble:!0,visitTotal:ge}),ye(ge),ce(0),Pe(0),Ee([]),Ce(0),Le(0),t&&t(ge,Y,!0);return}Y>=3&&(He(ge,Y,{preOpenDarts:ht||0,doubleWindowDarts:me||0,finishedByDouble:!1,visitTotal:ge}),ce(0),Pe(0),Ee([]),Ce(0),Le(0),t&&t(ge,Y,!1))}function Os(){if(ie){if(s)try{s(Oe,Re,void 0)}catch{}else Vt(Oe,ie,Re);We(0),et(!1)}}function as(){const S=ws(Be);if(!S){alert("Enter like T20, D16, 5, 25, 50");return}if(!$t||!ie||Re==="MISS"||Oe===0){const O=yt+1;We(O),O>=5&&kt(!0)}else We(0);Vt(S.value,S.label,S.ring),Ue(""),et(!1)}function Bs(){const S=ws(Be);if(!S){alert("Enter like T20, D16, 5, 25, 50");return}if(te===0||Te.length===0){as();return}if(i==="custom"){if(!$t||!ie||Re==="MISS"||Oe===0){const at=yt+1;We(at),at>=5&&kt(!0)}else We(0);if(Ee(at=>[...at.slice(0,-1),{label:S.label,value:S.value,ring:S.ring}]),o)try{o(S.value,S.ring,{label:S.label})}catch{}Ue(""),et(!1);return}if(!$t||!ie||Re==="MISS"||Oe===0){const at=yt+1;We(at),at>=5&&kt(!0)}else We(0);const O=Te[Te.length-1],U=te-1,Y=ze-(O?.value||0),re=Ls(),he=Y+S.value,ge=U+1,Se=re-he,Ie=Se===0&&(S.ring==="DOUBLE"||S.ring==="INNER_BULL");if(Se<0||Se===1||Se===0&&!Ie){He(0,ge);try{const at=De.players[De.currentPlayerIdx]?.name;at&&In(at,ge,0)}catch{}ce(0),Pe(0),Ee([]),t&&t(0,ge,!1),Ue(""),et(!1);return}if(ce(ge),Pe(he),Ee(at=>[...at.slice(0,-1),{label:S.label,value:S.value,ring:S.ring}]),Ie){He(he,ge),ye(he);try{const at=De.players[De.currentPlayerIdx]?.name;at&&In(at,ge,he)}catch{}ce(0),Pe(0),Ee([]),t&&t(he,ge,!0),Ue(""),et(!1);return}if(ge>=3){He(he,ge);try{const at=De.players[De.currentPlayerIdx]?.name;at&&In(at,ge,he)}catch{}ce(0),Pe(0),Ee([]),t&&t(he,ge,!1)}Ue(""),et(!1)}function Ts(){kt(!1),We(0);try{window.dispatchEvent(new CustomEvent("ndn:request-calibrate"))}catch{}}function B(){K(),kt(!1),We(0)}React.useEffect(()=>{function S(O){try{const Y=document.activeElement?.tagName?.toLowerCase();O.key==="m"&&Y!=="input"&&Y!=="textarea"&&(Rt("manual"),Ft(!0))}catch{}}return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[]);function Q(S,O){if(te>=3)return;const U=S*(O==="S"?1:O==="D"?2:3),Y=O==="S"?"SINGLE":O==="D"?"DOUBLE":"TRIPLE";if(!$t||!ie||Re==="MISS"||Oe===0){const re=yt+1;We(re),re>=5&&kt(!0)}else We(0);Vt(U,`${O}${S} ${U}`,Y),et(!1)}function se(){if(te===0)return;const S=Te[Te.length-1];ce(O=>O-1),Pe(O=>O-(S?.value||0)),Ee(O=>O.slice(0,-1))}function G(){if(te!==0){if(i==="custom"){ce(0),Pe(0),Ee([]);return}He(ze,te);try{const S=De.players[De.currentPlayerIdx]?.name;S&&In(S,te,ze)}catch{}ce(0),Pe(0),Ee([]),t&&t(ze,te,!1)}}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!w&&e.jsx("button",{className:`btn px-3 py-1 text-sm ${es==="auto"?"tab--active":""}`,onClick:()=>{Rt("auto"),Ft(!1),ae(!0)},children:"Autoscore"}),e.jsx("button",{className:`btn px-3 py-1 text-sm ${es==="manual"?"tab--active":""}`,onClick:()=>{Rt("manual"),Ft(!0)},title:"Open Manual Correction",children:"Manual Correction"}),w&&e.jsx("span",{className:"text-xs opacity-70",children:"Manual scoring mode active"})]})}),!n&&!w?e.jsxs("div",{className:"card relative",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(va,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:320,minHeight:240,maxWidth:1600,maxHeight:900,autoFill:!0,children:[e.jsx(Cs,{}),m==="Phone Camera"?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100 mb-2",children:"Phone Camera Active"}),e.jsx("div",{className:"text-sm text-slate-300 mb-4",children:"Your phone camera feed is shown in the floating overlay"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Camera controls available in Calibrator tab"})]})}):(()=>{const S=N||qt.getState().cameraAspect||"wide",O=(C||qt.getState().cameraFitMode||"fit")==="fit",U=S==="square"?"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black":O?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",Y=S==="square"?"relative w-full max-w-[640px] mx-auto aspect-square bg-black":"relative w-full aspect-[4/3] bg-black";return e.jsxs("div",{className:Y,children:[e.jsx("video",{ref:c,className:U,playsInline:!0,"webkit-playsinline":"true",muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:R,className:"absolute inset-0 w-full h-full",onClick:Ps}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${Te[0]?Te[0].value>0?"hit":"miss":"pending"}, ${Te[1]?Te[1].value>0?"hit":"miss":"pending"}, ${Te[2]?Te[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(re=>{const he=Te[re],ge=!he,Se=!!he&&(typeof he.value=="number"?he.value>0:!0),Ie=ge?"bg-gray-500/70":Se?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${Ie}`},re)}),Mt&&ts!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,ts),"s"]})]})]})})()]}),inProgress?e.jsx("div",{className:"absolute top-3 right-3 z-30",children:(()=>{let S="bg-white/90 text-slate-800",O="Manual Correction (M)";$t&&(!!ie&&Re!=="MISS"&&Oe>0?(S="bg-emerald-600 text-white",O=`Manual Correction (M) â€” Autoscore: ${ie} (confirmed)`):(S="bg-amber-400 text-black",O=`Manual Correction (M) â€” Autoscore ambiguous: ${ie||"â€”"}`));const U="px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90",Y=$t&&!!ie&&Re!=="MISS"&&Oe>0,re=zt&&Y?"ring-4 ring-emerald-400/60 animate-ping":$t&&!Y?"animate-pulse":"";return e.jsx("button",{className:`${U} ${S} ${re}`,onClick:()=>{Rt("manual"),Ft(!0)},title:O,children:"Manual"})})()}):null,e.jsxs("div",{className:"flex gap-2 mt-3",children:[m==="Phone Camera"?e.jsx("div",{className:"text-sm text-blue-200 px-3 py-2 rounded bg-blue-900/30 flex-1",children:"ðŸ“± Using phone camera from overlay"}):e.jsxs(e.Fragment,{children:[A?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:ks,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:Rs,disabled:p,children:p?"Connecting Camera...":"Connect Camera"}),e.jsx("button",{className:"btn",onClick:vs,disabled:!A,children:"Capture Still"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",disabled:!A,onClick:()=>{V.current=null,us(S=>S+1)},children:"Reset Autoscore Background"})]}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}):null,inProgress?e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{className:"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg",title:"Open Manual Correction (M)",onClick:()=>{Rt("manual"),Ft(!0)},children:"âœï¸"})}):null,!n&&w&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Manual Scoring"}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:"Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{Ft(!0),Rt("manual")},children:"Open Manual Correction"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Manage Pending Visit"})]})]}),e.jsx("canvas",{ref:M,className:"hidden"}),E&&!w&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(Xs,{storageKey:"ndn:autoscore:size",className:"w-full max-w-3xl",defaultWidth:720,defaultHeight:520,minWidth:420,minHeight:320,maxWidth:1400,maxHeight:900,initialFitHeight:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Autoscore"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn btn--ghost",onClick:()=>ae(!1),children:"Close"})})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Click the camera overlay to autoscore. Use Manual Correction if the last auto is off."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:ie||"â€”"}),e.jsx("button",{className:"btn",onClick:Os,disabled:te>=3,children:"Add Auto Dart"}),yt>0&&e.jsxs("span",{className:"text-sm opacity-80",children:["No-registers: ",yt,"/3"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:te>=3,onClick:()=>{if(!$t||!ie||Re==="MISS"||Oe===0){const S=yt+1;We(S),S>=5&&kt(!0)}else We(0);Vt(25,"BULL 25","BULL"),et(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:te>=3,onClick:()=>{if(!$t||!ie||Re==="MISS"||Oe===0){const S=yt+1;We(S),S>=5&&kt(!0)}else We(0);Vt(50,"INNER_BULL 50","INNER_BULL"),et(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"autoscore-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:Xe,onChange:S=>rt(S.target.value.toUpperCase()),onKeyDown:S=>{if(S.key==="Enter"){const O=Xe.match(/^(S|D|T)(\d{1,2})$/);O&&Q(parseInt(O[2],10),O[1])}}}),e.jsx("datalist",{id:"autoscore-quick-list",children:["D","S","T"].map(S=>Array.from({length:20},(O,U)=>U+1).map(O=>e.jsx("option",{value:`${S}${O}`},`${S}${O}`)))}),e.jsx("button",{className:"btn",disabled:!Xe||te>=3,onClick:()=>{const S=Xe.match(/^(S|D|T)(\d{1,2})$/);if(!S)return;const O=S[1],U=parseInt(S[2],10);Q(U,O)},children:"Add"})]})]})]})})}),Yt&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{Ft(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:Qe,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:ie||"â€”"}),e.jsx("button",{className:"btn",onClick:Os,disabled:te>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Manual (T20, D16, 5, 25, 50)",value:Be,onChange:S=>Ue(S.target.value),onKeyDown:S=>{S.key==="Enter"&&!S.shiftKey&&(S.preventDefault(),as()),S.key==="Enter"&&S.shiftKey&&(S.preventDefault(),Bs())}}),e.jsx("button",{className:"btn btn--ghost",onClick:Bs,disabled:te===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:as,disabled:te>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add Â· Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Number pad"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 max-w-sm",children:[["7","8","9","4","5","6","1","2","3","0"].map(S=>e.jsx("button",{className:"btn text-lg",onClick:()=>{Ue(O=>/^[SDT]/i.test(O)?O+S:(O||"")+S)},children:S},S)),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:()=>Ue(""),children:"Clear"}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 text-white",onClick:()=>Ue(S=>(S||"").slice(0,-1)),children:"âŒ«"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>as(),disabled:te>=3,children:"Enter"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Tap numbers then press Enter to submit. Use D/T prefixes for doubles/trebles (e.g., D16)."})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:te>=3,onClick:()=>{if(!$t||!ie||Re==="MISS"||Oe===0){const S=yt+1;We(S),S>=5&&kt(!0)}else We(0);Vt(25,"BULL 25","BULL"),et(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:te>=3,onClick:()=>{if(!$t||!ie||Re==="MISS"||Oe===0){const S=yt+1;We(S),S>=5&&kt(!0)}else We(0);Vt(50,"INNER_BULL 50","INNER_BULL"),et(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:ft,onChange:S=>Ve(S.target.value.toUpperCase()),onKeyDown:S=>{if(S.key==="Enter"){const O=ft.match(/^(S|D|T)(\d{1,2})$/);O&&Q(parseInt(O[2],10),O[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(S=>Array.from({length:20},(O,U)=>U+1).map(O=>e.jsx("option",{value:`${S}${O}`},`${S}${O}`)))}),e.jsx("button",{className:"btn",disabled:!ft||te>=3,onClick:()=>{const S=ft.match(/^(S|D|T)(\d{1,2})$/);if(!S)return;const O=S[1],U=parseInt(S[2],10);Q(U,O)},children:"Add"})]})]})]})]})})]})}),xe&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>$e(!1),children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(va,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:320,minHeight:240,maxWidth:1600,maxHeight:900,children:[e.jsx(Cs,{}),m==="Phone Camera"?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100 mb-2",children:"Phone Camera Active"}),e.jsx("div",{className:"text-sm text-slate-300 mb-4",children:"Your phone camera feed is shown in the floating overlay"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Camera controls available in Calibrator tab"})]})}):(()=>{const O=(qt.getState().cameraFitMode||"fit")==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black";return e.jsxs("div",{className:"relative w-full aspect-[4/3] bg-black",children:[e.jsx("video",{ref:c,className:O,playsInline:!0,"webkit-playsinline":"true",muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:R,className:"absolute inset-0 w-full h-full",onClick:Ps}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${Te[0]?Te[0].value>0?"hit":"miss":"pending"}, ${Te[1]?Te[1].value>0?"hit":"miss":"pending"}, ${Te[2]?Te[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(U=>{const Y=Te[U],re=!Y,he=!!Y&&(typeof Y.value=="number"?Y.value>0:!0),ge=re?"bg-gray-500/70":he?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${ge}`},U)}),Mt&&ts!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,ts),"s"]})]})]})})()]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[m==="Phone Camera"?e.jsx("div",{className:"text-sm text-blue-200 px-3 py-2 rounded bg-blue-900/30 flex-1",children:"ðŸ“± Using phone camera from overlay"}):e.jsxs(e.Fragment,{children:[A?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:ks,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Rs,children:"Connect Camera"}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:vs,disabled:!A,children:"Capture Still"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold",disabled:!A,onClick:()=>{V.current=null,us(S=>S+1)},children:"Reset Autoscore Background"})]}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[0,1,2].map(S=>{const O=Te[S],U=!O,Y=!!O&&(typeof O.value=="number"?O.value>0:!0),re=U?"bg-gray-500/70":Y?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-2.5 h-2.5 rounded-full shadow ${re}`},S)}),Mt&&ts!==null&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold",children:[Math.max(0,ts),"s"]})]}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:Te.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):Te.map((S,O)=>e.jsx("li",{children:S.label},O))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",te,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",ze]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:se,disabled:te===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:G,disabled:te===0,children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{ce(0),Pe(0),Ee([])},disabled:te===0,children:"Clear"})]})]})]})]})}),wt&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>{kt(!1),We(0)},children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-white",children:"Recalibration Recommended"}),e.jsx("div",{className:"mb-4 text-lg font-semibold text-indigo-200",children:"We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Ts,children:"Go to Calibrate"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:B,children:"Reset Calibration"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{kt(!1),We(0)},children:"Dismiss"})]})]})})]})}function Nl(t,a,s,r){const n=(r-90)*Math.PI/180;return{x:t+s*Math.cos(n),y:a+s*Math.sin(n)}}function wl(t){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(t)*18+9}function pm({width:t=320,height:a=320}){const s=lc(n=>n.samples),r=u.useRef(null);return u.useEffect(()=>{const n=r.current;if(!n)return;const i=n.getContext("2d");if(!i)return;n.width=t,n.height=a,i.clearRect(0,0,t,a);const l=t/2,o=a/2,d=Math.min(t,a)/(pe.doubleOuter*2+20),c={bullInner:pe.bullInner*d,bullOuter:pe.bullOuter*d,trebleInner:pe.trebleInner*d,trebleOuter:pe.trebleOuter*d,doubleInner:pe.doubleInner*d,doubleOuter:pe.doubleOuter*d};i.strokeStyle="rgba(255,255,255,0.06)",i.lineWidth=1;const h=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const b of h)i.beginPath(),i.arc(l,o,c[b],0,Math.PI*2),i.stroke();const m=[];for(const b of s){let y=Math.random()*360,N=Math.random()*c.doubleOuter;typeof b.sector=="number"&&b.sector>=1&&b.sector<=20&&(y=wl(b.sector),b.ring==="DOUBLE"?N=(c.doubleInner+c.doubleOuter)/2:b.ring==="TRIPLE"?N=(c.trebleInner+c.trebleOuter)/2:b.ring==="INNER_BULL"?N=c.bullInner*.5:b.ring==="BULL"?N=c.bullOuter*.8:N=(c.trebleOuter+c.doubleInner)/2*(.6+Math.random()*.4));const C=Nl(l,o,N,y);m.push({x:C.x,y:C.y,w:1})}for(const b of m){const y=i.createRadialGradient(b.x,b.y,1,b.x,b.y,60);y.addColorStop(0,"rgba(255,0,0,0.9)"),y.addColorStop(.3,"rgba(255,100,0,0.5)"),y.addColorStop(1,"rgba(255,100,0,0)"),i.fillStyle=y,i.beginPath(),i.arc(b.x,b.y,60,0,Math.PI*2),i.fill()}i.fillStyle="rgba(255,255,255,0.85)",i.font="12px ui-sans-serif";const x={};for(const b of s)b.sector&&(x[b.sector]=(x[b.sector]||0)+1);for(const b of Object.keys(x)){const y=Number(b),N=wl(y),C=Nl(l,o,c.trebleOuter+18,N);i.fillText(String(x[y]),C.x-6,C.y+4)}},[s,t,a]),e.jsx("canvas",{ref:r,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}const Gs=[...Array.from({length:20},(t,a)=>({label:`D${a+1}`,score:(a+1)*2})),{label:"DBULL",score:50,isBull:!0}];function Ai(t,a){const s=Gs[a];return!!s&&t===s.score}function gn(t){const a=t.trim().toUpperCase();if(!a)return null;if(a==="50"||a==="BULL"||a==="DBULL"||a==="IBULL")return 50;if(a==="25"||a==="OBULL")return 25;const s=a.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!s)return null;const r=s[1]||"S",n=parseInt(s[2],10);return n<1||n>20?null:n*(r==="S"?1:r==="D"?2:3)}const rs=[...Array.from({length:20},(t,a)=>a+1),25,50],Wa=[20,19,18,17,16,15,25];function Kn(){const t={};return Wa.forEach(a=>{t[a]=0}),{marks:t,points:0}}function dc(t,a,s,r,n=()=>!1){let i=null,l=0;if(s==="BULL"||s==="INNER_BULL"||a===25||a===50)i=25,l=s==="INNER_BULL"||a===50?2:1;else if(typeof r=="number"&&r>=15&&r<=20)i=r,s==="TRIPLE"?l=3:s==="DOUBLE"?l=2:l=1;else if(a){const b=[20,19,18,17,16,15];for(const y of b){if(a===y){i=y,l=1;break}if(a===y*2){i=y,l=2;break}if(a===y*3){i=y,l=3;break}}!i&&(a===25||a===50)&&(i=25,l=a===50?2:1)}if(!i)return 0;const o=t.marks[i];let d=Math.max(0,3-o);const c=Math.min(d,l),h=Math.max(0,l-c),m=o+c;t.marks[i]=m>3?3:m;let x=0;return h>0&&!n(i)&&(i===25?s==="INNER_BULL"?x+=50*h:x+=25*h:x+=i*h),t.points+=x,x}function bm(t){return Wa.every(a=>(t.marks[a]||0)>=3)}function An(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function gm(t){return t.round}function uc(t,a,s,r){if(t.finished)return 0;const n=gm(t);let i=0;return typeof r=="number"&&r===n?s==="TRIPLE"?(i=n*3,t.turnHits.triples++):s==="DOUBLE"?(i=n*2,t.turnHits.doubles++):s==="SINGLE"&&(i=n*1,t.turnHits.singles++):!r&&(a===n||a===n*2||a===n*3)&&(a===n*3?(i=n*3,t.turnHits.triples++):a===n*2?(i=n*2,t.turnHits.doubles++):a===n&&(i=n,t.turnHits.singles++)),t.score+=i,i}function mc(t){if(!t.finished){if(t.turnHits.singles>0&&t.turnHits.doubles>0&&t.turnHits.triples>0){t.shanghaiAchieved=!0,t.finished=!0;return}const a=t.round+1;a>20?t.finished=!0:t.round=a}t.turnHits={singles:0,doubles:0,triples:0}}function Rn(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function dr(t){return t.targets[t.stage]||null}function hc(t,a,s,r){if(t.finished)return 0;const n=dr(t);if(!n)return 0;let i=0;switch(n.kind){case"NUMBER":{typeof r=="number"&&r===n.num?s==="TRIPLE"?i=n.num*3:s==="DOUBLE"?i=n.num*2:s==="SINGLE"&&(i=n.num):!r&&(a===n.num||a===n.num*2||a===n.num*3)&&(i=a),i>0&&(t.hitThisRound=!0);break}case"DOUBLE":{(s==="DOUBLE"&&r===n.num||a===n.num*2)&&(i=n.num*2,t.hitThisRound=!0);break}case"TRIPLE":{(s==="TRIPLE"&&r===n.num||a===n.num*3)&&(i=n.num*3,t.hitThisRound=!0);break}case"BULL":{(s==="BULL"||s==="INNER_BULL"||a===25||a===50)&&(i=s==="INNER_BULL"||a===50?50:25,t.hitThisRound=!0);break}case"ANY_NUMBER":{a>0&&(i=a,t.hitThisRound=!0);break}}return t.score+=i,i}function fc(t){t.finished||(t.hitThisRound||(t.score=Math.floor(t.score/2)),t.hitThisRound=!1,t.stage+=1,t.stage>=t.targets.length&&(t.finished=!0))}function Pn(){return{round:1,score:0,target:"HIGH",finished:!1}}function xc(t,a,s,r){if(t.finished)return 0;let n=0;if(t.target==="HIGH")if(s==="INNER_BULL")n=50;else if(typeof r=="number"){const l=r*(s==="TRIPLE"?3:s==="DOUBLE"?2:1);r>=20&&(n=l)}else a>=40&&(n=a);else if(typeof r=="number"){const l=r*(s==="TRIPLE"?3:s==="DOUBLE"?2:1);r<=10&&(n=l)}else a>0&&a<=30&&(n=a);return t.score+=n,n}function pc(t){if(!t.finished){if(t.round+=1,t.round>10){t.finished=!0;return}t.target=t.target==="HIGH"?"LOW":"HIGH"}}function bc(t,a=3){return{number:t,lives:a,isKiller:!1,eliminated:!1}}function ym(t){const a=Array.from({length:20},(r,n)=>n+1),s={};for(const r of t){const n=Math.floor(Math.random()*a.length),i=a.splice(n,1)[0];s[r]=i}return s}function Ri(t,a,s,r){const n=a[t];if(!n||!r||!s)return{becameKiller:!1};if(!n.isKiller&&s==="DOUBLE"&&r===n.number)return n.isKiller=!0,{becameKiller:!0};if(n.isKiller&&(s==="DOUBLE"||s==="TRIPLE")){const i=Object.keys(a).find(l=>l!==t&&!a[l].eliminated&&a[l].number===r);if(i){const l=a[i],o=s==="TRIPLE"?2:1;return l.lives=Math.max(0,l.lives-o),l.lives===0&&(l.eliminated=!0),{becameKiller:!1,victimId:i,livesRemoved:o}}}return{becameKiller:!1}}function Pi(t){const a=Object.entries(t).filter(([,s])=>!s.eliminated&&s.lives>0);return a.length===1?a[0][0]:null}function Ua(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function gc(t,a,s,r){if(t.finished)return 0;let n=0;if(typeof r=="number"&&r===t.inning?s==="TRIPLE"?n=3:s==="DOUBLE"?n=2:n=1:!r&&(a===t.inning||a===t.inning*2||a===t.inning*3)&&(n=a===t.inning*3?3:a===t.inning*2?2:1),t.score+=n,t.dartsThisInning+=1,t.dartsThisInning>=3){const i=t.inning+1;i>9?t.finished=!0:(t.inning=i,t.dartsThisInning=0)}return n}const yc={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function $a(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function vc(t,a,s,r){if(t.finished)return!1;const n=yc[t.hole];if(t.dartsThisHole+=1,typeof r=="number"&&r===n&&(s==="SINGLE"||s==="DOUBLE"||s==="TRIPLE")||!r&&(a===n||a===n*2||a===n*3)){t.strokes+=t.dartsThisHole;const l=t.hole+1;return l>18?t.finished=!0:(t.hole=l,t.dartsThisHole=0),!0}if(t.dartsThisHole>=3){t.strokes+=3;const l=t.hole+1;l>18?t.finished=!0:(t.hole=l,t.dartsThisHole=0)}return!1}const Fa={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function Li(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function vm(t){const a=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[s,r,n]of a)if(t[s]&&t[s]===t[r]&&t[s]===t[n])return t[s];return t.every(s=>s)?"Draw":null}function jc(t,a,s,r,n){if(t.finished||t.board[a])return!1;const i=Fa[a];let l=!1;if(i.type==="BULL"?l=r==="BULL"||r==="INNER_BULL"||s===25||s===50:i.type==="NUM"&&typeof i.num=="number"&&(typeof n=="number"&&n===i.num||!n&&(s===i.num||s===i.num*2||s===i.num*3))&&(l=!0),!l)return!1;t.board[a]=t.turn;const o=vm(t.board);return o?(t.finished=!0,t.winner=o,!0):(t.turn=t.turn==="X"?"O":"X",!0)}function Oi(){return{targetIndex:0,darts:0,finished:!1}}const Nc=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25],ji=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","Bull"];function jm(t){return Nc[t.targetIndex]}function Bi(t,a,s){if(t.finished)return t;const r=jm(t);if(!(s==="SINGLE"&&a===r||s==="DOUBLE"&&a===r||s==="TRIPLE"&&a===r||s==="INNER_BULL"&&r===25))return t;const i=t.targetIndex+1,l=i>=Nc.length;return{targetIndex:i,darts:t.darts+1,finished:l}}function Sl(t,a){return Bi(t,a,"SINGLE")}function Nm(){return Oi()}function Ui(t=50){return{score:0,darts:0,finished:!1,target:t}}const wm=[5,10,15,20,25,50];function Sm(t){return wm.includes(t)}function $i(t,a,s){if(t.finished)return t;if(!Sm(a))return{...t,darts:t.darts+1};const r=t.score+a,n=r>=t.target;return{score:n?t.target:r,darts:t.darts+1,finished:n,target:t.target}}function kl(t,a){return $i(t,a)}function km(t=50){return Ui(t)}function Fi(t=70){return{score:0,darts:0,finished:!1,target:t}}const Cm=[7,14,21];function Tm(t){return Cm.includes(t)}function _i(t,a,s){if(t.finished)return t;if(!Tm(a))return{...t,darts:t.darts+1};const r=t.score+a,n=r>=t.target;return{score:n?t.target:r,darts:t.darts+1,finished:n,target:t.target}}function Cl(t,a){return _i(t,a)}function Em(t=70){return Fi(t)}const fr=[20,19,18,17,16,15,14,13,12,25];function _a(){const t={};return fr.forEach(a=>{t[a]=0}),{marks:t,points:0}}function wc(t,a,s,r,n=()=>!1){let i=null,l=0;if(s==="BULL"||s==="INNER_BULL"||a===25||a===50)i=25,l=s==="INNER_BULL"||a===50?2:1;else if(typeof r=="number"&&r>=12&&r<=20)i=r,s==="TRIPLE"?l=3:s==="DOUBLE"?l=2:l=1;else if(a){for(const b of[20,19,18,17,16,15,14,13,12]){if(a===b){i=b,l=1;break}if(a===b*2){i=b,l=2;break}if(a===b*3){i=b,l=3;break}}!i&&(a===25||a===50)&&(i=25,l=a===50?2:1)}if(!i)return 0;const o=t.marks[i],d=Math.max(0,3-o),c=Math.min(d,l),h=Math.max(0,l-c),m=o+c;t.marks[i]=m>3?3:m;let x=0;return h>0&&!n(i)&&(i===25?s==="INNER_BULL"?x+=50*h:x+=25*h:x+=i*h),t.points+=x,x}function Dm(t){return fr.every(a=>(t.marks[a]||0)>=3)}function Sc({left:t,right:a,className:s="",sticky:r=!0}){return e.jsxs("div",{className:`${r?"sticky top-0":""} relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${s}`,children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:t}),e.jsx("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:a})]})}function Dn({gameMode:t,players:a,matchScore:s,gameRules:r}){return!a||a.length===0?null:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:a.map((n,i)=>e.jsxs("div",{className:`rounded-lg border p-3 ${n.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[e.jsx("div",{className:`text-xs font-semibold mb-2 uppercase tracking-wide ${n.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:n.name}),e.jsxs("div",{className:"space-y-1 text-xs",children:[t==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Legs Won",value:`â— ${n.legsWon||0}`,highlight:!0}),e.jsx(dt,{label:"Score",value:n.score||0,mono:!0,bold:!0}),e.jsx(dt,{label:"Last Score",value:n.lastScore||"0",mono:!0}),e.jsx(dt,{label:"C/Out Rate",value:`${n.checkoutRate||0}%`,mono:!0}),e.jsx(dt,{label:"Best Leg",value:n.bestLeg||"â€”",mono:!0}),n.matchAvg!==void 0&&n.allTimeAvg!==void 0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[e.jsx(dt,{label:"Match Avg",value:n.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:n.matchAvg>0}),e.jsx(Im,{matchAvg:n.matchAvg,allTimeAvg:n.allTimeAvg})]})})]}),(t==="Cricket"||t==="American Cricket")&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Closed",value:Mm(n.closed),mono:!0}),e.jsx(dt,{label:"Points",value:n.points||0,mono:!0,bold:!0}),e.jsx(dt,{label:"Status",value:Am(n),highlight:n.isCurrentTurn})]}),(t==="Shanghai"||t==="Halve It")&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:t==="Shanghai"?"Round":"Stage",value:n.round||1,mono:!0}),e.jsx(dt,{label:"Target",value:n.target||"â€”",mono:!0}),e.jsx(dt,{label:"Score",value:n.score||0,mono:!0,bold:!0})]}),t==="Killer"&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Target #",value:n.number||"â€”",mono:!0,bold:!0}),e.jsx(dt,{label:"Lives",value:n.lives||0,mono:!0,bold:!0}),n.eliminated&&e.jsx(dt,{label:"Status",value:"ELIMINATED",highlight:!1})]}),t==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Round",value:n.round||1,mono:!0}),e.jsx(dt,{label:"Target",value:n.target||"High",mono:!0}),e.jsx(dt,{label:"Score",value:n.score||0,mono:!0,bold:!0})]}),(t==="Double Practice"||t==="Treble Practice"||t==="Around the Clock")&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Target",value:n.target||"â€”",mono:!0,bold:!0}),e.jsx(dt,{label:"Hits",value:n.hits||0,mono:!0,bold:!0}),n.totalNeeded&&e.jsx(dt,{label:"Progress",value:`${n.hits||0} / ${n.totalNeeded}`,mono:!0})]}),(t==="Count-Up"||t==="High Score"||t==="Low Score")&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Round",value:n.round||1,mono:!0}),e.jsx(dt,{label:"Score",value:n.score||0,mono:!0,bold:!0}),t==="High Score"&&e.jsx(dt,{label:"Best",value:n.bestScore||0,mono:!0})]}),(t==="Checkout 170"||t==="Checkout 121")&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Remaining",value:n.remaining||0,mono:!0,bold:!0}),e.jsx(dt,{label:"Attempts",value:n.attempts||0,mono:!0}),e.jsx(dt,{label:"Successes",value:n.successes||0,mono:!0})]}),t==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Target",value:`D${n.target||1}`,mono:!0,bold:!0}),e.jsx(dt,{label:"Score",value:n.score||0,mono:!0,bold:!0})]}),t==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Inning",value:n.inning||1,mono:!0}),e.jsx(dt,{label:"Score",value:n.score||0,mono:!0,bold:!0})]}),t==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Hole",value:n.hole||1,mono:!0}),e.jsx(dt,{label:"Strokes",value:n.strokes||0,mono:!0,bold:!0})]}),t==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{label:"Turn",value:n.turn||1,mono:!0}),n.winner&&e.jsx(dt,{label:"Result",value:"WINNER!",highlight:!0})]}),s&&(t==="X01"||t==="Cricket"||t==="American Cricket")&&i===1&&e.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:e.jsx(dt,{label:"Match",value:s,mono:!0,bold:!0,highlight:!0})})]})]},i))})}function dt({label:t,value:a,mono:s=!1,bold:r=!1,highlight:n=!1}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"opacity-70",children:[t,":"]}),e.jsx("span",{className:`${s?"font-mono":""} ${r?"font-semibold":""} ${n?"text-emerald-300":""}`,children:a})]})}function Im({matchAvg:t,allTimeAvg:a}){const s=t-a,r=s>0,n=Math.abs(s)<.01;let i="",l="text-slate-300";return n?(i="= All-time",l="text-slate-300"):r?(i=`+${s.toFixed(2)} vs avg`,l="text-emerald-400"):(i=`${s.toFixed(2)} vs avg`,l="text-orange-400"),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-70",children:"AVG vs Avg:"}),e.jsx("span",{className:`font-mono font-semibold ${l}`,children:i})]})}function Mm(t){return!t||Object.keys(t).length===0?"â€”":Object.entries(t).filter(([s,r])=>r===3).map(([s])=>s==="25"?"B":s).join(",")||"â€”"}function Am(t){if(!t.closed)return"Starting";const a=Object.values(t.closed).filter(s=>s===3).length;return a===0?"No marks":a<7?`${a}/7`:"Closing in"}function Gn(t,a,s,r,n,i,l,o,d,c,h,m,x,b,y,N,C,w,D,I,M,R,A){return u.useMemo(()=>{const v=[];if(t==="X01"){let p=0,F=0,H=0;if(b&&b.length>0){for(const _ of b)_.dartsThrown&&_.totalScored&&(F+=_.dartsThrown,H+=_.totalScored);F>0&&(p=H/F*3)}v.push({name:"You",isCurrentTurn:!!y,legsWon:r||0,score:a||0,lastScore:o||i||0,checkoutRate:h&&h>0?Math.round((c||0)/h*100):0,bestLeg:b&&b.length>0?`${Math.min(...b.map(_=>_.doubleDarts+(_.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:p,allTimeAvg:ln("You")||0}),N&&N!=="None"&&v.push({name:`${N} AI`,isCurrentTurn:!y,legsWon:n||0,score:s||0,lastScore:d||l||0,checkoutRate:x&&x>0?Math.round((m||0)/x*100):0,bestLeg:"â€”"})}return t==="Cricket"&&(v.push({name:"You",isCurrentTurn:!!y,closed:w?.marks||{},points:w?.points||0}),N&&N!=="None"&&v.push({name:`${N} AI`,isCurrentTurn:!y,closed:{},points:0})),t==="Shanghai"&&(v.push({name:"You",isCurrentTurn:!!y,round:D?.round||1,target:D?.target||1,score:D?.score||0}),N&&N!=="None"&&v.push({name:`${N} AI`,isCurrentTurn:!y,round:D?.round||1,target:D?.target||1,score:0})),t==="Killer"&&I&&I.length>0&&I.forEach((p,F)=>{const H=M?.[p.id];v.push({name:p.name,isCurrentTurn:F===A,number:R?.[p.id],lives:H?.lives||0,eliminated:H?.eliminated||!1})}),v},[t,a,s,r,n,i,l,o,d,c,h,m,x,b,y,N,w,D,I,M,R,A])}function Rm(t,a,s){return u.useMemo(()=>{const r=[];return!a||!a.players||a.players.length===0||a.players.forEach((n,i)=>{const l=i===a.currentPlayerIdx;if(t==="X01"){let o=0,d=0,c=0;if(n.legs&&n.legs.length>0){for(const h of n.legs)if(h.finished){const m=h.dartsThrown||0,x=Math.max(0,h.totalScoreStart-h.totalScoreRemaining)||0;d+=m,c+=x}}d>0&&(o=c/d*3),r.push({name:n.name||`Player ${i+1}`,isCurrentTurn:l,legsWon:n.legsWon||0,score:n.score||0,lastScore:n.lastVisitScore||0,checkoutRate:n.doublesAttempted>0?Math.round(n.doublesHit/n.doublesAttempted*100):0,bestLeg:n.bestLegDarts?`${n.bestLegDarts} darts`:"â€”",matchAvg:o,allTimeAvg:n.name?ln(n.name):0})}t==="Cricket"&&r.push({name:n.name||`Player ${i+1}`,isCurrentTurn:l,closed:n.cricket?.marks||{},points:n.cricket?.points||0}),t==="Killer"&&r.push({name:n.name||`Player ${i+1}`,isCurrentTurn:l,number:n.killerNumber||null,lives:n.killerLives||3,eliminated:n.killerEliminated||!1})}),r},[t,a,s])}const Hi=["X01","Double Practice"],bn=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice","Baseball","Golf","Tic Tac Toe","American Cricket","Scam","Fives","Sevens"],ja=[...Hi,...bn],Pm=["Easy","Medium","Hardened"];function ga(t,a,s){return Math.max(a,Math.min(s,t))}function Lm(t,a){let s=0;if(a==="Easy"){const r=[22,26,41,45,60];s=r[Math.floor(Math.random()*r.length)]}else a==="Medium"?s=Math.round(ga(60+(Math.random()*30-15),30,100)):s=Math.round(ga(80+(Math.random()*20-10),50,120));return t<=0?0:s>t?[100,85,81,60,57,45,41,26,22,20,1].find(n=>n<=t)??0:s}function Om({onClose:t}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:t,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const Bm="http://localhost:8787";function Um({user:t}){const{offlineLayout:a}=qt(),[s,r]=u.useState("X01"),[n,i]=u.useState(501),[l,o]=u.useState("None"),[d,c]=u.useState(!1),[h,m]=u.useState(!1),[x,b]=u.useState(n),[y,N]=u.useState(n),[C,w]=u.useState(!1),[D,I]=u.useState(!1),[M,R]=u.useState(1),[A,v]=u.useState(0),[p,F]=u.useState(0),[H,_]=u.useState(null),[z,T]=u.useState(1),[K,ee]=u.useState(1),[ie,ke]=u.useState([]),[Be,Ue]=u.useState(2e3),Oe=Na(),[je,Re]=u.useState(!1),[$,te]=u.useState(a==="modern"),[ce,ze]=u.useState(a==="modern");u.useEffect(()=>{te(a==="modern"),ze(a==="modern")},[a]);const[Pe,Te]=u.useState(1),[Ee,ht]=u.useState(!0),[Ce,me]=u.useState(0),[Le,pt]=u.useState(0),[It,is]=u.useState(0),[Ke,De]=u.useState(0),[Pt,le]=u.useState(0),[fe,ne]=u.useState(Kn()),[Z,He]=u.useState(An()),[ye,Ne]=u.useState(Rn()),[Xe,rt]=u.useState(Pn()),[ft,Ve]=u.useState(0),[yt,We]=u.useState(1),[wt,kt]=u.useState(27),[$t,et]=u.useState(0),[zt,os]=u.useState(0),[ls,es]=u.useState(!1),[Rt,Yt]=u.useState(1),[Ft,E]=u.useState(0),[ae,xe]=u.useState(0),$e=8,[Qe,Mt]=u.useState(1),[Lt,ts]=u.useState(0),[ps,Tt]=u.useState(0),_t=10,[V,we]=u.useState(1),[ot,us]=u.useState(0),[Rs,ks]=u.useState(0),vs=10,[Cs,Xt]=u.useState(170),[Ps,ws]=u.useState(0),[Ls,Vt]=u.useState(0),[Os,as]=u.useState(0),[Bs,Ts]=u.useState(121),[B,Q]=u.useState(0),[se,G]=u.useState(0),[S,O]=u.useState(0),[U,Y]=u.useState(20),[re,he]=u.useState(0),[ge,Se]=u.useState(0),[Ie,Et]=u.useState(30),[at,xt]=u.useState(!1),[ut,bt]=u.useState(Ua()),[cs,ms]=u.useState($a()),[Gt,hs]=u.useState(Li()),[fs,Zs]=u.useState(_a()),[vt,Ot]=u.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[tt,mt]=u.useState({}),[ct,ss]=u.useState({}),[Ht,Ct]=u.useState(!1),[xs,gt]=u.useState(0),[en,Qt]=u.useState(0),[Es,Ss]=u.useState(null),[Ds,Is]=u.useState(""),[Ye,jt]=u.useState(Oi()),[st,Bt]=u.useState(Oi()),[Ze,Zt]=u.useState(Ui(50)),[Nt,Ut]=u.useState(Ui(50)),[Ms,Us]=u.useState(Fi(70)),[js,yn]=u.useState(Fi(70)),[vn,Wt]=u.useState(0),[jn,Fe]=u.useState(0),[tn,qs]=u.useState(0),[$s,sn]=u.useState(n),[Ns,Fs]=u.useState(0),[ea,bs]=u.useState(0),[As,Nn]=u.useState(0);u.useRef(null);const[ta,Ln]=u.useState(0),[On,cn]=u.useState(0),[Ks,_s]=u.useState(0),[sa,zs]=u.useState(0),[dn,un]=u.useState(0),[wn,Bn]=u.useState(0),[mn,na]=u.useState(0),[aa,it]=u.useState(0),[ra,hn]=u.useState(0),[fn,Un]=u.useState(0),[qa,ia]=u.useState(0),[ka,Ca]=u.useState(0),[Ta,$n]=u.useState(0),[pr,Fn]=u.useState(0),[At,Sn]=u.useState(0),[Ea,_n]=u.useState(0),[za,Hn]=u.useState(0),[br,oa]=u.useState(0),[gr,Da]=u.useState(0),[la,kn]=u.useState(0),[Wn,xn]=u.useState(!1),[ns,ds]=u.useState(""),[Ia,ca]=u.useState(""),{favoriteDouble:Ma,callerEnabled:Cn,callerVoice:nn,callerVolume:qn,speakCheckoutOnly:zn,rememberLastOffline:yr,setLastOffline:f,autoStartOffline:j,cameraScale:k,setCameraScale:L,cameraAspect:X="wide",setCameraAspect:de,cameraFitMode:ue="fill",setCameraFitMode:q,cameraEnabled:be,textSize:Jt,boxSize:gs,autoscoreProvider:Hs,matchType:_e="singles",setMatchType:Aa,teamAName:da="Team A",setTeamAName:ys,teamBName:ua="Team B",setTeamBName:Ra}=qt(),vr=Hs==="manual",jr=Gn("X01",x,y,A,p,jn,On,Ns,Ks,wn,dn,aa,mn,ie,Ee,l),Va=Gn("Cricket",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,fe),Lc=Gn("Shanghai",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ee,l,void 0,fe,Z),Oc=Gn("Killer",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,vt,tt,ct,xs),Bc=Gn("Scam"),Uc=Gn("Fives"),$c=Gn("Sevens"),Tn=(g=>{switch(g){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(Jt),ma=u.useRef(null),ha=u.useRef(null),Nr=u.useRef(null),[fa,wr]=u.useState("first"),[Ga,Qi]=u.useState(1),Fc=u.useRef(null);u.useEffect(()=>{const g=Math.max(1,Math.floor(Number(Ga)||1)),P=fa==="first"?g:Math.max(1,Math.ceil(g/2));R(P)},[fa,Ga]),u.useEffect(()=>{if(!ce){Te(1);return}const g=()=>{const J=ma.current,oe=ha.current;if(!J||!oe)return;const qe=Nr.current?Nr.current.getBoundingClientRect().height:0,nt=Math.max(0,J.clientHeight-qe-6),Me=Math.max(0,J.clientWidth-8),ve=oe.getBoundingClientRect(),Ae=Pe||1,Ge=ve.height/Ae,lt=ve.width/Ae,Vs=nt>0?nt/Ge:1,Vn=Me>0?Me/lt:1,Ys=Math.min(1,Math.max(.5,Math.min(Vs,Vn)));Te(Ys)};g();const P=window.ResizeObserver,W=P?new P(()=>g()):null;return W&&ma.current&&W.observe(ma.current),W&&ha.current&&W.observe(ha.current),window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g);try{W&&ma.current&&W.unobserve(ma.current)}catch{}try{W&&ha.current&&W.unobserve(ha.current)}catch{}}},[ce,Pe]),u.useEffect(()=>{const g=P=>{const W=P?.detail?.mode;W&&(r(W),xa())};return window.addEventListener("ndn:auto-start",g),()=>window.removeEventListener("ndn:auto-start",g)},[]),u.useEffect(()=>{const g=P=>{const W=P?.detail?.formatType,J=P?.detail?.formatCount,oe=P?.detail?.startScore;(W==="first"||W==="best")&&wr(W),typeof J=="number"&&isFinite(J)&&Qi(Math.max(1,Math.floor(J))),typeof oe=="number"&&isFinite(oe)&&i(Math.max(1,Math.floor(oe)))};return window.addEventListener("ndn:offline-format",g),()=>window.removeEventListener("ndn:offline-format",g)},[]),u.useEffect(()=>{if(!j)return;const g=setTimeout(()=>xa(),50);return()=>clearTimeout(g)},[j]),u.useEffect(()=>{if(!je||Ee||l==="None"||As<=0)return;let g,P=performance.now();const W=J=>{const oe=J-P;P=J,Nn(qe=>{const nt=qe-oe;if(nt<=0){let Me=0,ve=y;for(;Me<3&&ve>0;){const Ae=Lm(ve,l),Ge=ga(Ae-Me*20,0,Math.min(60,ve)),lt=ve-Ge;if(cn(Ge),Ln(Ys=>Ys+1),Un(Ys=>Ys+1),lt<0){ve=y,_s(0),zs(0);break}_s(Ys=>Ys+Ge),Ca(Ys=>Ys+Ge);const Vs=ve,Vn=lt;if(Vs>50&&Vn<=50?zs(1):Vs<=50&&zs(Ys=>Ys+1),ve=lt,Me+=1,ve===0)break}if(N(ve),ve===0){Ks===180?_n(Ge=>Ge+1):Ks>=140?Hn(Ge=>Ge+1):Ks>=100&&oa(Ge=>Ge+1);const Ae=y;Ae<=170&&kn(Ge=>Math.max(Ge,Ae)),y<=50&&(na(Ge=>Ge+(sa>0?sa:1)),it(Ge=>Ge+1)),_s(0),zs(0),_("ai"),I(!0)}return ve>0&&Me>=3&&(Ks===180?_n(Ae=>Ae+1):Ks>=140?Hn(Ae=>Ae+1):Ks>=100&&oa(Ae=>Ae+1),_s(0),zs(0)),ht(!0),0}return nt}),g=requestAnimationFrame(W)};return g=requestAnimationFrame(W),()=>cancelAnimationFrame(g)},[je,Ee,l,y]);function xa(){m(!0),b(n),N(n),w(!1),Re(!0),ht(!0),me(0),Wt(0),Fe(0),qs(0),sn(n),Fs(0),bs(0),Nn(0),Ln(0),cn(0),_s(0),_(null),v(0),F(0),ke([]),he(0),Se(0),xt(!1),hn(0),Un(0),ia(0),Ca(0),$n(0),Fn(0),Sn(0),_n(0),Hn(0),oa(0),Da(0),kn(0),un(0),Bn(0),na(0),it(0);const g=Math.max(1,Math.floor(Number(Ga)||1));if(R(fa==="first"?g:Math.max(1,Math.ceil(g/2))),yr)try{f({mode:s,x01Start:n,firstTo:M,aiLevel:l})}catch{}}function _c(){b(n),N(n),w(!1),Re(!0),ht(!0),me(0),Wt(0),Fe(0),qs(0),sn(n),Fs(0),bs(0),Nn(0),Ln(0),cn(0),_s(0),_(null)}function Ja(g){qs(0),sn(g===0?n:x),bs(0),l!=="None"?(ht(!1),Nn(Be)):ht(!1)}function Pa(g){const P=x-g,W=tn+1;if(Fe(g),Wt(Me=>Me+1),hn(Me=>Me+1),P<0){try{const ve=x,Ae=$s;Js.getState().recordVisit("offline-x01",W,0,{preRemaining:ve,postRemaining:Ae,bust:!0,finish:!1})}catch{}if(b($s),x<=50){const ve=(ea||0)+1;un(Ae=>Ae+ve)}if(Cn)try{Mn(t?.username||"Player",0,Math.max($s,0),nn,{volume:qn,checkoutOnly:zn})}catch{}Ja($s),me(0),Fs(0),bs(0);return}b(P),qs(W),Fs(Me=>Me+g),ia(Me=>Me+g),me(0);const J=x,oe=P,qe=J>50&&oe<=50,nt=J<=50;if(qe?bs(1):nt&&bs(Me=>Me+1),P===0){try{const ve=Ns+g,Ae=x;Js.getState().recordVisit("offline-x01",W,ve,{preRemaining:Ae,postRemaining:0,finish:!0,bust:!1})}catch{}Ns+g===180?$n(ve=>ve+1):Ns+g>=140?Fn(ve=>ve+1):Ns+g>=100&&Sn(ve=>ve+1);const Me=$s;if(Me<=170&&Da(ve=>Math.max(ve,Me)),J<=50){const ve=(ea||0)+1;un(Ae=>Ae+ve),Bn(Ae=>Ae+1)}if(Cn){const ve=Ns+g;try{Mn(t?.username||"Player",ve,0,nn,{volume:qn,checkoutOnly:zn})}catch{}}_("player"),I(!0);return}if(W>=3){try{const Me=Ns+g,ve=x,Ae=P;Js.getState().recordVisit("offline-x01",W,Me,{preRemaining:ve,postRemaining:Ae,finish:!1,bust:!1})}catch{}if(Ns+g===180?$n(Me=>Me+1):Ns+g>=140?Fn(Me=>Me+1):Ns+g>=100&&Sn(Me=>Me+1),J<=50){const Me=(ea||0)+1;un(ve=>ve+Me)}if(Cn){const Me=Ns+g;try{Mn(t?.username||"Player",Me,Math.max(P,0),nn,{volume:qn,checkoutOnly:zn})}catch{}}Ja(P),Fs(0),bs(0)}}function Zi(){const g=ga(Math.round(Number(Ce)||0),0,60);Pa(g)}const[eo,Ka]=u.useState("");function to(){const g=Math.round(Number(eo)||0),P=ga(g,0,180);if(P===0&&g!==0){alert("Enter a number 0â€“180 for visit total");return}const W=x-P;if(Wt(J=>J+3),hn(J=>J+3),qs(3),Fs(P),P===180?$n(J=>J+1):P>=140?Fn(J=>J+1):P>=100&&Sn(J=>J+1),W<0){if(Cn)try{Mn(t?.username||"Player",0,Math.max($s,0),nn,{volume:qn,checkoutOnly:zn})}catch{}try{const J=x,oe=$s;Js.getState().recordVisit("offline-x01",3,0,{preRemaining:J,postRemaining:oe,bust:!0,finish:!1})}catch{}b($s),Ja($s),Fs(0),qs(0),bs(0),Ka("");return}if(b(W),Cn)try{Mn(t?.username||"Player",P,Math.max(W,0),nn,{volume:qn,checkoutOnly:zn})}catch{}if($s<=50&&(un(J=>J+3),W===0&&Bn(J=>J+1)),W===0){const J=$s;J<=170&&Da(oe=>Math.max(oe,J));try{const oe=x;Js.getState().recordVisit("offline-x01",3,P,{preRemaining:oe,postRemaining:0,finish:!0,bust:!1})}catch{}_("player"),I(!0),Ka("");return}try{const J=x,oe=W;Js.getState().recordVisit("offline-x01",3,P,{preRemaining:J,postRemaining:oe,finish:!1,bust:!1})}catch{}Ja(W),Fs(0),qs(0),bs(0),Ka("")}function so(g){const P=ga(Math.round(g||0),0,60);if(Fe(P),Wt(W=>W+1),hn(W=>W+1),Ai(P,Le)){const W=It+1;is(W),pt(J=>Math.min(20,J+1)),W>=21&&(_("player"),I(!0))}me(0)}function no(){so(Number(Ce))}function ao(){const g=gn(ns);if(g==null){alert("Enter like D16, 50, 25, T20");return}so(g),ds("")}function ro(g,P,W){if(ls)return;const J=yt,oe=P==="DOUBLE"&&W===J||!P&&g===J*2;oe&&os(qe=>qe+1),et(qe=>{const nt=qe+1;if(nt>=3){const Me=zt+(oe?1:0);Me>0?kt(Ae=>Ae+Me*J*2):kt(Ae=>Ae-J*2);const ve=J+1;return We(ve),os(0),ve>20&&es(!0),0}return nt})}function io(){ro(Math.max(0,Ce|0)),me(0)}function oo(){We(1),kt(27),et(0),os(0),es(!1)}function Sr(g){E(P=>P+Math.max(0,g|0)),xe(P=>{const W=P+1;return W>=3?(Yt(J=>J+1),0):W})}function kr(g){ts(P=>P+Math.max(0,g|0)),Tt(P=>{const W=P+1;return W>=3?(Mt(J=>J+1),0):W})}function Cr(g){us(P=>P+Math.max(0,g|0)),ks(P=>{const W=P+1;return W>=3?(we(J=>J+1),0):W})}function lo(g,P,W,J,oe,qe,nt,Me){const ve=g-nt;if(!(ve<0))if(ve===0){if(Me==="DOUBLE"||Me==="INNER_BULL"){qe(Ae=>Ae+1),oe(Ae=>Ae+1),J(()=>0),P(g);return}}else P(ve);J(Ae=>{const Ge=Ae+1;return Ge>=3?(oe(lt=>lt+1),0):Ge})}function co(g,P){lo(Cs,Xt,Ps,ws,Vt,as,g,P),Ps+1>=3&&Xt(170)}function uo(g,P){lo(Bs,Ts,B,Q,G,O,g,P),B+1>=3&&Ts(121)}function Ya(g){const P=gn(ns);if(P==null){alert("Enter like T20, D16, 25, 50");return}const W=ns.trim().toUpperCase(),J=W.startsWith("D")||W==="50"||W==="BULL"||W==="DBULL"||W==="IBULL"||W.includes("INNER");g?co(P,J?"DOUBLE":void 0):uo(P,J?"DOUBLE":void 0),ds("")}function Hc(){Xt(170),ws(0),Vt(0),as(0)}function Wc(){Ts(121),Q(0),G(0),O(0)}function Tr(g,P,W){if(at)return;(P==="TRIPLE"&&W===U||!P&&g===U*3)&&he(oe=>oe+1),Se(oe=>{const qe=oe+1;if(qe%3===0&&[20,19,18].includes(U)){const nt=[20,19,18],Me=nt.indexOf(U),ve=nt[(Me+1)%nt.length];Y(ve)}return Ie>0&&qe>=Ie&&xt(!0),qe})}function mo(){he(0),Se(0),xt(!1)}function qc(g,P,W){bt(J=>{const oe={...J};return gc(oe,g,P,W),oe})}function zc(){bt(Ua())}function Vc(g,P,W){ms(J=>{const oe={...J};return vc(oe,g,P,W),oe})}function Gc(){ms($a())}function Jc(g,P,W,J){hs(oe=>{const qe={...oe,board:[...oe.board]};return jc(qe,g,P,W,J),qe})}function Kc(){hs(Li())}function Yc(g,P,W){Zs(J=>{const oe={...J,marks:{...J.marks}};return wc(oe,g,P,W,()=>!1),oe})}function ho(){Zs(_a())}function Er(g,P,W){const J=rs[Ke];let oe=!1;if(typeof W=="number"&&W===J&&(P==="SINGLE"||P==="DOUBLE"||P==="TRIPLE")&&(oe=!0),J===25&&(P==="BULL"||g===25)&&(oe=!0),J===50&&(P==="INNER_BULL"||g===50)&&(oe=!0),oe||(g===J||g===J*2||g===J*3)&&(oe=!0),oe){const qe=Pt+1;le(qe),De(nt=>nt+1)}}function fo(){Er(Math.max(0,Ce|0)),me(0)}function xo(){const g=gn(ns);if(g==null){alert("Enter like T20, D5, 25, 50");return}Er(g),ds("")}function Dr(g,P,W){ne(J=>{const oe={...J,marks:{...J.marks}};return dc(oe,g,P,W,()=>!1),oe}),Ve(J=>{const oe=J+1;return oe>=3?0:oe})}function po(){Dr(Math.max(0,Ce|0)),me(0)}function Ir(g,P,W){He(J=>{const oe={...J,turnHits:{...J.turnHits}};return uc(oe,g,P,W),oe}),Ve(J=>{const oe=J+1;return oe>=3?(He(qe=>{const nt={...qe,turnHits:{...qe.turnHits}};return mc(nt),nt}),0):oe})}function bo(){Ir(Math.max(0,Ce|0)),me(0)}function go(g,P,W){Ne(J=>{const oe={...J,targets:[...J.targets]};return hc(oe,g,P,W),oe}),Ve(J=>{const oe=J+1;return oe>=3?(Ne(qe=>{const nt={...qe,targets:[...qe.targets]};return fc(nt),nt}),0):oe})}function yo(){go(Math.max(0,Ce|0)),me(0)}function vo(g,P,W){rt(J=>{const oe={...J};return xc(oe,g,P,W),oe}),Ve(J=>{const oe=J+1;return oe>=3?(rt(qe=>{const nt={...qe};return pc(nt),nt}),0):oe})}function jo(){vo(Math.max(0,Ce|0)),me(0)}function No(){const g=ns.trim().toUpperCase();if(!g)return null;if(g==="50"||g==="BULL"||g==="DBULL"||g==="IBULL")return 50;if(g==="25"||g==="OBULL")return 25;const P=g.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!P)return null;const W=P[1]||"S",J=parseInt(P[2],10);return J<1||J>20?null:J*(W==="S"?1:W==="D"?2:3)}function Mr(){const g=No();if(g==null){alert("Enter like T20, D16, 5, 25, 50");return}Pa(g),ds("")}function Xc(){const g=Ia.trim().split(`
`).map(P=>P.trim()).filter(P=>P);if(g.length!==0){for(const P of g){const W=gn(P);if(W==null){alert(`Invalid score: ${P}`);return}Pa(W)}ca("")}}function Qc(){tn!==0&&(b(g=>g+jn),qs(g=>Math.max(0,g-1)))}function wo(){const g=No();if(g==null){alert("Enter like T20, D16, 5, 25, 50");return}if(tn===0){Mr();return}const P=jn;b(W=>W+P),qs(W=>Math.max(0,W-1)),setTimeout(()=>Pa(g),0),ds("")}function Zc(){const g=H??"player",P=g==="player"?ea||void 0:sa||void 0,W=1,J=g==="player"?vn:ta;ke([...ie,{winner:g,doubleDarts:z,checkoutDarts:K,winnerDarts:J,doublesAtt:P,doublesHit:W}]),I(!1);let oe=A,qe=p;if(H==="player"?oe+=1:H==="ai"&&(qe+=1),v(oe),F(qe),_(null),oe>=M||qe>=M){try{qd(s,g==="player")}catch{}Re(!1),m(!1),b(n),N(n),xn(!0);return}_c()}const Ar=!Hi.includes(s)&&!(t?.fullAccess||t?.admin);return e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[e.jsxs("h2",{className:"text-2xl font-bold text-brand-700 mb-4",children:["Offline Game Modes ",a==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"ndn-shell-body",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsx("label",{className:"font-semibold",children:"Select game mode:"}),e.jsxs("select",{className:"input w-full",value:s,onChange:g=>r(g.target.value),children:[Hi.map(g=>e.jsx("option",{value:g,children:g},g)),bn.map(g=>e.jsxs("option",{value:g,disabled:!(t?.fullAccess||t?.admin),children:[g," ",t?.fullAccess||t?.admin?"":"(Premium)"]},g))]}),e.jsx(oc,{gameMode:s,compact:!0}),s==="Treble Practice"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"font-semibold",children:"Throws per game"}),e.jsx("input",{className:"input w-full",type:"number",min:3,step:3,value:Ie,onChange:g=>Et(Math.max(3,Math.floor(Number(g.target.value)||30)))})]}),e.jsx("div",{className:"sm:col-span-2 text-xs text-slate-300",children:"Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws."})]}),!t?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),s==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:n,onChange:g=>i(Number(g.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{className:"input w-full",value:l,onChange:g=>o(g.target.value),children:[e.jsx("option",{value:"None",children:"None"}),Pm.map(g=>e.jsx("option",{value:g,children:g},g))]}),l!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:Be/1e3,onChange:g=>Ue(Math.round(Number(g.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>c(!0),children:"X01 Rules & Regulations!"})]}),s==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply."})]}),!h&&e.jsx("button",{className:"btn",disabled:Ar,title:Ar?"PREMIUM required for this mode":"",onClick:xa,children:"Start Match"}),je&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${$?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(Xs,{storageKey:"ndn:modal:offline-match",className:`${$?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:$,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:ce?"hidden":"auto"},ref:g=>{ma.current=g},children:[e.jsx("div",{ref:g=>{Nr.current=g},children:e.jsx(Sc,{left:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[s,s==="X01"?` / ${n}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",M," Â· Legs ",A,"-",p]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${a==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:a==="modern"?"Modern layout":"Classic layout"})]}),right:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>L(Math.max(.5,Math.round((k-.05)*100)/100)),title:"Decrease camera size",children:"âˆ’"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(k*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>L(Math.min(1.25,Math.round((k+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:ce?"Actual Size":"Fit All",onClick:()=>ze(g=>!g),children:ce?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:$?"Restore":"Maximize",onClick:()=>te(g=>!g),children:$?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{xa()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{Re(!1),m(!1)},children:"Quit"})]})})}),e.jsxs("div",{ref:g=>{ha.current=g},className:"will-change-transform",style:ce?{transform:`scale(${Pe})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,Pe))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:s==="X01"?"X01 Match":s}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",s]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",n]}),e.jsxs("div",{ref:Fc,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const g=x!==n||y!==n||tn>0,P=`px-2 py-0.5 rounded border text-xs ${g?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${P} ${fa==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{g||wr("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${P} ${fa==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{g||wr("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${g?"opacity-50":""}`,type:"number",min:1,step:1,value:Ga,onChange:W=>Qi(Math.max(1,Math.floor(Number(W.target.value)||1))),disabled:g,title:fa==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",A,"â€“",p]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Match"}),e.jsxs("select",{className:`btn ${Tn}`,value:_e,onChange:g=>Aa(g.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${Tn} w-[7.5rem]`,value:da,onChange:g=>ys(g.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${Tn} w-[7.5rem]`,value:ua,onChange:g=>Ra(g.target.value),placeholder:"Team B"})]})]}),s!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[s==="Double Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Gs[Le]?.label||"â€”"})]})}),s==="Around the Clock"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:rs[Ke]===25?"25 (Outer Bull)":rs[Ke]===50?"50 (Inner Bull)":rs[Ke]||"â€”"})]})}),s==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket â€” Close 20â€“15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:Wa.map(g=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:g===25?"Bull":g}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,fe.marks?.[g]||0)," / 3"]})]},g))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:fe.points})]}),bm(fe)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ne(Kn()),Ve(0)},children:"Reset"})]})]}),s==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Z.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Z.score]}),Z.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{He(An()),Ve(0)},children:"Reset"})]})]}),s==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[ye.stage+1,"/",ye.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const g=dr(ye);return g?g.kind==="ANY_NUMBER"?"Any":g.kind==="BULL"?"Bull":g.kind==="DOUBLE"||g.kind==="TRIPLE"||g.kind==="NUMBER"?`${g.kind} ${g.num}`:"â€”":"â€”"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",ye.score]}),ye.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Ne(Rn()),Ve(0)},children:"Reset"})]})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Xe.round," Â· Target ",Xe.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Xe.score]}),Xe.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{rt(Pn()),Ve(0)},children:"Reset"})]})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",yt]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",wt]}),ls&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:oo,children:"Reset"})]})]}),s==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Rt,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ft]})]}),s==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Qe,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Lt]})]}),s==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",V,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",ot]})]}),s==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Cs}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",Ls," Â· Successes: ",Os]})]}),s==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Bs}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",se," Â· Successes: ",S]})]}),s==="Treble Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",U]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",re]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("div",{className:"inline-flex items-center gap-1",children:[20,19,18].map(g=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${U===g?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>Y(g),children:["T",g]},`tpick-header-${g}`))}),e.jsx("span",{className:"opacity-60 text-xs",children:"or"}),e.jsx("select",{className:"input w-24",value:U,onChange:g=>Y(parseInt(g.target.value,10)),children:Array.from({length:20},(g,P)=>P+1).map(g=>e.jsx("option",{value:g,children:g},g))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:mo,children:"Reset"})]})]})}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ut.inning}),e.jsxs("div",{className:"text-sm",children:["Score: ",e.jsx("span",{className:"font-semibold",children:ut.score})]})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:cs.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes: ",e.jsx("span",{className:"font-semibold",children:cs.strokes})]})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Gt.turn}),Gt.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",Gt.winner||"â€”"]})]}),s==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Target"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ji[Ye.targetIndex]}),e.jsxs("div",{className:"text-sm",children:["Progress: ",e.jsxs("span",{className:"font-semibold",children:[Ye.targetIndex+1,"/",ji.length]})]}),Ye.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["ðŸŽ‰ Finished in ",Ye.darts," darts!"]})]}),s==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Ze.score,"/",Ze.target]}),e.jsxs("div",{className:"text-sm",children:["Darts: ",e.jsx("span",{className:"font-semibold",children:Ze.darts})]}),Ze.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",Ze.target,"!"]})]}),s==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Ms.score,"/",Ms.target]}),e.jsxs("div",{className:"text-sm",children:["Darts: ",e.jsx("span",{className:"font-semibold",children:Ms.darts})]}),Ms.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",Ms.target,"!"]})]}),s==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20â€“12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:fr.map(g=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:g===25?"Bull":g}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,fs.marks?.[g]||0)," / 3"]})]},g))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:fs.points})]}),Dm(fs)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:ho,children:"Reset"})]})]}),s==="Killer"&&e.jsx(e.Fragment,{children:Ht?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:vt[xs]?.name||"â€”"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Es?`${vt.find(g=>g.id===Es)?.name||"Winner"} Wins`:Ds||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):a==="modern"?e.jsx("div",{className:"grid grid-cols-1 gap-2 mb-2 items-stretch",children:e.jsx("div",{className:"min-w-0 space-y-2 flex flex-col justify-between",children:vr?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${Tn}`,onClick:()=>L(Math.max(.5,Math.round((k-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${Tn} min-w-[2.5rem] text-center`,children:[Math.round(k*100),"%"]}),e.jsx("button",{className:`btn ${Tn}`,onClick:()=>L(Math.min(1.25,Math.round((k+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Tn}`,title:"Toggle fit/fill",onClick:()=>q(ue==="fill"?"fit":"fill"),children:ue==="fill"?"Fill":"Fit"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Tn}`,title:"Toggle camera aspect",onClick:()=>de(X==="square"?"wide":"square"),children:X==="square"?"Square":"Wide"})]})}),e.jsxs("div",{className:"flex items-stretch justify-end min-w-0 flex-1 min-h-0 ndn-camera-tall",children:[s==="Double Practice"&&e.jsxs("div",{className:"w-full text-center mb-3",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Current Target"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[It," / 21"]})]}),s==="Around the Clock"&&e.jsxs("div",{className:"w-full text-center mb-3",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Current Target"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Pt," / ",rs.length]})]}),e.jsx(va,{storageKey:"ndn:camera:tile:offline:primary",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:720,defaultHeight:420,minWidth:320,minHeight:220,maxWidth:1600,maxHeight:900,autoFill:!0,children:e.jsx(cr,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic"})})]})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:1fr_1.2fr_1fr] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),Ee?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:x}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-x/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:jn})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:ra>0?(qa/ra*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",vn]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(g=>e.jsx("span",{className:`w-2 h-2 rounded-full ${g<tn?"bg-emerald-400":"bg-white/20"}`},g))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",dn," Â· Hit ",wn]})]}),x<=170&&x>0&&(()=>{const P=Mi(x,Ma)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:P})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall",children:e.jsx(va,{storageKey:"ndn:camera:tile:offline:center",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:720,defaultHeight:420,minWidth:320,minHeight:220,maxWidth:1600,maxHeight:900,autoFill:!0,children:e.jsx(cr,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic",fill:!0})})}),e.jsxs("div",{className:`mt-2 ${gs==="small"?"p-2":gs==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${Jt==="small"?"text-xs":Jt==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const g=Ee?t?.username||"You":l==="None"?"â€”":`${l} AI`,P=Ee?x:l==="None"?0:y,W=Ee?jn:On,J=Ee?Ns:Ks,oe=Ee?vn:ta,qe=n-(Ee?x:l==="None"?n:y),nt=oe>0?qe/oe*3:0,Me=`${A}-${p}`,ve=ie.length>0?`${Math.min(...ie.map(Ae=>Ae.doubleDarts+(Ae.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:Me}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:g}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:P}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:nt.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:J||W}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:ve})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[l==="None"?"Opponent":`${l} AI`," Remain"]}),Ee?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:l!=="None"?y:"N/A"}),l!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-y/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:l==="None"?0:On})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:l!=="None"?fn>0?(ka/fn*3).toFixed(1):"0.0":"â€”"})]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",ta]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",mn," Â· Hit ",aa]})]})]})]})}),s!=="X01"?e.jsxs("div",{className:"space-y-2",children:[s==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Gs[Le]?.label||"â€”"})]}),be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,onAutoDart:(g,P)=>{if((P==="DOUBLE"||P==="INNER_BULL")&&Ai(g,Le)){const J=It+1,oe=Le+1;is(J),pt(oe),J>=Gs.length&&setTimeout(()=>{is(0),pt(0)},250)}},immediateAutoCommit:!0})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&no()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:no,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:ns,onChange:g=>ds(g.target.value),onKeyDown:g=>{g.key==="Enter"&&ao()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ao,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",It," of 21"]})]}),s==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:rs[Ke]===25?"25 (Outer Bull)":rs[Ke]===50?"50 (Inner Bull)":rs[Ke]||"â€”"})]}),be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{Er(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&fo()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:fo,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:ns,onChange:g=>ds(g.target.value),onKeyDown:g=>{g.key==="Enter"&&xo()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:xo,children:"Add"})]}),Pt>=rs.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{le(0),De(0)},children:"Reset"})]})]}),s==="Cricket"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{Dr(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&po()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:po,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ne(Kn()),Ve(0)},children:"Reset"})]})]}),s==="Shanghai"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{Ir(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&bo()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:bo,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{He(An()),Ve(0)},children:"Reset"})]})]}),s==="Halve It"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{go(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&yo()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:yo,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ne(Rn()),Ve(0)},children:"Reset"})]})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{vo(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&jo()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:jo,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{rt(Pn()),Ve(0)},children:"Reset"})]})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{ro(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&io()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:io,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:oo,children:"Reset"})]})]}),s==="Count-Up"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:g=>Sr(g)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&(Sr(Ce),me(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Sr(Ce),me(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Yt(1),E(0),xe(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Rt,"/",$e]})]}),s==="High Score"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:g=>kr(g)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&(kr(Ce),me(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{kr(Ce),me(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Mt(1),ts(0),Tt(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Qe,"/",_t]})]}),s==="Low Score"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:g=>Cr(g)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&(Cr(Ce),me(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Cr(Ce),me(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{we(1),us(0),ks(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",V,"/",vs]})]}),s==="Checkout 170"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P)=>co(g,P==="MISS"?void 0:P)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:ns,onChange:g=>ds(g.target.value),onKeyDown:g=>{g.key==="Enter"&&Ya(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Ya(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Hc,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",Cs," Â· Attempts: ",Ls," Â· Successes: ",Os]})]}),s==="Checkout 121"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P)=>uo(g,P==="MISS"?void 0:P)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:ns,onChange:g=>ds(g.target.value),onKeyDown:g=>{g.key==="Enter"&&Ya(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Ya(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Wc,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",Bs," Â· Attempts: ",se," Â· Successes: ",S]})]}),s==="Treble Practice"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{Tr(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:ns,onChange:g=>ds(g.target.value),onKeyDown:g=>{if(g.key==="Enter"){const P=gn(ns);P!=null&&Tr(P,void 0,void 0),ds("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const g=gn(ns);g!=null&&Tr(g,void 0,void 0),ds("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",re," Â· Misses: ",Math.max(0,ge-re)," Â· Darts: ",ge,Ie>0?`/${Ie}`:""]}),at&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:mo,children:"Reset"})]})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{qc(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:zc,children:"Reset"})})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{Vc(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Gc,children:"Reset"})})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(g,P)=>P).map(g=>e.jsx("button",{className:`h-16 rounded-xl border ${Gt.board[g]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(Gt.finished||Gt.board[g])return;const P=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),W=P%3===0?"TRIPLE":P%2===0?"DOUBLE":"SINGLE",J=g,oe=Fa[J],qe=oe.type==="BULL"?null:oe.num||null;Jc(J,P,W,qe)},children:Gt.board[g]||""},g))}),be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Kc,children:"Reset"})})]}),s==="American Cricket"&&e.jsxs(e.Fragment,{children:[be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{Yc(g,P==="MISS"?void 0:P,W?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:ho,children:"Reset"})})]}),s==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:ji[st.targetIndex]})]}),be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{Bt(Bi(st,g,P))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:1,max:25,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&Bt(Sl(st,Ce)),me(0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Bt(Sl(st,Ce)),me(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>Bt(Nm()),children:"Reset"})]}),st.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["ðŸŽ‰ Finished in ",st.darts," darts!"]})]}),s==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score: ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[Nt.score,"/",Nt.target]})]}),be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{Ut($i(Nt,g))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:5,max:50,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&Ut(kl(Nt,Ce)),me(0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Ut(kl(Nt,Ce)),me(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>Ut(km(Nt.target)),children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts: ",Nt.darts]}),Nt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",Nt.target," in ",Nt.darts," darts!"]})]}),s==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score: ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[js.score,"/",js.target]})]}),be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{yn(_i(js,g))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:7,max:21,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&yn(Cl(js,Ce)),me(0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{yn(Cl(js,Ce)),me(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>yn(Em(js.target)),children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 7, 14, 21 Â· Darts: ",js.darts]}),js.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",js.target," in ",js.darts," darts!"]})]}),s==="Killer"&&e.jsx(e.Fragment,{children:Ht?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:vt.map(g=>{const P=tt[g.id],W=ct[g.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${P?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:g.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${P?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:P?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number: ",e.jsx("span",{className:"font-semibold",children:W})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:P?.lives??0})]})]},g.id)})}),be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{if(Es)return;const J=P==="MISS"?void 0:P,oe=W?.sector??null,qe=vt[xs];qe&&(mt(nt=>{const Me={};Object.keys(nt).forEach(Ge=>Me[Ge]={...nt[Ge]});const ve=Ri(qe.id,Me,J,oe);if(ve.becameKiller)Is(`${qe.name} became a Killer`);else if(ve.victimId){const Ge=vt.find(lt=>lt.id===ve.victimId);Is(`${qe.name} hit ${Ge?.name}'s ${ct[ve.victimId]} (${ve.livesRemoved} life${(ve.livesRemoved||0)>1?"s":""})`)}else Is("No effect");const Ae=Pi(Me);return Ae&&Ss(Ae),Me}),Qt(nt=>{const Me=nt+1;if(Me>=3){let ve=xs;for(let Ae=1;Ae<=vt.length;Ae++){const Ge=(xs+Ae)%vt.length,lt=vt[Ge].id,Vs=tt[lt];if(Vs&&!Vs.eliminated&&Vs.lives>0){ve=Ge;break}}return gt(ve),0}return Me}))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:ns,onChange:g=>ds(g.target.value),onKeyDown:g=>{if(g.key==="Enter"){if(Es)return;const W=ns.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!W){ds("");return}const J=W[1]||"S",oe=parseInt(W[2],10),qe=J==="D"?"DOUBLE":J==="T"?"TRIPLE":"SINGLE",nt=vt[xs];mt(Me=>{const ve={};Object.keys(Me).forEach(lt=>ve[lt]={...Me[lt]});const Ae=Ri(nt.id,ve,qe,oe);if(Ae.becameKiller)Is(`${nt.name} became a Killer`);else if(Ae.victimId){const lt=vt.find(Vs=>Vs.id===Ae.victimId);Is(`${nt.name} hit ${lt?.name}'s ${ct[Ae.victimId]} (${Ae.livesRemoved} life${(Ae.livesRemoved||0)>1?"s":""})`)}else Is("No effect");const Ge=Pi(ve);return Ge&&Ss(Ge),ve}),ds(""),Qt(Me=>{const ve=Me+1;if(ve>=3){let Ae=xs;for(let Ge=1;Ge<=vt.length;Ge++){const lt=(xs+Ge)%vt.length,Vs=vt[lt].id,Vn=tt[Vs];if(Vn&&!Vn.eliminated&&Vn.lives>0){Ae=lt;break}}return gt(Ae),0}return ve})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let g=xs;for(let P=1;P<=vt.length;P++){const W=(xs+P)%vt.length,J=vt[W].id,oe=tt[J];if(oe&&!oe.eliminated&&oe.lives>0){g=W;break}}gt(g),Qt(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{mt({}),ss({}),Ct(!1),gt(0),Qt(0),Ss(null),Is("")},children:"Reset"})]}),Es&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner: ",vt.find(g=>g.id===Es)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{mt({}),ss({}),Ct(!1),gt(0),Qt(0),Ss(null),Is("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:vt.map((g,P)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:g.name,onChange:W=>{const J=W.target.value;Ot(oe=>oe.map((qe,nt)=>nt===P?{...qe,name:J}:qe))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Ot(W=>W.filter((J,oe)=>oe!==P)),disabled:vt.length<=2,children:"Remove"})]},g.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Ot(g=>{const P=`p${g.length+1}`;return[...g,{id:P,name:`Player ${g.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(vt.length<2){alert("Need at least 2 players");return}const g=vt.map(J=>J.id),P=ym(g),W={};g.forEach(J=>{W[J]=bc(P[J])}),ss(P),mt(W),gt(0),Qt(0),Ss(null),Is("Assigned numbers"),Ct(!0)},children:"Assign Numbers & Start"})]})]})})]}):Ee?e.jsxs("div",{className:"space-y-2",children:[s==="X01"&&e.jsx(e.Fragment,{children:e.jsx(Dn,{gameMode:"X01",players:jr,matchScore:`${A}-${p}`})}),s==="X01"&&be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P)=>{g>0&&Pa(g)}})}),s==="Cricket"&&e.jsx(e.Fragment,{children:e.jsx(Dn,{gameMode:"Cricket",players:Va})}),s==="Cricket"&&be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{g>0&&Dr(g,P==="MISS"?void 0:P,W?.sector??null)}})}),s==="Shanghai"&&e.jsx(e.Fragment,{children:e.jsx(Dn,{gameMode:"Shanghai",players:Lc})}),s==="Shanghai"&&be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{g>0&&Ir(g,P==="MISS"?void 0:P,W?.sector??null)}})}),s==="Killer"&&e.jsx(e.Fragment,{children:e.jsx(Dn,{gameMode:"Killer",players:Oc})}),s==="Scam"&&e.jsx(e.Fragment,{children:e.jsx(Dn,{gameMode:"Scam",players:Bc})}),s==="Scam"&&be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{g>0&&Bt(Bi(st,g,P))}})}),s==="Fives"&&e.jsx(e.Fragment,{children:e.jsx(Dn,{gameMode:"Fives",players:Uc})}),s==="Fives"&&be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{g>0&&Ut($i(Nt,g))}})}),s==="Sevens"&&e.jsx(e.Fragment,{children:e.jsx(Dn,{gameMode:"Sevens",players:$c})}),s==="Sevens"&&be&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(g,P,W)=>{g>0&&yn(_i(js,g))}})}),e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:Ce,onChange:g=>me(Number(g.target.value||0)),onKeyDown:g=>{g.key==="Enter"&&(g.shiftKey?Qc():Zi())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Zi,title:"Add a single dart (0â€“60)",children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,max:180,placeholder:"Visit total (0â€“180)",value:eo,onChange:g=>Ka(g.target.value),onKeyDown:g=>{g.key==="Enter"&&to()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:to,title:"Commit a full 3-dart total like 93",children:"Commit Visit"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:ns,onChange:g=>ds(g.target.value),onKeyDown:g=>{g.key==="Enter"&&(g.shiftKey?wo():Mr())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:wo,disabled:tn===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Mr,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:Ia,onChange:g=>ca(g.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Xc,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>ca(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add Â· Shift+Enter to Replace Last"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"font-semibold",children:[l==="None"?"Opponent":`${l} AI`," Turn"]}),l!=="None"?e.jsxs("div",{className:"text-sm text-slate-300",children:["Throwing in ",Math.ceil(As/1e3),"s..."]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>ht(!0),children:"Switch Back to You"})})]}),e.jsx("div",{className:"h-1"})]})]})})}),d&&e.jsx(Om,{onClose:()=>c(!1)}),Ar&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const P=await(await fetch(`${Bm}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t?.email})})).json();P.ok&&P.url?(window.location.href=P.url,P.development&&Oe("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):P.error==="STRIPE_NOT_CONFIGURED"?Oe("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):Oe("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{Oe("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â· ",Fl(_l(),5)]})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(Xs,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(g=>e.jsx("button",{className:`btn ${z===g?"bg-brand-600":""}`,onClick:()=>T(g),children:g},g))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(g=>e.jsx("button",{className:`btn ${K===g?"bg-brand-600":""}`,onClick:()=>ee(g),children:g},g))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:Zc,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{I(!1),xa()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{I(!1),Re(!1),m(!1)},children:"Back to Menu"})]})]})}),Wn&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(Xs,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[s," Â· ",n," start Â· First to ",M]}),(()=>{const g=ra>0?qa/ra*3:0,P=g*3,W=(()=>{const Ge=ie.filter(lt=>lt.winner==="player"&&typeof lt.winnerDarts=="number").map(lt=>lt.winnerDarts);return Ge.length?`${Math.min(...Ge)} darts`:"â€”"})(),J=(()=>{const Ge=ie.filter(lt=>lt.winner==="player"&&typeof lt.winnerDarts=="number").map(lt=>lt.winnerDarts);return Ge.length?`${Math.max(...Ge)} darts`:"â€”"})(),oe=dn>0?Math.round(wn/dn*100):0,qe=fn>0?ka/fn*3:0,nt=qe*3,Me=(()=>{const Ge=ie.filter(lt=>lt.winner==="ai"&&typeof lt.winnerDarts=="number").map(lt=>lt.winnerDarts);return Ge.length?`${Math.min(...Ge)} darts`:"â€”"})(),ve=(()=>{const Ge=ie.filter(lt=>lt.winner==="ai"&&typeof lt.winnerDarts=="number").map(lt=>lt.winnerDarts);return Ge.length?`${Math.max(...Ge)} darts`:"â€”"})(),Ae=mn>0?Math.round(aa/mn*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:t?.username||"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:A}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:g.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:P.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:dn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[oe,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:W})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:J})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Ta})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[A," â€“ ",p]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:l==="None"?"Opponent":`${l} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:p}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:qe.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:nt.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:mn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[Ae,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:Me})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:ve})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Ea})]})]})]})]})})(),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ie.map((g,P)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${g.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",P+1,": ",g.winner==="player"?"You":l==="None"?"Opp":"AI"," Â· Dbl ",g.doubleDarts," Â· CO ",g.checkoutDarts]},P))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(pm,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>xn(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{xn(!1),xa()},children:"Rematch"})]})]})}),ie.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:ie.map((g,P)=>e.jsxs("li",{children:["Leg ",P+1,": Double darts: ",g.doubleDarts,", Checkout darts: ",g.checkoutDarts]},P))})]})]})]})}const kc="ndn:messages:inbox",Cc="ndn:messages:unread";function $m(){try{const t=localStorage.getItem(kc),a=t?JSON.parse(t):[],s=Number(localStorage.getItem(Cc)||"0")||0;return{inbox:Array.isArray(a)?a.filter(n=>n&&typeof n.id=="string").slice(0,200):[],unread:s}}catch{return{inbox:[],unread:0}}}function tr(t,a){try{localStorage.setItem(kc,JSON.stringify(t))}catch{}try{localStorage.setItem(Cc,String(a))}catch{}}const Tl=$m(),Wi=Qs((t,a)=>({inbox:Tl.inbox,unread:Tl.unread,inGame:!1,setInGame:s=>t({inGame:s}),add:s=>t(r=>{const n=r.inbox.some(o=>o.id===s.id&&o.ts===s.ts),i=n?r.inbox:[s,...r.inbox].slice(0,200),l=r.unread+(n?0:1);return tr(i,l),{inbox:i,unread:l}}),load:s=>t(r=>{const n=[...s].sort((i,l)=>l.ts-i.ts).slice(0,200);return tr(n,r.unread),{inbox:n,unread:r.unread}}),markAllRead:()=>{const s=a();tr(s.inbox,0),t({unread:0})},remove:s=>t(r=>{const n=r.inbox.filter(l=>l.id!==s),i=r.unread;return tr(n,i),{inbox:n,unread:i}})})),Tc=[/\b(f+[\W_]*u+[\W_]*c+[\W_]*k+)\b/gi,/\b(s+[\W_]*h+[\W_]*i+[\W_]*t+)\b/gi,/\b(b+[\W_]*i+[\W_]*t+[\W_]*c+[\W_]*h+)\b/gi,/\b(a+[\W_]*s+[\W_]*s+[\W_]*h+[\W_]*o+[\W_]*l+[\W_]*e+)\b/gi,/\b(d+[\W_]*a+[\W_]*m+[\W_]*n+)\b/gi,/\b(c+[\W_]*r+[\W_]*a+[\W_]*p+)\b/gi,/\b(p+[\W_]*i+[\W_]*s+[\W_]*s+)\b/gi];function Fm(t){return t.replace(/[\p{L}\p{N}]/gu,"*")}function Ec(t){if(!t)return t;let a=t;for(const s of Tc)a=a.replace(s,r=>Fm(r));return a}function _m(t){return t?Tc.some(a=>a.test(t)):!1}function xr({tabs:t,active:a,onChange:s,className:r}){return e.jsxs("div",{className:`relative ${r||""}`,children:[e.jsx("div",{className:"absolute inset-0 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 pointer-events-none"}),e.jsx("div",{className:"relative overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx("div",{className:"flex items-center gap-2 min-w-max",children:t.map(n=>{const i=n.key===a;return e.jsx("button",{type:"button",onClick:()=>s(n.key),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98]
                  ${i?"bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white shadow-indigo-500/30":"bg-white/10 text-slate-100 hover:bg-white/15"}
                `,"aria-pressed":i,children:n.label},n.key)})})}),e.jsx("style",{children:`
        /* Hide scrollbars on WebKit/Firefox for a cleaner pill row */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})}function Hm(t){if(!t)return"";const a=Math.floor((Date.now()-t)/1e3);if(a<60)return`${a}s ago`;const s=Math.floor(a/60);if(s<60)return`${s}m ago`;const r=Math.floor(s/60);return r<24?`${r}h ago`:`${Math.floor(r/24)}d ago`}function Wm({user:t}){const a=Na(),s=String(t?.email||"").toLowerCase(),[r,n]=u.useState([]),[i,l]=u.useState([]),[o,d]=u.useState([]),[c,h]=u.useState(""),[m,x]=u.useState("all"),[b,y]=u.useState(!1),N=Wi(),[C,w]=u.useState([]),[D,I]=u.useState([]),[M,R]=u.useState({show:!1});async function A(){if(s)try{const[T,K,ee,ie]=await Promise.all([fetch(`/api/friends/list?email=${encodeURIComponent(s)}`).then(ke=>ke.json()),fetch(`/api/friends/suggested?email=${encodeURIComponent(s)}`).then(ke=>ke.json()),fetch(`/api/friends/requests?email=${encodeURIComponent(s)}`).then(ke=>ke.json()),fetch(`/api/friends/outgoing?email=${encodeURIComponent(s)}`).then(ke=>ke.json())]);n(T.friends||[]),l(K.suggestions||[]),w(ee.requests||[]),I(ie.requests||[])}catch{}}u.useEffect(()=>{A()},[s]);async function v(T){if(h(T),!T){d([]);return}try{const ee=await(await fetch(`/api/friends/search?q=${encodeURIComponent(T)}`)).json();d(ee.results||[])}catch{}}async function p(T){if(!(!s||!T)){y(!0);try{await fetch("/api/friends/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:T})}),await A(),h(""),d([]),a("Friend added",{type:"success"})}finally{y(!1)}}}async function F(T){if(!(!s||!T)){y(!0);try{await fetch("/api/friends/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:T})}),await A(),a("Friend removed",{type:"info"})}finally{y(!1)}}}const H=u.useMemo(()=>m==="all"?r:r.filter(T=>(T.status||"offline")===m),[r,m]);async function _(T){if(!T){a("Room unavailable",{type:"error"});return}try{const K=new CustomEvent("ndn:spectate-request",{detail:{roomId:T}});window.dispatchEvent(K),a("Opening spectator viewâ€¦",{type:"info"})}catch{}}const z=C.length+D.length;return e.jsxs("div",{className:"card ndn-game-shell",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Friends"}),e.jsx("p",{className:"mb-2 text-brand-600",children:"Manage your friends. See whoâ€™s online, in-game, or offline; find new teammates; and invite people to play."}),e.jsxs("div",{className:"text-xs opacity-70 mb-3",children:["Online: ",r.filter(T=>T.status==="online").length," Â· In-game: ",r.filter(T=>T.status==="ingame").length," Â· Offline: ",r.filter(T=>!T.status||T.status==="offline").length]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"md:col-span-2 p-3 rounded-2xl bg-black/30 border border-white/10",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"font-semibold text-white/90",children:"Your Friends"})}),e.jsx(xr,{tabs:[{key:"all",label:"All"},{key:"online",label:"Online"},{key:"ingame",label:"In-Game"},{key:"offline",label:"Offline"},{key:"requests",label:`Requests ${z>0?"("+z+")":""}`}],active:m,onChange:T=>x(T),className:"mb-3"}),m==="requests"?e.jsx("ul",{className:"space-y-2",children:z>0?e.jsxs(e.Fragment,{children:[C.length>0&&C.map(T=>e.jsxs("li",{className:"p-3 rounded bg-black/20 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:T.fromUsername||T.fromEmail||"Unknown User"}),e.jsx("span",{className:"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded",children:"Incoming"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{y(!0);try{if((await fetch("/api/friends/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requester:T.fromEmail})})).ok){w(ie=>ie.filter(ke=>ke.id!==T.id));const ee={email:T.fromEmail,username:T.fromUsername,status:"offline"};n(ie=>[...ie,ee]),I(ie=>ie.filter(ke=>ke.toEmail!==T.fromEmail)),a("Friend request accepted",{type:"success"}),setTimeout(()=>A(),100)}else a("Failed to accept request",{type:"error"})}catch{a("Error accepting request",{type:"error"})}finally{y(!1)}},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:async()=>{y(!0);try{(await fetch("/api/friends/decline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requester:T.fromEmail})})).ok?(w(ee=>ee.filter(ie=>ie.id!==T.id)),I(ee=>ee.filter(ie=>ie.toEmail!==T.fromEmail)),a("Friend request declined",{type:"info"}),setTimeout(()=>A(),100)):a("Failed to decline request",{type:"error"})}finally{y(!1)}},children:"Decline"})]})]},`incoming-${T.id||T.fromEmail}`)),D.length>0&&D.map(T=>e.jsxs("li",{className:"p-3 rounded bg-black/20 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:T.toUsername||T.toEmail||"Unknown User"}),e.jsx("span",{className:"text-xs bg-amber-600/20 text-amber-400 px-2 py-1 rounded",children:"Pending"})]}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 self-start",onClick:async()=>{y(!0);try{(await fetch("/api/friends/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:T.toEmail})})).ok?(I(ee=>ee.filter(ie=>ie.id!==T.id)),a("Friend request cancelled",{type:"info"}),setTimeout(()=>A(),100)):a("Failed to cancel request",{type:"error"})}finally{y(!1)}},children:"Cancel"})]},`outgoing-${T.id||T.toEmail}`))]}):e.jsx("li",{className:"text-sm opacity-70",children:"No friend requests yet."})}):e.jsxs("ul",{className:"space-y-2",children:[H.map(T=>e.jsxs("li",{className:"p-2 rounded bg-black/20 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${T.status==="online"?"bg-emerald-400":T.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{className:"font-semibold",children:T.username||T.email}),e.jsxs("span",{className:"text-xs opacity-70",children:[T.status||"offline",T.status!=="online"&&T.lastSeen?` Â· ${Hm(T.lastSeen)}`:""]}),T.status==="ingame"&&T.match&&e.jsxs("span",{className:"text-[10px] opacity-70 px-2 py-0.5 rounded bg-indigo-500/20 border border-indigo-600/30",children:[T.match.game," ",T.match.mode==="firstto"?"FT":"BO"," ",T.match.value,T.match.game==="X01"&&T.match.startingScore?` Â· ${T.match.startingScore}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T.status==="ingame"&&T.roomId&&e.jsx("button",{className:"btn",onClick:()=>_(T.roomId),children:"Spectate"}),e.jsx("button",{className:"btn",disabled:b||T.status!=="online"&&T.status!=="ingame",onClick:async()=>{y(!0);try{(await(await fetch("/api/friends/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:T.email,game:"X01",mode:"bestof",value:3,startingScore:501})})).json().catch(()=>({})))?.delivered?a("Invite sent",{type:"success"}):a("Friend is offline; invite queued",{type:"info"})}finally{y(!1)}},children:"Invite"}),e.jsx("button",{className:"btn",disabled:b,onClick:()=>R({show:!0,toUser:T.username||T.email,toEmail:T.email}),children:"Message"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:b,onClick:()=>F(T.email),children:"Remove"})]})]},T.email)),H.length===0&&e.jsxs("li",{className:"text-sm opacity-70",children:["No friends ",m!=="all"?`in ${m}`:""," yet."]})]})]}),e.jsxs("div",{className:"p-3 rounded-2xl bg-black/20 border border-white/10",children:[e.jsx("div",{className:"font-semibold mb-2 text-white/90",children:"Find Friends"}),e.jsx("input",{className:"input w-full mb-2",placeholder:"Search by name or email",value:c,onChange:T=>v(T.target.value)}),e.jsxs("ul",{className:"space-y-1 mb-3 max-h-48 overflow-auto",children:[o.map(T=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${T.status==="online"?"bg-emerald-400":T.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{children:T.username||T.email})]}),e.jsx("button",{className:"btn",disabled:b,onClick:()=>p(T.email),children:"Add"})]},T.email)),o.length===0&&e.jsx("li",{className:"text-xs opacity-60",children:"Type to searchâ€¦"})]}),e.jsx("div",{className:"font-semibold mb-1 text-white/90",children:"Suggested"}),e.jsxs("ul",{className:"space-y-1 max-h-48 overflow-auto",children:[i.map(T=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${T.status==="online"?"bg-emerald-400":T.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{children:T.username||T.email})]}),e.jsx("button",{className:"btn",disabled:b,onClick:()=>p(T.email),children:"Add"})]},T.email)),i.length===0&&e.jsx("li",{className:"text-xs opacity-60",children:"No suggestions right now."})]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>N.markAllRead(),children:"Mark all read"})]}),N.inbox.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No messages yet."}):e.jsx("ul",{className:"space-y-2 max-h-72 overflow-auto",children:N.inbox.map(T=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:T.from})," ",e.jsxs("span",{className:"opacity-70 text-xs",children:["Â· ",new Date(T.ts).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:()=>R({show:!0,toUser:T.from,toEmail:T.from,replyTo:T.from}),children:"Reply"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-2 py-1 text-xs",title:"Delete this message",onClick:()=>N.remove(T.id),children:"Delete"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-2 py-1 text-xs",onClick:async()=>{const K=prompt("Report reason (what happened)?");if(K)try{await fetch("/api/friends/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reporterEmail:s,offenderEmail:T.from,reason:K,messageId:T.id})}),a("Report sent to admin",{type:"info"})}catch{}},children:"Report"})]})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap break-words",children:Ec(T.message)})]},T.id))})]}),M.show&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("div",{className:"text-center mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Type Message To ",M.toUser]})}),e.jsx("textarea",{className:"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none",placeholder:"Type your message here...",id:"message-input",autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{className:"flex-1 btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const K=document.getElementById("message-input")?.value?.trim();if(K){y(!0);try{await fetch("/api/friends/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:M.toEmail,message:K})}),a("Message sent",{type:"success"}),R({show:!1})}catch{a("Failed to send message",{type:"error"})}finally{y(!1)}}},disabled:b,children:"Send"}),e.jsx("button",{className:"flex-1 btn bg-slate-600 hover:bg-slate-700",onClick:()=>R({show:!1}),children:"Cancel"})]})]})})]})}function qm(){const t=Ei(s=>s.toasts),a=Ei(s=>s.remove);return t.length?e.jsxs(e.Fragment,{children:[t.filter(s=>s.type==="success").map(s=>e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50",children:e.jsx("div",{className:"p-4 rounded-lg shadow-lg border text-sm bg-emerald-700/90 border-emerald-500/60 text-white max-w-sm text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("span",{className:"flex-1 font-semibold",children:s.message})})})},s.id)),t.filter(s=>s.type!=="success").length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 sm:right-4 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 w-[calc(100%-1.5rem)] sm:w-auto max-w-sm",children:t.filter(s=>s.type!=="success").map(s=>e.jsx("div",{className:`p-3 rounded-lg shadow-lg border text-sm ${s.type==="error"?"bg-rose-700/80 border-rose-500/60 text-white":"bg-black/70 border-slate-700 text-slate-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>a(s.id),children:"Dismiss"})]})},s.id))})]}):null}function Dc({data:t,height:a=220,barWidth:s=28,gap:r=6,showValues:n=!1}){const i=Math.max(1,...t.map(o=>o.value)),l=t.length*(s+r);return e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"relative",style:{height:a,width:Math.max(600,l)},children:e.jsx("div",{className:"absolute inset-0 flex items-end",children:t.map((o,d)=>{const c=Math.round(o.value/i*(a-40));return e.jsxs("div",{className:"flex flex-col items-center justify-end",style:{width:s,marginRight:r},children:[e.jsx("div",{className:"w-full rounded-t-md bg-gradient-to-b from-indigo-400 to-fuchsia-500 shadow-sm",style:{height:c},title:`${o.label}: ${o.value}`}),n&&e.jsx("div",{className:"text-[10px] mt-1 text-indigo-200 font-semibold",children:o.value}),e.jsx("div",{className:"text-[10px] mt-1 text-slate-200 font-medium select-none",children:o.label})]},d)})})})})}const Ic=u.createContext(null);function zm({children:t}){const[a,s]=u.useState(!1),[r,n]=u.useState("connecting"),i=u.useRef(null),l=u.useRef(new Set),o=u.useRef(!0),d=u.useRef(0),c=u.useRef(null),h=u.useRef(null),m=u.useRef(null),x=u.useRef(0),b=()=>{if(m.current)return m.current;const R="ws://localhost:8787";if(R.length>0){const H=R.endsWith("/ws")?R:R.replace(/\/$/,"")+"/ws";return m.current=[H],m.current}const A=window.location.protocol==="https:"?"wss":"ws",v=window.location.hostname,F=[`${A}://${window.location.host}`+"/ws",`${A}://${v}/ws`,`${A}://${v}:8787/ws`,`${A}://${v}:3000/ws`];return m.current=Array.from(new Set(F)),m.current},y=()=>{const R=b();return x.current=(x.current+1)%R.length,R[x.current]},N=()=>{const R=b();return R[x.current]||R[0]},C=u.useCallback(()=>{if(i.current&&(i.current.readyState===WebSocket.OPEN||i.current.readyState===WebSocket.CONNECTING))return;n("connecting");const A=`${N()}`,v=new WebSocket(A);i.current=v,v.onopen=()=>{s(!0),n("connected"),d.current=0,h.current&&clearInterval(h.current),h.current=setInterval(()=>{try{i.current?.readyState===WebSocket.OPEN&&i.current?.send(JSON.stringify({type:"ping",t:Date.now()}))}catch{}},2e4)},v.onmessage=p=>{try{const F=JSON.parse(p.data);l.current.forEach(H=>{try{H(F)}catch{}})}catch{}},v.onerror=()=>{},v.onclose=()=>{if(s(!1),n("disconnected"),h.current&&(clearInterval(h.current),h.current=null),!o.current)return;const p=(d.current||0)+1;d.current=p,p%2===0&&y();const F=1e3*Math.pow(2,p-1),H=Math.floor(Math.random()*1e3);let _=Math.min(3e4,F+H);p===1&&(_=0),c.current&&clearTimeout(c.current),_===0?C():c.current=setTimeout(C,_)}},[]),w=u.useCallback(()=>{try{o.current=!1,c.current&&(clearTimeout(c.current),c.current=null),h.current&&(clearInterval(h.current),h.current=null);try{i.current?.close()}catch{}i.current=null}catch{}d.current=0,o.current=!0,n("connecting"),s(!1),C()},[C]);u.useEffect(()=>{o.current=!0,C();const R=()=>{o.current=!1;try{i.current?.close()}catch{}};window.addEventListener("beforeunload",R);const A=()=>{document.visibilityState==="visible"&&(a||C())};return document.addEventListener("visibilitychange",A),window.addEventListener("online",C),()=>{o.current=!1,c.current&&clearTimeout(c.current),h.current&&clearInterval(h.current);try{i.current?.close()}catch{}document.removeEventListener("visibilitychange",A),window.removeEventListener("online",C),window.removeEventListener("beforeunload",R)}},[C]);const D=u.useCallback(R=>{try{i.current&&i.current.readyState===WebSocket.OPEN&&i.current.send(typeof R=="string"?R:JSON.stringify(R))}catch{}},[]),I=u.useCallback(R=>(l.current.add(R),()=>{l.current.delete(R)}),[]),M=u.useMemo(()=>({connected:a,status:r,send:D,addListener:I,reconnect:w}),[a,r,D,I,w]);return e.jsx(Ic.Provider,{value:M,children:t})}function Sa(){const t=u.useContext(Ic);if(!t)throw new Error("useWS must be used within WSProvider");return t}function Mc({status:t,title:a,size:s=12}){const r=s;return t==="connecting"?e.jsx("span",{role:"img","aria-label":"Connecting",title:a||"Connectingâ€¦",className:"inline-flex items-center justify-center",style:{width:r,height:r},children:e.jsxs("svg",{width:r,height:r,viewBox:"0 0 24 24",className:"animate-spin","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#A7F3D0",strokeWidth:"3",fill:"none",opacity:"0.35"}),e.jsx("path",{d:"M22 12a10 10 0 0 0-10-10",stroke:"#34D399",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]})}):t==="connected"?e.jsx("span",{role:"img","aria-label":"Connected",title:a||"Connected",className:"inline-flex items-center justify-center",style:{width:r,height:r},children:e.jsx("svg",{width:r,height:r,viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#34D399"})})}):e.jsx("span",{role:"img","aria-label":"Disconnected",title:a||"Not connected",className:"inline-flex items-center justify-center",style:{width:r,height:r},children:e.jsxs("svg",{width:r,height:r,viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#F87171",opacity:"0.15"}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"#F87171",strokeWidth:"2",fill:"none"}),e.jsx("rect",{x:"6",y:"11",width:"12",height:"2",rx:"1",fill:"#F87171"})]})})}function Ac(){const t=Zn(),a=u.useRef(null),s=u.useRef(null),r=t.isStreaming&&t.mode==="phone",n=t.getVideoElementRef();u.useEffect(()=>{const l=a.current;if(!l)return;let o=!0;const d=l.getContext("2d");if(!d)return;const c=()=>{if(o){try{if(d.clearRect(0,0,l.width,l.height),r&&n&&n.readyState>=2){const h=n.videoWidth||640,m=n.videoHeight||360,x=l.width,b=l.height,y=h/m,N=x/b;let C=0,w=0,D=h,I=m;if(y>N){const M=m*N;C=(h-M)/2,D=M}else if(y<N){const M=h/N;w=(m-M)/2,I=M}d.drawImage(n,C,w,D,I,0,0,x,b)}else d.fillStyle="rgba(148, 163, 184, 0.25)",d.fillRect(0,0,l.width,l.height),d.fillStyle="rgba(226,232,240,0.8)",d.font="10px system-ui, sans-serif",d.textAlign="center",d.textBaseline="middle",d.fillText("Camera",l.width/2,l.height/2)}catch{}s.current=requestAnimationFrame(c)}};return s.current=requestAnimationFrame(c),()=>{o=!1,s.current&&cancelAnimationFrame(s.current)}},[r,n]);const i=()=>{try{window.dispatchEvent(new CustomEvent("ndn:toggle-phone-overlay"))}catch{}};return e.jsxs("button",{type:"button",onClick:i,className:"relative inline-flex items-center gap-1 rounded-lg border border-white/15 bg-white/5 hover:bg-white/10 transition-colors shadow-sm overflow-hidden",style:{height:36},title:r?"Camera connected â€“ click to toggle overlay":"Camera not connected",children:[e.jsx("canvas",{ref:a,width:64,height:36,className:"block"}),e.jsx("span",{className:"pr-2 text-xs text-slate-100 select-none hidden xs:inline",children:r?"Phone Cam":"No Camera"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-lg pointer-events-none drop-shadow","aria-hidden":"true",children:r?"âœ…":"âšª"})]})}const El={calibration:{keywords:["calibration","calibrate","camera","score","accuracy","aim","setup"],title:"How Calibration Works",explanation:`Calibration helps our AI precisely detect where your darts land on the board. Here's how it works:

1. **D20**: Click on the 20 segment to calibrate that area
2. **D6**: Click on the 6 segment to calibrate that area
3. **D3**: Click on the 3 segment to calibrate that area
4. **D11**: Click on the 11 segment to calibrate that area
5. **Bullseye**: Click on the bullseye to calibrate the center

Each click teaches the system about your board's position and angle. After calibrating all areas, your scoring will be much more accurate!`,actions:[{id:"D20",label:"ðŸ“ Click D20",color:"bg-blue-600"},{id:"D6",label:"ðŸ“ Click D6",color:"bg-purple-600"},{id:"D3",label:"ðŸ“ Click D3",color:"bg-pink-600"},{id:"D11",label:"ðŸ“ Click D11",color:"bg-cyan-600"},{id:"Bullseye",label:"ðŸŽ¯ Click Bullseye",color:"bg-yellow-600"}]},scoring:{keywords:["score","points","counting","how do i score","scoring system"],title:"Dart Scoring",explanation:`In darts, each segment on the board has a value:
- Single areas: Face value (1-20)
- Double ring (outer): 2Ã— the segment number
- Triple ring (inner): 3Ã— the segment number
- Bullseye: 50 points
- Bull (outer bull): 25 points

For example: hitting Triple 20 = 60 points, Double 10 = 20 points`},gameplay:{keywords:["game","how to play","rules","x01","cricket","match","round"],title:"How to Play",explanation:`Nine Dart Nation supports multiple game modes:

**X01** (501, 301, 701): Start from the set score and count down to exactly 0. Final dart must be on a double.

**Cricket**: Players try to "close" numbers 15-20 and bullseye by hitting them. First to close all and have the highest score wins.

**Killer**: Players mark their "number" and try to knock out other players' lives.

Select your game mode when creating a match, and follow the on-screen instructions!`},premium:{keywords:["premium","subscription","features","upgrade","cost","paid"],title:"Premium Features",explanation:`Our Premium subscription gives you:
- Tournament creation and entry
- Advanced statistics and replays
- Priority matchmaking
- Custom profiles and themes
- Ad-free experience

Premium grants are often awarded as tournament prizes!`},connection:{keywords:["connection","disconnect","lag","latency","websocket","error","offline"],title:"Connection Issues",explanation:`If you're experiencing connection issues:
1. Check your internet connection
2. Refresh the page (Ctrl+R or Cmd+R)
3. Clear browser cache
4. Try a different browser
5. Check if the site status page shows any issues

Most connection issues resolve in seconds. Contact admin if problems persist.`},camera:{keywords:["camera","phone camera","mobile","video","pairing","connect"],title:"Camera Setup",explanation:`To use our phone camera feature:
1. Open Nine Dart Nation on your phone
2. Go to Settings > Camera Pairing
3. Scan the QR code or enter the pairing code
4. Position your phone to capture the dartboard
5. Run calibration (see calibration help for details)

Your phone will now act as a live dartboard camera!`},tournament:{keywords:["tournament","compete","bracket","prize","winner","playoffs"],title:"Tournaments",explanation:`Tournaments are competitive events where you can:
- Play against other skilled players
- Win prizes (Premium subscriptions or cash)
- Climb leaderboards
- Compete in structured brackets

Check the Tournaments tab to see upcoming events. Registration typically opens 30 minutes before start time.`}};function Vm(t){const a=t.toLowerCase();for(const[s,r]of Object.entries(El))for(const n of r.keywords)if(a.includes(n))return{type:"explanation",title:r.title,message:r.explanation,actions:r.actions,followUp:"Do you need further assistance? I can connect you with an admin if needed."};return{type:"suggestion",title:"Need More Help?",message:`I couldn't find a specific answer to your question. Common topics I can help with:

${Object.values(El).map(s=>`â€¢ ${s.title}`).join(`
`)}

Or I can connect you with an admin who can help further.`,followUp:"Would you like to speak with an admin?"}}function Gm(){const t=new Date().getHours();return t>=20||t<7?"20-30 minutes (off-peak hours)":t>=12&&t<14?"10-15 minutes (moderate traffic)":t>=18&&t<20?"15-20 minutes (peak hours)":"5-10 minutes"}function Rc({request:t,user:a,onClose:s}){const r=(()=>{try{return Sa()}catch{return null}})(),[n,i]=u.useState(t?.messages||[]),[l,o]=u.useState(""),[d,c]=u.useState({}),[h,m]=u.useState(!1),[x,b]=u.useState(""),y=u.useRef(null),N=u.useRef(null);u.useEffect(()=>{if(!r)return;const I=r.addListener(M=>{try{if(M?.type==="help-message"&&String(M.requestId)===String(t.id)&&i(R=>[...R,M.message]),M?.type==="help-request-updated"&&M.request?.id===t.id&&(i(M.request.messages||[]),m(!!M.request.claimedBy)),M?.type==="help-typing"&&String(M.requestId)===String(t.id)){const R=M.fromName||M.fromEmail||(M.admin?"admin":"user");c(A=>({...A,[R]:Date.now()}))}}catch{}});return()=>{I()}},[r,t?.id]);const C=()=>{if(!l.trim())return;const I=l,M={type:"help-message",requestId:t.id,message:I};try{r?.send(M)}catch{}const R={fromEmail:a?.email||null,fromName:a?.username||null,message:I,ts:Date.now(),admin:!1};i(A=>[...A,R]),o(""),h||setTimeout(()=>{const A=Vm(I);if(A){const v={fromName:"AI Assistant",message:`${A.title}

${A.message}`,ts:Date.now(),admin:!0,actions:A.actions,followUp:A.followUp};i(p=>[...p,v])}},500)},w=I=>{if(!I){const R={fromName:"You",message:"No, I think I have it now. Thanks!",ts:Date.now(),admin:!1};i(A=>[...A,R]),setTimeout(()=>{const A={fromName:"AI Assistant",message:"âœ… Great! Glad I could help. Feel free to reach out anytime you need assistance.",ts:Date.now(),admin:!0};i(v=>[...v,A])},300);return}const M={fromName:"You",message:"Yes, I need to speak with an admin",ts:Date.now(),admin:!1};i(R=>[...R,M]);try{r?.send({type:"help-escalate",requestId:t.id})}catch{}b(Gm()),setTimeout(()=>{const R={fromName:"System",message:`â³ Connecting you with an admin...

ðŸ“Š Estimated wait time: ${x}

An admin will be with you shortly. Please stay on this chat.`,ts:Date.now(),admin:!0};i(A=>[...A,R])},500)};u.useEffect(()=>{if(y.current)try{y.current.scrollTop=y.current.scrollHeight}catch{}},[n]);const D=u.useCallback(()=>{try{r?.send({type:"help-typing",requestId:t.id,fromName:a?.username,fromEmail:a?.email,admin:!!a?.isAdmin})}catch{}N.current&&clearTimeout(N.current),N.current=window.setTimeout(()=>{c(I=>{const M={...I};return delete M[a?.username||a?.email||"me"],M})},3e3)},[r,t.id,a]);return u.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]),e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-2xl bg-slate-900 rounded-lg shadow-xl overflow-hidden flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-slate-700 bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(ki,{className:"w-4 h-4 text-yellow-400"}),"Help Desk â€” ",t.username||"Anonymous"]}),h&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-emerald-600",children:"Admin Connected"})]}),e.jsx("button",{className:"px-2 py-1 rounded bg-neutral-700 hover:bg-neutral-600 text-sm",onClick:s,children:e.jsx(Al,{className:"w-4 h-4"})})]}),e.jsxs("div",{ref:y,className:"flex-1 overflow-y-auto p-3 space-y-3 bg-black/20",children:[n.map((I,M)=>e.jsx("div",{children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded ${I.admin?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-100 ml-auto":"bg-slate-700 text-slate-100"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs opacity-70 font-semibold flex items-center gap-1",children:[I.admin?e.jsx(ki,{className:"w-3 h-3"}):e.jsx(nr,{className:"w-3 h-3"}),I.fromName||I.fromEmail||(I.admin?"AI Assistant":"You")]}),e.jsx("div",{className:"text-xs opacity-50 ml-2",children:I.ts?new Date(I.ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("div",{className:"whitespace-pre-wrap break-words text-sm",children:I.message}),I.actions&&I.actions.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold opacity-80",children:"ðŸŽ¯ Try these calibration points:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:I.actions.map(R=>e.jsx("button",{className:`${R.color} text-white text-xs py-2 px-2 rounded font-medium hover:opacity-90 transition-opacity`,onClick:()=>{const A={fromName:"You",message:`Clicked: ${R.label}`,ts:Date.now(),admin:!1};i(v=>[...v,A]);try{r?.send({type:"help-message",requestId:t.id,message:`User clicked: ${R.id}`})}catch{}},children:R.label},R.id))})]}),I.followUp&&!h&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs opacity-80",children:I.followUp}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white text-xs py-2 px-3 rounded font-medium transition-colors",onClick:()=>w(!0),children:"âœ… Yes, connect me"}),e.jsx("button",{className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white text-xs py-2 px-3 rounded font-medium transition-colors",onClick:()=>w(!1),children:"âŒ No thanks"})]})]})]})},M)),Object.keys(d).length>0&&e.jsxs("div",{className:"text-xs text-slate-300 opacity-80 flex items-center gap-2",children:[e.jsxs("span",{children:[Object.keys(d).join(", ")," typing"]}),e.jsxs("span",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce"}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce delay-100"}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce delay-200"})]})]})]}),e.jsxs("div",{className:"p-3 border-t border-slate-700 bg-slate-800 flex gap-2",children:[e.jsx("input",{className:"input flex-1 text-sm",value:l,onChange:I=>{o(I.target.value),D()},onKeyDown:I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),C())},placeholder:"Ask a question (e.g., 'How does calibration work?')..."}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white",onClick:C,children:e.jsx(Gi,{className:"w-4 h-4"})})]})]})]})}const Jm="daviesfamily108@gmail.com";function Km({user:t}){const a=(()=>{try{return Sa()}catch{return null}})(),[s,r]=u.useState([]),[n,i]=u.useState(""),[l,o]=u.useState(null),[d,c]=u.useState(""),[h,m]=u.useState(!1),[x,b]=u.useState([]),[y,N]=u.useState([]),[C,w]=u.useState(""),[D,I]=u.useState([]),[M,R]=u.useState({title:"Official Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:30,capacity:16,prizeType:"premium",prizeAmount:3,currency:"GBP",prizeNotes:""}),[A,v]=u.useState({reset:{},reminder:{},confirmEmail:{},changed:{}}),[p,F]=u.useState({open:!1}),[H,_]=u.useState("general"),z=t?.email?.toLowerCase()===Jm,[T,K]=u.useState([]),[ee,ie]=u.useState([]),[ke,Be]=u.useState([]),[Ue,Oe]=u.useState({}),[je,Re]=u.useState(null),[$,te]=u.useState([]),[ce,ze]=u.useState(null),[Pe,Te]=u.useState(!1),[Ee,ht]=u.useState(1500),[Ce,me]=u.useState(0);u.useEffect(()=>{const E=()=>me(ae=>ae+1);return window.addEventListener("ndn:stats-updated",E),()=>window.removeEventListener("ndn:stats-updated",E)},[]);const Le=u.useMemo(()=>Ji(ja),[Ce]),pt=wa();u.useEffect(()=>{if(!p.open)return;function E(ae){ae.key==="Escape"&&F({open:!1})}return document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)},[p.open]);const It=u.useMemo(()=>{const E=pt.errorPx??null,ae=[];for(const xe of ja){const $e=hr(xe,E),Qe=ic(xe,E);ae.push({game:xe,confidence:$e,qualityInfo:Qe})}return ae},[pt.errorPx]),is=u.useMemo(()=>{const E=[];if(Le&&typeof Le=="object")for(const[ae,xe]of Object.entries(Le)){const $e=xe;E.push({label:ae,value:$e?.played||0,won:$e?.won||0})}return E},[Le]);async function Ke(){try{const E={Authorization:`Bearer ${localStorage.getItem("authToken")}`},[ae,xe,$e]=await Promise.all([fetch("/api/admin/help-requests",{headers:E}),fetch("/api/admins",{headers:E}),fetch("/api/tournaments",{headers:E})]);if(ae.ok){const Qe=await ae.json();Be(Array.isArray(Qe)?Qe:Qe.requests||[])}if(xe.ok){const Qe=await xe.json();r(Array.isArray(Qe)?Qe:Qe.admins||[])}if($e.ok){const Qe=await $e.json();b(Array.isArray(Qe)?Qe:Qe.tournaments||Qe)}}catch(E){console.error("refresh failed",E)}}async function De(E){try{await fetch("/api/admins/revoke",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:E})}),await Ke()}catch{}}async function Pt(E,ae){if(E)try{await fetch("/api/admin/premium/grant",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:E,days:ae})}),await Ke()}catch{}}async function le(E){try{await fetch("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:E})}),await Ke()}catch{}}async function fe(){if(d.trim())try{await fetch("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({message:d})}),c(""),await Ke()}catch{}}async function ne(E){try{await fetch("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({maintenance:E})}),await Ke()}catch{}}u.useEffect(()=>{if(!a)return;const E=a.addListener(xe=>{try{if(xe?.type==="help-typing"){const $e=String(xe.requestId||"");if(!$e)return;Oe(Qe=>({...Qe,[$e]:{who:xe.fromName||"someone",ts:Date.now()}}));return}if(xe?.type==="help-request"){const $e=xe.request;if(!$e||!$e.id)return;Be(Qe=>{const Mt=(Qe||[]).filter(Lt=>String(Lt.id)!==String($e.id));return[$e,...Mt]});return}xe?.type==="help-request-updated"&&Ke()}catch{}}),ae=setInterval(()=>{const xe=Date.now();let $e=!1;const Qe={...Ue};for(const Mt of Object.keys(Qe))xe-Qe[Mt].ts>3500&&(delete Qe[Mt],$e=!0);$e&&Oe(Qe)},1500);return()=>{try{E()}catch{}clearInterval(ae)}},[a]);async function Z(E){try{const ae={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`};(await fetch(`/api/admin/help-requests/${encodeURIComponent(E)}/claim`,{method:"POST",headers:ae,body:JSON.stringify({})})).ok&&await Ke()}catch{}}async function He(E){try{const ae={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`};(await fetch(`/api/admin/help-requests/${encodeURIComponent(E)}/resolve`,{method:"POST",headers:ae,body:JSON.stringify({})})).ok&&await Ke()}catch{}}async function ye(){n&&(await fetch("/api/admins/grant",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:n})}),i(""))}async function Ne(){if(C.trim())try{const E={Authorization:`Bearer ${localStorage.getItem("authToken")}`},ae=await fetch(`/api/admin/users/search?q=${encodeURIComponent(C)}`,{headers:E});if(ae.ok){const xe=await ae.json();I(Array.isArray(xe.users)?xe.users:[])}}catch(E){console.error("Search failed:",E)}}async function Xe(E){try{await fetch("/api/admin/users/ban",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:E})}),await Ne()}catch(ae){console.error("Ban failed:",ae)}}async function rt(E){try{await fetch("/api/admin/users/unban",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:E})}),await Ne()}catch(ae){console.error("Unban failed:",ae)}}async function ft(){m(!0);try{const E=new Date(M.startAt).getTime(),ae=await fetch("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:M.title,game:M.game,mode:M.mode,value:Number(M.value),description:M.description,startAt:E,checkinMinutes:Number(M.checkinMinutes),capacity:Number(M.capacity),requireCalibration:!!M.requireCalibration,creatorEmail:t?.email,creatorName:t?.username,requesterEmail:t?.email,official:!0,prizeType:M.prizeType,prizeAmount:Number(M.prizeAmount||0),currency:M.currency,prizeNotes:M.prizeNotes})});await Ke();try{const xe=await ae.json();xe&&xe.tournament&&xe.tournament.id&&window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:"tournaments"}}))}catch{}}finally{m(!1)}}async function Ve(E,ae){m(!0);try{await fetch("/api/admin/tournaments/winner",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({tournamentId:E,winnerEmail:ae})}),await Ke()}finally{m(!1)}}async function yt(E){m(!0);try{await fetch("/api/admin/tournaments/mark-paid",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({tournamentId:E})}),await Ke()}finally{m(!1)}}async function We(E){m(!0);try{await fetch("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({tournamentId:E})}),await Ke()}finally{m(!1)}}async function wt(){m(!0);try{await fetch("/api/admin/tournaments/reseed-weekly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({})}),await Ke()}finally{m(!1)}}async function kt(E,ae){m(!0);try{await fetch("/api/admin/wallet/withdrawals/decide",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({id:E,approve:ae})}),await Ke()}finally{m(!1)}}async function $t(E){m(!0);try{await fetch("/api/admin/matches/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({matchId:E})}),await Ke()}finally{m(!1)}}async function et(){try{const E={Authorization:`Bearer ${localStorage.getItem("authToken")}`},ae=await fetch("/api/admin/logs",{headers:E});if(ae.ok){const xe=await ae.json();xe?.ok&&te(xe.logs||[])}}catch(E){console.error("Failed to fetch logs:",E)}}async function zt(){try{const E={Authorization:`Bearer ${localStorage.getItem("authToken")}`},ae=await fetch("/api/admin/system-health",{headers:E});if(ae.ok){const xe=await ae.json();xe?.ok&&xe?.health&&(ze({database:xe.health.database||!1,websocket:xe.health.websocket||!1,https:xe.health.https||!1,maintenance:xe.health.maintenance||!1,clustering:xe.health.clustering||!1,uptime:xe.health.uptime||0,memory:xe.health.memory||{heapUsed:0},version:xe.health.version||"unknown"}),Te(xe.health?.clustering||!1))}}catch(E){console.error("Failed to fetch system health:",E)}}async function os(E){m(!0);try{const xe=await(await fetch("/api/admin/clustering",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({enabled:E,maxWorkers:4,capacity:Ee})})).json();console.log("Clustering response:",xe),xe?.ok?(alert(`Clustering ${E?"enabled":"disabled"} successfully. Max capacity: ${Ee.toLocaleString()} concurrent users. NODE_WORKERS environment variable is set to max capacity.`),await zt()):alert(`Failed: ${xe?.error||xe?.message||"Unknown error"}`)}catch(ae){console.error("Clustering toggle failed:",ae),alert("Clustering toggle failed: "+(ae instanceof Error?ae.message:String(ae)))}finally{m(!1)}}async function ls(E){ht(E)}async function es(){try{const E={Authorization:`Bearer ${localStorage.getItem("authToken")}`},ae=await fetch("/api/admin/email-copy",{headers:E});if(ae.ok){const xe=await ae.json();xe?.ok&&v(xe.copy||A)}}catch{}}u.useEffect(()=>{z&&es()},[z]),u.useEffect(()=>{z&&(H==="general"||H==="maintenance")&&(et(),zt())},[z,H]);async function Rt(E,ae){await fetch("/api/admin/email-copy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({kind:E,...ae})}),await es()}async function Yt(E,ae){try{const xe={Authorization:`Bearer ${localStorage.getItem("authToken")}`},Qe=await(await fetch(`/api/email/preview?kind=${encodeURIComponent(E)}`,{headers:xe})).text();if(ae){const Mt=window.open();if(Mt){Mt.document.open(),Mt.document.write(Qe),Mt.document.close();return}}F({open:!0,kind:E,html:Qe})}catch{F({open:!0,kind:E,html:'<!doctype html><html><body style="font-family:sans-serif;padding:16px">Failed to load preview.</body></html>'})}}u.useEffect(()=>{if(!p.open)return;function E(ae){ae.key==="Escape"&&F({open:!1})}return document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)},[p.open]);function Ft({kind:E,label:ae}){const $e=A?.[E==="confirm-email"?"confirmEmail":E==="changed"?"changed":E]||{title:"",intro:"",buttonLabel:""},[Qe,Mt]=u.useState($e.title||""),[Lt,ts]=u.useState($e.intro||""),[ps,Tt]=u.useState($e.buttonLabel||"");return u.useEffect(()=>{Mt($e.title||""),ts($e.intro||""),Tt($e.buttonLabel||"")},[$e.title,$e.intro,$e.buttonLabel]),e.jsxs("div",{className:"p-2 rounded bg-black/20 space-y-2",children:[e.jsx("div",{className:"font-semibold",children:ae}),e.jsx("input",{className:"input w-full",placeholder:"Title (optional)",value:Qe,onChange:_t=>Mt(_t.target.value)}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Intro line (optional)",value:Lt,onChange:_t=>ts(_t.target.value)}),e.jsx("input",{className:"input w-full",placeholder:"Button label (optional)",value:ps,onChange:_t=>Tt(_t.target.value)}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"btn",type:"button",onClick:()=>Yt(E,!0),children:"Preview"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>Yt(E),children:"Popup"}),e.jsx("button",{className:"btn",onClick:()=>Rt(E,{title:Qe,intro:Lt,buttonLabel:ps}),children:"Save"})]})]})}return z?(ke.length>0&&(ke.length,ke.slice(0,6).map(E=>e.jsxs("div",{className:"p-2 rounded bg-black/10 border border-white/10 min-w-[220px]",children:[e.jsx("div",{className:"font-medium",children:E.username||"Anonymous"}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(E.ts||0).toLocaleTimeString()}),e.jsx("div",{className:"text-sm truncate mt-1",children:E.message}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[E.status==="open"?e.jsx("button",{className:"btn",onClick:()=>Z(E.id),children:"Claim"}):e.jsxs("span",{className:"text-xs opacity-70",children:[E.status," by ",E.claimedBy||"â€”"]}),e.jsx("button",{className:"btn",onClick:()=>Re(E),children:"Chat"})]})]},E.id))),e.jsxs("div",{className:"space-y-4 ndn-game-shell",children:[e.jsxs("div",{className:"p-2 rounded-xl bg-white/10 border border-white/10 flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Connection Status"}),a?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Mc,{status:a.status,title:`WebSocket: ${a.status}`}),e.jsxs("span",{className:"text-xs opacity-80",children:["WS: ",a.status]})]}):e.jsx("span",{className:"text-xs opacity-70",children:"WS: unavailable"})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[e.jsx(Ac,{}),a&&a.reconnect&&e.jsx("button",{onClick:()=>a.reconnect(),className:"ml-1 rounded-md bg-neutral-700/60 hover:bg-neutral-600/70 px-2.5 py-1 text-xs border border-white/10",title:"Force close and recreate the WebSocket connection",children:"Recreate WS"})]})]}),z&&e.jsx(xr,{tabs:[{key:"general",label:"General"},{key:"maintenance",label:"Maintenance"},{key:"premium",label:"Premium"},{key:"tourneys",label:"Tourneys"},{key:"helpdesk",label:"Help Desk"}],active:H,onChange:E=>_(E),className:"mb-4"}),"			",H==="general"&&e.jsxs(e.Fragment,{children:[z&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Game Usage"}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(Dc,{data:is.map(E=>({label:"",value:E.value}))}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:is.map((E,ae)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:E.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",E.value," Â· Won ",E.won]})]},ae))})]})]}),z&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Calibration Quality Status"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Camera calibration confidence by game mode. Shows current system calibration readiness for each game."}),e.jsx("div",{className:"rounded-xl border border-amber-500/40 bg-amber-500/5 p-3",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px]",children:It.map(E=>{const ae=E.confidence>=85?"bg-emerald-500/20 border-emerald-500/40 text-emerald-200":E.confidence>=70?"bg-amber-500/20 border-amber-500/40 text-amber-200":"bg-rose-500/20 border-rose-500/40 text-rose-200";return e.jsxs("div",{className:`px-2 py-2 rounded-md border ${ae}`,children:[e.jsx("div",{className:"font-semibold text-xs truncate",children:E.game}),e.jsx("div",{className:"text-[10px] opacity-80 truncate",children:E.qualityInfo.quality}),e.jsxs("div",{className:"text-[10px] font-mono mt-0.5",children:[Math.round(E.confidence),"%"]})]},E.game)})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Admin to trusted users. Only the owner can perform these actions."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:n,onChange:E=>i(E.target.value)}),e.jsx("button",{className:"btn",disabled:h,onClick:ye,children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:h,onClick:()=>De(n),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Current Admins:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.map(E=>e.jsx("div",{className:"px-2 py-1 rounded bg-indigo-600/20 border border-indigo-500/40 text-sm",children:E},E))}),e.jsx("hr",{className:"border-indigo-500/20 my-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Premium Access Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Premium subscription access to users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:n,onChange:E=>i(E.target.value)}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:h||!n.trim(),onClick:()=>Pt(n,30),children:"Grant Premium"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:h,onClick:()=>le(n),children:"Revoke Premium"})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Premium grants provide 30 days of unlimited access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Announcements"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Send a message to all users. This will appear as a toast notification."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Announcement message...",value:d,onChange:E=>c(E.target.value)}),e.jsx("button",{className:"btn",disabled:h||!d.trim(),onClick:fe,children:"Send"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Search"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Search for users by email or name."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"Search users...",value:C,onChange:E=>w(E.target.value)}),e.jsx("button",{className:"btn",disabled:h,onClick:Ne,children:"Search"})]}),D.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),D.map(E=>e.jsx("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:E.name||"No name"}),e.jsx("div",{className:"opacity-70",children:E.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(E.createdAt).toLocaleDateString()]})]})},E.email))]})]}),z&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Email Templates"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Customize titles, intro lines, and button text. Previews open in a new tab or as a popup."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(Ft,{kind:"reset",label:"Password reset"}),e.jsx(Ft,{kind:"reminder",label:"Password reset reminder"}),e.jsx(Ft,{kind:"confirm-email",label:"Confirm new email"}),e.jsx(Ft,{kind:"changed",label:"Password changed notice"})]})]})]}),H==="maintenance"&&z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Management"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Ban or unban users. Use with caution."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:C,onChange:E=>w(E.target.value)}),e.jsx("button",{className:"btn",disabled:h,onClick:Ne,children:"Search"})]}),D.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),D.map(E=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:E.name||"No name"}),e.jsx("div",{className:"opacity-70",children:E.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(E.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",onClick:()=>Xe(E.email),children:"Ban"}),e.jsx("button",{className:"btn bg-green-600 hover:bg-green-700 text-xs",onClick:()=>rt(E.email),children:"Unban"})]})]},E.email))]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Withdrawals"}),e.jsxs("ul",{className:"space-y-2",children:[y.map(E=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:E.id}),e.jsxs("div",{children:[E.email," Â· ",E.currency," ",(E.amountCents/100).toFixed(2)]}),e.jsxs("div",{className:"opacity-70",children:[E.status," Â· ",new Date(E.requestedAt).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2",children:E.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:h,onClick:()=>kt(E.id,!0),children:"Approve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:h,onClick:()=>kt(E.id,!1),children:"Reject"})]})})]},E.id)),y.length===0&&e.jsx("li",{className:"opacity-60",children:"No withdrawal requests."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),ce?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.database?"bg-emerald-600":"bg-red-600"}`,children:ce.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.websocket?"bg-emerald-600":"bg-red-600"}`,children:ce.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.https?"bg-emerald-600":"bg-amber-600"}`,children:ce.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.maintenance?"bg-red-600":"bg-emerald-600"}`,children:ce.maintenance?"Active":"Normal"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Clustering (Auto-Scaling)"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${Pe?"bg-emerald-600":"bg-amber-600"}`,children:Pe?"Enabled":"Disabled"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(ce.uptime/3600),"h ",Math.floor(ce.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",ce.memory?Math.round(ce.memory.heapUsed/1024/1024):"?","MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",ce.version]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{className:"btn",onClick:zt,children:"Refresh"}),e.jsxs("button",{className:`btn ${Pe?"bg-amber-600 hover:bg-amber-700":"bg-emerald-600 hover:bg-emerald-700"}`,disabled:h,onClick:()=>os(!Pe),children:[Pe?"Disable":"Enable"," Clustering"]})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:zt,children:"Load Health Status"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Clustering Capacity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"font-semibold",children:"Max Concurrent Users"}),e.jsx("span",{className:"text-sm bg-blue-600 px-2 py-1 rounded",children:Ee.toLocaleString()})]}),e.jsx("input",{type:"range",min:"1500",max:"50000",step:"500",value:Ee,onChange:E=>ls(Number(E.target.value)),disabled:h,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",style:{background:Pe?`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(Ee-1500)/48500*100}%, #374151 ${(Ee-1500)/48500*100}%, #374151 100%)`:"#374151"}}),e.jsxs("div",{className:"flex justify-between text-xs opacity-60 mt-1",children:[e.jsx("span",{children:"1.5k"}),e.jsx("span",{children:"50k"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("button",{className:`btn ${Pe?"bg-amber-600 hover:bg-amber-700":"bg-emerald-600 hover:bg-emerald-700"}`,disabled:h,onClick:()=>os(!Pe),children:[Pe?"Disable":"Enable"," Clustering"]})})]}),e.jsxs("div",{className:"text-xs opacity-70 mt-2 p-2 bg-white/5 rounded",children:["ðŸ’¡ Clustering enables auto-scaling with capacity up to ",Ee.toLocaleString()," concurrent users. Adjust the slider to set maximum capacity. NODE_WORKERS environment variable is set to handle the configured load behind a reverse proxy."]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"User Reports"}),e.jsxs("ul",{className:"space-y-2",children:[ee.map(E=>e.jsx("li",{className:"p-2 rounded bg-black/20 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:E.id}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:E.reporter})," â†’ ",e.jsx("span",{className:"font-semibold",children:E.offender})," Â· ",new Date(E.ts).toLocaleString()]}),e.jsxs("div",{className:"opacity-80",children:["Reason: ",E.reason]}),E.messageId&&e.jsxs("div",{className:"opacity-60 text-xs",children:["Message ID: ",E.messageId]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${E.status==="open"?"bg-amber-600":"bg-emerald-600"}`,children:E.status}),E.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:h,onClick:async()=>{await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({id:E.id,action:"resolved"})}),await Ke()},children:"Resolve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:h,onClick:async()=>{const ae=prompt("Enter notes for action taken (e.g., warning, block):")||"";await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({id:E.id,action:"actioned",notes:ae})}),await Ke()},children:"Action"})]})]})]})},E.id)),ee.length===0&&e.jsx("li",{className:"opacity-60",children:"No reports."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),ce?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.database?"bg-emerald-600":"bg-red-600"}`,children:ce.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.websocket?"bg-emerald-600":"bg-red-600"}`,children:ce.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.https?"bg-emerald-600":"bg-amber-600"}`,children:ce.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.maintenance?"bg-red-600":"bg-emerald-600"}`,children:ce.maintenance?"Active":"Normal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(ce.uptime/3600),"h ",Math.floor(ce.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",Math.round(ce.memory.heapUsed/1024/1024),"MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",ce.version]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:zt,children:"Refresh"})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:zt,children:"Load Health Status"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Open Matches"}),e.jsxs("ul",{className:"space-y-1",children:[(l?.matches||[]).map(E=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs",children:E.id}),e.jsx("span",{className:"opacity-80",children:E.creatorName}),e.jsxs("span",{className:"opacity-60",children:[E.game," ",E.mode==="firstto"?"FT":"BO"," ",E.value," ",E.game==="X01"?`/${E.startingScore}`:""]})]}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:h,onClick:()=>$t(E.id),children:"Remove"})]},E.id)),(!l?.matches||l.matches.length===0)&&e.jsx("li",{className:"text-sm opacity-60",children:"No open matches."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Dangerous Operations"}),e.jsx("div",{className:"text-sm opacity-80 mb-3 text-red-400",children:"âš ï¸ These operations can cause data loss or service disruption. Use with extreme caution."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"Tournament Deletion"}),e.jsxs("ul",{className:"space-y-2",children:[x.map(E=>e.jsxs("li",{className:"p-2 rounded bg-red-900/20 border border-red-500/40 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:E.title}),e.jsx("div",{className:"opacity-70",children:E.status})]}),e.jsxs("div",{className:"opacity-80",children:[E.game," Â· ",E.mode==="firstto"?"FT":"BO"," ",E.value]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",disabled:h,onClick:()=>We(E.id),children:"Delete Tournament"})})]},E.id)),x.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"System Maintenance"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"p-3 rounded bg-red-900/20 border border-red-500/40",children:[e.jsx("div",{className:"font-semibold text-red-400 mb-2",children:"Maintenance Mode"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Put the entire site into maintenance mode. Users won't be able to access games or create matches."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${l?.maintenance?"bg-red-600":"bg-green-600"}`,children:l?.maintenance?"MAINTENANCE ACTIVE":"NORMAL OPERATION"}),e.jsx("button",{className:`btn ${l?.maintenance?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:h,onClick:()=>ne(!l?.maintenance),children:l?.maintenance?"Disable":"Enable"})]})]})})]})]})]}),je&&e.jsx(Rc,{request:je,user:{email:t?.email,username:t?.username,isAdmin:!0},onClose:()=>Re(null)})]}),H==="premium"&&z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Subscription Grants"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke premium subscriptions for users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:n,onChange:E=>i(E.target.value)}),e.jsx("button",{className:"btn",disabled:h||!n.trim(),onClick:()=>Pt(n,30),children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:h,onClick:()=>le(n),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Premium users get 30 days of access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Users who have won premium through tournaments."}),e.jsxs("div",{className:"space-y-2",children:[T.map(E=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:E.name||"No name"}),e.jsx("div",{className:"opacity-70",children:E.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Expires ",new Date(E.expiresAt).toLocaleDateString()]})]}),e.jsx("div",{className:"flex gap-2",children:E.expired?e.jsx("span",{className:"px-2 py-1 rounded bg-amber-600 text-xs",children:"Premium Expired"}):e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Premium Active"})})]},E.email)),T.length===0&&e.jsx("div",{className:"opacity-60",children:"No premium winners."})]})]})]}),H==="tourneys"&&z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Create Official Tournament"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Set up a new official tournament with custom rules, timing, and prizes."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"input w-full",placeholder:"Tournament Title",value:M.title,onChange:E=>R(ae=>({...ae,title:E.target.value}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("select",{className:"input",value:M.game,onChange:E=>R(ae=>({...ae,game:E.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low"].map(E=>e.jsx("option",{value:E,children:E},E))}),e.jsxs("select",{className:"input",value:M.mode,onChange:E=>R(ae=>({...ae,mode:E.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]}),e.jsx("input",{className:"input",type:"number",min:1,value:M.value,onChange:E=>R(ae=>({...ae,value:Number(E.target.value)}))})]}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Description",value:M.description,onChange:E=>R(ae=>({...ae,description:E.target.value}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"input",type:"datetime-local",value:M.startAt,onChange:E=>R(ae=>({...ae,startAt:E.target.value}))}),e.jsx("input",{className:"input",type:"number",min:0,placeholder:"Checkin minutes",value:M.checkinMinutes,onChange:E=>R(ae=>({...ae,checkinMinutes:Number(E.target.value)}))})]}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,placeholder:"Capacity",value:M.capacity,onChange:E=>R(ae=>({...ae,capacity:Number(E.target.value)}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[e.jsxs("select",{className:"input",value:M.prizeType,onChange:E=>{const ae=E.target.value;R(xe=>({...xe,prizeType:ae,prizeAmount:ae==="premium"?3:0}))},children:[e.jsx("option",{value:"premium",children:"PREMIUM"}),e.jsx("option",{value:"cash",children:"Cash"})]}),M.prizeType==="premium"?e.jsxs("select",{className:"input",value:M.prizeAmount,onChange:E=>R(ae=>({...ae,prizeAmount:Number(E.target.value)})),children:[e.jsx("option",{value:1,children:"1 month"}),e.jsx("option",{value:3,children:"3 months"})]}):e.jsx("input",{className:"input",type:"number",min:0,value:M.prizeAmount,onChange:E=>R(ae=>({...ae,prizeAmount:Number(E.target.value)}))}),e.jsxs("select",{className:"input",disabled:M.prizeType!=="cash",value:M.currency,onChange:E=>R(ae=>({...ae,currency:E.target.value})),children:[e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"CAD",children:"CAD"}),e.jsx("option",{value:"AUD",children:"AUD"})]})]}),e.jsx("input",{className:"input w-full",placeholder:"Prize notes (optional)",value:M.prizeNotes,onChange:E=>R(ae=>({...ae,prizeNotes:E.target.value}))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:h,onClick:ft,children:"Create Tournament"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Tournament Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Users who have won premium prizes in tournaments. Grant them access here."}),e.jsxs("div",{className:"space-y-2",children:[x.filter(E=>E.status==="completed"&&E.winnerEmail&&E.prizeType==="premium").map(E=>{const ae=T.find($e=>$e.email===E.winnerEmail),xe=ae&&!ae.expired;return e.jsxs("div",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:E.title}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(E.startAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:E.winnerEmail}),e.jsxs("div",{className:"text-xs opacity-70",children:["Prize: ",E.prizeAmount," month",E.prizeAmount>1?"s":""," PREMIUM"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:xe?e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"âœ“ Access Granted"}):e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-xs",disabled:h,onClick:()=>Pt(E.winnerEmail,E.prizeAmount*30),children:"Grant Access"})})]})]},E.id)}),x.filter(E=>E.status==="completed"&&E.winnerEmail&&E.prizeType==="premium").length===0&&e.jsx("div",{className:"text-center py-4 text-sm opacity-60",children:"No completed premium tournaments."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Manage Tournaments"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"View and manage all tournaments. Set winners or mark payouts."}),e.jsxs("ul",{className:"space-y-2",children:[x.map(E=>e.jsxs("li",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:E.title}),e.jsxs("div",{className:"opacity-80",children:[E.game," Â· ",E.mode==="firstto"?"First to":"Best of"," ",E.value]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-semibold ${E.status==="scheduled"?"bg-blue-600":E.status==="running"?"bg-green-600":E.status==="completed"?"bg-purple-600":"bg-gray-600"}`,children:E.status})]}),e.jsxs("div",{className:"text-xs opacity-70 mb-2",children:["Start: ",new Date(E.startAt).toLocaleString()," Â· Capacity: ",E.capacity]}),E.prize&&e.jsxs("div",{className:"text-xs mb-2",children:["Prize: ",E.prizeType==="cash"&&E.prizeAmount?`${E.currency||"USD"} ${E.prizeAmount}`:`${E.prizeAmount||3} month${(E.prizeAmount||3)>1?"s":""} PREMIUM`,E.prizeType==="cash"&&E.status==="completed"&&E.payoutStatus&&e.jsx("span",{className:`ml-2 px-1.5 py-0.5 rounded ${E.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:E.payoutStatus})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn text-xs",disabled:h||E.status!=="scheduled",onClick:()=>Ve(E.id,prompt("Winner email?")||""),children:"Set Winner"}),E.prizeType==="cash"&&E.status==="completed"&&E.payoutStatus!=="paid"&&e.jsx("button",{className:"btn text-xs",disabled:h,onClick:()=>yt(E.id),children:"Mark Paid"}),e.jsx("button",{className:"btn text-xs",disabled:h,onClick:()=>wt(),children:"Reseed"})]})]},E.id)),x.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]})]}),H==="helpdesk"&&z&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Helpdesk Requests"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Incoming requests from users who asked to speak with an admin. Claim to take over the chat."}),ke.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No open requests."}):e.jsx("div",{className:"space-y-2",children:ke.map(E=>e.jsxs("div",{className:"p-2 rounded bg-black/10 border border-white/10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:E.username||"Anonymous"}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(E.ts||0).toLocaleString()}),e.jsx("div",{className:"text-sm mt-1",children:E.message}),Ue[E.id]&&e.jsxs("div",{className:"text-xs text-amber-300 mt-1",children:[Ue[E.id].who," typing..."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E.status==="open"?e.jsx("button",{className:"btn",onClick:()=>Z(E.id),children:"Claim"}):e.jsxs("span",{className:"text-xs opacity-70",children:[E.status," by ",E.claimedBy||"â€”"]}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>He(E.id),children:"Resolve"}),e.jsx("button",{className:"btn",onClick:()=>Re(E),children:"Chat"})]})]},E.id))})]})}),p.open&&e.jsxs("div",{className:"fixed inset-0 z-[1000]",onClick:()=>F({open:!1}),children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsx("div",{className:"absolute inset-0 p-4 md:p-8 overflow-auto flex items-start md:items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-3xl bg-[#0b1020] rounded-2xl border border-indigo-500/40 shadow-2xl",onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20",children:[e.jsxs("div",{className:"font-semibold",children:["Preview: ",p.kind]}),e.jsx("button",{className:"btn",onClick:()=>F({open:!1}),children:"Close"})]}),e.jsx("div",{className:"p-0 bg-black/30",children:e.jsx("iframe",{title:"Email Preview",style:{width:"100%",height:"70vh",border:"0",background:"transparent"},srcDoc:p.html||""})}),e.jsx("div",{className:"px-4 py-3 border-t border-indigo-500/20 text-xs opacity-70",children:"Click outside this panel or press Esc to close."})]})})]})]})):e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin"}),e.jsx("div",{className:"text-sm opacity-80",children:"You donâ€™t have permission to manage admins."})]})}function Ym({user:t}){const{favoriteDouble:a,callerEnabled:s,callerVoice:r,callerVolume:n,speakCheckoutOnly:i,avgMode:l,autoStartOffline:o,rememberLastOffline:d,reducedMotion:c,compactHeader:h,allowSpectate:m,cameraScale:x,cameraAspect:b,cameraFitMode:y,autoscoreProvider:N,autoscoreWsUrl:C,calibrationGuide:w,preferredCameraId:D,preferredCameraLabel:I,cameraEnabled:M,offlineLayout:R,textSize:A,boxSize:v,setFavoriteDouble:p,setCallerEnabled:F,setCallerVoice:H,setCallerVolume:_,setSpeakCheckoutOnly:z,setAvgMode:T,setAutoStartOffline:K,setRememberLastOffline:ee,setReducedMotion:ie,setCompactHeader:ke,setAllowSpectate:Be,setCameraScale:Ue,setCameraAspect:Oe,setCameraFitMode:je,setAutoscoreProvider:Re,setAutoscoreWsUrl:$,setCalibrationGuide:te,setPreferredCamera:ce,setCameraEnabled:ze,setOfflineLayout:Pe,setTextSize:Te,setBoxSize:Ee,dartTimerEnabled:ht,dartTimerSeconds:Ce,setDartTimerEnabled:me,setDartTimerSeconds:Le,x01DoubleIn:pt,setX01DoubleIn:It}=qt(),[is,Ke]=u.useState([{key:"first180",label:"First 180",unlocked:!1,icon:"ðŸŽ¯",desc:"Score 180 in a match."},{key:"hundredGames",label:"100 Games Played",unlocked:!1,icon:"ðŸ…",desc:"Play 100 games."},{key:"tournamentWin",label:"Tournament Winner",unlocked:!1,icon:"ðŸ¥‡",desc:"Win a tournament."},{key:"bestLeg",label:"Best Leg",unlocked:!1,icon:"âš¡",desc:"Finish a leg in 12 darts or less."},{key:"comeback",label:"Comeback",unlocked:!1,icon:"ðŸ”¥",desc:"Win after trailing by 3 legs."}]);u.useEffect(()=>{const V=t?.username||"";V&&Ke(we=>we.map(ot=>({...ot,unlocked:!!localStorage.getItem(`ndn:achieve:${ot.key}:${V}`)})))},[t?.username]);const[De,Pt]=u.useState(!1),[le,fe]=u.useState(""),[ne,Z]=u.useState(""),[He,ye]=u.useState(""),[Ne,Xe]=u.useState(""),[rt,ft]=u.useState(""),[Ve,yt]=u.useState(!0),[We,wt]=u.useState(null),[kt,$t]=u.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[et,zt]=u.useState("");u.useEffect(()=>{const V=t?.username||"";if(V)try{fe(localStorage.getItem(`ndn:bio:favPlayer:${V}`)||""),Z(localStorage.getItem(`ndn:bio:favTeam:${V}`)||""),ye(localStorage.getItem(`ndn:bio:favDarts:${V}`)||""),Xe(localStorage.getItem(`ndn:bio:bio:${V}`)||""),ft(localStorage.getItem(`ndn:bio:profilePhoto:${V}`)||""),yt(localStorage.getItem(`ndn:settings:allowAnalytics:${V}`)!=="false")}catch{}},[t?.username]),u.useEffect(()=>{t?.email&&Kt(`/api/subscription?email=${encodeURIComponent(t.email)}`).then(V=>V.json()).then(wt).catch(()=>{})},[t?.email]);const os=()=>{const V=t?.username||"";if(V)try{localStorage.setItem(`ndn:bio:favPlayer:${V}`,le),localStorage.setItem(`ndn:bio:favTeam:${V}`,ne),localStorage.setItem(`ndn:bio:favDarts:${V}`,He),localStorage.setItem(`ndn:bio:bio:${V}`,Ne),localStorage.setItem(`ndn:bio:profilePhoto:${V}`,rt);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:V,avatar:rt}}))}catch{}localStorage.setItem(`ndn:settings:allowAnalytics:${V}`,Ve.toString()),Pt(!1)}catch{}},ls=V=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:V}}))}catch(we){console.error("Navigation failed:",we)}},es=V=>{const we=V.toLowerCase();return we.includes("username")||we.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:we.includes("premium")||we.includes("upgrade")||we.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:we.includes("calibrat")||we.includes("camera")||we.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:we.includes("voice")||we.includes("caller")||we.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:we.includes("friend")||we.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:we.includes("stat")||we.includes("score")||we.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:we.includes("setting")||we.includes("customiz")||we.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:we.includes("tournament")||we.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:we.includes("help")||we.includes("support")||we.includes("faq")?{text:"You're already in the help section! Check the Support section above for more resources.",links:[{text:"Scroll to Support",tab:"settings"}]}:we.includes("how to play")||we.includes("game")||we.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},Rt=()=>{if(!et.trim())return;const V=et.toLowerCase();$t(ot=>[...ot,{text:et,isUser:!0}]),zt("");const we=es(V);setTimeout(()=>{$t(ot=>[...ot,{text:we,isUser:!1}])},500)},[Yt,Ft]=u.useState(""),[E,ae]=u.useState(!1),[xe,$e]=u.useState(""),[Qe,Mt]=u.useState([]);u.useEffect(()=>{const V=()=>{const we=speechSynthesis.getVoices();Mt(we.filter(ot=>ot.lang.startsWith("en")))};V(),speechSynthesis.onvoiceschanged=V},[]);const[Lt,ts]=u.useState(!1),[ps,Tt]=u.useState(null),_t=({label:V,icon:we,pill:ot,color:us})=>e.jsxs("button",{onClick:()=>Tt(ps===ot?null:ot),type:"button",className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] bg-gradient-to-r ${us} text-white flex items-center gap-2`,children:[e.jsx(we,{className:"w-4 h-4"})," ",V,e.jsx(cd,{className:`w-4 h-4 transition-transform ${ps===ot?"rotate-180":""}`})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx(_t,{label:"User Info",icon:nr,pill:"user",color:"from-indigo-500 to-fuchsia-500 shadow-indigo-500/30"})})}),ps==="user"&&e.jsx("div",{className:"p-6 rounded-2xl border border-white/10 bg-white/[0.02] animate-in fade-in duration-200 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-red-100",children:[e.jsx(nr,{className:"w-5 h-5"})," Account"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:logout")),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Logout"}),e.jsx("button",{onClick:()=>ts(!0),className:"px-4 py-2 bg-slate-700 hover:bg-slate-800 text-white rounded-lg font-medium transition-colors",children:"Highlights"})]}),e.jsxs("div",{className:"border-t border-red-500/20 pt-3",children:[e.jsxs("div",{className:"font-medium mb-2 text-red-100",children:["Change Username (",(()=>{const V=t?.usernameChangeCount||0;return V<2?`${2-V} free changes remaining`:"Â£2 per change"})(),")"]}),e.jsx("div",{className:"text-sm text-red-100 mb-2",children:"You can change your username up to 2 times for free. Additional changes cost Â£2 each."}),t?.usernameChangeCount>=2&&!Yt.trim()?e.jsx("div",{className:"text-amber-400 text-sm mb-2",children:"âš ï¸ Additional username changes cost Â£2"}):null,e.jsx("input",{className:"input w-full mb-2",type:"text",placeholder:"New username",value:Yt,onChange:V=>Ft(V.target.value),disabled:E}),xe&&e.jsx("div",{className:"text-red-400 text-sm mb-2",children:xe}),e.jsx("button",{onClick:async()=>{if($e(""),!Yt.trim()){$e("Username required");return}if(Yt.length<3||Yt.length>20){$e("Username must be 3-20 characters");return}(t?.usernameChangeCount||0)<2?(localStorage.setItem("pendingUsernameChange",Yt.trim()),window.location.href="/?username-change=free"):window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02"},disabled:E||!Yt.trim(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:E?"Processing...":(t?.usernameChangeCount||0)<2?"Change Username (FREE)":"Change Username (Â£2)"})]})]})]})}),We&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-green-100",children:[e.jsx(La,{className:"w-5 h-5"})," Premium"]}),e.jsxs("div",{className:"space-y-3 text-sm text-green-100",children:[e.jsxs("div",{children:["Status: ",e.jsx("span",{className:We?.status==="active"?"text-green-400":"text-yellow-400",children:We?.status==="active"?"âœ“ Active":"Not Active"})]}),We?.status==="active"&&We?.nextBillingDate&&e.jsxs("div",{children:["Next Billing: ",new Date(We.nextBillingDate).toLocaleDateString()]}),We?.source==="tournament"&&We?.status==="active"&&e.jsx("button",{onClick:()=>window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02",className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-medium transition-colors text-xs",children:"Cancel Subscription"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-cyan-100",children:[e.jsx(Ci,{className:"w-5 h-5"})," Profile Photo"]}),e.jsx("input",{type:"file",accept:"image/*",onChange:V=>{const we=V.target.files?.[0];if(we){const ot=new FileReader;ot.onload=()=>ft(ot.result),ot.readAsDataURL(we)}},className:"w-full text-xs text-slate-100"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-purple-100",children:[e.jsx(on,{className:"w-5 h-5"})," Online & Socials"]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowSpectate",checked:m,onChange:V=>Be(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowSpectate",className:"text-sm text-purple-100",children:"Allow spectators"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-orange-500/40 bg-orange-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-orange-100",children:[e.jsx(La,{className:"w-5 h-5"})," Data & Privacy"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowAnalytics",checked:Ve,onChange:V=>yt(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowAnalytics",className:"text-sm text-orange-100",children:"Allow analytics"})]}),e.jsx("button",{onClick:()=>{const V={achievements:is,bio:{favPlayer:le,favTeam:ne,favDarts:He,bio:Ne}},we=new Blob([JSON.stringify(V,null,2)],{type:"application/json"}),ot=URL.createObjectURL(we),us=document.createElement("a");us.href=ot,us.download=`my-data-${new Date().toISOString().split("T")[0]}.json`,us.click(),URL.revokeObjectURL(ot)},className:"btn bg-orange-600 hover:bg-orange-700 w-full",children:"Export My Data"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(La,{className:"w-5 h-5 text-red-400"})," Privacy & Copyright"]}),e.jsx("div",{className:"space-y-3 text-sm text-slate-300",children:e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-red-300 mb-2",children:"âš ï¸ Legal Notice"}),e.jsxs("p",{className:"mb-2 text-xs",children:[e.jsx("strong",{children:"Copyright:"})," All content is protected by copyright law."]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Privacy:"})," Your data is protected and unauthorized access is prohibited."]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-yellow-100",children:[e.jsx(La,{className:"w-5 h-5"})," Blocked Users"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-yellow-100",children:"Manage players you've blocked from contacting you."}),e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:open-blocklist")),className:"btn bg-yellow-600 hover:bg-yellow-700 w-full text-sm",children:"View Blocked Users"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-blue-100",children:[e.jsx(on,{className:"w-5 h-5"})," Contact & Support"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"ðŸ“§ Email Support"}),e.jsx("a",{href:"https://ninedartnation.com/help",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"â“ Help Center"}),e.jsx("a",{href:"https://ninedartnation.com/faq",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"ðŸ“‹ FAQ"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-red-100",children:[e.jsx(La,{className:"w-5 h-5"})," Delete Account"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3 text-xs text-red-200",children:[e.jsx("p",{className:"font-semibold mb-1",children:"âš ï¸ Warning"}),e.jsx("p",{children:"Deleting your account is permanent and cannot be undone. All your stats, achievements, and data will be erased."})]}),e.jsx("button",{onClick:()=>{window.confirm(`Are you absolutely sure you want to delete your account? This action cannot be undone.

All your stats, achievements, and data will be permanently erased.`)&&window.confirm("This is your final warning. Click OK to permanently delete your account.")&&window.dispatchEvent(new CustomEvent("ndn:delete-account"))},className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Permanently Delete Account"})]})]})})]})}),e.jsx("div",{className:"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx(_t,{label:"Calibration",icon:wi,pill:"calibration",color:"from-purple-500 to-pink-500 shadow-purple-500/30"})})}),ps==="calibration"&&e.jsx("div",{className:"p-6 rounded-2xl border border-white/10 bg-white/[0.02] animate-in fade-in duration-200 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(wi,{className:"w-5 h-5 text-blue-400"})," Camera & Vision"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled",checked:M,onChange:V=>ze(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraEnabled",className:"text-sm",children:"Enable camera"})]}),M&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"cameraScale",className:"block text-sm mb-2",children:["Scale: ",x?.toFixed(2)]}),e.jsx("input",{type:"range",id:"cameraScale",min:"0.5",max:"3",step:"0.1",value:x||1,onChange:V=>Ue(parseFloat(V.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cameraAspect",className:"block text-sm mb-2",children:"Aspect Ratio"}),e.jsxs("select",{id:"cameraAspect",value:b||"wide",onChange:V=>Oe(V.target.value),className:"input w-full",children:[e.jsx("option",{value:"wide",children:"Wide (16:9)"}),e.jsx("option",{value:"square",children:"Square (1:1)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cameraFitMode",className:"block text-sm mb-2",children:"Fit Mode"}),e.jsxs("select",{id:"cameraFitMode",value:y||"fit",onChange:V=>je(V.target.value),className:"input w-full",children:[e.jsx("option",{value:"fill",children:"Fill (crop)"}),e.jsx("option",{value:"fit",children:"Fit (letterbox)"})]})]}),e.jsx("button",{onClick:()=>{},className:"btn bg-indigo-600 hover:bg-indigo-700 w-full",children:"Calibration Guide"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"autoscoreProvider",className:"block text-sm mb-2",children:"Auto-score Provider"}),e.jsxs("select",{id:"autoscoreProvider",value:N||"manual",onChange:V=>Re(V.target.value),className:"input w-full",children:[e.jsx("option",{value:"manual",children:"Manual Scoring"}),e.jsx("option",{value:"built-in",children:"Built-in Vision"}),e.jsx("option",{value:"external-ws",children:"External (WebSocket)"})]})]}),N==="external-ws"&&e.jsx("input",{type:"text",placeholder:"WebSocket URL",value:C||"",onChange:V=>$(V.target.value),className:"input w-full text-xs"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(rd,{className:"w-5 h-5 text-purple-400"})," Audio & Voice"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"callerEnabled",checked:s,onChange:V=>F(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"callerEnabled",className:"text-sm",children:"Enable voice caller"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"callerVoice",className:"block text-sm mb-2",children:"Voice"}),e.jsxs("select",{id:"callerVoice",value:r||"",onChange:V=>H(V.target.value),className:"input w-full text-xs",children:[e.jsx("option",{value:"",children:"Default"}),Qe.map((V,we)=>e.jsx("option",{value:V.voiceURI,children:V.name},we))]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"callerVolume",className:"block text-sm mb-2",children:["Volume: ",Math.round((n||1)*100),"%"]}),e.jsx("input",{type:"range",id:"callerVolume",min:"0",max:"1",step:"0.1",value:n||1,onChange:V=>_(parseFloat(V.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"speakCheckoutOnly",checked:i,onChange:V=>z(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"speakCheckoutOnly",className:"text-sm",children:"Only speak checkout scores"})]}),e.jsx("button",{onClick:()=>{const V=new SpeechSynthesisUtterance("Test voice. One hundred and eighty!");V.voice=Qe.find(we=>we.voiceURI===r)||null,V.volume=n||1,speechSynthesis.cancel(),speechSynthesis.speak(V)},className:"btn bg-purple-600 hover:bg-purple-700 w-full",children:"Test Voice"})]})]})]})})]})}),e.jsx("div",{className:"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx(_t,{label:"Settings",icon:Vi,pill:"settings",color:"from-cyan-500 to-blue-500 shadow-cyan-500/30"})})}),ps==="settings"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(nr,{className:"w-5 h-5 text-brand-400"})," Profile Bio"]}),De?e.jsxs("button",{onClick:os,className:"flex items-center gap-2 px-3 py-1 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400 text-sm transition-colors",children:[e.jsx(od,{className:"w-4 h-4"})," Save"]}):e.jsxs("button",{onClick:()=>Pt(!0),className:"flex items-center gap-2 px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400 text-sm transition-colors",children:[e.jsx(id,{className:"w-4 h-4"})," Edit"]})]}),e.jsx("div",{className:"space-y-3",children:De?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Player"}),e.jsx("input",{type:"text",value:le,onChange:V=>fe(V.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Team"}),e.jsx("input",{type:"text",value:ne,onChange:V=>Z(V.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Darts"}),e.jsx("input",{type:"text",value:He,onChange:V=>ye(V.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Bio / Quote"}),e.jsx("textarea",{value:Ne,onChange:V=>Xe(V.target.value),rows:3,className:"input w-full"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Favorite Player: ",e.jsx("span",{className:"text-brand-300",children:le||"Not set"})]}),e.jsxs("div",{children:["Favorite Team: ",e.jsx("span",{className:"text-brand-300",children:ne||"Not set"})]}),e.jsxs("div",{children:["Favorite Darts: ",e.jsx("span",{className:"text-brand-300",children:He||"Not set"})]}),e.jsxs("div",{children:["Bio: ",e.jsx("span",{className:"text-brand-300",children:Ne||"No bio set"})]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ld,{className:"w-5 h-5 text-green-400"})," Game Preferences"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"dartTimerEnabled",checked:!!ht,onChange:V=>me(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"dartTimerEnabled",className:"text-sm",children:"Enable per-dart throw timer"})]}),ht&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Time per throw: ",Ce?Math.round(Ce):0,"s"]}),e.jsx("input",{type:"range",min:"3",max:"30",value:Ce||10,onChange:V=>Le(parseInt(V.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"When the timer reaches zero, the dart is recorded as a miss and advances to the next throw."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"favoriteDouble",className:"block text-sm mb-2",children:"Favorite Finish Double"}),e.jsxs("select",{id:"favoriteDouble",value:a,onChange:V=>p(V.target.value),className:"input w-full",children:[e.jsx("option",{value:"any",children:"Any Double"}),e.jsx("option",{value:"D20",children:"Double 20"}),e.jsx("option",{value:"D10",children:"Double 10"}),e.jsx("option",{value:"D5",children:"Double 5"}),e.jsx("option",{value:"D1",children:"Double 1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"avgMode",className:"block text-sm mb-2",children:"Average Display Mode"}),e.jsxs("select",{id:"avgMode",value:l,onChange:V=>T(V.target.value),className:"input w-full",children:[e.jsx("option",{value:"all-time",children:"All Time Average"}),e.jsx("option",{value:"24h",children:"24 Hour Average"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"x01DoubleIn",checked:!!pt,onChange:V=>It(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"x01DoubleIn",className:"text-sm",children:"Require Double-In for X01"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-pink-500/40 bg-pink-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ci,{className:"w-5 h-5 text-pink-400"})," UI & Accessibility"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"autoStartOffline",checked:o,onChange:V=>K(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoStartOffline",className:"text-sm",children:"Auto-start offline games"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"rememberLastOffline",checked:d,onChange:V=>ee(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"rememberLastOffline",className:"text-sm",children:"Remember last offline game settings"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"offlineLayout",className:"block text-sm mb-2",children:"Offline Layout"}),e.jsxs("select",{id:"offlineLayout",value:R||"classic",onChange:V=>Pe(V.target.value),className:"input w-full",children:[e.jsx("option",{value:"classic",children:"Classic Layout"}),e.jsx("option",{value:"modern",children:"Modern Layout"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"reducedMotion",checked:c,onChange:V=>ie(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"reducedMotion",className:"text-sm",children:"Reduce motion/animations"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"compactHeader",checked:h,onChange:V=>ke(V.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"compactHeader",className:"text-sm",children:"Compact header"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ti,{className:"w-5 h-5 text-blue-400"})," Support & Help"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm opacity-80",children:"Need help? Contact us via email:"}),e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"btn bg-blue-600 hover:bg-blue-700 w-full text-xs",children:"Email Support"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(on,{className:"w-5 h-5 text-cyan-400"})," Help Assistant"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:kt.map((V,we)=>e.jsx("div",{className:`${V.isUser?"text-right":""}`,children:e.jsx("div",{className:`inline-block max-w-xs px-3 py-2 rounded-lg text-sm ${V.isUser?"bg-indigo-600 text-white":"bg-white/10 text-slate-100"}`,children:typeof V.text=="string"?V.text:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:V.text.text}),V.text.links&&e.jsx("div",{className:"mt-2 space-y-1",children:V.text.links.map((ot,us)=>e.jsx("button",{onClick:()=>ls(ot.tab),className:"block w-full text-left text-xs px-2 py-1 bg-white/20 hover:bg-white/30 rounded transition",children:ot.text},us))})]})})},we))}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("input",{type:"text",value:et,onChange:V=>zt(V.target.value),onKeyPress:V=>V.key==="Enter"&&Rt(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:Rt,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(Gi,{className:"w-4 h-4"})})]})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ti,{className:"w-5 h-5 text-yellow-400"})," Achievements & Badges"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:is.map(V=>e.jsxs("div",{className:`p-3 rounded-lg border ${V.unlocked?"border-yellow-500/40 bg-yellow-500/10":"border-white/10 bg-white/5"}`,title:V.desc,children:[e.jsx("div",{className:"text-lg",children:V.icon}),e.jsx("div",{className:"text-xs font-semibold mt-1",children:V.label}),e.jsx("div",{className:"text-[10px] opacity-70",children:V.unlocked?"âœ“ Unlocked":"Locked"})]},V.key))})]})})]})}const Xm={};function Qm({onAuth:t}){const[a,s]=u.useState("signin"),[r,n]=u.useState(""),[i,l]=u.useState(""),[o,d]=u.useState(""),[c,h]=u.useState(""),[m,x]=u.useState(""),[b,y]=u.useState(!1),[N,C]=u.useState(!1),w="http://localhost:8787";async function D(A){if(A.preventDefault(),x(""),C(!0),!i||!o){x("Username and password required."),C(!1);return}try{const v=await fetch(`${w}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.includes("@")?{email:i,password:o}:{username:i,password:o})}),p=await v.json();v.ok&&p?.user&&p?.token?(localStorage.setItem("authToken",p.token),t(p.user)):x(p?.error||"Invalid username or password.")}catch{x("Network error.")}finally{C(!1)}}async function I(A){if(A.preventDefault(),x(""),C(!0),!r||!i||!o){x("Email, username, and password required."),C(!1);return}try{const v=await fetch(`${w}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,username:i,password:o})}),p=await v.json();v.ok&&p?.user&&p?.token?(localStorage.setItem("authToken",p.token),t(p.user)):x(p?.error||"Signup failed.")}catch{x("Network error.")}finally{C(!1)}}async function M(A){if(A.preventDefault(),x(""),C(!0),!r||!r.includes("@")){x("Enter your email address."),C(!1);return}try{const p=await(await fetch(`${w}/api/auth/send-reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})})).json();if(!p?.ok)throw new Error(p?.error||"Failed to send reset email");x("Password reset link sent to your email.")}catch(v){x(v?.message||"Failed to send reset email")}finally{C(!1)}}async function R(A){if(A.preventDefault(),x(""),C(!0),!r||!r.includes("@")){x("Enter your email address."),C(!1);return}try{const p=await(await fetch(`${w}/api/auth/send-username`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})})).json();if(!p?.ok)throw new Error(p?.error||"Failed to send username email");x("Your username has been emailed to you.")}catch(v){x(v?.message||"Failed to send username email")}finally{C(!1)}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsxs("div",{className:"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsxs("form",{className:"card w-full space-y-4",onSubmit:a==="signin"?D:a==="signup"?I:M,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:[e.jsx("h1",{className:"logo text-center",children:"NINE-DART-NATION ðŸŽ¯"}),e.jsx("span",{className:"badge",children:"Welcome"})]}),e.jsx("h2",{className:"text-2xl font-bold",children:a==="signin"?"Sign In":a==="signup"?"Create Account":"Reset Password"}),(a==="signup"||a==="reset")&&e.jsx("input",{className:"input w-full",type:"email",placeholder:"Email",value:r,onChange:A=>n(A.target.value),required:!0}),a!=="reset"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Username or Email",value:i,onChange:A=>l(A.target.value),required:!0}),a!=="reset"&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input w-full pr-10",type:b?"text":"password",placeholder:"Password",value:o,onChange:A=>d(A.target.value),autoComplete:"current-password",required:!0,onFocus:()=>y(!1),onBlur:()=>y(!1)}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white",tabIndex:-1,onMouseDown:A=>{A.preventDefault(),y(!0)},onMouseUp:A=>{A.preventDefault(),y(!1)},onMouseLeave:()=>y(!1),onTouchStart:A=>{A.preventDefault(),y(!0)},onTouchEnd:A=>{A.preventDefault(),y(!1)},"aria-label":"Toggle password visibility",children:b?e.jsx(dd,{className:"w-5 h-5"}):e.jsx(Ci,{className:"w-5 h-5"})})]}),a==="signup"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Password Reminder (optional)",value:c,onChange:A=>h(A.target.value)}),m&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:m}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:N,children:N?"Signing In...":a==="signin"?"Sign In":a==="signup"?"Sign Up":"Send Reset Link"}),a==="reset"&&e.jsx("button",{className:"btn w-full mt-2 bg-white/10 hover:bg-white/20",type:"button",onClick:R,disabled:N,children:"Email me my username"}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("button",{type:"button",className:"underline",onClick:()=>s(a==="signin"?"signup":"signin"),disabled:N,children:a==="signin"?"Need an account? Sign Up":"Already have an account? Sign In"}),e.jsx("button",{type:"button",className:"underline",onClick:()=>s("reset"),disabled:N,children:"Forgot password?"})]})]}),e.jsxs("aside",{className:"card w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Whatâ€™s inside"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(Ni,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Online & Friends"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Challenge friends, chat, and join leagues."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(ud,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Deep Stats"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Track 3-dart averages, best legs, and more."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(sr,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Game Modes"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Start with 3 free online games upon signup. After that, PREMIUM is required to play all games."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(md,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Premium Perks"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Polished UI, upcoming features, and early access."})]})]})]}),e.jsxs("a",{href:Xm?.VITE_DISCORD_INVITE_URL||"https://discord.gg/8GtbZ6RU",target:"_blank",rel:"noopener noreferrer",className:"btn mt-4 flex items-center justify-center gap-2",children:[e.jsx(on,{className:"w-5 h-5"})," Join BullseyeDartsLeague"]}),e.jsxs("a",{href:"https://discord.gg/NineDartNation",target:"_blank",rel:"noopener noreferrer",className:"btn mt-2 flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20",children:[e.jsx(on,{className:"w-5 h-5"})," Join NineDartNation"]})]})]})]})}const Zm=u.createContext({theme:"default",setTheme:t=>{}}),Dl="ndn_theme";function eh({children:t}){const[a,s]=u.useState("default");return u.useEffect(()=>{try{const r=localStorage.getItem(Dl);r&&s(r)}catch{}},[]),u.useEffect(()=>{try{localStorage.setItem(Dl,a)}catch{}},[a]),e.jsx(Zm.Provider,{value:{theme:a,setTheme:s},children:e.jsx("div",{className:`theme-${a}`,children:t})})}function th(t){let a=0,s=0,r=null,n=null,i=0;for(const d of t.legs||[]){a+=d.totalScoreStart-d.totalScoreRemaining;const c=(d.visits||[]).reduce((h,m)=>h+(m.darts||0)-(m.preOpenDarts||0),0);s+=c,d.finished&&((r===null||d.dartsThrown<r)&&(r=d.dartsThrown),(n===null||d.dartsThrown>n)&&(n=d.dartsThrown));for(const h of d.visits||[])(h?.score||0)===180&&(i+=1)}const l=s>0?a/s*3:0,o=l*3;return{points:a,darts:s,threeDA:l,nineDA:o,bestLeg:r,worstLeg:n,oneEighties:i}}function sh({open:t,onClose:a,title:s="Match Summary",players:r,centerScore:n,doublesStats:i,allowRematch:l,onRematch:o}){if(!t)return null;const d=r.map(c=>{const h=th(c),m=i?.[c.id]||{},x=Math.max(0,Number(m.dartsAtDouble||0)),b=Math.max(0,Number(m.doublesHit||0)),y=x>0?Math.round(b/x*100):null;return{id:c.id,name:c.name,legsWon:c.legsWon,...h,dartsAtDouble:x,doublesHit:b,doublePct:y}});return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[120]",children:e.jsxs(Xs,{storageKey:"ndn:modal:match-summary",className:"w-full relative",defaultWidth:860,defaultHeight:540,minWidth:640,minHeight:420,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:s}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:["Players: ",r.map(c=>c.name).join(" vs ")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[d[0]&&e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:d[0].name}),e.jsx("div",{className:"text-3xl font-extrabold",children:d[0].legsWon}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:d[0].threeDA.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:d[0].nineDA.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:d[0].dartsAtDouble??"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsx("div",{className:"font-semibold",children:d[0].doublePct!==null&&d[0].doublePct!==void 0?`${d[0].doublePct}%`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:d[0].bestLeg?`${d[0].bestLeg} darts`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:d[0].worstLeg?`${d[0].worstLeg} darts`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:d[0].oneEighties})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsx("div",{className:"text-4xl font-black",children:n||(r.length===2?`${d[0]?.legsWon??0} â€“ ${d[1]?.legsWon??0}`:"")})}),d[1]&&e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:d[1].name}),e.jsx("div",{className:"text-3xl font-extrabold",children:d[1].legsWon}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:d[1].threeDA.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:d[1].nineDA.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:d[1].dartsAtDouble??"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsx("div",{className:"font-semibold",children:d[1].doublePct!==null&&d[1].doublePct!==void 0?`${d[1].doublePct}%`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:d[1].bestLeg?`${d[1].bestLeg} darts`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:d[1].worstLeg?`${d[1].worstLeg} darts`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:d[1].oneEighties})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:a,children:"Close"}),l&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:o,children:"Rematch"})]})]})})}const Pc="ndn:blocked:v1";function nh(){try{const t=localStorage.getItem(Pc);return t?JSON.parse(t):{}}catch{return{}}}function Il(t){try{localStorage.setItem(Pc,JSON.stringify(t))}catch{}}const ah=Qs((t,a)=>({blocked:nh(),isBlocked:s=>!!a().blocked[(s||"").toLowerCase()],block:s=>t(r=>{const n={...r.blocked};return n[(s||"").toLowerCase()]=Date.now(),Il(n),{blocked:n}}),unblock:s=>t(r=>{const n={...r.blocked};return delete n[(s||"").toLowerCase()],Il(n),{blocked:n}}),all:()=>Object.keys(a().blocked)}));function rh({user:t}){const a="http://localhost:8787",s=Na(),r=(()=>{try{return Sa()}catch{return null}})(),n=ah(),[i,l]=u.useState("room-1"),[o,d]=u.useState(!1),[c,h]=u.useState([]),[m,x]=u.useState(!1),[b,y]=u.useState(!1),N=u.useRef(null),[C,w]=u.useState(null),D=u.useRef(null),I=u.useRef(0),M=u.useRef(null),R=u.useRef(!0),A=u.useRef(0),v=u.useRef(!1),p=ya(),F=Wi(),{favoriteDouble:H,callerEnabled:_,callerVoice:z,callerVolume:T,speakCheckoutOnly:K,allowSpectate:ee,cameraScale:ie,setCameraScale:ke,cameraFitMode:Be="fill",setCameraFitMode:Ue,cameraEnabled:Oe,textSize:je,boxSize:Re,autoscoreProvider:$,matchType:te="singles",setMatchType:ce,teamAName:ze="Team A",setTeamAName:Pe,teamBName:Te="Team B",setTeamBName:Ee,x01DoubleIn:ht}=qt(),Ce=$==="manual",Le=(f=>{switch(f){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(je),[pt,It]=u.useState(2),[is,Ke]=u.useState(!1),[De,Pt]=u.useState([]),[le,fe]=u.useState(0),[ne,Z]=u.useState(0),[He,ye]=u.useState(0),[Ne,Xe]=u.useState(0),[rt,ft]=u.useState(""),[Ve,yt]=u.useState(0),[We,wt]=u.useState(0),[kt,$t]=u.useState(""),[et,zt]=u.useState(20),[os,ls]=u.useState(0),[es,Rt]=u.useState(0),[Yt,Ft]=u.useState(""),[E,ae]=u.useState(30),[xe,$e]=u.useState(!1),[Qe,Mt]=u.useState(null),[Lt,ts]=u.useState(null),[ps,Tt]=u.useState(!1);function _t(){if(Lt)try{const f=new Blob([JSON.stringify(Lt,null,2)],{type:"application/json"}),j=URL.createObjectURL(f),k=document.createElement("a"),L=`ndn-highlight-${Lt.player||"player"}-${Lt.ts||Date.now()}.json`;k.href=j,k.download=L,document.body.appendChild(k),k.click(),k.remove(),URL.revokeObjectURL(j),s?.("Downloaded highlight to device",{type:"success"}),Tt(!1)}catch{s?.("Download failed",{type:"error"})}}async function V(){if(!Lt)return;const f=localStorage.getItem("authToken");if(!f){s?.("You must be signed in to save to account",{type:"error"});return}try{const j=await Kt("/api/user/highlights",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify(Lt)});if(!j.ok){const L=await j.json().catch(()=>({}));s?.(`Save failed: ${L.error||j.statusText}`,{type:"error"});return}const k=await j.json();s?.("Saved highlight to your account",{type:"success"}),Tt(!1)}catch{s?.("Save failed",{type:"error"})}}const[we,ot]=u.useState(null),us=u.useRef(null),[Rs,ks]=u.useState(""),[vs,Cs]=u.useState({}),[Xt,Ps]=u.useState({}),[ws,Ls]=u.useState({}),[Vt,Os]=u.useState({}),[as,Bs]=u.useState({}),[Ts,B]=u.useState({}),[Q,se]=u.useState({}),[G,S]=u.useState({}),[O,U]=u.useState(()=>Li()),[Y,re]=u.useState(0),[he,ge]=u.useState(!1),[Se,Ie]=u.useState(null),[Et,at]=u.useState({}),[xt,ut]=u.useState(null),[bt,cs]=u.useState(300),ms=cc(f=>f.setPaused),[Gt,hs]=u.useState(()=>{try{const f=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(f)}catch{return!1}}),[fs,Zs]=u.useState(!1),vt=u.useRef(!!ya.getState().inProgress);u.useEffect(()=>{const f=vt.current,j=!!p.inProgress;f&&!j&&(p.players||[]).some(L=>(L.legs||[]).some(X=>X.finished))&&Zs(!0),vt.current=j},[p.inProgress,p.players]),u.useEffect(()=>{try{return}catch{}},[]);const Ot=(()=>{const f={};for(const j of p.players||[]){let k=0,L=0;for(const X of j.legs||[])for(const de of X.visits||[])k+=Math.max(0,Number(de.doubleWindowDarts||0)),de.finishedByDouble&&(L+=1);f[j.id]={dartsAtDouble:k,doublesHit:L}}return f})(),[tt,mt]=u.useState(null),ct=u.useRef(null),ss=u.useRef(null);u.useEffect(()=>{if(!he||!xt)return;const f=setInterval(()=>{Date.now()>=(xt||0)&&(ge(!1),Ie(null),at({}),ut(null),ms(!1,null),it())},1e3);return()=>clearInterval(f)},[he,xt]);function Ht(){try{if(!ss.current){const f=window.AudioContext||window.webkitAudioContext;f&&(ss.current=new f)}ss.current?.resume?.().catch(()=>{})}catch{}}function Ct(f,j,k=0,L=.05){const X=ss.current;if(!X)return;const de=X.createOscillator(),ue=X.createGain();de.type="square",de.frequency.value=f,ue.gain.value=L,de.connect(ue),ue.connect(X.destination);const q=X.currentTime+k;de.start(q),de.stop(q+j/1e3)}function xs(f){Ht(),ss.current&&(f==="180"?(Ct(880,110,0,.06),Ct(1175,110,.06,.06),Ct(1568,140,.12,.06)):(Ct(659,140,0,.07),Ct(784,140,.08,.07),Ct(987,200,.16,.07)))}function gt(f,j){const k=Date.now(),L=ct.current;L&&L.kind===f&&L.by===j&&k-L.ts<500||(ct.current={kind:f,by:j,ts:k},mt({kind:f,by:j,turnIdx:p.currentPlayerIdx,ts:k}),xs(f))}const[en,Qt]=u.useState(!1),[Es,Ss]=u.useState([]),[Ds,Is]=u.useState("bestof"),[Ye,jt]=u.useState(5),[st,Bt]=u.useState(501),[Ze,Zt]=u.useState(null),[Nt,Ut]=u.useState("");function Ms(f){Ut(f),setTimeout(()=>Ut(""),4e3);try{s(f||"Stripe checkout failed",{type:"error"})}catch{}}const[Us,js]=u.useState(null),[yn,vn]=u.useState(null),[Wt,jn]=u.useState("X01"),[Fe,tn]=u.useState("X01"),[qs,$s]=u.useState(!1),[sn,Ns]=u.useState(30),[Fs,ea]=u.useState(!!ht),bs=t?.username&&!t?.fullAccess?Ll(t.username):1/0,As=!t?.fullAccess&&bs<=0,[Nn,ta]=u.useState("all"),[Ln,On]=u.useState("all"),[cn,Ks]=u.useState("all"),[_s,sa]=u.useState(!1),[zs,dn]=u.useState(10),{H:un}=wa(),wn=t?.username?ln(t.username):0,Bn=Wi(f=>f.unread),mn=(Es||[]).filter(f=>!(Nn!=="all"&&f.mode!==Nn||Ln!=="all"&&Number(f.startingScore)!==Number(Ln)||cn!=="all"&&f.game!==cn||_s&&(!wn||!f.creatorAvg||Math.abs(Number(f.creatorAvg)-Number(wn))>zs)));u.useEffect(()=>{const f=j=>{const k=j?.detail||{};k.game&&jn(k.game),(k.mode==="bestof"||k.mode==="firstto")&&Is(k.mode),typeof k.value=="number"&&isFinite(k.value)&&jt(Math.max(1,Math.floor(k.value))),typeof k.start=="number"&&isFinite(k.start)&&Bt(Math.max(1,Math.floor(k.start))),Qt(!0)};return window.addEventListener("ndn:online-demo",f),()=>window.removeEventListener("ndn:online-demo",f)},[]),u.useEffect(()=>{const f=String(t?.email||"").toLowerCase();f&&Kt(`/api/friends/messages?email=${encodeURIComponent(f)}`).then(j=>j.json()).then(j=>{j?.ok&&Array.isArray(j.messages)&&F.load(j.messages)}).catch(()=>{})},[t?.email]),u.useEffect(()=>{const f=j=>{try{const k=j?.detail||{},L=Number(k.start||501);p.newMatch([t?.username||"You","Opponent"],L,i),p.addVisit(60,3),p.nextPlayer(),p.addVisit(85,3),p.nextPlayer(),p.addVisit(100,3),tn("X01"),Ke(!0)}catch(k){console.error("Demo error:",k)}};return window.addEventListener("ndn:online-match-demo",f),()=>window.removeEventListener("ndn:online-match-demo",f)},[]),u.useEffect(()=>(R.current=!0,na(),()=>{R.current=!1,M.current&&clearTimeout(M.current);try{D.current?.close()}catch{}}),[]),u.useEffect(()=>{F.setInGame(p.inProgress)},[p.inProgress]),u.useEffect(()=>{tt&&p.currentPlayerIdx!==tt.turnIdx&&mt(null)},[p.currentPlayerIdx,tt?.turnIdx]),u.useEffect(()=>{try{r&&r.connected?r.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ee}):D.current&&D.current.readyState===WebSocket.OPEN&&D.current.send(JSON.stringify({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ee}))}catch{}},[ee,r?.connected]),u.useEffect(()=>{const f=j=>{const k=j?.detail?.roomId;k&&(l(k),r?r.send({type:"spectate",roomId:k}):D.current?.send(JSON.stringify({type:"spectate",roomId:k})),Ke(!0),Qt(!1))};return window.addEventListener("ndn:spectate-room",f),()=>window.removeEventListener("ndn:spectate-room",f)},[r]);function na(){if(r){r.connected&&(r.send({type:"join",roomId:i}),r.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ee}),r.send({type:"list-matches"}),d(!0));return}try{if(D.current&&(D.current.readyState===WebSocket.OPEN||D.current.readyState===WebSocket.CONNECTING))return}catch{}const f="ws://localhost:8787",j=window.location.protocol==="https:"?"wss":"ws",k=window.location.hostname,L=`${j}://${k}${window.location.port?"":":8787"}`,X=f.length>0?f:L,de=new WebSocket(X);D.current=de,de.onopen=()=>{d(!0),I.current=0,v.current?s("Reconnected to lobby",{type:"success"}):(s("Connected to lobby",{type:"success"}),v.current=!0),de.send(JSON.stringify({type:"join",roomId:i})),de.send(JSON.stringify({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ee})),de.send(JSON.stringify({type:"list-matches"}))},de.onmessage=ue=>{const q=JSON.parse(ue.data);if(q.type==="state"){p.importState(q.payload);const be=Number(q.payload._dpIndex),Jt=Number(q.payload._dpHits);Number.isFinite(be)&&ye(Math.max(0,be)),Number.isFinite(Jt)&&Xe(Math.max(0,Jt));const gs=Number(q.payload._atcIndex),Hs=Number(q.payload._atcHits);Number.isFinite(gs)&&yt(Math.max(0,gs)),Number.isFinite(Hs)&&wt(Math.max(0,Hs));try{const _e=Number(q.payload._trebleTarget),Aa=Number(q.payload._trebleHits),da=Number(q.payload._trebleDarts),ys=Number(q.payload._trebleMaxDarts);Number.isFinite(_e)&&zt(Math.max(1,Math.min(20,_e))),Number.isFinite(Aa)&&ls(Math.max(0,Aa)),Number.isFinite(da)&&Rt(Math.max(0,da)),Number.isFinite(ys)&&ae(Math.max(0,ys))}catch{}try{const _e=q.payload._cricketById;_e&&typeof _e=="object"&&Cs(_e)}catch{}try{const _e=q.payload._shanghaiById;_e&&typeof _e=="object"&&Ps(_e)}catch{}try{const _e=q.payload._halveById;_e&&typeof _e=="object"&&Ls(_e)}catch{}try{const _e=q.payload._highlowById;_e&&typeof _e=="object"&&Os(_e)}catch{}try{const _e=q.payload._killerById;_e&&typeof _e=="object"&&Bs(_e)}catch{}try{const _e=q.payload._amCricketById;_e&&typeof _e=="object"&&B(_e)}catch{}try{const _e=q.payload._baseballById;_e&&typeof _e=="object"&&se(_e)}catch{}try{const _e=q.payload._golfById;_e&&typeof _e=="object"&&S(_e)}catch{}try{const _e=q.payload._tttState;_e&&typeof _e=="object"&&U(_e)}catch{}try{const _e=Number(q.payload._turnDarts);Number.isFinite(_e)&&re(Math.max(0,_e))}catch{}try{const _e=q.payload._x01DoubleIn;typeof _e=="boolean"&&$e(_e)}catch{}}else if(q.type==="joined")q.id&&w(q.id);else if(q.type==="presence"||q.type==="peer-joined")Pt(be=>{const Jt=new Set(be);return q.id&&Jt.add(q.id),Array.from(Jt)});else if(q.type==="chat"){const be=!!(q.from&&C&&q.from===C),Jt=be?t?.username||"me":q.from||"peer",gs=String(q.from||"");if(!be&&gs&&n.isBlocked(gs))return;if(be&&N.current&&String(q.message||"")===N.current.text){N.current=null;return}h(Hs=>[...Hs,{from:Jt,message:q.message,fromId:gs||void 0}])}else if(q.type==="matches")Ss(Array.isArray(q.matches)?q.matches:[]);else if(q.type==="invite")Zt({matchId:q.matchId,fromId:q.fromId,fromName:q.fromName,calibrated:!!q.calibrated,boardPreview:q.boardPreview||null,game:q.game,mode:q.mode,value:q.value,startingScore:q.startingScore});else if(q.type==="match-start")l(q.roomId),de.send(JSON.stringify({type:"join",roomId:q.roomId})),Ke(!0),Qt(!1),q.match?.game&&tn(q.match.game),t?.username&&!t?.fullAccess&&Eo(t.username);else if(q.type==="declined")s("Invite declined",{type:"info"});else if(q.type==="error"){const be=typeof q.message=="string"?q.message:"Action not allowed";if(Ut(be),q.code==="SPECTATE_NOT_ALLOWED")try{s("This player has spectating turned off.",{type:"error"})}catch{}q.code==="NOT_FOUND"&&Us&&vn({game:Us.game,mode:Us.mode,value:Us.value,startingScore:Us.startingScore}),setTimeout(()=>Ut(""),3500)}else if(q.type==="friend-invite")confirm(`${q.fromName||q.fromEmail} invited you to play ${q.game||"X01"} (${q.mode==="firstto"?"First To":"Best Of"} ${q.value||1}). Accept?`)?de.send(JSON.stringify({type:"start-friend-match",toEmail:q.fromEmail,game:q.game,mode:q.mode,value:q.value,startingScore:q.startingScore})):s("Invite declined",{type:"info"});else if(q.type==="friend-message")F.add({id:q.id||`${q.ts}-${q.from}`,from:q.from,message:q.message,ts:q.ts||Date.now()}),p.inProgress||s(`${q.from}: ${q.message}`,{type:"info"});else if(q.type==="celebration"){const be=q.by||"Player",Jt=q.kind==="leg"?"leg":"180";gt(Jt,be)}else if(q.type==="cam-code")console.log("Received cam-code:",q.code),Mt(q.code),s(`Pairing code: ${q.code}`,{type:"info"});else if(q.type==="cam-peer-joined")console.log("Mobile peer joined for code:",q.code),yr(q.code);else if(q.type==="cam-answer"){console.log("Received cam-answer");const be=window.mobilePC;be&&be.setRemoteDescription(new RTCSessionDescription(q.payload))}else if(q.type==="cam-ice"){console.log("Received cam-ice");const be=window.mobilePC;be&&be.addIceCandidate(q.payload)}},de.onclose=()=>{if(d(!1),!R.current)return;const ue=(I.current||0)+1;I.current=ue;const q=Math.min(3e4,1e3*Math.pow(2,ue-1)),be=Date.now();be-A.current>4e3&&(s(`Disconnected. Reconnecting in ${Math.round(q/1e3)}s...`,{type:"error"}),A.current=be),M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{na()},q)}}function aa(){const f=p.players||[],j=p.currentPlayerIdx||0,k=f[j],L=k?.legs?.[k?.legs?.length-1],X=L?L.totalScoreRemaining:p.startingScore,de=(()=>{let ys=0,ua=0;if(k?.legs)for(const Ra of k.legs){ys+=Ra.totalScoreStart-Ra.totalScoreRemaining;const vr=(Ra.visits||[]).reduce((jr,Va)=>jr+(Va.darts||0)-(Va.preOpenDarts||0),0);ua+=vr}return{pts:ys,darts:ua}})(),ue=de.darts>0?de.pts/de.darts*3:0,q=L?.visits?.[L.visits.length-1]?.score??0;let be="Ã”Ã‡Ã¶";f.length===2?be=`${f[0]?.legsWon||0}-${f[1]?.legsWon||0}`:f.length>2&&(be=f.map(ys=>`${ys.name}:${ys.legsWon||0}`).join(" = "));const Jt=p.bestLegThisMatch,gs=Jt?`${Jt.darts} darts${(()=>{const ys=f.find(ua=>ua.id===Jt.playerId);return ys?` (${ys.name})`:""})()}`:"-",_e=(ys=>{switch(ys){case"small":return"text-xs";case"large":return"text-base";default:return"text-sm"}})(je),da=(ys=>{switch(ys){case"small":return"p-2";case"large":return"p-4";default:return"p-3"}})(Re);return e.jsxs("div",{className:`${da} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${_e}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:be}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold",children:k?.name||"Ã”Ã‡Ã¶"}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-lg",children:X}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:ue.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:q}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:gs})]})]})}u.useEffect(()=>{if(!r)return;d(r.connected);const f=r.addListener(j=>{try{if(j.type==="state"){p.importState(j.payload);try{const k=Number(j.payload._dpIndex),L=Number(j.payload._dpHits);Number.isFinite(k)&&ye(Math.max(0,k)),Number.isFinite(L)&&Xe(Math.max(0,L))}catch{}try{const k=Number(j.payload._atcIndex),L=Number(j.payload._atcHits);Number.isFinite(k)&&yt(Math.max(0,k)),Number.isFinite(L)&&wt(Math.max(0,L))}catch{}try{const k=j.payload._cricketById;k&&typeof k=="object"&&Cs(k)}catch{}try{const k=j.payload._shanghaiById;k&&typeof k=="object"&&Ps(k)}catch{}try{const k=j.payload._halveById;k&&typeof k=="object"&&Ls(k)}catch{}try{const k=j.payload._highlowById;k&&typeof k=="object"&&Os(k)}catch{}try{const k=j.payload._killerById;k&&typeof k=="object"&&Bs(k)}catch{}try{const k=j.payload._amCricketById;k&&typeof k=="object"&&B(k)}catch{}try{const k=j.payload._baseballById;k&&typeof k=="object"&&se(k)}catch{}try{const k=j.payload._golfById;k&&typeof k=="object"&&S(k)}catch{}try{const k=j.payload._tttState;k&&typeof k=="object"&&U(k)}catch{}try{const k=Number(j.payload._turnDarts);Number.isFinite(k)&&re(Math.max(0,k))}catch{}try{const k=!!j.payload._paused;ge(k)}catch{}try{const k=Number(j.payload._pauseEndsAt);ut(Number.isFinite(k)?k:null)}catch{}try{const k=j.payload._pauseRequestedBy;Ie(typeof k=="string"?k:null)}catch{}try{const k=j.payload._pauseAcceptedBy;k&&typeof k=="object"&&at(k)}catch{}try{const k=Number(j.payload._pauseDurationSec);Number.isFinite(k)&&cs(Math.max(60,Math.min(600,k)))}catch{}try{const k=j.payload._x01DoubleIn;typeof k=="boolean"&&$e(k)}catch{}ms(!!j.payload._paused,Number(j.payload._pauseEndsAt)||null)}else if(j.type==="joined")j.id&&w(j.id);else if(j.type==="presence"||j.type==="peer-joined")Pt(k=>Array.from(new Set([...k||[],j.id].filter(Boolean))));else if(j.type==="chat"){const k=!!(j.from&&C&&j.from===C),L=k?t?.username||"me":j.from||"peer",X=String(j.from||"");if(!k&&X&&n.isBlocked(X))return;h(de=>[...de,{from:L,message:j.message,fromId:X||void 0}])}else if(j.type==="matches")Ss(Array.isArray(j.matches)?j.matches:[]);else if(j.type==="invite")Zt({matchId:j.matchId,fromId:j.fromId,fromName:j.fromName,calibrated:!!j.calibrated,boardPreview:j.boardPreview||null,game:j.game,mode:j.mode,value:j.value,startingScore:j.startingScore});else if(j.type==="match-start")l(j.roomId),r.send({type:"join",roomId:j.roomId}),Ke(!0),Qt(!1),j.match?.game&&tn(j.match.game),t?.username&&!t?.fullAccess&&Eo(t.username);else if(j.type==="declined")s("Invite declined",{type:"info"});else if(j.type==="error"){const k=typeof j.message=="string"?j.message:"Action not allowed";if(Ut(k),j.code==="SPECTATE_NOT_ALLOWED")try{s("This player has spectating turned off.",{type:"error"})}catch{}j.code==="NOT_FOUND"&&Us&&vn({game:Us.game,mode:Us.mode,value:Us.value,startingScore:Us.startingScore}),setTimeout(()=>Ut(""),3500)}else if(j.type==="friend-invite")confirm(`${j.fromName||j.fromEmail} invited you to play ${j.game||"X01"} (${j.mode==="firstto"?"First To":"Best Of"} ${j.value||1}). Accept?`)?r.send({type:"start-friend-match",toEmail:j.fromEmail,game:j.game,mode:j.mode,value:j.value,startingScore:j.startingScore}):s("Invite declined",{type:"info"});else if(j.type==="friend-message")F.add({id:j.id||`${j.ts}-${j.from}`,from:j.from,message:j.message,ts:j.ts||Date.now()}),p.inProgress||s(`${j.from}: ${j.message}`,{type:"info"});else if(j.type==="celebration"){const k=j.by||"Player",L=j.kind==="leg"?"leg":"180";gt(L,k)}}catch{}});return r.connected&&(r.send({type:"join",roomId:i}),r.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ee}),r.send({type:"list-matches"})),()=>{f()}},[r?.connected]);function it(){if(r){r.send({type:"state",payload:{...p,_turnIdx:le,_participants:De,_dpIndex:He,_dpHits:Ne,_atcIndex:Ve,_atcHits:We,_trebleTarget:et,_trebleHits:os,_trebleDarts:es,_trebleMaxDarts:E,_x01DoubleIn:xe,_cricketById:vs,_shanghaiById:Xt,_halveById:ws,_highlowById:Vt,_killerById:as,_amCricketById:Ts,_baseballById:Q,_golfById:G,_tttState:O,_turnDarts:Y,_paused:he,_pauseEndsAt:xt,_pauseRequestedBy:Se,_pauseAcceptedBy:Et,_pauseDurationSec:bt}});return}const f=D.current;!f||f.readyState!==WebSocket.OPEN||f.send(JSON.stringify({type:"state",payload:{...p,_turnIdx:le,_participants:De,_dpIndex:He,_dpHits:Ne,_atcIndex:Ve,_atcHits:We,_trebleTarget:et,_trebleHits:os,_trebleDarts:es,_trebleMaxDarts:E,_x01DoubleIn:xe,_cricketById:vs,_shanghaiById:Xt,_halveById:ws,_highlowById:Vt,_killerById:as,_amCricketById:Ts,_baseballById:Q,_golfById:G,_tttState:O,_turnDarts:Y,_paused:he,_pauseEndsAt:xt,_pauseRequestedBy:Se,_pauseAcceptedBy:Et,_pauseDurationSec:bt}}))}function ra(f){const j=t?.username||"me";if(h(L=>[...L,{from:j,message:f,fromId:C||"self"}]),N.current={text:f,ts:Date.now()},r){r.send({type:"chat",message:f});return}const k=D.current;!k||k.readyState!==WebSocket.OPEN||k.send(JSON.stringify({type:"chat",message:f}))}function hn(f){if(Ai(f,He)){const k=Ne+1,L=He+1;Xe(k),ye(L);try{if(k>=Gs.length){const X=p.players[p.currentPlayerIdx]?.name||"Player";gt("leg",X),Xe(0),ye(0)}}catch{}}it()}function fn(){const f=Math.max(0,Math.floor(ne|0));hn(f),Z(0)}function Un(){const f=gn(rt);f!=null&&(hn(f),ft(""))}function qa(f,j,k){const L=rs[Ve];return L==null?!1:typeof k=="number"&&k>=1&&k<=20&&k===L&&(j==="SINGLE"||j==="DOUBLE"||j==="TRIPLE")?!0:L===25?j==="BULL"||f===25:L===50?j==="INNER_BULL"||f===50:f===L||f===L*2||f===L*3}function ia(f,j,k){if(qa(f,j,k)){const L=We+1,X=Ve+1;wt(L),yt(X);try{if(L>=rs.length){const de=p.players[p.currentPlayerIdx]?.name||"Player";gt("leg",de),wt(0),yt(0)}}catch{}}it()}function ka(){const f=Math.max(0,Math.floor(ne|0));ia(f),Z(0)}function Ca(){const f=gn(kt);f!=null&&(ia(f),$t(""))}function Ta(f,j,k){if(E>0&&es>=E)return;(j==="TRIPLE"&&k===et||!j&&f===et*3)&&ls(X=>X+1),Rt(X=>{const de=X+1;if(de%3===0&&[20,19,18].includes(et)){const ue=[20,19,18],q=ue.indexOf(et),be=ue[(q+1)%ue.length];zt(be)}return de}),it()}function $n(){const f=Math.max(0,Math.floor(ne|0));Ta(f),Z(0)}function pr(){const f=gn(Yt);f!=null&&(Ta(f),Ft(""))}function Fn(){ls(0),Rt(0)}function At(){return p.players[p.currentPlayerIdx]?.id??String(p.currentPlayerIdx)}function Sn(f){vs[f]||Cs(j=>({...j,[f]:Kn()}))}function Ea(f){Xt[f]||Ps(j=>({...j,[f]:An()}))}function _n(f){ws[f]||Ls(j=>({...j,[f]:Rn()}))}function za(f){Vt[f]||Os(j=>({...j,[f]:Pn()}))}function Hn(f){if(!as[f]){const j=new Set(Object.values(as||{}).map(X=>X.number)),k=[];for(let X=1;X<=20;X++)j.has(X)||k.push(X);const L=k.length>0?k[Math.floor(Math.random()*k.length)]:20;Bs(X=>({...X,[f]:bc(L,3)}))}}function br(f){Ts[f]||B(j=>({...j,[f]:_a()}))}function oa(f){Q[f]||se(j=>({...j,[f]:Ua()}))}function gr(f){G[f]||S(j=>({...j,[f]:$a()}))}u.useEffect(()=>{re(0)},[p.currentPlayerIdx,Fe]);function Da(f,j){const k=p.players.filter(L=>L.id!==j);return k.length===0?!1:k.every(L=>(vs[L.id]?.marks?.[f]||0)>=3)}function la(f,j,k){const L=At();Sn(L),Cs(de=>{const ue={...de},q={...ue[L]||Kn()};return dc(q,f,j,k,be=>Da(be,L)),ue[L]=q,ue});const X=Y+1;re(X),X>=3&&(re(0),p.nextPlayer()),it()}function kn(f,j,k){const L=At();Ea(L),Ps(de=>{const ue={...de},q={...ue[L]||An()};return uc(q,f,j,k),ue[L]=q,ue});const X=Y+1;re(X),X>=3&&(Ps(de=>{const ue={...de},q={...ue[L]||An()};return mc(q),ue[L]=q,ue}),re(0),p.nextPlayer()),it()}function Wn(f,j,k){const L=At();_n(L),Ls(de=>{const ue={...de},q={...ue[L]||Rn()};return hc(q,f,j,k),ue[L]=q,ue});const X=Y+1;re(X),X>=3&&(Ls(de=>{const ue={...de},q={...ue[L]||Rn()};return fc(q),ue[L]=q,ue}),re(0),p.nextPlayer()),it()}function xn(f,j,k){const L=At();za(L),Os(de=>{const ue={...de},q={...ue[L]||Pn()};return xc(q,f,j,k),ue[L]=q,ue});const X=Y+1;re(X),X>=3&&(Os(de=>{const ue={...de},q={...ue[L]||Pn()};return pc(q),ue[L]=q,ue}),re(0),p.nextPlayer()),it()}function ns(f,j){const k=At();p.players.forEach(X=>Hn(X.id)),Bs(X=>{const de={};for(const[q,be]of Object.entries(X))de[q]={...be};Ri(k,de,f,j);const ue=Pi(de);if(ue)try{gt("leg",p.players.find(q=>q.id===ue)?.name||"Player")}catch{}return de});const L=Y+1;re(L),L>=3&&(re(0),p.nextPlayer()),it()}function ds(f,j,k){const L=At();br(L),B(de=>{const ue={...de},be={...ue[L]||_a()};return wc(be,f,j,k,gs=>p.players.filter(Hs=>Hs.id!==L).every(Hs=>(Ts[Hs.id]?.marks?.[gs]||0)>=3)),ue[L]=be,ue});const X=Y+1;re(X),X>=3&&(re(0),p.nextPlayer()),it()}function Ia(f,j,k){const L=At();oa(L),se(de=>{const ue={...de},q={...ue[L]||Ua()};return gc(q,f,j,k),ue[L]=q,ue});const X=Y+1;re(X),X>=3&&(re(0),p.nextPlayer()),it()}function ca(f,j,k){const L=At();gr(L),S(de=>{const ue={...de},q={...ue[L]||$a()};return vc(q,f,j,k),ue[L]=q,ue});const X=Y+1;re(X),X>=3&&(re(0),p.nextPlayer()),it()}function Ma(f,j,k,L){U(de=>{const ue={...de,board:[...de.board]};return jc(ue,f,j,k,L),ue});const X=Y+1;re(X),X>=3&&(re(0),p.nextPlayer()),it()}function Cn(){try{window.dispatchEvent(new Event("ndn:open-manual"))}catch{}}function nn(f){const j=Math.max(0,f|0);try{const X=p.players[p.currentPlayerIdx],de=X?.legs?.[X.legs.length-1],ue=de?de.totalScoreRemaining:p.startingScore,q=Math.max(0,ue-j),be=ue<=50?3:q<=50?1:0,Jt=q===0;p.addVisit(j,3,{preOpenDarts:0,doubleWindowDarts:be,finishedByDouble:Jt,visitTotal:j})}catch{p.addVisit(j,3)}Z(0);const k=p.players[p.currentPlayerIdx],L=k.legs[k.legs.length-1];try{j===180&&gt("180",k?.name||"Player"),L&&L.totalScoreRemaining===0&&gt("leg",k?.name||"Player")}catch{}if(L&&L.totalScoreRemaining===0?p.endLeg(j):p.nextPlayer(),_){const X=L?L.totalScoreRemaining:p.startingScore;Mn(t?.username||"Player",j,Math.max(0,X),z,{volume:T,checkoutOnly:K})}t?.username&&k?.name===t.username&&In(t.username,3,j),it()}function qn(f,j){const k={type:"report",offenderId:f,reason:"Inappropriate language",message:j};try{r?r.send(k):D.current?.send(JSON.stringify(k))}catch{}try{s("Report submitted",{type:"info"})}catch{}}async function zn(){try{const f=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),j=f.getVideoTracks?.()[0],k=document.createElement("video");k.srcObject=f,await k.play().catch(()=>{}),await new Promise(be=>setTimeout(be,120));const L=Math.min(320,k.videoWidth||320),X=Math.max(1,Math.floor((k.videoHeight||180)*(L/Math.max(1,k.videoWidth||320)))),de=document.createElement("canvas");de.width=L,de.height=X,de.getContext("2d").drawImage(k,0,0,L,X);const q=de.toDataURL("image/jpeg",.7);try{j&&j.stop()}catch{}try{f.getTracks?.().forEach(be=>be.stop())}catch{}return q}catch{return null}}const yr=async f=>{console.log("Starting WebRTC for code:",f);try{const j=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});j.ontrack=L=>{console.log("Received track:",L.streams[0]),ot(L.streams[0]),us.current&&(us.current.srcObject=L.streams[0],console.log("Set video srcObject"))},j.onicecandidate=L=>{L.candidate&&(console.log("Sending ICE candidate"),r?r.send({type:"cam-ice",code:f,payload:L.candidate}):D.current&&D.current.readyState===WebSocket.OPEN&&D.current.send(JSON.stringify({type:"cam-ice",code:f,payload:L.candidate})))},j.onconnectionstatechange=()=>console.log("Connection state:",j.connectionState);const k=await j.createOffer();if(await j.setLocalDescription(k),console.log("Sending offer"),r)console.log("Sending offer via wsGlobal"),r.send({type:"cam-offer",code:f,payload:k});else if(D.current&&D.current.readyState===WebSocket.OPEN)console.log("Sending offer via wsRef"),D.current.send(JSON.stringify({type:"cam-offer",code:f,payload:k}));else{console.log("WS not available, POSTing offer to /cam/signal");try{await Kt(`/cam/signal/${f}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"cam-offer",payload:k,source:"desktop"})})}catch(L){console.warn("REST offer failed",L)}}window.mobilePC=j}catch(j){console.error("WebRTC error:",j),s("Failed to start mobile camera",{type:"error"})}};return e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Online Play"}),e.jsxs("div",{className:"ndn-shell-body",children:[he&&e.jsxs("div",{className:"absolute inset-0 z-40 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold mb-2",children:"Game Paused"}),e.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Resumes ",xt?`in ${Math.max(0,Math.ceil((xt-Date.now())/1e3))}s`:"soon"]}),e.jsx("div",{className:"text-xs opacity-60",children:"Both players can see this pause screen."})]}),Bn>0&&!p.inProgress&&e.jsxs("div",{className:"mb-3 text-sm px-3 py-2 rounded bg-amber-600/30 border border-amber-500/40",children:["You have ",Bn," unread message",Bn>1?"s":"",". Check the Friends tab."]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs opacity-70 shrink-0",children:"Room"}),e.jsx("input",{className:"input w-28",value:i,onChange:f=>l(f.target.value),placeholder:"room-1"})]}),o?e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0",children:"Connected"}):e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 shrink-0",onClick:na,children:"Connect"}),e.jsx("button",{className:"btn shrink-0",onClick:it,disabled:!o,children:"Sync"}),!he&&!Se&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs opacity-70",children:"Pause (max 10m)"}),e.jsxs("select",{className:"input w-28",value:bt,onChange:f=>cs(Math.max(60,Math.min(600,parseInt(f.target.value)||300))),children:[e.jsx("option",{value:120,children:"2 min"}),e.jsx("option",{value:300,children:"5 min"}),e.jsx("option",{value:600,children:"10 min"})]}),e.jsx("button",{className:"btn",disabled:!o,onClick:()=>{const f=t?.username||"player";Ie(f),at({[f]:!0}),ge(!1),ut(null),it()},children:"Request Pause"})]}),!he&&Se&&!Et[t?.username||""]&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"opacity-80",children:[Se," requested a ",Math.round((bt||300)/60),"m pause"]}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{const f=t?.username||"",j={...Et,[f]:!0};at(j);const k=Object.keys(j).filter(X=>!!j[X]).length,L=Math.max(2,De?.length||2);if(k>=2||k>=L){const X=Date.now()+Math.min(600,Math.max(60,bt||300))*1e3;ge(!0),ut(X),ms(!0,X)}it()},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>{Ie(null),at({}),ge(!1),ut(null),ms(!1,null),it()},children:"Decline"})]}),he&&e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-yellow-500/25 text-yellow-100 border border-yellow-400/40 shrink-0",children:["Paused Â· ",Math.max(0,Math.ceil(((xt||Date.now())-Date.now())/1e3)),"s"]}),e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40 shrink-0",title:"Open a simulated online match demo",onClick:()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch(f){console.error("Demo click error:",f)}},children:"DEMO"}),o&&e.jsx("button",{className:"btn shrink-0",onClick:()=>Ke(!0),disabled:As,title:As?"Weekly free games used":"",children:"Open Match"})]})}),e.jsx("div",{className:`mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end ${!o||As?"opacity-60 cursor-not-allowed":"cursor-pointer"}`,role:"button",title:o?As?"Weekly free games used":"Create a new match":"Connect to the lobby first",onClick:()=>{!o||As||(Qt(!0),r?r.send({type:"list-matches"}):D.current?.send(JSON.stringify({type:"list-matches"})))},children:e.jsx("button",{className:"btn",disabled:!o||As,children:"Create Match +"})}),e.jsx("p",{className:"text-sm text-slate-600 mt-3",children:"Open this app on another device and join the same Room ID to sync scores."}),!t?.fullAccess&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Weekly free online games remaining: ",bs===1/0?"Ã”Ã‡Ã¶":bs]}),!t?.fullAccess&&bs!==1/0&&bs<=0&&e.jsx("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm",children:"You've used your 3 free online games this week. PREMIUM required to continue."}),Nt&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"material-icons text-rose-300",children:"error_outline"}),Nt]}),yn&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-700/30 border border-indigo-600/40 text-indigo-100 text-sm flex items-center justify-between gap-2",children:[e.jsx("div",{children:"That room is full or no longer available. Create a new clean room with the same settings?"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const{game:f,mode:j,value:k,startingScore:L}=yn,X=t?.username?ln(t.username):0;r?(r.send({type:"create-match",game:f,mode:j,value:k,startingScore:L||501,creatorAvg:X}),r.send({type:"list-matches"})):(D.current?.send(JSON.stringify({type:"create-match",game:f,mode:j,value:k,startingScore:L||501,creatorAvg:X})),D.current?.send(JSON.stringify({type:"list-matches"}))),vn(null)},children:"Create New Match"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>vn(null),children:"Dismiss"})]})]}),o&&e.jsxs("div",{className:"mt-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10 flex-1 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"World Lobby"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs opacity-80",children:["Matches: ",mn.length]}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>r?r.send({type:"list-matches"}):D.current?.send(JSON.stringify({type:"list-matches"})),children:"Refresh"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",title:o?As?"Weekly free games used":"Create a new match":"Connect to the lobby first",disabled:!o||As,onClick:()=>{!o||As||(Qt(!0),r?r.send({type:"list-matches"}):D.current?.send(JSON.stringify({type:"list-matches"})))},children:"Create Match +"})]})]}),e.jsxs("div",{className:"space-y-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Mode"}),e.jsx(xr,{tabs:[{key:"all",label:"All"},{key:"bestof",label:"Best of"},{key:"firstto",label:"First to"}],active:Nn,onChange:f=>ta(f)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-2 font-semibold",children:"Game"}),e.jsxs("select",{className:"input w-full text-sm",value:cn,onChange:f=>Ks(f.target.value),children:[e.jsx("option",{value:"all",children:"All"}),ja.map(f=>e.jsx("option",{value:f,children:f},f))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-2 font-semibold",children:"Starting Score"}),e.jsxs("select",{className:"input w-full text-sm",value:Ln,onChange:f=>{const j=f.target.value;On(j==="all"?"all":Number(j))},disabled:cn!=="all"&&cn!=="X01",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"301",children:"301"}),e.jsx("option",{value:"501",children:"501"}),e.jsx("option",{value:"701",children:"701"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-2 font-semibold",children:"Opponent Average"}),e.jsxs("div",{className:"flex items-center gap-2 h-10 px-3 rounded bg-slate-900/30 border border-slate-500/30",children:[e.jsx("input",{id:"nearavg",type:"checkbox",className:"w-4 h-4 cursor-pointer accent-purple-500",checked:_s,onChange:f=>sa(f.target.checked),title:!wn||wn===0?"Play a game first to use this filter":"Filter matches near your average"}),e.jsx("label",{htmlFor:"nearavg",className:"cursor-pointer text-sm flex-1",children:"Near my avg"}),e.jsx("input",{type:"number",className:"input w-20 text-sm px-2 py-1",min:5,max:40,step:1,value:zs,onChange:f=>{const j=parseInt(f.target.value||"10");isNaN(j)||dn(Math.max(5,Math.min(40,j)))},disabled:!_s,title:"Tolerance range (Â±)"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-2",children:[e.jsxs("div",{className:"flex-1 max-w-xs",children:[e.jsx("label",{className:`block text-xs opacity-70 mb-2 font-semibold ${_s?"":"opacity-40"}`,children:"Avg Tolerance (Â±)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"1",max:"50",value:zs,onChange:f=>{const j=parseInt(f.target.value,10);isNaN(j)||dn(Math.max(1,Math.min(50,j)))},disabled:!_s,title:"Drag to set tolerance",className:"w-32 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:_s?"linear-gradient(to right, rgb(55, 65, 81) 0%, rgb(55, 65, 81) "+(zs-1)/49*100+"%, rgb(88, 28, 135) "+(zs-1)/49*100+"%, rgb(88, 28, 135) 100%)":"linear-gradient(to right, rgb(71, 85, 105) 0%, rgb(71, 85, 105) 100%)"}}),e.jsxs("div",{className:"text-xs font-mono font-semibold w-8 text-right text-purple-400",children:["Â±",zs]})]})]}),e.jsx("button",{className:"btn px-3 py-2 text-sm mt-6",onClick:()=>{ta("all"),Ks("all"),On("all"),sa(!1),dn(10)},children:"Reset"})]})]}),mn.length===0?e.jsx("div",{className:"text-sm text-slate-300",children:"No games waiting. Create one!"}):e.jsx("div",{className:"space-y-2",children:mn.map(f=>e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 flex items-center justify-between relative",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[f.game||"X01"," ",f.game==="X01"?` ${f.startingScore}`:""," - ",f.mode==="bestof"?`Best Of ${f.value}`:`First To ${f.value}`," - Created by ",f.creatorName]}),f.requireCalibration&&e.jsx("div",{className:"text-[11px] inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-600/30 mt-1",children:"Calibration required"}),f.creatorAvg?e.jsxs("div",{className:"text-xs opacity-70",children:["Creator avg: ",Number(f.creatorAvg).toFixed(1)]}):null,e.jsxs("div",{className:"text-xs opacity-70",children:["ID: ",f.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm bg-green-600 hover:bg-green-700",disabled:As||!t?.fullAccess&&bn.includes(f.game)||!!f.requireCalibration&&!un,title:!t?.fullAccess&&bn.includes(f.game)?"PREMIUM game":As?"Weekly free games used":f.requireCalibration&&!un?"Calibration required":"",onClick:async()=>{js({game:f.game,mode:f.mode,value:f.value,startingScore:f.startingScore});const j=!!un,k=await zn();try{r?r.send({type:"join-match",matchId:f.id,calibrated:j,boardPreview:k}):D.current?.send(JSON.stringify({type:"join-match",matchId:f.id,calibrated:j,boardPreview:k}))}catch(L){Ms(L?.message||"Failed to create Stripe checkout session. Please try again later.")}},children:"Join Now!"}),C&&f.creatorId===C&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Close this match",onClick:()=>{r?r.send({type:"cancel-match",matchId:f.id}):D.current?.send(JSON.stringify({type:"cancel-match",matchId:f.id}))},"aria-label":"Close match",children:"Ã—"})]})]},f.id))})]}),!t?.fullAccess&&bs!==1/0&&bs<=0&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"Â­Æ’Ã¶Ã†"}),e.jsx("div",{className:"font-semibold",children:"Online play locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"YouÃ”Ã‡Ã–ve used your 3 free online games this week. Upgrade to PREMIUM to play all modes."}),e.jsxs("button",{onClick:async()=>{try{const j=await(await fetch(`${a}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t?.email})})).json();j.ok&&j.url?window.location.href=j.url:alert("Failed to create payment session: "+(j.error||"Unknown error"))}catch{alert("Network error")}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM = ",Fl(_l(),5)]})]})]}),is&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-2 md:p-3 flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:"Online Match"})}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>Ke(!1),children:"Close"})]}),e.jsx("div",{className:"relative flex-1 overflow-hidden p-2 md:p-3",children:e.jsxs("div",{className:"card w-full h-full overflow-hidden relative p-2.5 md:p-3",children:[tt&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-start justify-center pt-8 z-20",children:[e.jsxs("div",{className:`px-4 py-2 rounded-full text-lg font-bold shadow ${tt.kind==="leg"?"bg-indigo-500/20 border border-indigo-400/40 text-indigo-100":"bg-emerald-500/20 border border-emerald-400/40 text-emerald-100"}`,children:[tt.kind==="leg"?"Â­Æ’Ã…Ã¼ LEG WON Ã”Ã‡Ã¶ ":"Â­Æ’Ã„Â» ONE HUNDRED AND EIGHTY! Ã”Ã‡Ã¶ ",tt.by]}),tt.kind==="leg"&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:"@keyframes ndn-confetti-fall{0%{transform:translateY(-10%) rotate(0deg);opacity:1}100%{transform:translateY(120%) rotate(360deg);opacity:0}}"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(24)].map((f,j)=>{const k=Math.random()*100,L=Math.random()*.2,X=1.2+Math.random()*.8,de=6+Math.random()*6,ue=Math.floor(Math.random()*360);return e.jsx("span",{style:{position:"absolute",top:0,left:k+"%",width:de,height:de,background:`hsl(${ue} 90% 60%)`,borderRadius:2,animation:`ndn-confetti-fall ${X}s ease-out ${L}s forwards`}},j)})})]})]}),e.jsxs("div",{className:"mb-1.5 text-xs md:text-sm flex items-center justify-between gap-2",children:[e.jsxs("span",{children:["Participants: ",De.length||1]}),e.jsx("button",{className:"text-[11px] px-2 py-0.5 rounded-full bg-slate-700/50 hover:bg-slate-700 border border-slate-600",onClick:()=>hs(f=>!f),title:Gt?"Switch to full multi-player view":"Switch to compact player-by-player view",children:Gt?"Full view":"Compact view"})]}),(()=>{const f=p.players?.[0]?.legsWon||0,j=p.players?.[1]?.legsWon||0;return e.jsx(Sc,{left:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[Fe,Fe==="X01"?` / ${p.startingScore}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["Legs ",f,"â€“",j]})]}),right:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70 text-[10px]",children:"Match"}),e.jsxs("select",{className:`btn ${Le}`,value:te,onChange:k=>ce(k.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${Le} w-[7.5rem]`,value:ze,onChange:k=>Pe(k.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${Le} w-[7.5rem]`,value:Te,onChange:k=>Ee(k.target.value),placeholder:"Team B"})]})})})(),Gt?e.jsxs("div",{className:"mb-3",children:[(()=>{const f=p.currentPlayerIdx,j=p.players[f];if(!j)return null;const k=j.legs[j.legs.length-1],L=k?k.totalScoreRemaining:p.startingScore,X=t?.username&&j.name===t.username,de=k&&k.visits.length?k.visits[k.visits.length-1].score:0,ue=(()=>{let be=0,Jt=0;for(const gs of j?.legs||[])be+=gs.totalScoreStart-gs.totalScoreRemaining,Jt+=(gs.visits||[]).reduce((Hs,_e)=>Hs+(_e.darts||0)-(_e.preOpenDarts||0),0);return{pts:be,d:Jt}})(),q=ue.d>0?ue.pts/ue.d*3:0;return Fe==="X01"?e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${f===p.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${f===p.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:f===p.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-4xl font-extrabold",children:L}),e.jsxs("div",{className:"text-sm mt-1",children:["Last score: ",e.jsx("span",{className:"font-semibold",children:de})]}),e.jsxs("div",{className:"text-sm",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:q.toFixed(1)})]}),X&&f===p.currentPlayerIdx&&L<=170&&L>0&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",H,"): ",Mi(L,H).join("  Ã”Ã‡Ã³  ")||"Ã”Ã‡Ã¶"]})]}):e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${f===p.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${f===p.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:f===p.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-sm opacity-80",children:Fe}),Fe==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Gs[He]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[Ne," / ",Gs.length]})]}),Fe==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:rs[Ve]===25?"25 (Outer Bull)":rs[Ve]===50?"50 (Inner Bull)":rs[Ve]||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[We," / ",rs.length]})]}),Fe==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Treble Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:["T",et]})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[os," / ",es]})]})]})})(),p.players.length>1&&e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Next up: ",p.players[(p.currentPlayerIdx+1)%p.players.length]?.name]})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-3 flex flex-wrap items-center gap-2",children:p.players.map((f,j)=>{const k=f.legs[f.legs.length-1],L=k?k.totalScoreRemaining:p.startingScore;return e.jsxs("div",{className:`px-2 py-1 rounded bg-black/20 border border-slate-700/40 text-xs ${j===p.currentPlayerIdx?"ring-1 ring-brand-400":""}`,children:[e.jsx("span",{className:"font-semibold",children:f.name}),Fe==="X01"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:L})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:Fe==="Double Practice"?`${Ne}/${Gs.length}`:Fe==="Around the Clock"?`${We}/${rs.length}`:Fe==="Treble Practice"?`${os}/${es}`:Fe==="Cricket"?`${vs[f.id]?.points||0} pts`:Fe==="Shanghai"?`${Xt[f.id]?.score||0} pts = R${Xt[f.id]?.round||1}`:Fe==="Halve It"?`${ws[f.id]?.score||0} pts = S${(ws[f.id]?.stage||0)+1}`:Fe==="High-Low"?`${Vt[f.id]?.score||0} pts = ${Vt[f.id]?.target||"HIGH"}`:Fe==="Killer"?(()=>{const X=as[f.id];return X?`#${X.number} = ${X.lives}Ã”Ã˜Ã± ${X.isKiller?"= K":""}`:"Ã”Ã‡Ã¶"})():Fe==="American Cricket"?`${Ts[f.id]?.points||0} pts`:Fe==="Baseball"?(()=>{const X=Q[f.id];return X?`R${X.score} = I${X.inning}`:"Ã”Ã‡Ã¶"})():Fe==="Golf"?(()=>{const X=G[f.id];return X?`S${X.strokes} = H${X.hole}`:"Ã”Ã‡Ã¶"})():Fe==="Tic Tac Toe"?(()=>{const X=(O.board||[]).filter(ue=>ue==="X").length,de=(O.board||[]).filter(ue=>ue==="O").length;return`X${X}-O${de}`})():Fe})]})]},`strip-${f.id}`)})})}),Gt?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-col gap-2 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`btn ${Le}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${Le}`,onClick:Cn,children:"Manual Correction"}),!Ce&&e.jsx("button",{className:`btn ${Le}`,onClick:()=>{console.log("Sending cam-create"),r?r.send({type:"cam-create"}):D.current&&D.current.readyState===WebSocket.OPEN?D.current.send(JSON.stringify({type:"cam-create"})):s("Not connected to server",{type:"error"})},children:"Pair Phone"}),!Ce&&Qe&&e.jsxs("div",{className:"ml-2 text-sm bg-blue-900/50 p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Mobile pairing code: "}),e.jsx("span",{className:"font-mono font-bold text-lg",children:Qe})]}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["On your phone, go to: ",e.jsxs("a",{href:`/mobile-cam.html?code=${Qe}`,target:"_blank",className:"underline",children:[window.location.origin,"/mobile-cam.html?code=",Qe]})]})]}),!Ce&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[11px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam size"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>ke(Math.max(.5,Math.round((ie-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${Le} min-w-[2.5rem] text-center`,children:[Math.round(ie*100),"%"]}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>ke(Math.min(1.25,Math.round((ie+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Le}`,title:"Toggle fit/fill",onClick:()=>Ue(Be==="fill"?"fit":"fill"),children:Be==="fill"?"Fill":"Fit"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 items-start h-full",children:[e.jsx("div",{className:"order-1",children:Fe==="X01"?e.jsx(aa,{}):e.jsx(Dn,{gameMode:Fe,players:Rm(Fe,p,De),matchScore:p.players?.length===2?`${p.players[0]?.legsWon||0}-${p.players[1]?.legsWon||0}`:void 0})}),e.jsx("div",{className:"order-2 flex-1 min-h-0",children:Oe?e.jsx("div",{className:"min-w-0 relative z-10 flex-1 min-h-0 ndn-camera-tall",children:e.jsx(va,{storageKey:"ndn:camera:tile:online:top",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:520,defaultHeight:320,minWidth:280,minHeight:200,maxWidth:1600,maxHeight:900,autoFill:!0,children:e.jsx(cr,{label:"Your Board",autoStart:t?.username&&p.players[p.currentPlayerIdx]?.name===t.username,aspect:"classic",fill:!0})})}):null})]}),e.jsxs("div",{className:"font-semibold",children:["Current: ",p.players[p.currentPlayerIdx]?.name||"Ã”Ã‡Ã¶"]}),Fe==="X01"&&Oe&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs(e.Fragment,{children:[e.jsx(Je,{x01DoubleInOverride:xe,hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(f,j,k)=>{if(_){const X=p.players[p.currentPlayerIdx],de=X?.legs[X.legs.length-1],ue=de?de.totalScoreRemaining:p.startingScore;Mn(t?.username||"Player",f,Math.max(0,ue),z,{volume:T,checkoutOnly:K})}const L=p.players[p.currentPlayerIdx];t?.username&&L?.name===t.username&&In(t.username,j,f);try{f===180&&gt("180",L?.name||"Player"),k&&gt("leg",L?.name||"Player")}catch{}k||(De?.length||0)>=2&&p.nextPlayer(),it();try{if(k&&f>50||f>100){const X=p.players[p.currentPlayerIdx],de=X?.legs?.[X.legs.length-1]?.totalScoreRemaining??p.startingScore,ue={player:X?.name||t?.username||"Player",score:f,darts:j,finished:k,remainingBefore:Math.max(0,de+f),ts:Date.now()};ts(ue),Tt(!0)}}catch{}}}),ps&&Lt?e.jsx(Xs,{storageKey:"ndn:modal:highlight",className:"w-[420px]",defaultWidth:420,defaultHeight:220,minWidth:320,minHeight:160,initialFitHeight:!0,children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Save highlight"}),e.jsxs("div",{className:"text-sm mb-3",children:["Player: ",e.jsx("strong",{children:Lt.player})," â€” Score: ",e.jsx("strong",{children:Lt.score})," â€” Darts: ",e.jsx("strong",{children:Lt.darts})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>_t(),children:"Download to device"}),e.jsx("button",{className:"btn",onClick:()=>V(),children:"Save to account"}),e.jsx("button",{className:"btn btn-ghost ml-auto",onClick:()=>{Tt(!1),ts(null)},children:"Close"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-3",children:"You can download this JSON to keep a copy, or save it to your account for later access."})]})}):null,e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>nn(ne),children:"Submit Visit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{p.undoVisit(),it()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-1.5 text-xs",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(f=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>nn(f),children:f},f))]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 mb-2",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>y(!0),children:"Messages"})]})]}):Fe==="Double Practice"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Double Practice Ã”Ã‡Ã¶ Hit doubles D1Ã”Ã¥Ã†D20Ã”Ã¥Ã†DBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Gs[He]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Ne," / ",Gs.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j)=>{(j==="DOUBLE"||j==="INNER_BULL")&&hn(f)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&fn()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:fn,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (D16, 50, 25, T20)",value:rt,onChange:f=>ft(f.target.value),onKeyDown:f=>{f.key==="Enter"&&Un()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Un,children:"Add"})]})]}):Fe==="Around the Clock"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Around the Clock Ã”Ã‡Ã¶ Hit 1Ã”Ã¥Ã†20 then 25 (outer) and 50 (inner)"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:rs[Ve]===25?"25 (Outer Bull)":rs[Ve]===50?"50 (Inner Bull)":rs[Ve]||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[We," / ",rs.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{ia(f,j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&ka()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:ka,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (T20, D5, 25, 50)",value:kt,onChange:f=>$t(f.target.value),onKeyDown:f=>{f.key==="Enter"&&Ca()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Ca,children:"Add"})]})]}):Fe==="Treble Practice"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Treble Practice â€” Aim for triples only; count hits vs total darts"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Treble target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:["T",et]})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[os," / ",E>0?E:es]}),E>0&&es>=E&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:Fn,children:"Reset"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("span",{className:"opacity-70 text-xs",children:"Quick:"}),[20,19,18].map(f=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${et===f?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>zt(f),children:["T",f]},`tquick-${f}`)),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("select",{className:"input w-24 text-sm",value:et,onChange:f=>zt(parseInt(f.target.value,10)),children:Array.from({length:20},(f,j)=>j+1).map(f=>e.jsx("option",{value:f,children:f},f))}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:Fn,children:"Reset"})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{Ta(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&$n()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:$n,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (T20)",value:Yt,onChange:f=>Ft(f.target.value),onKeyDown:f=>{f.key==="Enter"&&pr()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:pr,children:"Add"})]})]}):Fe==="Cricket"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Cricket Ã”Ã‡Ã¶ Close 15-20 and Bull; overflow scores points"}),(()=>{const f=At();Sn(f);const j=vs[f]||Kn();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:Wa.map(k=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:k===25?"Bull":k}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[k]||0)," / 3"]})]},k))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:vs[At()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{la(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&(la(Math.max(0,ne|0)),Z(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{la(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="Shanghai"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();Ea(f);const j=Xt[f]||An();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Shanghai Ã”Ã‡Ã¶ Hit only the round's number; Single/Double/Triple score"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j.round})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{kn(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&(kn(Math.max(0,ne|0)),Z(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{kn(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="Halve It"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();_n(f);const j=ws[f]||Rn(),k=dr(j);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Halve It Ã”Ã‡Ã¶ Hit the target each round or your score halves"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[j.stage+1,"/",j.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const L=k;return L?L.kind==="ANY_NUMBER"?"Any":L.kind==="BULL"?"Bull":L.kind==="DOUBLE"||L.kind==="TRIPLE"||L.kind==="NUMBER"?`${L.kind} ${L.num}`:"Ã”Ã‡Ã¶":"Ã”Ã‡Ã¶"})()})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{Wn(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&(Wn(Math.max(0,ne|0)),Z(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Wn(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="High-Low"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();za(f);const j=Vt[f]||Pn();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"High-Low Ã”Ã‡Ã¶ Alternate aiming for high then low segments"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j.round})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:j.target})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{xn(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&(xn(Math.max(0,ne|0)),Z(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{xn(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="American Cricket"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"American Cricket Ã”Ã‡Ã¶ Close 12-20 and Bull; overflow scores"}),(()=>{const f=At();br(f);const j=Ts[f]||_a();return e.jsx("div",{className:"mb-2 grid grid-cols-5 gap-1 text-center text-[11px]",children:fr.map(k=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:k===25?"Bull":k}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[k]||0)," / 3"]})]},k))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:Ts[At()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{ds(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{ds(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="Baseball"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();oa(f);const j=Q[f]||Ua();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Baseball Ã”Ã‡Ã¶ Inning ",j.inning," Ã”Ã‡Ã³ Runs ",j.score]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{Ia(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Ia(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="Golf"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();gr(f);const j=G[f]||$a();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Golf Ã”Ã‡Ã¶ Hole ",j.hole," (target ",yc[j.hole],") Ã”Ã‡Ã³ Strokes ",j.strokes]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{ca(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{ca(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="Tic Tac Toe"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Tic Tac Toe Ã”Ã‡Ã¶ Tap a cell to claim by hitting its target"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(f,j)=>j).map(f=>e.jsx("button",{className:`h-12 rounded-xl border ${O.board[f]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(O.finished||O.board[f])return;const j=Fa[f],k=Number(Rs||0),L=k%3===0?"TRIPLE":k%2===0?"DOUBLE":"SINGLE",X=j.type==="BULL"?null:j.num||null;Ma(f,k,L,X),ks("")},children:O.board[f]||""},f))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Enter dart score (e.g. 20, 40, 60, 25, 50)",value:Rs,onChange:f=>ks(f.target.value),onKeyDown:f=>{if(f.key==="Enter"){const j=Array.from({length:9},(k,L)=>L).find(k=>!O.board[k]&&!O.finished);if(j!==void 0){const k=Fa[j],L=Number(Rs||0),X=L%3===0?"TRIPLE":L%2===0?"DOUBLE":"SINGLE",de=k.type==="BULL"?null:k.num||null;Ma(j,L,X,de),ks("")}}}}),e.jsx("button",{className:"btn",onClick:()=>{const f=Array.from({length:9},(j,k)=>k).find(j=>!O.board[j]&&!O.finished);if(f!==void 0){const j=Fa[f],k=Number(Rs||0),L=k%3===0?"TRIPLE":k%2===0?"DOUBLE":"SINGLE",X=j.type==="BULL"?null:j.num||null;Ma(f,k,L,X),ks("")}},children:"Claim Cell"})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{}})})]}):Fe==="Killer"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer Ã”Ã‡Ã¶ Hit your own double to become Killer; then remove othersÃ”Ã‡Ã– lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:(()=>{const f=At();return p.players.forEach(j=>Hn(j.id)),as[f]?.number||"Ã”Ã‡Ã¶"})()})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:(()=>{const f=At();return as[f]?.lives??"Ã”Ã‡Ã¶"})()})," ",(()=>{const f=At();return as[f]?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null})()]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{ns(j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&(ns("SINGLE",Math.max(0,ne|0)),Z(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{ns("SINGLE",Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-xs mb-1.5",children:[Fe," (online) Ã”Ã‡Ã¶ manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const f=Math.max(0,ne|0);p.addVisit(f,3),Z(0),p.nextPlayer(),it()},children:"Submit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{p.undoVisit(),it()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>y(!0),children:"Messages"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsx(aa,{})}),e.jsxs("div",{className:`md:col-span-${pt} space-y-1.5 relative`,children:[e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("button",{className:`btn ${Le}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${Le}`,onClick:Cn,children:"Manual Correction"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[e.jsx("span",{className:"text-xs opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>ke(Math.max(.5,Math.round((ie-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${Le} bg-transparent border-slate-600 text-center min-w-[3rem]`,children:[Math.round(ie*100),"%"]}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>ke(Math.min(1.25,Math.round((ie+.05)*100)/100)),children:"+"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>It(pt===2?3:2),title:pt===2?"Expand camera":"Shrink camera",children:pt===2?"â†”":"â†™"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Le}`,title:"Toggle fit/fill",onClick:()=>Ue(Be==="fill"?"fit":"fill"),children:Be==="fill"?"Fill":"Fit"})]})]}),e.jsxs("div",{className:"mt-2 relative flex-1 min-h-0 ndn-camera-tall",children:[e.jsx(va,{storageKey:"ndn:camera:tile:online:row",className:"relative rounded-2xl overflow-hidden bg-black w-full",defaultWidth:720,defaultHeight:400,minWidth:320,minHeight:220,maxWidth:1600,maxHeight:900,autoFill:!0,children:e.jsx(cr,{label:"Your Board",autoStart:t?.username&&p.players[p.currentPlayerIdx]?.name===t.username,aspect:"classic",fill:!0})}),pt<3&&e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-slate-600/20 hover:bg-slate-600/40 transition-colors flex items-center justify-center group",onMouseDown:f=>{f.preventDefault();const j=f.clientX,k=pt,L=de=>{de.clientX-j>50&&k===2&&It(3)},X=()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",X)};document.addEventListener("mousemove",L),document.addEventListener("mouseup",X)},children:e.jsx("div",{className:"w-0.5 h-8 bg-slate-400 group-hover:bg-slate-300 transition-colors"})})]}),e.jsxs("div",{className:"font-semibold text-sm md:text-base",children:["Current: ",p.players[p.currentPlayerIdx]?.name||"Ã”Ã‡Ã¶"]}),Fe==="X01"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs(e.Fragment,{children:[e.jsx(Je,{x01DoubleInOverride:xe,hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(f,j,k)=>{if(_){const X=p.players[p.currentPlayerIdx],de=X?.legs[X.legs.length-1],ue=de?de.totalScoreRemaining:p.startingScore;Mn(t?.username||"Player",f,Math.max(0,ue),z,{volume:T,checkoutOnly:K})}const L=p.players[p.currentPlayerIdx];t?.username&&L?.name===t.username&&In(t.username,j,f);try{f===180&&gt("180",L?.name||"Player"),k&&gt("leg",L?.name||"Player")}catch{}k?it():(De?.length||0)>=2?setTimeout(()=>{try{p.nextPlayer(),it()}catch{}},750):it()}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>nn(ne),children:"Submit Visit (Manual)"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{p.undoVisit(),it()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(f=>e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>nn(f),children:f},f))]}),(()=>{const f=p.players[p.currentPlayerIdx],j=f?.legs?.[f.legs?.length-1],k=j?j.totalScoreRemaining:p.startingScore;return k>0&&k<=170?e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",H,"): ",Mi(k,H).join("  Ã”Ã‡Ã³  ")||"Ã”Ã‡Ã¶"]}):null})()]}):Fe==="Double Practice"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Double Practice Ã”Ã‡Ã¶ Hit doubles D1Ã”Ã¥Ã†D20Ã”Ã¥Ã†DBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Gs[He]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Ne," / ",Gs.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j)=>{(j==="DOUBLE"||j==="INNER_BULL")&&hn(f)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0")),onKeyDown:f=>{f.key==="Enter"&&fn()}}),e.jsx("button",{className:"btn",onClick:fn,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:rt,onChange:f=>ft(f.target.value),onKeyDown:f=>{f.key==="Enter"&&Un()}}),e.jsx("button",{className:"btn",onClick:Un,children:"Add"})]})]}):Fe==="Cricket"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Cricket Ã”Ã‡Ã¶ Close 15-20 and Bull; overflow scores points"}),(()=>{const f=At();Sn(f);const j=vs[f]||Kn();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:Wa.map(k=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:k===25?"Bull":k}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[k]||0)," / 3"]})]},k))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:vs[At()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{la(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{la(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="Shanghai"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();Ea(f);const j=Xt[f]||An();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["Shanghai Ã”Ã‡Ã¶ Round ",j.round," Ã”Ã‡Ã³ Score ",j.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{kn(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{kn(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="Halve It"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();_n(f);const j=ws[f]||Rn(),k=dr(j);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm mb-2",children:["Halve It Ã”Ã‡Ã¶ Stage ",j.stage+1,"/",j.targets.length," Ã”Ã‡Ã³ Score ",j.score]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const L=k;return L?L.kind==="ANY_NUMBER"?"Any":L.kind==="BULL"?"Bull":L.kind==="DOUBLE"||L.kind==="TRIPLE"||L.kind==="NUMBER"?`${L.kind} ${L.num}`:"Ã”Ã‡Ã¶":"Ã”Ã‡Ã¶"})()})]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{Wn(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Wn(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="High-Low"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();za(f);const j=Vt[f]||Pn();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["High-Low Ã”Ã‡Ã¶ Round ",j.round," Ã”Ã‡Ã³ Target ",j.target," Ã”Ã‡Ã³ Score ",j.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{xn(f,j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{xn(Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]})]}):Fe==="Killer"&&t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const f=At();p.players.forEach(k=>Hn(k.id));const j=as[f];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer Ã”Ã‡Ã¶ Hit your own double to become Killer; then remove othersÃ”Ã‡Ã– lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j?.number||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:j?.lives??"Ã”Ã‡Ã¶"})," ",j?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 gap-1 text-[11px]",children:p.players.map(k=>{const L=as[k.id];return e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80 truncate",children:k.name}),e.jsx("span",{className:"font-mono",children:L?`#${L.number} = ${L.lives}Ã”Ã˜Ã±${L.isKiller?" = K":""}`:"Ã”Ã‡Ã¶"})]},k.id)})})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 my-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(f,j,k)=>{ns(j==="MISS"?void 0:j,k?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{ns("SINGLE",Math.max(0,ne|0)),Z(0)},children:"Add Dart"})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Tip: Only doubles/triples on the opponentsÃ”Ã‡Ã– numbers remove lives. To become Killer, hit your own double."})]}):t?.username&&p.players[p.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-sm mb-2",children:[Fe," (online) Ã”Ã‡Ã¶ manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ne,onChange:f=>Z(parseInt(f.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const f=Math.max(0,ne|0);p.addVisit(f,3),Z(0),p.nextPlayer(),it()},children:"Submit"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{p.undoVisit(),it()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>y(!0),children:"Messages"})]})})]})]})})]})]}),en&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50",children:e.jsx("div",{className:"w-full h-full flex items-stretch justify-stretch p-0",children:e.jsxs(Xs,{storageKey:"ndn:modal:create-match",className:"w-full h-full rounded-none !border-0 !shadow-none relative",fullScreen:!0,children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-slate-900/80 backdrop-blur border-b border-slate-700 z-10 px-2 py-2",children:e.jsx("h3",{className:"text-xl font-bold",children:"Create Match"})}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 overflow-auto px-2",style:{maxHeight:"calc(100vh - 120px)"},children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:Wt,onChange:f=>jn(f.target.value),children:ja.map(f=>e.jsxs("option",{value:f,disabled:!t?.fullAccess&&bn.includes(f),children:[f," ",!t?.fullAccess&&bn.includes(f)?"(PREMIUM)":""]},f))}),e.jsx("div",{className:"mt-2",children:e.jsx(oc,{gameMode:Wt,compact:!0})})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:Ds,onChange:f=>Is(f.target.value),children:[e.jsx("option",{value:"bestof",children:"Best Of"}),e.jsx("option",{value:"firstto",children:"First To"})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Value"}),Wt==="X01"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:[101,201,301,401,501].map(f=>e.jsx("button",{className:`btn px-2 py-1 text-xs ${Ye===f?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>jt(f),children:f},f))}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:Ye,onChange:f=>jt(parseInt(f.target.value||"1")),placeholder:"Or enter custom value"})]}):e.jsx("input",{className:"input w-full",type:"number",min:1,value:Ye,onChange:f=>jt(parseInt(f.target.value||"1"))}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Example: Best Of 5 â€” first to 3"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Starting Score"}),Wt==="X01"?e.jsx("select",{className:"input w-full",value:st,onChange:f=>Bt(parseInt(f.target.value||"501")),children:[301,501,701].map(f=>e.jsx("option",{value:f,children:f},f))}):e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Starting score applies to X01 only"})]}),Wt==="X01"&&e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"X01 Rules"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"create-x01di",type:"checkbox",className:"accent-purple-500",checked:!!Fs,onChange:f=>ea(f.target.checked)}),e.jsx("label",{htmlFor:"create-x01di",className:"text-sm opacity-80",children:"Require Double-In"})]})]}),Wt==="Treble Practice"&&e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Throws per game"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[[9,12,18,30,60].map(f=>e.jsx("button",{className:`btn px-2 py-1 text-xs ${sn===f?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>Ns(f),children:f},f)),e.jsx("button",{className:`btn px-2 py-1 text-xs ${sn===0?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>Ns(0),title:"Unlimited",children:"âˆž"})]}),e.jsx("input",{className:"input w-full",type:"number",min:0,placeholder:"0 = unlimited",value:sn,onChange:f=>Ns(Math.max(0,parseInt(f.target.value||"0")))})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Require Calibration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"calibreq",type:"checkbox",className:"accent-purple-500",checked:qs,onChange:f=>$s(f.target.checked)}),e.jsx("label",{htmlFor:"calibreq",className:"text-sm opacity-80",children:"Players must be calibrated"})]})]}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 border border-slate-700/40",children:[e.jsx("div",{className:"text-xs text-slate-300 uppercase tracking-wide mb-1",children:"Summary"}),e.jsxs("div",{className:"text-sm font-semibold",children:[Wt," â€” ",Ds==="bestof"?`Best Of ${Ye}`:`First To ${Ye}`," ",Wt==="X01"?`â€” ${st}`:""]}),Wt==="X01"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Double-In: ",Fs?"On":"Off"]}),Wt==="Treble Practice"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Throws per game: ",sn||"Unlimited"]}),!t?.fullAccess&&bn.includes(Wt)&&e.jsx("div",{className:"text-xs text-rose-300 mt-1",children:"PREMIUM required"})]})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-900/80 backdrop-blur border-t border-slate-700 z-10 px-2 py-2",children:[e.jsx("button",{className:"btn w-full",disabled:!t?.fullAccess&&bn.includes(Wt),title:!t?.fullAccess&&bn.includes(Wt)?"PREMIUM game":"",onClick:()=>{const f=t?.username?ln(t.username):0;Wt==="Treble Practice"&&ae(Math.max(0,sn|0)),Wt==="X01"&&$e(!!Fs);const j={type:"create-match",game:Wt,mode:Ds,value:Ye,startingScore:st,creatorAvg:f,requireCalibration:qs};Wt==="Treble Practice"&&(j.trebleMaxDarts=Math.max(0,sn|0)),Wt==="X01"&&(j.x01DoubleIn=!!Fs),r?(r.send(j),Qt(!1),r.send({type:"list-matches"})):(D.current?.send(JSON.stringify(j)),Qt(!1),D.current?.send(JSON.stringify({type:"list-matches"})))},children:"START GAME!"}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Qt(!1),children:"Close"})})]})]})})}),Ze&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(Xs,{storageKey:"ndn:modal:invite",className:"w-full relative",defaultWidth:620,defaultHeight:420,minWidth:520,minHeight:320,maxWidth:1e3,maxHeight:800,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-bold mb-1",children:"Incoming Match Request"}),e.jsxs("div",{className:"text-sm mb-2",children:[e.jsx("span",{className:"font-semibold",children:Ze.fromName})," wants to join your match.",e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${Ze.calibrated?"bg-emerald-500/20 text-emerald-300 border border-emerald-600/30":"bg-amber-500/20 text-amber-200 border border-amber-600/30"}`,children:Ze.calibrated?"Calibrated":"Not calibrated"})]}),(Ze.game||Ze.mode)&&e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[Ze.game||"X01"," Ã”Ã‡Ã³ ",Ze.mode==="firstto"?`First To ${Ze.value}`:`Best Of ${Ze.value}`," ",Ze.game==="X01"&&Ze.startingScore?`Ã”Ã‡Ã³ ${Ze.startingScore}`:""]}),fs&&e.jsx(sh,{open:fs,onClose:()=>Zs(!1),title:"Match Summary",players:p.players||[],doublesStats:Ot,centerScore:(()=>{const f=p.players||[];return f.length===2?`${f[0]?.legsWon||0} â€“ ${f[1]?.legsWon||0}`:""})()}),Ze.boardPreview?e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:Ze.boardPreview,alt:"Board preview",className:"rounded-lg w-full max-h-64 object-contain bg-black/40 border border-slate-700"})}):e.jsx("div",{className:"mb-3 text-xs opacity-60",children:"No camera preview provided."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{r?r.send({type:"invite-response",matchId:Ze.matchId,accept:!0,toId:Ze.fromId}):D.current?.send(JSON.stringify({type:"invite-response",matchId:Ze.matchId,accept:!0,toId:Ze.fromId})),Zt(null)},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>{r?r.send({type:"invite-response",matchId:Ze.matchId,accept:!1,toId:Ze.fromId}):D.current?.send(JSON.stringify({type:"invite-response",matchId:Ze.matchId,accept:!1,toId:Ze.fromId})),Zt(null)},children:"Decline"})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(Xs,{storageKey:"ndn:modal:quick-chat",className:"w-full relative",defaultWidth:520,defaultHeight:280,minWidth:360,minHeight:220,maxWidth:900,maxHeight:700,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>x(!1),children:"Close"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["Good luck!","Good game!","Nice darts!","Well played!","Ready?"].map(f=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{ra(f),x(!1)},disabled:!o,children:f},f))})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(Xs,{storageKey:"ndn:modal:messages",className:"w-full relative",defaultWidth:560,defaultHeight:360,minWidth:380,minHeight:260,maxWidth:1e3,maxHeight:800,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>y(!1),children:"Close"})]}),e.jsx(ih,{items:c.slice(-30).filter(f=>!n.isBlocked(String(f.fromId||""))).map((f,j)=>({key:String(j),from:f.from,id:String(f.fromId||f.from),text:f.message})),onDelete:f=>h(j=>j.filter((k,L)=>L!==f)),onReport:f=>{const k=c.slice(-30).filter(L=>!n.isBlocked(String(L.fromId||"")))[f];k&&qn(null,k.message)},onBlock:f=>{const k=c.slice(-30).filter(L=>!n.isBlocked(String(L.fromId||"")))[f];if(k){try{n.block(String(k.fromId||k.from))}catch{}h(L=>L.filter(X=>String(X.fromId||X.from)!==String(k.fromId||k.from)));try{s(`${k.from} blocked`,{type:"info"})}catch{}}}})]})})]})]})}function ih({items:t,onDelete:a,onReport:s,onBlock:r}){const n=(()=>{try{const c=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(c)}catch{return!1}})(),[i,l]=u.useState(null),[o,d]=u.useState(null);return e.jsx("div",{className:"h-24 overflow-auto text-sm divide-y divide-slate-700/40",children:t.length===0?e.jsx("div",{className:"opacity-60 py-1",children:"No messages yet."}):t.map((c,h)=>{const m=Ec(c.text),x=_m(c.text);return e.jsxs("div",{className:"relative group px-1 py-1 flex items-start gap-2",onTouchStart:n?b=>{const y=b.touches[0];l({x:y.clientX,y:y.clientY,i:h,t:Date.now()})}:void 0,onTouchMove:n?b=>{if(!i||i.i!==h)return;b.touches[0].clientX-i.x<-40&&d(h)}:void 0,onTouchEnd:n?()=>{const b=i?Date.now()-i.t:0;(o===h||b>600)&&(a(h),d(null)),l(null)}:void 0,children:[e.jsxs("span",{className:"text-slate-400 shrink-0",children:["[",c.from,"]"]}),e.jsx("span",{className:"text-white break-words whitespace-pre-wrap flex-1",children:m}),!n&&e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 ml-2",children:[e.jsx("button",{className:"w-5 h-5 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center",title:"Delete message","aria-label":"Delete message",onClick:()=>a(h),children:"â”œÃ¹"}),r&&e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-slate-700 hover:bg-slate-800 text-slate-100 text-[11px]",onClick:()=>r(h),title:"Block sender",children:"Block"}),e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-amber-600/40 hover:bg-amber-600/60 text-amber-100 text-[11px]",onClick:()=>s(h),title:"Report message",children:"Report"})]}),x&&e.jsx("span",{className:"ml-2 text-[10px] px-1 rounded bg-rose-600/30 text-rose-200 border border-rose-600/40",children:"Filtered"})]},c.key)})})}function oh({user:t}){const{players:a,inProgress:s,startingScore:r,newMatch:n}=ya(),[i,l]=u.useState("x01"),[o,d]=u.useState("Player 1, Player 2"),[c,h]=u.useState(501),[m,x]=u.useState(""),[b,y]=u.useState([]),[N,C]=u.useState(""),[w,D]=u.useState(!1),[I,M]=u.useState(""),[R,A]=u.useState([]),[v,p]=u.useState(!1),F=String(t?.email||"").toLowerCase();u.useEffect(()=>{let T=!1;async function K(){try{if(!F)return;const ke=await(await fetch(`/api/friends/list?email=${encodeURIComponent(F)}`)).json().catch(()=>({friends:[]}));T||y(ke.friends||[])}catch{}}K();const ee=setInterval(K,2e4);return()=>{T=!0,clearInterval(ee)}},[F]),u.useEffect(()=>{try{const T=F?`ndn:stats:opponent:${F}`:"ndn:stats:opponent",K=localStorage.getItem(T);K&&C(K)}catch{}},[F]),u.useEffect(()=>{try{const T=F?`ndn:stats:opponent:${F}`:"ndn:stats:opponent";N?localStorage.setItem(T,N):localStorage.removeItem(T)}catch{}},[N,F]);async function H(T){if(M(T),!T.trim()){A([]);return}p(!0);try{const ee=await(await fetch(`/api/friends/search?q=${encodeURIComponent(T)}`)).json().catch(()=>({results:[]}));A(ee.results||[])}finally{p(!1)}}const _=u.useMemo(()=>{const T=new Map;if(i==="x01")for(const ee of a)for(const ie of ee.legs)for(const ke of ie.visits){const Be=Math.max(0,Math.min(180,ke.score));T.set(Be,(T.get(Be)??0)+1)}const K=Array.from(T.entries()).sort((ee,ie)=>ee[0]-ie[0]);return K.length===0&&i==="x01"?([0,26,41,60,81,100,120,140,160,180].forEach(ee=>T.set(ee,0)),Array.from(T.entries()).sort((ee,ie)=>ee[0]-ie[0]).map(([ee,ie])=>({label:ee,value:ie}))):K.map(([ee,ie])=>({label:ee,value:ie}))},[a,i]),z=u.useMemo(()=>{const T=Ji(ja);return ja.map(K=>{const ee=T[K]||{played:0,won:0};return{label:K,value:ee.played,extra:ee.won}})},[i]);return u.useEffect(()=>{const T=()=>l(K=>K);return window.addEventListener("ndn:stats-updated",T),()=>window.removeEventListener("ndn:stats-updated",T)},[]),e.jsxs("div",{className:"card ndn-game-shell",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-2xl font-extrabold text-white",children:"Match Stats"}),e.jsx("span",{className:"text-xs opacity-70",children:"View"})]}),e.jsx(xr,{tabs:[{key:"x01",label:"X01"},{key:"other",label:"Other Modes"}],active:i,onChange:T=>l(T)})]}),s&&e.jsx("div",{className:"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200",children:"Note: Detailed leg stats are finalized at the end of the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.map((T,K)=>e.jsxs("div",{className:"p-4 rounded-2xl border border-indigo-500/20 bg-gradient-to-br from-indigo-700/6 to-indigo-900/6 shadow-sm transform transition-transform duration-200 hover:-translate-y-1 hover:shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:K===1&&!N?T.name||"Opponent":K===1&&N?N:T.name}),K===1&&e.jsxs("div",{className:"flex gap-2 items-center overflow-x-auto py-1",children:[e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10",onClick:()=>D(ee=>!ee),title:"Search user to compare",children:"Select Friend"}),b.slice(0,6).map(ee=>{const ie=ee.username||ee.email,ke=N===ie;return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${ke?"bg-indigo-500/30 border-indigo-400/50":"bg-white/6 border-white/8 hover:bg-white/10 transform hover:-translate-y-0.5 transition-all duration-150"}`,onClick:()=>C(ie),title:`Compare vs ${ie}`,children:ie},ee.email)}),b.length===0&&e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10",disabled:!0,children:"Find friends to compare"})]})]}),K===1&&w&&e.jsxs("div",{className:"mb-2 p-2 rounded-lg bg-black/20 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1 py-1",placeholder:"Search by name or email",value:I,onChange:ee=>H(ee.target.value)}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>H(I),disabled:v,children:"Search"})]}),e.jsxs("ul",{className:"max-h-40 overflow-auto space-y-1",children:[R.map(ee=>{const ie=ee.username||ee.email;return e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm",onClick:()=>{C(ie),D(!1)},children:ie})},ee.email)}),!R.length&&e.jsx("li",{className:"text-xs opacity-70",children:I.trim()?"No results":"Type to searchâ€¦"})]})]}),K===1&&N?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:Dt(Ws(N).best3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:Dt(Ws(N).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const ee=Ws(N);return ee.bestLegDarts?`${ee.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:Ws(N).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",Dt(ln(N))," Â· ",Dt($r(N))]}),e.jsxs("span",{children:["First 9: ",Dt(Ur(N))," Â· ",Dt(Fr(N))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const ee=Ws(N);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",Dt(ee.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",Dt(ee.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",ee.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",ee.bestCheckout||0]})]})})()]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:Dt(T.bestThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:Dt(T.worstThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:T.bestNineDart?`${T.bestNineDart.darts} darts`:"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:T.bestCheckout??"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",Dt(ln(T.name))," Â· ",Dt($r(T.name))]}),e.jsxs("span",{children:["First 9: ",Dt(Ur(T.name))," Â· ",Dt(Fr(T.name))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const ee=Ws(T.name);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",Dt(ee.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",Dt(ee.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",ee.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",ee.bestCheckout||0]})]})})()]})]})]},T.id)),a.length<=1&&e.jsxs("div",{className:"p-3 rounded-2xl border border-purple-500/20 bg-gradient-to-r from-purple-800/6 to-pink-800/6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Opponent"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.slice(0,6).map(T=>{const K=T.username||T.email,ee=N===(T.username||T.email);return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${ee?"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-transparent shadow-sm":"bg-gradient-to-r from-purple-500/8 to-pink-500/8 border-white/10 hover:from-purple-500/12 hover:to-pink-500/12"}`,onClick:()=>C(K),title:`Compare vs ${K}`,children:K},T.email)}),b.length===0&&e.jsx("span",{className:"text-xs opacity-70",children:"Add friends to compare stats."})]})]}),N?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Comparing to"}),e.jsx("div",{className:"font-semibold",children:N})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:Dt(ln(N))})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:Dt(Ws(N).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const T=Ws(N);return T.bestLegDarts?`${T.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:Ws(N).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",Dt(ln(N))," Â· ",Dt($r(N))]}),e.jsxs("span",{children:["First 9: ",Dt(Ur(N))," Â· ",Dt(Fr(N))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const T=Ws(N);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",Dt(T.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",Dt(T.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",T.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",T.bestCheckout||0]})]})})()]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Select a friend above to compare."})]})]}),i!=="other"?e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Score Distribution (",i.toUpperCase(),"): Visits by scored points"]}),e.jsx("div",{className:"rounded-xl border border-indigo-500/20 p-3 min-h-[220px] transform transition-shadow duration-200 hover:shadow-lg overflow-y-auto",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)",scrollbarColor:"#8F43EE #18122B"},children:e.jsx(Dc,{data:_,showValues:!1})})]}):m&&z.find(T=>T.label===m)?e.jsx("div",{className:"mt-6",children:(()=>{const T=z.find(K=>K.label===m);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Game Stats for ",T.label]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Games Played"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:T.value})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Games Won"}),e.jsx("div",{className:"text-3xl font-bold text-green-400",children:T.extra})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Win Rate"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[T.value>0?(T.extra/T.value*100).toFixed(1):0,"%"]})]})]})]})})()}):null,i==="other"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Other Modes: Click a game to view stats"}),e.jsx("div",{className:"rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar flex-wrap",children:z.map(T=>e.jsx("button",{onClick:()=>x(T.label),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] ${m===T.label?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gradient-to-r from-slate-700 to-slate-600 text-white hover:from-slate-600 hover:to-slate-500"}`,children:T.label},T.label))})]}),!m&&e.jsx("div",{className:"rounded-xl border border-indigo-500/20 p-4",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)"},children:e.jsx("div",{className:"text-center text-slate-300",children:"Select a game mode above to view detailed stats"})})]})]})}function lh({user:t}){const a=Na(),s=(()=>{try{return Sa()}catch{return null}})(),{matchType:r="singles",setMatchType:n,teamAName:i="Team A",setTeamAName:l,teamBName:o="Team B",setTeamBName:d}=qt(),[c,h]=u.useState([]),[m,x]=u.useState(!1),[b,y]=u.useState(""),[N,C]=u.useState(null),[w,D]=u.useState(!1),[I,M]=u.useState({open:!1,t:null}),[R,A]=u.useState({open:!1,t:null}),[v,p]=u.useState({title:"Community X01 Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:15,capacity:8,startingScore:501,requireCalibration:!1}),F=(()=>{try{return"ontouchstart"in window||(navigator.maxTouchPoints||0)>0}catch{return!1}})();async function H(){try{const te=await(await Kt("/api/tournaments")).json();h(Array.isArray(te.tournaments)?te.tournaments:[])}catch{}}u.useEffect(()=>{H()},[]),u.useEffect(()=>{if(!s)return;const $=s.addListener(te=>{try{te.type==="tournaments"&&h(te.tournaments||[]),te.type==="tournament-win"&&te.message&&a(te.message,{type:"success",timeout:1e4})}catch{}});return()=>{$()}},[s?.connected]);const _=String(t?.email||"").toLowerCase(),z=()=>e.jsxs("div",{className:"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Default match"}),e.jsx("span",{className:"btn py-1 px-2 bg-indigo-500/30 border border-indigo-400/50 text-indigo-100",children:"Singles"}),e.jsx("span",{className:"text-xs opacity-60 ml-2",children:"(tournaments use Singles only)"})]});u.useEffect(()=>{let $=!1;async function te(){if(!_){C(null);return}try{const ze=await(await Kt(`/api/subscription?email=${encodeURIComponent(_)}`)).json();$||(ze?.source==="tournament"&&typeof ze.expiresAt=="number"&&ze.expiresAt>Date.now()?C(ze.expiresAt):C(null))}catch{$||C(null)}}return te(),()=>{$=!0}},[_]);function T($){return!!$.participants?.some(te=>te.email===_)}async function K($){_&&A({open:!0,t:$})}async function ee(){const $=R.t;if(!(!$||!_)){A({open:!1,t:null}),x(!0);try{let te=await Kt("/api/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:$.id,requesterEmail:_})});if(!te.ok&&te.status===403&&String(_)==="daviesfamily108@gmail.com"&&(te=await Kt("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:$.id,requesterEmail:_})})),!te.ok){let ce="Delete failed";try{const ze=await te.json();ze?.error&&(ce=`Delete failed: ${String(ze.error)}`)}catch{}a(ce,{type:"error"});return}a("Tournament deleted",{type:"success"}),await H()}finally{x(!1)}}}async function ie($){if(_){x(!0);try{const te=await Kt("/api/tournaments/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:$.id,email:_,username:t?.username})});if(!te.ok){let ce={};try{ce=await te.json()}catch{}ce?.error==="WINNER_COOLDOWN"&&typeof ce.until=="number"?(y(`You're a recent NDN tournament winner. You can re-enter after ${Re(ce.until)}.`),setTimeout(()=>y(""),6e3),a("Join blocked: winner cooldown active",{type:"error"})):ce?.error==="ALREADY_IN_TOURNAMENT"?(y(String(ce.message||"You can only join one tournament at a time.")),setTimeout(()=>y(""),6e3),a("Join blocked: already in another tournament",{type:"error"})):ce?.error&&(y(String(ce.error)),setTimeout(()=>y(""),3500),a(`Join failed: ${String(ce.error)}`,{type:"error"}));return}a("Joined tournament",{type:"success"}),await H()}finally{x(!1)}}}async function ke($){if(_){x(!0);try{const te=await Kt("/api/tournaments/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:$.id,email:_})});if(!te.ok){let ce={};try{ce=await te.json()}catch{}ce?.error?a(`Leave failed: ${String(ce.error)}`,{type:"error"}):te.status===404?a("Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.",{type:"error"}):a("Leave failed. Please try again.",{type:"error"});return}a("Left tournament",{type:"success"}),h(ce=>ce.map(ze=>ze.id===$.id?{...ze,participants:(ze.participants||[]).filter(Pe=>Pe.email!==_)}:ze)),await H()}finally{x(!1)}}}async function Be(){x(!0);try{const $=new Date(v.startAt).getTime();await Kt("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:v.title,game:v.game,mode:v.mode,value:Number(v.value),description:v.description,startAt:$,checkinMinutes:Number(v.checkinMinutes),capacity:Number(v.capacity),startingScore:v.game==="X01"?Number(v.startingScore||501):void 0,requireCalibration:!!v.requireCalibration,creatorEmail:t?.email,creatorName:t?.username})}),D(!1),a("Tournament created",{type:"success"}),await H()}finally{x(!1)}}u.useEffect(()=>{if(!w)return;const $=te=>{te.key==="Escape"&&D(!1)};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[w]);const Ue=u.useMemo(()=>c.filter($=>$.official),[c]),Oe=u.useMemo(()=>c.filter($=>!$.official),[c]),je=u.useMemo(()=>Ue.filter(te=>te.status==="scheduled").sort((te,ce)=>te.startAt-ce.startAt)[0]||null,[Ue]);function Re($){return new Date($).toLocaleString()}return e.jsxs("div",{className:"card ndn-game-shell",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Tournaments"})}),e.jsxs("div",{className:"ndn-shell-body",children:[e.jsxs("div",{className:"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(z,{})}),e.jsx("div",{className:"shrink-0",children:e.jsx("button",{className:"btn",onClick:()=>D(!0),children:"Create Tournament +"})})]}),e.jsx("div",{className:"mb-2 text-sm font-semibold text-slate-300",children:"World Lobby"}),je&&e.jsx("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm uppercase tracking-wide text-indigo-300 font-semibold",children:"Weekly Official Tournament"}),e.jsx("div",{className:"font-bold",children:je.title}),e.jsxs("div",{className:"text-sm opacity-80",children:[je.game,je.game==="X01"&&je.startingScore?`/${je.startingScore}`:""," Â· ",je.mode==="firstto"?"First to":"Best of"," ",je.value," Â· Starts ",Re(je.startAt)," Â· Cap ",je.capacity," Â· Joined ",je.participants.length]}),je.prize&&e.jsxs("div",{className:"text-xs mt-1",children:["Prize: ",je.prizeType==="cash"&&je.prizeAmount?`${je.currency||"USD"} ${je.prizeAmount}`:"3 months PREMIUM"]}),je.status!=="scheduled"&&e.jsxs("div",{className:"text-xs",children:["Status: ",je.status]}),N&&N>Date.now()&&e.jsxs("div",{className:"text-xs text-rose-300",children:["Recent winners can re-enter after ",Re(N),"."]})]}),e.jsx("div",{className:"shrink-0",children:e.jsx("button",{className:`btn ${T(je)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:T(je)?"Double-click to leave this tournament":je.official&&N&&N>Date.now()?`Recent winners can re-enter after ${Re(N)}`:"",disabled:m||je.status!=="scheduled"||!T(je)&&(je.participants.length>=je.capacity||!!N&&N>Date.now()),onClick:()=>{T(je)?F&&M({open:!0,t:je}):ie(je)},onDoubleClick:()=>{!F&&T(je)&&M({open:!0,t:je})},"aria-label":T(je)?"Already Joined":"Join Now",children:T(je)?"Already Joined!":"Join Now"})})]})}),b&&e.jsx("div",{className:"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm",children:b}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("section",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Official"}),e.jsx("div",{className:"text-xs opacity-70 mb-2",children:N&&N>Date.now()?e.jsxs(e.Fragment,{children:["Youâ€™re a recent NDN tournament winner â€” to keep it fair, you can re-enter after ",Re(N),"."]}):e.jsx(e.Fragment,{children:"Note: Weekly winners can re-enter once their 3 months of PREMIUM ends."})}),e.jsxs("ul",{className:"space-y-2",children:[Ue.map($=>e.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"font-semibold",children:[$.title," ",$.prize&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 align-middle",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-amber-500 text-black",children:"Prize"}),e.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help",title:$.prizeType==="cash"?"Official cash prize tournament â€” payout handled by admin.":"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.","aria-label":"Prize info",children:"i"})]})]}),e.jsxs("div",{className:"text-sm opacity-80",children:[$.game,$.game==="X01"&&$.startingScore?`/${$.startingScore}`:""," Â· ",$.mode==="firstto"?"First to":"Best of"," ",$.value," Â· ",Re($.startAt)," Â· Cap ",$.capacity," Â· Joined ",$.participants.length]}),$.prize&&e.jsxs("div",{className:"text-xs",children:["Prize: ",$.prizeType==="cash"&&$.prizeAmount?`${$.currency||"USD"} ${$.prizeAmount}`:"3 months PREMIUM",$.status==="completed"&&$.prizeType==="cash"&&$.payoutStatus&&e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded ${$.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:$.payoutStatus==="paid"?"Paid":"Pending"})]}),$.status!=="scheduled"&&e.jsxs("div",{className:"text-xs",children:["Status: ",$.status]}),T($)&&e.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"}),$.official&&N&&N>Date.now()&&e.jsxs("div",{className:"text-xs text-rose-300",children:["Cooldown active until ",Re(N),"."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`btn ${T($)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:T($)?"Double-click to leave this tournament":$.official&&N&&N>Date.now()?`Recent winners can re-enter after ${Re(N)}`:"",disabled:m||$.status!=="scheduled"||!T($)&&($.participants.length>=$.capacity||$.official&&!!N&&N>Date.now()),onClick:()=>{T($)?F&&M({open:!0,t:$}):ie($)},onDoubleClick:()=>{!F&&T($)&&M({open:!0,t:$})},"aria-label":T($)?"Already Joined":"Join Now",children:T($)?"Already Joined!":"Join Now"}),$.status==="scheduled"&&_&&$.creatorEmail&&String($.creatorEmail).toLowerCase()===_&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>K($),"aria-label":"Delete tournament",children:"Ã—"})]})]},$.id)),Ue.length===0&&e.jsx("li",{className:"text-sm opacity-60",children:"No official tournaments yet."})]})]}),e.jsxs("section",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Community"}),e.jsxs("ul",{className:"space-y-2",children:[Oe.map($=>e.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-semibold",children:$.title}),e.jsxs("div",{className:"text-sm opacity-80",children:[$.game,$.game==="X01"&&$.startingScore?`/${$.startingScore}`:""," Â· ",$.mode==="firstto"?"First to":"Best of"," ",$.value," Â· ",Re($.startAt)," Â· Cap ",$.capacity," Â· Joined ",$.participants.length]}),$.description&&e.jsx("div",{className:"text-xs opacity-80",children:$.description}),T($)&&e.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",title:T($)?"Double-click to leave this tournament":"",disabled:m||$.status!=="scheduled"||!T($)&&$.participants.length>=$.capacity,onClick:()=>{T($)?F&&M({open:!0,t:$}):ie($)},onDoubleClick:()=>{!F&&T($)&&M({open:!0,t:$})},children:T($)?"Already Joined":"Join Now"}),$.status==="scheduled"&&_&&$.creatorEmail&&String($.creatorEmail).toLowerCase()===_&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>K($),"aria-label":"Delete tournament",children:"Ã—"})]})]},$.id)),Oe.length===0&&e.jsx("li",{className:"text-sm opacity-60",children:"No community tournaments yet."})]})]})]}),w&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"card relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Create Tournament"}),e.jsx("button",{className:"btn",onClick:()=>D(!1),children:"Close"})]}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 pr-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Title"}),e.jsx("input",{className:"input w-full",value:v.title,onChange:$=>p(te=>({...te,title:$.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:v.game,onChange:$=>p(te=>({...te,game:$.target.value})),children:["X01","Cricket","Killer"].map($=>e.jsx("option",{value:$,children:$},$))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:v.mode,onChange:$=>p(te=>({...te,mode:$.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Number"}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:v.value,onChange:$=>p(te=>({...te,value:Number($.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Description"}),e.jsx("textarea",{className:"input w-full",rows:5,value:v.description,onChange:$=>p(te=>({...te,description:$.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Start time"}),e.jsx("input",{className:"input w-full",type:"datetime-local",value:v.startAt,onChange:$=>p(te=>({...te,startAt:$.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Check-in reminder (min)"}),e.jsx("input",{className:"input w-full",type:"number",min:0,value:v.checkinMinutes,onChange:$=>p(te=>({...te,checkinMinutes:Number($.target.value)}))})]})]}),v.game==="X01"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"X01 Starting Score"}),e.jsx("select",{className:"input w-full",value:String(v.startingScore),onChange:$=>p(te=>({...te,startingScore:Number($.target.value)})),children:[301,501,701].map($=>e.jsx("option",{value:$,children:$},$))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"accent-purple-500",checked:!!v.requireCalibration,onChange:$=>p(te=>({...te,requireCalibration:!!$.target.checked}))}),e.jsx("span",{className:"font-semibold",children:"Require calibration"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"If checked, players must have a calibrated board to join matches spawned from this tournament."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Capacity"}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,value:v.capacity,onChange:$=>p(te=>({...te,capacity:Number($.target.value)}))})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Note: community tournaments do not award prizes."}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn",disabled:m,onClick:Be,children:"Create"})})]})]})}),I.open&&I.t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>M({open:!1,t:null})}),e.jsxs("div",{className:"relative card p-4 w-[360px] max-w-[90vw]",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Leave tournament?"}),e.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Are you sure you want to remove yourself from â€œ",I.t.title,"â€?"]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>M({open:!1,t:null}),children:"Decline"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const $=I.t;M({open:!1,t:null}),await ke($)},children:"Accept"})]})]})]}),R.open&&R.t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold mb-4 text-white",children:"Delete Tournament"}),e.jsxs("div",{className:"text-slate-300 mb-6",children:["Are you sure you want to delete ",e.jsxs("span",{className:"font-semibold text-white",children:['"',R.t.title,'"']}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-sm text-slate-400",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",onClick:()=>A({open:!1,t:null}),children:"Decline"}),e.jsx("button",{className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",onClick:ee,children:"Continue"})]})]})})})]})]})}function ch({user:t}){const[a,s]=u.useState(null),[r,n]=u.useState(!0),[i,l]=u.useState(null),o="http://localhost:8787",d=Na();if(u.useEffect(()=>{(async()=>{try{const m=t?.email?`?email=${encodeURIComponent(t.email)}`:"",x=await fetch(`${o}/api/subscription`+m);if(!x.ok)throw new Error("Failed to fetch subscription");const b=await x.json();s(b)}catch(m){l(m instanceof Error?m.message:"Something went wrong")}finally{n(!1)}})()},[t?.email]),r)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-4"}),e.jsx("p",{children:"Loading subscription..."})]})});if(i)return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-300 mb-2",children:"Subscription Error"}),e.jsx("p",{className:"mb-4 text-red-200",children:i}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn bg-red-600 hover:bg-red-700",children:"Retry"})]});const c=a?.fullAccess;return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-300 mb-2",children:c?"PREMIUM Active":"PREMIUM"}),c?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 text-green-300 font-semibold mb-2",children:"âœ… PREMIUM Access Active"}),e.jsx("p",{className:"text-green-200 text-sm",children:"You have full access to all premium features!"}),a?.source&&e.jsxs("p",{className:"text-green-200 text-xs mt-1",children:["Source: ",a.source,a?.expiresAt&&` (expires: ${new Date(a.expiresAt).toLocaleDateString()})`]})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-indigo-200",children:"Your Benefits:"})]}):e.jsx("p",{className:"mb-2 text-indigo-200",children:"Unlock every game mode known to darts, advanced stats, and premium features."}),e.jsxs("ul",{className:"mb-4",children:[e.jsx("li",{children:"All game modes (including paid/advanced)"}),e.jsx("li",{children:"Online play with all rules and variations"}),e.jsx("li",{children:"Advanced analytics and leaderboards"}),e.jsx("li",{children:"Premium camera modes and autoscoring"})]}),!c&&e.jsx("button",{onClick:async()=>{try{const m=await(await fetch(`${o}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})})).json();m.ok&&m.url?window.location.href=m.url:m.error==="STRIPE_NOT_CONFIGURED"?d("Premium purchases are not available. Payment link not configured.",{type:"error",timeout:4e3}):d("Failed to get payment link. Please try again.",{type:"error",timeout:4e3})}catch{d("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold shadow-lg hover:scale-105 transition",children:"Subscribe to PREMIUM"})]})}function dh({open:t,onClose:a,width:s=700,title:r,footer:n,children:i,side:l="right"}){return u.useEffect(()=>{function o(d){d.key==="Escape"&&a()}return t&&document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t,a]),e.jsxs("div",{className:`fixed inset-0 z-50 ${t?"":"pointer-events-none"}`,"aria-hidden":!t,children:[e.jsx("div",{className:`absolute inset-0 bg-black/60 transition-opacity ${t?"opacity-100":"opacity-0"}`,onClick:a}),e.jsxs("div",{className:`absolute top-0 ${l==="right"?"right-0 border-l":"left-0 border-r"} h-full bg-slate-900 border-slate-700 shadow-2xl w-full sm:w-auto flex flex-col transition-transform duration-200 ${t?"translate-x-0":l==="right"?"translate-x-full":"-translate-x-full"}`,style:{width:typeof s=="number"?`${s}px`:s},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-700 sticky top-0 bg-slate-900 z-10",children:[e.jsx("div",{className:"text-lg font-semibold",children:r}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:a,children:"Close"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:i}),n&&e.jsx("div",{className:"px-4 py-3 border-t border-slate-700 sticky bottom-0 bg-slate-900 z-10",children:n})]})]})}function uh({user:t}){const a=$l(t?.email),[s,r]=u.useState(null),[n,i]=u.useState(""),[l,o]=u.useState("");async function d(){try{const m=await Kt("/readyz");r(await m.json())}catch{}}if(u.useEffect(()=>{d();const m=setInterval(d,5e3);return()=>clearInterval(m)},[]),!a)return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Ops"}),e.jsx("div",{children:"Restricted"})]});async function c(m){o("");try{const x=await Kt("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:m,requesterEmail:t?.email})}),b=await x.json();!x.ok||!b?.ok?o(b?.error||"Failed"):o(`Maintenance ${m?"enabled":"disabled"}`)}catch{o("Network error")}}async function h(){o("");const m=n.trim();if(m)try{const x=await Kt("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:m,requesterEmail:t?.email})}),b=await x.json();!x.ok||!b?.ok?o(b?.error||"Failed"):o("Announcement broadcasted"),i("")}catch{o("Network error")}}return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Ops"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Readiness"}),e.jsxs("div",{className:"text-sm",children:["HTTP: ",e.jsx("span",{className:`font-semibold ${s?.ok?"text-emerald-300":"text-rose-300"}`,children:String(!!s?.ok)})]}),e.jsxs("div",{className:"text-sm",children:["WS: ",e.jsx("span",{className:`font-semibold ${s?.ws?"text-emerald-300":"text-rose-300"}`,children:String(!!s?.ws)})]}),e.jsxs("div",{className:"text-sm",children:["Clients: ",e.jsx("span",{className:"font-semibold",children:s?.clients??0})]}),e.jsxs("div",{className:"text-sm",children:["Rooms: ",e.jsx("span",{className:"font-semibold",children:s?.rooms??0})]}),e.jsxs("div",{className:"text-sm",children:["Heap Used: ",e.jsxs("span",{className:"font-semibold",children:[s?.mem?Math.round(s.mem.heapUsed/1024/1024):0," MB"]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Maintenance"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>c(!0),children:"Enable"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>c(!1),children:"Disable"})]})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Announcement"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Message to broadcast",value:n,onChange:m=>i(m.target.value)}),e.jsx("button",{className:"btn",onClick:h,children:"Send"})]})]})]}),l&&e.jsx("div",{className:"text-xs mt-2",children:l}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"âœ… Clustering enabled! For 1.5k+ concurrent users, deploy behind a reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets. Set NODE_WORKERS environment variable to control worker count."})]})}function mh({}){const[t,a]=u.useState(!1),[s,r]=u.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[n,i]=u.useState(""),[l,o]=u.useState(!1),[d,c]=u.useState(""),[h,m]=u.useState(null),x=(()=>{try{return Sa()}catch{return null}})();u.useEffect(()=>{if(!x)return;const C=x.addListener(w=>{try{w?.type==="help-message"&&h&&(String(w.requestId),String(h.id)),w?.type==="help-request-updated"&&h&&w.request?.id===h.id&&m(w.request)}catch{}});return()=>C()},[x,h]);const b=C=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:C}})),a(!1)}catch(w){console.error("Navigation failed:",w)}},y=C=>{const w=C.toLowerCase();return w.includes("username")||w.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:w.includes("premium")||w.includes("upgrade")||w.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:w.includes("calibrat")||w.includes("camera")||w.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:w.includes("voice")||w.includes("caller")||w.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:w.includes("friend")||w.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:w.includes("stat")||w.includes("score")||w.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:w.includes("setting")||w.includes("customiz")||w.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:w.includes("tournament")||w.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:w.includes("score")||w.includes("scoring")||w.includes("autoscore")?{text:"Auto-scoring assigns darts to board segments automatically. You can review and adjust placements in the Match Summary screen.",links:[{text:"Go to Match Summary",tab:"matchsummary"}]}:w.includes("pair")||w.includes("pairing")||w.includes("phone")||w.includes("camera pairing")?{text:"Use the Pairing flow to connect phones and cameras. Make sure devices are on the same Wiâ€‘Fi and scan the QR code shown.",links:[{text:"Open Pairing",tab:"pairing"}]}:w.includes("highlight")||w.includes("download")||w.includes("save")?{text:"Highlights can be downloaded or saved to your account from the Highlights section. We keep a record when you hit milestone checkouts or visits.",links:[{text:"Open Highlights",tab:"highlights"}]}:w.includes("privacy")||w.includes("copyright")||w.includes("legal")?{text:"Our Legal Notice and Privacy information are available in the footer. You can view privacy, copyright, and contact details there.",links:[{text:"View Legal Notice",tab:"footer"}]}:w.includes("help")||w.includes("support")||w.includes("faq")?{text:"You're already in the help section! Check Settings for more resources.",links:[{text:"Go to Settings > Support",tab:"settings"}]}:w.includes("how to play")||w.includes("game")||w.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},N=()=>{if(!n.trim())return;const C=n.trim(),w=C.toLowerCase();if(r(I=>[...I,{text:C,isUser:!0}]),i(""),l)if(w.startsWith("y")){r(I=>[...I,{text:"Okay â€” I will notify an admin. Please wait for them to join the chat.",isUser:!1}]),o(!1),(async()=>{try{const R=await(await Kt("/api/help/requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:d||C})})).json().catch(()=>null);R&&R.request?(m(R.request),r(A=>[...A,{text:"Okay â€” I will notify an admin. Please wait for them to join the chat.",isUser:!1}])):r(A=>[...A,{text:"Okay â€” I will notify an admin. Please wait for them to join the chat.",isUser:!1}])}catch{r(M=>[...M,{text:"Failed to contact admins. Please try again later.",isUser:!1}])}})();return}else{r(I=>[...I,{text:"Okay â€” I won't notify an admin. If you change your mind, just ask.",isUser:!1}]),o(!1);return}const D=y(w);if(typeof D.text=="string"&&D.text.includes("I'm not sure about that")){c(C),o(!0),setTimeout(()=>{r(I=>[...I,{text:{text:"I can connect you to a member of our admin team â€” would you like that? Type YES or NO.",links:[]},isUser:!1}])},350);return}setTimeout(()=>{r(I=>[...I,{text:D,isUser:!1}])},500)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-colors",title:"Help Assistant",children:e.jsx(Ti,{className:"w-6 h-6"})}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-end p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsxs("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-md h-96 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(on,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"font-semibold",children:"Help Assistant"})]}),e.jsx("button",{onClick:()=>a(!1),className:"text-slate-400 hover:text-white",children:e.jsx(Al,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:s.map((C,w)=>e.jsx("div",{className:`flex ${C.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${C.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof C.text=="string"?C.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:C.text.text}),C.text.links&&e.jsx("div",{className:"space-y-1",children:C.text.links.map((D,I)=>e.jsx("button",{onClick:()=>b(D.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:D.text},I))})]})})},w))}),e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:C=>i(C.target.value),onKeyPress:C=>C.key==="Enter"&&N(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:N,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(Gi,{className:"w-4 h-4"})})]})})]})]}),h&&e.jsx(Rc,{request:h,user:{email:null,username:null,isAdmin:!1},onClose:()=>m(null)})]})}function hh(){const t=Zn(),a=u.useRef({}),s=u.useRef({});return u.useEffect(()=>{function r(c="[GlobalCamera]"){try{const h=t.getVideoElementRef(),m=t.getMediaStream(),x=t.getPcRef&&t.getPcRef(),b=t.getWsRef&&t.getWsRef();console.log(c,{isStreaming:t.isStreaming,mode:t.mode,showOverlay:t.showOverlay,hasVideoElement:!!h,video:h?{videoWidth:h.videoWidth,videoHeight:h.videoHeight,srcObject:!!h.srcObject}:null,mediaTracks:m?m.getTracks().map(y=>({kind:y.kind,enabled:y.enabled,id:y.id})):null,pcState:x?x.connectionState||x.iceConnectionState:null,wsState:b?b.readyState||"unknown":null})}catch(h){console.warn("[GlobalCamera] dumpState failed",h)}}r("[GlobalCamera] INIT");let n=!0;const i=setInterval(()=>{if(n)try{const c=t.getVideoElementRef(),h=t.getMediaStream(),m=t.getPcRef&&t.getPcRef(),x={isStreaming:t.isStreaming,mode:t.mode,hasVideo:!!c,videoW:c?c.videoWidth:0,videoH:c?c.videoHeight:0,tracks:h?h.getTracks().length:0,pcState:m?m.connectionState||m.iceConnectionState:null},b=a.current;(x.isStreaming!==b.isStreaming||x.hasVideo!==b.hasVideo||x.videoW!==b.videoW||x.videoH!==b.videoH||x.tracks!==b.tracks||x.pcState!==b.pcState||t.showOverlay!==b.showOverlay)&&(a.current=x,r("[GlobalCamera] CHANGE"))}catch(c){console.warn("[GlobalCamera] poll failed",c)}},750);function l(c){try{const h=s.current.video;if(h&&h.el===c)return;if(h&&h.el){try{h.el.removeEventListener("loadedmetadata",h.loadedmetadata)}catch{}try{h.el.removeEventListener("playing",h.playing)}catch{}try{h.el.removeEventListener("pause",h.pause)}catch{}try{h.el.removeEventListener("ended",h.ended)}catch{}}if(s.current.video=null,c){const m=()=>console.log("[GlobalCamera] video loadedmetadata",{videoWidth:c.videoWidth,videoHeight:c.videoHeight}),x=()=>{console.log("[GlobalCamera] video playing",{paused:c.paused});try{t.setStreaming(!0)}catch{}},b=()=>{console.log("[GlobalCamera] video pause");try{t.setStreaming(!1)}catch{}},y=()=>{console.log("[GlobalCamera] video ended");try{t.setStreaming(!1)}catch{}};c.addEventListener("loadedmetadata",m),c.addEventListener("playing",x),c.addEventListener("pause",b),c.addEventListener("ended",y),s.current.video={el:c,loadedmetadata:m,playing:x,pause:b,ended:y}}}catch(h){console.warn("[GlobalCamera] attachVideoListeners failed",h)}}function o(c){try{const h=s.current.pc;if(h&&h.pc===c)return;if(h&&h.pc)try{h.pc.removeEventListener("connectionstatechange",h.connChange)}catch{}if(s.current.pc=null,c){const m=()=>console.log("[GlobalCamera] pc state change",{connectionState:c.connectionState,iceState:c.iceConnectionState});c.addEventListener("connectionstatechange",m),s.current.pc={pc:c,connChange:m}}}catch(h){console.warn("[GlobalCamera] attachPc failed",h)}}const d=setInterval(()=>{try{l(t.getVideoElementRef()),o(t.getPcRef&&t.getPcRef())}catch{}},1e3);return()=>{n=!1,clearInterval(i),clearInterval(d);try{const c=s.current.video;c&&c.el&&(c.el.removeEventListener("loadedmetadata",c.loadedmetadata),c.el.removeEventListener("playing",c.playing))}catch{}try{const c=s.current.pc;c&&c.pc&&c.pc.removeEventListener("connectionstatechange",c.connChange)}catch{}}},[t]),null}function fh(){const t=Zn(),a=u.useRef(null),s=u.useRef(null),r=u.useRef(0),n=u.useRef(0),i=u.useRef(0),l=u.useRef(0);return u.useEffect(()=>{a.current&&t.setVideoElementRef(a.current)},[t]),u.useEffect(()=>{let o=!0;const d=async()=>{if(o)try{const h=t.getMediaStream(),m=a.current;if(!m||!h)return;(s.current!==h||m.srcObject!==h)&&(m.srcObject=h,s.current=h),m.muted=!0,m.playsInline=!0;try{await m.play()}catch{}}catch{}};d();const c=setInterval(d,750);return()=>{o=!1,clearInterval(c)}},[t]),u.useEffect(()=>{const d=setInterval(()=>{const c=a.current,h=Date.now();if(!c||!t.isStreaming||t.mode!=="phone"||!c.srcObject){n.current=0;return}const m=c.currentTime||0;if(Number.isFinite(m))if(m===r.current?n.current+=1:n.current=0,r.current=m,n.current>=3){const x=[3e3,6e3,1e4][Math.min(l.current,2)];if(h-i.current>=x){i.current=h,l.current=Math.min(l.current+1,3);try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{reason:"stall",ts:h}})),c.play().catch(()=>{})}catch{}}}else n.current===0&&(l.current=0)},1e3);return()=>clearInterval(d)},[t]),e.jsx("video",{ref:a,style:{position:"fixed",width:1,height:1,left:-9999,top:-9999,opacity:0},muted:!0,playsInline:!0,"aria-hidden":!0})}function xh(){const[t,a]=u.useState(!1),s=new Date().getFullYear();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full text-center text-xs text-gray-500 py-2 select-none",children:["Â© ",s," Nine Dart Nation â€” ",e.jsx("button",{className:"underline",onClick:()=>a(!0),children:"Legal Notice"})]}),t?e.jsx(Xs,{storageKey:"ndn:modal:legal",className:"w-[640px]",defaultWidth:640,defaultHeight:420,minWidth:420,minHeight:220,initialFitHeight:!0,children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Privacy & Copyright Notice"}),e.jsx("div",{className:"text-sm",children:"âš ï¸ IMPORTANT LEGAL NOTICE"}),e.jsx("div",{className:"text-sm",children:"Copyright Protection: All code, assets, and intellectual property in Nine Dart Nation are protected by copyright law. Unauthorized copying, modification, or distribution of this software is strictly prohibited."}),e.jsx("div",{className:"text-sm",children:"Legal Consequences: Any attempt to edit, reverse-engineer, or redistribute this code will result in immediate legal action, including but not limited to copyright infringement lawsuits and potential criminal charges."}),e.jsx("div",{className:"text-sm",children:"Privacy: Your personal data and gameplay information are protected. Any unauthorized access or data collection violates privacy laws and will be prosecuted to the full extent of the law."}),e.jsx("div",{className:"flex items-center gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:()=>a(!1),children:"Close"})})]})}):null]})}function ph(){const t=u.useRef(null),[a,s]=u.useState(""),[r,n]=u.useState(!1),[i,l]=u.useState(null),o=(()=>{try{return Sa()}catch{return null}})(),[d,c]=u.useState("score"),[h,m]=u.useState(!1),[x,b]=u.useState(!1),[y,N]=u.useState(null),[C,w]=u.useState(0),{avgMode:D}=qt(),{H:I,locked:M,errorPx:R}=wa();u.useEffect(()=>{const p=localStorage.getItem("authToken");p&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${p}`}}).then(H=>H.json()).then(H=>{H?.user?(N(H.user),A(H.user)):localStorage.removeItem("authToken")}).catch(()=>{})},[]),u.useEffect(()=>{const p=()=>{try{localStorage.removeItem("mockUser"),localStorage.removeItem("authToken")}catch{}N(null),c("score")};return window.addEventListener("ndn:logout",p),()=>window.removeEventListener("ndn:logout",p)},[]),u.useEffect(()=>{if(!y?.username)return;const p=()=>w(D==="24h"?Gd(y.username):ln(y.username));p();const F=()=>p();return window.addEventListener("ndn:stats-updated",F),()=>window.removeEventListener("ndn:stats-updated",F)},[y?.username,D]),u.useEffect(()=>{if(!y?.username){s("");return}const p=localStorage.getItem(`ndn:bio:profilePhoto:${y.username}`);s(p||"")},[y?.username]),u.useEffect(()=>{const p=z=>{z.key?.startsWith("ndn:bio:profilePhoto:")&&y?.username&&z.key.endsWith(y.username)&&s(z.newValue||"")},F=z=>{if(z.detail?.username===y?.username&&s(z.detail?.avatar||""),y?.username){const T=localStorage.getItem(`ndn:bio:profilePhoto:${y.username}`);s(T||"")}},H=()=>{if(!document.hidden&&y?.username){const z=localStorage.getItem(`ndn:bio:profilePhoto:${y.username}`);s(z||"")}},_=setInterval(()=>{if(y?.username){const z=localStorage.getItem(`ndn:bio:profilePhoto:${y.username}`);z&&z!==a&&s(z)}},2e3);return window.addEventListener("storage",p),window.addEventListener("ndn:avatar-updated",F),document.addEventListener("visibilitychange",H),()=>{window.removeEventListener("storage",p),window.removeEventListener("ndn:avatar-updated",F),document.removeEventListener("visibilitychange",H),clearInterval(_)}},[y?.username,a]),u.useEffect(()=>{const p=new URLSearchParams(window.location.search),F=p.get("paid"),H=p.get("username-change");if(F==="1"||F==="username-change"||H==="free"){const _=localStorage.getItem("pendingUsernameChange");_&&y?.email&&fetch("http://localhost:8787/api/change-username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:y.email,newUsername:_})}).then(T=>T.json()).then(T=>{T.ok?(alert("Username changed successfully!"),localStorage.removeItem("pendingUsernameChange"),T.token&&localStorage.setItem("authToken",T.token),T.user&&N(T.user),window.history.replaceState({},document.title,window.location.pathname)):alert("Failed to change username: "+(T.error||"Unknown error"))}).catch(()=>{alert("Network error while changing username")})}},[y?.email]),u.useEffect(()=>{new URLSearchParams(window.location.search).get("subscription")==="success"&&y?.email&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}).then(_=>_.json()).then(_=>{_?.user&&(N(_.user),alert("Premium subscription activated successfully!"),window.history.replaceState({},document.title,window.location.pathname))}).catch(()=>{alert("Subscription activated, but failed to refresh user data. Please refresh the page.")})},[y?.email]),u.useEffect(()=>{const p=()=>{const _=window.innerWidth,z=window.matchMedia("(max-width: 768px)").matches,T=window.matchMedia("(max-width: 1024px) and (min-width: 769px)").matches,K=/Mobi|Android|iPhone|iPad|iPod|Mobile|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent||""),ee=/iPad|Android(?=.*\bMobile\b)|Tablet|PlayBook|Silk/i.test(navigator.userAgent||""),ie="ontouchstart"in window||navigator.maxTouchPoints>0,ke=_<769,Be=T&&ie||ee||_>=769&&_<=1024&&ie,Oe=z||K||ke||_<769&&ie||Be;m(Oe)};p(),window.addEventListener("resize",p),window.addEventListener("orientationchange",p);const F=window.matchMedia("(max-width: 768px)"),H=window.matchMedia("(max-width: 1024px) and (min-width: 769px)");try{F.addEventListener("change",p),H.addEventListener("change",p)}catch{}return()=>{window.removeEventListener("resize",p),window.removeEventListener("orientationchange",p);try{F.removeEventListener("change",p),H.removeEventListener("change",p)}catch{}}},[]),u.useEffect(()=>{const p=()=>{try{localStorage.removeItem("ndn:avatar")}catch{}N(null),c("score")};return window.addEventListener("ndn:logout",p),()=>window.removeEventListener("ndn:logout",p)},[]),u.useEffect(()=>{const p=F=>{try{const H=String(F?.detail?.username||"").trim();if(!H)return;N(_=>_&&{..._,username:H});try{const _=(y?.email||"").toLowerCase();o&&H&&_&&o.send({type:"presence",username:H,email:_})}catch{}}catch{}};return window.addEventListener("ndn:username-changed",p),()=>window.removeEventListener("ndn:username-changed",p)},[o,y?.email]),u.useEffect(()=>{const p=F=>{try{const H=String(F?.detail?.tab||"").trim();H&&["score","offline","online","stats","settings","admin","tournaments","friends"].includes(H)&&c(H)}catch{}};return window.addEventListener("ndn:change-tab",p),()=>window.removeEventListener("ndn:change-tab",p)},[]);async function A(p){try{const F=p?.email?`?email=${encodeURIComponent(p.email)}`:"",H=await fetch("/api/subscription"+F);if(!H.ok)return;const _=await H.json();N({...p,fullAccess:!!_?.fullAccess})}catch{}}if(!y)return e.jsx(Qm,{onAuth:p=>{N(p),A(p)}});const v=`https://ui-avatars.com/api/?name=${encodeURIComponent(y.username||"NDN")}&background=8F43EE&color=fff&bold=true&rounded=true&size=64`;return e.jsxs(eh,{children:[e.jsxs("div",{ref:t,className:`${y?.fullAccess?"premium-body":""} h-screen overflow-hidden pt-1 pb-0 px-1 xs:pt-2 xs:pb-0 xs:px-2 sm:pt-3 sm:pb-0 sm:px-3 md:pt-4 md:pb-0 md:px-4`,children:[e.jsx(qm,{}),e.jsxs("div",{className:"max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-[auto,1fr] gap-2 xs:gap-3 sm:gap-4 h-full overflow-hidden",children:[!h&&e.jsx("div",{className:"relative hidden lg:block",style:{width:240},children:e.jsx(Hl,{active:d,onChange:p=>{c(p)},user:y})}),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"pt-1 xs:pt-2",children:e.jsxs("header",{id:"ndn-header",className:"header glass flex-col xs:flex-col sm:flex-row gap-2 xs:gap-2 sm:gap-3",children:[e.jsx("div",{className:"flex items-center gap-2 order-1",children:e.jsx("h1",{className:"text-lg xs:text-xl sm:text-xl md:text-2xl font-bold text-brand-700 whitespace-nowrap cursor-pointer select-none",onClick:()=>{c("score")},title:"Go Home",children:"NINE-DART-NATION ðŸŽ¯"})}),e.jsxs("div",{className:"order-3 xs:order-3 sm:order-2 w-full sm:w-auto flex-1 flex flex-col items-center justify-center text-center sm:text-left !text-black",children:[e.jsxs("span",{className:"text-sm xs:text-base sm:text-base md:text-lg font-semibold flex items-center gap-2 max-w-full truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[e.jsx("span",{className:"hidden xs:inline !text-black",children:"Welcome"}),e.jsx("img",{src:a||v,alt:"avatar",className:"w-5 h-5 xs:w-6 xs:h-6 sm:w-6 sm:h-6 md:w-7 md:h-7 rounded-full ring-2 ring-white/20"}),e.jsxs("span",{className:"truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[y.username,"ðŸŽ¯"]})]}),e.jsxs("span",{className:"hidden xs:inline text-xs xs:text-xs sm:text-xs md:text-sm !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:["All-time 3-dart avg: ",e.jsx("span",{className:"font-semibold !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:C.toFixed(2)})]}),h&&e.jsx("button",{className:"btn px-3 py-1 xs:px-3 xs:py-1 sm:px-3 sm:py-1 mt-1 text-sm xs:text-sm","aria-label":"Open navigation",onClick:()=>b(!0),children:"â˜° Menu"})]}),M&&I&&e.jsxs("button",{onClick:()=>c("calibrate"),className:"order-4 sm:order-4 md:order-3 px-3 py-1 text-xs sm:text-sm rounded-full bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-100 border border-emerald-400/50 transition-colors",title:"Click to adjust calibration",children:["âœ“ Calibration Active ",R!=null&&`â€¢ ${R.toFixed(1)}px`]}),e.jsxs("div",{className:"order-2 md:order-3 ml-0 md:ml-auto flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"px-3 py-1 text-sm rounded-full bg-white/5 hover:bg-white/10 border border-white/10",onClick:()=>{const p=t.current;p&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):p.requestFullscreen().catch(()=>{}))},title:r?"Exit Full Screen":"Enter Full Screen",children:r?"Exit Full Screen":"Full Screen"}),d==="online"&&e.jsx("button",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40",title:"Open a simulated online match",onClick:()=>{setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch{}},40)},children:"ONLINE DEMO"}),e.jsx(Ac,{}),o?e.jsx("span",{className:"ml-0 md:ml-2",children:e.jsx(Mc,{status:o.status})}):null]})]})}),h&&e.jsx(bh,{open:x,onClose:()=>b(!1),active:d,onChange:p=>{c(p),b(!1)},user:y}),e.jsxs("main",{id:"ndn-main-scroll",className:"space-y-4 flex-1 overflow-y-auto pr-1 flex flex-col",children:[d==="settings"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsx(Ym,{user:y})}),d==="score"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsx(Yd,{user:y})}),d==="online"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsx(rh,{user:y})}),d==="offline"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsx(Um,{user:y})}),e.jsx("div",{className:d==="calibrate"?"":"hidden",children:e.jsx(an,{children:e.jsx(sm,{})})}),d==="friends"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsx(Wm,{user:y})}),d==="stats"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsx(oh,{user:y})}),d==="tournaments"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsx(lh,{user:y})}),d==="admin"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"flex-1 min-h-0 space-y-6",children:[e.jsx(Km,{user:y}),e.jsx(uh,{user:y})]})}),d==="fullaccess"&&e.jsx(an,{className:"flex-1 min-h-0",children:e.jsx(ch,{user:y})})]})]})]})]}),e.jsx(mh,{}),e.jsx(xh,{}),e.jsx(hh,{}),e.jsx(fh,{})]})}function bh({open:t,onClose:a,active:s,onChange:r,user:n}){return e.jsx(dh,{open:t,onClose:a,width:320,side:"left",title:"Navigate",children:e.jsx("div",{className:"mt-2",children:e.jsx(Hl,{active:s,onChange:r,user:n,className:"flex relative static max-h-[80vh] w-full"})})})}function gh(t){return t.length>=10&&/\d/.test(t)&&/[^A-Za-z0-9]/.test(t)}function yh(){const[t,a]=u.useState(""),[s,r]=u.useState(""),[n,i]=u.useState(""),[l,o]=u.useState(""),[d,c]=u.useState("");u.useEffect(()=>{try{const x=new URLSearchParams(window.location.search).get("token")||"";a(x)}catch{}},[]);async function h(m){if(m.preventDefault(),o(""),c(""),!t){o("Missing or invalid reset token.");return}if(!s||s!==n){o("Passwords do not match.");return}if(!gh(s)){o("Password must be at least 10 chars and include a number and symbol.");return}try{const b=await(await fetch("/api/auth/confirm-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,newPassword:s})})).json();if(!b?.ok)throw new Error(b?.error||"Reset failed");c("Password changed. You can now sign in.")}catch(x){o(x?.message||"Reset failed")}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsx("div",{className:"relative z-10 w-full max-w-lg mx-auto p-4",children:e.jsxs("form",{className:"card w-full space-y-4",onSubmit:h,children:[e.jsx("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:e.jsx("h1",{className:"logo text-center",children:"Reset your password"})}),!t&&e.jsx("div",{className:"text-red-400",children:"This reset link is missing a token. Please use the link from your email."}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"New password",value:s,onChange:m=>r(m.target.value),required:!0}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"Confirm password",value:n,onChange:m=>i(m.target.value),required:!0}),l&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:l}),d&&e.jsx("div",{className:"text-emerald-400 font-semibold text-sm",children:d}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:!t,children:"Change Password"}),e.jsx("a",{className:"underline text-sm text-center",href:"/",children:"Back to sign in"})]})})]})}class vh extends u.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,message:String(a?.message||a)}}componentDidCatch(a,s){console.error("[ErrorBoundary]",a,s)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"card max-w-lg w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"opacity-80 mb-4",children:"Please refresh the page. If this persists, let us know."}),this.state.message&&e.jsx("pre",{className:"text-xs bg-black/40 rounded p-2 overflow-auto text-left",children:this.state.message}),e.jsx("button",{className:"btn mt-4",onClick:()=>window.location.reload(),children:"Reload"})]})}):this.props.children}}try{window.React=window.React||{}}catch{}Td();bd.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(vh,{children:e.jsx(zm,{children:e.jsx(jh,{})})})}));function jh(){return window.location.pathname==="/reset"?e.jsx(yh,{}):e.jsx(ph,{})}
//# sourceMappingURL=index-BS8cKKcV.js.map

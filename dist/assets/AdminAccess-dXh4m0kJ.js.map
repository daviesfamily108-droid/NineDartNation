{"version":3,"file":"AdminAccess-dXh4m0kJ.js","sources":["../../src/components/AdminAccess.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useToast } from \"../store/toast\";\nimport { getApiBaseUrl } from \"../utils/api\";\n\nexport default function AdminAccess({ user }: { user?: any }) {\n  const [subscription, setSubscription] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const API_URL = getApiBaseUrl();\n  const toast = useToast();\n\n  useEffect(() => {\n    const fetchSubscription = async () => {\n      try {\n        const q = user?.email ? `?email=${encodeURIComponent(user.email)}` : \"\";\n        const res = await fetch(`${API_URL}/api/subscription` + q);\n        if (!res.ok) throw new Error(\"Failed to fetch subscription\");\n        const data = await res.json();\n        setSubscription(data);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \"Something went wrong\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchSubscription();\n  }, [user?.email, API_URL]);\n\n  if (loading) {\n    return (\n      <div className=\"card\">\n        <div className=\"text-center py-8\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-4\"></div>\n          <p>Loading subscription...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"card\">\n        <h2 className=\"text-2xl font-bold text-red-300 mb-2\">\n          Subscription Error\n        </h2>\n        <p className=\"mb-4 text-red-200\">{error}</p>\n        <button\n          onClick={() => window.location.reload()}\n          className=\"btn bg-red-600 hover:bg-red-700\"\n        >\n          Retry\n        </button>\n      </div>\n    );\n  }\n\n  const hasAccess = subscription?.fullAccess;\n\n  return (\n    <div className=\"card\">\n      <h2 className=\"text-2xl font-bold text-indigo-300 mb-2\">\n        {hasAccess ? \"PREMIUM Active\" : \"PREMIUM\"}\n      </h2>\n\n      {hasAccess ? (\n        <div className=\"mb-4\">\n          <div className=\"bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4\">\n            <div className=\"flex items-center gap-2 text-green-300 font-semibold mb-2\">\n              âœ… PREMIUM Access Active\n            </div>\n            <p className=\"text-green-200 text-sm\">\n              You have full access to all premium features!\n            </p>\n            {subscription?.source && (\n              <p className=\"text-green-200 text-xs mt-1\">\n                Source: {subscription.source}\n                {subscription?.expiresAt &&\n                  ` (expires: ${new Date(subscription.expiresAt).toLocaleDateString()})`}\n              </p>\n            )}\n          </div>\n\n          <h3 className=\"text-lg font-semibold mb-2 text-indigo-200\">\n            Your Benefits:\n          </h3>\n        </div>\n      ) : (\n        <p className=\"mb-2 text-indigo-200\">\n          Unlock every game mode known to darts, advanced stats, and premium\n          features.\n        </p>\n      )}\n\n      <ul className=\"mb-4\">\n        <li>All game modes (including paid/advanced)</li>\n        <li>Online play with all rules and variations</li>\n        <li>Advanced analytics and leaderboards</li>\n        <li>Premium camera modes and autoscoring</li>\n      </ul>\n\n      {!hasAccess && (\n        <button\n          onClick={async () => {\n            try {\n              const res = await fetch(\n                `${API_URL}/api/stripe/create-checkout-session`,\n                {\n                  method: \"POST\",\n                  headers: { \"Content-Type\": \"application/json\" },\n                  body: JSON.stringify({ email: user.email }),\n                },\n              );\n              const data = await res.json();\n              if (data.ok && data.url) {\n                window.location.href = data.url;\n              } else if (data.error === \"STRIPE_NOT_CONFIGURED\") {\n                toast(\n                  \"Premium purchases are not available. Payment link not configured.\",\n                  { type: \"error\", timeout: 4000 },\n                );\n              } else {\n                toast(\"Failed to get payment link. Please try again.\", {\n                  type: \"error\",\n                  timeout: 4000,\n                });\n              }\n            } catch (err) {\n              toast(\"Error creating checkout. Please try again.\", {\n                type: \"error\",\n                timeout: 4000,\n              });\n            }\n          }}\n          className=\"btn bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold shadow-lg hover:scale-105 transition\"\n        >\n          Subscribe to PREMIUM\n        </button>\n      )}\n    </div>\n  );\n}\n"],"names":["AdminAccess","user","subscription","setSubscription","useState","loading","setLoading","error","setError","API_URL","getApiBaseUrl","toast","useToast","useEffect","q","res","data","err","jsxs","jsx","hasAccess"],"mappings":"wHAIA,SAAwBA,EAAY,CAAE,KAAAC,GAAwB,CAC5D,KAAM,CAACC,EAAcC,CAAe,EAAIC,EAAAA,SAAc,IAAI,EACpD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAOC,CAAQ,EAAIJ,EAAAA,SAAwB,IAAI,EAChDK,EAAUC,EAAA,EACVC,EAAQC,EAAA,EAoBd,GAlBAC,EAAAA,UAAU,IAAM,EACY,SAAY,CACpC,GAAI,CACF,MAAMC,EAAIb,GAAM,MAAQ,UAAU,mBAAmBA,EAAK,KAAK,CAAC,GAAK,GAC/Dc,EAAM,MAAM,MAAM,GAAGN,CAAO,oBAAsBK,CAAC,EACzD,GAAI,CAACC,EAAI,GAAI,MAAM,IAAI,MAAM,8BAA8B,EAC3D,MAAMC,EAAO,MAAMD,EAAI,KAAA,EACvBZ,EAAgBa,CAAI,CACtB,OAASC,EAAK,CACZT,EAASS,aAAe,MAAQA,EAAI,QAAU,sBAAsB,CACtE,QAAA,CACEX,EAAW,EAAK,CAClB,CACF,GAEA,CACF,EAAG,CAACL,GAAM,MAAOQ,CAAO,CAAC,EAErBJ,EACF,aACG,MAAA,CAAI,UAAU,OACb,SAAAa,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,6EAAA,CAA8E,EAC7FA,EAAAA,IAAC,KAAE,SAAA,yBAAA,CAAuB,CAAA,CAAA,CAC5B,CAAA,CACF,EAIJ,GAAIZ,EACF,OACEW,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,uCAAuC,SAAA,qBAErD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,oBAAqB,SAAAZ,EAAM,EACxCY,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,OAAO,SAAS,OAAA,EAC/B,UAAU,kCACX,SAAA,OAAA,CAAA,CAED,EACF,EAIJ,MAAMC,EAAYlB,GAAc,WAEhC,OACEgB,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,0CACX,SAAAC,EAAY,iBAAmB,UAClC,EAECA,EACCF,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iEACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,4DAA4D,SAAA,0BAE3E,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,yBAAyB,SAAA,gDAEtC,EACCjB,GAAc,QACbgB,OAAC,IAAA,CAAE,UAAU,8BAA8B,SAAA,CAAA,WAChChB,EAAa,OACrBA,GAAc,WACb,cAAc,IAAI,KAAKA,EAAa,SAAS,EAAE,mBAAA,CAAoB,GAAA,CAAA,CACvE,CAAA,EAEJ,EAEAiB,EAAAA,IAAC,KAAA,CAAG,UAAU,6CAA6C,SAAA,gBAAA,CAE3D,CAAA,EACF,EAEAA,EAAAA,IAAC,IAAA,CAAE,UAAU,uBAAuB,SAAA,+EAGpC,EAGFD,EAAAA,KAAC,KAAA,CAAG,UAAU,OACZ,SAAA,CAAAC,EAAAA,IAAC,MAAG,SAAA,0CAAA,CAAwC,EAC5CA,EAAAA,IAAC,MAAG,SAAA,2CAAA,CAAyC,EAC7CA,EAAAA,IAAC,MAAG,SAAA,qCAAA,CAAmC,EACvCA,EAAAA,IAAC,MAAG,SAAA,sCAAA,CAAoC,CAAA,EAC1C,EAEC,CAACC,GACAD,EAAAA,IAAC,SAAA,CACC,QAAS,SAAY,CACnB,GAAI,CASF,MAAMH,EAAO,MARD,MAAM,MAChB,GAAGP,CAAO,sCACV,CACE,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,MAAOR,EAAK,MAAO,CAAA,CAC5C,GAEqB,KAAA,EACnBe,EAAK,IAAMA,EAAK,IAClB,OAAO,SAAS,KAAOA,EAAK,IACnBA,EAAK,QAAU,wBACxBL,EACE,oEACA,CAAE,KAAM,QAAS,QAAS,GAAA,CAAK,EAGjCA,EAAM,gDAAiD,CACrD,KAAM,QACN,QAAS,GAAA,CACV,CAEL,MAAc,CACZA,EAAM,6CAA8C,CAClD,KAAM,QACN,QAAS,GAAA,CACV,CACH,CACF,EACA,UAAU,gHACX,SAAA,sBAAA,CAAA,CAED,EAEJ,CAEJ"}
{"version":3,"file":"index-RXpX39D2.js","sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/utils/quota.ts","../../src/utils/admin.ts","../../src/utils/config.ts","../../src/utils/api.ts","../../src/components/Sidebar.tsx","../../node_modules/zustand/esm/vanilla.mjs","../../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js","../../node_modules/use-sync-external-store/shim/index.js","../../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js","../../node_modules/use-sync-external-store/shim/with-selector.js","../../node_modules/zustand/esm/index.mjs","../../src/store/toast.ts","../../src/utils/stats.ts","../../src/store/profileStats.ts","../../src/store/userSettings.ts","../../src/components/Home.tsx","../../src/components/ScrollFade.tsx","../../src/components/DartLoader.tsx","../../node_modules/qrcode/lib/can-promise.js","../../node_modules/qrcode/lib/core/utils.js","../../node_modules/qrcode/lib/core/error-correction-level.js","../../node_modules/qrcode/lib/core/bit-buffer.js","../../node_modules/qrcode/lib/core/bit-matrix.js","../../node_modules/qrcode/lib/core/alignment-pattern.js","../../node_modules/qrcode/lib/core/finder-pattern.js","../../node_modules/qrcode/lib/core/mask-pattern.js","../../node_modules/qrcode/lib/core/error-correction-code.js","../../node_modules/qrcode/lib/core/galois-field.js","../../node_modules/qrcode/lib/core/polynomial.js","../../node_modules/qrcode/lib/core/reed-solomon-encoder.js","../../node_modules/qrcode/lib/core/version-check.js","../../node_modules/qrcode/lib/core/regex.js","../../node_modules/qrcode/lib/core/mode.js","../../node_modules/qrcode/lib/core/version.js","../../node_modules/qrcode/lib/core/format-info.js","../../node_modules/qrcode/lib/core/numeric-data.js","../../node_modules/qrcode/lib/core/alphanumeric-data.js","../../node_modules/qrcode/lib/core/byte-data.js","../../node_modules/qrcode/lib/core/kanji-data.js","../../node_modules/dijkstrajs/dijkstra.js","../../node_modules/qrcode/lib/core/segments.js","../../node_modules/qrcode/lib/core/qrcode.js","../../node_modules/qrcode/lib/renderer/utils.js","../../node_modules/qrcode/lib/renderer/canvas.js","../../node_modules/qrcode/lib/renderer/svg-tag.js","../../node_modules/qrcode/lib/browser.js","../../node_modules/zustand/esm/middleware.mjs","../../src/store/calibration.ts","../../src/utils/vision.ts","../../node_modules/js-aruco/src/cv.js","../../node_modules/js-aruco/src/aruco.js","../../node_modules/js-aruco/src/svd.js","../../node_modules/js-aruco/src/posit1.js","../../node_modules/js-aruco/src/posit2.js","../../node_modules/js-aruco/index.js","../../src/utils/markerCalibration.ts","../../src/utils/networkDevices.ts","../../src/components/Calibrator.tsx","../../src/utils/checkout.ts","../../src/components/CameraTile.tsx","../../src/store/match.ts","../../src/utils/autoscore.ts","../../src/utils/scoring.ts","../../src/components/ui/ResizablePanel.tsx","../../src/components/ui/ResizableModal.tsx","../../src/store/heatmap.ts","../../src/components/CameraView.tsx","../../src/components/HeatMap.tsx","../../src/game/types.ts","../../src/game/aroundTheClock.ts","../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/game/ticTacToe.ts","../../src/game/americanCricket.ts","../../src/components/OfflinePlay.tsx","../../src/store/messages.ts","../../src/utils/profanity.ts","../../src/components/ui/TabPills.tsx","../../src/components/Friends.tsx","../../src/components/Toaster.tsx","../../src/components/BarChart.tsx","../../src/utils/games.ts","../../src/components/AdminDashboard.tsx","../../src/components/SettingsPanel.tsx","../../src/components/Auth.tsx","../../src/components/ThemeContext.tsx","../../src/components/WSProvider.tsx","../../src/components/ui/StatusDot.tsx","../../src/store/blocklist.ts","../../src/components/OnlinePlay.tsx","../../src/components/StatsPanel.tsx","../../src/components/Tournaments.tsx","../../src/components/AdminAccess.tsx","../../src/components/ui/Drawer.tsx","../../src/components/OpsDashboard.tsx","../../src/components/HelpAssistant.tsx","../../src/App.tsx","../../src/components/ResetPassword.tsx","../../src/components/ErrorBoundary.tsx","../../src/main.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","// Simple localStorage-based weekly quota for free online games\r\n// 3 free online games per week per user (by username). Premium users are exempt.\r\n\r\nconst KEY = (user: string) => `ndn_online_quota_${user}`\r\n\r\ntype Usage = {\r\n  week: string // e.g., YYYY-WW\r\n  used: number\r\n}\r\n\r\nfunction getWeekId(d = new Date()): string {\r\n  // ISO week-numbering year and week\r\n  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()))\r\n  // Thursday in current week decides the year\r\n  const dayNum = date.getUTCDay() || 7\r\n  date.setUTCDate(date.getUTCDate() + 4 - dayNum)\r\n  const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1))\r\n  const weekNo = Math.ceil(((date.getTime() - yearStart.getTime()) / 86400000 + 1) / 7)\r\n  const week = String(weekNo).padStart(2, '0')\r\n  return `${date.getUTCFullYear()}-${week}`\r\n}\r\n\r\nexport function getOnlineUsage(user: string): Usage {\r\n  try {\r\n    const raw = localStorage.getItem(KEY(user))\r\n    if (!raw) return { week: getWeekId(), used: 0 }\r\n    const u = JSON.parse(raw)\r\n    const currentWeek = getWeekId()\r\n    if (!u.week || u.week !== currentWeek) return { week: currentWeek, used: 0 }\r\n    return { week: String(u.week), used: Number(u.used) || 0 }\r\n  } catch {\r\n    return { week: getWeekId(), used: 0 }\r\n  }\r\n}\r\n\r\nexport function setOnlineUsage(user: string, usage: Usage) {\r\n  try { localStorage.setItem(KEY(user), JSON.stringify(usage)) } catch {}\r\n}\r\n\r\nexport function incOnlineUsage(user: string, cap = 3): Usage {\r\n  const currentWeek = getWeekId()\r\n  const u = getOnlineUsage(user)\r\n  const next: Usage = { week: currentWeek, used: (u.week === currentWeek ? u.used : 0) + 1 }\r\n  // clamp to cap, though we still store the number\r\n  setOnlineUsage(user, next)\r\n  return next\r\n}\r\n\r\nexport function getFreeRemaining(user: string, cap = 3): number {\r\n  const u = getOnlineUsage(user)\r\n  return Math.max(0, cap - (u.used || 0))\r\n}\r\n","import { useEffect, useState } from 'react'\r\n\r\nconst LS_KEY = 'ndn:isAdmin:v1'\r\n\r\ntype Cache = { [email: string]: { v: boolean; ts: number } }\r\n\r\nfunction getCache(): Cache {\r\n  try { const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : {} } catch { return {} }\r\n}\r\nfunction setCache(email: string, v: boolean) {\r\n  try {\r\n    const c = getCache()\r\n    c[(email||'').toLowerCase()] = { v, ts: Date.now() }\r\n    localStorage.setItem(LS_KEY, JSON.stringify(c))\r\n  } catch {}\r\n}\r\n\r\nexport async function fetchIsAdmin(email?: string|null): Promise<boolean> {\r\n  const e = String(email || '').toLowerCase()\r\n  if (!e) return false\r\n  // Immediate fallbacks: owner env or local override (dev)\r\n  try {\r\n    const owner = String((import.meta as any)?.env?.VITE_OWNER_EMAIL || '').toLowerCase()\r\n    if (owner && e === owner) return true\r\n  } catch {}\r\n  // Hard fallback to known owner (repo default) if nothing else is set\r\n  if (e === 'daviesfamily108@gmail.com') return true\r\n  try {\r\n    const force = localStorage.getItem('ndn:forceAdmin')\r\n    if (force === '1' || force === 'true') return true\r\n  } catch {}\r\n  // try cache first (5 minutes)\r\n  const c = getCache()\r\n  const hit = c[e]\r\n  if (hit && (Date.now() - hit.ts) < 5 * 60 * 1000) return !!hit.v\r\n  try {\r\n    const res = await fetch(`/api/admins/check?email=${encodeURIComponent(e)}`)\r\n    const data = await res.json().catch(()=>({}))\r\n    const v = !!data?.isAdmin\r\n    setCache(e, v)\r\n    return v\r\n  } catch {\r\n    return !!(hit?.v)\r\n  }\r\n}\r\n\r\nexport function useIsAdmin(email?: string|null) {\r\n  const e = String(email || '').toLowerCase()\r\n  const [isAdmin, setIsAdmin] = useState(false)\r\n  useEffect(() => {\r\n    let on = true\r\n    if (!e) { setIsAdmin(false); return }\r\n    // Instant fallbacks before API\r\n    try {\r\n      const owner = String((import.meta as any)?.env?.VITE_OWNER_EMAIL || '').toLowerCase()\r\n      const force = ((): boolean => { try { const v = localStorage.getItem('ndn:forceAdmin'); return v === '1' || v === 'true' } catch { return false } })()\r\n      if (owner && e === owner) { setIsAdmin(true); return }\r\n      if (force) { setIsAdmin(true); return }\r\n    } catch {}\r\n    if (e === 'daviesfamily108@gmail.com') { setIsAdmin(true); return }\r\n    fetchIsAdmin(e).then(v => { if (on) setIsAdmin(!!v) })\r\n    return () => { on = false }\r\n  }, [e])\r\n  return isAdmin\r\n}\r\n","// Demo pricing: base is £5 GBP. Convert to user currency for display.\r\nexport const BASE_PRICE_GBP = 5\r\n\r\n// Simple static FX rates for display (not for real billing). Updated rarely.\r\nconst FX: Record<string, number> = {\r\n\tGBP: 1,\r\n\tEUR: 1.16, // € per £\r\n\tUSD: 1.26, // $ per £\r\n\tAUD: 1.92,\r\n\tNZD: 2.08,\r\n\tCAD: 1.73,\r\n}\r\n\r\nexport function formatPriceInCurrency(currency: string, gbpAmount = BASE_PRICE_GBP) {\r\n\tconst cur = (currency || 'GBP').toUpperCase()\r\n\tconst rate = FX[cur] ?? 1\r\n\tconst val = gbpAmount * rate\r\n\ttry {\r\n\t\treturn new Intl.NumberFormat(undefined, { style: 'currency', currency: cur }).format(val)\r\n\t} catch {\r\n\t\t// Fallback\r\n\t\treturn `${cur} ${val.toFixed(2)}`\r\n\t}\r\n}\r\n\r\nexport function getUserCurrency(): string {\r\n\ttry {\r\n\t\t// Heuristic: infer from locale\r\n\t\tconst parts = new Intl.NumberFormat().resolvedOptions()\r\n\t\t// Example: en-GB -> GBP, en-US -> USD, en-AU -> AUD, etc. Not 100% accurate.\r\n\t\tconst m = String(parts.locale).toLowerCase()\r\n\t\tif (m.includes('-gb')) return 'GBP'\r\n\t\tif (m.includes('-ie') || m.includes('-de') || m.includes('-fr') || m.includes('-es') || m.includes('-it') || m.includes('-nl')) return 'EUR'\r\n\t\tif (m.includes('-us')) return 'USD'\r\n\t\tif (m.includes('-au')) return 'AUD'\r\n\t\tif (m.includes('-nz')) return 'NZD'\r\n\t\tif (m.includes('-ca')) return 'CAD'\r\n\t\treturn 'GBP'\r\n\t} catch {\r\n\t\treturn 'GBP'\r\n\t}\r\n}\r\n\r\n// Centralized Discord invite; override via VITE_DISCORD_INVITE_URL in Render/Netlify\r\nexport const DISCORD_INVITE_URL: string = (import.meta as any).env?.VITE_DISCORD_INVITE_URL || 'https://discord.gg/nCfT4hJz'\r\n","export type ApiPath = string;\r\n\r\nlet cachedBaseUrl: string | null = null;\r\n\r\nfunction computeApiBase(): string {\r\n  if (cachedBaseUrl) return cachedBaseUrl;\r\n  const envUrl = ((import.meta as any)?.env?.VITE_API_URL as string | undefined)?.trim();\r\n  if (envUrl) {\r\n    cachedBaseUrl = envUrl.replace(/\\/$/, '');\r\n    return cachedBaseUrl;\r\n  }\r\n  if (typeof window !== 'undefined') {\r\n    const { protocol, host, hostname } = window.location;\r\n    const sameOrigin = `${protocol}//${host}`;\r\n    if (hostname.endsWith('onrender.com') || hostname === 'localhost' || hostname === '127.0.0.1') {\r\n      cachedBaseUrl = sameOrigin.replace(/\\/$/, '');\r\n    } else {\r\n      cachedBaseUrl = 'https://ninedartnation.onrender.com';\r\n    }\r\n    return cachedBaseUrl;\r\n  }\r\n  // Fallback for build/test environments without window\r\n  cachedBaseUrl = 'https://ninedartnation.onrender.com';\r\n  return cachedBaseUrl;\r\n}\r\n\r\nfunction normalizePath(path: ApiPath): string {\r\n  if (/^https?:\\/\\//i.test(path)) return path;\r\n  const base = computeApiBase();\r\n  const cleanPath = path.startsWith('/') ? path : `/${path}`;\r\n  return `${base}${cleanPath}`;\r\n}\r\n\r\nexport function resolveApiUrl(path: ApiPath): string {\r\n  return normalizePath(path);\r\n}\r\n\r\nexport function apiFetch(path: ApiPath, init?: RequestInit) {\r\n  const url = resolveApiUrl(path);\r\n  return fetch(url, init);\r\n}\r\n\r\nexport function installApiInterceptor() {\r\n  if (typeof window === 'undefined' || typeof window.fetch !== 'function') return;\r\n  const anyWindow = window as typeof window & { __ndnApiPatched?: boolean };\r\n  if (anyWindow.__ndnApiPatched) return;\r\n  const originalFetch = window.fetch.bind(window);\r\n  window.fetch = (input: RequestInfo | URL, init?: RequestInit) => {\r\n    try {\r\n      if (typeof input === 'string') {\r\n        if (input.startsWith('/')) {\r\n          return originalFetch(resolveApiUrl(input), init);\r\n        }\r\n        return originalFetch(input, init);\r\n      }\r\n      if (input instanceof Request) {\r\n        const reqUrl = input.url.startsWith('/') ? resolveApiUrl(input.url) : input.url;\r\n        if (reqUrl === input.url) {\r\n          return originalFetch(input, init);\r\n        }\r\n        const cloned = new Request(reqUrl, input);\r\n        return originalFetch(cloned, init);\r\n      }\r\n      if (input instanceof URL) {\r\n        const href = input.href.startsWith('/') ? resolveApiUrl(input.href) : input.href;\r\n        return originalFetch(href, init);\r\n      }\r\n    } catch (err) {\r\n      console.warn('[API] Interceptor failed, falling back to original fetch', err);\r\n    }\r\n    return originalFetch(input as any, init);\r\n  };\r\n  anyWindow.__ndnApiPatched = true;\r\n}\r\n","import { LayoutDashboard, Camera, Users, Trophy, Settings, MessageCircle, Lock, PoundSterling, Bell } from 'lucide-react';\r\nimport { useEffect, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { getFreeRemaining } from '../utils/quota'\r\nimport { useIsAdmin } from '../utils/admin'\r\nimport { DISCORD_INVITE_URL } from '../utils/config'\r\nimport { apiFetch } from '../utils/api'\r\n\r\nexport type TabKey = 'score' | 'online' | 'offline' | 'friends' | 'stats' | 'calibrate' | 'settings' | 'admin' | 'tournaments' | 'fullaccess';\r\n\r\nexport function getTabs(user: any) {\r\n  const baseTabs = [\r\n    { key: 'score', label: 'Home', icon: LayoutDashboard },\r\n    { key: 'online', label: 'Online', icon: Users },\r\n    { key: 'offline', label: 'Offline', icon: Trophy },\r\n    { key: 'tournaments', label: 'Tournaments', icon: Trophy },\r\n    { key: 'friends', label: 'Friends', icon: Users },\r\n    { key: 'stats', label: 'Stats', icon: Trophy },\r\n    { key: 'calibrate', label: 'Calibrate', icon: Camera },\r\n    { key: 'settings', label: 'Settings', icon: Settings },\r\n  ];\r\n  // Admin tab visibility handled in Sidebar via hook (client-side fetch)\r\n  if (!user?.fullAccess) {\r\n    baseTabs.push({ key: 'fullaccess', label: 'PREMIUM £€$', icon: PoundSterling });\r\n  }\r\n  return baseTabs;\r\n}\r\n\r\nexport function Sidebar({\r\n  active,\r\n  onChange,\r\n  user,\r\n  className,\r\n}: {\r\n  active: TabKey;\r\n  onChange: (key: TabKey) => void;\r\n  user: any;\r\n  className?: string;\r\n}) {\r\n  const tabs = getTabs(user);\r\n  const isAdmin = useIsAdmin(user?.email)\r\n  // IMPORTANT: Admin tab is ONLY shown for explicitly granted admin users\r\n  // Premium status does NOT automatically grant admin access\r\n  // Admin access must be granted via /api/admins/grant endpoint by the owner\r\n  if (isAdmin && !tabs.some(t => t.key === 'admin')) {\r\n    const idx = tabs.findIndex(t => t.key === 'settings')\r\n    const adminTab = { key: 'admin', label: 'Admin', icon: Settings } as const\r\n    if (idx >= 0) tabs.splice(idx, 0, adminTab as any); else tabs.push(adminTab as any)\r\n  }\r\n  const [showDiscord, setShowDiscord] = useState(false);\r\n  const freeLeft = user?.username && !user?.fullAccess ? getFreeRemaining(user.username) : Infinity\r\n  \r\n  // Notification counts\r\n  const [notifications, setNotifications] = useState({\r\n    friendRequests: 0,\r\n    messages: 0,\r\n    tournaments: 0\r\n  });\r\n  \r\n  // Fetch notification counts\r\n  useEffect(() => {\r\n    if (!user?.email) return;\r\n    \r\n    const fetchNotifications = async () => {\r\n      try {\r\n        const [requestsRes, messagesRes] = await Promise.all([\r\n          apiFetch(`/api/friends/requests?email=${encodeURIComponent(user.email)}`),\r\n          apiFetch(`/api/friends/messages?email=${encodeURIComponent(user.email)}`)\r\n        ]);\r\n        \r\n        const requests = requestsRes.ok ? await requestsRes.json() : { requests: [] };\r\n        const messages = messagesRes.ok ? await messagesRes.json() : { messages: [] };\r\n        \r\n        // Count unread messages (messages without read status, assuming all are unread for now)\r\n        const unreadMessages = messages.messages?.filter((m: any) => !m.read).length || 0;\r\n        \r\n        setNotifications({\r\n          friendRequests: requests.requests?.length || 0,\r\n          messages: unreadMessages,\r\n          tournaments: 0 // TODO: Add tournament notifications\r\n        });\r\n      } catch (err) {\r\n        console.error('Failed to fetch notifications:', err);\r\n      }\r\n    };\r\n    \r\n    fetchNotifications();\r\n    // Refresh every 30 seconds\r\n    const interval = setInterval(fetchNotifications, 30000);\r\n    return () => clearInterval(interval);\r\n  }, [user?.email]);\r\n  \r\n  useEffect(() => {\r\n    if (!showDiscord) return\r\n    const onKey = (e: KeyboardEvent) => { if (e.key === 'Escape' || e.key === 'Enter') setShowDiscord(false) }\r\n    document.addEventListener('keydown', onKey)\r\n    return () => document.removeEventListener('keydown', onKey)\r\n  }, [showDiscord])\r\n  return (\r\n    <aside className={`${user?.fullAccess ? 'premium-sidebar' : ''} sidebar glass ${className ? '' : 'w-60'} p-2 sm:p-4 rounded-2xl ${className ?? 'hidden sm:flex'} flex-col gap-2 overflow-y-auto overflow-x-hidden ${className ? '' : 'fixed top-2 bottom-2 sm:top-4 sm:bottom-4'}`}>\r\n      {tabs.map(({ key, label, icon: Icon }) => {\r\n  if (key === 'admin' && !isAdmin) return null\r\n        return (\r\n        <button\r\n          key={key}\r\n          className={`tab whitespace-nowrap flex items-center justify-start gap-3 ${active === key ? 'tab--active' : 'tab--inactive'} ${key === 'fullaccess' ? '' : ''}`}\r\n          onClick={() => onChange(key as TabKey)}\r\n          title={label}\r\n          style={{ fontWeight: 700, fontSize: '1.1rem', color: active === key ? '#fff' : '#E5E7EB', letterSpacing: '0.02em' }}\r\n        >\r\n          <Icon className=\"w-6 h-6\" />\r\n          <span className=\"flex items-center gap-2\">\r\n            {label}\r\n            {key === 'online' && !user?.fullAccess && freeLeft <= 0 && (\r\n              <span title=\"Weekly free games used\" className=\"inline-flex items-center gap-1 text-[0.65rem] px-2 py-0.5 rounded-full bg-rose-600 text-white\">\r\n                <Lock className=\"w-3 h-3\" />\r\n                Locked\r\n              </span>\r\n            )}\r\n            {/* Notification badges */}\r\n            {key === 'friends' && notifications.friendRequests > 0 && (\r\n              <span className=\"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full\">\r\n                {notifications.friendRequests > 9 ? '9+' : notifications.friendRequests}\r\n              </span>\r\n            )}\r\n            {key === 'score' && (notifications.messages > 0 || notifications.tournaments > 0) && (\r\n              <span className=\"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full\">\r\n                {(notifications.messages + notifications.tournaments) > 9 ? '9+' : (notifications.messages + notifications.tournaments)}\r\n              </span>\r\n            )}\r\n          </span>\r\n          {/* Only the tab label should show PREMIUM; remove extra badge */}\r\n        </button>\r\n        )\r\n      })}\r\n      {/* Discord tab at the end */}\r\n      <button\r\n        className=\"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-2\"\r\n        onClick={() => setShowDiscord(true)}\r\n        title=\"BullseyeDartsLeague\"\r\n        style={{ fontWeight: 700, fontSize: '1.1rem', letterSpacing: '0.02em' }}\r\n      >\r\n        <MessageCircle className=\"w-6 h-6\" />\r\n        <span className=\"truncate\">BullseyeDartsLeague</span>\r\n      </button>\r\n      {/* Discord about dialog via portal */}\r\n      {showDiscord && createPortal(\r\n        <div className=\"fixed inset-0 z-[1000]\">\r\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setShowDiscord(false)} onTouchStart={() => setShowDiscord(false)} />\r\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\r\n            <div role=\"dialog\" aria-modal=\"true\" className=\"card max-w-md w-full relative text-left p-6 rounded-xl\">\r\n              <button className=\"absolute -top-3 -right-3 btn px-3 py-1\" aria-label=\"Close\" onClick={() => setShowDiscord(false)}>✕</button>\r\n              <h3 className=\"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]\">\r\n                <MessageCircle className=\"w-6 h-6\" /> BullseyeDartsLeague\r\n              </h3>\r\n              <div className=\"mb-4 text-lg font-semibold\">Join this fantastic Online Darts League with divisions and other cool stuff included</div>\r\n        <a\r\n          href={DISCORD_INVITE_URL}\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer nofollow\"\r\n                className=\"btn bg-[#5865F2] text-white w-full font-bold text-lg\"\r\n              >\r\n                Join Discord\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </aside>\r\n  )\r\n}\r\n","const createStoreImpl = (createState) => {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (!Object.is(nextState, state)) {\n      const previousState = state;\n      state = (replace != null ? replace : typeof nextState !== \"object\" || nextState === null) ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const getInitialState = () => initialState;\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const destroy = () => {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected.\"\n      );\n    }\n    listeners.clear();\n  };\n  const api = { setState, getState, getInitialState, subscribe, destroy };\n  const initialState = state = createState(setState, getState, api);\n  return api;\n};\nconst createStore = (createState) => createState ? createStoreImpl(createState) : createStoreImpl;\nvar vanilla = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use import { createStore } from 'zustand/vanilla'.\"\n    );\n  }\n  return createStore(createState);\n};\n\nexport { createStore, vanilla as default };\n","/**\n * @license React\n * use-sync-external-store-shim.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar React = require(\"react\");\nfunction is(x, y) {\n  return (x === y && (0 !== x || 1 / x === 1 / y)) || (x !== x && y !== y);\n}\nvar objectIs = \"function\" === typeof Object.is ? Object.is : is,\n  useState = React.useState,\n  useEffect = React.useEffect,\n  useLayoutEffect = React.useLayoutEffect,\n  useDebugValue = React.useDebugValue;\nfunction useSyncExternalStore$2(subscribe, getSnapshot) {\n  var value = getSnapshot(),\n    _useState = useState({ inst: { value: value, getSnapshot: getSnapshot } }),\n    inst = _useState[0].inst,\n    forceUpdate = _useState[1];\n  useLayoutEffect(\n    function () {\n      inst.value = value;\n      inst.getSnapshot = getSnapshot;\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n    },\n    [subscribe, value, getSnapshot]\n  );\n  useEffect(\n    function () {\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      return subscribe(function () {\n        checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      });\n    },\n    [subscribe]\n  );\n  useDebugValue(value);\n  return value;\n}\nfunction checkIfSnapshotChanged(inst) {\n  var latestGetSnapshot = inst.getSnapshot;\n  inst = inst.value;\n  try {\n    var nextValue = latestGetSnapshot();\n    return !objectIs(inst, nextValue);\n  } catch (error) {\n    return !0;\n  }\n}\nfunction useSyncExternalStore$1(subscribe, getSnapshot) {\n  return getSnapshot();\n}\nvar shim =\n  \"undefined\" === typeof window ||\n  \"undefined\" === typeof window.document ||\n  \"undefined\" === typeof window.document.createElement\n    ? useSyncExternalStore$1\n    : useSyncExternalStore$2;\nexports.useSyncExternalStore =\n  void 0 !== React.useSyncExternalStore ? React.useSyncExternalStore : shim;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim.production.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim.development.js');\n}\n","/**\n * @license React\n * use-sync-external-store-shim/with-selector.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar React = require(\"react\"),\n  shim = require(\"use-sync-external-store/shim\");\nfunction is(x, y) {\n  return (x === y && (0 !== x || 1 / x === 1 / y)) || (x !== x && y !== y);\n}\nvar objectIs = \"function\" === typeof Object.is ? Object.is : is,\n  useSyncExternalStore = shim.useSyncExternalStore,\n  useRef = React.useRef,\n  useEffect = React.useEffect,\n  useMemo = React.useMemo,\n  useDebugValue = React.useDebugValue;\nexports.useSyncExternalStoreWithSelector = function (\n  subscribe,\n  getSnapshot,\n  getServerSnapshot,\n  selector,\n  isEqual\n) {\n  var instRef = useRef(null);\n  if (null === instRef.current) {\n    var inst = { hasValue: !1, value: null };\n    instRef.current = inst;\n  } else inst = instRef.current;\n  instRef = useMemo(\n    function () {\n      function memoizedSelector(nextSnapshot) {\n        if (!hasMemo) {\n          hasMemo = !0;\n          memoizedSnapshot = nextSnapshot;\n          nextSnapshot = selector(nextSnapshot);\n          if (void 0 !== isEqual && inst.hasValue) {\n            var currentSelection = inst.value;\n            if (isEqual(currentSelection, nextSnapshot))\n              return (memoizedSelection = currentSelection);\n          }\n          return (memoizedSelection = nextSnapshot);\n        }\n        currentSelection = memoizedSelection;\n        if (objectIs(memoizedSnapshot, nextSnapshot)) return currentSelection;\n        var nextSelection = selector(nextSnapshot);\n        if (void 0 !== isEqual && isEqual(currentSelection, nextSelection))\n          return (memoizedSnapshot = nextSnapshot), currentSelection;\n        memoizedSnapshot = nextSnapshot;\n        return (memoizedSelection = nextSelection);\n      }\n      var hasMemo = !1,\n        memoizedSnapshot,\n        memoizedSelection,\n        maybeGetServerSnapshot =\n          void 0 === getServerSnapshot ? null : getServerSnapshot;\n      return [\n        function () {\n          return memoizedSelector(getSnapshot());\n        },\n        null === maybeGetServerSnapshot\n          ? void 0\n          : function () {\n              return memoizedSelector(maybeGetServerSnapshot());\n            }\n      ];\n    },\n    [getSnapshot, getServerSnapshot, selector, isEqual]\n  );\n  var value = useSyncExternalStore(subscribe, instRef[0], instRef[1]);\n  useEffect(\n    function () {\n      inst.hasValue = !0;\n      inst.value = value;\n    },\n    [value]\n  );\n  useDebugValue(value);\n  return value;\n};\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim/with-selector.production.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim/with-selector.development.js');\n}\n","import { createStore } from 'zustand/vanilla';\nexport * from 'zustand/vanilla';\nimport ReactExports from 'react';\nimport useSyncExternalStoreExports from 'use-sync-external-store/shim/with-selector.js';\n\nconst { useDebugValue } = ReactExports;\nconst { useSyncExternalStoreWithSelector } = useSyncExternalStoreExports;\nlet didWarnAboutEqualityFn = false;\nconst identity = (arg) => arg;\nfunction useStore(api, selector = identity, equalityFn) {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && equalityFn && !didWarnAboutEqualityFn) {\n    console.warn(\n      \"[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937\"\n    );\n    didWarnAboutEqualityFn = true;\n  }\n  const slice = useSyncExternalStoreWithSelector(\n    api.subscribe,\n    api.getState,\n    api.getServerState || api.getInitialState,\n    selector,\n    equalityFn\n  );\n  useDebugValue(slice);\n  return slice;\n}\nconst createImpl = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && typeof createState !== \"function\") {\n    console.warn(\n      \"[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.\"\n    );\n  }\n  const api = typeof createState === \"function\" ? createStore(createState) : createState;\n  const useBoundStore = (selector, equalityFn) => useStore(api, selector, equalityFn);\n  Object.assign(useBoundStore, api);\n  return useBoundStore;\n};\nconst create = (createState) => createState ? createImpl(createState) : createImpl;\nvar react = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`.\"\n    );\n  }\n  return create(createState);\n};\n\nexport { create, react as default, useStore };\n","import { create } from 'zustand'\r\n\r\ntype Toast = { id: number; message: string; type?: 'info'|'success'|'error'; timeout?: number }\r\n\r\ntype ToastState = {\r\n  toasts: Toast[]\r\n  push: (message: string, opts?: { type?: 'info'|'success'|'error'; timeout?: number }) => void\r\n  remove: (id: number) => void\r\n  clear: () => void\r\n}\r\n\r\nlet nextId = 1\r\n\r\nexport const useToastStore = create<ToastState>((set) => ({\r\n  toasts: [],\r\n  push: (message, opts) => set((s) => {\r\n    const id = nextId++\r\n    const t: Toast = { id, message, type: opts?.type || 'info', timeout: opts?.timeout ?? 3000 }\r\n    // auto-remove after timeout\r\n    if (t.timeout && t.timeout > 0) {\r\n      setTimeout(() => {\r\n        set((cur) => ({ toasts: cur.toasts.filter(x => x.id !== id) }))\r\n      }, t.timeout)\r\n    }\r\n    return { toasts: [...s.toasts, t] }\r\n  }),\r\n  remove: (id) => set((s) => ({ toasts: s.toasts.filter(t => t.id !== id) })),\r\n  clear: () => set({ toasts: [] }),\r\n}))\r\n\r\nexport function useToast() {\r\n  const push = useToastStore(s => s.push)\r\n  return push\r\n}\r\n","export function threeDartAverage(totalScore: number, darts: number): number {\r\n  if (darts === 0) return 0\r\n  return (totalScore / darts) * 3\r\n}\r\n\r\nexport function formatAvg(n?: number) {\r\n  return (n ?? 0).toFixed(2)\r\n}\r\n","export type AllTimeTotals = {\r\n  darts: number\r\n  scored: number\r\n  fnDarts?: number\r\n  fnScored?: number\r\n  // All-time quality metrics\r\n  best3?: number // highest 3-dart avg achieved in a finished leg\r\n  worst3?: number // lowest 3-dart avg achieved in a finished leg\r\n  bestLegDarts?: number // fewest darts to finish a winning leg\r\n  bestCheckout?: number // highest checkout score achieved\r\n  worstLegDarts?: number // most darts in a winning leg (optional)\r\n  bestFNAvg?: number // best per-leg first-nine average\r\n  worstFNAvg?: number // worst per-leg first-nine average\r\n}\r\ntype StatEntry = { t: number; darts: number; scored: number; fnDarts?: number; fnScored?: number }\r\nexport type GameModeStat = { played: number; won: number }\r\nexport type GameModeStats = Record<string, GameModeStat>\r\n\r\nconst keyFor = (name: string) => `ndn_stats_${name}`\r\nconst keySeriesFor = (name: string) => `ndn_stats_ts_${name}`\r\nconst keyDailyFor = (name: string) => `ndn_stats_daily_${name}`\r\n\r\nexport function getAllTime(name: string): AllTimeTotals {\r\n  try {\r\n    const raw = localStorage.getItem(keyFor(name))\r\n    if (!raw) return { darts: 0, scored: 0 }\r\n    const parsed = JSON.parse(raw)\r\n    return {\r\n      darts: Number(parsed.darts) || 0,\r\n      scored: Number(parsed.scored) || 0,\r\n      fnDarts: Number(parsed.fnDarts) || 0,\r\n      fnScored: Number(parsed.fnScored) || 0,\r\n      best3: typeof parsed.best3 === 'number' ? parsed.best3 : 0,\r\n      worst3: typeof parsed.worst3 === 'number' ? parsed.worst3 : 0,\r\n      bestLegDarts: typeof parsed.bestLegDarts === 'number' ? parsed.bestLegDarts : 0,\r\n      bestCheckout: typeof parsed.bestCheckout === 'number' ? parsed.bestCheckout : 0,\r\n      worstLegDarts: typeof parsed.worstLegDarts === 'number' ? parsed.worstLegDarts : 0,\r\n      bestFNAvg: typeof parsed.bestFNAvg === 'number' ? parsed.bestFNAvg : 0,\r\n      worstFNAvg: typeof parsed.worstFNAvg === 'number' ? parsed.worstFNAvg : 0,\r\n    }\r\n  } catch {\r\n    return { darts: 0, scored: 0 }\r\n  }\r\n}\r\n\r\nexport function setAllTime(name: string, totals: AllTimeTotals) {\r\n  try {\r\n    localStorage.setItem(keyFor(name), JSON.stringify(totals))\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { name, totals } }))\r\n  } catch {}\r\n}\r\n\r\n// Clear all stored stats for a user (all-time totals, time-series, and daily snapshot)\r\nexport function clearAllStats(name: string) {\r\n  try {\r\n    localStorage.removeItem(keyFor(name))\r\n    localStorage.removeItem(keySeriesFor(name))\r\n    localStorage.removeItem(keyDailyFor(name))\r\n  } catch {}\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { name, cleared: true } }))\r\n  } catch {}\r\n}\r\n\r\nexport function getAllTimeAvg(name: string): number {\r\n  const { darts, scored } = getAllTime(name)\r\n  if (!darts) return 0\r\n  return (scored / darts) * 3\r\n}\r\n\r\nexport function getAllTimeFirstNineAvg(name: string): number {\r\n  const { fnDarts = 0, fnScored = 0 } = getAllTime(name)\r\n  if (!fnDarts) return 0\r\n  return (fnScored / fnDarts) * 3\r\n}\r\n\r\n// All-time quality metric getters\r\nexport function getAllTimeBestWorst(name: string): { best3: number; worst3: number } {\r\n  const { best3 = 0, worst3 = 0 } = getAllTime(name)\r\n  return { best3, worst3 }\r\n}\r\nexport function getAllTimeBestLeg(name: string): number {\r\n  const { bestLegDarts = 0 } = getAllTime(name)\r\n  return bestLegDarts || 0\r\n}\r\nexport function getAllTimeBestCheckout(name: string): number {\r\n  const { bestCheckout = 0 } = getAllTime(name)\r\n  return bestCheckout || 0\r\n}\r\n\r\n// --- Per-game-mode played/won stats (local-only demo) ---\r\nconst keyGameModes = 'ndn_game_mode_stats'\r\n\r\nexport function getGameModeStats(allModeKeys?: string[]): GameModeStats {\r\n  let obj: GameModeStats = {}\r\n  try {\r\n    const raw = localStorage.getItem(keyGameModes)\r\n    if (raw) obj = JSON.parse(raw)\r\n  } catch {}\r\n  // Ensure requested keys exist with zeros so charts are stable\r\n  if (Array.isArray(allModeKeys)) {\r\n    for (const k of allModeKeys) {\r\n      if (!obj[k]) obj[k] = { played: 0, won: 0 }\r\n    }\r\n  }\r\n  return obj\r\n}\r\n\r\nexport function setGameModeStats(stats: GameModeStats) {\r\n  try {\r\n    localStorage.setItem(keyGameModes, JSON.stringify(stats))\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { gameModes: true } }))\r\n  } catch {}\r\n}\r\n\r\nexport function bumpGameMode(mode: string, won: boolean) {\r\n  const current = getGameModeStats()\r\n  const entry = current[mode] || { played: 0, won: 0 }\r\n  entry.played += 1\r\n  if (won) entry.won += 1\r\n  current[mode] = entry\r\n  setGameModeStats(current)\r\n}\r\n\r\n// Time-series helpers for rolling averages\r\nfunction getSeries(name: string): StatEntry[] {\r\n  try {\r\n    const raw = localStorage.getItem(keySeriesFor(name))\r\n    if (!raw) return []\r\n    const arr = JSON.parse(raw)\r\n    if (!Array.isArray(arr)) return []\r\n    return arr.map((e: any) => ({\r\n      t: Number(e.t)||0,\r\n      darts: Number(e.darts)||0,\r\n      scored: Number(e.scored)||0,\r\n      fnDarts: Number(e.fnDarts)||0,\r\n      fnScored: Number(e.fnScored)||0,\r\n    })).filter(e => e.t > 0)\r\n  } catch { return [] }\r\n}\r\n\r\nfunction setSeries(name: string, entries: StatEntry[]) {\r\n  try {\r\n    localStorage.setItem(keySeriesFor(name), JSON.stringify(entries))\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { name } }))\r\n  } catch {}\r\n}\r\n\r\nfunction pruneOld(entries: StatEntry[], maxAgeMs: number): StatEntry[] {\r\n  const now = Date.now()\r\n  return entries.filter(e => now - e.t <= maxAgeMs)\r\n}\r\n\r\nexport function addSample(name: string, darts: number, scored: number, when: number = Date.now(), fnDarts?: number, fnScored?: number) {\r\n  if (darts <= 0) return\r\n  const list = getSeries(name)\r\n  const next = pruneOld([...list, { t: when, darts, scored, fnDarts, fnScored }], 1000 * 60 * 60 * 24 * 30) // keep ~30 days\r\n  setSeries(name, next)\r\n}\r\n\r\nexport function getRollingAvg(name: string, windowMs: number = 1000 * 60 * 60 * 24): number {\r\n  const list = getSeries(name)\r\n  if (!list.length) return 0\r\n  const now = Date.now()\r\n  let darts = 0, scored = 0\r\n  for (const e of list) {\r\n    if (now - e.t <= windowMs) { darts += e.darts; scored += e.scored }\r\n  }\r\n  if (darts <= 0) return 0\r\n  return (scored / darts) * 3\r\n}\r\n\r\nexport function getRollingFirstNineAvg(name: string, windowMs: number = 1000 * 60 * 60 * 24 * 30): number {\r\n  const list = getSeries(name)\r\n  if (!list.length) return 0\r\n  const now = Date.now()\r\n  let darts = 0, scored = 0\r\n  for (const e of list) {\r\n    if (now - e.t <= windowMs) {\r\n      darts += (e.fnDarts || 0)\r\n      scored += (e.fnScored || 0)\r\n    }\r\n  }\r\n  if (darts <= 0) return 0\r\n  return (scored / darts) * 3\r\n}\r\n\r\n// Daily adjusted average: recompute from last 24h at most once per 24h and persist the last value\r\ntype DailySnapshot = { avg: number; ts: number }\r\n\r\nfunction getDailySnapshot(name: string): DailySnapshot | null {\r\n  try {\r\n    const raw = localStorage.getItem(keyDailyFor(name))\r\n    if (!raw) return null\r\n    const j = JSON.parse(raw)\r\n    return { avg: Number(j.avg) || 0, ts: Number(j.ts) || 0 }\r\n  } catch { return null }\r\n}\r\n\r\nfunction setDailySnapshot(name: string, snap: DailySnapshot) {\r\n  try {\r\n    localStorage.setItem(keyDailyFor(name), JSON.stringify(snap))\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { name } }))\r\n  } catch {}\r\n}\r\n\r\nexport function getDailyAdjustedAvg(name: string): number {\r\n  const snap = getDailySnapshot(name)\r\n  const now = Date.now()\r\n  const DAY = 1000 * 60 * 60 * 24\r\n  if (snap && now - snap.ts < DAY) return snap.avg\r\n  // Need to compute a new daily value from the last 24h of samples\r\n  const ra = getRollingAvg(name, DAY)\r\n  const next: DailySnapshot = { avg: ra, ts: now }\r\n  setDailySnapshot(name, next)\r\n  return ra\r\n}\r\n\r\n// Convenience helpers for monthly (last ~30 days) averages\r\nexport function getMonthlyAvg3(name: string): number {\r\n  const THIRTY_DAYS = 1000 * 60 * 60 * 24 * 30\r\n  const list = getSeries(name)\r\n  if (!list.length) return 0\r\n  const now = Date.now()\r\n  // Prefer match-aggregated entries (those with fnDarts defined) to avoid double counting with per-visit samples\r\n  const windowed = list.filter(e => now - e.t <= THIRTY_DAYS)\r\n  const matchOnly = windowed.filter(e => typeof e.fnDarts === 'number')\r\n  const use = matchOnly.length ? matchOnly : windowed\r\n  let darts = 0, scored = 0\r\n  for (const e of use) { darts += e.darts; scored += e.scored }\r\n  if (darts <= 0) return 0\r\n  return (scored / darts) * 3\r\n}\r\nexport function getMonthlyFirstNineAvg(name: string): number {\r\n  const THIRTY_DAYS = 1000 * 60 * 60 * 24 * 30\r\n  return getRollingFirstNineAvg(name, THIRTY_DAYS)\r\n}\r\n\r\n// Update all players' all-time totals given a finished match roster\r\nimport type { Player, Leg } from './match'\r\nexport function addMatchToAllTime(players: Player[]) {\r\n  for (const p of players) {\r\n    // Sum over finished legs\r\n    let darts = 0\r\n    let scored = 0\r\n    let fnDarts = 0\r\n    let fnScored = 0\r\n    // Per-match quality metrics\r\n    let matchBest3 = 0\r\n    let matchWorst3 = 0\r\n    let matchBestLegDarts = 0 // track fewest darts on a winning leg only\r\n    let matchBestCheckout = 0\r\n    let matchWorstLegDarts = 0 // most darts on a winning leg\r\n    let matchBestFNAvg = 0\r\n    let matchWorstFNAvg = 0\r\n    for (const leg of p.legs) {\r\n      if (!leg.finished) continue\r\n      darts += leg.dartsThrown\r\n      scored += Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining)\r\n      // First nine darts aggregation (or fewer if leg ended earlier)\r\n      const { d: legFnDarts, s: legFnScored } = sumFirstNine(leg)\r\n      fnDarts += legFnDarts\r\n      fnScored += legFnScored\r\n      // Quality metrics per leg\r\n      const legDarts = Math.max(0, leg.dartsThrown)\r\n      const legScored = Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining)\r\n      const legAvg = legDarts > 0 ? (legScored / legDarts) * 3 : 0\r\n      const legFNAvg = legFnDarts > 0 ? (legFnScored / legFnDarts) * 3 : 0\r\n      if (legAvg > 0) {\r\n        matchBest3 = Math.max(matchBest3, legAvg)\r\n        matchWorst3 = matchWorst3 === 0 ? legAvg : Math.min(matchWorst3, legAvg)\r\n      }\r\n      if (legFNAvg > 0) {\r\n        matchBestFNAvg = Math.max(matchBestFNAvg, legFNAvg)\r\n        matchWorstFNAvg = matchWorstFNAvg === 0 ? legFNAvg : Math.min(matchWorstFNAvg, legFNAvg)\r\n      }\r\n      const wasCheckout = leg.totalScoreRemaining === 0\r\n      if (wasCheckout) {\r\n        if (matchBestLegDarts === 0 || legDarts < matchBestLegDarts) matchBestLegDarts = legDarts\r\n        if (matchWorstLegDarts === 0 || legDarts > matchWorstLegDarts) matchWorstLegDarts = legDarts\r\n        const co = typeof leg.checkoutScore === 'number' ? leg.checkoutScore : 0\r\n        if (co > matchBestCheckout) matchBestCheckout = co\r\n      }\r\n    }\r\n    if (darts > 0) {\r\n      const prev = getAllTime(p.name)\r\n      const next: AllTimeTotals = {\r\n        darts: prev.darts + darts,\r\n        scored: prev.scored + scored,\r\n        fnDarts: (prev.fnDarts || 0) + fnDarts,\r\n        fnScored: (prev.fnScored || 0) + fnScored,\r\n        best3: Math.max(prev.best3 || 0, matchBest3 || 0),\r\n        // For worst3, treat 0 as \"unset\"; choose the min positive across history\r\n        worst3: (() => {\r\n          const prior = prev.worst3 || 0\r\n          if (prior === 0) return matchWorst3 || 0\r\n          if (matchWorst3 === 0) return prior\r\n          return Math.min(prior, matchWorst3)\r\n        })(),\r\n        // Fewest darts on winning leg; 0 means no winning legs recorded yet\r\n        bestLegDarts: (() => {\r\n          const prior = prev.bestLegDarts || 0\r\n          if (prior === 0) return matchBestLegDarts || 0\r\n          if (matchBestLegDarts === 0) return prior\r\n          return Math.min(prior, matchBestLegDarts)\r\n        })(),\r\n        bestCheckout: Math.max(prev.bestCheckout || 0, matchBestCheckout || 0),\r\n        worstLegDarts: (() => {\r\n          const prior = prev.worstLegDarts || 0\r\n          if (prior === 0) return matchWorstLegDarts || 0\r\n          if (matchWorstLegDarts === 0) return prior\r\n          return Math.max(prior, matchWorstLegDarts)\r\n        })(),\r\n        bestFNAvg: Math.max(prev.bestFNAvg || 0, matchBestFNAvg || 0),\r\n        worstFNAvg: (() => {\r\n          const prior = prev.worstFNAvg || 0\r\n          if (prior === 0) return matchWorstFNAvg || 0\r\n          if (matchWorstFNAvg === 0) return prior\r\n          return Math.min(prior, matchWorstFNAvg)\r\n        })(),\r\n      }\r\n      setAllTime(p.name, next)\r\n      // Also add a time-series sample for rolling averages\r\n      addSample(p.name, darts, scored, Date.now(), fnDarts, fnScored)\r\n    }\r\n  }\r\n}\r\n\r\n// Helper: sum points and darts for the first 9 darts of a leg (or fewer if finished earlier)\r\nfunction sumFirstNine(leg: Leg): { d: number; s: number } {\r\n  let remain = Math.min(9, leg.dartsThrown)\r\n  if (remain <= 0) return { d: 0, s: 0 }\r\n  let s = 0\r\n  for (const v of leg.visits) {\r\n    if (remain <= 0) break\r\n    const take = Math.min(remain, v.darts)\r\n    // Pro-rate score if partial darts from a visit are included\r\n    if (take === v.darts) s += v.score\r\n    else s += Math.round((v.score / v.darts) * take)\r\n    remain -= take\r\n  }\r\n  const d = Math.min(9, leg.dartsThrown)\r\n  return { d, s }\r\n}\r\n","import { create } from 'zustand'\r\n\r\ntype LastOffline = { mode: string; x01Start: number; firstTo: number; aiLevel: string }\r\n\r\ntype SettingsState = {\r\n  favoriteDouble: string\r\n  callerEnabled: boolean\r\n  callerVoice: string // voice name\r\n  callerVolume: number // 0..1\r\n  speakCheckoutOnly: boolean\r\n  avgMode: 'all-time' | '24h'\r\n  autoStartOffline: boolean\r\n  rememberLastOffline: boolean\r\n  lastOffline: LastOffline\r\n  reducedMotion: boolean\r\n  compactHeader: boolean\r\n  allowSpectate: boolean\r\n  // UI tuning\r\n  cameraScale: number // 0.5 .. 1.25\r\n  cameraAspect?: 'wide' | 'square'\r\n  // External autoscore provider\r\n  autoscoreProvider?: 'built-in' | 'external-ws' | 'manual'\r\n  autoscoreWsUrl?: string\r\n  calibrationGuide: boolean\r\n  // Devices & preferences\r\n  preferredCameraId?: string\r\n  preferredCameraLabel?: string\r\n  preferredCameraLocked?: boolean\r\n  // Camera control\r\n  cameraEnabled: boolean\r\n  // UI variants\r\n  offlineLayout?: 'classic' | 'modern'\r\n  // Text size\r\n  textSize: 'small' | 'medium' | 'large'\r\n  // Box size\r\n  boxSize: 'small' | 'medium' | 'large'\r\n  setFavoriteDouble: (d: string) => void\r\n  setCallerEnabled: (v: boolean) => void\r\n  setCallerVoice: (name: string) => void\r\n  setAvgMode: (mode: 'all-time' | '24h') => void\r\n  setCallerVolume: (v: number) => void\r\n  setSpeakCheckoutOnly: (v: boolean) => void\r\n  setAutoStartOffline: (v: boolean) => void\r\n  setRememberLastOffline: (v: boolean) => void\r\n  setLastOffline: (cfg: Partial<LastOffline>) => void\r\n  setReducedMotion: (v: boolean) => void\r\n  setCompactHeader: (v: boolean) => void\r\n  setAllowSpectate: (v: boolean) => void\r\n  setCameraScale: (n: number) => void\r\n  setCameraAspect: (a: 'wide' | 'square') => void\r\n  setCalibrationGuide: (v: boolean) => void\r\n  setPreferredCamera: (id: string|undefined, label?: string, force?: boolean) => void\r\n  setPreferredCameraLocked: (v: boolean) => void\r\n  setCameraEnabled: (v: boolean) => void\r\n  setOfflineLayout: (mode: 'classic'|'modern') => void\r\n  setAutoscoreProvider: (p: 'built-in' | 'external-ws' | 'manual') => void\r\n  setAutoscoreWsUrl: (u: string) => void\r\n  setTextSize: (size: 'small' | 'medium' | 'large') => void\r\n  setBoxSize: (size: 'small' | 'medium' | 'large') => void\r\n}\r\nconst KEY = 'ndn_user_settings'\r\n\r\nfunction load(): Pick<SettingsState, 'favoriteDouble' | 'callerEnabled' | 'callerVoice' | 'avgMode' | 'callerVolume' | 'speakCheckoutOnly' | 'autoStartOffline' | 'rememberLastOffline' | 'lastOffline' | 'reducedMotion' | 'compactHeader' | 'allowSpectate' | 'cameraScale' | 'cameraAspect' | 'calibrationGuide' | 'preferredCameraId' | 'preferredCameraLabel' | 'preferredCameraLocked' | 'cameraEnabled' | 'offlineLayout' | 'autoscoreProvider' | 'autoscoreWsUrl' | 'textSize' | 'boxSize'> {\r\n  try {\r\n    const raw = localStorage.getItem(KEY)\r\n  if (!raw) return { favoriteDouble: 'D16', callerEnabled: true, callerVoice: '', callerVolume: 1, speakCheckoutOnly: false, avgMode: 'all-time', autoStartOffline: false, rememberLastOffline: true, lastOffline: { mode: 'X01', x01Start: 501, firstTo: 1, aiLevel: 'None' }, reducedMotion: false, compactHeader: false, allowSpectate: true, cameraScale: 1.0, cameraAspect: 'wide', calibrationGuide: true, preferredCameraId: undefined, preferredCameraLabel: undefined, cameraEnabled: true, offlineLayout: 'modern', autoscoreProvider: 'built-in', autoscoreWsUrl: '', textSize: 'medium', boxSize: 'medium' }\r\n    const j = JSON.parse(raw)\r\n    return {\r\n      favoriteDouble: j.favoriteDouble || 'D16',\r\n      callerEnabled: typeof j.callerEnabled === 'boolean' ? j.callerEnabled : true,\r\n      callerVoice: j.callerVoice || '',\r\n      callerVolume: (typeof j.callerVolume === 'number') ? Math.max(0, Math.min(1, j.callerVolume)) : 1,\r\n      speakCheckoutOnly: !!j.speakCheckoutOnly,\r\n      avgMode: j.avgMode === '24h' ? '24h' : 'all-time',\r\n      autoStartOffline: !!j.autoStartOffline,\r\n      rememberLastOffline: (typeof j.rememberLastOffline === 'boolean') ? j.rememberLastOffline : true,\r\n      lastOffline: j.lastOffline && typeof j.lastOffline === 'object' ? {\r\n        mode: j.lastOffline.mode || 'X01',\r\n        x01Start: Number(j.lastOffline.x01Start) || 501,\r\n        firstTo: Number(j.lastOffline.firstTo) || 1,\r\n        aiLevel: j.lastOffline.aiLevel || 'None'\r\n      } : { mode: 'X01', x01Start: 501, firstTo: 1, aiLevel: 'None' },\r\n      reducedMotion: !!j.reducedMotion,\r\n      compactHeader: !!j.compactHeader,\r\n      allowSpectate: (typeof j.allowSpectate === 'boolean') ? j.allowSpectate : true,\r\n  cameraScale: (typeof j.cameraScale === 'number' && isFinite(j.cameraScale)) ? Math.max(0.5, Math.min(1.25, j.cameraScale)) : 1.0,\r\n  cameraAspect: j.cameraAspect === 'square' ? 'square' : 'wide',\r\n  autoscoreProvider: (j.autoscoreProvider === 'external-ws') ? 'external-ws' : (j.autoscoreProvider === 'manual' ? 'manual' : 'built-in'),\r\n  autoscoreWsUrl: typeof j.autoscoreWsUrl === 'string' ? j.autoscoreWsUrl : '',\r\n      calibrationGuide: (typeof j.calibrationGuide === 'boolean') ? j.calibrationGuide : true,\r\n  preferredCameraId: typeof j.preferredCameraId === 'string' ? j.preferredCameraId : undefined,\r\n  preferredCameraLabel: typeof j.preferredCameraLabel === 'string' ? j.preferredCameraLabel : undefined,\r\n  preferredCameraLocked: (typeof j.preferredCameraLocked === 'boolean') ? j.preferredCameraLocked : false,\r\n      cameraEnabled: (typeof j.cameraEnabled === 'boolean') ? j.cameraEnabled : true,\r\n      offlineLayout: j.offlineLayout === 'classic' ? 'classic' : 'modern',\r\n      textSize: (j.textSize === 'small' || j.textSize === 'large') ? j.textSize : 'medium',\r\n      boxSize: (j.boxSize === 'small' || j.boxSize === 'large') ? j.boxSize : 'medium',\r\n    }\r\n  } catch {\r\n  return { favoriteDouble: 'D16', callerEnabled: true, callerVoice: '', callerVolume: 1, speakCheckoutOnly: false, avgMode: 'all-time', autoStartOffline: false, rememberLastOffline: true, lastOffline: { mode: 'X01', x01Start: 501, firstTo: 1, aiLevel: 'None' }, reducedMotion: false, compactHeader: false, allowSpectate: true, cameraScale: 1.0, cameraAspect: 'wide', calibrationGuide: true, preferredCameraId: undefined, preferredCameraLabel: undefined, preferredCameraLocked: false, cameraEnabled: true, offlineLayout: 'modern', autoscoreProvider: 'built-in', autoscoreWsUrl: '', textSize: 'medium', boxSize: 'medium' }\r\n  }\r\n}\r\n\r\nfunction save(partial: Partial<SettingsState>) {\r\n  try {\r\n    const prev = load()\r\n    localStorage.setItem(KEY, JSON.stringify({ ...prev, ...partial }))\r\n  } catch {}\r\n}\r\n\r\nexport const useUserSettings = create<SettingsState>((set, get) => ({\r\n  ...load(),\r\n  setFavoriteDouble: (d) => { save({ favoriteDouble: d }); set({ favoriteDouble: d }) },\r\n  setCallerEnabled: (v) => { save({ callerEnabled: v }); set({ callerEnabled: v }) },\r\n  setCallerVoice: (name) => { save({ callerVoice: name }); set({ callerVoice: name }) },\r\n  setAvgMode: (mode) => { save({ avgMode: mode }); set({ avgMode: mode }) },\r\n  setCallerVolume: (v) => { const vol = Math.max(0, Math.min(1, v)); save({ callerVolume: vol }); set({ callerVolume: vol }) },\r\n  setSpeakCheckoutOnly: (v) => { save({ speakCheckoutOnly: v }); set({ speakCheckoutOnly: v }) },\r\n  setAutoStartOffline: (v) => { save({ autoStartOffline: v }); set({ autoStartOffline: v }) },\r\n  setRememberLastOffline: (v) => { save({ rememberLastOffline: v }); set({ rememberLastOffline: v }) },\r\n  setLastOffline: (cfg) => { const prev = load().lastOffline; const next = { ...prev, ...cfg }; save({ lastOffline: next }); set({ lastOffline: next }) },\r\n  setReducedMotion: (v) => { save({ reducedMotion: v }); set({ reducedMotion: v }) },\r\n  setCompactHeader: (v) => { save({ compactHeader: v }); set({ compactHeader: v }) },\r\n  setAllowSpectate: (v) => { save({ allowSpectate: v }); set({ allowSpectate: v }) },\r\n  setCameraScale: (n) => { const s = Math.max(0.5, Math.min(1.25, n)); save({ cameraScale: s }); set({ cameraScale: s }) },\r\n  setCameraAspect: (a) => { const v = (a === 'square') ? 'square' : 'wide'; save({ cameraAspect: v }); set({ cameraAspect: v }) },\r\n  setAutoscoreProvider: (p) => { save({ autoscoreProvider: p }); set({ autoscoreProvider: p }) },\r\n  setAutoscoreWsUrl: (u) => { save({ autoscoreWsUrl: u }); set({ autoscoreWsUrl: u }) },\r\n  setCalibrationGuide: (v) => { save({ calibrationGuide: v }); set({ calibrationGuide: v }) },\r\n  setPreferredCamera: (id, label, force = false) => {\r\n    try {\r\n      const state = get()\r\n      if (state.preferredCameraLocked && !force) {\r\n        // Locked: ignore programmatic updates unless explicitly forced by user action\r\n        return\r\n      }\r\n    } catch {}\r\n    save({ preferredCameraId: id, preferredCameraLabel: label });\r\n    set({ preferredCameraId: id, preferredCameraLabel: label })\r\n  },\r\n  setPreferredCameraLocked: (v) => { save({ preferredCameraLocked: v }); set({ preferredCameraLocked: v }) },\r\n  setCameraEnabled: (v) => { save({ cameraEnabled: v }); set({ cameraEnabled: v }) },\r\n  setOfflineLayout: (mode) => { save({ offlineLayout: mode }); set({ offlineLayout: mode }) },\r\n  setTextSize: (size) => { save({ textSize: size }); set({ textSize: size }) },\r\n  setBoxSize: (size) => { save({ boxSize: size }); set({ boxSize: size }) },\r\n}))\r\n","import { useEffect, useState } from 'react';\r\nimport { useToast } from '../store/toast';\r\nimport { formatAvg } from '../utils/stats'\r\nimport { getAllTime } from '../store/profileStats'\r\nimport { STRIPE_CHECKOUT_URL } from '../utils/stripe'\r\nimport { useUserSettings } from '../store/userSettings'\r\n\r\nfunction goTab(tab: string) {\r\n  try { window.dispatchEvent(new CustomEvent('ndn:change-tab', { detail: { tab } })) } catch {}\r\n}\r\n\r\nconst API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n\r\nexport default function Home({ user }: { user?: any }) {\r\n  const [showLegal, setShowLegal] = useState(false);\r\n  const [showHowTo, setShowHowTo] = useState(false);\r\n  const [fact, setFact] = useState<string>('');\r\n  const { lastOffline } = useUserSettings()\r\n  const toast = useToast();\r\n\r\n  // Rotate a random \"Did you know?\" each time Home mounts\r\n  useEffect(() => {\r\n    const facts: string[] = [\r\n      'The fastest televised 9-darter took roughly 25 seconds!',\r\n      'A perfect leg (501) can be finished in nine darts.',\r\n      'The inner bull is worth 50; the outer bull is 25.',\r\n      'Standard dartboards are made from compressed sisal fibers.',\r\n      'Doubles and trebles are the thin outer and middle rings.',\r\n      'Professional oche (throw line) distance is 7 ft 9¼ in (2.37 m).',\r\n      '“Dartitis” is a real condition affecting a player’s throwing motion.',\r\n      'Phil Taylor holds a record number of World Championship titles.',\r\n      'Checkout routes often end on a double—classic “double-out”.',\r\n      'The highest 3-dart score is 180 (triple 20, triple 20, triple 20).'\r\n    ];\r\n    const idx = Math.floor(Math.random() * facts.length);\r\n    setFact(facts[idx]);\r\n  }, []);\r\n  return (\r\n    <div className={`${user?.fullAccess ? 'premium-main' : ''} relative min-h-[600px] flex flex-col items-center justify-center overflow-hidden`}>\r\n      {/* Background only */}\r\n      <div className=\"absolute inset-0 z-0\">\r\n        <div className=\"w-full h-full bg-gradient-to-br from-purple-700 via-indigo-500 to-blue-600 opacity-60 blur-2xl\"></div>\r\n        <div className=\"absolute top-20 left-1/4 w-40 h-40 bg-pink-400 rounded-full opacity-30 blur-2xl animate-pulse\"></div>\r\n        <div className=\"absolute bottom-10 right-1/4 w-32 h-32 bg-blue-400 rounded-full opacity-30 blur-2xl animate-pulse\"></div>\r\n      </div>\r\n\r\n      {/* Foreground content */}\r\n  <div className=\"relative z-10 w-full max-w-6xl mx-auto bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 lg:p-10 flex flex-col items-center\">\r\n  <h2 className=\"text-2xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-400 to-blue-400 mb-2 sm:mb-3 md:mb-4 drop-shadow-xl text-center leading-tight\">Welcome to Nine Dart Nation</h2>\r\n  <p className=\"text-base sm:text-lg md:text-xl lg:text-2xl text-white/80 mb-2 font-semibold text-center px-2\">Your home for competitive darts, stats, and online play.</p>\r\n  <p className=\"text-xs sm:text-sm md:text-base lg:text-lg text-white/60 mb-3 sm:mb-4 italic text-center px-2\">\"Where every dart counts and every player matters.\"</p>\r\n\r\n        {/* Did You Know - moved up for full visibility and randomized each mount */}\r\n        {fact && (\r\n          <div className=\"w-full mb-4 sm:mb-6 px-2 sm:px-0\">\r\n            <div className=\"mx-auto max-w-xs sm:max-w-xl rounded-full px-3 sm:px-5 py-2 text-center text-indigo-100 bg-gradient-to-r from-indigo-600/80 to-fuchsia-600/80 shadow-md\">\r\n              <span className=\"font-semibold text-sm sm:text-base\">Did you know?</span> <span className=\"opacity-90 text-sm sm:text-base\">{fact}</span>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n  <div className=\"flex flex-wrap gap-3 sm:gap-4 md:gap-6 justify-center mb-6 md:mb-8 w-full max-w-4xl mx-auto\">\r\n          <button\r\n            onClick={()=>{\r\n              // Switch to Offline and auto-start using the last saved offline settings\r\n              goTab('offline');\r\n              try {\r\n                // Preconfigure format and starting score\r\n                window.dispatchEvent(new CustomEvent('ndn:offline-format', {\r\n                  detail: {\r\n                    formatType: 'first',\r\n                    formatCount: Number(lastOffline?.firstTo) || 1,\r\n                    startScore: Number(lastOffline?.x01Start) || 501,\r\n                  }\r\n                }))\r\n              } catch {}\r\n              try {\r\n                // Give the Offline tab a tick to mount, then auto-start the chosen mode\r\n                setTimeout(() => {\r\n                  window.dispatchEvent(new CustomEvent('ndn:auto-start', {\r\n                    detail: { mode: lastOffline?.mode || 'X01' }\r\n                  }))\r\n                }, 50)\r\n              } catch {}\r\n            }}\r\n            className=\"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation\"\r\n          >\r\n            <span aria-hidden>🎯</span> Start New Match\r\n          </button>\r\n          <button \r\n            onClick={()=>goTab('stats')} \r\n            className=\"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation\"\r\n          >\r\n            <span aria-hidden>📊</span> View Stats\r\n          </button>\r\n          <button \r\n            onClick={()=>goTab('online')} \r\n            className=\"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-green-500 to-blue-400 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation\"\r\n          >\r\n            <span aria-hidden>🏆</span> Join Online League\r\n          </button>\r\n          <button \r\n            onClick={()=>{ goTab('offline'); try { window.dispatchEvent(new CustomEvent('ndn:auto-start', { detail: { mode: 'Double Practice' } })) } catch {} }} \r\n            className=\"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-pink-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation\"\r\n          >\r\n            <span aria-hidden>💡</span> Practice Doubles\r\n          </button>\r\n        </div>\r\n\r\n        {/* Removed older stat pill grid; now using BEST/WORST grid below */}\r\n\r\n        {/* Replaced Free/Premium cards with BEST/WORST vertical grid */}\r\n        {(() => {\r\n          const name = user?.username || 'Player 1'\r\n          const all = getAllTime(name)\r\n          const isPremium = !!user?.fullAccess\r\n          const GRID = 'grid grid-cols-[120px,1fr,1fr] sm:grid-cols-[160px,1fr,1fr]';\r\n          const Row = ({ label, left, right, lock }: { label: string; left: string; right: string; lock?: boolean }) => (\r\n            <div className={`relative ${GRID} gap-2 items-center p-2 rounded-lg ${lock ? 'bg-white/5 border border-white/10 overflow-hidden' : 'bg-indigo-500/10 border border-indigo-500/40'} mb-2`}>\r\n              <div className=\"text-[12px] opacity-80 pl-2 text-left\">{label}</div>\r\n              <div className={`text-sm font-semibold text-center ${lock ? 'opacity-50 blur-[0.5px]' : ''}`}>{left}</div>\r\n              <div className={`text-sm font-semibold text-center ${lock ? 'opacity-50 blur-[0.5px]' : ''}`}>{right}</div>\r\n              {lock && (\r\n                <button\r\n                  className=\"absolute inset-0 flex items-center justify-center rounded-lg bg-slate-900/35 hover:bg-slate-900/45 transition\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ email: user.email })\r\n                      });\r\n                      const data = await res.json();\r\n                      if (data.ok && data.url) {\r\n                        window.location.href = data.url;\r\n                      } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                        toast(\"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\", { type: 'error', timeout: 4000 });\r\n                      } else {\r\n                        toast(\"Failed to create checkout session. Please try again.\", { type: 'error', timeout: 4000 });\r\n                      }\r\n                    } catch (err) {\r\n                      toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n                    }\r\n                  }}\r\n                  title=\"Unlock with PREMIUM\"\r\n                >\r\n                  <span className=\"text-[12px] font-semibold\">Unlock PREMIUM</span>\r\n                </button>\r\n              )}\r\n            </div>\r\n          )\r\n          return (\r\n            <div className=\"w-full mt-2 rounded-2xl p-2 sm:p-3 bg-white/5 border border-white/10 overflow-x-auto\">\r\n              <div className={`${GRID} gap-2 mb-2 px-1 items-center min-w-[280px] sm:min-w-0`}>\r\n                <div className=\"text-[12px] opacity-0 select-none\">label</div>\r\n                <div className=\"text-[12px] font-semibold text-center\">BEST</div>\r\n                <div className=\"text-[12px] font-semibold text-center\">WORST</div>\r\n              </div>\r\n              <Row label=\"3-dart avg\" left={formatAvg(all.best3||0)} right={formatAvg(all.worst3||0)} />\r\n              <Row label=\"9-dart avg\" left={formatAvg(all.bestFNAvg||0)} right={formatAvg(all.worstFNAvg||0)} lock={!isPremium} />\r\n              <Row label=\"Leg (darts)\" left={String(all.bestLegDarts||0)} right={String(all.worstLegDarts||0)} lock={!isPremium} />\r\n              <Row label=\"Checkout\" left={String(all.bestCheckout||0)} right={'—'} lock={!isPremium} />\r\n            </div>\r\n          )\r\n        })()}\r\n\r\n  <button className=\"mt-6 sm:mt-8 md:mt-10 px-6 sm:px-8 md:px-10 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 text-base sm:text-lg md:text-xl touch-manipulation\" onClick={() => setShowHowTo(true)}>How to Play / Getting Started</button>\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <footer className=\"w-full py-2 md:py-2 text-center text-white/80 text-xs md:text-sm font-medium absolute bottom-0 left-0 z-20 flex items-center justify-center gap-1 md:gap-2\">\r\n        <button className=\"flex items-center gap-1 md:gap-2 hover:text-white transition\" onClick={() => setShowLegal(true)}>\r\n          <span>©</span>\r\n          <span style={{ letterSpacing: '0.05em' }}>NINEDARTNATION</span>\r\n        </button>\r\n      </footer>\r\n\r\n      {/* Legal Dialog */}\r\n      {showLegal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <div className=\"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\" onClick={() => setShowLegal(false)}>Close</button>\r\n            <h3 className=\"text-xl font-bold mb-2\">Legal Information</h3>\r\n            <ul className=\"list-disc pl-5 mb-2\">\r\n              <li>Terms & Conditions: All users must follow fair play and site rules.</li>\r\n              <li>Privacy Policy: Your data is protected and never shared without consent.</li>\r\n              <li>Copyright © {new Date().getFullYear()} NINEDARTNATION. All rights reserved.</li>\r\n              <li>Contact: support@ninedartnation.com</li>\r\n            </ul>\r\n            <p className=\"text-sm text-purple-200\">For full legal details, please contact us or visit our legal page.</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* How to Play Dialog */}\r\n      {showHowTo && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <div className=\"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\" onClick={() => setShowHowTo(false)}>Close</button>\r\n            <h3 className=\"text-xl font-bold mb-2\">Getting Started</h3>\r\n            <ul className=\"list-disc pl-5 mb-2\">\r\n              <li>Choose a game mode and invite friends or play solo.</li>\r\n              <li>Track your stats and progress in the Stats tab.</li>\r\n              <li>Join the BullseyeDartsLeague for online competition.</li>\r\n              <li>Upgrade to PREMIUM for advanced features and modes.</li>\r\n              <li>Need help? Visit the Settings tab for support and tips.</li>\r\n            </ul>\r\n            <p className=\"text-sm text-purple-200\">Ready to play? Hit \"Start New Match\" and let the darts fly!</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { PropsWithChildren, useEffect, useRef, type CSSProperties } from 'react'\r\n\r\ntype ScrollFadeProps = PropsWithChildren<{\r\n  className?: string\r\n  style?: CSSProperties\r\n}>\r\n\r\nexport default function ScrollFade({ children, className, style }: ScrollFadeProps) {\r\n  const ref = useRef<HTMLDivElement | null>(null)\r\n\r\n  // Clip content under the sticky header so text never shows over it\r\n  useEffect(() => {\r\n    let raf = 0\r\n    const updateClip = () => {\r\n      const wrapper = ref.current\r\n      if (!wrapper) return\r\n  const header = document.getElementById('ndn-header') as HTMLElement | null\r\n      if (!header) {\r\n        wrapper.style.clipPath = ''\r\n        return\r\n      }\r\n  const scroller = document.getElementById('ndn-main-scroll') as HTMLElement | null\r\n  const scrollTop = scroller ? scroller.scrollTop : (window.scrollY || 0)\r\n  // As soon as the user scrolls at all, reserve the full header height so content never slides under it\r\n  const headerH = header.getBoundingClientRect().height\r\n  const overlap = scrollTop > 0 ? headerH : 0\r\n  wrapper.style.marginTop = overlap > 0 ? `${overlap}px` : '0px'\r\n    }\r\n    updateClip()\r\n    const onScrollOrResize = () => {\r\n      if (raf) cancelAnimationFrame(raf)\r\n      raf = requestAnimationFrame(updateClip)\r\n    }\r\n    // Listen to the app's main scroll container instead of window\r\n    const scroller = document.getElementById('ndn-main-scroll')\r\n  scroller?.addEventListener('scroll', onScrollOrResize as any, { passive: true } as any)\r\n    // Fallback to window for safety (mobile or non-standard layouts)\r\n    window.addEventListener('scroll', onScrollOrResize, { passive: true })\r\n    window.addEventListener('resize', onScrollOrResize)\r\n    return () => {\r\n  scroller?.removeEventListener('scroll', onScrollOrResize as any)\r\n      window.removeEventListener('scroll', onScrollOrResize)\r\n      window.removeEventListener('resize', onScrollOrResize)\r\n      if (raf) cancelAnimationFrame(raf)\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <div ref={ref} className={className} style={style}>\r\n      {children}\r\n    </div>\r\n  )\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\n\r\ninterface DartLoaderProps {\r\n  calibrationComplete: boolean;\r\n}\r\n\r\nconst DartLoader: React.FC<DartLoaderProps> = ({ calibrationComplete }) => {\r\n  const [showTick, setShowTick] = useState(false);\r\n  const [fade, setFade] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (calibrationComplete) {\r\n      setShowTick(true);\r\n      setTimeout(() => setFade(true), 1200);\r\n    } else {\r\n      setShowTick(false);\r\n      setFade(false);\r\n    }\r\n  }, [calibrationComplete]);\r\n\r\n  return (\r\n    <div\r\n      className={`flex flex-col items-center justify-center w-full h-full transition-opacity duration-700 ${fade ? 'opacity-0' : 'opacity-100'}`}\r\n      style={{ pointerEvents: 'none', position: 'absolute', inset: 0, zIndex: 10 }}\r\n    >\r\n      <div className=\"flex items-center justify-center\">\r\n        <svg\r\n          width=\"80\"\r\n          height=\"80\"\r\n          viewBox=\"0 0 80 80\"\r\n          className={`animate-spin-slow ${showTick ? 'opacity-0' : 'opacity-100'} transition-opacity duration-500`}\r\n          style={{ transition: 'opacity 0.5s' }}\r\n        >\r\n          {/* Dart graphic */}\r\n          <g>\r\n            <rect x=\"36\" y=\"10\" width=\"8\" height=\"40\" rx=\"3\" fill=\"#a78bfa\" />\r\n            <polygon points=\"40,10 44,22 36,22\" fill=\"#f472b6\" />\r\n            <rect x=\"36\" y=\"50\" width=\"8\" height=\"18\" rx=\"2\" fill=\"#22d3ee\" />\r\n            <polygon points=\"36,68 44,68 40,78\" fill=\"#10b981\" />\r\n          </g>\r\n        </svg>\r\n        {showTick && (\r\n          <svg width=\"80\" height=\"80\" viewBox=\"0 0 80 80\" className=\"absolute\" style={{ left: 0, top: 0 }}>\r\n            <circle cx=\"40\" cy=\"40\" r=\"32\" fill=\"none\" stroke=\"#10b981\" strokeWidth=\"6\" />\r\n            <polyline points=\"28,44 38,54 54,30\" fill=\"none\" stroke=\"#10b981\" strokeWidth=\"6\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n          </svg>\r\n        )}\r\n      </div>\r\n      <div className=\"mt-4 text-lg font-semibold text-indigo-200\">\r\n        {showTick ? 'Calibration Complete!' : 'Initializing Camera...'}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DartLoader;\r\n","// can-promise has a crash in some versions of react native that dont have\n// standard global objects\n// https://github.com/soldair/node-qrcode/issues/157\n\nmodule.exports = function () {\n  return typeof Promise === 'function' && Promise.prototype && Promise.prototype.then\n}\n","let toSJISFunction\nconst CODEWORDS_COUNT = [\n  0, // Not used\n  26, 44, 70, 100, 134, 172, 196, 242, 292, 346,\n  404, 466, 532, 581, 655, 733, 815, 901, 991, 1085,\n  1156, 1258, 1364, 1474, 1588, 1706, 1828, 1921, 2051, 2185,\n  2323, 2465, 2611, 2761, 2876, 3034, 3196, 3362, 3532, 3706\n]\n\n/**\n * Returns the QR Code size for the specified version\n *\n * @param  {Number} version QR Code version\n * @return {Number}         size of QR code\n */\nexports.getSymbolSize = function getSymbolSize (version) {\n  if (!version) throw new Error('\"version\" cannot be null or undefined')\n  if (version < 1 || version > 40) throw new Error('\"version\" should be in range from 1 to 40')\n  return version * 4 + 17\n}\n\n/**\n * Returns the total number of codewords used to store data and EC information.\n *\n * @param  {Number} version QR Code version\n * @return {Number}         Data length in bits\n */\nexports.getSymbolTotalCodewords = function getSymbolTotalCodewords (version) {\n  return CODEWORDS_COUNT[version]\n}\n\n/**\n * Encode data with Bose-Chaudhuri-Hocquenghem\n *\n * @param  {Number} data Value to encode\n * @return {Number}      Encoded value\n */\nexports.getBCHDigit = function (data) {\n  let digit = 0\n\n  while (data !== 0) {\n    digit++\n    data >>>= 1\n  }\n\n  return digit\n}\n\nexports.setToSJISFunction = function setToSJISFunction (f) {\n  if (typeof f !== 'function') {\n    throw new Error('\"toSJISFunc\" is not a valid function.')\n  }\n\n  toSJISFunction = f\n}\n\nexports.isKanjiModeEnabled = function () {\n  return typeof toSJISFunction !== 'undefined'\n}\n\nexports.toSJIS = function toSJIS (kanji) {\n  return toSJISFunction(kanji)\n}\n","exports.L = { bit: 1 }\nexports.M = { bit: 0 }\nexports.Q = { bit: 3 }\nexports.H = { bit: 2 }\n\nfunction fromString (string) {\n  if (typeof string !== 'string') {\n    throw new Error('Param is not a string')\n  }\n\n  const lcStr = string.toLowerCase()\n\n  switch (lcStr) {\n    case 'l':\n    case 'low':\n      return exports.L\n\n    case 'm':\n    case 'medium':\n      return exports.M\n\n    case 'q':\n    case 'quartile':\n      return exports.Q\n\n    case 'h':\n    case 'high':\n      return exports.H\n\n    default:\n      throw new Error('Unknown EC Level: ' + string)\n  }\n}\n\nexports.isValid = function isValid (level) {\n  return level && typeof level.bit !== 'undefined' &&\n    level.bit >= 0 && level.bit < 4\n}\n\nexports.from = function from (value, defaultValue) {\n  if (exports.isValid(value)) {\n    return value\n  }\n\n  try {\n    return fromString(value)\n  } catch (e) {\n    return defaultValue\n  }\n}\n","function BitBuffer () {\n  this.buffer = []\n  this.length = 0\n}\n\nBitBuffer.prototype = {\n\n  get: function (index) {\n    const bufIndex = Math.floor(index / 8)\n    return ((this.buffer[bufIndex] >>> (7 - index % 8)) & 1) === 1\n  },\n\n  put: function (num, length) {\n    for (let i = 0; i < length; i++) {\n      this.putBit(((num >>> (length - i - 1)) & 1) === 1)\n    }\n  },\n\n  getLengthInBits: function () {\n    return this.length\n  },\n\n  putBit: function (bit) {\n    const bufIndex = Math.floor(this.length / 8)\n    if (this.buffer.length <= bufIndex) {\n      this.buffer.push(0)\n    }\n\n    if (bit) {\n      this.buffer[bufIndex] |= (0x80 >>> (this.length % 8))\n    }\n\n    this.length++\n  }\n}\n\nmodule.exports = BitBuffer\n","/**\n * Helper class to handle QR Code symbol modules\n *\n * @param {Number} size Symbol size\n */\nfunction BitMatrix (size) {\n  if (!size || size < 1) {\n    throw new Error('BitMatrix size must be defined and greater than 0')\n  }\n\n  this.size = size\n  this.data = new Uint8Array(size * size)\n  this.reservedBit = new Uint8Array(size * size)\n}\n\n/**\n * Set bit value at specified location\n * If reserved flag is set, this bit will be ignored during masking process\n *\n * @param {Number}  row\n * @param {Number}  col\n * @param {Boolean} value\n * @param {Boolean} reserved\n */\nBitMatrix.prototype.set = function (row, col, value, reserved) {\n  const index = row * this.size + col\n  this.data[index] = value\n  if (reserved) this.reservedBit[index] = true\n}\n\n/**\n * Returns bit value at specified location\n *\n * @param  {Number}  row\n * @param  {Number}  col\n * @return {Boolean}\n */\nBitMatrix.prototype.get = function (row, col) {\n  return this.data[row * this.size + col]\n}\n\n/**\n * Applies xor operator at specified location\n * (used during masking process)\n *\n * @param {Number}  row\n * @param {Number}  col\n * @param {Boolean} value\n */\nBitMatrix.prototype.xor = function (row, col, value) {\n  this.data[row * this.size + col] ^= value\n}\n\n/**\n * Check if bit at specified location is reserved\n *\n * @param {Number}   row\n * @param {Number}   col\n * @return {Boolean}\n */\nBitMatrix.prototype.isReserved = function (row, col) {\n  return this.reservedBit[row * this.size + col]\n}\n\nmodule.exports = BitMatrix\n","/**\n * Alignment pattern are fixed reference pattern in defined positions\n * in a matrix symbology, which enables the decode software to re-synchronise\n * the coordinate mapping of the image modules in the event of moderate amounts\n * of distortion of the image.\n *\n * Alignment patterns are present only in QR Code symbols of version 2 or larger\n * and their number depends on the symbol version.\n */\n\nconst getSymbolSize = require('./utils').getSymbolSize\n\n/**\n * Calculate the row/column coordinates of the center module of each alignment pattern\n * for the specified QR Code version.\n *\n * The alignment patterns are positioned symmetrically on either side of the diagonal\n * running from the top left corner of the symbol to the bottom right corner.\n *\n * Since positions are simmetrical only half of the coordinates are returned.\n * Each item of the array will represent in turn the x and y coordinate.\n * @see {@link getPositions}\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinate\n */\nexports.getRowColCoords = function getRowColCoords (version) {\n  if (version === 1) return []\n\n  const posCount = Math.floor(version / 7) + 2\n  const size = getSymbolSize(version)\n  const intervals = size === 145 ? 26 : Math.ceil((size - 13) / (2 * posCount - 2)) * 2\n  const positions = [size - 7] // Last coord is always (size - 7)\n\n  for (let i = 1; i < posCount - 1; i++) {\n    positions[i] = positions[i - 1] - intervals\n  }\n\n  positions.push(6) // First coord is always 6\n\n  return positions.reverse()\n}\n\n/**\n * Returns an array containing the positions of each alignment pattern.\n * Each array's element represent the center point of the pattern as (x, y) coordinates\n *\n * Coordinates are calculated expanding the row/column coordinates returned by {@link getRowColCoords}\n * and filtering out the items that overlaps with finder pattern\n *\n * @example\n * For a Version 7 symbol {@link getRowColCoords} returns values 6, 22 and 38.\n * The alignment patterns, therefore, are to be centered on (row, column)\n * positions (6,22), (22,6), (22,22), (22,38), (38,22), (38,38).\n * Note that the coordinates (6,6), (6,38), (38,6) are occupied by finder patterns\n * and are not therefore used for alignment patterns.\n *\n * let pos = getPositions(7)\n * // [[6,22], [22,6], [22,22], [22,38], [38,22], [38,38]]\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinates\n */\nexports.getPositions = function getPositions (version) {\n  const coords = []\n  const pos = exports.getRowColCoords(version)\n  const posLength = pos.length\n\n  for (let i = 0; i < posLength; i++) {\n    for (let j = 0; j < posLength; j++) {\n      // Skip if position is occupied by finder patterns\n      if ((i === 0 && j === 0) || // top-left\n          (i === 0 && j === posLength - 1) || // bottom-left\n          (i === posLength - 1 && j === 0)) { // top-right\n        continue\n      }\n\n      coords.push([pos[i], pos[j]])\n    }\n  }\n\n  return coords\n}\n","const getSymbolSize = require('./utils').getSymbolSize\nconst FINDER_PATTERN_SIZE = 7\n\n/**\n * Returns an array containing the positions of each finder pattern.\n * Each array's element represent the top-left point of the pattern as (x, y) coordinates\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinates\n */\nexports.getPositions = function getPositions (version) {\n  const size = getSymbolSize(version)\n\n  return [\n    // top-left\n    [0, 0],\n    // top-right\n    [size - FINDER_PATTERN_SIZE, 0],\n    // bottom-left\n    [0, size - FINDER_PATTERN_SIZE]\n  ]\n}\n","/**\n * Data mask pattern reference\n * @type {Object}\n */\nexports.Patterns = {\n  PATTERN000: 0,\n  PATTERN001: 1,\n  PATTERN010: 2,\n  PATTERN011: 3,\n  PATTERN100: 4,\n  PATTERN101: 5,\n  PATTERN110: 6,\n  PATTERN111: 7\n}\n\n/**\n * Weighted penalty scores for the undesirable features\n * @type {Object}\n */\nconst PenaltyScores = {\n  N1: 3,\n  N2: 3,\n  N3: 40,\n  N4: 10\n}\n\n/**\n * Check if mask pattern value is valid\n *\n * @param  {Number}  mask    Mask pattern\n * @return {Boolean}         true if valid, false otherwise\n */\nexports.isValid = function isValid (mask) {\n  return mask != null && mask !== '' && !isNaN(mask) && mask >= 0 && mask <= 7\n}\n\n/**\n * Returns mask pattern from a value.\n * If value is not valid, returns undefined\n *\n * @param  {Number|String} value        Mask pattern value\n * @return {Number}                     Valid mask pattern or undefined\n */\nexports.from = function from (value) {\n  return exports.isValid(value) ? parseInt(value, 10) : undefined\n}\n\n/**\n* Find adjacent modules in row/column with the same color\n* and assign a penalty value.\n*\n* Points: N1 + i\n* i is the amount by which the number of adjacent modules of the same color exceeds 5\n*/\nexports.getPenaltyN1 = function getPenaltyN1 (data) {\n  const size = data.size\n  let points = 0\n  let sameCountCol = 0\n  let sameCountRow = 0\n  let lastCol = null\n  let lastRow = null\n\n  for (let row = 0; row < size; row++) {\n    sameCountCol = sameCountRow = 0\n    lastCol = lastRow = null\n\n    for (let col = 0; col < size; col++) {\n      let module = data.get(row, col)\n      if (module === lastCol) {\n        sameCountCol++\n      } else {\n        if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5)\n        lastCol = module\n        sameCountCol = 1\n      }\n\n      module = data.get(col, row)\n      if (module === lastRow) {\n        sameCountRow++\n      } else {\n        if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5)\n        lastRow = module\n        sameCountRow = 1\n      }\n    }\n\n    if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5)\n    if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5)\n  }\n\n  return points\n}\n\n/**\n * Find 2x2 blocks with the same color and assign a penalty value\n *\n * Points: N2 * (m - 1) * (n - 1)\n */\nexports.getPenaltyN2 = function getPenaltyN2 (data) {\n  const size = data.size\n  let points = 0\n\n  for (let row = 0; row < size - 1; row++) {\n    for (let col = 0; col < size - 1; col++) {\n      const last = data.get(row, col) +\n        data.get(row, col + 1) +\n        data.get(row + 1, col) +\n        data.get(row + 1, col + 1)\n\n      if (last === 4 || last === 0) points++\n    }\n  }\n\n  return points * PenaltyScores.N2\n}\n\n/**\n * Find 1:1:3:1:1 ratio (dark:light:dark:light:dark) pattern in row/column,\n * preceded or followed by light area 4 modules wide\n *\n * Points: N3 * number of pattern found\n */\nexports.getPenaltyN3 = function getPenaltyN3 (data) {\n  const size = data.size\n  let points = 0\n  let bitsCol = 0\n  let bitsRow = 0\n\n  for (let row = 0; row < size; row++) {\n    bitsCol = bitsRow = 0\n    for (let col = 0; col < size; col++) {\n      bitsCol = ((bitsCol << 1) & 0x7FF) | data.get(row, col)\n      if (col >= 10 && (bitsCol === 0x5D0 || bitsCol === 0x05D)) points++\n\n      bitsRow = ((bitsRow << 1) & 0x7FF) | data.get(col, row)\n      if (col >= 10 && (bitsRow === 0x5D0 || bitsRow === 0x05D)) points++\n    }\n  }\n\n  return points * PenaltyScores.N3\n}\n\n/**\n * Calculate proportion of dark modules in entire symbol\n *\n * Points: N4 * k\n *\n * k is the rating of the deviation of the proportion of dark modules\n * in the symbol from 50% in steps of 5%\n */\nexports.getPenaltyN4 = function getPenaltyN4 (data) {\n  let darkCount = 0\n  const modulesCount = data.data.length\n\n  for (let i = 0; i < modulesCount; i++) darkCount += data.data[i]\n\n  const k = Math.abs(Math.ceil((darkCount * 100 / modulesCount) / 5) - 10)\n\n  return k * PenaltyScores.N4\n}\n\n/**\n * Return mask value at given position\n *\n * @param  {Number} maskPattern Pattern reference value\n * @param  {Number} i           Row\n * @param  {Number} j           Column\n * @return {Boolean}            Mask value\n */\nfunction getMaskAt (maskPattern, i, j) {\n  switch (maskPattern) {\n    case exports.Patterns.PATTERN000: return (i + j) % 2 === 0\n    case exports.Patterns.PATTERN001: return i % 2 === 0\n    case exports.Patterns.PATTERN010: return j % 3 === 0\n    case exports.Patterns.PATTERN011: return (i + j) % 3 === 0\n    case exports.Patterns.PATTERN100: return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 === 0\n    case exports.Patterns.PATTERN101: return (i * j) % 2 + (i * j) % 3 === 0\n    case exports.Patterns.PATTERN110: return ((i * j) % 2 + (i * j) % 3) % 2 === 0\n    case exports.Patterns.PATTERN111: return ((i * j) % 3 + (i + j) % 2) % 2 === 0\n\n    default: throw new Error('bad maskPattern:' + maskPattern)\n  }\n}\n\n/**\n * Apply a mask pattern to a BitMatrix\n *\n * @param  {Number}    pattern Pattern reference number\n * @param  {BitMatrix} data    BitMatrix data\n */\nexports.applyMask = function applyMask (pattern, data) {\n  const size = data.size\n\n  for (let col = 0; col < size; col++) {\n    for (let row = 0; row < size; row++) {\n      if (data.isReserved(row, col)) continue\n      data.xor(row, col, getMaskAt(pattern, row, col))\n    }\n  }\n}\n\n/**\n * Returns the best mask pattern for data\n *\n * @param  {BitMatrix} data\n * @return {Number} Mask pattern reference number\n */\nexports.getBestMask = function getBestMask (data, setupFormatFunc) {\n  const numPatterns = Object.keys(exports.Patterns).length\n  let bestPattern = 0\n  let lowerPenalty = Infinity\n\n  for (let p = 0; p < numPatterns; p++) {\n    setupFormatFunc(p)\n    exports.applyMask(p, data)\n\n    // Calculate penalty\n    const penalty =\n      exports.getPenaltyN1(data) +\n      exports.getPenaltyN2(data) +\n      exports.getPenaltyN3(data) +\n      exports.getPenaltyN4(data)\n\n    // Undo previously applied mask\n    exports.applyMask(p, data)\n\n    if (penalty < lowerPenalty) {\n      lowerPenalty = penalty\n      bestPattern = p\n    }\n  }\n\n  return bestPattern\n}\n","const ECLevel = require('./error-correction-level')\r\n\r\nconst EC_BLOCKS_TABLE = [\r\n// L  M  Q  H\r\n  1, 1, 1, 1,\r\n  1, 1, 1, 1,\r\n  1, 1, 2, 2,\r\n  1, 2, 2, 4,\r\n  1, 2, 4, 4,\r\n  2, 4, 4, 4,\r\n  2, 4, 6, 5,\r\n  2, 4, 6, 6,\r\n  2, 5, 8, 8,\r\n  4, 5, 8, 8,\r\n  4, 5, 8, 11,\r\n  4, 8, 10, 11,\r\n  4, 9, 12, 16,\r\n  4, 9, 16, 16,\r\n  6, 10, 12, 18,\r\n  6, 10, 17, 16,\r\n  6, 11, 16, 19,\r\n  6, 13, 18, 21,\r\n  7, 14, 21, 25,\r\n  8, 16, 20, 25,\r\n  8, 17, 23, 25,\r\n  9, 17, 23, 34,\r\n  9, 18, 25, 30,\r\n  10, 20, 27, 32,\r\n  12, 21, 29, 35,\r\n  12, 23, 34, 37,\r\n  12, 25, 34, 40,\r\n  13, 26, 35, 42,\r\n  14, 28, 38, 45,\r\n  15, 29, 40, 48,\r\n  16, 31, 43, 51,\r\n  17, 33, 45, 54,\r\n  18, 35, 48, 57,\r\n  19, 37, 51, 60,\r\n  19, 38, 53, 63,\r\n  20, 40, 56, 66,\r\n  21, 43, 59, 70,\r\n  22, 45, 62, 74,\r\n  24, 47, 65, 77,\r\n  25, 49, 68, 81\r\n]\r\n\r\nconst EC_CODEWORDS_TABLE = [\r\n// L  M  Q  H\r\n  7, 10, 13, 17,\r\n  10, 16, 22, 28,\r\n  15, 26, 36, 44,\r\n  20, 36, 52, 64,\r\n  26, 48, 72, 88,\r\n  36, 64, 96, 112,\r\n  40, 72, 108, 130,\r\n  48, 88, 132, 156,\r\n  60, 110, 160, 192,\r\n  72, 130, 192, 224,\r\n  80, 150, 224, 264,\r\n  96, 176, 260, 308,\r\n  104, 198, 288, 352,\r\n  120, 216, 320, 384,\r\n  132, 240, 360, 432,\r\n  144, 280, 408, 480,\r\n  168, 308, 448, 532,\r\n  180, 338, 504, 588,\r\n  196, 364, 546, 650,\r\n  224, 416, 600, 700,\r\n  224, 442, 644, 750,\r\n  252, 476, 690, 816,\r\n  270, 504, 750, 900,\r\n  300, 560, 810, 960,\r\n  312, 588, 870, 1050,\r\n  336, 644, 952, 1110,\r\n  360, 700, 1020, 1200,\r\n  390, 728, 1050, 1260,\r\n  420, 784, 1140, 1350,\r\n  450, 812, 1200, 1440,\r\n  480, 868, 1290, 1530,\r\n  510, 924, 1350, 1620,\r\n  540, 980, 1440, 1710,\r\n  570, 1036, 1530, 1800,\r\n  570, 1064, 1590, 1890,\r\n  600, 1120, 1680, 1980,\r\n  630, 1204, 1770, 2100,\r\n  660, 1260, 1860, 2220,\r\n  720, 1316, 1950, 2310,\r\n  750, 1372, 2040, 2430\r\n]\r\n\r\n/**\r\n * Returns the number of error correction block that the QR Code should contain\r\n * for the specified version and error correction level.\r\n *\r\n * @param  {Number} version              QR Code version\r\n * @param  {Number} errorCorrectionLevel Error correction level\r\n * @return {Number}                      Number of error correction blocks\r\n */\r\nexports.getBlocksCount = function getBlocksCount (version, errorCorrectionLevel) {\r\n  switch (errorCorrectionLevel) {\r\n    case ECLevel.L:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 0]\r\n    case ECLevel.M:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 1]\r\n    case ECLevel.Q:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 2]\r\n    case ECLevel.H:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 3]\r\n    default:\r\n      return undefined\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the number of error correction codewords to use for the specified\r\n * version and error correction level.\r\n *\r\n * @param  {Number} version              QR Code version\r\n * @param  {Number} errorCorrectionLevel Error correction level\r\n * @return {Number}                      Number of error correction codewords\r\n */\r\nexports.getTotalCodewordsCount = function getTotalCodewordsCount (version, errorCorrectionLevel) {\r\n  switch (errorCorrectionLevel) {\r\n    case ECLevel.L:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 0]\r\n    case ECLevel.M:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 1]\r\n    case ECLevel.Q:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 2]\r\n    case ECLevel.H:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 3]\r\n    default:\r\n      return undefined\r\n  }\r\n}\r\n","const EXP_TABLE = new Uint8Array(512)\nconst LOG_TABLE = new Uint8Array(256)\n/**\n * Precompute the log and anti-log tables for faster computation later\n *\n * For each possible value in the galois field 2^8, we will pre-compute\n * the logarithm and anti-logarithm (exponential) of this value\n *\n * ref {@link https://en.wikiversity.org/wiki/Reed%E2%80%93Solomon_codes_for_coders#Introduction_to_mathematical_fields}\n */\n;(function initTables () {\n  let x = 1\n  for (let i = 0; i < 255; i++) {\n    EXP_TABLE[i] = x\n    LOG_TABLE[x] = i\n\n    x <<= 1 // multiply by 2\n\n    // The QR code specification says to use byte-wise modulo 100011101 arithmetic.\n    // This means that when a number is 256 or larger, it should be XORed with 0x11D.\n    if (x & 0x100) { // similar to x >= 256, but a lot faster (because 0x100 == 256)\n      x ^= 0x11D\n    }\n  }\n\n  // Optimization: double the size of the anti-log table so that we don't need to mod 255 to\n  // stay inside the bounds (because we will mainly use this table for the multiplication of\n  // two GF numbers, no more).\n  // @see {@link mul}\n  for (let i = 255; i < 512; i++) {\n    EXP_TABLE[i] = EXP_TABLE[i - 255]\n  }\n}())\n\n/**\n * Returns log value of n inside Galois Field\n *\n * @param  {Number} n\n * @return {Number}\n */\nexports.log = function log (n) {\n  if (n < 1) throw new Error('log(' + n + ')')\n  return LOG_TABLE[n]\n}\n\n/**\n * Returns anti-log value of n inside Galois Field\n *\n * @param  {Number} n\n * @return {Number}\n */\nexports.exp = function exp (n) {\n  return EXP_TABLE[n]\n}\n\n/**\n * Multiplies two number inside Galois Field\n *\n * @param  {Number} x\n * @param  {Number} y\n * @return {Number}\n */\nexports.mul = function mul (x, y) {\n  if (x === 0 || y === 0) return 0\n\n  // should be EXP_TABLE[(LOG_TABLE[x] + LOG_TABLE[y]) % 255] if EXP_TABLE wasn't oversized\n  // @see {@link initTables}\n  return EXP_TABLE[LOG_TABLE[x] + LOG_TABLE[y]]\n}\n","const GF = require('./galois-field')\n\n/**\n * Multiplies two polynomials inside Galois Field\n *\n * @param  {Uint8Array} p1 Polynomial\n * @param  {Uint8Array} p2 Polynomial\n * @return {Uint8Array}    Product of p1 and p2\n */\nexports.mul = function mul (p1, p2) {\n  const coeff = new Uint8Array(p1.length + p2.length - 1)\n\n  for (let i = 0; i < p1.length; i++) {\n    for (let j = 0; j < p2.length; j++) {\n      coeff[i + j] ^= GF.mul(p1[i], p2[j])\n    }\n  }\n\n  return coeff\n}\n\n/**\n * Calculate the remainder of polynomials division\n *\n * @param  {Uint8Array} divident Polynomial\n * @param  {Uint8Array} divisor  Polynomial\n * @return {Uint8Array}          Remainder\n */\nexports.mod = function mod (divident, divisor) {\n  let result = new Uint8Array(divident)\n\n  while ((result.length - divisor.length) >= 0) {\n    const coeff = result[0]\n\n    for (let i = 0; i < divisor.length; i++) {\n      result[i] ^= GF.mul(divisor[i], coeff)\n    }\n\n    // remove all zeros from buffer head\n    let offset = 0\n    while (offset < result.length && result[offset] === 0) offset++\n    result = result.slice(offset)\n  }\n\n  return result\n}\n\n/**\n * Generate an irreducible generator polynomial of specified degree\n * (used by Reed-Solomon encoder)\n *\n * @param  {Number} degree Degree of the generator polynomial\n * @return {Uint8Array}    Buffer containing polynomial coefficients\n */\nexports.generateECPolynomial = function generateECPolynomial (degree) {\n  let poly = new Uint8Array([1])\n  for (let i = 0; i < degree; i++) {\n    poly = exports.mul(poly, new Uint8Array([1, GF.exp(i)]))\n  }\n\n  return poly\n}\n","const Polynomial = require('./polynomial')\n\nfunction ReedSolomonEncoder (degree) {\n  this.genPoly = undefined\n  this.degree = degree\n\n  if (this.degree) this.initialize(this.degree)\n}\n\n/**\n * Initialize the encoder.\n * The input param should correspond to the number of error correction codewords.\n *\n * @param  {Number} degree\n */\nReedSolomonEncoder.prototype.initialize = function initialize (degree) {\n  // create an irreducible generator polynomial\n  this.degree = degree\n  this.genPoly = Polynomial.generateECPolynomial(this.degree)\n}\n\n/**\n * Encodes a chunk of data\n *\n * @param  {Uint8Array} data Buffer containing input data\n * @return {Uint8Array}      Buffer containing encoded data\n */\nReedSolomonEncoder.prototype.encode = function encode (data) {\n  if (!this.genPoly) {\n    throw new Error('Encoder not initialized')\n  }\n\n  // Calculate EC for this data block\n  // extends data size to data+genPoly size\n  const paddedData = new Uint8Array(data.length + this.degree)\n  paddedData.set(data)\n\n  // The error correction codewords are the remainder after dividing the data codewords\n  // by a generator polynomial\n  const remainder = Polynomial.mod(paddedData, this.genPoly)\n\n  // return EC data blocks (last n byte, where n is the degree of genPoly)\n  // If coefficients number in remainder are less than genPoly degree,\n  // pad with 0s to the left to reach the needed number of coefficients\n  const start = this.degree - remainder.length\n  if (start > 0) {\n    const buff = new Uint8Array(this.degree)\n    buff.set(remainder, start)\n\n    return buff\n  }\n\n  return remainder\n}\n\nmodule.exports = ReedSolomonEncoder\n","/**\n * Check if QR Code version is valid\n *\n * @param  {Number}  version QR Code version\n * @return {Boolean}         true if valid version, false otherwise\n */\nexports.isValid = function isValid (version) {\n  return !isNaN(version) && version >= 1 && version <= 40\n}\n","const numeric = '[0-9]+'\nconst alphanumeric = '[A-Z $%*+\\\\-./:]+'\nlet kanji = '(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|' +\n  '[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|' +\n  '[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|' +\n  '[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+'\nkanji = kanji.replace(/u/g, '\\\\u')\n\nconst byte = '(?:(?![A-Z0-9 $%*+\\\\-./:]|' + kanji + ')(?:.|[\\r\\n]))+'\n\nexports.KANJI = new RegExp(kanji, 'g')\nexports.BYTE_KANJI = new RegExp('[^A-Z0-9 $%*+\\\\-./:]+', 'g')\nexports.BYTE = new RegExp(byte, 'g')\nexports.NUMERIC = new RegExp(numeric, 'g')\nexports.ALPHANUMERIC = new RegExp(alphanumeric, 'g')\n\nconst TEST_KANJI = new RegExp('^' + kanji + '$')\nconst TEST_NUMERIC = new RegExp('^' + numeric + '$')\nconst TEST_ALPHANUMERIC = new RegExp('^[A-Z0-9 $%*+\\\\-./:]+$')\n\nexports.testKanji = function testKanji (str) {\n  return TEST_KANJI.test(str)\n}\n\nexports.testNumeric = function testNumeric (str) {\n  return TEST_NUMERIC.test(str)\n}\n\nexports.testAlphanumeric = function testAlphanumeric (str) {\n  return TEST_ALPHANUMERIC.test(str)\n}\n","const VersionCheck = require('./version-check')\nconst Regex = require('./regex')\n\n/**\n * Numeric mode encodes data from the decimal digit set (0 - 9)\n * (byte values 30HEX to 39HEX).\n * Normally, 3 data characters are represented by 10 bits.\n *\n * @type {Object}\n */\nexports.NUMERIC = {\n  id: 'Numeric',\n  bit: 1 << 0,\n  ccBits: [10, 12, 14]\n}\n\n/**\n * Alphanumeric mode encodes data from a set of 45 characters,\n * i.e. 10 numeric digits (0 - 9),\n *      26 alphabetic characters (A - Z),\n *   and 9 symbols (SP, $, %, *, +, -, ., /, :).\n * Normally, two input characters are represented by 11 bits.\n *\n * @type {Object}\n */\nexports.ALPHANUMERIC = {\n  id: 'Alphanumeric',\n  bit: 1 << 1,\n  ccBits: [9, 11, 13]\n}\n\n/**\n * In byte mode, data is encoded at 8 bits per character.\n *\n * @type {Object}\n */\nexports.BYTE = {\n  id: 'Byte',\n  bit: 1 << 2,\n  ccBits: [8, 16, 16]\n}\n\n/**\n * The Kanji mode efficiently encodes Kanji characters in accordance with\n * the Shift JIS system based on JIS X 0208.\n * The Shift JIS values are shifted from the JIS X 0208 values.\n * JIS X 0208 gives details of the shift coded representation.\n * Each two-byte character value is compacted to a 13-bit binary codeword.\n *\n * @type {Object}\n */\nexports.KANJI = {\n  id: 'Kanji',\n  bit: 1 << 3,\n  ccBits: [8, 10, 12]\n}\n\n/**\n * Mixed mode will contain a sequences of data in a combination of any of\n * the modes described above\n *\n * @type {Object}\n */\nexports.MIXED = {\n  bit: -1\n}\n\n/**\n * Returns the number of bits needed to store the data length\n * according to QR Code specifications.\n *\n * @param  {Mode}   mode    Data mode\n * @param  {Number} version QR Code version\n * @return {Number}         Number of bits\n */\nexports.getCharCountIndicator = function getCharCountIndicator (mode, version) {\n  if (!mode.ccBits) throw new Error('Invalid mode: ' + mode)\n\n  if (!VersionCheck.isValid(version)) {\n    throw new Error('Invalid version: ' + version)\n  }\n\n  if (version >= 1 && version < 10) return mode.ccBits[0]\n  else if (version < 27) return mode.ccBits[1]\n  return mode.ccBits[2]\n}\n\n/**\n * Returns the most efficient mode to store the specified data\n *\n * @param  {String} dataStr Input data string\n * @return {Mode}           Best mode\n */\nexports.getBestModeForData = function getBestModeForData (dataStr) {\n  if (Regex.testNumeric(dataStr)) return exports.NUMERIC\n  else if (Regex.testAlphanumeric(dataStr)) return exports.ALPHANUMERIC\n  else if (Regex.testKanji(dataStr)) return exports.KANJI\n  else return exports.BYTE\n}\n\n/**\n * Return mode name as string\n *\n * @param {Mode} mode Mode object\n * @returns {String}  Mode name\n */\nexports.toString = function toString (mode) {\n  if (mode && mode.id) return mode.id\n  throw new Error('Invalid mode')\n}\n\n/**\n * Check if input param is a valid mode object\n *\n * @param   {Mode}    mode Mode object\n * @returns {Boolean} True if valid mode, false otherwise\n */\nexports.isValid = function isValid (mode) {\n  return mode && mode.bit && mode.ccBits\n}\n\n/**\n * Get mode object from its name\n *\n * @param   {String} string Mode name\n * @returns {Mode}          Mode object\n */\nfunction fromString (string) {\n  if (typeof string !== 'string') {\n    throw new Error('Param is not a string')\n  }\n\n  const lcStr = string.toLowerCase()\n\n  switch (lcStr) {\n    case 'numeric':\n      return exports.NUMERIC\n    case 'alphanumeric':\n      return exports.ALPHANUMERIC\n    case 'kanji':\n      return exports.KANJI\n    case 'byte':\n      return exports.BYTE\n    default:\n      throw new Error('Unknown mode: ' + string)\n  }\n}\n\n/**\n * Returns mode from a value.\n * If value is not a valid mode, returns defaultValue\n *\n * @param  {Mode|String} value        Encoding mode\n * @param  {Mode}        defaultValue Fallback value\n * @return {Mode}                     Encoding mode\n */\nexports.from = function from (value, defaultValue) {\n  if (exports.isValid(value)) {\n    return value\n  }\n\n  try {\n    return fromString(value)\n  } catch (e) {\n    return defaultValue\n  }\n}\n","const Utils = require('./utils')\nconst ECCode = require('./error-correction-code')\nconst ECLevel = require('./error-correction-level')\nconst Mode = require('./mode')\nconst VersionCheck = require('./version-check')\n\n// Generator polynomial used to encode version information\nconst G18 = (1 << 12) | (1 << 11) | (1 << 10) | (1 << 9) | (1 << 8) | (1 << 5) | (1 << 2) | (1 << 0)\nconst G18_BCH = Utils.getBCHDigit(G18)\n\nfunction getBestVersionForDataLength (mode, length, errorCorrectionLevel) {\n  for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {\n    if (length <= exports.getCapacity(currentVersion, errorCorrectionLevel, mode)) {\n      return currentVersion\n    }\n  }\n\n  return undefined\n}\n\nfunction getReservedBitsCount (mode, version) {\n  // Character count indicator + mode indicator bits\n  return Mode.getCharCountIndicator(mode, version) + 4\n}\n\nfunction getTotalBitsFromDataArray (segments, version) {\n  let totalBits = 0\n\n  segments.forEach(function (data) {\n    const reservedBits = getReservedBitsCount(data.mode, version)\n    totalBits += reservedBits + data.getBitsLength()\n  })\n\n  return totalBits\n}\n\nfunction getBestVersionForMixedData (segments, errorCorrectionLevel) {\n  for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {\n    const length = getTotalBitsFromDataArray(segments, currentVersion)\n    if (length <= exports.getCapacity(currentVersion, errorCorrectionLevel, Mode.MIXED)) {\n      return currentVersion\n    }\n  }\n\n  return undefined\n}\n\n/**\n * Returns version number from a value.\n * If value is not a valid version, returns defaultValue\n *\n * @param  {Number|String} value        QR Code version\n * @param  {Number}        defaultValue Fallback value\n * @return {Number}                     QR Code version number\n */\nexports.from = function from (value, defaultValue) {\n  if (VersionCheck.isValid(value)) {\n    return parseInt(value, 10)\n  }\n\n  return defaultValue\n}\n\n/**\n * Returns how much data can be stored with the specified QR code version\n * and error correction level\n *\n * @param  {Number} version              QR Code version (1-40)\n * @param  {Number} errorCorrectionLevel Error correction level\n * @param  {Mode}   mode                 Data mode\n * @return {Number}                      Quantity of storable data\n */\nexports.getCapacity = function getCapacity (version, errorCorrectionLevel, mode) {\n  if (!VersionCheck.isValid(version)) {\n    throw new Error('Invalid QR Code version')\n  }\n\n  // Use Byte mode as default\n  if (typeof mode === 'undefined') mode = Mode.BYTE\n\n  // Total codewords for this QR code version (Data + Error correction)\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n\n  // Total number of error correction codewords\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n\n  // Total number of data codewords\n  const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8\n\n  if (mode === Mode.MIXED) return dataTotalCodewordsBits\n\n  const usableBits = dataTotalCodewordsBits - getReservedBitsCount(mode, version)\n\n  // Return max number of storable codewords\n  switch (mode) {\n    case Mode.NUMERIC:\n      return Math.floor((usableBits / 10) * 3)\n\n    case Mode.ALPHANUMERIC:\n      return Math.floor((usableBits / 11) * 2)\n\n    case Mode.KANJI:\n      return Math.floor(usableBits / 13)\n\n    case Mode.BYTE:\n    default:\n      return Math.floor(usableBits / 8)\n  }\n}\n\n/**\n * Returns the minimum version needed to contain the amount of data\n *\n * @param  {Segment} data                    Segment of data\n * @param  {Number} [errorCorrectionLevel=H] Error correction level\n * @param  {Mode} mode                       Data mode\n * @return {Number}                          QR Code version\n */\nexports.getBestVersionForData = function getBestVersionForData (data, errorCorrectionLevel) {\n  let seg\n\n  const ecl = ECLevel.from(errorCorrectionLevel, ECLevel.M)\n\n  if (Array.isArray(data)) {\n    if (data.length > 1) {\n      return getBestVersionForMixedData(data, ecl)\n    }\n\n    if (data.length === 0) {\n      return 1\n    }\n\n    seg = data[0]\n  } else {\n    seg = data\n  }\n\n  return getBestVersionForDataLength(seg.mode, seg.getLength(), ecl)\n}\n\n/**\n * Returns version information with relative error correction bits\n *\n * The version information is included in QR Code symbols of version 7 or larger.\n * It consists of an 18-bit sequence containing 6 data bits,\n * with 12 error correction bits calculated using the (18, 6) Golay code.\n *\n * @param  {Number} version QR Code version\n * @return {Number}         Encoded version info bits\n */\nexports.getEncodedBits = function getEncodedBits (version) {\n  if (!VersionCheck.isValid(version) || version < 7) {\n    throw new Error('Invalid QR Code version')\n  }\n\n  let d = version << 12\n\n  while (Utils.getBCHDigit(d) - G18_BCH >= 0) {\n    d ^= (G18 << (Utils.getBCHDigit(d) - G18_BCH))\n  }\n\n  return (version << 12) | d\n}\n","const Utils = require('./utils')\n\nconst G15 = (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0)\nconst G15_MASK = (1 << 14) | (1 << 12) | (1 << 10) | (1 << 4) | (1 << 1)\nconst G15_BCH = Utils.getBCHDigit(G15)\n\n/**\n * Returns format information with relative error correction bits\n *\n * The format information is a 15-bit sequence containing 5 data bits,\n * with 10 error correction bits calculated using the (15, 5) BCH code.\n *\n * @param  {Number} errorCorrectionLevel Error correction level\n * @param  {Number} mask                 Mask pattern\n * @return {Number}                      Encoded format information bits\n */\nexports.getEncodedBits = function getEncodedBits (errorCorrectionLevel, mask) {\n  const data = ((errorCorrectionLevel.bit << 3) | mask)\n  let d = data << 10\n\n  while (Utils.getBCHDigit(d) - G15_BCH >= 0) {\n    d ^= (G15 << (Utils.getBCHDigit(d) - G15_BCH))\n  }\n\n  // xor final data with mask pattern in order to ensure that\n  // no combination of Error Correction Level and data mask pattern\n  // will result in an all-zero data string\n  return ((data << 10) | d) ^ G15_MASK\n}\n","const Mode = require('./mode')\n\nfunction NumericData (data) {\n  this.mode = Mode.NUMERIC\n  this.data = data.toString()\n}\n\nNumericData.getBitsLength = function getBitsLength (length) {\n  return 10 * Math.floor(length / 3) + ((length % 3) ? ((length % 3) * 3 + 1) : 0)\n}\n\nNumericData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nNumericData.prototype.getBitsLength = function getBitsLength () {\n  return NumericData.getBitsLength(this.data.length)\n}\n\nNumericData.prototype.write = function write (bitBuffer) {\n  let i, group, value\n\n  // The input data string is divided into groups of three digits,\n  // and each group is converted to its 10-bit binary equivalent.\n  for (i = 0; i + 3 <= this.data.length; i += 3) {\n    group = this.data.substr(i, 3)\n    value = parseInt(group, 10)\n\n    bitBuffer.put(value, 10)\n  }\n\n  // If the number of input digits is not an exact multiple of three,\n  // the final one or two digits are converted to 4 or 7 bits respectively.\n  const remainingNum = this.data.length - i\n  if (remainingNum > 0) {\n    group = this.data.substr(i)\n    value = parseInt(group, 10)\n\n    bitBuffer.put(value, remainingNum * 3 + 1)\n  }\n}\n\nmodule.exports = NumericData\n","const Mode = require('./mode')\n\n/**\n * Array of characters available in alphanumeric mode\n *\n * As per QR Code specification, to each character\n * is assigned a value from 0 to 44 which in this case coincides\n * with the array index\n *\n * @type {Array}\n */\nconst ALPHA_NUM_CHARS = [\n  '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',\n  'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',\n  'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',\n  ' ', '$', '%', '*', '+', '-', '.', '/', ':'\n]\n\nfunction AlphanumericData (data) {\n  this.mode = Mode.ALPHANUMERIC\n  this.data = data\n}\n\nAlphanumericData.getBitsLength = function getBitsLength (length) {\n  return 11 * Math.floor(length / 2) + 6 * (length % 2)\n}\n\nAlphanumericData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nAlphanumericData.prototype.getBitsLength = function getBitsLength () {\n  return AlphanumericData.getBitsLength(this.data.length)\n}\n\nAlphanumericData.prototype.write = function write (bitBuffer) {\n  let i\n\n  // Input data characters are divided into groups of two characters\n  // and encoded as 11-bit binary codes.\n  for (i = 0; i + 2 <= this.data.length; i += 2) {\n    // The character value of the first character is multiplied by 45\n    let value = ALPHA_NUM_CHARS.indexOf(this.data[i]) * 45\n\n    // The character value of the second digit is added to the product\n    value += ALPHA_NUM_CHARS.indexOf(this.data[i + 1])\n\n    // The sum is then stored as 11-bit binary number\n    bitBuffer.put(value, 11)\n  }\n\n  // If the number of input data characters is not a multiple of two,\n  // the character value of the final character is encoded as a 6-bit binary number.\n  if (this.data.length % 2) {\n    bitBuffer.put(ALPHA_NUM_CHARS.indexOf(this.data[i]), 6)\n  }\n}\n\nmodule.exports = AlphanumericData\n","const Mode = require('./mode')\n\nfunction ByteData (data) {\n  this.mode = Mode.BYTE\n  if (typeof (data) === 'string') {\n    this.data = new TextEncoder().encode(data)\n  } else {\n    this.data = new Uint8Array(data)\n  }\n}\n\nByteData.getBitsLength = function getBitsLength (length) {\n  return length * 8\n}\n\nByteData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nByteData.prototype.getBitsLength = function getBitsLength () {\n  return ByteData.getBitsLength(this.data.length)\n}\n\nByteData.prototype.write = function (bitBuffer) {\n  for (let i = 0, l = this.data.length; i < l; i++) {\n    bitBuffer.put(this.data[i], 8)\n  }\n}\n\nmodule.exports = ByteData\n","const Mode = require('./mode')\nconst Utils = require('./utils')\n\nfunction KanjiData (data) {\n  this.mode = Mode.KANJI\n  this.data = data\n}\n\nKanjiData.getBitsLength = function getBitsLength (length) {\n  return length * 13\n}\n\nKanjiData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nKanjiData.prototype.getBitsLength = function getBitsLength () {\n  return KanjiData.getBitsLength(this.data.length)\n}\n\nKanjiData.prototype.write = function (bitBuffer) {\n  let i\n\n  // In the Shift JIS system, Kanji characters are represented by a two byte combination.\n  // These byte values are shifted from the JIS X 0208 values.\n  // JIS X 0208 gives details of the shift coded representation.\n  for (i = 0; i < this.data.length; i++) {\n    let value = Utils.toSJIS(this.data[i])\n\n    // For characters with Shift JIS values from 0x8140 to 0x9FFC:\n    if (value >= 0x8140 && value <= 0x9FFC) {\n      // Subtract 0x8140 from Shift JIS value\n      value -= 0x8140\n\n    // For characters with Shift JIS values from 0xE040 to 0xEBBF\n    } else if (value >= 0xE040 && value <= 0xEBBF) {\n      // Subtract 0xC140 from Shift JIS value\n      value -= 0xC140\n    } else {\n      throw new Error(\n        'Invalid SJIS character: ' + this.data[i] + '\\n' +\n        'Make sure your charset is UTF-8')\n    }\n\n    // Multiply most significant byte of result by 0xC0\n    // and add least significant byte to product\n    value = (((value >>> 8) & 0xff) * 0xC0) + (value & 0xff)\n\n    // Convert result to a 13-bit binary string\n    bitBuffer.put(value, 13)\n  }\n}\n\nmodule.exports = KanjiData\n","'use strict';\n\n/******************************************************************************\n * Created 2008-08-19.\n *\n * Dijkstra path-finding functions. Adapted from the Dijkstar Python project.\n *\n * Copyright (C) 2008\n *   Wyatt Baldwin <self@wyattbaldwin.com>\n *   All rights reserved\n *\n * Licensed under the MIT license.\n *\n *   http://www.opensource.org/licenses/mit-license.php\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *****************************************************************************/\nvar dijkstra = {\n  single_source_shortest_paths: function(graph, s, d) {\n    // Predecessor map for each node that has been encountered.\n    // node ID => predecessor node ID\n    var predecessors = {};\n\n    // Costs of shortest paths from s to all nodes encountered.\n    // node ID => cost\n    var costs = {};\n    costs[s] = 0;\n\n    // Costs of shortest paths from s to all nodes encountered; differs from\n    // `costs` in that it provides easy access to the node that currently has\n    // the known shortest path from s.\n    // XXX: Do we actually need both `costs` and `open`?\n    var open = dijkstra.PriorityQueue.make();\n    open.push(s, 0);\n\n    var closest,\n        u, v,\n        cost_of_s_to_u,\n        adjacent_nodes,\n        cost_of_e,\n        cost_of_s_to_u_plus_cost_of_e,\n        cost_of_s_to_v,\n        first_visit;\n    while (!open.empty()) {\n      // In the nodes remaining in graph that have a known cost from s,\n      // find the node, u, that currently has the shortest path from s.\n      closest = open.pop();\n      u = closest.value;\n      cost_of_s_to_u = closest.cost;\n\n      // Get nodes adjacent to u...\n      adjacent_nodes = graph[u] || {};\n\n      // ...and explore the edges that connect u to those nodes, updating\n      // the cost of the shortest paths to any or all of those nodes as\n      // necessary. v is the node across the current edge from u.\n      for (v in adjacent_nodes) {\n        if (adjacent_nodes.hasOwnProperty(v)) {\n          // Get the cost of the edge running from u to v.\n          cost_of_e = adjacent_nodes[v];\n\n          // Cost of s to u plus the cost of u to v across e--this is *a*\n          // cost from s to v that may or may not be less than the current\n          // known cost to v.\n          cost_of_s_to_u_plus_cost_of_e = cost_of_s_to_u + cost_of_e;\n\n          // If we haven't visited v yet OR if the current known cost from s to\n          // v is greater than the new cost we just found (cost of s to u plus\n          // cost of u to v across e), update v's cost in the cost list and\n          // update v's predecessor in the predecessor list (it's now u).\n          cost_of_s_to_v = costs[v];\n          first_visit = (typeof costs[v] === 'undefined');\n          if (first_visit || cost_of_s_to_v > cost_of_s_to_u_plus_cost_of_e) {\n            costs[v] = cost_of_s_to_u_plus_cost_of_e;\n            open.push(v, cost_of_s_to_u_plus_cost_of_e);\n            predecessors[v] = u;\n          }\n        }\n      }\n    }\n\n    if (typeof d !== 'undefined' && typeof costs[d] === 'undefined') {\n      var msg = ['Could not find a path from ', s, ' to ', d, '.'].join('');\n      throw new Error(msg);\n    }\n\n    return predecessors;\n  },\n\n  extract_shortest_path_from_predecessor_list: function(predecessors, d) {\n    var nodes = [];\n    var u = d;\n    var predecessor;\n    while (u) {\n      nodes.push(u);\n      predecessor = predecessors[u];\n      u = predecessors[u];\n    }\n    nodes.reverse();\n    return nodes;\n  },\n\n  find_path: function(graph, s, d) {\n    var predecessors = dijkstra.single_source_shortest_paths(graph, s, d);\n    return dijkstra.extract_shortest_path_from_predecessor_list(\n      predecessors, d);\n  },\n\n  /**\n   * A very naive priority queue implementation.\n   */\n  PriorityQueue: {\n    make: function (opts) {\n      var T = dijkstra.PriorityQueue,\n          t = {},\n          key;\n      opts = opts || {};\n      for (key in T) {\n        if (T.hasOwnProperty(key)) {\n          t[key] = T[key];\n        }\n      }\n      t.queue = [];\n      t.sorter = opts.sorter || T.default_sorter;\n      return t;\n    },\n\n    default_sorter: function (a, b) {\n      return a.cost - b.cost;\n    },\n\n    /**\n     * Add a new item to the queue and ensure the highest priority element\n     * is at the front of the queue.\n     */\n    push: function (value, cost) {\n      var item = {value: value, cost: cost};\n      this.queue.push(item);\n      this.queue.sort(this.sorter);\n    },\n\n    /**\n     * Return the highest priority element in the queue.\n     */\n    pop: function () {\n      return this.queue.shift();\n    },\n\n    empty: function () {\n      return this.queue.length === 0;\n    }\n  }\n};\n\n\n// node.js module exports\nif (typeof module !== 'undefined') {\n  module.exports = dijkstra;\n}\n","const Mode = require('./mode')\nconst NumericData = require('./numeric-data')\nconst AlphanumericData = require('./alphanumeric-data')\nconst ByteData = require('./byte-data')\nconst KanjiData = require('./kanji-data')\nconst Regex = require('./regex')\nconst Utils = require('./utils')\nconst dijkstra = require('dijkstrajs')\n\n/**\n * Returns UTF8 byte length\n *\n * @param  {String} str Input string\n * @return {Number}     Number of byte\n */\nfunction getStringByteLength (str) {\n  return unescape(encodeURIComponent(str)).length\n}\n\n/**\n * Get a list of segments of the specified mode\n * from a string\n *\n * @param  {Mode}   mode Segment mode\n * @param  {String} str  String to process\n * @return {Array}       Array of object with segments data\n */\nfunction getSegments (regex, mode, str) {\n  const segments = []\n  let result\n\n  while ((result = regex.exec(str)) !== null) {\n    segments.push({\n      data: result[0],\n      index: result.index,\n      mode: mode,\n      length: result[0].length\n    })\n  }\n\n  return segments\n}\n\n/**\n * Extracts a series of segments with the appropriate\n * modes from a string\n *\n * @param  {String} dataStr Input string\n * @return {Array}          Array of object with segments data\n */\nfunction getSegmentsFromString (dataStr) {\n  const numSegs = getSegments(Regex.NUMERIC, Mode.NUMERIC, dataStr)\n  const alphaNumSegs = getSegments(Regex.ALPHANUMERIC, Mode.ALPHANUMERIC, dataStr)\n  let byteSegs\n  let kanjiSegs\n\n  if (Utils.isKanjiModeEnabled()) {\n    byteSegs = getSegments(Regex.BYTE, Mode.BYTE, dataStr)\n    kanjiSegs = getSegments(Regex.KANJI, Mode.KANJI, dataStr)\n  } else {\n    byteSegs = getSegments(Regex.BYTE_KANJI, Mode.BYTE, dataStr)\n    kanjiSegs = []\n  }\n\n  const segs = numSegs.concat(alphaNumSegs, byteSegs, kanjiSegs)\n\n  return segs\n    .sort(function (s1, s2) {\n      return s1.index - s2.index\n    })\n    .map(function (obj) {\n      return {\n        data: obj.data,\n        mode: obj.mode,\n        length: obj.length\n      }\n    })\n}\n\n/**\n * Returns how many bits are needed to encode a string of\n * specified length with the specified mode\n *\n * @param  {Number} length String length\n * @param  {Mode} mode     Segment mode\n * @return {Number}        Bit length\n */\nfunction getSegmentBitsLength (length, mode) {\n  switch (mode) {\n    case Mode.NUMERIC:\n      return NumericData.getBitsLength(length)\n    case Mode.ALPHANUMERIC:\n      return AlphanumericData.getBitsLength(length)\n    case Mode.KANJI:\n      return KanjiData.getBitsLength(length)\n    case Mode.BYTE:\n      return ByteData.getBitsLength(length)\n  }\n}\n\n/**\n * Merges adjacent segments which have the same mode\n *\n * @param  {Array} segs Array of object with segments data\n * @return {Array}      Array of object with segments data\n */\nfunction mergeSegments (segs) {\n  return segs.reduce(function (acc, curr) {\n    const prevSeg = acc.length - 1 >= 0 ? acc[acc.length - 1] : null\n    if (prevSeg && prevSeg.mode === curr.mode) {\n      acc[acc.length - 1].data += curr.data\n      return acc\n    }\n\n    acc.push(curr)\n    return acc\n  }, [])\n}\n\n/**\n * Generates a list of all possible nodes combination which\n * will be used to build a segments graph.\n *\n * Nodes are divided by groups. Each group will contain a list of all the modes\n * in which is possible to encode the given text.\n *\n * For example the text '12345' can be encoded as Numeric, Alphanumeric or Byte.\n * The group for '12345' will contain then 3 objects, one for each\n * possible encoding mode.\n *\n * Each node represents a possible segment.\n *\n * @param  {Array} segs Array of object with segments data\n * @return {Array}      Array of object with segments data\n */\nfunction buildNodes (segs) {\n  const nodes = []\n  for (let i = 0; i < segs.length; i++) {\n    const seg = segs[i]\n\n    switch (seg.mode) {\n      case Mode.NUMERIC:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.ALPHANUMERIC, length: seg.length },\n          { data: seg.data, mode: Mode.BYTE, length: seg.length }\n        ])\n        break\n      case Mode.ALPHANUMERIC:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.BYTE, length: seg.length }\n        ])\n        break\n      case Mode.KANJI:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }\n        ])\n        break\n      case Mode.BYTE:\n        nodes.push([\n          { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }\n        ])\n    }\n  }\n\n  return nodes\n}\n\n/**\n * Builds a graph from a list of nodes.\n * All segments in each node group will be connected with all the segments of\n * the next group and so on.\n *\n * At each connection will be assigned a weight depending on the\n * segment's byte length.\n *\n * @param  {Array} nodes    Array of object with segments data\n * @param  {Number} version QR Code version\n * @return {Object}         Graph of all possible segments\n */\nfunction buildGraph (nodes, version) {\n  const table = {}\n  const graph = { start: {} }\n  let prevNodeIds = ['start']\n\n  for (let i = 0; i < nodes.length; i++) {\n    const nodeGroup = nodes[i]\n    const currentNodeIds = []\n\n    for (let j = 0; j < nodeGroup.length; j++) {\n      const node = nodeGroup[j]\n      const key = '' + i + j\n\n      currentNodeIds.push(key)\n      table[key] = { node: node, lastCount: 0 }\n      graph[key] = {}\n\n      for (let n = 0; n < prevNodeIds.length; n++) {\n        const prevNodeId = prevNodeIds[n]\n\n        if (table[prevNodeId] && table[prevNodeId].node.mode === node.mode) {\n          graph[prevNodeId][key] =\n            getSegmentBitsLength(table[prevNodeId].lastCount + node.length, node.mode) -\n            getSegmentBitsLength(table[prevNodeId].lastCount, node.mode)\n\n          table[prevNodeId].lastCount += node.length\n        } else {\n          if (table[prevNodeId]) table[prevNodeId].lastCount = node.length\n\n          graph[prevNodeId][key] = getSegmentBitsLength(node.length, node.mode) +\n            4 + Mode.getCharCountIndicator(node.mode, version) // switch cost\n        }\n      }\n    }\n\n    prevNodeIds = currentNodeIds\n  }\n\n  for (let n = 0; n < prevNodeIds.length; n++) {\n    graph[prevNodeIds[n]].end = 0\n  }\n\n  return { map: graph, table: table }\n}\n\n/**\n * Builds a segment from a specified data and mode.\n * If a mode is not specified, the more suitable will be used.\n *\n * @param  {String} data             Input data\n * @param  {Mode | String} modesHint Data mode\n * @return {Segment}                 Segment\n */\nfunction buildSingleSegment (data, modesHint) {\n  let mode\n  const bestMode = Mode.getBestModeForData(data)\n\n  mode = Mode.from(modesHint, bestMode)\n\n  // Make sure data can be encoded\n  if (mode !== Mode.BYTE && mode.bit < bestMode.bit) {\n    throw new Error('\"' + data + '\"' +\n      ' cannot be encoded with mode ' + Mode.toString(mode) +\n      '.\\n Suggested mode is: ' + Mode.toString(bestMode))\n  }\n\n  // Use Mode.BYTE if Kanji support is disabled\n  if (mode === Mode.KANJI && !Utils.isKanjiModeEnabled()) {\n    mode = Mode.BYTE\n  }\n\n  switch (mode) {\n    case Mode.NUMERIC:\n      return new NumericData(data)\n\n    case Mode.ALPHANUMERIC:\n      return new AlphanumericData(data)\n\n    case Mode.KANJI:\n      return new KanjiData(data)\n\n    case Mode.BYTE:\n      return new ByteData(data)\n  }\n}\n\n/**\n * Builds a list of segments from an array.\n * Array can contain Strings or Objects with segment's info.\n *\n * For each item which is a string, will be generated a segment with the given\n * string and the more appropriate encoding mode.\n *\n * For each item which is an object, will be generated a segment with the given\n * data and mode.\n * Objects must contain at least the property \"data\".\n * If property \"mode\" is not present, the more suitable mode will be used.\n *\n * @param  {Array} array Array of objects with segments data\n * @return {Array}       Array of Segments\n */\nexports.fromArray = function fromArray (array) {\n  return array.reduce(function (acc, seg) {\n    if (typeof seg === 'string') {\n      acc.push(buildSingleSegment(seg, null))\n    } else if (seg.data) {\n      acc.push(buildSingleSegment(seg.data, seg.mode))\n    }\n\n    return acc\n  }, [])\n}\n\n/**\n * Builds an optimized sequence of segments from a string,\n * which will produce the shortest possible bitstream.\n *\n * @param  {String} data    Input string\n * @param  {Number} version QR Code version\n * @return {Array}          Array of segments\n */\nexports.fromString = function fromString (data, version) {\n  const segs = getSegmentsFromString(data, Utils.isKanjiModeEnabled())\n\n  const nodes = buildNodes(segs)\n  const graph = buildGraph(nodes, version)\n  const path = dijkstra.find_path(graph.map, 'start', 'end')\n\n  const optimizedSegs = []\n  for (let i = 1; i < path.length - 1; i++) {\n    optimizedSegs.push(graph.table[path[i]].node)\n  }\n\n  return exports.fromArray(mergeSegments(optimizedSegs))\n}\n\n/**\n * Splits a string in various segments with the modes which\n * best represent their content.\n * The produced segments are far from being optimized.\n * The output of this function is only used to estimate a QR Code version\n * which may contain the data.\n *\n * @param  {string} data Input string\n * @return {Array}       Array of segments\n */\nexports.rawSplit = function rawSplit (data) {\n  return exports.fromArray(\n    getSegmentsFromString(data, Utils.isKanjiModeEnabled())\n  )\n}\n","const Utils = require('./utils')\nconst ECLevel = require('./error-correction-level')\nconst BitBuffer = require('./bit-buffer')\nconst BitMatrix = require('./bit-matrix')\nconst AlignmentPattern = require('./alignment-pattern')\nconst FinderPattern = require('./finder-pattern')\nconst MaskPattern = require('./mask-pattern')\nconst ECCode = require('./error-correction-code')\nconst ReedSolomonEncoder = require('./reed-solomon-encoder')\nconst Version = require('./version')\nconst FormatInfo = require('./format-info')\nconst Mode = require('./mode')\nconst Segments = require('./segments')\n\n/**\n * QRCode for JavaScript\n *\n * modified by Ryan Day for nodejs support\n * Copyright (c) 2011 Ryan Day\n *\n * Licensed under the MIT license:\n *   http://www.opensource.org/licenses/mit-license.php\n *\n//---------------------------------------------------------------------\n// QRCode for JavaScript\n//\n// Copyright (c) 2009 Kazuhiko Arase\n//\n// URL: http://www.d-project.com/\n//\n// Licensed under the MIT license:\n//   http://www.opensource.org/licenses/mit-license.php\n//\n// The word \"QR Code\" is registered trademark of\n// DENSO WAVE INCORPORATED\n//   http://www.denso-wave.com/qrcode/faqpatent-e.html\n//\n//---------------------------------------------------------------------\n*/\n\n/**\n * Add finder patterns bits to matrix\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupFinderPattern (matrix, version) {\n  const size = matrix.size\n  const pos = FinderPattern.getPositions(version)\n\n  for (let i = 0; i < pos.length; i++) {\n    const row = pos[i][0]\n    const col = pos[i][1]\n\n    for (let r = -1; r <= 7; r++) {\n      if (row + r <= -1 || size <= row + r) continue\n\n      for (let c = -1; c <= 7; c++) {\n        if (col + c <= -1 || size <= col + c) continue\n\n        if ((r >= 0 && r <= 6 && (c === 0 || c === 6)) ||\n          (c >= 0 && c <= 6 && (r === 0 || r === 6)) ||\n          (r >= 2 && r <= 4 && c >= 2 && c <= 4)) {\n          matrix.set(row + r, col + c, true, true)\n        } else {\n          matrix.set(row + r, col + c, false, true)\n        }\n      }\n    }\n  }\n}\n\n/**\n * Add timing pattern bits to matrix\n *\n * Note: this function must be called before {@link setupAlignmentPattern}\n *\n * @param  {BitMatrix} matrix Modules matrix\n */\nfunction setupTimingPattern (matrix) {\n  const size = matrix.size\n\n  for (let r = 8; r < size - 8; r++) {\n    const value = r % 2 === 0\n    matrix.set(r, 6, value, true)\n    matrix.set(6, r, value, true)\n  }\n}\n\n/**\n * Add alignment patterns bits to matrix\n *\n * Note: this function must be called after {@link setupTimingPattern}\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupAlignmentPattern (matrix, version) {\n  const pos = AlignmentPattern.getPositions(version)\n\n  for (let i = 0; i < pos.length; i++) {\n    const row = pos[i][0]\n    const col = pos[i][1]\n\n    for (let r = -2; r <= 2; r++) {\n      for (let c = -2; c <= 2; c++) {\n        if (r === -2 || r === 2 || c === -2 || c === 2 ||\n          (r === 0 && c === 0)) {\n          matrix.set(row + r, col + c, true, true)\n        } else {\n          matrix.set(row + r, col + c, false, true)\n        }\n      }\n    }\n  }\n}\n\n/**\n * Add version info bits to matrix\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupVersionInfo (matrix, version) {\n  const size = matrix.size\n  const bits = Version.getEncodedBits(version)\n  let row, col, mod\n\n  for (let i = 0; i < 18; i++) {\n    row = Math.floor(i / 3)\n    col = i % 3 + size - 8 - 3\n    mod = ((bits >> i) & 1) === 1\n\n    matrix.set(row, col, mod, true)\n    matrix.set(col, row, mod, true)\n  }\n}\n\n/**\n * Add format info bits to matrix\n *\n * @param  {BitMatrix} matrix               Modules matrix\n * @param  {ErrorCorrectionLevel}    errorCorrectionLevel Error correction level\n * @param  {Number}    maskPattern          Mask pattern reference value\n */\nfunction setupFormatInfo (matrix, errorCorrectionLevel, maskPattern) {\n  const size = matrix.size\n  const bits = FormatInfo.getEncodedBits(errorCorrectionLevel, maskPattern)\n  let i, mod\n\n  for (i = 0; i < 15; i++) {\n    mod = ((bits >> i) & 1) === 1\n\n    // vertical\n    if (i < 6) {\n      matrix.set(i, 8, mod, true)\n    } else if (i < 8) {\n      matrix.set(i + 1, 8, mod, true)\n    } else {\n      matrix.set(size - 15 + i, 8, mod, true)\n    }\n\n    // horizontal\n    if (i < 8) {\n      matrix.set(8, size - i - 1, mod, true)\n    } else if (i < 9) {\n      matrix.set(8, 15 - i - 1 + 1, mod, true)\n    } else {\n      matrix.set(8, 15 - i - 1, mod, true)\n    }\n  }\n\n  // fixed module\n  matrix.set(size - 8, 8, 1, true)\n}\n\n/**\n * Add encoded data bits to matrix\n *\n * @param  {BitMatrix}  matrix Modules matrix\n * @param  {Uint8Array} data   Data codewords\n */\nfunction setupData (matrix, data) {\n  const size = matrix.size\n  let inc = -1\n  let row = size - 1\n  let bitIndex = 7\n  let byteIndex = 0\n\n  for (let col = size - 1; col > 0; col -= 2) {\n    if (col === 6) col--\n\n    while (true) {\n      for (let c = 0; c < 2; c++) {\n        if (!matrix.isReserved(row, col - c)) {\n          let dark = false\n\n          if (byteIndex < data.length) {\n            dark = (((data[byteIndex] >>> bitIndex) & 1) === 1)\n          }\n\n          matrix.set(row, col - c, dark)\n          bitIndex--\n\n          if (bitIndex === -1) {\n            byteIndex++\n            bitIndex = 7\n          }\n        }\n      }\n\n      row += inc\n\n      if (row < 0 || size <= row) {\n        row -= inc\n        inc = -inc\n        break\n      }\n    }\n  }\n}\n\n/**\n * Create encoded codewords from data input\n *\n * @param  {Number}   version              QR Code version\n * @param  {ErrorCorrectionLevel}   errorCorrectionLevel Error correction level\n * @param  {ByteData} data                 Data input\n * @return {Uint8Array}                    Buffer containing encoded codewords\n */\nfunction createData (version, errorCorrectionLevel, segments) {\n  // Prepare data buffer\n  const buffer = new BitBuffer()\n\n  segments.forEach(function (data) {\n    // prefix data with mode indicator (4 bits)\n    buffer.put(data.mode.bit, 4)\n\n    // Prefix data with character count indicator.\n    // The character count indicator is a string of bits that represents the\n    // number of characters that are being encoded.\n    // The character count indicator must be placed after the mode indicator\n    // and must be a certain number of bits long, depending on the QR version\n    // and data mode\n    // @see {@link Mode.getCharCountIndicator}.\n    buffer.put(data.getLength(), Mode.getCharCountIndicator(data.mode, version))\n\n    // add binary data sequence to buffer\n    data.write(buffer)\n  })\n\n  // Calculate required number of bits\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n  const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8\n\n  // Add a terminator.\n  // If the bit string is shorter than the total number of required bits,\n  // a terminator of up to four 0s must be added to the right side of the string.\n  // If the bit string is more than four bits shorter than the required number of bits,\n  // add four 0s to the end.\n  if (buffer.getLengthInBits() + 4 <= dataTotalCodewordsBits) {\n    buffer.put(0, 4)\n  }\n\n  // If the bit string is fewer than four bits shorter, add only the number of 0s that\n  // are needed to reach the required number of bits.\n\n  // After adding the terminator, if the number of bits in the string is not a multiple of 8,\n  // pad the string on the right with 0s to make the string's length a multiple of 8.\n  while (buffer.getLengthInBits() % 8 !== 0) {\n    buffer.putBit(0)\n  }\n\n  // Add pad bytes if the string is still shorter than the total number of required bits.\n  // Extend the buffer to fill the data capacity of the symbol corresponding to\n  // the Version and Error Correction Level by adding the Pad Codewords 11101100 (0xEC)\n  // and 00010001 (0x11) alternately.\n  const remainingByte = (dataTotalCodewordsBits - buffer.getLengthInBits()) / 8\n  for (let i = 0; i < remainingByte; i++) {\n    buffer.put(i % 2 ? 0x11 : 0xEC, 8)\n  }\n\n  return createCodewords(buffer, version, errorCorrectionLevel)\n}\n\n/**\n * Encode input data with Reed-Solomon and return codewords with\n * relative error correction bits\n *\n * @param  {BitBuffer} bitBuffer            Data to encode\n * @param  {Number}    version              QR Code version\n * @param  {ErrorCorrectionLevel} errorCorrectionLevel Error correction level\n * @return {Uint8Array}                     Buffer containing encoded codewords\n */\nfunction createCodewords (bitBuffer, version, errorCorrectionLevel) {\n  // Total codewords for this QR code version (Data + Error correction)\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n\n  // Total number of error correction codewords\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n\n  // Total number of data codewords\n  const dataTotalCodewords = totalCodewords - ecTotalCodewords\n\n  // Total number of blocks\n  const ecTotalBlocks = ECCode.getBlocksCount(version, errorCorrectionLevel)\n\n  // Calculate how many blocks each group should contain\n  const blocksInGroup2 = totalCodewords % ecTotalBlocks\n  const blocksInGroup1 = ecTotalBlocks - blocksInGroup2\n\n  const totalCodewordsInGroup1 = Math.floor(totalCodewords / ecTotalBlocks)\n\n  const dataCodewordsInGroup1 = Math.floor(dataTotalCodewords / ecTotalBlocks)\n  const dataCodewordsInGroup2 = dataCodewordsInGroup1 + 1\n\n  // Number of EC codewords is the same for both groups\n  const ecCount = totalCodewordsInGroup1 - dataCodewordsInGroup1\n\n  // Initialize a Reed-Solomon encoder with a generator polynomial of degree ecCount\n  const rs = new ReedSolomonEncoder(ecCount)\n\n  let offset = 0\n  const dcData = new Array(ecTotalBlocks)\n  const ecData = new Array(ecTotalBlocks)\n  let maxDataSize = 0\n  const buffer = new Uint8Array(bitBuffer.buffer)\n\n  // Divide the buffer into the required number of blocks\n  for (let b = 0; b < ecTotalBlocks; b++) {\n    const dataSize = b < blocksInGroup1 ? dataCodewordsInGroup1 : dataCodewordsInGroup2\n\n    // extract a block of data from buffer\n    dcData[b] = buffer.slice(offset, offset + dataSize)\n\n    // Calculate EC codewords for this data block\n    ecData[b] = rs.encode(dcData[b])\n\n    offset += dataSize\n    maxDataSize = Math.max(maxDataSize, dataSize)\n  }\n\n  // Create final data\n  // Interleave the data and error correction codewords from each block\n  const data = new Uint8Array(totalCodewords)\n  let index = 0\n  let i, r\n\n  // Add data codewords\n  for (i = 0; i < maxDataSize; i++) {\n    for (r = 0; r < ecTotalBlocks; r++) {\n      if (i < dcData[r].length) {\n        data[index++] = dcData[r][i]\n      }\n    }\n  }\n\n  // Apped EC codewords\n  for (i = 0; i < ecCount; i++) {\n    for (r = 0; r < ecTotalBlocks; r++) {\n      data[index++] = ecData[r][i]\n    }\n  }\n\n  return data\n}\n\n/**\n * Build QR Code symbol\n *\n * @param  {String} data                 Input string\n * @param  {Number} version              QR Code version\n * @param  {ErrorCorretionLevel} errorCorrectionLevel Error level\n * @param  {MaskPattern} maskPattern     Mask pattern\n * @return {Object}                      Object containing symbol data\n */\nfunction createSymbol (data, version, errorCorrectionLevel, maskPattern) {\n  let segments\n\n  if (Array.isArray(data)) {\n    segments = Segments.fromArray(data)\n  } else if (typeof data === 'string') {\n    let estimatedVersion = version\n\n    if (!estimatedVersion) {\n      const rawSegments = Segments.rawSplit(data)\n\n      // Estimate best version that can contain raw splitted segments\n      estimatedVersion = Version.getBestVersionForData(rawSegments, errorCorrectionLevel)\n    }\n\n    // Build optimized segments\n    // If estimated version is undefined, try with the highest version\n    segments = Segments.fromString(data, estimatedVersion || 40)\n  } else {\n    throw new Error('Invalid data')\n  }\n\n  // Get the min version that can contain data\n  const bestVersion = Version.getBestVersionForData(segments, errorCorrectionLevel)\n\n  // If no version is found, data cannot be stored\n  if (!bestVersion) {\n    throw new Error('The amount of data is too big to be stored in a QR Code')\n  }\n\n  // If not specified, use min version as default\n  if (!version) {\n    version = bestVersion\n\n  // Check if the specified version can contain the data\n  } else if (version < bestVersion) {\n    throw new Error('\\n' +\n      'The chosen QR Code version cannot contain this amount of data.\\n' +\n      'Minimum version required to store current data is: ' + bestVersion + '.\\n'\n    )\n  }\n\n  const dataBits = createData(version, errorCorrectionLevel, segments)\n\n  // Allocate matrix buffer\n  const moduleCount = Utils.getSymbolSize(version)\n  const modules = new BitMatrix(moduleCount)\n\n  // Add function modules\n  setupFinderPattern(modules, version)\n  setupTimingPattern(modules)\n  setupAlignmentPattern(modules, version)\n\n  // Add temporary dummy bits for format info just to set them as reserved.\n  // This is needed to prevent these bits from being masked by {@link MaskPattern.applyMask}\n  // since the masking operation must be performed only on the encoding region.\n  // These blocks will be replaced with correct values later in code.\n  setupFormatInfo(modules, errorCorrectionLevel, 0)\n\n  if (version >= 7) {\n    setupVersionInfo(modules, version)\n  }\n\n  // Add data codewords\n  setupData(modules, dataBits)\n\n  if (isNaN(maskPattern)) {\n    // Find best mask pattern\n    maskPattern = MaskPattern.getBestMask(modules,\n      setupFormatInfo.bind(null, modules, errorCorrectionLevel))\n  }\n\n  // Apply mask pattern\n  MaskPattern.applyMask(maskPattern, modules)\n\n  // Replace format info bits with correct values\n  setupFormatInfo(modules, errorCorrectionLevel, maskPattern)\n\n  return {\n    modules: modules,\n    version: version,\n    errorCorrectionLevel: errorCorrectionLevel,\n    maskPattern: maskPattern,\n    segments: segments\n  }\n}\n\n/**\n * QR Code\n *\n * @param {String | Array} data                 Input data\n * @param {Object} options                      Optional configurations\n * @param {Number} options.version              QR Code version\n * @param {String} options.errorCorrectionLevel Error correction level\n * @param {Function} options.toSJISFunc         Helper func to convert utf8 to sjis\n */\nexports.create = function create (data, options) {\n  if (typeof data === 'undefined' || data === '') {\n    throw new Error('No input text')\n  }\n\n  let errorCorrectionLevel = ECLevel.M\n  let version\n  let mask\n\n  if (typeof options !== 'undefined') {\n    // Use higher error correction level as default\n    errorCorrectionLevel = ECLevel.from(options.errorCorrectionLevel, ECLevel.M)\n    version = Version.from(options.version)\n    mask = MaskPattern.from(options.maskPattern)\n\n    if (options.toSJISFunc) {\n      Utils.setToSJISFunction(options.toSJISFunc)\n    }\n  }\n\n  return createSymbol(data, version, errorCorrectionLevel, mask)\n}\n","function hex2rgba (hex) {\n  if (typeof hex === 'number') {\n    hex = hex.toString()\n  }\n\n  if (typeof hex !== 'string') {\n    throw new Error('Color should be defined as hex string')\n  }\n\n  let hexCode = hex.slice().replace('#', '').split('')\n  if (hexCode.length < 3 || hexCode.length === 5 || hexCode.length > 8) {\n    throw new Error('Invalid hex color: ' + hex)\n  }\n\n  // Convert from short to long form (fff -> ffffff)\n  if (hexCode.length === 3 || hexCode.length === 4) {\n    hexCode = Array.prototype.concat.apply([], hexCode.map(function (c) {\n      return [c, c]\n    }))\n  }\n\n  // Add default alpha value\n  if (hexCode.length === 6) hexCode.push('F', 'F')\n\n  const hexValue = parseInt(hexCode.join(''), 16)\n\n  return {\n    r: (hexValue >> 24) & 255,\n    g: (hexValue >> 16) & 255,\n    b: (hexValue >> 8) & 255,\n    a: hexValue & 255,\n    hex: '#' + hexCode.slice(0, 6).join('')\n  }\n}\n\nexports.getOptions = function getOptions (options) {\n  if (!options) options = {}\n  if (!options.color) options.color = {}\n\n  const margin = typeof options.margin === 'undefined' ||\n    options.margin === null ||\n    options.margin < 0\n    ? 4\n    : options.margin\n\n  const width = options.width && options.width >= 21 ? options.width : undefined\n  const scale = options.scale || 4\n\n  return {\n    width: width,\n    scale: width ? 4 : scale,\n    margin: margin,\n    color: {\n      dark: hex2rgba(options.color.dark || '#000000ff'),\n      light: hex2rgba(options.color.light || '#ffffffff')\n    },\n    type: options.type,\n    rendererOpts: options.rendererOpts || {}\n  }\n}\n\nexports.getScale = function getScale (qrSize, opts) {\n  return opts.width && opts.width >= qrSize + opts.margin * 2\n    ? opts.width / (qrSize + opts.margin * 2)\n    : opts.scale\n}\n\nexports.getImageWidth = function getImageWidth (qrSize, opts) {\n  const scale = exports.getScale(qrSize, opts)\n  return Math.floor((qrSize + opts.margin * 2) * scale)\n}\n\nexports.qrToImageData = function qrToImageData (imgData, qr, opts) {\n  const size = qr.modules.size\n  const data = qr.modules.data\n  const scale = exports.getScale(size, opts)\n  const symbolSize = Math.floor((size + opts.margin * 2) * scale)\n  const scaledMargin = opts.margin * scale\n  const palette = [opts.color.light, opts.color.dark]\n\n  for (let i = 0; i < symbolSize; i++) {\n    for (let j = 0; j < symbolSize; j++) {\n      let posDst = (i * symbolSize + j) * 4\n      let pxColor = opts.color.light\n\n      if (i >= scaledMargin && j >= scaledMargin &&\n        i < symbolSize - scaledMargin && j < symbolSize - scaledMargin) {\n        const iSrc = Math.floor((i - scaledMargin) / scale)\n        const jSrc = Math.floor((j - scaledMargin) / scale)\n        pxColor = palette[data[iSrc * size + jSrc] ? 1 : 0]\n      }\n\n      imgData[posDst++] = pxColor.r\n      imgData[posDst++] = pxColor.g\n      imgData[posDst++] = pxColor.b\n      imgData[posDst] = pxColor.a\n    }\n  }\n}\n","const Utils = require('./utils')\n\nfunction clearCanvas (ctx, canvas, size) {\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n\n  if (!canvas.style) canvas.style = {}\n  canvas.height = size\n  canvas.width = size\n  canvas.style.height = size + 'px'\n  canvas.style.width = size + 'px'\n}\n\nfunction getCanvasElement () {\n  try {\n    return document.createElement('canvas')\n  } catch (e) {\n    throw new Error('You need to specify a canvas element')\n  }\n}\n\nexports.render = function render (qrData, canvas, options) {\n  let opts = options\n  let canvasEl = canvas\n\n  if (typeof opts === 'undefined' && (!canvas || !canvas.getContext)) {\n    opts = canvas\n    canvas = undefined\n  }\n\n  if (!canvas) {\n    canvasEl = getCanvasElement()\n  }\n\n  opts = Utils.getOptions(opts)\n  const size = Utils.getImageWidth(qrData.modules.size, opts)\n\n  const ctx = canvasEl.getContext('2d')\n  const image = ctx.createImageData(size, size)\n  Utils.qrToImageData(image.data, qrData, opts)\n\n  clearCanvas(ctx, canvasEl, size)\n  ctx.putImageData(image, 0, 0)\n\n  return canvasEl\n}\n\nexports.renderToDataURL = function renderToDataURL (qrData, canvas, options) {\n  let opts = options\n\n  if (typeof opts === 'undefined' && (!canvas || !canvas.getContext)) {\n    opts = canvas\n    canvas = undefined\n  }\n\n  if (!opts) opts = {}\n\n  const canvasEl = exports.render(qrData, canvas, opts)\n\n  const type = opts.type || 'image/png'\n  const rendererOpts = opts.rendererOpts || {}\n\n  return canvasEl.toDataURL(type, rendererOpts.quality)\n}\n","const Utils = require('./utils')\n\nfunction getColorAttrib (color, attrib) {\n  const alpha = color.a / 255\n  const str = attrib + '=\"' + color.hex + '\"'\n\n  return alpha < 1\n    ? str + ' ' + attrib + '-opacity=\"' + alpha.toFixed(2).slice(1) + '\"'\n    : str\n}\n\nfunction svgCmd (cmd, x, y) {\n  let str = cmd + x\n  if (typeof y !== 'undefined') str += ' ' + y\n\n  return str\n}\n\nfunction qrToPath (data, size, margin) {\n  let path = ''\n  let moveBy = 0\n  let newRow = false\n  let lineLength = 0\n\n  for (let i = 0; i < data.length; i++) {\n    const col = Math.floor(i % size)\n    const row = Math.floor(i / size)\n\n    if (!col && !newRow) newRow = true\n\n    if (data[i]) {\n      lineLength++\n\n      if (!(i > 0 && col > 0 && data[i - 1])) {\n        path += newRow\n          ? svgCmd('M', col + margin, 0.5 + row + margin)\n          : svgCmd('m', moveBy, 0)\n\n        moveBy = 0\n        newRow = false\n      }\n\n      if (!(col + 1 < size && data[i + 1])) {\n        path += svgCmd('h', lineLength)\n        lineLength = 0\n      }\n    } else {\n      moveBy++\n    }\n  }\n\n  return path\n}\n\nexports.render = function render (qrData, options, cb) {\n  const opts = Utils.getOptions(options)\n  const size = qrData.modules.size\n  const data = qrData.modules.data\n  const qrcodesize = size + opts.margin * 2\n\n  const bg = !opts.color.light.a\n    ? ''\n    : '<path ' + getColorAttrib(opts.color.light, 'fill') +\n      ' d=\"M0 0h' + qrcodesize + 'v' + qrcodesize + 'H0z\"/>'\n\n  const path =\n    '<path ' + getColorAttrib(opts.color.dark, 'stroke') +\n    ' d=\"' + qrToPath(data, size, opts.margin) + '\"/>'\n\n  const viewBox = 'viewBox=\"' + '0 0 ' + qrcodesize + ' ' + qrcodesize + '\"'\n\n  const width = !opts.width ? '' : 'width=\"' + opts.width + '\" height=\"' + opts.width + '\" '\n\n  const svgTag = '<svg xmlns=\"http://www.w3.org/2000/svg\" ' + width + viewBox + ' shape-rendering=\"crispEdges\">' + bg + path + '</svg>\\n'\n\n  if (typeof cb === 'function') {\n    cb(null, svgTag)\n  }\n\n  return svgTag\n}\n","\nconst canPromise = require('./can-promise')\n\nconst QRCode = require('./core/qrcode')\nconst CanvasRenderer = require('./renderer/canvas')\nconst SvgRenderer = require('./renderer/svg-tag.js')\n\nfunction renderCanvas (renderFunc, canvas, text, opts, cb) {\n  const args = [].slice.call(arguments, 1)\n  const argsNum = args.length\n  const isLastArgCb = typeof args[argsNum - 1] === 'function'\n\n  if (!isLastArgCb && !canPromise()) {\n    throw new Error('Callback required as last argument')\n  }\n\n  if (isLastArgCb) {\n    if (argsNum < 2) {\n      throw new Error('Too few arguments provided')\n    }\n\n    if (argsNum === 2) {\n      cb = text\n      text = canvas\n      canvas = opts = undefined\n    } else if (argsNum === 3) {\n      if (canvas.getContext && typeof cb === 'undefined') {\n        cb = opts\n        opts = undefined\n      } else {\n        cb = opts\n        opts = text\n        text = canvas\n        canvas = undefined\n      }\n    }\n  } else {\n    if (argsNum < 1) {\n      throw new Error('Too few arguments provided')\n    }\n\n    if (argsNum === 1) {\n      text = canvas\n      canvas = opts = undefined\n    } else if (argsNum === 2 && !canvas.getContext) {\n      opts = text\n      text = canvas\n      canvas = undefined\n    }\n\n    return new Promise(function (resolve, reject) {\n      try {\n        const data = QRCode.create(text, opts)\n        resolve(renderFunc(data, canvas, opts))\n      } catch (e) {\n        reject(e)\n      }\n    })\n  }\n\n  try {\n    const data = QRCode.create(text, opts)\n    cb(null, renderFunc(data, canvas, opts))\n  } catch (e) {\n    cb(e)\n  }\n}\n\nexports.create = QRCode.create\nexports.toCanvas = renderCanvas.bind(null, CanvasRenderer.render)\nexports.toDataURL = renderCanvas.bind(null, CanvasRenderer.renderToDataURL)\n\n// only svg for now.\nexports.toString = renderCanvas.bind(null, function (data, _, opts) {\n  return SvgRenderer.render(data, opts)\n})\n","const reduxImpl = (reducer, initial) => (set, _get, api) => {\n  api.dispatch = (action) => {\n    set((state) => reducer(state, action), false, action);\n    return action;\n  };\n  api.dispatchFromDevtools = true;\n  return { dispatch: (...a) => api.dispatch(...a), ...initial };\n};\nconst redux = reduxImpl;\n\nconst trackedConnections = /* @__PURE__ */ new Map();\nconst getTrackedConnectionState = (name) => {\n  const api = trackedConnections.get(name);\n  if (!api) return {};\n  return Object.fromEntries(\n    Object.entries(api.stores).map(([key, api2]) => [key, api2.getState()])\n  );\n};\nconst extractConnectionInformation = (store, extensionConnector, options) => {\n  if (store === void 0) {\n    return {\n      type: \"untracked\",\n      connection: extensionConnector.connect(options)\n    };\n  }\n  const existingConnection = trackedConnections.get(options.name);\n  if (existingConnection) {\n    return { type: \"tracked\", store, ...existingConnection };\n  }\n  const newConnection = {\n    connection: extensionConnector.connect(options),\n    stores: {}\n  };\n  trackedConnections.set(options.name, newConnection);\n  return { type: \"tracked\", store, ...newConnection };\n};\nconst devtoolsImpl = (fn, devtoolsOptions = {}) => (set, get, api) => {\n  const { enabled, anonymousActionType, store, ...options } = devtoolsOptions;\n  let extensionConnector;\n  try {\n    extensionConnector = (enabled != null ? enabled : (import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") && window.__REDUX_DEVTOOLS_EXTENSION__;\n  } catch (_e) {\n  }\n  if (!extensionConnector) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && enabled) {\n      console.warn(\n        \"[zustand devtools middleware] Please install/enable Redux devtools extension\"\n      );\n    }\n    return fn(set, get, api);\n  }\n  const { connection, ...connectionInformation } = extractConnectionInformation(store, extensionConnector, options);\n  let isRecording = true;\n  api.setState = (state, replace, nameOrAction) => {\n    const r = set(state, replace);\n    if (!isRecording) return r;\n    const action = nameOrAction === void 0 ? { type: anonymousActionType || \"anonymous\" } : typeof nameOrAction === \"string\" ? { type: nameOrAction } : nameOrAction;\n    if (store === void 0) {\n      connection == null ? void 0 : connection.send(action, get());\n      return r;\n    }\n    connection == null ? void 0 : connection.send(\n      {\n        ...action,\n        type: `${store}/${action.type}`\n      },\n      {\n        ...getTrackedConnectionState(options.name),\n        [store]: api.getState()\n      }\n    );\n    return r;\n  };\n  const setStateFromDevtools = (...a) => {\n    const originalIsRecording = isRecording;\n    isRecording = false;\n    set(...a);\n    isRecording = originalIsRecording;\n  };\n  const initialState = fn(api.setState, get, api);\n  if (connectionInformation.type === \"untracked\") {\n    connection == null ? void 0 : connection.init(initialState);\n  } else {\n    connectionInformation.stores[connectionInformation.store] = api;\n    connection == null ? void 0 : connection.init(\n      Object.fromEntries(\n        Object.entries(connectionInformation.stores).map(([key, store2]) => [\n          key,\n          key === connectionInformation.store ? initialState : store2.getState()\n        ])\n      )\n    );\n  }\n  if (api.dispatchFromDevtools && typeof api.dispatch === \"function\") {\n    let didWarnAboutReservedActionType = false;\n    const originalDispatch = api.dispatch;\n    api.dispatch = (...a) => {\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && a[0].type === \"__setState\" && !didWarnAboutReservedActionType) {\n        console.warn(\n          '[zustand devtools middleware] \"__setState\" action type is reserved to set state from the devtools. Avoid using it.'\n        );\n        didWarnAboutReservedActionType = true;\n      }\n      originalDispatch(...a);\n    };\n  }\n  connection.subscribe((message) => {\n    var _a;\n    switch (message.type) {\n      case \"ACTION\":\n        if (typeof message.payload !== \"string\") {\n          console.error(\n            \"[zustand devtools middleware] Unsupported action format\"\n          );\n          return;\n        }\n        return parseJsonThen(\n          message.payload,\n          (action) => {\n            if (action.type === \"__setState\") {\n              if (store === void 0) {\n                setStateFromDevtools(action.state);\n                return;\n              }\n              if (Object.keys(action.state).length !== 1) {\n                console.error(\n                  `\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { \"type\": \"__setState\", \"state\": { \"abc123Store\": { \"foo\": \"bar\" } } }\n                    `\n                );\n              }\n              const stateFromDevtools = action.state[store];\n              if (stateFromDevtools === void 0 || stateFromDevtools === null) {\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(stateFromDevtools)) {\n                setStateFromDevtools(stateFromDevtools);\n              }\n              return;\n            }\n            if (!api.dispatchFromDevtools) return;\n            if (typeof api.dispatch !== \"function\") return;\n            api.dispatch(action);\n          }\n        );\n      case \"DISPATCH\":\n        switch (message.payload.type) {\n          case \"RESET\":\n            setStateFromDevtools(initialState);\n            if (store === void 0) {\n              return connection == null ? void 0 : connection.init(api.getState());\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"COMMIT\":\n            if (store === void 0) {\n              connection == null ? void 0 : connection.init(api.getState());\n              return;\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"ROLLBACK\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                connection == null ? void 0 : connection.init(api.getState());\n                return;\n              }\n              setStateFromDevtools(state[store]);\n              connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n            });\n          case \"JUMP_TO_STATE\":\n          case \"JUMP_TO_ACTION\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(state[store])) {\n                setStateFromDevtools(state[store]);\n              }\n            });\n          case \"IMPORT_STATE\": {\n            const { nextLiftedState } = message.payload;\n            const lastComputedState = (_a = nextLiftedState.computedStates.slice(-1)[0]) == null ? void 0 : _a.state;\n            if (!lastComputedState) return;\n            if (store === void 0) {\n              setStateFromDevtools(lastComputedState);\n            } else {\n              setStateFromDevtools(lastComputedState[store]);\n            }\n            connection == null ? void 0 : connection.send(\n              null,\n              // FIXME no-any\n              nextLiftedState\n            );\n            return;\n          }\n          case \"PAUSE_RECORDING\":\n            return isRecording = !isRecording;\n        }\n        return;\n    }\n  });\n  return initialState;\n};\nconst devtools = devtoolsImpl;\nconst parseJsonThen = (stringified, f) => {\n  let parsed;\n  try {\n    parsed = JSON.parse(stringified);\n  } catch (e) {\n    console.error(\n      \"[zustand devtools middleware] Could not parse the received json\",\n      e\n    );\n  }\n  if (parsed !== void 0) f(parsed);\n};\n\nconst subscribeWithSelectorImpl = (fn) => (set, get, api) => {\n  const origSubscribe = api.subscribe;\n  api.subscribe = (selector, optListener, options) => {\n    let listener = selector;\n    if (optListener) {\n      const equalityFn = (options == null ? void 0 : options.equalityFn) || Object.is;\n      let currentSlice = selector(api.getState());\n      listener = (state) => {\n        const nextSlice = selector(state);\n        if (!equalityFn(currentSlice, nextSlice)) {\n          const previousSlice = currentSlice;\n          optListener(currentSlice = nextSlice, previousSlice);\n        }\n      };\n      if (options == null ? void 0 : options.fireImmediately) {\n        optListener(currentSlice, currentSlice);\n      }\n    }\n    return origSubscribe(listener);\n  };\n  const initialState = fn(set, get, api);\n  return initialState;\n};\nconst subscribeWithSelector = subscribeWithSelectorImpl;\n\nconst combine = (initialState, create) => (...a) => Object.assign({}, initialState, create(...a));\n\nfunction createJSONStorage(getStorage, options) {\n  let storage;\n  try {\n    storage = getStorage();\n  } catch (_e) {\n    return;\n  }\n  const persistStorage = {\n    getItem: (name) => {\n      var _a;\n      const parse = (str2) => {\n        if (str2 === null) {\n          return null;\n        }\n        return JSON.parse(str2, options == null ? void 0 : options.reviver);\n      };\n      const str = (_a = storage.getItem(name)) != null ? _a : null;\n      if (str instanceof Promise) {\n        return str.then(parse);\n      }\n      return parse(str);\n    },\n    setItem: (name, newValue) => storage.setItem(\n      name,\n      JSON.stringify(newValue, options == null ? void 0 : options.replacer)\n    ),\n    removeItem: (name) => storage.removeItem(name)\n  };\n  return persistStorage;\n}\nconst toThenable = (fn) => (input) => {\n  try {\n    const result = fn(input);\n    if (result instanceof Promise) {\n      return result;\n    }\n    return {\n      then(onFulfilled) {\n        return toThenable(onFulfilled)(result);\n      },\n      catch(_onRejected) {\n        return this;\n      }\n    };\n  } catch (e) {\n    return {\n      then(_onFulfilled) {\n        return this;\n      },\n      catch(onRejected) {\n        return toThenable(onRejected)(e);\n      }\n    };\n  }\n};\nconst oldImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    getStorage: () => localStorage,\n    serialize: JSON.stringify,\n    deserialize: JSON.parse,\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage;\n  try {\n    storage = options.getStorage();\n  } catch (_e) {\n  }\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const thenableSerialize = toThenable(options.serialize);\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    let errorInSync;\n    const thenable = thenableSerialize({ state, version: options.version }).then(\n      (serializedValue) => storage.setItem(options.name, serializedValue)\n    ).catch((e) => {\n      errorInSync = e;\n    });\n    if (errorInSync) {\n      throw errorInSync;\n    }\n    return thenable;\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => cb(get()));\n    const postRehydrationCallback = ((_a = options.onRehydrateStorage) == null ? void 0 : _a.call(options, get())) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((storageValue) => {\n      if (storageValue) {\n        return options.deserialize(storageValue);\n      }\n    }).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return options.migrate(\n              deserializedStorageValue.state,\n              deserializedStorageValue.version\n            );\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return deserializedStorageValue.state;\n        }\n      }\n    }).then((migratedState) => {\n      var _a2;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      return setItem();\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.getStorage) {\n        storage = newOptions.getStorage();\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  hydrate();\n  return stateFromStorage || configResult;\n};\nconst newImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    storage: createJSONStorage(() => localStorage),\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage = options.storage;\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    return storage.setItem(options.name, {\n      state,\n      version: options.version\n    });\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  api.getInitialState = () => configResult;\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a, _b;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => {\n      var _a2;\n      return cb((_a2 = get()) != null ? _a2 : configResult);\n    });\n    const postRehydrationCallback = ((_b = options.onRehydrateStorage) == null ? void 0 : _b.call(options, (_a = get()) != null ? _a : configResult)) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return [\n              true,\n              options.migrate(\n                deserializedStorageValue.state,\n                deserializedStorageValue.version\n              )\n            ];\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return [false, deserializedStorageValue.state];\n        }\n      }\n      return [false, void 0];\n    }).then((migrationResult) => {\n      var _a2;\n      const [migrated, migratedState] = migrationResult;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      if (migrated) {\n        return setItem();\n      }\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      stateFromStorage = get();\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.storage) {\n        storage = newOptions.storage;\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  if (!options.skipHydration) {\n    hydrate();\n  }\n  return stateFromStorage || configResult;\n};\nconst persistImpl = (config, baseOptions) => {\n  if (\"getStorage\" in baseOptions || \"serialize\" in baseOptions || \"deserialize\" in baseOptions) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead.\"\n      );\n    }\n    return oldImpl(config, baseOptions);\n  }\n  return newImpl(config, baseOptions);\n};\nconst persist = persistImpl;\n\nexport { combine, createJSONStorage, devtools, persist, redux, subscribeWithSelector };\n","import { create } from 'zustand'\r\nimport { persist, createJSONStorage } from 'zustand/middleware'\r\nimport type { Homography, Point } from '../utils/vision'\r\n\r\ntype CalibrationState = {\r\n  H: Homography | null // board->image\r\n  createdAt: number | null\r\n  errorPx: number | null\r\n  imageSize: { w: number; h: number } | null\r\n  anchors: { src: Point[]; dst: Point[] } | null\r\n  locked: boolean\r\n  setCalibration: (c: Partial<Omit<CalibrationState, 'setCalibration' | 'reset'>>) => void\r\n  reset: () => void\r\n}\r\n\r\nexport const useCalibration = create<CalibrationState>()(persist((set, get) => ({\r\n  H: null,\r\n  createdAt: null,\r\n  errorPx: null,\r\n  imageSize: null,\r\n  anchors: null,\r\n  locked: false,\r\n  setCalibration: (c) => set((s) => ({ ...s, ...c })),\r\n  reset: () => set({ H: null, createdAt: null, errorPx: null, imageSize: null, anchors: null, locked: false }),\r\n}), {\r\n  name: 'ndn-calibration-v1',\r\n  storage: createJSONStorage(() => localStorage),\r\n  // If we ever had alternate keys (legacy), gently import once after hydration\r\n  onRehydrateStorage: () => (state, error) => {\r\n    // No-op on error; best-effort fallback\r\n    if (error) return\r\n    try {\r\n      if (state && !state.H) {\r\n        const legacy = localStorage.getItem('ndn:calibration:v1')\r\n        if (legacy) {\r\n          const j = JSON.parse(legacy)\r\n          if (j && (j.H || j.imageSize)) {\r\n            state.setCalibration({\r\n              H: j.H ?? null,\r\n              createdAt: j.createdAt ?? null,\r\n              errorPx: j.errorPx ?? null,\r\n              imageSize: j.imageSize ?? null,\r\n              anchors: j.anchors ?? null,\r\n              locked: !!j.locked,\r\n            })\r\n          }\r\n        }\r\n      }\r\n    } catch {}\r\n  },\r\n}))\r\n","// Vision and calibration utilities for dartboard mapping\r\n// Board dimensions follow standard measurements (millimeters)\r\n// - Inner bull radius: 6.35 mm (12.7 mm diameter)\r\n// - Outer bull radius: 15.9 mm (31.8 mm diameter)\r\n// - Treble inner radius: 99 mm\r\n// - Treble outer radius: 107 mm\r\n// - Double inner radius: 162 mm\r\n// - Double outer radius: 170 mm (playing field outer edge)\r\n\r\nexport type Point = { x: number; y: number }\r\nexport type Homography = [number, number, number, number, number, number, number, number, number] // row-major 3x3\r\n\r\nexport const BoardRadii = {\r\n\tbullInner: 6.35,\r\n\tbullOuter: 15.9,\r\n\ttrebleInner: 99,\r\n\ttrebleOuter: 107,\r\n\tdoubleInner: 162,\r\n\tdoubleOuter: 170,\r\n}\r\n\r\nexport const SectorOrder = [20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5]\r\n\r\n// Basic 3x3 matrix operations\r\nfunction matMul3(a: Homography, b: Homography): Homography {\r\n\tconst r = new Array(9).fill(0)\r\n\tfor (let i = 0; i < 3; i++) {\r\n\t\tfor (let j = 0; j < 3; j++) {\r\n\t\t\tfor (let k = 0; k < 3; k++) {\r\n\t\t\t\tr[i * 3 + j] += a[i * 3 + k] * b[k * 3 + j]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn r as Homography\r\n}\r\n\r\nexport function applyHomography(H: Homography, p: Point): Point {\r\n\tconst x = p.x, y = p.y\r\n\tconst w = H[6] * x + H[7] * y + H[8]\r\n\tconst nx = (H[0] * x + H[1] * y + H[2]) / w\r\n\tconst ny = (H[3] * x + H[4] * y + H[5]) / w\r\n\treturn { x: nx, y: ny }\r\n}\r\n\r\n// Scale a homography by sx, sy on the destination/image side: H' = S * H\r\n// Where S = diag([sx, sy, 1])\r\nexport function scaleHomography(H: Homography, sx: number, sy: number): Homography {\r\n\treturn [\r\n\t\tsx * H[0], sx * H[1], sx * H[2],\r\n\t\tsy * H[3], sy * H[4], sy * H[5],\r\n\t\tH[6],     H[7],     H[8],\r\n\t] as Homography\r\n}\r\n\r\nexport function invertHomography(H: Homography): Homography {\r\n\t// Inverse of 3x3 matrix\r\n\tconst m = H\r\n\tconst a = m[0], b = m[1], c = m[2], d = m[3], e = m[4], f = m[5], g = m[6], h = m[7], i = m[8]\r\n\tconst A = e * i - f * h\r\n\tconst B = c * h - b * i\r\n\tconst C = b * f - c * e\r\n\tconst D = f * g - d * i\r\n\tconst E = a * i - c * g\r\n\tconst F = c * d - a * f\r\n\tconst G = d * h - e * g\r\n\tconst Hh = b * g - a * h\r\n\tconst I = a * e - b * d\r\n\tconst det = a * A + b * D + c * G\r\n\tif (Math.abs(det) < 1e-12) throw new Error('Singular homography')\r\n\tconst inv = [\r\n\t\tA / det, B / det, C / det,\r\n\t\tD / det, E / det, F / det,\r\n\t\tG / det, Hh / det, I / det,\r\n\t] as Homography\r\n\treturn inv\r\n}\r\n\r\n// Compute homography H that maps src (board space) -> dst (image space)\r\n// Using 4 correspondences via DLT (solved by Gaussian elimination)\r\nexport function computeHomographyDLT(src: Point[], dst: Point[]): Homography {\r\n\tif (src.length !== 4 || dst.length !== 4) throw new Error('Need exactly 4 correspondences')\r\n\t// Build A * h = b where h = [h11 h12 h13 h21 h22 h23 h31 h32]^T and h33 = 1\r\n\tconst A: number[][] = []\r\n\tconst B: number[] = []\r\n\tfor (let k = 0; k < 4; k++) {\r\n\t\tconst { x: X, y: Y } = src[k]\r\n\t\tconst { x: x, y: y } = dst[k]\r\n\t\t// x = (h11 X + h12 Y + h13) / (h31 X + h32 Y + 1)\r\n\t\t// y = (h21 X + h22 Y + h23) / (h31 X + h32 Y + 1)\r\n\t\t// => x*(h31 X + h32 Y + 1) = h11 X + h12 Y + h13\r\n\t\t// => y*(h31 X + h32 Y + 1) = h21 X + h22 Y + h23\r\n\t\tA.push([X, Y, 1, 0, 0, 0, -x * X, -x * Y])\r\n\t\tB.push(x)\r\n\t\tA.push([0, 0, 0, X, Y, 1, -y * X, -y * Y])\r\n\t\tB.push(y)\r\n\t}\r\n\tconst h = solveLeastSquares(A, B) // length 8\r\n\tconst H: Homography = [h[0], h[1], h[2], h[3], h[4], h[5], h[6], h[7], 1]\r\n\treturn H\r\n}\r\n\r\n// Solve A x = b in least squares sense using Gaussian elimination with partial pivoting\r\nfunction solveLeastSquares(A: number[][], b: number[]): number[] {\r\n\t// Normal equations: (A^T A) x = A^T b\r\n\tconst m = A.length, n = A[0].length\r\n\tconst AtA: number[][] = Array.from({ length: n }, () => new Array(n).fill(0))\r\n\tconst Atb: number[] = new Array(n).fill(0)\r\n\tfor (let r = 0; r < m; r++) {\r\n\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\tAtb[i] += A[r][i] * b[r]\r\n\t\t\tfor (let j = 0; j < n; j++) {\r\n\t\t\t\tAtA[i][j] += A[r][i] * A[r][j]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn gaussianSolve(AtA, Atb)\r\n}\r\n\r\nfunction gaussianSolve(M: number[][], v: number[]): number[] {\r\n\tconst n = v.length\r\n\t// Augment matrix\r\n\tconst A = M.map((row, i) => row.concat([v[i]]))\r\n\tfor (let i = 0; i < n; i++) {\r\n\t\t// Pivot\r\n\t\tlet maxRow = i\r\n\t\tfor (let r = i + 1; r < n; r++) {\r\n\t\t\tif (Math.abs(A[r][i]) > Math.abs(A[maxRow][i])) maxRow = r\r\n\t\t}\r\n\t\tif (Math.abs(A[maxRow][i]) < 1e-12) throw new Error('Singular matrix')\r\n\t\tif (maxRow !== i) {\r\n\t\t\tconst tmp = A[i]; A[i] = A[maxRow]; A[maxRow] = tmp\r\n\t\t}\r\n\t\t// Eliminate\r\n\t\tfor (let r = i + 1; r < n; r++) {\r\n\t\t\tconst f = A[r][i] / A[i][i]\r\n\t\t\tfor (let c = i; c <= n; c++) A[r][c] -= f * A[i][c]\r\n\t\t}\r\n\t}\r\n\t// Back substitution\r\n\tconst x = new Array(n).fill(0)\r\n\tfor (let i = n - 1; i >= 0; i--) {\r\n\t\tlet s = A[i][n]\r\n\t\tfor (let c = i + 1; c < n; c++) s -= A[i][c] * x[c]\r\n\t\tx[i] = s / A[i][i]\r\n\t}\r\n\treturn x\r\n}\r\n\r\n// Canonical calibration targets in board space (mm)\r\n// We ask the user to click the image positions for: TOP, RIGHT, BOTTOM, LEFT of double outer rim\r\nexport function canonicalRimTargets(): Point[] {\r\n\tconst R = BoardRadii.doubleOuter\r\n\treturn [\r\n\t\t{ x: 0, y: -R }, // TOP\r\n\t\t{ x: R, y: 0 },  // RIGHT\r\n\t\t{ x: 0, y: R },  // BOTTOM\r\n\t\t{ x: -R, y: 0 }, // LEFT\r\n\t]\r\n}\r\n\r\n// Given a homography mapping board->image, produce polylines for overlay rings (in image px)\r\nexport function sampleRing(H: Homography, radius: number, steps = 256): Point[] {\r\n\tconst pts: Point[] = []\r\n\tfor (let k = 0; k < steps; k++) {\r\n\t\tconst theta = (k / steps) * Math.PI * 2\r\n\t\tconst p = applyHomography(H, { x: radius * Math.cos(theta), y: radius * Math.sin(theta) })\r\n\t\tpts.push(p)\r\n\t}\r\n\treturn pts\r\n}\r\n\r\nexport function rmsError(H: Homography, src: Point[], dst: Point[]): number {\r\n\tlet e2 = 0\r\n\tfor (let i = 0; i < src.length; i++) {\r\n\t\tconst p = applyHomography(H, src[i])\r\n\t\tconst dx = p.x - dst[i].x\r\n\t\tconst dy = p.y - dst[i].y\r\n\t\te2 += dx * dx + dy * dy\r\n\t}\r\n\treturn Math.sqrt(e2 / src.length)\r\n}\r\n\r\n// Map an image point to board coordinates using inverse homography (image->board)\r\nexport function imageToBoard(H_boardToImage: Homography, pImg: Point): Point {\r\n\tconst inv = invertHomography(H_boardToImage)\r\n\treturn applyHomography(inv as Homography, pImg)\r\n}\r\n\r\n// Compute score for a board coordinate (mm)\r\nexport function scoreAtBoardPoint(p: Point): { base: number; ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'; sector: number | null; mult: 0|1|2|3 } {\r\n\tconst r = Math.hypot(p.x, p.y)\r\n\tconst ang = Math.atan2(p.y, p.x) // 0 rad at +X, increasing CCW\r\n\t// Rotate so that sector 20 is at the top (negative Y). Top corresponds to -90 degrees (or 270)\r\n\tlet deg = ang * 180 / Math.PI\r\n\tdeg = (deg + 360 + 90) % 360 // shift so 0 deg is at top\r\n\tconst sector = SectorOrder[Math.floor(((360 - deg) % 360) / 18)] // clockwise ordering\r\n\r\n\tif (r <= BoardRadii.bullInner) return { base: 50, ring: 'INNER_BULL', sector: 25, mult: 2 }\r\n\tif (r <= BoardRadii.bullOuter) return { base: 25, ring: 'BULL', sector: 25, mult: 1 }\r\n\tif (r >= BoardRadii.doubleOuter) return { base: 0, ring: 'MISS', sector: null, mult: 0 }\r\n\tif (r >= BoardRadii.doubleInner) return { base: sector * 2, ring: 'DOUBLE', sector, mult: 2 }\r\n\tif (r >= BoardRadii.trebleOuter) return { base: sector, ring: 'SINGLE', sector, mult: 1 }\r\n\tif (r >= BoardRadii.trebleInner) return { base: sector * 3, ring: 'TRIPLE', sector, mult: 3 }\r\n\treturn { base: sector, ring: 'SINGLE', sector, mult: 1 }\r\n}\r\n\r\nexport function drawPolyline(ctx: CanvasRenderingContext2D, pts: Point[], color = '#10b981', width = 2) {\r\n\tif (!pts.length) return\r\n\tctx.save()\r\n\tctx.strokeStyle = color\r\n\tctx.lineWidth = width\r\n\tctx.beginPath()\r\n\tctx.moveTo(pts[0].x, pts[0].y)\r\n\tfor (let i = 1; i < pts.length; i++) ctx.lineTo(pts[i].x, pts[i].y)\r\n\tctx.closePath()\r\n\tctx.stroke()\r\n\tctx.restore()\r\n}\r\n\r\nexport function drawCross(ctx: CanvasRenderingContext2D, p: Point, color = '#f59e0b') {\r\n\tctx.save()\r\n\tctx.strokeStyle = color\r\n\tctx.lineWidth = 2\r\n\tctx.beginPath()\r\n\tctx.moveTo(p.x - 8, p.y)\r\n\tctx.lineTo(p.x + 8, p.y)\r\n\tctx.moveTo(p.x, p.y - 8)\r\n\tctx.lineTo(p.x, p.y + 8)\r\n\tctx.stroke()\r\n\tctx.restore()\r\n}\r\n\r\n// --- Point refinement using Sobel gradient ---\r\nfunction clamp(v: number, lo: number, hi: number) { return Math.max(lo, Math.min(hi, v)) }\r\n\r\nfunction sobelAtGray(img: ImageData, x: number, y: number): number {\r\n\tconst { width, data } = img\r\n\t// Sobel kernels\r\n\tconst gx = [[-1,0,1],[-2,0,2],[-1,0,1]]\r\n\tconst gy = [[-1,-2,-1],[0,0,0],[1,2,1]]\r\n\tlet sx = 0, sy = 0\r\n\tfor (let j = -1; j <= 1; j++) {\r\n\t\tfor (let i = -1; i <= 1; i++) {\r\n\t\t\tconst xi = clamp(x + i, 0, width - 1)\r\n\t\t\tconst yi = clamp(y + j, 0, img.height - 1)\r\n\t\t\tconst idx = (yi * width + xi) * 4\r\n\t\t\tconst r = data[idx], g = data[idx+1], b = data[idx+2]\r\n\t\t\tconst gray = 0.299*r + 0.587*g + 0.114*b\r\n\t\t\tsx += gray * gx[j+1][i+1]\r\n\t\t\tsy += gray * gy[j+1][i+1]\r\n\t\t}\r\n\t}\r\n\treturn Math.hypot(sx, sy)\r\n}\r\n\r\nexport function refinePointSobel(canvas: HTMLCanvasElement, p: Point, radius = 6): Point {\r\n\tconst ctx = canvas.getContext('2d')!\r\n\tconst img = ctx.getImageData(0, 0, canvas.width, canvas.height)\r\n\tconst cx = clamp(Math.round(p.x), 1, canvas.width - 2)\r\n\tconst cy = clamp(Math.round(p.y), 1, canvas.height - 2)\r\n\tlet best = { x: cx, y: cy, mag: -1 }\r\n\tfor (let y = cy - radius; y <= cy + radius; y++) {\r\n\t\tfor (let x = cx - radius; x <= cx + radius; x++) {\r\n\t\t\tif (x <= 0 || y <= 0 || x >= canvas.width-1 || y >= canvas.height-1) continue\r\n\t\t\tconst mag = sobelAtGray(img, x, y)\r\n\t\t\tif (mag > best.mag) best = { x, y, mag }\r\n\t\t}\r\n\t}\r\n\treturn { x: best.x, y: best.y }\r\n}\r\n\r\nexport function refinePointsSobel(canvas: HTMLCanvasElement, pts: Point[], radius = 6): Point[] {\r\n\treturn pts.map(p => refinePointSobel(canvas, p, radius))\r\n}\r\n\r\n","/*\nCopyright (c) 2011 Juan Mellado\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\n/*\nReferences:\n- \"OpenCV: Open Computer Vision Library\"\n  http://sourceforge.net/projects/opencvlibrary/\n- \"Stack Blur: Fast But Goodlooking\"\n  http://incubator.quasimondo.com/processing/fast_blur_deluxe.php\n*/\n\nvar CV = CV || {};\n\nCV.Image = function(width, height, data){\n  this.width = width || 0;\n  this.height = height || 0;\n  this.data = data || [];\n};\n\nCV.grayscale = function(imageSrc, imageDst){\n  var src = imageSrc.data, dst = imageDst.data, len = src.length,\n      i = 0, j = 0;\n\n  for (; i < len; i += 4){\n    dst[j ++] =\n      (src[i] * 0.299 + src[i + 1] * 0.587 + src[i + 2] * 0.114 + 0.5) & 0xff;\n  }\n  \n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  return imageDst;\n};\n\nCV.threshold = function(imageSrc, imageDst, threshold){\n  var src = imageSrc.data, dst = imageDst.data,\n      len = src.length, tab = [], i;\n\n  for (i = 0; i < 256; ++ i){\n    tab[i] = i <= threshold? 0: 255;\n  }\n\n  for (i = 0; i < len; ++ i){\n    dst[i] = tab[ src[i] ];\n  }\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n\n  return imageDst;\n};\n\nCV.adaptiveThreshold = function(imageSrc, imageDst, kernelSize, threshold){\n  var src = imageSrc.data, dst = imageDst.data, len = src.length, tab = [], i;\n\n  CV.stackBoxBlur(imageSrc, imageDst, kernelSize);\n\n  for (i = 0; i < 768; ++ i){\n    tab[i] = (i - 255 <= -threshold)? 255: 0;\n  }\n\n  for (i = 0; i < len; ++ i){\n    dst[i] = tab[ src[i] - dst[i] + 255 ];\n  }\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  return imageDst;\n};\n\nCV.otsu = function(imageSrc){\n  var src = imageSrc.data, len = src.length, hist = [],\n      threshold = 0, sum = 0, sumB = 0, wB = 0, wF = 0, max = 0,\n      mu, between, i;\n\n  for (i = 0; i < 256; ++ i){\n    hist[i] = 0;\n  }\n  \n  for (i = 0; i < len; ++ i){\n    hist[ src[i] ] ++;\n  }\n\n  for (i = 0; i < 256; ++ i){\n    sum += hist[i] * i;\n  }\n\n  for (i = 0; i < 256; ++ i){\n    wB += hist[i];\n    if (0 !== wB){\n    \n      wF = len - wB;\n      if (0 === wF){\n        break;\n      }\n\n      sumB += hist[i] * i;\n      \n      mu = (sumB / wB) - ( (sum - sumB) / wF );\n\n      between = wB * wF * mu * mu;\n      \n      if (between > max){\n        max = between;\n        threshold = i;\n      }\n    }\n  }\n\n  return threshold;\n};\n\nCV.stackBoxBlurMult =\n  [1, 171, 205, 293, 57, 373, 79, 137, 241, 27, 391, 357, 41, 19, 283, 265];\n\nCV.stackBoxBlurShift =\n  [0, 9, 10, 11, 9, 12, 10, 11, 12, 9, 13, 13, 10, 9, 13, 13];\n\nCV.BlurStack = function(){\n  this.color = 0;\n  this.next = null;\n};\n\nCV.stackBoxBlur = function(imageSrc, imageDst, kernelSize){\n  var src = imageSrc.data, dst = imageDst.data,\n      height = imageSrc.height, width = imageSrc.width,\n      heightMinus1 = height - 1, widthMinus1 = width - 1,\n      size = kernelSize + kernelSize + 1, radius = kernelSize + 1,\n      mult = CV.stackBoxBlurMult[kernelSize],\n      shift = CV.stackBoxBlurShift[kernelSize],\n      stack, stackStart, color, sum, pos, start, p, x, y, i;\n\n  stack = stackStart = new CV.BlurStack();\n  for (i = 1; i < size; ++ i){\n    stack = stack.next = new CV.BlurStack();\n  }\n  stack.next = stackStart;\n\n  pos = 0;\n\n  for (y = 0; y < height; ++ y){\n    start = pos;\n    \n    color = src[pos];\n    sum = radius * color;\n    \n    stack = stackStart;\n    for (i = 0; i < radius; ++ i){\n      stack.color = color;\n      stack = stack.next;\n    }\n    for (i = 1; i < radius; ++ i){\n      stack.color = src[pos + i];\n      sum += stack.color;\n      stack = stack.next;\n    }\n  \n    stack = stackStart;\n    for (x = 0; x < width; ++ x){\n      dst[pos ++] = (sum * mult) >>> shift;\n      \n      p = x + radius;\n      p = start + (p < widthMinus1? p: widthMinus1);\n      sum -= stack.color - src[p];\n      \n      stack.color = src[p];\n      stack = stack.next;\n    }\n  }\n\n  for (x = 0; x < width; ++ x){\n    pos = x;\n    start = pos + width;\n    \n    color = dst[pos];\n    sum = radius * color;\n    \n    stack = stackStart;\n    for (i = 0; i < radius; ++ i){\n      stack.color = color;\n      stack = stack.next;\n    }\n    for (i = 1; i < radius; ++ i){\n      stack.color = dst[start];\n      sum += stack.color;\n      stack = stack.next;\n      \n      start += width;\n    }\n    \n    stack = stackStart;\n    for (y = 0; y < height; ++ y){\n      dst[pos] = (sum * mult) >>> shift;\n      \n      p = y + radius;\n      p = x + ( (p < heightMinus1? p: heightMinus1) * width );\n      sum -= stack.color - dst[p];\n      \n      stack.color = dst[p];\n      stack = stack.next;\n      \n      pos += width;\n    }\n  }\n\n  return imageDst;\n};\n\nCV.gaussianBlur = function(imageSrc, imageDst, imageMean, kernelSize){\n  var kernel = CV.gaussianKernel(kernelSize);\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  imageMean.width = imageSrc.width;\n  imageMean.height = imageSrc.height;\n\n  CV.gaussianBlurFilter(imageSrc, imageMean, kernel, true);\n  CV.gaussianBlurFilter(imageMean, imageDst, kernel, false);\n\n  return imageDst;\n};\n\nCV.gaussianBlurFilter = function(imageSrc, imageDst, kernel, horizontal){\n  var src = imageSrc.data, dst = imageDst.data,\n      height = imageSrc.height, width = imageSrc.width,\n      pos = 0, limit = kernel.length >> 1,\n      cur, value, i, j, k;\n      \n  for (i = 0; i < height; ++ i){\n    \n    for (j = 0; j < width; ++ j){\n      value = 0.0;\n    \n      for (k = -limit; k <= limit; ++ k){\n\n        if (horizontal){\n          cur = pos + k;\n          if (j + k < 0){\n            cur = pos;\n          }\n          else if (j + k >= width){\n            cur = pos;\n          }\n        }else{\n          cur = pos + (k * width);\n          if (i + k < 0){\n            cur = pos;\n          }\n          else if (i + k >= height){\n            cur = pos;\n          }\n        }\n\n        value += kernel[limit + k] * src[cur];\n      }\n    \n      dst[pos ++] = horizontal? value: (value + 0.5) & 0xff;\n    }\n  }\n\n  return imageDst;\n};\n\nCV.gaussianKernel = function(kernelSize){\n  var tab =\n    [ [1],\n      [0.25, 0.5, 0.25],\n      [0.0625, 0.25, 0.375, 0.25, 0.0625],\n      [0.03125, 0.109375, 0.21875, 0.28125, 0.21875, 0.109375, 0.03125] ],\n    kernel = [], center, sigma, scale2X, sum, x, i;\n\n  if ( (kernelSize <= 7) && (kernelSize % 2 === 1) ){\n    kernel = tab[kernelSize >> 1];\n  }else{\n    center = (kernelSize - 1.0) * 0.5;\n    sigma = 0.8 + (0.3 * (center - 1.0) );\n    scale2X = -0.5 / (sigma * sigma);\n    sum = 0.0;\n    for (i = 0; i < kernelSize; ++ i){\n      x = i - center;\n      sum += kernel[i] = Math.exp(scale2X * x * x);\n    }\n    sum = 1 / sum;\n    for (i = 0; i < kernelSize; ++ i){\n      kernel[i] *= sum;\n    }  \n  }\n\n  return kernel;\n};\n\nCV.findContours = function(imageSrc, binary){\n  var width = imageSrc.width, height = imageSrc.height, contours = [],\n      src, deltas, pos, pix, nbd, outer, hole, i, j;\n  \n  src = CV.binaryBorder(imageSrc, binary);\n\n  deltas = CV.neighborhoodDeltas(width + 2);\n\n  pos = width + 3;\n  nbd = 1;\n\n  for (i = 0; i < height; ++ i, pos += 2){\n  \n    for (j = 0; j < width; ++ j, ++ pos){\n      pix = src[pos];\n\n      if (0 !== pix){\n        outer = hole = false;\n\n        if (1 === pix && 0 === src[pos - 1]){\n          outer = true;\n        }\n        else if (pix >= 1 && 0 === src[pos + 1]){\n          hole = true;\n        }\n\n        if (outer || hole){\n          ++ nbd;\n          \n          contours.push( CV.borderFollowing(src, pos, nbd, {x: j, y: i}, hole, deltas) );\n        }\n      }\n    }\n  }  \n\n  return contours;\n};\n\nCV.borderFollowing = function(src, pos, nbd, point, hole, deltas){\n  var contour = [], pos1, pos3, pos4, s, s_end, s_prev;\n\n  contour.hole = hole;\n      \n  s = s_end = hole? 0: 4;\n  do{\n    s = (s - 1) & 7;\n    pos1 = pos + deltas[s];\n    if (src[pos1] !== 0){\n      break;\n    }\n  }while(s !== s_end);\n  \n  if (s === s_end){\n    src[pos] = -nbd;\n    contour.push( {x: point.x, y: point.y} );\n\n  }else{\n    pos3 = pos;\n    s_prev = s ^ 4;\n\n    while(true){\n      s_end = s;\n    \n      do{\n        pos4 = pos3 + deltas[++ s];\n      }while(src[pos4] === 0);\n      \n      s &= 7;\n      \n      if ( ( (s - 1) >>> 0) < (s_end >>> 0) ){\n        src[pos3] = -nbd;\n      }\n      else if (src[pos3] === 1){\n        src[pos3] = nbd;\n      }\n\n      contour.push( {x: point.x, y: point.y} );\n      \n      s_prev = s;\n\n      point.x += CV.neighborhood[s][0];\n      point.y += CV.neighborhood[s][1];\n\n      if ( (pos4 === pos) && (pos3 === pos1) ){\n        break;\n      }\n      \n      pos3 = pos4;\n      s = (s + 4) & 7;\n    }\n  }\n\n  return contour;\n};\n\nCV.neighborhood = \n  [ [1, 0], [1, -1], [0, -1], [-1, -1], [-1, 0], [-1, 1], [0, 1], [1, 1] ];\n\nCV.neighborhoodDeltas = function(width){\n  var deltas = [], len = CV.neighborhood.length, i = 0;\n  \n  for (; i < len; ++ i){\n    deltas[i] = CV.neighborhood[i][0] + (CV.neighborhood[i][1] * width);\n  }\n  \n  return deltas.concat(deltas);\n};\n\nCV.approxPolyDP = function(contour, epsilon){\n  var slice = {start_index: 0, end_index: 0},\n      right_slice = {start_index: 0, end_index: 0},\n      poly = [], stack = [], len = contour.length,\n      pt, start_pt, end_pt, dist, max_dist, le_eps,\n      dx, dy, i, j, k;\n  \n  epsilon *= epsilon;\n  \n  k = 0;\n  \n  for (i = 0; i < 3; ++ i){\n    max_dist = 0;\n    \n    k = (k + right_slice.start_index) % len;\n    start_pt = contour[k];\n    if (++ k === len) {k = 0;}\n  \n    for (j = 1; j < len; ++ j){\n      pt = contour[k];\n      if (++ k === len) {k = 0;}\n    \n      dx = pt.x - start_pt.x;\n      dy = pt.y - start_pt.y;\n      dist = dx * dx + dy * dy;\n\n      if (dist > max_dist){\n        max_dist = dist;\n        right_slice.start_index = j;\n      }\n    }\n  }\n\n  if (max_dist <= epsilon){\n    poly.push( {x: start_pt.x, y: start_pt.y} );\n\n  }else{\n    slice.start_index = k;\n    slice.end_index = (right_slice.start_index += slice.start_index);\n  \n    right_slice.start_index -= right_slice.start_index >= len? len: 0;\n    right_slice.end_index = slice.start_index;\n    if (right_slice.end_index < right_slice.start_index){\n      right_slice.end_index += len;\n    }\n    \n    stack.push( {start_index: right_slice.start_index, end_index: right_slice.end_index} );\n    stack.push( {start_index: slice.start_index, end_index: slice.end_index} );\n  }\n\n  while(stack.length !== 0){\n    slice = stack.pop();\n    \n    end_pt = contour[slice.end_index % len];\n    start_pt = contour[k = slice.start_index % len];\n    if (++ k === len) {k = 0;}\n    \n    if (slice.end_index <= slice.start_index + 1){\n      le_eps = true;\n    \n    }else{\n      max_dist = 0;\n\n      dx = end_pt.x - start_pt.x;\n      dy = end_pt.y - start_pt.y;\n      \n      for (i = slice.start_index + 1; i < slice.end_index; ++ i){\n        pt = contour[k];\n        if (++ k === len) {k = 0;}\n        \n        dist = Math.abs( (pt.y - start_pt.y) * dx - (pt.x - start_pt.x) * dy);\n\n        if (dist > max_dist){\n          max_dist = dist;\n          right_slice.start_index = i;\n        }\n      }\n      \n      le_eps = max_dist * max_dist <= epsilon * (dx * dx + dy * dy);\n    }\n    \n    if (le_eps){\n      poly.push( {x: start_pt.x, y: start_pt.y} );\n\n    }else{\n      right_slice.end_index = slice.end_index;\n      slice.end_index = right_slice.start_index;\n\n      stack.push( {start_index: right_slice.start_index, end_index: right_slice.end_index} );\n      stack.push( {start_index: slice.start_index, end_index: slice.end_index} );\n    }\n  }\n  \n  return poly;\n};\n\nCV.warp = function(imageSrc, imageDst, contour, warpSize){\n  var src = imageSrc.data, dst = imageDst.data,\n      width = imageSrc.width, height = imageSrc.height,\n      pos = 0,\n      sx1, sx2, dx1, dx2, sy1, sy2, dy1, dy2, p1, p2, p3, p4,\n      m, r, s, t, u, v, w, x, y, i, j;\n  \n  m = CV.getPerspectiveTransform(contour, warpSize - 1);\n\n  r = m[8];\n  s = m[2];\n  t = m[5];\n  \n  for (i = 0; i < warpSize; ++ i){\n    r += m[7];\n    s += m[1];\n    t += m[4];\n\n    u = r;\n    v = s;\n    w = t;\n    \n    for (j = 0; j < warpSize; ++ j){\n      u += m[6];\n      v += m[0];\n      w += m[3];\n\n      x = v / u;\n      y = w / u;\n\n      sx1 = x >>> 0;\n      sx2 = (sx1 === width - 1)? sx1: sx1 + 1;\n      dx1 = x - sx1;\n      dx2 = 1.0 - dx1;\n\n      sy1 = y >>> 0;\n      sy2 = (sy1 === height - 1)? sy1: sy1 + 1;\n      dy1 = y - sy1;\n      dy2 = 1.0 - dy1;\n\n      p1 = p2 = sy1 * width;\n      p3 = p4 = sy2 * width;\n\n      dst[pos ++] = \n        (dy2 * (dx2 * src[p1 + sx1] + dx1 * src[p2 + sx2]) +\n         dy1 * (dx2 * src[p3 + sx1] + dx1 * src[p4 + sx2]) ) & 0xff;\n\n    }\n  }\n\n  imageDst.width = warpSize;\n  imageDst.height = warpSize;\n\n  return imageDst;\n};\n\nCV.getPerspectiveTransform = function(src, size){\n  var rq = CV.square2quad(src);\n  \n  rq[0] /= size;\n  rq[1] /= size;\n  rq[3] /= size;\n  rq[4] /= size;\n  rq[6] /= size;\n  rq[7] /= size;\n  \n  return rq;\n};\n\nCV.square2quad = function(src){\n  var sq = [], px, py, dx1, dx2, dy1, dy2, den;\n  \n  px = src[0].x - src[1].x + src[2].x - src[3].x;\n  py = src[0].y - src[1].y + src[2].y - src[3].y;\n  \n  if (0 === px && 0 === py){\n    sq[0] = src[1].x - src[0].x;\n    sq[1] = src[2].x - src[1].x;\n    sq[2] = src[0].x;\n    sq[3] = src[1].y - src[0].y;\n    sq[4] = src[2].y - src[1].y;\n    sq[5] = src[0].y;\n    sq[6] = 0;\n    sq[7] = 0;\n    sq[8] = 1;\n\n  }else{\n    dx1 = src[1].x - src[2].x;\n    dx2 = src[3].x - src[2].x;\n    dy1 = src[1].y - src[2].y;\n    dy2 = src[3].y - src[2].y;\n    den = dx1 * dy2 - dx2 * dy1;\n  \n    sq[6] = (px * dy2 - dx2 * py) / den;\n    sq[7] = (dx1 * py - px * dy1) / den;\n    sq[8] = 1;\n    sq[0] = src[1].x - src[0].x + sq[6] * src[1].x;\n    sq[1] = src[3].x - src[0].x + sq[7] * src[3].x;\n    sq[2] = src[0].x;\n    sq[3] = src[1].y - src[0].y + sq[6] * src[1].y;\n    sq[4] = src[3].y - src[0].y + sq[7] * src[3].y;\n    sq[5] = src[0].y;\n  }\n\n  return sq;\n};\n\nCV.isContourConvex = function(contour){\n  var orientation = 0, convex = true,\n      len = contour.length, i = 0, j = 0,\n      cur_pt, prev_pt, dxdy0, dydx0, dx0, dy0, dx, dy;\n\n  prev_pt = contour[len - 1];\n  cur_pt = contour[0];\n\n  dx0 = cur_pt.x - prev_pt.x;\n  dy0 = cur_pt.y - prev_pt.y;\n\n  for (; i < len; ++ i){\n    if (++ j === len) {j = 0;}\n\n    prev_pt = cur_pt;\n    cur_pt = contour[j];\n\n    dx = cur_pt.x - prev_pt.x;\n    dy = cur_pt.y - prev_pt.y;\n    dxdy0 = dx * dy0;\n    dydx0 = dy * dx0;\n\n    orientation |= dydx0 > dxdy0? 1: (dydx0 < dxdy0? 2: 3);\n\n    if (3 === orientation){\n        convex = false;\n        break;\n    }\n\n    dx0 = dx;\n    dy0 = dy;\n  }\n\n  return convex;\n};\n\nCV.perimeter = function(poly){\n  var len = poly.length, i = 0, j = len - 1,\n      p = 0.0, dx, dy;\n\n  for (; i < len; j = i ++){\n    dx = poly[i].x - poly[j].x;\n    dy = poly[i].y - poly[j].y;\n    \n    p += Math.sqrt(dx * dx + dy * dy) ;\n  }\n\n  return p;\n};\n\nCV.minEdgeLength = function(poly){\n  var len = poly.length, i = 0, j = len - 1, \n      min = Infinity, d, dx, dy;\n\n  for (; i < len; j = i ++){\n    dx = poly[i].x - poly[j].x;\n    dy = poly[i].y - poly[j].y;\n\n    d = dx * dx + dy * dy;\n\n    if (d < min){\n      min = d;\n    }\n  }\n  \n  return Math.sqrt(min);\n};\n\nCV.countNonZero = function(imageSrc, square){\n  var src = imageSrc.data, height = square.height, width = square.width,\n      pos = square.x + (square.y * imageSrc.width),\n      span = imageSrc.width - width,\n      nz = 0, i, j;\n  \n  for (i = 0; i < height; ++ i){\n\n    for (j = 0; j < width; ++ j){\n    \n      if ( 0 !== src[pos ++] ){\n        ++ nz;\n      }\n    }\n    \n    pos += span;\n  }\n\n  return nz;\n};\n\nCV.binaryBorder = function(imageSrc, dst){\n  var src = imageSrc.data, height = imageSrc.height, width = imageSrc.width,\n      posSrc = 0, posDst = 0, i, j;\n\n  for (j = -2; j < width; ++ j){\n    dst[posDst ++] = 0;\n  }\n\n  for (i = 0; i < height; ++ i){\n    dst[posDst ++] = 0;\n    \n    for (j = 0; j < width; ++ j){\n      dst[posDst ++] = (0 === src[posSrc ++]? 0: 1);\n    }\n    \n    dst[posDst ++] = 0;\n  }\n\n  for (j = -2; j < width; ++ j){\n    dst[posDst ++] = 0;\n  }\n  \n  return dst;\n};\n\nmodule.exports = CV;","/*\nCopyright (c) 2011 Juan Mellado\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\n/*\nReferences:\n- \"ArUco: a minimal library for Augmented Reality applications based on OpenCv\"\n  http://www.uco.es/investiga/grupos/ava/node/26\n*/\n\nvar CV = require('./cv');\n\nvar AR = AR || {};\n\nAR.Marker = function(id, corners){\n  this.id = id;\n  this.corners = corners;\n};\n\nAR.Detector = function(){\n  this.grey = new CV.Image();\n  this.thres = new CV.Image();\n  this.homography = new CV.Image();\n  this.binary = [];\n  this.contours = [];\n  this.polys = [];\n  this.candidates = [];\n};\n\nAR.Detector.prototype.detect = function(image){\n  CV.grayscale(image, this.grey);\n  CV.adaptiveThreshold(this.grey, this.thres, 2, 7);\n  \n  this.contours = CV.findContours(this.thres, this.binary);\n\n  this.candidates = this.findCandidates(this.contours, image.width * 0.20, 0.05, 10);\n  this.candidates = this.clockwiseCorners(this.candidates);\n  this.candidates = this.notTooNear(this.candidates, 10);\n\n  return this.findMarkers(this.grey, this.candidates, 49);\n};\n\nAR.Detector.prototype.findCandidates = function(contours, minSize, epsilon, minLength){\n  var candidates = [], len = contours.length, contour, poly, i;\n\n  this.polys = [];\n  \n  for (i = 0; i < len; ++ i){\n    contour = contours[i];\n\n    if (contour.length >= minSize){\n      poly = CV.approxPolyDP(contour, contour.length * epsilon);\n\n      this.polys.push(poly);\n\n      if ( (4 === poly.length) && ( CV.isContourConvex(poly) ) ){\n\n        if ( CV.minEdgeLength(poly) >= minLength){\n          candidates.push(poly);\n        }\n      }\n    }\n  }\n\n  return candidates;\n};\n\nAR.Detector.prototype.clockwiseCorners = function(candidates){\n  var len = candidates.length, dx1, dx2, dy1, dy2, swap, i;\n\n  for (i = 0; i < len; ++ i){\n    dx1 = candidates[i][1].x - candidates[i][0].x;\n    dy1 = candidates[i][1].y - candidates[i][0].y;\n    dx2 = candidates[i][2].x - candidates[i][0].x;\n    dy2 = candidates[i][2].y - candidates[i][0].y;\n\n    if ( (dx1 * dy2 - dy1 * dx2) < 0){\n      swap = candidates[i][1];\n      candidates[i][1] = candidates[i][3];\n      candidates[i][3] = swap;\n    }\n  }\n\n  return candidates;\n};\n\nAR.Detector.prototype.notTooNear = function(candidates, minDist){\n  var notTooNear = [], len = candidates.length, dist, dx, dy, i, j, k;\n\n  for (i = 0; i < len; ++ i){\n  \n    for (j = i + 1; j < len; ++ j){\n      dist = 0;\n      \n      for (k = 0; k < 4; ++ k){\n        dx = candidates[i][k].x - candidates[j][k].x;\n        dy = candidates[i][k].y - candidates[j][k].y;\n      \n        dist += dx * dx + dy * dy;\n      }\n      \n      if ( (dist / 4) < (minDist * minDist) ){\n      \n        if ( CV.perimeter( candidates[i] ) < CV.perimeter( candidates[j] ) ){\n          candidates[i].tooNear = true;\n        }else{\n          candidates[j].tooNear = true;\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < len; ++ i){\n    if ( !candidates[i].tooNear ){\n      notTooNear.push( candidates[i] );\n    }\n  }\n\n  return notTooNear;\n};\n\nAR.Detector.prototype.findMarkers = function(imageSrc, candidates, warpSize){\n  var markers = [], len = candidates.length, candidate, marker, i;\n\n  for (i = 0; i < len; ++ i){\n    candidate = candidates[i];\n\n    CV.warp(imageSrc, this.homography, candidate, warpSize);\n  \n    CV.threshold(this.homography, this.homography, CV.otsu(this.homography) );\n\n    marker = this.getMarker(this.homography, candidate);\n    if (marker){\n      markers.push(marker);\n    }\n  }\n  \n  return markers;\n};\n\nAR.Detector.prototype.getMarker = function(imageSrc, candidate){\n  var width = (imageSrc.width / 7) >>> 0,\n      minZero = (width * width) >> 1,\n      bits = [], rotations = [], distances = [],\n      square, pair, inc, i, j;\n\n  for (i = 0; i < 7; ++ i){\n    inc = (0 === i || 6 === i)? 1: 6;\n    \n    for (j = 0; j < 7; j += inc){\n      square = {x: j * width, y: i * width, width: width, height: width};\n      if ( CV.countNonZero(imageSrc, square) > minZero){\n        return null;\n      }\n    }\n  }\n\n  for (i = 0; i < 5; ++ i){\n    bits[i] = [];\n\n    for (j = 0; j < 5; ++ j){\n      square = {x: (j + 1) * width, y: (i + 1) * width, width: width, height: width};\n      \n      bits[i][j] = CV.countNonZero(imageSrc, square) > minZero? 1: 0;\n    }\n  }\n\n  rotations[0] = bits;\n  distances[0] = this.hammingDistance( rotations[0] );\n  \n  pair = {first: distances[0], second: 0};\n  \n  for (i = 1; i < 4; ++ i){\n    rotations[i] = this.rotate( rotations[i - 1] );\n    distances[i] = this.hammingDistance( rotations[i] );\n    \n    if (distances[i] < pair.first){\n      pair.first = distances[i];\n      pair.second = i;\n    }\n  }\n\n  if (0 !== pair.first){\n    return null;\n  }\n\n  return new AR.Marker(\n    this.mat2id( rotations[pair.second] ), \n    this.rotate2(candidate, 4 - pair.second) );\n};\n\nAR.Detector.prototype.hammingDistance = function(bits){\n  var ids = [ [1,0,0,0,0], [1,0,1,1,1], [0,1,0,0,1], [0,1,1,1,0] ],\n      dist = 0, sum, minSum, i, j, k;\n\n  for (i = 0; i < 5; ++ i){\n    minSum = Infinity;\n    \n    for (j = 0; j < 4; ++ j){\n      sum = 0;\n\n      for (k = 0; k < 5; ++ k){\n          sum += bits[i][k] === ids[j][k]? 0: 1;\n      }\n\n      if (sum < minSum){\n        minSum = sum;\n      }\n    }\n\n    dist += minSum;\n  }\n\n  return dist;\n};\n\nAR.Detector.prototype.mat2id = function(bits){\n  var id = 0, i;\n  \n  for (i = 0; i < 5; ++ i){\n    id <<= 1;\n    id |= bits[i][1];\n    id <<= 1;\n    id |= bits[i][3];\n  }\n\n  return id;\n};\n\nAR.Detector.prototype.rotate = function(src){\n  var dst = [], len = src.length, i, j;\n  \n  for (i = 0; i < len; ++ i){\n    dst[i] = [];\n    for (j = 0; j < src[i].length; ++ j){\n      dst[i][j] = src[src[i].length - j - 1][i];\n    }\n  }\n\n  return dst;\n};\n\nAR.Detector.prototype.rotate2 = function(src, rotation){\n  var dst = [], len = src.length, i;\n  \n  for (i = 0; i < len; ++ i){\n    dst[i] = src[ (rotation + i) % len ];\n  }\n\n  return dst;\n};\n\nmodule.exports = AR;","/*\r\nCopyright (c) 2012 Juan Mellado\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n*/\r\n\r\n/*\r\nReferences:\r\n- \"Numerical Recipes in C - Second Edition\"\r\n  http://www.nr.com/\r\n*/\r\n\r\nvar SVD = SVD || {};\r\n\r\nSVD.svdcmp = function(a, m, n, w, v){\r\n  var flag, i, its, j, jj, k, l, nm,\r\n      anorm = 0.0, c, f, g = 0.0, h, s, scale = 0.0, x, y, z, rv1 = [];\r\n      \r\n  //Householder reduction to bidiagonal form\r\n  for (i = 0; i < n; ++ i){\r\n    l = i + 1;\r\n    rv1[i] = scale * g;\r\n    g = s = scale = 0.0;\r\n    if (i < m){\r\n      for (k = i; k < m; ++ k){\r\n        scale += Math.abs( a[k][i] );\r\n      }\r\n      if (0.0 !== scale){\r\n        for (k = i; k < m; ++ k){\r\n          a[k][i] /= scale;\r\n          s += a[k][i] * a[k][i];\r\n        }\r\n        f = a[i][i];\r\n        g = -SVD.sign( Math.sqrt(s), f );\r\n        h = f * g - s;\r\n        a[i][i] = f - g;\r\n        for (j = l; j < n; ++ j){\r\n          for (s = 0.0, k = i; k < m; ++ k){\r\n            s += a[k][i] * a[k][j];\r\n          }\r\n          f = s / h;\r\n          for (k = i; k < m; ++ k){\r\n            a[k][j] += f * a[k][i];\r\n          }\r\n        }\r\n        for (k = i; k < m; ++ k){\r\n          a[k][i] *= scale;\r\n        }\r\n      }\r\n    }\r\n    w[i] = scale * g;\r\n    g = s = scale = 0.0;\r\n    if ( (i < m) && (i !== n - 1) ){\r\n      for (k = l; k < n; ++ k){\r\n        scale += Math.abs( a[i][k] );\r\n      }\r\n      if (0.0 !== scale){\r\n        for (k = l; k < n; ++ k){\r\n          a[i][k] /= scale;\r\n          s += a[i][k] * a[i][k];\r\n        }\r\n        f = a[i][l];\r\n        g = -SVD.sign( Math.sqrt(s), f );\r\n        h = f * g - s;\r\n        a[i][l] = f - g;\r\n        for (k = l; k < n; ++ k){\r\n          rv1[k] = a[i][k] / h;\r\n        }\r\n        for (j = l; j < m; ++ j){\r\n          for (s = 0.0, k = l; k < n; ++ k){\r\n            s += a[j][k] * a[i][k];\r\n          }\r\n          for (k = l; k < n; ++ k){\r\n            a[j][k] += s * rv1[k];\r\n          }\r\n        }\r\n        for (k = l; k < n; ++ k){\r\n          a[i][k] *= scale;\r\n        }\r\n      }\r\n    }\r\n    anorm = Math.max(anorm, ( Math.abs( w[i] ) + Math.abs( rv1[i] ) ) );\r\n  }\r\n\r\n  //Acumulation of right-hand transformation\r\n  for (i = n - 1; i >= 0; -- i){\r\n    if (i < n - 1){\r\n      if (0.0 !== g){\r\n        for (j = l; j < n; ++ j){\r\n          v[j][i] = ( a[i][j] / a[i][l] ) / g;\r\n        }\r\n        for (j = l; j < n; ++ j){\r\n          for (s = 0.0, k = l; k < n; ++ k){\r\n            s += a[i][k] * v[k][j];\r\n          }\r\n          for (k = l; k < n; ++ k){\r\n            v[k][j] += s * v[k][i];\r\n          }\r\n        }\r\n      }\r\n      for (j = l; j < n; ++ j){\r\n        v[i][j] = v[j][i] = 0.0;\r\n      }\r\n    }\r\n    v[i][i] = 1.0;\r\n    g = rv1[i];\r\n    l = i;\r\n  }\r\n\r\n  //Acumulation of left-hand transformation\r\n  for (i = Math.min(n, m) - 1; i >= 0; -- i){\r\n    l = i + 1;\r\n    g = w[i];\r\n    for (j = l; j < n; ++ j){\r\n      a[i][j] = 0.0;\r\n    }\r\n    if (0.0 !== g){\r\n      g = 1.0 / g;\r\n      for (j = l; j < n; ++ j){\r\n        for (s = 0.0, k = l; k < m; ++ k){\r\n          s += a[k][i] * a[k][j];\r\n        }\r\n        f = (s / a[i][i]) * g;\r\n        for (k = i; k < m; ++ k){\r\n          a[k][j] += f * a[k][i];\r\n        }\r\n      }\r\n      for (j = i; j < m; ++ j){\r\n        a[j][i] *= g;\r\n      }\r\n    }else{\r\n        for (j = i; j < m; ++ j){\r\n          a[j][i] = 0.0;\r\n        }\r\n    }\r\n    ++ a[i][i];\r\n  }\r\n\r\n  //Diagonalization of the bidiagonal form\r\n  for (k = n - 1; k >= 0; -- k){\r\n    for (its = 1; its <= 30; ++ its){\r\n      flag = true;\r\n      for (l = k; l >= 0; -- l){\r\n        nm = l - 1;\r\n        if ( Math.abs( rv1[l] ) + anorm === anorm ){\r\n          flag = false;\r\n          break;\r\n        }\r\n        if ( Math.abs( w[nm] ) + anorm === anorm ){\r\n          break;\r\n        }\r\n      }\r\n      if (flag){\r\n        c = 0.0;\r\n        s = 1.0;\r\n        for (i = l; i <= k; ++ i){\r\n          f = s * rv1[i];\r\n          if ( Math.abs(f) + anorm === anorm ){\r\n            break;\r\n          }\r\n          g = w[i];\r\n          h = SVD.pythag(f, g);\r\n          w[i] = h;\r\n          h = 1.0 / h;\r\n          c = g * h;\r\n          s = -f * h;\r\n          for (j = 1; j <= m; ++ j){\r\n            y = a[j][nm];\r\n            z = a[j][i];\r\n            a[j][nm] = y * c + z * s;\r\n            a[j][i] = z * c - y * s;\r\n          }\r\n        }\r\n      }\r\n\r\n      //Convergence\r\n      z = w[k];\r\n      if (l === k){\r\n        if (z < 0.0){\r\n          w[k] = -z;\r\n          for (j = 0; j < n; ++ j){\r\n            v[j][k] = -v[j][k];\r\n          }\r\n        }\r\n        break;\r\n      }\r\n\r\n      if (30 === its){\r\n        return false;\r\n      }\r\n\r\n      //Shift from bottom 2-by-2 minor\r\n      x = w[l];\r\n      nm = k - 1;\r\n      y = w[nm];\r\n      g = rv1[nm];\r\n      h = rv1[k];\r\n      f = ( (y - z) * (y + z) + (g - h) * (g + h) ) / (2.0 * h * y);\r\n      g = SVD.pythag( f, 1.0 );\r\n      f = ( (x - z) * (x + z) + h * ( (y / (f + SVD.sign(g, f) ) ) - h) ) / x;\r\n\r\n      //Next QR transformation\r\n      c = s = 1.0;\r\n      for (j = l; j <= nm; ++ j){\r\n        i = j + 1;\r\n        g = rv1[i];\r\n        y = w[i];\r\n        h = s * g;\r\n        g = c * g;\r\n        z = SVD.pythag(f, h);\r\n        rv1[j] = z;\r\n        c = f / z;\r\n        s = h / z;\r\n        f = x * c + g * s;\r\n        g = g * c - x * s;\r\n        h = y * s;\r\n        y *= c;\r\n        for (jj = 0; jj < n; ++ jj){\r\n          x = v[jj][j];\r\n          z = v[jj][i];\r\n          v[jj][j] = x * c + z * s;\r\n          v[jj][i] = z * c - x * s;\r\n        }\r\n        z = SVD.pythag(f, h);\r\n        w[j] = z;\r\n        if (0.0 !== z){\r\n          z = 1.0 / z;\r\n          c = f * z;\r\n          s = h * z;\r\n        }\r\n        f = c * g + s * y;\r\n        x = c * y - s * g;\r\n        for (jj = 0; jj < m; ++ jj){\r\n          y = a[jj][j];\r\n          z = a[jj][i];\r\n          a[jj][j] = y * c + z * s;\r\n          a[jj][i] = z * c - y * s;\r\n        }\r\n      }\r\n      rv1[l] = 0.0;\r\n      rv1[k] = f;\r\n      w[k] = x;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nSVD.pythag = function(a, b){\r\n  var at = Math.abs(a), bt = Math.abs(b), ct;\r\n\r\n  if (at > bt){\r\n    ct = bt / at;\r\n    return at * Math.sqrt(1.0 + ct * ct);\r\n  }\r\n    \r\n  if (0.0 === bt){\r\n    return 0.0;\r\n  }\r\n\r\n  ct = at / bt;\r\n  return bt * Math.sqrt(1.0 + ct * ct);\r\n};\r\n\r\nSVD.sign = function(a, b){\r\n  return b >= 0.0? Math.abs(a): -Math.abs(a);\r\n};\r\n\r\nmodule.exports = SVD;","/*\r\nCopyright (c) 2012 Juan Mellado\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n*/\r\n\r\n/*\r\nReferences:\r\n- \"Iterative Pose Estimation using Coplanar Feature Points\"\r\n  Denis Oberkampf, Daniel F. DeMenthon, Larry S. Davis\r\n  http://www.cfar.umd.edu/~daniel/daniel_papersfordownload/CoplanarPts.pdf\r\n*/\r\n\r\nvar SVD = require('./svd');\r\n\r\nvar POS = POS || {};\r\n\r\nPOS.Posit = function(modelSize, focalLength){\r\n  this.objectPoints = this.buildModel(modelSize);\r\n  this.focalLength = focalLength;\r\n\r\n  this.objectVectors = [];\r\n  this.objectNormal = [];\r\n  this.objectMatrix = [[],[],[]];\r\n  \r\n  this.init();\r\n};\r\n\r\nPOS.Posit.prototype.buildModel = function(modelSize){\r\n  var half = modelSize / 2.0;\r\n  \r\n  return [\r\n    [-half,  half, 0.0],\r\n    [ half,  half, 0.0],\r\n    [ half, -half, 0.0],\r\n    [-half, -half, 0.0] ];\r\n};\r\n\r\nPOS.Posit.prototype.init = function(){\r\n  var np = this.objectPoints.length,\r\n      vectors = [], n = [], len = 0.0, row = 2, i;\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    this.objectVectors[i] = [this.objectPoints[i][0] - this.objectPoints[0][0],\r\n                             this.objectPoints[i][1] - this.objectPoints[0][1],\r\n                             this.objectPoints[i][2] - this.objectPoints[0][2]];\r\n                             \r\n    vectors[i] = [this.objectVectors[i][0],\r\n                  this.objectVectors[i][1],\r\n                  this.objectVectors[i][2]];\r\n  }\r\n\r\n  while(0.0 === len){\r\n    n[0] = this.objectVectors[1][1] * this.objectVectors[row][2] -\r\n           this.objectVectors[1][2] * this.objectVectors[row][1];\r\n    n[1] = this.objectVectors[1][2] * this.objectVectors[row][0] -\r\n           this.objectVectors[1][0] * this.objectVectors[row][2];\r\n    n[2] = this.objectVectors[1][0] * this.objectVectors[row][1] -\r\n           this.objectVectors[1][1] * this.objectVectors[row][0];\r\n    \r\n    len = Math.sqrt(n[0] * n[0] + n[1] * n[1] + n[2] * n[2]);\r\n    \r\n    ++ row;\r\n  }\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    this.objectNormal[i] = n[i] / len;\r\n  }\r\n\r\n  POS.pseudoInverse(vectors, np, this.objectMatrix);\r\n};\r\n\r\nPOS.Posit.prototype.pose = function(imagePoints){\r\n  var posRotation1 = [[],[],[]], posRotation2 = [[],[],[]], posTranslation = [],\r\n      rotation1 = [[],[],[]], rotation2 = [[],[],[]], translation1 = [], translation2 = [],\r\n      error1, error2, valid1, valid2, i, j;\r\n\r\n  this.pos(imagePoints, posRotation1, posRotation2, posTranslation);\r\n\r\n  valid1 = this.isValid(posRotation1, posTranslation);\r\n  if (valid1){\r\n    error1 = this.iterate(imagePoints, posRotation1, posTranslation, rotation1, translation1);\r\n  }else{\r\n    error1 = {euclidean: -1.0, pixels: -1, maximum: -1.0};\r\n  }\r\n  \r\n  valid2 = this.isValid(posRotation2, posTranslation);\r\n  if (valid2){\r\n    error2 = this.iterate(imagePoints, posRotation2, posTranslation, rotation2, translation2);\r\n  }else{\r\n    error2 = {euclidean: -1.0, pixels: -1, maximum: -1.0};\r\n  }\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    for (j = 0; j < 3; ++ j){\r\n      if (valid1){\r\n        translation1[i] -= rotation1[i][j] * this.objectPoints[0][j];\r\n      }\r\n      if (valid2){\r\n        translation2[i] -= rotation2[i][j] * this.objectPoints[0][j];\r\n      }\r\n    }\r\n  }\r\n\r\n  return error1.euclidean < error2.euclidean?\r\n    new POS.Pose(error1.pixels, rotation1, translation1, error2.pixels, rotation2, translation2):\r\n    new POS.Pose(error2.pixels, rotation2, translation2, error1.pixels, rotation1, translation1);\r\n};\r\n\r\nPOS.Posit.prototype.pos = function(imagePoints, rotation1, rotation2, translation){\r\n  var np = this.objectPoints.length, imageVectors = [],\r\n      i0 = [], j0 = [], ivec = [], jvec = [], row1 = [], row2 = [], row3 = [],\r\n      i0i0, j0j0, i0j0, delta, q, lambda, mu, scale, i, j;\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    imageVectors[i] = [imagePoints[i].x - imagePoints[0].x,\r\n                       imagePoints[i].y - imagePoints[0].y];\r\n  }\r\n\r\n  //i0 and j0\r\n  for (i = 0; i < 3; ++ i){\r\n    i0[i] = 0.0;\r\n    j0[i] = 0.0;\r\n    for (j = 0; j < np; ++ j){\r\n      i0[i] += this.objectMatrix[i][j] * imageVectors[j][0];\r\n      j0[i] += this.objectMatrix[i][j] * imageVectors[j][1];\r\n    }\r\n  }\r\n\r\n  i0i0 = i0[0] * i0[0] + i0[1] * i0[1] + i0[2] * i0[2];\r\n  j0j0 = j0[0] * j0[0] + j0[1] * j0[1] + j0[2] * j0[2];\r\n  i0j0 = i0[0] * j0[0] + i0[1] * j0[1] + i0[2] * j0[2];\r\n\r\n  //Lambda and mu\r\n  delta = (j0j0 - i0i0) * (j0j0 - i0i0) + 4.0 * (i0j0 * i0j0);\r\n  \r\n  if (j0j0 - i0i0 >= 0.0){\r\n    q = (j0j0 - i0i0 + Math.sqrt(delta) ) / 2.0;\r\n  }else{\r\n    q = (j0j0 - i0i0 - Math.sqrt(delta) ) / 2.0;\r\n  }\r\n  \r\n  if (q >= 0.0){\r\n    lambda = Math.sqrt(q);\r\n    if (0.0 === lambda){\r\n      mu = 0.0;\r\n    }else{\r\n      mu = -i0j0 / lambda;\r\n    }\r\n  }else{\r\n    lambda = Math.sqrt( -(i0j0 * i0j0) / q);\r\n    if (0.0 === lambda){\r\n      mu = Math.sqrt(i0i0 - j0j0);\r\n    }else{\r\n      mu = -i0j0 / lambda;\r\n    }\r\n  }\r\n\r\n  //First rotation\r\n  for (i = 0; i < 3; ++ i){\r\n    ivec[i] = i0[i] + lambda * this.objectNormal[i];\r\n    jvec[i] = j0[i] + mu * this.objectNormal[i];\r\n  }\r\n  \r\n  scale = Math.sqrt(ivec[0] * ivec[0] + ivec[1] * ivec[1] + ivec[2] * ivec[2]);\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    row1[i] = ivec[i] / scale;\r\n    row2[i] = jvec[i] / scale;\r\n  }\r\n  \r\n  row3[0] = row1[1] * row2[2] - row1[2] * row2[1];\r\n  row3[1] = row1[2] * row2[0] - row1[0] * row2[2];\r\n  row3[2] = row1[0] * row2[1] - row1[1] * row2[0];\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    rotation1[0][i] = row1[i];\r\n    rotation1[1][i] = row2[i];\r\n    rotation1[2][i] = row3[i];\r\n  }\r\n\r\n  //Second rotation\r\n  for (i = 0; i < 3; ++ i){\r\n    ivec[i] = i0[i] - lambda * this.objectNormal[i];\r\n    jvec[i] = j0[i] - mu * this.objectNormal[i];\r\n  }\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    row1[i] = ivec[i] / scale;\r\n    row2[i] = jvec[i] / scale;\r\n  }\r\n  \r\n  row3[0] = row1[1] * row2[2] - row1[2] * row2[1];\r\n  row3[1] = row1[2] * row2[0] - row1[0] * row2[2];\r\n  row3[2] = row1[0] * row2[1] - row1[1] * row2[0];\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    rotation2[0][i] = row1[i];\r\n    rotation2[1][i] = row2[i];\r\n    rotation2[2][i] = row3[i];\r\n  }\r\n\r\n  //Translation\r\n  translation[0] = imagePoints[0].x / scale;\r\n  translation[1] = imagePoints[0].y / scale;\r\n  translation[2] = this.focalLength / scale;\r\n};\r\n\r\nPOS.Posit.prototype.isValid = function(rotation, translation){\r\n  var np = this.objectPoints.length, zmin = Infinity, i = 0, zi;\r\n\r\n  for (; i < np; ++ i){\r\n    zi = translation[2] +\r\n      (rotation[2][0] * this.objectVectors[i][0] +\r\n       rotation[2][1] * this.objectVectors[i][1] +\r\n       rotation[2][2] * this.objectVectors[i][2]);\r\n    if (zi < zmin){\r\n      zmin = zi;\r\n    }\r\n  }\r\n\r\n  return zmin >= 0.0;\r\n};\r\n\r\nPOS.Posit.prototype.iterate = function(imagePoints, posRotation, posTranslation, rotation, translation){\r\n  var np = this.objectPoints.length,\r\n      oldSopImagePoints = [], sopImagePoints = [],\r\n      rotation1 = [[],[],[]], rotation2 = [[],[],[]],\r\n      translation1 = [], translation2 = [],\r\n      converged = false, iteration = 0,\r\n      oldImageDifference, imageDifference, factor,\r\n      error, error1, error2, delta, i, j;\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    oldSopImagePoints[i] = {x: imagePoints[i].x,\r\n                            y: imagePoints[i].y};\r\n  }\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    for (j = 0; j < 3; ++ j){\r\n      rotation[i][j] = posRotation[i][j];\r\n    }\r\n    translation[i] = posTranslation[i];\r\n  }\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    factor = 0.0;\r\n    for (j = 0; j < 3; ++ j){\r\n      factor += this.objectVectors[i][j] * rotation[2][j] / translation[2];\r\n    }\r\n    sopImagePoints[i] = {x: (1.0 + factor) * imagePoints[i].x,\r\n                         y: (1.0 + factor) * imagePoints[i].y};\r\n  }\r\n\r\n  imageDifference = 0.0;\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    imageDifference += Math.abs(sopImagePoints[i].x - oldSopImagePoints[i].x);\r\n    imageDifference += Math.abs(sopImagePoints[i].y - oldSopImagePoints[i].y);\r\n  }\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    translation1[i] = translation[i] -\r\n      (rotation[i][0] * this.objectPoints[0][0] +\r\n       rotation[i][1] * this.objectPoints[0][1] +\r\n       rotation[i][2] * this.objectPoints[0][2]);\r\n  }\r\n  \r\n  error = error1 = this.error(imagePoints, rotation, translation1);\r\n\r\n  //Convergence\r\n  converged = (0.0 === error1.pixels) || (imageDifference < 0.01);\r\n  \r\n  while( iteration ++ < 100 && !converged ){\r\n  \r\n    for (i = 0; i < np; ++ i){\r\n      oldSopImagePoints[i].x = sopImagePoints[i].x;\r\n      oldSopImagePoints[i].y = sopImagePoints[i].y;\r\n    }\r\n\r\n    this.pos(sopImagePoints, rotation1, rotation2, translation);\r\n\r\n    for (i = 0; i < 3; ++ i){\r\n      translation1[i] = translation[i] -\r\n        (rotation1[i][0] * this.objectPoints[0][0] +\r\n         rotation1[i][1] * this.objectPoints[0][1] +\r\n         rotation1[i][2] * this.objectPoints[0][2]);\r\n        \r\n      translation2[i] = translation[i] -\r\n        (rotation2[i][0] * this.objectPoints[0][0] +\r\n         rotation2[i][1] * this.objectPoints[0][1] +\r\n         rotation2[i][2] * this.objectPoints[0][2]);\r\n    }\r\n\r\n    error1 = this.error(imagePoints, rotation1, translation1);\r\n    error2 = this.error(imagePoints, rotation2, translation2);\r\n\r\n    if ( (error1.euclidean >= 0.0) && (error2.euclidean >= 0.0) ){\r\n      if (error2.euclidean < error1.euclidean){\r\n        error = error2;\r\n        for (i = 0; i < 3; ++ i){\r\n          for (j = 0; j < 3; ++ j){\r\n            rotation[i][j] = rotation2[i][j];\r\n          }\r\n        }\r\n      }else{\r\n        error = error1;\r\n        for (i = 0; i < 3; ++ i){\r\n          for (j = 0; j < 3; ++ j){\r\n            rotation[i][j] = rotation1[i][j];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if ( (error1.euclidean < 0.0) && (error2.euclidean >= 0.0) ){\r\n      error = error2;\r\n      for (i = 0; i < 3; ++ i){\r\n        for (j = 0; j < 3; ++ j){\r\n          rotation[i][j] = rotation2[i][j];\r\n        }\r\n      }\r\n    }\r\n    \r\n    if ( (error2.euclidean < 0.0) && (error1.euclidean >= 0.0) ){\r\n      error = error1;\r\n      for (i = 0; i < 3; ++ i){\r\n        for (j = 0; j < 3; ++ j){\r\n          rotation[i][j] = rotation1[i][j];\r\n        }\r\n      }\r\n    }\r\n\r\n    for (i = 0; i < np; ++ i){\r\n      factor = 0.0;\r\n      for (j = 0; j < 3; ++ j){\r\n        factor += this.objectVectors[i][j] * rotation[2][j] / translation[2];\r\n      }\r\n      sopImagePoints[i].x = (1.0 + factor) * imagePoints[i].x;\r\n      sopImagePoints[i].y = (1.0 + factor) * imagePoints[i].y;\r\n    }\r\n\r\n    oldImageDifference = imageDifference;\r\n    imageDifference = 0.0;\r\n    \r\n    for (i = 0; i < np; ++ i){\r\n      imageDifference += Math.abs(sopImagePoints[i].x - oldSopImagePoints[i].x);\r\n      imageDifference += Math.abs(sopImagePoints[i].y - oldSopImagePoints[i].y);\r\n    }\r\n\r\n    delta = Math.abs(imageDifference - oldImageDifference);\r\n\r\n    converged = (0.0 === error.pixels) || (delta < 0.01);\r\n  }\r\n  \r\n  return error;\r\n};\r\n\r\nPOS.Posit.prototype.error = function(imagePoints, rotation, translation){\r\n  var np = this.objectPoints.length,\r\n      move = [], projection = [], errorvec = [],\r\n      euclidean = 0.0, pixels = 0.0, maximum = 0.0,\r\n      i, j, k;\r\n\r\n  if ( !this.isValid(rotation, translation) ){\r\n    return {euclidean: -1.0, pixels: -1, maximum: -1.0};\r\n  }\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    move[i] = [];\r\n    for (j = 0; j < 3; ++ j){\r\n      move[i][j] = translation[j];\r\n    }\r\n  }\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    for (j = 0; j < 3; ++ j){\r\n      for (k = 0; k < 3; ++ k){\r\n        move[i][j] += rotation[j][k] * this.objectPoints[i][k];\r\n      }\r\n    }\r\n  }\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    projection[i] = [];\r\n    for (j = 0; j < 2; ++ j){\r\n      projection[i][j] = this.focalLength * move[i][j] / move[i][2];\r\n    }\r\n  }\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    errorvec[i] = [projection[i][0] - imagePoints[i].x,\r\n                   projection[i][1] - imagePoints[i].y];\r\n  }\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    euclidean += Math.sqrt(errorvec[i][0] * errorvec[i][0] +\r\n                           errorvec[i][1] * errorvec[i][1]);\r\n                       \r\n    pixels += Math.abs( Math.round(projection[i][0]) - Math.round(imagePoints[i].x) ) +\r\n              Math.abs( Math.round(projection[i][1]) - Math.round(imagePoints[i].y) );\r\n              \r\n    if (Math.abs(errorvec[i][0]) > maximum){\r\n      maximum = Math.abs(errorvec[i][0]);\r\n    }\r\n    if (Math.abs(errorvec[i][1]) > maximum){\r\n      maximum = Math.abs(errorvec[i][1]);\r\n    }\r\n  }\r\n\r\n  return {euclidean: euclidean / np, pixels: pixels, maximum: maximum};\r\n};\r\n\r\nPOS.pseudoInverse = function(a, n, b){\r\n  var w = [], v = [[],[],[]], s = [[],[],[]],\r\n      wmax = 0.0, cn = 0,\r\n      i, j, k;\r\n\r\n  SVD.svdcmp(a, n, 3, w, v);\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    if (w[i] > wmax){\r\n      wmax = w[i];\r\n    }\r\n  }\r\n\r\n  wmax *= 0.01;\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    if (w[i] < wmax){\r\n      w[i] = 0.0;\r\n    }\r\n  }\r\n\r\n  for (j = 0; j < 3; ++ j){\r\n    if (0.0 === w[j]){\r\n      ++ cn;\r\n      for (k = j; k < 2; ++ k){\r\n        for (i = 0; i < n; ++ i){\r\n          a[i][k] = a[i][k + 1];\r\n        }\r\n        for (i = 0; i < 3; ++ i){\r\n          v[i][k] = v[i][k + 1];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  for (j = 0; j < 2; ++ j){\r\n    if (0.0 === w[j]){\r\n      w[j] = w[j + 1];\r\n    }\r\n  }\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    for (j = 0; j < 3 - cn; ++ j){\r\n      s[i][j] = v[i][j] / w[j];\r\n    }\r\n  }\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    for (j = 0; j < n; ++ j){\r\n      b[i][j] = 0.0;\r\n      for (k = 0; k < 3 - cn; ++ k){\r\n        b[i][j] += s[i][k] * a[j][k];\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nPOS.Pose = function(error1, rotation1, translation1, error2, rotation2, translation2){\r\n  this.bestError = error1;\r\n  this.bestRotation = rotation1;\r\n  this.bestTranslation = translation1;\r\n  this.alternativeError = error2;\r\n  this.alternativeRotation = rotation2;\r\n  this.alternativeTranslation = translation2;\r\n};\r\n\r\nmodule.exports = POS;","/*\r\nCopyright (c) 2012 Juan Mellado\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n*/\r\n\r\n/*\r\nReferences:\r\n- \"3D Pose Estimation\"\r\n  Andrew Kirillow\r\n  http://www.aforgenet.com/articles/posit/\r\n*/\r\n\r\nvar SVD = require('./svd');\r\n\r\nvar POS = POS || {};\r\n\r\nPOS.Posit = function(modelSize, focalLength){\r\n  this.model = this.buildModel(modelSize);\r\n  this.focalLength = focalLength;\r\n\r\n  this.init();\r\n};\r\n\r\nPOS.Posit.prototype.buildModel = function(modelSize){\r\n  var half = modelSize / 2.0;\r\n  \r\n  return [\r\n    new Vec3(-half,  half, 0.0),\r\n    new Vec3( half,  half, 0.0),\r\n    new Vec3( half, -half, 0.0),\r\n    new Vec3(-half, -half, 0.0) ];\r\n};\r\n\r\nPOS.Posit.prototype.init = function(){\r\n  var d = new Vec3(), v = new Mat3(), u;\r\n  \r\n  this.modelVectors = Mat3.fromRows(\r\n      Vec3.sub(this.model[1], this.model[0]),\r\n      Vec3.sub(this.model[2], this.model[0]),\r\n      Vec3.sub(this.model[3], this.model[0]) );\r\n\r\n  u = Mat3.clone(this.modelVectors);\r\n\r\n  SVD.svdcmp(u.m, 3, 3, d.v, v.m);\r\n\r\n  this.modelPseudoInverse = Mat3.mult(\r\n    Mat3.mult(v, Mat3.fromDiagonal( Vec3.inverse(d) ) ), Mat3.transpose(u) );\r\n  \r\n  this.modelNormal = v.column( d.minIndex() );\r\n};\r\n\r\nPOS.Posit.prototype.pose = function(points){\r\n  var eps = new Vec3(1.0, 1.0, 1.0),\r\n      rotation1 = new Mat3(), rotation2 = new Mat3(),\r\n      translation1 = new Vec3(), translation2 = new Vec3(),\r\n      error1, error2;\r\n\r\n  this.pos(points, eps, rotation1, rotation2, translation1, translation2);\r\n\r\n  error1 = this.iterate(points, rotation1, translation1);\r\n  error2 = this.iterate(points, rotation2, translation2);\r\n\r\n  return error1 < error2?\r\n    new POS.Pose(error1, rotation1.m, translation1.v, error2, rotation2.m, translation2.v):\r\n    new POS.Pose(error2, rotation2.m, translation2.v, error1, rotation1.m, translation1.v);\r\n};\r\n\r\nPOS.Posit.prototype.pos = function(points, eps, rotation1, rotation2, translation1, translation2){\r\n  var xi = new Vec3(points[1].x, points[2].x, points[3].x),\r\n      yi = new Vec3(points[1].y, points[2].y, points[3].y),\r\n      xs = Vec3.addScalar( Vec3.mult(xi, eps), -points[0].x),\r\n      ys = Vec3.addScalar( Vec3.mult(yi, eps), -points[0].y),\r\n      i0 = Mat3.multVector(this.modelPseudoInverse, xs),\r\n      j0 = Mat3.multVector(this.modelPseudoInverse, ys),\r\n      s = j0.square() - i0.square(),\r\n      ij = Vec3.dot(i0, j0),\r\n      r = 0.0, theta = 0.0,\r\n      i, j, k, inorm, jnorm, scale, temp, lambda, mu;\r\n\r\n  if (0.0 === s){\r\n    r = Math.sqrt( Math.abs(2.0 * ij) );\r\n    theta = (-Math.PI / 2.0) * (ij < 0.0? -1: (ij > 0.0? 1.0: 0.0) );\r\n  }else{\r\n    r = Math.sqrt( Math.sqrt(s * s + 4.0 * ij * ij) );\r\n    theta = Math.atan(-2.0 * ij / s);\r\n    if (s < 0.0){\r\n      theta += Math.PI;\r\n    }\r\n    theta /= 2.0;\r\n  }\r\n\r\n  lambda = r * Math.cos(theta);\r\n  mu = r * Math.sin(theta);\r\n\r\n  //First possible rotation/translation\r\n  i = Vec3.add(i0, Vec3.multScalar(this.modelNormal, lambda) );\r\n  j = Vec3.add(j0, Vec3.multScalar(this.modelNormal, mu) );\r\n  inorm = i.normalize();\r\n  jnorm = j.normalize();\r\n  k = Vec3.cross(i, j);\r\n  rotation1.copy( Mat3.fromRows(i, j, k) );\r\n  \r\n  scale = (inorm + jnorm) / 2.0;\r\n  temp = Mat3.multVector(rotation1, this.model[0]);\r\n  translation1.v = [\r\n    points[0].x / scale - temp.v[0],\r\n    points[0].y / scale - temp.v[1],\r\n    this.focalLength / scale];\r\n\r\n  //Second possible rotation/translation\r\n  i = Vec3.sub(i0, Vec3.multScalar(this.modelNormal, lambda) );\r\n  j = Vec3.sub(j0, Vec3.multScalar(this.modelNormal, mu) );\r\n  inorm = i.normalize();\r\n  jnorm = j.normalize();\r\n  k = Vec3.cross(i, j);\r\n  rotation2.copy( Mat3.fromRows(i, j, k) );\r\n  \r\n  scale = (inorm + jnorm) / 2.0;\r\n  temp = Mat3.multVector(rotation2, this.model[0]);\r\n  translation2.v = [\r\n    points[0].x / scale - temp.v[0],\r\n    points[0].y / scale - temp.v[1],\r\n    this.focalLength / scale];\r\n};\r\n\r\nPOS.Posit.prototype.iterate = function(points, rotation, translation){\r\n  var prevError = Infinity,\r\n      rotation1 = new Mat3(), rotation2 = new Mat3(),\r\n      translation1 = new Vec3(), translation2 = new Vec3(),\r\n      i = 0, eps, error, error1, error2;\r\n\r\n  for (; i < 100; ++ i){\r\n    eps = Vec3.addScalar( Vec3.multScalar( \r\n      Mat3.multVector( this.modelVectors, rotation.row(2) ), 1.0 / translation.v[2]), 1.0);\r\n\r\n    this.pos(points, eps, rotation1, rotation2, translation1, translation2);\r\n\r\n    error1 = this.getError(points, rotation1, translation1);\r\n    error2 = this.getError(points, rotation2, translation2);\r\n\r\n    if (error1 < error2){\r\n      rotation.copy(rotation1);\r\n      translation.copy(translation1);\r\n      error = error1;\r\n    }else{\r\n      rotation.copy(rotation2);\r\n      translation.copy(translation2);\r\n      error = error2;\r\n    }\r\n\r\n    if ( (error <= 2.0) || (error > prevError) ){\r\n      break;\r\n    }\r\n\r\n    prevError = error;\r\n  }\r\n\r\n  return error;\r\n};\r\n\r\nPOS.Posit.prototype.getError = function(points, rotation, translation){\r\n  var v1 = Vec3.add( Mat3.multVector(rotation, this.model[0]), translation),\r\n      v2 = Vec3.add( Mat3.multVector(rotation, this.model[1]), translation),\r\n      v3 = Vec3.add( Mat3.multVector(rotation, this.model[2]), translation),\r\n      v4 = Vec3.add( Mat3.multVector(rotation, this.model[3]), translation),\r\n      modeled, ia1, ia2, ia3, ia4, ma1, ma2, ma3, ma4;\r\n  \r\n  v1 = v1.v; v2 = v2.v; v3 = v3.v; v4 = v4.v;\r\n  \r\n  v1[0] *= this.focalLength / v1[2];\r\n  v1[1] *= this.focalLength / v1[2];\r\n  v2[0] *= this.focalLength / v2[2];\r\n  v2[1] *= this.focalLength / v2[2];\r\n  v3[0] *= this.focalLength / v3[2];\r\n  v3[1] *= this.focalLength / v3[2];\r\n  v4[0] *= this.focalLength / v4[2];\r\n  v4[1] *= this.focalLength / v4[2];\r\n  \r\n  modeled = [\r\n    {x: v1[0], y: v1[1]},\r\n    {x: v2[0], y: v2[1]},\r\n    {x: v3[0], y: v3[1]},\r\n    {x: v4[0], y: v4[1]}\r\n  ];\r\n\r\n  ia1 = this.angle( points[0], points[1], points[3] );\r\n  ia2 = this.angle( points[1], points[2], points[0] );\r\n  ia3 = this.angle( points[2], points[3], points[1] );\r\n  ia4 = this.angle( points[3], points[0], points[2] );\r\n\r\n  ma1 = this.angle( modeled[0], modeled[1], modeled[3] );\r\n  ma2 = this.angle( modeled[1], modeled[2], modeled[0] );\r\n  ma3 = this.angle( modeled[2], modeled[3], modeled[1] );\r\n  ma4 = this.angle( modeled[3], modeled[0], modeled[2] );\r\n\r\n  return ( Math.abs(ia1 - ma1) +\r\n           Math.abs(ia2 - ma2) +\r\n           Math.abs(ia3 - ma3) +\r\n           Math.abs(ia4 - ma4) ) / 4.0;\r\n};\r\n\r\nPOS.Posit.prototype.angle = function(a, b, c){\r\n  var x1 = b.x - a.x, y1 = b.y - a.y,\r\n      x2 = c.x - a.x, y2 = c.y - a.y;\r\n  \r\n  return Math.acos( (x1 * x2 + y1 * y2) / \r\n    (Math.sqrt(x1 * x1 + y1 * y1) * Math.sqrt(x2 * x2 + y2 * y2) ) ) * 180.0 / Math.PI;\r\n};\r\n\r\nPOS.Pose = function(error1, rotation1, translation1, error2, rotation2, translation2){\r\n  this.bestError = error1;\r\n  this.bestRotation = rotation1;\r\n  this.bestTranslation = translation1;\r\n  this.alternativeError = error2;\r\n  this.alternativeRotation = rotation2;\r\n  this.alternativeTranslation = translation2;\r\n};\r\n\r\nvar Vec3 = function(x, y, z){\r\n  this.v = [x || 0.0, y || 0.0, z || 0.0];\r\n};\r\n\r\nVec3.prototype.copy = function(a){\r\n  var v = this.v;\r\n\r\n  a = a.v;\r\n\r\n  v[0] = a[0];\r\n  v[1] = a[1];\r\n  v[2] = a[2];\r\n\r\n  return this;\r\n};\r\n\r\nVec3.add = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v; b = b.v;\r\n\r\n  v[0] = a[0] + b[0];\r\n  v[1] = a[1] + b[1];\r\n  v[2] = a[2] + b[2];\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.sub = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v; b = b.v;\r\n\r\n  v[0] = a[0] - b[0];\r\n  v[1] = a[1] - b[1];\r\n  v[2] = a[2] - b[2];\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.mult = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v; b = b.v;\r\n\r\n  v[0] = a[0] * b[0];\r\n  v[1] = a[1] * b[1];\r\n  v[2] = a[2] * b[2];\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.addScalar = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v;\r\n\r\n  v[0] = a[0] + b;\r\n  v[1] = a[1] + b;\r\n  v[2] = a[2] + b;\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.multScalar = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v;\r\n\r\n  v[0] = a[0] * b;\r\n  v[1] = a[1] * b;\r\n  v[2] = a[2] * b;\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.dot = function(a, b){\r\n  a = a.v; b = b.v;\r\n\r\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n};\r\n\r\nVec3.cross = function(a, b){\r\n  a = a.v; b = b.v;\r\n\r\n return new Vec3(\r\n    a[1] * b[2] - a[2] * b[1],\r\n    a[2] * b[0] - a[0] * b[2],\r\n    a[0] * b[1] - a[1] * b[0]);\r\n};\r\n\r\nVec3.prototype.normalize = function(){\r\n  var v = this.v,\r\n      len = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n      \r\n  if (len > 0.0){\r\n    v[0] /= len;\r\n    v[1] /= len;\r\n    v[2] /= len;\r\n  }\r\n\r\n  return len;\r\n};\r\n\r\nVec3.inverse = function(a){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v;\r\n  \r\n  if (a[0] !== 0.0){\r\n    v[0] = 1.0 / a[0];\r\n  }\r\n  if (a[1] !== 0.0){\r\n    v[1] = 1.0 / a[1];\r\n  }\r\n  if (a[2] !== 0.0){\r\n    v[2] = 1.0 / a[2];\r\n  }\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.prototype.square = function(){\r\n  var v = this.v;\r\n\r\n  return v[0] * v[0] + v[1] * v[1] + v[2] * v[2];\r\n};\r\n\r\nVec3.prototype.minIndex = function(){\r\n  var v = this.v;\r\n\r\n  return v[0] < v[1]? (v[0] < v[2]? 0: 2): (v[1] < v[2]? 1: 2);\r\n};\r\n\r\nvar Mat3 = function(){\r\n  this.m = [ [0.0, 0.0, 0.0],\r\n             [0.0, 0.0, 0.0],\r\n             [0.0, 0.0, 0.0] ];\r\n};\r\n\r\nMat3.clone = function(a){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.m;\r\n\r\n  m[0][0] = a[0][0];\r\n  m[0][1] = a[0][1];\r\n  m[0][2] = a[0][2];\r\n  m[1][0] = a[1][0];\r\n  m[1][1] = a[1][1];\r\n  m[1][2] = a[1][2];\r\n  m[2][0] = a[2][0];\r\n  m[2][1] = a[2][1];\r\n  m[2][2] = a[2][2];\r\n  \r\n  return matrix;\r\n};\r\n\r\nMat3.prototype.copy = function(a){\r\n  var m = this.m;\r\n\r\n  a = a.m;\r\n\r\n  m[0][0] = a[0][0];\r\n  m[0][1] = a[0][1];\r\n  m[0][2] = a[0][2];\r\n  m[1][0] = a[1][0];\r\n  m[1][1] = a[1][1];\r\n  m[1][2] = a[1][2];\r\n  m[2][0] = a[2][0];\r\n  m[2][1] = a[2][1];\r\n  m[2][2] = a[2][2];\r\n\r\n  return this;\r\n};\r\n\r\nMat3.fromRows = function(a, b, c){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.v; b = b.v; c = c.v;\r\n  \r\n  m[0][0] = a[0];\r\n  m[0][1] = a[1];\r\n  m[0][2] = a[2];\r\n  m[1][0] = b[0];\r\n  m[1][1] = b[1];\r\n  m[1][2] = b[2];\r\n  m[2][0] = c[0];\r\n  m[2][1] = c[1];\r\n  m[2][2] = c[2];\r\n\r\n  return matrix;\r\n};\r\n\r\nMat3.fromDiagonal = function(a){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.v;\r\n  \r\n  m[0][0] = a[0];\r\n  m[1][1] = a[1];\r\n  m[2][2] = a[2];\r\n  \r\n  return matrix;\r\n};\r\n\r\nMat3.transpose = function(a){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.m;\r\n  \r\n  m[0][0] = a[0][0];\r\n  m[0][1] = a[1][0];\r\n  m[0][2] = a[2][0];\r\n  m[1][0] = a[0][1];\r\n  m[1][1] = a[1][1];\r\n  m[1][2] = a[2][1];\r\n  m[2][0] = a[0][2];\r\n  m[2][1] = a[1][2];\r\n  m[2][2] = a[2][2];\r\n            \r\n  return matrix;\r\n};\r\n\r\nMat3.mult = function(a, b){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.m; b = b.m;\r\n\r\n  m[0][0] = a[0][0] * b[0][0] + a[0][1] * b[1][0] + a[0][2] * b[2][0];\r\n  m[0][1] = a[0][0] * b[0][1] + a[0][1] * b[1][1] + a[0][2] * b[2][1];\r\n  m[0][2] = a[0][0] * b[0][2] + a[0][1] * b[1][2] + a[0][2] * b[2][2];\r\n  m[1][0] = a[1][0] * b[0][0] + a[1][1] * b[1][0] + a[1][2] * b[2][0];\r\n  m[1][1] = a[1][0] * b[0][1] + a[1][1] * b[1][1] + a[1][2] * b[2][1];\r\n  m[1][2] = a[1][0] * b[0][2] + a[1][1] * b[1][2] + a[1][2] * b[2][2];\r\n  m[2][0] = a[2][0] * b[0][0] + a[2][1] * b[1][0] + a[2][2] * b[2][0];\r\n  m[2][1] = a[2][0] * b[0][1] + a[2][1] * b[1][1] + a[2][2] * b[2][1];\r\n  m[2][2] = a[2][0] * b[0][2] + a[2][1] * b[1][2] + a[2][2] * b[2][2];\r\n\r\n  return matrix;\r\n};\r\n\r\nMat3.multVector = function(m, a){\r\n  m = m.m; a = a.v;\r\n  \r\n  return new Vec3(\r\n    m[0][0] * a[0] + m[0][1] * a[1] + m[0][2] * a[2],\r\n    m[1][0] * a[0] + m[1][1] * a[1] + m[1][2] * a[2],\r\n    m[2][0] * a[0] + m[2][1] * a[1] + m[2][2] * a[2]);\r\n};\r\n\r\nMat3.prototype.column = function(index){\r\n  var m = this.m;\r\n  \r\n  return new Vec3( m[0][index], m[1][index], m[2][index] );\r\n};\r\n\r\nMat3.prototype.row = function(index){\r\n  var m = this.m;\r\n  \r\n  return new Vec3( m[index][0], m[index][1], m[index][2] );\r\n};\r\n\r\nmodule.exports = POS;","module.exports = {\n  CV: require('./src/cv'),\n  AR: require('./src/aruco'),\n  SVD: require('./src/svd'),\n  POS1: require('./src/posit1'),\n  POS2: require('./src/posit2')\n}","import { AR } from 'js-aruco'\r\nimport { canonicalRimTargets, computeHomographyDLT, rmsError, type Homography, type Point } from './vision'\r\n\r\nexport type MarkerKey = 'top' | 'right' | 'bottom' | 'left'\r\n\r\nexport const MARKER_ORDER: MarkerKey[] = ['top', 'right', 'bottom', 'left']\r\n\r\nexport const MARKER_TARGETS: Record<MarkerKey, number> = {\r\n  top: 0,\r\n  right: 1,\r\n  bottom: 2,\r\n  left: 3,\r\n}\r\n\r\nexport type MarkerDetection = {\r\n  success: boolean\r\n  points: Point[]\r\n  missing: MarkerKey[]\r\n  markersFound: Array<{ id: number; center: Point }>\r\n  assignments: Partial<Record<MarkerKey, { id: number; center: Point }>>\r\n  homography: Homography | null\r\n  errorPx: number | null\r\n  message?: string\r\n}\r\n\r\nlet detector: AR.Detector | null = null\r\n\r\nfunction ensureDetector() {\r\n  if (!detector) detector = new AR.Detector()\r\n  return detector\r\n}\r\n\r\nfunction centerFromCorners(corners: { x: number; y: number }[]): Point {\r\n  const acc = corners.reduce((sum, corner) => ({ x: sum.x + corner.x, y: sum.y + corner.y }), { x: 0, y: 0 })\r\n  const count = corners.length || 1\r\n  return { x: acc.x / count, y: acc.y / count }\r\n}\r\n\r\nexport function detectMarkersFromImage(image: ImageData): MarkerDetection {\r\n  try {\r\n    const det = ensureDetector()\r\n    const markers = det.detect(image) || []\r\n    const assignments: Partial<Record<MarkerKey, { id: number; center: Point }>> = {}\r\n    const found: Array<{ id: number; center: Point }> = []\r\n    for (const marker of markers) {\r\n      const center = centerFromCorners(marker.corners)\r\n      found.push({ id: marker.id, center })\r\n      const key = (Object.keys(MARKER_TARGETS) as MarkerKey[]).find(k => MARKER_TARGETS[k] === marker.id)\r\n      if (key) assignments[key] = { id: marker.id, center }\r\n    }\r\n    const missing = (Object.keys(MARKER_TARGETS) as MarkerKey[]).filter(k => !assignments[k])\r\n    if (missing.length > 0) {\r\n      return {\r\n        success: false,\r\n        points: [],\r\n        missing,\r\n        markersFound: found,\r\n        assignments,\r\n        homography: null,\r\n        errorPx: null,\r\n        message: 'Not all calibration markers were detected.',\r\n      }\r\n    }\r\n    const dst = [assignments.top!.center, assignments.right!.center, assignments.bottom!.center, assignments.left!.center]\r\n    const src = canonicalRimTargets()\r\n    const H = computeHomographyDLT(src, dst)\r\n    const error = rmsError(H, src, dst)\r\n    return {\r\n      success: true,\r\n      points: dst,\r\n      missing: [],\r\n      markersFound: found,\r\n      assignments,\r\n      homography: H,\r\n      errorPx: error,\r\n    }\r\n  } catch (err) {\r\n    return {\r\n      success: false,\r\n      points: [],\r\n      missing: (Object.keys(MARKER_TARGETS) as MarkerKey[]),\r\n      markersFound: [],\r\n      assignments: {},\r\n      homography: null,\r\n      errorPx: null,\r\n      message: err instanceof Error ? err.message : 'Marker detection failed',\r\n    }\r\n  }\r\n}\r\n\r\nexport function detectMarkersFromCanvas(canvas: HTMLCanvasElement): MarkerDetection {\r\n  const ctx = canvas.getContext('2d')\r\n  if (!ctx) {\r\n    return {\r\n      success: false,\r\n      points: [],\r\n      missing: (Object.keys(MARKER_TARGETS) as MarkerKey[]),\r\n      markersFound: [],\r\n      assignments: {},\r\n      homography: null,\r\n      errorPx: null,\r\n      message: 'Canvas context unavailable for marker detection.',\r\n    }\r\n  }\r\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\r\n  return detectMarkersFromImage(imageData)\r\n}\r\n\r\nconst ROW_PATTERNS: Record<string, number[]> = {\r\n  '0,0': [1, 0, 0, 0, 0],\r\n  '0,1': [1, 0, 1, 1, 1],\r\n  '1,0': [0, 1, 0, 0, 1],\r\n  '1,1': [0, 1, 1, 1, 0],\r\n}\r\n\r\nexport function markerIdToMatrix(id: number): number[][] {\r\n  const rows: number[][] = new Array(5)\r\n  let bits = id >>> 0\r\n  for (let row = 4; row >= 0; row--) {\r\n    const bit3 = bits & 1; bits >>= 1\r\n    const bit1 = bits & 1; bits >>= 1\r\n    const pattern = ROW_PATTERNS[`${bit1},${bit3}`]\r\n    if (!pattern) throw new Error(`Unsupported marker id pattern for row ${row}`)\r\n    rows[row] = pattern.slice()\r\n  }\r\n  const matrix = Array.from({ length: 7 }, () => new Array(7).fill(0))\r\n  for (let y = 0; y < 5; y++) {\r\n    for (let x = 0; x < 5; x++) {\r\n      matrix[y + 1][x + 1] = rows[y][x]\r\n    }\r\n  }\r\n  return matrix\r\n}\r\n","/**\r\n * Network device discovery utilities for wifi scoring devices\r\n */\r\n\r\n// Web Serial API types\r\ndeclare global {\r\n  interface Navigator {\r\n    serial: Serial;\r\n  }\r\n  interface Serial extends EventTarget {\r\n    getPorts(): Promise<SerialPort[]>;\r\n    requestPort(options?: SerialOptions): Promise<SerialPort>;\r\n  }\r\n  interface SerialPort {\r\n    open(options: SerialOptions): Promise<void>;\r\n    close(): Promise<void>;\r\n    readable: ReadableStream<Uint8Array> | null;\r\n    writable: WritableStream<Uint8Array> | null;\r\n  }\r\n  interface SerialOptions {\r\n    baudRate?: number;\r\n    dataBits?: number;\r\n    stopBits?: number;\r\n    parity?: 'none' | 'even' | 'odd';\r\n    bufferSize?: number;\r\n    flowControl?: 'none' | 'hardware';\r\n  }\r\n}\r\n\r\nexport interface NetworkDevice {\r\n  id: string;\r\n  name: string;\r\n  ip: string;\r\n  port: number;\r\n  type: 'omni' | 'vert' | 'generic';\r\n  capabilities: string[];\r\n  status: 'online' | 'offline' | 'connecting';\r\n  connectionType: 'wifi' | 'usb';\r\n}\r\n\r\n/**\r\n * USB device interface for serial-connected scoring devices\r\n */\r\nexport interface USBDevice {\r\n  id: string;\r\n  name: string;\r\n  type: 'omni' | 'vert' | 'generic';\r\n  capabilities: string[];\r\n  status: 'online' | 'offline' | 'connecting';\r\n  port: SerialPort | null;\r\n}\r\n\r\n/**\r\n * Discover wifi scoring devices on the local network\r\n */\r\nexport async function discoverNetworkDevices(): Promise<NetworkDevice[]> {\r\n  const devices: NetworkDevice[] = [];\r\n\r\n  try {\r\n    // Get local network info\r\n    const localIPs = await getLocalIPs();\r\n\r\n    for (const localIP of localIPs) {\r\n      // Scan common ports for dart scoring devices\r\n      const scanResults = await scanNetwork(localIP, [80, 8080, 8787, 8788, 3000, 5000]);\r\n\r\n      for (const result of scanResults) {\r\n        const device = await probeDevice(result.ip, result.port);\r\n        if (device) {\r\n          devices.push(device);\r\n        }\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Network discovery failed:', error);\r\n  }\r\n\r\n  return devices;\r\n}\r\n\r\n/**\r\n * Get local IP addresses\r\n */\r\nasync function getLocalIPs(): Promise<string[]> {\r\n  const ips: string[] = [];\r\n\r\n  try {\r\n    // Try to get local IPs via WebRTC\r\n    const pc = new RTCPeerConnection({ iceServers: [] });\r\n    pc.createDataChannel('');\r\n\r\n    const offer = await pc.createOffer();\r\n    await pc.setLocalDescription(offer);\r\n\r\n    return new Promise((resolve) => {\r\n      const timeout = setTimeout(() => {\r\n        pc.close();\r\n        resolve(ips);\r\n      }, 5000);\r\n\r\n      pc.onicecandidate = (event) => {\r\n        if (event.candidate) {\r\n          const candidate = event.candidate.candidate;\r\n          const ipMatch = candidate.match(/(\\d+\\.\\d+\\.\\d+\\.\\d+)/);\r\n          if (ipMatch && ipMatch[1] && !ips.includes(ipMatch[1])) {\r\n            const ip = ipMatch[1];\r\n            // Only include private IPs\r\n            if (isPrivateIP(ip)) {\r\n              ips.push(ip);\r\n            }\r\n          }\r\n        } else {\r\n          clearTimeout(timeout);\r\n          pc.close();\r\n          resolve(ips);\r\n        }\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to get local IPs:', error);\r\n    return ['192.168.1.0']; // fallback\r\n  }\r\n}\r\n\r\n/**\r\n * Check if IP is in private range\r\n */\r\nfunction isPrivateIP(ip: string): boolean {\r\n  const parts = ip.split('.').map(Number);\r\n  return (\r\n    (parts[0] === 10) ||\r\n    (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) ||\r\n    (parts[0] === 192 && parts[1] === 168)\r\n  );\r\n}\r\n\r\n/**\r\n * Scan network for open ports\r\n */\r\nasync function scanNetwork(localIP: string, ports: number[]): Promise<{ip: string, port: number}[]> {\r\n  const results: {ip: string, port: number}[] = [];\r\n  const baseIP = localIP.split('.').slice(0, 3).join('.');\r\n\r\n  // Scan a reasonable range (e.g., .1 to .254)\r\n  const promises = [];\r\n  for (let i = 1; i <= 254; i++) {\r\n    const ip = `${baseIP}.${i}`;\r\n    for (const port of ports) {\r\n      promises.push(checkPort(ip, port));\r\n    }\r\n  }\r\n\r\n  const portResults = await Promise.allSettled(promises);\r\n\r\n  portResults.forEach((result, index) => {\r\n    if (result.status === 'fulfilled' && result.value) {\r\n      const portIndex = index % ports.length;\r\n      const ipIndex = Math.floor(index / ports.length);\r\n      const ip = `${baseIP}.${ipIndex + 1}`;\r\n      results.push({ ip, port: ports[portIndex] });\r\n    }\r\n  });\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Check if a specific port is open on an IP\r\n */\r\nasync function checkPort(ip: string, port: number): Promise<boolean> {\r\n  try {\r\n    const response = await fetch(`http://${ip}:${port}/`, {\r\n      method: 'HEAD',\r\n      mode: 'no-cors',\r\n      signal: AbortSignal.timeout(2000)\r\n    });\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Probe a device to identify its type and capabilities\r\n */\r\nasync function probeDevice(ip: string, port: number): Promise<NetworkDevice | null> {\r\n  try {\r\n    // Try common endpoints for dart scoring devices\r\n    const endpoints = [\r\n      '/',\r\n      '/api/info',\r\n      '/api/status',\r\n      '/camera',\r\n      '/stream'\r\n    ];\r\n\r\n    for (const endpoint of endpoints) {\r\n      try {\r\n        const response = await fetch(`http://${ip}:${port}${endpoint}`, {\r\n          method: 'GET',\r\n          signal: AbortSignal.timeout(3000)\r\n        });\r\n\r\n        if (response.ok) {\r\n          const contentType = response.headers.get('content-type') || '';\r\n          const text = await response.text();\r\n\r\n          // Check for OMNI device\r\n          if (text.includes('OMNI') || text.includes('omni') || endpoint.includes('omni')) {\r\n            return {\r\n              id: `omni-${ip}-${port}`,\r\n              name: `OMNI Camera (${ip})`,\r\n              ip,\r\n              port,\r\n              type: 'omni',\r\n              capabilities: ['video', 'calibration'],\r\n              status: 'online',\r\n              connectionType: 'wifi'\r\n            };\r\n          }\r\n\r\n          // Check for VERT device\r\n          if (text.includes('VERT') || text.includes('vert') || endpoint.includes('vert')) {\r\n            return {\r\n              id: `vert-${ip}-${port}`,\r\n              name: `VERT Camera (${ip})`,\r\n              ip,\r\n              port,\r\n              type: 'vert',\r\n              capabilities: ['video', 'calibration'],\r\n              status: 'online',\r\n              connectionType: 'wifi'\r\n            };\r\n          }\r\n\r\n          // Check for generic video streaming device\r\n          if (contentType.includes('video') || text.includes('stream') || endpoint === '/stream') {\r\n            return {\r\n              id: `generic-${ip}-${port}`,\r\n              name: `Network Camera (${ip})`,\r\n              ip,\r\n              port,\r\n              type: 'generic',\r\n              capabilities: ['video'],\r\n              status: 'online',\r\n              connectionType: 'wifi'\r\n            };\r\n          }\r\n        }\r\n      } catch {\r\n        // Continue to next endpoint\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error(`Failed to probe device ${ip}:${port}:`, error);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Discover USB scoring devices connected via serial\r\n */\r\nexport async function discoverUSBDevices(): Promise<USBDevice[]> {\r\n  const devices: USBDevice[] = [];\r\n\r\n  try {\r\n    // Check if Web Serial API is supported\r\n    if (!('serial' in navigator)) {\r\n      console.warn('Web Serial API not supported in this browser');\r\n      return devices;\r\n    }\r\n\r\n    // Get already paired ports\r\n    const ports = await navigator.serial.getPorts();\r\n\r\n    for (const port of ports) {\r\n      const device = await probeUSBDevice(port);\r\n      if (device) {\r\n        devices.push(device);\r\n      }\r\n    }\r\n\r\n    // Also try to request a new port (this will show user selection dialog)\r\n    // Note: This is optional and will be handled separately in the UI\r\n  } catch (error) {\r\n    console.error('USB device discovery failed:', error);\r\n  }\r\n\r\n  return devices;\r\n}\r\n\r\n/**\r\n * Request user to select a USB device\r\n */\r\nexport async function requestUSBDevice(): Promise<USBDevice | null> {\r\n  try {\r\n    if (!('serial' in navigator)) {\r\n      alert('Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge.');\r\n      return null;\r\n    }\r\n\r\n    const port = await navigator.serial.requestPort();\r\n    return await probeUSBDevice(port);\r\n  } catch (error) {\r\n    if ((error as any).name !== 'NotFoundError') {\r\n      console.error('USB device request failed:', error);\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Probe a USB serial port to identify the device type\r\n */\r\nasync function probeUSBDevice(port: SerialPort): Promise<USBDevice | null> {\r\n  try {\r\n    // Open the port with common settings for dart scoring devices\r\n    await port.open({ baudRate: 9600, dataBits: 8, stopBits: 1, parity: 'none' });\r\n\r\n    // Try to read some data to identify the device\r\n    const reader = port.readable?.getReader();\r\n    if (reader) {\r\n      try {\r\n        // Set a timeout for reading\r\n        const timeout = setTimeout(() => reader.cancel(), 2000);\r\n\r\n        const { value, done } = await reader.read();\r\n        clearTimeout(timeout);\r\n\r\n        if (!done && value) {\r\n          const text = new TextDecoder().decode(value);\r\n\r\n          // Check for OMNI device\r\n          if (text.includes('OMNI') || text.includes('omni')) {\r\n            reader.releaseLock();\r\n            return {\r\n              id: `usb-omni-${Date.now()}`,\r\n              name: 'OMNI Camera (USB)',\r\n              type: 'omni',\r\n              capabilities: ['video', 'calibration'],\r\n              status: 'online',\r\n              port\r\n            };\r\n          }\r\n\r\n          // Check for VERT device\r\n          if (text.includes('VERT') || text.includes('vert')) {\r\n            reader.releaseLock();\r\n            return {\r\n              id: `usb-vert-${Date.now()}`,\r\n              name: 'VERT Camera (USB)',\r\n              type: 'vert',\r\n              capabilities: ['video', 'calibration'],\r\n              status: 'online',\r\n              port\r\n            };\r\n          }\r\n        }\r\n      } catch {\r\n        // Continue\r\n      } finally {\r\n        try { reader.releaseLock(); } catch {}\r\n      }\r\n    }\r\n\r\n    // If we can't identify, assume it's a generic device\r\n    return {\r\n      id: `usb-generic-${Date.now()}`,\r\n      name: 'USB Scoring Device',\r\n      type: 'generic',\r\n      capabilities: ['video'],\r\n      status: 'online',\r\n      port\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('Failed to probe USB device:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Connect to a network device and get video stream\r\n */\r\nexport async function connectToNetworkDevice(device: NetworkDevice): Promise<MediaStream | null> {\r\n  try {\r\n    // For now, assume devices provide an MJPEG or HLS stream\r\n    // This would need to be adapted based on the actual device API\r\n    const streamUrl = `http://${device.ip}:${device.port}/stream`;\r\n\r\n    // Create a video element to capture the stream\r\n    const video = document.createElement('video');\r\n    video.src = streamUrl;\r\n    video.crossOrigin = 'anonymous';\r\n\r\n    return new Promise((resolve, reject) => {\r\n      video.onloadeddata = () => {\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d')!;\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n\r\n        // Create a MediaStream from the video\r\n        const stream = canvas.captureStream(30); // 30 FPS\r\n\r\n        const drawFrame = () => {\r\n          if (video.readyState >= 2) {\r\n            ctx.drawImage(video, 0, 0);\r\n          }\r\n          requestAnimationFrame(drawFrame);\r\n        };\r\n        drawFrame();\r\n\r\n        resolve(stream);\r\n      };\r\n\r\n      video.onerror = () => reject(new Error('Failed to load video stream'));\r\n      video.load();\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to connect to network device:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Connect to a USB device and get video stream\r\n */\r\nexport async function connectToUSBDevice(device: USBDevice): Promise<MediaStream | null> {\r\n  try {\r\n    if (!device.port) {\r\n      throw new Error('No serial port available');\r\n    }\r\n\r\n    // For USB devices, we assume they provide video through a companion app or driver\r\n    // This is a placeholder - actual implementation would depend on the device protocol\r\n    console.log('USB device connection not fully implemented yet');\r\n    return null;\r\n\r\n  } catch (error) {\r\n    console.error('Failed to connect to USB device:', error);\r\n    return null;\r\n  }\r\n}","import React, { useCallback, useEffect, useMemo, useRef, useState, type ReactNode } from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport DartLoader from './DartLoader'\r\n\r\nimport QRCode from 'qrcode'\r\nimport { useCalibration } from '../store/calibration'\r\nimport { BoardRadii, canonicalRimTargets, computeHomographyDLT, drawCross, drawPolyline, rmsError, sampleRing, refinePointsSobel, type Homography, type Point } from '../utils/vision'\r\nimport { detectMarkersFromCanvas, MARKER_ORDER, MARKER_TARGETS, markerIdToMatrix, type MarkerDetection } from '../utils/markerCalibration'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { discoverNetworkDevices, connectToNetworkDevice, type NetworkDevice } from '../utils/networkDevices'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype Phase = 'idle' | 'camera' | 'capture' | 'select' | 'computed'\r\ntype CamMode = 'local' | 'phone' | 'wifi'\r\n\r\nexport default function Calibrator() {\r\n\tconst videoRef = useRef<HTMLVideoElement>(null)\r\n\tconst canvasRef = useRef<HTMLCanvasElement>(null)\r\n\tconst overlayRef = useRef<HTMLCanvasElement>(null)\r\n\tconst fileInputRef = useRef<HTMLInputElement>(null)\r\n\tconst [streaming, setStreaming] = useState(false)\r\n\tconst [videoPlayBlocked, setVideoPlayBlocked] = useState(false)\r\n\tconst [phase, setPhase] = useState<Phase>('camera')\r\n\t// Default to local or last-used mode, but allow user to freely change\r\n\tconst [mode, setMode] = useState<CamMode>(() => (localStorage.getItem('ndn:cal:mode') as CamMode) || 'local')\r\n\tconst [dstPoints, setDstPoints] = useState<Point[]>([]) // image points clicked in order TOP, RIGHT, BOTTOM, LEFT\r\n\tconst [snapshotSet, setSnapshotSet] = useState(false)\r\n\t// Track current frame (video/snapshot) size to preserve aspect ratio in the preview container\r\n\tconst [frameSize, setFrameSize] = useState<{ w: number, h: number } | null>(null)\r\n\t// Zoom for pixel-perfect point picking (0.5x – 2.0x)\r\n\tconst [zoom, setZoom] = useState<number>(1)\r\n\tconst [mobileLandingOverride, setMobileLandingOverride] = useState<boolean>(() => {\r\n\t\tif (typeof window === 'undefined') return false\r\n\t\ttry {\r\n\t\t\treturn window.localStorage.getItem('ndn:cal:forceDesktop') === '1'\r\n\t\t} catch {\r\n\t\t\treturn false\r\n\t\t}\r\n\t})\r\n\tconst [isMobileDevice, setIsMobileDevice] = useState<boolean>(() => {\r\n\t\tif (typeof navigator === 'undefined') return false\r\n\t\treturn /Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)\r\n\t})\r\n\tconst { H, setCalibration, reset, errorPx, locked } = useCalibration()\r\n\tconst { calibrationGuide, setCalibrationGuide, preferredCameraId, cameraEnabled, setCameraEnabled, preferredCameraLocked, setPreferredCameraLocked, setPreferredCamera } = useUserSettings()\r\n\t\t// Detected ring data (from auto-detect) in image pixels\r\n\tconst [detected, setDetected] = useState<null | {\r\n\t\tcx: number; cy: number;\r\n\t\tbullInner: number; bullOuter: number;\r\n\t\ttrebleInner: number; trebleOuter: number;\r\n\t\tdoubleInner: number; doubleOuter: number;\r\n\t}>(null)\r\n\t\t// Live detection and confidence state\r\n\t\tconst [liveDetect, setLiveDetect] = useState<boolean>(false)\r\n\t\tconst [confidence, setConfidence] = useState<number>(0)\r\n\tconst [markerResult, setMarkerResult] = useState<MarkerDetection | null>(null)\r\n\r\n\tconst createMarkerDataUrl = useCallback((id: number, size = 480) => {\r\n\t\tif (typeof document === 'undefined') throw new Error('Marker rendering only available in browser context')\r\n\t\tconst matrix = markerIdToMatrix(id)\r\n\t\tconst canvas = document.createElement('canvas')\r\n\t\tcanvas.width = size\r\n\t\tcanvas.height = size\r\n\t\tconst ctx = canvas.getContext('2d')\r\n\t\tif (!ctx) throw new Error('Unable to create marker canvas context')\r\n\t\tctx.imageSmoothingEnabled = false\r\n\t\tctx.fillStyle = '#ffffff'\r\n\t\tctx.fillRect(0, 0, size, size)\r\n\t\tconst padding = size * 0.08\r\n\t\tconst cells = matrix.length\r\n\t\tconst gridSize = size - padding * 2\r\n\t\tconst cellSize = gridSize / cells\r\n\t\tconst origin = padding\r\n\t\tfor (let y = 0; y < cells; y++) {\r\n\t\t\tfor (let x = 0; x < cells; x++) {\r\n\t\t\t\tconst value = matrix[y][x]\r\n\t\t\t\tctx.fillStyle = value === 1 ? '#000000' : '#ffffff'\r\n\t\t\t\tctx.fillRect(origin + x * cellSize, origin + y * cellSize, cellSize, cellSize)\r\n\t\t\t}\r\n\t\t}\r\n\t\tctx.strokeStyle = '#000000'\r\n\t\tctx.lineWidth = Math.max(2, cellSize * 0.08)\r\n\t\tctx.strokeRect(origin, origin, cellSize * cells, cellSize * cells)\r\n\t\treturn canvas.toDataURL('image/png')\r\n\t}, [])\r\n\r\n\tconst openMarkerSheet = useCallback(() => {\r\n\t\ttry {\r\n\t\t\tconst markers = MARKER_ORDER.map((key) => {\r\n\t\t\t\tconst id = MARKER_TARGETS[key]\r\n\t\t\t\treturn { key, id, dataUrl: createMarkerDataUrl(id) }\r\n\t\t\t})\r\n\t\t\tconst popup = window.open('', '_blank', 'width=900,height=1200')\r\n\t\t\tif (!popup) throw new Error('Popup blocked by browser')\r\n\t\t\tconst html = `<!DOCTYPE html>\r\n\t\t\t<html>\r\n\t\t\t<head>\r\n\t\t\t\t<meta charset=\"utf-8\" />\r\n\t\t\t\t<title>Nine Dart Nation – Marker Sheet</title>\r\n\t\t\t\t<style>\r\n\t\t\t\t\tbody { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 24px; color: #0f172a; }\r\n\t\t\t\t\th1 { font-size: 20px; margin-bottom: 4px; }\r\n\t\t\t\t\tp { margin-top: 0; opacity: 0.7; }\r\n\t\t\t\t\t.grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 32px; margin-top: 24px; }\r\n\t\t\t\t\t.marker { text-align: center; }\r\n\t\t\t\t\t.marker h2 { font-size: 16px; margin: 12px 0 8px; }\r\n\t\t\t\t\t.marker img { width: 100%; max-width: 360px; border: 1px solid #0f172a; }\r\n\t\t\t\t\tfooter { margin-top: 24px; font-size: 12px; opacity: 0.6; }\r\n\t\t\t\t</style>\r\n\t\t\t</head>\r\n\t\t\t<body>\r\n\t\t\t\t<h1>Marker sheet</h1>\r\n\t\t\t\t<p>Print at 100% scale on letter/A4 paper. Cut out and tape each marker so it is flush with the outer double ring.</p>\r\n\t\t\t\t<div class=\"grid\">\r\n\t\t\t\t\t${markers.map((m) => `\r\n\t\t\t\t\t\t<div class=\"marker\">\r\n\t\t\t\t\t\t\t<h2>${m.key.toUpperCase()} • ID ${m.id}</h2>\r\n\t\t\t\t\t\t\t<img src=\"${m.dataUrl}\" alt=\"Marker ${m.key}\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t`).join('')}\r\n\t\t\t\t</div>\r\n\t\t\t\t<footer>Tip: Keep markers flat, smooth, and unobstructed for best detection results.</footer>\r\n\t\t\t</body>\r\n\t\t\t</html>`\r\n\t\t\tpopup.document.write(html)\r\n\t\t\tpopup.document.close()\r\n\t\t} catch (err: any) {\r\n\t\t\tconsole.error('Marker sheet generation failed', err)\r\n\t\t\talert(`Unable to open marker sheet: ${err?.message || err}`)\r\n\t\t}\r\n\t}, [createMarkerDataUrl])\r\n\r\n\t// Phone pairing state (mirrors CameraTile)\r\n\tconst [ws, setWs] = useState<WebSocket | null>(null)\r\n\tconst autoLockRef = useRef(false)\r\n\tconst [pairCode, setPairCode] = useState<string | null>(null)\r\n\tconst pairCodeRef = useRef<string | null>(null)\r\n\tconst updatePairCode = useCallback((code: string | null) => {\r\n\t\tpairCodeRef.current = code\r\n\t\tsetPairCode(code)\r\n\t}, [setPairCode])\r\n\tconst [expiresAt, setExpiresAt] = useState<number | null>(null)\r\n\tconst [now, setNow] = useState<number>(Date.now())\r\n\tconst [paired, setPaired] = useState<boolean>(false)\r\n\tconst pcRef = useRef<RTCPeerConnection | null>(null)\r\n\tconst [qrDataUrl, setQrDataUrl] = useState<string>('')\r\n\tconst [lanHost, setLanHost] = useState<string | null>(null)\r\n\tconst [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null)\r\n\tconst [showTips, setShowTips] = useState<boolean>(true)\r\n\tconst [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([])\r\n\tconst [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false)\r\n\tconst [copyFeedback, setCopyFeedback] = useState<'link' | 'code' | null>(null)\r\n\tconst copyTimeoutRef = useRef<number | null>(null)\r\n\tuseEffect(() => {\r\n\t\tconst h = window.location.hostname\r\n\t\tif (h === 'localhost' || h === '127.0.0.1') {\r\n\t\t\tapiFetch(`/api/hosts`).then(r => r.json()).then(j => {\r\n\t\t\t\tconst ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x)\r\n\t\t\t\tif (ip) setLanHost(ip)\r\n\t\t\t}).catch(()=>{})\r\n\t\t}\r\n\t\t// Try to detect if server exposes HTTPS info\r\n\t\tapiFetch(`/api/https-info`).then(r=>r.json()).then(j=>{\r\n\t\t\tif (j && typeof j.https === 'boolean') setHttpsInfo({ https: !!j.https, port: Number(j.port)||8788 })\r\n\t\t}).catch(()=>{})\r\n\t}, [])\r\n\r\n\t// Remove automatic phone pairing on mode change; only pair on explicit user action\r\n\tconst mobileUrl = useMemo(() => {\r\n\t\tconst code = pairCode || '____'\r\n\t\t// Prefer configured WS host (Render) when available to build the correct server origin\r\n\t\tconst envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n\t\tif (envUrl && envUrl.length > 0) {\r\n\t\t\ttry {\r\n\t\t\t\tconst u = new URL(envUrl)\r\n\t\t\t\tconst isSecure = u.protocol === 'wss:'\r\n\t\t\t\tconst origin = `${isSecure ? 'https' : 'http'}://${u.host}${u.pathname.endsWith('/ws') ? '' : u.pathname}`\r\n\t\t\t\tconst base = origin.replace(/\\/?ws$/i, '')\r\n\t\t\t\treturn `${base}/mobile-cam.html?code=${code}`\r\n\t\t\t} catch {}\r\n\t\t}\r\n\t\t// Local dev fallback using detected LAN or current host\r\n\t\tconst host = (lanHost || window.location.hostname)\r\n\t\tconst useHttps = !!httpsInfo?.https\r\n\t\tconst port = useHttps ? (httpsInfo?.port || 8788) : 8787\r\n\t\tconst proto = useHttps ? 'https' : 'http'\r\n\t\treturn `${proto}://${host}:${port}/mobile-cam.html?code=${code}`\r\n\t}, [pairCode, lanHost, httpsInfo])\r\n\r\n\tconst mobileLandingLink = useMemo(() => {\r\n\t\tif (!mobileUrl) return null\r\n\t\ttry {\r\n\t\t\tconst url = new URL(mobileUrl)\r\n\t\t\turl.searchParams.delete('code')\r\n\t\t\treturn url.toString().replace(/\\?$/, '')\r\n\t\t} catch {\r\n\t\t\tif (typeof window !== 'undefined') {\r\n\t\t\t\tconst origin = window.location.origin.replace(/\\/$/, '')\r\n\t\t\t\treturn `${origin}/mobile-cam.html`\r\n\t\t\t}\r\n\t\t\treturn '/mobile-cam.html'\r\n\t\t}\r\n\t}, [mobileUrl])\r\n\r\n\tuseEffect(() => { localStorage.setItem('ndn:cal:mode', mode) }, [mode])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (typeof window === 'undefined') return\r\n\t\ttry {\r\n\t\t\tif (mobileLandingOverride) {\r\n\t\t\t\twindow.localStorage.setItem('ndn:cal:forceDesktop', '1')\r\n\t\t\t} else {\r\n\t\t\t\twindow.localStorage.removeItem('ndn:cal:forceDesktop')\r\n\t\t\t}\r\n\t\t} catch {}\r\n\t}, [mobileLandingOverride])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (typeof window === 'undefined') return\r\n\t\tconst coarseQuery = window.matchMedia('(pointer: coarse)')\r\n\t\tconst detect = () => {\r\n\t\t\tconst uaMobile = typeof navigator !== 'undefined' && /Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)\r\n\t\t\tconst coarse = typeof coarseQuery.matches === 'boolean' ? coarseQuery.matches : false\r\n\t\t\tconst narrow = window.innerWidth <= 820\r\n\t\t\tsetIsMobileDevice(uaMobile || coarse || narrow)\r\n\t\t}\r\n\t\tdetect()\r\n\t\ttry {\r\n\t\t\tif (typeof coarseQuery.addEventListener === 'function') coarseQuery.addEventListener('change', detect)\r\n\t\t\telse if (typeof coarseQuery.addListener === 'function') coarseQuery.addListener(detect)\r\n\t\t} catch {}\r\n\t\twindow.addEventListener('resize', detect)\r\n\t\treturn () => {\r\n\t\t\ttry {\r\n\t\t\t\tif (typeof coarseQuery.removeEventListener === 'function') coarseQuery.removeEventListener('change', detect)\r\n\t\t\t\telse if (typeof coarseQuery.removeListener === 'function') coarseQuery.removeListener(detect)\r\n\t\t\t} catch {}\r\n\t\t\twindow.removeEventListener('resize', detect)\r\n\t\t}\r\n\t}, [])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!pairCode) { setQrDataUrl(''); return }\r\n\t\tQRCode.toDataURL(mobileUrl, { width: 160, margin: 1, color: { dark: '#000000', light: '#ffffff' } })\r\n\t\t\t.then(setQrDataUrl)\r\n\t\t\t.catch(() => setQrDataUrl(''))\r\n\t}, [mobileUrl, pairCode])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!expiresAt) return\r\n\t\tconst t = setInterval(() => setNow(Date.now()), 1000)\r\n\t\treturn () => clearInterval(t)\r\n\t}, [expiresAt])\r\n\tconst ttl = useMemo(() => expiresAt ? Math.max(0, Math.ceil((expiresAt - now)/1000)) : null, [expiresAt, now])\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tif (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n\t\t}\r\n\t}, [])\r\n\r\n\tconst copyValue = useCallback(async (value: string | null | undefined, type: 'link' | 'code') => {\r\n\t\tif (!value) return\r\n\t\ttry {\r\n\t\t\tif (navigator.clipboard && navigator.clipboard.writeText) {\r\n\t\t\t\tawait navigator.clipboard.writeText(value)\r\n\t\t\t} else {\r\n\t\t\t\tconst textarea = document.createElement('textarea')\r\n\t\t\t\ttextarea.value = value\r\n\t\t\t\ttextarea.style.position = 'fixed'\r\n\t\t\t\ttextarea.style.opacity = '0'\r\n\t\t\t\tdocument.body.appendChild(textarea)\r\n\t\t\t\ttextarea.focus()\r\n\t\t\t\ttextarea.select()\r\n\t\t\t\tdocument.execCommand('copy')\r\n\t\t\t\tdocument.body.removeChild(textarea)\r\n\t\t\t}\r\n\t\t\tsetCopyFeedback(type)\r\n\t\t\tif (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n\t\t\tcopyTimeoutRef.current = window.setTimeout(() => setCopyFeedback(null), 1500)\r\n\t\t} catch (err) {\r\n\t\t\tconsole.warn('[Calibrator] Copy failed:', err)\r\n\t\t\tsetCopyFeedback(null)\r\n\t\t}\r\n\t}, [])\r\n\t// Removed automatic regeneration of code when ttl expires. Only regenerate on explicit user action.\r\n\r\n\tuseEffect(() => {\r\n\t\treturn () => stopCamera()\r\n\t}, [])\r\n\r\n\t// Remove automatic camera restart on preferredCameraId change to prevent flicker\r\n\r\n\tfunction ensureWS() {\r\n\t\tif (ws && ws.readyState === WebSocket.OPEN) return ws\r\n\t\t// Prefer configured WS endpoint; normalize to include '/ws'. Fallback to same-origin '/ws'.\r\n\t\t\tconst envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n\t\t\tconst normalizedEnv = envUrl && envUrl.length > 0\r\n\t\t\t\t? (envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws')\r\n\t\t\t\t: undefined\r\n\t\t\tconst proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n\t\t\tconst sameOrigin = `${proto}://${window.location.host}/ws`\r\n\t\t\tconst host = window.location.hostname\r\n\t\t\t// Production safeguard: if we are not on the Render backend host and no env URL is set,\r\n\t\t\t// prefer the known Render service as a fallback instead of Netlify same-origin.\r\n\t\t\tconst renderWS = `wss://ninedartnation.onrender.com/ws`\r\n\t\t\tconst url = normalizedEnv || (host.endsWith('onrender.com') ? sameOrigin : renderWS)\r\n\t\t\tconsole.log('[Calibrator] Connecting WebSocket to:', url)\r\n\t\t\tlet socket: WebSocket = new WebSocket(url)\r\n\t\tsetWs(socket)\r\n\t\treturn socket\r\n\t}\r\n\r\n\tasync function startPhonePairing() {\r\n\t\t// Do not reset paired/streaming/phase state here to keep UI static\r\n\t\t// Switch UI into phone pairing mode so the calibrator shows phone-specific hints\r\n\t\tsetMode('phone')\r\n\t\t// Lock selection and ensure camera UI is enabled while pairing is active\r\n\t\tlockSelectionForPairing()\r\n\t\ttry { setCameraEnabled(true) } catch {}\r\n\t\tconst socket = ensureWS()\r\n\t\tif (socket.readyState === WebSocket.OPEN) {\r\n\t\t\tsocket.send(JSON.stringify({ type: 'cam-create' }))\r\n\t\t} else {\r\n\t\t\tsocket.onopen = () => socket.send(JSON.stringify({ type: 'cam-create' }))\r\n\t\t}\r\n\t\tsocket.onerror = (error) => {\r\n\t\t\tconsole.error('WebSocket connection error:', error)\r\n\t\t\talert('Failed to connect to camera pairing service. Please check your internet connection and try again.')\r\n\t\t}\r\n\t\tsocket.onclose = (event) => {\r\n\t\t\tconsole.log('WebSocket closed:', event.code, event.reason)\r\n\t\t\tif (pcRef.current) {\r\n\t\t\t\ttry { pcRef.current.close() } catch {}\r\n\t\t\t\tpcRef.current = null\r\n\t\t\t}\r\n\t\t\tupdatePairCode(null)\r\n\t\t\t// Only show alert if it wasn't a clean close\r\n\t\t\tif (event.code !== 1000) {\r\n\t\t\t\talert('Camera pairing connection lost. Please try pairing again.')\r\n\t\t\t}\r\n\t\t}\r\n\t\tsocket.onmessage = async (ev) => {\r\n\t\t\tconst data = JSON.parse(ev.data)\r\n\t\t\tif (data.type === 'cam-code') {\r\n\t\t\t\tupdatePairCode(data.code)\r\n\t\t\t\tif (data.expiresAt) setExpiresAt(data.expiresAt)\r\n\t\t\t} else if (data.type === 'cam-peer-joined') {\r\n\t\t\t\t// Ensure we have the latest pairing code even if messages arrive out of order\r\n\t\t\t\tif (!pairCodeRef.current && data.code) updatePairCode(data.code)\r\n\t\t\t\tsetPaired(true)\r\n\t\t\t\t// When a phone peer joins, proactively send current calibration (if locked)\r\n\t\t\t\tconst codeForSession = pairCodeRef.current || data.code || null\r\n\t\t\t\tif (codeForSession) pairCodeRef.current = codeForSession\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (locked && codeForSession) {\r\n\t\t\t\t\t\tconst imgSize = canvasRef.current ? { w: canvasRef.current.width, h: canvasRef.current.height } : null\r\n\t\t\t\t\t\tconst payload = { H, imageSize: imgSize, errorPx: (errorPx ?? null), createdAt: Date.now() }\r\n\t\t\t\t\t\tsocket.send(JSON.stringify({ type: 'cam-calibration', code: codeForSession, payload }))\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Sent calibration to joined phone for code', codeForSession)\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.warn('[Calibrator] Failed to send calibration on peer join', e)\r\n\t\t\t\t}\r\n\t\t\t\tconst peer = new RTCPeerConnection({ \r\n\t\t\t\t\ticeServers: [{ urls: 'stun:stun.l.google.com:19302' }],\r\n\t\t\t\t\ticeCandidatePoolSize: 10\r\n\t\t\t\t})\r\n\t\t\t\tpcRef.current = peer\r\n\t\t\t\t\r\n\t\t\t\t// Add connection state monitoring\r\n\t\t\t\tpeer.onconnectionstatechange = () => {\r\n\t\t\t\t\tconsole.log('WebRTC connection state:', peer.connectionState)\r\n\t\t\t\t\tif (peer.connectionState === 'failed' || peer.connectionState === 'disconnected') {\r\n\t\t\t\t\t\tconsole.error('WebRTC connection failed')\r\n\t\t\t\t\t\talert('Camera connection lost. Please try pairing again.')\r\n\t\t\t\t\t\tstopCamera()\r\n\t\t\t\t\t} else if (peer.connectionState === 'connected') {\r\n\t\t\t\t\t\tconsole.log('WebRTC connection established')\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tpeer.onicecandidate = (e) => {\r\n\t\t\t\t\tif (e.candidate && codeForSession) {\r\n\t\t\t\t\t\tsocket.send(JSON.stringify({ type: 'cam-ice', code: codeForSession, payload: e.candidate }))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\tpeer.ontrack = (ev) => {\r\n\t\t\t\tconsole.log('[Calibrator] WebRTC ontrack received:', ev.streams?.length, 'streams, track kind:', ev.track?.kind)\r\n\t\t\t\tif (videoRef.current) {\r\n\t\t\t\t\tconst inbound = ev.streams?.[0]\r\n\t\t\t\t\tif (inbound) {\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Assigning video stream (tracks:', inbound.getTracks().length, ') to video element')\r\n\t\t\t\t\t\t// Ensure video element is visible\r\n\t\t\t\t\t\tsetSnapshotSet(false)\r\n\t\t\t\t\t\t// Use setTimeout to ensure DOM updates before assigning stream\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tif (videoRef.current) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('[Calibrator] Setting srcObject and attempting play')\r\n\t\t\t\t\t\t\t\t\t\tvideoRef.current.srcObject = inbound\r\n\t\t\t\t\t\t\t\t\t\tvideoRef.current.muted = true // Ensure muted for autoplay policy\r\n\t\t\t\t\t\t\t\t\t\tvideoRef.current.playsInline = true // Mobile/iOS support\r\n\t\t\t\t\t\t\t\t\t\tvideoRef.current.play().then(() => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('[Calibrator] Video playback started successfully')\r\n\t\t\t\t\t\t\t\t\t\t\t// Mark that we're streaming from the phone and transition to capture\r\n\t\t\t\t\t\t\t\t\t\t\tsetStreaming(true)\r\n\t\t\t\t\t\t\t\t\t\t\tsetPhase('capture')\r\n\t\t\t\t\t\t\t\t\t\t\t// Set user settings to reflect that the active camera is the phone\r\n\t\t\t\t\t\t\t\t\t\t\ttry { setPreferredCamera(undefined, 'Phone Camera', true) } catch {}\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (!preferredCameraLocked) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPreferredCameraLocked(true)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tautoLockRef.current = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\ttry { setCameraEnabled(true) } catch {}\r\n\t\t\t\t\t\t\t\t\t\t\t// If an overlay prompt was shown earlier, hide it now\r\n\t\t\t\t\t\t\t\t\t\t\tsetVideoPlayBlocked(false)\r\n\t\t\t\t\t\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.error('[Calibrator] Video play failed:', err)\r\n\t\t\t\t\t\t\t\t\t\t\t// Show a friendly tap-to-play overlay so user can enable playback\r\n\t\t\t\t\t\t\t\t\t\t\tsetVideoPlayBlocked(true)\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.warn('[Calibrator] video play blocked — prompting user interaction')\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, 100)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.error('[Calibrator] No inbound stream received in ontrack')\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error('[Calibrator] Video element not available')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst offer = await peer.createOffer({ offerToReceiveAudio: false, offerToReceiveVideo: true })\r\n\t\t\t\t\tawait peer.setLocalDescription(offer)\r\n\t\t\t\t\tconsole.log('[Calibrator] Sending cam-offer for code:', codeForSession)\r\n\t\t\t\t\tif (codeForSession) socket.send(JSON.stringify({ type: 'cam-offer', code: codeForSession, payload: offer }))\r\n\t\t\t\t\telse console.warn('[Calibrator] Missing pairing code when sending offer')\r\n\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error('Failed to create WebRTC offer:', err)\r\n\t\t\t\t\talert('Failed to establish camera connection. Please try again.')\r\n\t\t\t\t\tstopCamera()\r\n\t\t\t\t}\r\n\t\t\t} else if (data.type === 'cam-answer') {\r\n\t\t\t\tconsole.log('[Calibrator] Received cam-answer')\r\n\t\t\t\tconst peer = pcRef.current\r\n\t\t\t\tif (peer) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait peer.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Remote description set (answer)')\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\tconsole.error('Failed to set remote description:', err)\r\n\t\t\t\t\t\talert('Camera pairing failed. Please try again.')\r\n\t\t\t\t\t\tstopCamera()\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn('[Calibrator] Received cam-answer but no peer connection exists')\r\n\t\t\t\t}\r\n\t\t\t} else if (data.type === 'cam-ice') {\r\n\t\t\t\tconsole.log('[Calibrator] Received cam-ice')\r\n\t\t\t\tconst peer = pcRef.current\r\n\t\t\t\tif (peer) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait peer.addIceCandidate(data.payload)\r\n\t\t\t\t\t\tconsole.log('[Calibrator] ICE candidate added')\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\tconsole.error('Failed to add ICE candidate:', err)\r\n\t\t\t\t\t\t// Don't alert for ICE candidate errors as they're often non-critical\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn('[Calibrator] Received ICE candidate but no peer connection exists')\r\n\t\t\t\t}\r\n\t\t\t} else if (data.type === 'cam-error') {\r\n\t\t\t\tconsole.error('Camera pairing error:', data.code)\r\n\t\t\t\talert(data.code === 'EXPIRED' ? 'Code expired. Generate a new code.' : `Camera error: ${data.code || 'Unknown error'}`)\r\n\t\t\t\tstopCamera()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync function startWifiConnection() {\r\n\t\tsetDiscoveringWifi(true)\r\n\t\ttry {\r\n\t\t\tconst devices = await discoverNetworkDevices()\r\n\t\t\tsetWifiDevices(devices)\r\n\t\t\tif (devices.length === 0) {\r\n\t\t\t\talert('No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.')\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Wifi device discovery failed:', error)\r\n\t\t\talert('Failed to discover wifi devices. Please check your network connection.')\r\n\t\t} finally {\r\n\t\t\tsetDiscoveringWifi(false)\r\n\t\t}\r\n\t\tsetPhase('camera')\r\n\t}\r\n\r\n\tasync function connectToWifiDevice(device: NetworkDevice) {\r\n\t\ttry {\r\n\t\t\tsetWifiDevices(devices => devices.map(d => \r\n\t\t\t\td.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n\t\t\t))\r\n\r\n\t\t\tconst stream = await connectToNetworkDevice(device)\r\n\t\t\tif (stream && videoRef.current) {\r\n\t\t\t\tvideoRef.current.srcObject = stream\r\n\t\t\t\tawait videoRef.current.play()\r\n\t\t\t\tsetStreaming(true)\r\n\t\t\t\tsetPhase('capture')\r\n\t\t\t\tsetWifiDevices(devices => devices.map(d => \r\n\t\t\t\t\td.id === device.id ? { ...d, status: 'online' as const } : d\r\n\t\t\t\t))\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('Failed to get video stream')\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to connect to wifi device:', error)\r\n\t\t\talert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n\t\t\tsetWifiDevices(devices => devices.map(d => \r\n\t\t\t\td.id === device.id ? { ...d, status: 'offline' as const } : d\r\n\t\t\t))\r\n\t\t}\r\n\t}\r\n\r\n\tasync function startCamera() {\r\n\t\tif (mode === 'phone') return startPhonePairing()\r\n\t\tif (mode === 'wifi') return startWifiConnection()\r\n\t\ttry {\r\n\t\t\tconsole.log('[Calibrator] Attempting camera access...')\r\n\t\t\tconst constraints: MediaStreamConstraints = {\r\n\t\t\t\tvideo: preferredCameraId ? { deviceId: { exact: preferredCameraId } } : { facingMode: 'environment' },\r\n\t\t\t\taudio: false\r\n\t\t\t}\r\n\t\t\tconsole.log('[Calibrator] Camera constraints:', constraints)\r\n\t\t\tlet stream: MediaStream\r\n\t\t\ttry {\r\n\t\t\t\tstream = await navigator.mediaDevices.getUserMedia(constraints)\r\n\t\t\t\tconsole.log('[Calibrator] Camera stream obtained:', stream)\r\n\t\t\t} catch (err: any) {\r\n\t\t\t\tconst name = (err && (err.name || err.code)) || ''\r\n\t\t\t\tconsole.warn('[Calibrator] Preferred camera not available:', err)\r\n\t\t\t\tif (preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError' || name === 'NotAllowedError')) {\r\n\t\t\t\t\tstream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false })\r\n\t\t\t\t\tconsole.log('[Calibrator] Fallback camera stream obtained:', stream)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow err\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (videoRef.current) {\r\n\t\t\t\tvideoRef.current.srcObject = stream\r\n\t\t\t\tawait videoRef.current.play()\r\n\t\t\t\tconsole.log('[Calibrator] Video playback started')\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('[Calibrator] videoRef.current is null')\r\n\t\t\t}\r\n\t\t\tsetStreaming(true)\r\n\t\t\tsetPhase('capture')\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('[Calibrator] Camera access failed:', e)\r\n\t\t\talert(`Camera access failed: ${e instanceof Error ? e.message : 'Unknown error'}. Try refreshing the page or check camera permissions.`)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction stopCamera() {\r\n\t\tif (videoRef.current && videoRef.current.srcObject) {\r\n\t\t\tconst tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n\t\t\ttracks.forEach(t => t.stop())\r\n\t\t\tvideoRef.current.srcObject = null\r\n\t\t\tsetStreaming(false)\r\n\t\t}\r\n\t\tif (pcRef.current) { try { pcRef.current.close() } catch {}; pcRef.current = null }\r\n\t\tupdatePairCode(null)\r\n\t\tsetExpiresAt(null)\r\n\t\tsetPaired(false)\r\n\t\tsetMarkerResult(null)\r\n\t    // Unlock preferred camera selection only if we auto-locked it for this session\r\n\t    if (autoLockRef.current) {\r\n\t    \ttry { setPreferredCameraLocked(false) } catch {}\r\n\t    \tautoLockRef.current = false\r\n\t    }\r\n\t}\r\n\r\n\tfunction regenerateCode() {\r\n\t\t// Only regenerate code, do not reset UI or camera state\r\n\t\tif (ws && ws.readyState === WebSocket.OPEN) {\r\n\t\t\tws.send(JSON.stringify({ type: 'cam-create' }))\r\n\t\t} else {\r\n\t\t\tstartPhonePairing()\r\n\t\t}\r\n\t\t// Lock the preferred camera selection while pairing is active so it doesn't\r\n\t\t// flip automatically during the pairing flow.\r\n\t\tlockSelectionForPairing()\r\n\t}\r\n\r\n\t// When user regenerates a pairing code we lock the preferred camera selection so\r\n\t// it won't be changed accidentally by other parts of the UI while pairing is active.\r\n\t// This implements the user's request that the camera selection 'stay static' after\r\n\t// generating a code. The lock can be toggled by the user in the DevicePicker UI.\r\n\tfunction lockSelectionForPairing() {\r\n\t\ttry {\r\n\t\t\tif (!preferredCameraLocked) {\r\n\t\t\t\tsetPreferredCameraLocked(true)\r\n\t\t\t\tautoLockRef.current = true\r\n\t\t\t} else if (autoLockRef.current) {\r\n\t\t\t\t// already auto-locked; keep flag as-is\r\n\t\t\t} else {\r\n\t\t\t\t// Respect existing manual lock; do not mark as auto-managed\r\n\t\t\t}\r\n\t\t} catch {}\r\n\t}\r\n\r\n\t// Allow uploading a photo instead of using a live camera\r\n\tfunction triggerUpload() {\r\n\t\ttry { fileInputRef.current?.click() } catch {}\r\n\t}\r\n\r\n\tfunction onUploadPhotoChange(e: React.ChangeEvent<HTMLInputElement>) {\r\n\t\tconst f = e.target.files?.[0]\r\n\t\tif (!f) return\r\n\t\tconst img = new Image()\r\n\t\timg.onload = () => {\r\n\t\t\ttry {\r\n\t\t\t\tif (!canvasRef.current) return\r\n\t\t\t\tconst c = canvasRef.current\r\n\t\t\t\tc.width = img.naturalWidth\r\n\t\t\t\tc.height = img.naturalHeight\r\n\t\t\t\tconst ctx = c.getContext('2d')!\r\n\t\t\t\tctx.drawImage(img, 0, 0, c.width, c.height)\r\n\t\t\t\tsetSnapshotSet(true)\r\n\t\t\t\tsetFrameSize({ w: c.width, h: c.height })\r\n\t\t\t\tsetPhase('select')\r\n\t\t\t\tsetDstPoints([])\r\n\t\t\t\tsetMarkerResult(null)\r\n\t\t\t\t// Clear any previous video stream\r\n\t\t\t\tstopCamera()\r\n\t\t\t} catch {}\r\n\t\t}\r\n\t\timg.onerror = () => { alert('Could not load image. Please try a different photo.') }\r\n\t\timg.src = URL.createObjectURL(f)\r\n\t\t// reset input value so the same file can be reselected\r\n\t\ttry { e.target.value = '' } catch {}\r\n\t}\r\n\r\n\t\tfunction captureFrame() {\r\n\t\tif (!videoRef.current || !canvasRef.current) return\r\n\t\tconst v = videoRef.current\r\n\t\tconst c = canvasRef.current\r\n\t\tc.width = v.videoWidth\r\n\t\tc.height = v.videoHeight\r\n\t\tconst ctx = c.getContext('2d')!\r\n\t\tctx.drawImage(v, 0, 0, c.width, c.height)\r\n\t\tsetSnapshotSet(true)\r\n\t\tsetFrameSize({ w: c.width, h: c.height })\r\n\t\tsetPhase('select')\r\n\t\tsetDstPoints([])\r\n\t\tsetMarkerResult(null)\r\n\t\t\t// If liveDetect is on, kick a detect on this captured frame\r\n\t\t\tif (liveDetect) setTimeout(() => { autoDetectRings() }, 0)\r\n\t}\r\n\r\n\tfunction drawOverlay(currentPoints = dstPoints, HH: Homography | null = null) {\r\n\t\tif (!canvasRef.current || !overlayRef.current) return\r\n\t\tconst img = canvasRef.current\r\n\t\tconst o = overlayRef.current\r\n\t\to.width = img.width; o.height = img.height\r\n\t\tconst ctx = o.getContext('2d')!\r\n\t\tctx.clearRect(0, 0, o.width, o.height)\r\n\r\n\t\t// Draw clicked points (with order labels to guide TOP, RIGHT, BOTTOM, LEFT)\r\n\t\tcurrentPoints.forEach((p, i) => {\r\n\t\t\tdrawCross(ctx, p, '#f472b6')\r\n\t\t\tctx.save()\r\n\t\t\tctx.fillStyle = '#f472b6'\r\n\t\t\tctx.font = '14px sans-serif'\r\n\t\t\tctx.fillText(String(i + 1), p.x + 6, p.y - 6)\r\n\t\t\tctx.restore()\r\n\t\t})\r\n\r\n\t\t// If we have a homography, draw rings (precise, perspective-correct)\r\n\t\tconst Huse = HH || H\r\n\t\tif (Huse) {\r\n\t\t\tconst rings = [BoardRadii.bullInner, BoardRadii.bullOuter, BoardRadii.trebleInner, BoardRadii.trebleOuter, BoardRadii.doubleInner, BoardRadii.doubleOuter]\r\n\t\t\tfor (const r of rings) {\r\n\t\t\t\t// Use green for all rings when calibration is locked/perfect\r\n\t\t\t\tconst ringColor = locked ? '#10b981' : (r === BoardRadii.doubleOuter ? '#22d3ee' : '#a78bfa')\r\n\t\t\t\tconst ringWidth = locked ? 3 : (r === BoardRadii.doubleOuter ? 3 : 2)\r\n\t\t\t\tconst poly = sampleRing(Huse, r, 360)\r\n\t\t\t\tdrawPolyline(ctx, poly, ringColor, ringWidth)\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Otherwise, if we have detected circles, draw them as previews (circles in image space)\r\n\t\tif (!Huse && detected) {\r\n\t\t\tconst drawCircle = (r: number, color: string, w = 2) => {\r\n\t\t\t\tctx.save(); ctx.strokeStyle = color; ctx.lineWidth = w\r\n\t\t\t\tctx.beginPath(); ctx.arc(detected.cx, detected.cy, r, 0, Math.PI * 2); ctx.stroke(); ctx.restore()\r\n\t\t\t}\r\n\t\t\tdrawCircle(detected.doubleOuter, '#22d3ee', 3)\r\n\t\t\tdrawCircle(detected.doubleInner, '#22d3ee', 2)\r\n\t\t\tdrawCircle(detected.trebleOuter, '#fde047', 2)\r\n\t\t\tdrawCircle(detected.trebleInner, '#fde047', 2)\r\n\t\t\tdrawCircle(detected.bullOuter, '#34d399', 2)\r\n\t\t\tdrawCircle(detected.bullInner, '#10b981', 3)\r\n\t\t}\r\n\r\n\t\t// Preferred-view framing guide (if enabled and not yet calibrated)\r\n\t\tif (calibrationGuide && !locked) {\r\n\t\t\tctx.save()\r\n\t\t\t// Semi-transparent vignette to encourage centered, face-on framing\r\n\t\t\tctx.fillStyle = 'rgba(59,130,246,0.10)'\r\n\t\t\tconst pad = Math.round(Math.min(o.width, o.height) * 0.08)\r\n\t\t\tconst w = o.width - pad*2\r\n\t\t\tconst h = o.height - pad*2\r\n\t\t\tctx.fillRect(pad, pad, w, h)\r\n\t\t\t// Horizon/tilt line and vertical center line\r\n\t\t\tctx.strokeStyle = 'rgba(34,197,94,0.9)'\r\n\t\t\tctx.lineWidth = 2\r\n\t\t\t// Horizontal line roughly through bull height\r\n\t\t\tctx.beginPath(); ctx.moveTo(pad, o.height/2); ctx.lineTo(o.width-pad, o.height/2); ctx.stroke()\r\n\t\t\t// Vertical center\r\n\t\t\tctx.beginPath(); ctx.moveTo(o.width/2, pad); ctx.lineTo(o.width/2, o.height-pad); ctx.stroke()\r\n\t\t\t// Angle brackets to suggest slight top-down 10–15°\r\n\t\t\tctx.strokeStyle = 'rgba(234,179,8,0.9)'\r\n\t\t\tctx.setLineDash([6,4])\r\n\t\t\tconst ax = pad + 30, ay = pad + 30\r\n\t\t\tctx.beginPath(); ctx.moveTo(ax, ay+30); ctx.lineTo(ax+60, ay); ctx.stroke()\r\n\t\t\tctx.beginPath(); ctx.moveTo(o.width-ax, ay+30); ctx.lineTo(o.width-ax-60, ay); ctx.stroke()\r\n\t\t\tctx.restore()\r\n\t\t\t// Legend - draw at fixed size regardless of zoom\r\n\t\t\tctx.save()\r\n\t\t\tctx.scale(1/zoom, 1/zoom) // Inverse scale to keep text static\r\n\t\t\tctx.fillStyle = 'rgba(255,255,255,0.85)'\r\n\t\t\tctx.font = '12px sans-serif'\r\n\t\t\tctx.fillText('Tip: Frame board centered, edges parallel; slight top-down is okay. Keep bull near center.', pad * zoom, (pad + 18) * zoom)\r\n\t\t\tctx.restore()\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onClickOverlay(e: React.MouseEvent<HTMLCanvasElement>) {\r\n\t\tif (phase !== 'select') return\r\n\t\tconst el = (e.target as HTMLCanvasElement)\r\n\t\tconst rect = el.getBoundingClientRect()\r\n\t\tconst cssX = e.clientX - rect.left\r\n\t\tconst cssY = e.clientY - rect.top\r\n\t\t// Map CSS coordinates back to the overlay canvas pixel coordinates, accounting for CSS scaling and zoom\r\n\t\tconst scaleX = el.width > 0 ? (el.width / rect.width) : 1\r\n\t\tconst scaleY = el.height > 0 ? (el.height / rect.height) : 1\r\n\t\tconst x = cssX * scaleX\r\n\t\tconst y = cssY * scaleY\r\n\t\tconst pts = [...dstPoints, { x, y }]\r\n\t\tif (pts.length <= 4) {\r\n\t\t\tsetDstPoints(pts)\r\n\t\t\tdrawOverlay(pts)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction undoPoint() {\r\n\t\tconst pts = dstPoints.slice(0, -1)\r\n\t\tsetDstPoints(pts)\r\n\t\tdrawOverlay(pts)\r\n\t}\r\n\r\n\t\tfunction refinePoints() {\r\n\t\t\tif (!canvasRef.current || dstPoints.length === 0) return\r\n\t\t\tconst refined = refinePointsSobel(canvasRef.current, dstPoints, 8)\r\n\t\t\tsetDstPoints(refined)\r\n\t\t\tdrawOverlay(refined)\r\n\t\t}\r\n\r\n\tfunction compute() {\r\n\t\tif (!canvasRef.current) return\r\n\t\tif (dstPoints.length !== 4) return alert('Please click 4 points: TOP, RIGHT, BOTTOM, LEFT corners of the double rim.')\r\n\t\tconst src = canonicalRimTargets() // board space mm\r\n\t\tconst Hcalc = computeHomographyDLT(src, dstPoints)\r\n\t\tdrawOverlay(dstPoints, Hcalc)\r\n\t\tconst err = rmsError(Hcalc, src, dstPoints)\r\n\t\tsetCalibration({ H: Hcalc as Homography, createdAt: Date.now(), errorPx: err, imageSize: { w: canvasRef.current.width, h: canvasRef.current.height }, anchors: { src, dst: dstPoints } })\r\n\t\tsetPhase('computed')\r\n\t}\r\n\r\n\tfunction resetAll() {\r\n\t\tsetDstPoints([])\r\n\t\tsetSnapshotSet(false)\r\n\t\tsetPhase('camera')\r\n\t\tdrawOverlay([])\r\n\t\tsetMarkerResult(null)\r\n\t\treset()\r\n\t}\r\n\r\n\t// --- Auto-detect the double rim from the current snapshot and compute homography ---\r\n\t\tasync function autoDetectRings() {\r\n\t\tif (!canvasRef.current) return alert('Load a photo or capture a frame first.')\r\n\t\tsetMarkerResult(null)\r\n\t\tconst src = canvasRef.current\r\n\t\t// Downscale for speed\r\n\t\tconst maxW = 800\r\n\t\tconst scale = Math.min(1, maxW / src.width)\r\n\t\tconst dw = Math.max(1, Math.round(src.width * scale))\r\n\t\tconst dh = Math.max(1, Math.round(src.height * scale))\r\n\t\tconst tmp = document.createElement('canvas')\r\n\t\ttmp.width = dw; tmp.height = dh\r\n\t\tconst tctx = tmp.getContext('2d')!\r\n\t\ttctx.drawImage(src, 0, 0, dw, dh)\r\n\t\tconst img = tctx.getImageData(0, 0, dw, dh)\r\n\t\t// Grayscale + Sobel edge magnitude\r\n\t\tconst gray = new Float32Array(dw * dh)\r\n\t\tfor (let i = 0, p = 0; i < img.data.length; i += 4, p++) {\r\n\t\t\tconst r = img.data[i], g = img.data[i+1], b = img.data[i+2]\r\n\t\t\tgray[p] = 0.299*r + 0.587*g + 0.114*b\r\n\t\t}\r\n\t\tconst gx = new Float32Array(dw * dh)\r\n\t\tconst gy = new Float32Array(dw * dh)\r\n\t\tfor (let y = 1; y < dh-1; y++) {\r\n\t\t\tfor (let x = 1; x < dw-1; x++) {\r\n\t\t\t\tconst i = y*dw + x\r\n\t\t\t\tconst a = gray[i - dw - 1], b = gray[i - dw], c = gray[i - dw + 1]\r\n\t\t\t\tconst d0 = gray[i - 1],        /*e*/       f0 = gray[i + 1]\r\n\t\t\t\tconst g0 = gray[i + dw - 1], h0 = gray[i + dw], j0 = gray[i + dw + 1]\r\n\t\t\t\tgx[i] = (-a - 2*d0 - g0) + (c + 2*f0 + j0)\r\n\t\t\t\tgy[i] = (-a - 2*b - c) + (g0 + 2*h0 + j0)\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst mag = new Float32Array(dw * dh)\r\n\t\tlet maxMag = 1\r\n\t\tfor (let i = 0; i < mag.length; i++) { const m = Math.hypot(gx[i], gy[i]); mag[i] = m; if (m > maxMag) maxMag = m }\r\n\t\t// Coarse circle search around center for double outer\r\n\t\tconst cx0 = Math.floor(dw/2), cy0 = Math.floor(dh/2)\r\n\t\tconst rMin = Math.floor(Math.min(dw, dh) * 0.35)\r\n\t\tconst rMax = Math.floor(Math.min(dw, dh) * 0.52)\r\n\t\tlet best = { score: -1, cx: cx0, cy: cy0, r: Math.floor((rMin + rMax)/2) }\r\n\t\tconst stepC = Math.max(2, Math.floor(Math.min(dw, dh) * 0.01)) // center step\r\n\t\tconst stepR = Math.max(2, Math.floor(Math.min(dw, dh) * 0.01)) // radius step\r\n\t\tfor (let cy = cy0 - Math.floor(dh*0.08); cy <= cy0 + Math.floor(dh*0.08); cy += stepC) {\r\n\t\t\tfor (let cx = cx0 - Math.floor(dw*0.08); cx <= cx0 + Math.floor(dw*0.08); cx += stepC) {\r\n\t\t\t\tfor (let r = rMin; r <= rMax; r += stepR) {\r\n\t\t\t\t\tlet s = 0\r\n\t\t\t\t\tconst samples = 360\r\n\t\t\t\t\tfor (let a = 0; a < samples; a++) {\r\n\t\t\t\t\t\tconst ang = (a * Math.PI) / 180\r\n\t\t\t\t\t\tconst x = Math.round(cx + r * Math.cos(ang))\r\n\t\t\t\t\t\tconst y = Math.round(cy + r * Math.sin(ang))\r\n\t\t\t\t\t\tif (x <= 0 || x >= dw-1 || y <= 0 || y >= dh-1) continue\r\n\t\t\t\t\t\ts += mag[y*dw + x]\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (s > best.score) best = { score: s, cx, cy, r }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Map back to original canvas coords\r\n\t\tconst inv = 1/scale\r\n\t\tconst OCX = best.cx * inv\r\n\t\tconst OCY = best.cy * inv\r\n\t\tconst OR  = best.r  * inv\r\n\t\t// With center/doubleOuter radius fixed, locate other rings via 1D radial search\r\n\t\tfunction radialScore(rPx: number) {\r\n\t\t\tlet s = 0\r\n\t\t\tconst rScaled = rPx * scale\r\n\t\t\tconst samples = 360\r\n\t\t\tfor (let a = 0; a < samples; a++) {\r\n\t\t\t\tconst ang = (a * Math.PI) / 180\r\n\t\t\t\tconst x = Math.round(best.cx + rScaled * Math.cos(ang))\r\n\t\t\t\tconst y = Math.round(best.cy + rScaled * Math.sin(ang))\r\n\t\t\t\tif (x <= 0 || x >= dw-1 || y <= 0 || y >= dh-1) continue\r\n\t\t\t\ts += mag[y*dw + x]\r\n\t\t\t}\r\n\t\t\treturn s\r\n\t\t}\r\n\t\tconst ratios = {\r\n\t\t\tbullInner: BoardRadii.bullInner / BoardRadii.doubleOuter,\r\n\t\t\tbullOuter: BoardRadii.bullOuter / BoardRadii.doubleOuter,\r\n\t\t\ttrebleInner: BoardRadii.trebleInner / BoardRadii.doubleOuter,\r\n\t\t\ttrebleOuter: BoardRadii.trebleOuter / BoardRadii.doubleOuter,\r\n\t\t\tdoubleInner: BoardRadii.doubleInner / BoardRadii.doubleOuter,\r\n\t\t\tdoubleOuter: 1,\r\n\t\t} as const\r\n\t\tfunction refineAround(expectedR: number, pctWindow = 0.08) { // Reduced window for more precision\r\n\t\t\tconst lo = Math.max(1, Math.floor(expectedR * (1 - pctWindow)))\r\n\t\t\tconst hi = Math.max(lo+1, Math.floor(expectedR * (1 + pctWindow)))\r\n\t\t\tlet bestR = lo, bestS = -1\r\n\t\t\tfor (let r = lo; r <= hi; r++) {\r\n\t\t\t\tconst s = radialScore(r)\r\n\t\t\t\tif (s > bestS) { bestS = s; bestR = r }\r\n\t\t\t}\r\n\t\t\treturn bestR\r\n\t\t}\r\n\t\tconst dOuter = OR\r\n\t\tconst dInner = refineAround(dOuter * ratios.doubleInner)\r\n\t\tconst tOuter = refineAround(dOuter * ratios.trebleOuter)\r\n\t\tconst tInner = refineAround(dOuter * ratios.trebleInner)\r\n\t\tconst bOuter = refineAround(dOuter * ratios.bullOuter)\r\n\t\tconst bInner = refineAround(dOuter * ratios.bullInner)\r\n\t\t\tsetDetected({ cx: OCX, cy: OCY, bullInner: bInner, bullOuter: bOuter, trebleInner: tInner, trebleOuter: tOuter, doubleInner: dInner, doubleOuter: dOuter })\r\n\t\t\t// Estimate confidence: ratio of ring scores around expected vs local baseline\r\n\t\t\t// Use normalized edge magnitude at found radii to compute a 0-1 score, then scale to percent\r\n\t\t\tconst totalEdge = (r: number) => {\r\n\t\t\t\tconst samples = 180\r\n\t\t\t\tlet s = 0\r\n\t\t\t\tfor (let a = 0; a < samples; a++) {\r\n\t\t\t\t\tconst ang = (a * Math.PI) / 90\r\n\t\t\t\t\tconst x = Math.round(best.cx + (r*scale) * Math.cos(ang))\r\n\t\t\t\t\tconst y = Math.round(best.cy + (r*scale) * Math.sin(ang))\r\n\t\t\t\t\tif (x <= 0 || x >= dw-1 || y <= 0 || y >= dh-1) continue\r\n\t\t\t\t\ts += mag[y*dw + x]\r\n\t\t\t\t}\r\n\t\t\t\treturn s / samples\r\n\t\t\t}\r\n\t\t\tconst score = totalEdge(best.r) + totalEdge(tOuter) + totalEdge(tInner) + totalEdge(dInner) + totalEdge(bOuter) + totalEdge(bInner)\r\n\t\t\tconst norm = score / (maxMag * 6)\r\n\t\t\tconst conf = Math.max(0, Math.min(1, norm))\r\n\t\t\t// Apply stricter confidence calculation for perfect calibration\r\n\t\t\tconst adjustedConf = Math.min(conf, Math.min(\r\n\t\t\t\ttotalEdge(best.r) / maxMag,    // Double outer\r\n\t\t\t\ttotalEdge(tOuter) / maxMag,    // Treble outer  \r\n\t\t\t\ttotalEdge(tInner) / maxMag,    // Treble inner\r\n\t\t\t\ttotalEdge(dInner) / maxMag,    // Double inner\r\n\t\t\t\ttotalEdge(bOuter) / maxMag,    // Bull outer\r\n\t\t\t\ttotalEdge(bInner) / maxMag     // Bull inner\r\n\t\t\t))\r\n\t\t\tsetConfidence(Math.round(adjustedConf * 100))\r\n\t\t// Seed the four calibration points and compute\r\n\t\tconst pts: Point[] = [\r\n\t\t\t{ x: OCX,       y: OCY - dOuter },\r\n\t\t\t{ x: OCX + dOuter,  y: OCY      },\r\n\t\t\t{ x: OCX,       y: OCY + dOuter },\r\n\t\t\t{ x: OCX - dOuter,  y: OCY      },\r\n\t\t]\r\n\t\tsetDstPoints(pts)\r\n\t\tdrawOverlay(pts)\r\n\t\t\ttry { compute() } catch {}\r\n\t\t\t// Auto-lock if confidence high and error small\r\n\t\t\tconst autoLock = adjustedConf >= 0.95 // Use adjusted confidence for near-perfect calibration\r\n\t\t\tsetCalibration({ locked: autoLock })\r\n\t}\r\n\r\n\t\t\tfunction detectMarkers() {\r\n\t\t\t\tif (!canvasRef.current) return alert('Capture a frame or upload a photo first.')\r\n\t\t\t\tconst result = detectMarkersFromCanvas(canvasRef.current)\r\n\t\t\t\tsetMarkerResult(result)\r\n\t\t\t\tif (!result.success || !result.homography) {\r\n\t\t\t\t\tconst missingMsg = result.missing.length\r\n\t\t\t\t\t\t? ` Missing markers: ${result.missing.map(k => `${k.toUpperCase()} (ID ${MARKER_TARGETS[k]})`).join(', ')}`\r\n\t\t\t\t\t\t: ''\r\n\t\t\t\t\talert(result.message ? `${result.message}${missingMsg}` : `Marker detection failed.${missingMsg}`)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tsetDetected(null)\r\n\t\t\t\tsetDstPoints(result.points)\r\n\t\t\t\tdrawOverlay(result.points, result.homography)\r\n\t\t\t\tconst src = canonicalRimTargets()\r\n\t\t\t\tconst imageSize = { w: canvasRef.current.width, h: canvasRef.current.height }\r\n\t\t\t\tconst shouldLock = (result.errorPx ?? Number.POSITIVE_INFINITY) <= 1.2\r\n\t\t\t\tsetCalibration({\r\n\t\t\t\t\tH: result.homography as Homography,\r\n\t\t\t\t\tcreatedAt: Date.now(),\r\n\t\t\t\t\terrorPx: result.errorPx ?? null,\r\n\t\t\t\t\timageSize,\r\n\t\t\t\t\tanchors: { src, dst: result.points },\r\n\t\t\t\t\tlocked: shouldLock ? true : locked,\r\n\t\t\t\t})\r\n\t\t\t\tsetPhase('computed')\r\n\t\t\t}\r\n\r\n\t\tuseEffect(() => {\r\n\t\t\tdrawOverlay()\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t\t}, [snapshotSet, H])\r\n\r\n\t\t// Live detection loop (runs only when streaming and liveDetect is on)\r\n\t\tuseEffect(() => {\r\n\t\t\tif (!liveDetect || !streaming) return\r\n\t\t\tlet raf = 0\r\n\t\t\tconst tick = () => {\r\n\t\t\t\ttry { captureFrame() } catch {}\r\n\t\t\t\traf = requestAnimationFrame(tick)\r\n\t\t\t}\r\n\t\t\traf = requestAnimationFrame(tick)\r\n\t\t\treturn () => cancelAnimationFrame(raf)\r\n\t\t}, [liveDetect, streaming])\r\n\r\n\t\t// When calibration is locked and we have a pairing code, publish calibration to server\r\n\t\tuseEffect(() => {\r\n\t\t\t(async () => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (!locked || !pairCode) return\r\n\t\t\t\t\t// Build a compact calibration payload including current canvas size if available\r\n\t\t\t\t\tconst imgSize = canvasRef.current ? { w: canvasRef.current.width, h: canvasRef.current.height } : null\r\n\t\t\t\t\tconst bodyStr = JSON.stringify({ H, anchors: null, imageSize: imgSize, errorPx: errorPx ?? null })\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait apiFetch(`/cam/calibration/${pairCode}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: bodyStr })\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Posted calibration for code', pairCode)\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\tconsole.warn('[Calibrator] Upload calibration failed', err)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t// If user is authenticated, persist calibration to their account (Supabase-backed)\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst token = localStorage.getItem('authToken')\r\n\t\t\t\t\t\t\tif (token) {\r\n\t\t\t\t\t\t\t\tawait apiFetch('/api/user/calibration', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }, body: bodyStr })\r\n\t\t\t\t\t\t\t\tconsole.log('[Calibrator] Synced calibration to user account')\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tconsole.warn('[Calibrator] User calibration sync failed', err)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t} catch (e) { /* ignore */ }\r\n\t\t\t})()\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t\t}, [locked, pairCode])\r\n\r\n\t\t// DevicePicker moved from SettingsPanel\r\n\t\tfunction DevicePicker() {\r\n\t\t\tconst { preferredCameraId, preferredCameraLabel, setPreferredCamera, cameraEnabled, setCameraEnabled, preferredCameraLocked, setPreferredCameraLocked } = useUserSettings()\r\n\t\t\tconst [devices, setDevices] = useState<MediaDeviceInfo[]>([])\r\n\t\t\tconst [err, setErr] = useState('')\r\n\t\t\tconst [dropdownOpen, setDropdownOpen] = useState(false)\r\n\t\t\tconst dropdownRef = useRef<HTMLDivElement>(null)\r\n\t\t\tconst dropdownPortal = document.getElementById('dropdown-portal-root') || (() => {\r\n\t\t\t\tconst el = document.createElement('div');\r\n\t\t\t\tel.id = 'dropdown-portal-root';\r\n\t\t\t\tdocument.body.appendChild(el);\r\n\t\t\t\treturn el;\r\n\t\t\t})();\r\n\r\n\t\t\tasync function enumerate() {\r\n\t\t\t\tsetErr('')\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Ensure we have permission; otherwise labels may be empty.\r\n\t\t\t\t\ttry { await navigator.mediaDevices.getUserMedia({ video: true }); } catch {}\r\n\t\t\t\t\tconst list = await navigator.mediaDevices.enumerateDevices()\r\n\t\t\t\t\tconst cams = list.filter(d => d.kind === 'videoinput')\r\n\t\t\t\t\tsetDevices(cams)\r\n\t\t\t\t} catch (e: any) {\r\n\t\t\t\t\tsetErr('Unable to list cameras. Grant camera permission in your browser.')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tuseEffect(() => { enumerate() }, [])\r\n\r\n\t\t\t// Close dropdown when clicking outside\r\n\t\t\tuseEffect(() => {\r\n\t\t\t\tfunction handleClickOutside(event: MouseEvent) {\r\n\t\t\t\t\tif (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n\t\t\t\t\t\tsetDropdownOpen(false)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdocument.addEventListener('mousedown', handleClickOutside)\r\n\t\t\t\treturn () => document.removeEventListener('mousedown', handleClickOutside)\r\n\t\t\t}, [])\r\n\r\n\t\t\tconst selectedDevice = devices.find(d => d.deviceId === preferredCameraId)\r\n\t\t\tconst selectedLabel = selectedDevice ? \r\n\t\t\t\t`${selectedDevice.label || 'Camera'}` : \r\n\t\t\t\t(preferredCameraId ? 'Camera (unavailable)' : 'Auto (browser default)')\r\n\r\n\t\t\t// If preferred camera is set but not found, show a warning\r\n\t\t\tconst preferredCameraUnavailable = preferredCameraId && !selectedDevice\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"mt-3 p-3 rounded-lg border border-indigo-500/30 bg-indigo-500/5\">\r\n\t\t\t\t\t<div className=\"font-semibold mb-2\">Select camera device</div>\r\n\t\t\t\t\t{err && <div className=\"text-rose-400 text-sm mb-2\">{err}</div>}\r\n\t\t\t\t\t{preferredCameraUnavailable && (\r\n\t\t\t\t\t\t<div className=\"text-amber-400 text-sm mb-2\">\r\n\t\t\t\t\t\t\tSelected camera is no longer available. \r\n\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\tclassName=\"underline ml-1\" \r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setPreferredCamera(undefined, '', true)}\r\n\t\t\t\t\t\t\t\tdisabled={streaming}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tUse auto-selection\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t{/* Lock indicator and toggle for camera selection */}\r\n\t\t\t\t\t<div className=\"flex items-center gap-2 mb-2\">\r\n\t\t\t\t\t\t{preferredCameraLocked ? (\r\n\t\t\t\t\t\t\t<div className=\"text-xs text-emerald-400\">🔒 Camera selection locked</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className=\"text-xs text-slate-400\">Camera selection unlocked</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclassName=\"btn btn--ghost px-2 py-0.5 text-xs ml-2\"\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tautoLockRef.current = false\r\n\t\t\t\t\t\t\t\tsetPreferredCameraLocked(!preferredCameraLocked)\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{preferredCameraLocked ? 'Unlock' : 'Lock'}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"flex items-center gap-3 mb-3\">\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t\t\t\tid=\"cameraEnabled-calibrator\"\r\n\t\t\t\t\t\t\tchecked={cameraEnabled}\r\n\t\t\t\t\t\t\tonChange={e => setCameraEnabled(e.target.checked)}\r\n\t\t\t\t\t\t\tclassName=\"w-4 h-4\"\r\n\t\t\t\t\t\t\tdisabled={streaming}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<label htmlFor=\"cameraEnabled-calibrator\" className=\"text-sm\">Enable camera for scoring</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"grid grid-cols-3 gap-2 items-center text-sm\">\r\n\t\t\t\t\t\t<div className=\"col-span-2 relative\" ref={dropdownRef}>\r\n\t\t\t\t\t\t\t<div \r\n\t\t\t\t\t\t\t\tclassName={`input w-full flex items-center justify-between cursor-pointer ${streaming ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n\t\t\t\t\t\t\t\tonClick={() => !streaming && setDropdownOpen(!dropdownOpen)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<span className=\"truncate\">{selectedLabel}</span>\r\n\t\t\t\t\t\t\t\t<svg className={`w-4 h-4 transition-transform ${dropdownOpen ? 'rotate-180' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n\t\t\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{dropdownOpen && !streaming && ReactDOM.createPortal(\r\n\t\t\t\t\t\t\t\t<div className=\"fixed left-0 top-0 w-full h-full z-[9999]\" style={{ pointerEvents: 'none' }}>\r\n\t\t\t\t\t\t\t\t\t<div className=\"absolute\" style={{ left: dropdownRef.current?.getBoundingClientRect().left || 0, top: dropdownRef.current?.getBoundingClientRect().bottom || 0, width: dropdownRef.current?.offsetWidth || 240, pointerEvents: 'auto' }}>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-48 overflow-y-auto\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div \r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetPreferredCamera(undefined, '', true)\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\tAuto (browser default)\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t{devices.map(d => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst label = `${d.label || 'Camera'}`\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={d.deviceId} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPreferredCamera(d.deviceId, d.label || '', true)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{label}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t\t\t<div \r\n\t\t\t\t\t\t\t\t\t\t\t\tkey=\"phone-camera\" \r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm text-indigo-400\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetMode('phone');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetPhase('camera');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetStreaming(false);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetSnapshotSet(false);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Only start pairing if user clicks 'Pair Phone Camera' button\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t📱 Phone Camera\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"px-3 py-2 text-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={() => setDropdownOpen(false)}>Close</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>,\r\n\t\t\t\t\t\t\t\tdropdownPortal\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"text-right\">\r\n\t\t\t\t\t\t\t<button className=\"btn px-2 py-1\" onClick={enumerate} disabled={streaming}>Refresh</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{preferredCameraLabel && (\r\n\t\t\t\t\t\t<div className=\"text-xs opacity-70 mt-1\">Selected: {preferredCameraLabel}</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<div className=\"text-xs opacity-70 mt-1\">Tip: All camera technology is supported for autoscoring needs—select your camera here and then open Calibrator to align.</div>\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\t}\r\n\t\tconst showMobileLanding = isMobileDevice && !mobileLandingOverride\r\n\r\n\t\tif (showMobileLanding) {\r\n\t\t\tconst linkForMobile = mobileLandingLink ?? (typeof window !== 'undefined' ? `${window.location.origin.replace(/\\/$/, '')}/mobile-cam.html` : '/mobile-cam.html')\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"mx-auto flex min-h-[calc(100vh-140px)] w-full max-w-xl flex-col justify-center gap-6 p-6\">\r\n\t\t\t\t\t<div className=\"space-y-5 rounded-3xl border border-indigo-400/30 bg-slate-900/70 p-6 text-slate-100 shadow-xl\">\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t<p className=\"text-xs font-semibold uppercase tracking-wide text-indigo-300\">Mobile camera</p>\r\n\t\t\t\t\t\t\t<h2 className=\"text-2xl font-semibold leading-tight text-white\">This device is ready to stream as your dartboard camera</h2>\r\n\t\t\t\t\t\t\t<p className=\"text-sm text-slate-200/80\">\r\n\t\t\t\t\t\t\t\tOpen the lightweight mobile camera page to stream video to your desktop calibrator. You can still come back here if you need the full desktop tools.\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t<a\r\n\t\t\t\t\t\t\t\thref={linkForMobile}\r\n\t\t\t\t\t\t\t\tclassName=\"btn w-full justify-center px-4 py-2 text-base\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tOpen mobile camera\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn--ghost w-full justify-center px-4 py-2 text-sm\"\r\n\t\t\t\t\t\t\t\tonClick={() => copyValue(linkForMobile, 'link')}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{copyFeedback === 'link' ? 'Link copied!' : 'Copy link'}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<p className=\"text-xs text-slate-300/70\">\r\n\t\t\t\t\t\t\tOn a desktop, open Calibrator and generate a pairing code. Then tap <span className=\"font-semibold\">Pair with Desktop</span> from the mobile camera page to connect this device.\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\tclassName=\"self-center text-xs font-medium text-indigo-200 underline decoration-dotted decoration-indigo-300/70 transition hover:text-indigo-100\"\r\n\t\t\t\t\t\tonClick={() => setMobileLandingOverride(true)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tContinue to desktop calibrator\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"space-y-6\">\r\n\t\t\t\t{isMobileDevice && mobileLandingOverride && (\r\n\t\t\t\t\t<div className=\"rounded-2xl border border-indigo-400/30 bg-indigo-500/10 p-4 text-sm text-indigo-100\">\r\n\t\t\t\t\t\t<div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\r\n\t\t\t\t\t\t\t<p className=\"leading-relaxed\">Using a phone? Switch back to the streamlined mobile camera interface for an easier pairing flow.</p>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn--ghost px-3 py-1 text-xs\"\r\n\t\t\t\t\t\t\t\tonClick={() => setMobileLandingOverride(false)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tOpen mobile camera mode\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t\t<div className=\"card space-y-6 p-6\">\r\n\t\t\t\t\t<header className=\"flex flex-wrap items-start justify-between gap-4\">\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t<p className=\"text-xs font-semibold uppercase tracking-wide text-indigo-300\">Marker calibration</p>\r\n\t\t\t\t\t\t\t<h2 className=\"text-2xl font-semibold leading-tight text-white\">Align your board with the autoscoring overlay</h2>\r\n\t\t\t\t\t\t\t<p className=\"max-w-2xl text-sm opacity-80\">\r\n\t\t\t\t\t\t\t\tPlace the printable fiducial markers around the double ring, capture a clear frame, and let the calibrator compute a precise homography.\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"flex flex-col items-end gap-2 text-xs font-medium\">\r\n\t\t\t\t\t\t\t<span className=\"inline-flex items-center gap-2 rounded-full border border-indigo-400/50 bg-indigo-500/10 px-3 py-1\">\r\n\t\t\t\t\t\t\t\t<span className=\"opacity-60\">Mode</span>\r\n\t\t\t\t\t\t\t\t<span>{mode === 'local' ? 'Desktop camera' : mode === 'phone' ? 'Phone camera' : 'Wifi device'}</span>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span className={`inline-flex items-center gap-2 rounded-full border px-3 py-1 ${streaming ? 'border-emerald-400/60 bg-emerald-500/10 text-emerald-100' : 'border-white/20 bg-white/5 text-slate-200'}`}>\r\n\t\t\t\t\t\t\t\t<span className={`h-2 w-2 rounded-full ${streaming ? 'bg-emerald-400' : 'bg-slate-400'}`} />\r\n\t\t\t\t\t\t\t\t{streaming ? 'Live stream active' : 'Stream idle'}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t{locked ? (\r\n\t\t\t\t\t\t\t\t<span className=\"inline-flex items-center gap-2 rounded-full border border-emerald-400/60 bg-emerald-500/10 px-3 py-1 text-emerald-100\">\r\n\t\t\t\t\t\t\t\t\t<span>Locked • {errorPx != null ? `${errorPx.toFixed(2)}px error` : 'ready'}</span>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<span className=\"inline-flex items-center gap-2 rounded-full border border-amber-400/40 bg-amber-500/10 px-3 py-1 text-amber-100\">\r\n\t\t\t\t\t\t\t\t\t<span>Not locked</span>\r\n\t\t\t\t\t\t\t\t\t{errorPx != null && <span>• {errorPx.toFixed(2)}px</span>}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</header>\r\n\r\n\t\t\t\t\t<section className=\"rounded-2xl border border-indigo-500/30 bg-indigo-500/5 p-5\">\r\n\t\t\t\t\t\t<div className=\"flex flex-wrap items-start justify-between gap-4\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold uppercase tracking-wide text-indigo-200\">Marker kit</h3>\r\n\t\t\t\t\t\t\t\t<p className=\"mt-1 text-sm opacity-80\">\r\n\t\t\t\t\t\t\t\t\tPrint the fiducials, tape them flush with the outer double ring, then capture a clear frame before running detection.\r\n\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t<button className=\"btn px-3 py-1.5\" onClick={openMarkerSheet}>Open printable sheet</button>\r\n\t\t\t\t\t\t\t\t<button className=\"btn btn--ghost px-3 py-1.5\" onClick={() => setMarkerResult(null)}>Clear marker status</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<ol className=\"mt-3 list-decimal list-inside space-y-2 text-sm opacity-75\">\r\n\t\t\t\t\t\t\t<li>Print and cut out the four markers. Place them on the top, right, bottom, and left edges of the double ring.</li>\r\n\t\t\t\t\t\t\t<li>Start your camera or upload a still frame with the full board visible and the markers unobstructed.</li>\r\n\t\t\t\t\t\t\t<li>Run <strong>Auto detect</strong> for circle fitting or <strong>Detect markers</strong> for fiducials, then lock calibration when error ≤ 1.2px.</li>\r\n\t\t\t\t\t\t</ol>\r\n\t\t\t\t\t</section>\r\n\r\n\t\t\t\t\t<div className=\"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(320px,1fr)]\">\r\n\t\t\t\t\t\t<section className=\"space-y-4\">\r\n\t\t\t\t\t\t\t<div className=\"space-y-4 rounded-2xl border border-white/10 bg-black/40 p-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center justify-between gap-4 text-xs\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"uppercase tracking-wide opacity-60\">Video source</span>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn px-3 py-1 ${mode === 'local' ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-slate-700 hover:bg-slate-600'}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => { setMode('local'); stopCamera() }}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Use local camera\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\tLocal\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn px-3 py-1 ${mode === 'phone' ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-slate-700 hover:bg-slate-600'}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => { setMode('phone'); stopCamera() }}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Pair phone camera\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\tPhone\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn px-3 py-1 ${mode === 'wifi' ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-slate-700 hover:bg-slate-600'}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetMode('wifi')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstopCamera()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstartWifiConnection()\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Discover wifi/USB autoscoring devices\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\tWifi\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"opacity-70\">Zoom</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"range\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tmin={50}\r\n\t\t\t\t\t\t\t\t\t\t\t\tmax={200}\r\n\t\t\t\t\t\t\t\t\t\t\t\tstep={5}\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={Math.round((zoom || 1) * 100)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={e => setZoom(Math.max(0.5, Math.min(2, Number(e.target.value) / 100)))}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"w-12 text-right\">{Math.round((zoom || 1) * 100)}%</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn px-3 py-1\" onClick={() => setZoom(1)}>Actual</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tclassName=\"relative w-full overflow-hidden rounded-2xl border border-indigo-400/30 bg-black\"\r\n\t\t\t\t\t\t\t\t\tstyle={{ aspectRatio: frameSize ? `${frameSize.w} / ${frameSize.h}` : '16 / 9' }}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{(!streaming || !paired) && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"absolute inset-0 z-20 flex items-center justify-center bg-gradient-to-br from-black/40 to-black/10\">\r\n\t\t\t\t\t\t\t\t\t\t\t<DartLoader calibrationComplete={phase === 'computed'} />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t<div className=\"absolute inset-0\" style={{ transform: `scale(${zoom || 1})`, transformOrigin: 'center center' }}>\r\n\t\t\t\t\t\t\t\t\t\t<video\r\n\t\t\t\t\t\t\t\t\t\t\tref={videoRef}\r\n\t\t\t\t\t\t\t\t\t\t\tonLoadedMetadata={(ev) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst v = ev.currentTarget as HTMLVideoElement\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (v.videoWidth && v.videoHeight) setFrameSize({ w: v.videoWidth, h: v.videoHeight })\r\n\t\t\t\t\t\t\t\t\t\t\t\t} catch {}\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={`absolute inset-0 h-full w-full object-cover transition-opacity duration-300 ${snapshotSet ? 'opacity-0 -z-10' : 'opacity-100 z-10'}`}\r\n\t\t\t\t\t\t\t\t\t\t\tautoPlay\r\n\t\t\t\t\t\t\t\t\t\t\tplaysInline\r\n\t\t\t\t\t\t\t\t\t\t\tmuted\r\n\t\t\t\t\t\t\t\t\t\t\tcontrols={false}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t{videoPlayBlocked && (\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"rounded-lg bg-white px-4 py-2 font-semibold text-slate-900 shadow-lg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={async () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait videoRef.current?.play()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetVideoPlayBlocked(false)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetStreaming(true)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPhase('capture')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.warn('Tap-to-play retry failed', e)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talert('Tap to enable video failed. Please check browser settings or reload the page.')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tTap to allow video\r\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t<canvas ref={canvasRef} className={`absolute inset-0 h-full w-full transition-opacity duration-300 ${snapshotSet ? 'opacity-100 z-10' : 'opacity-0 -z-10'}`} />\r\n\t\t\t\t\t\t\t\t\t\t<canvas ref={overlayRef} onClick={onClickOverlay} className=\"absolute inset-0 z-30 h-full w-full cursor-crosshair\" />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<label className=\"flex items-center gap-2 text-xs\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" className=\"accent-indigo-600\" checked={calibrationGuide} onChange={e => setCalibrationGuide(e.target.checked)} />\r\n\t\t\t\t\t\t\t\t\tShow preferred-view guide overlay\r\n\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 gap-3 text-xs sm:grid-cols-3\">\r\n\t\t\t\t\t\t\t\t<div className=\"rounded-xl border border-white/10 bg-white/5 px-3 py-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"uppercase tracking-wide opacity-60\">Phase</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold capitalize\">{phase}</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"rounded-xl border border-white/10 bg-white/5 px-3 py-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"uppercase tracking-wide opacity-60\">Points selected</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">{dstPoints.length} / 4</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"rounded-xl border border-white/10 bg-white/5 px-3 py-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"uppercase tracking-wide opacity-60\">Fit error</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">{errorPx != null ? `${errorPx.toFixed(2)} px` : '—'}</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\r\n\t\t\t\t\t\t<aside className=\"space-y-4\">\r\n\t\t\t\t\t\t\t<DevicePicker />\r\n\r\n\t\t\t\t\t\t\t<section className=\"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">Step 1 · Capture image</h3>\r\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs opacity-70\">Start your preferred camera or upload a static photo of the board.</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t{!streaming ? (\r\n\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t{mode === 'local' && <button className=\"btn\" onClick={startCamera}>Start camera</button>}\r\n\t\t\t\t\t\t\t\t\t\t\t{mode === 'phone' && <button className=\"btn\" onClick={startPhonePairing}>Pair phone camera</button>}\r\n\t\t\t\t\t\t\t\t\t\t\t{mode === 'wifi' && <button className=\"btn\" onClick={startWifiConnection}>Connect wifi camera</button>}\r\n\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={stopCamera}>Stop camera</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={captureFrame} disabled={!streaming}>Capture frame</button>\r\n\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t<input ref={fileInputRef} type=\"file\" accept=\"image/*\" className=\"hidden\" onChange={onUploadPhotoChange} />\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={triggerUpload}>Upload photo</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</section>\r\n\r\n\t\t\t\t\t\t\t<section className=\"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">Step 2 · Detect markers</h3>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs opacity-70\">Use fiducials or auto-detect to seed the rim points.</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<span className={`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] ${confidence >= 85 ? 'border-emerald-400/60 bg-emerald-500/10 text-emerald-100' : 'border-white/20 bg-white/5 text-slate-200'}`}>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"opacity-70\">Confidence</span>\r\n\t\t\t\t\t\t\t\t\t\t<span>{confidence}%</span>\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<label className=\"inline-flex items-center gap-2 text-xs\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" className=\"accent-indigo-600\" checked={liveDetect} onChange={e => setLiveDetect(e.target.checked)} />\r\n\t\t\t\t\t\t\t\t\tLive auto-detect while streaming\r\n\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={!snapshotSet} onClick={autoDetectRings}>Auto detect</button>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={!snapshotSet} onClick={detectMarkers}>Detect markers</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t{markerResult && (\r\n\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\tclassName={`rounded-lg border px-3 py-2 text-xs ${markerResult.success ? 'bg-emerald-500/10 border-emerald-500/30 text-emerald-100' : 'bg-rose-500/10 border-rose-500/30 text-rose-100'}`}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t{markerResult.success ? (\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tDetected markers → board anchors:{' '}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{MARKER_ORDER.map((key) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst assignment = markerResult.assignments?.[key]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn `${key.toUpperCase()}→${assignment ? `ID ${assignment.id}` : '—'}`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).join(', ')}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{markerResult.errorPx != null && <div>RMS error: {markerResult.errorPx.toFixed(2)} px</div>}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-80\">Markers correspond to IDs TOP {MARKER_TARGETS.top}, RIGHT {MARKER_TARGETS.right}, BOTTOM {MARKER_TARGETS.bottom}, LEFT {MARKER_TARGETS.left}.</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>{markerResult.message || 'Unable to detect all markers.'}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{markerResult.missing.length > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>Missing: {markerResult.missing.map(k => `${k.toUpperCase()} (ID ${MARKER_TARGETS[k]})`).join(', ')}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</section>\r\n\r\n\t\t\t\t\t\t\t<section className=\"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">Step 3 · Align & lock</h3>\r\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs opacity-70\">Click points in TOP → RIGHT → BOTTOM → LEFT order, refine edges, then lock the calibration.</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={dstPoints.length !== 4} onClick={compute}>Compute</button>\r\n\t\t\t\t\t\t\t\t\t<button className={`btn ${locked ? 'bg-emerald-600 hover:bg-emerald-700' : ''}`} onClick={() => setCalibration({ locked: !locked })}>\r\n\t\t\t\t\t\t\t\t\t\t{locked ? 'Unlock' : 'Lock in'}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t{locked && (\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-xs opacity-75\">\r\n\t\t\t\t\t\t\t\t\t\tCalibration saved {errorPx != null ? `· error ${errorPx.toFixed(2)} px` : ''}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={dstPoints.length === 0} onClick={undoPoint}>Undo</button>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={dstPoints.length === 0} onClick={refinePoints}>Refine points</button>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={resetAll}>Reset</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</aside>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{mode === 'phone' && !streaming && (\r\n\t\t\t\t\t\t<div className=\"space-y-2 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white\">\r\n\t\t\t\t\t\t\t<div className=\"font-semibold\">Phone pairing</div>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tclassName=\"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center gap-2\"\r\n\t\t\t\t\t\t\t\tonClick={() => copyValue(mobileUrl, 'link')}\r\n\t\t\t\t\t\t\t\ttitle=\"Copy mobile camera link\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<span className=\"flex-1 min-w-0 font-mono break-all text-[11px]\">{mobileUrl}</span>\r\n\t\t\t\t\t\t\t\t<span className=\"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'link' ? 'Copied!' : 'Copy link'}</span>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-[11px]\">\r\n\t\t\t\t\t\t\t\t<a href={mobileUrl} target=\"_blank\" rel=\"noreferrer\" className=\"underline decoration-dotted text-indigo-200 hover:text-indigo-100 transition\">\r\n\t\t\t\t\t\t\t\t\tOpen link in new tab\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"opacity-80\">\r\n\t\t\t\t\t\t\t\tWS: {ws ? (ws.readyState === 1 ? 'open' : ws.readyState === 0 ? 'connecting' : ws.readyState === 2 ? 'closing' : 'closed') : 'not started'} · {httpsInfo?.https ? 'HTTPS on' : 'HTTP only'}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{pairCode && (\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\tclassName=\"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n\t\t\t\t\t\t\t\t\tonClick={() => copyValue(pairCode, 'code')}\r\n\t\t\t\t\t\t\t\t\ttitle=\"Copy pairing code\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-mono tracking-[0.3em] text-sm\">{pairCode}</span>\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'code' ? 'Copied!' : 'Copy code'}</span>\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t{qrDataUrl && <img className=\"mt-1 h-40 w-40 rounded bg-white\" alt=\"Scan to open\" src={qrDataUrl} />}\r\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t{ttl !== null && <span>Expires in {ttl}s</span>}\r\n\t\t\t\t\t\t\t\t<button className=\"btn px-2 py-1 text-xs\" onClick={regenerateCode}>Regenerate</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{showTips && (\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2 rounded-lg border border-slate-700/50 bg-slate-900/60 p-3 text-slate-200\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">Troubleshooting</div>\r\n\t\t\t\t\t\t\t\t\t<ul className=\"list-disc space-y-1 pl-4\">\r\n\t\t\t\t\t\t\t\t\t\t<li>Phone and desktop must be on the same Wi‑Fi network.</li>\r\n\t\t\t\t\t\t\t\t\t\t<li>Allow the server through your firewall (ports 8787 and {httpsInfo?.https ? httpsInfo.port : 8788}).</li>\r\n\t\t\t\t\t\t\t\t\t\t<li>On iPhone, use HTTPS links (QR will prefer HTTPS when enabled).</li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-right\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={() => setShowTips(false)}>Hide tips</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{mode === 'wifi' && !streaming && (\r\n\t\t\t\t\t\t<div className=\"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white\">\r\n\t\t\t\t\t\t\t<div className=\"font-semibold\">Wifi scoring devices</div>\r\n\t\t\t\t\t\t\t{discoveringWifi ? (\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"h-4 w-4 animate-spin rounded-full border-b-2 border-white\" />\r\n\t\t\t\t\t\t\t\t\t<span>Scanning network for devices…</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : wifiDevices.length > 0 ? (\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t{wifiDevices.map(device => (\r\n\t\t\t\t\t\t\t\t\t\t<div key={device.id} className=\"flex items-center justify-between rounded border border-slate-700/50 bg-slate-900/60 p-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{device.name}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{device.ip}:{device.port} · {device.type.toUpperCase()}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70 text-xs\">Capabilities: {device.capabilities.join(', ')}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn px-2 py-1 text-xs ${device.status === 'connecting' ? 'bg-yellow-600' : device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => connectToWifiDevice(device)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={device.status === 'connecting'}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{device.status === 'connecting' ? 'Connecting…' : 'Connect'}\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn px-2 py-1 text-xs\" onClick={startWifiConnection}>Rescan network</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t<div>No wifi scoring devices found.</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">Ensure your wifi cameras are powered on and on the same network.</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn px-2 py-1 text-xs\" onClick={startWifiConnection}>Scan again</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)\r\n}\r\n","// Very lightweight checkout suggestions. For proper coverage consider a full table.\r\n// Returns up to a few route strings like \"T20 T20 D20\" for a given remaining.\r\n\r\nconst doubles = [\r\n  'D1','D2','D3','D4','D5','D6','D7','D8','D9','D10','D11','D12','D13','D14','D15','D16','D17','D18','D19','D20','DB'\r\n]\r\n\r\nfunction dVal(tag: string): number { if (tag === 'DB') return 50; const n = Number(tag.slice(1)); return n*2 }\r\n\r\nfunction prefsDoubleScore(fav: string): number {\r\n  if (!doubles.includes(fav)) return 32 // default D16\r\n  return dVal(fav)\r\n}\r\n\r\nexport function suggestCheckouts(remaining: number, favoriteDouble: string = 'D16'): string[] {\r\n  if (remaining > 170 || remaining <= 1) return []\r\n  // Simple known highest routes for popular numbers, then fall back to greedy towards favourite double\r\n  const hardcoded: Record<number, string[]> = {\r\n    170: ['T20 T20 DB'], 167: ['T20 T19 DB'], 164: ['T20 T18 DB'], 161: ['T20 T17 DB'], 160: ['T20 T20 D20'],\r\n    158: ['T20 T20 D19'], 157: ['T20 T19 D20'], 156: ['T20 T20 D18'], 155: ['T20 T19 D19'], 154: ['T20 T18 D20'],\r\n    153: ['T20 T19 D18'], 152: ['T20 T20 D16'], 151: ['T20 T17 D20'], 150: ['T20 T18 D18'], 149: ['T20 T19 D16'],\r\n    148: ['T20 T16 D20'], 147: ['T20 T17 D18'], 146: ['T20 T18 D16'], 145: ['T20 T15 D20'], 144: ['T20 T20 D12'],\r\n    141: ['T20 T19 D12'], 140: ['T20 T20 D10'], 137: ['T20 T19 D10'], 136: ['T20 T20 D8'], 132: ['BULL T14 D20','T20 T12 D8'],\r\n    130: ['T20 T20 D5','T20 T18 D8'], 129: ['T19 T16 D12'], 128: ['T18 T14 D16'], 127: ['T20 T17 D8'], 126: ['T19 T19 D6'],\r\n    121: ['T20 11 D20','T20 T15 D8'], 120: ['T20 20 D20','T20 S20 D20'], 110: ['T20 10 D20'], 100: ['T20 D20'], 99: ['T19 10 D16','T19 S10 D16'], 97: ['T19 D20'],\r\n    96: ['T20 D18'], 95: ['T19 D19'], 94: ['T18 D20'], 92: ['T20 D16'], 90: ['T18 D18','T20 D15'], 86: ['T18 D16'], 84: ['T20 D12','T16 D18'],\r\n    82: ['BULL D16','T14 D20'], 81: ['T19 D12'], 80: ['T20 D10','D20 D20'], 78: ['T18 D12'], 76: ['T20 D8','T16 D14'], 74: ['T14 D16','T18 D10'],\r\n    72: ['T16 D12','T20 D6'], 70: ['T18 D8','S20 BULL'], 68: ['T20 D4','T16 D10'], 66: ['T10 D18','T14 D12'], 64: ['T16 D8','D16 D16'],\r\n    62: ['T10 D16','T12 D13'], 60: ['20 D20','S20 D20'], 58: ['18 D20','S18 D20'], 56: ['16 D20','S16 D20'], 54: ['14 D20','S14 D20'],\r\n    52: ['20 D16','S20 D16'], 50: ['BULL','10 D20'], 48: ['16 D16','S16 D16'], 46: ['14 D16'], 44: ['12 D16'], 42: ['10 D16'],\r\n    40: ['D20'], 38: ['D19'], 36: ['D18'], 34: ['D17'], 32: ['D16'], 30: ['D15'], 28: ['D14'], 26: ['D13'], 24: ['D12'], 22: ['D11'], 20: ['D10'], 18: ['D9'], 16: ['D8'], 14: ['D7'], 12: ['D6'], 10: ['D5'], 8: ['D4'], 6: ['D3'], 4: ['D2'], 2: ['D1']\r\n  }\r\n  if (hardcoded[remaining]) return hardcoded[remaining]\r\n  // Greedy fallback: aim to leave favourite double if possible in two darts\r\n  const target = prefsDoubleScore(favoriteDouble)\r\n  const routes: string[] = []\r\n  // Try to hit a treble/big single that leaves the fav double\r\n  for (const t of [60, 57, 54, 51, 48]) { // T20..T16\r\n    const left = remaining - t\r\n    if (left === target) { routes.push(`T${t/3} ${favoriteDouble}`); break }\r\n  }\r\n  if (!routes.length) {\r\n    for (const s of [20, 19, 18, 17, 16, 15]) {\r\n      const left = remaining - s\r\n      if (left === target) { routes.push(`${s} ${favoriteDouble}`); break }\r\n    }\r\n  }\r\n  return routes\r\n}\r\n\r\nexport function sayScore(name: string, scored: number, remaining: number, voiceName?: string, opts?: { volume?: number; checkoutOnly?: boolean }) {\r\n  try {\r\n    const synth = window.speechSynthesis\r\n    if (!synth) return\r\n    const msg = new SpeechSynthesisUtterance()\r\n    const isCheckout = remaining <= 170 && remaining > 0\r\n    if (opts?.checkoutOnly && !isCheckout) return\r\n    msg.text = isCheckout ? `${name}, you have ${remaining} remaining.` : `${scored}`\r\n    if (voiceName) {\r\n      const v = synth.getVoices().find(v => v.name === voiceName)\r\n      if (v) msg.voice = v\r\n    }\r\n    if (typeof opts?.volume === 'number') msg.volume = Math.max(0, Math.min(1, opts.volume))\r\n    msg.rate = 1.0\r\n    msg.pitch = 1.0\r\n    synth.speak(msg)\r\n  } catch {}\r\n}\r\n","import { useEffect, useMemo, useRef, useState, type CSSProperties } from 'react'\r\nimport QRCode from 'qrcode'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { discoverNetworkDevices, connectToNetworkDevice, type NetworkDevice, discoverUSBDevices, requestUSBDevice, connectToUSBDevice, type USBDevice } from '../utils/networkDevices'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype CameraTileProps = {\r\n  label?: string\r\n  autoStart?: boolean\r\n  scale?: number\r\n  className?: string\r\n  aspect?: 'inherit' | 'wide' | 'square' | 'portrait' | 'classic' | 'free'\r\n  style?: CSSProperties\r\n  fill?: boolean\r\n}\r\n\r\nexport default function CameraTile({\r\n  label,\r\n  autoStart = false,\r\n  scale: scaleOverride,\r\n  className,\r\n  aspect = 'inherit',\r\n  style,\r\n  fill = false,\r\n}: CameraTileProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null)\r\n  const [streaming, setStreaming] = useState(false)\r\n  const [ws, setWs] = useState<WebSocket | null>(null)\r\n  const [pairCode, setPairCode] = useState<string | null>(null)\r\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null)\r\n  const [mode, setMode] = useState<'local'|'phone'|'wifi'>(() => (localStorage.getItem('ndn:camera:mode') as any) || 'local')\r\n  const [expiresAt, setExpiresAt] = useState<number | null>(null)\r\n  const [now, setNow] = useState<number>(Date.now())\r\n  const [paired, setPaired] = useState<boolean>(false)\r\n  const [lanHost, setLanHost] = useState<string | null>(null)\r\n  const [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null)\r\n  const [showTips, setShowTips] = useState<boolean>(true)\r\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([])\r\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false)\r\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([])\r\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false)\r\n  const autoscoreProvider = useUserSettings(s => s.autoscoreProvider)\r\n  const setPreferredCameraLocked = useUserSettings(s => s.setPreferredCameraLocked)\r\n\r\n  if (autoscoreProvider === 'manual') {\r\n    const fallbackBase = fill ? 'rounded-2xl overflow-hidden bg-black w-full flex flex-col' : 'rounded-2xl overflow-hidden bg-black w-full mx-auto'\r\n    const fallbackClass = [fallbackBase, className].filter(Boolean).join(' ').trim()\r\n    const fallbackStyle: CSSProperties = { ...(style || {}) }\r\n    if (!fill && fallbackStyle.aspectRatio === undefined && fallbackStyle.height === undefined && fallbackStyle.minHeight === undefined) {\r\n      fallbackStyle.aspectRatio = '4 / 3'\r\n    }\r\n    return (\r\n      <div className={fallbackClass} style={fallbackStyle}>\r\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\r\n          Manual scoring mode active — camera feeds are disabled.\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n  useEffect(() => {\r\n    const h = window.location.hostname\r\n    if (h === 'localhost' || h === '127.0.0.1') {\r\n      apiFetch(`/api/hosts`).then(r => r.json()).then(j => {\r\n        const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x)\r\n        if (ip) setLanHost(ip)\r\n      }).catch(()=>{})\r\n    }\r\n    // Detect HTTPS support for the phone link\r\n    apiFetch(`/api/https-info`).then(r=>r.json()).then(j=>{\r\n      if (j && typeof j.https === 'boolean') setHttpsInfo({ https: !!j.https, port: Number(j.port)||8788 })\r\n    }).catch(()=>{})\r\n  }, [])\r\n  const mobileUrl = useMemo(() => {\r\n    const code = pairCode || '____'\r\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    if (envUrl && envUrl.length > 0) {\r\n      try {\r\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\r\n        const u = new URL(envUrl)\r\n        const isSecure = u.protocol === 'wss:'\r\n        const origin = `${isSecure ? 'https' : 'http'}://${u.host}${u.pathname.endsWith('/ws') ? '' : u.pathname}`\r\n        const base = origin.replace(/\\/?ws$/i, '')\r\n        return `${base}/mobile-cam.html?code=${code}`\r\n      } catch {}\r\n    }\r\n    // Fallback to local development: prefer LAN host if detected\r\n    const host = (lanHost || window.location.hostname)\r\n    const useHttps = !!httpsInfo?.https\r\n    const port = useHttps ? (httpsInfo?.port || 8788) : 8787\r\n    const proto = useHttps ? 'https' : 'http'\r\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`\r\n  }, [pairCode, lanHost, httpsInfo])\r\n  useEffect(() => { localStorage.setItem('ndn:camera:mode', mode) }, [mode])\r\n  const [qrDataUrl, setQrDataUrl] = useState<string>('')\r\n  useEffect(() => {\r\n    if (!pairCode) { setQrDataUrl(''); return }\r\n    QRCode.toDataURL(mobileUrl, { width: 160, margin: 1, color: { dark: '#000000', light: '#ffffff' } })\r\n      .then(setQrDataUrl)\r\n      .catch(() => setQrDataUrl(''))\r\n  }, [mobileUrl, pairCode])\r\n  useEffect(() => {\r\n    if (!expiresAt) return\r\n    const t = setInterval(() => setNow(Date.now()), 1000)\r\n    return () => clearInterval(t)\r\n  }, [expiresAt])\r\n  const ttl = useMemo(() => expiresAt ? Math.max(0, Math.ceil((expiresAt - now)/1000)) : null, [expiresAt, now])\r\n  // Intentionally disabled automatic regeneration of phone pairing codes.\r\n  // Codes will only be created when the user explicitly requests it (button click).\r\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\r\n\r\n  useEffect(() => {\r\n    if (autoStart) {\r\n      start().catch(()=>{})\r\n    } else {\r\n      stop()\r\n    }\r\n  }, [autoStart])\r\n\r\n  async function start() {\r\n    if (mode === 'wifi') {\r\n      return startWifiConnection()\r\n    }\r\n\r\n    try {\r\n      // Prefer saved camera if available\r\n      const { preferredCameraId, setPreferredCamera } = useUserSettings.getState()\r\n      const constraints: MediaStreamConstraints = preferredCameraId ? { video: { deviceId: { exact: preferredCameraId } }, audio: false } : { video: true, audio: false }\r\n      let stream: MediaStream\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints)\r\n      } catch (err: any) {\r\n        const name = (err && (err.name || err.code)) || ''\r\n        if (preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError')) {\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else {\r\n          throw err\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n      }\r\n      // Camera started successfully - no automatic preference updates\r\n    } catch {}\r\n  }\r\n  function stop() {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n      tracks.forEach(t => t.stop())\r\n      videoRef.current.srcObject = null\r\n      setStreaming(false)\r\n    }\r\n  }\r\n\r\n  async function startWifiConnection() {\r\n    setDiscoveringWifi(true)\r\n    try {\r\n      const devices = await discoverNetworkDevices()\r\n      setWifiDevices(devices)\r\n      if (devices.length === 0) {\r\n        alert('No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.')\r\n      }\r\n    } catch (error) {\r\n      console.error('Wifi device discovery failed:', error)\r\n      alert('Failed to discover wifi devices. Please check your network connection.')\r\n    } finally {\r\n      setDiscoveringWifi(false)\r\n    }\r\n  }\r\n\r\n  async function connectToWifiDevice(device: NetworkDevice) {\r\n    try {\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n\r\n      const stream = await connectToNetworkDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        setWifiDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to wifi device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  async function startUsbConnection() {\r\n    setDiscoveringUsb(true)\r\n    try {\r\n      // First try to get already paired devices\r\n      const devices = await discoverUSBDevices()\r\n      setUsbDevices(devices)\r\n\r\n      // Then request user to select a new device\r\n      const newDevice = await requestUSBDevice()\r\n      if (newDevice) {\r\n        setUsbDevices(prev => [...prev, newDevice])\r\n      }\r\n\r\n      if (devices.length === 0 && !newDevice) {\r\n        alert('No USB scoring devices found. Please connect a device and try again.')\r\n      }\r\n    } catch (error) {\r\n      console.error('USB device discovery failed:', error)\r\n      alert('Failed to discover USB devices. Please check device connections.')\r\n    } finally {\r\n      setDiscoveringUsb(false)\r\n    }\r\n  }\r\n\r\n  async function connectToUsbDevice(device: USBDevice) {\r\n    try {\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n      const stream = await connectToUSBDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        setMode('wifi') // Using wifi mode for USB devices too\r\n        setUsbDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to USB device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  // Phone pairing via WebRTC\r\n  function ensureWS() {\r\n    if (ws && ws.readyState === WebSocket.OPEN) return ws\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    const normalizedEnv = envUrl && envUrl.length > 0\r\n      ? (envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws')\r\n      : undefined\r\n    const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n    const sameOrigin = `${proto}://${window.location.host}/ws`\r\n    const host = window.location.hostname\r\n    const isLocalhost = host === 'localhost' || host === '127.0.0.1'\r\n    const isRenderHost = host.endsWith('onrender.com')\r\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\r\n    const renderWS = `wss://ninedartnation.onrender.com/ws`\r\n    let url = normalizedEnv\r\n    if (!url) {\r\n      if (isLocalhost) {\r\n        url = `${proto}://${host}:8787/ws`\r\n      } else if (isRenderHost) {\r\n        url = sameOrigin\r\n      } else {\r\n        url = renderWS\r\n      }\r\n    }\r\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\r\n    if (!url) url = sameOrigin\r\n    const socket = new WebSocket(url)\r\n    setWs(socket)\r\n    return socket\r\n  }\r\n  async function startPhonePairing() {\r\n    setMode('phone')\r\n    setPaired(false)\r\n    const socket = ensureWS()\r\n    if (socket.readyState === WebSocket.OPEN) {\r\n      socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      socket.onopen = () => socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    }\r\n    socket.onmessage = async (ev) => {\r\n      const data = JSON.parse(ev.data)\r\n      if (data.type === 'cam-code') {\r\n        setPairCode(data.code)\r\n        if (data.expiresAt) setExpiresAt(data.expiresAt)\r\n      } else if (data.type === 'cam-peer-joined') {\r\n        setPaired(true)\r\n        // Create offer to the phone\r\n        const peer = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] })\r\n        setPc(peer)\r\n        peer.onicecandidate = (e) => {\r\n          if (e.candidate && pairCode) socket.send(JSON.stringify({ type: 'cam-ice', code: pairCode, payload: e.candidate }))\r\n        }\r\n        peer.ontrack = (ev) => {\r\n          if (videoRef.current) {\r\n            const inbound = ev.streams?.[0]\r\n            if (inbound) {\r\n              videoRef.current.srcObject = inbound\r\n              videoRef.current.play().catch(()=>{})\r\n              setStreaming(true)\r\n            }\r\n          }\r\n        }\r\n        const offer = await peer.createOffer({ offerToReceiveAudio: false, offerToReceiveVideo: true })\r\n        await peer.setLocalDescription(offer)\r\n        if (pairCode) socket.send(JSON.stringify({ type: 'cam-offer', code: pairCode, payload: offer }))\r\n      } else if (data.type === 'cam-answer') {\r\n        if (pc) await pc.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n      } else if (data.type === 'cam-ice') {\r\n        if (pc) try { await pc.addIceCandidate(data.payload) } catch {}\r\n      }\r\n    }\r\n  }\r\n  function regenerateCode() {\r\n    setPairCode(null)\r\n    setExpiresAt(null)\r\n    setPaired(false)\r\n    if (ws && ws.readyState === WebSocket.OPEN) {\r\n      ws.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      startPhonePairing()\r\n    }\r\n    try { setPreferredCameraLocked(true) } catch {}\r\n  }\r\n\r\n  function stopAll() {\r\n    stop()\r\n    setPairCode(null)\r\n    setPaired(false)\r\n    setExpiresAt(null)\r\n    if (pc) { try { pc.close() } catch {}; setPc(null) }\r\n  }\r\n  return (\r\n    <CameraFrame \r\n      label={label} \r\n      autoStart={autoStart} \r\n      start={start} \r\n      stopAll={stopAll} \r\n      startPhonePairing={startPhonePairing} \r\n      startWifiConnection={startWifiConnection}\r\n      startUsbConnection={startUsbConnection}\r\n      connectToWifiDevice={connectToWifiDevice}\r\n      connectToUsbDevice={connectToUsbDevice}\r\n      videoRef={videoRef} \r\n      streaming={streaming} \r\n      mode={mode} \r\n      setMode={setMode} \r\n      pairCode={pairCode} \r\n      mobileUrl={mobileUrl} \r\n      ttl={ttl} \r\n      qrDataUrl={qrDataUrl} \r\n      regenerateCode={regenerateCode} \r\n      httpsInfo={httpsInfo} \r\n      showTips={showTips} \r\n      setShowTips={setShowTips} \r\n      wifiDevices={wifiDevices}\r\n      usbDevices={usbDevices}\r\n      discoveringWifi={discoveringWifi}\r\n      discoveringUsb={discoveringUsb}\r\n      scaleOverride={scaleOverride} \r\n      className={className}\r\n      aspect={aspect}\r\n      style={style}\r\n      fill={fill}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CameraFrame(props: any) {\r\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings()\r\n  const scale = Math.max(0.5, Math.min(1.25, Number(props.scaleOverride ?? cameraScale ?? 1)))\r\n  const {\r\n    label,\r\n    start,\r\n    stopAll,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n    startUsbConnection,\r\n    connectToWifiDevice,\r\n    connectToUsbDevice,\r\n    videoRef,\r\n    streaming,\r\n    mode,\r\n    setMode,\r\n    pairCode,\r\n    mobileUrl,\r\n    ttl,\r\n    qrDataUrl,\r\n    regenerateCode,\r\n    httpsInfo,\r\n    showTips,\r\n    setShowTips,\r\n    wifiDevices,\r\n    usbDevices,\r\n    discoveringWifi,\r\n    discoveringUsb,\r\n    className,\r\n    aspect,\r\n    style,\r\n    fill,\r\n  } = props\r\n\r\n  const [copyFeedback, setCopyFeedback] = useState<'link' | 'code' | null>(null)\r\n  const copyTimeoutRef = useRef<number | null>(null)\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n    }\r\n  }, [])\r\n\r\n  const aspectChoice: 'wide' | 'square' | 'portrait' | 'classic' | 'free' = aspect && aspect !== 'inherit'\r\n    ? aspect\r\n    : (storedAspect as any) || 'wide'\r\n\r\n  const shouldMaintainAspect = aspectChoice !== 'free'\r\n  const aspectClass = shouldMaintainAspect\r\n    ? aspectChoice === 'square'\r\n      ? 'aspect-square'\r\n      : aspectChoice === 'portrait'\r\n        ? 'aspect-[3/4]'\r\n        : aspectChoice === 'classic'\r\n          ? 'aspect-[4/3]'\r\n          : 'aspect-video'\r\n    : ''\r\n\r\n  const containerBase = fill\r\n    ? 'rounded-2xl overflow-hidden bg-black w-full flex flex-col'\r\n    : 'rounded-2xl overflow-hidden bg-black w-full mx-auto flex flex-col'\r\n  const containerClass = [containerBase, className].filter(Boolean).join(' ').trim()\r\n  const containerStyle: CSSProperties = { ...(style || {}) }\r\n\r\n  const viewportClass = fill ? 'relative flex-1 min-h-[220px] bg-black' : 'relative w-full bg-black'\r\n\r\n  const commonVideoProps = {\r\n    style: { transform: `scale(${scale})`, transformOrigin: 'center' as const },\r\n  }\r\n\r\n  const videoElement = (() => {\r\n    const videoClass = 'absolute inset-0 w-full h-full object-contain object-center bg-black'\r\n    if (fill) {\r\n      if (shouldMaintainAspect) {\r\n        return (\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div className={`relative w-full max-w-full max-h-full ${aspectClass}`}>\r\n              <video ref={videoRef} className={videoClass} {...commonVideoProps} />\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n      return <video ref={videoRef} className={videoClass} {...commonVideoProps} />\r\n    }\r\n    if (shouldMaintainAspect) {\r\n      return (\r\n        <div className={`relative w-full ${aspectClass}`}>\r\n          <video ref={videoRef} className={videoClass} {...commonVideoProps} />\r\n        </div>\r\n      )\r\n    }\r\n    return <video ref={videoRef} className=\"w-full h-full object-contain object-center bg-black\" {...commonVideoProps} />\r\n  })()\r\n\r\n  async function copyValue(value: string | null | undefined, type: 'link' | 'code') {\r\n    if (!value) return\r\n    try {\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        await navigator.clipboard.writeText(value)\r\n      } else {\r\n        const textarea = document.createElement('textarea')\r\n        textarea.value = value\r\n        textarea.style.position = 'fixed'\r\n        textarea.style.opacity = '0'\r\n        document.body.appendChild(textarea)\r\n        textarea.focus()\r\n        textarea.select()\r\n        document.execCommand('copy')\r\n        document.body.removeChild(textarea)\r\n      }\r\n      setCopyFeedback(type)\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n      copyTimeoutRef.current = window.setTimeout(() => setCopyFeedback(null), 1500)\r\n    } catch (err) {\r\n      console.warn('Copy to clipboard failed:', err)\r\n      setCopyFeedback(null)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={containerClass} style={containerStyle}>\r\n      <div className={viewportClass}>{videoElement}</div>\r\n      <div className=\"p-1 flex items-center justify-between bg-black/60 text-white text-[10px] gap-1\">\r\n        <span className=\"truncate\">{label || (streaming ? (mode==='phone' ? 'PHONE LIVE' : mode==='wifi' ? 'WIFI LIVE' : 'LIVE') : 'Camera')}</span>\r\n        <div className=\"flex items-center gap-1\">\r\n          {!streaming && (\r\n            <>\r\n              <button className={`px-1 py-0.5 rounded ${mode==='local'?'bg-emerald-600':'bg-slate-700'}`} onClick={() => { setMode('local'); start() }}>Local</button>\r\n              <button className={`px-1 py-0.5 rounded ${mode==='phone'?'bg-emerald-600':'bg-slate-700'}`} onClick={startPhonePairing}>Phone</button>\r\n              <button className={`px-1 py-0.5 rounded ${mode==='wifi'?'bg-emerald-600':'bg-slate-700'}`} onClick={() => { setMode('wifi'); startWifiConnection() }}>Wifi</button>\r\n              <button className={`px-1 py-0.5 rounded ${mode==='wifi'?'bg-emerald-600':'bg-slate-700'}`} onClick={() => { setMode('wifi'); startUsbConnection() }}>USB</button>\r\n            </>\r\n          )}\r\n          {streaming ? (\r\n            <button className=\"px-1 py-0.5 rounded bg-rose-600\" onClick={stopAll}>Stop</button>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n      {mode==='phone' && pairCode && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\r\n          <button\r\n            type=\"button\"\r\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\r\n            onClick={() => copyValue(mobileUrl, 'link')}\r\n            title=\"Copy mobile camera link\"\r\n          >\r\n            <span className=\"flex-1 min-w-0 font-mono break-all\">{mobileUrl}</span>\r\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'link' ? 'Copied!' : 'Copy'}</span>\r\n          </button>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <a\r\n              href={mobileUrl}\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\r\n            >\r\n              Open link\r\n            </a>\r\n            <button\r\n              type=\"button\"\r\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n              onClick={() => copyValue(pairCode, 'code')}\r\n              title=\"Copy pairing code\"\r\n            >\r\n              <span className=\"font-mono tracking-[0.3em] text-sm\">{pairCode}</span>\r\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'code' ? 'Copied!' : 'Copy'}</span>\r\n            </button>\r\n          </div>\r\n          {qrDataUrl && <img className=\"mt-1 w-[160px] h-[160px] bg-white rounded\" alt=\"Scan to open\" src={qrDataUrl} />}\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            {ttl !== null && <span>Expires in {ttl}s</span>}\r\n            <button className=\"px-1 py-0.5 rounded bg-slate-700\" onClick={regenerateCode}>Regenerate</button>\r\n          </div>\r\n          {showTips && (\r\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\r\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\r\n              <ul className=\"list-disc pl-4 space-y-1\">\r\n                <li>Phone and desktop must be on the same Wi‑Fi network.</li>\r\n                <li>Allow the server through your firewall (ports 8787 and {httpsInfo?.https ? httpsInfo.port : 8788}).</li>\r\n                <li>On iPhone, use HTTPS links (QR will prefer https when enabled).</li>\r\n              </ul>\r\n              <div className=\"mt-2 text-right\"><button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={()=>setShowTips(false)}>Hide tips</button></div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      {mode==='wifi' && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\r\n          \r\n          {/* WiFi Devices */}\r\n          <div className=\"mb-3\">\r\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\r\n            {discoveringWifi ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning network...</span>\r\n              </div>\r\n            ) : wifiDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {wifiDevices.map((device: NetworkDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.ip}:{device.port}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToWifiDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Rescan WiFi</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Scan WiFi</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* USB Devices */}\r\n          <div>\r\n            <div className=\"font-medium mb-1\">USB Devices</div>\r\n            {discoveringUsb ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning USB...</span>\r\n              </div>\r\n            ) : usbDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {usbDevices.map((device: USBDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.type.toUpperCase()}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToUsbDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Rescan USB</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Scan USB</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","import { create } from 'zustand'\r\n\r\nexport type ThrowVisit = { darts: number; score: number } // e.g., 3 darts, scored 100\r\nexport type Leg = {\r\n  visits: ThrowVisit[]\r\n  totalScoreStart: number // e.g., 501\r\n  totalScoreRemaining: number\r\n  dartsThrown: number\r\n  finished: boolean\r\n  checkoutScore: number | null // score taken on final visit to finish leg\r\n  startTime: number\r\n  endTime?: number\r\n}\r\n\r\nexport type Player = {\r\n  id: string\r\n  name: string\r\n  legsWon: number\r\n  legs: Leg[]\r\n  bestThreeDartAvg?: number\r\n  worstThreeDartAvg?: number\r\n  bestNineDart?: { darts: number; timestamp: number }\r\n  bestCheckout?: number\r\n}\r\n\r\nexport type MatchState = {\r\n  roomId: string\r\n  players: Player[]\r\n  currentPlayerIdx: number\r\n  startingScore: number\r\n  inProgress: boolean\r\n  bestLegThisMatch?: { playerId: string; darts: number; timestamp: number }\r\n}\r\n\r\nfunction calcThreeDartAvg(leg: Leg): number {\r\n  if (leg.dartsThrown === 0) return 0\r\n  const scored = leg.totalScoreStart - leg.totalScoreRemaining\r\n  return (scored / leg.dartsThrown) * 3\r\n}\r\n\r\nfunction finishedLegStats(leg: Leg) {\r\n  // compute 3-dart avg, was it a 9-dart (or lowest darts)?\r\n  const avg = calcThreeDartAvg(leg)\r\n  const isCompleted = leg.finished\r\n  return { avg, isCompleted, darts: leg.dartsThrown, checkout: leg.checkoutScore ?? 0 }\r\n}\r\n\r\nfunction updatePlayerEndOfGameStats(player: Player) {\r\n  if (player.legs.length === 0) return\r\n  const avgs: number[] = []\r\n  let bestNine: { darts: number; timestamp: number } | undefined\r\n  let bestCheckout = player.bestCheckout ?? 0\r\n\r\n  for (const leg of player.legs) {\r\n    if (!leg.finished) continue\r\n    const st = finishedLegStats(leg)\r\n    avgs.push(st.avg)\r\n    // best \"9-dart leg\" meaning fewest darts; if tie pick earliest\r\n    if (!bestNine || st.darts < bestNine.darts || (st.darts === bestNine.darts && (leg.endTime ?? 0) < bestNine.timestamp)) {\r\n      bestNine = { darts: st.darts, timestamp: leg.endTime ?? Date.now() }\r\n    }\r\n    if (st.checkout > bestCheckout) bestCheckout = st.checkout\r\n  }\r\n\r\n  if (avgs.length) {\r\n    player.bestThreeDartAvg = Math.max(...avgs)\r\n    player.worstThreeDartAvg = Math.min(...avgs)\r\n  }\r\n  if (bestNine) player.bestNineDart = bestNine\r\n  player.bestCheckout = bestCheckout\r\n}\r\n\r\nexport type Actions = {\r\n  newMatch: (players: string[], startingScore: number, roomId?: string) => void\r\n  addVisit: (score: number, darts: number) => void\r\n  undoVisit: () => void\r\n  endLeg: (checkoutScore: number) => void\r\n  nextPlayer: () => void\r\n  endGame: () => void\r\n  importState: (state: MatchState) => void\r\n}\r\n\r\nexport const useMatch = create<MatchState & Actions>((set, get) => ({\r\n  roomId: '',\r\n  players: [],\r\n  currentPlayerIdx: 0,\r\n  startingScore: 501,\r\n  inProgress: false,\r\n\r\n  newMatch: (playerNames, startingScore, roomId='') => set(() => {\r\n    const players = playerNames.map((name, i) => ({\r\n      id: `${i}`,\r\n      name,\r\n      legsWon: 0,\r\n      legs: [],\r\n    } as Player))\r\n    return { players, currentPlayerIdx: 0, startingScore, inProgress: true, roomId, bestLegThisMatch: undefined }\r\n  }),\r\n\r\n  addVisit: (score, darts) => set((state) => {\r\n    if (!state.inProgress) return state\r\n    const p = state.players[state.currentPlayerIdx]\r\n    // ensure a current leg exists\r\n    let leg = p.legs[p.legs.length-1]\r\n    if (!leg || leg.finished) {\r\n      leg = {\r\n        visits: [], totalScoreStart: state.startingScore, totalScoreRemaining: state.startingScore,\r\n        dartsThrown: 0, finished: false, checkoutScore: null, startTime: Date.now()\r\n      }\r\n      p.legs.push(leg)\r\n    }\r\n    leg.visits.push({ darts, score })\r\n    leg.dartsThrown += darts\r\n    leg.totalScoreRemaining = Math.max(0, leg.totalScoreRemaining - score)\r\n    return { ...state }\r\n  }),\r\n\r\n  undoVisit: () => set((state) => {\r\n    const p = state.players[state.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length-1]\r\n    if (!leg || leg.finished || leg.visits.length === 0) return state\r\n    const last = leg.visits.pop()!\r\n    leg.dartsThrown -= last.darts\r\n    leg.totalScoreRemaining += last.score\r\n    return { ...state }\r\n  }),\r\n\r\n  endLeg: (checkoutScore) => set((state) => {\r\n    const p = state.players[state.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length-1]\r\n    if (!leg || leg.finished) return state\r\n    leg.finished = true\r\n    leg.checkoutScore = checkoutScore\r\n    leg.endTime = Date.now()\r\n    if (leg.totalScoreRemaining === 0) {\r\n      p.legsWon += 1\r\n      // Check if this leg is the new best for this match (fewest darts)\r\n      const best = state.bestLegThisMatch\r\n      if (!best || (leg.dartsThrown < best.darts)) {\r\n        state.bestLegThisMatch = { playerId: p.id, darts: leg.dartsThrown, timestamp: leg.endTime }\r\n      }\r\n    }\r\n    return { ...state }\r\n  }),\r\n\r\n  nextPlayer: () => set((state) => ({\r\n    ...state,\r\n    currentPlayerIdx: (state.currentPlayerIdx + 1) % state.players.length\r\n  })),\r\n\r\n  endGame: () => set((state) => {\r\n    // Only now compute best/worst 3-dart, best 9-dart, best checkout\r\n    for (const p of state.players) updatePlayerEndOfGameStats(p)\r\n    return { ...state, inProgress: false }\r\n  }),\r\n\r\n  importState: (newState) => set(() => ({ ...newState })),\r\n}))\r\n","import type { Homography, Point } from './vision'\r\nimport { imageToBoard, scoreAtBoardPoint } from './vision'\r\n\r\nexport function scoreFromImagePoint(H_boardToImage: Homography, pImg: Point) {\r\n\tconst pBoard = imageToBoard(H_boardToImage, pImg)\r\n\treturn scoreAtBoardPoint(pBoard)\r\n}\r\n","// Generic autoscore provider helpers: parse vendor-agnostic payloads and subscribe via WebSocket\r\n\r\nexport type Ring = 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\nexport type ParsedDart = { value: number; ring: Ring; sector?: number|null; mult?: 0|1|2|3 }\r\n\r\n// Try to parse a variety of vendor payload shapes\r\nexport function parseExternalDart(data: any): ParsedDart | null {\r\n  try {\r\n    if (!data || typeof data !== 'object') return null\r\n    // 1) { type:'dart', value: <0-60>, ring: 'SINGLE'|'DOUBLE'|... }\r\n    if ((data.type === 'dart' || data.kind === 'dart' || data.event === 'dart') && typeof data.value === 'number') {\r\n      const ring = normalizeRing(data.ring)\r\n      return finalizeFromValue(data.value, ring)\r\n    }\r\n    // 2) { value, ring }\r\n    if (typeof data.value === 'number' && data.ring) {\r\n      const ring = normalizeRing(data.ring)\r\n      return finalizeFromValue(data.value, ring)\r\n    }\r\n    // 3) { score: 'T20'|'D16'|'S5'|'25'|'50' }\r\n    if (typeof data.score === 'string') {\r\n      const s = data.score.trim().toUpperCase()\r\n      if (s === '50' || s === 'DBULL' || s === 'INNER_BULL') return { value: 50, ring: 'INNER_BULL', sector: null, mult: 0 }\r\n      if (s === '25' || s === 'BULL' || s === 'OBULL') return { value: 25, ring: 'BULL', sector: null, mult: 0 }\r\n      const m = s.match(/^(S|D|T)(\\d{1,2})$/)\r\n      if (m) {\r\n        const mult = m[1] === 'S' ? 1 : m[1] === 'D' ? 2 : 3\r\n        const sec = parseInt(m[2],10)\r\n        if (sec >=1 && sec <= 20) return { value: sec*mult, ring: mult===1?'SINGLE':mult===2?'DOUBLE':'TRIPLE', sector: sec, mult: mult as 1|2|3 }\r\n      }\r\n    }\r\n    // 4) { sector: 1..20, mult: 1|2|3 }\r\n    if (typeof data.sector === 'number' && typeof data.mult === 'number') {\r\n      const sec = Math.max(1, Math.min(20, Math.floor(data.sector)))\r\n      const mul = data.mult===1?1:data.mult===2?2:3\r\n      return { value: sec*mul, ring: mul===1?'SINGLE':mul===2?'DOUBLE':'TRIPLE', sector: sec, mult: mul as 1|2|3 }\r\n    }\r\n    // 5) { bull: 'outer'|'inner'|true }\r\n    if (data.bull) {\r\n      const inner = String(data.bull).toLowerCase() === 'inner' || data.bull === true\r\n      return { value: inner?50:25, ring: inner?'INNER_BULL':'BULL', sector: null, mult: 0 }\r\n    }\r\n  } catch {}\r\n  return null\r\n}\r\n\r\nfunction normalizeRing(r: any): Ring {\r\n  const s = String(r||'').toUpperCase()\r\n  if (s.startsWith('TR')) return 'TRIPLE'\r\n  if (s.startsWith('DO')) return 'DOUBLE'\r\n  if (s.startsWith('SI')) return 'SINGLE'\r\n  if (s === 'INNER_BULL' || s === 'DBULL' || s === '50' || s === 'IBULL') return 'INNER_BULL'\r\n  if (s === 'BULL' || s === '25' || s === 'OBULL' || s === 'OUTER_BULL') return 'BULL'\r\n  if (s === 'MISS' || s === '0') return 'MISS'\r\n  return 'SINGLE'\r\n}\r\n\r\nfunction finalizeFromValue(value: number, ring: Ring): ParsedDart | null {\r\n  const v = Math.max(0, Math.min(60, Math.round(Number(value)||0)))\r\n  if (ring === 'INNER_BULL') return { value: 50, ring }\r\n  if (ring === 'BULL') return { value: 25, ring }\r\n  // Best-effort: preserve base if consistent with ring\r\n  return { value: v, ring }\r\n}\r\n\r\nexport type ExternalSub = { close: () => void }\r\n\r\nexport function subscribeExternalWS(url: string, onDart: (d: ParsedDart) => void): ExternalSub {\r\n  let socket: WebSocket | null = null\r\n  let alive = true\r\n  function connect() {\r\n    if (!alive) return\r\n    try {\r\n      socket = new WebSocket(url)\r\n      socket.onmessage = (ev) => {\r\n        try {\r\n          const payload = JSON.parse(ev.data)\r\n          const parsed = parseExternalDart(payload)\r\n          if (parsed) onDart(parsed)\r\n        } catch {}\r\n      }\r\n      socket.onclose = () => { socket = null; setTimeout(connect, 1500) }\r\n      socket.onerror = () => { /* ignore; will reconnect on close */ }\r\n    } catch {\r\n      setTimeout(connect, 2000)\r\n    }\r\n  }\r\n  connect()\r\n  return { close: () => { alive = false; try { socket?.close() } catch {} } }\r\n}\r\n","import React, { useEffect, useRef, useState, type ReactNode, type CSSProperties } from 'react'\r\n\r\ntype Props = {\r\n  storageKey: string\r\n  children: ReactNode\r\n  className?: string\r\n  defaultWidth?: number\r\n  defaultHeight?: number\r\n  minWidth?: number\r\n  minHeight?: number\r\n  maxWidth?: number\r\n  maxHeight?: number\r\n}\r\n\r\ntype Size = { width?: number; height?: number }\r\n\r\nexport default function ResizablePanel({\r\n  storageKey,\r\n  children,\r\n  className,\r\n  defaultWidth = 640,\r\n  defaultHeight = 360,\r\n  minWidth = 320,\r\n  minHeight = 200,\r\n  maxWidth = 1600,\r\n  maxHeight = 1200,\r\n}: Props) {\r\n  const [size, setSize] = useState<Size>(() => {\r\n    try { const raw = localStorage.getItem(storageKey); if (raw) return JSON.parse(raw) } catch {}\r\n    return { width: defaultWidth, height: defaultHeight }\r\n  })\r\n  const startRef = useRef<{ x: number; y: number; w: number; h: number; dir: string } | null>(null)\r\n  const containerRef = useRef<HTMLDivElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    function onReset() {\r\n      try { localStorage.removeItem(storageKey) } catch {}\r\n      setSize({ width: defaultWidth, height: defaultHeight })\r\n    }\r\n    window.addEventListener('ndn:layout-reset' as any, onReset)\r\n    window.addEventListener('ndn:camera-reset' as any, onReset)\r\n    return () => {\r\n      window.removeEventListener('ndn:layout-reset' as any, onReset)\r\n      window.removeEventListener('ndn:camera-reset' as any, onReset)\r\n    }\r\n  }, [storageKey, defaultWidth, defaultHeight])\r\n\r\n  useEffect(() => { try { localStorage.setItem(storageKey, JSON.stringify(size)) } catch {} }, [size, storageKey])\r\n\r\n  function clamp(n: number, min: number, max: number) { return Math.max(min, Math.min(max, n)) }\r\n  function beginResize(e: React.MouseEvent, dir: string) {\r\n    e.preventDefault(); const el = containerRef.current; if (!el) return\r\n    const rect = el.getBoundingClientRect()\r\n    startRef.current = { x: e.clientX, y: e.clientY, w: rect.width, h: rect.height, dir }\r\n    window.addEventListener('mousemove', onMove)\r\n    window.addEventListener('mouseup', endResize)\r\n  }\r\n  function onMove(e: globalThis.MouseEvent) {\r\n    const s = startRef.current; if (!s) return\r\n    const dx = e.clientX - s.x; const dy = e.clientY - s.y\r\n    let w = s.w; let h = s.h\r\n    if (s.dir.includes('e')) w = clamp(s.w + dx, minWidth, maxWidth)\r\n    if (s.dir.includes('s')) h = clamp(s.h + dy, minHeight, maxHeight)\r\n    if (s.dir.includes('w')) w = clamp(s.w - dx, minWidth, maxWidth)\r\n    if (s.dir.includes('n')) h = clamp(s.h - dy, minHeight, maxHeight)\r\n    setSize({ width: Math.round(w), height: Math.round(h) })\r\n  }\r\n  function endResize() { window.removeEventListener('mousemove', onMove); window.removeEventListener('mouseup', endResize); startRef.current = null }\r\n\r\n  const style: CSSProperties = {\r\n    width: size.width ? `${size.width}px` : undefined,\r\n    height: size.height ? `${size.height}px` : undefined,\r\n    maxWidth: '100%',\r\n    maxHeight: '80vh',\r\n    position: 'relative',\r\n  }\r\n\r\n  return (\r\n    <div ref={containerRef} className={`${className || ''}`} style={style}>\r\n      {children}\r\n      <div className=\"resizer resizer-nw\" onMouseDown={(e)=>beginResize(e,'nw')} />\r\n      <div className=\"resizer resizer-ne\" onMouseDown={(e)=>beginResize(e,'ne')} />\r\n      <div className=\"resizer resizer-sw\" onMouseDown={(e)=>beginResize(e,'sw')} />\r\n      <div className=\"resizer resizer-se\" onMouseDown={(e)=>beginResize(e,'se')} />\r\n    </div>\r\n  )\r\n}\r\n","import React, { useEffect, useRef, useState, type ReactNode, type CSSProperties } from 'react'\r\n\r\ntype Props = {\r\n  storageKey: string\r\n  children: ReactNode\r\n  className?: string\r\n  defaultWidth?: number\r\n  defaultHeight?: number\r\n  minWidth?: number\r\n  minHeight?: number\r\n  maxWidth?: number\r\n  maxHeight?: number\r\n  fullScreen?: boolean\r\n  initialFitHeight?: boolean\r\n}\r\n\r\ntype Size = { width?: number; height?: number }\r\n\r\nexport default function ResizableModal({\r\n  storageKey,\r\n  children,\r\n  className,\r\n  defaultWidth = 520,\r\n  defaultHeight,\r\n  minWidth = 360,\r\n  minHeight = 200,\r\n  maxWidth = 1100,\r\n  maxHeight = 900,\r\n  fullScreen = false,\r\n  initialFitHeight = false,\r\n}: Props) {\r\n  const [size, setSize] = useState<Size>(() => {\r\n    if (!fullScreen) {\r\n      try {\r\n        const raw = localStorage.getItem(storageKey)\r\n        if (raw) return JSON.parse(raw)\r\n      } catch {}\r\n      return { width: defaultWidth, height: defaultHeight }\r\n    }\r\n    return {}\r\n  })\r\n  const startRef = useRef<{ x: number; y: number; w: number; h: number; dir: string } | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (fullScreen) return\r\n    function onReset() {\r\n      try { localStorage.removeItem(storageKey) } catch {}\r\n      // If initialFitHeight is enabled, prefer fitting to parent height on reset\r\n      if (initialFitHeight && containerRef.current?.parentElement) {\r\n        const parent = containerRef.current.parentElement as HTMLElement\r\n        const cs = window.getComputedStyle(parent)\r\n        const padTop = parseFloat(cs.paddingTop || '0') || 0\r\n        const padBottom = parseFloat(cs.paddingBottom || '0') || 0\r\n        const inner = Math.max(0, parent.clientHeight - padTop - padBottom)\r\n        const target = Math.max(minHeight, Math.min(maxHeight, Math.round(inner)))\r\n        setSize({ width: defaultWidth, height: target })\r\n        return\r\n      }\r\n      setSize({ width: defaultWidth, height: defaultHeight })\r\n    }\r\n    window.addEventListener('ndn:layout-reset' as any, onReset)\r\n    return () => window.removeEventListener('ndn:layout-reset' as any, onReset)\r\n  }, [storageKey, defaultWidth, defaultHeight, fullScreen])\r\n\r\n  useEffect(() => {\r\n    if (fullScreen) return\r\n    try { localStorage.setItem(storageKey, JSON.stringify(size)) } catch {}\r\n  }, [size, storageKey, fullScreen])\r\n\r\n  // Optionally fit initial height to the available parent container when no saved size exists\r\n  useEffect(() => {\r\n    if (fullScreen || !initialFitHeight) return\r\n    const parent = containerRef.current?.parentElement as HTMLElement | null\r\n    if (!parent) return\r\n    const cs = window.getComputedStyle(parent)\r\n    const padTop = parseFloat(cs.paddingTop || '0') || 0\r\n    const padBottom = parseFloat(cs.paddingBottom || '0') || 0\r\n    const inner = Math.max(0, parent.clientHeight - padTop - padBottom)\r\n    const target = Math.max(minHeight, Math.min(maxHeight, Math.round(inner)))\r\n    try {\r\n      const saved = localStorage.getItem(storageKey)\r\n      if (saved) {\r\n        const savedSize = JSON.parse(saved) as Size\r\n        const h = savedSize?.height || 0\r\n        // If saved height is smaller than available, bump it to fill the frame bottom\r\n        if (!h || h < target) {\r\n          setSize(s => ({ ...s, height: target }))\r\n        }\r\n        return\r\n      }\r\n    } catch {}\r\n    setSize(s => ({ ...s, height: target }))\r\n  }, [initialFitHeight, fullScreen, storageKey, minHeight, maxHeight])\r\n\r\n  function clamp(n: number, min: number, max: number) {\r\n    return Math.max(min, Math.min(max, n))\r\n  }\r\n\r\n  function beginResize(e: React.MouseEvent, dir: string) {\r\n    e.preventDefault()\r\n    const el = containerRef.current\r\n    if (!el) return\r\n    const rect = el.getBoundingClientRect()\r\n    startRef.current = { x: e.clientX, y: e.clientY, w: rect.width, h: rect.height, dir }\r\n    window.addEventListener('mousemove', onMove)\r\n    window.addEventListener('mouseup', endResize)\r\n  }\r\n\r\n  function onMove(e: MouseEvent) {\r\n    const s = startRef.current\r\n    if (!s) return\r\n    const dx = e.clientX - s.x\r\n    const dy = e.clientY - s.y\r\n    const dir = s.dir\r\n    let w = s.w\r\n    let h = s.h\r\n    // Respect parent's inner height so the modal bottom can align with the frame bottom\r\n    let parentInner = Infinity\r\n    const parent = containerRef.current?.parentElement as HTMLElement | null\r\n    if (parent) {\r\n      const cs = window.getComputedStyle(parent)\r\n      const padTop = parseFloat(cs.paddingTop || '0') || 0\r\n      const padBottom = parseFloat(cs.paddingBottom || '0') || 0\r\n      parentInner = Math.max(0, parent.clientHeight - padTop - padBottom)\r\n    }\r\n    const effMaxH = Math.min(maxHeight, isFinite(parentInner) ? parentInner : maxHeight)\r\n    // We only adjust width/height; the modal stays centered via parent flex\r\n    if (dir.includes('e')) w = clamp(s.w + dx, minWidth, maxWidth)\r\n    if (dir.includes('s')) h = clamp(s.h + dy, minHeight, effMaxH)\r\n    if (dir.includes('w')) w = clamp(s.w - dx, minWidth, maxWidth)\r\n    if (dir.includes('n')) h = clamp(s.h - dy, minHeight, effMaxH)\r\n    setSize({ width: Math.round(w), height: Math.round(h) })\r\n  }\r\n\r\n  function endResize() {\r\n    window.removeEventListener('mousemove', onMove)\r\n    window.removeEventListener('mouseup', endResize)\r\n    startRef.current = null\r\n  }\r\n\r\n  const containerRef = useRef<HTMLDivElement | null>(null)\r\n  const style: CSSProperties = fullScreen\r\n    ? { width: '100%', height: '100%', maxWidth: '100%', maxHeight: '100%' }\r\n    : {\r\n        width: size.width ? `${size.width}px` : undefined,\r\n        height: size.height ? `${size.height}px` : undefined,\r\n        maxWidth: `${maxWidth}px`,\r\n        // Allow filling up to the parent's inner height\r\n        maxHeight: '100%',\r\n      }\r\n\r\n  const baseClass = fullScreen ? 'card relative ndn-modal-full' : 'card relative'\r\n  return (\r\n    <div ref={containerRef} className={`${baseClass} ${className || ''}`} style={style}>\r\n      {/* Content */}\r\n      {children}\r\n      {/* Corner handles */}\r\n      {!fullScreen && <div className=\"resizer resizer-nw\" onMouseDown={(e)=>beginResize(e,'nw')} />}\r\n      {!fullScreen && <div className=\"resizer resizer-ne\" onMouseDown={(e)=>beginResize(e,'ne')} />}\r\n      {!fullScreen && <div className=\"resizer resizer-sw\" onMouseDown={(e)=>beginResize(e,'sw')} />}\r\n      {!fullScreen && <div className=\"resizer resizer-se\" onMouseDown={(e)=>beginResize(e,'se')} />}\r\n      {/* Bottom edge handle for easy vertical stretching */}\r\n      {!fullScreen && <div className=\"resizer-edge resizer-s\" onMouseDown={(e)=>beginResize(e,'s')} />}\r\n    </div>\r\n  )\r\n}\r\n","import { create } from 'zustand'\r\n\r\nexport type HeatSample = {\r\n  playerId: string | null\r\n  sector: number | null\r\n  mult: 0 | 1 | 2 | 3\r\n  ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n  ts: number\r\n}\r\n\r\ntype HeatState = {\r\n  samples: HeatSample[]\r\n  addSample: (s: HeatSample) => void\r\n  clear: () => void\r\n  export: () => HeatSample[]\r\n}\r\n\r\nexport const useHeatmapStore = create<HeatState>((set, get) => ({\r\n  samples: [],\r\n  addSample: (s) => set(state => ({ samples: [...state.samples, s] })),\r\n  clear: () => set({ samples: [] }),\r\n  export: () => get().samples.slice(),\r\n}))\r\n\r\nexport default useHeatmapStore\r\n","import { useEffect, useRef, useState } from 'react'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCalibration } from '../store/calibration'\r\nimport { useMatch } from '../store/match'\r\nimport { BoardRadii, drawPolyline, sampleRing, scaleHomography, type Point } from '../utils/vision'\r\nimport { scoreFromImagePoint } from '../utils/autoscore'\r\nimport { addSample } from '../store/profileStats'\r\nimport { subscribeExternalWS } from '../utils/scoring'\r\nimport ResizablePanel from './ui/ResizablePanel'\r\nimport ResizableModal from './ui/ResizableModal'\r\nimport useHeatmapStore from '../store/heatmap'\r\n\r\n// Shared ring type across autoscore/manual flows\r\ntype Ring = 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n\r\nexport default function CameraView({\r\n  onVisitCommitted,\r\n  showToolbar = true,\r\n  onAutoDart,\r\n  immediateAutoCommit = false,\r\n  hideInlinePanels = false,\r\n  scoringMode = 'x01',\r\n  onGenericDart,\r\n  onGenericReplace,\r\n}: {\r\n  onVisitCommitted?: (score: number, darts: number, finished: boolean) => void\r\n  showToolbar?: boolean\r\n  onAutoDart?: (value: number, ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', info?: { sector: number | null; mult: 0|1|2|3 }) => void\r\n  immediateAutoCommit?: boolean\r\n  hideInlinePanels?: boolean\r\n  scoringMode?: 'x01' | 'custom'\r\n  onGenericDart?: (value: number, ring: Ring, meta: { label: string }) => void\r\n  onGenericReplace?: (value: number, ring: Ring, meta: { label: string }) => void\r\n}) {\r\n  const videoRef = useRef<HTMLVideoElement>(null)\r\n  const { preferredCameraId, setPreferredCamera, autoscoreProvider, autoscoreWsUrl } = useUserSettings()\r\n  const manualOnly = autoscoreProvider === 'manual'\r\n  const [availableCameras, setAvailableCameras] = useState<MediaDeviceInfo[]>([])\r\n  const canvasRef = useRef<HTMLCanvasElement>(null)\r\n  const overlayRef = useRef<HTMLCanvasElement>(null)\r\n  const [streaming, setStreaming] = useState(false)\r\n  const [cameraStarting, setCameraStarting] = useState(false)\r\n  const [snapshotUrl, setSnapshotUrl] = useState<string | null>(null)\r\n  const { H, imageSize, reset: resetCalibration } = useCalibration()\r\n  const [lastAutoScore, setLastAutoScore] = useState<string>('')\r\n  const [manualScore, setManualScore] = useState<string>('')\r\n  const [lastAutoValue, setLastAutoValue] = useState<number>(0)\r\n  const [lastAutoRing, setLastAutoRing] = useState<Ring>('MISS')\r\n  const [pendingDarts, setPendingDarts] = useState<number>(0)\r\n  const [pendingScore, setPendingScore] = useState<number>(0)\r\n  const [pendingEntries, setPendingEntries] = useState<{ label: string; value: number; ring: Ring }[]>([])\r\n  const addVisit = useMatch(s => s.addVisit)\r\n  const endLeg = useMatch(s => s.endLeg)\r\n  const matchState = useMatch(s => s)\r\n  const addHeatSample = useHeatmapStore(s => s.addSample)\r\n  // Quick entry dropdown selections\r\n  const [quickSelAuto, setQuickSelAuto] = useState('')\r\n  const [quickSelManual, setQuickSelManual] = useState('')\r\n  const [nonRegCount, setNonRegCount] = useState(0)\r\n  const [showRecalModal, setShowRecalModal] = useState(false)\r\n  const [hadRecentAuto, setHadRecentAuto] = useState(false)\r\n  const [activeTab, setActiveTab] = useState<'auto'|'manual'>('auto')\r\n  const [showManualModal, setShowManualModal] = useState(false)\r\n  const [showAutoModal, setShowAutoModal] = useState(false)\r\n  const [showScoringModal, setShowScoringModal] = useState(false)\r\n  const manualPreviewRef = useRef<HTMLCanvasElement | null>(null)\r\n  // Open Autoscore modal from parent via global event\r\n  useEffect(() => {\r\n    const onOpen = () => { if (!manualOnly) setShowAutoModal(true) }\r\n    window.addEventListener('ndn:open-autoscore' as any, onOpen)\r\n    return () => window.removeEventListener('ndn:open-autoscore' as any, onOpen)\r\n  }, [manualOnly])\r\n\r\n  // Open Scoring (Camera + Pending Visit) modal from parent via global event\r\n  useEffect(() => {\r\n    const onOpen = () => setShowScoringModal(true)\r\n    window.addEventListener('ndn:open-scoring' as any, onOpen)\r\n    return () => window.removeEventListener('ndn:open-scoring' as any, onOpen)\r\n  }, [])\r\n\r\n  // Allow parent to open/close the manual modal via global events\r\n  useEffect(() => {\r\n    const onOpen = () => { setActiveTab('manual'); setShowManualModal(true) }\r\n    const onClose = () => { setActiveTab('auto'); setShowManualModal(false) }\r\n    window.addEventListener('ndn:open-manual' as any, onOpen)\r\n    window.addEventListener('ndn:close-manual' as any, onClose)\r\n    return () => {\r\n      window.removeEventListener('ndn:open-manual' as any, onOpen)\r\n      window.removeEventListener('ndn:close-manual' as any, onClose)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (manualOnly) {\r\n      setActiveTab('manual')\r\n      setShowAutoModal(false)\r\n    }\r\n  }, [manualOnly])\r\n\r\n  // Drive a lightweight live preview inside the manual modal from the main video element\r\n  useEffect(() => {\r\n    if (!showManualModal) return\r\n    const id = setInterval(() => {\r\n      try {\r\n        const v = videoRef.current\r\n        const c = manualPreviewRef.current\r\n        if (!v || !c) return\r\n        const vw = v.videoWidth || 0\r\n        const vh = v.videoHeight || 0\r\n        if (!vw || !vh) return\r\n        const cw = c.clientWidth || 640\r\n        const ch = c.clientHeight || 360\r\n        // Set backing size to match display for crisp rendering\r\n        if (c.width !== cw) c.width = cw\r\n        if (c.height !== ch) c.height = ch\r\n        const ctx = c.getContext('2d')\r\n        if (!ctx) return\r\n        ctx.imageSmoothingEnabled = true\r\n        // Letterbox fit\r\n        const scale = Math.min(cw / vw, ch / vh)\r\n        const dw = Math.round(vw * scale)\r\n        const dh = Math.round(vh * scale)\r\n        const dx = Math.floor((cw - dw) / 2)\r\n        const dy = Math.floor((ch - dh) / 2)\r\n        ctx.fillStyle = '#000'\r\n        ctx.fillRect(0, 0, cw, ch)\r\n        ctx.drawImage(v, dx, dy, dw, dh)\r\n      } catch (e) {\r\n        // Silently ignore preview update errors\r\n        console.warn('Manual preview update error:', e)\r\n      }\r\n    }, 120)\r\n    return () => clearInterval(id)\r\n  }, [showManualModal])\r\n\r\n  useEffect(() => {\r\n    return () => stopCamera()\r\n  }, [])\r\n\r\n  async function startCamera() {\r\n    if (cameraStarting || streaming) return\r\n    setCameraStarting(true)\r\n    console.log('[CAMERA] Starting camera...')\r\n    try {\r\n      // If a preferred camera is set, request it; otherwise default to back camera on mobile\r\n      const constraints: MediaStreamConstraints = preferredCameraId \r\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false } \r\n        : { video: { facingMode: 'environment' }, audio: false } // Prefer back camera on mobile\r\n      console.log('[CAMERA] Using constraints:', constraints)\r\n      let stream: MediaStream\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints)\r\n        console.log('[CAMERA] Got stream:', !!stream)\r\n      } catch (err: any) {\r\n        console.warn('[CAMERA] First attempt failed:', err)\r\n        // Fallback if specific device isn't available or facingMode not supported\r\n        const name = (err && (err.name || err.code)) || ''\r\n        if (preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError')) {\r\n          console.log('[CAMERA] Trying fallback without deviceId')\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else if (!preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError' || name === 'NotSupportedError')) {\r\n          console.log('[CAMERA] Trying fallback for facingMode not supported')\r\n          // Fallback for devices that don't support facingMode\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else {\r\n          throw err\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        console.log('[CAMERA] Setting stream to video element')\r\n        videoRef.current.srcObject = stream\r\n        console.log('[CAMERA] Stream tracks:', stream.getTracks().length, 'video tracks:', stream.getVideoTracks().length)\r\n        // Add event listeners for debugging\r\n        videoRef.current.addEventListener('loadeddata', () => console.log('[CAMERA] Video loadeddata'))\r\n        videoRef.current.addEventListener('canplay', () => console.log('[CAMERA] Video canplay'))\r\n        videoRef.current.addEventListener('play', () => console.log('[CAMERA] Video started playing'))\r\n        videoRef.current.addEventListener('error', (e) => console.error('[CAMERA] Video error:', e))\r\n        try {\r\n          videoRef.current.play()\r\n          console.log('[CAMERA] Play called successfully')\r\n        } catch (playErr) {\r\n          console.error('[CAMERA] Video play failed:', playErr)\r\n          // Try again after a short delay\r\n          setTimeout(() => {\r\n            try {\r\n              videoRef.current?.play()\r\n              console.log('[CAMERA] Retry play called')\r\n            } catch (retryErr) {\r\n              console.error('[CAMERA] Retry play failed:', retryErr)\r\n            }\r\n          }, 100)\r\n        }\r\n      } else {\r\n        console.error('[CAMERA] Video element not found')\r\n      }\r\n      setStreaming(true)\r\n      // Capture device list for inline picker - no automatic preference updates\r\n      try {\r\n        const list = await navigator.mediaDevices.enumerateDevices()\r\n        setAvailableCameras(list.filter(d=>d.kind==='videoinput'))\r\n        console.log('[CAMERA] Found cameras:', list.filter(d=>d.kind==='videoinput').length)\r\n      } catch (enumErr) {\r\n        console.warn('[CAMERA] Failed to enumerate devices:', enumErr)\r\n      }\r\n    } catch (e) {\r\n      console.error('[CAMERA] Camera start failed:', e)\r\n      alert('Camera permission denied or not available.')\r\n    } finally {\r\n      setCameraStarting(false)\r\n    }\r\n  }\r\n\r\n  function stopCamera() {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n      tracks.forEach(t => t.stop())\r\n      videoRef.current.srcObject = null\r\n      setStreaming(false)\r\n      setCameraStarting(false)\r\n    }\r\n  }\r\n\r\n  function capture() {\r\n    try {\r\n      if (!videoRef.current || !canvasRef.current) return\r\n      const video = videoRef.current\r\n      const canvas = canvasRef.current\r\n      canvas.width = video.videoWidth\r\n      canvas.height = video.videoHeight\r\n      const ctx = canvas.getContext('2d')\r\n      if (!ctx) return\r\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height)\r\n      const url = canvas.toDataURL('image/png')\r\n      setSnapshotUrl(url)\r\n    } catch (e) {\r\n      console.warn('Capture error:', e)\r\n    }\r\n  }\r\n\r\n  // Inline light-weight device switcher (optional)\r\n  function CameraSelector() {\r\n    if (!availableCameras.length) return null\r\n    return (\r\n      <div className=\"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs\">\r\n        <span>Cam:</span>\r\n        <select\r\n          className=\"bg-black/20 rounded px-1 py-0.5\"\r\n          value={preferredCameraId || ''}\r\n          onChange={async (e)=>{\r\n            if (cameraStarting) return\r\n            const id = e.target.value || undefined\r\n            const label = availableCameras.find(d=>d.deviceId===id)?.label\r\n            // This is a user-initiated change so force the preference even when locked\r\n            setPreferredCamera(id, label||'', true)\r\n            // Stop current camera and wait for cleanup\r\n            stopCamera()\r\n            // Small delay to ensure camera device is fully released\r\n            await new Promise(resolve => setTimeout(resolve, 100))\r\n            try {\r\n              await startCamera()\r\n            } catch (err) {\r\n              console.warn('Failed to start camera after device switch:', err)\r\n              // Try one more time after a longer delay\r\n              setTimeout(async () => {\r\n                try {\r\n                  await startCamera()\r\n                } catch (retryErr) {\r\n                  console.error('Camera switch failed after retry:', retryErr)\r\n                  alert('Failed to switch camera. Please try again or refresh the page.')\r\n                }\r\n              }, 500)\r\n            }\r\n          }}\r\n        >\r\n          <option value=\"\">Auto</option>\r\n          {availableCameras.map(d => (\r\n            <option key={d.deviceId} value={d.deviceId}>{d.label || 'Camera'}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  function drawOverlay() {\r\n    try {\r\n      if (!overlayRef.current || !videoRef.current || !H || !imageSize) return\r\n      const o = overlayRef.current\r\n      const v = videoRef.current\r\n      const w = v.clientWidth\r\n      const h = v.clientHeight\r\n      o.width = w; o.height = h\r\n      const ctx = o.getContext('2d')\r\n      if (!ctx) return\r\n      ctx.clearRect(0,0,w,h)\r\n\r\n      // scale homography from calibration image size to current rendered size\r\n      const sx = w / imageSize.w\r\n      const sy = h / imageSize.h\r\n      const Hs = scaleHomography(H, sx, sy)\r\n      const rings = [BoardRadii.bullInner, BoardRadii.bullOuter, BoardRadii.trebleInner, BoardRadii.trebleOuter, BoardRadii.doubleInner, BoardRadii.doubleOuter]\r\n      for (const r of rings) {\r\n        const poly = sampleRing(Hs, r, 360)\r\n        drawPolyline(ctx, poly, r === BoardRadii.doubleOuter ? '#22d3ee' : '#a78bfa', r === BoardRadii.doubleOuter ? 3 : 2)\r\n      }\r\n    } catch (e) {\r\n      // Silently ignore drawing errors to prevent re-render loops\r\n      console.warn('Overlay drawing error:', e)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (manualOnly) return\r\n    const id = setInterval(drawOverlay, 250)\r\n    return () => clearInterval(id)\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [H, imageSize, streaming, manualOnly])\r\n\r\n  // External autoscore subscription\r\n  useEffect(() => {\r\n    if (autoscoreProvider !== 'external-ws' || !autoscoreWsUrl) return\r\n    const sub = subscribeExternalWS(autoscoreWsUrl, (d) => {\r\n      // Prefer parent hook if provided; otherwise add to visit directly\r\n      if (onAutoDart) {\r\n        try { onAutoDart(d.value, d.ring as any, { sector: d.sector ?? null, mult: (d.mult as any) ?? 0 }) } catch {}\r\n        try { addHeatSample({ playerId: matchState.players[matchState.currentPlayerIdx]?.id ?? null, sector: d.sector ?? null, mult: (d.mult as any) ?? 0, ring: d.ring as any, ts: Date.now() }) } catch {}\r\n      } else {\r\n        const label = d.ring === 'INNER_BULL' ? 'INNER_BULL 50' : d.ring === 'BULL' ? 'BULL 25' : `${d.ring[0]}${(d.value/(d.mult||1))||d.value} ${d.value}`\r\n        addDart(d.value, label, d.ring as any)\r\n        try { addHeatSample({ playerId: matchState.players[matchState.currentPlayerIdx]?.id ?? null, sector: d.sector ?? null, mult: (d.mult as any) ?? 0, ring: d.ring as any, ts: Date.now() }) } catch {}\r\n      }\r\n    })\r\n    return () => sub.close()\r\n  }, [autoscoreProvider, autoscoreWsUrl])\r\n\r\n  function onOverlayClick(e: React.MouseEvent<HTMLCanvasElement>) {\r\n    if (!overlayRef.current || !H || !imageSize) return\r\n    const rect = overlayRef.current.getBoundingClientRect()\r\n    const x = e.clientX - rect.left\r\n    const y = e.clientY - rect.top\r\n    // Map to calibration coordinate space by reversing the display scaling\r\n    const sx = overlayRef.current.width / imageSize.w\r\n    const sy = overlayRef.current.height / imageSize.h\r\n    const pCal: Point = { x: x / sx, y: y / sy }\r\n  const score = scoreFromImagePoint(H, pCal)\r\n  const s = `${score.ring} ${score.base > 0 ? score.base : ''}`.trim()\r\n    setLastAutoScore(s)\r\n  setLastAutoValue(score.base)\r\n  setLastAutoRing(score.ring as Ring)\r\n    setHadRecentAuto(true)\r\n    // Optional immediate commit hook (e.g., Double Practice)\r\n    try {\r\n      if (immediateAutoCommit && onAutoDart) {\r\n        onAutoDart(score.base, score.ring as Ring, { sector: score.sector, mult: score.mult })\r\n        try { addHeatSample({ playerId: matchState.players[matchState.currentPlayerIdx]?.id ?? null, sector: score.sector ?? null, mult: score.mult ?? 0, ring: score.ring as any, ts: Date.now() }) } catch {}\r\n        setHadRecentAuto(false)\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  function parseManual(input: string): { label: string; value: number; ring: Ring } | null {\r\n    const t = input.trim().toUpperCase()\r\n    if (!t) return null\r\n    const bull = t === 'BULL' || t === '50' || t === 'DBULL' || t === 'IBULL'\r\n    const outerBull = t === '25' || t === 'OBULL'\r\n    if (bull) return { label: 'INNER_BULL 50', value: 50, ring: 'INNER_BULL' }\r\n    if (outerBull) return { label: 'BULL 25', value: 25, ring: 'BULL' }\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n    if (!m) return null\r\n    const mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n    const num = parseInt(m[2], 10)\r\n    if (num < 1 || num > 20) return null\r\n    const multVal = mult === 'S' ? 1 : mult === 'D' ? 2 : 3\r\n    const ring: Ring = mult === 'S' ? 'SINGLE' : mult === 'D' ? 'DOUBLE' : 'TRIPLE'\r\n    return { label: `${mult}${num} ${num*multVal}`, value: num * multVal, ring }\r\n  }\r\n\r\n  function getCurrentRemaining(): number {\r\n    const s = matchState\r\n    if (!s.players.length) return s.startingScore\r\n    const p = s.players[s.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length-1]\r\n    if (!leg) return s.startingScore\r\n    return leg.totalScoreRemaining\r\n  }\r\n\r\n  function addDart(value: number, label: string, ring: Ring) {\r\n    // In generic mode, delegate to parent without X01 bust/finish rules\r\n    if (scoringMode === 'custom') {\r\n      if (onGenericDart) try { onGenericDart(value, ring, { label }) } catch {}\r\n      // Maintain a lightweight pending list for UI only\r\n      if (pendingDarts >= 3) return\r\n      const newDarts = pendingDarts + 1\r\n      setPendingDarts(newDarts)\r\n      setPendingScore(s => s + value)\r\n      setPendingEntries(e => [...e, { label, value, ring }])\r\n      return\r\n    }\r\n\r\n    if (pendingDarts >= 3) return\r\n    const newDarts = pendingDarts + 1\r\n    const newScore = pendingScore + value\r\n    const remaining = getCurrentRemaining()\r\n    const after = remaining - newScore\r\n\r\n    // Bust conditions (double-out): negative or 1, or 0 without double/inner bull\r\n    const isFinish = after === 0 && (ring === 'DOUBLE' || ring === 'INNER_BULL')\r\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish)\r\n\r\n    if (isBust) {\r\n      // Commit bust visit: 0 score, darts thrown so far including this one\r\n      addVisit(0, newDarts)\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(0, newDarts, false)\r\n      return\r\n    }\r\n\r\n    // Normal add\r\n    setPendingDarts(newDarts)\r\n    setPendingScore(newScore)\r\n    setPendingEntries(e => [...e, { label, value, ring }])\r\n\r\n    if (isFinish) {\r\n      // Commit visit with current total and end leg\r\n      addVisit(newScore, newDarts)\r\n      endLeg(newScore)\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(newScore, newDarts, true)\r\n      return\r\n    }\r\n\r\n    if (newDarts >= 3) {\r\n      addVisit(newScore, newDarts)\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(newScore, newDarts, false)\r\n    }\r\n  }\r\n\r\n  function onAddAutoDart() {\r\n    if (lastAutoScore) {\r\n      if (onAutoDart) {\r\n        try { onAutoDart(lastAutoValue, lastAutoRing, undefined) } catch {}\r\n      } else {\r\n        addDart(lastAutoValue, lastAutoScore, lastAutoRing)\r\n      }\r\n      setNonRegCount(0)\r\n      setHadRecentAuto(false)\r\n    }\r\n  }\r\n\r\n  function onApplyManual() {\r\n    const parsed = parseManual(manualScore)\r\n    if (!parsed) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    // If autoscore didn't register recently, count toward recalibration\r\n    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n      const c = nonRegCount + 1\r\n      setNonRegCount(c)\r\n      if (c >= 3) setShowRecalModal(true)\r\n    } else {\r\n      setNonRegCount(0)\r\n    }\r\n    addDart(parsed.value, parsed.label, parsed.ring)\r\n    setManualScore('')\r\n    setHadRecentAuto(false)\r\n  }\r\n\r\n  // Replace the last pending dart with a manually typed correction\r\n  function onReplaceManual() {\r\n    const parsed = parseManual(manualScore)\r\n    if (!parsed) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    if (pendingDarts === 0 || pendingEntries.length === 0) {\r\n      onApplyManual()\r\n      return\r\n    }\r\n    if (scoringMode === 'custom') {\r\n      // Let parent handle replacement semantics\r\n      if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n        const c = nonRegCount + 1\r\n        setNonRegCount(c)\r\n        if (c >= 3) setShowRecalModal(true)\r\n      } else setNonRegCount(0)\r\n\r\n      // Update local pending UI\r\n      setPendingEntries((e)=>[...e.slice(0,-1), { label: parsed.label, value: parsed.value, ring: parsed.ring }])\r\n      if (onGenericReplace) try { onGenericReplace(parsed.value, parsed.ring, { label: parsed.label }) } catch {}\r\n      setManualScore('')\r\n      setHadRecentAuto(false)\r\n      return\r\n    }\r\n    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n      const c = nonRegCount + 1\r\n      setNonRegCount(c)\r\n      if (c >= 3) setShowRecalModal(true)\r\n    } else setNonRegCount(0)\r\n\r\n    const last = pendingEntries[pendingEntries.length-1]\r\n    const prevDarts = pendingDarts - 1\r\n    const prevScore = pendingScore - (last?.value || 0)\r\n    const remaining = getCurrentRemaining()\r\n    const newScore = prevScore + parsed.value\r\n    const newDarts = prevDarts + 1\r\n    const after = remaining - newScore\r\n    const isFinish = after === 0 && (parsed.ring === 'DOUBLE' || parsed.ring === 'INNER_BULL')\r\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish)\r\n\r\n    if (isBust) {\r\n      addVisit(0, newDarts)\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n        if (name) addSample(name, newDarts, 0)\r\n      } catch {}\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(0, newDarts, false)\r\n      setManualScore('')\r\n      setHadRecentAuto(false)\r\n      return\r\n    }\r\n\r\n    setPendingDarts(newDarts)\r\n    setPendingScore(newScore)\r\n    setPendingEntries((e)=>[...e.slice(0,-1), { label: parsed.label, value: parsed.value, ring: parsed.ring }])\r\n\r\n    if (isFinish) {\r\n      addVisit(newScore, newDarts)\r\n      endLeg(newScore)\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n        if (name) addSample(name, newDarts, newScore)\r\n      } catch {}\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(newScore, newDarts, true)\r\n      setManualScore('')\r\n      setHadRecentAuto(false)\r\n      return\r\n    }\r\n\r\n    if (newDarts >= 3) {\r\n      addVisit(newScore, newDarts)\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n        if (name) addSample(name, newDarts, newScore)\r\n      } catch {}\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(newScore, newDarts, false)\r\n    }\r\n    setManualScore('')\r\n    setHadRecentAuto(false)\r\n  }\r\n\r\n  function onRecalibrateNow() {\r\n    setShowRecalModal(false)\r\n    setNonRegCount(0)\r\n    // Ask App to switch to calibrate tab\r\n    try { window.dispatchEvent(new CustomEvent('ndn:request-calibrate')) } catch {}\r\n  }\r\n\r\n  function onResetCalibration() {\r\n    resetCalibration()\r\n    setShowRecalModal(false)\r\n    setNonRegCount(0)\r\n  }\r\n\r\n  // Centralized quick-entry handler for S/D/T 1-20 buttons\r\n  function onQuickEntry(num: number, mult: 'S'|'D'|'T') {\r\n    if (pendingDarts >= 3) return\r\n    const val = num * (mult==='S'?1:mult==='D'?2:3)\r\n    const ring: Ring = mult==='S' ? 'SINGLE' : mult==='D' ? 'DOUBLE' : 'TRIPLE'\r\n    // If autoscore didn't register recently, count toward recalibration\r\n    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n      const c = nonRegCount + 1\r\n      setNonRegCount(c)\r\n      if (c >= 3) setShowRecalModal(true)\r\n    } else {\r\n      setNonRegCount(0)\r\n    }\r\n    addDart(val, `${mult}${num} ${val}`, ring)\r\n    setHadRecentAuto(false)\r\n  }\r\n\r\n  function onUndoDart() {\r\n    if (pendingDarts === 0) return\r\n    const last = pendingEntries[pendingEntries.length-1]\r\n    setPendingDarts(d => d - 1)\r\n    setPendingScore(s => s - (last?.value || 0))\r\n    setPendingEntries(e => e.slice(0, -1))\r\n  }\r\n\r\n  function onCommitVisit() {\r\n    if (pendingDarts === 0) return\r\n    if (scoringMode === 'custom') {\r\n      // For custom mode, simply clear local pending (parent maintains its own scoring)\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      return\r\n    }\r\n    addVisit(pendingScore, pendingDarts)\r\n    try {\r\n      const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n      if (name) addSample(name, pendingDarts, pendingScore)\r\n    } catch {}\r\n    setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n    if (onVisitCommitted) onVisitCommitted(pendingScore, pendingDarts, false)\r\n  }\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n      {/* Pills (optional; can be hidden and controlled by parent) */}\r\n      {showToolbar && (\r\n        <div className=\"lg:col-span-2\">\r\n          <div className=\"flex items-center gap-2 mb-2\">\r\n            {!manualOnly && (\r\n              <button\r\n                className={`btn px-3 py-1 text-sm ${activeTab==='auto' ? 'tab--active' : ''}`}\r\n                onClick={()=>{ setActiveTab('auto'); setShowManualModal(false); setShowAutoModal(true) }}\r\n              >Autoscore</button>\r\n            )}\r\n            <button\r\n              className={`btn px-3 py-1 text-sm ${activeTab==='manual' ? 'tab--active' : ''}`}\r\n              onClick={()=>{ setActiveTab('manual'); setShowManualModal(true) }}\r\n              title=\"Open Manual Correction\"\r\n            >Manual Correction</button>\r\n            {manualOnly && (\r\n              <span className=\"text-xs opacity-70\">Manual scoring mode active</span>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {!hideInlinePanels && !manualOnly ? (\r\n        <div className=\"card\">\r\n          <h2 className=\"text-xl font-semibold mb-3\">Camera</h2>\r\n          <ResizablePanel storageKey=\"ndn:camera:size\" className=\"relative rounded-2xl overflow-hidden bg-black\" defaultWidth={480} defaultHeight={360} minWidth={320} minHeight={240} maxWidth={1600} maxHeight={900}>\r\n            <CameraSelector />\r\n            <video ref={videoRef} className=\"w-full h-full object-cover\" playsInline webkit-playsinline=\"true\" muted autoPlay />\r\n            <canvas ref={overlayRef} className=\"absolute inset-0 w-full h-full\" onClick={onOverlayClick} />\r\n          </ResizablePanel>\r\n          <div className=\"flex gap-2 mt-3\">\r\n            {!streaming ? (\r\n              <button className=\"btn\" onClick={startCamera} disabled={cameraStarting}>\r\n                {cameraStarting ? 'Connecting Camera...' : 'Connect Camera'}\r\n              </button>\r\n            ) : (\r\n              <button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={stopCamera}>Stop Camera</button>\r\n            )}\r\n            {/* Removed Snapshot panel; Capture remains for future features (e.g., quick preview) */}\r\n            <button className=\"btn\" onClick={capture} disabled={!streaming}>Capture Still</button>\r\n            <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:camera-reset' as any)) }catch{} }}>Reset Camera Size</button>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n      {!hideInlinePanels && manualOnly && (\r\n        <div className=\"card\">\r\n          <h2 className=\"text-xl font-semibold mb-3\">Manual Scoring</h2>\r\n          <p className=\"text-sm opacity-80 mb-3\">Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts.</p>\r\n          <div className=\"flex flex-wrap items-center gap-2\">\r\n            <button className=\"btn\" onClick={()=>{ setShowManualModal(true); setActiveTab('manual') }}>Open Manual Correction</button>\r\n            <button className=\"btn btn--ghost\" onClick={()=>{ try { window.dispatchEvent(new Event('ndn:open-scoring' as any)) } catch {} }}>Manage Pending Visit</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Snapshot panel removed to reduce unused space */}\r\n      <canvas ref={canvasRef} className=\"hidden\"></canvas>\r\n      {/* Autoscore moved into a pill-triggered modal to reduce on-screen clutter */}\r\n      {/* Modal: Autoscore */}\r\n  {showAutoModal && !manualOnly && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-[100]\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\r\n            <ResizableModal\r\n              storageKey=\"ndn:autoscore:size\"\r\n              className=\"w-full max-w-3xl\"\r\n              defaultWidth={720}\r\n              defaultHeight={520}\r\n              minWidth={420}\r\n              minHeight={320}\r\n              maxWidth={1400}\r\n              maxHeight={900}\r\n              initialFitHeight\r\n            >\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <h2 className=\"text-xl font-semibold\">Autoscore</h2>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button className=\"btn btn--ghost\" onClick={()=>setShowAutoModal(false)}>Close</button>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-sm opacity-80 mb-3\">Click the camera overlay to autoscore. Use Manual Correction if the last auto is off.</div>\r\n              <div className=\"flex items-center gap-2 mb-3 flex-wrap\">\r\n                <span className=\"font-semibold\">Last auto:</span>\r\n                <span>{lastAutoScore || '—'}</span>\r\n                <button className=\"btn\" onClick={onAddAutoDart} disabled={pendingDarts>=3}>Add Auto Dart</button>\r\n                {nonRegCount>0 && <span className=\"text-sm opacity-80\">No-registers: {nonRegCount}/3</span>}\r\n              </div>\r\n              <div className=\"mt-2\">\r\n                <div className=\"text-sm font-semibold mb-2\">Quick entry</div>\r\n                {/* Bulls */}\r\n                <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                  <button className=\"btn\" disabled={pendingDarts>=3} onClick={()=>{\r\n                    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n                      const c = nonRegCount + 1\r\n                      setNonRegCount(c)\r\n                      if (c >= 3) setShowRecalModal(true)\r\n                    } else setNonRegCount(0)\r\n                    addDart(25, 'BULL 25', 'BULL'); setHadRecentAuto(false)\r\n                  }}>25</button>\r\n                  <button className=\"btn\" disabled={pendingDarts>=3} onClick={()=>{\r\n                    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n                      const c = nonRegCount + 1\r\n                      setNonRegCount(c)\r\n                      if (c >= 3) setShowRecalModal(true)\r\n                    } else setNonRegCount(0)\r\n                    addDart(50, 'INNER_BULL 50', 'INNER_BULL'); setHadRecentAuto(false)\r\n                  }}>50</button>\r\n                </div>\r\n                {/* Grouped dropdown: Doubles, Singles, Trebles */}\r\n                <div className=\"flex items-center gap-2 mb-3\">\r\n                  <input\r\n                    className=\"input w-full max-w-sm\"\r\n                    list=\"autoscore-quick-list\"\r\n                    placeholder=\"Type or select (e.g., D16, T20, S5)\"\r\n                    value={quickSelAuto}\r\n                    onChange={e=>setQuickSelAuto(e.target.value.toUpperCase())}\r\n                    onKeyDown={e=>{ if(e.key==='Enter'){ const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/); if(m){ onQuickEntry(parseInt(m[2],10), m[1] as any); } }} }\r\n                  />\r\n                  <datalist id=\"autoscore-quick-list\">\r\n                    {(['D','S','T'] as const).map(mult => (\r\n                      Array.from({length:20}, (_,i)=>i+1).map(num => (\r\n                        <option key={`${mult}${num}`} value={`${mult}${num}`} />\r\n                      ))\r\n                    ))}\r\n                  </datalist>\r\n                  <button\r\n                    className=\"btn\"\r\n                    disabled={!quickSelAuto || pendingDarts>=3}\r\n                    onClick={()=>{\r\n                      const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/)\r\n                      if (!m) return\r\n                      const mult = m[1] as 'S'|'D'|'T'\r\n                      const num = parseInt(m[2], 10)\r\n                      onQuickEntry(num, mult)\r\n                    }}\r\n                  >Add</button>\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showManualModal && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-[100]\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"absolute inset-0 flex flex-col\">\r\n            <div className=\"p-3 md:p-4 flex items-center justify-between\">\r\n              <h3 className=\"text-xl md:text-2xl font-semibold\">Manual Correction</h3>\r\n              <div className=\"flex items-center gap-2\">\r\n                <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={()=>{ setShowManualModal(false); }}>Close</button>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex-1 p-3 md:p-4\">\r\n              <div className=\"h-full grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n                {/* Live preview */}\r\n                <div className=\"card relative flex flex-col\">\r\n                  <div className=\"text-sm font-semibold mb-2\">Live Preview</div>\r\n                  <div className=\"relative flex-1 rounded-2xl overflow-hidden bg-black\">\r\n                    <canvas ref={manualPreviewRef} className=\"absolute inset-0 w-full h-full\" />\r\n                  </div>\r\n                </div>\r\n                {/* Manual controls */}\r\n                <div className=\"card flex flex-col\">\r\n                  <div className=\"text-sm opacity-80 mb-2\">Type a correction or replace the last dart. The preview updates live.</div>\r\n                  <div className=\"flex items-center gap-2 mb-2\">\r\n                    <span className=\"font-semibold\">Last auto:</span>\r\n                    <span>{lastAutoScore || '—'}</span>\r\n                    <button className=\"btn\" onClick={onAddAutoDart} disabled={pendingDarts>=3}>Add Auto Dart</button>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2 mb-2\">\r\n                    <input\r\n                      className=\"input flex-1\"\r\n                      placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                      value={manualScore}\r\n                      onChange={e => setManualScore(e.target.value)}\r\n                      onKeyDown={e => {\r\n                        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); onApplyManual() }\r\n                        if (e.key === 'Enter' && e.shiftKey) { e.preventDefault(); onReplaceManual() }\r\n                      }}\r\n                    />\r\n                    <button className=\"btn btn--ghost\" onClick={onReplaceManual} disabled={pendingDarts===0}>Replace Last</button>\r\n                    <button className=\"btn\" onClick={onApplyManual} disabled={pendingDarts>=3}>Add</button>\r\n                  </div>\r\n                  <div className=\"text-xs opacity-70 mb-4\">Press Enter to Add · Shift+Enter to Replace Last</div>\r\n                  <div className=\"mt-auto\">\r\n                    <div className=\"text-sm font-semibold mb-2\">Quick entry</div>\r\n                    {/* Bulls */}\r\n                    <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                      <button className=\"btn\" disabled={pendingDarts>=3} onClick={()=>{\r\n                        if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n                          const c = nonRegCount + 1\r\n                          setNonRegCount(c)\r\n                          if (c >= 3) setShowRecalModal(true)\r\n                        } else setNonRegCount(0)\r\n                        addDart(25, 'BULL 25', 'BULL'); setHadRecentAuto(false)\r\n                      }}>25</button>\r\n                      <button className=\"btn\" disabled={pendingDarts>=3} onClick={()=>{\r\n                        if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n                          const c = nonRegCount + 1\r\n                          setNonRegCount(c)\r\n                          if (c >= 3) setShowRecalModal(true)\r\n                        } else setNonRegCount(0)\r\n                        addDart(50, 'INNER_BULL 50', 'INNER_BULL'); setHadRecentAuto(false)\r\n                      }}>50</button>\r\n                    </div>\r\n                    {/* Grouped dropdown: Doubles, Singles, Trebles */}\r\n                    <div className=\"flex items-center gap-2 mb-3\">\r\n                      <input\r\n                        className=\"input w-full max-w-sm\"\r\n                        list=\"manual-quick-list\"\r\n                        placeholder=\"Type or select (e.g., D16, T20, S5)\"\r\n                        value={quickSelManual}\r\n                        onChange={e=>setQuickSelManual(e.target.value.toUpperCase())}\r\n                        onKeyDown={e=>{ if(e.key==='Enter'){ const m = quickSelManual.match(/^(S|D|T)(\\d{1,2})$/); if(m){ onQuickEntry(parseInt(m[2],10), m[1] as any); } }} }\r\n                      />\r\n                      <datalist id=\"manual-quick-list\">\r\n                        {(['D','S','T'] as const).map(mult => (\r\n                          Array.from({length:20}, (_,i)=>i+1).map(num => (\r\n                            <option key={`${mult}${num}`} value={`${mult}${num}`} />\r\n                          ))\r\n                        ))}\r\n                      </datalist>\r\n                      <button\r\n                        className=\"btn\"\r\n                        disabled={!quickSelManual || pendingDarts>=3}\r\n                        onClick={()=>{\r\n                          const m = quickSelManual.match(/^(S|D|T)(\\d{1,2})$/)\r\n                          if (!m) return\r\n                          const mult = m[1] as 'S'|'D'|'T'\r\n                          const num = parseInt(m[2], 10)\r\n                          onQuickEntry(num, mult)\r\n                        }}\r\n                      >Add</button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showScoringModal && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center\">\r\n          <div className=\"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\" onClick={()=>setShowScoringModal(false)}>Close</button>\r\n            <h2 className=\"text-xl font-bold mb-4 flex items-center gap-2 text-white\">Scoring</h2>\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n              {/* Camera section */}\r\n              <div className=\"bg-black/30 rounded-2xl p-4\">\r\n                <h2 className=\"text-lg font-semibold mb-3\">Camera</h2>\r\n                <ResizablePanel storageKey=\"ndn:camera:size:modal\" className=\"relative rounded-2xl overflow-hidden bg-black\" defaultWidth={480} defaultHeight={360} minWidth={320} minHeight={240} maxWidth={1600} maxHeight={900}>\r\n                  <CameraSelector />\r\n                  <video ref={videoRef} className=\"w-full h-full object-cover\" playsInline webkit-playsinline=\"true\" muted autoPlay />\r\n                  <canvas ref={overlayRef} className=\"absolute inset-0 w-full h-full\" onClick={onOverlayClick} />\r\n                </ResizablePanel>\r\n                <div className=\"flex gap-2 mt-3\">\r\n                  {!streaming ? (\r\n                    <button className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\" onClick={startCamera}>Connect Camera</button>\r\n                  ) : (\r\n                    <button className=\"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold\" onClick={stopCamera}>Stop Camera</button>\r\n                  )}\r\n                  <button className=\"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold\" onClick={capture} disabled={!streaming}>Capture Still</button>\r\n                  <button className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\" onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:camera-reset' as any)) }catch{} }}>Reset Camera Size</button>\r\n                </div>\r\n              </div>\r\n              {/* Pending Visit section */}\r\n              <div className=\"bg-black/30 rounded-2xl p-4\">\r\n                <h2 className=\"text-lg font-semibold mb-3\">Pending Visit</h2>\r\n                <div className=\"text-sm opacity-80 mb-2\">Up to 3 darts per visit.</div>\r\n                <ul className=\"text-sm mb-2 list-disc pl-5\">\r\n                  {pendingEntries.length === 0 ? <li className=\"opacity-60\">No darts yet</li> : pendingEntries.map((e,i) => <li key={i}>{e.label}</li>)}\r\n                </ul>\r\n                <div className=\"flex items-center gap-4 mb-2\">\r\n                  <div className=\"font-semibold\">Darts: {pendingDarts}/3</div>\r\n                  <div className=\"font-semibold\">Total: {pendingScore}</div>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                  <button className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\" onClick={onUndoDart} disabled={pendingDarts===0}>Undo Dart</button>\r\n                  <button className=\"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold\" onClick={onCommitVisit} disabled={pendingDarts===0}>Commit Visit</button>\r\n                  <button className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\" onClick={()=>{setPendingDarts(0);setPendingScore(0);setPendingEntries([])}} disabled={pendingDarts===0}>Clear</button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showRecalModal && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <div className=\"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\" onClick={()=>{setShowRecalModal(false); setNonRegCount(0)}}>Close</button>\r\n            <h3 className=\"text-xl font-bold mb-2 flex items-center gap-2 text-white\">Recalibration Recommended</h3>\r\n            <div className=\"mb-4 text-lg font-semibold text-indigo-200\">We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again.</div>\r\n            <div className=\"flex gap-2\">\r\n              <button className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\" onClick={onRecalibrateNow}>Go to Calibrate</button>\r\n              <button className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\" onClick={onResetCalibration}>Reset Calibration</button>\r\n              <button className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\" onClick={()=>{setShowRecalModal(false); setNonRegCount(0)}}>Dismiss</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n  {!hideInlinePanels ? (\r\n  <div className=\"card\">\r\n        <h2 className=\"text-xl font-semibold mb-3\">Pending Visit</h2>\r\n        <div className=\"text-sm opacity-80 mb-2\">Up to 3 darts per visit.</div>\r\n        <ul className=\"text-sm mb-2 list-disc pl-5\">\r\n          {pendingEntries.length === 0 ? <li className=\"opacity-60\">No darts yet</li> : pendingEntries.map((e,i) => <li key={i}>{e.label}</li>)}\r\n        </ul>\r\n        <div className=\"flex items-center gap-4 mb-2\">\r\n          <div className=\"font-semibold\">Darts: {pendingDarts}/3</div>\r\n          <div className=\"font-semibold\">Total: {pendingScore}</div>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <button className=\"btn\" onClick={onUndoDart} disabled={pendingDarts===0}>Undo Dart</button>\r\n          <button className=\"btn\" onClick={onCommitVisit} disabled={pendingDarts===0}>Commit Visit</button>\r\n          <button className=\"btn\" onClick={()=>{setPendingDarts(0);setPendingScore(0);setPendingEntries([])}} disabled={pendingDarts===0}>Clear</button>\r\n        </div>\r\n  </div>\r\n  ) : null}\r\n    </div>\r\n  )\r\n}\r\n","import React, { useEffect, useRef } from 'react'\r\nimport useHeatmapStore from '../store/heatmap'\r\nimport { BoardRadii } from '../utils/vision'\r\n\r\nfunction polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {\r\n  const a = (angleDeg - 90) * Math.PI / 180.0\r\n  return { x: cx + (r * Math.cos(a)), y: cy + (r * Math.sin(a)) }\r\n}\r\n\r\nfunction sectorAngle(sector: number) {\r\n  // SectorOrder puts 20 at top; 360/20 = 18deg per sector\r\n  const SectorOrder = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5]\r\n  const idx = SectorOrder.indexOf(sector)\r\n  const mid = (idx * 18) + 9 // middle of sector\r\n  return mid\r\n}\r\n\r\nexport default function HeatMap({ width = 320, height = 320 }: { width?: number; height?: number }) {\r\n  const samples = useHeatmapStore(s => s.samples)\r\n  const ref = useRef<HTMLCanvasElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    const c = ref.current\r\n    if (!c) return\r\n    const ctx = c.getContext('2d')\r\n    if (!ctx) return\r\n    c.width = width; c.height = height\r\n    ctx.clearRect(0,0,width,height)\r\n    // Draw a faint dartboard backdrop (rings)\r\n    const cx = width / 2\r\n    const cy = height / 2\r\n    const scale = Math.min(width, height) / (BoardRadii.doubleOuter * 2 + 20)\r\n    const radii = {\r\n      bullInner: BoardRadii.bullInner * scale,\r\n      bullOuter: BoardRadii.bullOuter * scale,\r\n      trebleInner: BoardRadii.trebleInner * scale,\r\n      trebleOuter: BoardRadii.trebleOuter * scale,\r\n      doubleInner: BoardRadii.doubleInner * scale,\r\n      doubleOuter: BoardRadii.doubleOuter * scale,\r\n    }\r\n    // rings\r\n    ctx.strokeStyle = 'rgba(255,255,255,0.06)'\r\n    ctx.lineWidth = 1\r\n    const ringOrder = ['doubleOuter','doubleInner','trebleOuter','trebleInner','bullOuter','bullInner'] as const\r\n    for (const k of ringOrder) {\r\n      ctx.beginPath(); ctx.arc(cx, cy, (radii as any)[k], 0, Math.PI*2); ctx.stroke();\r\n    }\r\n\r\n    // Aggregate sample weights by approximate xy\r\n    const points: { x:number;y:number;w:number }[] = []\r\n    for (const s of samples) {\r\n      // if sector unknown, scatter in board\r\n      let angle = Math.random() * 360\r\n      let r = Math.random() * radii.doubleOuter\r\n      if (typeof s.sector === 'number' && s.sector >= 1 && s.sector <= 20) {\r\n        angle = sectorAngle(s.sector)\r\n        // choose radius by mult/ring\r\n        if (s.ring === 'DOUBLE') r = (radii.doubleInner + radii.doubleOuter)/2\r\n        else if (s.ring === 'TRIPLE') r = (radii.trebleInner + radii.trebleOuter)/2\r\n        else if (s.ring === 'INNER_BULL') r = radii.bullInner * 0.5\r\n        else if (s.ring === 'BULL') r = radii.bullOuter * 0.8\r\n        else r = (radii.trebleOuter + radii.doubleInner)/2 * (0.6 + Math.random()*0.4)\r\n      }\r\n      const p = polarToCartesian(cx, cy, r, angle)\r\n      points.push({ x: p.x, y: p.y, w: 1 })\r\n    }\r\n\r\n    // Draw heat circles additive\r\n    for (const p of points) {\r\n      const grd = ctx.createRadialGradient(p.x, p.y, 1, p.x, p.y, 60)\r\n      grd.addColorStop(0, 'rgba(255,0,0,0.9)')\r\n      grd.addColorStop(0.3, 'rgba(255,100,0,0.5)')\r\n      grd.addColorStop(1, 'rgba(255,100,0,0)')\r\n      ctx.fillStyle = grd\r\n      ctx.beginPath(); ctx.arc(p.x, p.y, 60, 0, Math.PI*2); ctx.fill()\r\n    }\r\n\r\n    // Optionally overlay counts per sector\r\n    ctx.fillStyle = 'rgba(255,255,255,0.85)'\r\n    ctx.font = '12px ui-sans-serif'\r\n    // compute counts per sector\r\n    const sectorCounts: Record<number, number> = {}\r\n    for (const s of samples) if (s.sector) sectorCounts[s.sector] = (sectorCounts[s.sector] || 0) + 1\r\n    for (const secStr of Object.keys(sectorCounts)) {\r\n      const sec = Number(secStr)\r\n      const a = sectorAngle(sec)\r\n      const pos = polarToCartesian(cx, cy, radii.trebleOuter + 18, a)\r\n      ctx.fillText(String(sectorCounts[sec]), pos.x-6, pos.y+4)\r\n    }\r\n  }, [samples, width, height])\r\n\r\n  return <canvas ref={ref} style={{ width: '100%', height: 'auto', borderRadius: 8, background: '#081018' }} />\r\n}\r\n","export type DartMult = 'S' | 'D' | 'T'\r\nexport type Dart = { mult: DartMult; num: number } | { bull: 25 | 50 }\r\n\r\nexport type DoublePracticeState = {\r\n\ttargetIndex: number // 0..20 for D1..D20 then 21 for DBULL\r\n\tcompleted: boolean\r\n}\r\n\r\nexport const DOUBLE_PRACTICE_TARGETS: Array<{ label: string; score: number; isBull?: boolean }>[] = [] as any\r\n\r\nexport const DOUBLE_PRACTICE_ORDER: { label: string; score: number; isBull?: boolean }[] = [\r\n\t...Array.from({ length: 20 }, (_, i) => ({ label: `D${i + 1}` , score: (i + 1) * 2 })),\r\n\t{ label: 'DBULL', score: 50, isBull: true },\r\n]\r\n\r\nexport function isDoubleHit(value: number, targetIdx: number): boolean {\r\n\tconst t = DOUBLE_PRACTICE_ORDER[targetIdx]\r\n\treturn !!t && value === t.score\r\n}\r\n\r\nexport function parseManualDart(input: string): number | null {\r\n\tconst t = input.trim().toUpperCase()\r\n\tif (!t) return null\r\n\tif (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL') return 50\r\n\tif (t === '25' || t === 'OBULL') return 25\r\n\tconst m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n\tif (!m) return null\r\n\tconst mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n\tconst num = parseInt(m[2],10)\r\n\tif (num < 1 || num > 20) return null\r\n\tconst multVal = mult==='S'?1:mult==='D'?2:3\r\n\treturn num * multVal\r\n}\r\n\r\n// Parse a detailed dart string like \"T20\", \"D16\", \"S5\", \"25\", \"50\", \"BULL\", returning a structured Dart.\r\nexport function parseDartDetailed(input: string): Dart | null {\r\n\tconst t = input.trim().toUpperCase()\r\n\tif (!t) return null\r\n\tif (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL' || t === 'INNER BULL' || t === 'INNER_BULL') return { bull: 50 }\r\n\tif (t === '25' || t === 'OBULL' || t === 'OUTER BULL' || t === 'BULL25') return { bull: 25 }\r\n\tconst m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n\tif (!m) return null\r\n\tconst mult = (m[1] || 'S') as DartMult\r\n\tconst num = parseInt(m[2], 10)\r\n\tif (num < 1 || num > 20) return null\r\n\treturn { mult, num }\r\n}\r\n\r\n// Convert autoscore ring+sector data into a structured Dart\r\n// ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n// sector: 1..20 for numbered segments; null/undefined for bull/miss\r\nexport function ringSectorToDart(ring?: string, sector?: number | null): Dart | null {\r\n\tif (!ring || ring === 'MISS') return null\r\n\tif (ring === 'BULL') return { bull: 25 }\r\n\tif (ring === 'INNER_BULL') return { bull: 50 }\r\n\tif (typeof sector === 'number' && sector >= 1 && sector <= 20) {\r\n\t\tconst mult: DartMult = ring === 'DOUBLE' ? 'D' : ring === 'TRIPLE' ? 'T' : 'S'\r\n\t\treturn { mult, num: sector }\r\n\t}\r\n\treturn null\r\n}\r\n","export type ATCState = {\r\n\ttarget: number // 1..20 then 25 (outer bull) then 50 (inner)\r\n\tfinished: boolean\r\n}\r\n\r\nexport const ATC_ORDER: number[] = [\r\n\t...Array.from({ length: 20 }, (_, i) => i + 1),\r\n\t25,\r\n\t50,\r\n]\r\n\r\nexport function nextTarget(current: number): number | null {\r\n\tconst idx = ATC_ORDER.indexOf(current)\r\n\tif (idx < 0) return ATC_ORDER[0]\r\n\tif (idx >= ATC_ORDER.length - 1) return null\r\n\treturn ATC_ORDER[idx + 1]\r\n}\r\n\r\nexport function isCorrectHit(value: number, target: number): boolean {\r\n\treturn value === target\r\n}\r\n\r\n","export type CricketMark = 0 | 1 | 2 | 3\r\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25 // 25 is bull (outer+inner)\r\n\r\nexport type CricketState = {\r\n\t// marks per number\r\n\tmarks: Record<CricketNumber, CricketMark>\r\n\t// accumulated points when opponent hasn't closed a number\r\n\tpoints: number\r\n}\r\n\r\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25]\r\n\r\nexport function createCricketState(): CricketState {\r\n\tconst marks: any = {}\r\n\tCRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n\treturn { marks, points: 0 }\r\n}\r\n\r\n// Apply a single dart to a player's cricket state\r\n// Returns deltaPoints scored on this dart\r\nexport function applyCricketDart(state: CricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: CricketNumber) => boolean = () => false): number {\r\n\t// Map autoscore terms to logical hits\r\n\tlet num: CricketNumber | null = null\r\n\tlet hits = 0\r\n\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n\t\tnum = 25\r\n\t\thits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n\t} else if (typeof sector === 'number' && (sector as number) >= 15 && (sector as number) <= 20) {\r\n\t\tnum = sector as CricketNumber\r\n\t\tif (ring === 'TRIPLE') hits = 3\r\n\t\telse if (ring === 'DOUBLE') hits = 2\r\n\t\telse hits = 1\r\n\t} else if (value) {\r\n\t\t// Fallback when only numeric score provided (manual): infer by divisibility\r\n\t\tconst cand: CricketNumber[] = [20,19,18,17,16,15]\r\n\t\tfor (const c of cand) {\r\n\t\t\tif (value === c) { num = c; hits = 1; break }\r\n\t\t\tif (value === c*2) { num = c; hits = 2; break }\r\n\t\t\tif (value === c*3) { num = c; hits = 3; break }\r\n\t\t}\r\n\t\tif (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n\t}\r\n\tif (!num) return 0\r\n\r\n\tconst before = state.marks[num]\r\n\tlet remainToClose = Math.max(0, 3 - before)\r\n\tconst toApply = Math.min(remainToClose, hits)\r\n\tconst overflow = Math.max(0, hits - toApply)\r\n\t// Increase marks up to 3\r\n\tconst after = (before + toApply) as CricketMark\r\n\tstate.marks[num] = after > 3 ? 3 : after\r\n\r\n\t// Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\r\n\tlet points = 0\r\n\tif (overflow > 0 && !opponentClosed(num)) {\r\n\t\tif (num === 25) {\r\n\t\t\t// Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\r\n\t\t\tif (ring === 'INNER_BULL') points += 50 * overflow\r\n\t\t\telse points += 25 * overflow\r\n\t\t} else {\r\n\t\t\tpoints += num * overflow\r\n\t\t}\r\n\t}\r\n\r\n\tstate.points += points\r\n\treturn points\r\n}\r\n\r\nexport function hasClosedAll(state: CricketState): boolean {\r\n\treturn CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n\r\nexport function cricketWinner(self: CricketState, opponents: CricketState[]): boolean {\r\n\t// Win when all closed and you have >= opponents' points\r\n\tif (!hasClosedAll(self)) return false\r\n\tconst maxOppPoints = Math.max(0, ...opponents.map(o => o.points))\r\n\treturn self.points >= maxOppPoints\r\n}\r\n","export type ShanghaiRound = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20\r\n\r\nexport type ShanghaiState = {\r\n\tround: ShanghaiRound\r\n\tscore: number\r\n\tfinished: boolean\r\n\tshanghaiAchieved: boolean // single+double+triple of target in same 3-dart turn\r\n\tturnHits: { singles: number; doubles: number; triples: number }\r\n}\r\n\r\nexport function createShanghaiState(): ShanghaiState {\r\n\treturn { round: 1, score: 0, finished: false, shanghaiAchieved: false, turnHits: { singles: 0, doubles: 0, triples: 0 } }\r\n}\r\n\r\nexport function getRoundTarget(state: ShanghaiState): number { return state.round }\r\n\r\n// Apply one dart; returns points scored on this dart\r\nexport function applyShanghaiDart(state: ShanghaiState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst target = getRoundTarget(state)\r\n\tlet points = 0\r\n\tif (typeof sector === 'number' && sector === target) {\r\n\t\tif (ring === 'TRIPLE') { points = target * 3; state.turnHits.triples++ }\r\n\t\telse if (ring === 'DOUBLE') { points = target * 2; state.turnHits.doubles++ }\r\n\t\telse if (ring === 'SINGLE') { points = target * 1; state.turnHits.singles++ }\r\n\t} else if (!sector && (value === target || value === target*2 || value === target*3)) {\r\n\t\t// manual numeric entry fallback\r\n\t\tif (value === target*3) { points = target*3; state.turnHits.triples++ }\r\n\t\telse if (value === target*2) { points = target*2; state.turnHits.doubles++ }\r\n\t\telse if (value === target) { points = target; state.turnHits.singles++ }\r\n\t}\r\n\tstate.score += points\r\n\treturn points\r\n}\r\n\r\n// Call at end of 3-dart turn; advances round and checks Shanghai\r\nexport function endShanghaiTurn(state: ShanghaiState) {\r\n\tif (!state.finished) {\r\n\t\tif (state.turnHits.singles>0 && state.turnHits.doubles>0 && state.turnHits.triples>0) {\r\n\t\t\tstate.shanghaiAchieved = true\r\n\t\t\tstate.finished = true\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst next = (state.round + 1) as ShanghaiRound\r\n\t\tif (next > 20) { state.finished = true } else { state.round = next }\r\n\t}\r\n\t// reset per-turn hits\r\n\tstate.turnHits = { singles: 0, doubles: 0, triples: 0 }\r\n}\r\n","export type HalveItTarget =\r\n\t| { kind: 'ANY_NUMBER' }\r\n\t| { kind: 'DOUBLE'; num: number }\r\n\t| { kind: 'TRIPLE'; num: number }\r\n\t| { kind: 'BULL' }\r\n\t| { kind: 'NUMBER'; num: number }\r\n\r\nexport type HalveItState = {\r\n\tstage: number\r\n\ttargets: HalveItTarget[]\r\n\tscore: number\r\n\tfinished: boolean\r\n\thitThisRound: boolean\r\n}\r\n\r\nexport function createDefaultHalveIt(): HalveItState {\r\n\tconst targets: HalveItTarget[] = [\r\n\t\t{ kind: 'NUMBER', num: 20 },\r\n\t\t{ kind: 'DOUBLE', num: 16 },\r\n\t\t{ kind: 'TRIPLE', num: 14 },\r\n\t\t{ kind: 'NUMBER', num: 19 },\r\n\t\t{ kind: 'BULL' },\r\n\t\t{ kind: 'ANY_NUMBER' },\r\n\t]\r\n\treturn { stage: 0, targets, score: 0, finished: false, hitThisRound: false }\r\n}\r\n\r\nexport function getCurrentHalveTarget(state: HalveItState): HalveItTarget | null {\r\n\treturn state.targets[state.stage] || null\r\n}\r\n\r\nexport function applyHalveItDart(state: HalveItState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst t = getCurrentHalveTarget(state)\r\n\tif (!t) return 0\r\n\tlet scored = 0\r\n\tswitch (t.kind) {\r\n\t\tcase 'NUMBER': {\r\n\t\t\tif (typeof sector === 'number' && sector === t.num) {\r\n\t\t\t\tif (ring === 'TRIPLE') scored = t.num * 3\r\n\t\t\t\telse if (ring === 'DOUBLE') scored = t.num * 2\r\n\t\t\t\telse if (ring === 'SINGLE') scored = t.num\r\n\t\t\t} else if (!sector && (value === t.num || value === t.num*2 || value === t.num*3)) {\r\n\t\t\t\tscored = value\r\n\t\t\t}\r\n\t\t\tif (scored > 0) state.hitThisRound = true\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'DOUBLE': {\r\n\t\t\tif ((ring === 'DOUBLE' && sector === t.num) || value === t.num*2) { scored = t.num*2; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'TRIPLE': {\r\n\t\t\tif ((ring === 'TRIPLE' && sector === t.num) || value === t.num*3) { scored = t.num*3; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'BULL': {\r\n\t\t\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) { scored = (ring === 'INNER_BULL' || value === 50) ? 50 : 25; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'ANY_NUMBER': {\r\n\t\t\t// any valid score counts\r\n\t\t\tif (value > 0) { scored = value; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHalveItTurn(state: HalveItState) {\r\n\tif (state.finished) return\r\n\tif (!state.hitThisRound) {\r\n\t\tstate.score = Math.floor(state.score / 2)\r\n\t}\r\n\tstate.hitThisRound = false\r\n\tstate.stage += 1\r\n\tif (state.stage >= state.targets.length) state.finished = true\r\n}\r\n","export type HighLowState = {\r\n\tround: number\r\n\tscore: number\r\n\ttarget: 'HIGH' | 'LOW'\r\n\tfinished: boolean\r\n}\r\n\r\nexport function createHighLow(): HighLowState {\r\n\treturn { round: 1, score: 0, target: 'HIGH', finished: false }\r\n}\r\n\r\nexport function applyHighLowDart(state: HighLowState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\t// For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\r\n\t// When LOW, count only scores <= 10 (any ring) and bull does not count\r\n\tlet scored = 0\r\n\tif (state.target === 'HIGH') {\r\n\t\tif (ring === 'INNER_BULL') scored = 50\r\n\t\telse if (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector >= 20) scored = v\r\n\t\t} else {\r\n\t\t\t// manual numeric fallback\r\n\t\t\tif (value >= 40) scored = value\r\n\t\t}\r\n\t} else {\r\n\t\tif (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector <= 10) scored = v\r\n\t\t} else {\r\n\t\t\tif (value > 0 && value <= 30) scored = value\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHighLowTurn(state: HighLowState) {\r\n\tif (state.finished) return\r\n\tstate.round += 1\r\n\tif (state.round > 10) { state.finished = true; return }\r\n\tstate.target = state.target === 'HIGH' ? 'LOW' : 'HIGH'\r\n}\r\n","export type KillerState = {\r\n  number: number // assigned sector 1..20\r\n  lives: number // start with 3\r\n  isKiller: boolean // became killer by hitting own double\r\n  eliminated: boolean\r\n}\r\n\r\nexport function createKillerState(assigned: number, lives = 3): KillerState {\r\n  return { number: assigned, lives, isKiller: false, eliminated: false }\r\n}\r\n\r\n// Assign unique random numbers (1..20) to each player id\r\nexport function assignKillerNumbers<T extends string>(playerIds: T[]): Record<T, number> {\r\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1)\r\n  const res: any = {}\r\n  for (const id of playerIds) {\r\n    // pick a random remaining number\r\n    const idx = Math.floor(Math.random() * pool.length)\r\n    const num = pool.splice(idx, 1)[0]\r\n    res[id] = num\r\n  }\r\n  return res\r\n}\r\n\r\n// Apply a single dart in Killer context.\r\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\r\nexport function applyKillerDart(\r\n  selfId: string,\r\n  states: Record<string, KillerState>,\r\n  ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL',\r\n  sector?: number | null\r\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\r\n  const me = states[selfId]\r\n  if (!me || !sector || !ring) return { becameKiller: false }\r\n  // Becoming killer: hit your own DOUBLE only\r\n  if (!me.isKiller && ring === 'DOUBLE' && sector === me.number) {\r\n    me.isKiller = true\r\n    return { becameKiller: true }\r\n  }\r\n  // If already killer, hitting opponents' doubles/triples removes lives\r\n  if (me.isKiller && (ring === 'DOUBLE' || ring === 'TRIPLE')) {\r\n    const victimId = Object.keys(states).find(pid => pid !== selfId && !states[pid].eliminated && states[pid].number === sector)\r\n    if (victimId) {\r\n      const victim = states[victimId]\r\n      const delta = ring === 'TRIPLE' ? 2 : 1\r\n      victim.lives = Math.max(0, victim.lives - delta)\r\n      if (victim.lives === 0) victim.eliminated = true\r\n      return { becameKiller: false, victimId, livesRemoved: delta }\r\n    }\r\n  }\r\n  return { becameKiller: false }\r\n}\r\n\r\nexport function killerWinner(states: Record<string, KillerState>): string | null {\r\n  const alive = Object.entries(states).filter(([,st]) => !st.eliminated && st.lives > 0)\r\n  if (alive.length === 1) return alive[0][0]\r\n  return null\r\n}\r\n","export type BaseballInning = 1|2|3|4|5|6|7|8|9\r\n\r\nexport type BaseballState = {\r\n  inning: BaseballInning\r\n  score: number\r\n  dartsThisInning: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createBaseball(): BaseballState {\r\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false }\r\n}\r\n\r\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\r\nexport function applyBaseballDart(state: BaseballState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): number {\r\n  if (state.finished) return 0\r\n  let runs = 0\r\n  if (typeof sector === 'number' && sector === state.inning) {\r\n    if (ring === 'TRIPLE') runs = 3\r\n    else if (ring === 'DOUBLE') runs = 2\r\n    else runs = 1\r\n  } else if (!sector && (value === state.inning || value === state.inning*2 || value === state.inning*3)) {\r\n    runs = value === state.inning*3 ? 3 : value === state.inning*2 ? 2 : 1\r\n  }\r\n  state.score += runs\r\n  state.dartsThisInning += 1\r\n  if (state.dartsThisInning >= 3) {\r\n    const next = (state.inning + 1) as BaseballInning\r\n    if (next > 9) state.finished = true\r\n    else { state.inning = next; state.dartsThisInning = 0 }\r\n  }\r\n  return runs\r\n}\r\n","export type GolfHole = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18\r\n\r\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\r\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\r\n\r\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\r\n  1: 5, 2: 20, 3: 1, 4: 18, 5: 4, 6: 13, 7: 6, 8: 10, 9: 15,\r\n  10: 2, 11: 17, 12: 3, 13: 19, 14: 7, 15: 16, 16: 8, 17: 11, 18: 14,\r\n}\r\n\r\nexport type GolfState = {\r\n  hole: GolfHole\r\n  strokes: number\r\n  dartsThisHole: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createGolf(): GolfState {\r\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false }\r\n}\r\n\r\nexport function applyGolfDart(state: GolfState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): boolean {\r\n  if (state.finished) return false\r\n  const target = GOLF_TARGETS[state.hole]\r\n  state.dartsThisHole += 1\r\n  const hit = (typeof sector === 'number' && sector === target && (ring==='SINGLE'||ring==='DOUBLE'||ring==='TRIPLE')) || (!sector && (value===target || value===target*2 || value===target*3))\r\n  if (hit) {\r\n    state.strokes += state.dartsThisHole\r\n    // advance to next hole\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n    return true\r\n  }\r\n  // If not finished and took 3 darts, score 3 and advance hole\r\n  if (state.dartsThisHole >= 3) {\r\n    state.strokes += 3\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n  }\r\n  return false\r\n}\r\n","export type TicCell = 0|1|2|3|4|5|6|7|8\r\n\r\n// Map grid cells to targets: center uses Bull; edges/corners use numbers.\r\nexport const TTT_TARGETS: Record<TicCell, { type: 'NUM'|'BULL'; num?: number }> = {\r\n  0: { type: 'NUM', num: 20 }, 1: { type: 'NUM', num: 19 }, 2: { type: 'NUM', num: 18 },\r\n  3: { type: 'NUM', num: 17 }, 4: { type: 'BULL' }, 5: { type: 'NUM', num: 16 },\r\n  6: { type: 'NUM', num: 15 }, 7: { type: 'NUM', num: 14 }, 8: { type: 'NUM', num: 13 },\r\n}\r\n\r\nexport type TicTacToeState = {\r\n  board: Array<'X'|'O'|null>\r\n  turn: 'X'|'O'\r\n  finished: boolean\r\n  winner: 'X'|'O'|'Draw'|null\r\n}\r\n\r\nexport function createTicTacToe(): TicTacToeState {\r\n  return { board: Array(9).fill(null), turn: 'X', finished: false, winner: null }\r\n}\r\n\r\nfunction checkWin(board: Array<'X'|'O'|null>): 'X'|'O'|'Draw'|null {\r\n  const lines = [ [0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6] ]\r\n  for (const [a,b,c] of lines) { if (board[a] && board[a]===board[b] && board[a]===board[c]) return board[a] as 'X'|'O' }\r\n  if (board.every(c => c)) return 'Draw'\r\n  return null\r\n}\r\n\r\nexport function tryClaimCell(state: TicTacToeState, cell: TicCell, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): boolean {\r\n  if (state.finished || state.board[cell]) return false\r\n  const tgt = TTT_TARGETS[cell]\r\n  let ok = false\r\n  if (tgt.type === 'BULL') ok = (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50)\r\n  else if (tgt.type === 'NUM' && typeof tgt.num === 'number') {\r\n    if (typeof sector === 'number' && sector === tgt.num) ok = true\r\n    else if (!sector && (value===tgt.num || value===tgt.num*2 || value===tgt.num*3)) ok = true\r\n  }\r\n  if (!ok) return false\r\n  state.board[cell] = state.turn\r\n  const w = checkWin(state.board)\r\n  if (w) { state.finished = true; state.winner = w; return true }\r\n  state.turn = state.turn === 'X' ? 'O' : 'X'\r\n  return true\r\n}\r\n","export type AmCricketMark = 0 | 1 | 2 | 3\r\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25\r\n\r\nexport type AmCricketState = {\r\n  marks: Record<AmCricketNumber, AmCricketMark>\r\n  points: number\r\n}\r\n\r\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [20, 19, 18, 17, 16, 15, 14, 13, 12, 25]\r\n\r\nexport function createAmCricketState(): AmCricketState {\r\n  const marks: any = {}\r\n  AM_CRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n  return { marks, points: 0 }\r\n}\r\n\r\nexport function applyAmCricketDart(state: AmCricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: AmCricketNumber) => boolean = () => false): number {\r\n  let num: AmCricketNumber | null = null\r\n  let hits = 0\r\n  if (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n    num = 25\r\n    hits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n  } else if (typeof sector === 'number' && sector >= 12 && sector <= 20) {\r\n    num = sector as AmCricketNumber\r\n    if (ring === 'TRIPLE') hits = 3\r\n    else if (ring === 'DOUBLE') hits = 2\r\n    else hits = 1\r\n  } else if (value) {\r\n    for (const c of [20,19,18,17,16,15,14,13,12] as AmCricketNumber[]) {\r\n      if (value === c) { num = c; hits = 1; break }\r\n      if (value === c*2) { num = c; hits = 2; break }\r\n      if (value === c*3) { num = c; hits = 3; break }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n  }\r\n  if (!num) return 0\r\n\r\n  const before = state.marks[num]\r\n  const toClose = Math.max(0, 3 - before)\r\n  const toApply = Math.min(toClose, hits)\r\n  const overflow = Math.max(0, hits - toApply)\r\n  const after = (before + toApply) as AmCricketMark\r\n  state.marks[num] = after > 3 ? 3 : after\r\n\r\n  let points = 0\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      if (ring === 'INNER_BULL') points += 50 * overflow\r\n      else points += 25 * overflow\r\n    } else {\r\n      points += (num as number) * overflow\r\n    }\r\n  }\r\n  state.points += points\r\n  return points\r\n}\r\n\r\nexport function hasClosedAllAm(state: AmCricketState): boolean {\r\n  return AM_CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n","\r\nimport { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { suggestCheckouts, sayScore } from '../utils/checkout';\r\nimport { useUserSettings } from '../store/userSettings';\r\nimport { useToast } from '../store/toast';\r\nimport CameraTile from './CameraTile'\r\nimport CameraView from './CameraView'\r\nimport HeatMap from './HeatMap'\r\nimport { getUserCurrency, formatPriceInCurrency } from '../utils/config';\r\nimport { bumpGameMode } from '../store/profileStats'\r\nimport { DOUBLE_PRACTICE_ORDER, isDoubleHit, parseManualDart } from '../game/types'\r\nimport { ATC_ORDER } from '../game/aroundTheClock'\r\nimport { createCricketState, applyCricketDart, CRICKET_NUMBERS, hasClosedAll as cricketClosedAll } from '../game/cricket'\r\nimport { createShanghaiState, applyShanghaiDart, endShanghaiTurn } from '../game/shanghai'\r\nimport { createDefaultHalveIt, getCurrentHalveTarget, applyHalveItDart, endHalveItTurn } from '../game/halveIt'\r\nimport { createHighLow, applyHighLowDart, endHighLowTurn } from '../game/highLow'\r\nimport { createKillerState, assignKillerNumbers, applyKillerDart, killerWinner, KillerState } from '../game/killer'\r\nimport { createBaseball, applyBaseballDart } from '../game/baseball'\r\nimport { createGolf, applyGolfDart } from '../game/golf'\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from '../game/ticTacToe'\r\nimport { createAmCricketState, applyAmCricketDart, AM_CRICKET_NUMBERS, hasClosedAllAm } from '../game/americanCricket'\r\nimport ResizableModal from './ui/ResizableModal'\r\n\r\nconst freeGames = ['X01', 'Double Practice'];\r\nconst premiumGames = [\r\n  'Around the Clock',\r\n  'Cricket',\r\n  'Halve It',\r\n  'Shanghai',\r\n  'High-Low',\r\n  'Killer',\r\n  \"Bob's 27\",\r\n  'Count-Up',\r\n  'High Score',\r\n  'Low Score',\r\n  'Checkout 170',\r\n  'Checkout 121',\r\n  'Treble Practice',\r\n];\r\nconst aiLevels = ['Easy', 'Medium', 'Hardened'];\r\n\r\nfunction clamp(n: number, min: number, max: number) {\r\n  return Math.max(min, Math.min(max, n))\r\n}\r\n\r\nfunction aiVisitScore(remaining: number, level: string): number {\r\n  // Very simple AI: target a plausible 3-dart total based on difficulty\r\n  // Then adjust down if it would overshoot remaining.\r\n  let target = 0\r\n  if (level === 'Easy') {\r\n    const candidates = [22, 26, 41, 45, 60]\r\n    target = candidates[Math.floor(Math.random() * candidates.length)]\r\n  } else if (level === 'Medium') {\r\n    // around 60 with some variance\r\n    target = Math.round(clamp(60 + (Math.random() * 30 - 15), 30, 100))\r\n  } else {\r\n    // Hardened: around 80 with tighter variance\r\n    target = Math.round(clamp(80 + (Math.random() * 20 - 10), 50, 120))\r\n  }\r\n  if (remaining <= 0) return 0\r\n  if (target > remaining) {\r\n    // Try to pick something that doesn't bust\r\n    const safe = [100, 85, 81, 60, 57, 45, 41, 26, 22, 20, 1].find(v => v <= remaining)\r\n    return safe ?? 0\r\n  }\r\n  return target\r\n}\r\n\r\nfunction X01RulesPopup({ onClose }: { onClose: () => void }) {\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n      <div className=\"card max-w-lg w-full relative\">\r\n        <button className=\"absolute top-2 right-2 btn px-2 py-1\" onClick={onClose}>Close</button>\r\n        <h3 className=\"text-xl font-bold mb-2\">X01 Rules & Regulations</h3>\r\n        <ul className=\"list-disc pl-5 text-left mb-2\">\r\n          <li>Double In: Start scoring only after hitting a double.</li>\r\n          <li>Double Out: Finish the game by hitting a double to reach exactly zero.</li>\r\n          <li>Best Of: Play a set number of legs, winner is first to reach majority.</li>\r\n          <li>First To: Play until a player reaches a set number of legs.</li>\r\n          <li>No Cheating: All scores must be valid, no manual score changes mid-leg.</li>\r\n          <li>Competitive Standard: Follow latest WDF/PDC rules for match play.</li>\r\n        </ul>\r\n        <p className=\"text-sm text-slate-600\">For full details, see official darts governing body rules.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n\r\nexport default function OfflinePlay({ user }: { user: any }) {\r\n  const { offlineLayout } = useUserSettings()\r\n  const [selectedMode, setSelectedMode] = useState('X01');\r\n  const [x01Score, setX01Score] = useState(501);\r\n  const [ai, setAI] = useState('None');\r\n  const [showRules, setShowRules] = useState(false);\r\n  const [inMatch, setInMatch] = useState(false);\r\n  const [playerScore, setPlayerScore] = useState(x01Score);\r\n  const [aiScore, setAiScore] = useState(x01Score);\r\n  const [onDouble, setOnDouble] = useState(false);\r\n  const [showWinPopup, setShowWinPopup] = useState(false);\r\n  // Match format: First-to selector and leg counters\r\n  const [firstTo, setFirstTo] = useState<number>(1)\r\n  const [playerLegs, setPlayerLegs] = useState<number>(0)\r\n  const [aiLegs, setAiLegs] = useState<number>(0)\r\n  const [pendingLegWinner, setPendingLegWinner] = useState<'player'|'ai'|null>(null)\r\n  const [doubleDarts, setDoubleDarts] = useState(1);\r\n  const [checkoutDarts, setCheckoutDarts] = useState(1);\r\n  const [legStats, setLegStats] = useState<{ winner: 'player'|'ai'; doubleDarts: number; checkoutDarts: number; doublesAtt?: number; doublesHit?: number }[]>([]);\r\n  // New: pre-game adjustable AI delay (ms)\r\n  const [aiDelayMs, setAiDelayMs] = useState<number>(2000)\r\n  const toast = useToast();\r\n  // New: match popup state\r\n  const [showMatchModal, setShowMatchModal] = useState(false)\r\n  // Mirror Online layout defaults when in modern layout, otherwise keep classic feel\r\n  const [maximized, setMaximized] = useState(offlineLayout === 'modern')\r\n  const [fitAll, setFitAll] = useState(offlineLayout === 'modern')\r\n  // React to layout changes at runtime\r\n  useEffect(() => {\r\n    setMaximized(offlineLayout === 'modern')\r\n    setFitAll(offlineLayout === 'modern')\r\n  }, [offlineLayout])\r\n  const [fitScale, setFitScale] = useState(1)\r\n  const [isPlayerTurn, setIsPlayerTurn] = useState(true)\r\n  // Per-dart input and stats\r\n  const [playerDartPoints, setPlayerDartPoints] = useState<number>(0)\r\n  const [dpIndex, setDpIndex] = useState<number>(0) // 0..20 (DBULL at 20)\r\n  const [dpHits, setDpHits] = useState<number>(0)\r\n  // Around the Clock (offline practice)\r\n  const [atcIndex, setAtcIndex] = useState<number>(0)\r\n  const [atcHits, setAtcHits] = useState<number>(0)\r\n  // Practice mode states\r\n  const [cricket, setCricket] = useState(createCricketState())\r\n  const [shanghai, setShanghai] = useState(createShanghaiState())\r\n  const [halve, setHalve] = useState(createDefaultHalveIt())\r\n  const [highlow, setHighlow] = useState(createHighLow())\r\n  const [practiceTurnDarts, setPracticeTurnDarts] = useState<number>(0)\r\n  // Phase 1 practice modes\r\n  const [b27Stage, setB27Stage] = useState<number>(1)\r\n  const [b27Score, setB27Score] = useState<number>(27)\r\n  const [b27Darts, setB27Darts] = useState<number>(0)\r\n  const [b27Hits, setB27Hits] = useState<number>(0)\r\n  const [b27Finished, setB27Finished] = useState<boolean>(false)\r\n  const [cuRound, setCuRound] = useState<number>(1)\r\n  const [cuScore, setCuScore] = useState<number>(0)\r\n  const [cuDarts, setCuDarts] = useState<number>(0)\r\n  const cuMaxRounds = 8\r\n  const [hsRound, setHsRound] = useState<number>(1)\r\n  const [hsScore, setHsScore] = useState<number>(0)\r\n  const [hsDarts, setHsDarts] = useState<number>(0)\r\n  const hsMaxRounds = 10\r\n  const [lsRound, setLsRound] = useState<number>(1)\r\n  const [lsScore, setLsScore] = useState<number>(0)\r\n  const [lsDarts, setLsDarts] = useState<number>(0)\r\n  const lsMaxRounds = 10\r\n  const [co170Rem, setCo170Rem] = useState<number>(170)\r\n  const [co170Darts, setCo170Darts] = useState<number>(0)\r\n  const [co170Attempts, setCo170Attempts] = useState<number>(0)\r\n  const [co170Successes, setCo170Successes] = useState<number>(0)\r\n  const [co121Rem, setCo121Rem] = useState<number>(121)\r\n  const [co121Darts, setCo121Darts] = useState<number>(0)\r\n  const [co121Attempts, setCo121Attempts] = useState<number>(0)\r\n  const [co121Successes, setCo121Successes] = useState<number>(0)\r\n  const [trebleTarget, setTrebleTarget] = useState<number>(20)\r\n  const [trebleHits, setTrebleHits] = useState<number>(0)\r\n  const [trebleDarts, setTrebleDarts] = useState<number>(0)\r\n  // Phase 2 states\r\n  const [baseball, setBaseball] = useState(createBaseball())\r\n  const [golf, setGolf] = useState(createGolf())\r\n  const [ttt, setTTT] = useState(createTicTacToe())\r\n  const [amCricket, setAmCricket] = useState(createAmCricketState())\r\n  // Killer (hotseat) state\r\n  const [killerPlayers, setKillerPlayers] = useState<Array<{ id: string; name: string }>>([\r\n    { id: 'p1', name: 'Player 1' },\r\n    { id: 'p2', name: 'Player 2' },\r\n  ])\r\n  const [killerStates, setKillerStates] = useState<Record<string, KillerState>>({})\r\n  const [killerAssigned, setKillerAssigned] = useState<Record<string, number>>({})\r\n  const [killerSetupDone, setKillerSetupDone] = useState<boolean>(false)\r\n  const [killerTurnIdx, setKillerTurnIdx] = useState<number>(0)\r\n  const [killerDarts, setKillerDarts] = useState<number>(0)\r\n  const [killerWinnerId, setKillerWinnerId] = useState<string | null>(null)\r\n  const [killerLastEvent, setKillerLastEvent] = useState<string>('')\r\n  const [playerDartsThrown, setPlayerDartsThrown] = useState<number>(0)\r\n  const [playerLastDart, setPlayerLastDart] = useState<number>(0)\r\n  const [playerVisitDarts, setPlayerVisitDarts] = useState<number>(0)\r\n  const [playerVisitStart, setPlayerVisitStart] = useState<number>(x01Score)\r\n  const [playerVisitSum, setPlayerVisitSum] = useState<number>(0)\r\n  const [playerVisitDartsAtDouble, setPlayerVisitDartsAtDouble] = useState<number>(0)\r\n  const [aiCountdownMs, setAiCountdownMs] = useState<number>(0)\r\n  const aiTimerRef = useRef<number | null>(null)\r\n  const [aiDartsThrown, setAiDartsThrown] = useState<number>(0)\r\n  const [aiLastDart, setAiLastDart] = useState<number>(0)\r\n  const [aiVisitSum, setAiVisitSum] = useState<number>(0)\r\n  const [aiVisitDartsAtDouble, setAiVisitDartsAtDouble] = useState<number>(0)\r\n  // Doubles attempts/hits\r\n  const [playerDoublesAtt, setPlayerDoublesAtt] = useState<number>(0)\r\n  const [playerDoublesHit, setPlayerDoublesHit] = useState<number>(0)\r\n  const [aiDoublesAtt, setAiDoublesAtt] = useState<number>(0)\r\n  const [aiDoublesHit, setAiDoublesHit] = useState<number>(0)\r\n  // Match-long totals for averages\r\n  const [totalPlayerDarts, setTotalPlayerDarts] = useState<number>(0)\r\n  const [totalAiDarts, setTotalAiDarts] = useState<number>(0)\r\n  const [totalPlayerPoints, setTotalPlayerPoints] = useState<number>(0)\r\n  const [totalAiPoints, setTotalAiPoints] = useState<number>(0)\r\n  // Power scoring and checkout highs\r\n  const [player180s, setPlayer180s] = useState<number>(0)\r\n  const [player140s, setPlayer140s] = useState<number>(0)\r\n  const [player100s, setPlayer100s] = useState<number>(0)\r\n  const [ai180s, setAi180s] = useState<number>(0)\r\n  const [ai140s, setAi140s] = useState<number>(0)\r\n  const [ai100s, setAi100s] = useState<number>(0)\r\n  const [playerHighestCheckout, setPlayerHighestCheckout] = useState<number>(0)\r\n  const [aiHighestCheckout, setAiHighestCheckout] = useState<number>(0)\r\n  // End-of-match summary modal\r\n  const [showMatchSummary, setShowMatchSummary] = useState<boolean>(false)\r\n  // Manual correction input for offline (matches CameraView UX)\r\n  const [manualBox, setManualBox] = useState<string>('')\r\n  const [manualTextarea, setManualTextarea] = useState<string>('')\r\n  // Settings: favourite double and caller\r\n  const { favoriteDouble, callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, rememberLastOffline, setLastOffline, autoStartOffline, cameraScale, setCameraScale, cameraAspect = 'wide', setCameraAspect, cameraEnabled, textSize, boxSize, autoscoreProvider } = useUserSettings()\r\n  const manualScoring = autoscoreProvider === 'manual'\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case 'small': return 'px-1.5 py-0.5 text-xs'\r\n      case 'large': return 'px-3 py-1 text-sm'\r\n      default: return 'px-2 py-0.5 text-sm'\r\n    }\r\n  }\r\n  const buttonSizeClass = getButtonSizeClasses(textSize)\r\n  // Fit-all scaling measurement\r\n  const scrollerRef = useRef<HTMLDivElement | null>(null)\r\n  const contentRef = useRef<HTMLDivElement | null>(null)\r\n  const headerBarRef = useRef<HTMLDivElement | null>(null)\r\n  // Match format controls (offline only): First to N or Best of N with editable count\r\n  const [formatType, setFormatType] = useState<'first'|'best'>('first')\r\n  const [formatCount, setFormatCount] = useState<number>(1)\r\n  const formatRef = useRef<HTMLDivElement | null>(null)\r\n  // Keep internal required wins (firstTo) in sync with format selection\r\n  useEffect(() => {\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1))\r\n    const wins = formatType === 'first' ? n : Math.max(1, Math.ceil(n / 2))\r\n    setFirstTo(wins)\r\n  }, [formatType, formatCount])\r\n  useEffect(() => {\r\n    if (!fitAll) { setFitScale(1); return }\r\n    const measure = () => {\r\n      const scroller = scrollerRef.current\r\n      const content = contentRef.current\r\n      if (!scroller || !content) return\r\n      // Available size excludes the sticky header inside the scroller\r\n      const headerH = headerBarRef.current ? headerBarRef.current.getBoundingClientRect().height : 0\r\n      const availH = Math.max(0, scroller.clientHeight - headerH - 6) // small breathing room\r\n      const availW = Math.max(0, scroller.clientWidth - 8)\r\n      // Measure the content size without scale\r\n      const rect = content.getBoundingClientRect()\r\n      const currentScale = fitScale || 1\r\n      const naturalHeight = rect.height / currentScale\r\n      const naturalWidth = rect.width / currentScale\r\n      // Compute scale to fit both height and width\r\n      const scaleH = availH > 0 ? (availH / naturalHeight) : 1\r\n      const scaleW = availW > 0 ? (availW / naturalWidth) : 1\r\n      const next = Math.min(1, Math.max(0.5, Math.min(scaleH, scaleW)))\r\n      setFitScale(next)\r\n    }\r\n    measure()\r\n  const RO: any = (window as any).ResizeObserver\r\n  const ro = RO ? new RO(() => measure()) : null\r\n  ro && scrollerRef.current && ro.observe(scrollerRef.current as any)\r\n  ro && contentRef.current && ro.observe(contentRef.current as any)\r\n    window.addEventListener('resize', measure)\r\n    return () => {\r\n      window.removeEventListener('resize', measure)\r\n      try { ro && scrollerRef.current && ro.unobserve(scrollerRef.current as any) } catch {}\r\n      try { ro && contentRef.current && ro.unobserve(contentRef.current as any) } catch {}\r\n    }\r\n  }, [fitAll, fitScale])\r\n\r\n\r\n  // Auto-start handler (from Home or other tabs)\r\n  useEffect(() => {\r\n    const onAuto = (e: any) => {\r\n      const m = e?.detail?.mode as string | undefined\r\n      if (!m) return\r\n      setSelectedMode(m)\r\n      // For Double Practice we could load a specific flow. For now, we just open the X01-like modal with immediate start.\r\n      startMatch()\r\n    }\r\n    window.addEventListener('ndn:auto-start', onAuto as any)\r\n    return () => window.removeEventListener('ndn:auto-start', onAuto as any)\r\n  }, [])\r\n\r\n  // Accept demo parameters to preconfigure format and starting score before auto-start\r\n  useEffect(() => {\r\n    const onFmt = (e: any) => {\r\n      const t = e?.detail?.formatType\r\n      const c = e?.detail?.formatCount\r\n      const s = e?.detail?.startScore\r\n      if (t === 'first' || t === 'best') setFormatType(t)\r\n      if (typeof c === 'number' && isFinite(c)) setFormatCount(Math.max(1, Math.floor(c)))\r\n      if (typeof s === 'number' && isFinite(s)) setX01Score(Math.max(1, Math.floor(s)))\r\n    }\r\n    window.addEventListener('ndn:offline-format', onFmt as any)\r\n    return () => window.removeEventListener('ndn:offline-format', onFmt as any)\r\n  }, [])\r\n\r\n  // Auto-start last offline match when opening this tab, if enabled\r\n  useEffect(() => {\r\n    if (!autoStartOffline) return\r\n    // Kick off a match after initial render for a smooth modal open\r\n    const id = setTimeout(() => startMatch(), 50)\r\n    return () => clearTimeout(id)\r\n  }, [autoStartOffline])\r\n\r\n  // Drive AI countdown and perform AI visit when countdown elapses\r\n  useEffect(() => {\r\n    if (!showMatchModal || isPlayerTurn || ai === 'None' || aiCountdownMs <= 0) return\r\n    let raf: number\r\n    let last = performance.now()\r\n    const tick = (now: number) => {\r\n      const dt = now - last\r\n      last = now\r\n      setAiCountdownMs(prev => {\r\n        const next = prev - dt\r\n        if (next <= 0) {\r\n          // Execute AI visit per dart (up to 3 darts or until finish/bust)\r\n          let visitDarts = 0\r\n          let remaining = aiScore\r\n          while (visitDarts < 3 && remaining > 0) {\r\n            const targetVisit = aiVisitScore(remaining, ai)\r\n            // break target into up to 3 darts (roughly 20 per dart for easy split)\r\n            const dart = clamp(targetVisit - visitDarts*20, 0, Math.min(60, remaining))\r\n            const after = remaining - dart\r\n            setAiLastDart(dart)\r\n            setAiDartsThrown(d => d + 1)\r\n            setTotalAiDarts(d => d + 1)\r\n            if (after < 0) {\r\n              // bust: revert to remaining before visit\r\n              remaining = aiScore\r\n              setAiVisitSum(0)\r\n              setAiVisitDartsAtDouble(0)\r\n              break\r\n            }\r\n            // Only add points after confirming not a bust\r\n            setAiVisitSum(s => s + dart)\r\n            setTotalAiPoints(p => p + dart)\r\n            // Track darts at double window\r\n            const preRem = remaining\r\n            const postRem = after\r\n            if (preRem > 50 && postRem <= 50) setAiVisitDartsAtDouble(1)\r\n            else if (preRem <= 50) setAiVisitDartsAtDouble(c => c + 1)\r\n            remaining = after\r\n            visitDarts += 1\r\n            if (remaining === 0) break\r\n          }\r\n          setAiScore(remaining)\r\n          if (remaining === 0) {\r\n            // Power score classification\r\n            if (aiVisitSum === 180) setAi180s(n => n + 1)\r\n            else if (aiVisitSum >= 140) setAi140s(n => n + 1)\r\n            else if (aiVisitSum >= 100) setAi100s(n => n + 1)\r\n            // Highest checkout\r\n            const checkout = aiScore\r\n            if (checkout <= 170) setAiHighestCheckout(h => Math.max(h, checkout))\r\n            // Doubles attempts/hit if finished from <= 50\r\n            if (aiScore <= 50) {\r\n              setAiDoublesAtt(a => a + (aiVisitDartsAtDouble > 0 ? aiVisitDartsAtDouble : 1))\r\n              setAiDoublesHit(h => h + 1)\r\n            }\r\n            setAiVisitSum(0)\r\n            setAiVisitDartsAtDouble(0)\r\n            // AI won the leg\r\n            setPendingLegWinner('ai')\r\n            setShowWinPopup(true)\r\n          }\r\n          // If AI did not finish, but threw 3 darts this visit, classify power score and reset visit sum\r\n          if (remaining > 0 && visitDarts >= 3) {\r\n            if (aiVisitSum === 180) setAi180s(n => n + 1)\r\n            else if (aiVisitSum >= 140) setAi140s(n => n + 1)\r\n            else if (aiVisitSum >= 100) setAi100s(n => n + 1)\r\n            setAiVisitSum(0)\r\n            setAiVisitDartsAtDouble(0)\r\n          }\r\n          // Hand turn back to player\r\n          setIsPlayerTurn(true)\r\n          return 0\r\n        }\r\n        return next\r\n      })\r\n      if (aiCountdownMs > 0) raf = requestAnimationFrame(tick)\r\n    }\r\n    raf = requestAnimationFrame(tick)\r\n    return () => cancelAnimationFrame(raf)\r\n  }, [showMatchModal, isPlayerTurn, ai, aiCountdownMs, aiScore])\r\n\r\n  function startMatch() {\r\n    setInMatch(true);\r\n    setPlayerScore(x01Score);\r\n    setAiScore(x01Score);\r\n    setOnDouble(false);\r\n    setShowMatchModal(true);\r\n    setIsPlayerTurn(true);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown(0);\r\n    setPlayerLastDart(0);\r\n    setPlayerVisitDarts(0);\r\n    setPlayerVisitStart(x01Score);\r\n    setPlayerVisitSum(0)\r\n  setPlayerVisitDartsAtDouble(0)\r\n    setAiCountdownMs(0);\r\n    setAiDartsThrown(0);\r\n    setAiLastDart(0);\r\n    setAiVisitSum(0)\r\n    setPendingLegWinner(null)\r\n    // When starting a brand-new match from menu, reset legs\r\n  setPlayerLegs(0)\r\n  setAiLegs(0)\r\n    setLegStats([])\r\n    // Reset match-long totals\r\n    setTotalPlayerDarts(0); setTotalAiDarts(0)\r\n    setTotalPlayerPoints(0); setTotalAiPoints(0)\r\n    setPlayer180s(0); setPlayer140s(0); setPlayer100s(0)\r\n    setAi180s(0); setAi140s(0); setAi100s(0)\r\n    setPlayerHighestCheckout(0); setAiHighestCheckout(0)\r\n    setPlayerDoublesAtt(0); setPlayerDoublesHit(0)\r\n    setAiDoublesAtt(0); setAiDoublesHit(0)\r\n    // Sync required wins from current format selection\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1))\r\n    setFirstTo(formatType === 'first' ? n : Math.max(1, Math.ceil(n/2)))\r\n    if (rememberLastOffline) {\r\n      try { setLastOffline({ mode: selectedMode, x01Start: x01Score, firstTo, aiLevel: ai }) } catch {}\r\n    }\r\n  }\r\n\r\n  function startNextLeg() {\r\n    setPlayerScore(x01Score)\r\n    setAiScore(x01Score)\r\n    setOnDouble(false)\r\n    setShowMatchModal(true)\r\n    setIsPlayerTurn(true)\r\n    setPlayerDartPoints(0)\r\n    setPlayerDartsThrown(0)\r\n    setPlayerLastDart(0)\r\n    setPlayerVisitDarts(0)\r\n    setPlayerVisitStart(x01Score)\r\n    setPlayerVisitSum(0)\r\n  setPlayerVisitDartsAtDouble(0)\r\n    setAiCountdownMs(0)\r\n    setAiDartsThrown(0)\r\n    setAiLastDart(0)\r\n    setAiVisitSum(0)\r\n    setPendingLegWinner(null)\r\n  }\r\n\r\n  // --- Offline per-dart helpers ---\r\n  function endTurn(nextRemaining: number) {\r\n    setPlayerVisitDarts(0)\r\n    setPlayerVisitStart(nextRemaining === 0 ? x01Score : playerScore)\r\n    setPlayerVisitDartsAtDouble(0)\r\n    if (ai !== 'None') { setIsPlayerTurn(false); setAiCountdownMs(aiDelayMs) } else setIsPlayerTurn(false)\r\n  }\r\n\r\n  function applyDartValue(dart: number) {\r\n    const remaining = playerScore - dart\r\n    const newVisitDarts = playerVisitDarts + 1\r\n    setPlayerLastDart(dart)\r\n    setPlayerDartsThrown(d => d + 1)\r\n    setTotalPlayerDarts(d => d + 1)\r\n    if (remaining < 0) {\r\n      // bust: revert to visit start, end turn\r\n      setPlayerScore(playerVisitStart)\r\n      endTurn(playerVisitStart)\r\n      setPlayerDartPoints(0)\r\n      setPlayerVisitSum(0)\r\n      setPlayerVisitDartsAtDouble(0)\r\n      return\r\n    }\r\n    setPlayerScore(remaining)\r\n  if (callerEnabled) sayScore(user?.username || 'Player', dart, Math.max(remaining, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n    setPlayerVisitDarts(newVisitDarts)\r\n    setPlayerVisitSum(s => s + dart)\r\n    setTotalPlayerPoints(p => p + dart)\r\n    setPlayerDartPoints(0)\r\n    // Start/continue counting darts at a double when remaining <= 50 and on a valid finish path\r\n    const preRemaining = playerScore\r\n    const postRemaining = remaining\r\n    const startedDoubleWindow = preRemaining > 50 && postRemaining <= 50\r\n    const stillInDoubleWindow = preRemaining <= 50\r\n    if (startedDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(1)\r\n    } else if (stillInDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(c => c + 1)\r\n    }\r\n    if (remaining === 0) {\r\n      // Player wins the leg\r\n      // Power score classification on final visit\r\n      if (playerVisitSum + dart === 180) setPlayer180s(n => n + 1)\r\n      else if (playerVisitSum + dart >= 140) setPlayer140s(n => n + 1)\r\n      else if (playerVisitSum + dart >= 100) setPlayer100s(n => n + 1)\r\n      // Highest checkout if <= 170\r\n      const checkout = playerVisitStart\r\n      if (checkout <= 170) setPlayerHighestCheckout(h => Math.max(h, checkout))\r\n      // Count a double hit only if last dart is a double that takes out from <= 50\r\n      if (preRemaining <= 50) {\r\n        setPlayerDoublesAtt(a => a + (playerVisitDartsAtDouble > 0 ? playerVisitDartsAtDouble : 1))\r\n        setPlayerDoublesHit(h => h + 1)\r\n      }\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n      return\r\n    }\r\n    if (newVisitDarts >= 3) {\r\n      // Classify power score for completed visit\r\n      if (playerVisitSum + dart === 180) setPlayer180s(n => n + 1)\r\n      else if (playerVisitSum + dart >= 140) setPlayer140s(n => n + 1)\r\n      else if (playerVisitSum + dart >= 100) setPlayer100s(n => n + 1)\r\n      endTurn(remaining)\r\n      setPlayerVisitSum(0)\r\n      setPlayerVisitDartsAtDouble(0)\r\n    }\r\n  }\r\n\r\n  function addDartNumeric() {\r\n    const dart = clamp(Math.round(Number(playerDartPoints) || 0), 0, 60)\r\n    applyDartValue(dart)\r\n  }\r\n\r\n  // --- Double Practice helpers ---\r\n  function addDpValue(val: number) {\r\n    const dart = clamp(Math.round(val || 0), 0, 60)\r\n    setPlayerLastDart(dart)\r\n    setPlayerDartsThrown(d => d + 1)\r\n    setTotalPlayerDarts(d => d + 1)\r\n    if (isDoubleHit(dart, dpIndex)) {\r\n      const nextHits = dpHits + 1\r\n      setDpHits(nextHits)\r\n      setDpIndex(i => Math.min(20, i + 1))\r\n      // End when DBULL (index 20) is hit\r\n      if (nextHits >= 21) {\r\n        setPendingLegWinner('player')\r\n        setShowWinPopup(true)\r\n      }\r\n    }\r\n    setPlayerDartPoints(0)\r\n  }\r\n  function addDpNumeric() { addDpValue(Number(playerDartPoints)) }\r\n  function addDpManual() {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like D16, 50, 25, T20'); return }\r\n    addDpValue(v)\r\n    setManualBox('')\r\n  }\r\n\r\n  // Bob's 27\r\n  function addB27Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (b27Finished) return\r\n    const target = b27Stage\r\n    const hit = (ring === 'DOUBLE' && sector === target) || (!ring && value === target*2)\r\n    if (hit) setB27Hits(h => h + 1)\r\n    setB27Darts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        const totalHits = b27Hits + (hit?1:0)\r\n        if (totalHits > 0) setB27Score(s => s + totalHits * target * 2)\r\n        else setB27Score(s => s - target * 2)\r\n        const next = target + 1\r\n        setB27Stage(next)\r\n        setB27Hits(0)\r\n        if (next > 20) setB27Finished(true)\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addB27Numeric() { addB27Auto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n  function resetB27() { setB27Stage(1); setB27Score(27); setB27Darts(0); setB27Hits(0); setB27Finished(false) }\r\n\r\n  // Count-Up / High Score / Low Score\r\n  function addCountUpAuto(value: number) { setCuScore(s => s + Math.max(0, value|0)); setCuDarts(d => { const nd=d+1; if(nd>=3){ setCuRound(r=>r+1); return 0 } return nd }) }\r\n  function addHighScoreAuto(value: number) { setHsScore(s => s + Math.max(0, value|0)); setHsDarts(d => { const nd=d+1; if(nd>=3){ setHsRound(r=>r+1); return 0 } return nd }) }\r\n  function addLowScoreAuto(value: number) { setLsScore(s => s + Math.max(0, value|0)); setLsDarts(d => { const nd=d+1; if(nd>=3){ setLsRound(r=>r+1); return 0 } return nd }) }\r\n\r\n  // Checkout routines (double out)\r\n  function applyCheckout(rem: number, setRem: (n:number)=>void, darts: number, setDarts: (f:(n:number)=>number)=>void, setAttempts: (f:(n:number)=>number)=>void, setSuccesses: (f:(n:number)=>number)=>void, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') {\r\n    const next = rem - value\r\n    if (next < 0) {\r\n      // bust: ignore progress during attempt\r\n    } else if (next === 0) {\r\n      if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n        setSuccesses(s => s + 1)\r\n        setAttempts(a => a + 1)\r\n        setDarts(()=>0)\r\n        setRem(rem) // caller will reset to initial value right after\r\n        return\r\n      }\r\n    } else {\r\n      setRem(next)\r\n    }\r\n    setDarts(d => { const nd = d + 1; if (nd>=3) { setAttempts(a=>a+1); return 0 } return nd })\r\n  }\r\n  function addCo170Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') { applyCheckout(co170Rem, setCo170Rem, co170Darts, setCo170Darts, setCo170Attempts, setCo170Successes, value, ring); if (co170Darts+1>=3) setCo170Rem(170) }\r\n  function addCo121Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') { applyCheckout(co121Rem, setCo121Rem, co121Darts, setCo121Darts, setCo121Attempts, setCo121Successes, value, ring); if (co121Darts+1>=3) setCo121Rem(121) }\r\n  function addCoManual(is170: boolean) {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like T20, D16, 25, 50'); return }\r\n    const t = manualBox.trim().toUpperCase()\r\n    const isDouble = t.startsWith('D') || t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL' || t.includes('INNER')\r\n    if (is170) addCo170Auto(v, isDouble?'DOUBLE':undefined); else addCo121Auto(v, isDouble?'DOUBLE':undefined)\r\n    setManualBox('')\r\n  }\r\n  function resetCo170() { setCo170Rem(170); setCo170Darts(0); setCo170Attempts(0); setCo170Successes(0) }\r\n  function resetCo121() { setCo121Rem(121); setCo121Darts(0); setCo121Attempts(0); setCo121Successes(0) }\r\n\r\n  // Treble practice\r\n  function addTrebleAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) { if (ring==='TRIPLE' && sector===trebleTarget) setTrebleHits(h=>h+1); else if(!ring && value===trebleTarget*3) setTrebleHits(h=>h+1); setTrebleDarts(d=>d+1) }\r\n  function resetTreble() { setTrebleHits(0); setTrebleDarts(0) }\r\n\r\n  // Baseball\r\n  function addBaseballAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    setBaseball(prev => { const cp = { ...prev }; applyBaseballDart(cp as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetBaseball() { setBaseball(createBaseball()) }\r\n\r\n  // Golf\r\n  function addGolfAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    setGolf(prev => { const cp = { ...prev }; applyGolfDart(cp as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetGolf() { setGolf(createGolf()) }\r\n\r\n  // Tic Tac Toe\r\n  function addTttAuto(cell: number, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setTTT(prev => { const cp = { ...prev, board: [...prev.board] as any }; tryClaimCell(cp as any, cell as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetTtt() { setTTT(createTicTacToe()) }\r\n\r\n  // American Cricket\r\n  function addAmCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setAmCricket(prev => { const cp = { ...prev, marks: { ...prev.marks } }; applyAmCricketDart(cp as any, value, ring as any, sector, () => false); return cp })\r\n  }\r\n  function resetAmCricket() { setAmCricket(createAmCricketState()) }\r\n\r\n  // --- Around the Clock helpers ---\r\n  function addAtcValue(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const target = ATC_ORDER[atcIndex]\r\n    let hit = false\r\n    if (typeof sector === 'number' && sector === target && (ring === 'SINGLE' || ring === 'DOUBLE' || ring === 'TRIPLE')) hit = true\r\n    if (target === 25 && (ring === 'BULL' || val === 25)) hit = true\r\n    if (target === 50 && (ring === 'INNER_BULL' || val === 50)) hit = true\r\n    if (!hit) {\r\n      // Fallback by value only\r\n      if (val === target || val === target * 2 || val === target * 3) hit = true\r\n    }\r\n    if (hit) {\r\n      const newHits = atcHits + 1\r\n      setAtcHits(newHits)\r\n      setAtcIndex(i => i + 1)\r\n    }\r\n  }\r\n  function addAtcNumeric() { addAtcValue(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n  function addAtcManual() {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like T20, D5, 25, 50'); return }\r\n    addAtcValue(v)\r\n    setManualBox('')\r\n  }\r\n\r\n  // --- Cricket helpers (solo practice) ---\r\n  function addCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setCricket(prev => {\r\n      const copy = { ...prev, marks: { ...prev.marks } }\r\n      applyCricketDart(copy as any, value, ring, sector, () => false)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1; if (nd >= 3) return 0; return nd\r\n    })\r\n  }\r\n  function addCricketNumeric() { addCricketAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- Shanghai helpers ---\r\n  function addShanghaiAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setShanghai(prev => {\r\n      const copy = { ...prev, turnHits: { ...prev.turnHits } }\r\n      applyShanghaiDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setShanghai(prev => { const cp = { ...prev, turnHits: { ...prev.turnHits } }; endShanghaiTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addShanghaiNumeric() { addShanghaiAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- Halve It helpers ---\r\n  function addHalveAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setHalve(prev => {\r\n      const copy = { ...prev, targets: [...prev.targets] }\r\n      applyHalveItDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setHalve(prev => { const cp = { ...prev, targets: [...prev.targets] }; endHalveItTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addHalveNumeric() { addHalveAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- High-Low helpers ---\r\n  function addHighLowAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setHighlow(prev => {\r\n      const copy = { ...prev }\r\n      applyHighLowDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setHighlow(prev => { const cp = { ...prev }; endHighLowTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addHighLowNumeric() { addHighLowAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  function parseManualBox(): number | null {\r\n    const t = manualBox.trim().toUpperCase()\r\n    if (!t) return null\r\n    if (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL') return 50\r\n    if (t === '25' || t === 'OBULL') return 25\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n    if (!m) return null\r\n    const mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n    const num = parseInt(m[2],10)\r\n    if (num < 1 || num > 20) return null\r\n    const multVal = mult==='S'?1:mult==='D'?2:3\r\n    return num * multVal\r\n  }\r\n\r\n  function addManual() {\r\n    const val = parseManualBox()\r\n    if (val == null) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    applyDartValue(val)\r\n    setManualBox('')\r\n  }\r\n\r\n  function addManualTextarea() {\r\n    const lines = manualTextarea.trim().split('\\n').map(l => l.trim()).filter(l => l)\r\n    if (lines.length === 0) return\r\n    for (const line of lines) {\r\n      const val = parseManualDart(line)\r\n      if (val == null) { alert(`Invalid score: ${line}`); return }\r\n      applyDartValue(val)\r\n    }\r\n    setManualTextarea('')\r\n  }\r\n\r\n  function replaceLast() {\r\n    if (playerVisitDarts === 0) return\r\n    // Rewind one dart: approximate by adding back last dart into score\r\n    setPlayerScore(s => s + playerLastDart)\r\n    setPlayerVisitDarts(d => Math.max(0, d - 1))\r\n  }\r\n\r\n  function replaceLastManual() {\r\n    const val = parseManualBox()\r\n    if (val == null) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    if (playerVisitDarts === 0) { addManual(); return }\r\n    // Rewind last then apply\r\n    const rewind = playerLastDart\r\n    setPlayerScore(s => s + rewind)\r\n    setPlayerVisitDarts(d => Math.max(0, d - 1))\r\n    // Apply new value in next microtask to ensure state has updated\r\n    setTimeout(() => applyDartValue(val), 0)\r\n    setManualBox('')\r\n  }\r\n\r\n  function playerThrow(points: number) {\r\n    let newScore = playerScore - points;\r\n    if (newScore < 0) {\r\n      setPlayerScore(playerScore); // bust\r\n      return;\r\n    }\r\n    setPlayerScore(newScore);\r\n    if (newScore === 0) {\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n    }\r\n    setOnDouble(newScore <= 40 && newScore % 2 === 0)\r\n  }\r\n\r\n  function aiTurn() {\r\n    // This is now automated inside the modal turn loop\r\n  }\r\n\r\n  function handleBust() {\r\n    setPlayerScore(playerScore); // bust, score unchanged\r\n    setOnDouble(false);\r\n  }\r\n\r\n  function handleWinPopupSubmit() {\r\n    const winner = pendingLegWinner ?? 'player'\r\n    // Approximate per-leg doubles attempts: if winner is player and they finished from <=50, attempts were counted in playerVisitDartsAtDouble; otherwise leave undefined\r\n    const legDoublesAtt = winner==='player' ? (playerVisitDartsAtDouble || undefined) : (aiVisitDartsAtDouble || undefined)\r\n    const legDoublesHit = 1\r\n    setLegStats([...legStats, { winner, doubleDarts, checkoutDarts, doublesAtt: legDoublesAtt, doublesHit: legDoublesHit }]);\r\n    setShowWinPopup(false);\r\n    // Increment legs for the winner\r\n    let p = playerLegs\r\n    let a = aiLegs\r\n    if (pendingLegWinner === 'player') p += 1\r\n    else if (pendingLegWinner === 'ai') a += 1\r\n    setPlayerLegs(p)\r\n    setAiLegs(a)\r\n    setPendingLegWinner(null)\r\n    // Check if match is over\r\n    if (p >= firstTo || a >= firstTo) {\r\n      // End of match: close modal back to menu state\r\n      // Record per-game-mode result (local-only demo)\r\n      try { bumpGameMode(selectedMode, winner === 'player') } catch {}\r\n      setShowMatchModal(false)\r\n      setInMatch(false)\r\n      // Reset leg-specific stats for next match but keep the summary list visible\r\n      setPlayerScore(x01Score)\r\n      setAiScore(x01Score)\r\n      setShowMatchSummary(true)\r\n      return\r\n    }\r\n    // Otherwise, start the next leg immediately\r\n    startNextLeg()\r\n  }\r\n\r\n  const isFreeSelected = freeGames.includes(selectedMode)\r\n  const lockedPremium = !isFreeSelected && !(user?.fullAccess || user?.admin)\r\n\r\n  // no external overlay: we render the match modal as absolute inset-0 inside this card\r\n\r\n  return (\r\n  <div className=\"card relative overflow-hidden\">\r\n  <h2 className=\"text-2xl font-bold text-brand-700 mb-4\">Offline Game Modes {offlineLayout==='classic' ? <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle\">Classic layout</span> : <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle\">Modern layout</span>}</h2>\r\n      <div className=\"mb-4 flex flex-col gap-3\">\r\n        <label className=\"font-semibold\">Select game mode:</label>\r\n        <select className=\"input w-full\" value={selectedMode} onChange={e => setSelectedMode(e.target.value)}>\r\n          {freeGames.map(mode => <option key={mode} value={mode}>{mode}</option>)}\r\n          {premiumGames.map(mode => (\r\n            <option key={mode} value={mode} disabled={!(user?.fullAccess || user?.admin)}>{mode} {(user?.fullAccess || user?.admin) ? '' : '(Premium)'}</option>\r\n          ))}\r\n        </select>\r\n        {!user?.fullAccess && (\r\n          <div className=\"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2\">\r\n            <span>🔒</span>\r\n            <span>Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM.</span>\r\n          </div>\r\n        )}\r\n        {selectedMode === 'X01' && (\r\n          <>\r\n            <label className=\"font-semibold mt-2\">Enter starting score (1-1001):</label>\r\n            <input\r\n              className=\"input w-full\"\r\n              type=\"number\"\r\n              min={1}\r\n              max={1001}\r\n              value={x01Score}\r\n              onChange={e => setX01Score(Number(e.target.value))}\r\n            />\r\n            <label className=\"font-semibold mt-2\">Play against AI bot?</label>\r\n            <select className=\"input w-full\" value={ai} onChange={e => setAI(e.target.value)}>\r\n              <option value=\"None\">None</option>\r\n              {aiLevels.map(level => <option key={level} value={level}>{level}</option>)}\r\n            </select>\r\n            {ai !== 'None' && (\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2\">\r\n                <div className=\"sm:col-span-2\">\r\n                  <label className=\"font-semibold\">AI throw delay (seconds)</label>\r\n                  <input\r\n                    className=\"input w-full\"\r\n                    type=\"number\"\r\n                    min={0.5}\r\n                    max={10}\r\n                    step={0.5}\r\n                    value={aiDelayMs / 1000}\r\n                    onChange={e => setAiDelayMs(Math.round(Number(e.target.value) * 1000))}\r\n                  />\r\n                </div>\r\n                <div className=\"text-sm text-slate-300\">Controls how long the AI waits before its visit.</div>\r\n              </div>\r\n            )}\r\n            <button className=\"btn mt-2\" onClick={() => setShowRules(true)}>X01 Rules & Regulations!</button>\r\n          </>\r\n        )}\r\n        {selectedMode === 'Double Practice' && (\r\n          <div className=\"mt-2 text-brand-600\">Hit doubles D1 → D20 → DBULL in as few darts as possible. AI and X01 settings don’t apply.</div>\r\n        )}\r\n      </div>\r\n  {!inMatch && <button className=\"btn\" disabled={lockedPremium} title={lockedPremium ? 'PREMIUM required for this mode' : ''} onClick={startMatch}>Start Match</button>}\r\n      {/* Match Modal with turn-by-turn flow */}\r\n      {showMatchModal && (\r\n  <div className={`absolute inset-0 z-[1000] ${maximized ? '' : 'flex items-center justify-center p-3 sm:p-4'}` }>\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:offline-match\"\r\n            className={`${maximized ? 'w-full h-full ndn-modal-tight' : ''} relative flex flex-col overflow-hidden`}\r\n            fullScreen={maximized}\r\n            defaultWidth={1100}\r\n            defaultHeight={720}\r\n            minWidth={720}\r\n            minHeight={480}\r\n            maxWidth={1600}\r\n            maxHeight={1200}\r\n            initialFitHeight\r\n          >\r\n            {/* Header bar with visible mode and actions; sheen is clipped to this area */}\r\n            <div\r\n              className=\"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2\"\r\n              style={{ overflowY: fitAll ? 'hidden' as any : 'auto' }}\r\n              ref={(el) => { (scrollerRef as any).current = el }}\r\n            >\r\n              <div ref={(el)=>{ (headerBarRef as any).current = el }} className=\"sticky top-0 relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm\">\r\n                <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent\" />\r\n                <div className=\"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap\">\r\n                  <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">Game Mode</span>\r\n                  <span className=\"font-medium whitespace-nowrap\">{selectedMode}{selectedMode==='X01' ? ` / ${x01Score}` : ''}</span>\r\n                  <span className=\"opacity-80 whitespace-nowrap\">First to {firstTo} · Legs {playerLegs}-{aiLegs}</span>\r\n                  <span className={`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${offlineLayout==='modern' ? 'bg-emerald-500/15 text-emerald-200 border-emerald-400/30' : 'bg-white/10 text-white/70 border-white/20'}`}>{offlineLayout==='modern' ? 'Modern layout' : 'Classic layout'}</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1 flex-wrap justify-end\">\r\n                  {/* Camera scale controls (match Online UI) */}\r\n                  <div className=\"hidden items-center gap-2 mr-2 text-xs\">\r\n                    <span className=\"opacity-80\">Cam</span>\r\n                    <button\r\n                      className=\"btn btn--ghost px-2 py-1\"\r\n                      onClick={() => setCameraScale(Math.max(0.5, Math.round((cameraScale - 0.05) * 100) / 100))}\r\n                      title=\"Decrease camera size\"\r\n                    >−</button>\r\n                    <span className=\"w-9 text-center\">{Math.round(cameraScale * 100)}%</span>\r\n                    <button\r\n                      className=\"btn btn--ghost px-2 py-1\"\r\n                      onClick={() => setCameraScale(Math.min(1.25, Math.round((cameraScale + 0.05) * 100) / 100))}\r\n                      title=\"Increase camera size\"\r\n                    >+</button>\r\n                  </div>\r\n                  <button\r\n                    className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                    title={fitAll ? 'Actual Size' : 'Fit All'}\r\n                    onClick={() => setFitAll(v => !v)}\r\n                  >{fitAll ? 'Actual Size' : 'Fit All'}</button>\r\n                  <button\r\n                    className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                    title={maximized ? 'Restore' : 'Maximize'}\r\n                    onClick={() => setMaximized(m => !m)}\r\n                  >{maximized ? 'Restore' : 'Maximize'}</button>\r\n                  <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={() => { startMatch() }}>Restart</button>\r\n                  <button className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\" onClick={() => { setShowMatchModal(false); setInMatch(false); }}>Quit</button>\r\n                </div>\r\n              </div>\r\n              <div\r\n                ref={(el) => { (contentRef as any).current = el }}\r\n                className=\"will-change-transform\"\r\n                style={fitAll ? { transform: `scale(${fitScale})`, transformOrigin: 'top left', width: '100%', fontSize: `${Math.max(0.8, Math.min(1, fitScale))}em` } : undefined}\r\n              >\r\n            <h3 className=\"text-xl font-bold mb-2 mt-1 leading-tight\">{selectedMode === 'X01' ? 'X01 Match' : selectedMode}</h3>\r\n            <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Mode: {selectedMode}</span>\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Start: {x01Score}</span>\r\n              <div ref={formatRef} className=\"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                <span>Format:</span>\r\n                {(() => {\r\n                  const disabled = (playerScore !== x01Score || aiScore !== x01Score || playerVisitDarts > 0)\r\n                  const pillCls = `px-2 py-0.5 rounded border text-xs ${disabled? 'opacity-50 cursor-not-allowed': 'cursor-pointer'} `\r\n                  return (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <button\r\n                          type=\"button\"\r\n                          className={`${pillCls} ${formatType==='first' ? 'bg-indigo-500/20 text-indigo-100 border-indigo-400/30' : 'bg-white/10 text-white/80 border-white/20'}`}\r\n                          onClick={() => { if (!disabled) setFormatType('first') }}\r\n                          title=\"First to N\"\r\n                        >First to</button>\r\n                        <button\r\n                          type=\"button\"\r\n                          className={`${pillCls} ${formatType==='best' ? 'bg-indigo-500/20 text-indigo-100 border-indigo-400/30' : 'bg-white/10 text-white/80 border-white/20'}`}\r\n                          onClick={() => { if (!disabled) setFormatType('best') }}\r\n                          title=\"Best of N (wins = ceil(N/2)\"\r\n                        >Best of</button>\r\n                      </div>\r\n                      <input\r\n                        className={`input w-16 text-center ${disabled ? 'opacity-50' : ''}`}\r\n                        type=\"number\"\r\n                        min={1}\r\n                        step={1}\r\n                        value={formatCount}\r\n                        onChange={e => setFormatCount(Math.max(1, Math.floor(Number(e.target.value)||1)))}\r\n                        disabled={disabled}\r\n                        title={formatType==='first' ? 'First to N' : 'Best of N (wins = ceil(N/2))'}\r\n                      />\r\n                    </div>\r\n                  )\r\n                })()}\r\n              </div>\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Legs: {playerLegs}–{aiLegs}</span>\r\n            </div>\r\n            {selectedMode !== 'X01' ? (\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2\">\r\n                {selectedMode === 'Double Practice' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">Current Target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || '—'}</span>\r\n                    </div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{dpHits} / 21</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Around the Clock' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">Current Target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || '—')}</span>\r\n                    </div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{atcHits} / {ATC_ORDER.length}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Cricket' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 mb-1\">Cricket — Close 20–15 and Bull; overflow scores points</div>\r\n                    <div className=\"grid grid-cols-7 gap-1 text-center text-[11px] mb-2\">\r\n                      {CRICKET_NUMBERS.map(n => (\r\n                        <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                          <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                          <div className=\"font-semibold\">{Math.min(3, cricket.marks?.[n]||0)} / 3</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm\">Points: <span className=\"font-semibold\">{cricket.points}</span></div>\r\n                    {cricketClosedAll(cricket) && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setCricket(createCricketState()); setPracticeTurnDarts(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Shanghai' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{shanghai.round}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {shanghai.score}</div>\r\n                    {shanghai.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setShanghai(createShanghaiState()); setPracticeTurnDarts(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Halve It' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Stage</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{halve.stage+1}/{halve.targets.length}</span></div>\r\n                    <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const t = getCurrentHalveTarget(halve); if (!t) return '—'; if (t.kind==='ANY_NUMBER') return 'Any'; if (t.kind==='BULL') return 'Bull'; if (t.kind==='DOUBLE' || t.kind==='TRIPLE' || t.kind==='NUMBER') return `${t.kind} ${(t as any).num}`; return '—' })()}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {halve.score}</div>\r\n                    {halve.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setHalve(createDefaultHalveIt()); setPracticeTurnDarts(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High-Low' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {highlow.round} · Target {highlow.target}</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {highlow.score}</div>\r\n                    {highlow.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setHighlow(createHighLow()); setPracticeTurnDarts(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === \"Bob's 27\" && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Target</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold\">D{b27Stage}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {b27Score}</div>\r\n                    {b27Finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetB27}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Count-Up' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {cuRound}/8</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {cuScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High Score' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {hsRound}/10</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {hsScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Low Score' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {lsRound}/10</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {lsScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 170' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Remaining</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{co170Rem}</div>\r\n                    <div className=\"text-xs text-slate-400 mt-1\">Attempts: {co170Attempts} · Successes: {co170Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 121' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Remaining</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{co121Rem}</div>\r\n                    <div className=\"text-xs text-slate-400 mt-1\">Attempts: {co121Attempts} · Successes: {co121Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Treble Practice' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Treble Target: T{trebleTarget}</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Hits: {trebleHits}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Baseball' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Inning</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{baseball.inning}</div>\r\n                    <div className=\"text-sm\">Score: <span className=\"font-semibold\">{baseball.score}</span></div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Golf' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Hole</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{golf.hole}</div>\r\n                    <div className=\"text-sm\">Strokes: <span className=\"font-semibold\">{golf.strokes}</span></div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Tic Tac Toe' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Turn</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{ttt.turn}</div>\r\n                    {ttt.finished && <div className=\"mt-1 text-xs\">Winner: {ttt.winner || '—'}</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'American Cricket' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 mb-1\">Close 20–12 and Bull; overflow scores points</div>\r\n                    <div className=\"grid grid-cols-10 gap-1 text-center text-[11px] mb-2\">\r\n                      {AM_CRICKET_NUMBERS.map(n => (\r\n                        <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                          <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                          <div className=\"font-semibold\">{Math.min(3, amCricket.marks?.[n]||0)} / 3</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm\">Points: <span className=\"font-semibold\">{amCricket.points}</span></div>\r\n                    {hasClosedAllAm(amCricket) && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetAmCricket}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Killer' && (\r\n                  <>\r\n                    {!killerSetupDone ? (\r\n                      <div className=\"text-xs text-slate-600\">Setup players and assign numbers</div>\r\n                    ) : (\r\n                      <>\r\n                        <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                          <span>Turn</span>\r\n                          <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{killerPlayers[killerTurnIdx]?.name || '—'}</span>\r\n                        </div>\r\n                        <div className=\"text-3xl font-extrabold tracking-tight\">{killerWinnerId ? `${killerPlayers.find(p=>p.id===killerWinnerId)?.name || 'Winner'} Wins` : (killerLastEvent || 'Ready')}</div>\r\n                      </>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            ) : offlineLayout === 'modern' ? (\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-2 items-stretch\">\r\n                {/* Left column: Player panel, Match Summary, Opponent panel stacked */}\r\n                <div className=\"flex flex-col gap-2 min-w-0\">\r\n                  <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col\">\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">You Remain</span>\r\n                      {isPlayerTurn ? (\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                      ) : (\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{playerScore}</div>\r\n                    <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                      <div className=\"h-full bg-emerald-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (playerScore / x01Score)) * 100))}%` }} />\r\n                    </div>\r\n                    <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{playerLastDart}</span></div>\r\n                    <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{playerDartsThrown>0 ? (((x01Score - playerScore)/playerDartsThrown)*3).toFixed(1) : '0.0'}</span></div>\r\n                    <div className=\"text-xs opacity-70 flex items-center gap-2\">\r\n                      <span>Darts thrown: {playerDartsThrown}</span>\r\n                      <span className=\"inline-flex items-center gap-1\" aria-label=\"Visit darts\">\r\n                        {[0,1,2].map(i => (\r\n                          <span key={i} className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? 'bg-emerald-400' : 'bg-white/20'}`}></span>\r\n                        ))}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {playerDoublesAtt} · Hit {playerDoublesHit}</span></div>\r\n                    {playerScore <= 170 && playerScore > 0 && (\r\n                      (() => {\r\n                        const sugs = suggestCheckouts(playerScore, favoriteDouble)\r\n                        const first = sugs[0] || '—'\r\n                        return (\r\n                          <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\r\n                            <span className=\"opacity-70\">Checkout</span>\r\n                            <span className=\"font-semibold\">{first}</span>\r\n                          </div>\r\n                        )\r\n                      })()\r\n                    )}\r\n                  </div>\r\n                  {/* Match Summary */}\r\n                  <div className={`${boxSize === 'small' ? 'p-2' : boxSize === 'large' ? 'p-4' : 'p-3'} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === 'small' ? 'text-xs' : textSize === 'large' ? 'text-base' : 'text-sm'}`}>\r\n                    <div className=\"font-semibold mb-2\">Match Summary</div>\r\n                    {(() => {\r\n                      const currentThrower = isPlayerTurn ? (user?.username || 'You') : (ai === 'None' ? '—' : `${ai} AI`)\r\n                      const currentRemaining = isPlayerTurn ? playerScore : (ai === 'None' ? 0 : aiScore)\r\n                      const last = isPlayerTurn ? playerLastDart : aiLastDart\r\n                      const lastScoreVisit = isPlayerTurn ? playerVisitSum : aiVisitSum\r\n                      const dartsThrown = isPlayerTurn ? playerDartsThrown : aiDartsThrown\r\n                      const scored = (x01Score - (isPlayerTurn ? playerScore : (ai === 'None' ? x01Score : aiScore)))\r\n                      const avg3 = dartsThrown > 0 ? ((scored / dartsThrown) * 3) : 0\r\n                      const matchScore = `${playerLegs}-${aiLegs}`\r\n                      const bestLegText = legStats.length > 0 ? `${Math.min(...legStats.map(l=>l.doubleDarts + (l.checkoutDarts||0))) || 0} darts` : '—'\r\n                      return (\r\n                        <div className=\"grid grid-cols-2 gap-y-1\">\r\n                          <div className=\"opacity-80\">Current score</div>\r\n                          <div className=\"font-mono text-right\">{matchScore}</div>\r\n                          <div className=\"opacity-80\">Current thrower</div>\r\n                          <div className=\"text-right font-semibold text-lg\">{currentThrower}</div>\r\n                          <div className=\"opacity-80\">Score remaining</div>\r\n                          <div className=\"text-right font-mono font-bold text-xl\">{currentRemaining}</div>\r\n                          <div className=\"opacity-80\">3-dart avg</div>\r\n                          <div className=\"text-right font-mono\">{avg3.toFixed(1)}</div>\r\n                          <div className=\"opacity-80\">Last score</div>\r\n                          <div className=\"text-right font-mono\">{lastScoreVisit || last}</div>\r\n                          <div className=\"opacity-80\">Best leg</div>\r\n                          <div className=\"text-right\">{bestLegText}</div>\r\n                        </div>\r\n                      )\r\n                    })()}\r\n                  </div>\r\n                  {/* Opponent panel */}\r\n                  <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col\">\r\n                    <div className=\"text-xs flex items-center justify-between opacity-80\">\r\n                      <span>{ai === 'None' ? 'Opponent' : `${ai} AI`} Remain</span>\r\n                      {!isPlayerTurn ? (\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                      ) : (\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{ai !== 'None' ? aiScore : 'N/A'}</div>\r\n                    {ai !== 'None' && (\r\n                      <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                        <div className=\"h-full bg-fuchsia-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (aiScore / x01Score)) * 100))}%` }} />\r\n                      </div>\r\n                    )}\r\n                    <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{ai === 'None' ? 0 : aiLastDart}</span></div>\r\n                    <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{ai !== 'None' ? (aiDartsThrown>0 ? (((x01Score - aiScore)/aiDartsThrown)*3).toFixed(1) : '0.0') : '—'}</span></div>\r\n                    {ai !== 'None' && (\r\n                      <div className=\"text-xs opacity-70\">Darts thrown: {aiDartsThrown}</div>\r\n                    )}\r\n                    {ai !== 'None' && (\r\n                      <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {aiDoublesAtt} · Hit {aiDoublesHit}</span></div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {/* Right area: toolbar + camera (span 2) */}\r\n                <div className=\"md:col-span-2 min-w-0 space-y-2\">\r\n                  {!manualScoring ? (\r\n                    <>\r\n                      <div className=\"flex items-center gap-1.5 mt-1\">\r\n                        <div className=\"ml-auto flex items-center gap-1 text-[10px]\">\r\n                          <span className=\"opacity-70\">Cam</span>\r\n                          <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.max(0.5, Math.round((cameraScale-0.05)*100)/100))}>−</button>\r\n                          <span className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}>{Math.round(cameraScale*100)}%</span>\r\n                          <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.min(1.25, Math.round((cameraScale+0.05)*100)/100))}>+</button>\r\n                          <span className=\"opacity-50\">|</span>\r\n                          <button className={`btn ${buttonSizeClass}`} title=\"Toggle camera aspect\" onClick={()=>setCameraAspect(cameraAspect==='square'?'wide':'square')}>{cameraAspect==='square'?'Square':'Wide'}</button>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-stretch justify-end min-w-0 md:min-h-[45vh]\">\r\n                        <CameraTile\r\n                          label=\"Your Board\"\r\n                          autoStart={true}\r\n                          className=\"min-w-0 h-full\"\r\n                          style={{ minHeight: '45vh' }}\r\n                          fill\r\n                        />\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <div className=\"card\">\r\n                      <div className=\"text-sm font-semibold mb-1\">Manual scoring active</div>\r\n                      <div className=\"text-xs opacity-70\">Camera previews are disabled. Use the manual entry controls below to record your turn.</div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:[grid-template-columns:1fr_1.2fr_1fr] gap-2 mb-2 items-stretch min-w-0\">\r\n                <div className=\"flex items-stretch justify-center md:px-3 min-w-0\">\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                  <span className=\"opacity-80\">You Remain</span>\r\n                  {isPlayerTurn ? (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl font-extrabold tracking-tight\">{playerScore}</div>\r\n                <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                  <div className=\"h-full bg-emerald-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (playerScore / x01Score)) * 100))}%` }} />\r\n                </div>\r\n                <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{playerLastDart}</span></div>\r\n                <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{playerDartsThrown>0 ? (((x01Score - playerScore)/playerDartsThrown)*3).toFixed(1) : '0.0'}</span></div>\r\n                <div className=\"text-xs opacity-70 flex items-center gap-2\">\r\n                  <span>Darts thrown: {playerDartsThrown}</span>\r\n                  <span className=\"inline-flex items-center gap-1\" aria-label=\"Visit darts\">\r\n                    {[0,1,2].map(i => (\r\n                      <span key={i} className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? 'bg-emerald-400' : 'bg-white/20'}`}></span>\r\n                    ))}\r\n                  </span>\r\n                </div>\r\n                <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {playerDoublesAtt} · Hit {playerDoublesHit}</span></div>\r\n                {playerScore <= 170 && playerScore > 0 && (\r\n                  (() => {\r\n                    const sugs = suggestCheckouts(playerScore, favoriteDouble)\r\n                    const first = sugs[0] || '—'\r\n                    return (\r\n                      <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\r\n                        <span className=\"opacity-70\">Checkout</span>\r\n                        <span className=\"font-semibold\">{first}</span>\r\n                      </div>\r\n                    )\r\n                  })()\r\n                )}\r\n              </div>\r\n              {/* Center camera preview: right-aligned and square when selected */}\r\n              <div className=\"flex items-stretch justify-end md:px-3 min-w-0 md:min-h-[45vh]\">\r\n                <CameraTile\r\n                  label=\"Your Board\"\r\n                  autoStart={true}\r\n                  className=\"min-w-0 h-full\"\r\n                  style={{ minHeight: '45vh' }}\r\n                  fill\r\n                />\r\n              </div>\r\n              {/* Match summary (offline) */}\r\n              <div className={`mt-2 ${boxSize === 'small' ? 'p-2' : boxSize === 'large' ? 'p-4' : 'p-3'} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === 'small' ? 'text-xs' : textSize === 'large' ? 'text-base' : 'text-sm'}`}>\r\n                <div className=\"font-semibold mb-2\">Match Summary</div>\r\n                {(() => {\r\n                  // In offline X01, player is vs AI or practice\r\n                  const currentThrower = isPlayerTurn ? (user?.username || 'You') : (ai === 'None' ? '—' : `${ai} AI`)\r\n                  const currentRemaining = isPlayerTurn ? playerScore : (ai === 'None' ? 0 : aiScore)\r\n                  const last = isPlayerTurn ? playerLastDart : aiLastDart\r\n                  const lastScoreVisit = isPlayerTurn ? playerVisitSum : aiVisitSum\r\n                  const dartsThrown = isPlayerTurn ? playerDartsThrown : aiDartsThrown\r\n                  const scored = (x01Score - (isPlayerTurn ? playerScore : (ai === 'None' ? x01Score : aiScore)))\r\n                  const avg3 = dartsThrown > 0 ? ((scored / dartsThrown) * 3) : 0\r\n                  const matchScore = `${playerLegs}-${aiLegs}`\r\n                  const bestLegText = legStats.length > 0 ? `${Math.min(...legStats.map(l=>l.doubleDarts + (l.checkoutDarts||0))) || 0} darts` : '—'\r\n                  return (\r\n                    <div className=\"grid grid-cols-2 gap-y-1\">\r\n                      <div className=\"opacity-80\">Current score</div>\r\n                      <div className=\"font-mono text-right\">{matchScore}</div>\r\n                      <div className=\"opacity-80\">Current thrower</div>\r\n                      <div className=\"text-right font-semibold text-lg\">{currentThrower}</div>\r\n                      <div className=\"opacity-80\">Score remaining</div>\r\n                      <div className=\"text-right font-mono font-bold text-xl\">{currentRemaining}</div>\r\n                      <div className=\"opacity-80\">3-dart avg</div>\r\n                      <div className=\"text-right font-mono\">{avg3.toFixed(1)}</div>\r\n                      <div className=\"opacity-80\">Last score</div>\r\n                      <div className=\"text-right font-mono\">{lastScoreVisit || last}</div>\r\n                      <div className=\"opacity-80\">Best leg</div>\r\n                      <div className=\"text-right\">{bestLegText}</div>\r\n                    </div>\r\n                  )\r\n                })()}\r\n              </div>\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                <div className=\"text-xs flex items-center justify-between opacity-80\">\r\n                  <span>{ai === 'None' ? 'Opponent' : `${ai} AI`} Remain</span>\r\n                  {!isPlayerTurn ? (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl font-extrabold tracking-tight\">{ai !== 'None' ? aiScore : 'N/A'}</div>\r\n                {ai !== 'None' && (\r\n                  <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                    <div className=\"h-full bg-fuchsia-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (aiScore / x01Score)) * 100))}%` }} />\r\n                  </div>\r\n                )}\r\n                <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{ai === 'None' ? 0 : aiLastDart}</span></div>\r\n                <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{ai !== 'None' ? (aiDartsThrown>0 ? (((x01Score - aiScore)/aiDartsThrown)*3).toFixed(1) : '0.0') : '—'}</span></div>\r\n                {ai !== 'None' && (\r\n                  <div className=\"text-xs opacity-70\">Darts thrown: {aiDartsThrown}</div>\r\n                )}\r\n                {ai !== 'None' && (\r\n                  <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {aiDoublesAtt} · Hit {aiDoublesHit}</span></div>\r\n                )}\r\n              </div>\r\n                </div>\r\n            </div>\r\n            )}\r\n            {/* Turn area */}\r\n            {selectedMode !== 'X01' ? (\r\n              <div className=\"space-y-2\">\r\n                {selectedMode === 'Double Practice' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || '—'}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} onAutoDart={(value, ring) => {\r\n                        if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                          const hit = isDoubleHit(value, dpIndex)\r\n                          if (hit) { const nh = dpHits + 1; const ni = dpIndex + 1; setDpHits(nh); setDpIndex(ni); if (nh >= DOUBLE_PRACTICE_ORDER.length) setTimeout(()=>{ setDpHits(0); setDpIndex(0) }, 250) }\r\n                        }\r\n                      }} immediateAutoCommit />\r\n                    </div>}\r\n                    <div className=\"flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-24\" type=\"number\" min={0} max={60} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e => { if (e.key==='Enter') addDpNumeric() }} />\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={addDpNumeric}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-44\" placeholder=\"Manual (D16, 50, 25, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e => { if (e.key==='Enter') addDpManual() }} />\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={addDpManual}>Add</button>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-300\">Progress: {dpHits} of 21</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Around the Clock' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || '—')}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addAtcValue(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addAtcNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addAtcNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-44\" placeholder=\"Manual (T20, D5, 25, 50)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addAtcManual() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addAtcManual}>Add</button>\r\n                    </div>\r\n                    {atcHits >= ATC_ORDER.length && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setAtcHits(0); setAtcIndex(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Cricket' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addCricketAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addCricketNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addCricketNumeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setCricket(createCricketState()); setPracticeTurnDarts(0) }}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Shanghai' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addShanghaiAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addShanghaiNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addShanghaiNumeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setShanghai(createShanghaiState()); setPracticeTurnDarts(0) }}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Halve It' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addHalveAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addHalveNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addHalveNumeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setHalve(createDefaultHalveIt()); setPracticeTurnDarts(0) }}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High-Low' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addHighLowAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addHighLowNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addHighLowNumeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setHighlow(createHighLow()); setPracticeTurnDarts(0) }}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === \"Bob's 27\" && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addB27Auto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addB27Numeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addB27Numeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetB27}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Count-Up' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value) => addCountUpAuto(value)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addCountUpAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addCountUpAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setCuRound(1); setCuScore(0); setCuDarts(0) }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {cuRound}/{cuMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High Score' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value) => addHighScoreAuto(value)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addHighScoreAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addHighScoreAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setHsRound(1); setHsScore(0); setHsDarts(0) }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {hsRound}/{hsMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Low Score' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value) => addLowScoreAuto(value)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addLowScoreAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addLowScoreAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setLsRound(1); setLsScore(0); setLsDarts(0) }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {lsRound}/{lsMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 170' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring) => addCo170Auto(value, ring === 'MISS' ? undefined : ring)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (D16, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addCoManual(true) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>addCoManual(true)}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetCo170}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Remaining: {co170Rem} · Attempts: {co170Attempts} · Successes: {co170Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 121' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring) => addCo121Auto(value, ring === 'MISS' ? undefined : ring)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (D16, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addCoManual(false) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>addCoManual(false)}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetCo121}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Remaining: {co121Rem} · Attempts: {co121Attempts} · Successes: {co121Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Treble Practice' && (\r\n                  <>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <label className=\"text-sm\">Target</label>\r\n                      <select className=\"input w-24\" value={trebleTarget} onChange={e=> setTrebleTarget(parseInt(e.target.value,10))}>\r\n                        {Array.from({length:20},(_,i)=>i+1).map(n=> <option key={n} value={n}>{n}</option>)}\r\n                      </select>\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={resetTreble}>Reset</button>\r\n                    </div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addTrebleAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') { const v = parseManualDart(manualBox); if (v!=null) addTrebleAuto(v, undefined, undefined); setManualBox('') } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ const v = parseManualDart(manualBox); if (v!=null) addTrebleAuto(v, undefined, undefined); setManualBox('') }}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Hits: {trebleHits} · Darts: {trebleDarts}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Baseball' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addBaseballAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetBaseball}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Golf' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addGolfAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetGolf}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Tic Tac Toe' && (\r\n                  <>\r\n                    <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                      {Array.from({length:9},(_,i)=>i).map(cell => (\r\n                        <button key={cell} className={`h-16 rounded-xl border ${ttt.board[cell]?'bg-emerald-500/20 border-emerald-400/30':'bg-slate-800/50 border-slate-700/50'}`} onClick={()=>{\r\n                          if (ttt.finished || ttt.board[cell]) return\r\n                          // One-tap claim attempt using autoscore last dart; fallback: prompt numeric\r\n                          // For simplicity here, we use a no-op value and rely on next autoscore dart; as a usable fallback, open a numeric prompt\r\n                          const promptVal = Number(prompt('Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)')||0)\r\n                          const ring = promptVal%3===0?'TRIPLE': promptVal%2===0?'DOUBLE':'SINGLE'\r\n                          const tcell = cell as unknown as 0|1|2|3|4|5|6|7|8\r\n                          const tgt = TTT_TARGETS[tcell]\r\n                          const num = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          addTttAuto(tcell, promptVal, ring as any, num as any)\r\n                        }}>{ttt.board[cell] || ''}</button>\r\n                      ))}\r\n                    </div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        // Attempt to claim the currently tapped-looking cell not tracked; as a simple flow, map by round-robin preference or let user click a cell button above.\r\n                        // No-op here; primary interaction is via buttons with prompt for now.\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetTtt}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'American Cricket' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addAmCricketAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetAmCricket}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Killer' && (\r\n                  <>\r\n                    {!killerSetupDone ? (\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"font-semibold\">Players</div>\r\n                        <div className=\"space-y-1\">\r\n                          {killerPlayers.map((p, idx) => (\r\n                            <div key={p.id} className=\"flex items-center gap-2\">\r\n                              <input className=\"input\" value={p.name} onChange={e=>{\r\n                                const name = e.target.value\r\n                                setKillerPlayers(list => list.map((it,i)=> i===idx?{...it,name}:it))\r\n                              }} />\r\n                              <button className=\"btn px-2 py-1\" onClick={()=> setKillerPlayers(list => list.filter((_,i)=>i!==idx))} disabled={killerPlayers.length<=2}>Remove</button>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <button className=\"btn px-2 py-1\" onClick={()=> setKillerPlayers(list => {\r\n                            const id = `p${list.length+1}`; return [...list, { id, name: `Player ${list.length+1}` }]\r\n                          })}>Add Player</button>\r\n                          <button className=\"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1\" onClick={()=>{\r\n                            if (killerPlayers.length < 2) { alert('Need at least 2 players'); return }\r\n                            const ids = killerPlayers.map(p=>p.id)\r\n                            const assigned = assignKillerNumbers(ids)\r\n                            const initStates: Record<string,KillerState> = {}\r\n                            ids.forEach(id => { initStates[id] = createKillerState(assigned[id]) })\r\n                            setKillerAssigned(assigned)\r\n                            setKillerStates(initStates)\r\n                            setKillerTurnIdx(0)\r\n                            setKillerDarts(0)\r\n                            setKillerWinnerId(null)\r\n                            setKillerLastEvent('Assigned numbers')\r\n                            setKillerSetupDone(true)\r\n                          }}>Assign Numbers & Start</button>\r\n                        </div>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"space-y-3\">\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                          {killerPlayers.map(p => {\r\n                            const st = killerStates[p.id]\r\n                            const num = killerAssigned[p.id]\r\n                            return (\r\n                              <div key={p.id} className={`p-2 rounded-xl border ${st?.eliminated? 'opacity-50 border-red-500/40 bg-red-500/10' : 'border-slate-700/50 bg-slate-800/50'}`}>\r\n                                <div className=\"flex items-center justify-between text-xs\">\r\n                                  <div className=\"font-semibold\">{p.name}</div>\r\n                                  <div className={`text-[10px] px-1.5 py-0.5 rounded ${st?.isKiller?'bg-purple-500/20 text-purple-200 border border-purple-400/30':'bg-slate-600/30 text-slate-300'}`}>{st?.isKiller? 'Killer' : 'Not Killer'}</div>\r\n                                </div>\r\n                                <div className=\"mt-1 text-sm\">Number: <span className=\"font-semibold\">{num}</span></div>\r\n                                <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{st?.lives ?? 0}</span></div>\r\n                              </div>\r\n                            )\r\n                          })}\r\n                        </div>\r\n                        {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                            if (killerWinnerId) return\r\n                            const r = ring === 'MISS' ? undefined : ring\r\n                            const sector = info?.sector ?? null\r\n                            const cur = killerPlayers[killerTurnIdx]\r\n                            if (!cur) return\r\n                            setKillerStates(prev => {\r\n                              const copy: Record<string,KillerState> = {}\r\n                              Object.keys(prev).forEach(k => copy[k] = { ...prev[k] })\r\n                              const res = applyKillerDart(cur.id, copy, r as any, sector)\r\n                              if (res.becameKiller) setKillerLastEvent(`${cur.name} became a Killer`)\r\n                              else if (res.victimId) {\r\n                                const v = killerPlayers.find(p=>p.id===res.victimId)\r\n                                setKillerLastEvent(`${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved||0)>1?'s':''})`)\r\n                              } else setKillerLastEvent('No effect')\r\n                              // Check winner\r\n                              const win = killerWinner(copy)\r\n                              if (win) setKillerWinnerId(win)\r\n                              return copy\r\n                            })\r\n                            setKillerDarts(d => {\r\n                              const nd = d + 1\r\n                              if (nd >= 3) {\r\n                                // advance to next alive\r\n                                let next = killerTurnIdx\r\n                                for (let i=1;i<=killerPlayers.length;i++) {\r\n                                  const idx = (killerTurnIdx + i) % killerPlayers.length\r\n                                  const pid = killerPlayers[idx].id\r\n                                  const st = killerStates[pid]\r\n                                  if (st && !st.eliminated && st.lives > 0) { next = idx; break }\r\n                                }\r\n                                setKillerTurnIdx(next)\r\n                                return 0\r\n                              }\r\n                              return nd\r\n                            })\r\n                          }} />\r\n                        </div>}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input className=\"input w-40\" placeholder=\"Manual (D16, T5)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') {\r\n                            if (killerWinnerId) return\r\n                            const t = manualBox.trim().toUpperCase()\r\n                            const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n                            if (!m) { setManualBox(''); return }\r\n                            const mult = (m[1]||'S') as 'S'|'D'|'T'\r\n                            const num = parseInt(m[2],10)\r\n                            const ring = mult==='D'?'DOUBLE': mult==='T'?'TRIPLE':'SINGLE'\r\n                            const cur = killerPlayers[killerTurnIdx]\r\n                            setKillerStates(prev => {\r\n                              const copy: Record<string,KillerState> = {}\r\n                              Object.keys(prev).forEach(k => copy[k] = { ...prev[k] })\r\n                              const res = applyKillerDart(cur.id, copy, ring as any, num)\r\n                              if (res.becameKiller) setKillerLastEvent(`${cur.name} became a Killer`)\r\n                              else if (res.victimId) {\r\n                                const v = killerPlayers.find(p=>p.id===res.victimId)\r\n                                setKillerLastEvent(`${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved||0)>1?'s':''})`)\r\n                              } else setKillerLastEvent('No effect')\r\n                              const win = killerWinner(copy); if (win) setKillerWinnerId(win)\r\n                              return copy\r\n                            })\r\n                            setManualBox('')\r\n                            setKillerDarts(d => {\r\n                              const nd = d + 1\r\n                              if (nd >= 3) { let next = killerTurnIdx; for (let i=1;i<=killerPlayers.length;i++){ const idx=(killerTurnIdx+i)%killerPlayers.length; const pid=killerPlayers[idx].id; const st=killerStates[pid]; if (st && !st.eliminated && st.lives>0) { next=idx; break } } setKillerTurnIdx(next); return 0 } return nd\r\n                            })\r\n                          } }} />\r\n                          <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                            // Skip to next alive player\r\n                            let next = killerTurnIdx\r\n                            for (let i=1;i<=killerPlayers.length;i++) {\r\n                              const idx = (killerTurnIdx + i) % killerPlayers.length\r\n                              const pid = killerPlayers[idx].id\r\n                              const st = killerStates[pid]\r\n                              if (st && !st.eliminated && st.lives > 0) { next = idx; break }\r\n                            }\r\n                            setKillerTurnIdx(next); setKillerDarts(0)\r\n                          }}>Next Player</button>\r\n                          <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                            // Reset Killer\r\n                            setKillerStates({}); setKillerAssigned({}); setKillerSetupDone(false); setKillerTurnIdx(0); setKillerDarts(0); setKillerWinnerId(null); setKillerLastEvent('')\r\n                          }}>Reset</button>\r\n                        </div>\r\n                        {killerWinnerId && (\r\n                          <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Winner: {killerPlayers.find(p=>p.id===killerWinnerId)?.name} <button className=\"ml-2 underline\" onClick={()=>{\r\n                            setKillerStates({}); setKillerAssigned({}); setKillerSetupDone(false); setKillerTurnIdx(0); setKillerDarts(0); setKillerWinnerId(null); setKillerLastEvent('')\r\n                          }}>Play Again</button></div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            ) : isPlayerTurn ? (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"font-semibold\">Your Turn</div>\r\n                <div className=\"flex flex-col gap-2\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-24\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      max={60}\r\n                      value={playerDartPoints}\r\n                      onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                      onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLast() : addDartNumeric()) }}\r\n                    />\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addDartNumeric}>Add Dart</button>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-44\"\r\n                      placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                      value={manualBox}\r\n                      onChange={e=>setManualBox(e.target.value)}\r\n                      onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLastManual() : addManual()) }}\r\n                    />\r\n                    <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={replaceLastManual} disabled={playerVisitDarts===0}>Replace Last</button>\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addManual}>Add</button>\r\n                  </div>\r\n                  <div>\r\n                    <textarea\r\n                      className=\"input w-full h-24 resize-none\"\r\n                      placeholder=\"Type scores manually (one per line, e.g. T20&#10;D16&#10;5&#10;25&#10;50) - No camera needed!\"\r\n                      value={manualTextarea}\r\n                      onChange={e=>setManualTextarea(e.target.value)}\r\n                    />\r\n                    <div className=\"flex gap-2 mt-1\">\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addManualTextarea}>Add All Scores</button>\r\n                      <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={() => setManualTextarea('')}>Clear</button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-xs text-slate-300\">Tip: Enter to Add · Shift+Enter to Replace Last</div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"font-semibold\">{ai === 'None' ? 'Opponent' : `${ai} AI`} Turn</div>\r\n                {ai !== 'None' ? (\r\n                  <div className=\"text-sm text-slate-300\">Throwing in {Math.ceil(aiCountdownMs/1000)}s...</div>\r\n                ) : (\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <button className=\"btn\" onClick={() => setIsPlayerTurn(true)}>Switch Back to You</button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n            <div className=\"h-1\" />\r\n              </div>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {showRules && <X01RulesPopup onClose={() => setShowRules(false)} />}\r\n      {/* Frosted overlay when selecting premium mode without access */}\r\n      {lockedPremium && (\r\n        <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n          <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n            <div className=\"text-3xl mb-2\">🔒</div>\r\n            <div className=\"font-semibold\">Premium mode locked</div>\r\n            <div className=\"text-sm text-slate-200/80\">Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more.</div>\r\n            <button\r\n              onClick={async () => {\r\n                try {\r\n                  const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ email: user?.email })\r\n                  });\r\n                  const data = await res.json();\r\n                  if (data.ok && data.url) {\r\n                    window.location.href = data.url;\r\n                    if (data.development) {\r\n                      toast(\"Opened Stripe test checkout (development mode)\", { type: 'info', timeout: 3000 });\r\n                    }\r\n                  } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                    toast(\"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\", { type: 'error', timeout: 4000 });\r\n                  } else {\r\n                    toast(\"Failed to create checkout session. Please try again.\", { type: 'error', timeout: 4000 });\r\n                  }\r\n                } catch (err) {\r\n                  toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n                }\r\n              }}\r\n              className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n            >\r\n              Upgrade to PREMIUM · {formatPriceInCurrency(getUserCurrency(), 5)}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showWinPopup && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <ResizableModal storageKey=\"ndn:modal:offline-win\" className=\"w-full relative\" defaultWidth={420} defaultHeight={360} minWidth={360} minHeight={300} maxWidth={800} maxHeight={700}>\r\n            <h3 className=\"text-lg font-bold mb-2\">Leg Won!</h3>\r\n            <label className=\"block mb-1\">Darts to hit double:</label>\r\n            <div className=\"flex gap-2 mb-2\">\r\n              {[1,2,3].map(n => (\r\n                <button key={n} className={`btn ${doubleDarts===n?'bg-brand-600':''}`} onClick={()=>setDoubleDarts(n)}>{n}</button>\r\n              ))}\r\n            </div>\r\n            <label className=\"block mb-1\">Darts for checkout:</label>\r\n            <div className=\"flex gap-2 mb-2\">\r\n              {[1,2,3].map(n => (\r\n                <button key={n} className={`btn ${checkoutDarts===n?'bg-brand-600':''}`} onClick={()=>setCheckoutDarts(n)}>{n}</button>\r\n              ))}\r\n            </div>\r\n            <div className=\"grid grid-cols-1 gap-2 mt-2\">\r\n              <button className=\"btn w-full\" onClick={handleWinPopupSubmit}>Submit</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700 w-full\" onClick={() => { setShowWinPopup(false); startMatch(); }}>Rematch</button>\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800 w-full\" onClick={() => { setShowWinPopup(false); setShowMatchModal(false); setInMatch(false); }}>Back to Menu</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {showMatchSummary && (\r\n        <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]\">\r\n          <ResizableModal storageKey=\"ndn:modal:offline-summary\" className=\"w-full relative\" defaultWidth={820} defaultHeight={520} minWidth={600} minHeight={400} maxWidth={1400} maxHeight={1000}>\r\n            <h3 className=\"text-xl font-extrabold mb-2\">Match Summary</h3>\r\n            <div className=\"text-xs opacity-80 mb-3\">{selectedMode} · {x01Score} start · First to {firstTo}</div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n              <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                <div className=\"text-sm font-semibold mb-1\">You</div>\r\n                <div className=\"text-3xl font-extrabold\">{playerLegs}</div>\r\n                <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                  <div><span className=\"opacity-70\">3-Dart Avg</span><div className=\"font-semibold\">{totalPlayerDarts>0 ? ((totalPlayerPoints/totalPlayerDarts)*3).toFixed(1) : '0.0'}</div></div>\r\n                  <div><span className=\"opacity-70\">1-Dart Avg</span><div className=\"font-semibold\">{totalPlayerDarts>0 ? (totalPlayerPoints/totalPlayerDarts).toFixed(2) : '0.00'}</div></div>\r\n                  <div><span className=\"opacity-70\">180s</span><div className=\"font-semibold\">{player180s}</div></div>\r\n                  <div><span className=\"opacity-70\">140+</span><div className=\"font-semibold\">{player140s}</div></div>\r\n                  <div><span className=\"opacity-70\">100+</span><div className=\"font-semibold\">{player100s}</div></div>\r\n                  <div><span className=\"opacity-70\">High Checkout</span><div className=\"font-semibold\">{playerHighestCheckout || '—'}</div></div>\r\n                  <div><span className=\"opacity-70\">Dbl Att</span><div className=\"font-semibold\">{playerDoublesAtt}</div></div>\r\n                  <div><span className=\"opacity-70\">Dbl Hit</span><div className=\"font-semibold\">{playerDoublesHit}</div></div>\r\n                </div>\r\n              </div>\r\n              <div className=\"hidden md:flex items-center justify-center\">\r\n                <div className=\"text-4xl font-black\">{playerLegs} – {aiLegs}</div>\r\n              </div>\r\n              <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                <div className=\"text-sm font-semibold mb-1\">{ai==='None' ? 'Opponent' : `${ai} AI`}</div>\r\n                <div className=\"text-3xl font-extrabold\">{aiLegs}</div>\r\n                <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                  <div><span className=\"opacity-70\">3-Dart Avg</span><div className=\"font-semibold\">{totalAiDarts>0 ? ((totalAiPoints/totalAiDarts)*3).toFixed(1) : '0.0'}</div></div>\r\n                  <div><span className=\"opacity-70\">1-Dart Avg</span><div className=\"font-semibold\">{totalAiDarts>0 ? (totalAiPoints/totalAiDarts).toFixed(2) : '0.00'}</div></div>\r\n                  <div><span className=\"opacity-70\">180s</span><div className=\"font-semibold\">{ai180s}</div></div>\r\n                  <div><span className=\"opacity-70\">140+</span><div className=\"font-semibold\">{ai140s}</div></div>\r\n                  <div><span className=\"opacity-70\">100+</span><div className=\"font-semibold\">{ai100s}</div></div>\r\n                  <div><span className=\"opacity-70\">High Checkout</span><div className=\"font-semibold\">{aiHighestCheckout || '—'}</div></div>\r\n                  <div><span className=\"opacity-70\">Dbl Att</span><div className=\"font-semibold\">{aiDoublesAtt}</div></div>\r\n                  <div><span className=\"opacity-70\">Dbl Hit</span><div className=\"font-semibold\">{aiDoublesHit}</div></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm font-semibold mb-2\">Legs Timeline</div>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {legStats.map((leg, i) => (\r\n                  <div key={i} className={`px-3 py-1 rounded-full border text-xs ${leg.winner==='player' ? 'bg-emerald-500/15 border-emerald-400/30' : 'bg-fuchsia-500/15 border-fuchsia-400/30'}`}>\r\n                    Leg {i+1}: {leg.winner==='player' ? 'You' : (ai==='None'?'Opp':'AI')} · Dbl {leg.doubleDarts} · CO {leg.checkoutDarts}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm font-semibold mb-2\">Shot Heat Map</div>\r\n              <div className=\"rounded-2xl overflow-hidden bg-black p-3\">\r\n                {/* Lazy-load HeatMap component to avoid increasing initial bundle too much */}\r\n                <HeatMap />\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => setShowMatchSummary(false)}>Close</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={() => { setShowMatchSummary(false); startMatch(); }}>Rematch</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {legStats.length > 0 && (\r\n        <div className=\"mt-4\">\r\n          <h4 className=\"font-semibold mb-2\">Leg Stats</h4>\r\n          <ul>\r\n            {legStats.map((leg, i) => (\r\n              <li key={i}>Leg {i+1}: Double darts: {leg.doubleDarts}, Checkout darts: {leg.checkoutDarts}</li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","import { create } from 'zustand'\r\n\r\nexport type DM = { id: string; from: string; message: string; ts: number }\r\n\r\ntype MessagesState = {\r\n  inbox: DM[]\r\n  unread: number\r\n  inGame: boolean\r\n  setInGame: (v: boolean) => void\r\n  add: (m: DM) => void\r\n  load: (arr: DM[]) => void\r\n  markAllRead: () => void\r\n  remove: (id: string) => void\r\n}\r\n\r\nconst LS_INBOX = 'ndn:messages:inbox'\r\nconst LS_UNREAD = 'ndn:messages:unread'\r\n\r\nfunction loadInitial() {\r\n  try {\r\n    const raw = localStorage.getItem(LS_INBOX)\r\n    const arr = raw ? JSON.parse(raw) as DM[] : []\r\n    const unread = Number(localStorage.getItem(LS_UNREAD) || '0') || 0\r\n    // sanitize\r\n    const inbox = Array.isArray(arr) ? arr.filter(m => m && typeof m.id==='string').slice(0,200) : []\r\n    return { inbox, unread }\r\n  } catch { return { inbox: [], unread: 0 } }\r\n}\r\n\r\nfunction save(inbox: DM[], unread: number) {\r\n  try { localStorage.setItem(LS_INBOX, JSON.stringify(inbox)) } catch {}\r\n  try { localStorage.setItem(LS_UNREAD, String(unread)) } catch {}\r\n}\r\n\r\nconst initial = loadInitial()\r\n\r\nexport const useMessages = create<MessagesState>((set, get) => ({\r\n  inbox: initial.inbox,\r\n  unread: initial.unread,\r\n  inGame: false,\r\n  setInGame: (v) => set({ inGame: v }),\r\n  add: (m) => set((s) => {\r\n    const exists = s.inbox.some(x => x.id === m.id && x.ts === m.ts)\r\n    const list = exists ? s.inbox : [m, ...s.inbox].slice(0, 200)\r\n    const unread = s.unread + (exists ? 0 : 1)\r\n    save(list, unread)\r\n    return { inbox: list, unread }\r\n  }),\r\n  load: (arr) => set((s) => {\r\n    const sorted = [...arr].sort((a,b)=>b.ts-a.ts).slice(0,200)\r\n    save(sorted, s.unread)\r\n    return { inbox: sorted, unread: s.unread }\r\n  }),\r\n  markAllRead: () => { const s = get(); save(s.inbox, 0); set({ unread: 0 }) },\r\n  remove: (id) => set((s) => {\r\n    const list = s.inbox.filter(m => m.id !== id)\r\n    const unread = s.unread // keep unread count stable on deletion from history\r\n    save(list, unread)\r\n    return { inbox: list, unread }\r\n  }),\r\n}))\r\n","// Simple profanity filter: replaces detected profane words with asterisks of the same length.\r\n// Note: This is a lightweight heuristic and not exhaustive.\r\n\r\nconst patterns: RegExp[] = [\r\n  /\\b(f+[\\W_]*u+[\\W_]*c+[\\W_]*k+)\\b/gi,\r\n  /\\b(s+[\\W_]*h+[\\W_]*i+[\\W_]*t+)\\b/gi,\r\n  /\\b(b+[\\W_]*i+[\\W_]*t+[\\W_]*c+[\\W_]*h+)\\b/gi,\r\n  /\\b(a+[\\W_]*s+[\\W_]*s+[\\W_]*h+[\\W_]*o+[\\W_]*l+[\\W_]*e+)\\b/gi,\r\n  /\\b(d+[\\W_]*a+[\\W_]*m+[\\W_]*n+)\\b/gi,\r\n  /\\b(c+[\\W_]*r+[\\W_]*a+[\\W_]*p+)\\b/gi,\r\n  /\\b(p+[\\W_]*i+[\\W_]*s+[\\W_]*s+)\\b/gi,\r\n]\r\n\r\nfunction starify(match: string) {\r\n  // Preserve whitespace/punct positions; just replace letters/numbers with *\r\n  return match.replace(/[\\p{L}\\p{N}]/gu, '*')\r\n}\r\n\r\nexport function censorProfanity(input: string): string {\r\n  if (!input) return input\r\n  let out = input\r\n  for (const re of patterns) {\r\n    out = out.replace(re, (m) => starify(m))\r\n  }\r\n  return out\r\n}\r\n\r\nexport function containsProfanity(input: string): boolean {\r\n  if (!input) return false\r\n  return patterns.some((re) => re.test(input))\r\n}\r\n","import React from 'react'\r\n\r\ntype Tab = { key: string; label: string }\r\n\r\nexport default function TabPills({\r\n  tabs,\r\n  active,\r\n  onChange,\r\n  className,\r\n}: {\r\n  tabs: Tab[];\r\n  active: string;\r\n  onChange: (key: string) => void;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <div className={`relative ${className || ''}`}>\r\n      {/* subtle backdrop and border for contrast on mobile */}\r\n      <div className=\"absolute inset-0 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 pointer-events-none\" />\r\n      <div className=\"relative overflow-x-auto no-scrollbar py-1 px-1\">\r\n        <div className=\"flex items-center gap-2 min-w-max\">\r\n          {tabs.map((t) => {\r\n            const isActive = t.key === active\r\n            return (\r\n              <button\r\n                key={t.key}\r\n                type=\"button\"\r\n                onClick={() => onChange(t.key)}\r\n                className={`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98]\r\n                  ${isActive\r\n                    ? 'bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white shadow-indigo-500/30'\r\n                    : 'bg-white/10 text-slate-100 hover:bg-white/15'}\r\n                `}\r\n                aria-pressed={isActive}\r\n              >\r\n                {t.label}\r\n              </button>\r\n            )\r\n          })}\r\n        </div>\r\n      </div>\r\n      <style>{`\r\n        /* Hide scrollbars on WebKit/Firefox for a cleaner pill row */\r\n        .no-scrollbar::-webkit-scrollbar { display: none; }\r\n        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }\r\n      `}</style>\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useMemo, useState } from 'react'\r\nimport { useToast } from '../store/toast'\r\nimport { useMessages } from '../store/messages'\r\nimport { censorProfanity } from '../utils/profanity'\r\nimport TabPills from './ui/TabPills'\r\n\r\ntype Friend = { email: string, username?: string, status?: 'online'|'offline'|'ingame', lastSeen?: number, roomId?: string|null, match?: { game: string, mode: string, value: number, startingScore?: number } | null }\r\n\r\nfunction timeAgo(ts?: number) {\r\n  if (!ts) return ''\r\n  const s = Math.floor((Date.now() - ts) / 1000)\r\n  if (s < 60) return `${s}s ago`\r\n  const m = Math.floor(s/60)\r\n  if (m < 60) return `${m}m ago`\r\n  const h = Math.floor(m/60)\r\n  if (h < 24) return `${h}h ago`\r\n  const d = Math.floor(h/24)\r\n  return `${d}d ago`\r\n}\r\n\r\nexport default function Friends({ user }: { user?: any }) {\r\n  const toast = useToast()\r\n  const email = String(user?.email || '').toLowerCase()\r\n  const [friends, setFriends] = useState<Friend[]>([])\r\n  const [suggested, setSuggested] = useState<Friend[]>([])\r\n  const [results, setResults] = useState<Friend[]>([])\r\n  const [q, setQ] = useState('')\r\n  const [filter, setFilter] = useState<'all'|'online'|'offline'|'ingame'|'requests'>('all')\r\n  const [loading, setLoading] = useState(false)\r\n  const msgs = useMessages()\r\n  const [requests, setRequests] = useState<Array<{ id: string; fromEmail: string; fromUsername: string; toEmail: string; toUsername: string; requestedAt: number }>>([])\r\n  const [outgoingRequests, setOutgoingRequests] = useState<Array<{ id: string; fromEmail: string; fromUsername: string; toEmail: string; toUsername: string; requestedAt: number }>>([])\r\n  const [messagePopup, setMessagePopup] = useState<{ show: boolean; toUser?: string; toEmail?: string; replyTo?: string }>({ show: false })\r\n\r\n  async function refresh() {\r\n    if (!email) return\r\n    try {\r\n      const [fl, sg, rq, out] = await Promise.all([\r\n        fetch(`/api/friends/list?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/suggested?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/requests?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/outgoing?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n      ])\r\n      setFriends(fl.friends || [])\r\n      setSuggested(sg.suggestions || [])\r\n      setRequests(rq.requests || [])\r\n      setOutgoingRequests(out.requests || [])\r\n    } catch {}\r\n  }\r\n\r\n  useEffect(() => { refresh() }, [email])\r\n\r\n  async function search(term: string) {\r\n    setQ(term)\r\n    if (!term) { setResults([]); return }\r\n    try {\r\n      const res = await fetch(`/api/friends/search?q=${encodeURIComponent(term)}`)\r\n      const data = await res.json()\r\n      setResults(data.results || [])\r\n    } catch {}\r\n  }\r\n\r\n  async function addFriend(target: string) {\r\n    if (!email || !target) return\r\n    setLoading(true)\r\n    try {\r\n      await fetch('/api/friends/add', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, friend: target }) })\r\n      await refresh()\r\n      setQ(''); setResults([])\r\n      toast('Friend added', { type: 'success' })\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  async function removeFriend(target: string) {\r\n    if (!email || !target) return\r\n    setLoading(true)\r\n    try {\r\n      await fetch('/api/friends/remove', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, friend: target }) })\r\n      await refresh()\r\n      toast('Friend removed', { type: 'info' })\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  const filtered = useMemo(() => {\r\n    if (filter === 'all') return friends\r\n    return friends.filter(f => (f.status || 'offline') === filter)\r\n  }, [friends, filter])\r\n\r\n  async function spectate(roomId?: string|null) {\r\n    if (!roomId) { toast('Room unavailable', { type: 'error' }); return }\r\n    try {\r\n      const ev = new CustomEvent('ndn:spectate-request', { detail: { roomId } })\r\n      window.dispatchEvent(ev)\r\n      toast('Opening spectator view…', { type: 'info' })\r\n    } catch {}\r\n  }\r\n\r\n  // Friend Requests pill: use real requests data\r\n  const requestsCount = requests.length + outgoingRequests.length;\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Friends</h2>\r\n      <p className=\"mb-2 text-brand-600\">Manage your friends. See who’s online, in-game, or offline; find new teammates; and invite people to play.</p>\r\n      <div className=\"text-xs opacity-70 mb-3\">Online: {friends.filter(f=>f.status==='online').length} · In-game: {friends.filter(f=>f.status==='ingame').length} · Offline: {friends.filter(f=>!f.status || f.status==='offline').length}</div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4\">\r\n        <div className=\"md:col-span-2 p-3 rounded-2xl bg-black/30 border border-white/10\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div className=\"font-semibold text-white/90\">Your Friends</div>\r\n          </div>\r\n          <TabPills\r\n            tabs={[\r\n              { key: 'all', label: 'All' },\r\n              { key: 'online', label: 'Online' },\r\n              { key: 'ingame', label: 'In-Game' },\r\n              { key: 'offline', label: 'Offline' },\r\n              { key: 'requests', label: `Requests ${requestsCount > 0 ? '(' + requestsCount + ')' : ''}` },\r\n            ]}\r\n            active={filter}\r\n            onChange={(k)=>setFilter(k as any)}\r\n            className=\"mb-3\"\r\n          />\r\n          {filter === 'requests' ? (\r\n            <ul className=\"space-y-2\">\r\n              {requestsCount > 0 ? (\r\n                <>\r\n                  {/* Incoming requests */}\r\n                  {requests.length > 0 && requests.map(r => (\r\n                    <li key={`incoming-${r.id || r.fromEmail}`} className=\"p-3 rounded bg-black/20 flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-semibold text-lg\">{r.fromUsername || r.fromEmail || 'Unknown User'}</span>\r\n                        <span className=\"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded\">Incoming</span>\r\n                      </div>\r\n                      <div className=\"flex gap-2\">\r\n                        <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={async()=>{\r\n                          setLoading(true)\r\n                          try {\r\n                            const res = await fetch('/api/friends/accept', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, requester: r.fromEmail }) })\r\n                            if (res.ok) {\r\n                              // Remove from requests and add to friends immediately for better UX\r\n                              setRequests(prev => prev.filter(req => req.id !== r.id))\r\n                              // Add to friends list (we'll get the full data on next refresh, but show basic info now)\r\n                              const newFriend = { email: r.fromEmail, username: r.fromUsername, status: 'offline' as const }\r\n                              setFriends(prev => [...prev, newFriend])\r\n                              // Also remove from outgoing if it exists\r\n                              setOutgoingRequests(prev => prev.filter(req => req.toEmail !== r.fromEmail))\r\n                              toast('Friend request accepted', { type: 'success' })\r\n                              // Refresh in background to get complete data\r\n                              setTimeout(() => refresh(), 100)\r\n                            } else {\r\n                              toast('Failed to accept request', { type: 'error' })\r\n                            }\r\n                          } catch (error) {\r\n                            toast('Error accepting request', { type: 'error' })\r\n                          } finally { setLoading(false) }\r\n                        }}>Accept</button>\r\n                        <button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={async()=>{\r\n                          setLoading(true)\r\n                          try {\r\n                            const res = await fetch('/api/friends/decline', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, requester: r.fromEmail }) })\r\n                            if (res.ok) {\r\n                              // Remove from requests immediately for better UX\r\n                              setRequests(prev => prev.filter(req => req.id !== r.id))\r\n                              // Also remove from outgoing if it exists\r\n                              setOutgoingRequests(prev => prev.filter(req => req.toEmail !== r.fromEmail))\r\n                              toast('Friend request declined', { type: 'info' })\r\n                              // Refresh in background to ensure consistency\r\n                              setTimeout(() => refresh(), 100)\r\n                            } else {\r\n                              toast('Failed to decline request', { type: 'error' })\r\n                            }\r\n                          } finally { setLoading(false) }\r\n                        }}>Decline</button>\r\n                      </div>\r\n                    </li>\r\n                  ))}\r\n                  {/* Outgoing requests */}\r\n                  {outgoingRequests.length > 0 && outgoingRequests.map(r => (\r\n                    <li key={`outgoing-${r.id || r.toEmail}`} className=\"p-3 rounded bg-black/20 flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-semibold text-lg\">{r.toUsername || r.toEmail || 'Unknown User'}</span>\r\n                        <span className=\"text-xs bg-amber-600/20 text-amber-400 px-2 py-1 rounded\">Pending</span>\r\n                      </div>\r\n                      <button className=\"btn bg-slate-600 hover:bg-slate-700 self-start\" onClick={async()=>{\r\n                        setLoading(true)\r\n                        try {\r\n                          const res = await fetch('/api/friends/cancel', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, friend: r.toEmail }) })\r\n                          if (res.ok) {\r\n                            // Remove from outgoing requests immediately for better UX\r\n                            setOutgoingRequests(prev => prev.filter(req => req.id !== r.id))\r\n                            toast('Friend request cancelled', { type: 'info' })\r\n                            // Refresh in background to ensure consistency\r\n                            setTimeout(() => refresh(), 100)\r\n                          } else {\r\n                            toast('Failed to cancel request', { type: 'error' })\r\n                          }\r\n                        } finally { setLoading(false) }\r\n                      }}>Cancel</button>\r\n                    </li>\r\n                  ))}\r\n                </>\r\n              ) : (\r\n                <li className=\"text-sm opacity-70\">No friend requests yet.</li>\r\n              )}\r\n            </ul>\r\n          ) : (\r\n            <ul className=\"space-y-2\">\r\n              {filtered.map(f => (\r\n                <li key={f.email} className=\"p-2 rounded bg-black/20 flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className={`inline-block w-2 h-2 rounded-full ${f.status==='online'?'bg-emerald-400':f.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                    <span className=\"font-semibold\">{f.username || f.email}</span>\r\n                    <span className=\"text-xs opacity-70\">{f.status || 'offline'}{(f.status!=='online' && f.lastSeen) ? ` · ${timeAgo(f.lastSeen)}` : ''}</span>\r\n                    {f.status==='ingame' && f.match && (\r\n                      <span className=\"text-[10px] opacity-70 px-2 py-0.5 rounded bg-indigo-500/20 border border-indigo-600/30\">{f.match.game} {f.match.mode==='firstto'?'FT':'BO'} {f.match.value}{f.match.game==='X01' && f.match.startingScore ? ` · ${f.match.startingScore}`:''}</span>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {f.status==='ingame' && f.roomId && (\r\n                      <button className=\"btn\" onClick={()=>spectate(f.roomId!)}>Spectate</button>\r\n                    )}\r\n                    <button className=\"btn\" disabled={loading || (f.status!=='online' && f.status!=='ingame')} onClick={async()=>{\r\n                      setLoading(true)\r\n                      try {\r\n                        const res = await fetch('/api/friends/invite', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ fromEmail: email, toEmail: f.email, game: 'X01', mode: 'bestof', value: 3, startingScore: 501 }) })\r\n                        const data = await res.json().catch(()=>({}))\r\n                        if (data?.delivered) toast('Invite sent', { type: 'success' })\r\n                        else toast('Friend is offline; invite queued', { type: 'info' })\r\n                      } finally { setLoading(false) }\r\n                    }}>Invite</button>\r\n                    <button className=\"btn\" disabled={loading} onClick={()=>setMessagePopup({ show: true, toUser: f.username || f.email, toEmail: f.email })}>Message</button>\r\n                    <button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={()=>removeFriend(f.email)}>Remove</button>\r\n                  </div>\r\n                </li>\r\n              ))}\r\n              {filtered.length === 0 && (\r\n                <li className=\"text-sm opacity-70\">No friends {filter !== 'all' ? `in ${filter}` : ''} yet.</li>\r\n              )}\r\n            </ul>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"p-3 rounded-2xl bg-black/20 border border-white/10\">\r\n          <div className=\"font-semibold mb-2 text-white/90\">Find Friends</div>\r\n          <input className=\"input w-full mb-2\" placeholder=\"Search by name or email\" value={q} onChange={e=>search(e.target.value)} />\r\n          <ul className=\"space-y-1 mb-3 max-h-48 overflow-auto\">\r\n            {results.map(r => (\r\n              <li key={r.email} className=\"flex items-center justify-between p-2 rounded bg-black/10\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className={`inline-block w-2 h-2 rounded-full ${r.status==='online'?'bg-emerald-400':r.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                  <span>{r.username || r.email}</span>\r\n                </div>\r\n                <button className=\"btn\" disabled={loading} onClick={()=>addFriend(r.email)}>Add</button>\r\n              </li>\r\n            ))}\r\n            {results.length === 0 && <li className=\"text-xs opacity-60\">Type to search…</li>}\r\n          </ul>\r\n          <div className=\"font-semibold mb-1 text-white/90\">Suggested</div>\r\n          <ul className=\"space-y-1 max-h-48 overflow-auto\">\r\n            {suggested.map(s => (\r\n              <li key={s.email} className=\"flex items-center justify-between p-2 rounded bg-black/10\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className={`inline-block w-2 h-2 rounded-full ${s.status==='online'?'bg-emerald-400':s.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                  <span>{s.username || s.email}</span>\r\n                </div>\r\n                <button className=\"btn\" disabled={loading} onClick={()=>addFriend(s.email)}>Add</button>\r\n              </li>\r\n            ))}\r\n            {suggested.length === 0 && <li className=\"text-xs opacity-60\">No suggestions right now.</li>}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Direct Messages */}\r\n      <div className=\"p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <div className=\"font-semibold\">Messages</div>\r\n          <button className=\"btn px-3 py-1 text-sm\" onClick={()=>msgs.markAllRead()}>Mark all read</button>\r\n        </div>\r\n        {msgs.inbox.length === 0 ? (\r\n          <div className=\"text-sm opacity-70\">No messages yet.</div>\r\n        ) : (\r\n          <ul className=\"space-y-2 max-h-72 overflow-auto\">\r\n            {msgs.inbox.map(m => (\r\n              <li key={m.id} className=\"p-2 rounded bg-black/20 text-sm\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div><span className=\"font-semibold\">{m.from}</span> <span className=\"opacity-70 text-xs\">· {new Date(m.ts).toLocaleString()}</span></div>\r\n                  <div className=\"flex gap-2\">\r\n                    <button className=\"btn px-2 py-1 text-xs\" onClick={()=>setMessagePopup({ show: true, toUser: m.from, toEmail: m.from, replyTo: m.from })}>Reply</button>\r\n                    <button className=\"btn bg-slate-700 hover:bg-slate-800 px-2 py-1 text-xs\" title=\"Delete this message\" onClick={()=>msgs.remove(m.id)}>Delete</button>\r\n                    <button className=\"btn bg-rose-600 hover:bg-rose-700 px-2 py-1 text-xs\" onClick={async()=>{\r\n                      const reason = prompt('Report reason (what happened)?')\r\n                      if (!reason) return\r\n                      try {\r\n                        await fetch('/api/friends/report', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ reporterEmail: email, offenderEmail: m.from, reason, messageId: m.id }) })\r\n                        toast('Report sent to admin', { type: 'info' })\r\n                      } catch {}\r\n                    }}>Report</button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"mt-1 whitespace-pre-wrap break-words\">{censorProfanity(m.message)}</div>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        )}\r\n      </div>\r\n\r\n      {/* Message Popup */}\r\n      {messagePopup.show && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4\">\r\n            <div className=\"text-center mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-white\">\r\n                Type Message To {messagePopup.toUser}\r\n              </h3>\r\n            </div>\r\n            <textarea\r\n              className=\"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none\"\r\n              placeholder=\"Type your message here...\"\r\n              id=\"message-input\"\r\n              autoFocus\r\n            />\r\n            <div className=\"flex gap-3 mt-4\">\r\n              <button\r\n                className=\"flex-1 btn bg-emerald-600 hover:bg-emerald-700\"\r\n                onClick={async () => {\r\n                  const input = document.getElementById('message-input') as HTMLTextAreaElement\r\n                  const message = input?.value?.trim()\r\n                  if (!message) return\r\n\r\n                  setLoading(true)\r\n                  try {\r\n                    await fetch('/api/friends/message', {\r\n                      method: 'POST',\r\n                      headers: { 'Content-Type': 'application/json' },\r\n                      body: JSON.stringify({\r\n                        fromEmail: email,\r\n                        toEmail: messagePopup.toEmail,\r\n                        message\r\n                      })\r\n                    })\r\n                    toast('Message sent', { type: 'success' })\r\n                    setMessagePopup({ show: false })\r\n                  } catch (error) {\r\n                    toast('Failed to send message', { type: 'error' })\r\n                  } finally {\r\n                    setLoading(false)\r\n                  }\r\n                }}\r\n                disabled={loading}\r\n              >\r\n                Send\r\n              </button>\r\n              <button\r\n                className=\"flex-1 btn bg-slate-600 hover:bg-slate-700\"\r\n                onClick={() => setMessagePopup({ show: false })}\r\n              >\r\n                Cancel\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}","import { useToastStore } from '../store/toast'\r\n\r\nexport default function Toaster() {\r\n  const toasts = useToastStore(s => s.toasts)\r\n  const remove = useToastStore(s => s.remove)\r\n  if (!toasts.length) return null\r\n  return (\r\n    <>\r\n      {/* Success messages centered */}\r\n      {toasts.filter(t => t.type === 'success').map(t => (\r\n        <div key={t.id} className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50\">\r\n          <div className={`p-4 rounded-lg shadow-lg border text-sm bg-emerald-700/90 border-emerald-500/60 text-white max-w-sm text-center`}>\r\n            <div className=\"flex items-center justify-center gap-2\">\r\n              <span className=\"flex-1 font-semibold\">{t.message}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n      {/* Other messages bottom right */}\r\n      {toasts.filter(t => t.type !== 'success').length > 0 && (\r\n        <div className=\"fixed bottom-4 right-4 z-50 space-y-2 sm:right-4 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 w-[calc(100%-1.5rem)] sm:w-auto max-w-sm\">\r\n          {toasts.filter(t => t.type !== 'success').map(t => (\r\n            <div key={t.id} className={`p-3 rounded-lg shadow-lg border text-sm ${\r\n              t.type === 'error' ? 'bg-rose-700/80 border-rose-500/60 text-white' :\r\n              'bg-black/70 border-slate-700 text-slate-100'\r\n            }`}>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"flex-1\">{t.message}</span>\r\n                <button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={()=>remove(t.id)}>Dismiss</button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\ntype Datum = { label: string | number; value: number }\r\n\r\nexport default function BarChart({\r\n  data,\r\n  height = 220,\r\n  barWidth = 28,\r\n  gap = 6,\r\n  showValues = false,\r\n}: {\r\n  data: Datum[]\r\n  height?: number\r\n  barWidth?: number\r\n  gap?: number\r\n  showValues?: boolean\r\n}) {\r\n  const max = Math.max(1, ...data.map(d => d.value))\r\n  const totalWidth = data.length * (barWidth + gap)\r\n  return (\r\n    <div className=\"w-full overflow-x-auto\">\r\n      <div className=\"relative\" style={{ height, width: Math.max(600, totalWidth) }}>\r\n        <div className=\"absolute inset-0 flex items-end\">\r\n          {data.map((d, i) => {\r\n            const h = Math.round((d.value / max) * (height - 40)) // leave room for labels\r\n            return (\r\n              <div key={i} className=\"flex flex-col items-center justify-end\" style={{ width: barWidth, marginRight: gap }}>\r\n                <div\r\n                  className=\"w-full rounded-t-md bg-gradient-to-b from-indigo-400 to-fuchsia-500 shadow-sm\"\r\n                  style={{ height: h }}\r\n                  title={`${d.label}: ${d.value}`}\r\n                />\r\n                {showValues && <div className=\"text-[10px] mt-1 opacity-80\">{d.value}</div>}\r\n                <div className=\"text-[10px] mt-1 opacity-70 select-none\">{d.label}</div>\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","export const freeGames = ['X01', 'Double Practice'] as const\r\nexport const premiumGames = [\r\n\t'Around the Clock',\r\n\t'Cricket',\r\n\t'Halve It',\r\n\t'Shanghai',\r\n\t'High-Low',\r\n\t'Killer',\r\n\t\"Bob's 27\",\r\n\t'Count-Up',\r\n\t'High Score',\r\n\t'Low Score',\r\n\t'Checkout 170',\r\n\t'Checkout 121',\r\n\t'Treble Practice',\r\n\t'Baseball',\r\n\t'Golf',\r\n\t'Tic Tac Toe',\r\n\t'American Cricket',\r\n] as const\r\nexport type GameKey = typeof freeGames[number] | typeof premiumGames[number]\r\nexport const allGames: GameKey[] = [...freeGames, ...premiumGames]\r\n","import { useEffect, useMemo, useState } from 'react'\r\nimport BarChart from './BarChart'\r\nimport TabPills from './ui/TabPills'\r\nimport { getGameModeStats } from '../store/profileStats'\r\nimport { allGames } from '../utils/games'\r\n\r\nconst OWNER_EMAIL = 'daviesfamily108@gmail.com'\r\n\r\nexport default function AdminDashboard({ user }: { user: any }) {\r\n\tconst [admins, setAdmins] = useState<string[]>([])\r\n\tconst [email, setEmail] = useState('')\r\n\tconst [status, setStatus] = useState<any>(null)\r\n\tconst [announcement, setAnnouncement] = useState('')\r\n\tconst [loading, setLoading] = useState(false)\r\n\tconst [tournaments, setTournaments] = useState<any[]>([])\r\n\t\tconst [withdrawals, setWithdrawals] = useState<any[]>([])\r\n\tconst [userSearch, setUserSearch] = useState('')\r\n\tconst [userResults, setUserResults] = useState<any[]>([])\r\n\tconst [createForm, setCreateForm] = useState<any>({\r\n\t\ttitle: 'Official Tournament',\r\n\t\tgame: 'X01',\r\n\t\tmode: 'bestof',\r\n\t\tvalue: 3,\r\n\t\tdescription: '',\r\n\t\tstartAt: new Date(Date.now() + 2*60*60*1000).toISOString().slice(0,16),\r\n\t\tcheckinMinutes: 30,\r\n\t\tcapacity: 16,\r\n\t\tprizeType: 'premium',\r\n\t\tprizeAmount: 3,\r\n\t\t\tcurrency: 'GBP',\r\n\t\tprizeNotes: '',\r\n\t})\r\n\tconst [emailCopy, setEmailCopy] = useState<any>({ reset:{}, reminder:{}, confirmEmail:{}, changed:{} })\r\n\tconst [preview, setPreview] = useState<{ open: boolean, kind?: string, html?: string }>({ open: false })\r\n\tconst [activeTab, setActiveTab] = useState<'general' | 'maintenance' | 'premium'>('general')\r\n\tconst isOwner = user?.email?.toLowerCase() === OWNER_EMAIL\r\n  const [winners, setWinners] = useState<any[]>([])\r\n\t\tconst [reports, setReports] = useState<any[]>([])\r\n\tconst [logs, setLogs] = useState<any[]>([])\r\n\tconst [systemHealth, setSystemHealth] = useState<any>(null)\r\n\r\n\t// --- Game usage (played/won per mode) ---\r\n\tconst [gmVersion, setGmVersion] = useState(0)\r\n\tuseEffect(() => {\r\n\t\tconst on = () => setGmVersion(v => v + 1)\r\n\t\twindow.addEventListener('ndn:stats-updated', on as any)\r\n\t\treturn () => window.removeEventListener('ndn:stats-updated', on as any)\r\n\t}, [])\r\n\tconst gmStats = useMemo(() => getGameModeStats(allGames as unknown as string[]), [gmVersion])\r\n\tconst gmBars = useMemo(() => (\r\n\t\t(allGames as unknown as string[]).map(mode => ({ label: mode, value: gmStats[mode]?.played || 0, won: gmStats[mode]?.won || 0 }))\r\n\t), [gmStats])\r\n\r\n\tasync function refresh() {\r\n\t\ttry {\r\n\t\t\tconst res = await fetch('/api/admins')\r\n\t\t\tconst data = await res.json()\r\n\t\t\tsetAdmins(Array.isArray(data.admins) ? data.admins : [])\r\n\t\t\tif (isOwner) {\r\n\t\t\t\tconst sres = await fetch(`/api/admin/status?requesterEmail=${encodeURIComponent(user?.email || '')}`)\r\n\t\t\t\tif (sres.ok) setStatus(await sres.json())\r\n\t\t\t\tconst tres = await fetch(`/api/admin/tournaments?requesterEmail=${encodeURIComponent(user?.email || '')}`)\r\n        if (tres.ok) {\r\n          const td = await tres.json()\r\n          setTournaments(Array.isArray(td.tournaments) ? td.tournaments : [])\r\n        }\r\n\t\t\t\tconst rres = await fetch(`/api/admin/reports?requesterEmail=${encodeURIComponent(user?.email || '')}`)\r\n\t\t\t\tif (rres.ok) {\r\n\t\t\t\t\tconst rd = await rres.json()\r\n\t\t\t\t\tsetReports(Array.isArray(rd.reports) ? rd.reports : [])\r\n\t\t\t\t}\r\n\t\t\t\tconst pw = await fetch(`/api/admin/premium-winners?requesterEmail=${encodeURIComponent(user?.email||'')}`)\r\n\t\t\t\tif (pw.ok) {\r\n\t\t\t\t\tconst d = await pw.json()\r\n\t\t\t\t\tsetWinners(Array.isArray(d.winners) ? d.winners : [])\r\n\t\t\t\t}\r\n\t\t\t\t\t\tconst wres = await fetch(`/api/admin/wallet/withdrawals?requesterEmail=${encodeURIComponent(user?.email || '')}`)\r\n\t\t\t\t\t\tif (wres.ok) {\r\n\t\t\t\t\t\t\tconst wd = await wres.json()\r\n\t\t\t\t\t\t\tsetWithdrawals(Array.isArray(wd.withdrawals) ? wd.withdrawals : [])\r\n\t\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch {}\r\n\t}\r\n\r\n\tuseEffect(() => { refresh() }, [])\r\n\r\n\tasync function grant() {\r\n\t\tif (!email) return\r\n\t\tawait fetch('/api/admins/grant', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, requesterEmail: user?.email }) })\r\n\t\tsetEmail('')\r\n\t\trefresh()\r\n\t}\r\n\tasync function revoke(target: string) {\r\n\t\tawait fetch('/api/admins/revoke', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: target, requesterEmail: user?.email }) })\r\n\t\trefresh()\r\n\t}\r\n\r\n\tasync function grantPremium(email: string, days: number) {\r\n\t\tif (!email) return\r\n\t\tawait fetch('/api/admin/premium/grant', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, days, requesterEmail: user?.email }) })\r\n\t\tawait refresh()\r\n\t}\r\n\tasync function revokePremium(email: string) {\r\n\t\tawait fetch('/api/admin/premium/revoke', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, requesterEmail: user?.email }) })\r\n\t\tawait refresh()\r\n\t}\r\n\r\n\tasync function toggleMaintenance(enabled: boolean) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/maintenance', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ enabled, requesterEmail: user?.email }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function sendAnnouncement() {\r\n\t\tif (!announcement.trim()) return\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/announce', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: announcement, requesterEmail: user?.email }) })\r\n\t\t\tsetAnnouncement('')\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function searchUsers() {\r\n\t\tif (!userSearch.trim()) return\r\n\t\ttry {\r\n\t\t\tconst res = await fetch(`/api/admin/users/search?q=${encodeURIComponent(userSearch)}&requesterEmail=${encodeURIComponent(user?.email || '')}`)\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tconst data = await res.json()\r\n\t\t\t\tsetUserResults(Array.isArray(data.users) ? data.users : [])\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Search failed:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function banUser(email: string) {\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/users/ban', { \r\n\t\t\t\tmethod: 'POST', \r\n\t\t\t\theaders: { 'Content-Type': 'application/json' }, \r\n\t\t\t\tbody: JSON.stringify({ email, requesterEmail: user?.email }) \r\n\t\t\t})\r\n\t\t\tawait searchUsers() // Refresh results\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Ban failed:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function unbanUser(email: string) {\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/users/unban', { \r\n\t\t\t\tmethod: 'POST', \r\n\t\t\t\theaders: { 'Content-Type': 'application/json' }, \r\n\t\t\t\tbody: JSON.stringify({ email, requesterEmail: user?.email }) \r\n\t\t\t})\r\n\t\t\tawait searchUsers() // Refresh results\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Unban failed:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function flipPremium(next: boolean) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/subscription', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ fullAccess: next, requesterEmail: user?.email }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function createOfficialTournament() {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tconst start = new Date(createForm.startAt).getTime()\r\n\t\t\tawait fetch('/api/tournaments/create', {\r\n\t\t\t\tmethod: 'POST', headers: { 'Content-Type': 'application/json' },\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\ttitle: createForm.title,\r\n\t\t\t\t\tgame: createForm.game,\r\n\t\t\t\t\tmode: createForm.mode,\r\n\t\t\t\t\tvalue: Number(createForm.value),\r\n\t\t\t\t\tdescription: createForm.description,\r\n\t\t\t\t\tstartAt: start,\r\n\t\t\t\t\tcheckinMinutes: Number(createForm.checkinMinutes),\r\n\t\t\t\t\tcapacity: Number(createForm.capacity),\r\n\t\t\t\t\tcreatorEmail: user?.email,\r\n\t\t\t\t\tcreatorName: user?.username,\r\n\t\t\t\t\trequesterEmail: user?.email,\r\n\t\t\t\t\tofficial: true,\r\n\t\t\t\t\tprizeType: createForm.prizeType,\r\n\t\t\t\t\tprizeAmount: Number(createForm.prizeAmount||0),\r\n\t\t\t\t\tcurrency: createForm.currency,\r\n\t\t\t\t\tprizeNotes: createForm.prizeNotes,\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function setWinner(tid: string, winnerEmail: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/tournaments/winner', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tournamentId: tid, winnerEmail, requesterEmail: user?.email }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function markPaid(tid: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/tournaments/mark-paid', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tournamentId: tid, requesterEmail: user?.email }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function deleteTournament(tid: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/tournaments/delete', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tournamentId: tid, requesterEmail: user?.email }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function reseedWeekly() {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/tournaments/reseed-weekly', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ requesterEmail: user?.email }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\t\tasync function decideWithdrawal(id: string, approve: boolean) {\r\n\t\t\tsetLoading(true)\r\n\t\t\ttry {\r\n\t\t\t\tawait fetch('/api/admin/wallet/withdrawals/decide', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id, approve, requesterEmail: user?.email }) })\r\n\t\t\t\tawait refresh()\r\n\t\t\t} finally { setLoading(false) }\r\n\t\t}\r\n\r\n\tasync function deleteMatch(id: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/matches/delete', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ matchId: id, requesterEmail: user?.email }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function fetchLogs() {\r\n\t\ttry {\r\n\t\t\tconst res = await fetch(`/api/admin/logs?requesterEmail=${encodeURIComponent(user?.email || '')}`)\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tconst data = await res.json()\r\n\t\t\t\tif (data?.ok) setLogs(data.logs || [])\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to fetch logs:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function fetchSystemHealth() {\r\n\t\ttry {\r\n\t\t\tconst res = await fetch(`/api/admin/system-health?requesterEmail=${encodeURIComponent(user?.email || '')}`)\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tconst data = await res.json()\r\n\t\t\t\tif (data?.ok) setSystemHealth(data.health)\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to fetch system health:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function runQuickFix(action: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tconst res = await fetch('/api/admin/quick-fix', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\t\tbody: JSON.stringify({ action, requesterEmail: user?.email })\r\n\t\t\t})\r\n\t\t\tconst data = await res.json()\r\n\t\t\tif (data?.ok) {\r\n\t\t\t\talert(`${action} completed successfully`)\r\n\t\t\t\tawait fetchSystemHealth() // Refresh health data\r\n\t\t\t} else {\r\n\t\t\t\talert(`Failed: ${data?.error || 'Unknown error'}`)\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Quick fix failed:', error)\r\n\t\t\talert('Quick fix failed')\r\n\t\t} finally {\r\n\t\t\tsetLoading(false)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function loadEmailCopy() {\r\n\t\ttry {\r\n\t\t\tconst res = await fetch(`/api/admin/email-copy?requesterEmail=${encodeURIComponent(user?.email||'')}`)\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tconst d = await res.json()\r\n\t\t\t\tif (d?.ok) setEmailCopy(d.copy || emailCopy)\r\n\t\t\t}\r\n\t\t} catch {}\r\n\t}\r\n\tuseEffect(()=>{ if (isOwner) loadEmailCopy() }, [isOwner])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (isOwner && (activeTab === 'general' || activeTab === 'maintenance')) {\r\n\t\t\tfetchLogs()\r\n\t\t\tfetchSystemHealth()\r\n\t\t}\r\n\t}, [isOwner, activeTab])\r\n\r\n\tasync function saveEmailCopy(kind: string, payload: any) {\r\n\t\tawait fetch('/api/admin/email-copy', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ requesterEmail: user?.email, kind, ...payload }) })\r\n\t\tawait loadEmailCopy()\r\n\t}\r\n\r\n\tasync function openInlinePreview(kind: string) {\r\n\t\ttry {\r\n\t\t\tconst res = await fetch(`/api/email/preview?kind=${encodeURIComponent(kind)}&requesterEmail=${encodeURIComponent(user?.email||'')}`)\r\n\t\t\tconst html = await res.text()\r\n\t\t\tsetPreview({ open: true, kind, html })\r\n\t\t} catch {\r\n\t\t\tsetPreview({ open: true, kind, html: '<!doctype html><html><body style=\"font-family:sans-serif;padding:16px\">Failed to load preview.</body></html>' })\r\n\t\t}\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!preview.open) return\r\n\t\tfunction onKey(e: KeyboardEvent) { if (e.key === 'Escape') setPreview({ open: false }) }\r\n\t\tdocument.addEventListener('keydown', onKey)\r\n\t\treturn () => document.removeEventListener('keydown', onKey)\r\n\t}, [preview.open])\r\n\r\n\tfunction EmailEditor({ kind, label }: { kind:string, label:string }) {\r\n\t\tconst key = kind === 'confirm-email' ? 'confirmEmail' : (kind === 'changed' ? 'changed' : kind)\r\n\t\tconst cfg = emailCopy?.[key] || { title:'', intro:'', buttonLabel:'' }\r\n\t\tconst [title, setTitle] = useState(cfg.title||'')\r\n\t\tconst [intro, setIntro] = useState(cfg.intro||'')\r\n\t\tconst [btn, setBtn] = useState(cfg.buttonLabel||'')\r\n\t\tuseEffect(()=>{ setTitle(cfg.title||''); setIntro(cfg.intro||''); setBtn(cfg.buttonLabel||'') }, [cfg.title, cfg.intro, cfg.buttonLabel])\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"p-2 rounded bg-black/20 space-y-2\">\r\n\t\t\t\t<div className=\"font-semibold\">{label}</div>\r\n\t\t\t\t<input className=\"input w-full\" placeholder=\"Title (optional)\" value={title} onChange={e=>setTitle(e.target.value)} />\r\n\t\t\t\t<textarea className=\"input w-full\" rows={2} placeholder=\"Intro line (optional)\" value={intro} onChange={e=>setIntro(e.target.value)} />\r\n\t\t\t\t<input className=\"input w-full\" placeholder=\"Button label (optional)\" value={btn} onChange={e=>setBtn(e.target.value)} />\r\n\t\t\t\t<div className=\"flex gap-2 justify-end\">\r\n\t\t\t\t\t<a className=\"btn\" href={`/api/email/preview?kind=${encodeURIComponent(kind)}&requesterEmail=${encodeURIComponent(user?.email||'')}`} target=\"_blank\" rel=\"noreferrer\">Preview</a>\r\n\t\t\t\t\t<button className=\"btn\" type=\"button\" onClick={()=>openInlinePreview(kind)}>Popup</button>\r\n\t\t\t\t\t<button className=\"btn\" onClick={()=>saveEmailCopy(kind, { title, intro, buttonLabel: btn })}>Save</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\tif (!isOwner) return (\r\n\t\t<div className=\"card\">\r\n\t\t\t<h2 className=\"text-2xl font-bold mb-2\">Admin</h2>\r\n\t\t\t<div className=\"text-sm opacity-80\">You don’t have permission to manage admins.</div>\r\n\t\t</div>\r\n\t)\r\n\r\n\treturn (\r\n\t\t<div className=\"space-y-4\">\r\n\t\t\t{isOwner && (\r\n\t\t\t\t<TabPills\r\n\t\t\t\t\ttabs={[\r\n\t\t\t\t\t\t{ key: 'general', label: 'General' },\r\n\t\t\t\t\t\t{ key: 'maintenance', label: 'Maintenance' },\r\n\t\t\t\t\t\t{ key: 'premium', label: 'Premium' }\r\n\t\t\t\t\t]}\r\n\t\t\t\t\tactive={activeTab}\r\n\t\t\t\t\tonChange={(key) => setActiveTab(key as 'general' | 'maintenance' | 'premium')}\r\n\t\t\t\t\tclassName=\"mb-4\"\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\r\n\t\t\t{activeTab === 'general' && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{isOwner && (\r\n\t\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Game Usage</h3>\r\n\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Bar height shows total plays per mode. Wins are listed under each label. This helps decide which modes to keep or iterate on.</div>\r\n\t\t\t\t\t\t\t<div className=\"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3\">\r\n\t\t\t\t\t\t\t\t<BarChart data={gmBars.map(d => ({ label: d.label, value: d.value }))} />\r\n\t\t\t\t\t\t\t\t<div className=\"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80\">\r\n\t\t\t\t\t\t\t\t\t{gmBars.map((d, i) => (\r\n\t\t\t\t\t\t\t\t\t\t<div key={i} className=\"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"truncate mr-2\">{d.label}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"whitespace-nowrap\">Played {d.value} · Won {d.won}</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h2 className=\"text-2xl font-bold mb-2\">Admin Control</h2>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Grant or revoke Admin to trusted users. Only the owner can perform these actions.</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"user@example.com\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={grant}>Grant</button>\r\n\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={() => revoke(email)}>Revoke</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Current Admins:</div>\r\n\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2 mb-4\">\r\n\t\t\t\t\t\t\t{admins.map((admin)=> (\r\n\t\t\t\t\t\t\t\t<div key={admin} className=\"px-2 py-1 rounded bg-indigo-600/20 border border-indigo-500/40 text-sm\">\r\n\t\t\t\t\t\t\t\t\t{admin}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<hr className=\"border-indigo-500/20 my-4\" />\r\n\r\n\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-2\">Premium Access Control</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Grant or revoke Premium subscription access to users (grants 30 days).</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"user@example.com\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn bg-emerald-600 hover:bg-emerald-700\" disabled={loading || !email.trim()} onClick={() => grantPremium(email, 30)}>Grant Premium</button>\r\n\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={() => revokePremium(email)}>Revoke Premium</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80\">Premium grants provide 30 days of unlimited access to all features.</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-2\">Tournament Premium Winners</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Users who have won premium prizes in tournaments and need access granted.</div>\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{tournaments\r\n\t\t\t\t\t\t\t\t.filter((t: any) => t.status === 'completed' && t.winnerEmail && t.prizeType === 'premium')\r\n\t\t\t\t\t\t\t\t.map((t: any) => {\r\n\t\t\t\t\t\t\t\t\tconst winner = winners.find((w: any) => w.email === t.winnerEmail)\r\n\t\t\t\t\t\t\t\t\tconst hasAccess = winner && !winner.expired\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t<div key={t.id} className=\"p-3 rounded bg-black/20 text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{t.title}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs opacity-70\">{new Date(t.startAt).toLocaleDateString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{t.winnerEmail}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs opacity-70\">Prize: {t.prizeAmount} month{t.prizeAmount > 1 ? 's' : ''} PREMIUM</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{hasAccess ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-2 py-1 rounded bg-emerald-600 text-xs\">Access Granted</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"btn bg-emerald-600 hover:bg-emerald-700 text-xs\" \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => grantPremium(t.winnerEmail, t.prizeAmount * 30 * 24 * 60 * 60 * 1000)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tGrant Access\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t{tournaments.filter((t: any) => t.status === 'completed' && t.winnerEmail && t.prizeType === 'premium').length === 0 && (\r\n\t\t\t\t\t\t\t\t<div className=\"text-center py-4 text-sm opacity-60\">No completed premium tournaments.</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Announcements</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Send a message to all users. This will appear as a toast notification.</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"Announcement message...\" value={announcement} onChange={e=>setAnnouncement(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading || !announcement.trim()} onClick={sendAnnouncement}>Send</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">User Search</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Search for users by email or name.</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"Search users...\" value={userSearch} onChange={e=>setUserSearch(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={searchUsers}>Search</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{userResults.length > 0 && (\r\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Results:</div>\r\n\t\t\t\t\t\t\t\t{userResults.map((u)=> (\r\n\t\t\t\t\t\t\t\t\t<div key={u.email} className=\"p-2 rounded bg-black/20 text-sm flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{u.name || 'No name'}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{u.email}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-60 text-xs\">Joined {new Date(u.createdAt).toLocaleDateString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{isOwner && (\r\n\t\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Tournaments Management</h3>\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"font-semibold mb-2\">Create Official</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t\t<input className=\"input w-full\" placeholder=\"Title\" value={createForm.title} onChange={e=>setCreateForm((f:any)=>({ ...f, title: e.target.value }))} />\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-3 gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<select className=\"input\" value={createForm.game} onChange={e=>setCreateForm((f:any)=>({ ...f, game: e.target.value }))}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{['X01','Around the Clock','Cricket','Halve It','Shanghai','High-Low'].map((g)=> <option key={g} value={g}>{g}</option>)}\r\n\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t\t<select className=\"input\" value={createForm.mode} onChange={e=>setCreateForm((f:any)=>({ ...f, mode: e.target.value }))}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"bestof\">Best of</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"firstto\">First to</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t\t<input className=\"input\" type=\"number\" min={1} value={createForm.value} onChange={e=>setCreateForm((f:any)=>({ ...f, value: Number(e.target.value) }))} />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<textarea className=\"input w-full\" rows={2} placeholder=\"Description\" value={createForm.description} onChange={e=>setCreateForm((f:any)=>({ ...f, description: e.target.value }))} />\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input className=\"input\" type=\"datetime-local\" value={createForm.startAt} onChange={e=>setCreateForm((f:any)=>({ ...f, startAt: e.target.value }))} />\r\n\t\t\t\t\t\t\t\t\t\t\t<input className=\"input\" type=\"number\" min={0} value={createForm.checkinMinutes} onChange={e=>setCreateForm((f:any)=>({ ...f, checkinMinutes: Number(e.target.value) }))} />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<input className=\"input w-full\" type=\"number\" min={6} max={64} value={createForm.capacity} onChange={e=>setCreateForm((f:any)=>({ ...f, capacity: Number(e.target.value) }))} />\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-3 gap-2 items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<select className=\"input\" value={createForm.prizeType} onChange={e=>{\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst newType = e.target.value\r\n\t\t\t\t\t\t\t\t\t\t\t\tsetCreateForm((f:any)=>({ ...f, prizeType: newType, prizeAmount: newType === 'premium' ? 3 : 0 }))\r\n\t\t\t\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"premium\">PREMIUM</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"cash\">Cash</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t\t{createForm.prizeType === 'premium' ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<select className=\"input\" value={createForm.prizeAmount} onChange={e=>setCreateForm((f:any)=>({ ...f, prizeAmount: Number(e.target.value) }))}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value={1}>1 month</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value={3}>3 months</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input className=\"input\" type=\"number\" min={0} value={createForm.prizeAmount} onChange={e=>setCreateForm((f:any)=>({ ...f, prizeAmount: Number(e.target.value) }))} />\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t<select className=\"input\" disabled={createForm.prizeType!=='cash'} value={createForm.currency} onChange={e=>setCreateForm((f:any)=>({ ...f, currency: e.target.value }))}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"GBP\">GBP</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"USD\">USD</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"EUR\">EUR</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"CAD\">CAD</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"AUD\">AUD</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<input className=\"input w-full\" placeholder=\"Prize notes (optional)\" value={createForm.prizeNotes} onChange={e=>setCreateForm((f:any)=>({ ...f, prizeNotes: e.target.value }))} />\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-end\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={createOfficialTournament}>Create</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"font-semibold mb-2\">Existing</div>\r\n\t\t\t\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t\t{tournaments.map((t:any)=> (\r\n\t\t\t\t\t\t\t\t\t\t\t<li key={t.id} className=\"p-2 rounded bg-black/20 text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{t.title}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{t.status}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-80\">{t.game} · {t.mode==='firstto'?'FT':'BO'} {t.value} · {new Date(t.startAt).toLocaleString()} · {t.capacity} cap</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{t.prize && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs mt-1\">Prize: {t.prizeType==='cash' && t.prizeAmount ? `${t.currency||'USD'} ${t.prizeAmount}` : `${t.prizeAmount || 3} month${(t.prizeAmount || 3) > 1 ? 's' : ''} PREMIUM`} {t.prizeType==='cash' && t.status==='completed' && t.payoutStatus && (<span className={`ml-2 px-1.5 py-0.5 rounded ${t.payoutStatus==='paid'?'bg-emerald-600':'bg-amber-600'}`}>{t.payoutStatus}</span>)}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-2 flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading || t.status!=='scheduled'} onClick={()=>setWinner(t.id, prompt('Winner email?')||'')}>Set Winner</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.prizeType==='cash' && t.status==='completed' && t.payoutStatus!=='paid' && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={()=>markPaid(t.id)}>Mark Paid</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t\t{tournaments.length===0 && <li className=\"opacity-60\">No tournaments.</li>}\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t<div className=\"mt-3 flex justify-end\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={reseedWeekly}>Reseed Weekly Giveaway</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{isOwner && (\r\n\t\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Email Templates</h3>\r\n\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Customize titles, intro lines, and button text. Previews open in a new tab or as a popup.</div>\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n\t\t\t\t\t\t\t\t<EmailEditor kind=\"reset\" label=\"Password reset\" />\r\n\t\t\t\t\t\t\t\t<EmailEditor kind=\"reminder\" label=\"Password reset reminder\" />\r\n\t\t\t\t\t\t\t\t<EmailEditor kind=\"confirm-email\" label=\"Confirm new email\" />\r\n\t\t\t\t\t\t\t\t<EmailEditor kind=\"changed\" label=\"Password changed notice\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\r\n\t\t\t{activeTab === 'maintenance' && isOwner && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">User Management</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Ban or unban users. Use with caution.</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"user@example.com\" value={userSearch} onChange={e=>setUserSearch(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={searchUsers}>Search</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{userResults.length > 0 && (\r\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Results:</div>\r\n\t\t\t\t\t\t\t\t{userResults.map((u)=> (\r\n\t\t\t\t\t\t\t\t\t<div key={u.email} className=\"p-2 rounded bg-black/20 text-sm flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{u.name || 'No name'}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{u.email}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-60 text-xs\">Joined {new Date(u.createdAt).toLocaleDateString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-red-600 hover:bg-red-700 text-xs\" onClick={()=>banUser(u.email)}>Ban</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-green-600 hover:bg-green-700 text-xs\" onClick={()=>unbanUser(u.email)}>Unban</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Withdrawals</h3>\r\n\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{withdrawals.map((w:any) => (\r\n\t\t\t\t\t\t\t\t<li key={w.id} className=\"p-2 rounded bg-black/20 text-sm flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-mono text-xs\">{w.id}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div>{w.email} · {w.currency} {(w.amountCents/100).toFixed(2)}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{w.status} · {new Date(w.requestedAt).toLocaleString()}</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t{w.status==='pending' && (\r\n\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-emerald-600 hover:bg-emerald-700\" disabled={loading} onClick={()=>decideWithdrawal(w.id, true)}>Approve</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={()=>decideWithdrawal(w.id, false)}>Reject</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{withdrawals.length===0 && <li className=\"opacity-60\">No withdrawal requests.</li>}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">System Health</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Current status of system components and services.</div>\r\n\t\t\t\t\t\t{systemHealth ? (\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Database</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.database ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.database ? 'Ready' : 'Down'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>WebSocket</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.websocket ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.websocket ? 'Ready' : 'Down'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>HTTPS</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.https ? 'bg-emerald-600' : 'bg-amber-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.https ? 'Enabled' : 'HTTP Only'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Maintenance Mode</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${!systemHealth.maintenance ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{!systemHealth.maintenance ? 'Normal' : 'Active'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Uptime:</span> {Math.floor(systemHealth.uptime / 3600)}h {Math.floor((systemHealth.uptime % 3600) / 60)}m\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Memory:</span> {Math.round(systemHealth.memory.heapUsed / 1024 / 1024)}MB used\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Version:</span> {systemHealth.version}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 mt-3\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={fetchSystemHealth}>Refresh</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className=\"text-center py-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-60 mb-2\">Loading system health...</div>\r\n\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={fetchSystemHealth}>Load Health Status</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">User Reports</h3>\r\n\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{reports.map((r:any)=> (\r\n\t\t\t\t\t\t\t\t<li key={r.id} className=\"p-2 rounded bg-black/20 text-sm\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-mono text-xs\">{r.id}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div><span className=\"font-semibold\">{r.reporter}</span> → <span className=\"font-semibold\">{r.offender}</span> · {new Date(r.ts).toLocaleString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-80\">Reason: {r.reason}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t{r.messageId && <div className=\"opacity-60 text-xs\">Message ID: {r.messageId}</div>}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-0.5 rounded text-xs ${r.status==='open'?'bg-amber-600':'bg-emerald-600'}`}>{r.status}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t{r.status==='open' && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-emerald-600 hover:bg-emerald-700\" disabled={loading} onClick={async()=>{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait fetch('/api/admin/reports/resolve', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ id: r.id, action: 'resolved', requesterEmail: user?.email }) })\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Resolve</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={async()=>{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst notes = prompt('Enter notes for action taken (e.g., warning, block):') || ''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait fetch('/api/admin/reports/resolve', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ id: r.id, action: 'actioned', notes, requesterEmail: user?.email }) })\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Action</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{reports.length===0 && <li className=\"opacity-60\">No reports.</li>}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">System Health</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Current status of system components and services.</div>\r\n\t\t\t\t\t\t{systemHealth ? (\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Database</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.database ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.database ? 'Ready' : 'Down'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>WebSocket</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.websocket ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.websocket ? 'Ready' : 'Down'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>HTTPS</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.https ? 'bg-emerald-600' : 'bg-amber-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.https ? 'Enabled' : 'HTTP Only'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Maintenance Mode</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${!systemHealth.maintenance ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{!systemHealth.maintenance ? 'Normal' : 'Active'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Uptime:</span> {Math.floor(systemHealth.uptime / 3600)}h {Math.floor((systemHealth.uptime % 3600) / 60)}m\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Memory:</span> {Math.round(systemHealth.memory.heapUsed / 1024 / 1024)}MB used\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Version:</span> {systemHealth.version}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 mt-3\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={fetchSystemHealth}>Refresh</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className=\"text-center py-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-60 mb-2\">Loading system health...</div>\r\n\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={fetchSystemHealth}>Load Health Status</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Open Matches</h3>\r\n\t\t\t\t\t\t<ul className=\"space-y-1\">\r\n\t\t\t\t\t\t\t{(status?.matches || []).map((m: any) => (\r\n\t\t\t\t\t\t\t\t<li key={m.id} className=\"flex items-center justify-between p-2 rounded bg-black/20 text-sm\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-mono text-xs\">{m.id}</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"opacity-80\">{m.creatorName}</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"opacity-60\">{m.game} {m.mode==='firstto'?'FT':'BO'} {m.value} {m.game==='X01'?`/${m.startingScore}`:''}</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={()=>deleteMatch(m.id)}>Remove</button>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{(!status?.matches || status.matches.length === 0) && (\r\n\t\t\t\t\t\t\t\t<li className=\"text-sm opacity-60\">No open matches.</li>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Dangerous Operations</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3 text-red-400\">⚠️ These operations can cause data loss or service disruption. Use with extreme caution.</div>\r\n\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<div className=\"font-semibold mb-2 text-red-400\">Tournament Deletion</div>\r\n\t\t\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t{tournaments.map((t:any)=> (\r\n\t\t\t\t\t\t\t\t\t\t<li key={t.id} className=\"p-2 rounded bg-red-900/20 border border-red-500/40 text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{t.title}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{t.status}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-80\">{t.game} · {t.mode==='firstto'?'FT':'BO'} {t.value}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-red-600 hover:bg-red-700 text-xs\" disabled={loading} onClick={()=>deleteTournament(t.id)}>Delete Tournament</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t{tournaments.length===0 && <li className=\"opacity-60\">No tournaments.</li>}\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<div className=\"font-semibold mb-2 text-red-400\">System Maintenance</div>\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"p-3 rounded bg-red-900/20 border border-red-500/40\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold text-red-400 mb-2\">Maintenance Mode</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Put the entire site into maintenance mode. Users won't be able to access games or create matches.</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${status?.maintenance ? 'bg-red-600' : 'bg-green-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{status?.maintenance ? 'MAINTENANCE ACTIVE' : 'NORMAL OPERATION'}\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn ${status?.maintenance ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`} \r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={loading} \r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={()=>toggleMaintenance(!status?.maintenance)}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{status?.maintenance ? 'Disable' : 'Enable'}\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\r\n\t\t\t{activeTab === 'premium' && isOwner && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Premium Subscription Grants</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Grant or revoke premium subscriptions for users (grants 30 days).</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"user@example.com\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading || !email.trim()} onClick={() => grantPremium(email, 30)}>Grant</button>\r\n\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={() => revokePremium(email)}>Revoke</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Premium users get 30 days of access to all features.</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Premium Winners</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Users who have won premium through tournaments.</div>\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{winners.map((w: any) => (\r\n\t\t\t\t\t\t\t\t<div key={w.email} className=\"p-2 rounded bg-black/20 text-sm flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{w.name || 'No name'}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{w.email}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-60 text-xs\">Expires {new Date(w.expiresAt).toLocaleDateString()}</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t{!w.expired ? (\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-2 py-1 rounded bg-emerald-600 text-xs\">Premium Active</span>\r\n\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-2 py-1 rounded bg-amber-600 text-xs\">Premium Expired</span>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{winners.length === 0 && <div className=\"opacity-60\">No premium winners.</div>}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Inline email preview overlay */}\r\n\t\t\t{preview.open && (\r\n\t\t\t\t<div className=\"fixed inset-0 z-[1000]\" onClick={()=>setPreview({ open: false })}>\r\n\t\t\t\t\t<div className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\" />\r\n\t\t\t\t\t<div className=\"absolute inset-0 p-4 md:p-8 overflow-auto flex items-start md:items-center justify-center\">\r\n\t\t\t\t\t\t<div className=\"w-full max-w-3xl bg-[#0b1020] rounded-2xl border border-indigo-500/40 shadow-2xl\" onClick={e=>e.stopPropagation()}>\r\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20\">\r\n\t\t\t\t\t\t\t\t<div className=\"font-semibold\">Preview: {preview.kind}</div>\r\n\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={()=>setPreview({ open: false })}>Close</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"p-0 bg-black/30\">\r\n\t\t\t\t\t\t\t\t<iframe title=\"Email Preview\" style={{ width: '100%', height: '70vh', border: '0', background: 'transparent' }} srcDoc={preview.html || ''} />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"px-4 py-3 border-t border-indigo-500/20 text-xs opacity-70\">Click outside this panel or press Esc to close.</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t)\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { User, Settings, Volume2, Camera, Gamepad2, Eye, Mic, Save, Edit3, Shield, HelpCircle, MessageCircle, X, Send } from 'lucide-react';\r\nimport { useUserSettings } from '../store/userSettings';\r\nimport { apiFetch } from '../utils/api';\r\n\r\nexport default function SettingsPanel({ user }: { user?: any }) {\r\n  const {\r\n    favoriteDouble, callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, avgMode,\r\n    autoStartOffline, rememberLastOffline, reducedMotion, compactHeader, allowSpectate,\r\n    cameraScale, cameraAspect, autoscoreProvider, autoscoreWsUrl, calibrationGuide,\r\n    preferredCameraId, preferredCameraLabel, cameraEnabled, offlineLayout, textSize, boxSize,\r\n    setFavoriteDouble, setCallerEnabled, setCallerVoice, setCallerVolume, setSpeakCheckoutOnly,\r\n    setAvgMode, setAutoStartOffline, setRememberLastOffline, setReducedMotion, setCompactHeader,\r\n    setAllowSpectate, setCameraScale, setCameraAspect, setAutoscoreProvider, setAutoscoreWsUrl,\r\n    setCalibrationGuide, setPreferredCamera, setCameraEnabled, setOfflineLayout, setTextSize, setBoxSize\r\n  } = useUserSettings();\r\n\r\n  // Achievements state\r\n  const [achievements, setAchievements] = useState([\r\n    { key: 'first180', label: 'First 180', unlocked: false, icon: '🎯', desc: 'Score 180 in a match.' },\r\n    { key: 'hundredGames', label: '100 Games Played', unlocked: false, icon: '🏅', desc: 'Play 100 games.' },\r\n    { key: 'tournamentWin', label: 'Tournament Winner', unlocked: false, icon: '🥇', desc: 'Win a tournament.' },\r\n    { key: 'bestLeg', label: 'Best Leg', unlocked: false, icon: '⚡', desc: 'Finish a leg in 12 darts or less.' },\r\n    { key: 'comeback', label: 'Comeback', unlocked: false, icon: '🔥', desc: 'Win after trailing by 3 legs.' },\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const uname = user?.username || '';\r\n    if (!uname) return;\r\n    setAchievements(prev => prev.map(a => ({\r\n      ...a,\r\n      unlocked: !!localStorage.getItem(`ndn:achieve:${a.key}:${uname}`)\r\n    })));\r\n  }, [user?.username]);\r\n\r\n  // Profile bio fields with edit mode\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [favPlayer, setFavPlayer] = useState('');\r\n  const [favTeam, setFavTeam] = useState('');\r\n  const [favDarts, setFavDarts] = useState('');\r\n  const [bio, setBio] = useState('');\r\n  const [profilePhoto, setProfilePhoto] = useState('');\r\n  const [allowAnalytics, setAllowAnalytics] = useState(true);\r\n  const [subscription, setSubscription] = useState<any>(null);\r\n\r\n  // Help Assistant state\r\n  const [helpMessages, setHelpMessages] = useState<Array<{text: string | {text: string, links?: Array<{text: string, tab: string}>}, isUser: boolean}>>([\r\n    { text: \"Hi! I'm your Nine Dart Nation assistant. How can I help you today?\", isUser: false }\r\n  ]);\r\n  const [helpInput, setHelpInput] = useState('');\r\n\r\n  useEffect(() => {\r\n    const uname = user?.username || '';\r\n    if (!uname) return;\r\n    try {\r\n      setFavPlayer(localStorage.getItem(`ndn:bio:favPlayer:${uname}`) || '');\r\n      setFavTeam(localStorage.getItem(`ndn:bio:favTeam:${uname}`) || '');\r\n      setFavDarts(localStorage.getItem(`ndn:bio:favDarts:${uname}`) || '');\r\n      setBio(localStorage.getItem(`ndn:bio:bio:${uname}`) || '');\r\n      setProfilePhoto(localStorage.getItem(`ndn:bio:profilePhoto:${uname}`) || '');\r\n      setAllowAnalytics(localStorage.getItem(`ndn:settings:allowAnalytics:${uname}`) !== 'false');\r\n    } catch {}\r\n  }, [user?.username]);\r\n\r\n  useEffect(() => {\r\n    if (!user?.email) return;\r\n    apiFetch(`/api/subscription?email=${encodeURIComponent(user.email)}`)\r\n      .then(r => r.json())\r\n      .then(setSubscription)\r\n      .catch(() => {});\r\n  }, [user?.email]);\r\n\r\n  const saveBio = () => {\r\n    const uname = user?.username || '';\r\n    if (!uname) return;\r\n    try {\r\n      localStorage.setItem(`ndn:bio:favPlayer:${uname}`, favPlayer);\r\n      localStorage.setItem(`ndn:bio:favTeam:${uname}`, favTeam);\r\n      localStorage.setItem(`ndn:bio:favDarts:${uname}`, favDarts);\r\n      localStorage.setItem(`ndn:bio:bio:${uname}`, bio);\r\n      localStorage.setItem(`ndn:bio:profilePhoto:${uname}`, profilePhoto);\r\n      // Dispatch event to notify avatar update\r\n      try { window.dispatchEvent(new CustomEvent('ndn:avatar-updated', { detail: { username: uname, avatar: profilePhoto } })) } catch {}\r\n      localStorage.setItem(`ndn:settings:allowAnalytics:${uname}`, allowAnalytics.toString());\r\n      setIsEditing(false);\r\n    } catch {}\r\n  };\r\n\r\n  // Help Assistant functions\r\n  const faq = {\r\n    'how to play': 'To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.',\r\n    'calibration': 'Go to Settings > Camera & Vision > Calibration Guide to set up your camera properly.',\r\n    'premium': 'Premium unlocks all game modes. Click the \"Upgrade to PREMIUM\" button in online play.',\r\n    'username': 'Change your username once for free in Settings > Account.',\r\n    'voice': 'Enable voice caller in Settings > Audio & Voice. Test the voice with the Test Voice button.',\r\n    'friends': 'Add friends in the Friends tab to play together.',\r\n    'stats': 'View your statistics in the Stats tab.',\r\n    'settings': 'Customize your experience in the Settings panel.',\r\n    'support': 'Contact support via email or check the FAQ in Settings > Support.',\r\n  };\r\n\r\n  const navigateToTab = (tabKey: string) => {\r\n    try {\r\n      window.dispatchEvent(new CustomEvent('ndn:change-tab', { detail: { tab: tabKey } }));\r\n    } catch (error) {\r\n      console.error('Navigation failed:', error);\r\n    }\r\n  };\r\n\r\n  const getResponseWithLinks = (userMessage: string): { text: string, links?: Array<{ text: string, tab: string }> } => {\r\n    const message = userMessage.toLowerCase();\r\n\r\n    if (message.includes('username') || message.includes('change name')) {\r\n      return {\r\n        text: 'You can change your username once for free.',\r\n        links: [{ text: 'Go to Settings > Account', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('premium') || message.includes('upgrade') || message.includes('subscription')) {\r\n      return {\r\n        text: 'Premium unlocks all game modes and features.',\r\n        links: [{ text: 'Go to Online Play', tab: 'online' }]\r\n      };\r\n    }\r\n    if (message.includes('calibrat') || message.includes('camera') || message.includes('vision')) {\r\n      return {\r\n        text: 'Set up your camera properly in Settings.',\r\n        links: [{ text: 'Go to Settings > Camera & Vision', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('voice') || message.includes('caller') || message.includes('audio')) {\r\n      return {\r\n        text: 'Enable voice calling in Settings.',\r\n        links: [{ text: 'Go to Settings > Audio & Voice', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('friend') || message.includes('play together')) {\r\n      return {\r\n        text: 'Add friends to play together.',\r\n        links: [{ text: 'Go to Friends', tab: 'friends' }]\r\n      };\r\n    }\r\n    if (message.includes('stat') || message.includes('score') || message.includes('performance')) {\r\n      return {\r\n        text: 'View your statistics and performance.',\r\n        links: [{ text: 'Go to Stats', tab: 'stats' }]\r\n      };\r\n    }\r\n    if (message.includes('setting') || message.includes('customiz') || message.includes('configur')) {\r\n      return {\r\n        text: 'Customize your experience.',\r\n        links: [{ text: 'Go to Settings', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('tournament') || message.includes('competition')) {\r\n      return {\r\n        text: 'Check out tournaments and competitions.',\r\n        links: [{ text: 'Go to Tournaments', tab: 'tournaments' }]\r\n      };\r\n    }\r\n    if (message.includes('help') || message.includes('support') || message.includes('faq')) {\r\n      return {\r\n        text: 'You\\'re already in the help section! Check the Support section above for more resources.',\r\n        links: [{ text: 'Scroll to Support', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('how to play') || message.includes('game') || message.includes('start')) {\r\n      return {\r\n        text: 'To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.',\r\n        links: [\r\n          { text: 'Play Online', tab: 'online' },\r\n          { text: 'Play Offline', tab: 'offline' }\r\n        ]\r\n      };\r\n    }\r\n\r\n    return { text: \"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings.\" };\r\n  };\r\n\r\n  const handleHelpSend = () => {\r\n    if (!helpInput.trim()) return;\r\n    const userMessage = helpInput.toLowerCase();\r\n    setHelpMessages(prev => [...prev, { text: helpInput, isUser: true }]);\r\n    setHelpInput('');\r\n\r\n    // Get response with smart link suggestions\r\n    const response = getResponseWithLinks(userMessage);\r\n\r\n    setTimeout(() => {\r\n      setHelpMessages(prev => [...prev, { text: response, isUser: false }]);\r\n    }, 500);\r\n  };\r\n\r\n  // Username change state\r\n  const [newUsername, setNewUsername] = useState('')\r\n  const [changingUsername, setChangingUsername] = useState(false)\r\n  const [usernameError, setUsernameError] = useState('')\r\n\r\n  // Available voices for caller\r\n  const [availableVoices, setAvailableVoices] = useState<SpeechSynthesisVoice[]>([])\r\n\r\n  useEffect(() => {\r\n    const loadVoices = () => {\r\n      const voices = speechSynthesis.getVoices();\r\n      setAvailableVoices(voices.filter(v => v.lang.startsWith('en')));\r\n    };\r\n    loadVoices();\r\n    speechSynthesis.onvoiceschanged = loadVoices;\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Account Actions - Moved to top */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-red-500/40 bg-red-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2 text-black\">\r\n            <User className=\"w-5 h-5\" /> Account\r\n          </div>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex justify-center\">\r\n              <button\r\n                onClick={() => window.dispatchEvent(new CustomEvent('ndn:logout'))}\r\n                className=\"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\r\n              >\r\n                Logout\r\n              </button>\r\n            </div>\r\n            {/* Username Change */}\r\n            <div className=\"border-t border-red-500/20 pt-3\">\r\n              <div className=\"font-medium mb-2 text-black\">Change Username ({(() => {\r\n                const count = user?.usernameChangeCount || 0;\r\n                if (count < 2) return `${2 - count} free changes remaining`;\r\n                return '£2 per change';\r\n              })()})</div>\r\n              <div className=\"text-sm text-black mb-2\">You can change your username up to 2 times for free. Additional changes cost £2 each.</div>\r\n              {user?.usernameChangeCount >= 2 && !newUsername.trim() ? (\r\n                <div className=\"text-amber-400 text-sm mb-2\">⚠️ Additional username changes cost £2</div>\r\n              ) : null}\r\n              <input\r\n                className=\"input w-full mb-2\"\r\n                type=\"text\"\r\n                placeholder=\"New username\"\r\n                value={newUsername}\r\n                onChange={e => setNewUsername(e.target.value)}\r\n                disabled={changingUsername}\r\n              />\r\n              {usernameError && <div className=\"text-red-400 text-sm mb-2\">{usernameError}</div>}\r\n              <button\r\n                onClick={async () => {\r\n                  setUsernameError('')\r\n                  if (!newUsername.trim()) {\r\n                    setUsernameError('Username required')\r\n                    return\r\n                  }\r\n                  if (newUsername.length < 3 || newUsername.length > 20) {\r\n                    setUsernameError('Username must be 3-20 characters')\r\n                    return\r\n                  }\r\n                  const currentCount = user?.usernameChangeCount || 0;\r\n                  const isFree = currentCount < 2;\r\n                  \r\n                  if (!isFree) {\r\n                    // Charge £2 for additional changes\r\n                    window.location.href = 'https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02'\r\n                  } else {\r\n                    // Free change - store the new username for after processing\r\n                    localStorage.setItem('pendingUsernameChange', newUsername.trim())\r\n                    // For free changes, we might need to handle this differently\r\n                    // For now, redirect to a free processing endpoint or handle locally\r\n                    window.location.href = '/?username-change=free'\r\n                  }\r\n                }}\r\n                disabled={changingUsername || !newUsername.trim()}\r\n                className=\"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors\"\r\n              >\r\n                {changingUsername ? 'Processing...' : (() => {\r\n                  const count = user?.usernameChangeCount || 0;\r\n                  return count < 2 ? 'Change Username (FREE)' : 'Change Username (£2)';\r\n                })()}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Premium Management */}\r\n      {subscription && (\r\n        <div className=\"card\">\r\n          <div className=\"p-3 rounded-xl border border-green-500/40 bg-green-500/10\">\r\n            <div className=\"font-semibold mb-4 flex items-center gap-2 text-black\">\r\n              <Shield className=\"w-5 h-5\" /> Premium\r\n            </div>\r\n            <div className=\"space-y-3\">\r\n              <div className=\"text-sm\">\r\n                <div className=\"font-medium\">Status: {subscription.fullAccess ? 'Active' : 'Inactive'}</div>\r\n                {subscription.source && <div className=\"text-xs opacity-80\">Source: {subscription.source}</div>}\r\n                {subscription.expiresAt && (\r\n                  <div className=\"text-xs opacity-80\">\r\n                    Expires: {new Date(subscription.expiresAt).toLocaleDateString()}\r\n                  </div>\r\n                )}\r\n                {subscription.renewalWarning && (\r\n                  <div className=\"text-amber-600 text-xs mt-2 p-2 bg-amber-100 rounded\">\r\n                    ⚠️ {subscription.renewalWarning}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              {subscription.source === 'tournament' && (\r\n                <div className=\"flex justify-center\">\r\n                  <button\r\n                    onClick={async () => {\r\n                      if (confirm('Are you sure you want to cancel your premium subscription? You will lose access to premium features.')) {\r\n                        try {\r\n                          await apiFetch('/api/admin/premium/revoke', {\r\n                            method: 'POST',\r\n                            headers: { 'Content-Type': 'application/json' },\r\n                            body: JSON.stringify({ email: user.email, requesterEmail: user.email })\r\n                          });\r\n                          // Refresh subscription\r\n                          const res = await apiFetch(`/api/subscription?email=${encodeURIComponent(user.email)}`);\r\n                          setSubscription(await res.json());\r\n                        } catch (error) {\r\n                          alert('Failed to cancel premium. Please try again.');\r\n                        }\r\n                      }\r\n                    }}\r\n                    className=\"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\r\n                  >\r\n                    Cancel Premium\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Profile Bio Section */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <div className=\"font-semibold flex items-center gap-2\">\r\n              <User className=\"w-5 h-5 text-brand-400\" /> Profile Bio\r\n            </div>\r\n            {!isEditing ? (\r\n              <button\r\n                onClick={() => setIsEditing(true)}\r\n                className=\"flex items-center gap-2 px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400 text-sm transition-colors\"\r\n              >\r\n                <Edit3 className=\"w-4 h-4\" /> Edit\r\n              </button>\r\n            ) : (\r\n              <button\r\n                onClick={saveBio}\r\n                className=\"flex items-center gap-2 px-3 py-1 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400 text-sm transition-colors\"\r\n              >\r\n                <Save className=\"w-4 h-4\" /> Save\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-3\">\r\n            <div>\r\n              <label className=\"block mb-1 text-sm font-medium\">Favourite Player:</label>\r\n              {isEditing ? (\r\n                <input\r\n                  className=\"input w-full\"\r\n                  type=\"text\"\r\n                  value={favPlayer}\r\n                  onChange={e => setFavPlayer(e.target.value)}\r\n                  placeholder=\"e.g. Michael van Gerwen\"\r\n                />\r\n              ) : (\r\n                <div className=\"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center\">\r\n                  {favPlayer || 'Not set'}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-1 text-sm font-medium\">Favourite Football Team:</label>\r\n              {isEditing ? (\r\n                <input\r\n                  className=\"input w-full\"\r\n                  type=\"text\"\r\n                  value={favTeam}\r\n                  onChange={e => setFavTeam(e.target.value)}\r\n                  placeholder=\"e.g. Manchester United\"\r\n                />\r\n              ) : (\r\n                <div className=\"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center\">\r\n                  {favTeam || 'Not set'}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-1 text-sm font-medium\">Favourite Darts:</label>\r\n              {isEditing ? (\r\n                <input\r\n                  className=\"input w-full\"\r\n                  type=\"text\"\r\n                  value={favDarts}\r\n                  onChange={e => setFavDarts(e.target.value)}\r\n                  placeholder=\"e.g. Unicorn Phase 5, 24g\"\r\n                />\r\n              ) : (\r\n                <div className=\"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center\">\r\n                  {favDarts || 'Not set'}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-1 text-sm font-medium\">Short Bio / Quote:</label>\r\n              {isEditing ? (\r\n                <textarea\r\n                  className=\"input w-full\"\r\n                  value={bio}\r\n                  onChange={e => setBio(e.target.value)}\r\n                  placeholder=\"Write something about yourself...\"\r\n                  rows={3}\r\n                />\r\n              ) : (\r\n                <div className=\"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[4rem] flex items-start\">\r\n                  {bio || 'No bio set'}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Profile Photo */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10\">\r\n          <div className=\"font-semibold mb-2 flex items-center gap-2\">\r\n            <User className=\"w-5 h-5 text-cyan-400\" /> Profile Photo\r\n          </div>\r\n          <div>\r\n            {profilePhoto && (\r\n              <div className=\"mb-2\">\r\n                <img src={profilePhoto} alt=\"Profile\" className=\"w-16 h-16 rounded-full object-cover\" />\r\n              </div>\r\n            )}\r\n            <input\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              onChange={(e) => {\r\n                const file = e.target.files?.[0];\r\n                if (file) {\r\n                  const reader = new FileReader();\r\n                  reader.onload = (event) => {\r\n                    const photoData = event.target?.result as string;\r\n                    setProfilePhoto(photoData);\r\n                    // Immediately save to localStorage and update avatar in header\r\n                    const uname = user?.username || '';\r\n                    if (uname) {\r\n                      localStorage.setItem(`ndn:bio:profilePhoto:${uname}`, photoData);\r\n                    }\r\n                    try { window.dispatchEvent(new CustomEvent('ndn:avatar-updated', { detail: { username: uname, avatar: photoData } })) } catch {}\r\n                  };\r\n                  reader.readAsDataURL(file);\r\n                }\r\n              }}\r\n              className=\"hidden\"\r\n              id=\"profile-photo-upload\"\r\n            />\r\n            <label htmlFor=\"profile-photo-upload\" className=\"btn bg-cyan-600 hover:bg-cyan-700 cursor-pointer\">\r\n              {profilePhoto ? 'Change Photo' : 'Upload Photo'}\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Game Preferences */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-green-500/40 bg-green-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <Gamepad2 className=\"w-5 h-5 text-green-400\" /> Game Preferences\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">Favourite Double:</label>\r\n              <select\r\n                className=\"input w-full\"\r\n                value={favoriteDouble}\r\n                onChange={e => setFavoriteDouble(e.target.value)}\r\n              >\r\n                <option value=\"any\">Any Double</option>\r\n                <option value=\"D20\">Double 20</option>\r\n                <option value=\"D19\">Double 19</option>\r\n                <option value=\"D18\">Double 18</option>\r\n                <option value=\"D17\">Double 17</option>\r\n                <option value=\"D16\">Double 16</option>\r\n                <option value=\"D15\">Double 15</option>\r\n                <option value=\"D14\">Double 14</option>\r\n                <option value=\"D13\">Double 13</option>\r\n                <option value=\"D12\">Double 12</option>\r\n                <option value=\"D11\">Double 11</option>\r\n                <option value=\"D10\">Double 10</option>\r\n                <option value=\"D9\">Double 9</option>\r\n                <option value=\"D8\">Double 8</option>\r\n                <option value=\"D7\">Double 7</option>\r\n                <option value=\"D6\">Double 6</option>\r\n                <option value=\"D5\">Double 5</option>\r\n                <option value=\"D4\">Double 4</option>\r\n                <option value=\"D3\">Double 3</option>\r\n                <option value=\"D2\">Double 2</option>\r\n                <option value=\"D1\">Double 1</option>\r\n                <option value=\"DB\">Bullseye</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">Average Display Mode:</label>\r\n              <select\r\n                className=\"input w-full\"\r\n                value={avgMode}\r\n                onChange={e => setAvgMode(e.target.value as 'all-time' | '24h')}\r\n              >\r\n                <option value=\"all-time\">All Time Average</option>\r\n                <option value=\"24h\">24 Hour Average</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"autoStartOffline\"\r\n                checked={autoStartOffline}\r\n                onChange={e => setAutoStartOffline(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"autoStartOffline\" className=\"text-sm\">Auto-start offline games</label>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"rememberLastOffline\"\r\n                checked={rememberLastOffline}\r\n                onChange={e => setRememberLastOffline(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"rememberLastOffline\" className=\"text-sm\">Remember last offline game settings</label>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">Offline Game Layout:</label>\r\n              <select\r\n                className=\"input w-full\"\r\n                value={offlineLayout || 'classic'}\r\n                onChange={e => setOfflineLayout(e.target.value as 'classic' | 'modern')}\r\n              >\r\n                <option value=\"classic\">Classic Layout</option>\r\n                <option value=\"modern\">Modern Layout</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Audio & Voice Settings */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <Volume2 className=\"w-5 h-5 text-purple-400\" /> Audio & Voice\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"callerEnabled\"\r\n                checked={callerEnabled}\r\n                onChange={e => setCallerEnabled(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"callerEnabled\" className=\"text-sm font-medium\">Enable Voice Caller</label>\r\n            </div>\r\n\r\n            {callerEnabled && (\r\n              <>\r\n                <div>\r\n                  <label className=\"block mb-2 text-sm font-medium\">Voice:</label>\r\n                  <select\r\n                    className=\"input w-full\"\r\n                    value={callerVoice}\r\n                    onChange={e => setCallerVoice(e.target.value)}\r\n                  >\r\n                    {availableVoices.map(voice => (\r\n                      <option key={voice.name} value={voice.name}>\r\n                        {voice.name} ({voice.lang})\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  <button\r\n                    onClick={() => {\r\n                      const utterance = new SpeechSynthesisUtterance('Test voice: 180 scored!');\r\n                      utterance.voice = availableVoices.find(v => v.name === callerVoice) || null;\r\n                      utterance.volume = callerVolume;\r\n                      speechSynthesis.speak(utterance);\r\n                    }}\r\n                    className=\"btn bg-blue-600 hover:bg-blue-700 mt-2\"\r\n                  >\r\n                    Test Voice\r\n                  </button>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block mb-2 text-sm font-medium\">Volume: {Math.round(callerVolume * 100)}%</label>\r\n                  <input\r\n                    type=\"range\"\r\n                    min=\"0\"\r\n                    max=\"1\"\r\n                    step=\"0.1\"\r\n                    value={callerVolume}\r\n                    onChange={e => setCallerVolume(parseFloat(e.target.value))}\r\n                    className=\"w-full\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"speakCheckoutOnly\"\r\n                    checked={speakCheckoutOnly}\r\n                    onChange={e => setSpeakCheckoutOnly(e.target.checked)}\r\n                    className=\"w-4 h-4\"\r\n                  />\r\n                  <label htmlFor=\"speakCheckoutOnly\" className=\"text-sm\">Only announce checkouts</label>\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Camera & Vision Settings */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <Camera className=\"w-5 h-5 text-blue-400\" /> Camera & Vision\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"cameraEnabled\"\r\n                checked={cameraEnabled}\r\n                onChange={e => setCameraEnabled(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"cameraEnabled\" className=\"text-sm\">Enable camera for scoring</label>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">Camera Scale: {cameraScale.toFixed(2)}x</label>\r\n              <input\r\n                type=\"range\"\r\n                min=\"0.5\"\r\n                max=\"1.25\"\r\n                step=\"0.05\"\r\n                value={cameraScale}\r\n                onChange={e => setCameraScale(parseFloat(e.target.value))}\r\n                className=\"w-full\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">Camera Aspect Ratio:</label>\r\n              <select\r\n                className=\"input w-full\"\r\n                value={cameraAspect || 'wide'}\r\n                onChange={e => setCameraAspect(e.target.value as 'wide' | 'square')}\r\n              >\r\n                <option value=\"wide\">Wide (16:9)</option>\r\n                <option value=\"square\">Square (1:1)</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">Text Size:</label>\r\n              <select\r\n                className=\"input w-full\"\r\n                value={textSize}\r\n                onChange={e => setTextSize(e.target.value as 'small' | 'medium' | 'large')}\r\n              >\r\n                <option value=\"small\">Small</option>\r\n                <option value=\"medium\">Medium</option>\r\n                <option value=\"large\">Large</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">Box Size:</label>\r\n              <select\r\n                className=\"input w-full\"\r\n                value={boxSize}\r\n                onChange={e => setBoxSize(e.target.value as 'small' | 'medium' | 'large')}\r\n              >\r\n                <option value=\"small\">Small</option>\r\n                <option value=\"medium\">Medium</option>\r\n                <option value=\"large\">Large</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"calibrationGuide\"\r\n                checked={calibrationGuide}\r\n                onChange={e => setCalibrationGuide(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"calibrationGuide\" className=\"text-sm\">Show calibration guide</label>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">Autoscore Provider:</label>\r\n              <select\r\n                className=\"input w-full\"\r\n                value={autoscoreProvider || 'built-in'}\r\n                onChange={e => setAutoscoreProvider(e.target.value as 'built-in' | 'external-ws' | 'manual')}\r\n              >\r\n                <option value=\"built-in\">Built-in Vision</option>\r\n                <option value=\"manual\">Manual scoring only</option>\r\n                <option value=\"external-ws\">External WebSocket</option>\r\n              </select>\r\n            </div>\r\n\r\n            {autoscoreProvider === 'manual' && (\r\n              <div className=\"text-xs opacity-70\">\r\n                Camera previews and autoscore overlays are hidden while manual scoring is selected. Use the score inputs or keyboard shortcuts to record each visit.\r\n              </div>\r\n            )}\r\n\r\n            {autoscoreProvider === 'external-ws' && (\r\n              <div>\r\n                <label className=\"block mb-2 text-sm font-medium\">External WebSocket URL:</label>\r\n                <input\r\n                  className=\"input w-full\"\r\n                  type=\"url\"\r\n                  value={autoscoreWsUrl || ''}\r\n                  onChange={e => setAutoscoreWsUrl(e.target.value)}\r\n                  placeholder=\"ws://localhost:8080\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* UI & Accessibility */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-orange-500/40 bg-orange-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <Eye className=\"w-5 h-5 text-orange-400\" /> UI & Accessibility\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"reducedMotion\"\r\n                checked={reducedMotion}\r\n                onChange={e => setReducedMotion(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"reducedMotion\" className=\"text-sm\">Reduce motion/animations</label>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"compactHeader\"\r\n                checked={compactHeader}\r\n                onChange={e => setCompactHeader(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"compactHeader\" className=\"text-sm\">Compact header layout</label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Online & Social */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-pink-500/40 bg-pink-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <Mic className=\"w-5 h-5 text-pink-400\" /> Online & Social\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"allowSpectate\"\r\n                checked={allowSpectate}\r\n                onChange={e => setAllowSpectate(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"allowSpectate\" className=\"text-sm\">Allow others to spectate my games</label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Achievements & Badges Section */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2 text-yellow-700\">\r\n            <Settings className=\"w-5 h-5\" /> Achievements & Badges\r\n          </div>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            {achievements.map(a => (\r\n              <div key={a.key} className={`flex flex-col items-center p-3 rounded-xl border ${a.unlocked ? 'border-emerald-400 bg-emerald-500/10' : 'border-slate-400 bg-slate-700/10'}`}>\r\n                <div className=\"text-3xl mb-2\">{a.icon}</div>\r\n                <div className={`font-bold mb-1 text-center ${a.unlocked ? 'text-emerald-400' : 'text-slate-400'}`}>{a.label}</div>\r\n                <div className=\"text-xs text-slate-300 text-center mb-2\">{a.desc}</div>\r\n                {!a.unlocked && <div className=\"text-xs text-amber-400 font-medium\">🔒 Locked</div>}\r\n                {a.unlocked && <div className=\"text-xs text-emerald-400 font-medium\">✅ Unlocked!</div>}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Data & Privacy */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-gray-500/40 bg-gray-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <Settings className=\"w-5 h-5 text-gray-400\" /> Data & Privacy\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"allowAnalytics\"\r\n                checked={allowAnalytics}\r\n                onChange={e => setAllowAnalytics(e.target.checked)}\r\n                className=\"w-4 h-4\"\r\n              />\r\n              <label htmlFor=\"allowAnalytics\" className=\"text-sm\">Allow anonymous usage analytics</label>\r\n            </div>\r\n\r\n            <div>\r\n              <button\r\n                onClick={() => {\r\n                  // Export user data\r\n                  const data = {\r\n                    username: user?.username,\r\n                    email: user?.email,\r\n                    favPlayer,\r\n                    favTeam,\r\n                    favDarts,\r\n                    bio,\r\n                    profilePhoto,\r\n                    settings: {\r\n                      favoriteDouble,\r\n                      avgMode,\r\n                      autoStartOffline,\r\n                      rememberLastOffline,\r\n                      reducedMotion,\r\n                      compactHeader,\r\n                      allowSpectate,\r\n                      cameraScale,\r\n                      cameraAspect,\r\n                      autoscoreProvider,\r\n                      autoscoreWsUrl,\r\n                      calibrationGuide,\r\n                      callerEnabled,\r\n                      callerVoice,\r\n                      callerVolume,\r\n                      speakCheckoutOnly,\r\n                      textSize\r\n                    }\r\n                  };\r\n                  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\r\n                  const url = URL.createObjectURL(blob);\r\n                  const a = document.createElement('a');\r\n                  a.href = url;\r\n                  a.download = 'ninedartnation-data.json';\r\n                  a.click();\r\n                  URL.revokeObjectURL(url);\r\n                }}\r\n                className=\"btn bg-blue-600 hover:bg-blue-700\"\r\n              >\r\n                Export My Data\r\n              </button>\r\n            </div>\r\n\r\n            <div>\r\n              <button\r\n                onClick={() => {\r\n                  if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {\r\n                    // TODO: Implement account deletion\r\n                    alert('Account deletion not yet implemented. Please contact support.');\r\n                  }\r\n                }}\r\n                className=\"btn bg-red-600 hover:bg-red-700\"\r\n              >\r\n                Delete Account\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Privacy & Copyright Warning */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-red-500/40 bg-red-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <Shield className=\"w-5 h-5 text-red-400\" /> Privacy & Copyright Notice\r\n          </div>\r\n\r\n          <div className=\"space-y-3 text-sm text-slate-300\">\r\n            <div className=\"bg-red-500/20 border border-red-500/30 rounded-lg p-3\">\r\n              <p className=\"font-semibold text-red-300 mb-2\">⚠️ IMPORTANT LEGAL NOTICE</p>\r\n              <p className=\"mb-2\">\r\n                <strong>Copyright Protection:</strong> All code, assets, and intellectual property in Nine Dart Nation are protected by copyright law.\r\n                Unauthorized copying, modification, or distribution of this software is strictly prohibited.\r\n              </p>\r\n              <p className=\"mb-2\">\r\n                <strong>Legal Consequences:</strong> Any attempt to edit, reverse-engineer, or redistribute this code will result in immediate legal action,\r\n                including but not limited to copyright infringement lawsuits and potential criminal charges.\r\n              </p>\r\n              <p>\r\n                <strong>Privacy:</strong> Your personal data and gameplay information are protected. Any unauthorized access or data collection\r\n                violates privacy laws and will be prosecuted to the full extent of the law.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Support */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-teal-500/40 bg-teal-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <Settings className=\"w-5 h-5 text-teal-400\" /> Support & Help\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <p className=\"text-sm text-slate-300 mb-2\">Need help? Contact us:</p>\r\n              <a href=\"mailto:support@ninedartnation.com\" className=\"btn bg-teal-600 hover:bg-teal-700\">\r\n                Email Support\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Help Assistant */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <HelpCircle className=\"w-5 h-5 text-blue-400\" /> Help Assistant\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            {/* Chat Messages */}\r\n            <div className=\"bg-slate-800 rounded-lg p-4 max-h-96 overflow-y-auto space-y-3\">\r\n              {helpMessages.map((msg, i) => (\r\n                <div key={i} className={`flex ${msg.isUser ? 'justify-end' : 'justify-start'}`}>\r\n                  <div className={`max-w-xs px-3 py-2 rounded-lg ${\r\n                    msg.isUser \r\n                      ? 'bg-blue-600 text-white' \r\n                      : 'bg-slate-700 text-slate-200'\r\n                  }`}>\r\n                    {typeof msg.text === 'string' ? (\r\n                      msg.text\r\n                    ) : (\r\n                      <div className=\"space-y-2\">\r\n                        <div>{msg.text.text}</div>\r\n                        {msg.text.links && (\r\n                          <div className=\"space-y-1\">\r\n                            {msg.text.links.map((link, linkIndex) => (\r\n                              <button\r\n                                key={linkIndex}\r\n                                onClick={() => navigateToTab(link.tab)}\r\n                                className=\"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm\"\r\n                              >\r\n                                {link.text}\r\n                              </button>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Input */}\r\n            <div className=\"flex gap-2\">\r\n              <input\r\n                type=\"text\"\r\n                value={helpInput}\r\n                onChange={(e) => setHelpInput(e.target.value)}\r\n                onKeyPress={(e) => e.key === 'Enter' && handleHelpSend()}\r\n                placeholder=\"Ask me anything...\"\r\n                className=\"flex-1 input\"\r\n              />\r\n              <button\r\n                onClick={handleHelpSend}\r\n                className=\"btn bg-blue-600 hover:bg-blue-700\"\r\n              >\r\n                <Send className=\"w-4 h-4\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n}","import { useState } from 'react';\r\nimport { Eye, EyeOff, Trophy, Users, BarChart3, ShieldCheck, MessageCircle } from 'lucide-react';\r\n\r\n// Demo-only admin credentials. Allow build-time override via Vite env vars so\r\n// deployments (e.g., Netlify) can set their own values without editing code.\r\n// SECURITY NOTE: These live in the client bundle and are NOT secure; for demo only.\r\nconst ADMIN_EMAIL = ((import.meta as any).env?.VITE_ADMIN_EMAIL as string) || 'daviesfamily108@gmail.com';\r\nconst ADMIN_USERNAME = ((import.meta as any).env?.VITE_ADMIN_USERNAME as string) || 'DartsWithG';\r\nconst ADMIN_PASSWORD = ((import.meta as any).env?.VITE_ADMIN_PASSWORD as string) || 'Cymru-2015';\r\n\r\nfunction validatePassword(password: string) {\r\n  return password.length >= 10 && /\\d/.test(password) && /[^A-Za-z0-9]/.test(password);\r\n}\r\n\r\nexport default function Auth({ onAuth }: { onAuth: (user: any) => void }) {\r\n  const [mode, setMode] = useState<'signin' | 'signup' | 'reset'>('signin');\r\n  const [email, setEmail] = useState('');\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [reminder, setReminder] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Use VITE_API_URL for API requests, fallback to relative path for local dev\r\n  const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n\r\n  async function handleSignIn(e: any) {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    if (!username || !password) {\r\n      setError('Username and password required.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    try {\r\n      const res = await fetch(`${API_URL}/api/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ username, password })\r\n      });\r\n      const data = await res.json();\r\n      if (res.ok && data?.user && data?.token) {\r\n        localStorage.setItem('authToken', data.token);\r\n        onAuth(data.user);\r\n      } else {\r\n        setError(data?.error || 'Invalid username or password.');\r\n      }\r\n    } catch {\r\n      setError('Network error.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSignUp(e: any) {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    if (!email || !username || !password) {\r\n      setError('Email, username, and password required.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    try {\r\n      const res = await fetch(`${API_URL}/api/auth/signup`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, username, password })\r\n      });\r\n      const data = await res.json();\r\n      if (res.ok && data?.user && data?.token) {\r\n        localStorage.setItem('authToken', data.token);\r\n        onAuth(data.user);\r\n      } else {\r\n        setError(data?.error || 'Signup failed.');\r\n      }\r\n    } catch {\r\n      setError('Network error.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleReset(e: any) {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    if (!email || !email.includes('@')) { setError('Enter your email address.'); setLoading(false); return }\r\n    try {\r\n      const r = await fetch(`${API_URL}/api/auth/send-reset`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email }) })\r\n      const j = await r.json()\r\n      if (!j?.ok) throw new Error(j?.error || 'Failed to send reset email')\r\n      setError('Password reset link sent to your email.');\r\n    } catch (err: any) {\r\n      setError(err?.message || 'Failed to send reset email');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSendUsername(e: any) {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    if (!email || !email.includes('@')) { setError('Enter your email address.'); setLoading(false); return }\r\n    try {\r\n      const r = await fetch(`${API_URL}/api/auth/send-username`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email }) })\r\n      const j = await r.json()\r\n      if (!j?.ok) throw new Error(j?.error || 'Failed to send username email')\r\n      setError('Your username has been emailed to you.');\r\n    } catch (err: any) {\r\n      setError(err?.message || 'Failed to send username email');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center relative overflow-hidden\">\r\n      {/* Animated background accents */}\r\n      <div className=\"background-animated\" />\r\n      <div className=\"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 p-4\">\r\n        {/* Auth Card */}\r\n        <form className=\"card w-full space-y-4\" onSubmit={mode === 'signin' ? handleSignIn : mode === 'signup' ? handleSignUp : handleReset}>\r\n          <div className=\"flex flex-col items-center justify-center gap-2 mb-2 text-center\">\r\n            <h1 className=\"logo text-center\">NINE-DART-NATION 🎯</h1>\r\n            <span className=\"badge\">Welcome</span>\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold\">{mode === 'signin' ? 'Sign In' : mode === 'signup' ? 'Create Account' : 'Reset Password'}</h2>\r\n          {(mode === 'signup' || mode === 'reset') && (\r\n            <input className=\"input w-full\" type=\"email\" placeholder=\"Email\" value={email} onChange={e => setEmail(e.target.value)} required />\r\n          )}\r\n          {mode !== 'reset' && (\r\n            <input className=\"input w-full\" type=\"text\" placeholder=\"Username\" value={username} onChange={e => setUsername(e.target.value)} required />\r\n          )}\r\n          {mode !== 'reset' && (\r\n            <div className=\"relative\">\r\n              <input\r\n                className=\"input w-full pr-10\"\r\n                type={showPassword ? 'text' : 'password'}\r\n                placeholder=\"Password\"\r\n                value={password}\r\n                onChange={e => setPassword(e.target.value)}\r\n                autoComplete=\"current-password\"\r\n                required\r\n                onFocus={() => setShowPassword(false)}\r\n                onBlur={() => setShowPassword(false)}\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white\"\r\n                tabIndex={-1}\r\n                onMouseDown={e => { e.preventDefault(); setShowPassword(true); }}\r\n                onMouseUp={e => { e.preventDefault(); setShowPassword(false); }}\r\n                onMouseLeave={() => setShowPassword(false)}\r\n                onTouchStart={e => { e.preventDefault(); setShowPassword(true); }}\r\n                onTouchEnd={e => { e.preventDefault(); setShowPassword(false); }}\r\n                aria-label=\"Toggle password visibility\"\r\n              >\r\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n              </button>\r\n            </div>\r\n          )}\r\n          {mode === 'signup' && (\r\n            <input className=\"input w-full\" type=\"text\" placeholder=\"Password Reminder (optional)\" value={reminder} onChange={e => setReminder(e.target.value)} />\r\n          )}\r\n          {error && <div className=\"text-red-400 font-semibold text-sm\">{error}</div>}\r\n          <button className=\"btn w-full\" type=\"submit\" disabled={loading}>{loading ? 'Signing In...' : (mode === 'signin' ? 'Sign In' : mode === 'signup' ? 'Sign Up' : 'Send Reset Link')}</button>\r\n          {mode === 'reset' && (\r\n            <button className=\"btn w-full mt-2 bg-white/10 hover:bg-white/20\" type=\"button\" onClick={handleSendUsername} disabled={loading}>Email me my username</button>\r\n          )}\r\n          <div className=\"flex justify-between text-sm mt-2\">\r\n            <button type=\"button\" className=\"underline\" onClick={() => setMode(mode === 'signin' ? 'signup' : 'signin')} disabled={loading}>{mode === 'signin' ? 'Need an account? Sign Up' : 'Already have an account? Sign In'}</button>\r\n            <button type=\"button\" className=\"underline\" onClick={() => setMode('reset')} disabled={loading}>Forgot password?</button>\r\n          </div>\r\n          <div className=\"text-xs text-slate-200/80\">\r\n            Tip: Use the admin demo credentials to explore admin features.\r\n          </div>\r\n        </form>\r\n\r\n        {/* Hints / Teaser Panel */}\r\n        <aside className=\"card w-full\">\r\n          <h3 className=\"text-xl font-bold mb-3\">What’s inside</h3>\r\n          <ul className=\"space-y-3\">\r\n            <li className=\"flex items-start gap-3\"><Users className=\"w-5 h-5 text-indigo-300 mt-1\" />\r\n              <div>\r\n                <div className=\"font-semibold\">Online & Friends</div>\r\n                <div className=\"text-sm text-slate-200/90\">Challenge friends, chat, and join leagues.</div>\r\n              </div>\r\n            </li>\r\n            <li className=\"flex items-start gap-3\"><BarChart3 className=\"w-5 h-5 text-indigo-300 mt-1\" />\r\n              <div>\r\n                <div className=\"font-semibold\">Deep Stats</div>\r\n                <div className=\"text-sm text-slate-200/90\">Track 3-dart averages, best legs, and more.</div>\r\n              </div>\r\n            </li>\r\n            <li className=\"flex items-start gap-3\"><Trophy className=\"w-5 h-5 text-indigo-300 mt-1\" />\r\n              <div>\r\n                <div className=\"font-semibold\">Game Modes</div>\r\n                <div className=\"text-sm text-slate-200/90\">Start with 3 free online games upon signup. After that, PREMIUM is required to play all games.</div>\r\n              </div>\r\n            </li>\r\n            <li className=\"flex items-start gap-3\"><ShieldCheck className=\"w-5 h-5 text-indigo-300 mt-1\" />\r\n              <div>\r\n                <div className=\"font-semibold\">Premium Perks</div>\r\n                <div className=\"text-sm text-slate-200/90\">Polished UI, upcoming features, and early access.</div>\r\n              </div>\r\n            </li>\r\n          </ul>\r\n          <a\r\n            href={(import.meta as any).env?.VITE_DISCORD_INVITE_URL || 'https://discord.gg/8GtbZ6RU'}\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            className=\"btn mt-4 flex items-center justify-center gap-2\"\r\n          >\r\n            <MessageCircle className=\"w-5 h-5\" /> Join BullseyeDartsLeague\r\n          </a>\r\n        </aside>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { createContext, useContext, useEffect, useState } from 'react';\r\n\r\nconst ThemeContext = createContext({\r\n  theme: 'default',\r\n  setTheme: (t: string) => {},\r\n});\r\n\r\nconst THEME_KEY = 'ndn_theme'\r\n\r\nexport function ThemeProvider({ children }: { children: any }) {\r\n  const [theme, setTheme] = useState('default');\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const saved = localStorage.getItem(THEME_KEY)\r\n      if (saved) setTheme(saved)\r\n    } catch {}\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    try { localStorage.setItem(THEME_KEY, theme) } catch {}\r\n  }, [theme])\r\n  return (\r\n    <ThemeContext.Provider value={{ theme, setTheme }}>\r\n      <div className={`theme-${theme}`}>{children}</div>\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  return useContext(ThemeContext);\r\n}\r\n","import React, { createContext, useCallback, useContext, useEffect, useMemo, useRef, useState, type ReactNode } from 'react'\r\n\r\ntype WSMessage = any\r\n\r\ntype WSStatus = 'connecting' | 'connected' | 'disconnected'\r\ntype WSContextType = {\r\n  connected: boolean\r\n  status: WSStatus\r\n  send: (msg: WSMessage) => void\r\n  addListener: (fn: (data: WSMessage) => void) => () => void\r\n}\r\n\r\nconst WSContext = createContext<WSContextType | null>(null)\r\n\r\nexport function WSProvider({ children }: { children: ReactNode }) {\r\n  const [connected, setConnected] = useState(false)\r\n  const [status, setStatus] = useState<WSStatus>('connecting')\r\n  const wsRef = useRef<WebSocket | null>(null)\r\n  const listenersRef = useRef(new Set<(data: WSMessage) => void>())\r\n  const shouldReconnectRef = useRef(true)\r\n  const attemptsRef = useRef(0)\r\n  const timerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\r\n  const heartbeatRef = useRef<ReturnType<typeof setInterval> | null>(null)\r\n\r\n  const endpointsRef = useRef<string[] | null>(null)\r\n  const endpointIdxRef = useRef(0)\r\n  const debug = false\r\n\r\n  const ensureEndpoints = () => {\r\n    if (endpointsRef.current) return endpointsRef.current\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    if (envUrl && envUrl.length > 0) {\r\n      const normalized = envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws'\r\n      endpointsRef.current = [normalized]\r\n      return endpointsRef.current\r\n    }\r\n    const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n    const host = window.location.hostname\r\n    const sameOrigin = `${proto}://${window.location.host}` // includes port if present\r\n    // Candidate endpoints: prefer same-origin first (works when server serves SPA),\r\n    // then common local ports for dev fallbacks.\r\n    const bases = [\r\n      sameOrigin + '/ws',\r\n      `${proto}://${host}/ws`,\r\n      `${proto}://${host}:8787/ws`,\r\n      `${proto}://${host}:3000/ws`,\r\n    ]\r\n    // Deduplicate\r\n    endpointsRef.current = Array.from(new Set(bases))\r\n    return endpointsRef.current\r\n  }\r\n\r\n  const rotateEndpoint = () => {\r\n    const eps = ensureEndpoints()\r\n    endpointIdxRef.current = (endpointIdxRef.current + 1) % eps.length\r\n    return eps[endpointIdxRef.current]\r\n  }\r\n\r\n  const currentEndpoint = () => {\r\n    const eps = ensureEndpoints()\r\n    return eps[endpointIdxRef.current] || eps[0]\r\n  }\r\n\r\n  const connect = useCallback(() => {\r\n    if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) return\r\n    setStatus('connecting')\r\n    const base = currentEndpoint()\r\n    const url = `${base}`\r\n    if (debug) console.log('[WS] connecting to', url)\r\n    const ws = new WebSocket(url)\r\n    wsRef.current = ws\r\n    ws.onopen = () => {\r\n      setConnected(true)\r\n      setStatus('connected')\r\n      attemptsRef.current = 0\r\n      // start heartbeat\r\n      if (heartbeatRef.current) clearInterval(heartbeatRef.current)\r\n      heartbeatRef.current = setInterval(() => {\r\n        try { wsRef.current?.readyState === WebSocket.OPEN && wsRef.current?.send(JSON.stringify({ type: 'ping', t: Date.now() })) } catch {}\r\n      }, 20000)\r\n      if (debug) console.log('[WS] connected')\r\n    }\r\n    ws.onmessage = (ev) => {\r\n      try {\r\n        const data = JSON.parse(ev.data)\r\n        listenersRef.current.forEach(fn => { try { fn(data) } catch {} })\r\n      } catch {}\r\n    }\r\n    ws.onerror = () => {\r\n      if (debug) console.log('[WS] socket error on', currentEndpoint())\r\n    }\r\n    ws.onclose = () => {\r\n      setConnected(false)\r\n      setStatus('disconnected')\r\n      if (heartbeatRef.current) { clearInterval(heartbeatRef.current); heartbeatRef.current = null }\r\n      if (!shouldReconnectRef.current) return\r\n      const attempt = (attemptsRef.current || 0) + 1\r\n      attemptsRef.current = attempt\r\n      // rotate endpoint every 2 failed attempts for broader coverage\r\n      if (attempt % 2 === 0) rotateEndpoint()\r\n      if (debug) console.log('[WS] closed. attempt', attempt, 'next endpoint', currentEndpoint())\r\n      const base = 1000 * Math.pow(2, attempt - 1)\r\n      const jitter = Math.floor(Math.random() * 1000)\r\n      let delay = Math.min(30000, base + jitter)\r\n      // First retry should be immediate for instant reconnect UX\r\n      if (attempt === 1) delay = 0\r\n      if (timerRef.current) clearTimeout(timerRef.current)\r\n      if (delay === 0) {\r\n        connect()\r\n      } else {\r\n        timerRef.current = setTimeout(connect, delay)\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    shouldReconnectRef.current = true\r\n    connect()\r\n    const beforeUnload = () => {\r\n      shouldReconnectRef.current = false\r\n      try { wsRef.current?.close() } catch {}\r\n    }\r\n    window.addEventListener('beforeunload', beforeUnload)\r\n    const onVis = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        // nudge reconnect if needed\r\n        if (!connected) connect()\r\n      }\r\n    }\r\n    document.addEventListener('visibilitychange', onVis)\r\n    window.addEventListener('online', connect)\r\n    return () => {\r\n      shouldReconnectRef.current = false\r\n      if (timerRef.current) clearTimeout(timerRef.current)\r\n      if (heartbeatRef.current) clearInterval(heartbeatRef.current)\r\n      try { wsRef.current?.close() } catch {}\r\n      document.removeEventListener('visibilitychange', onVis)\r\n      window.removeEventListener('online', connect)\r\n      window.removeEventListener('beforeunload', beforeUnload)\r\n    }\r\n  }, [connect])\r\n\r\n  const send = useCallback((msg: WSMessage) => {\r\n    try {\r\n      if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        wsRef.current.send(typeof msg === 'string' ? msg : JSON.stringify(msg))\r\n      }\r\n    } catch {}\r\n  }, [])\r\n\r\n  const addListener = useCallback((fn: (data: WSMessage) => void) => {\r\n    listenersRef.current.add(fn)\r\n    return () => { listenersRef.current.delete(fn) }\r\n  }, [])\r\n\r\n  const value = useMemo(() => ({ connected, status, send, addListener }), [connected, status, send, addListener])\r\n  return <WSContext.Provider value={value}>{children}</WSContext.Provider>\r\n}\r\n\r\nexport function useWS() {\r\n  const ctx = useContext(WSContext)\r\n  if (!ctx) throw new Error('useWS must be used within WSProvider')\r\n  return ctx\r\n}\r\n","import React from 'react'\r\n\r\ntype Props = {\r\n  status: 'connecting' | 'connected' | 'disconnected'\r\n  title?: string\r\n  size?: number // pixels, defaults to 12\r\n}\r\n\r\nexport default function StatusDot({ status, title, size = 12 }: Props) {\r\n  const s = size\r\n  if (status === 'connecting') {\r\n    return (\r\n      <span\r\n        role=\"img\"\r\n        aria-label=\"Connecting\"\r\n        title={title || 'Connecting…'}\r\n        className=\"inline-flex items-center justify-center\"\r\n        style={{ width: s, height: s }}\r\n      >\r\n        <svg\r\n          width={s}\r\n          height={s}\r\n          viewBox=\"0 0 24 24\"\r\n          className=\"animate-spin\"\r\n          aria-hidden=\"true\"\r\n        >\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"#A7F3D0\" strokeWidth=\"3\" fill=\"none\" opacity=\"0.35\" />\r\n          <path d=\"M22 12a10 10 0 0 0-10-10\" stroke=\"#34D399\" strokeWidth=\"3\" strokeLinecap=\"round\" fill=\"none\" />\r\n        </svg>\r\n      </span>\r\n    )\r\n  }\r\n  if (status === 'connected') {\r\n    return (\r\n      <span\r\n        role=\"img\"\r\n        aria-label=\"Connected\"\r\n        title={title || 'Connected'}\r\n        className=\"inline-flex items-center justify-center\"\r\n        style={{ width: s, height: s }}\r\n      >\r\n        <svg width={s} height={s} viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"#34D399\" />\r\n        </svg>\r\n      </span>\r\n    )\r\n  }\r\n  return (\r\n    <span\r\n      role=\"img\"\r\n      aria-label=\"Disconnected\"\r\n      title={title || 'Not connected'}\r\n      className=\"inline-flex items-center justify-center\"\r\n      style={{ width: s, height: s }}\r\n    >\r\n      <svg width={s} height={s} viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n        <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"#F87171\" opacity=\"0.15\" />\r\n        <circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"#F87171\" strokeWidth=\"2\" fill=\"none\" />\r\n        <rect x=\"6\" y=\"11\" width=\"12\" height=\"2\" rx=\"1\" fill=\"#F87171\" />\r\n      </svg>\r\n    </span>\r\n  )\r\n}\r\n","import { create } from 'zustand'\r\n\r\ntype BlockState = {\r\n  blocked: Record<string, number> // email/username -> ts\r\n  isBlocked: (id: string) => boolean\r\n  block: (id: string) => void\r\n  unblock: (id: string) => void\r\n  all: () => string[]\r\n}\r\n\r\nconst LS = 'ndn:blocked:v1'\r\n\r\nfunction load(): Record<string, number> {\r\n  try { const raw = localStorage.getItem(LS); return raw ? JSON.parse(raw) : {} } catch { return {} }\r\n}\r\nfunction save(map: Record<string, number>) {\r\n  try { localStorage.setItem(LS, JSON.stringify(map)) } catch {}\r\n}\r\n\r\nexport const useBlocklist = create<BlockState>((set, get) => ({\r\n  blocked: load(),\r\n  isBlocked: (id) => !!get().blocked[(id||'').toLowerCase()],\r\n  block: (id) => set((s) => { const map = { ...s.blocked }; map[(id||'').toLowerCase()] = Date.now(); save(map); return { blocked: map } }),\r\n  unblock: (id) => set((s) => { const map = { ...s.blocked }; delete map[(id||'').toLowerCase()]; save(map); return { blocked: map } }),\r\n  all: () => Object.keys(get().blocked),\r\n}))\r\n","import { useEffect, useRef, useState } from 'react'\r\nimport { useMatch } from '../store/match'\r\nimport CameraView from './CameraView'\r\nimport CameraTile from './CameraTile'\r\nimport { suggestCheckouts, sayScore } from '../utils/checkout'\r\nimport { addSample, getAllTimeAvg } from '../store/profileStats'\r\nimport { getFreeRemaining, incOnlineUsage } from '../utils/quota'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCalibration } from '../store/calibration'\r\nimport { freeGames, premiumGames, allGames, type GameKey } from '../utils/games'\r\nimport { getUserCurrency, formatPriceInCurrency } from '../utils/config'\r\nimport ResizableModal from './ui/ResizableModal'\r\nimport { useToast } from '../store/toast'\r\n// import { TabKey } from './Sidebar'\r\nimport { useWS } from './WSProvider'\r\nimport { useMessages } from '../store/messages'\r\nimport { censorProfanity, containsProfanity } from '../utils/profanity'\r\nimport { useBlocklist } from '../store/blocklist'\r\nimport TabPills from './ui/TabPills'\r\nimport { DOUBLE_PRACTICE_ORDER, isDoubleHit, parseManualDart, ringSectorToDart } from '../game/types'\r\nimport { ATC_ORDER } from '../game/aroundTheClock'\r\nimport { createCricketState, applyCricketDart, CRICKET_NUMBERS, hasClosedAll as cricketClosedAll, cricketWinner } from '../game/cricket'\r\nimport { createShanghaiState, getRoundTarget as shanghaiTarget, applyShanghaiDart, endShanghaiTurn } from '../game/shanghai'\r\nimport { createDefaultHalveIt, getCurrentHalveTarget, applyHalveItDart, endHalveItTurn } from '../game/halveIt'\r\nimport { createHighLow, applyHighLowDart, endHighLowTurn } from '../game/highLow'\r\nimport { assignKillerNumbers, createKillerState, applyKillerDart, killerWinner } from '../game/killer'\r\nimport { apiFetch } from '../utils/api'\r\n// Phase 2 premium games (Online support)\r\nimport { createAmCricketState, applyAmCricketDart, AM_CRICKET_NUMBERS } from '../game/americanCricket'\r\nimport { createBaseball, applyBaseballDart } from '../game/baseball'\r\nimport { createGolf, applyGolfDart, GOLF_TARGETS } from '../game/golf'\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from '../game/ticTacToe'\r\n\r\nexport default function OnlinePlay({ user }: { user?: any }) {\r\n  const API_URL = (import.meta as any).env?.VITE_API_URL || ''\r\n  const toast = useToast();\r\n  const wsGlobal = (() => { try { return useWS() } catch { return null } })()\r\n  const blocklist = useBlocklist()\r\n  const [roomId, setRoomId] = useState('room-1')\r\n  const [connected, setConnected] = useState(false)\r\n  const [chat, setChat] = useState<{from:string;message:string; fromId?: string}[]>([])\r\n  const [showQuick, setShowQuick] = useState(false)\r\n  const [showMessages, setShowMessages] = useState(false)\r\n  // Track last locally-sent chat to avoid duplicating when the server echoes it back\r\n  const lastSentChatRef = useRef<{ text: string; ts: number } | null>(null)\r\n  const [selfId, setSelfId] = useState<string | null>(null)\r\n  const wsRef = useRef<WebSocket | null>(null)\r\n  // Reconnect handling\r\n  const reconnectAttemptsRef = useRef(0)\r\n  const reconnectTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\r\n  const shouldReconnectRef = useRef(true)\r\n  const lastToastRef = useRef(0)\r\n  const firstConnectDoneRef = useRef(false)\r\n  const match = useMatch()\r\n  const msgs = useMessages()\r\n  const { favoriteDouble, callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, allowSpectate, cameraScale, setCameraScale, cameraEnabled, textSize, boxSize, autoscoreProvider } = useUserSettings()\r\n  const manualScoring = autoscoreProvider === 'manual'\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case 'small': return 'px-1.5 py-0.5 text-xs'\r\n      case 'large': return 'px-3 py-1 text-sm'\r\n      default: return 'px-2 py-0.5 text-sm'\r\n    }\r\n  }\r\n  const buttonSizeClass = getButtonSizeClasses(textSize)\r\n  // Camera resize state\r\n  const [cameraColSpan, setCameraColSpan] = useState(2)\r\n  // Turn-by-turn modal\r\n  const [showMatchModal, setShowMatchModal] = useState(false)\r\n  const [participants, setParticipants] = useState<string[]>([])\r\n  const [turnIdx, setTurnIdx] = useState(0)\r\n  const [visitScore, setVisitScore] = useState(0)\r\n  // Double Practice (online) minimal state synchronized via WS state payload\r\n  const [dpIndex, setDpIndex] = useState(0)\r\n  const [dpHits, setDpHits] = useState(0)\r\n  const [dpManual, setDpManual] = useState('')\r\n  // Around the Clock (online) minimal state\r\n  const [atcIndex, setAtcIndex] = useState(0)\r\n  const [atcHits, setAtcHits] = useState(0)\r\n  const [atcManual, setAtcManual] = useState('')\r\n  // Mobile camera pairing\r\n  const [pairingCode, setPairingCode] = useState<string | null>(null)\r\n  // WebRTC for mobile camera\r\n  const [mobileStream, setMobileStream] = useState<MediaStream | null>(null)\r\n  const mobileVideoRef = useRef<HTMLVideoElement>(null)\r\n  // Tic Tac Toe manual input\r\n  const [tttManual, setTttManual] = useState('')\r\n  // Per-player states for premium games\r\n  const [cricketById, setCricketById] = useState<Record<string, ReturnType<typeof createCricketState>>>({})\r\n  const [shanghaiById, setShanghaiById] = useState<Record<string, ReturnType<typeof createShanghaiState>>>({})\r\n  const [halveById, setHalveById] = useState<Record<string, ReturnType<typeof createDefaultHalveIt>>>({})\r\n  const [highlowById, setHighlowById] = useState<Record<string, ReturnType<typeof createHighLow>>>({})\r\n  const [killerById, setKillerById] = useState<Record<string, ReturnType<typeof createKillerState>>>({})\r\n  const [amCricketById, setAmCricketById] = useState<Record<string, ReturnType<typeof createAmCricketState>>>({})\r\n  const [baseballById, setBaseballById] = useState<Record<string, ReturnType<typeof createBaseball>>>({})\r\n  const [golfById, setGolfById] = useState<Record<string, ReturnType<typeof createGolf>>>({})\r\n  const [ttt, setTTT] = useState<ReturnType<typeof createTicTacToe>>(() => createTicTacToe())\r\n  // Track darts this turn for non-X01 games to auto-advance after 3\r\n  const [turnDarts, setTurnDarts] = useState(0)\r\n  // View mode: compact player-by-player (mobile) vs full overview (desktop)\r\n  const [compactView, setCompactView] = useState<boolean>(() => {\r\n    try { const ua = navigator.userAgent || ''; return /Android|iPhone|iPad|iPod|Mobile/i.test(ua) } catch { return false }\r\n  })\r\n  // Ephemeral celebration overlay (e.g., 180), tied to the current player's turn\r\n  const [celebration, setCelebration] = useState<null | { kind: '180' | 'leg'; by: string; turnIdx: number; ts: number }>(null)\r\n  const lastCelebrationRef = useRef<{ kind: '180'|'leg'; by: string; ts: number } | null>(null)\r\n  const audioCtxRef = useRef<AudioContext | null>(null)\r\n  function ensureAudio() {\r\n    try {\r\n      if (!audioCtxRef.current) {\r\n        const Ctor: any = (window as any).AudioContext || (window as any).webkitAudioContext\r\n        if (Ctor) audioCtxRef.current = new Ctor()\r\n      }\r\n      audioCtxRef.current?.resume?.().catch(()=>{})\r\n    } catch {}\r\n  }\r\n  function beep(freq: number, durMs: number, whenS = 0, gain = 0.05) {\r\n    const ctx = audioCtxRef.current\r\n    if (!ctx) return\r\n    const o = ctx.createOscillator()\r\n    const g = ctx.createGain()\r\n    o.type = 'square'\r\n    o.frequency.value = freq\r\n    g.gain.value = gain\r\n    o.connect(g)\r\n    g.connect(ctx.destination)\r\n    const now = ctx.currentTime + whenS\r\n    o.start(now)\r\n    o.stop(now + durMs / 1000)\r\n  }\r\n  function playSting(kind: '180'|'leg') {\r\n    ensureAudio()\r\n    const ctx = audioCtxRef.current\r\n    if (!ctx) return\r\n    if (kind === '180') {\r\n      beep(880, 110, 0, 0.06); beep(1175, 110, 0.06, 0.06); beep(1568, 140, 0.12, 0.06)\r\n    } else {\r\n      beep(659, 140, 0, 0.07); beep(784, 140, 0.08, 0.07); beep(987, 200, 0.16, 0.07)\r\n    }\r\n  }\r\n  function triggerCelebration(kind: '180'|'leg', who: string) {\r\n    const now = Date.now()\r\n    const last = lastCelebrationRef.current\r\n    if (last && last.kind === kind && last.by === who && (now - last.ts) < 500) return\r\n    lastCelebrationRef.current = { kind, by: who, ts: now }\r\n    setCelebration({ kind, by: who, turnIdx: match.currentPlayerIdx, ts: now })\r\n    playSting(kind)\r\n  }\r\n  // Lobby & create-match state\r\n  const [showCreate, setShowCreate] = useState(false)\r\n  const [lobby, setLobby] = useState<any[]>([])\r\n  const [mode, setMode] = useState<'bestof'|'firstto'>('bestof')\r\n  const [modeValue, setModeValue] = useState<number>(5)\r\n  const [startScore, setStartScore] = useState<number>(501)\r\n  const [pendingInvite, setPendingInvite] = useState<any | null>(null)\r\n  const [errorMsg, setErrorMsg] = useState<string>('')\r\n  // Stripe checkout error handler\r\n  function handleStripeError(msg: string) {\r\n    setErrorMsg(msg || 'Failed to create Stripe checkout session. Please try again later.')\r\n    setTimeout(() => setErrorMsg(''), 4000)\r\n    try { toast(msg || 'Stripe checkout failed', { type: 'error' }) } catch {}\r\n  }\r\n  const [lastJoinIntent, setLastJoinIntent] = useState<any | null>(null)\r\n  const [offerNewRoom, setOfferNewRoom] = useState<null | { game: string; mode: 'bestof'|'firstto'; value: number; startingScore?: number }>(null)\r\n  // Game selection\r\n  const [game, setGame] = useState<GameKey>('X01')\r\n  const [currentGame, setCurrentGame] = useState<GameKey>('X01')\r\n  const [requireCalibration, setRequireCalibration] = useState<boolean>(false)\r\n  const freeLeft = user?.username && !user?.fullAccess ? getFreeRemaining(user.username) : Infinity\r\n  const locked = !user?.fullAccess && (freeLeft <= 0)\r\n  // World Lobby filters\r\n  const [filterMode, setFilterMode] = useState<'all'|'bestof'|'firstto'>('all')\r\n  const [filterStart, setFilterStart] = useState<'all'|301|501|701>('all')\r\n  const [filterGame, setFilterGame] = useState<'all'|GameKey>('all')\r\n  const [nearAvg, setNearAvg] = useState(false)\r\n  const [avgTolerance, setAvgTolerance] = useState<number>(10)\r\n  const { H: calibH } = useCalibration()\r\n  const myAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n  const unread = useMessages(s => s.unread)\r\n  const filteredLobby = (lobby || []).filter((m:any) => {\r\n    if (filterMode !== 'all' && m.mode !== filterMode) return false\r\n    if (filterStart !== 'all' && Number(m.startingScore) !== Number(filterStart)) return false\r\n    if (filterGame !== 'all' && m.game !== filterGame) return false\r\n    if (nearAvg) {\r\n      if (!myAvg || !m.creatorAvg) return false\r\n      const diff = Math.abs(Number(m.creatorAvg) - Number(myAvg))\r\n      if (diff > avgTolerance) return false\r\n    }\r\n    return true\r\n  })\r\n\r\n  // Removed tournaments banner from Online; tournaments live in Tournaments tab only\r\n\r\n  // Demo: prefill Create Match modal from URL (ndn:online-demo)\r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      const d = e?.detail || {}\r\n      if (d.game) setGame(d.game)\r\n      if (d.mode === 'bestof' || d.mode === 'firstto') setMode(d.mode)\r\n      if (typeof d.value === 'number' && isFinite(d.value)) setModeValue(Math.max(1, Math.floor(d.value)))\r\n      if (typeof d.start === 'number' && isFinite(d.start)) setStartScore(Math.max(1, Math.floor(d.start)))\r\n      setShowCreate(true)\r\n    }\r\n    window.addEventListener('ndn:online-demo', handler as any)\r\n    return () => window.removeEventListener('ndn:online-demo', handler as any)\r\n  }, [])\r\n\r\n  // Load inbox on mount for the current user\r\n  useEffect(() => {\r\n    const email = String(user?.email || '').toLowerCase()\r\n    if (!email) return\r\n    apiFetch(`/api/friends/messages?email=${encodeURIComponent(email)}`).then(r=>r.json()).then(d=>{\r\n      if (d?.ok && Array.isArray(d.messages)) msgs.load(d.messages)\r\n    }).catch(()=>{})\r\n  }, [user?.email])\r\n\r\n  // Demo: open a populated Online Match view with fake data (local-only)\r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const d = e?.detail || {}\r\n        const start = Number(d.start || 501)\r\n        // Create a quick local match with two players\r\n        match.newMatch([user?.username || 'You', 'Opponent'], start, roomId)\r\n        // Seed a few visits to populate UI\r\n        match.addVisit(60, 3) // You\r\n        match.nextPlayer()\r\n        match.addVisit(85, 3) // Opponent\r\n        match.nextPlayer()\r\n        match.addVisit(100, 3) // You\r\n        setCurrentGame('X01')\r\n        setShowMatchModal(true)\r\n      } catch {}\r\n    }\r\n    window.addEventListener('ndn:online-match-demo', handler as any)\r\n    return () => window.removeEventListener('ndn:online-match-demo', handler as any)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    // Auto-connect on mount and enable auto-reconnect\r\n    shouldReconnectRef.current = true\r\n    connect()\r\n    return () => {\r\n      shouldReconnectRef.current = false\r\n      if (reconnectTimerRef.current) { clearTimeout(reconnectTimerRef.current) }\r\n      try { wsRef.current?.close() } catch {}\r\n    }\r\n  }, [])\r\n\r\n  // Track in-game flag in messages store\r\n  useEffect(() => {\r\n    msgs.setInGame(match.inProgress)\r\n  }, [match.inProgress])\r\n\r\n  // Clear celebration as soon as turn advances to the next player\r\n  useEffect(() => {\r\n    if (celebration && match.currentPlayerIdx !== celebration.turnIdx) {\r\n      setCelebration(null)\r\n    }\r\n  }, [match.currentPlayerIdx, celebration?.turnIdx])\r\n\r\n  // If the user changes the spectate preference, push updated presence to the server\r\n  useEffect(() => {\r\n    try {\r\n      if (wsGlobal && wsGlobal.connected) {\r\n        wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n      } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        wsRef.current.send(JSON.stringify({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate }))\r\n      }\r\n    } catch {}\r\n  }, [allowSpectate, wsGlobal?.connected])\r\n\r\n  // Spectator flow: listen to spectate events from Friends and join room as readonly\r\n  useEffect(() => {\r\n    const onSpectate = (e: any) => {\r\n      const rid = e?.detail?.roomId\r\n      if (!rid) return\r\n      setRoomId(rid)\r\n      // send spectate message\r\n      if (wsGlobal) wsGlobal.send({ type: 'spectate', roomId: rid })\r\n      else wsRef.current?.send(JSON.stringify({ type: 'spectate', roomId: rid }))\r\n      setShowMatchModal(true)\r\n      setShowCreate(false)\r\n    }\r\n    window.addEventListener('ndn:spectate-room', onSpectate as any)\r\n    return () => window.removeEventListener('ndn:spectate-room', onSpectate as any)\r\n  }, [wsGlobal])\r\n\r\n  function connect() {\r\n    if (wsGlobal) {\r\n      // If global provider exists, rely on it for connection and just send initial commands\r\n      if (wsGlobal.connected) {\r\n        wsGlobal.send({ type: 'join', roomId })\r\n  wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n        wsGlobal.send({ type: 'list-matches' })\r\n        setConnected(true)\r\n      }\r\n      return\r\n    }\r\n    // Avoid duplicate sockets\r\n    try { if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) return } catch {}\r\n  const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n  const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n  const host = window.location.hostname\r\n  const fallback = `${proto}://${host}${window.location.port ? '' : ':8787'}`\r\n  const url = envUrl && typeof envUrl === 'string' && envUrl.length > 0 ? envUrl : fallback\r\n  const ws = new WebSocket(url)\r\n    wsRef.current = ws\r\n    ws.onopen = () => {\r\n      setConnected(true)\r\n      // Reset backoff\r\n      reconnectAttemptsRef.current = 0\r\n      if (!firstConnectDoneRef.current) {\r\n        toast('Connected to lobby', { type: 'success' })\r\n        firstConnectDoneRef.current = true\r\n      } else {\r\n        toast('Reconnected to lobby', { type: 'success' })\r\n      }\r\n    ws.send(JSON.stringify({ type: 'join', roomId }))\r\n    // send presence\r\n  ws.send(JSON.stringify({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate }))\r\n      // fetch current lobby\r\n      ws.send(JSON.stringify({ type: 'list-matches' }))\r\n    }\r\n    ws.onmessage = (ev) => {\r\n      const data = JSON.parse(ev.data)\r\n      if (data.type === 'state') {\r\n        match.importState(data.payload)\r\n        // Pull Double Practice progress if present\r\n        const di = Number((data.payload as any)._dpIndex)\r\n        const dh = Number((data.payload as any)._dpHits)\r\n        if (Number.isFinite(di)) setDpIndex(Math.max(0, di))\r\n        if (Number.isFinite(dh)) setDpHits(Math.max(0, dh))\r\n        // Pull Around the Clock progress if present\r\n        const ai = Number((data.payload as any)._atcIndex)\r\n        const ah = Number((data.payload as any)._atcHits)\r\n        if (Number.isFinite(ai)) setAtcIndex(Math.max(0, ai))\r\n        if (Number.isFinite(ah)) setAtcHits(Math.max(0, ah))\r\n        // Premium per-player states\r\n        try {\r\n          const _cr = (data.payload as any)._cricketById\r\n          if (_cr && typeof _cr === 'object') setCricketById(_cr)\r\n        } catch {}\r\n        try {\r\n          const _sh = (data.payload as any)._shanghaiById\r\n          if (_sh && typeof _sh === 'object') setShanghaiById(_sh)\r\n        } catch {}\r\n        try {\r\n          const _hv = (data.payload as any)._halveById\r\n          if (_hv && typeof _hv === 'object') setHalveById(_hv)\r\n        } catch {}\r\n        try {\r\n          const _hl = (data.payload as any)._highlowById\r\n          if (_hl && typeof _hl === 'object') setHighlowById(_hl)\r\n        } catch {}\r\n        try {\r\n          const _kr = (data.payload as any)._killerById\r\n          if (_kr && typeof _kr === 'object') setKillerById(_kr)\r\n        } catch {}\r\n        try { const _am = (data.payload as any)._amCricketById; if (_am && typeof _am === 'object') setAmCricketById(_am) } catch {}\r\n        try { const _bb = (data.payload as any)._baseballById; if (_bb && typeof _bb === 'object') setBaseballById(_bb) } catch {}\r\n        try { const _gf = (data.payload as any)._golfById; if (_gf && typeof _gf === 'object') setGolfById(_gf) } catch {}\r\n        try { const _tt = (data.payload as any)._tttState; if (_tt && typeof _tt === 'object') setTTT(_tt) } catch {}\r\n        try {\r\n          const _td = Number((data.payload as any)._turnDarts)\r\n          if (Number.isFinite(_td)) setTurnDarts(Math.max(0, _td))\r\n        } catch {}\r\n      } else if (data.type === 'joined') {\r\n        // joined room; keep our assigned id to label messages\r\n        if (data.id) setSelfId(data.id)\r\n      } else if (data.type === 'presence' || data.type === 'peer-joined') {\r\n        // Maintain a simple list of participant ids. In a real app we would map id->username.\r\n        setParticipants(prev => {\r\n          const set = new Set(prev)\r\n          if (data.id) set.add(data.id)\r\n          return Array.from(set)\r\n        })\r\n      } else if (data.type === 'chat') {\r\n        const isSelf = !!(data.from && selfId && data.from === selfId)\r\n        const label = isSelf ? (user?.username || 'me') : (data.from || 'peer')\r\n        const idKey = String(data.from || '')\r\n        // Skip messages from blocked senders (only applies to non-self)\r\n        if (!isSelf && idKey && blocklist.isBlocked(idKey)) return\r\n        // De-dupe if this is our own recently-sent quick message already appended locally\r\n        if (isSelf && lastSentChatRef.current && String(data.message||'') === lastSentChatRef.current.text) {\r\n          // Clear marker and do not append again\r\n          lastSentChatRef.current = null\r\n          return\r\n        }\r\n        setChat(prev => [...prev, { from: label, message: data.message, fromId: idKey || undefined }])\r\n      } else if (data.type === 'matches') {\r\n        setLobby(Array.isArray(data.matches) ? data.matches : [])\r\n      } else if (data.type === 'invite') {\r\n        setPendingInvite({ matchId: data.matchId, fromId: data.fromId, fromName: data.fromName, calibrated: !!data.calibrated, boardPreview: data.boardPreview || null, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n      } else if (data.type === 'match-start') {\r\n        // Both parties received a room id to join\r\n        setRoomId(data.roomId)\r\n        // Auto-join the room\r\n        ws.send(JSON.stringify({ type: 'join', roomId: data.roomId }))\r\n        setShowMatchModal(true)\r\n        setShowCreate(false)\r\n        if (data.match?.game) setCurrentGame(data.match.game)\r\n        // Consume a free game for non-premium users\r\n        if (user?.username && !user?.fullAccess) {\r\n          incOnlineUsage(user.username)\r\n        }\r\n      } else if (data.type === 'declined') {\r\n        toast('Invite declined', { type: 'info' })\r\n      } else if (data.type === 'error') {\r\n        const msg = typeof data.message === 'string' ? data.message : 'Action not allowed'\r\n        setErrorMsg(msg)\r\n        if (data.code === 'SPECTATE_NOT_ALLOWED') {\r\n          try { toast('This player has spectating turned off.', { type: 'error' }) } catch {}\r\n        }\r\n        if (data.code === 'NOT_FOUND' && lastJoinIntent) {\r\n          setOfferNewRoom({\r\n            game: lastJoinIntent.game,\r\n            mode: lastJoinIntent.mode,\r\n            value: lastJoinIntent.value,\r\n            startingScore: lastJoinIntent.startingScore,\r\n          })\r\n        }\r\n        // auto-clear after a bit\r\n        setTimeout(()=>setErrorMsg(''), 3500)\r\n      } else if (data.type === 'friend-invite') {\r\n        const accept = confirm(`${data.fromName || data.fromEmail} invited you to play ${data.game || 'X01'} (${data.mode==='firstto'?'First To':'Best Of'} ${data.value||1}). Accept?`)\r\n        if (accept) {\r\n          ws.send(JSON.stringify({ type: 'start-friend-match', toEmail: data.fromEmail, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore }))\r\n        } else {\r\n          toast('Invite declined', { type: 'info' })\r\n        }\r\n      } else if (data.type === 'friend-message') {\r\n        msgs.add({ id: data.id || `${data.ts}-${data.from}`, from: data.from, message: data.message, ts: data.ts || Date.now() })\r\n        // Show toast only if not currently in a game\r\n        if (!match.inProgress) toast(`${data.from}: ${data.message}`, { type: 'info' })\r\n      } else if (data.type === 'celebration') {\r\n        const who = data.by || 'Player'\r\n        const kind = data.kind === 'leg' ? 'leg' : '180'\r\n        triggerCelebration(kind, who)\r\n      } else if (data.type === 'cam-code') {\r\n        console.log('Received cam-code:', data.code)\r\n        setPairingCode(data.code)\r\n        toast(`Pairing code: ${data.code}`, { type: 'info' })\r\n      } else if (data.type === 'cam-peer-joined') {\r\n        console.log('Mobile peer joined for code:', data.code)\r\n        // Mobile camera connected, start WebRTC\r\n        startMobileWebRTC(data.code)\r\n      } else if (data.type === 'cam-answer') {\r\n        console.log('Received cam-answer')\r\n        const pc = (window as any).mobilePC\r\n        if (pc) pc.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n      } else if (data.type === 'cam-ice') {\r\n        console.log('Received cam-ice')\r\n        const pc = (window as any).mobilePC\r\n        if (pc) pc.addIceCandidate(data.payload)\r\n      }\r\n    }\r\n    ws.onclose = () => {\r\n      setConnected(false)\r\n      // Auto-reconnect with exponential backoff\r\n      if (!shouldReconnectRef.current) return\r\n      const attempt = (reconnectAttemptsRef.current || 0) + 1\r\n      reconnectAttemptsRef.current = attempt\r\n      const delay = Math.min(30000, 1000 * Math.pow(2, attempt - 1))\r\n      const now = Date.now()\r\n      if (now - lastToastRef.current > 4000) {\r\n        toast(`Disconnected. Reconnecting in ${Math.round(delay/1000)}s...`, { type: 'error' })\r\n        lastToastRef.current = now\r\n      }\r\n      if (reconnectTimerRef.current) clearTimeout(reconnectTimerRef.current)\r\n      reconnectTimerRef.current = setTimeout(() => {\r\n        connect()\r\n      }, delay)\r\n    }\r\n  }\r\n  // Small helper to render the match summary card\r\n  function RenderMatchSummary() {\r\n    const players = match.players || []\r\n    const curIdx = match.currentPlayerIdx || 0\r\n    const cur = players[curIdx]\r\n    const leg = cur?.legs?.[cur?.legs?.length - 1]\r\n    const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n    const darts = leg?.dartsThrown || 0\r\n    const scored = leg ? (leg.totalScoreStart - leg.totalScoreRemaining) : 0\r\n    const avg3 = darts > 0 ? ((scored / darts) * 3) : 0\r\n    const lastScore = leg?.visits?.[leg.visits.length-1]?.score ?? 0\r\n    let matchScore = 'ÔÇö'\r\n    if (players.length === 2) {\r\n      matchScore = `${players[0]?.legsWon || 0}-${players[1]?.legsWon || 0}`\r\n    } else if (players.length > 2) {\r\n      matchScore = players.map(p => `${p.name}:${p.legsWon||0}`).join(' = ')\r\n    }\r\n    const best = match.bestLegThisMatch\r\n    const bestText = best ? `${best.darts} darts${(() => { const p = players.find(x=>x.id===best.playerId); return p?` (${p.name})`:'' })()}` : '-'\r\n    \r\n    // Text size classes\r\n    const getTextSizeClasses = (size: string) => {\r\n      switch (size) {\r\n        case 'small': return 'text-xs'\r\n        case 'large': return 'text-base'\r\n        default: return 'text-sm'\r\n      }\r\n    }\r\n    const textSizeClass = getTextSizeClasses(textSize)\r\n    \r\n    // Box size classes\r\n    const getBoxSizeClasses = (size: string) => {\r\n      switch (size) {\r\n        case 'small': return 'p-2'\r\n        case 'large': return 'p-4'\r\n        default: return 'p-3'\r\n      }\r\n    }\r\n    const boxSizeClass = getBoxSizeClasses(boxSize)\r\n    \r\n    return (\r\n      <div className={`${boxSizeClass} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSizeClass}`}>\r\n        <div className=\"font-semibold mb-2\">Match Summary</div>\r\n        <div className=\"grid grid-cols-2 gap-y-1\">\r\n          <div className=\"opacity-80\">Current score</div>\r\n          <div className=\"font-mono text-right\">{matchScore}</div>\r\n          <div className=\"opacity-80\">Current thrower</div>\r\n          <div className=\"text-right font-semibold\">{cur?.name || 'ÔÇö'}</div>\r\n          <div className=\"opacity-80\">Score remaining</div>\r\n          <div className=\"text-right font-mono font-bold text-lg\">{remaining}</div>\r\n          <div className=\"opacity-80\">3-dart avg</div>\r\n          <div className=\"text-right font-mono\">{avg3.toFixed(1)}</div>\r\n          <div className=\"opacity-80\">Last score</div>\r\n          <div className=\"text-right font-mono\">{lastScore}</div>\r\n          <div className=\"opacity-80\">Best leg</div>\r\n          <div className=\"text-right\">{bestText}</div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Subscribe to global WS messages if available\r\n  useEffect(() => {\r\n    if (!wsGlobal) return\r\n    setConnected(wsGlobal.connected)\r\n    const unsub = wsGlobal.addListener((data) => {\r\n      try {\r\n        if (data.type === 'state') {\r\n          match.importState(data.payload)\r\n          // Pull synchronized premium states (when using WS provider)\r\n          try {\r\n            const di = Number((data.payload as any)._dpIndex); const dh = Number((data.payload as any)._dpHits)\r\n            if (Number.isFinite(di)) setDpIndex(Math.max(0, di))\r\n            if (Number.isFinite(dh)) setDpHits(Math.max(0, dh))\r\n          } catch {}\r\n          try {\r\n            const ai = Number((data.payload as any)._atcIndex); const ah = Number((data.payload as any)._atcHits)\r\n            if (Number.isFinite(ai)) setAtcIndex(Math.max(0, ai))\r\n            if (Number.isFinite(ah)) setAtcHits(Math.max(0, ah))\r\n          } catch {}\r\n          try { const _cr = (data.payload as any)._cricketById; if (_cr && typeof _cr === 'object') setCricketById(_cr) } catch {}\r\n          try { const _sh = (data.payload as any)._shanghaiById; if (_sh && typeof _sh === 'object') setShanghaiById(_sh) } catch {}\r\n          try { const _hv = (data.payload as any)._halveById; if (_hv && typeof _hv === 'object') setHalveById(_hv) } catch {}\r\n          try { const _hl = (data.payload as any)._highlowById; if (_hl && typeof _hl === 'object') setHighlowById(_hl) } catch {}\r\n          try { const _kr = (data.payload as any)._killerById; if (_kr && typeof _kr === 'object') setKillerById(_kr) } catch {}\r\n          // Phase 2\r\n          try { const _am = (data.payload as any)._amCricketById; if (_am && typeof _am === 'object') setAmCricketById(_am) } catch {}\r\n          try { const _bb = (data.payload as any)._baseballById; if (_bb && typeof _bb === 'object') setBaseballById(_bb) } catch {}\r\n          try { const _gf = (data.payload as any)._golfById; if (_gf && typeof _gf === 'object') setGolfById(_gf) } catch {}\r\n          try { const _tt = (data.payload as any)._tttState; if (_tt && typeof _tt === 'object') setTTT(_tt) } catch {}\r\n          try { const _td = Number((data.payload as any)._turnDarts); if (Number.isFinite(_td)) setTurnDarts(Math.max(0, _td)) } catch {}\r\n        } else if (data.type === 'joined') {\r\n          if (data.id) setSelfId(data.id)\r\n        } else if (data.type === 'presence' || data.type === 'peer-joined') {\r\n          setParticipants(prev => Array.from(new Set([...(prev||[]), data.id].filter(Boolean))))\r\n        } else if (data.type === 'chat') {\r\n          const isSelf = !!(data.from && selfId && data.from === selfId)\r\n          const label = isSelf ? (user?.username || 'me') : (data.from || 'peer')\r\n          const idKey = String(data.from || '')\r\n          if (!isSelf && idKey && blocklist.isBlocked(idKey)) return\r\n          setChat(prev => [...prev, { from: label, message: data.message, fromId: idKey || undefined }])\r\n        } else if (data.type === 'matches') {\r\n          setLobby(Array.isArray(data.matches) ? data.matches : [])\r\n        } else if (data.type === 'invite') {\r\n          setPendingInvite({ matchId: data.matchId, fromId: data.fromId, fromName: data.fromName, calibrated: !!data.calibrated, boardPreview: data.boardPreview || null, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n        } else if (data.type === 'match-start') {\r\n          setRoomId(data.roomId)\r\n          wsGlobal.send({ type: 'join', roomId: data.roomId })\r\n          setShowMatchModal(true)\r\n          setShowCreate(false)\r\n          if (data.match?.game) setCurrentGame(data.match.game)\r\n          if (user?.username && !user?.fullAccess) {\r\n            incOnlineUsage(user.username)\r\n          }\r\n        } else if (data.type === 'declined') {\r\n          toast('Invite declined', { type: 'info' })\r\n        } else if (data.type === 'error') {\r\n          const msg = typeof data.message === 'string' ? data.message : 'Action not allowed'\r\n          setErrorMsg(msg)\r\n          if (data.code === 'SPECTATE_NOT_ALLOWED') {\r\n            try { toast('This player has spectating turned off.', { type: 'error' }) } catch {}\r\n          }\r\n          if (data.code === 'NOT_FOUND' && lastJoinIntent) {\r\n            setOfferNewRoom({\r\n              game: lastJoinIntent.game,\r\n              mode: lastJoinIntent.mode,\r\n              value: lastJoinIntent.value,\r\n              startingScore: lastJoinIntent.startingScore,\r\n            })\r\n          }\r\n          setTimeout(()=>setErrorMsg(''), 3500)\r\n        } else if (data.type === 'friend-invite') {\r\n          const accept = confirm(`${data.fromName || data.fromEmail} invited you to play ${data.game || 'X01'} (${data.mode==='firstto'?'First To':'Best Of'} ${data.value||1}). Accept?`)\r\n          if (accept) {\r\n            wsGlobal.send({ type: 'start-friend-match', toEmail: data.fromEmail, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n          } else {\r\n            toast('Invite declined', { type: 'info' })\r\n          }\r\n        } else if (data.type === 'friend-message') {\r\n          msgs.add({ id: data.id || `${data.ts}-${data.from}`, from: data.from, message: data.message, ts: data.ts || Date.now() })\r\n          if (!match.inProgress) toast(`${data.from}: ${data.message}`, { type: 'info' })\r\n        } else if (data.type === 'celebration') {\r\n          const who = data.by || 'Player'\r\n          const kind = data.kind === 'leg' ? 'leg' : '180'\r\n          triggerCelebration(kind, who)\r\n        }\r\n      } catch {}\r\n    })\r\n    // On connect, join and load lobby\r\n    if (wsGlobal.connected) {\r\n      wsGlobal.send({ type: 'join', roomId })\r\n  wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n      wsGlobal.send({ type: 'list-matches' })\r\n    }\r\n    return () => { unsub() }\r\n  }, [wsGlobal?.connected])\r\n\r\n  function sendState() {\r\n    if (wsGlobal) {\r\n  wsGlobal.send({ type: 'state', payload: { ...match, _turnIdx: turnIdx, _participants: participants, _dpIndex: dpIndex, _dpHits: dpHits, _atcIndex: atcIndex, _atcHits: atcHits, _cricketById: cricketById, _shanghaiById: shanghaiById, _halveById: halveById, _highlowById: highlowById, _killerById: killerById, _amCricketById: amCricketById, _baseballById: baseballById, _golfById: golfById, _tttState: ttt, _turnDarts: turnDarts } })\r\n      return\r\n    }\r\n    const ws = wsRef.current\r\n    if (!ws || ws.readyState !== WebSocket.OPEN) return\r\n  ws.send(JSON.stringify({ type: 'state', payload: { ...match, _turnIdx: turnIdx, _participants: participants, _dpIndex: dpIndex, _dpHits: dpHits, _atcIndex: atcIndex, _atcHits: atcHits, _cricketById: cricketById, _shanghaiById: shanghaiById, _halveById: halveById, _highlowById: highlowById, _killerById: killerById, _amCricketById: amCricketById, _baseballById: baseballById, _golfById: golfById, _tttState: ttt, _turnDarts: turnDarts } }))\r\n  }\r\n\r\n  function sendQuick(msg: string) {\r\n    const label = user?.username || 'me'\r\n    // Optimistically append locally for snappy UX\r\n    setChat(prev => [...prev, { from: label, message: msg, fromId: selfId || 'self' }])\r\n    lastSentChatRef.current = { text: msg, ts: Date.now() }\r\n    if (wsGlobal) {\r\n      wsGlobal.send({ type: 'chat', message: msg })\r\n      return\r\n    }\r\n    const ws = wsRef.current\r\n    if (!ws || ws.readyState !== WebSocket.OPEN) return\r\n    ws.send(JSON.stringify({ type: 'chat', message: msg }))\r\n  }\r\n\r\n  // Double Practice handlers\r\n  function addDpValue(dart: number) {\r\n    const hit = isDoubleHit(dart, dpIndex)\r\n    if (hit) {\r\n      const newHits = dpHits + 1\r\n      const nextIdx = dpIndex + 1\r\n      setDpHits(newHits)\r\n      setDpIndex(nextIdx)\r\n      // Celebrate completion locally\r\n      try {\r\n        if (newHits >= DOUBLE_PRACTICE_ORDER.length) {\r\n          const who = match.players[match.currentPlayerIdx]?.name || 'Player'\r\n          triggerCelebration('leg', who)\r\n          // Reset for another round\r\n          setDpHits(0)\r\n          setDpIndex(0)\r\n        }\r\n      } catch {}\r\n    }\r\n    // Sync to peers\r\n    sendState()\r\n  }\r\n  function addDpNumeric() {\r\n    const v = Math.max(0, Math.floor(visitScore|0))\r\n    addDpValue(v)\r\n    setVisitScore(0)\r\n  }\r\n  function addDpManual() {\r\n    const val = parseManualDart(dpManual)\r\n    if (val == null) return\r\n    addDpValue(val)\r\n    setDpManual('')\r\n  }\r\n\r\n  // Around the Clock handlers\r\n  function isAtcHit(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const target = ATC_ORDER[atcIndex]\r\n    if (target == null) return false\r\n    if (typeof sector === 'number' && sector >= 1 && sector <= 20) {\r\n      if (sector === target && (ring === 'SINGLE' || ring === 'DOUBLE' || ring === 'TRIPLE')) return true\r\n    }\r\n    if (target === 25) {\r\n      return ring === 'BULL' || val === 25\r\n    }\r\n    if (target === 50) {\r\n      return ring === 'INNER_BULL' || val === 50\r\n    }\r\n    return val === target || val === target * 2 || val === target * 3\r\n  }\r\n  function addAtcValue(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (isAtcHit(val, ring, sector)) {\r\n      const newHits = atcHits + 1\r\n      const nextIdx = atcIndex + 1\r\n      setAtcHits(newHits)\r\n      setAtcIndex(nextIdx)\r\n      try {\r\n        if (newHits >= ATC_ORDER.length) {\r\n          const who = match.players[match.currentPlayerIdx]?.name || 'Player'\r\n          triggerCelebration('leg', who)\r\n          setAtcHits(0)\r\n          setAtcIndex(0)\r\n        }\r\n      } catch {}\r\n    }\r\n    sendState()\r\n  }\r\n  function addAtcNumeric() {\r\n    const v = Math.max(0, Math.floor(visitScore|0))\r\n    addAtcValue(v)\r\n    setVisitScore(0)\r\n  }\r\n  function addAtcManual() {\r\n    const val = parseManualDart(atcManual)\r\n    if (val == null) return\r\n    addAtcValue(val)\r\n    setAtcManual('')\r\n  }\r\n\r\n  // Helpers for premium modes\r\n  function currentPlayerId(): string {\r\n    const p = match.players[match.currentPlayerIdx]\r\n    return p?.id ?? String(match.currentPlayerIdx)\r\n  }\r\n  // Ensure state exists for a given player id\r\n  function ensureCricket(pid: string) {\r\n    if (!cricketById[pid]) setCricketById(s => ({ ...s, [pid]: createCricketState() }))\r\n  }\r\n  function ensureShanghai(pid: string) {\r\n    if (!shanghaiById[pid]) setShanghaiById(s => ({ ...s, [pid]: createShanghaiState() }))\r\n  }\r\n  function ensureHalve(pid: string) {\r\n    if (!halveById[pid]) setHalveById(s => ({ ...s, [pid]: createDefaultHalveIt() }))\r\n  }\r\n  function ensureHighLow(pid: string) {\r\n    if (!highlowById[pid]) setHighlowById(s => ({ ...s, [pid]: createHighLow() }))\r\n  }\r\n  function ensureKiller(pid: string) {\r\n    if (!killerById[pid]) {\r\n      // If any existing assignments, pick the highest density or default to pid index\r\n      const used = new Set<number>(Object.values(killerById || {}).map(s => s.number))\r\n      const pool: number[] = []\r\n      for (let i=1;i<=20;i++){ if (!used.has(i)) pool.push(i) }\r\n      const num = pool.length>0 ? pool[Math.floor(Math.random()*pool.length)] : 20\r\n      setKillerById(s => ({ ...s, [pid]: createKillerState(num, 3) }))\r\n    }\r\n  }\r\n  function ensureAmCricket(pid: string) {\r\n    if (!amCricketById[pid]) setAmCricketById(s => ({ ...s, [pid]: createAmCricketState() }))\r\n  }\r\n  function ensureBaseball(pid: string) {\r\n    if (!baseballById[pid]) setBaseballById(s => ({ ...s, [pid]: createBaseball() }))\r\n  }\r\n  function ensureGolf(pid: string) {\r\n    if (!golfById[pid]) setGolfById(s => ({ ...s, [pid]: createGolf() }))\r\n  }\r\n  // Resets darts count on player change for non-X01 games\r\n  useEffect(() => { setTurnDarts(0) }, [match.currentPlayerIdx, currentGame])\r\n\r\n  // Compute whether all opponents have closed a cricket number\r\n  function allOpponentsClosed(num: 15|16|17|18|19|20|25, selfId: string): boolean {\r\n    const opps = match.players.filter(p => p.id !== selfId)\r\n    if (opps.length === 0) return false\r\n    return opps.every(p => (cricketById[p.id]?.marks?.[num] || 0) >= 3)\r\n  }\r\n\r\n  function applyCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureCricket(pid)\r\n    setCricketById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createCricketState()) }\r\n      const pts = applyCricketDart(st, value, ring, sector, (n)=>allOpponentsClosed(n, pid))\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      // end turn\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyShanghaiAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureShanghai(pid)\r\n    setShanghaiById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createShanghaiState()) }\r\n      applyShanghaiDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setShanghaiById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createShanghaiState()) }\r\n        endShanghaiTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyHalveAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureHalve(pid)\r\n    setHalveById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createDefaultHalveIt()) }\r\n      applyHalveItDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setHalveById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createDefaultHalveIt()) }\r\n        endHalveItTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyHighLowAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureHighLow(pid)\r\n    setHighlowById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createHighLow()) }\r\n      applyHighLowDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setHighlowById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createHighLow()) }\r\n        endHighLowTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyKillerAuto(ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    // Ensure every player has an assignment before applying\r\n    match.players.forEach(p => ensureKiller(p.id))\r\n    setKillerById(prev => {\r\n      const copy: Record<string, ReturnType<typeof createKillerState>> = {}\r\n      for (const [id, st] of Object.entries(prev)) copy[id] = { ...st }\r\n      const res = applyKillerDart(pid, copy, ring, sector)\r\n      // Trigger simple winner check\r\n      const win = killerWinner(copy)\r\n      if (win) {\r\n        try { triggerCelebration('leg', match.players.find(p=>p.id===win)?.name || 'Player') } catch {}\r\n      }\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyAmCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureAmCricket(pid)\r\n    setAmCricketById(prev => {\r\n      const copy = { ...prev }\r\n      const base = (copy[pid] || createAmCricketState())\r\n      const st: ReturnType<typeof createAmCricketState> = { ...(base as any) }\r\n      const oppClosed = (n: 12|13|14|15|16|17|18|19|20|25) => match.players.filter(p=>p.id!==pid).every(p => (((amCricketById[p.id]?.marks as any)?.[n]||0) >= 3))\r\n      applyAmCricketDart(st, value, ring, sector, oppClosed)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyBaseballAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureBaseball(pid)\r\n    setBaseballById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createBaseball()) }\r\n      applyBaseballDart(st, value, ring as any, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyGolfAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureGolf(pid)\r\n    setGolfById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createGolf()) }\r\n      applyGolfDart(st, value, ring as any, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyTttAuto(cell: number, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setTTT(prev => {\r\n      const cp = { ...prev, board: [...prev.board] as any }\r\n      tryClaimCell(cp as any, (cell as any), value, ring as any, sector)\r\n      return cp as any\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  // Open/close Manual Correction dialog in CameraView\r\n  function openManual() { try { window.dispatchEvent(new Event('ndn:open-manual' as any)) } catch {} }\r\n  function closeManual() { try { window.dispatchEvent(new Event('ndn:close-manual' as any)) } catch {} }\r\n\r\n  // Helper to submit a manual visit with shared logic\r\n  function submitVisitManual(v: number) {\r\n    const score = Math.max(0, v | 0)\r\n    match.addVisit(score, 3)\r\n    setVisitScore(0)\r\n    const p = match.players[match.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length - 1]\r\n    // Instant celebration locally\r\n    try {\r\n      if (score === 180) triggerCelebration('180', p?.name || 'Player')\r\n      if (leg && leg.totalScoreRemaining === 0) triggerCelebration('leg', p?.name || 'Player')\r\n    } catch {}\r\n    if (leg && leg.totalScoreRemaining === 0) { match.endLeg(score) } else { match.nextPlayer() }\r\n    if (callerEnabled) {\r\n      const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n      sayScore(user?.username || 'Player', score, Math.max(0, rem), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n    }\r\n    if (user?.username && p?.name === user.username) { addSample(user.username, 3, score) }\r\n    sendState()\r\n  }\r\n\r\n  function reportMessage(offenderId: string | null, text: string) {\r\n    const payload: any = { type: 'report', offenderId, reason: 'Inappropriate language', message: text }\r\n    try { if (wsGlobal) wsGlobal.send(payload); else wsRef.current?.send(JSON.stringify(payload)) } catch {}\r\n    try { toast('Report submitted', { type: 'info' }) } catch {}\r\n  }\r\n\r\n  function isMobileLike() {\r\n    if (typeof navigator === 'undefined') return false\r\n    const ua = navigator.userAgent || ''\r\n    return /Android|iPhone|iPad|iPod|Mobile/i.test(ua)\r\n  }\r\n\r\n  // Try to take a quick camera snapshot to show to the match creator (non-blocking)\r\n  async function getBoardPreview(): Promise<string | null> {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n      const track = stream.getVideoTracks?.()[0]\r\n      // Create a hidden video element to draw a frame\r\n      const video = document.createElement('video')\r\n      video.srcObject = stream\r\n      await video.play().catch(()=>{})\r\n      // Wait a moment for first frame\r\n      await new Promise(r => setTimeout(r, 120))\r\n      const w = Math.min(320, video.videoWidth || 320)\r\n      const h = Math.max(1, Math.floor((video.videoHeight || 180) * (w / Math.max(1, video.videoWidth || 320))))\r\n      const canvas = document.createElement('canvas')\r\n      canvas.width = w; canvas.height = h\r\n      const ctx = canvas.getContext('2d')!\r\n      ctx.drawImage(video, 0, 0, w, h)\r\n      const url = canvas.toDataURL('image/jpeg', 0.7)\r\n      // Cleanup\r\n      try { if (track) track.stop() } catch {}\r\n      try { (stream as any).getTracks?.().forEach((t:any)=>t.stop()) } catch {}\r\n      return url\r\n    } catch {\r\n      return null\r\n    }\r\n  }\r\n\r\n  // WebRTC for mobile camera\r\n  const startMobileWebRTC = async (code: string) => {\r\n    console.log('Starting WebRTC for code:', code)\r\n    try {\r\n      const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] })\r\n      pc.ontrack = (event) => {\r\n        console.log('Received track:', event.streams[0])\r\n        setMobileStream(event.streams[0])\r\n        if (mobileVideoRef.current) {\r\n          mobileVideoRef.current.srcObject = event.streams[0]\r\n          console.log('Set video srcObject')\r\n        }\r\n      }\r\n      pc.onicecandidate = (event) => {\r\n        if (event.candidate) {\r\n          console.log('Sending ICE candidate')\r\n          if (wsGlobal) {\r\n            wsGlobal.send({ type: 'cam-ice', code, payload: event.candidate })\r\n          } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n            wsRef.current.send(JSON.stringify({ type: 'cam-ice', code, payload: event.candidate }))\r\n          }\r\n        }\r\n      }\r\n      pc.onconnectionstatechange = () => console.log('Connection state:', pc.connectionState)\r\n      const offer = await pc.createOffer()\r\n      await pc.setLocalDescription(offer)\r\n      console.log('Sending offer')\r\n      // Try WebSocket first, otherwise fall back to REST POST\r\n      if (wsGlobal) {\r\n        console.log('Sending offer via wsGlobal')\r\n        wsGlobal.send({ type: 'cam-offer', code, payload: offer })\r\n      } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        console.log('Sending offer via wsRef')\r\n        wsRef.current.send(JSON.stringify({ type: 'cam-offer', code, payload: offer }))\r\n      } else {\r\n        console.log('WS not available, POSTing offer to /cam/signal')\r\n        try {\r\n          await apiFetch(`/cam/signal/${code}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ type: 'cam-offer', payload: offer, source: 'desktop' }) })\r\n        } catch (e) { console.warn('REST offer failed', e) }\r\n      }\r\n      // Store pc for later use\r\n      (window as any).mobilePC = pc\r\n    } catch (err) {\r\n      console.error('WebRTC error:', err)\r\n      toast('Failed to start mobile camera', { type: 'error' })\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"card flex flex-col min-h-[85vh] relative overflow-hidden\">\r\n      <h2 className=\"text-xl font-semibold mb-1\">Online Play</h2>\r\n      {unread > 0 && !match.inProgress && (\r\n        <div className=\"mb-3 text-sm px-3 py-2 rounded bg-amber-600/30 border border-amber-500/40\">\r\n          You have {unread} unread message{unread>1?'s':''}. Check the Friends tab.\r\n        </div>\r\n      )}\r\n      <div className=\"relative\">\r\n        <div className=\"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <label className=\"text-xs opacity-70 shrink-0\">Room</label>\r\n            <input className=\"input w-28\" value={roomId} onChange={e => setRoomId(e.target.value)} placeholder=\"room-1\" />\r\n          </div>\r\n          {connected ? (\r\n            <span className=\"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0\">Connected</span>\r\n          ) : (\r\n            <button className=\"btn bg-rose-600 hover:bg-rose-700 shrink-0\" onClick={connect}>Connect</button>\r\n          )}\r\n          <button className=\"btn shrink-0\" onClick={sendState} disabled={!connected}>Sync</button>\r\n          <button\r\n            className=\"text-[11px] px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40 shrink-0\"\r\n            title=\"Open a simulated online match demo\"\r\n            onClick={() => { try { window.dispatchEvent(new CustomEvent('ndn:online-match-demo', { detail: { game: 'X01', start: 501 } })) } catch {} }}\r\n          >DEMO</button>\r\n          {connected && (\r\n            <button className=\"btn shrink-0\" onClick={() => setShowMatchModal(true)} disabled={locked} title={locked ? 'Weekly free games used' : ''}>Open Match</button>\r\n          )}\r\n        </div>\r\n      </div>\r\n      {/* Create Match+ box (top-right area) */}\r\n      <div\r\n        className={`mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end ${(!connected || locked) ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer'}`}\r\n        role=\"button\"\r\n        title={!connected ? 'Connect to the lobby first' : (locked ? 'Weekly free games used' : 'Create a new match')}\r\n        onClick={() => {\r\n          if (!connected || locked) return\r\n          setShowCreate(true)\r\n          if (wsGlobal) wsGlobal.send({ type: 'list-matches' })\r\n          else wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n        }}\r\n      >\r\n        <button className=\"btn\" disabled={!connected || locked}>Create Match +</button>\r\n      </div>\r\n      <p className=\"text-sm text-slate-600 mt-3\">Open this app on another device and join the same Room ID to sync scores.</p>\r\n      {!user?.fullAccess && (\r\n        <div className=\"text-xs text-slate-400 mt-1\">Weekly free online games remaining: {freeLeft === Infinity ? 'ÔÇö' : freeLeft}</div>\r\n      )}\r\n      {(!user?.fullAccess && freeLeft !== Infinity && freeLeft <= 0) && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm\">You've used your 3 free online games this week. PREMIUM required to continue.</div>\r\n      )}\r\n      {errorMsg && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm font-semibold flex items-center gap-2\">\r\n          <span className=\"material-icons text-rose-300\">error_outline</span>\r\n          {errorMsg}\r\n        </div>\r\n      )}\r\n      {offerNewRoom && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-indigo-700/30 border border-indigo-600/40 text-indigo-100 text-sm flex items-center justify-between gap-2\">\r\n          <div>That room is full or no longer available. Create a new clean room with the same settings?</div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n              const { game, mode, value, startingScore } = offerNewRoom\r\n              const creatorAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n              if (wsGlobal) {\r\n                wsGlobal.send({ type: 'create-match', game, mode, value, startingScore: startingScore || 501, creatorAvg })\r\n                wsGlobal.send({ type: 'list-matches' })\r\n              } else {\r\n                wsRef.current?.send(JSON.stringify({ type: 'create-match', game, mode, value, startingScore: startingScore || 501, creatorAvg }))\r\n                wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n              }\r\n              setOfferNewRoom(null)\r\n            }}>Create New Match</button>\r\n            <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>setOfferNewRoom(null)}>Dismiss</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Global toaster is mounted in App */}\r\n\r\n  {/* World Lobby with filters */}\r\n      {connected && (\r\n        <div className=\"mt-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10 flex-1 overflow-auto\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div className=\"font-semibold\">World Lobby</div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-xs opacity-80\">Matches: {filteredLobby.length}</div>\r\n              <button className=\"btn px-3 py-1 text-sm\" onClick={()=> (wsGlobal ? wsGlobal.send({ type: 'list-matches' }) : wsRef.current?.send(JSON.stringify({ type: 'list-matches' })))}>Refresh</button>\r\n              <button\r\n                className=\"btn px-3 py-1 text-sm\"\r\n                title={!connected ? 'Connect to the lobby first' : (locked ? 'Weekly free games used' : 'Create a new match')}\r\n                disabled={!connected || locked}\r\n                onClick={() => { if (!connected || locked) return; setShowCreate(true); (wsGlobal ? wsGlobal.send({ type: 'list-matches' }) : wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))) }}\r\n              >Create Match +</button>\r\n            </div>\r\n          </div>\r\n          {/* Filters */}\r\n          <div className=\"space-y-3 mb-3\">\r\n            <div>\r\n              <label className=\"block text-xs opacity-70 mb-1\">Mode</label>\r\n              <TabPills\r\n                tabs={[{ key: 'all', label: 'All' }, { key: 'bestof', label: 'Best of' }, { key: 'firstto', label: 'First to' }]}\r\n                active={filterMode}\r\n                onChange={(k)=> setFilterMode(k as any)}\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-1\">Game</label>\r\n                <select className=\"input w-full\" value={filterGame as any} onChange={e=>setFilterGame(e.target.value as any)}>\r\n                  <option value=\"all\">All</option>\r\n                  {allGames.map(g => (\r\n                    <option key={g} value={g}>{g}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-1\">Starting Score</label>\r\n                <select className=\"input w-full\" value={filterStart as any} onChange={e=>{\r\n                  const v = e.target.value\r\n                  if (v==='all') setFilterStart('all'); else setFilterStart(Number(v) as any)\r\n                }} disabled={filterGame !== 'all' && filterGame !== 'X01'}>\r\n                  <option value=\"all\">All</option>\r\n                  <option value=\"301\">301</option>\r\n                  <option value=\"501\">501</option>\r\n                  <option value=\"701\">701</option>\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-1\">Opponent near my avg</label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <input id=\"nearavg\" type=\"checkbox\" className=\"accent-purple-500\" checked={nearAvg} onChange={e=>setNearAvg(e.target.checked)} disabled={!myAvg} />\r\n                  <label htmlFor=\"nearavg\" className=\"cursor-pointer text-sm\">Near my average</label>\r\n                  <input className=\"input w-24\" type=\"number\" min={5} max={40} step={1} value={avgTolerance} onChange={e=>setAvgTolerance(parseInt(e.target.value||'10'))} disabled={!nearAvg} />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center justify-between gap-2\">\r\n              <div className=\"flex-1 max-w-sm\">\r\n                <label className={`block text-xs opacity-70 mb-1 ${!nearAvg ? 'opacity-40' : ''}`}>Avg tolerance (±)</label>\r\n                <input className=\"w-full\" type=\"range\" min={1} max={50} value={avgTolerance} onChange={e=>setAvgTolerance(parseInt(e.target.value||'10'))} disabled={!nearAvg} />\r\n                <div className=\"text-xs opacity-70 mt-1\">± {avgTolerance}</div>\r\n              </div>\r\n              <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ setFilterMode('all'); setFilterGame('all'); setFilterStart('all'); setNearAvg(false); setAvgTolerance(10) }}>Reset</button>\r\n            </div>\r\n          </div>\r\n          {filteredLobby.length === 0 ? (\r\n            <div className=\"text-sm text-slate-300\">No games waiting. Create one!</div>\r\n          ) : (\r\n            <div className=\"space-y-2\">\r\n              {filteredLobby.map((m:any)=> (\r\n                <div key={m.id} className=\"p-3 rounded-lg bg-black/20 flex items-center justify-between relative\">\r\n                  <div className=\"text-sm\">\r\n                    <div>{m.game || 'X01'} {m.game==='X01' ? ` ${m.startingScore}` : ''} - {m.mode==='bestof' ? `Best Of ${m.value}` : `First To ${m.value}`} - Created by {m.creatorName}</div>\r\n                    {m.requireCalibration && (\r\n                      <div className=\"text-[11px] inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-600/30 mt-1\">Calibration required</div>\r\n                    )}\r\n                    {m.creatorAvg ? (\r\n                      <div className=\"text-xs opacity-70\">Creator avg: {Number(m.creatorAvg).toFixed(1)}</div>\r\n                    ) : null}\r\n                    <div className=\"text-xs opacity-70\">ID: {m.id}</div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <button className=\"btn px-3 py-1 text-sm bg-green-600 hover:bg-green-700\" disabled={locked || (!user?.fullAccess && (premiumGames as readonly string[]).includes(m.game)) || (!!m.requireCalibration && !calibH)} title={\r\n                      !user?.fullAccess && (premiumGames as readonly string[]).includes(m.game)\r\n                        ? 'PREMIUM game'\r\n                        : (locked ? 'Weekly free games used' : (!!m.requireCalibration && !calibH ? 'Calibration required' : ''))\r\n                    } onClick={async ()=>{\r\n                      setLastJoinIntent({ game: m.game, mode: m.mode, value: m.value, startingScore: m.startingScore })\r\n                      const calibrated = !!calibH\r\n                      const boardPreview = await getBoardPreview()\r\n                      try {\r\n                        // Simulate Stripe checkout error for demo\r\n                        // throw new Error('Failed to create checkout session')\r\n                        if (wsGlobal) wsGlobal.send({ type: 'join-match', matchId: m.id, calibrated, boardPreview })\r\n                        else wsRef.current?.send(JSON.stringify({ type: 'join-match', matchId: m.id, calibrated, boardPreview }))\r\n                      } catch (err: any) {\r\n                        handleStripeError(err?.message || 'Failed to create Stripe checkout session. Please try again later.')\r\n                      }\r\n                    }}>Join Now!</button>\r\n                    {selfId && m.creatorId === selfId && (\r\n                      <button\r\n                        className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\r\n                        title=\"Close this match\"\r\n                        onClick={()=>{\r\n                          if (wsGlobal) wsGlobal.send({ type: 'cancel-match', matchId: m.id })\r\n                          else wsRef.current?.send(JSON.stringify({ type: 'cancel-match', matchId: m.id }))\r\n                        }}\r\n                        aria-label=\"Close match\"\r\n                      >×</button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Frosted lock overlay when non-premium user is locked */}\r\n      {(!user?.fullAccess && freeLeft !== Infinity && freeLeft <= 0) && (\r\n        <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n          <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n            <div className=\"text-3xl mb-2\">­ƒöÆ</div>\r\n            <div className=\"font-semibold\">Online play locked</div>\r\n            <div className=\"text-sm text-slate-200/80\">YouÔÇÖve used your 3 free online games this week. Upgrade to PREMIUM to play all modes.</div>\r\n            <button \r\n              onClick={async () => {\r\n                try {\r\n                  const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ email: user?.email })\r\n                  })\r\n                  const data = await res.json()\r\n                  if (data.ok && data.url) {\r\n                    window.location.href = data.url\r\n                  } else {\r\n                    alert('Failed to create payment session: ' + (data.error || 'Unknown error'))\r\n                  }\r\n                } catch (e) {\r\n                  alert('Network error')\r\n                }\r\n              }}\r\n              className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n            >\r\n              Upgrade to PREMIUM = {formatPriceInCurrency(getUserCurrency(), 5)}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showMatchModal && (\r\n        <div className=\"fixed inset-0 z-50\">\r\n          <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" />\r\n          <div className=\"absolute inset-0 flex flex-col\">\r\n            <div className=\"p-2 md:p-3 flex items-center justify-between\">\r\n              <div>\r\n                <h3 className=\"text-xl md:text-2xl font-bold\">Online Match</h3>\r\n                {/* Room id hidden in-game to reduce clutter */}\r\n              </div>\r\n              <button className=\"btn px-3 py-1\" onClick={() => setShowMatchModal(false)}>Close</button>\r\n            </div>\r\n            <div className=\"relative flex-1 overflow-hidden p-2 md:p-3\">\r\n              <div className=\"card w-full h-full overflow-hidden relative p-2.5 md:p-3\">\r\n            {/* Ephemeral celebration overlay */}\r\n            {celebration && (\r\n              <div className=\"absolute inset-0 pointer-events-none flex items-start justify-center pt-8 z-20\">\r\n                <div className={`px-4 py-2 rounded-full text-lg font-bold shadow ${celebration.kind==='leg' ? 'bg-indigo-500/20 border border-indigo-400/40 text-indigo-100' : 'bg-emerald-500/20 border border-emerald-400/40 text-emerald-100'}`}>\r\n                  {celebration.kind==='leg' ? '­ƒÅü LEG WON ÔÇö ' : '­ƒÄ» ONE HUNDRED AND EIGHTY! ÔÇö '}{celebration.by}\r\n                </div>\r\n                {/* Lightweight confetti for leg wins */}\r\n                {celebration.kind === 'leg' && (\r\n                  <>\r\n                    <style>{`@keyframes ndn-confetti-fall{0%{transform:translateY(-10%) rotate(0deg);opacity:1}100%{transform:translateY(120%) rotate(360deg);opacity:0}}`}</style>\r\n                    <div className=\"absolute inset-0 pointer-events-none\">\r\n                      {[...Array(24)].map((_,i)=>{\r\n                        const left = Math.random()*100\r\n                        const delay = Math.random()*0.2\r\n                        const dur = 1.2 + Math.random()*0.8\r\n                        const size = 6 + Math.random()*6\r\n                        const hue = Math.floor(Math.random()*360)\r\n                        return (\r\n                          <span key={i} style={{ position:'absolute', top:0, left: left+'%', width: size, height: size, background:`hsl(${hue} 90% 60%)`, borderRadius: 2, animation: `ndn-confetti-fall ${dur}s ease-out ${delay}s forwards` }} />\r\n                        )\r\n                      })}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            )}\r\n            <div className=\"mb-1.5 text-xs md:text-sm flex items-center justify-between gap-2\">\r\n              <span>Participants: {participants.length || 1}</span>\r\n              <button\r\n                className=\"text-[11px] px-2 py-0.5 rounded-full bg-slate-700/50 hover:bg-slate-700 border border-slate-600\"\r\n                onClick={() => setCompactView(v => !v)}\r\n                title={compactView ? 'Switch to full multi-player view' : 'Switch to compact player-by-player view'}\r\n              >{compactView ? 'Full view' : 'Compact view'}</button>\r\n            </div>\r\n            {/* Summary area */}\r\n            {compactView ? (\r\n              <div className=\"mb-3\">\r\n                {(() => {\r\n                  const idx = match.currentPlayerIdx\r\n                  const p = match.players[idx]\r\n                  if (!p) return null\r\n                  const leg = p.legs[p.legs.length-1]\r\n                  const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                  const isMe = (user?.username && p.name === user.username)\r\n                  const lastVisitScore = leg && leg.visits.length ? leg.visits[leg.visits.length-1].score : 0\r\n                  const dartsThrown = leg ? leg.dartsThrown : 0\r\n                  const avg = dartsThrown > 0 ? (((leg?.totalScoreStart ?? match.startingScore) - rem) / dartsThrown) * 3 : 0\r\n                  if (currentGame === 'X01') {\r\n                    return (\r\n                      <div className={`p-4 rounded-xl bg-brand-50 text-black ${idx===match.currentPlayerIdx?'ring-2 ring-brand-400':''}`}>\r\n                        <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                          <span className=\"font-semibold\">{p.name}</span>\r\n                          <span className={`px-2 py-0.5 rounded-full ${idx===match.currentPlayerIdx?'bg-emerald-500/20 text-emerald-300':'bg-slate-500/20 text-slate-300'} text-xs font-bold`}>\r\n                            {idx===match.currentPlayerIdx ? 'THROWING' : 'WAITING TO THROW'}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"text-4xl font-extrabold\">{rem}</div>\r\n                        <div className=\"text-sm mt-1\">Last score: <span className=\"font-semibold\">{lastVisitScore}</span></div>\r\n                        <div className=\"text-sm\">3-Dart Avg: <span className=\"font-semibold\">{avg.toFixed(1)}</span></div>\r\n                        {isMe && idx===match.currentPlayerIdx && rem <= 170 && rem > 0 && (\r\n                          <div className=\"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm\">\r\n                            Checkout suggestions (fav {favoriteDouble}): {suggestCheckouts(rem, favoriteDouble).join('  ÔÇó  ') || 'ÔÇö'}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  }\r\n                  // Non-X01 (e.g., Double Practice, Around the Clock): show target and hits instead of X01 remaining\r\n                  return (\r\n                    <div className={`p-4 rounded-xl bg-brand-50 text-black ${idx===match.currentPlayerIdx?'ring-2 ring-brand-400':''}`}>\r\n                      <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                        <span className=\"font-semibold\">{p.name}</span>\r\n                        <span className={`px-2 py-0.5 rounded-full ${idx===match.currentPlayerIdx?'bg-emerald-500/20 text-emerald-300':'bg-slate-500/20 text-slate-300'} text-xs font-bold`}>\r\n                          {idx===match.currentPlayerIdx ? 'THROWING' : 'WAITING TO THROW'}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"text-sm opacity-80\">{currentGame}</div>\r\n                      {currentGame === 'Double Practice' && (\r\n                        <>\r\n                          <div className=\"mt-1 text-xs flex items-center justify-between\">\r\n                            <span>Current target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                        </>\r\n                      )}\r\n                      {currentGame === 'Around the Clock' && (\r\n                        <>\r\n                          <div className=\"mt-1 text-xs flex items-center justify-between\">\r\n                            <span>Current target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || 'ÔÇö')}</span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold\">{atcHits} / {ATC_ORDER.length}</div>\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  )\r\n                })()}\r\n                {match.players.length > 1 && (\r\n                  <div className=\"mt-2 text-xs text-slate-400\">Next up: {match.players[(match.currentPlayerIdx+1) % match.players.length]?.name}</div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <>\r\n                {/* Full overview: slim strip with each player's remaining */}\r\n                <div className=\"mb-3 flex flex-wrap items-center gap-2\">\r\n                  {match.players.map((p, idx) => {\r\n                    const leg = p.legs[p.legs.length-1]\r\n                    const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                    return (\r\n                      <div key={`strip-${p.id}`} className={`px-2 py-1 rounded bg-black/20 border border-slate-700/40 text-xs ${idx===match.currentPlayerIdx ? 'ring-1 ring-brand-400' : ''}`}>\r\n                        <span className=\"font-semibold\">{p.name}</span>\r\n                        {currentGame === 'X01' ? (\r\n                          <>\r\n                            <span className=\"opacity-70\"> = </span>\r\n                            <span className=\"font-mono\">{rem}</span>\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <span className=\"opacity-70\"> = </span>\r\n                            <span className=\"font-mono\">\r\n                              {currentGame === 'Double Practice' ? `${dpHits}/${DOUBLE_PRACTICE_ORDER.length}`\r\n                                : currentGame === 'Around the Clock' ? `${atcHits}/${ATC_ORDER.length}`\r\n                                : currentGame === 'Cricket' ? `${(cricketById[p.id]?.points||0)} pts`\r\n                                : currentGame === 'Shanghai' ? `${(shanghaiById[p.id]?.score||0)} pts = R${(shanghaiById[p.id]?.round||1)}`\r\n                                : currentGame === 'Halve It' ? `${(halveById[p.id]?.score||0)} pts = S${(halveById[p.id]?.stage||0)+1}`\r\n                                : currentGame === 'High-Low' ? `${(highlowById[p.id]?.score||0)} pts = ${(highlowById[p.id]?.target||'HIGH')}`\r\n                                : currentGame === 'Killer' ? (() => { const st = killerById[p.id]; return st ? `#${st.number} = ${st.lives}ÔØñ ${st.isKiller?'= K':''}` : 'ÔÇö' })()\r\n                                : currentGame === 'American Cricket' ? `${(amCricketById[p.id]?.points||0)} pts`\r\n                                : currentGame === 'Baseball' ? (() => { const st = baseballById[p.id]; return st ? `R${st.score} = I${st.inning}` : 'ÔÇö' })()\r\n                                : currentGame === 'Golf' ? (() => { const st = golfById[p.id]; return st ? `S${st.strokes} = H${st.hole}` : 'ÔÇö' })()\r\n                                : currentGame === 'Tic Tac Toe' ? (() => { const x = (ttt.board||[]).filter((c:any)=>c==='X').length; const o = (ttt.board||[]).filter((c:any)=>c==='O').length; return `X${x}-O${o}` })()\r\n                                : currentGame}\r\n                            </span>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  })}\r\n                </div>\r\n              </>\r\n            )}\r\n            {compactView ? (\r\n              <div className=\"space-y-2\">\r\n                {/* Top toolbar */}\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-autoscore' as any)) }catch{} }}>Autoscore</button>\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-scoring' as any)) }catch{} }}>Scoring</button>\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={openManual}>Manual Correction</button>\r\n                  {!manualScoring && (\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={() => {\r\n                      console.log('Sending cam-create')\r\n                      if (wsGlobal) {\r\n                        wsGlobal.send({ type: 'cam-create' })\r\n                      } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n                        wsRef.current.send(JSON.stringify({ type: 'cam-create' }))\r\n                      } else {\r\n                        toast('Not connected to server', { type: 'error' })\r\n                      }\r\n                    }}>Pair Phone</button>\r\n                  )}\r\n                  {!manualScoring && pairingCode && (\r\n                    <div className=\"ml-2 text-sm bg-blue-900/50 p-2 rounded\">\r\n                      <div><span className=\"opacity-70\">Mobile pairing code: </span><span className=\"font-mono font-bold text-lg\">{pairingCode}</span></div>\r\n                      <div className=\"text-xs opacity-70 mt-1\">On your phone, go to: <a href={`/mobile-cam.html?code=${pairingCode}`} target=\"_blank\" className=\"underline\">{window.location.origin}/mobile-cam.html?code={pairingCode}</a></div>\r\n                    </div>\r\n                  )}\r\n                  {!manualScoring && (\r\n                    <div className=\"ml-auto flex items-center gap-1 text-[11px]\">\r\n                      <span className=\"opacity-70\">Cam size</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.max(0.5, Math.round((cameraScale-0.05)*100)/100))}>−</button>\r\n                      <span className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}>{Math.round(cameraScale*100)}%</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.min(1.25, Math.round((cameraScale+0.05)*100)/100))}>+</button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {/* Summary (left) + Camera (right) */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 items-start\">\r\n                  <div className=\"order-1\"><RenderMatchSummary /></div>\r\n                  <div className=\"order-2\">\r\n                    {cameraEnabled ? (\r\n                      <div className=\"min-w-[260px] relative z-10 overflow-hidden\" style={{ maxHeight: 'min(50vh, 400px)' }}>\r\n                        <CameraTile \r\n                          label=\"Your Board\" \r\n                          autoStart={user?.username && match.players[match.currentPlayerIdx]?.name === user.username} \r\n                        />\r\n                        {mobileStream && (\r\n                          <div className=\"mt-2\">\r\n                            <video \r\n                              ref={mobileVideoRef} \r\n                              autoPlay \r\n                              playsInline \r\n                              muted \r\n                              className=\"w-full h-auto max-h-32 object-cover rounded border\" \r\n                            />\r\n                            <div className=\"text-xs opacity-70 mt-1\">Mobile Camera</div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"text-xs opacity-60\">Camera disabled in settings</div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"font-semibold\">Current: {match.players[match.currentPlayerIdx]?.name || 'ÔÇö'}</div>\r\n                {currentGame === 'X01' && cameraEnabled && user?.username && match.players[match.currentPlayerIdx]?.name === user.username ? (\r\n                  <>\r\n                    {/* Camera autoscore module; only render for current thrower */}\r\n                    <CameraView hideInlinePanels showToolbar={false} onVisitCommitted={(score, darts, finished) => {\r\n                      if (callerEnabled) {\r\n                        const p = match.players[match.currentPlayerIdx]\r\n                        const leg = p?.legs[p.legs.length-1]\r\n                        const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n                        sayScore(user?.username || 'Player', score, Math.max(0, remaining), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n                      }\r\n                      const current = match.players[match.currentPlayerIdx]\r\n                      if (user?.username && current?.name === user.username) {\r\n                        addSample(user.username, darts, score)\r\n                      }\r\n                      // Instant local celebration\r\n                      try { if (score === 180) triggerCelebration('180', current?.name || 'Player'); if (finished) triggerCelebration('leg', current?.name || 'Player') } catch {}\r\n                      if (!finished) { match.nextPlayer() }\r\n                      sendState()\r\n                    }} />\r\n                    <div className=\"flex items-center gap-1.5 mb-2\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn px-2 py-0.5 text-xs\" onClick={() => submitVisitManual(visitScore)}>Submit Visit</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                    </div>\r\n                      {/* Quick entry buttons */}\r\n                      <div className=\"flex flex-wrap items-center gap-1.5 mt-1.5 text-xs\">\r\n                        <span className=\"opacity-70\">Quick:</span>\r\n                        {[180,140,100,60].map(v => (\r\n                          <button key={v} className=\"btn px-2 py-0.5 text-xs\" onClick={()=>submitVisitManual(v)}>{v}</button>\r\n                        ))}\r\n                      </div>\r\n                    <div className=\"mt-2 flex items-center gap-1.5 mb-2\">\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                    </div>\r\n                  </>\r\n                ) : (currentGame === 'Double Practice' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Current target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-extrabold mb-2\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView\r\n                        showToolbar={false}\r\n                        immediateAutoCommit\r\n                        onAutoDart={(value, ring) => {\r\n                          if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                            addDpValue(value)\r\n                          }\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addDpNumeric() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addDpNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 mt-1.5\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Manual (D16, 50, 25, T20)\" value={dpManual} onChange={e=>setDpManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addDpManual() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addDpManual}>Add</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Around the Clock' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Around the Clock ÔÇö Hit 1ÔåÆ20 then 25 (outer) and 50 (inner)</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Current target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || 'ÔÇö')}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-extrabold mb-2\">{atcHits} / {ATC_ORDER.length}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView\r\n                        scoringMode=\"custom\"\r\n                        showToolbar={false}\r\n                        immediateAutoCommit\r\n                        onAutoDart={(value, ring, info) => {\r\n                          addAtcValue(value, ring, info?.sector ?? null)\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addAtcNumeric() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addAtcNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 mt-1.5\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Manual (T20, D5, 25, 50)\" value={atcManual} onChange={e=>setAtcManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addAtcManual() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addAtcManual}>Add</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Cricket ÔÇö Close 15-20 and Bull; overflow scores points</div>\r\n                    {(() => {\r\n                      const pid = currentPlayerId(); ensureCricket(pid); const st = cricketById[pid] || createCricketState()\r\n                      return (\r\n                        <div className=\"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]\">\r\n                          {CRICKET_NUMBERS.map(n => (\r\n                            <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                              <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                              <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      )\r\n                    })()}\r\n                    <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(cricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        {\r\n                          const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL')\r\n                          applyCricketAuto(value, r, info?.sector ?? null)\r\n                        }\r\n                      }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Shanghai' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureShanghai(pid); const st = shanghaiById[pid] || createShanghaiState(); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">Shanghai ÔÇö Hit only the round's number; Single/Double/Triple score</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.round}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyShanghaiAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Halve It' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureHalve(pid); const st = halveById[pid] || createDefaultHalveIt(); const t = getCurrentHalveTarget(st); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">Halve It ÔÇö Hit the target each round or your score halves</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                          <span>Stage</span>\r\n                          <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.stage+1}/{st.targets.length}</span>\r\n                        </div>\r\n                        <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const tt = t; if (!tt) return 'ÔÇö'; if (tt.kind==='ANY_NUMBER') return 'Any'; if (tt.kind==='BULL') return 'Bull'; if (tt.kind==='DOUBLE' || tt.kind==='TRIPLE' || tt.kind==='NUMBER') return `${tt.kind} ${(tt as any).num}`; return 'ÔÇö' })()}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHalveAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'High-Low' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureHighLow(pid); const st = highlowById[pid] || createHighLow(); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">High-Low ÔÇö Alternate aiming for high then low segments</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.round}</span></div>\r\n                        <div className=\"text-sm\">Target: <span className=\"font-semibold\">{st.target}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHighLowAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'American Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">American Cricket ÔÇö Close 12-20 and Bull; overflow scores</div>\r\n                    {(() => { const pid = currentPlayerId(); ensureAmCricket(pid); const st = amCricketById[pid] || createAmCricketState(); return (\r\n                      <div className=\"mb-2 grid grid-cols-5 gap-1 text-center text-[11px]\">\r\n                        {AM_CRICKET_NUMBERS.map(n => (\r\n                          <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                            <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                            <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    ) })()}\r\n                    <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(amCricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyAmCricketAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyAmCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Baseball' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureBaseball(pid); const st = baseballById[pid] || createBaseball(); return (\r\n                      <div className=\"text-xs mb-1.5\">Baseball ÔÇö Inning {st.inning} ÔÇó Runs {st.score}</div>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyBaseballAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyBaseballAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Golf' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureGolf(pid); const st = golfById[pid] || createGolf(); return (\r\n                      <div className=\"text-xs mb-1.5\">Golf ÔÇö Hole {st.hole} (target {GOLF_TARGETS[st.hole]}) ÔÇó Strokes {st.strokes}</div>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyGolfAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyGolfAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Tic Tac Toe' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Tic Tac Toe ÔÇö Tap a cell to claim by hitting its target</div>\r\n                    <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                      {Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).map(cell => (\r\n                        <button key={cell} className={`h-12 rounded-xl border ${ttt.board[cell]?'bg-emerald-500/20 border-emerald-400/30':'bg-slate-800/50 border-slate-700/50'}`} onClick={()=>{\r\n                          if (ttt.finished || ttt.board[cell]) return\r\n                          // Use the manual input value instead of prompt\r\n                          const tgt = TTT_TARGETS[cell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(cell, v, ring as any, sector as any)\r\n                          setTttManual('') // Clear input after use\r\n                        }}>{ttt.board[cell] || ''}</button>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Enter dart score (e.g. 20, 40, 60, 25, 50)\" value={tttManual} onChange={e=>setTttManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') {\r\n                        // Apply to first available cell\r\n                        const availableCell = Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).find(cell => !ttt.board[cell] && !ttt.finished)\r\n                        if (availableCell !== undefined) {\r\n                          const tgt = TTT_TARGETS[availableCell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(availableCell, v, ring as any, sector as any)\r\n                          setTttManual('')\r\n                        }\r\n                      }}} />\r\n                      <button className=\"btn\" onClick={() => {\r\n                        // Apply to first available cell\r\n                        const availableCell = Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).find(cell => !ttt.board[cell] && !ttt.finished)\r\n                        if (availableCell !== undefined) {\r\n                          const tgt = TTT_TARGETS[availableCell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(availableCell, v, ring as any, sector as any)\r\n                          setTttManual('')\r\n                        }\r\n                      }}>Claim Cell</button>\r\n                    </div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        // passive; primary interaction via tapping a cell above\r\n                      }} />\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Killer' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples.</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Your number</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{(() => { const pid = currentPlayerId(); match.players.forEach(p=>ensureKiller(p.id)); return killerById[pid]?.number || 'ÔÇö' })()}</span>\r\n                    </div>\r\n                    <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{(() => { const pid = currentPlayerId(); return killerById[pid]?.lives ?? 'ÔÇö' })()}</span> {(() => { const pid = currentPlayerId(); return killerById[pid]?.isKiller ? <span className=\"ml-2 text-emerald-300\">KILLER</span> : null })()}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyKillerAuto(r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">{currentGame} (online) ÔÇö manual turn entry</div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => {\r\n                        const v = Math.max(0, visitScore|0)\r\n                        match.addVisit(v, 3)\r\n                        setVisitScore(0)\r\n                        match.nextPlayer()\r\n                        sendState()\r\n                      }}>Submit</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold\">WAITING TO THROW</div>\r\n                )}\r\n                <div className=\"mt-2 flex items-center gap-1.5\">\r\n                  <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                  <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\r\n                {/* Left column: summary */}\r\n                <div className=\"space-y-1.5\">\r\n                  <RenderMatchSummary />\r\n                </div>\r\n                {/* Main area: toolbar + camera + controls */}\r\n                <div className={`md:col-span-${cameraColSpan} space-y-1.5 relative`}>\r\n                  {/* Toolbar row (separate) */}\r\n                  <div className=\"flex items-center gap-1.5 mt-2\">\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-autoscore' as any)) }catch{} }}>Autoscore</button>\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-scoring' as any)) }catch{} }}>Scoring</button>\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={openManual}>Manual Correction</button>\r\n                    <div className=\"ml-auto flex items-center gap-1\">\r\n                      <span className=\"text-xs opacity-70\">Cam</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.max(0.5, Math.round((cameraScale-0.05)*100)/100))}>−</button>\r\n                      <span className={`btn ${buttonSizeClass} bg-transparent border-slate-600 text-center min-w-[3rem]`}>{Math.round(cameraScale*100)}%</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.min(1.25, Math.round((cameraScale+0.05)*100)/100))}>+</button>\r\n                      <button \r\n                        className={`btn ${buttonSizeClass}`} \r\n                        onClick={() => setCameraColSpan(cameraColSpan === 2 ? 3 : 2)}\r\n                        title={cameraColSpan === 2 ? \"Expand camera\" : \"Shrink camera\"}\r\n                      >\r\n                        {cameraColSpan === 2 ? '↔' : '↙'}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                  {/* Camera row (under toolbar, left side) */}\r\n                  <div className=\"mt-2 relative\">\r\n                    <div className=\"w-full max-w-full\">\r\n                      <CameraTile \r\n                        label=\"Your Board\" \r\n                        autoStart={user?.username && match.players[match.currentPlayerIdx]?.name === user.username} \r\n                      />\r\n                    </div>\r\n                    {/* Resize handle */}\r\n                    {cameraColSpan < 3 && (\r\n                      <div \r\n                        className=\"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-slate-600/20 hover:bg-slate-600/40 transition-colors flex items-center justify-center group\"\r\n                        onMouseDown={(e) => {\r\n                          e.preventDefault()\r\n                          const startX = e.clientX\r\n                          const startSpan = cameraColSpan\r\n                          \r\n                          const handleMouseMove = (moveEvent: MouseEvent) => {\r\n                            const deltaX = moveEvent.clientX - startX\r\n                            // If dragged more than 50px to the right, expand to 3 columns\r\n                            if (deltaX > 50 && startSpan === 2) {\r\n                              setCameraColSpan(3)\r\n                            }\r\n                          }\r\n                          \r\n                          const handleMouseUp = () => {\r\n                            document.removeEventListener('mousemove', handleMouseMove)\r\n                            document.removeEventListener('mouseup', handleMouseUp)\r\n                          }\r\n                          \r\n                          document.addEventListener('mousemove', handleMouseMove)\r\n                          document.addEventListener('mouseup', handleMouseUp)\r\n                        }}\r\n                      >\r\n                        <div className=\"w-0.5 h-8 bg-slate-400 group-hover:bg-slate-300 transition-colors\"></div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"font-semibold text-sm md:text-base\">Current: {match.players[match.currentPlayerIdx]?.name || 'ÔÇö'}</div>\r\n                  {currentGame === 'X01' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username ? (\r\n                    <>\r\n                      <CameraView hideInlinePanels showToolbar={false} onVisitCommitted={(score, darts, finished) => {\r\n                        if (callerEnabled) {\r\n                          const p = match.players[match.currentPlayerIdx]\r\n                          const leg = p?.legs[p.legs.length-1]\r\n                          const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n                          sayScore(user?.username || 'Player', score, Math.max(0, remaining), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n                        }\r\n                        const current = match.players[match.currentPlayerIdx]\r\n                        if (user?.username && current?.name === user.username) {\r\n                          addSample(user.username, darts, score)\r\n                        }\r\n                        // Instant local celebration\r\n                        try { if (score === 180) triggerCelebration('180', current?.name || 'Player'); if (finished) triggerCelebration('leg', current?.name || 'Player') } catch {}\r\n                        if (!finished) { match.nextPlayer() }\r\n                        sendState()\r\n                      }} />\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => submitVisitManual(visitScore)}>Submit Visit (Manual)</button>\r\n                        <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                      </div>\r\n                      {/* Quick entry buttons */}\r\n                      <div className=\"flex flex-wrap items-center gap-2 mt-2 text-sm\">\r\n                        <span className=\"opacity-70\">Quick:</span>\r\n                        {[180,140,100,60].map(v => (\r\n                          <button key={v} className=\"btn px-3 py-1 text-sm\" onClick={()=>submitVisitManual(v)}>{v}</button>\r\n                        ))}\r\n                      </div>\r\n                      {/* Checkout suggestions (full view) */}\r\n                      {(() => {\r\n                        const p = match.players[match.currentPlayerIdx]\r\n                        const leg = p?.legs?.[p.legs?.length-1]\r\n                        const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                        return (rem > 0 && rem <= 170) ? (\r\n                          <div className=\"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm\">\r\n                            Checkout suggestions (fav {favoriteDouble}): {suggestCheckouts(rem, favoriteDouble).join('  ÔÇó  ') || 'ÔÇö'}\r\n                          </div>\r\n                        ) : null\r\n                      })()}\r\n                    </>\r\n                  ) : (currentGame === 'Double Practice' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL</div>\r\n                      <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                        <span>Current target</span>\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                      </div>\r\n                      <div className=\"text-2xl font-extrabold mb-2\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView\r\n                          scoringMode=\"custom\"\r\n                          showToolbar={false}\r\n                          immediateAutoCommit\r\n                          onAutoDart={(value, ring) => {\r\n                            if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                              addDpValue(value)\r\n                            }\r\n                          }}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addDpNumeric() }} />\r\n                        <button className=\"btn\" onClick={addDpNumeric}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 mt-1.5\">\r\n                        <input className=\"input w-44\" placeholder=\"Manual (D16, 50, 25, T20)\" value={dpManual} onChange={e=>setDpManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addDpManual() }} />\r\n                        <button className=\"btn\" onClick={addDpManual}>Add</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">Cricket ÔÇö Close 15-20 and Bull; overflow scores points</div>\r\n                      {(() => { const pid = currentPlayerId(); ensureCricket(pid); const st = cricketById[pid] || createCricketState(); return (\r\n                        <div className=\"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]\">\r\n                          {CRICKET_NUMBERS.map(n => (\r\n                            <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                              <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                              <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      ) })()}\r\n                      <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(cricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyCricketAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Shanghai' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureShanghai(pid); const st = shanghaiById[pid] || createShanghaiState(); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">Shanghai ÔÇö Round {st.round} ÔÇó Score {st.score}</div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyShanghaiAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Halve It' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureHalve(pid); const st = halveById[pid] || createDefaultHalveIt(); const t = getCurrentHalveTarget(st); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">Halve It ÔÇö Stage {st.stage+1}/{st.targets.length} ÔÇó Score {st.score}</div>\r\n                          <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const tt = t; if (!tt) return 'ÔÇö'; if (tt.kind==='ANY_NUMBER') return 'Any'; if (tt.kind==='BULL') return 'Bull'; if (tt.kind==='DOUBLE' || tt.kind==='TRIPLE' || tt.kind==='NUMBER') return `${tt.kind} ${(tt as any).num}`; return 'ÔÇö' })()}</span></div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHalveAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'High-Low' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureHighLow(pid); const st = highlowById[pid] || createHighLow(); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">High-Low ÔÇö Round {st.round} ÔÇó Target {st.target} ÔÇó Score {st.score}</div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHighLowAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Killer' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); match.players.forEach(p=>ensureKiller(p.id)); const st = killerById[pid]; return (\r\n                        <>\r\n                          <div className=\"text-xs mb-1.5\">Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples.</div>\r\n                          <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Your number</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st?.number || 'ÔÇö'}</span></div>\r\n                          <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{st?.lives ?? 'ÔÇö'}</span> {st?.isKiller ? <span className=\"ml-2 text-emerald-300\">KILLER</span> : null}</div>\r\n                          <div className=\"mt-2 grid grid-cols-2 md:grid-cols-3 gap-1 text-[11px]\">\r\n                            {match.players.map(pp => {\r\n                              const s = killerById[pp.id]\r\n                              return (\r\n                                <div key={pp.id} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50 flex items-center justify-between\">\r\n                                  <span className=\"opacity-80 truncate\">{pp.name}</span>\r\n                                  <span className=\"font-mono\">{s ? `#${s.number} = ${s.lives}ÔØñ${s.isKiller?' = K':''}` : 'ÔÇö'}</span>\r\n                                </div>\r\n                              )\r\n                            })}\r\n                          </div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 my-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyKillerAuto(r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"text-xs opacity-70\">Tip: Only doubles/triples on the opponentsÔÇÖ numbers remove lives. To become Killer, hit your own double.</div>\r\n                    </div>\r\n                  ) : (user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">{currentGame} (online) ÔÇö manual turn entry</div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => {\r\n                          const v = Math.max(0, visitScore|0)\r\n                          match.addVisit(v, 3)\r\n                          setVisitScore(0)\r\n                          match.nextPlayer()\r\n                          sendState()\r\n                        }}>Submit</button>\r\n                        <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold\">WAITING TO THROW</div>\r\n                  )}\r\n                </div>\r\n                <div className=\"md:col-span-1\">\r\n                  <div className=\"flex flex-wrap items-center gap-1.5\">\r\n                    <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                    <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                  </div>\r\n                </div>\r\n                </div>\r\n              )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Create Match modal */}\r\n      {showCreate && (\r\n        <div className=\"fixed inset-0 bg-black/70 z-50\">\r\n          <div className=\"w-full h-full flex items-stretch justify-stretch p-0\">\r\n            <ResizableModal storageKey=\"ndn:modal:create-match\" className=\"w-full h-full rounded-none !border-0 !shadow-none relative\" fullScreen>\r\n              <div className=\"flex items-center justify-between mb-3 sticky top-0 bg-slate-900/80 backdrop-blur border-b border-slate-700 z-10 px-2 py-2\">\r\n                <h3 className=\"text-xl font-bold\">Create Match</h3>\r\n              </div>\r\n              <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 overflow-auto px-2\" style={{ maxHeight: 'calc(100vh - 120px)' }}>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Game</label>\r\n                <select className=\"input w-full\" value={game} onChange={e=>setGame(e.target.value as any)}>\r\n                  {allGames.map(g => (\r\n                    <option key={g} value={g} disabled={!user?.fullAccess && (premiumGames as readonly string[]).includes(g)}>\r\n                      {g} {!user?.fullAccess && (premiumGames as readonly string[]).includes(g) ? '(PREMIUM)' : ''}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Mode</label>\r\n                <select className=\"input w-full\" value={mode} onChange={e=>setMode(e.target.value as any)}>\r\n                  <option value=\"bestof\">Best Of</option>\r\n                  <option value=\"firstto\">First To</option>\r\n                </select>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Value</label>\r\n                {game === 'X01' ? (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {[101, 201, 301, 401, 501].map(val => (\r\n                        <button\r\n                          key={val}\r\n                          className={`btn px-2 py-1 text-xs ${modeValue === val ? 'bg-purple-600 hover:bg-purple-700' : ''}`}\r\n                          onClick={() => setModeValue(val)}\r\n                        >\r\n                          {val}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                    <input className=\"input w-full\" type=\"number\" min={1} value={modeValue} onChange={e=>setModeValue(parseInt(e.target.value||'1'))} placeholder=\"Or enter custom value\" />\r\n                  </div>\r\n                ) : (\r\n                  <input className=\"input w-full\" type=\"number\" min={1} value={modeValue} onChange={e=>setModeValue(parseInt(e.target.value||'1'))} />\r\n                )}\r\n                <div className=\"text-xs opacity-70 mt-1\">Example: Best Of 5 — first to 3</div>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Starting Score</label>\r\n                {game === 'X01' ? (\r\n                  <select className=\"input w-full\" value={startScore} onChange={e=>setStartScore(parseInt(e.target.value||'501'))}>\r\n                    {[301, 501, 701].map(s => <option key={s} value={s}>{s}</option>)}\r\n                  </select>\r\n                ) : (\r\n                  <div className=\"text-xs opacity-70 mt-1\">Starting score applies to X01 only</div>\r\n                )}\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Require Calibration</label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <input id=\"calibreq\" type=\"checkbox\" className=\"accent-purple-500\" checked={requireCalibration} onChange={e=>setRequireCalibration(e.target.checked)} />\r\n                  <label htmlFor=\"calibreq\" className=\"text-sm opacity-80\">Players must be calibrated</label>\r\n                </div>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <div className=\"p-3 rounded-lg bg-black/20 border border-slate-700/40\">\r\n                  <div className=\"text-xs text-slate-300 uppercase tracking-wide mb-1\">Summary</div>\r\n                  <div className=\"text-sm font-semibold\">{game} — {mode==='bestof' ? `Best Of ${modeValue}` : `First To ${modeValue}`} {game==='X01' ? `— ${startScore}` : ''}</div>\r\n                  {!user?.fullAccess && (premiumGames as readonly string[]).includes(game) && (\r\n                    <div className=\"text-xs text-rose-300 mt-1\">PREMIUM required</div>\r\n                  )}\r\n                </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"sticky bottom-0 bg-slate-900/80 backdrop-blur border-t border-slate-700 z-10 px-2 py-2\">\r\n                <button className=\"btn w-full\" disabled={!user?.fullAccess && (premiumGames as readonly string[]).includes(game)} title={!user?.fullAccess && (premiumGames as readonly string[]).includes(game) ? 'PREMIUM game' : ''} onClick={()=>{\r\n                  const creatorAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n                  if (wsGlobal) {\r\n                    wsGlobal.send({ type: 'create-match', game, mode, value: modeValue, startingScore: startScore, creatorAvg, requireCalibration })\r\n                    setShowCreate(false)\r\n                    wsGlobal.send({ type: 'list-matches' })\r\n                  } else {\r\n                    wsRef.current?.send(JSON.stringify({ type: 'create-match', game, mode, value: modeValue, startingScore: startScore, creatorAvg, requireCalibration }))\r\n                    setShowCreate(false)\r\n                    wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n                  }\r\n                }}>START GAME!</button>\r\n                <div className=\"flex justify-center mt-2\">\r\n                  <button className=\"btn px-2 py-1\" onClick={()=>setShowCreate(false)}>Close</button>\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Invitation modal for creator */}\r\n      {pendingInvite && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <ResizableModal storageKey=\"ndn:modal:invite\" className=\"w-full relative\" defaultWidth={620} defaultHeight={420} minWidth={520} minHeight={320} maxWidth={1000} maxHeight={800}>\r\n            <h3 className=\"text-xl font-bold mb-1\">Incoming Match Request</h3>\r\n            <div className=\"text-sm mb-2\">\r\n              <span className=\"font-semibold\">{pendingInvite.fromName}</span> wants to join your match.\r\n              <span className={`ml-2 text-xs px-2 py-0.5 rounded ${pendingInvite.calibrated ? 'bg-emerald-500/20 text-emerald-300 border border-emerald-600/30' : 'bg-amber-500/20 text-amber-200 border border-amber-600/30'}`}>\r\n                {pendingInvite.calibrated ? 'Calibrated' : 'Not calibrated'}\r\n              </span>\r\n            </div>\r\n            {(pendingInvite.game || pendingInvite.mode) && (\r\n              <div className=\"text-xs opacity-80 mb-3\">\r\n                {pendingInvite.game || 'X01'} ÔÇó {pendingInvite.mode==='firstto' ? `First To ${pendingInvite.value}` : `Best Of ${pendingInvite.value}`} {pendingInvite.game==='X01' && pendingInvite.startingScore ? `ÔÇó ${pendingInvite.startingScore}` : ''}\r\n              </div>\r\n            )}\r\n            {pendingInvite.boardPreview ? (\r\n              <div className=\"mb-3\">\r\n                <img src={pendingInvite.boardPreview} alt=\"Board preview\" className=\"rounded-lg w-full max-h-64 object-contain bg-black/40 border border-slate-700\" />\r\n              </div>\r\n            ) : (\r\n              <div className=\"mb-3 text-xs opacity-60\">No camera preview provided.</div>\r\n            )}\r\n            <div className=\"flex gap-2\">\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={()=>{\r\n                if (wsGlobal) wsGlobal.send({ type: 'invite-response', matchId: pendingInvite.matchId, accept: true, toId: pendingInvite.fromId })\r\n                else wsRef.current?.send(JSON.stringify({ type: 'invite-response', matchId: pendingInvite.matchId, accept: true, toId: pendingInvite.fromId }))\r\n                setPendingInvite(null)\r\n              }}>Accept</button>\r\n              <button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={()=>{\r\n                if (wsGlobal) wsGlobal.send({ type: 'invite-response', matchId: pendingInvite.matchId, accept: false, toId: pendingInvite.fromId })\r\n                else wsRef.current?.send(JSON.stringify({ type: 'invite-response', matchId: pendingInvite.matchId, accept: false, toId: pendingInvite.fromId }))\r\n                setPendingInvite(null)\r\n              }}>Decline</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n\r\n      {/* Quick Chat popup */}\r\n      {showQuick && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:quick-chat\"\r\n            className=\"w-full relative\"\r\n            defaultWidth={520}\r\n            defaultHeight={280}\r\n            minWidth={360}\r\n            minHeight={220}\r\n            maxWidth={900}\r\n            maxHeight={700}\r\n          >\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <h3 className=\"text-lg font-semibold\">Quick Chat</h3>\r\n              <button className=\"btn px-2 py-1 text-sm\" onClick={()=>setShowQuick(false)}>Close</button>\r\n            </div>\r\n            <div className=\"flex flex-wrap gap-1.5\">\r\n              {['Good luck!','Good game!','Nice darts!','Well played!','Ready?'].map((m) => (\r\n                <button key={m} className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ sendQuick(m); setShowQuick(false) }} disabled={!connected}>{m}</button>\r\n              ))}\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n\r\n      {/* Messages popup */}\r\n      {showMessages && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:messages\"\r\n            className=\"w-full relative\"\r\n            defaultWidth={560}\r\n            defaultHeight={360}\r\n            minWidth={380}\r\n            minHeight={260}\r\n            maxWidth={1000}\r\n            maxHeight={800}\r\n          >\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <h3 className=\"text-lg font-semibold\">Messages</h3>\r\n              <button className=\"btn px-2 py-1 text-sm\" onClick={()=>setShowMessages(false)}>Close</button>\r\n            </div>\r\n            <ChatList\r\n              items={chat\r\n                .slice(-30)\r\n                .filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                .map((m, i) => ({ key: String(i), from: m.from, id: String(m.fromId || m.from), text: m.message }))}\r\n              onDelete={(idx) => setChat(prev => prev.filter((_, i) => i !== idx))}\r\n              onReport={(idx) => {\r\n                const pool = chat.slice(-30).filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                const item = pool[idx]\r\n                if (!item) return\r\n                reportMessage(null, item.message)\r\n              }}\r\n              onBlock={(idx) => {\r\n                const pool = chat.slice(-30).filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                const item = pool[idx]\r\n                if (!item) return\r\n                try { blocklist.block(String(item.fromId || item.from)) } catch {}\r\n                setChat(prev => prev.filter(m => String(m.fromId || m.from) !== String(item.fromId || item.from)))\r\n                try { toast(`${item.from} blocked`, { type: 'info' }) } catch {}\r\n              }}\r\n            />\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\n// Small, self-contained chat list with moderation affordances\r\nfunction ChatList({ items, onDelete, onReport, onBlock }: { items: { key: string; from: string; id?: string; text: string }[]; onDelete: (index: number) => void; onReport: (index: number) => void; onBlock?: (index: number) => void }) {\r\n  const mobile = (() => { try { const ua = navigator.userAgent || ''; return /Android|iPhone|iPad|iPod|Mobile/i.test(ua) } catch { return false } })()\r\n  const [touch, setTouch] = useState<{ x: number; y: number; i: number; t: number } | null>(null)\r\n  const [swiped, setSwiped] = useState<number | null>(null)\r\n  return (\r\n    <div className=\"h-24 overflow-auto text-sm divide-y divide-slate-700/40\">\r\n      {items.length === 0 ? (\r\n        <div className=\"opacity-60 py-1\">No messages yet.</div>\r\n      ) : items.map((m, i) => {\r\n        const text = censorProfanity(m.text)\r\n        const flagged = containsProfanity(m.text)\r\n        return (\r\n          <div\r\n            key={m.key}\r\n            className=\"relative group px-1 py-1 flex items-start gap-2\"\r\n            onTouchStart={mobile ? (e) => { const t = e.touches[0]; setTouch({ x: t.clientX, y: t.clientY, i, t: Date.now() }) } : undefined}\r\n            onTouchMove={mobile ? (e) => { if (!touch || touch.i !== i) return; const t = e.touches[0]; const dx = t.clientX - touch.x; if (dx < -40) setSwiped(i) } : undefined}\r\n            onTouchEnd={mobile ? () => { const held = touch ? (Date.now() - touch.t) : 0; if (swiped === i || held > 600) { onDelete(i); setSwiped(null) } setTouch(null) } : undefined}\r\n          >\r\n            <span className=\"text-slate-400 shrink-0\">[{m.from}]</span>\r\n            <span className=\"text-white break-words whitespace-pre-wrap flex-1\">{text}</span>\r\n            {/* Desktop delete (red X) and Report/Block */}\r\n            {!mobile && (\r\n              <div className=\"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 ml-2\">\r\n                <button\r\n                  className=\"w-5 h-5 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center\"\r\n                  title=\"Delete message\"\r\n                  aria-label=\"Delete message\"\r\n                  onClick={() => onDelete(i)}\r\n                >├ù</button>\r\n                {onBlock && (\r\n                  <button\r\n                    className=\"px-1.5 py-0.5 rounded bg-slate-700 hover:bg-slate-800 text-slate-100 text-[11px]\"\r\n                    onClick={() => onBlock(i)}\r\n                    title=\"Block sender\"\r\n                  >Block</button>\r\n                )}\r\n                <button\r\n                  className=\"px-1.5 py-0.5 rounded bg-amber-600/40 hover:bg-amber-600/60 text-amber-100 text-[11px]\"\r\n                  onClick={() => onReport(i)}\r\n                  title=\"Report message\"\r\n                >Report</button>\r\n              </div>\r\n            )}\r\n            {/* Flag badge if profanity detected */}\r\n            {flagged && <span className=\"ml-2 text-[10px] px-1 rounded bg-rose-600/30 text-rose-200 border border-rose-600/40\">Filtered</span>}\r\n          </div>\r\n        )\r\n      })}\r\n    </div>\r\n  )\r\n}\r\n","import { useMatch } from '../store/match'\r\nimport { formatAvg } from '../utils/stats'\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport BarChart from './BarChart'\r\nimport { getGameModeStats, getMonthlyAvg3, getMonthlyFirstNineAvg, getAllTimeAvg, getAllTimeFirstNineAvg, getAllTime } from '../store/profileStats'\r\nimport { allGames } from '../utils/games'\r\nimport TabPills from './ui/TabPills'\r\n\r\nexport default function StatsPanel({ user }: { user?: any }) {\r\n  const { players, inProgress, startingScore, newMatch } = useMatch()\r\n  const [family, setFamily] = useState<'x01' | 'other'>('x01')\r\n  const [playersText, setPlayersText] = useState('Player 1, Player 2')\r\n  const [start, setStart] = useState(501)\r\n  // Opponent compare: select a friend to render on the second card\r\n  const [friends, setFriends] = useState<Array<{ email: string; username?: string }>>([])\r\n  const [opponent, setOpponent] = useState<string>('')\r\n  const [showPicker, setShowPicker] = useState<boolean>(false)\r\n  const [q, setQ] = useState<string>('')\r\n  const [results, setResults] = useState<Array<{ email: string; username?: string }>>([])\r\n  const [searching, setSearching] = useState<boolean>(false)\r\n  const me = String(user?.email || '').toLowerCase()\r\n  useEffect(() => {\r\n    let cancelled = false\r\n    async function load() {\r\n      try {\r\n        if (!me) return\r\n        const res = await fetch(`/api/friends/list?email=${encodeURIComponent(me)}`)\r\n        const j = await res.json().catch(()=>({friends:[]}))\r\n        if (!cancelled) setFriends((j.friends||[]) as Array<{email:string;username?:string}>)\r\n      } catch {}\r\n    }\r\n    load()\r\n    // Refresh occasionally in case friends change while open\r\n    const id = setInterval(load, 20000)\r\n    return () => { cancelled = true; clearInterval(id) }\r\n  }, [me])\r\n\r\n  // Rehydrate previously selected opponent from localStorage (per-user key)\r\n  useEffect(() => {\r\n    try {\r\n      const key = me ? `ndn:stats:opponent:${me}` : 'ndn:stats:opponent'\r\n      const saved = localStorage.getItem(key)\r\n      if (saved) setOpponent(saved)\r\n    } catch {}\r\n  }, [me])\r\n\r\n  // Persist opponent selection\r\n  useEffect(() => {\r\n    try {\r\n      const key = me ? `ndn:stats:opponent:${me}` : 'ndn:stats:opponent'\r\n      if (opponent) localStorage.setItem(key, opponent); else localStorage.removeItem(key)\r\n    } catch {}\r\n  }, [opponent, me])\r\n\r\n  async function runSearch(term: string) {\r\n    setQ(term)\r\n    if (!term.trim()) { setResults([]); return }\r\n    setSearching(true)\r\n    try {\r\n      const res = await fetch(`/api/friends/search?q=${encodeURIComponent(term)}`)\r\n      const j = await res.json().catch(()=>({results:[]}))\r\n      setResults((j.results||[]) as Array<{email:string;username?:string}>)\r\n    } finally { setSearching(false) }\r\n  }\r\n\r\n  // Build a score-frequency distribution for the selected family.\r\n  // For now, we only have X01 in the match store; \"other\" is a placeholder that would read other game stats when added.\r\n  const dist = useMemo(() => {\r\n    const freq = new Map<number, number>()\r\n    if (family === 'x01') {\r\n      for (const p of players) {\r\n        for (const leg of p.legs) {\r\n          for (const v of leg.visits) {\r\n            const s = Math.max(0, Math.min(180, v.score))\r\n            freq.set(s, (freq.get(s) ?? 0) + 1)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // Convert to sorted array (by score asc) and limit to reasonable width\r\n    const arr = Array.from(freq.entries()).sort((a, b) => a[0] - b[0])\r\n    // If very sparse, still show common x01 bands\r\n    if (arr.length === 0 && family === 'x01') {\r\n      [0, 26, 41, 60, 81, 100, 120, 140, 160, 180].forEach(k => freq.set(k, 0))\r\n      return Array.from(freq.entries()).sort((a, b) => a[0] - b[0]).map(([label, value]) => ({ label, value }))\r\n    }\r\n    return arr.map(([label, value]) => ({ label, value }))\r\n  }, [players, family])\r\n\r\n  // Build Other Modes dataset: one bar per mode with value = played, label = mode name, and show played/won in label\r\n  const otherData = useMemo(() => {\r\n    const gm = getGameModeStats(allGames as unknown as string[])\r\n    return (allGames as unknown as string[]).map(mode => {\r\n      const e = gm[mode] || { played: 0, won: 0 }\r\n      // Bar label stays short; detailed caption rendered below values via custom footer\r\n      return { label: mode, value: e.played, extra: e.won }\r\n    })\r\n  }, [family])\r\n\r\n  // Trigger re-render when any game-mode stat updates elsewhere\r\n  useEffect(() => {\r\n    const onUpdate = () => setFamily(f => f) // noop to refresh memo\r\n    window.addEventListener('ndn:stats-updated', onUpdate as any)\r\n    return () => window.removeEventListener('ndn:stats-updated', onUpdate as any)\r\n  }, [])\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <div className=\"mb-4\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <h2 className=\"text-xl font-semibold\">Match Stats</h2>\r\n          <span className=\"text-xs opacity-70\">View</span>\r\n        </div>\r\n        <TabPills\r\n          tabs={[{ key: 'x01', label: 'X01' }, { key: 'other', label: 'Other Modes' }]}\r\n          active={family}\r\n          onChange={(k)=> setFamily((k as 'x01'|'other'))}\r\n        />\r\n      </div>\r\n      {players.length === 0 && (\r\n        <div className=\"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-2\">No match data yet</div>\r\n          <div className=\"text-sm opacity-80 mb-2\">Start a quick X01 match to generate stats. Stats like Best/Worst 3-dart are finalized when you end the game.</div>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2 items-end\">\r\n            <div>\r\n              <label className=\"block text-xs text-slate-300 mb-1\">Players (comma separated)</label>\r\n              <input className=\"input w-full\" value={playersText} onChange={e => setPlayersText(e.target.value)} />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs text-slate-300 mb-1\">Starting Score</label>\r\n              <input className=\"input w-full\" type=\"number\" value={start} onChange={e => setStart(parseInt(e.target.value||'501'))} />\r\n            </div>\r\n            <div>\r\n              <button className=\"btn w-full\" onClick={()=>{\r\n                const names = playersText.split(',').map(s=>s.trim()).filter(Boolean)\r\n                if (!names.length) return alert('Enter at least one player')\r\n                newMatch(names, start)\r\n              }}>Start Match</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {inProgress && (\r\n        <div className=\"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200\">Note: Detailed leg stats are finalized at the end of the game.</div>\r\n      )}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n        {players.map((p, idx) => (\r\n          <div key={p.id} className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <div className=\"font-semibold\">{idx===1 && !opponent ? (p.name || 'Opponent') : (idx===1 && opponent ? opponent : p.name)}</div>\r\n              {idx === 1 && (\r\n                <div className=\"flex flex-wrap gap-2 items-center\">\r\n                  <button\r\n                    className=\"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10\"\r\n                    onClick={()=> setShowPicker(s => !s)}\r\n                    title=\"Search user to compare\"\r\n                  >Select Friend</button>\r\n                  {friends.slice(0, 6).map(f => {\r\n                    const lbl = f.username || f.email\r\n                    const active = opponent === lbl\r\n                    return (\r\n                      <button\r\n                        key={f.email}\r\n                        className={`text-[11px] px-3 py-1 rounded-full border ${active ? 'bg-indigo-500/30 border-indigo-400/50' : 'bg-white/5 border-white/10 hover:bg-white/10'}`}\r\n                        onClick={()=> setOpponent(lbl)}\r\n                        title={`Compare vs ${lbl}`}\r\n                      >{lbl}</button>\r\n                    )\r\n                  })}\r\n                  {friends.length === 0 && (\r\n                    <button className=\"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10\" disabled>Find friends to compare</button>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n            {idx === 1 && showPicker && (\r\n              <div className=\"mb-2 p-2 rounded-lg bg-black/20 border border-white/10\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <input\r\n                    className=\"input flex-1 py-1\"\r\n                    placeholder=\"Search by name or email\"\r\n                    value={q}\r\n                    onChange={e=> runSearch(e.target.value)}\r\n                  />\r\n                  <button className=\"btn px-3 py-1 text-sm\" onClick={()=> runSearch(q)} disabled={searching}>Search</button>\r\n                </div>\r\n                <ul className=\"max-h-40 overflow-auto space-y-1\">\r\n                  {results.map(r => {\r\n                    const lbl = r.username || r.email\r\n                    return (\r\n                      <li key={r.email}>\r\n                        <button\r\n                          className=\"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm\"\r\n                          onClick={()=> { setOpponent(lbl); setShowPicker(false) }}\r\n                        >{lbl}</button>\r\n                      </li>\r\n                    )\r\n                  })}\r\n                  {!results.length && (\r\n                    <li className=\"text-xs opacity-70\">{q.trim() ? 'No results' : 'Type to search…'}</li>\r\n                  )}\r\n                </ul>\r\n              </div>\r\n            )}\r\n            {/* If second card and an opponent is selected, show their all-time stats; otherwise show the match/player stats */}\r\n            {idx === 1 && opponent ? (\r\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(getAllTime(opponent).best3 || 0)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Worst 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(getAllTime(opponent).worst3 || 0)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 9-Dart (fewest darts)</div>\r\n                  <div className=\"font-semibold\">{(() => { const a = getAllTime(opponent); return a.bestLegDarts ? `${a.bestLegDarts} darts` : '—' })()}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best Checkout</div>\r\n                  <div className=\"font-semibold\">{getAllTime(opponent).bestCheckout || '—'}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">Averages (All-time vs Monthly)</div>\r\n                  <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                    <span>3-dart: {formatAvg(getAllTimeAvg(opponent))} · {formatAvg(getMonthlyAvg3(opponent))}</span>\r\n                    <span>First 9: {formatAvg(getAllTimeFirstNineAvg(opponent))} · {formatAvg(getMonthlyFirstNineAvg(opponent))}</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">All-time snapshot</div>\r\n                  {(() => { const all = getAllTime(opponent); return (\r\n                    <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                      <span>Best 3-dart: {formatAvg(all.best3||0)}</span>\r\n                      <span>Worst 3-dart: {formatAvg(all.worst3||0)}</span>\r\n                      <span>Best leg: {all.bestLegDarts || 0} darts</span>\r\n                      <span>Best checkout: {all.bestCheckout || 0}</span>\r\n                    </div>\r\n                  )})()}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(p.bestThreeDartAvg)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Worst 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(p.worstThreeDartAvg)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 9-Dart (fewest darts)</div>\r\n                  <div className=\"font-semibold\">{p.bestNineDart ? `${p.bestNineDart.darts} darts` : '—'}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best Checkout</div>\r\n                  <div className=\"font-semibold\">{p.bestCheckout ?? '—'}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">Averages (All-time vs Monthly)</div>\r\n                  <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                    <span>3-dart: {formatAvg(getAllTimeAvg(p.name))} · {formatAvg(getMonthlyAvg3(p.name))}</span>\r\n                    <span>First 9: {formatAvg(getAllTimeFirstNineAvg(p.name))} · {formatAvg(getMonthlyFirstNineAvg(p.name))}</span>\r\n                  </div>\r\n                </div>\r\n                {/* All-time snapshot */}\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">All-time snapshot</div>\r\n                  {(() => { const all = getAllTime(p.name); return (\r\n                    <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                      <span>Best 3-dart: {formatAvg(all.best3||0)}</span>\r\n                      <span>Worst 3-dart: {formatAvg(all.worst3||0)}</span>\r\n                      <span>Best leg: {all.bestLegDarts || 0} darts</span>\r\n                      <span>Best checkout: {all.bestCheckout || 0}</span>\r\n                    </div>\r\n                  )})()}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n        {/* Opponent compare card: if there are fewer than 2 players, show a selector to compare with a friend */}\r\n        {players.length <= 1 && (\r\n          <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <div className=\"font-semibold\">Opponent</div>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {friends.slice(0, 6).map(f => {\r\n                  const lbl = f.username || f.email\r\n                  const active = opponent === (f.username || f.email)\r\n                  return (\r\n                    <button\r\n                      key={f.email}\r\n                      className={`text-[11px] px-3 py-1 rounded-full border ${active ? 'bg-indigo-500/30 border-indigo-400/50' : 'bg-white/5 border-white/10 hover:bg-white/10'}`}\r\n                      onClick={()=> setOpponent(lbl)}\r\n                      title={`Compare vs ${lbl}`}\r\n                    >{lbl}</button>\r\n                  )\r\n                })}\r\n                {friends.length === 0 && (\r\n                  <span className=\"text-xs opacity-70\">Add friends to compare stats.</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n            {opponent ? (\r\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">Comparing to</div>\r\n                  <div className=\"font-semibold\">{opponent}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(getAllTimeAvg(opponent))}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Worst 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(getAllTime(opponent).worst3 || 0)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 9-Dart (fewest darts)</div>\r\n                  <div className=\"font-semibold\">{(() => { const a = getAllTime(opponent); return a.bestLegDarts ? `${a.bestLegDarts} darts` : '—' })()}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best Checkout</div>\r\n                  <div className=\"font-semibold\">{getAllTime(opponent).bestCheckout || '—'}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">Averages (All-time vs Monthly)</div>\r\n                  <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                    <span>3-dart: {formatAvg(getAllTimeAvg(opponent))} · {formatAvg(getMonthlyAvg3(opponent))}</span>\r\n                    <span>First 9: {formatAvg(getAllTimeFirstNineAvg(opponent))} · {formatAvg(getMonthlyFirstNineAvg(opponent))}</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">All-time snapshot</div>\r\n                  {(() => { const all = getAllTime(opponent); return (\r\n                    <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                      <span>Best 3-dart: {formatAvg(all.best3||0)}</span>\r\n                      <span>Worst 3-dart: {formatAvg(all.worst3||0)}</span>\r\n                      <span>Best leg: {all.bestLegDarts || 0} darts</span>\r\n                      <span>Best checkout: {all.bestCheckout || 0}</span>\r\n                    </div>\r\n                  )})()}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-sm opacity-70\">Select a friend above to compare.</div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Score distribution for selection */}\r\n      <div className=\"mt-6\">\r\n        <div className=\"mb-2 text-sm opacity-80\">Score Distribution ({family.toUpperCase()}): Visits by scored points</div>\r\n        <div className=\"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3\">\r\n          <BarChart data={dist} showValues={false} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Other Modes: Played/Won per game as a bar chart */}\r\n      <div className=\"mt-6\">\r\n        <div className=\"mb-2 text-sm opacity-80\">Other Modes: games played (bar height) with wins shown beneath each label</div>\r\n        <div className=\"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3\">\r\n          {/* Reuse BarChart for bar height = played; render captions underneath */}\r\n          <BarChart data={otherData.map(d => ({ label: d.label, value: d.value }))} showValues={false} />\r\n          <div className=\"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80\">\r\n            {otherData.map((d, i) => (\r\n              <div key={i} className=\"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10\">\r\n                <span className=\"truncate mr-2\">{d.label}</span>\r\n                <span className=\"whitespace-nowrap\">Played {d.value} · Won {d.extra}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useMemo, useState } from 'react'\r\nimport ResizableModal from './ui/ResizableModal'\r\nimport { useToast } from '../store/toast'\r\nimport { useWS } from './WSProvider'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype Tournament = {\r\n  id: string\r\n  title: string\r\n  game: string\r\n  mode: 'bestof'|'firstto'\r\n  value: number\r\n  description: string\r\n  startAt: number\r\n  checkinMinutes: number\r\n  capacity: number\r\n  participants: { email: string, username: string }[]\r\n  official?: boolean\r\n  prize?: boolean\r\n  prizeType?: 'premium'|'cash'|'none'\r\n  prizeAmount?: number\r\n  currency?: string\r\n  payoutStatus?: 'none'|'pending'|'paid'\r\n  status: 'scheduled'|'running'|'completed'\r\n  winnerEmail?: string|null\r\n  startingScore?: number\r\n  creatorEmail?: string\r\n  creatorName?: string\r\n}\r\n\r\nexport default function Tournaments({ user }: { user: any }) {\r\n  const toast = useToast()\r\n  const wsGlobal = (() => { try { return useWS() } catch { return null } })()\r\n  const [list, setList] = useState<Tournament[]>([])\r\n  const [loading, setLoading] = useState(false)\r\n  const [errorMsg, setErrorMsg] = useState('')\r\n  const [cooldownUntil, setCooldownUntil] = useState<number | null>(null)\r\n  const [showCreate, setShowCreate] = useState(false)\r\n  const [leaveAsk, setLeaveAsk] = useState<{ open: boolean; t: Tournament | null }>({ open: false, t: null })\r\n  const [deleteConfirm, setDeleteConfirm] = useState<{ open: boolean; t: Tournament | null }>({ open: false, t: null })\r\n  const [form, setForm] = useState({\r\n    title: 'Community X01 Tournament',\r\n    game: 'X01',\r\n    mode: 'bestof' as 'bestof'|'firstto',\r\n    value: 3,\r\n    description: '',\r\n    startAt: new Date(Date.now() + 2*60*60*1000).toISOString().slice(0,16), // local yyyy-mm-ddThh:mm\r\n    checkinMinutes: 15,\r\n    capacity: 8,\r\n    startingScore: 501,\r\n  })\r\n  const isTouch = (() => {\r\n    try { return ('ontouchstart' in window) || (navigator.maxTouchPoints||0) > 0 } catch { return false }\r\n  })()\r\n\r\n  async function refresh() {\r\n    try {\r\n      const res = await apiFetch('/api/tournaments')\r\n      const data = await res.json()\r\n      setList(Array.isArray(data.tournaments) ? data.tournaments : [])\r\n    } catch {}\r\n  }\r\n  useEffect(() => { refresh() }, [])\r\n\r\n  // Listen for WS push updates from global provider if available\r\n  useEffect(() => {\r\n    if (!wsGlobal) return\r\n    const unsub = wsGlobal.addListener((msg) => {\r\n      try {\r\n        if (msg.type === 'tournaments') setList(msg.tournaments || [])\r\n        if (msg.type === 'tournament-win' && msg.message) {\r\n          toast(msg.message, { type: 'success', timeout: 10000 }) // Show for 10 seconds\r\n        }\r\n        // tournament-reminder handled optionally here if desired\r\n      } catch {}\r\n    })\r\n    return () => { unsub() }\r\n  }, [wsGlobal?.connected])\r\n\r\n  const email = String(user?.email || '').toLowerCase()\r\n  // Fetch subscription to detect if user is a recent tournament winner (cooldown)\r\n  useEffect(() => {\r\n    let abort = false\r\n    async function check() {\r\n      if (!email) { setCooldownUntil(null); return }\r\n      try {\r\n        const res = await apiFetch(`/api/subscription?email=${encodeURIComponent(email)}`)\r\n        const data = await res.json()\r\n        if (!abort) {\r\n          if (data?.source === 'tournament' && typeof data.expiresAt === 'number' && data.expiresAt > Date.now()) {\r\n            setCooldownUntil(data.expiresAt)\r\n          } else {\r\n            setCooldownUntil(null)\r\n          }\r\n        }\r\n      } catch {\r\n        if (!abort) setCooldownUntil(null)\r\n      }\r\n    }\r\n    check()\r\n    return () => { abort = true }\r\n  }, [email])\r\n  function hasJoined(t: Tournament) {\r\n    return !!t.participants?.some(p => p.email === email)\r\n  }\r\n\r\n  // Helper to delete a tournament with proper error handling and owner fallback\r\n  async function deleteTournament(t: Tournament) {\r\n    if (!email) return\r\n    setDeleteConfirm({ open: true, t })\r\n  }\r\n\r\n  async function confirmDeleteTournament() {\r\n    const t = deleteConfirm.t\r\n    if (!t || !email) return\r\n    setDeleteConfirm({ open: false, t: null })\r\n    setLoading(true)\r\n    try {\r\n      // First try creator/owner shared endpoint\r\n      let res = await apiFetch('/api/tournaments/delete', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ tournamentId: t.id, requesterEmail: email })\r\n      })\r\n\r\n      // If forbidden but user is the owner, try the admin endpoint as a fallback\r\n      if (!res.ok && res.status === 403 && String(email) === 'daviesfamily108@gmail.com') {\r\n        res = await apiFetch('/api/admin/tournaments/delete', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ tournamentId: t.id, requesterEmail: email })\r\n        })\r\n      }\r\n\r\n      if (!res.ok) {\r\n        let msg = 'Delete failed'\r\n        try {\r\n          const data = await res.json()\r\n          if (data?.error) msg = `Delete failed: ${String(data.error)}`\r\n        } catch {}\r\n        toast(msg, { type: 'error' })\r\n        return\r\n      }\r\n\r\n      toast('Tournament deleted', { type: 'success' })\r\n      await refresh()\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  async function join(t: Tournament) {\r\n    if (!email) return\r\n    setLoading(true)\r\n    try {\r\n      const res = await apiFetch('/api/tournaments/join', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tournamentId: t.id, email, username: user?.username }) })\r\n      if (!res.ok) {\r\n        let data: any = {}\r\n        try { data = await res.json() } catch {}\r\n        if (data?.error === 'WINNER_COOLDOWN' && typeof data.until === 'number') {\r\n          setErrorMsg(`You're a recent NDN tournament winner. You can re-enter after ${fmt(data.until)}.`)\r\n          setTimeout(()=>setErrorMsg(''), 6000)\r\n          toast('Join blocked: winner cooldown active', { type: 'error' })\r\n        } else if (data?.error === 'ALREADY_IN_TOURNAMENT') {\r\n          setErrorMsg(String(data.message || 'You can only join one tournament at a time.'))\r\n          setTimeout(()=>setErrorMsg(''), 6000)\r\n          toast('Join blocked: already in another tournament', { type: 'error' })\r\n        } else if (data?.error) {\r\n          setErrorMsg(String(data.error))\r\n          setTimeout(()=>setErrorMsg(''), 3500)\r\n          toast(`Join failed: ${String(data.error)}`, { type: 'error' })\r\n        }\r\n        return\r\n      }\r\n      toast('Joined tournament', { type: 'success' })\r\n      await refresh()\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  async function leave(t: Tournament) {\r\n    if (!email) return\r\n    setLoading(true)\r\n    try {\r\n      const res = await apiFetch('/api/tournaments/leave', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tournamentId: t.id, email }) })\r\n      if (!res.ok) {\r\n        let data: any = {}\r\n        try { data = await res.json() } catch {}\r\n        if (data?.error) {\r\n          toast(`Leave failed: ${String(data.error)}`, { type: 'error' })\r\n        } else if (res.status === 404) {\r\n          toast('Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.', { type: 'error' })\r\n        } else {\r\n          toast('Leave failed. Please try again.', { type: 'error' })\r\n        }\r\n        return\r\n      }\r\n      toast('Left tournament', { type: 'success' })\r\n      // Optimistic local update\r\n      setList(prev => prev.map(it => it.id === t.id ? { ...it, participants: (it.participants||[]).filter(p => p.email !== email) } : it))\r\n      await refresh()\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  async function createTournament() {\r\n    setLoading(true)\r\n    try {\r\n      const start = new Date(form.startAt).getTime()\r\n      await apiFetch('/api/tournaments/create', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({\r\n        title: form.title,\r\n        game: form.game,\r\n        mode: form.mode,\r\n        value: Number(form.value),\r\n        description: form.description,\r\n        startAt: start,\r\n        checkinMinutes: Number(form.checkinMinutes),\r\n        capacity: Number(form.capacity),\r\n        startingScore: form.game==='X01' ? Number(form.startingScore||501) : undefined,\r\n        creatorEmail: user?.email,\r\n        creatorName: user?.username,\r\n      }) })\r\n      setShowCreate(false)\r\n      toast('Tournament created', { type: 'success' })\r\n      await refresh()\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  // Close the create modal on Escape\r\n  useEffect(() => {\r\n    if (!showCreate) return\r\n    const onKey = (e: KeyboardEvent) => { if (e.key === 'Escape') setShowCreate(false) }\r\n    document.addEventListener('keydown', onKey)\r\n    return () => document.removeEventListener('keydown', onKey)\r\n  }, [showCreate])\r\n\r\n  const official = useMemo(() => list.filter(t => t.official), [list])\r\n  const community = useMemo(() => list.filter(t => !t.official), [list])\r\n  const nextOfficial = useMemo(() => {\r\n    const upcoming = official\r\n      .filter(t => t.status === 'scheduled')\r\n      .sort((a,b) => a.startAt - b.startAt)\r\n    return upcoming[0] || null\r\n  }, [official])\r\n\r\n  function fmt(ts: number) {\r\n    const d = new Date(ts)\r\n    return d.toLocaleString()\r\n  }\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h2 className=\"text-2xl font-bold\">Tournaments</h2>\r\n      </div>\r\n      {/* Create Tournament+ box (top-right area) */}\r\n      <div className=\"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end\">\r\n        <button className=\"btn\" onClick={()=>setShowCreate(true)}>Create Tournament +</button>\r\n      </div>\r\n      <div className=\"mb-2 text-sm font-semibold text-slate-300\">World Lobby</div>\r\n      {/* Persistent banner for next official weekly tournament */}\r\n      {nextOfficial && (\r\n        <div className=\"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2\">\r\n            <div>\r\n              <div className=\"text-sm uppercase tracking-wide text-indigo-300 font-semibold\">Weekly Official Tournament</div>\r\n              <div className=\"font-bold\">{nextOfficial.title}</div>\r\n                  <div className=\"text-sm opacity-80\">{nextOfficial.game}{nextOfficial.game==='X01' && nextOfficial.startingScore?`/${nextOfficial.startingScore}`:''} · {nextOfficial.mode==='firstto'?'First to':'Best of'} {nextOfficial.value} · Starts {fmt(nextOfficial.startAt)} · Cap {nextOfficial.capacity} · Joined {nextOfficial.participants.length}</div>\r\n              {nextOfficial.prize && (\r\n                <div className=\"text-xs mt-1\">\r\n                  Prize: {nextOfficial.prizeType === 'cash' && nextOfficial.prizeAmount ? `${nextOfficial.currency||'USD'} ${nextOfficial.prizeAmount}` : '3 months PREMIUM'}\r\n                </div>\r\n              )}\r\n              {nextOfficial.status !== 'scheduled' && <div className=\"text-xs\">Status: {nextOfficial.status}</div>}\r\n              {cooldownUntil && cooldownUntil > Date.now() && (\r\n                <div className=\"text-xs text-rose-300\">Recent winners can re-enter after {fmt(cooldownUntil)}.</div>\r\n              )}\r\n            </div>\r\n            <div className=\"shrink-0\">\r\n              <button\r\n                className={`btn ${hasJoined(nextOfficial) ? 'bg-emerald-600 hover:bg-emerald-600' : ''}`}\r\n                title={hasJoined(nextOfficial)\r\n                  ? 'Double-click to leave this tournament'\r\n                  : (nextOfficial.official && cooldownUntil && cooldownUntil > Date.now() ? `Recent winners can re-enter after ${fmt(cooldownUntil)}` : '')}\r\n                disabled={loading || nextOfficial.status!=='scheduled' || (!hasJoined(nextOfficial) && (nextOfficial.participants.length>=nextOfficial.capacity || (!!cooldownUntil && cooldownUntil > Date.now())))}\r\n                onClick={()=> {\r\n                  if (!hasJoined(nextOfficial)) { join(nextOfficial) }\r\n                  else if (isTouch) { setLeaveAsk({ open: true, t: nextOfficial }) }\r\n                }}\r\n                onDoubleClick={()=> { if (!isTouch && hasJoined(nextOfficial)) setLeaveAsk({ open: true, t: nextOfficial }) }}\r\n                aria-label={hasJoined(nextOfficial) ? 'Already Joined' : 'Join Now'}\r\n              >{hasJoined(nextOfficial) ? 'Already Joined!' : 'Join Now'}</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {errorMsg && (\r\n        <div className=\"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm\">{errorMsg}</div>\r\n      )}\r\n      <div className=\"space-y-4\">\r\n        <section>\r\n          <div className=\"font-semibold mb-1\">Official</div>\r\n          <div className=\"text-xs opacity-70 mb-2\">\r\n            {cooldownUntil && cooldownUntil > Date.now() ? (\r\n              <>You’re a recent NDN tournament winner — to keep it fair, you can re-enter after {fmt(cooldownUntil)}.</>\r\n            ) : (\r\n              <>Note: Weekly winners can re-enter once their 3 months of PREMIUM ends.</>\r\n            )}\r\n          </div>\r\n          <ul className=\"space-y-2\">\r\n            {official.map(t => (\r\n              <li key={t.id} className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\">\r\n                <div className=\"space-y-0.5\">\r\n                  <div className=\"font-semibold\">{t.title} {t.prize && (\r\n                    <span className=\"inline-flex items-center gap-1 ml-2 align-middle\">\r\n                      <span className=\"text-xs px-2 py-0.5 rounded bg-amber-500 text-black\">Prize</span>\r\n                      <span\r\n                        className=\"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help\"\r\n                        title={t.prizeType==='cash' ? 'Official cash prize tournament — payout handled by admin.' : 'Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.'}\r\n                        aria-label=\"Prize info\"\r\n                      >i</span>\r\n                    </span>\r\n                  )}</div>\r\n                  <div className=\"text-sm opacity-80\">{t.game}{t.game==='X01' && t.startingScore?`/${t.startingScore}`:''} · {t.mode==='firstto'?'First to':'Best of'} {t.value} · {fmt(t.startAt)} · Cap {t.capacity} · Joined {t.participants.length}</div>\r\n                  {t.prize && (\r\n                    <div className=\"text-xs\">\r\n                      Prize: {t.prizeType === 'cash' && t.prizeAmount ? `${t.currency||'USD'} ${t.prizeAmount}` : '3 months PREMIUM'}\r\n                      {t.status==='completed' && t.prizeType==='cash' && t.payoutStatus && (\r\n                        <span className={`ml-2 px-2 py-0.5 rounded ${t.payoutStatus==='paid'?'bg-emerald-600':'bg-amber-600'}`}>{t.payoutStatus==='paid'?'Paid':'Pending'}</span>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                  {t.status !== 'scheduled' && <div className=\"text-xs\">Status: {t.status}</div>}\r\n                  {hasJoined(t) && <div className=\"text-xs text-emerald-400 font-semibold\">Already Joined</div>}\r\n                  {t.official && cooldownUntil && cooldownUntil > Date.now() && (\r\n                    <div className=\"text-xs text-rose-300\">Cooldown active until {fmt(cooldownUntil)}.</div>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    className={`btn ${hasJoined(t) ? 'bg-emerald-600 hover:bg-emerald-600' : ''}`}\r\n                    title={hasJoined(t)\r\n                      ? 'Double-click to leave this tournament'\r\n                      : (t.official && cooldownUntil && cooldownUntil > Date.now() ? `Recent winners can re-enter after ${fmt(cooldownUntil)}` : '')}\r\n                    disabled={loading || t.status!=='scheduled' || (!hasJoined(t) && (t.participants.length>=t.capacity || (t.official && !!cooldownUntil && cooldownUntil > Date.now())))}\r\n                    onClick={()=> { if (!hasJoined(t)) { join(t) } else if (isTouch) { setLeaveAsk({ open: true, t }) } }}\r\n                    onDoubleClick={()=> { if (!isTouch && hasJoined(t)) setLeaveAsk({ open: true, t }) }}\r\n                    aria-label={hasJoined(t) ? 'Already Joined' : 'Join Now'}\r\n                  >{hasJoined(t) ? 'Already Joined!' : 'Join Now'}</button>\r\n                  {/* Delete button when you are the creator (owner-created official) and it hasn't started */}\r\n                  {(t.status==='scheduled' && email && t.creatorEmail && String(t.creatorEmail).toLowerCase()===email) && (\r\n                    <button\r\n                      className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\r\n                      title=\"Delete this tournament\"\r\n                      onClick={()=>deleteTournament(t)}\r\n                      aria-label=\"Delete tournament\"\r\n                    >×</button>\r\n                  )}\r\n                </div>\r\n              </li>\r\n            ))}\r\n            {official.length === 0 && <li className=\"text-sm opacity-60\">No official tournaments yet.</li>}\r\n          </ul>\r\n        </section>\r\n\r\n        <section>\r\n          <div className=\"font-semibold mb-1\">Community</div>\r\n          <ul className=\"space-y-2\">\r\n            {community.map(t => (\r\n              <li key={t.id} className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\">\r\n                <div className=\"space-y-0.5\">\r\n                  <div className=\"font-semibold\">{t.title}</div>\r\n                  <div className=\"text-sm opacity-80\">{t.game}{t.game==='X01' && t.startingScore?`/${t.startingScore}`:''} · {t.mode==='firstto'?'First to':'Best of'} {t.value} · {fmt(t.startAt)} · Cap {t.capacity} · Joined {t.participants.length}</div>\r\n                  {t.description && <div className=\"text-xs opacity-80\">{t.description}</div>}\r\n                  {hasJoined(t) && <div className=\"text-xs text-emerald-400 font-semibold\">Already Joined</div>}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    className=\"btn\"\r\n                    title={hasJoined(t) ? 'Double-click to leave this tournament' : ''}\r\n                    disabled={loading || t.status!=='scheduled' || (!hasJoined(t) && t.participants.length>=t.capacity)}\r\n                    onClick={()=> { if (!hasJoined(t)) { join(t) } else if (isTouch) { setLeaveAsk({ open: true, t }) } }}\r\n                    onDoubleClick={()=> { if (!isTouch && hasJoined(t)) setLeaveAsk({ open: true, t }) }}\r\n                  >{hasJoined(t) ? 'Already Joined' : 'Join Now'}</button>\r\n                  {/* Delete button for creator to delete their own scheduled tournament */}\r\n                  {(t.status==='scheduled' && email && t.creatorEmail && String(t.creatorEmail).toLowerCase()===email) && (\r\n                    <button\r\n                      className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\r\n                      title=\"Delete this tournament\"\r\n                      onClick={()=>deleteTournament(t)}\r\n                      aria-label=\"Delete tournament\"\r\n                    >×</button>\r\n                  )}\r\n                </div>\r\n              </li>\r\n            ))}\r\n            {community.length === 0 && <li className=\"text-sm opacity-60\">No community tournaments yet.</li>}\r\n          </ul>\r\n        </section>\r\n      </div>\r\n\r\n      {showCreate && (\r\n        <div className=\"mb-4\">\r\n          <div className=\"card relative\">\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n              <h3 className=\"text-xl font-semibold\">Create Tournament</h3>\r\n              <button className=\"btn\" onClick={()=>setShowCreate(false)}>Close</button>\r\n            </div>\r\n            <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 pr-1\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Title</label>\r\n                <input className=\"input w-full\" value={form.title} onChange={e=>setForm(f=>({ ...f, title: e.target.value }))} />\r\n              </div>\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Game</label>\r\n                  <select className=\"input w-full\" value={form.game} onChange={e=>setForm(f=>({ ...f, game: e.target.value }))}>\r\n                    {['X01','Around the Clock','Cricket','Halve It','Shanghai','High-Low','Killer'].map(g => <option key={g} value={g}>{g}</option>)}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Mode</label>\r\n                  <select className=\"input w-full\" value={form.mode} onChange={e=>setForm(f=>({ ...f, mode: e.target.value as any }))}>\r\n                    <option value=\"bestof\">Best of</option>\r\n                    <option value=\"firstto\">First to</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Number</label>\r\n                  <input className=\"input w-full\" type=\"number\" min={1} value={form.value} onChange={e=>setForm(f=>({ ...f, value: Number(e.target.value) }))} />\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Description</label>\r\n                <textarea className=\"input w-full\" rows={5} value={form.description} onChange={e=>setForm(f=>({ ...f, description: e.target.value }))} />\r\n              </div>\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Start time</label>\r\n                  <input className=\"input w-full\" type=\"datetime-local\" value={form.startAt} onChange={e=>setForm(f=>({ ...f, startAt: e.target.value }))} />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Check-in reminder (min)</label>\r\n                  <input className=\"input w-full\" type=\"number\" min={0} value={form.checkinMinutes} onChange={e=>setForm(f=>({ ...f, checkinMinutes: Number(e.target.value) }))} />\r\n                </div>\r\n              </div>\r\n              {form.game==='X01' && (\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">X01 Starting Score</label>\r\n                  <select className=\"input w-full\" value={String(form.startingScore)} onChange={e=>setForm(f=>({ ...f, startingScore: Number(e.target.value) }))}>\r\n                    {[301, 501, 701].map(s => <option key={s} value={s}>{s}</option>)}\r\n                  </select>\r\n                </div>\r\n              )}\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Capacity</label>\r\n                <input className=\"input w-full\" type=\"number\" min={6} max={64} value={form.capacity} onChange={e=>setForm(f=>({ ...f, capacity: Number(e.target.value) }))} />\r\n              </div>\r\n              <div className=\"text-xs opacity-70\">Note: community tournaments do not award prizes.</div>\r\n              <div className=\"flex justify-end\">\r\n                <button className=\"btn\" disabled={loading} onClick={createTournament}>Create</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {leaveAsk.open && leaveAsk.t && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 bg-black/40\" onClick={()=>setLeaveAsk({ open: false, t: null })} />\r\n          <div className=\"relative card p-4 w-[360px] max-w-[90vw]\">\r\n            <div className=\"text-lg font-semibold mb-2\">Leave tournament?</div>\r\n            <div className=\"text-sm opacity-80 mb-4\">Are you sure you want to remove yourself from “{leaveAsk.t.title}”?</div>\r\n            <div className=\"flex items-center justify-end gap-2\">\r\n              <button\r\n                className=\"btn bg-rose-600 hover:bg-rose-700\"\r\n                onClick={()=>setLeaveAsk({ open: false, t: null })}\r\n              >Decline</button>\r\n              <button\r\n                className=\"btn bg-emerald-600 hover:bg-emerald-700\"\r\n                onClick={async ()=>{ const t = leaveAsk.t!; setLeaveAsk({ open: false, t: null }); await leave(t) }}\r\n              >Accept</button>\r\n            </div>\r\n        </div>\r\n      </div>\r\n      )}\r\n\r\n      {/* Delete Tournament Confirmation Modal */}\r\n      {deleteConfirm.open && deleteConfirm.t && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\r\n            <div className=\"text-center\">\r\n              <div className=\"text-xl font-semibold mb-4 text-white\">Delete Tournament</div>\r\n              <div className=\"text-slate-300 mb-6\">\r\n                Are you sure you want to delete <span className=\"font-semibold text-white\">\"{deleteConfirm.t.title}\"</span>?\r\n                <br />\r\n                <span className=\"text-sm text-slate-400\">This action cannot be undone.</span>\r\n              </div>\r\n              <div className=\"flex gap-3 justify-center\">\r\n                <button\r\n                  className=\"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\r\n                  onClick={() => setDeleteConfirm({ open: false, t: null })}\r\n                >\r\n                  Decline\r\n                </button>\r\n                <button\r\n                  className=\"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors\"\r\n                  onClick={confirmDeleteTournament}\r\n                >\r\n                  Continue\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}","import { useEffect, useState } from 'react';\r\nimport { useToast } from '../store/toast';\r\n\r\nexport default function AdminAccess({ user }: { user?: any }) {\r\n  const [subscription, setSubscription] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n  const toast = useToast();\r\n\r\n  useEffect(() => {\r\n    const fetchSubscription = async () => {\r\n      try {\r\n        const q = user?.email ? `?email=${encodeURIComponent(user.email)}` : '';\r\n        const res = await fetch(`${API_URL}/api/subscription` + q);\r\n        if (!res.ok) throw new Error('Failed to fetch subscription');\r\n        const data = await res.json();\r\n        setSubscription(data);\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err.message : 'Something went wrong');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchSubscription();\r\n  }, [user?.email]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"card\">\r\n        <div className=\"text-center py-8\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-4\"></div>\r\n          <p>Loading subscription...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"card\">\r\n        <h2 className=\"text-2xl font-bold text-red-300 mb-2\">Subscription Error</h2>\r\n        <p className=\"mb-4 text-red-200\">{error}</p>\r\n        <button \r\n          onClick={() => window.location.reload()} \r\n          className=\"btn bg-red-600 hover:bg-red-700\"\r\n        >\r\n          Retry\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const hasAccess = subscription?.fullAccess;\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-indigo-300 mb-2\">\r\n        {hasAccess ? 'PREMIUM Active' : 'PREMIUM'}\r\n      </h2>\r\n      \r\n      {hasAccess ? (\r\n        <div className=\"mb-4\">\r\n          <div className=\"bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4\">\r\n            <div className=\"flex items-center gap-2 text-green-300 font-semibold mb-2\">\r\n              ✅ PREMIUM Access Active\r\n            </div>\r\n            <p className=\"text-green-200 text-sm\">\r\n              You have full access to all premium features!\r\n            </p>\r\n            {subscription?.source && (\r\n              <p className=\"text-green-200 text-xs mt-1\">\r\n                Source: {subscription.source}\r\n                {subscription?.expiresAt && ` (expires: ${new Date(subscription.expiresAt).toLocaleDateString()})`}\r\n              </p>\r\n            )}\r\n          </div>\r\n          \r\n          <h3 className=\"text-lg font-semibold mb-2 text-indigo-200\">Your Benefits:</h3>\r\n        </div>\r\n      ) : (\r\n        <p className=\"mb-2 text-indigo-200\">Unlock every game mode known to darts, advanced stats, and premium features.</p>\r\n      )}\r\n      \r\n      <ul className=\"mb-4\">\r\n        <li>All game modes (including paid/advanced)</li>\r\n        <li>Online play with all rules and variations</li>\r\n        <li>Advanced analytics and leaderboards</li>\r\n        <li>Premium camera modes and autoscoring</li>\r\n      </ul>\r\n\r\n      {!hasAccess && (\r\n        <button\r\n          onClick={async () => {\r\n            try {\r\n              const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ email: user.email })\r\n              });\r\n              const data = await res.json();\r\n              if (data.ok && data.url) {\r\n                window.location.href = data.url;\r\n              } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                toast(\"Premium purchases are not available. Payment link not configured.\", { type: 'error', timeout: 4000 });\r\n              } else {\r\n                toast(\"Failed to get payment link. Please try again.\", { type: 'error', timeout: 4000 });\r\n              }\r\n            } catch (err) {\r\n              toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n            }\r\n          }}\r\n          className=\"btn bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold shadow-lg hover:scale-105 transition\"\r\n        >\r\n          Subscribe to PREMIUM\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}","import React, { useEffect, type ReactNode } from 'react'\r\n\r\ntype DrawerProps = {\r\n  open: boolean\r\n  onClose: () => void\r\n  width?: number | string\r\n  title?: string\r\n  footer?: ReactNode\r\n  children: ReactNode\r\n  side?: 'left' | 'right'\r\n}\r\n\r\nexport default function Drawer({ open, onClose, width = 700, title, footer, children, side = 'right' }: DrawerProps) {\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) { if (e.key === 'Escape') onClose() }\r\n    if (open) document.addEventListener('keydown', onKey)\r\n    return () => document.removeEventListener('keydown', onKey)\r\n  }, [open, onClose])\r\n\r\n  return (\r\n    <div className={`fixed inset-0 z-50 ${open ? '' : 'pointer-events-none'}`} aria-hidden={!open}>\r\n      {/* Backdrop */}\r\n      <div className={`absolute inset-0 bg-black/60 transition-opacity ${open ? 'opacity-100' : 'opacity-0'}`} onClick={onClose} />\r\n      {/* Panel */}\r\n      <div\r\n        className={`absolute top-0 ${side==='right' ? 'right-0 border-l' : 'left-0 border-r'} h-full bg-slate-900 border-slate-700 shadow-2xl w-full sm:w-auto flex flex-col transition-transform duration-200 ${open ? 'translate-x-0' : (side==='right' ? 'translate-x-full' : '-translate-x-full')}`}\r\n        style={{ width: typeof width === 'number' ? `${width}px` : width }}\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n      >\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-700 sticky top-0 bg-slate-900 z-10\">\r\n          <div className=\"text-lg font-semibold\">{title}</div>\r\n          <button className=\"btn px-3 py-1 text-sm\" onClick={onClose}>Close</button>\r\n        </div>\r\n        {/* Body */}\r\n        <div className=\"flex-1 overflow-auto p-4\">\r\n          {children}\r\n        </div>\r\n        {/* Footer */}\r\n        {footer && (\r\n          <div className=\"px-4 py-3 border-t border-slate-700 sticky bottom-0 bg-slate-900 z-10\">\r\n            {footer}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useState } from 'react'\r\nimport { useIsAdmin } from '../utils/admin'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype Ready = { ok: boolean; ws?: boolean; rooms?: number; clients?: number; mem?: { rss: number; heapUsed: number } }\r\n\r\nexport default function OpsDashboard({ user }: { user: any }) {\r\n  const isAdmin = useIsAdmin(user?.email)\r\n  const [ready, setReady] = useState<Ready|null>(null)\r\n  const [ann, setAnn] = useState<string>('')\r\n  const [msg, setMsg] = useState<string>('')\r\n\r\n  async function refresh() {\r\n    try {\r\n      const res = await apiFetch('/readyz')\r\n      setReady(await res.json())\r\n    } catch {}\r\n  }\r\n  useEffect(() => {\r\n    refresh()\r\n    const id = setInterval(refresh, 5000)\r\n    return () => clearInterval(id)\r\n  }, [])\r\n\r\n  if (!isAdmin) return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\r\n      <div>Restricted</div>\r\n    </div>\r\n  )\r\n\r\n  async function toggleMaintenance(enabled: boolean) {\r\n    setMsg('')\r\n    try {\r\n      const res = await apiFetch('/api/admin/maintenance', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ enabled, requesterEmail: user?.email }) })\r\n      const j = await res.json()\r\n      if (!res.ok || !j?.ok) setMsg(j?.error || 'Failed')\r\n      else setMsg(`Maintenance ${enabled ? 'enabled' : 'disabled'}`)\r\n    } catch { setMsg('Network error') }\r\n  }\r\n\r\n  async function announce() {\r\n    setMsg('')\r\n    const text = ann.trim()\r\n    if (!text) return\r\n    try {\r\n      const res = await apiFetch('/api/admin/announce', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: text, requesterEmail: user?.email }) })\r\n      const j = await res.json()\r\n      if (!res.ok || !j?.ok) setMsg(j?.error || 'Failed')\r\n      else setMsg('Announcement broadcasted')\r\n      setAnn('')\r\n    } catch { setMsg('Network error') }\r\n  }\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Readiness</div>\r\n          <div className=\"text-sm\">HTTP: <span className={`font-semibold ${ready?.ok ? 'text-emerald-300' : 'text-rose-300'}`}>{String(!!ready?.ok)}</span></div>\r\n          <div className=\"text-sm\">WS: <span className={`font-semibold ${ready?.ws ? 'text-emerald-300' : 'text-rose-300'}`}>{String(!!ready?.ws)}</span></div>\r\n          <div className=\"text-sm\">Clients: <span className=\"font-semibold\">{ready?.clients ?? 0}</span></div>\r\n          <div className=\"text-sm\">Rooms: <span className=\"font-semibold\">{ready?.rooms ?? 0}</span></div>\r\n          <div className=\"text-sm\">Heap Used: <span className=\"font-semibold\">{ready?.mem ? Math.round(ready.mem.heapUsed/1024/1024) : 0} MB</span></div>\r\n        </div>\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Maintenance</div>\r\n          <div className=\"flex gap-2\">\r\n            <button className=\"btn\" onClick={()=>toggleMaintenance(true)}>Enable</button>\r\n            <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={()=>toggleMaintenance(false)}>Disable</button>\r\n          </div>\r\n        </div>\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Announcement</div>\r\n          <div className=\"flex gap-2\">\r\n            <input className=\"input flex-1\" placeholder=\"Message to broadcast\" value={ann} onChange={e=>setAnn(e.target.value)} />\r\n            <button className=\"btn\" onClick={announce}>Send</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {msg && <div className=\"text-xs mt-2\">{msg}</div>}\r\n      <div className=\"text-xs opacity-70 mt-2\">✅ Clustering enabled! For 1.5k+ concurrent users, deploy behind a reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets. Set NODE_WORKERS environment variable to control worker count.</div>\r\n    </div>\r\n  )\r\n}\r\n","import React, { useState } from 'react';\r\nimport { HelpCircle, MessageCircle, X, Send } from 'lucide-react';\r\n\r\ninterface HelpAssistantProps {}\r\n\r\nexport default function HelpAssistant({}: HelpAssistantProps) {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [messages, setMessages] = useState<Array<{text: string | {text: string, links?: Array<{text: string, tab: string}>}, isUser: boolean}>>([\r\n    { text: \"Hi! I'm your Nine Dart Nation assistant. How can I help you today?\", isUser: false }\r\n  ]);\r\n  const [input, setInput] = useState('');\r\n\r\n  const faq = {\r\n    'how to play': 'To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.',\r\n    'calibration': 'Go to Settings > Camera & Vision > Calibration Guide to set up your camera properly.',\r\n    'premium': 'Premium unlocks all game modes. Click the \"Upgrade to PREMIUM\" button in online play.',\r\n    'username': 'Change your username once for free in Settings > Account.',\r\n    'voice': 'Enable voice caller in Settings > Audio & Voice. Test the voice with the Test Voice button.',\r\n    'friends': 'Add friends in the Friends tab to play together.',\r\n    'stats': 'View your statistics in the Stats tab.',\r\n    'settings': 'Customize your experience in the Settings panel.',\r\n    'support': 'Contact support via email or check the FAQ in Settings > Support.',\r\n  };\r\n\r\n  const navigateToTab = (tabKey: string) => {\r\n    try {\r\n      window.dispatchEvent(new CustomEvent('ndn:change-tab', { detail: { tab: tabKey } }));\r\n      setIsOpen(false); // Close the help modal after navigation\r\n    } catch (error) {\r\n      console.error('Navigation failed:', error);\r\n    }\r\n  };\r\n\r\n  const getResponseWithLinks = (userMessage: string): { text: string, links?: Array<{ text: string, tab: string }> } => {\r\n    const message = userMessage.toLowerCase();\r\n\r\n    if (message.includes('username') || message.includes('change name')) {\r\n      return {\r\n        text: 'You can change your username once for free.',\r\n        links: [{ text: 'Go to Settings > Account', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('premium') || message.includes('upgrade') || message.includes('subscription')) {\r\n      return {\r\n        text: 'Premium unlocks all game modes and features.',\r\n        links: [{ text: 'Go to Online Play', tab: 'online' }]\r\n      };\r\n    }\r\n    if (message.includes('calibrat') || message.includes('camera') || message.includes('vision')) {\r\n      return {\r\n        text: 'Set up your camera properly in Settings.',\r\n        links: [{ text: 'Go to Settings > Camera & Vision', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('voice') || message.includes('caller') || message.includes('audio')) {\r\n      return {\r\n        text: 'Enable voice calling in Settings.',\r\n        links: [{ text: 'Go to Settings > Audio & Voice', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('friend') || message.includes('play together')) {\r\n      return {\r\n        text: 'Add friends to play together.',\r\n        links: [{ text: 'Go to Friends', tab: 'friends' }]\r\n      };\r\n    }\r\n    if (message.includes('stat') || message.includes('score') || message.includes('performance')) {\r\n      return {\r\n        text: 'View your statistics and performance.',\r\n        links: [{ text: 'Go to Stats', tab: 'stats' }]\r\n      };\r\n    }\r\n    if (message.includes('setting') || message.includes('customiz') || message.includes('configur')) {\r\n      return {\r\n        text: 'Customize your experience.',\r\n        links: [{ text: 'Go to Settings', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('tournament') || message.includes('competition')) {\r\n      return {\r\n        text: 'Check out tournaments and competitions.',\r\n        links: [{ text: 'Go to Tournaments', tab: 'tournaments' }]\r\n      };\r\n    }\r\n    if (message.includes('help') || message.includes('support') || message.includes('faq')) {\r\n      return {\r\n        text: 'You\\'re already in the help section! Check Settings for more resources.',\r\n        links: [{ text: 'Go to Settings > Support', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('how to play') || message.includes('game') || message.includes('start')) {\r\n      return {\r\n        text: 'To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.',\r\n        links: [\r\n          { text: 'Play Online', tab: 'online' },\r\n          { text: 'Play Offline', tab: 'offline' }\r\n        ]\r\n      };\r\n    }\r\n\r\n    return { text: \"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings.\" };\r\n  };\r\n\r\n  const handleSend = () => {\r\n    if (!input.trim()) return;\r\n    const userMessage = input.toLowerCase();\r\n    setMessages(prev => [...prev, { text: input, isUser: true }]);\r\n    setInput('');\r\n\r\n    // Get response with smart link suggestions\r\n    const response = getResponseWithLinks(userMessage);\r\n\r\n    setTimeout(() => {\r\n      setMessages(prev => [...prev, { text: response, isUser: false }]);\r\n    }, 500);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Floating Button */}\r\n      <button\r\n        onClick={() => setIsOpen(true)}\r\n        className=\"fixed bottom-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-colors\"\r\n        title=\"Help Assistant\"\r\n      >\r\n        <HelpCircle className=\"w-6 h-6\" />\r\n      </button>\r\n\r\n      {/* Modal */}\r\n      {isOpen && (\r\n        <div className=\"fixed inset-0 z-50 flex items-end justify-end p-4\">\r\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setIsOpen(false)} />\r\n          <div className=\"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-md h-96 flex flex-col\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between p-4 border-b border-slate-700\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <MessageCircle className=\"w-5 h-5 text-blue-400\" />\r\n                <span className=\"font-semibold\">Help Assistant</span>\r\n              </div>\r\n              <button\r\n                onClick={() => setIsOpen(false)}\r\n                className=\"text-slate-400 hover:text-white\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Messages */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\r\n              {messages.map((msg, i) => (\r\n                <div key={i} className={`flex ${msg.isUser ? 'justify-end' : 'justify-start'}`}>\r\n                  <div className={`max-w-xs px-3 py-2 rounded-lg ${\r\n                    msg.isUser \r\n                      ? 'bg-blue-600 text-white' \r\n                      : 'bg-slate-700 text-slate-200'\r\n                  }`}>\r\n                    {typeof msg.text === 'string' ? (\r\n                      msg.text\r\n                    ) : (\r\n                      <div className=\"space-y-2\">\r\n                        <div>{msg.text.text}</div>\r\n                        {msg.text.links && (\r\n                          <div className=\"space-y-1\">\r\n                            {msg.text.links.map((link, linkIndex) => (\r\n                              <button\r\n                                key={linkIndex}\r\n                                onClick={() => navigateToTab(link.tab)}\r\n                                className=\"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm\"\r\n                              >\r\n                                {link.text}\r\n                              </button>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Input */}\r\n            <div className=\"p-4 border-t border-slate-700\">\r\n              <div className=\"flex gap-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={input}\r\n                  onChange={(e) => setInput(e.target.value)}\r\n                  onKeyPress={(e) => e.key === 'Enter' && handleSend()}\r\n                  placeholder=\"Ask me anything...\"\r\n                  className=\"flex-1 input\"\r\n                />\r\n                <button\r\n                  onClick={handleSend}\r\n                  className=\"btn bg-blue-600 hover:bg-blue-700\"\r\n                >\r\n                  <Send className=\"w-4 h-4\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}","import { useEffect, useRef, useState } from 'react'\r\nimport { Sidebar, TabKey } from './components/Sidebar'\r\nimport Home from './components/Home'\r\nimport ScrollFade from './components/ScrollFade'\r\nimport Calibrator from './components/Calibrator'\r\nimport OfflinePlay from './components/OfflinePlay'\r\nimport Friends from './components/Friends'\r\nimport Toaster from './components/Toaster'\r\nimport AdminDashboard from './components/AdminDashboard'\r\nimport SettingsPanel from './components/SettingsPanel'\r\nimport Auth from './components/Auth'\r\nimport { ThemeProvider } from './components/ThemeContext'\r\nimport { useWS } from './components/WSProvider'\r\nimport StatusDot from './components/ui/StatusDot'\r\nimport { getRollingAvg, getAllTimeAvg } from './store/profileStats'\r\nimport { useUserSettings } from './store/userSettings'\r\nimport './styles/premium.css'\r\nimport Scoreboard from './components/Scoreboard'\r\nimport CameraView from './components/CameraView'\r\nimport OnlinePlay from './components/OnlinePlay'\r\nimport MatchSettings from './components/MatchSettings'\r\nimport StatsPanel from './components/StatsPanel'\r\nimport Tournaments from './components/Tournaments'\r\nimport AdminAccess from './components/AdminAccess'\r\n// AdminAccess already imported above\r\nimport Drawer from './components/ui/Drawer'\r\nimport { getDominantColorFromImage, stringToColor } from './utils/color'\r\nimport OpsDashboard from './components/OpsDashboard'\r\nimport HelpAssistant from './components/HelpAssistant'\r\n\r\nexport default function App() {\r\n  const appRef = useRef<HTMLDivElement | null>(null);\r\n  const [avatar, setAvatar] = useState<string>('');\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null);\r\n  const ws = (() => { try { return useWS() } catch { return null } })()\r\n  const [tab, setTab] = useState<TabKey>('score')\r\n  const [isMobile, setIsMobile] = useState<boolean>(false)\r\n  const [navOpen, setNavOpen] = useState<boolean>(false)\r\n  const [user, setUser] = useState<any>(null)\r\n  const [allTimeAvg, setAllTimeAvg] = useState<number>(0)\r\n  const { avgMode } = useUserSettings()\r\n\r\n\r\n  // Restore user from token on mount\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('authToken');\r\n    if (token) {\r\n      // Validate token with server\r\n      const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n      fetch(`${API_URL}/api/auth/me`, {\r\n        headers: { 'Authorization': `Bearer ${token}` }\r\n      })\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data?.user) {\r\n          setUser(data.user);\r\n          fetchSubscription(data.user);\r\n        } else {\r\n          // Token invalid, remove it\r\n          localStorage.removeItem('authToken');\r\n        }\r\n      })\r\n      .catch(() => {\r\n        // Network error, keep token for offline retry\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const onLogout = () => {\r\n      try {\r\n        localStorage.removeItem('mockUser');\r\n        localStorage.removeItem('authToken');\r\n      } catch {}\r\n      setUser(null);\r\n      setTab('score');\r\n    };\r\n    window.addEventListener('ndn:logout' as any, onLogout as any);\r\n    return () => window.removeEventListener('ndn:logout' as any, onLogout as any);\r\n  }, []);\r\n  // Refresh all-time avg when user changes or stats update\r\n  useEffect(() => {\r\n    if (!user?.username) return\r\n    const refresh = () => setAllTimeAvg(avgMode === '24h' ? getRollingAvg(user.username) : getAllTimeAvg(user.username))\r\n    refresh()\r\n    const onUpdate = () => refresh()\r\n    window.addEventListener('ndn:stats-updated', onUpdate as any)\r\n    return () => window.removeEventListener('ndn:stats-updated', onUpdate as any)\r\n  }, [user?.username, avgMode])\r\n\r\n  // Load avatar from localStorage when user changes\r\n  useEffect(() => {\r\n    if (!user?.username) {\r\n      setAvatar('');\r\n      return;\r\n    }\r\n    const storedAvatar = localStorage.getItem(`ndn:bio:profilePhoto:${user.username}`);\r\n    setAvatar(storedAvatar || '');\r\n  }, [user?.username])\r\n\r\n  // Listen for avatar updates from SettingsPanel\r\n  useEffect(() => {\r\n    const handleStorageChange = (e: StorageEvent) => {\r\n      if (e.key?.startsWith('ndn:bio:profilePhoto:') && user?.username && e.key.endsWith(user.username)) {\r\n        setAvatar(e.newValue || '');\r\n      }\r\n    };\r\n    const handleAvatarUpdate = (e: any) => {\r\n      // Check if this update is for the current user\r\n      if (e.detail?.username === user?.username) {\r\n        setAvatar(e.detail?.avatar || '');\r\n      }\r\n      // Also check localStorage as backup for any avatar update\r\n      if (user?.username) {\r\n        const storedAvatar = localStorage.getItem(`ndn:bio:profilePhoto:${user.username}`);\r\n        setAvatar(storedAvatar || '');\r\n      }\r\n    };\r\n    // Also check localStorage when window becomes visible (user switches tabs)\r\n    const handleVisibilityChange = () => {\r\n      if (!document.hidden && user?.username) {\r\n        const storedAvatar = localStorage.getItem(`ndn:bio:profilePhoto:${user.username}`);\r\n        setAvatar(storedAvatar || '');\r\n      }\r\n    };\r\n    \r\n    // Check localStorage every 2 seconds as a fallback\r\n    const checkAvatarInterval = setInterval(() => {\r\n      if (user?.username) {\r\n        const storedAvatar = localStorage.getItem(`ndn:bio:profilePhoto:${user.username}`);\r\n        if (storedAvatar && storedAvatar !== avatar) {\r\n          setAvatar(storedAvatar);\r\n        }\r\n      }\r\n    }, 2000);\r\n    \r\n    window.addEventListener('storage', handleStorageChange);\r\n    window.addEventListener('ndn:avatar-updated' as any, handleAvatarUpdate as any);\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    return () => {\r\n      window.removeEventListener('storage', handleStorageChange);\r\n      window.removeEventListener('ndn:avatar-updated' as any, handleAvatarUpdate as any);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      clearInterval(checkAvatarInterval);\r\n    };\r\n  }, [user?.username, avatar]);\r\n\r\n  // Handle payment success for username change\r\n  useEffect(() => {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const paid = urlParams.get('paid');\r\n    const usernameChange = urlParams.get('username-change');\r\n    if (paid === '1' || paid === 'username-change' || usernameChange === 'free') {\r\n      const pendingUsername = localStorage.getItem('pendingUsernameChange');\r\n      if (pendingUsername && user?.email) {\r\n        // Call the change username API\r\n        const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n        fetch(`${API_URL}/api/change-username`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ email: user.email, newUsername: pendingUsername })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n          if (data.ok) {\r\n            alert('Username changed successfully!');\r\n            localStorage.removeItem('pendingUsernameChange');\r\n            // Update user data and token\r\n            if (data.token) {\r\n              localStorage.setItem('authToken', data.token);\r\n            }\r\n            if (data.user) {\r\n              setUser(data.user);\r\n            }\r\n            // Clean up URL\r\n            window.history.replaceState({}, document.title, window.location.pathname);\r\n          } else {\r\n            alert('Failed to change username: ' + (data.error || 'Unknown error'));\r\n          }\r\n        })\r\n        .catch(() => {\r\n          alert('Network error while changing username');\r\n        });\r\n      }\r\n    }\r\n  }, [user?.email]);\r\n\r\n  // Handle payment success for premium subscription\r\n  useEffect(() => {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const subscription = urlParams.get('subscription');\r\n    if (subscription === 'success' && user?.email) {\r\n      // Refresh user data to get updated subscription status\r\n      const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n      fetch(`${API_URL}/api/auth/me`, {\r\n        headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }\r\n      })\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data?.user) {\r\n          setUser(data.user);\r\n          alert('Premium subscription activated successfully!');\r\n          // Clean up URL\r\n          window.history.replaceState({}, document.title, window.location.pathname);\r\n        }\r\n      })\r\n      .catch(() => {\r\n        alert('Subscription activated, but failed to refresh user data. Please refresh the page.');\r\n      });\r\n    }\r\n  }, [user?.email]);\r\n\r\n  // Detect mobile/tablet layout via comprehensive device detection\r\n  useEffect(() => {\r\n    const update = () => {\r\n      const width = window.innerWidth\r\n      const height = window.innerHeight\r\n      const pixelRatio = window.devicePixelRatio || 1\r\n\r\n      // Comprehensive mobile/tablet detection\r\n      const mqMobile = window.matchMedia('(max-width: 768px)').matches\r\n      const mqTablet = window.matchMedia('(max-width: 1024px) and (min-width: 769px)').matches\r\n      const uaMobile = /Mobi|Android|iPhone|iPad|iPod|Mobile|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent || '')\r\n      const uaTablet = /iPad|Android(?=.*\\bMobile\\b)|Tablet|PlayBook|Silk/i.test(navigator.userAgent || '')\r\n      const touchScreen = 'ontouchstart' in window || navigator.maxTouchPoints > 0\r\n      const smallScreen = width < 1025\r\n      const verySmallScreen = width < 769\r\n\r\n      // Determine device type\r\n      const isTablet = (mqTablet && touchScreen) || uaTablet || (width >= 769 && width <= 1024 && touchScreen)\r\n      const isMobile = mqMobile || uaMobile || verySmallScreen || (width < 769 && touchScreen)\r\n      const isMobileDevice = isMobile || isTablet\r\n\r\n      setIsMobile(isMobileDevice)\r\n    }\r\n    update()\r\n    window.addEventListener('resize', update)\r\n    window.addEventListener('orientationchange', update)\r\n\r\n    const mqMobile = window.matchMedia('(max-width: 768px)')\r\n    const mqTablet = window.matchMedia('(max-width: 1024px) and (min-width: 769px)')\r\n\r\n    try {\r\n      mqMobile.addEventListener('change', update)\r\n      mqTablet.addEventListener('change', update)\r\n    } catch {}\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', update)\r\n      window.removeEventListener('orientationchange', update)\r\n      try {\r\n        mqMobile.removeEventListener('change', update)\r\n        mqTablet.removeEventListener('change', update)\r\n      } catch {}\r\n    }\r\n  }, [])\r\n\r\n  // Global logout handler: return to sign-in screen and clear minimal local user context\r\n  useEffect(() => {\r\n    const onLogout = () => {\r\n      try {\r\n        // Clear any lightweight local flags (keep stats unless explicitly reset)\r\n        localStorage.removeItem('ndn:avatar')\r\n      } catch {}\r\n      setUser(null)\r\n      setTab('score')\r\n    }\r\n    window.addEventListener('ndn:logout' as any, onLogout as any)\r\n    return () => window.removeEventListener('ndn:logout' as any, onLogout as any)\r\n  }, [])\r\n\r\n  // Apply username changes from Settings globally and propagate via WS presence\r\n  useEffect(() => {\r\n    const onName = (e: any) => {\r\n      try {\r\n        const next = String(e?.detail?.username || '').trim()\r\n        if (!next) return\r\n        setUser((prev: any) => {\r\n          const u = prev ? { ...prev, username: next } : prev\r\n          return u\r\n        })\r\n        // Recompute name color on next effect pass based on new username/avatar\r\n        // Send presence update so friends/lobby reflect the new name\r\n        try {\r\n          const email = (user?.email || '').toLowerCase()\r\n          if (ws && next && email) ws.send({ type: 'presence', username: next, email })\r\n        } catch {}\r\n      } catch {}\r\n    }\r\n    window.addEventListener('ndn:username-changed' as any, onName as any)\r\n    return () => window.removeEventListener('ndn:username-changed' as any, onName as any)\r\n  }, [ws, user?.email])\r\n\r\n  // Handle tab changes from Home component quick access pills\r\n  useEffect(() => {\r\n    const onTabChange = (e: any) => {\r\n      try {\r\n        const tab = String(e?.detail?.tab || '').trim()\r\n        if (tab && ['score', 'offline', 'online', 'stats', 'settings', 'admin', 'tournaments', 'friends'].includes(tab)) {\r\n          setTab(tab as TabKey)\r\n        }\r\n      } catch {}\r\n    }\r\n    window.addEventListener('ndn:change-tab' as any, onTabChange as any)\r\n    return () => window.removeEventListener('ndn:change-tab' as any, onTabChange as any)\r\n  }, [])\r\n\r\n  async function fetchSubscription(u: any) {\r\n    try {\r\n      const q = u?.email ? `?email=${encodeURIComponent(u.email)}` : ''\r\n      const res = await fetch('/api/subscription' + q);\r\n      if (!res.ok) return;\r\n      const data = await res.json();\r\n      setUser({ ...u, fullAccess: !!data?.fullAccess });\r\n    } catch {}\r\n  }\r\n\r\n  if (!user) {\r\n    return <Auth onAuth={(u:any) => { setUser(u); fetchSubscription(u); }} />;\r\n  }\r\n  const fallbackAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username||'NDN')}&background=8F43EE&color=fff&bold=true&rounded=true&size=64`\r\n  return (\r\n    <ThemeProvider>\r\n  <div ref={appRef} className={`${user?.fullAccess ? 'premium-body' : ''} h-screen overflow-hidden p-1 xs:p-2 sm:p-3 md:p-4`}>\r\n        <Toaster />\r\n  <div className=\"max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-[auto,1fr] gap-2 xs:gap-3 sm:gap-4 h-full overflow-hidden\">\r\n          {/* Desktop sidebar; hidden on mobile/tablet */}\r\n          {!isMobile && (\r\n            <div className=\"relative hidden lg:block\" style={{ width: 240 }}>\r\n              <Sidebar active={tab} onChange={(k)=>{ setTab(k); }} user={user} />\r\n            </div>\r\n          )}\r\n          {/* Wrap header + scroller in a column so header stays static and only content scrolls below it */}\r\n          <div className=\"flex flex-col h-full overflow-hidden\">\r\n            <div className=\"pt-1 xs:pt-2\">\r\n            <header id=\"ndn-header\" className={`header glass flex-col xs:flex-col sm:flex-row gap-2 xs:gap-2 sm:gap-3`}>\r\n              {/* Left: Brand */}\r\n              <div className=\"flex items-center gap-2 order-1\">\r\n                <h1\r\n                  className=\"text-lg xs:text-xl sm:text-xl md:text-2xl font-bold text-brand-700 whitespace-nowrap cursor-pointer select-none\"\r\n                  onClick={() => { if (isMobile) setTab('score') }}\r\n                  title={isMobile ? 'Go Home' : undefined}\r\n                >\r\n                  NINE-DART-NATION 🎯\r\n                </h1>\r\n              </div>\r\n              {/* Middle: Welcome band (full width on mobile) */}\r\n              <div className=\"order-3 xs:order-3 sm:order-2 w-full sm:w-auto flex-1 flex flex-col items-center justify-center text-center sm:text-left !text-black\">\r\n                <span className=\"text-sm xs:text-base sm:text-base md:text-lg font-semibold flex items-center gap-2 max-w-full truncate !text-black\" style={{ color: '#000000', WebkitTextFillColor: '#000000' }}>\r\n                  <span className=\"hidden xs:inline !text-black\">Welcome</span>\r\n                  <img src={avatar || fallbackAvatar} alt=\"avatar\" className=\"w-5 h-5 xs:w-6 xs:h-6 sm:w-6 sm:h-6 md:w-7 md:h-7 rounded-full ring-2 ring-white/20\" />\r\n                  <span className=\"truncate !text-black\" style={{ color: '#000000', WebkitTextFillColor: '#000000' }}>{user.username}🎯</span>\r\n                </span>\r\n                <span className=\"hidden xs:inline text-xs xs:text-xs sm:text-xs md:text-sm !text-black\" style={{ color: '#000000', WebkitTextFillColor: '#000000' }}>All-time 3-dart avg: <span className=\"font-semibold !text-black\" style={{ color: '#000000', WebkitTextFillColor: '#000000' }}>{allTimeAvg.toFixed(2)}</span></span>\r\n                {isMobile && (\r\n                  <button\r\n                    className=\"btn px-3 py-1 xs:px-3 xs:py-1 sm:px-3 sm:py-1 mt-1 text-sm xs:text-sm\"\r\n                    aria-label=\"Open navigation\"\r\n                    onClick={()=> setNavOpen(true)}\r\n                  >☰ Menu</button>\r\n                )}\r\n              </div>\r\n              {/* Right: Status + Actions */}\r\n              <div className=\"order-2 md:order-3 ml-0 md:ml-auto flex items-center gap-2 flex-wrap\">\r\n                <button\r\n                  className=\"px-3 py-1 text-sm rounded-full bg-white/5 hover:bg-white/10 border border-white/10\"\r\n                  onClick={() => {\r\n                    const el = appRef.current\r\n                    if (!el) return\r\n                    if (!document.fullscreenElement) el.requestFullscreen().catch(()=>{})\r\n                    else document.exitFullscreen().catch(()=>{})\r\n                  }}\r\n                  title={isFullscreen ? 'Exit Full Screen' : 'Enter Full Screen'}\r\n                >{isFullscreen ? 'Exit Full Screen' : 'Full Screen'}</button>\r\n                {tab === 'online' && (\r\n                  <button\r\n                    className=\"text-[10px] md:text-xs px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40\"\r\n                    title=\"Open a simulated online match\"\r\n                    onClick={() => {\r\n                      setTimeout(() => {\r\n                        try { window.dispatchEvent(new CustomEvent('ndn:online-match-demo', { detail: { game: 'X01', start: 501 } })) } catch {}\r\n                      }, 40)\r\n                    }}\r\n                  >ONLINE DEMO</button>\r\n                )}\r\n                {ws ? (\r\n                  <span className=\"ml-0 md:ml-2\"><StatusDot status={ws.status} /></span>\r\n                ) : null}\r\n                {httpsInfo?.https ? (\r\n                  <span className=\"text-[10px] md:text-xs px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/40\" title={`Phone HTTPS active on :${httpsInfo.port}`}>HTTPS READY</span>\r\n                ) : (\r\n                  <span className=\"text-[10px] md:text-xs px-3 py-1 rounded-full bg-slate-600/30 text-slate-300 border border-slate-400/30\" title=\"Enable HTTPS for iPhone camera pairing\">HTTP ONLY</span>\r\n                )}\r\n              </div>\r\n            </header>\r\n            </div>\r\n            {/* Mobile drawer navigation */}\r\n            {isMobile && (\r\n              <MobileNav\r\n                open={navOpen}\r\n                onClose={()=> setNavOpen(false)}\r\n                active={tab}\r\n                onChange={(k)=>{ setTab(k); setNavOpen(false) }}\r\n                user={user}\r\n              />\r\n            )}\r\n            <main id=\"ndn-main-scroll\" className=\"space-y-4 flex-1 overflow-y-auto pr-1\">\r\n            {tab === 'settings' && (\r\n              <ScrollFade>\r\n                <SettingsPanel user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'score' && (\r\n              <ScrollFade>\r\n                <Home user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'online' && (\r\n              <ScrollFade>\r\n                <OnlinePlay user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'offline' && (\r\n              <ScrollFade>\r\n                <OfflinePlay user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'calibrate' && (\r\n              <ScrollFade>\r\n                <Calibrator />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'friends' && (\r\n              <ScrollFade>\r\n                <Friends user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'stats' && (\r\n              <ScrollFade>\r\n                <StatsPanel user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'tournaments' && (\r\n              <ScrollFade>\r\n                <Tournaments user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'admin' && (\r\n              <ScrollFade>\r\n                <div className=\"space-y-6\">\r\n                  <AdminDashboard user={user} />\r\n                  <OpsDashboard user={user} />\r\n                </div>\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'fullaccess' && (\r\n              <ScrollFade>\r\n                <AdminAccess user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            </main>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Floating Help Assistant - Always visible */}\r\n      <HelpAssistant />\r\n    </ThemeProvider>\r\n  )\r\n}\r\n\r\n// Lightweight mobile drawer that reuses the same Sidebar\r\nfunction MobileNav({ open, onClose, active, onChange, user }: { open: boolean; onClose: () => void; active: TabKey; onChange: (k: TabKey)=>void; user: any }) {\r\n  return (\r\n    <Drawer open={open} onClose={onClose} width={320} side=\"left\" title=\"Navigate\">\r\n      <div className=\"mt-2\">\r\n        <Sidebar active={active} onChange={onChange} user={user} className=\"flex relative static max-h-[80vh] w-full\" />\r\n      </div>\r\n    </Drawer>\r\n  )\r\n}\r\n","import { useEffect, useState } from 'react'\r\n\r\nfunction validatePassword(password: string) {\r\n  return password.length >= 10 && /\\d/.test(password) && /[^A-Za-z0-9]/.test(password)\r\n}\r\n\r\nexport default function ResetPassword() {\r\n  const [token, setToken] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [confirm, setConfirm] = useState('')\r\n  const [error, setError] = useState('')\r\n  const [success, setSuccess] = useState('')\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const sp = new URLSearchParams(window.location.search)\r\n      const t = sp.get('token') || ''\r\n      setToken(t)\r\n    } catch {}\r\n  }, [])\r\n\r\n  async function onSubmit(e: any) {\r\n    e.preventDefault()\r\n    setError(''); setSuccess('')\r\n    if (!token) { setError('Missing or invalid reset token.'); return }\r\n    if (!password || password !== confirm) { setError('Passwords do not match.'); return }\r\n    if (!validatePassword(password)) { setError('Password must be at least 10 chars and include a number and symbol.'); return }\r\n    try {\r\n      const r = await fetch('/api/auth/confirm-reset', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ token, newPassword: password }) })\r\n      const j = await r.json()\r\n      if (!j?.ok) throw new Error(j?.error || 'Reset failed')\r\n      setSuccess('Password changed. You can now sign in.')\r\n    } catch (e: any) {\r\n      setError(e?.message || 'Reset failed')\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center relative overflow-hidden\">\r\n      <div className=\"background-animated\" />\r\n      <div className=\"relative z-10 w-full max-w-lg mx-auto p-4\">\r\n        <form className=\"card w-full space-y-4\" onSubmit={onSubmit}>\r\n          <div className=\"flex flex-col items-center justify-center gap-2 mb-2 text-center\">\r\n            <h1 className=\"logo text-center\">Reset your password</h1>\r\n          </div>\r\n          {!token && (\r\n            <div className=\"text-red-400\">This reset link is missing a token. Please use the link from your email.</div>\r\n          )}\r\n          <input className=\"input w-full\" type=\"password\" placeholder=\"New password\" value={password} onChange={e=>setPassword(e.target.value)} required />\r\n          <input className=\"input w-full\" type=\"password\" placeholder=\"Confirm password\" value={confirm} onChange={e=>setConfirm(e.target.value)} required />\r\n          {error && <div className=\"text-red-400 font-semibold text-sm\">{error}</div>}\r\n          {success && <div className=\"text-emerald-400 font-semibold text-sm\">{success}</div>}\r\n          <button className=\"btn w-full\" type=\"submit\" disabled={!token}>Change Password</button>\r\n          <a className=\"underline text-sm text-center\" href=\"/\">Back to sign in</a>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { Component, type ReactNode } from 'react'\r\n\r\nexport default class ErrorBoundary extends Component<{\r\n  children: ReactNode\r\n}, { hasError: boolean; message?: string }>{\r\n  constructor(props: any) {\r\n    super(props)\r\n    this.state = { hasError: false }\r\n  }\r\n  static getDerivedStateFromError(err: any) {\r\n    return { hasError: true, message: String(err?.message || err) }\r\n  }\r\n  componentDidCatch(error: any, info: any) {\r\n    // eslint-disable-next-line no-console\r\n    console.error('[ErrorBoundary]', error, info)\r\n  }\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center p-6\">\r\n          <div className=\"card max-w-lg w-full text-center\">\r\n            <h2 className=\"text-2xl font-bold mb-2\">Something went wrong</h2>\r\n            <p className=\"opacity-80 mb-4\">Please refresh the page. If this persists, let us know.</p>\r\n            {this.state.message && (\r\n              <pre className=\"text-xs bg-black/40 rounded p-2 overflow-auto text-left\">{this.state.message}</pre>\r\n            )}\r\n            <button className=\"btn mt-4\" onClick={() => window.location.reload()}>Reload</button>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n    return this.props.children as any\r\n  }\r\n}\r\n","import { StrictMode } from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport './index.css'\r\nimport App from './App'\r\nimport ResetPassword from './components/ResetPassword'\r\nimport { WSProvider } from './components/WSProvider'\r\nimport ErrorBoundary from './components/ErrorBoundary'\r\nimport { installApiInterceptor } from './utils/api'\r\n\r\n// In some hosting setups, third-party or legacy code may expect a global React.\r\n// This ensures `React` is available at runtime to prevent 'React is not defined' errors.\r\ntry { (window as any).React = (window as any).React || {} } catch {}\r\n\r\ninstallApiInterceptor()\r\n\r\nReactDOM.createRoot(document.getElementById('root')!).render(\r\n  <StrictMode>\r\n    <ErrorBoundary>\r\n      <WSProvider>\r\n        <Root />\r\n      </WSProvider>\r\n    </ErrorBoundary>\r\n  </StrictMode>,\r\n)\r\n\r\nfunction Root() {\r\n  const path = window.location.pathname\r\n  if (path === '/reset') return <ResetPassword />\r\n  return <App />\r\n}\r\n\r\n"],"names":["f","require$$0","k","l","m","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","KEY","user","getWeekId","date","dayNum","yearStart","weekNo","week","getOnlineUsage","raw","u","currentWeek","setOnlineUsage","usage","incOnlineUsage","cap","next","getFreeRemaining","LS_KEY","getCache","setCache","email","v","fetchIsAdmin","owner","__vite_import_meta_env__","force","hit","useIsAdmin","isAdmin","setIsAdmin","useState","useEffect","on","BASE_PRICE_GBP","FX","formatPriceInCurrency","currency","gbpAmount","cur","rate","val","getUserCurrency","parts","DISCORD_INVITE_URL","cachedBaseUrl","computeApiBase","envUrl","protocol","host","hostname","sameOrigin","normalizePath","path","base","cleanPath","resolveApiUrl","apiFetch","init","url","installApiInterceptor","anyWindow","originalFetch","input","reqUrl","cloned","href","err","getTabs","baseTabs","LayoutDashboard","Users","Trophy","Camera","Settings","PoundSterling","Sidebar","active","onChange","className","tabs","t","idx","adminTab","showDiscord","setShowDiscord","freeLeft","notifications","setNotifications","fetchNotifications","requestsRes","messagesRes","requests","unreadMessages","interval","onKey","key","label","Icon","jsxs","jsx","Lock","MessageCircle","createPortal","createStoreImpl","createState","state","listeners","setState","partial","replace","nextState","previousState","listener","getState","api","initialState","createStore","React","is","x","y","objectIs","useLayoutEffect","useDebugValue","useSyncExternalStore$2","subscribe","getSnapshot","value","_useState","inst","forceUpdate","checkIfSnapshotChanged","latestGetSnapshot","nextValue","useSyncExternalStore$1","shim","useSyncExternalStoreShim_production","shimModule","require$$1","useSyncExternalStore","useRef","useMemo","withSelector_production","getServerSnapshot","selector","isEqual","instRef","memoizedSelector","nextSnapshot","hasMemo","memoizedSnapshot","currentSelection","memoizedSelection","nextSelection","maybeGetServerSnapshot","withSelectorModule","ReactExports","useSyncExternalStoreWithSelector","useSyncExternalStoreExports","didWarnAboutEqualityFn","identity","arg","useStore","equalityFn","slice","createImpl","useBoundStore","create","nextId","useToastStore","set","message","opts","s","id","useToast","formatAvg","n","keyFor","name","keySeriesFor","getAllTime","parsed","getAllTimeAvg","darts","scored","getAllTimeFirstNineAvg","fnDarts","fnScored","keyGameModes","getGameModeStats","allModeKeys","obj","setGameModeStats","stats","bumpGameMode","mode","won","current","entry","getSeries","arr","setSeries","entries","pruneOld","maxAgeMs","now","addSample","when","list","getRollingAvg","windowMs","getRollingFirstNineAvg","getMonthlyAvg3","windowed","matchOnly","use","getMonthlyFirstNineAvg","load","j","save","prev","useUserSettings","get","vol","cfg","size","goTab","tab","API_URL","Home","showLegal","setShowLegal","showHowTo","setShowHowTo","fact","setFact","lastOffline","toast","facts","all","isPremium","GRID","Row","left","right","lock","data","ScrollFade","children","style","ref","raf","updateClip","wrapper","header","scroller","scrollTop","headerH","overlap","onScrollOrResize","DartLoader","calibrationComplete","showTick","setShowTick","fade","setFade","canPromise","toSJISFunction","CODEWORDS_COUNT","utils","version","digit","kanji","exports","fromString","string","level","defaultValue","BitBuffer","index","bufIndex","num","length","bit","bitBuffer","BitMatrix","row","col","reserved","bitMatrix","getSymbolSize","posCount","intervals","positions","i","coords","pos","posLength","FINDER_PATTERN_SIZE","finderPattern","PenaltyScores","mask","points","sameCountCol","sameCountRow","lastCol","lastRow","module","last","bitsCol","bitsRow","darkCount","modulesCount","getMaskAt","maskPattern","pattern","setupFormatFunc","numPatterns","bestPattern","lowerPenalty","penalty","ECLevel","EC_BLOCKS_TABLE","EC_CODEWORDS_TABLE","errorCorrectionCode","errorCorrectionLevel","EXP_TABLE","LOG_TABLE","galoisField","GF","p1","p2","coeff","divident","divisor","result","offset","degree","poly","Polynomial","ReedSolomonEncoder","paddedData","remainder","start","buff","reedSolomonEncoder","versionCheck","numeric","alphanumeric","byte","regex","TEST_KANJI","TEST_NUMERIC","TEST_ALPHANUMERIC","str","VersionCheck","Regex","dataStr","Utils","ECCode","require$$2","Mode","require$$3","require$$4","G18","G18_BCH","getBestVersionForDataLength","currentVersion","getReservedBitsCount","getTotalBitsFromDataArray","segments","totalBits","reservedBits","getBestVersionForMixedData","totalCodewords","ecTotalCodewords","dataTotalCodewordsBits","usableBits","seg","ecl","G15","G15_MASK","G15_BCH","formatInfo","NumericData","group","remainingNum","numericData","ALPHA_NUM_CHARS","AlphanumericData","alphanumericData","ByteData","byteData","KanjiData","kanjiData","dijkstra","graph","predecessors","costs","open","closest","cost_of_s_to_u","adjacent_nodes","cost_of_e","cost_of_s_to_u_plus_cost_of_e","cost_of_s_to_v","first_visit","msg","nodes","T","cost","item","require$$5","require$$6","require$$7","getStringByteLength","getSegments","getSegmentsFromString","numSegs","alphaNumSegs","byteSegs","kanjiSegs","s1","s2","getSegmentBitsLength","mergeSegments","segs","acc","curr","prevSeg","buildNodes","buildGraph","table","prevNodeIds","nodeGroup","currentNodeIds","node","prevNodeId","buildSingleSegment","modesHint","bestMode","array","optimizedSegs","AlignmentPattern","FinderPattern","MaskPattern","require$$8","Version","require$$9","FormatInfo","require$$10","require$$11","Segments","require$$12","setupFinderPattern","matrix","r","setupTimingPattern","setupAlignmentPattern","setupVersionInfo","bits","mod","setupFormatInfo","setupData","inc","bitIndex","byteIndex","dark","createData","buffer","remainingByte","createCodewords","dataTotalCodewords","ecTotalBlocks","blocksInGroup2","blocksInGroup1","totalCodewordsInGroup1","dataCodewordsInGroup1","dataCodewordsInGroup2","ecCount","rs","dcData","ecData","maxDataSize","dataSize","createSymbol","estimatedVersion","rawSegments","bestVersion","dataBits","moduleCount","modules","qrcode","options","hex2rgba","hex","hexCode","hexValue","margin","width","scale","qrSize","imgData","qr","symbolSize","scaledMargin","palette","posDst","pxColor","iSrc","jSrc","clearCanvas","ctx","canvas","getCanvasElement","qrData","canvasEl","image","type","rendererOpts","getColorAttrib","color","attrib","alpha","svgCmd","cmd","qrToPath","moveBy","newRow","lineLength","svgTag","cb","qrcodesize","bg","viewBox","QRCode","CanvasRenderer","SvgRenderer","renderCanvas","renderFunc","text","args","argsNum","isLastArgCb","resolve","reject","browser","_","createJSONStorage","getStorage","storage","_a","parse","str2","newValue","toThenable","fn","onFulfilled","_onRejected","_onFulfilled","onRejected","oldImpl","config","baseOptions","persistedState","currentState","hasHydrated","hydrationListeners","finishHydrationListeners","thenableSerialize","setItem","errorInSync","thenable","serializedValue","savedSetState","configResult","stateFromStorage","hydrate","postRehydrationCallback","storageValue","deserializedStorageValue","migratedState","_a2","newOptions","newImpl","_b","migrationResult","migrated","persistImpl","persist","useCalibration","error","legacy","BoardRadii","SectorOrder","applyHomography","H","w","nx","ny","scaleHomography","sx","sy","invertHomography","A","B","C","D","E","F","G","Hh","det","computeHomographyDLT","src","dst","X","Y","solveLeastSquares","AtA","Atb","gaussianSolve","M","maxRow","tmp","canonicalRimTargets","R","sampleRing","radius","steps","pts","theta","rmsError","e2","dx","dy","imageToBoard","H_boardToImage","pImg","inv","scoreAtBoardPoint","deg","sector","drawPolyline","drawCross","clamp","lo","hi","sobelAtGray","img","gx","gy","xi","gray","refinePointSobel","cx","cy","best","mag","refinePointsSobel","CV","height","imageSrc","imageDst","len","threshold","kernelSize","hist","sum","sumB","wB","wF","max","mu","between","heightMinus1","widthMinus1","mult","shift","stack","stackStart","imageMean","kernel","horizontal","limit","center","sigma","scale2X","binary","contours","deltas","pix","nbd","outer","hole","point","contour","pos1","pos3","pos4","s_end","epsilon","right_slice","pt","start_pt","end_pt","dist","max_dist","le_eps","warpSize","sx1","sx2","dx1","dx2","sy1","sy2","dy1","dy2","p3","p4","rq","sq","px","py","den","orientation","convex","cur_pt","prev_pt","dxdy0","dydx0","dx0","dy0","min","square","span","nz","posSrc","cv","AR","corners","minSize","minLength","candidates","swap","minDist","notTooNear","markers","candidate","marker","minZero","rotations","distances","pair","ids","minSum","rotation","aruco","SVD","flag","its","jj","nm","anorm","z","rv1","at","bt","ct","svd","POS","modelSize","focalLength","half","np","vectors","imagePoints","posRotation1","posRotation2","posTranslation","rotation1","rotation2","translation1","translation2","error1","error2","valid1","valid2","translation","imageVectors","i0","j0","ivec","jvec","row1","row2","row3","i0i0","j0j0","i0j0","delta","lambda","zmin","zi","posRotation","oldSopImagePoints","sopImagePoints","converged","iteration","oldImageDifference","imageDifference","factor","move","projection","errorvec","euclidean","pixels","maximum","wmax","cn","posit1","Vec3","Mat3","eps","yi","xs","ys","ij","inorm","jnorm","temp","prevError","v1","v2","v3","v4","modeled","ia1","ia2","ia3","ia4","ma1","ma2","ma3","ma4","x1","y1","x2","y2","vector","posit2","jsAruco","MARKER_ORDER","MARKER_TARGETS","detector","ensureDetector","centerFromCorners","corner","count","detectMarkersFromImage","assignments","found","missing","detectMarkersFromCanvas","imageData","ROW_PATTERNS","markerIdToMatrix","rows","bit3","bit1","discoverNetworkDevices","devices","localIPs","getLocalIPs","localIP","scanResults","scanNetwork","device","probeDevice","ips","pc","offer","timeout","event","ipMatch","ip","isPrivateIP","ports","results","baseIP","promises","port","checkPort","portIndex","ipIndex","response","endpoints","endpoint","contentType","discoverUSBDevices","probeUSBDevice","requestUSBDevice","reader","done","connectToNetworkDevice","streamUrl","video","stream","drawFrame","connectToUSBDevice","Calibrator","videoRef","canvasRef","overlayRef","fileInputRef","streaming","setStreaming","videoPlayBlocked","setVideoPlayBlocked","phase","setPhase","setMode","dstPoints","setDstPoints","snapshotSet","setSnapshotSet","frameSize","setFrameSize","zoom","setZoom","mobileLandingOverride","setMobileLandingOverride","isMobileDevice","setIsMobileDevice","setCalibration","reset","errorPx","locked","calibrationGuide","setCalibrationGuide","preferredCameraId","cameraEnabled","setCameraEnabled","preferredCameraLocked","setPreferredCameraLocked","setPreferredCamera","detected","setDetected","liveDetect","setLiveDetect","confidence","setConfidence","markerResult","setMarkerResult","createMarkerDataUrl","useCallback","padding","cells","cellSize","origin","openMarkerSheet","popup","html","ws","setWs","autoLockRef","pairCode","setPairCode","pairCodeRef","updatePairCode","code","expiresAt","setExpiresAt","setNow","paired","setPaired","pcRef","qrDataUrl","setQrDataUrl","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","copyFeedback","setCopyFeedback","copyTimeoutRef","mobileUrl","useHttps","mobileLandingLink","coarseQuery","detect","uaMobile","coarse","narrow","ttl","copyValue","textarea","stopCamera","ensureWS","normalizedEnv","socket","startPhonePairing","lockSelectionForPairing","ev","codeForSession","imgSize","payload","peer","inbound","startWifiConnection","connectToWifiDevice","startCamera","constraints","regenerateCode","triggerUpload","onUploadPhotoChange","captureFrame","autoDetectRings","drawOverlay","currentPoints","HH","o","Huse","rings","ringColor","ringWidth","drawCircle","pad","ax","ay","onClickOverlay","el","rect","cssX","cssY","scaleX","scaleY","undoPoint","refinePoints","refined","compute","Hcalc","resetAll","dw","dh","tctx","d0","f0","g0","h0","maxMag","cx0","cy0","rMin","rMax","stepC","stepR","samples","ang","OCX","OCY","OR","radialScore","rPx","rScaled","ratios","refineAround","expectedR","pctWindow","bestR","bestS","dOuter","dInner","tOuter","tInner","bOuter","bInner","totalEdge","norm","conf","adjustedConf","autoLock","detectMarkers","missingMsg","imageSize","shouldLock","tick","bodyStr","token","DevicePicker","preferredCameraLabel","setDevices","setErr","dropdownOpen","setDropdownOpen","dropdownRef","dropdownPortal","enumerate","cams","handleClickOutside","selectedDevice","selectedLabel","preferredCameraUnavailable","ReactDOM","linkForMobile","Fragment","assignment","doubles","dVal","tag","prefsDoubleScore","fav","suggestCheckouts","remaining","favoriteDouble","hardcoded","target","routes","sayScore","voiceName","synth","isCheckout","CameraTile","autoStart","scaleOverride","aspect","fill","setPc","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","fallbackClass","fallbackStyle","stop","startUsbConnection","newDevice","connectToUsbDevice","proto","isLocalhost","isRenderHost","renderWS","stopAll","CameraFrame","props","cameraScale","storedAspect","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","videoElement","videoClass","calcThreeDartAvg","leg","finishedLegStats","avg","isCompleted","updatePlayerEndOfGameStats","player","avgs","bestNine","bestCheckout","st","useMatch","playerNames","startingScore","roomId","score","checkoutScore","newState","scoreFromImagePoint","pBoard","parseExternalDart","ring","normalizeRing","finalizeFromValue","sec","mul","inner","subscribeExternalWS","onDart","alive","connect","ResizablePanel","storageKey","defaultWidth","defaultHeight","minWidth","minHeight","maxWidth","maxHeight","setSize","startRef","containerRef","onReset","beginResize","dir","onMove","endResize","ResizableModal","fullScreen","initialFitHeight","parent","cs","padTop","padBottom","saved","parentInner","effMaxH","baseClass","useHeatmapStore","CameraView","onVisitCommitted","showToolbar","onAutoDart","immediateAutoCommit","hideInlinePanels","scoringMode","onGenericDart","onGenericReplace","autoscoreWsUrl","manualOnly","availableCameras","setAvailableCameras","cameraStarting","setCameraStarting","snapshotUrl","setSnapshotUrl","resetCalibration","lastAutoScore","setLastAutoScore","manualScore","setManualScore","lastAutoValue","setLastAutoValue","lastAutoRing","setLastAutoRing","pendingDarts","setPendingDarts","pendingScore","setPendingScore","pendingEntries","setPendingEntries","addVisit","endLeg","matchState","addHeatSample","quickSelAuto","setQuickSelAuto","quickSelManual","setQuickSelManual","nonRegCount","setNonRegCount","showRecalModal","setShowRecalModal","hadRecentAuto","setHadRecentAuto","activeTab","setActiveTab","showManualModal","setShowManualModal","showAutoModal","setShowAutoModal","showScoringModal","setShowScoringModal","manualPreviewRef","onOpen","onClose","vw","vh","cw","ch","playErr","retryErr","enumErr","capture","CameraSelector","Hs","sub","addDart","onOverlayClick","pCal","parseManual","bull","outerBull","multVal","getCurrentRemaining","newDarts","newScore","after","isFinish","onAddAutoDart","onApplyManual","onReplaceManual","prevDarts","prevScore","onRecalibrateNow","onResetCalibration","onQuickEntry","onUndoDart","onCommitVisit","polarToCartesian","angleDeg","sectorAngle","HeatMap","radii","ringOrder","angle","grd","sectorCounts","secStr","DOUBLE_PRACTICE_ORDER","isDoubleHit","targetIdx","parseManualDart","ATC_ORDER","CRICKET_NUMBERS","createCricketState","marks","applyCricketDart","opponentClosed","hits","cand","before","remainToClose","toApply","overflow","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","endShanghaiTurn","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","endHalveItTurn","createHighLow","applyHighLowDart","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","res","applyKillerDart","selfId","states","me","victimId","pid","victim","killerWinner","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","TTT_TARGETS","createTicTacToe","checkWin","board","lines","tryClaimCell","cell","tgt","ok","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","freeGames","premiumGames","aiLevels","aiVisitScore","X01RulesPopup","OfflinePlay","offlineLayout","selectedMode","setSelectedMode","x01Score","setX01Score","ai","setAI","showRules","setShowRules","inMatch","setInMatch","playerScore","setPlayerScore","aiScore","setAiScore","onDouble","setOnDouble","showWinPopup","setShowWinPopup","firstTo","setFirstTo","playerLegs","setPlayerLegs","aiLegs","setAiLegs","pendingLegWinner","setPendingLegWinner","doubleDarts","setDoubleDarts","checkoutDarts","setCheckoutDarts","legStats","setLegStats","aiDelayMs","setAiDelayMs","showMatchModal","setShowMatchModal","maximized","setMaximized","fitAll","setFitAll","fitScale","setFitScale","isPlayerTurn","setIsPlayerTurn","playerDartPoints","setPlayerDartPoints","dpIndex","setDpIndex","dpHits","setDpHits","atcIndex","setAtcIndex","atcHits","setAtcHits","cricket","setCricket","shanghai","setShanghai","halve","setHalve","highlow","setHighlow","practiceTurnDarts","setPracticeTurnDarts","b27Stage","setB27Stage","b27Score","setB27Score","b27Darts","setB27Darts","b27Hits","setB27Hits","b27Finished","setB27Finished","cuRound","setCuRound","cuScore","setCuScore","cuDarts","setCuDarts","cuMaxRounds","hsRound","setHsRound","hsScore","setHsScore","hsDarts","setHsDarts","hsMaxRounds","lsRound","setLsRound","lsScore","setLsScore","lsDarts","setLsDarts","lsMaxRounds","co170Rem","setCo170Rem","co170Darts","setCo170Darts","co170Attempts","setCo170Attempts","co170Successes","setCo170Successes","co121Rem","setCo121Rem","co121Darts","setCo121Darts","co121Attempts","setCo121Attempts","co121Successes","setCo121Successes","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","baseball","setBaseball","golf","setGolf","ttt","setTTT","amCricket","setAmCricket","killerPlayers","setKillerPlayers","killerStates","setKillerStates","killerAssigned","setKillerAssigned","killerSetupDone","setKillerSetupDone","killerTurnIdx","setKillerTurnIdx","killerDarts","setKillerDarts","killerWinnerId","setKillerWinnerId","killerLastEvent","setKillerLastEvent","playerDartsThrown","setPlayerDartsThrown","playerLastDart","setPlayerLastDart","playerVisitDarts","setPlayerVisitDarts","playerVisitStart","setPlayerVisitStart","playerVisitSum","setPlayerVisitSum","playerVisitDartsAtDouble","setPlayerVisitDartsAtDouble","aiCountdownMs","setAiCountdownMs","aiDartsThrown","setAiDartsThrown","aiLastDart","setAiLastDart","aiVisitSum","setAiVisitSum","aiVisitDartsAtDouble","setAiVisitDartsAtDouble","playerDoublesAtt","setPlayerDoublesAtt","playerDoublesHit","setPlayerDoublesHit","aiDoublesAtt","setAiDoublesAtt","aiDoublesHit","setAiDoublesHit","totalPlayerDarts","setTotalPlayerDarts","totalAiDarts","setTotalAiDarts","totalPlayerPoints","setTotalPlayerPoints","totalAiPoints","setTotalAiPoints","player180s","setPlayer180s","player140s","setPlayer140s","player100s","setPlayer100s","ai180s","setAi180s","ai140s","setAi140s","ai100s","setAi100s","playerHighestCheckout","setPlayerHighestCheckout","aiHighestCheckout","setAiHighestCheckout","showMatchSummary","setShowMatchSummary","manualBox","setManualBox","manualTextarea","setManualTextarea","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","rememberLastOffline","setLastOffline","autoStartOffline","setCameraScale","cameraAspect","setCameraAspect","textSize","boxSize","manualScoring","buttonSizeClass","scrollerRef","contentRef","headerBarRef","formatType","setFormatType","formatCount","setFormatCount","formatRef","wins","measure","content","availH","availW","currentScale","naturalHeight","naturalWidth","scaleH","scaleW","RO","ro","onAuto","startMatch","onFmt","dt","visitDarts","targetVisit","dart","preRem","postRem","checkout","startNextLeg","endTurn","nextRemaining","applyDartValue","newVisitDarts","preRemaining","postRemaining","startedDoubleWindow","stillInDoubleWindow","addDartNumeric","addDpValue","nextHits","addDpNumeric","addDpManual","addB27Auto","nd","totalHits","addB27Numeric","resetB27","addCountUpAuto","addHighScoreAuto","addLowScoreAuto","applyCheckout","rem","setRem","setDarts","setAttempts","setSuccesses","addCo170Auto","addCo121Auto","addCoManual","is170","isDouble","resetCo170","resetCo121","addTrebleAuto","resetTreble","addBaseballAuto","cp","resetBaseball","addGolfAuto","resetGolf","addTttAuto","resetTtt","addAmCricketAuto","resetAmCricket","addAtcValue","newHits","addAtcNumeric","addAtcManual","addCricketAuto","copy","addCricketNumeric","addShanghaiAuto","addShanghaiNumeric","addHalveAuto","addHalveNumeric","addHighLowAuto","addHighLowNumeric","parseManualBox","addManual","addManualTextarea","line","replaceLast","replaceLastManual","rewind","handleWinPopupSubmit","winner","legDoublesAtt","lockedPremium","disabled","pillCls","cricketClosedAll","first","currentThrower","currentRemaining","lastScoreVisit","dartsThrown","avg3","matchScore","bestLegText","nh","ni","info","promptVal","tcell","win","it","initStates","LS_INBOX","LS_UNREAD","loadInitial","unread","inbox","initial","useMessages","exists","sorted","patterns","starify","match","censorProfanity","out","re","containsProfanity","TabPills","isActive","timeAgo","ts","Friends","friends","setFriends","suggested","setSuggested","setResults","setQ","filter","setFilter","loading","setLoading","msgs","setRequests","outgoingRequests","setOutgoingRequests","messagePopup","setMessagePopup","refresh","fl","sg","search","term","addFriend","removeFriend","filtered","spectate","requestsCount","req","newFriend","reason","Toaster","toasts","remove","BarChart","barWidth","gap","showValues","totalWidth","allGames","OWNER_EMAIL","AdminDashboard","admins","setAdmins","setEmail","status","setStatus","announcement","setAnnouncement","tournaments","setTournaments","withdrawals","setWithdrawals","userSearch","setUserSearch","userResults","setUserResults","createForm","setCreateForm","emailCopy","setEmailCopy","preview","setPreview","isOwner","winners","setWinners","reports","setReports","logs","setLogs","systemHealth","setSystemHealth","gmVersion","setGmVersion","gmStats","gmBars","sres","tres","td","rres","rd","pw","wres","wd","grant","revoke","grantPremium","days","revokePremium","toggleMaintenance","enabled","sendAnnouncement","searchUsers","banUser","unbanUser","createOfficialTournament","setWinner","tid","winnerEmail","markPaid","deleteTournament","reseedWeekly","decideWithdrawal","approve","deleteMatch","fetchLogs","fetchSystemHealth","loadEmailCopy","saveEmailCopy","kind","openInlinePreview","EmailEditor","title","setTitle","intro","setIntro","btn","setBtn","admin","hasAccess","newType","notes","SettingsPanel","avgMode","reducedMotion","compactHeader","allowSpectate","setFavoriteDouble","setCallerEnabled","setCallerVoice","setCallerVolume","setSpeakCheckoutOnly","setAvgMode","setAutoStartOffline","setRememberLastOffline","setReducedMotion","setCompactHeader","setAllowSpectate","setAutoscoreProvider","setAutoscoreWsUrl","setOfflineLayout","setTextSize","setBoxSize","achievements","setAchievements","uname","isEditing","setIsEditing","favPlayer","setFavPlayer","favTeam","setFavTeam","favDarts","setFavDarts","bio","setBio","profilePhoto","setProfilePhoto","allowAnalytics","setAllowAnalytics","subscription","setSubscription","helpMessages","setHelpMessages","helpInput","setHelpInput","saveBio","navigateToTab","tabKey","getResponseWithLinks","userMessage","handleHelpSend","newUsername","setNewUsername","changingUsername","setChangingUsername","usernameError","setUsernameError","availableVoices","setAvailableVoices","loadVoices","voices","User","Shield","Save","Edit3","file","photoData","Gamepad2","Volume2","voice","utterance","Eye","Mic","blob","HelpCircle","link","linkIndex","Send","Auth","onAuth","username","setUsername","password","setPassword","reminder","setReminder","setError","showPassword","setShowPassword","handleSignIn","handleSignUp","handleReset","handleSendUsername","EyeOff","BarChart3","ShieldCheck","ThemeContext","createContext","THEME_KEY","ThemeProvider","theme","setTheme","WSContext","WSProvider","connected","setConnected","wsRef","listenersRef","shouldReconnectRef","attemptsRef","timerRef","heartbeatRef","endpointsRef","endpointIdxRef","ensureEndpoints","normalized","bases","rotateEndpoint","currentEndpoint","attempt","jitter","delay","beforeUnload","onVis","send","addListener","useWS","useContext","StatusDot","LS","map","useBlocklist","OnlinePlay","wsGlobal","blocklist","setRoomId","chat","setChat","showQuick","setShowQuick","showMessages","setShowMessages","lastSentChatRef","setSelfId","reconnectAttemptsRef","reconnectTimerRef","lastToastRef","firstConnectDoneRef","cameraColSpan","setCameraColSpan","participants","setParticipants","turnIdx","setTurnIdx","visitScore","setVisitScore","dpManual","setDpManual","atcManual","setAtcManual","pairingCode","setPairingCode","mobileStream","setMobileStream","mobileVideoRef","tttManual","setTttManual","cricketById","setCricketById","shanghaiById","setShanghaiById","halveById","setHalveById","highlowById","setHighlowById","killerById","setKillerById","amCricketById","setAmCricketById","baseballById","setBaseballById","golfById","setGolfById","turnDarts","setTurnDarts","compactView","setCompactView","ua","celebration","setCelebration","lastCelebrationRef","audioCtxRef","ensureAudio","Ctor","beep","freq","durMs","whenS","gain","playSting","triggerCelebration","who","showCreate","setShowCreate","lobby","setLobby","modeValue","setModeValue","startScore","setStartScore","pendingInvite","setPendingInvite","errorMsg","setErrorMsg","handleStripeError","lastJoinIntent","setLastJoinIntent","offerNewRoom","setOfferNewRoom","game","setGame","currentGame","setCurrentGame","requireCalibration","setRequireCalibration","filterMode","setFilterMode","filterStart","setFilterStart","filterGame","setFilterGame","nearAvg","setNearAvg","avgTolerance","setAvgTolerance","calibH","myAvg","filteredLobby","handler","onSpectate","rid","fallback","di","ah","_cr","_sh","_hv","_hl","_kr","_am","_bb","_gf","_tt","_td","isSelf","idKey","startMobileWebRTC","RenderMatchSummary","players","curIdx","lastScore","bestText","textSizeClass","boxSizeClass","unsub","sendState","sendQuick","nextIdx","isAtcHit","currentPlayerId","ensureCricket","ensureShanghai","ensureHalve","ensureHighLow","ensureKiller","used","ensureAmCricket","ensureBaseball","ensureGolf","allOpponentsClosed","opps","applyCricketAuto","applyShanghaiAuto","applyHalveAuto","applyHighLowAuto","applyKillerAuto","applyAmCricketAuto","applyBaseballAuto","applyGolfAuto","applyTttAuto","openManual","submitVisitManual","reportMessage","offenderId","getBoardPreview","track","creatorAvg","calibrated","boardPreview","dur","hue","isMe","lastVisitScore","finished","tt","availableCell","startX","startSpan","handleMouseMove","moveEvent","handleMouseUp","pp","ChatList","items","onDelete","onReport","onBlock","mobile","touch","setTouch","swiped","setSwiped","flagged","held","StatsPanel","inProgress","newMatch","family","setFamily","playersText","setPlayersText","setStart","opponent","setOpponent","showPicker","setShowPicker","searching","setSearching","cancelled","runSearch","otherData","gm","onUpdate","names","lbl","Tournaments","setList","cooldownUntil","setCooldownUntil","leaveAsk","setLeaveAsk","deleteConfirm","setDeleteConfirm","form","setForm","isTouch","abort","check","hasJoined","confirmDeleteTournament","join","fmt","leave","createTournament","official","community","nextOfficial","AdminAccess","Drawer","footer","side","OpsDashboard","ready","setReady","ann","setAnn","setMsg","announce","HelpAssistant","isOpen","setIsOpen","messages","setMessages","setInput","handleSend","App","appRef","avatar","setAvatar","isFullscreen","setIsFullscreen","setTab","isMobile","setIsMobile","navOpen","setNavOpen","setUser","allTimeAvg","setAllTimeAvg","fetchSubscription","onLogout","storedAvatar","handleStorageChange","handleAvatarUpdate","handleVisibilityChange","checkAvatarInterval","urlParams","paid","usernameChange","pendingUsername","update","mqMobile","mqTablet","uaTablet","touchScreen","verySmallScreen","isTablet","onName","onTabChange","fallbackAvatar","MobileNav","validatePassword","ResetPassword","setToken","confirm","setConfirm","success","setSuccess","onSubmit","ErrorBoundary","Component","StrictMode","Root"],"mappings":"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CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAA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","x_google_ignoreList":[0,1,2,8,9,10,11,12,13,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,52,53,54,55,56,57]}
{"version":3,"file":"OfflinePlay-DvEQLJLW.js","sources":["../../src/utils/checkout.ts","../../src/components/CameraTile.tsx","../../src/components/HeatMap.tsx","../../src/game/types.ts","../../src/game/aroundTheClock.ts","../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/game/ticTacToe.ts","../../src/game/scamFivesSevens.ts","../../src/game/americanCricket.ts","../../src/components/matchControlAdapters.ts","../../src/logic/matchActions.ts","../../src/components/scoreboards/useGameStats.ts","../../src/components/OfflinePlay.tsx"],"sourcesContent":["// Very lightweight checkout suggestions. For proper coverage consider a full table.\r\n// Returns up to a few route strings like \"T20 T20 D20\" for a given remaining.\r\n\r\nconst doubles = [\r\n  \"D1\",\r\n  \"D2\",\r\n  \"D3\",\r\n  \"D4\",\r\n  \"D5\",\r\n  \"D6\",\r\n  \"D7\",\r\n  \"D8\",\r\n  \"D9\",\r\n  \"D10\",\r\n  \"D11\",\r\n  \"D12\",\r\n  \"D13\",\r\n  \"D14\",\r\n  \"D15\",\r\n  \"D16\",\r\n  \"D17\",\r\n  \"D18\",\r\n  \"D19\",\r\n  \"D20\",\r\n  \"DB\",\r\n];\r\n\r\nfunction dVal(tag: string): number {\r\n  if (tag === \"DB\") return 50;\r\n  const n = Number(tag.slice(1));\r\n  return n * 2;\r\n}\r\n\r\nfunction prefsDoubleScore(fav: string): number {\r\n  if (!doubles.includes(fav)) return 32; // default D16\r\n  return dVal(fav);\r\n}\r\n\r\nexport function suggestCheckouts(\r\n  remaining: number,\r\n  favoriteDouble: string = \"D16\",\r\n): string[] {\r\n  if (remaining > 170 || remaining <= 1) return [];\r\n  // Simple known highest routes for popular numbers, then fall back to greedy towards favourite double\r\n  const hardcoded: Record<number, string[]> = {\r\n    170: [\"T20 T20 DB\"],\r\n    167: [\"T20 T19 DB\"],\r\n    164: [\"T20 T18 DB\"],\r\n    161: [\"T20 T17 DB\"],\r\n    160: [\"T20 T20 D20\"],\r\n    158: [\"T20 T20 D19\"],\r\n    157: [\"T20 T19 D20\"],\r\n    156: [\"T20 T20 D18\"],\r\n    155: [\"T20 T19 D19\"],\r\n    154: [\"T20 T18 D20\"],\r\n    153: [\"T20 T19 D18\"],\r\n    152: [\"T20 T20 D16\"],\r\n    151: [\"T20 T17 D20\"],\r\n    150: [\"T20 T18 D18\"],\r\n    149: [\"T20 T19 D16\"],\r\n    148: [\"T20 T16 D20\"],\r\n    147: [\"T20 T17 D18\"],\r\n    146: [\"T20 T18 D16\"],\r\n    145: [\"T20 T15 D20\"],\r\n    144: [\"T20 T20 D12\"],\r\n    141: [\"T20 T19 D12\"],\r\n    140: [\"T20 T20 D10\"],\r\n    137: [\"T20 T19 D10\"],\r\n    136: [\"T20 T20 D8\"],\r\n    132: [\"BULL T14 D20\", \"T20 T12 D8\"],\r\n    130: [\"T20 T20 D5\", \"T20 T18 D8\"],\r\n    129: [\"T19 T16 D12\"],\r\n    128: [\"T18 T14 D16\"],\r\n    127: [\"T20 T17 D8\"],\r\n    126: [\"T19 T19 D6\"],\r\n    121: [\"T20 11 D20\", \"T20 T15 D8\"],\r\n    120: [\"T20 20 D20\", \"T20 S20 D20\"],\r\n    110: [\"T20 10 D20\"],\r\n    100: [\"T20 D20\"],\r\n    99: [\"T19 10 D16\", \"T19 S10 D16\"],\r\n    97: [\"T19 D20\"],\r\n    96: [\"T20 D18\"],\r\n    95: [\"T19 D19\"],\r\n    94: [\"T18 D20\"],\r\n    92: [\"T20 D16\"],\r\n    90: [\"T18 D18\", \"T20 D15\"],\r\n    86: [\"T18 D16\"],\r\n    84: [\"T20 D12\", \"T16 D18\"],\r\n    82: [\"BULL D16\", \"T14 D20\"],\r\n    81: [\"T19 D12\"],\r\n    80: [\"T20 D10\", \"D20 D20\"],\r\n    78: [\"T18 D12\"],\r\n    76: [\"T20 D8\", \"T16 D14\"],\r\n    74: [\"T14 D16\", \"T18 D10\"],\r\n    72: [\"T16 D12\", \"T20 D6\"],\r\n    70: [\"T18 D8\", \"S20 BULL\"],\r\n    68: [\"T20 D4\", \"T16 D10\"],\r\n    66: [\"T10 D18\", \"T14 D12\"],\r\n    64: [\"T16 D8\", \"D16 D16\"],\r\n    62: [\"T10 D16\", \"T12 D13\"],\r\n    60: [\"20 D20\", \"S20 D20\"],\r\n    58: [\"18 D20\", \"S18 D20\"],\r\n    56: [\"16 D20\", \"S16 D20\"],\r\n    54: [\"14 D20\", \"S14 D20\"],\r\n    52: [\"20 D16\", \"S20 D16\"],\r\n    50: [\"BULL\", \"10 D20\"],\r\n    48: [\"16 D16\", \"S16 D16\"],\r\n    46: [\"14 D16\"],\r\n    44: [\"12 D16\"],\r\n    42: [\"10 D16\"],\r\n    40: [\"D20\"],\r\n    38: [\"D19\"],\r\n    36: [\"D18\"],\r\n    34: [\"D17\"],\r\n    32: [\"D16\"],\r\n    30: [\"D15\"],\r\n    28: [\"D14\"],\r\n    26: [\"D13\"],\r\n    24: [\"D12\"],\r\n    22: [\"D11\"],\r\n    20: [\"D10\"],\r\n    18: [\"D9\"],\r\n    16: [\"D8\"],\r\n    14: [\"D7\"],\r\n    12: [\"D6\"],\r\n    10: [\"D5\"],\r\n    8: [\"D4\"],\r\n    6: [\"D3\"],\r\n    4: [\"D2\"],\r\n    2: [\"D1\"],\r\n  };\r\n  if (hardcoded[remaining]) return hardcoded[remaining];\r\n  // Greedy fallback: aim to leave favourite double if possible in two darts\r\n  const target = prefsDoubleScore(favoriteDouble);\r\n  const routes: string[] = [];\r\n  // Try to hit a treble/big single that leaves the fav double\r\n  for (const t of [60, 57, 54, 51, 48]) {\r\n    // T20..T16\r\n    const left = remaining - t;\r\n    if (left === target) {\r\n      routes.push(`T${t / 3} ${favoriteDouble}`);\r\n      break;\r\n    }\r\n  }\r\n  if (!routes.length) {\r\n    for (const s of [20, 19, 18, 17, 16, 15]) {\r\n      const left = remaining - s;\r\n      if (left === target) {\r\n        routes.push(`${s} ${favoriteDouble}`);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return routes;\r\n}\r\n\r\nexport function sayScore(\r\n  name: string,\r\n  scored: number,\r\n  remaining: number,\r\n  voiceName?: string,\r\n  opts?: { volume?: number; checkoutOnly?: boolean },\r\n) {\r\n  try {\r\n    const synth = window.speechSynthesis;\r\n    if (!synth) return;\r\n    const msg = new SpeechSynthesisUtterance();\r\n    const isCheckout = remaining <= 170 && remaining > 0;\r\n    const isOneEighty = scored === 180;\r\n    const shouldAnnounce = !opts?.checkoutOnly || isCheckout || isOneEighty;\r\n    if (!shouldAnnounce) return;\r\n\r\n    if (isOneEighty) {\r\n      msg.text = `${name}! One eighty!`;\r\n      msg.rate = 1.04;\r\n      msg.pitch = 1.15;\r\n    } else if (isCheckout) {\r\n      msg.text = `${name}, ${remaining} remaining.`;\r\n      msg.rate = 1.0;\r\n      msg.pitch = 1.0;\r\n    } else if (scored === 0) {\r\n      msg.text = `${name}, no score.`;\r\n      msg.rate = 1.0;\r\n      msg.pitch = 1.0;\r\n    } else {\r\n      msg.text = `${name}, ${scored}.`;\r\n      msg.rate = 1.0;\r\n      msg.pitch = 1.0;\r\n    }\r\n    if (voiceName) {\r\n      const v = synth.getVoices().find((v) => v.name === voiceName);\r\n      if (v) msg.voice = v;\r\n    }\r\n    if (typeof opts?.volume === \"number\")\r\n      msg.volume = Math.max(0, Math.min(1, opts.volume));\r\n    else msg.volume = 1;\r\n    try {\r\n      synth.cancel();\r\n    } catch {}\r\n    synth.speak(msg);\r\n  } catch {}\r\n}\r\n","/* eslint-disable jsx-a11y/media-has-caption */\r\nimport {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n  type CSSProperties,\r\n} from \"react\";\r\nimport { dlog } from \"../utils/logger\";\r\nimport { useUserSettings } from \"../store/userSettings\";\r\nimport {\r\n  useCameraSession,\r\n  type CameraStreamMode,\r\n} from \"../store/cameraSession\";\r\nimport {\r\n  discoverNetworkDevices,\r\n  connectToNetworkDevice,\r\n  type NetworkDevice,\r\n  discoverUSBDevices,\r\n  requestUSBDevice,\r\n  connectToUSBDevice,\r\n  type USBDevice,\r\n} from \"../utils/networkDevices\";\r\nimport { apiFetch } from \"../utils/api\";\r\n\r\ntype CameraTileProps = {\r\n  label?: string;\r\n  autoStart?: boolean;\r\n  scale?: number;\r\n  className?: string;\r\n  aspect?: \"inherit\" | \"wide\" | \"square\" | \"portrait\" | \"classic\" | \"free\";\r\n  style?: CSSProperties;\r\n  fill?: boolean;\r\n  // Offline mode props\r\n  user?: any;\r\n  playerScore?: number;\r\n  aiScore?: number;\r\n  x01Score?: number;\r\n  inMatch?: boolean;\r\n  showWinPopup?: boolean;\r\n  pendingLegWinner?: \"player\" | \"ai\" | null;\r\n  playerDartsThrown?: number;\r\n  aiDartsThrown?: number;\r\n  totalPlayerDarts?: number;\r\n  totalAiDarts?: number;\r\n  totalPlayerPoints?: number;\r\n  totalAiPoints?: number;\r\n  player180s?: number;\r\n  player140s?: number;\r\n  player100s?: number;\r\n  ai180s?: number;\r\n  ai140s?: number;\r\n  ai100s?: number;\r\n  playerHighestCheckout?: number;\r\n  aiHighestCheckout?: number;\r\n  onClose?: () => void;\r\n  onOpen?: () => void;\r\n  layout?: \"classic\" | \"modern\";\r\n};\r\n\r\nexport default function CameraTile({\r\n  label,\r\n  autoStart,\r\n  scale: scaleOverride,\r\n  className,\r\n  aspect = \"inherit\",\r\n  style,\r\n  fill = false,\r\n}: CameraTileProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const cameraSession = useCameraSession();\r\n  const [streaming, setStreaming] = useState(false);\r\n  const [ws, setWs] = useState<WebSocket | null>(null);\r\n  const [pairCode, setPairCode] = useState<string | null>(null);\r\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null);\r\n  const lastRegisteredModeRef = useRef<CameraStreamMode | null>(null);\r\n  const registerStream = useCallback(\r\n    (stream: MediaStream | null, modeOverride: CameraStreamMode = \"local\") => {\r\n      try {\r\n        if (stream) {\r\n          cameraSession.setMediaStream(stream);\r\n          if (videoRef.current) {\r\n            cameraSession.setVideoElementRef(videoRef.current);\r\n          }\r\n          cameraSession.setMode(modeOverride);\r\n          cameraSession.setStreaming(true);\r\n          lastRegisteredModeRef.current = modeOverride;\r\n        } else if (\r\n          lastRegisteredModeRef.current &&\r\n          lastRegisteredModeRef.current !== \"phone\"\r\n        ) {\r\n          cameraSession.setStreaming(false);\r\n          cameraSession.setMediaStream(null);\r\n          lastRegisteredModeRef.current = null;\r\n        }\r\n      } catch (err) {\r\n        console.warn(\r\n          \"[CameraTile] Failed to register stream with camera session:\",\r\n          err,\r\n        );\r\n      }\r\n    },\r\n    [cameraSession],\r\n  );\r\n\r\n  // Initialize mode: prioritize phone camera if preferred, otherwise use localStorage\r\n  const preferredCameraLabel = useUserSettings((s) => s.preferredCameraLabel);\r\n  const [mode, setMode] = useState<\"local\" | \"phone\" | \"wifi\">(() => {\r\n    // If phone camera is selected, start in phone mode\r\n    if (preferredCameraLabel === \"Phone Camera\") {\r\n      dlog(\r\n        \"[CAMERATILE] Initializing mode to phone (from preferred camera selection)\",\r\n      );\r\n      return \"phone\";\r\n    }\r\n    // Otherwise use saved mode or default to local\r\n    const saved = localStorage.getItem(\"ndn:camera:mode\") as any;\r\n    dlog(\r\n      \"[CAMERATILE] Initializing mode to\",\r\n      saved || \"local\",\r\n      \"(from localStorage)\",\r\n    );\r\n    return saved || \"local\";\r\n  });\r\n\r\n  const [, setExpiresAt] = useState<number | null>(null);\r\n  const [, setPaired] = useState<boolean>(false);\r\n  const [lanHost, setLanHost] = useState<string | null>(null);\r\n  const [httpsInfo, setHttpsInfo] = useState<{\r\n    https: boolean;\r\n    port: number;\r\n  } | null>(null);\r\n  const [showTips, setShowTips] = useState<boolean>(true);\r\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([]);\r\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false);\r\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([]);\r\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false);\r\n  const autoscoreProvider = useUserSettings((s) => s.autoscoreProvider);\r\n  const cameraEnabledSetting = useUserSettings((s) => s.cameraEnabled);\r\n  const setPreferredCameraLocked = useUserSettings(\r\n    (s) => s.setPreferredCameraLocked,\r\n  );\r\n  const preferredCameraLocked = useUserSettings((s) => s.preferredCameraLocked);\r\n  const setPreferredCamera = useUserSettings((s) => s.setPreferredCamera);\r\n  const preferredCameraId = useUserSettings((s) => s.preferredCameraId);\r\n\r\n  if (autoscoreProvider === \"manual\") {\r\n    const fallbackBase = fill\r\n      ? \"rounded-2xl overflow-hidden bg-black w-full flex flex-col\"\r\n      : \"rounded-2xl overflow-hidden bg-black w-full mx-auto\";\r\n    const fallbackClass = [fallbackBase, className]\r\n      .filter(Boolean)\r\n      .join(\" \")\r\n      .trim();\r\n    const fallbackStyle: CSSProperties = { ...(style || {}) };\r\n    if (\r\n      !fill &&\r\n      fallbackStyle.aspectRatio === undefined &&\r\n      fallbackStyle.height === undefined &&\r\n      fallbackStyle.minHeight === undefined\r\n    ) {\r\n      fallbackStyle.aspectRatio = \"4 / 3\";\r\n    }\r\n    return (\r\n      <div className={fallbackClass} style={fallbackStyle}>\r\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\r\n          Manual scoring mode active â€” camera feeds are disabled.\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  useEffect(() => {\r\n    const h = window.location.hostname;\r\n    if (h === \"localhost\" || h === \"127.0.0.1\") {\r\n      apiFetch(`/api/hosts`)\r\n        .then((r) => r.json())\r\n        .then((j) => {\r\n          const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x);\r\n          if (ip) setLanHost(ip);\r\n        })\r\n        .catch(() => {});\r\n    }\r\n    // Detect HTTPS support for the phone link\r\n    apiFetch(`/api/https-info`)\r\n      .then((r) => r.json())\r\n      .then((j) => {\r\n        if (j && typeof j.https === \"boolean\")\r\n          setHttpsInfo({ https: !!j.https, port: Number(j.port) || 8788 });\r\n      })\r\n      .catch(() => {});\r\n  }, []);\r\n  const mobileUrl = useMemo(() => {\r\n    const code = pairCode || \"____\";\r\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined;\r\n    if (envUrl && envUrl.length > 0) {\r\n      try {\r\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\r\n        const u = new URL(envUrl);\r\n        const isSecure = u.protocol === \"wss:\";\r\n        const origin = `${isSecure ? \"https\" : \"http\"}://${u.host}${u.pathname.endsWith(\"/ws\") ? \"\" : u.pathname}`;\r\n        const base = origin.replace(/\\/?ws$/i, \"\");\r\n        return `${base}/mobile-cam.html?code=${code}`;\r\n  } catch (e) {}\r\n    }\r\n    // Fallback to local development: prefer LAN host if detected\r\n    const host = lanHost || window.location.hostname;\r\n    const useHttps = !!httpsInfo?.https;\r\n    const port = useHttps ? httpsInfo?.port || 8788 : 8787;\r\n    const proto = useHttps ? \"https\" : \"http\";\r\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`;\r\n  }, [pairCode, lanHost, httpsInfo]);\r\n  useEffect(() => {\r\n    dlog(\"[CAMERATILE] Mode changed to:\", mode, \"- persisting to localStorage\");\r\n    localStorage.setItem(\"ndn:camera:mode\", mode);\r\n  }, [mode]);\r\n\r\n  const [manualModeSetAt, setManualModeSetAt] = useState<number | null>(null);\r\n\r\n  // start/stop are implemented later (deduplicated); keep single definition below.\r\n\r\n  // Sync phone camera selection from Calibrator into CameraTile mode state\r\n  // When user locks in phone camera in Calibrator, it updates preferredCameraLabel\r\n  // This effect ensures CameraTile's UI reflects that selection\r\n  useEffect(() => {\r\n    const ignore = useUserSettings.getState().ignorePreferredCameraSync;\r\n    dlog(\r\n      \"[CAMERATILE] Checking camera selection sync: preferredCameraLabel=\",\r\n      preferredCameraLabel,\r\n      \"mode=\",\r\n      mode,\r\n      \"ignoreSync=\",\r\n      ignore,\r\n      \"manualModeSetAt=\",\r\n      manualModeSetAt,\r\n    );\r\n    if (ignore) return;\r\n    // If user manually changed mode recently, avoid auto-syncing preferred camera\r\n    if (manualModeSetAt && Date.now() - manualModeSetAt < 30_000) return;\r\n    if (preferredCameraLabel === \"Phone Camera\" && mode !== \"phone\") {\r\n      dlog(\"[CAMERATILE] Syncing mode to phone from Calibrator selection\");\r\n      setMode(\"phone\");\r\n    }\r\n  }, [preferredCameraLabel, mode, manualModeSetAt]);\r\n\r\n  // Intentionally disabled automatic regeneration of phone pairing codes.\r\n  // Codes will only be created when the user explicitly requests it (button click).\r\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\r\n\r\n  useEffect(() => {\r\n    if (\r\n      !cameraEnabledSetting ||\r\n      (autoscoreProvider &&\r\n        autoscoreProvider !== \"built-in\" &&\r\n        autoscoreProvider !== \"external-ws\")\r\n    )\r\n      return;\r\n    if (autoStart === undefined) return;\r\n    if (autoStart) {\r\n      let cancelled = false;\r\n      const desiredLabel = preferredCameraLabel || \"default\";\r\n      const timer = window.setTimeout(() => {\r\n        if (cancelled || streaming) return;\r\n        start().catch((err) =>\r\n          console.warn(\r\n            `[CameraTile] Auto-start failed for ${desiredLabel}:`,\r\n            err,\r\n          ),\r\n        );\r\n      }, 200);\r\n      return () => {\r\n        cancelled = true;\r\n        window.clearTimeout(timer);\r\n      };\r\n    }\r\n    stop();\r\n  }, [\r\n    autoStart,\r\n    streaming,\r\n    cameraEnabledSetting,\r\n    autoscoreProvider,\r\n    preferredCameraLabel,\r\n    start,\r\n    stop,\r\n  ]);\r\n\r\n  // If the user selected Phone Camera, bind the global stream into this tile\r\n  useEffect(() => {\r\n    const apply = async () => {\r\n      try {\r\n        const allowPhoneAttach =\r\n          (preferredCameraLabel === \"Phone Camera\" &&\r\n            (!manualModeSetAt || Date.now() - manualModeSetAt >= 30_000)) ||\r\n          mode === \"phone\";\r\n        if (!allowPhoneAttach) return;\r\n        const s = cameraSession.getMediaStream();\r\n        const v = videoRef.current;\r\n        if (!v || !s) return;\r\n        if (v.srcObject !== s) {\r\n          v.srcObject = s;\r\n        }\r\n        v.muted = true;\r\n        (v as any).playsInline = true;\r\n        try {\r\n          await v.play();\r\n        } catch {}\r\n        setStreaming(true);\r\n      } catch {}\r\n    };\r\n    // Try immediately and poll briefly to catch late-arriving stream\r\n    apply();\r\n    const t = setInterval(apply, 800);\r\n    return () => clearInterval(t);\r\n  }, [preferredCameraLabel, mode, cameraSession, cameraSession.isStreaming]);\r\n\r\n  const start = useCallback(async () => {\r\n    dlog(\"[CameraTile] start() invoked with mode=\", mode);\r\n    if (mode === \"wifi\") {\r\n      return startWifiConnection();\r\n    }\r\n    dlog(\"[CameraTile] Attempting to attach global stream for phone mode...\");\r\n\r\n    // If phone camera is selected and paired, don't try to start local camera\r\n    if (preferredCameraLabel === \"Phone Camera\" || mode === \"phone\") {\r\n      const s = cameraSession.getMediaStream();\r\n      if (s && videoRef.current) {\r\n        try {\r\n          videoRef.current.srcObject = s;\r\n          await videoRef.current.play();\r\n          setStreaming(true);\r\n          return;\r\n        } catch {}\r\n      }\r\n      // If no global stream yet, for phone mode we should attempt pairing\r\n      if (mode === \"phone\") {\r\n        try {\r\n          await startPhonePairing();\r\n          return;\r\n        } catch {}\r\n      }\r\n    }\r\n\r\n    try {\r\n      // Prefer saved camera if available\r\n      const { preferredCameraId, setPreferredCamera } =\r\n        useUserSettings.getState();\r\n      const constraints: MediaStreamConstraints = preferredCameraId\r\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false }\r\n        : { video: true, audio: false };\r\n      let stream: MediaStream;\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n      } catch (err: any) {\r\n        const name = (err && (err.name || err.code)) || \"\";\r\n        if (\r\n          preferredCameraId &&\r\n          (name === \"OverconstrainedError\" || name === \"NotFoundError\")\r\n        ) {\r\n          stream = await navigator.mediaDevices.getUserMedia({\r\n            video: true,\r\n            audio: false,\r\n          });\r\n        } else {\r\n          throw err;\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        await videoRef.current.play();\r\n        setStreaming(true);\r\n        registerStream(stream, \"local\");\r\n      }\r\n      // Camera started successfully - no automatic preference updates\r\n    } catch {}\r\n  }, [mode, preferredCameraLabel, cameraSession, registerStream, startPhonePairing, startWifiConnection]);\r\n  const stop = useCallback(() => {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks();\r\n      tracks.forEach((t) => t.stop());\r\n      videoRef.current.srcObject = null;\r\n      setStreaming(false);\r\n      registerStream(null);\r\n    }\r\n  }, [registerStream]);\r\n\r\n  async function startWifiConnection() {\r\n    setDiscoveringWifi(true);\r\n    try {\r\n      const devices = await discoverNetworkDevices();\r\n      setWifiDevices(devices);\r\n      if (devices.length === 0) {\r\n        alert(\r\n          \"No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.\",\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Wifi device discovery failed:\", error);\r\n      alert(\r\n        \"Failed to discover wifi devices. Please check your network connection.\",\r\n      );\r\n    } finally {\r\n      setDiscoveringWifi(false);\r\n    }\r\n  }\r\n\r\n  async function connectToWifiDevice(device: NetworkDevice) {\r\n    try {\r\n      setWifiDevices((devices) =>\r\n        devices.map((d) =>\r\n          d.id === device.id ? { ...d, status: \"connecting\" as const } : d,\r\n        ),\r\n      );\r\n\r\n      const stream = await connectToNetworkDevice(device);\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        await videoRef.current.play();\r\n        setStreaming(true);\r\n        registerStream(stream, \"wifi\");\r\n        setWifiDevices((devices) =>\r\n          devices.map((d) =>\r\n            d.id === device.id ? { ...d, status: \"online\" as const } : d,\r\n          ),\r\n        );\r\n      } else {\r\n        throw new Error(\"Failed to get video stream\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to connect to wifi device:\", error);\r\n      alert(\r\n        `Failed to connect to ${device.name}. Please check the device and try again.`,\r\n      );\r\n      setWifiDevices((devices) =>\r\n        devices.map((d) =>\r\n          d.id === device.id ? { ...d, status: \"offline\" as const } : d,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  async function startUsbConnection() {\r\n    setDiscoveringUsb(true);\r\n    try {\r\n      // First try to get already paired devices\r\n      const devices = await discoverUSBDevices();\r\n      setUsbDevices(devices);\r\n\r\n      // Then request user to select a new device\r\n      const newDevice = await requestUSBDevice();\r\n      if (newDevice) {\r\n        setUsbDevices((prev) => [...prev, newDevice]);\r\n      }\r\n\r\n      if (devices.length === 0 && !newDevice) {\r\n        alert(\r\n          \"No USB scoring devices found. Please connect a device and try again.\",\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"USB device discovery failed:\", error);\r\n      alert(\"Failed to discover USB devices. Please check device connections.\");\r\n    } finally {\r\n      setDiscoveringUsb(false);\r\n    }\r\n  }\r\n\r\n  async function connectToUsbDevice(device: USBDevice) {\r\n    try {\r\n      setUsbDevices((devices) =>\r\n        devices.map((d) =>\r\n          d.id === device.id ? { ...d, status: \"connecting\" as const } : d,\r\n        ),\r\n      );\r\n      const stream = await connectToUSBDevice(device);\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        await videoRef.current.play();\r\n        setStreaming(true);\r\n        setMode(\"wifi\"); // Using wifi mode for USB devices too\r\n        registerStream(stream, \"wifi\");\r\n        setUsbDevices((devices) =>\r\n          devices.map((d) =>\r\n            d.id === device.id ? { ...d, status: \"online\" as const } : d,\r\n          ),\r\n        );\r\n      } else {\r\n        throw new Error(\"Failed to get video stream\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to connect to USB device:\", error);\r\n      alert(\r\n        `Failed to connect to ${device.name}. Please check the device and try again.`,\r\n      );\r\n      setUsbDevices((devices) =>\r\n        devices.map((d) =>\r\n          d.id === device.id ? { ...d, status: \"offline\" as const } : d,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  // Listen for global event to start local camera from other UI components\r\n  const handleModeSelect = useCallback(\r\n    (newMode: \"local\" | \"phone\" | \"wifi\" | \"usb\") => {\r\n      try {\r\n        setMode(newMode === \"usb\" ? \"wifi\" : newMode);\r\n        setManualModeSetAt(Date.now());\r\n        // Persist the user's selection and lock it to avoid auto-switching\r\n        try {\r\n          if (newMode === \"local\") {\r\n            try {\r\n              setPreferredCamera(preferredCameraId, \"Local\", true);\r\n            } catch {}\r\n            try {\r\n              setPreferredCameraLocked(true);\r\n            } catch {}\r\n          } else if (newMode === \"phone\") {\r\n            try {\r\n              setPreferredCamera(undefined, \"Phone Camera\", true);\r\n            } catch {}\r\n            try {\r\n              setPreferredCameraLocked(true);\r\n            } catch {}\r\n          } else if (newMode === \"wifi\" || newMode === \"usb\") {\r\n            try {\r\n              setPreferredCamera(undefined, \"WiFi/USB\", true);\r\n            } catch {}\r\n            try {\r\n              setPreferredCameraLocked(true);\r\n            } catch {}\r\n          }\r\n        } catch {}\r\n        if (newMode === \"local\") {\r\n          start().catch(() => {});\r\n        } else if (newMode === \"phone\") {\r\n          startPhonePairing();\r\n        } else if (newMode === \"wifi\") {\r\n          startWifiConnection();\r\n        } else if (newMode === \"usb\") {\r\n          startUsbConnection();\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"[CameraTile] handleModeSelect failed\", err);\r\n      }\r\n    },\r\n    [\r\n      start,\r\n      startPhonePairing,\r\n      startWifiConnection,\r\n      startUsbConnection,\r\n      setPreferredCamera,\r\n      setPreferredCameraLocked,\r\n      preferredCameraId,\r\n    ],\r\n  );\r\n\r\n  useEffect(() => {\r\n    const onStart = (ev: any) => {\r\n      try {\r\n        const modeFromEvent = ev && ev.detail && ev.detail.mode;\r\n        if (\r\n          modeFromEvent &&\r\n          [\"local\", \"phone\", \"wifi\", \"usb\"].includes(modeFromEvent)\r\n        ) {\r\n          // Respect explicit mode requests and treat as manual selection\r\n          handleModeSelect(modeFromEvent);\r\n          // Ensure start is invoked after selection is applied\r\n          start().catch(() => {});\r\n        } else {\r\n          // No explicit mode provided â€” just try to start current mode\r\n          start().catch(() => {});\r\n        }\r\n      } catch {}\r\n    };\r\n    window.addEventListener(\"ndn:start-camera\" as any, onStart as any);\r\n    return () => {\r\n      window.removeEventListener(\"ndn:start-camera\" as any, onStart as any);\r\n    };\r\n  }, [start, handleModeSelect]);\r\n\r\n  // Phone pairing via WebRTC\r\n  function ensureWS() {\r\n    if (ws && ws.readyState === WebSocket.OPEN) return ws;\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined;\r\n    const normalizedEnv =\r\n      envUrl && envUrl.length > 0\r\n        ? envUrl.endsWith(\"/ws\")\r\n          ? envUrl\r\n          : envUrl.replace(/\\/$/, \"\") + \"/ws\"\r\n        : undefined;\r\n    const proto = window.location.protocol === \"https:\" ? \"wss\" : \"ws\";\r\n    const sameOrigin = `${proto}://${window.location.host}/ws`;\r\n    const host = window.location.hostname;\r\n    const isLocalhost = host === \"localhost\" || host === \"127.0.0.1\";\r\n    const isRenderHost = host.endsWith(\"onrender.com\");\r\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\r\n    const renderWS = `wss://ninedartnation.onrender.com/ws`;\r\n    let url = normalizedEnv;\r\n    if (!url) {\r\n      if (isLocalhost) {\r\n        url = `${proto}://${host}:8787/ws`;\r\n      } else if (isRenderHost) {\r\n        url = sameOrigin;\r\n      } else {\r\n        url = renderWS;\r\n      }\r\n    }\r\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\r\n    if (!url) url = sameOrigin;\r\n    const socket = new WebSocket(url);\r\n    setWs(socket);\r\n    return socket;\r\n  }\r\n  async function startPhonePairing() {\r\n    setMode(\"phone\");\r\n    setPaired(false);\r\n    const socket = ensureWS();\r\n    if (socket.readyState === WebSocket.OPEN) {\r\n      socket.send(JSON.stringify({ type: \"cam-create\" }));\r\n    } else {\r\n      socket.onopen = () => socket.send(JSON.stringify({ type: \"cam-create\" }));\r\n    }\r\n    socket.onmessage = async (ev) => {\r\n      const data = JSON.parse(ev.data);\r\n      if (data.type === \"cam-code\") {\r\n        setPairCode(data.code);\r\n        if (data.expiresAt) setExpiresAt(data.expiresAt);\r\n      } else if (data.type === \"cam-peer-joined\") {\r\n        setPaired(true);\r\n        // Create offer to the phone\r\n        const peer = new RTCPeerConnection({\r\n          iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }],\r\n        });\r\n        setPc(peer);\r\n        peer.onicecandidate = (e) => {\r\n          if (e.candidate && pairCode)\r\n            socket.send(\r\n              JSON.stringify({\r\n                type: \"cam-ice\",\r\n                code: pairCode,\r\n                payload: e.candidate,\r\n              }),\r\n            );\r\n        };\r\n        peer.ontrack = (ev) => {\r\n          if (videoRef.current) {\r\n            const inbound = ev.streams?.[0];\r\n            if (inbound) {\r\n              videoRef.current.srcObject = inbound;\r\n              videoRef.current.play().catch(() => {});\r\n              setStreaming(true);\r\n            }\r\n          }\r\n        };\r\n        const offer = await peer.createOffer({\r\n          offerToReceiveAudio: false,\r\n          offerToReceiveVideo: true,\r\n        });\r\n        await peer.setLocalDescription(offer);\r\n        if (pairCode)\r\n          socket.send(\r\n            JSON.stringify({\r\n              type: \"cam-offer\",\r\n              code: pairCode,\r\n              payload: offer,\r\n            }),\r\n          );\r\n      } else if (data.type === \"cam-answer\") {\r\n        if (pc)\r\n          await pc.setRemoteDescription(\r\n            new RTCSessionDescription(data.payload),\r\n          );\r\n      } else if (data.type === \"cam-ice\") {\r\n        if (pc)\r\n          try {\r\n            await pc.addIceCandidate(data.payload);\r\n          } catch {}\r\n      }\r\n    };\r\n  }\r\n  function regenerateCode() {\r\n    setPairCode(null);\r\n    setExpiresAt(null);\r\n    setPaired(false);\r\n    if (ws && ws.readyState === WebSocket.OPEN) {\r\n      ws.send(JSON.stringify({ type: \"cam-create\" }));\r\n    } else {\r\n      startPhonePairing();\r\n    }\r\n    try {\r\n      setPreferredCameraLocked(true);\r\n    } catch {}\r\n  }\r\n\r\n  function stopAll() {\r\n    stop();\r\n    setPairCode(null);\r\n    setPaired(false);\r\n    setExpiresAt(null);\r\n    if (pc) {\r\n      try {\r\n        pc.close();\r\n      } catch {}\r\n      setPc(null);\r\n    }\r\n  }\r\n  return (\r\n    <CameraFrame\r\n      label={label}\r\n      autoStart={autoStart}\r\n      start={start}\r\n      stopAll={stopAll}\r\n      startPhonePairing={startPhonePairing}\r\n      startWifiConnection={startWifiConnection}\r\n      startUsbConnection={startUsbConnection}\r\n      connectToWifiDevice={connectToWifiDevice}\r\n      connectToUsbDevice={connectToUsbDevice}\r\n      videoRef={videoRef}\r\n      streaming={streaming}\r\n      mode={mode}\r\n      setMode={setMode}\r\n      pairCode={pairCode}\r\n      mobileUrl={mobileUrl}\r\n      regenerateCode={regenerateCode}\r\n      httpsInfo={httpsInfo}\r\n      showTips={showTips}\r\n      setShowTips={setShowTips}\r\n      wifiDevices={wifiDevices}\r\n      usbDevices={usbDevices}\r\n      discoveringWifi={discoveringWifi}\r\n      discoveringUsb={discoveringUsb}\r\n      scaleOverride={scaleOverride}\r\n      className={className}\r\n      aspect={aspect}\r\n      style={style}\r\n      fill={fill}\r\n      onModeSelect={handleModeSelect}\r\n      preferredCameraLocked={preferredCameraLocked}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CameraFrame(props: any) {\r\n  const cameraSession = useCameraSession();\r\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings();\r\n  const {\r\n    label,\r\n    start,\r\n    stopAll,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n    startUsbConnection,\r\n    connectToWifiDevice,\r\n    connectToUsbDevice,\r\n    videoRef,\r\n    streaming,\r\n    mode,\r\n    setMode,\r\n    onModeSelect,\r\n    pairCode,\r\n    mobileUrl,\r\n    regenerateCode,\r\n    httpsInfo,\r\n    showTips,\r\n    setShowTips,\r\n    wifiDevices,\r\n    usbDevices,\r\n    discoveringWifi,\r\n    discoveringUsb,\r\n    className,\r\n    aspect,\r\n    style,\r\n    fill,\r\n    preferredCameraLocked,\r\n  } = props;\r\n\r\n  const modeDisplayName: Record<string, string> = {\r\n    local: \"Local\",\r\n    phone: \"PhoneCam\",\r\n    wifi: \"Wi-Fi/USB\",\r\n  };\r\n\r\n  const reconnectOptions = useMemo(() => {\r\n    return [\r\n      {\r\n        id: \"local\",\r\n        title: \"Local camera\",\r\n        description: \"Use the desktop webcam or capture card.\",\r\n        action: () => {\r\n          if (onModeSelect) onModeSelect(\"local\");\r\n        },\r\n      },\r\n      {\r\n        id: \"phone\",\r\n        title: \"PhoneCam\",\r\n        description: \"Stream from your phone via the mobile link.\",\r\n        action: () => {\r\n          if (onModeSelect) onModeSelect(\"phone\");\r\n        },\r\n      },\r\n      {\r\n        id: \"wifi\",\r\n        title: \"Wi-Fi/USB\",\r\n        description: \"Connect to scoring devices on your local network.\",\r\n        action: () => {\r\n          if (onModeSelect) onModeSelect(\"wifi\");\r\n        },\r\n      },\r\n      {\r\n        id: \"usb\",\r\n        title: \"USB\",\r\n        description: \"Connect a USB capture device (treated like WiFi mode).\",\r\n        action: () => {\r\n          if (onModeSelect) onModeSelect(\"usb\");\r\n        },\r\n      },\r\n    ];\r\n  }, [\r\n    setMode,\r\n    start,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n    startUsbConnection,\r\n  ]);\r\n\r\n  const [copyFeedback, setCopyFeedback] = useState<\"link\" | \"code\" | null>(\r\n    null,\r\n  );\r\n  const copyTimeoutRef = useRef<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current);\r\n    };\r\n  }, []);\r\n\r\n  // Respect stored aspect unless we're explicitly in full-bleed fill mode,\r\n  // in which case drop the aspect box so the video can truly cover the area.\r\n  const { cameraFitMode: globalFitMode } = useUserSettings();\r\n  const effectiveFitMode: \"fit\" | \"fill\" = fill\r\n    ? \"fill\"\r\n    : globalFitMode || \"fill\";\r\n  // In fill mode we guarantee no black bars: never allow downscaling below 1.0\r\n  const scale = (() => {\r\n    const raw = Number(props.scaleOverride ?? cameraScale ?? 1);\r\n    const clamped = Math.max(0.5, Math.min(1.25, raw));\r\n    return effectiveFitMode === \"fill\" ? Math.max(1, clamped) : clamped;\r\n  })();\r\n  const aspectChoice: \"wide\" | \"square\" | \"portrait\" | \"classic\" | \"free\" =\r\n    fill && effectiveFitMode === \"fill\"\r\n      ? \"free\"\r\n      : aspect && aspect !== \"inherit\"\r\n        ? aspect\r\n        : (storedAspect as any) || \"wide\";\r\n\r\n  const shouldMaintainAspect = aspectChoice !== \"free\";\r\n  const aspectClass = shouldMaintainAspect\r\n    ? aspectChoice === \"square\"\r\n      ? \"aspect-square\"\r\n      : aspectChoice === \"portrait\"\r\n        ? \"aspect-[3/4]\"\r\n        : aspectChoice === \"classic\"\r\n          ? \"aspect-[4/3]\"\r\n          : \"aspect-video\"\r\n    : \"\";\r\n\r\n  const containerBase = fill\r\n    ? \"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30\"\r\n    : \"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30\";\r\n  const containerClass = [containerBase, className]\r\n    .filter(Boolean)\r\n    .join(\" \")\r\n    .trim();\r\n  const containerStyle: CSSProperties = { ...(style || {}) };\r\n\r\n  const viewportClass = fill\r\n    ? \"relative flex-1 min-h-[420px] bg-black\"\r\n    : \"relative w-full bg-black\";\r\n\r\n  const commonVideoProps = {\r\n    style: { transform: `scale(${scale})`, transformOrigin: \"center\" as const },\r\n  };\r\n\r\n  const usbActive =\r\n    mode === \"wifi\" && usbDevices.some((d: USBDevice) => d.status === \"online\");\r\n\r\n  const videoElement = (() => {\r\n    // Apply Fit/Fill preference (fill prop hard-overrides to full-bleed)\r\n    const isFit = effectiveFitMode === \"fit\";\r\n    const baseVideoClass = isFit\r\n      ? // Fit: preserve entire frame (may letterbox)\r\n        \"absolute inset-0 w-full h-full object-contain object-center bg-transparent\"\r\n      : // Fill: guarantee full coverage with object-cover so there are no black bars\r\n        \"absolute inset-0 w-full h-full object-cover object-center bg-transparent\";\r\n    if (fill) {\r\n      if (shouldMaintainAspect) {\r\n        return (\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div\r\n              className={`relative w-full max-w-full max-h-full ${aspectClass}`}\r\n            >\r\n              <video\r\n                ref={videoRef}\r\n                className={baseVideoClass}\r\n                {...commonVideoProps}\r\n              />\r\n            </div>\r\n          </div>\r\n        );\r\n      }\r\n      return (\r\n        <video\r\n          ref={videoRef}\r\n          className={baseVideoClass}\r\n          {...commonVideoProps}\r\n        />\r\n      );\r\n    }\r\n    if (shouldMaintainAspect) {\r\n      return (\r\n        <div className={`relative w-full ${aspectClass}`}>\r\n          <video\r\n            ref={videoRef}\r\n            className={baseVideoClass}\r\n            {...commonVideoProps}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n    return (\r\n      <div className=\"relative w-full\">\r\n        <video\r\n          ref={videoRef}\r\n          className={baseVideoClass}\r\n          {...commonVideoProps}\r\n        />\r\n      </div>\r\n    );\r\n  })();\r\n\r\n  async function copyValue(\r\n    value: string | null | undefined,\r\n    type: \"link\" | \"code\",\r\n  ) {\r\n    if (!value) return;\r\n    try {\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        await navigator.clipboard.writeText(value);\r\n      } else {\r\n        const textarea = document.createElement(\"textarea\");\r\n        textarea.value = value;\r\n        textarea.style.position = \"fixed\";\r\n        textarea.style.opacity = \"0\";\r\n        document.body.appendChild(textarea);\r\n        textarea.focus();\r\n        textarea.select();\r\n        document.execCommand(\"copy\");\r\n        document.body.removeChild(textarea);\r\n      }\r\n      setCopyFeedback(type);\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current);\r\n      copyTimeoutRef.current = window.setTimeout(\r\n        () => setCopyFeedback(null),\r\n        1500,\r\n      );\r\n    } catch (err) {\r\n      console.warn(\"Copy to clipboard failed:\", err);\r\n      setCopyFeedback(null);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={containerClass} style={containerStyle}>\r\n      <div className={viewportClass}>\r\n        {videoElement}\r\n        {cameraSession.isStreaming && mode === \"phone\" && (\r\n          <div className=\"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg\">\r\n            <span className=\"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse\" />\r\n            <span>REC</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50\">\r\n        <span className=\"truncate font-medium\">\r\n          {label ||\r\n            (streaming\r\n              ? mode === \"phone\"\r\n                ? \"PHONE LIVE\"\r\n                : mode === \"wifi\"\r\n                  ? \"WIFI LIVE\"\r\n                  : \"LIVE\"\r\n              : \"Camera\")}\r\n          {preferredCameraLocked && (\r\n            <span className=\"ml-2 text-xs opacity-80\">ðŸ”’</span>\r\n          )}\r\n        </span>\r\n        <div className=\"flex items-center gap-2\">\r\n          {!streaming && (\r\n            <>\r\n              <button\r\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"local\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\r\n                onClick={() => onModeSelect(\"local\")}\r\n              >\r\n                Local\r\n              </button>\r\n              <button\r\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"phone\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\r\n                onClick={() => onModeSelect(\"phone\")}\r\n              >\r\n                Phone\r\n              </button>\r\n              <button\r\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"wifi\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\r\n                onClick={() => onModeSelect(\"wifi\")}\r\n              >\r\n                WiFi\r\n              </button>\r\n              <button\r\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"wifi\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\r\n                onClick={() => onModeSelect(\"usb\")}\r\n              >\r\n                USB\r\n              </button>\r\n            </>\r\n          )}\r\n          {streaming ? (\r\n            <button\r\n              className=\"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all\"\r\n              onClick={stopAll}\r\n            >\r\n              Stop\r\n            </button>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n      {mode === \"phone\" && pairCode && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\r\n          <button\r\n            type=\"button\"\r\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\r\n            onClick={() => copyValue(mobileUrl, \"link\")}\r\n            title=\"Copy mobile camera link\"\r\n          >\r\n            <span className=\"flex-1 min-w-0 font-mono break-all\">\r\n              {mobileUrl}\r\n            </span>\r\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">\r\n              {copyFeedback === \"link\" ? \"Copied!\" : \"Copy\"}\r\n            </span>\r\n          </button>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <a\r\n              href={mobileUrl}\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\r\n            >\r\n              Open link\r\n            </a>\r\n            <button\r\n              type=\"button\"\r\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n              onClick={() => copyValue(pairCode, \"code\")}\r\n              title=\"Copy pairing code\"\r\n            >\r\n              <span className=\"font-mono tracking-[0.3em] text-sm\">\r\n                {pairCode}\r\n              </span>\r\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">\r\n                {copyFeedback === \"code\" ? \"Copied!\" : \"Copy\"}\r\n              </span>\r\n            </button>\r\n          </div>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <button\r\n              className=\"px-1 py-0.5 rounded bg-slate-700\"\r\n              onClick={regenerateCode}\r\n            >\r\n              Regenerate\r\n            </button>\r\n          </div>\r\n          {showTips && (\r\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\r\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\r\n              <ul className=\"list-disc pl-4 space-y-1\">\r\n                <li>Phone and desktop must be on the same Wiâ€‘Fi network.</li>\r\n                <li>\r\n                  Allow the server through your firewall (ports 8787 and{\" \"}\r\n                  {httpsInfo?.https ? httpsInfo.port : 8788}).\r\n                </li>\r\n                <li>\r\n                  On iPhone, use HTTPS links (QR will prefer https when\r\n                  enabled).\r\n                </li>\r\n              </ul>\r\n              <div className=\"mt-2 text-right\">\r\n                <button\r\n                  className=\"btn btn--ghost px-2 py-1 text-xs\"\r\n                  onClick={() => setShowTips(false)}\r\n                >\r\n                  Hide tips\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      {mode === \"wifi\" && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\r\n\r\n          {/* WiFi Devices */}\r\n          <div className=\"mb-3\">\r\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\r\n            {discoveringWifi ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning network...</span>\r\n              </div>\r\n            ) : wifiDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {wifiDevices.map((device: NetworkDevice) => (\r\n                  <div\r\n                    key={device.id}\r\n                    className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\"\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">\r\n                        {device.ip}:{device.port}\r\n                      </div>\r\n                    </div>\r\n                    <button\r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === \"connecting\"\r\n                          ? \"bg-yellow-600\"\r\n                          : device.status === \"online\"\r\n                            ? \"bg-green-600\"\r\n                            : \"bg-blue-600\"\r\n                      }`}\r\n                      onClick={() => connectToWifiDevice(device)}\r\n                      disabled={device.status === \"connecting\"}\r\n                    >\r\n                      {device.status === \"connecting\" ? \"...\" : \"Connect\"}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button\r\n                    className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\r\n                    onClick={startWifiConnection}\r\n                  >\r\n                    Rescan WiFi\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\r\n                <button\r\n                  className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\r\n                  onClick={startWifiConnection}\r\n                >\r\n                  Scan WiFi\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* USB Devices */}\r\n          <div>\r\n            <div className=\"font-medium mb-1\">USB Devices</div>\r\n            {discoveringUsb ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning USB...</span>\r\n              </div>\r\n            ) : usbDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {usbDevices.map((device: USBDevice) => (\r\n                  <div\r\n                    key={device.id}\r\n                    className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\"\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">\r\n                        {device.type.toUpperCase()}\r\n                      </div>\r\n                    </div>\r\n                    <button\r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === \"connecting\"\r\n                          ? \"bg-yellow-600\"\r\n                          : device.status === \"online\"\r\n                            ? \"bg-green-600\"\r\n                            : \"bg-blue-600\"\r\n                      }`}\r\n                      onClick={() => connectToUsbDevice(device)}\r\n                      disabled={device.status === \"connecting\"}\r\n                    >\r\n                      {device.status === \"connecting\" ? \"...\" : \"Connect\"}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button\r\n                    className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\r\n                    onClick={startUsbConnection}\r\n                  >\r\n                    Rescan USB\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\r\n                <button\r\n                  className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\r\n                  onClick={startUsbConnection}\r\n                >\r\n                  Scan USB\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {!streaming && (\r\n        <div className=\"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div>\r\n              <div className=\"text-[10px] uppercase tracking-wide text-slate-500\">\r\n                Camera modes\r\n              </div>\r\n              <div className=\"text-sm font-semibold text-slate-900\">\r\n                Reconnect camera\r\n              </div>\r\n            </div>\r\n            <span className=\"text-xs text-slate-500\">\r\n              Current: {modeDisplayName[mode] || \"Local\"}\r\n            </span>\r\n          </div>\r\n          <p className=\"text-xs text-slate-500 mb-2\">\r\n            Tap a mode to restart the feed or switch inputs.\r\n          </p>\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {reconnectOptions.map((option) => {\r\n              const isActive =\r\n                option.id === \"usb\" ? usbActive : option.id === mode;\r\n              return (\r\n                <button\r\n                  key={option.id}\r\n                  type=\"button\"\r\n                  onClick={option.action}\r\n                  className={`text-left p-3 rounded-2xl border ${isActive ? \"border-emerald-500 bg-emerald-50 shadow\" : \"border-slate-200 bg-white/80 hover:bg-slate-50\"} transition`}\r\n                >\r\n                  <div className=\"text-xs font-semibold uppercase tracking-wide text-slate-500\">\r\n                    {option.title}\r\n                  </div>\r\n                  <div className=\"text-[11px] text-slate-600 mt-1\">\r\n                    {option.description}\r\n                  </div>\r\n                  {isActive && (\r\n                    <div className=\"text-[10px] text-emerald-500 mt-2\">\r\n                      Active\r\n                    </div>\r\n                  )}\r\n                </button>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect, useRef } from \"react\";\r\nimport useHeatmapStore from \"../store/heatmap\";\r\nimport { BoardRadii } from \"../utils/vision\";\r\n\r\nfunction polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {\r\n  const a = ((angleDeg - 90) * Math.PI) / 180.0;\r\n  return { x: cx + r * Math.cos(a), y: cy + r * Math.sin(a) };\r\n}\r\n\r\nfunction sectorAngle(sector: number) {\r\n  // SectorOrder puts 20 at top; 360/20 = 18deg per sector\r\n  const SectorOrder = [\r\n    20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5,\r\n  ];\r\n  const idx = SectorOrder.indexOf(sector);\r\n  const mid = idx * 18 + 9; // middle of sector\r\n  return mid;\r\n}\r\n\r\nexport default function HeatMap({\r\n  width = 320,\r\n  height = 320,\r\n}: {\r\n  width?: number;\r\n  height?: number;\r\n}) {\r\n  const samples = useHeatmapStore((s) => s.samples);\r\n  const ref = useRef<HTMLCanvasElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    const c = ref.current;\r\n    if (!c) return;\r\n    const ctx = c.getContext(\"2d\");\r\n    if (!ctx) return;\r\n    c.width = width;\r\n    c.height = height;\r\n    ctx.clearRect(0, 0, width, height);\r\n    // Draw a faint dartboard backdrop (rings)\r\n    const cx = width / 2;\r\n    const cy = height / 2;\r\n    const scale = Math.min(width, height) / (BoardRadii.doubleOuter * 2 + 20);\r\n    const radii = {\r\n      bullInner: BoardRadii.bullInner * scale,\r\n      bullOuter: BoardRadii.bullOuter * scale,\r\n      trebleInner: BoardRadii.trebleInner * scale,\r\n      trebleOuter: BoardRadii.trebleOuter * scale,\r\n      doubleInner: BoardRadii.doubleInner * scale,\r\n      doubleOuter: BoardRadii.doubleOuter * scale,\r\n    };\r\n    // rings\r\n    ctx.strokeStyle = \"rgba(255,255,255,0.06)\";\r\n    ctx.lineWidth = 1;\r\n    const ringOrder = [\r\n      \"doubleOuter\",\r\n      \"doubleInner\",\r\n      \"trebleOuter\",\r\n      \"trebleInner\",\r\n      \"bullOuter\",\r\n      \"bullInner\",\r\n    ] as const;\r\n    for (const k of ringOrder) {\r\n      ctx.beginPath();\r\n      ctx.arc(cx, cy, (radii as any)[k], 0, Math.PI * 2);\r\n      ctx.stroke();\r\n    }\r\n\r\n    // Aggregate sample weights by approximate xy\r\n    const points: { x: number; y: number; w: number }[] = [];\r\n    for (const s of samples) {\r\n      // if sector unknown, scatter in board\r\n      let angle = Math.random() * 360;\r\n      let r = Math.random() * radii.doubleOuter;\r\n      if (typeof s.sector === \"number\" && s.sector >= 1 && s.sector <= 20) {\r\n        angle = sectorAngle(s.sector);\r\n        // choose radius by mult/ring\r\n        if (s.ring === \"DOUBLE\")\r\n          r = (radii.doubleInner + radii.doubleOuter) / 2;\r\n        else if (s.ring === \"TRIPLE\")\r\n          r = (radii.trebleInner + radii.trebleOuter) / 2;\r\n        else if (s.ring === \"INNER_BULL\") r = radii.bullInner * 0.5;\r\n        else if (s.ring === \"BULL\") r = radii.bullOuter * 0.8;\r\n        else\r\n          r =\r\n            ((radii.trebleOuter + radii.doubleInner) / 2) *\r\n            (0.6 + Math.random() * 0.4);\r\n      }\r\n      const p = polarToCartesian(cx, cy, r, angle);\r\n      points.push({ x: p.x, y: p.y, w: 1 });\r\n    }\r\n\r\n    // Draw heat circles additive\r\n    for (const p of points) {\r\n      const grd = ctx.createRadialGradient(p.x, p.y, 1, p.x, p.y, 60);\r\n      grd.addColorStop(0, \"rgba(255,0,0,0.9)\");\r\n      grd.addColorStop(0.3, \"rgba(255,100,0,0.5)\");\r\n      grd.addColorStop(1, \"rgba(255,100,0,0)\");\r\n      ctx.fillStyle = grd;\r\n      ctx.beginPath();\r\n      ctx.arc(p.x, p.y, 60, 0, Math.PI * 2);\r\n      ctx.fill();\r\n    }\r\n\r\n    // Optionally overlay counts per sector\r\n    ctx.fillStyle = \"rgba(255,255,255,0.85)\";\r\n    ctx.font = \"12px ui-sans-serif\";\r\n    // compute counts per sector\r\n    const sectorCounts: Record<number, number> = {};\r\n    for (const s of samples)\r\n      if (s.sector) sectorCounts[s.sector] = (sectorCounts[s.sector] || 0) + 1;\r\n    for (const secStr of Object.keys(sectorCounts)) {\r\n      const sec = Number(secStr);\r\n      const a = sectorAngle(sec);\r\n      const pos = polarToCartesian(cx, cy, radii.trebleOuter + 18, a);\r\n      ctx.fillText(String(sectorCounts[sec]), pos.x - 6, pos.y + 4);\r\n    }\r\n  }, [samples, width, height]);\r\n\r\n  return (\r\n    <canvas\r\n      ref={ref}\r\n      style={{\r\n        width: \"100%\",\r\n        height: \"auto\",\r\n        borderRadius: 8,\r\n        background: \"#081018\",\r\n      }}\r\n    />\r\n  );\r\n}\r\n","export type DartMult = \"S\" | \"D\" | \"T\";\r\nexport type Dart = { mult: DartMult; num: number } | { bull: 25 | 50 };\r\n\r\nexport type DoublePracticeState = {\r\n  targetIndex: number; // 0..20 for D1..D20 then 21 for DBULL\r\n  completed: boolean;\r\n};\r\n\r\nexport const DOUBLE_PRACTICE_TARGETS: Array<{\r\n  label: string;\r\n  score: number;\r\n  isBull?: boolean;\r\n}>[] = [] as any;\r\n\r\nexport const DOUBLE_PRACTICE_ORDER: {\r\n  label: string;\r\n  score: number;\r\n  isBull?: boolean;\r\n}[] = [\r\n  ...Array.from({ length: 20 }, (_, i) => ({\r\n    label: `D${i + 1}`,\r\n    score: (i + 1) * 2,\r\n  })),\r\n  { label: \"DBULL\", score: 50, isBull: true },\r\n];\r\n\r\nexport function isDoubleHit(value: number, targetIdx: number): boolean {\r\n  const t = DOUBLE_PRACTICE_ORDER[targetIdx];\r\n  return !!t && value === t.score;\r\n}\r\n\r\nexport function parseManualDart(input: string): number | null {\r\n  const t = input.trim().toUpperCase();\r\n  if (!t) return null;\r\n  if (t === \"50\" || t === \"BULL\" || t === \"DBULL\" || t === \"IBULL\") return 50;\r\n  if (t === \"25\" || t === \"OBULL\") return 25;\r\n  const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\r\n  if (!m) return null;\r\n  const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\r\n  const num = parseInt(m[2], 10);\r\n  if (num < 1 || num > 20) return null;\r\n  const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\r\n  return num * multVal;\r\n}\r\n\r\n// Parse a detailed dart string like \"T20\", \"D16\", \"S5\", \"25\", \"50\", \"BULL\", returning a structured Dart.\r\nexport function parseDartDetailed(input: string): Dart | null {\r\n  const t = input.trim().toUpperCase();\r\n  if (!t) return null;\r\n  if (\r\n    t === \"50\" ||\r\n    t === \"BULL\" ||\r\n    t === \"DBULL\" ||\r\n    t === \"IBULL\" ||\r\n    t === \"INNER BULL\" ||\r\n    t === \"INNER_BULL\"\r\n  )\r\n    return { bull: 50 };\r\n  if (t === \"25\" || t === \"OBULL\" || t === \"OUTER BULL\" || t === \"BULL25\")\r\n    return { bull: 25 };\r\n  const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\r\n  if (!m) return null;\r\n  const mult = (m[1] || \"S\") as DartMult;\r\n  const num = parseInt(m[2], 10);\r\n  if (num < 1 || num > 20) return null;\r\n  return { mult, num };\r\n}\r\n\r\n// Convert autoscore ring+sector data into a structured Dart\r\n// ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n// sector: 1..20 for numbered segments; null/undefined for bull/miss\r\nexport function ringSectorToDart(\r\n  ring?: string,\r\n  sector?: number | null,\r\n): Dart | null {\r\n  if (!ring || ring === \"MISS\") return null;\r\n  if (ring === \"BULL\") return { bull: 25 };\r\n  if (ring === \"INNER_BULL\") return { bull: 50 };\r\n  if (typeof sector === \"number\" && sector >= 1 && sector <= 20) {\r\n    const mult: DartMult =\r\n      ring === \"DOUBLE\" ? \"D\" : ring === \"TRIPLE\" ? \"T\" : \"S\";\r\n    return { mult, num: sector };\r\n  }\r\n  return null;\r\n}\r\n","export type ATCState = {\r\n  target: number; // 1..20 then 25 (outer bull) then 50 (inner)\r\n  finished: boolean;\r\n};\r\n\r\nexport const ATC_ORDER: number[] = [\r\n  ...Array.from({ length: 20 }, (_, i) => i + 1),\r\n  25,\r\n  50,\r\n];\r\n\r\nexport function nextTarget(current: number): number | null {\r\n  const idx = ATC_ORDER.indexOf(current);\r\n  if (idx < 0) return ATC_ORDER[0];\r\n  if (idx >= ATC_ORDER.length - 1) return null;\r\n  return ATC_ORDER[idx + 1];\r\n}\r\n\r\nexport function isCorrectHit(value: number, target: number): boolean {\r\n  return value === target;\r\n}\r\n","export type CricketMark = 0 | 1 | 2 | 3;\r\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25; // 25 is bull (outer+inner)\r\n\r\nexport type CricketState = {\r\n  // marks per number\r\n  marks: Record<CricketNumber, CricketMark>;\r\n  // accumulated points when opponent hasn't closed a number\r\n  points: number;\r\n};\r\n\r\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25];\r\n\r\nexport function createCricketState(): CricketState {\r\n  const marks: any = {};\r\n  CRICKET_NUMBERS.forEach((n) => {\r\n    marks[n] = 0;\r\n  });\r\n  return { marks, points: 0 };\r\n}\r\n\r\n// Apply a single dart to a player's cricket state\r\n// Returns deltaPoints scored on this dart\r\nexport function applyCricketDart(\r\n  state: CricketState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n  opponentClosed: (n: CricketNumber) => boolean = () => false,\r\n): number {\r\n  // Map autoscore terms to logical hits\r\n  let num: CricketNumber | null = null;\r\n  let hits = 0;\r\n  if (\r\n    ring === \"BULL\" ||\r\n    ring === \"INNER_BULL\" ||\r\n    value === 25 ||\r\n    value === 50\r\n  ) {\r\n    num = 25;\r\n    hits = ring === \"INNER_BULL\" || value === 50 ? 2 : 1;\r\n  } else if (\r\n    typeof sector === \"number\" &&\r\n    (sector as number) >= 15 &&\r\n    (sector as number) <= 20\r\n  ) {\r\n    num = sector as CricketNumber;\r\n    if (ring === \"TRIPLE\") hits = 3;\r\n    else if (ring === \"DOUBLE\") hits = 2;\r\n    else hits = 1;\r\n  } else if (value) {\r\n    // Fallback when only numeric score provided (manual): infer by divisibility\r\n    const cand: CricketNumber[] = [20, 19, 18, 17, 16, 15];\r\n    for (const c of cand) {\r\n      if (value === c) {\r\n        num = c;\r\n        hits = 1;\r\n        break;\r\n      }\r\n      if (value === c * 2) {\r\n        num = c;\r\n        hits = 2;\r\n        break;\r\n      }\r\n      if (value === c * 3) {\r\n        num = c;\r\n        hits = 3;\r\n        break;\r\n      }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) {\r\n      num = 25;\r\n      hits = value === 50 ? 2 : 1;\r\n    }\r\n  }\r\n  if (!num) return 0;\r\n\r\n  const before = state.marks[num];\r\n  const remainToClose = Math.max(0, 3 - before);\r\n  const toApply = Math.min(remainToClose, hits);\r\n  const overflow = Math.max(0, hits - toApply);\r\n  // Increase marks up to 3\r\n  const after = (before + toApply) as CricketMark;\r\n  state.marks[num] = after > 3 ? 3 : after;\r\n\r\n  // Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\r\n  let points = 0;\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      // Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\r\n      if (ring === \"INNER_BULL\") points += 50 * overflow;\r\n      else points += 25 * overflow;\r\n    } else {\r\n      points += num * overflow;\r\n    }\r\n  }\r\n\r\n  state.points += points;\r\n  return points;\r\n}\r\n\r\nexport function hasClosedAll(state: CricketState): boolean {\r\n  return CRICKET_NUMBERS.every((n) => (state.marks[n] || 0) >= 3);\r\n}\r\n\r\nexport function cricketWinner(\r\n  self: CricketState,\r\n  opponents: CricketState[],\r\n): boolean {\r\n  // Win when all closed and you have >= opponents' points\r\n  if (!hasClosedAll(self)) return false;\r\n  const maxOppPoints = Math.max(0, ...opponents.map((o) => o.points));\r\n  return self.points >= maxOppPoints;\r\n}\r\n","export type ShanghaiRound =\r\n  | 1\r\n  | 2\r\n  | 3\r\n  | 4\r\n  | 5\r\n  | 6\r\n  | 7\r\n  | 8\r\n  | 9\r\n  | 10\r\n  | 11\r\n  | 12\r\n  | 13\r\n  | 14\r\n  | 15\r\n  | 16\r\n  | 17\r\n  | 18\r\n  | 19\r\n  | 20;\r\n\r\nexport type ShanghaiState = {\r\n  round: ShanghaiRound;\r\n  score: number;\r\n  finished: boolean;\r\n  shanghaiAchieved: boolean; // single+double+triple of target in same 3-dart turn\r\n  turnHits: { singles: number; doubles: number; triples: number };\r\n};\r\n\r\nexport function createShanghaiState(): ShanghaiState {\r\n  return {\r\n    round: 1,\r\n    score: 0,\r\n    finished: false,\r\n    shanghaiAchieved: false,\r\n    turnHits: { singles: 0, doubles: 0, triples: 0 },\r\n  };\r\n}\r\n\r\nexport function getRoundTarget(state: ShanghaiState): number {\r\n  return state.round;\r\n}\r\n\r\n// Apply one dart; returns points scored on this dart\r\nexport function applyShanghaiDart(\r\n  state: ShanghaiState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): number {\r\n  if (state.finished) return 0;\r\n  const target = getRoundTarget(state);\r\n  let points = 0;\r\n  if (typeof sector === \"number\" && sector === target) {\r\n    if (ring === \"TRIPLE\") {\r\n      points = target * 3;\r\n      state.turnHits.triples++;\r\n    } else if (ring === \"DOUBLE\") {\r\n      points = target * 2;\r\n      state.turnHits.doubles++;\r\n    } else if (ring === \"SINGLE\") {\r\n      points = target * 1;\r\n      state.turnHits.singles++;\r\n    }\r\n  } else if (\r\n    !sector &&\r\n    (value === target || value === target * 2 || value === target * 3)\r\n  ) {\r\n    // manual numeric entry fallback\r\n    if (value === target * 3) {\r\n      points = target * 3;\r\n      state.turnHits.triples++;\r\n    } else if (value === target * 2) {\r\n      points = target * 2;\r\n      state.turnHits.doubles++;\r\n    } else if (value === target) {\r\n      points = target;\r\n      state.turnHits.singles++;\r\n    }\r\n  }\r\n  state.score += points;\r\n  return points;\r\n}\r\n\r\n// Call at end of 3-dart turn; advances round and checks Shanghai\r\nexport function endShanghaiTurn(state: ShanghaiState) {\r\n  if (!state.finished) {\r\n    if (\r\n      state.turnHits.singles > 0 &&\r\n      state.turnHits.doubles > 0 &&\r\n      state.turnHits.triples > 0\r\n    ) {\r\n      state.shanghaiAchieved = true;\r\n      state.finished = true;\r\n      return;\r\n    }\r\n    const next = (state.round + 1) as ShanghaiRound;\r\n    if (next > 20) {\r\n      state.finished = true;\r\n    } else {\r\n      state.round = next;\r\n    }\r\n  }\r\n  // reset per-turn hits\r\n  state.turnHits = { singles: 0, doubles: 0, triples: 0 };\r\n}\r\n","export type HalveItTarget =\r\n  | { kind: \"ANY_NUMBER\" }\r\n  | { kind: \"DOUBLE\"; num: number }\r\n  | { kind: \"TRIPLE\"; num: number }\r\n  | { kind: \"BULL\" }\r\n  | { kind: \"NUMBER\"; num: number };\r\n\r\nexport type HalveItState = {\r\n  stage: number;\r\n  targets: HalveItTarget[];\r\n  score: number;\r\n  finished: boolean;\r\n  hitThisRound: boolean;\r\n};\r\n\r\nexport function createDefaultHalveIt(): HalveItState {\r\n  const targets: HalveItTarget[] = [\r\n    { kind: \"NUMBER\", num: 20 },\r\n    { kind: \"DOUBLE\", num: 16 },\r\n    { kind: \"TRIPLE\", num: 14 },\r\n    { kind: \"NUMBER\", num: 19 },\r\n    { kind: \"BULL\" },\r\n    { kind: \"ANY_NUMBER\" },\r\n  ];\r\n  return { stage: 0, targets, score: 0, finished: false, hitThisRound: false };\r\n}\r\n\r\nexport function getCurrentHalveTarget(\r\n  state: HalveItState,\r\n): HalveItTarget | null {\r\n  return state.targets[state.stage] || null;\r\n}\r\n\r\nexport function applyHalveItDart(\r\n  state: HalveItState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): number {\r\n  if (state.finished) return 0;\r\n  const t = getCurrentHalveTarget(state);\r\n  if (!t) return 0;\r\n  let scored = 0;\r\n  switch (t.kind) {\r\n    case \"NUMBER\": {\r\n      if (typeof sector === \"number\" && sector === t.num) {\r\n        if (ring === \"TRIPLE\") scored = t.num * 3;\r\n        else if (ring === \"DOUBLE\") scored = t.num * 2;\r\n        else if (ring === \"SINGLE\") scored = t.num;\r\n      } else if (\r\n        !sector &&\r\n        (value === t.num || value === t.num * 2 || value === t.num * 3)\r\n      ) {\r\n        scored = value;\r\n      }\r\n      if (scored > 0) state.hitThisRound = true;\r\n      break;\r\n    }\r\n    case \"DOUBLE\": {\r\n      if ((ring === \"DOUBLE\" && sector === t.num) || value === t.num * 2) {\r\n        scored = t.num * 2;\r\n        state.hitThisRound = true;\r\n      }\r\n      break;\r\n    }\r\n    case \"TRIPLE\": {\r\n      if ((ring === \"TRIPLE\" && sector === t.num) || value === t.num * 3) {\r\n        scored = t.num * 3;\r\n        state.hitThisRound = true;\r\n      }\r\n      break;\r\n    }\r\n    case \"BULL\": {\r\n      if (\r\n        ring === \"BULL\" ||\r\n        ring === \"INNER_BULL\" ||\r\n        value === 25 ||\r\n        value === 50\r\n      ) {\r\n        scored = ring === \"INNER_BULL\" || value === 50 ? 50 : 25;\r\n        state.hitThisRound = true;\r\n      }\r\n      break;\r\n    }\r\n    case \"ANY_NUMBER\": {\r\n      // any valid score counts\r\n      if (value > 0) {\r\n        scored = value;\r\n        state.hitThisRound = true;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  state.score += scored;\r\n  return scored;\r\n}\r\n\r\nexport function endHalveItTurn(state: HalveItState) {\r\n  if (state.finished) return;\r\n  if (!state.hitThisRound) {\r\n    state.score = Math.floor(state.score / 2);\r\n  }\r\n  state.hitThisRound = false;\r\n  state.stage += 1;\r\n  if (state.stage >= state.targets.length) state.finished = true;\r\n}\r\n","export type HighLowState = {\r\n  round: number;\r\n  score: number;\r\n  target: \"HIGH\" | \"LOW\";\r\n  finished: boolean;\r\n};\r\n\r\nexport function createHighLow(): HighLowState {\r\n  return { round: 1, score: 0, target: \"HIGH\", finished: false };\r\n}\r\n\r\nexport function applyHighLowDart(\r\n  state: HighLowState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): number {\r\n  if (state.finished) return 0;\r\n  // For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\r\n  // When LOW, count only scores <= 10 (any ring) and bull does not count\r\n  let scored = 0;\r\n  if (state.target === \"HIGH\") {\r\n    if (ring === \"INNER_BULL\") scored = 50;\r\n    else if (typeof sector === \"number\") {\r\n      const mult = ring === \"TRIPLE\" ? 3 : ring === \"DOUBLE\" ? 2 : 1;\r\n      const v = sector * mult;\r\n      if (sector >= 20) scored = v;\r\n    } else {\r\n      // manual numeric fallback\r\n      if (value >= 40) scored = value;\r\n    }\r\n  } else {\r\n    if (typeof sector === \"number\") {\r\n      const mult = ring === \"TRIPLE\" ? 3 : ring === \"DOUBLE\" ? 2 : 1;\r\n      const v = sector * mult;\r\n      if (sector <= 10) scored = v;\r\n    } else {\r\n      if (value > 0 && value <= 30) scored = value;\r\n    }\r\n  }\r\n  state.score += scored;\r\n  return scored;\r\n}\r\n\r\nexport function endHighLowTurn(state: HighLowState) {\r\n  if (state.finished) return;\r\n  state.round += 1;\r\n  if (state.round > 10) {\r\n    state.finished = true;\r\n    return;\r\n  }\r\n  state.target = state.target === \"HIGH\" ? \"LOW\" : \"HIGH\";\r\n}\r\n","export type KillerState = {\r\n  number: number; // assigned sector 1..20\r\n  lives: number; // start with 3\r\n  isKiller: boolean; // became killer by hitting own double\r\n  eliminated: boolean;\r\n};\r\n\r\nexport function createKillerState(assigned: number, lives = 3): KillerState {\r\n  return { number: assigned, lives, isKiller: false, eliminated: false };\r\n}\r\n\r\n// Assign unique random numbers (1..20) to each player id\r\nexport function assignKillerNumbers<T extends string>(\r\n  playerIds: T[],\r\n): Record<T, number> {\r\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1);\r\n  const res: any = {};\r\n  for (const id of playerIds) {\r\n    // pick a random remaining number\r\n    const idx = Math.floor(Math.random() * pool.length);\r\n    const num = pool.splice(idx, 1)[0];\r\n    res[id] = num;\r\n  }\r\n  return res;\r\n}\r\n\r\n// Apply a single dart in Killer context.\r\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\r\nexport function applyKillerDart(\r\n  selfId: string,\r\n  states: Record<string, KillerState>,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\r\n  const me = states[selfId];\r\n  if (!me || !sector || !ring) return { becameKiller: false };\r\n  // Becoming killer: hit your own DOUBLE only\r\n  if (!me.isKiller && ring === \"DOUBLE\" && sector === me.number) {\r\n    me.isKiller = true;\r\n    return { becameKiller: true };\r\n  }\r\n  // If already killer, hitting opponents' doubles/triples removes lives\r\n  if (me.isKiller && (ring === \"DOUBLE\" || ring === \"TRIPLE\")) {\r\n    const victimId = Object.keys(states).find(\r\n      (pid) =>\r\n        pid !== selfId &&\r\n        !states[pid].eliminated &&\r\n        states[pid].number === sector,\r\n    );\r\n    if (victimId) {\r\n      const victim = states[victimId];\r\n      const delta = ring === \"TRIPLE\" ? 2 : 1;\r\n      victim.lives = Math.max(0, victim.lives - delta);\r\n      if (victim.lives === 0) victim.eliminated = true;\r\n      return { becameKiller: false, victimId, livesRemoved: delta };\r\n    }\r\n  }\r\n  return { becameKiller: false };\r\n}\r\n\r\nexport function killerWinner(\r\n  states: Record<string, KillerState>,\r\n): string | null {\r\n  const alive = Object.entries(states).filter(\r\n    ([, st]) => !st.eliminated && st.lives > 0,\r\n  );\r\n  if (alive.length === 1) return alive[0][0];\r\n  return null;\r\n}\r\n","export type BaseballInning = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9;\r\n\r\nexport type BaseballState = {\r\n  inning: BaseballInning;\r\n  score: number;\r\n  dartsThisInning: number;\r\n  finished: boolean;\r\n};\r\n\r\nexport function createBaseball(): BaseballState {\r\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false };\r\n}\r\n\r\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\r\nexport function applyBaseballDart(\r\n  state: BaseballState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\r\n  sector?: number | null,\r\n): number {\r\n  if (state.finished) return 0;\r\n  let runs = 0;\r\n  if (typeof sector === \"number\" && sector === state.inning) {\r\n    if (ring === \"TRIPLE\") runs = 3;\r\n    else if (ring === \"DOUBLE\") runs = 2;\r\n    else runs = 1;\r\n  } else if (\r\n    !sector &&\r\n    (value === state.inning ||\r\n      value === state.inning * 2 ||\r\n      value === state.inning * 3)\r\n  ) {\r\n    runs = value === state.inning * 3 ? 3 : value === state.inning * 2 ? 2 : 1;\r\n  }\r\n  state.score += runs;\r\n  state.dartsThisInning += 1;\r\n  if (state.dartsThisInning >= 3) {\r\n    const next = (state.inning + 1) as BaseballInning;\r\n    if (next > 9) state.finished = true;\r\n    else {\r\n      state.inning = next;\r\n      state.dartsThisInning = 0;\r\n    }\r\n  }\r\n  return runs;\r\n}\r\n","export type GolfHole =\r\n  | 1\r\n  | 2\r\n  | 3\r\n  | 4\r\n  | 5\r\n  | 6\r\n  | 7\r\n  | 8\r\n  | 9\r\n  | 10\r\n  | 11\r\n  | 12\r\n  | 13\r\n  | 14\r\n  | 15\r\n  | 16\r\n  | 17\r\n  | 18;\r\n\r\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\r\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\r\n\r\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\r\n  1: 5,\r\n  2: 20,\r\n  3: 1,\r\n  4: 18,\r\n  5: 4,\r\n  6: 13,\r\n  7: 6,\r\n  8: 10,\r\n  9: 15,\r\n  10: 2,\r\n  11: 17,\r\n  12: 3,\r\n  13: 19,\r\n  14: 7,\r\n  15: 16,\r\n  16: 8,\r\n  17: 11,\r\n  18: 14,\r\n};\r\n\r\nexport type GolfState = {\r\n  hole: GolfHole;\r\n  strokes: number;\r\n  dartsThisHole: number;\r\n  finished: boolean;\r\n};\r\n\r\nexport function createGolf(): GolfState {\r\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false };\r\n}\r\n\r\nexport function applyGolfDart(\r\n  state: GolfState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\r\n  sector?: number | null,\r\n): boolean {\r\n  if (state.finished) return false;\r\n  const target = GOLF_TARGETS[state.hole];\r\n  state.dartsThisHole += 1;\r\n  const hit =\r\n    (typeof sector === \"number\" &&\r\n      sector === target &&\r\n      (ring === \"SINGLE\" || ring === \"DOUBLE\" || ring === \"TRIPLE\")) ||\r\n    (!sector &&\r\n      (value === target || value === target * 2 || value === target * 3));\r\n  if (hit) {\r\n    state.strokes += state.dartsThisHole;\r\n    // advance to next hole\r\n    const next = (state.hole + 1) as GolfHole;\r\n    if (next > 18) state.finished = true;\r\n    else {\r\n      state.hole = next;\r\n      state.dartsThisHole = 0;\r\n    }\r\n    return true;\r\n  }\r\n  // If not finished and took 3 darts, score 3 and advance hole\r\n  if (state.dartsThisHole >= 3) {\r\n    state.strokes += 3;\r\n    const next = (state.hole + 1) as GolfHole;\r\n    if (next > 18) state.finished = true;\r\n    else {\r\n      state.hole = next;\r\n      state.dartsThisHole = 0;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n","export type TicCell = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8;\r\n\r\n// Map grid cells to targets: center uses Bull; edges/corners use numbers.\r\nexport const TTT_TARGETS: Record<\r\n  TicCell,\r\n  { type: \"NUM\" | \"BULL\"; num?: number }\r\n> = {\r\n  0: { type: \"NUM\", num: 20 },\r\n  1: { type: \"NUM\", num: 19 },\r\n  2: { type: \"NUM\", num: 18 },\r\n  3: { type: \"NUM\", num: 17 },\r\n  4: { type: \"BULL\" },\r\n  5: { type: \"NUM\", num: 16 },\r\n  6: { type: \"NUM\", num: 15 },\r\n  7: { type: \"NUM\", num: 14 },\r\n  8: { type: \"NUM\", num: 13 },\r\n};\r\n\r\nexport type TicTacToeState = {\r\n  board: Array<\"X\" | \"O\" | null>;\r\n  turn: \"X\" | \"O\";\r\n  finished: boolean;\r\n  winner: \"X\" | \"O\" | \"Draw\" | null;\r\n};\r\n\r\nexport function createTicTacToe(): TicTacToeState {\r\n  return {\r\n    board: Array(9).fill(null),\r\n    turn: \"X\",\r\n    finished: false,\r\n    winner: null,\r\n  };\r\n}\r\n\r\nfunction checkWin(board: Array<\"X\" | \"O\" | null>): \"X\" | \"O\" | \"Draw\" | null {\r\n  const lines = [\r\n    [0, 1, 2],\r\n    [3, 4, 5],\r\n    [6, 7, 8],\r\n    [0, 3, 6],\r\n    [1, 4, 7],\r\n    [2, 5, 8],\r\n    [0, 4, 8],\r\n    [2, 4, 6],\r\n  ];\r\n  for (const [a, b, c] of lines) {\r\n    if (board[a] && board[a] === board[b] && board[a] === board[c])\r\n      return board[a] as \"X\" | \"O\";\r\n  }\r\n  if (board.every((c) => c)) return \"Draw\";\r\n  return null;\r\n}\r\n\r\nexport function tryClaimCell(\r\n  state: TicTacToeState,\r\n  cell: TicCell,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n): boolean {\r\n  if (state.finished || state.board[cell]) return false;\r\n  const tgt = TTT_TARGETS[cell];\r\n  let ok = false;\r\n  if (tgt.type === \"BULL\")\r\n    ok =\r\n      ring === \"BULL\" || ring === \"INNER_BULL\" || value === 25 || value === 50;\r\n  else if (tgt.type === \"NUM\" && typeof tgt.num === \"number\") {\r\n    if (typeof sector === \"number\" && sector === tgt.num) ok = true;\r\n    else if (\r\n      !sector &&\r\n      (value === tgt.num || value === tgt.num * 2 || value === tgt.num * 3)\r\n    )\r\n      ok = true;\r\n  }\r\n  if (!ok) return false;\r\n  state.board[cell] = state.turn;\r\n  const w = checkWin(state.board);\r\n  if (w) {\r\n    state.finished = true;\r\n    state.winner = w;\r\n    return true;\r\n  }\r\n  state.turn = state.turn === \"X\" ? \"O\" : \"X\";\r\n  return true;\r\n}\r\n","/**\r\n * Scam, Fives, and Sevens game logic\r\n * All three follow a similar score-race pattern:\r\n * - Players accumulate scores\r\n * - Only certain numbers count\r\n * - First to reach target wins\r\n */\r\n\r\n// SCAM/SCUM - Hit targets 1â†’20â†’Bull in sequence\r\nexport interface ScamState {\r\n  targetIndex: number; // 0-20 for numbers 1-20, 21 for bull (25/50)\r\n  darts: number;\r\n  finished: boolean;\r\n}\r\n\r\nexport function createScamState(): ScamState {\r\n  return {\r\n    targetIndex: 0,\r\n    darts: 0,\r\n    finished: false,\r\n  };\r\n}\r\n\r\nexport const SCAM_TARGETS = [\r\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25,\r\n];\r\nexport const SCAM_TARGET_NAMES = [\r\n  \"1\",\r\n  \"2\",\r\n  \"3\",\r\n  \"4\",\r\n  \"5\",\r\n  \"6\",\r\n  \"7\",\r\n  \"8\",\r\n  \"9\",\r\n  \"10\",\r\n  \"11\",\r\n  \"12\",\r\n  \"13\",\r\n  \"14\",\r\n  \"15\",\r\n  \"16\",\r\n  \"17\",\r\n  \"18\",\r\n  \"19\",\r\n  \"20\",\r\n  \"Bull\",\r\n];\r\n\r\nexport function getScamTarget(state: ScamState): number {\r\n  return SCAM_TARGETS[state.targetIndex];\r\n}\r\n\r\nexport function addScamAuto(\r\n  state: ScamState,\r\n  value: number,\r\n  ring?: string,\r\n): ScamState {\r\n  if (state.finished) return state;\r\n\r\n  const target = getScamTarget(state);\r\n  const targetHit =\r\n    (ring === \"SINGLE\" && value === target) ||\r\n    (ring === \"DOUBLE\" && value === target) ||\r\n    (ring === \"TRIPLE\" && value === target) ||\r\n    (ring === \"INNER_BULL\" && target === 25);\r\n\r\n  if (!targetHit) return state;\r\n\r\n  // Hit! Move to next target\r\n  const newIndex = state.targetIndex + 1;\r\n  const finished = newIndex >= SCAM_TARGETS.length;\r\n\r\n  return {\r\n    targetIndex: newIndex,\r\n    darts: state.darts + 1,\r\n    finished,\r\n  };\r\n}\r\n\r\nexport function addScamNumeric(state: ScamState, value: number): ScamState {\r\n  // For manual input, assume single ring hit\r\n  return addScamAuto(state, value, \"SINGLE\");\r\n}\r\n\r\nexport function resetScam(): ScamState {\r\n  return createScamState();\r\n}\r\n\r\n// FIVES - Only multiples of 5 count (5,10,15,20,25,50)\r\nexport interface FivesState {\r\n  score: number;\r\n  darts: number;\r\n  finished: boolean;\r\n  target: number; // default 50\r\n}\r\n\r\nexport function createFivesState(target: number = 50): FivesState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  };\r\n}\r\n\r\nexport const FIVES_VALID_NUMBERS = [5, 10, 15, 20, 25, 50];\r\n\r\nexport function isFivesValid(value: number): boolean {\r\n  return FIVES_VALID_NUMBERS.includes(value);\r\n}\r\n\r\nexport function addFivesAuto(\r\n  state: FivesState,\r\n  value: number,\r\n  ring?: string,\r\n): FivesState {\r\n  if (state.finished) return state;\r\n\r\n  // Only multiples of 5 count\r\n  if (!isFivesValid(value)) {\r\n    return { ...state, darts: state.darts + 1 };\r\n  }\r\n\r\n  const newScore = state.score + value;\r\n  const finished = newScore >= state.target;\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  };\r\n}\r\n\r\nexport function addFivesNumeric(state: FivesState, value: number): FivesState {\r\n  return addFivesAuto(state, value, \"SINGLE\");\r\n}\r\n\r\nexport function resetFives(target: number = 50): FivesState {\r\n  return createFivesState(target);\r\n}\r\n\r\n// SEVENS - Only multiples of 7 count (7,14,21)\r\nexport interface SevensState {\r\n  score: number;\r\n  darts: number;\r\n  finished: boolean;\r\n  target: number; // default 70\r\n}\r\n\r\nexport function createSevensState(target: number = 70): SevensState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  };\r\n}\r\n\r\nexport const SEVENS_VALID_NUMBERS = [7, 14, 21];\r\n\r\nexport function isSevensValid(value: number): boolean {\r\n  return SEVENS_VALID_NUMBERS.includes(value);\r\n}\r\n\r\nexport function addSevensAuto(\r\n  state: SevensState,\r\n  value: number,\r\n  ring?: string,\r\n): SevensState {\r\n  if (state.finished) return state;\r\n\r\n  // Only multiples of 7 count\r\n  if (!isSevensValid(value)) {\r\n    return { ...state, darts: state.darts + 1 };\r\n  }\r\n\r\n  const newScore = state.score + value;\r\n  const finished = newScore >= state.target;\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  };\r\n}\r\n\r\nexport function addSevensNumeric(\r\n  state: SevensState,\r\n  value: number,\r\n): SevensState {\r\n  return addSevensAuto(state, value, \"SINGLE\");\r\n}\r\n\r\nexport function resetSevens(target: number = 70): SevensState {\r\n  return createSevensState(target);\r\n}\r\n","export type AmCricketMark = 0 | 1 | 2 | 3;\r\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25;\r\n\r\nexport type AmCricketState = {\r\n  marks: Record<AmCricketNumber, AmCricketMark>;\r\n  points: number;\r\n};\r\n\r\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [\r\n  20, 19, 18, 17, 16, 15, 14, 13, 12, 25,\r\n];\r\n\r\nexport function createAmCricketState(): AmCricketState {\r\n  const marks: any = {};\r\n  AM_CRICKET_NUMBERS.forEach((n) => {\r\n    marks[n] = 0;\r\n  });\r\n  return { marks, points: 0 };\r\n}\r\n\r\nexport function applyAmCricketDart(\r\n  state: AmCricketState,\r\n  value: number,\r\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  sector?: number | null,\r\n  opponentClosed: (n: AmCricketNumber) => boolean = () => false,\r\n): number {\r\n  let num: AmCricketNumber | null = null;\r\n  let hits = 0;\r\n  if (\r\n    ring === \"BULL\" ||\r\n    ring === \"INNER_BULL\" ||\r\n    value === 25 ||\r\n    value === 50\r\n  ) {\r\n    num = 25;\r\n    hits = ring === \"INNER_BULL\" || value === 50 ? 2 : 1;\r\n  } else if (typeof sector === \"number\" && sector >= 12 && sector <= 20) {\r\n    num = sector as AmCricketNumber;\r\n    if (ring === \"TRIPLE\") hits = 3;\r\n    else if (ring === \"DOUBLE\") hits = 2;\r\n    else hits = 1;\r\n  } else if (value) {\r\n    for (const c of [20, 19, 18, 17, 16, 15, 14, 13, 12] as AmCricketNumber[]) {\r\n      if (value === c) {\r\n        num = c;\r\n        hits = 1;\r\n        break;\r\n      }\r\n      if (value === c * 2) {\r\n        num = c;\r\n        hits = 2;\r\n        break;\r\n      }\r\n      if (value === c * 3) {\r\n        num = c;\r\n        hits = 3;\r\n        break;\r\n      }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) {\r\n      num = 25;\r\n      hits = value === 50 ? 2 : 1;\r\n    }\r\n  }\r\n  if (!num) return 0;\r\n\r\n  const before = state.marks[num];\r\n  const toClose = Math.max(0, 3 - before);\r\n  const toApply = Math.min(toClose, hits);\r\n  const overflow = Math.max(0, hits - toApply);\r\n  const after = (before + toApply) as AmCricketMark;\r\n  state.marks[num] = after > 3 ? 3 : after;\r\n\r\n  let points = 0;\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      if (ring === \"INNER_BULL\") points += 50 * overflow;\r\n      else points += 25 * overflow;\r\n    } else {\r\n      points += (num as number) * overflow;\r\n    }\r\n  }\r\n  state.points += points;\r\n  return points;\r\n}\r\n\r\nexport function hasClosedAllAm(state: AmCricketState): boolean {\r\n  return AM_CRICKET_NUMBERS.every((n) => (state.marks[n] || 0) >= 3);\r\n}\r\n","// Small adapter helpers to convert generic MatchControls onAddVisit callbacks to the local handlers\r\nexport function makeOnlineAddVisitAdapter(\r\n  submitVisitManual: (v: number) => void,\r\n) {\r\n  return (score: number, darts: number) => {\r\n    submitVisitManual(score);\r\n  };\r\n}\r\n\r\nexport function makeOfflineAddVisitAdapter(\r\n  commitManualVisitTotal: (v: number) => boolean,\r\n) {\r\n  return (score: number, darts: number) => {\r\n    commitManualVisitTotal(score);\r\n  };\r\n}\r\n","import type { Actions as MatchActions } from \"../store/match\";\r\n\r\nexport type UnifiedMatchActions = {\r\n  addVisit: (score: number, darts?: number, meta?: any) => void;\r\n  undoVisit: () => void;\r\n  nextPlayer: () => void;\r\n  endLeg: (score?: number) => void;\r\n  endGame: () => void;\r\n};\r\n\r\nexport function createOnlineMatchActions(args: {\r\n  match: MatchActions;\r\n  sendState: () => void;\r\n  submitVisitManual?: (v: number) => void;\r\n}): UnifiedMatchActions {\r\n  const { match, sendState, submitVisitManual } = args;\r\n  return {\r\n    addVisit: (score: number, darts = 3, meta?: any) => {\r\n      // Prefer the manual submit helper when available as it computes double/finish meta\r\n      if (submitVisitManual) {\r\n        submitVisitManual(score);\r\n        return;\r\n      }\r\n      try {\r\n        match.addVisit(score, darts, meta);\r\n      } catch (e) {\r\n        match.addVisit(score, darts);\r\n      }\r\n      try {\r\n        sendState();\r\n      } catch (e) {}\r\n    },\r\n    undoVisit: () => {\r\n      match.undoVisit();\r\n      try {\r\n        sendState();\r\n      } catch (e) {}\r\n    },\r\n    nextPlayer: () => {\r\n      match.nextPlayer();\r\n      try {\r\n        sendState();\r\n      } catch (e) {}\r\n    },\r\n    endLeg: (score?: number) => {\r\n      if (typeof score === \"number\") match.endLeg(score);\r\n      else match.endLeg(0);\r\n      try {\r\n        sendState();\r\n      } catch (e) {}\r\n    },\r\n    endGame: () => {\r\n      match.endGame();\r\n      try {\r\n        sendState();\r\n      } catch {}\r\n    },\r\n  };\r\n}\r\n\r\nexport function createOfflineMatchActions(args: {\r\n  match: MatchActions;\r\n  commitManualVisitTotal?: (v: number) => boolean;\r\n  endTurn?: (nextRemaining: number) => void;\r\n}): UnifiedMatchActions {\r\n  const { match, commitManualVisitTotal, endTurn } = args;\r\n  return {\r\n    addVisit: (score: number, darts = 3, meta?: any) => {\r\n      if (commitManualVisitTotal) {\r\n        commitManualVisitTotal(score);\r\n        return;\r\n      }\r\n      try {\r\n        match.addVisit(score, darts, meta);\r\n      } catch {\r\n        match.addVisit(score, darts);\r\n      }\r\n    },\r\n    undoVisit: () => {\r\n      match.undoVisit();\r\n    },\r\n    nextPlayer: () => {\r\n      if (endTurn) {\r\n        try {\r\n          endTurn(0);\r\n        } catch {\r\n          match.nextPlayer();\r\n        }\r\n      } else {\r\n        match.nextPlayer();\r\n      }\r\n    },\r\n    endLeg: (score?: number) => {\r\n      if (typeof score === \"number\") match.endLeg(score);\r\n      else match.endLeg(0);\r\n    },\r\n    endGame: () => {\r\n      match.endGame();\r\n    },\r\n  };\r\n}\r\n","/**\r\n * Hook to convert OfflinePlay game state to GameScoreboard format\r\n */\r\n\r\nimport { useMemo } from \"react\";\r\nimport type { PlayerStats } from \"./GameScoreboard\";\r\nimport type { GameMode } from \"./GameScoreboard\";\r\nimport { getAllTimeAvg } from \"../../store/profileStats\";\r\n\r\nexport function useOfflineGameStats(\r\n  gameMode: GameMode,\r\n  // X01 state\r\n  playerScore?: number,\r\n  aiScore?: number,\r\n  playerLegs?: number,\r\n  aiLegs?: number,\r\n  playerLastDart?: number,\r\n  aiLastDart?: number,\r\n  playerVisitSum?: number,\r\n  aiVisitSum?: number,\r\n  playerLastVisitScore?: number | null,\r\n  aiLastVisitScore?: number | null,\r\n  playerVisitDartCount?: number,\r\n  aiVisitDartCount?: number,\r\n  playerDoublesHit?: number,\r\n  playerDoublesAtt?: number,\r\n  aiDoublesHit?: number,\r\n  aiDoublesAtt?: number,\r\n  legStats?: Array<any>,\r\n  isPlayerTurn?: boolean,\r\n  ai?: string,\r\n  x01Score?: number,\r\n  // Cricket state\r\n  cricket?: any,\r\n  // Shanghai state\r\n  shanghai?: any,\r\n  // Killer state\r\n  killerPlayers?: Array<any>,\r\n  killerStates?: Record<string, any>,\r\n  killerAssigned?: Record<string, number>,\r\n  killerTurnIdx?: number,\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (gameMode === \"X01\") {\r\n      // Calculate player match average\r\n      let playerMatchAvg = 0;\r\n      let playerDarts = 0;\r\n      let playerScored = 0;\r\n      if (legStats && legStats.length > 0) {\r\n        for (const leg of legStats) {\r\n          if (leg.dartsThrown && leg.totalScored) {\r\n            playerDarts += leg.dartsThrown;\r\n            playerScored += leg.totalScored;\r\n          }\r\n        }\r\n        if (playerDarts > 0) {\r\n          playerMatchAvg = (playerScored / playerDarts) * 3;\r\n        }\r\n      }\r\n\r\n      // Player card\r\n      const playerVisitDarts = playerVisitDartCount ?? 0;\r\n      const playerCurrentVisitActive = playerVisitDarts > 0;\r\n      const playerCurrentVisitSum = playerVisitSum ?? 0;\r\n      const playerLastVisitTotal = playerLastVisitScore ?? null;\r\n      const playerLastDartValue = playerLastDart ?? 0;\r\n      const resolvedPlayerLastScore = playerCurrentVisitActive\r\n        ? playerCurrentVisitSum\r\n        : (playerLastVisitTotal ?? playerLastDartValue);\r\n\r\n      players.push({\r\n        name: \"You\",\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        legsWon: playerLegs || 0,\r\n        score: playerScore || 0,\r\n        lastScore: resolvedPlayerLastScore,\r\n        checkoutRate:\r\n          playerDoublesAtt && playerDoublesAtt > 0\r\n            ? Math.round(((playerDoublesHit || 0) / playerDoublesAtt) * 100)\r\n            : 0,\r\n        bestLeg:\r\n          legStats && legStats.length > 0\r\n            ? `${Math.min(...legStats.map((l) => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\r\n            : \"â€”\",\r\n        matchAvg: playerMatchAvg,\r\n        allTimeAvg: getAllTimeAvg(\"You\") || 0,\r\n      });\r\n\r\n      // AI card (if playing against AI)\r\n      if (ai && ai !== \"None\") {\r\n        const aiVisitDarts = aiVisitDartCount ?? 0;\r\n        const aiCurrentVisitActive = aiVisitDarts > 0;\r\n        const aiCurrentVisitSum = aiVisitSum ?? 0;\r\n        const aiLastVisitTotal = aiLastVisitScore ?? null;\r\n        const aiLastDartValue = aiLastDart ?? 0;\r\n        const resolvedAiLastScore = aiCurrentVisitActive\r\n          ? aiCurrentVisitSum\r\n          : (aiLastVisitTotal ?? aiLastDartValue);\r\n\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          legsWon: aiLegs || 0,\r\n          score: aiScore || 0,\r\n          lastScore: resolvedAiLastScore,\r\n          checkoutRate:\r\n            aiDoublesAtt && aiDoublesAtt > 0\r\n              ? Math.round(((aiDoublesHit || 0) / aiDoublesAtt) * 100)\r\n              : 0,\r\n          bestLeg: \"â€”\",\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === \"Cricket\") {\r\n      players.push({\r\n        name: \"You\",\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        closed: cricket?.marks || {},\r\n        points: cricket?.points || 0,\r\n      });\r\n\r\n      if (ai && ai !== \"None\") {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          closed: {},\r\n          points: 0,\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === \"Shanghai\") {\r\n      players.push({\r\n        name: \"You\",\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        round: shanghai?.round || 1,\r\n        target: shanghai?.target || 1,\r\n        score: shanghai?.score || 0,\r\n      });\r\n\r\n      if (ai && ai !== \"None\") {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          round: shanghai?.round || 1,\r\n          target: shanghai?.target || 1,\r\n          score: 0,\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === \"Killer\" && killerPlayers && killerPlayers.length > 0) {\r\n      killerPlayers.forEach((p, idx) => {\r\n        const state = killerStates?.[p.id];\r\n        players.push({\r\n          name: p.name,\r\n          isCurrentTurn: idx === killerTurnIdx,\r\n          number: killerAssigned?.[p.id],\r\n          lives: state?.lives || 0,\r\n          eliminated: state?.eliminated || false,\r\n        });\r\n      });\r\n    }\r\n\r\n    return players;\r\n  }, [\r\n    gameMode,\r\n    playerScore,\r\n    aiScore,\r\n    playerLegs,\r\n    aiLegs,\r\n    playerLastDart,\r\n    aiLastDart,\r\n    playerVisitSum,\r\n    aiVisitSum,\r\n    playerLastVisitScore,\r\n    aiLastVisitScore,\r\n    playerVisitDartCount,\r\n    aiVisitDartCount,\r\n    playerDoublesHit,\r\n    playerDoublesAtt,\r\n    aiDoublesHit,\r\n    aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn,\r\n    ai,\r\n    cricket,\r\n    shanghai,\r\n    killerPlayers,\r\n    killerStates,\r\n    killerAssigned,\r\n    killerTurnIdx,\r\n  ]);\r\n}\r\n\r\nexport function useOnlineGameStats(\r\n  gameMode: GameMode,\r\n  matchState?: any, // From useMatch() store\r\n  participants?: string[],\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (!matchState || !matchState.players || matchState.players.length === 0) {\r\n      return players;\r\n    }\r\n\r\n    matchState.players.forEach((player: any, idx: number) => {\r\n      const isCurrentTurn = idx === matchState.currentPlayerIdx;\r\n\r\n      if (gameMode === \"X01\") {\r\n        // Calculate match average for this player\r\n        let matchAvg = 0;\r\n        let totalDarts = 0;\r\n        let totalScored = 0;\r\n\r\n        if (player.legs && player.legs.length > 0) {\r\n          for (const leg of player.legs) {\r\n            if (leg.finished) {\r\n              const legDarts = leg.dartsThrown || 0;\r\n              const legScored =\r\n                Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining) || 0;\r\n              totalDarts += legDarts;\r\n              totalScored += legScored;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (totalDarts > 0) {\r\n          matchAvg = (totalScored / totalDarts) * 3;\r\n        }\r\n\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          legsWon: player.legsWon || 0,\r\n          score: player.score || 0,\r\n          lastScore: player.lastVisitScore || 0,\r\n          checkoutRate:\r\n            player.doublesAttempted > 0\r\n              ? Math.round((player.doublesHit / player.doublesAttempted) * 100)\r\n              : 0,\r\n          bestLeg: player.bestLegDarts ? `${player.bestLegDarts} darts` : \"â€”\",\r\n          matchAvg: matchAvg,\r\n          allTimeAvg: player.name ? getAllTimeAvg(player.name) : 0,\r\n        });\r\n      }\r\n\r\n      if (gameMode === \"Cricket\") {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          closed: player.cricket?.marks || {},\r\n          points: player.cricket?.points || 0,\r\n        });\r\n      }\r\n\r\n      if (gameMode === \"Killer\") {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          number: player.killerNumber || null,\r\n          lives: player.killerLives || 3,\r\n          eliminated: player.killerEliminated || false,\r\n        });\r\n      }\r\n    });\r\n\r\n    return players;\r\n  }, [gameMode, matchState, participants]);\r\n}\r\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { suggestCheckouts, sayScore } from \"../utils/checkout\";\r\nimport { useUserSettings } from \"../store/userSettings\";\r\nimport { useToast } from \"../store/toast\";\r\nimport { useCalibration } from \"../store/calibration\";\r\nimport GameCalibrationStatus from \"./GameCalibrationStatus\";\r\nimport CameraTile from \"./CameraTile\";\r\nimport CameraView from \"./CameraView\";\r\nimport { broadcastMessage } from \"../utils/broadcast\";\r\nimport HeatMap from \"./HeatMap\";\r\nimport { getUserCurrency, formatPriceInCurrency } from \"../utils/config\";\r\nimport { bumpGameMode } from \"../store/profileStats\";\r\nimport {\r\n  DOUBLE_PRACTICE_ORDER,\r\n  isDoubleHit,\r\n  parseManualDart,\r\n} from \"../game/types\";\r\nimport { ATC_ORDER } from \"../game/aroundTheClock\";\r\nimport {\r\n  createCricketState,\r\n  applyCricketDart,\r\n  CRICKET_NUMBERS,\r\n  hasClosedAll as cricketClosedAll,\r\n} from \"../game/cricket\";\r\nimport {\r\n  createShanghaiState,\r\n  applyShanghaiDart,\r\n  endShanghaiTurn,\r\n} from \"../game/shanghai\";\r\nimport {\r\n  createDefaultHalveIt,\r\n  getCurrentHalveTarget,\r\n  applyHalveItDart,\r\n  endHalveItTurn,\r\n} from \"../game/halveIt\";\r\nimport {\r\n  createHighLow,\r\n  applyHighLowDart,\r\n  endHighLowTurn,\r\n} from \"../game/highLow\";\r\nimport {\r\n  createKillerState,\r\n  assignKillerNumbers,\r\n  applyKillerDart,\r\n  killerWinner,\r\n  KillerState,\r\n} from \"../game/killer\";\r\nimport { createBaseball, applyBaseballDart } from \"../game/baseball\";\r\nimport { createGolf, applyGolfDart } from \"../game/golf\";\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from \"../game/ticTacToe\";\r\nimport {\r\n  createScamState,\r\n  addScamAuto,\r\n  addScamNumeric,\r\n  resetScam,\r\n  getScamTarget,\r\n  SCAM_TARGET_NAMES,\r\n  ScamState,\r\n  createFivesState,\r\n  addFivesAuto,\r\n  addFivesNumeric,\r\n  resetFives,\r\n  FivesState,\r\n  createSevensState,\r\n  addSevensAuto,\r\n  addSevensNumeric,\r\n  resetSevens,\r\n  SevensState,\r\n} from \"../game/scamFivesSevens\";\r\nimport {\r\n  createAmCricketState,\r\n  applyAmCricketDart,\r\n  AM_CRICKET_NUMBERS,\r\n  hasClosedAllAm,\r\n} from \"../game/americanCricket\";\r\nimport ResizableModal from \"./ui/ResizableModal\";\r\nimport MatchStartShowcase from \"./ui/MatchStartShowcase\";\r\nimport { useAudit } from \"../store/audit\";\r\nimport ResizablePanel from \"./ui/ResizablePanel\";\r\nimport GameHeaderBar from \"./ui/GameHeaderBar\";\r\nimport PauseQuitModal from \"./ui/PauseQuitModal\";\r\nimport { useMatchControl } from \"../store/matchControl\";\r\nimport GameScoreboard, { type PlayerStats } from \"./scoreboards/GameScoreboard\";\r\nimport MatchControls from \"./MatchControls\";\r\nimport { makeOfflineAddVisitAdapter } from \"./matchControlAdapters\";\r\nimport {\r\n  createOfflineMatchActions,\r\n  UnifiedMatchActions,\r\n} from \"../logic/matchActions\";\r\nimport { useMatch } from \"../store/match\";\r\nimport { useOfflineGameStats } from \"./scoreboards/useGameStats\";\r\nimport { freeGames, premiumGames, allGames } from \"../utils/games\";\r\n\r\nconst aiLevels = [\"Easy\", \"Medium\", \"Hardened\"];\r\n\r\nfunction clamp(n: number, min: number, max: number) {\r\n  return Math.max(min, Math.min(max, n));\r\n}\r\n\r\ntype PendingAutoVisit = {\r\n  visitTotal: number;\r\n  darts: number;\r\n  preRemaining: number;\r\n  remaining: number;\r\n  doubleAttempts: number;\r\n  finished: boolean;\r\n  doubleWindow: boolean;\r\n  highestCheckout?: number | null;\r\n  announced?: boolean;\r\n};\r\n\r\nconst BOARD_CLEAR_GRACE_MS = 6500;\r\n\r\nfunction aiVisitScore(remaining: number, level: string): number {\r\n  let target = 0;\r\n  if (level === \"Easy\") {\r\n    const candidates = [22, 26, 41, 45, 60];\r\n    target = candidates[Math.floor(Math.random() * candidates.length)];\r\n  } else if (level === \"Medium\") {\r\n    target = Math.round(clamp(60 + (Math.random() * 30 - 15), 30, 100));\r\n  } else {\r\n    target = Math.round(clamp(80 + (Math.random() * 20 - 10), 50, 120));\r\n  }\r\n  if (remaining <= 0) return 0;\r\n  if (target > remaining) {\r\n    const safe = [100, 85, 81, 60, 57, 45, 41, 26, 22, 20, 1].find(\r\n      (v) => v <= remaining,\r\n    );\r\n    return safe ?? 0;\r\n  }\r\n  return target;\r\n}\r\n\r\nfunction X01RulesPopup({ onClose }: { onClose: () => void }) {\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n      <div className=\"card max-w-lg w-full relative\">\r\n        <button\r\n          className=\"absolute top-2 right-2 btn px-2 py-1\"\r\n          onClick={onClose}\r\n        >\r\n          Close\r\n        </button>\r\n        <h3 className=\"text-xl font-bold mb-2\">X01 Rules & Regulations</h3>\r\n        <ul className=\"list-disc pl-5 text-left mb-2\">\r\n          <li>Double In: Start scoring only after hitting a double.</li>\r\n          <li>\r\n            Double Out: Finish the game by hitting a double to reach exactly\r\n            zero.\r\n          </li>\r\n          <li>\r\n            Best Of: Play a set number of legs, winner is first to reach\r\n            majority.\r\n          </li>\r\n          <li>First To: Play until a player reaches a set number of legs.</li>\r\n          <li>\r\n            No Cheating: All scores must be valid, no manual score changes\r\n            mid-leg.\r\n          </li>\r\n          <li>\r\n            Competitive Standard: Follow latest WDF/PDC rules for match play.\r\n          </li>\r\n        </ul>\r\n        <p className=\"text-sm text-slate-600\">\r\n          For full details, see official darts governing body rules.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst API_URL = (import.meta as any).env?.VITE_API_URL || \"\";\r\n\r\nexport default function OfflinePlay({ user }: { user: any }) {\r\n  const {\r\n    offlineLayout,\r\n    favoriteDouble,\r\n    callerEnabled,\r\n    callerVoice,\r\n    callerVolume,\r\n    speakCheckoutOnly,\r\n    rememberLastOffline,\r\n    setLastOffline,\r\n    autoStartOffline,\r\n    cameraScale,\r\n    setCameraScale,\r\n    cameraAspect = \"wide\",\r\n    setCameraAspect,\r\n    cameraFitMode = \"fill\",\r\n    setCameraFitMode,\r\n    cameraEnabled,\r\n    textSize,\r\n    boxSize,\r\n    autoscoreProvider,\r\n    autoCommitMode = \"wait-for-clear\",\r\n    matchType = \"singles\",\r\n    setMatchType,\r\n    teamAName = \"Team A\",\r\n    setTeamAName,\r\n    teamBName = \"Team B\",\r\n    setTeamBName,\r\n  } = useUserSettings();\r\n  const manualScoring = autoscoreProvider === \"manual\";\r\n  const cameraToolbarVisible = cameraEnabled && !manualScoring;\r\n  const waitForBoardClear =\r\n    cameraEnabled && !manualScoring && autoCommitMode !== \"immediate\";\r\n  const [selectedMode, setSelectedMode] = useState<string>(\"X01\");\r\n  const [x01Score, setX01Score] = useState(501);\r\n  const [ai, setAI] = useState(\"None\");\r\n  const [showRules, setShowRules] = useState(false);\r\n  const [inMatch, setInMatch] = useState(false);\r\n  const [playerScore, setPlayerScore] = useState(x01Score);\r\n  const [aiScore, setAiScore] = useState(x01Score);\r\n  const [onDouble, setOnDouble] = useState(false);\r\n  const [showWinPopup, setShowWinPopup] = useState(false);\r\n  // Match format: First-to selector and leg counters\r\n  const [firstTo, setFirstTo] = useState<number>(1);\r\n  const [playerLegs, setPlayerLegs] = useState<number>(0);\r\n  const match = useMatch();\r\n  const [showStartShowcase, setShowStartShowcase] = useState(false);\r\n  const startedShowcasedRef = useRef(false);\r\n  const [aiLegs, setAiLegs] = useState<number>(0);\r\n  // Placeholder for unified offline actions; once commitManualVisitTotal/endTurn defined, we'll assign\r\n\r\n  const [pendingLegWinner, setPendingLegWinner] = useState<\r\n    \"player\" | \"ai\" | null\r\n  >(null);\r\n  const [doubleDarts, setDoubleDarts] = useState(1);\r\n  const [checkoutDarts, setCheckoutDarts] = useState(1);\r\n  const [legStats, setLegStats] = useState<\r\n    {\r\n      winner: \"player\" | \"ai\";\r\n      doubleDarts: number;\r\n      checkoutDarts: number;\r\n      winnerDarts: number;\r\n      doublesAtt?: number;\r\n      doublesHit?: number;\r\n    }[]\r\n  >([]);\r\n  // New: pre-game adjustable AI delay (ms)\r\n  const [aiDelayMs, setAiDelayMs] = useState<number>(2000);\r\n  const toast = useToast();\r\n  // New: match popup state\r\n  const [showMatchModal, setShowMatchModal] = useState(false);\r\n  const [showQuitPause, setShowQuitPause] = useState(false);\r\n  const setPaused = useMatchControl((s) => s.setPaused);\r\n  useEffect(() => {\r\n    const onQuit = () => {\r\n      setShowMatchModal(false);\r\n      setInMatch(false);\r\n      setShowQuitPause(false);\r\n    };\r\n    try {\r\n      window.addEventListener(\"ndn:match-quit\" as any, onQuit as any);\r\n    } catch {}\r\n    return () => {\r\n      try {\r\n        window.removeEventListener(\"ndn:match-quit\" as any, onQuit as any);\r\n      } catch {}\r\n    };\r\n  }, []);\r\n  // Mirror Online layout defaults when in modern layout, otherwise keep classic feel\r\n  const [maximized, setMaximized] = useState(offlineLayout === \"modern\");\r\n  const [fitAll, setFitAll] = useState(offlineLayout === \"modern\");\r\n  // React to layout changes at runtime\r\n  useEffect(() => {\r\n    setMaximized(offlineLayout === \"modern\");\r\n    setFitAll(offlineLayout === \"modern\");\r\n  }, [offlineLayout]);\r\n  useEffect(() => {\r\n    if (cameraFitMode !== \"fit\") {\r\n      setCameraFitMode(\"fit\");\r\n    }\r\n  }, [cameraFitMode, setCameraFitMode]);\r\n  const [fitScale, setFitScale] = useState(1);\r\n  const [fitOverflowing, setFitOverflowing] = useState(false);\r\n  const [isPlayerTurn, setIsPlayerTurn] = useState(true);\r\n  useEffect(() => {\r\n    const handleOpenManager = () => setShowCameraManager(true);\r\n    window.addEventListener(\"ndn:open-camera-manager\", handleOpenManager);\r\n    return () =>\r\n      window.removeEventListener(\"ndn:open-camera-manager\", handleOpenManager);\r\n  }, []);\r\n  // Per-dart input and stats\r\n  const [playerDartPoints, setPlayerDartPoints] = useState<number>(0);\r\n  const [dpIndex, setDpIndex] = useState<number>(0); // 0..20 (DBULL at 20)\r\n  const [dpHits, setDpHits] = useState<number>(0);\r\n  // Around the Clock (offline practice)\r\n  const [atcIndex, setAtcIndex] = useState<number>(0);\r\n  const [atcHits, setAtcHits] = useState<number>(0);\r\n  // Practice mode states\r\n  const [cricket, setCricket] = useState(createCricketState());\r\n  const [shanghai, setShanghai] = useState(createShanghaiState());\r\n  const [halve, setHalve] = useState(createDefaultHalveIt());\r\n  const [highlow, setHighlow] = useState(createHighLow());\r\n  const [practiceTurnDarts, setPracticeTurnDarts] = useState<number>(0);\r\n  // Phase 1 practice modes\r\n  const [b27Stage, setB27Stage] = useState<number>(1);\r\n  const [b27Score, setB27Score] = useState<number>(27);\r\n  const [b27Darts, setB27Darts] = useState<number>(0);\r\n  const [b27Hits, setB27Hits] = useState<number>(0);\r\n  const [b27Finished, setB27Finished] = useState<boolean>(false);\r\n  const [cuRound, setCuRound] = useState<number>(1);\r\n  const [cuScore, setCuScore] = useState<number>(0);\r\n  const [cuDarts, setCuDarts] = useState<number>(0);\r\n  const cuMaxRounds = 8;\r\n  const [hsRound, setHsRound] = useState<number>(1);\r\n  const [hsScore, setHsScore] = useState<number>(0);\r\n  const [hsDarts, setHsDarts] = useState<number>(0);\r\n  const hsMaxRounds = 10;\r\n  const [lsRound, setLsRound] = useState<number>(1);\r\n  const [lsScore, setLsScore] = useState<number>(0);\r\n  const [lsDarts, setLsDarts] = useState<number>(0);\r\n  const lsMaxRounds = 10;\r\n  const [co170Rem, setCo170Rem] = useState<number>(170);\r\n  const [co170Darts, setCo170Darts] = useState<number>(0);\r\n  const [co170Attempts, setCo170Attempts] = useState<number>(0);\r\n  const [co170Successes, setCo170Successes] = useState<number>(0);\r\n  const [co121Rem, setCo121Rem] = useState<number>(121);\r\n  const [co121Darts, setCo121Darts] = useState<number>(0);\r\n  const [co121Attempts, setCo121Attempts] = useState<number>(0);\r\n  const [co121Successes, setCo121Successes] = useState<number>(0);\r\n  const [trebleTarget, setTrebleTarget] = useState<number>(20);\r\n  const [trebleHits, setTrebleHits] = useState<number>(0);\r\n  const [trebleDarts, setTrebleDarts] = useState<number>(0);\r\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30);\r\n  const [trebleFinished, setTrebleFinished] = useState<boolean>(false);\r\n  // Phase 2 states\r\n  const [baseball, setBaseball] = useState(createBaseball());\r\n  const [golf, setGolf] = useState(createGolf());\r\n  const [ttt, setTTT] = useState(createTicTacToe());\r\n  const [amCricket, setAmCricket] = useState(createAmCricketState());\r\n  // Killer (hotseat) state\r\n  const [killerPlayers, setKillerPlayers] = useState<\r\n    Array<{ id: string; name: string }>\r\n  >([\r\n    { id: \"p1\", name: \"Player 1\" },\r\n    { id: \"p2\", name: \"Player 2\" },\r\n  ]);\r\n  const [killerStates, setKillerStates] = useState<Record<string, KillerState>>(\r\n    {},\r\n  );\r\n  const [killerAssigned, setKillerAssigned] = useState<Record<string, number>>(\r\n    {},\r\n  );\r\n  const [killerSetupDone, setKillerSetupDone] = useState<boolean>(false);\r\n  const [killerTurnIdx, setKillerTurnIdx] = useState<number>(0);\r\n  const [killerDarts, setKillerDarts] = useState<number>(0);\r\n  const [killerWinnerId, setKillerWinnerId] = useState<string | null>(null);\r\n  const [killerLastEvent, setKillerLastEvent] = useState<string>(\"\");\r\n  // Scam/Scum state\r\n  const [scam, setScam] = useState(createScamState());\r\n  const [scamPlayer, setScamPlayer] = useState(createScamState());\r\n  // Fives state\r\n  const [fives, setFives] = useState(createFivesState(50));\r\n  const [fivesPlayer, setFivesPlayer] = useState(createFivesState(50));\r\n  // Sevens state\r\n  const [sevens, setSevens] = useState(createSevensState(70));\r\n  const [sevensPlayer, setSevensPlayer] = useState(createSevensState(70));\r\n  const [playerDartsThrown, setPlayerDartsThrown] = useState<number>(0);\r\n  const [playerLastDart, setPlayerLastDart] = useState<number>(0);\r\n  const [playerVisitDarts, setPlayerVisitDarts] = useState<number>(0);\r\n  const [playerVisitStart, setPlayerVisitStart] = useState<number>(x01Score);\r\n  const [playerVisitSum, setPlayerVisitSum] = useState<number>(0);\r\n  const [playerLastVisitScore, setPlayerLastVisitScore] = useState<\r\n    number | null\r\n  >(null);\r\n  const [playerVisitDartsAtDouble, setPlayerVisitDartsAtDouble] =\r\n    useState<number>(0);\r\n  const lastBounceMissTsRef = useRef<number>(0);\r\n  const lastVisitDartsRef = useRef<number>(0);\r\n  const playerScoreRef = useRef<number>(playerScore);\r\n  const playerVisitDartsRef = useRef<number>(playerVisitDarts);\r\n  const playerVisitSumRef = useRef<number>(playerVisitSum);\r\n  const playerVisitStartRef = useRef<number>(playerVisitStart);\r\n  const playerVisitDartsAtDoubleRef = useRef<number>(playerVisitDartsAtDouble);\r\n\r\n  useEffect(() => {\r\n    playerScoreRef.current = playerScore;\r\n  }, [playerScore]);\r\n  useEffect(() => {\r\n    playerVisitDartsRef.current = playerVisitDarts;\r\n  }, [playerVisitDarts]);\r\n  useEffect(() => {\r\n    playerVisitSumRef.current = playerVisitSum;\r\n  }, [playerVisitSum]);\r\n  useEffect(() => {\r\n    playerVisitStartRef.current = playerVisitStart;\r\n  }, [playerVisitStart]);\r\n  useEffect(() => {\r\n    playerVisitDartsAtDoubleRef.current = playerVisitDartsAtDouble;\r\n  }, [playerVisitDartsAtDouble]);\r\n  const [aiCountdownMs, setAiCountdownMs] = useState<number>(0);\r\n  const aiTimerRef = useRef<number | null>(null);\r\n  const [aiDartsThrown, setAiDartsThrown] = useState<number>(0);\r\n  const [aiLastDart, setAiLastDart] = useState<number>(0);\r\n  const [aiVisitSum, setAiVisitSum] = useState<number>(0);\r\n  const [aiVisitDarts, setAiVisitDarts] = useState<number>(0);\r\n  const [aiLastVisitScore, setAiLastVisitScore] = useState<number | null>(null);\r\n  const [aiVisitDartsAtDouble, setAiVisitDartsAtDouble] = useState<number>(0);\r\n  // Doubles attempts/hits\r\n  const [playerDoublesAtt, setPlayerDoublesAtt] = useState<number>(0);\r\n  const [playerDoublesHit, setPlayerDoublesHit] = useState<number>(0);\r\n  const [aiDoublesAtt, setAiDoublesAtt] = useState<number>(0);\r\n  const [aiDoublesHit, setAiDoublesHit] = useState<number>(0);\r\n  // Match-long totals for averages\r\n  const [totalPlayerDarts, setTotalPlayerDarts] = useState<number>(0);\r\n  const [totalAiDarts, setTotalAiDarts] = useState<number>(0);\r\n  const [totalPlayerPoints, setTotalPlayerPoints] = useState<number>(0);\r\n  const [totalAiPoints, setTotalAiPoints] = useState<number>(0);\r\n  // Power scoring and checkout highs\r\n  const [player180s, setPlayer180s] = useState<number>(0);\r\n  const [player140s, setPlayer140s] = useState<number>(0);\r\n  const [player100s, setPlayer100s] = useState<number>(0);\r\n  const [ai180s, setAi180s] = useState<number>(0);\r\n  const [ai140s, setAi140s] = useState<number>(0);\r\n  const [ai100s, setAi100s] = useState<number>(0);\r\n  const [playerHighestCheckout, setPlayerHighestCheckout] = useState<number>(0);\r\n  const [aiHighestCheckout, setAiHighestCheckout] = useState<number>(0);\r\n  // End-of-match summary modal\r\n  const [showMatchSummary, setShowMatchSummary] = useState<boolean>(false);\r\n  // Manual correction input for offline (matches CameraView UX)\r\n  const [manualBox, setManualBox] = useState<string>(\"\");\r\n  const [manualTextarea, setManualTextarea] = useState<string>(\"\");\r\n  const [manualPlayerScoreInput, setManualPlayerScoreInput] =\r\n    useState<string>(\"\");\r\n  const [manualOpponentScoreInput, setManualOpponentScoreInput] =\r\n    useState<string>(\"\");\r\n  const [manualPlayerLegsInput, setManualPlayerLegsInput] =\r\n    useState<string>(\"\");\r\n  const [manualOpponentLegsInput, setManualOpponentLegsInput] =\r\n    useState<string>(\"\");\r\n  const [legOverrideConfirm, setLegOverrideConfirm] = useState<{\r\n    target: \"player\" | \"ai\";\r\n    value: number;\r\n    stage: 1 | 2;\r\n  } | null>(null);\r\n  const [showCameraManager, setShowCameraManager] = useState<boolean>(false);\r\n  const [dartCounts, setDartCounts] = useState<Record<string, number>>({});\r\n  const [awaitingBoardClear, setAwaitingBoardClear] = useState<boolean>(false);\r\n  const pendingVisitRef = useRef<PendingAutoVisit | null>(null);\r\n  const pendingVisitTimerRef = useRef<ReturnType<typeof setTimeout> | null>(\r\n    null,\r\n  );\r\n\r\n  const clearPendingVisitTimer = useCallback(() => {\r\n    const timer = pendingVisitTimerRef.current;\r\n    if (timer) {\r\n      clearTimeout(timer);\r\n      pendingVisitTimerRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const speakAutoVisit = useCallback(\r\n    (pending: PendingAutoVisit) => {\r\n      if (!callerEnabled) return;\r\n      const speaker = user?.username || \"Player\";\r\n      try {\r\n        sayScore(\r\n          speaker,\r\n          pending.visitTotal,\r\n          Math.max(pending.remaining, 0),\r\n          callerVoice,\r\n          { volume: callerVolume, checkoutOnly: speakCheckoutOnly },\r\n        );\r\n      } catch {}\r\n    },\r\n    [\r\n      callerEnabled,\r\n      callerVoice,\r\n      callerVolume,\r\n      speakCheckoutOnly,\r\n      user?.username,\r\n    ],\r\n  );\r\n\r\n  const commitPendingVisit = useCallback(\r\n    (\r\n      pending: PendingAutoVisit,\r\n      _trigger: \"immediate\" | \"event\" | \"timeout\",\r\n    ) => {\r\n      setAwaitingBoardClear(false);\r\n      const {\r\n        visitTotal,\r\n        darts,\r\n        preRemaining,\r\n        remaining,\r\n        doubleAttempts,\r\n        finished,\r\n        doubleWindow,\r\n        highestCheckout,\r\n      } = pending;\r\n\r\n      if (!finished) {\r\n        setPlayerScore(remaining);\r\n        playerScoreRef.current = remaining;\r\n      } else {\r\n        setPlayerScore(0);\r\n        playerScoreRef.current = 0;\r\n        if (typeof highestCheckout === \"number\" && highestCheckout > 0) {\r\n          setPlayerHighestCheckout((h) => Math.max(h, highestCheckout));\r\n        }\r\n      }\r\n\r\n      setPlayerLastVisitScore(visitTotal);\r\n\r\n      if (visitTotal === 180) setPlayer180s((n) => n + 1);\r\n      else if (visitTotal >= 140) setPlayer140s((n) => n + 1);\r\n      else if (visitTotal >= 100) setPlayer100s((n) => n + 1);\r\n\r\n      if (doubleWindow && doubleAttempts > 0) {\r\n        setPlayerDoublesAtt((a) => a + doubleAttempts);\r\n        if (finished) setPlayerDoublesHit((h) => h + 1);\r\n      }\r\n\r\n      if (!pending.announced) speakAutoVisit(pending);\r\n\r\n      try {\r\n        useAudit.getState().recordVisit(\"offline-x01\", darts, visitTotal, {\r\n          preRemaining,\r\n          postRemaining: finished ? 0 : remaining,\r\n          finish: finished,\r\n          bust: false,\r\n        });\r\n      } catch {}\r\n\r\n      if (finished) {\r\n        setPendingLegWinner(\"player\");\r\n        setShowWinPopup(true);\r\n      }\r\n\r\n      endTurn(finished ? 0 : remaining);\r\n\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n    },\r\n    [\r\n      endTurn,\r\n      setPlayerHighestCheckout,\r\n      setPendingLegWinner,\r\n      setPlayerScore,\r\n      setPlayerLastVisitScore,\r\n      setPlayerVisitSum,\r\n      setPlayerVisitDarts,\r\n      setPlayerVisitDartsAtDouble,\r\n      setShowWinPopup,\r\n      setPlayer180s,\r\n      setPlayer140s,\r\n      setPlayer100s,\r\n      setPlayerDoublesAtt,\r\n      setPlayerDoublesHit,\r\n      speakAutoVisit,\r\n    ],\r\n  );\r\n\r\n  const finalizePendingVisit = useCallback(\r\n    (trigger: \"event\" | \"timeout\") => {\r\n      const pending = pendingVisitRef.current;\r\n      if (!pending) return;\r\n      pendingVisitRef.current = null;\r\n      clearPendingVisitTimer();\r\n      commitPendingVisit(pending, trigger);\r\n    },\r\n    [clearPendingVisitTimer, commitPendingVisit],\r\n  );\r\n\r\n  const queuePendingVisit = useCallback(\r\n    (pending: PendingAutoVisit) => {\r\n      speakAutoVisit(pending);\r\n      pendingVisitRef.current = { ...pending, announced: true };\r\n      setAwaitingBoardClear(true);\r\n      clearPendingVisitTimer();\r\n      pendingVisitTimerRef.current = setTimeout(\r\n        () => finalizePendingVisit(\"timeout\"),\r\n        BOARD_CLEAR_GRACE_MS,\r\n      );\r\n    },\r\n    [clearPendingVisitTimer, finalizePendingVisit, speakAutoVisit],\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!waitForBoardClear) return;\r\n    const handler = () => finalizePendingVisit(\"event\");\r\n    window.addEventListener(\"ndn:darts-cleared\", handler as EventListener);\r\n    return () =>\r\n      window.removeEventListener(\"ndn:darts-cleared\", handler as EventListener);\r\n  }, [waitForBoardClear, finalizePendingVisit]);\r\n\r\n  useEffect(() => {\r\n    if (!waitForBoardClear) finalizePendingVisit(\"timeout\");\r\n  }, [waitForBoardClear, finalizePendingVisit]);\r\n\r\n  useEffect(() => () => clearPendingVisitTimer(), [clearPendingVisitTimer]);\r\n\r\n  useEffect(() => {\r\n    if (playerVisitDarts === 0) {\r\n      try {\r\n        window.dispatchEvent(\r\n          new CustomEvent(\"ndn:darts-cleared\", {\r\n            detail: { source: \"offline-play\", ts: Date.now() },\r\n          }),\r\n        );\r\n      } catch {}\r\n      lastBounceMissTsRef.current = 0;\r\n    }\r\n    lastVisitDartsRef.current = playerVisitDarts;\r\n  }, [playerVisitDarts]);\r\n\r\n  const humanName = user?.username || \"Player 1\";\r\n  const aiDisplayName = ai === \"None\" ? \"Player 2\" : ai;\r\n\r\n  // Call all game stat hooks unconditionally at component level (React hooks rules)\r\n  const statsX01 = useOfflineGameStats(\r\n    \"X01\" as any,\r\n    playerScore,\r\n    aiScore,\r\n    playerLegs,\r\n    aiLegs,\r\n    playerLastDart,\r\n    aiLastDart,\r\n    playerVisitSum,\r\n    aiVisitSum,\r\n    playerLastVisitScore,\r\n    aiLastVisitScore,\r\n    playerVisitDarts,\r\n    aiVisitDarts,\r\n    playerDoublesHit,\r\n    playerDoublesAtt,\r\n    aiDoublesHit,\r\n    aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn,\r\n    ai,\r\n    x01Score,\r\n  );\r\n  const statsCricket = useOfflineGameStats(\r\n    \"Cricket\" as any,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    cricket,\r\n  );\r\n  const statsShanghai = useOfflineGameStats(\r\n    \"Shanghai\" as any,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    isPlayerTurn,\r\n    ai,\r\n    undefined,\r\n    cricket,\r\n    shanghai,\r\n  );\r\n  const statsKiller = useOfflineGameStats(\r\n    \"Killer\" as any,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    undefined,\r\n    killerPlayers,\r\n    killerStates,\r\n    killerAssigned,\r\n    killerTurnIdx,\r\n  );\r\n  const statsScam = useOfflineGameStats(\"Scam\" as any);\r\n  const statsFives = useOfflineGameStats(\"Fives\" as any);\r\n  const statsSevens = useOfflineGameStats(\"Sevens\" as any);\r\n\r\n  const activeScoreboardStats = useMemo(() => {\r\n    const list = statsX01 || [];\r\n    const playerResolvedLastScore =\r\n      playerVisitDarts > 0\r\n        ? playerVisitSum\r\n        : (playerLastVisitScore ?? playerLastDart);\r\n    const aiResolvedLastScore =\r\n      aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart);\r\n    if (list.length === 0) {\r\n      return {\r\n        name: isPlayerTurn ? humanName : aiDisplayName,\r\n        isCurrentTurn: true,\r\n        legsWon: isPlayerTurn ? playerLegs : aiLegs,\r\n        score: isPlayerTurn ? playerScore : aiScore,\r\n        lastScore: isPlayerTurn ? playerResolvedLastScore : aiResolvedLastScore,\r\n      } as PlayerStats;\r\n    }\r\n    return list.find((player) => player.isCurrentTurn) ?? list[0];\r\n  }, [\r\n    statsX01,\r\n    isPlayerTurn,\r\n    humanName,\r\n    aiDisplayName,\r\n    playerLegs,\r\n    aiLegs,\r\n    playerScore,\r\n    aiScore,\r\n    playerVisitDarts,\r\n    playerVisitSum,\r\n    playerLastVisitScore,\r\n    playerLastDart,\r\n    aiVisitSum,\r\n    aiLastVisitScore,\r\n    aiLastDart,\r\n    aiVisitDarts,\r\n  ]);\r\n\r\n  const singlePlayerScoreboard: PlayerStats[] = useMemo(() => {\r\n    if (!activeScoreboardStats) return [];\r\n    const { matchAvg, allTimeAvg, ...rest } = activeScoreboardStats;\r\n    return [\r\n      { ...rest, matchAvg: undefined, allTimeAvg: undefined } as PlayerStats,\r\n    ];\r\n  }, [activeScoreboardStats]);\r\n\r\n  const inactivePlayerName = isPlayerTurn ? aiDisplayName : humanName;\r\n  const activePlayerName =\r\n    activeScoreboardStats?.name ?? (isPlayerTurn ? humanName : aiDisplayName);\r\n  const activeRemaining = isPlayerTurn ? playerScore : aiScore;\r\n  const activeLastScore = isPlayerTurn\r\n    ? playerVisitDarts > 0\r\n      ? playerVisitSum\r\n      : (playerLastVisitScore ?? playerLastDart)\r\n    : aiVisitDarts > 0\r\n      ? aiVisitSum\r\n      : (aiLastVisitScore ?? aiLastDart);\r\n\r\n  const recordDart = useCallback((mode: string, count = 1) => {\r\n    if (!mode || count <= 0) return;\r\n    setDartCounts((prev) => ({\r\n      ...prev,\r\n      [mode]: (prev[mode] || 0) + count,\r\n    }));\r\n  }, []);\r\n\r\n  const resetDartCount = useCallback((mode: string) => {\r\n    if (!mode) return;\r\n    setDartCounts((prev) => {\r\n      if (prev[mode] === undefined) return prev;\r\n      return { ...prev, [mode]: 0 };\r\n    });\r\n  }, []);\r\n\r\n  const activeModeDarts = dartCounts[selectedMode] || 0;\r\n\r\n  const parseManualScoreOverride = (value: string): number | null => {\r\n    if (!value.trim()) return null;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) return null;\r\n    return clamp(Math.round(parsed), 0, x01Score);\r\n  };\r\n\r\n  const parseManualLegsOverride = (value: string): number | null => {\r\n    if (!value.trim()) return null;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) return null;\r\n    return Math.max(0, Math.round(parsed));\r\n  };\r\n\r\n  const cancelPendingAutoVisit = useCallback(() => {\r\n    if (pendingVisitRef.current) {\r\n      pendingVisitRef.current = null;\r\n    }\r\n    clearPendingVisitTimer();\r\n    setAwaitingBoardClear(false);\r\n  }, [clearPendingVisitTimer]);\r\n\r\n  const applyPlayerScoreOverride = useCallback(\r\n    (nextScore: number) => {\r\n      const safeScore = clamp(nextScore, 0, x01Score);\r\n      cancelPendingAutoVisit();\r\n      setPlayerScore(safeScore);\r\n      playerScoreRef.current = safeScore;\r\n\r\n      const nextVisitStart = safeScore === 0 ? x01Score : safeScore;\r\n      setPlayerVisitStart(nextVisitStart);\r\n      playerVisitStartRef.current = nextVisitStart;\r\n\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n\r\n      setPlayerLastVisitScore(null);\r\n      setPlayerLastDart(0);\r\n      setPlayerDartPoints(0);\r\n      lastBounceMissTsRef.current = 0;\r\n\r\n      if (safeScore === 0) {\r\n        setPendingLegWinner(\"player\");\r\n        setShowWinPopup(true);\r\n      } else {\r\n        setPendingLegWinner(null);\r\n        setShowWinPopup(false);\r\n      }\r\n    },\r\n    [\r\n      cancelPendingAutoVisit,\r\n      setPlayerScore,\r\n      x01Score,\r\n      setPlayerVisitStart,\r\n      setPlayerVisitSum,\r\n      setPlayerVisitDarts,\r\n      setPlayerVisitDartsAtDouble,\r\n      setPlayerLastVisitScore,\r\n      setPlayerLastDart,\r\n      setPlayerDartPoints,\r\n      setPendingLegWinner,\r\n      setShowWinPopup,\r\n    ],\r\n  );\r\n\r\n  const handleManualScoreOverride = (target: \"player\" | \"ai\") => {\r\n    const source =\r\n      target === \"player\" ? manualPlayerScoreInput : manualOpponentScoreInput;\r\n    const parsed = parseManualScoreOverride(source);\r\n    if (parsed === null) {\r\n      toast(`Enter a number between 0 and ${x01Score}`, {\r\n        type: \"error\",\r\n        timeout: 2500,\r\n      });\r\n      return;\r\n    }\r\n    if (target === \"player\") {\r\n      applyPlayerScoreOverride(parsed);\r\n      setManualPlayerScoreInput(\"\");\r\n      return;\r\n    } else {\r\n      setAiScore(parsed);\r\n      setAiVisitSum(0);\r\n      setAiVisitDarts(0);\r\n      setAiLastVisitScore(null);\r\n      setAiVisitDartsAtDouble(0);\r\n      setAiLastDart(0);\r\n      setManualOpponentScoreInput(\"\");\r\n    }\r\n    setPendingLegWinner(null);\r\n    setShowWinPopup(false);\r\n  };\r\n\r\n  const applyManualLegOverride = useCallback(\r\n    (target: \"player\" | \"ai\", value: number) => {\r\n      if (target === \"player\") {\r\n        setPlayerLegs(value);\r\n        setManualPlayerLegsInput(\"\");\r\n      } else {\r\n        setAiLegs(value);\r\n        setManualOpponentLegsInput(\"\");\r\n      }\r\n      setPendingLegWinner(null);\r\n      setShowWinPopup(false);\r\n    },\r\n    [\r\n      setAiLegs,\r\n      setManualOpponentLegsInput,\r\n      setManualPlayerLegsInput,\r\n      setPendingLegWinner,\r\n      setPlayerLegs,\r\n      setShowWinPopup,\r\n    ],\r\n  );\r\n\r\n  const handleManualLegsOverride = (target: \"player\" | \"ai\") => {\r\n    const source =\r\n      target === \"player\" ? manualPlayerLegsInput : manualOpponentLegsInput;\r\n    const parsed = parseManualLegsOverride(source);\r\n    if (parsed === null) {\r\n      toast(\"Enter a non-negative whole number for legs\", {\r\n        type: \"error\",\r\n        timeout: 2500,\r\n      });\r\n      return;\r\n    }\r\n    setLegOverrideConfirm({ target, value: parsed, stage: 1 });\r\n  };\r\n\r\n  const handleLegOverrideYes = useCallback(() => {\r\n    setLegOverrideConfirm((prev) => {\r\n      if (!prev) return prev;\r\n      if (prev.stage === 1) return { ...prev, stage: 2 };\r\n      applyManualLegOverride(prev.target, prev.value);\r\n      return null;\r\n    });\r\n  }, [applyManualLegOverride]);\r\n\r\n  const handleLegOverrideNo = useCallback(() => {\r\n    setLegOverrideConfirm(null);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!legOverrideConfirm) return;\r\n    const handleKey = (event: KeyboardEvent) => {\r\n      if (event.key === \"Escape\") {\r\n        event.preventDefault();\r\n        handleLegOverrideNo();\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", handleKey);\r\n    return () => window.removeEventListener(\"keydown\", handleKey);\r\n  }, [handleLegOverrideNo, legOverrideConfirm]);\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case \"small\":\r\n        return \"px-1.5 py-0.5 text-xs\";\r\n      case \"large\":\r\n        return \"px-3 py-1 text-sm\";\r\n      default:\r\n        return \"px-2 py-0.5 text-sm\";\r\n    }\r\n  };\r\n  const buttonSizeClass = getButtonSizeClasses(textSize);\r\n  // Fit-all scaling measurement\r\n  const scrollerRef = useRef<HTMLDivElement | null>(null);\r\n  const contentRef = useRef<HTMLDivElement | null>(null);\r\n  const headerBarRef = useRef<HTMLDivElement | null>(null);\r\n  // Match format controls (offline only): First to N or Best of N with editable count\r\n  const [formatType, setFormatType] = useState<\"first\" | \"best\">(\"first\");\r\n  const [formatCount, setFormatCount] = useState<number>(1);\r\n  const formatRef = useRef<HTMLDivElement | null>(null);\r\n  // Keep internal required wins (firstTo) in sync with format selection\r\n  useEffect(() => {\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1));\r\n    const wins = formatType === \"first\" ? n : Math.max(1, Math.ceil(n / 2));\r\n    setFirstTo(wins);\r\n  }, [formatType, formatCount]);\r\n  useEffect(() => {\r\n    if (!fitAll) {\r\n      setFitScale(1);\r\n      setFitOverflowing(false);\r\n      return;\r\n    }\r\n    const measure = () => {\r\n      const scroller = scrollerRef.current;\r\n      const content = contentRef.current;\r\n      if (!scroller || !content) return;\r\n      // Available size excludes the sticky header inside the scroller\r\n      const headerH = headerBarRef.current\r\n        ? headerBarRef.current.getBoundingClientRect().height\r\n        : 0;\r\n      const availH = Math.max(0, scroller.clientHeight - headerH - 6); // small breathing room\r\n      const availW = Math.max(0, scroller.clientWidth - 8);\r\n      // Measure the content size without scale\r\n      const rect = content.getBoundingClientRect();\r\n      const currentScale = fitScale || 1;\r\n      const naturalHeight = rect.height / currentScale;\r\n      const naturalWidth = rect.width / currentScale;\r\n      // Compute scale to fit both height and width\r\n      const scaleH = availH > 0 ? availH / naturalHeight : 1;\r\n      const scaleW = availW > 0 ? availW / naturalWidth : 1;\r\n      const next = Math.min(1, Math.max(0.5, Math.min(scaleH, scaleW)));\r\n      const scaledHeight = naturalHeight * next;\r\n      const overflowing = availH > 0 && scaledHeight - availH > 1;\r\n      setFitOverflowing(overflowing);\r\n      setFitScale(next);\r\n    };\r\n    measure();\r\n    const RO: any = (window as any).ResizeObserver;\r\n    const ro = RO ? new RO(() => measure()) : null;\r\n    ro && scrollerRef.current && ro.observe(scrollerRef.current as any);\r\n    ro && contentRef.current && ro.observe(contentRef.current as any);\r\n    window.addEventListener(\"resize\", measure);\r\n    return () => {\r\n      window.removeEventListener(\"resize\", measure);\r\n      try {\r\n        ro && scrollerRef.current && ro.unobserve(scrollerRef.current as any);\r\n      } catch {}\r\n      try {\r\n        ro && contentRef.current && ro.unobserve(contentRef.current as any);\r\n      } catch {}\r\n    };\r\n  }, [fitAll, fitScale]);\r\n\r\n  // Auto-start handler (from Home or other tabs)\r\n  useEffect(() => {\r\n    const onAuto = (e: any) => {\r\n      const m = e?.detail?.mode as string | undefined;\r\n      if (!m) return;\r\n      setSelectedMode(m);\r\n      // For Double Practice we could load a specific flow. For now, we just open the X01-like modal with immediate start.\r\n      startMatch();\r\n    };\r\n    window.addEventListener(\"ndn:auto-start\", onAuto as any);\r\n    return () => window.removeEventListener(\"ndn:auto-start\", onAuto as any);\r\n  }, []);\r\n\r\n  // Accept demo parameters to preconfigure format and starting score before auto-start\r\n  useEffect(() => {\r\n    const onFmt = (e: any) => {\r\n      const t = e?.detail?.formatType;\r\n      const c = e?.detail?.formatCount;\r\n      const s = e?.detail?.startScore;\r\n      if (t === \"first\" || t === \"best\") setFormatType(t);\r\n      if (typeof c === \"number\" && isFinite(c))\r\n        setFormatCount(Math.max(1, Math.floor(c)));\r\n      if (typeof s === \"number\" && isFinite(s))\r\n        setX01Score(Math.max(1, Math.floor(s)));\r\n    };\r\n    window.addEventListener(\"ndn:offline-format\", onFmt as any);\r\n    return () => window.removeEventListener(\"ndn:offline-format\", onFmt as any);\r\n  }, []);\r\n\r\n  // Auto-start last offline match when opening this tab, if enabled\r\n  useEffect(() => {\r\n    if (!autoStartOffline) return;\r\n    // Kick off a match after initial render for a smooth modal open\r\n    const id = setTimeout(() => startMatch(), 50);\r\n    return () => clearTimeout(id);\r\n  }, [autoStartOffline]);\r\n\r\n  // Drive AI countdown and perform AI visit when countdown elapses\r\n  useEffect(() => {\r\n    if (!showMatchModal || isPlayerTurn || ai === \"None\" || aiCountdownMs <= 0)\r\n      return;\r\n    let raf: number;\r\n    let last = performance.now();\r\n    const tick = (now: number) => {\r\n      const dt = now - last;\r\n      last = now;\r\n      setAiCountdownMs((prev) => {\r\n        const next = prev - dt;\r\n        if (next <= 0) {\r\n          // Execute AI visit per dart (up to 3 darts or until finish/bust)\r\n          let visitDarts = 0;\r\n          let visitTotal = 0;\r\n          let remaining = aiScore;\r\n          setAiVisitDarts(0);\r\n          while (visitDarts < 3 && remaining > 0) {\r\n            const targetVisit = aiVisitScore(remaining, ai);\r\n            // break target into up to 3 darts (roughly 20 per dart for easy split)\r\n            const dart = clamp(\r\n              targetVisit - visitDarts * 20,\r\n              0,\r\n              Math.min(60, remaining),\r\n            );\r\n            const after = remaining - dart;\r\n            setAiLastDart(dart);\r\n            setAiDartsThrown((d) => d + 1);\r\n            setTotalAiDarts((d) => d + 1);\r\n            if (after < 0) {\r\n              // bust: revert to remaining before visit\r\n              remaining = aiScore;\r\n              setAiVisitSum(0);\r\n              setAiVisitDartsAtDouble(0);\r\n              visitTotal = 0;\r\n              setAiLastVisitScore(0);\r\n              setAiVisitDarts(0);\r\n              break;\r\n            }\r\n            // Only add points after confirming not a bust\r\n            visitTotal += dart;\r\n            setAiVisitSum((s) => s + dart);\r\n            setTotalAiPoints((p) => p + dart);\r\n            // Track darts at double window\r\n            const preRem = remaining;\r\n            const postRem = after;\r\n            if (preRem > 50 && postRem <= 50) setAiVisitDartsAtDouble(1);\r\n            else if (preRem <= 50) setAiVisitDartsAtDouble((c) => c + 1);\r\n            remaining = after;\r\n            visitDarts += 1;\r\n            setAiVisitDarts(visitDarts);\r\n            if (remaining === 0) break;\r\n          }\r\n          setAiScore(remaining);\r\n          if (remaining === 0) {\r\n            // Power score classification\r\n            if (visitTotal === 180) setAi180s((n) => n + 1);\r\n            else if (visitTotal >= 140) setAi140s((n) => n + 1);\r\n            else if (visitTotal >= 100) setAi100s((n) => n + 1);\r\n            // Highest checkout\r\n            const checkout = aiScore;\r\n            if (checkout <= 170)\r\n              setAiHighestCheckout((h) => Math.max(h, checkout));\r\n            // Doubles attempts/hit if finished from <= 50\r\n            if (aiScore <= 50) {\r\n              setAiDoublesAtt(\r\n                (a) =>\r\n                  a + (aiVisitDartsAtDouble > 0 ? aiVisitDartsAtDouble : 1),\r\n              );\r\n              setAiDoublesHit((h) => h + 1);\r\n            }\r\n            setAiLastVisitScore(visitTotal);\r\n            setAiVisitSum(0);\r\n            setAiVisitDartsAtDouble(0);\r\n            setAiVisitDarts(0);\r\n            // AI won the leg\r\n            setPendingLegWinner(\"ai\");\r\n            setShowWinPopup(true);\r\n          }\r\n          // If AI did not finish, but threw 3 darts this visit, classify power score and reset visit sum\r\n          if (remaining > 0 && visitDarts >= 3) {\r\n            if (visitTotal === 180) setAi180s((n) => n + 1);\r\n            else if (visitTotal >= 140) setAi140s((n) => n + 1);\r\n            else if (visitTotal >= 100) setAi100s((n) => n + 1);\r\n            setAiLastVisitScore(visitTotal);\r\n            setAiVisitSum(0);\r\n            setAiVisitDartsAtDouble(0);\r\n            setAiVisitDarts(0);\r\n          }\r\n          // Hand turn back to player\r\n          setAiVisitDarts(0);\r\n          setIsPlayerTurn(true);\r\n          return 0;\r\n        }\r\n        return next;\r\n      });\r\n      raf = requestAnimationFrame(tick);\r\n    };\r\n    raf = requestAnimationFrame(tick);\r\n    return () => cancelAnimationFrame(raf);\r\n  }, [showMatchModal, isPlayerTurn, ai, aiScore]);\r\n\r\n  useEffect(() => {\r\n    if (!match.inProgress) return;\r\n    if (startedShowcasedRef.current) return;\r\n    setShowStartShowcase(true);\r\n    startedShowcasedRef.current = true;\r\n  }, [match.inProgress]);\r\n\r\n  function startMatch() {\r\n    setInMatch(true);\r\n    setPlayerScore(x01Score);\r\n    playerScoreRef.current = x01Score;\r\n    setAiScore(x01Score);\r\n    setOnDouble(false);\r\n    setShowMatchModal(true);\r\n    setIsPlayerTurn(true);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown(0);\r\n    setPlayerLastDart(0);\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitStart(x01Score);\r\n    setPlayerVisitSum(0);\r\n    setPlayerLastVisitScore(null);\r\n    setPlayerVisitDartsAtDouble(0);\r\n    setAiCountdownMs(0);\r\n    setAiDartsThrown(0);\r\n    setAiLastDart(0);\r\n    setAiVisitSum(0);\r\n    setAiVisitDarts(0);\r\n    setAiLastVisitScore(null);\r\n    setPendingLegWinner(null);\r\n    // When starting a brand-new match from menu, reset legs\r\n    setPlayerLegs(0);\r\n    setAiLegs(0);\r\n    setLegStats([]);\r\n    // Reset Treble Practice session state when starting a new match\r\n    setTrebleHits(0);\r\n    setTrebleDarts(0);\r\n    setTrebleFinished(false);\r\n    // Reset match-long totals\r\n    setTotalPlayerDarts(0);\r\n    setTotalAiDarts(0);\r\n    setTotalPlayerPoints(0);\r\n    setTotalAiPoints(0);\r\n    setPlayer180s(0);\r\n    setPlayer140s(0);\r\n    setPlayer100s(0);\r\n    setAi180s(0);\r\n    setAi140s(0);\r\n    setAi100s(0);\r\n    setPlayerHighestCheckout(0);\r\n    setAiHighestCheckout(0);\r\n    setPlayerDoublesAtt(0);\r\n    setPlayerDoublesHit(0);\r\n    setAiDoublesAtt(0);\r\n    setAiDoublesHit(0);\r\n    resetDartCount(\"X01\");\r\n    // Sync required wins from current format selection\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1));\r\n    setFirstTo(formatType === \"first\" ? n : Math.max(1, Math.ceil(n / 2)));\r\n    if (rememberLastOffline) {\r\n      try {\r\n        setLastOffline({\r\n          mode: selectedMode,\r\n          x01Start: x01Score,\r\n          firstTo,\r\n          aiLevel: ai,\r\n        });\r\n      } catch {}\r\n    }\r\n  }\r\n\r\n  function startNextLeg() {\r\n    setPlayerScore(x01Score);\r\n    playerScoreRef.current = x01Score;\r\n    setAiScore(x01Score);\r\n    setOnDouble(false);\r\n    setShowMatchModal(true);\r\n    setIsPlayerTurn(true);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown(0);\r\n    setPlayerLastDart(0);\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitStart(x01Score);\r\n    setPlayerVisitSum(0);\r\n    playerVisitStartRef.current = x01Score;\r\n    playerVisitSumRef.current = 0;\r\n    setPlayerLastVisitScore(null);\r\n    setPlayerVisitDartsAtDouble(0);\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    setAiCountdownMs(0);\r\n    setAiDartsThrown(0);\r\n    setAiLastDart(0);\r\n    setAiVisitSum(0);\r\n    setAiVisitDarts(0);\r\n    setAiLastVisitScore(null);\r\n    setPendingLegWinner(null);\r\n  }\r\n\r\n  // --- Offline per-dart helpers ---\r\n  function endTurn(nextRemaining: number) {\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitStart(nextRemaining === 0 ? x01Score : nextRemaining);\r\n    playerVisitStartRef.current =\r\n      nextRemaining === 0 ? x01Score : nextRemaining;\r\n    setPlayerVisitDartsAtDouble(0);\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    if (ai !== \"None\") {\r\n      setIsPlayerTurn(false);\r\n      setAiCountdownMs(aiDelayMs);\r\n    } else {\r\n      setAiCountdownMs(0);\r\n      setIsPlayerTurn(true);\r\n    }\r\n  }\r\n\r\n  function applyDartValue(dart: number) {\r\n    if (waitForBoardClear && pendingVisitRef.current) {\r\n      if (!awaitingBoardClear) setAwaitingBoardClear(true);\r\n      toast(\"Remove your darts before starting the next throw\", {\r\n        type: \"info\",\r\n        timeout: 1800,\r\n      });\r\n      return;\r\n    }\r\n    recordDart(\"X01\");\r\n    const currentScore = playerScoreRef.current;\r\n    const currentVisitDarts = playerVisitDartsRef.current;\r\n    const currentVisitSum = playerVisitSumRef.current;\r\n    const currentVisitStart = playerVisitStartRef.current;\r\n    const currentVisitDartsAtDouble = playerVisitDartsAtDoubleRef.current;\r\n    const remaining = currentScore - dart;\r\n    const newVisitDarts = currentVisitDarts + 1;\r\n\r\n    setPlayerLastDart(dart);\r\n    setPlayerDartsThrown((d) => d + 1);\r\n    setTotalPlayerDarts((d) => d + 1);\r\n\r\n    if (remaining < 0) {\r\n      try {\r\n        const preRemaining = currentScore;\r\n        const postRemaining = currentVisitStart;\r\n        useAudit.getState().recordVisit(\"offline-x01\", newVisitDarts, 0, {\r\n          preRemaining,\r\n          postRemaining,\r\n          bust: true,\r\n          finish: false,\r\n        });\r\n      } catch {}\r\n      setPlayerScore(currentVisitStart);\r\n      playerScoreRef.current = currentVisitStart;\r\n\r\n      if (currentScore <= 50) {\r\n        const attemptsThisVisit = (currentVisitDartsAtDouble || 0) + 1;\r\n        setPlayerDoublesAtt((a) => a + attemptsThisVisit);\r\n      }\r\n\r\n      if (callerEnabled) {\r\n        try {\r\n          sayScore(\r\n            user?.username || \"Player\",\r\n            0,\r\n            Math.max(currentVisitStart, 0),\r\n            callerVoice,\r\n            { volume: callerVolume, checkoutOnly: speakCheckoutOnly },\r\n          );\r\n        } catch {}\r\n      }\r\n\r\n      setPlayerLastVisitScore(0);\r\n      setPlayerDartPoints(0);\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n      endTurn(currentVisitStart);\r\n      return;\r\n    }\r\n\r\n    setPlayerScore(remaining);\r\n    playerScoreRef.current = remaining;\r\n\r\n    setPlayerVisitDarts(newVisitDarts);\r\n    playerVisitDartsRef.current = newVisitDarts;\r\n    const newVisitSum = currentVisitSum + dart;\r\n    setPlayerVisitSum(newVisitSum);\r\n    playerVisitSumRef.current = newVisitSum;\r\n\r\n    setTotalPlayerPoints((p) => p + dart);\r\n    setPlayerDartPoints(0);\r\n\r\n    const preRemaining = currentScore;\r\n    const postRemaining = remaining;\r\n    const startedDoubleWindow = preRemaining > 50 && postRemaining <= 50;\r\n    const stillInDoubleWindow = preRemaining <= 50;\r\n    if (startedDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(1);\r\n      playerVisitDartsAtDoubleRef.current = 1;\r\n    } else if (stillInDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble((c) => c + 1);\r\n      playerVisitDartsAtDoubleRef.current =\r\n        (currentVisitDartsAtDouble || 0) + 1;\r\n    }\r\n\r\n    const doubleAttemptsNow = playerVisitDartsAtDoubleRef.current || 0;\r\n    const inDoubleWindow = preRemaining <= 50;\r\n    const attemptsForVisit = inDoubleWindow\r\n      ? Math.max(doubleAttemptsNow, Math.min(newVisitDarts, 3))\r\n      : 0;\r\n\r\n    if (remaining === 0) {\r\n      const pending: PendingAutoVisit = {\r\n        visitTotal: newVisitSum,\r\n        darts: newVisitDarts,\r\n        preRemaining: currentScore,\r\n        remaining: 0,\r\n        doubleAttempts: attemptsForVisit,\r\n        finished: true,\r\n        doubleWindow: inDoubleWindow,\r\n        highestCheckout: currentVisitStart <= 170 ? currentVisitStart : null,\r\n      };\r\n      if (waitForBoardClear) {\r\n        queuePendingVisit(pending);\r\n      } else {\r\n        commitPendingVisit(pending, \"immediate\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (newVisitDarts >= 3) {\r\n      const pending: PendingAutoVisit = {\r\n        visitTotal: newVisitSum,\r\n        darts: newVisitDarts,\r\n        preRemaining: currentScore,\r\n        remaining,\r\n        doubleAttempts: attemptsForVisit,\r\n        finished: false,\r\n        doubleWindow: inDoubleWindow,\r\n        highestCheckout: null,\r\n      };\r\n      if (waitForBoardClear) {\r\n        queuePendingVisit(pending);\r\n      } else {\r\n        commitPendingVisit(pending, \"immediate\");\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  function addDartNumeric() {\r\n    const dart = clamp(Math.round(Number(playerDartPoints) || 0), 0, 60);\r\n    applyDartValue(dart);\r\n  }\r\n\r\n  function commitManualVisitTotal(rawTotal: number): boolean {\r\n    if (!Number.isFinite(rawTotal)) return false;\r\n\r\n    const visitStart = playerVisitStartRef.current;\r\n    const liveScore = playerScoreRef.current;\r\n    const existingDarts = playerVisitDartsRef.current;\r\n    const existingSum = playerVisitSumRef.current;\r\n    const hadPartialVisit = existingDarts > 0 || existingSum > 0;\r\n\r\n    if (hadPartialVisit) {\r\n      setPlayerScore(visitStart);\r\n      playerScoreRef.current = visitStart;\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n      setPlayerLastDart(0);\r\n      setPlayerDartPoints(0);\r\n      setPlayerDartsThrown((d) => Math.max(0, d - existingDarts));\r\n      setTotalPlayerDarts((d) => Math.max(0, d - existingDarts));\r\n      setTotalPlayerPoints((p) => Math.max(0, p - existingSum));\r\n      lastBounceMissTsRef.current = 0;\r\n    }\r\n\r\n    const preRemaining = hadPartialVisit ? visitStart : liveScore;\r\n    const checkoutCap = preRemaining <= 170 ? 170 : 180;\r\n    const total = clamp(Math.round(rawTotal), 0, checkoutCap);\r\n\r\n    recordDart(\"X01\", 3);\r\n    setPlayerDartsThrown((d) => d + 3);\r\n    setTotalPlayerDarts((d) => d + 3);\r\n    setPlayerVisitDarts(3);\r\n    playerVisitDartsRef.current = 3;\r\n    setPlayerVisitSum(total);\r\n    playerVisitSumRef.current = total;\r\n    setPlayerLastVisitScore(total);\r\n\r\n    if (total === 180) setPlayer180s((n) => n + 1);\r\n    else if (total >= 140) setPlayer140s((n) => n + 1);\r\n    else if (total >= 100) setPlayer100s((n) => n + 1);\r\n\r\n    const remaining = preRemaining - total;\r\n\r\n    if (remaining < 0) {\r\n      if (callerEnabled) {\r\n        try {\r\n          sayScore(humanName, 0, Math.max(visitStart, 0), callerVoice, {\r\n            volume: callerVolume,\r\n            checkoutOnly: speakCheckoutOnly,\r\n          });\r\n        } catch {}\r\n      }\r\n      try {\r\n        useAudit.getState().recordVisit(\"offline-x01\", 3, 0, {\r\n          preRemaining,\r\n          postRemaining: visitStart,\r\n          bust: true,\r\n          finish: false,\r\n        });\r\n      } catch {}\r\n      setPlayerScore(visitStart);\r\n      playerScoreRef.current = visitStart;\r\n      setPlayerLastVisitScore(0);\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n      endTurn(visitStart);\r\n      return true;\r\n    }\r\n\r\n    setPlayerScore(remaining);\r\n    playerScoreRef.current = remaining;\r\n    setTotalPlayerPoints((p) => p + total);\r\n\r\n    if (callerEnabled) {\r\n      try {\r\n        sayScore(humanName, total, Math.max(remaining, 0), callerVoice, {\r\n          volume: callerVolume,\r\n          checkoutOnly: speakCheckoutOnly,\r\n        });\r\n      } catch {}\r\n    }\r\n\r\n    if (preRemaining <= 50) {\r\n      setPlayerDoublesAtt((a) => a + 3);\r\n      if (remaining === 0) setPlayerDoublesHit((h) => h + 1);\r\n    }\r\n\r\n    if (remaining === 0) {\r\n      if (preRemaining <= 170)\r\n        setPlayerHighestCheckout((h) => Math.max(h, preRemaining));\r\n      try {\r\n        useAudit.getState().recordVisit(\"offline-x01\", 3, total, {\r\n          preRemaining,\r\n          postRemaining: 0,\r\n          finish: true,\r\n          bust: false,\r\n        });\r\n      } catch {}\r\n      setPendingLegWinner(\"player\");\r\n      setShowWinPopup(true);\r\n      setPlayerVisitDarts(0);\r\n      playerVisitDartsRef.current = 0;\r\n      setPlayerVisitSum(0);\r\n      playerVisitSumRef.current = 0;\r\n      setPlayerVisitDartsAtDouble(0);\r\n      playerVisitDartsAtDoubleRef.current = 0;\r\n      return true;\r\n    }\r\n\r\n    try {\r\n      useAudit.getState().recordVisit(\"offline-x01\", 3, total, {\r\n        preRemaining,\r\n        postRemaining: remaining,\r\n        finish: false,\r\n        bust: false,\r\n      });\r\n    } catch {}\r\n    endTurn(remaining);\r\n    setPlayerVisitSum(0);\r\n    playerVisitSumRef.current = 0;\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitDartsAtDouble(0);\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    return true;\r\n  }\r\n\r\n  // Once local commit and endTurn functions are defined, create the unified offline actions wrapper\r\n  const matchActions: UnifiedMatchActions = createOfflineMatchActions({\r\n    match,\r\n    commitManualVisitTotal,\r\n    endTurn,\r\n  });\r\n\r\n  // Optional: Add a full-visit total (0â€“180) input for quick entry like \"93\"\r\n  const [visitTotalInput, setVisitTotalInput] = useState<string>(\"\");\r\n  const handleVisitTotalChange = (raw: string) => {\r\n    if (!raw) {\r\n      setVisitTotalInput(\"\");\r\n      return;\r\n    }\r\n    const numericOnly = raw.replace(/[^0-9]/g, \"\");\r\n    if (!numericOnly) {\r\n      setVisitTotalInput(\"\");\r\n      return;\r\n    }\r\n    const parsed = Number(numericOnly);\r\n    if (!Number.isFinite(parsed)) return;\r\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180;\r\n    const safe = clamp(Math.round(parsed), 0, maxAllowed);\r\n    setVisitTotalInput(String(safe));\r\n  };\r\n  function addVisitTotal() {\r\n    if (!visitTotalInput) {\r\n      alert(\"Enter a number 0â€“180 for visit total\");\r\n      return;\r\n    }\r\n    const parsed = Number(visitTotalInput);\r\n    if (!Number.isFinite(parsed)) {\r\n      alert(\"Enter a number 0â€“180 for visit total\");\r\n      return;\r\n    }\r\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180;\r\n    const bounded = clamp(Math.round(parsed), 0, maxAllowed);\r\n    if (parsed > maxAllowed) {\r\n      toast(`Visit totals cannot exceed ${maxAllowed}.`, {\r\n        type: \"info\",\r\n        timeout: 2200,\r\n      });\r\n    }\r\n    if (commitManualVisitTotal(bounded)) {\r\n      setVisitTotalInput(\"\");\r\n    }\r\n  }\r\n\r\n  const clearCurrentVisit = useCallback(() => {\r\n    if (pendingVisitRef.current) {\r\n      pendingVisitRef.current = null;\r\n      clearPendingVisitTimer();\r\n      setAwaitingBoardClear(false);\r\n    }\r\n    const visitDarts = playerVisitDartsRef.current;\r\n    const visitTotal = playerVisitSumRef.current;\r\n    const visitStart = playerVisitStartRef.current;\r\n    if (visitDarts === 0 && visitTotal === 0) return;\r\n    setPlayerScore(visitStart);\r\n    playerScoreRef.current = visitStart;\r\n    setPlayerVisitDarts(0);\r\n    playerVisitDartsRef.current = 0;\r\n    setPlayerVisitSum(0);\r\n    playerVisitSumRef.current = 0;\r\n    setPlayerVisitDartsAtDouble(0);\r\n    playerVisitDartsAtDoubleRef.current = 0;\r\n    setPlayerLastDart(0);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown((d) => Math.max(0, d - visitDarts));\r\n    setTotalPlayerDarts((d) => Math.max(0, d - visitDarts));\r\n    setTotalPlayerPoints((p) => Math.max(0, p - visitTotal));\r\n    lastBounceMissTsRef.current = 0;\r\n  }, [clearPendingVisitTimer]);\r\n\r\n  useEffect(() => {\r\n    const onClearRequest = (evt: Event) => {\r\n      const detail = (evt as CustomEvent)?.detail;\r\n      if (!detail || detail?.source === \"offline-play\") return;\r\n      clearCurrentVisit();\r\n    };\r\n    window.addEventListener(\r\n      \"ndn:clear-visit-request\",\r\n      onClearRequest as EventListener,\r\n    );\r\n    return () =>\r\n      window.removeEventListener(\r\n        \"ndn:clear-visit-request\",\r\n        onClearRequest as EventListener,\r\n      );\r\n  }, [clearCurrentVisit]);\r\n\r\n  // --- Double Practice helpers ---\r\n  function addDpValue(val: number) {\r\n    recordDart(\"Double Practice\");\r\n    const dart = clamp(Math.round(val || 0), 0, 60);\r\n    setPlayerLastDart(dart);\r\n    setPlayerDartsThrown((d) => d + 1);\r\n    setTotalPlayerDarts((d) => d + 1);\r\n    if (isDoubleHit(dart, dpIndex)) {\r\n      const nextHits = dpHits + 1;\r\n      setDpHits(nextHits);\r\n      setDpIndex((i) => Math.min(20, i + 1));\r\n      // End when DBULL (index 20) is hit\r\n      if (nextHits >= 21) {\r\n        setPendingLegWinner(\"player\");\r\n        setShowWinPopup(true);\r\n      }\r\n    }\r\n    setPlayerDartPoints(0);\r\n  }\r\n  function addDpNumeric() {\r\n    addDpValue(Number(playerDartPoints));\r\n  }\r\n  function addDpManual() {\r\n    const v = parseManualDart(manualBox);\r\n    if (v == null) {\r\n      alert(\"Enter like D16, 50, 25, T20\");\r\n      return;\r\n    }\r\n    addDpValue(v);\r\n    setManualBox(\"\");\r\n  }\r\n\r\n  // Bob's 27\r\n  function addB27Auto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    if (b27Finished) return false;\r\n    recordDart(\"Bob's 27\");\r\n    const target = b27Stage;\r\n    const hit =\r\n      (ring === \"DOUBLE\" && sector === target) ||\r\n      (!ring && value === target * 2);\r\n    if (hit) setB27Hits((h) => h + 1);\r\n    setB27Darts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        const totalHits = b27Hits + (hit ? 1 : 0);\r\n        if (totalHits > 0) setB27Score((s) => s + totalHits * target * 2);\r\n        else setB27Score((s) => s - target * 2);\r\n        const next = target + 1;\r\n        setB27Stage(next);\r\n        setB27Hits(0);\r\n        if (next > 20) setB27Finished(true);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addB27Numeric() {\r\n    addB27Auto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n  function resetB27() {\r\n    setB27Stage(1);\r\n    setB27Score(27);\r\n    setB27Darts(0);\r\n    setB27Hits(0);\r\n    setB27Finished(false);\r\n    resetDartCount(\"Bob's 27\");\r\n  }\r\n\r\n  // Count-Up / High Score / Low Score\r\n  function addCountUpAuto(value: number): boolean {\r\n    recordDart(\"Count-Up\");\r\n    setCuScore((s) => s + Math.max(0, value | 0));\r\n    setCuDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setCuRound((r) => r + 1);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addHighScoreAuto(value: number): boolean {\r\n    recordDart(\"High Score\");\r\n    setHsScore((s) => s + Math.max(0, value | 0));\r\n    setHsDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setHsRound((r) => r + 1);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addLowScoreAuto(value: number): boolean {\r\n    recordDart(\"Low Score\");\r\n    setLsScore((s) => s + Math.max(0, value | 0));\r\n    setLsDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setLsRound((r) => r + 1);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n\r\n  // Checkout routines (double out)\r\n  function applyCheckout(\r\n    rem: number,\r\n    setRem: (n: number) => void,\r\n    darts: number,\r\n    setDarts: (f: (n: number) => number) => void,\r\n    setAttempts: (f: (n: number) => number) => void,\r\n    setSuccesses: (f: (n: number) => number) => void,\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  ) {\r\n    const next = rem - value;\r\n    if (next < 0) {\r\n      // bust: ignore progress during attempt\r\n    } else if (next === 0) {\r\n      if (ring === \"DOUBLE\" || ring === \"INNER_BULL\") {\r\n        setSuccesses((s) => s + 1);\r\n        setAttempts((a) => a + 1);\r\n        setDarts(() => 0);\r\n        setRem(rem); // caller will reset to initial value right after\r\n        return;\r\n      }\r\n      setRem(next);\r\n    } else {\r\n      setRem(next);\r\n    }\r\n    setDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setAttempts((a) => a + 1);\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n  }\r\n  function addCo170Auto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  ): boolean {\r\n    recordDart(\"Checkout 170\");\r\n    applyCheckout(\r\n      co170Rem,\r\n      setCo170Rem,\r\n      co170Darts,\r\n      setCo170Darts,\r\n      setCo170Attempts,\r\n      setCo170Successes,\r\n      value,\r\n      ring,\r\n    );\r\n    if (co170Darts + 1 >= 3) setCo170Rem(170);\r\n    return true;\r\n  }\r\n  function addCo121Auto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n  ): boolean {\r\n    recordDart(\"Checkout 121\");\r\n    applyCheckout(\r\n      co121Rem,\r\n      setCo121Rem,\r\n      co121Darts,\r\n      setCo121Darts,\r\n      setCo121Attempts,\r\n      setCo121Successes,\r\n      value,\r\n      ring,\r\n    );\r\n    if (co121Darts + 1 >= 3) setCo121Rem(121);\r\n    return true;\r\n  }\r\n  function addCoManual(is170: boolean) {\r\n    const v = parseManualDart(manualBox);\r\n    if (v == null) {\r\n      alert(\"Enter like T20, D16, 25, 50\");\r\n      return;\r\n    }\r\n    const t = manualBox.trim().toUpperCase();\r\n    const isDouble =\r\n      t.startsWith(\"D\") ||\r\n      t === \"50\" ||\r\n      t === \"BULL\" ||\r\n      t === \"DBULL\" ||\r\n      t === \"IBULL\" ||\r\n      t.includes(\"INNER\");\r\n    if (is170) addCo170Auto(v, isDouble ? \"DOUBLE\" : undefined);\r\n    else addCo121Auto(v, isDouble ? \"DOUBLE\" : undefined);\r\n    setManualBox(\"\");\r\n  }\r\n  function resetCo170() {\r\n    setCo170Rem(170);\r\n    setCo170Darts(0);\r\n    setCo170Attempts(0);\r\n    setCo170Successes(0);\r\n    resetDartCount(\"Checkout 170\");\r\n  }\r\n  function resetCo121() {\r\n    setCo121Rem(121);\r\n    setCo121Darts(0);\r\n    setCo121Attempts(0);\r\n    setCo121Successes(0);\r\n    resetDartCount(\"Checkout 121\");\r\n  }\r\n\r\n  // Treble practice\r\n  function addTrebleAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    if (trebleFinished) return false;\r\n    recordDart(\"Treble Practice\");\r\n    const isHit =\r\n      (ring === \"TRIPLE\" && sector === trebleTarget) ||\r\n      (!ring && value === trebleTarget * 3);\r\n    if (isHit) setTrebleHits((h) => h + 1);\r\n    setTrebleDarts((d) => {\r\n      const nd = d + 1;\r\n      // Auto-rotate target every 3 darts among T20â†’T19â†’T18\r\n      if (nd % 3 === 0 && [20, 19, 18].includes(trebleTarget)) {\r\n        const cycle = [20, 19, 18];\r\n        const idx = cycle.indexOf(trebleTarget);\r\n        const next = cycle[(idx + 1) % cycle.length];\r\n        setTrebleTarget(next);\r\n      }\r\n      // End session at configured throws\r\n      if (trebleMaxDarts > 0 && nd >= trebleMaxDarts) setTrebleFinished(true);\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function resetTreble() {\r\n    setTrebleHits(0);\r\n    setTrebleDarts(0);\r\n    setTrebleFinished(false);\r\n    resetDartCount(\"Treble Practice\");\r\n  }\r\n\r\n  // Baseball\r\n  function addBaseballAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Baseball\");\r\n    setBaseball((prev) => {\r\n      const cp = { ...prev };\r\n      applyBaseballDart(cp as any, value, ring as any, sector);\r\n      return cp;\r\n    });\r\n    return true;\r\n  }\r\n  function resetBaseball() {\r\n    setBaseball(createBaseball());\r\n    resetDartCount(\"Baseball\");\r\n  }\r\n\r\n  // Golf\r\n  function addGolfAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Golf\");\r\n    setGolf((prev) => {\r\n      const cp = { ...prev };\r\n      applyGolfDart(cp as any, value, ring as any, sector);\r\n      return cp;\r\n    });\r\n    return true;\r\n  }\r\n  function resetGolf() {\r\n    setGolf(createGolf());\r\n    resetDartCount(\"Golf\");\r\n  }\r\n\r\n  // Tic Tac Toe\r\n  function addTttAuto(\r\n    cell: number,\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Tic Tac Toe\");\r\n    setTTT((prev) => {\r\n      const cp = { ...prev, board: [...prev.board] as any };\r\n      tryClaimCell(cp as any, cell as any, value, ring as any, sector);\r\n      return cp;\r\n    });\r\n    return true;\r\n  }\r\n  function resetTtt() {\r\n    setTTT(createTicTacToe());\r\n    resetDartCount(\"Tic Tac Toe\");\r\n  }\r\n\r\n  // American Cricket\r\n  function addAmCricketAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"American Cricket\");\r\n    setAmCricket((prev) => {\r\n      const cp = { ...prev, marks: { ...prev.marks } };\r\n      applyAmCricketDart(cp as any, value, ring as any, sector, () => false);\r\n      return cp;\r\n    });\r\n    return true;\r\n  }\r\n  function resetAmCricket() {\r\n    setAmCricket(createAmCricketState());\r\n    resetDartCount(\"American Cricket\");\r\n  }\r\n\r\n  // --- Around the Clock helpers ---\r\n  function addAtcValue(\r\n    val: number,\r\n    ring?: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Around the Clock\");\r\n    const target = ATC_ORDER[atcIndex];\r\n    let hit = false;\r\n    if (\r\n      typeof sector === \"number\" &&\r\n      sector === target &&\r\n      (ring === \"SINGLE\" || ring === \"DOUBLE\" || ring === \"TRIPLE\")\r\n    )\r\n      hit = true;\r\n    if (target === 25 && (ring === \"BULL\" || val === 25)) hit = true;\r\n    if (target === 50 && (ring === \"INNER_BULL\" || val === 50)) hit = true;\r\n    if (!hit) {\r\n      // Fallback by value only\r\n      if (val === target || val === target * 2 || val === target * 3)\r\n        hit = true;\r\n    }\r\n  if (hit) {\r\n      const newHits = atcHits + 1;\r\n      setAtcHits(newHits);\r\n      setAtcIndex((i) => i + 1);\r\n      return true;\r\n    }\r\n    return true;\r\n  }\r\n  function addAtcNumeric() {\r\n    addAtcValue(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n  function addAtcManual() {\r\n    const v = parseManualDart(manualBox);\r\n    if (v == null) {\r\n      alert(\"Enter like T20, D5, 25, 50\");\r\n      return;\r\n    }\r\n    addAtcValue(v);\r\n    setManualBox(\"\");\r\n  }\r\n\r\n  // --- Cricket helpers (solo practice) ---\r\n  function addCricketAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Cricket\");\r\n    setCricket((prev) => {\r\n      const copy = { ...prev, marks: { ...prev.marks } };\r\n      applyCricketDart(copy as any, value, ring, sector, () => false);\r\n      return copy;\r\n    });\r\n    setPracticeTurnDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) return 0;\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addCricketNumeric() {\r\n    addCricketAuto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n\r\n  // --- Shanghai helpers ---\r\n  function addShanghaiAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Shanghai\");\r\n    setShanghai((prev) => {\r\n      const copy = { ...prev, turnHits: { ...prev.turnHits } };\r\n      applyShanghaiDart(copy as any, value, ring, sector);\r\n      return copy;\r\n    });\r\n    setPracticeTurnDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setShanghai((prev) => {\r\n          const cp = { ...prev, turnHits: { ...prev.turnHits } };\r\n          endShanghaiTurn(cp as any);\r\n          return cp;\r\n        });\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addShanghaiNumeric() {\r\n    addShanghaiAuto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n\r\n  // --- Halve It helpers ---\r\n  function addHalveAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"Halve It\");\r\n    setHalve((prev) => {\r\n      const copy = { ...prev, targets: [...prev.targets] };\r\n      applyHalveItDart(copy as any, value, ring, sector);\r\n      return copy;\r\n    });\r\n    setPracticeTurnDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setHalve((prev) => {\r\n          const cp = { ...prev, targets: [...prev.targets] };\r\n          endHalveItTurn(cp as any);\r\n          return cp;\r\n        });\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addHalveNumeric() {\r\n    addHalveAuto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n\r\n  // --- High-Low helpers ---\r\n  function addHighLowAuto(\r\n    value: number,\r\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\r\n    sector?: number | null,\r\n  ): boolean {\r\n    recordDart(\"High-Low\");\r\n    setHighlow((prev) => {\r\n      const copy = { ...prev };\r\n      applyHighLowDart(copy as any, value, ring, sector);\r\n      return copy;\r\n    });\r\n    setPracticeTurnDarts((d) => {\r\n      const nd = d + 1;\r\n      if (nd >= 3) {\r\n        setHighlow((prev) => {\r\n          const cp = { ...prev };\r\n          endHighLowTurn(cp as any);\r\n          return cp;\r\n        });\r\n        return 0;\r\n      }\r\n      return nd;\r\n    });\r\n    return true;\r\n  }\r\n  function addHighLowNumeric() {\r\n    addHighLowAuto(Math.max(0, playerDartPoints | 0));\r\n    setPlayerDartPoints(0);\r\n  }\r\n\r\n  function parseManualBox(): number | null {\r\n    const t = manualBox.trim().toUpperCase();\r\n    if (!t) return null;\r\n    if (t === \"50\" || t === \"BULL\" || t === \"DBULL\" || t === \"IBULL\") return 50;\r\n    if (t === \"25\" || t === \"OBULL\") return 25;\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\r\n    if (!m) return null;\r\n    const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\r\n    const num = parseInt(m[2], 10);\r\n    if (num < 1 || num > 20) return null;\r\n    const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\r\n    return num * multVal;\r\n  }\r\n\r\n  function addManual() {\r\n    const val = parseManualBox();\r\n    if (val == null) {\r\n      alert(\"Enter like T20, D16, 5, 25, 50\");\r\n      return;\r\n    }\r\n    applyDartValue(val);\r\n    setManualBox(\"\");\r\n  }\r\n\r\n  function addManualTextarea() {\r\n    const lines = manualTextarea\r\n      .trim()\r\n      .split(\"\\n\")\r\n      .map((l) => l.trim())\r\n      .filter((l) => l);\r\n    if (lines.length === 0) return;\r\n    for (const line of lines) {\r\n      const val = parseManualDart(line);\r\n      if (val == null) {\r\n        alert(`Invalid score: ${line}`);\r\n        return;\r\n      }\r\n      applyDartValue(val);\r\n    }\r\n    setManualTextarea(\"\");\r\n  }\r\n\r\n  function replaceLast() {\r\n    if (playerVisitDarts === 0) return;\r\n    // Rewind one dart: approximate by adding back last dart into score\r\n    setPlayerScore((s) => s + playerLastDart);\r\n    setPlayerVisitDarts((d) => Math.max(0, d - 1));\r\n  }\r\n\r\n  function replaceLastManual() {\r\n    const val = parseManualBox();\r\n    if (val == null) {\r\n      alert(\"Enter like T20, D16, 5, 25, 50\");\r\n      return;\r\n    }\r\n    if (playerVisitDarts === 0) {\r\n      addManual();\r\n      return;\r\n    }\r\n    // Rewind last then apply\r\n    const rewind = playerLastDart;\r\n    setPlayerScore((s) => s + rewind);\r\n    setPlayerVisitDarts((d) => Math.max(0, d - 1));\r\n    // Apply new value in next microtask to ensure state has updated\r\n    setTimeout(() => applyDartValue(val), 0);\r\n    setManualBox(\"\");\r\n  }\r\n\r\n  function playerThrow(points: number) {\r\n    const newScore = playerScore - points;\r\n    if (newScore < 0) {\r\n      setPlayerScore(playerScore); // bust\r\n      return;\r\n    }\r\n    setPlayerScore(newScore);\r\n    if (newScore === 0) {\r\n      setPendingLegWinner(\"player\");\r\n      setShowWinPopup(true);\r\n    }\r\n    setOnDouble(newScore <= 40 && newScore % 2 === 0);\r\n  }\r\n\r\n  function aiTurn() {\r\n    // This is now automated inside the modal turn loop\r\n  }\r\n\r\n  function handleBust() {\r\n    setPlayerScore(playerScore); // bust, score unchanged\r\n    setOnDouble(false);\r\n  }\r\n\r\n  function handleWinPopupSubmit() {\r\n    const winner = pendingLegWinner ?? \"player\";\r\n    // Approximate per-leg doubles attempts: if winner is player and they finished from <=50, attempts were counted in playerVisitDartsAtDouble; otherwise leave undefined\r\n    const legDoublesAtt =\r\n      winner === \"player\"\r\n        ? playerVisitDartsAtDouble || undefined\r\n        : aiVisitDartsAtDouble || undefined;\r\n    const legDoublesHit = 1;\r\n    const winnerDarts = winner === \"player\" ? playerDartsThrown : aiDartsThrown;\r\n    setLegStats([\r\n      ...legStats,\r\n      {\r\n        winner,\r\n        doubleDarts,\r\n        checkoutDarts,\r\n        winnerDarts,\r\n        doublesAtt: legDoublesAtt,\r\n        doublesHit: legDoublesHit,\r\n      },\r\n    ]);\r\n    setShowWinPopup(false);\r\n    // Increment legs for the winner\r\n    let p = playerLegs;\r\n    let a = aiLegs;\r\n    if (pendingLegWinner === \"player\") p += 1;\r\n    else if (pendingLegWinner === \"ai\") a += 1;\r\n    setPlayerLegs(p);\r\n    setAiLegs(a);\r\n    setPendingLegWinner(null);\r\n    // Check if match is over\r\n    if (p >= firstTo || a >= firstTo) {\r\n      // End of match: close modal back to menu state\r\n      // Record per-game-mode result (local-only demo)\r\n      try {\r\n        bumpGameMode(selectedMode, winner === \"player\");\r\n      } catch {}\r\n      setShowMatchModal(false);\r\n      setInMatch(false);\r\n      // Reset leg-specific stats for next match but keep the summary list visible\r\n      setPlayerScore(x01Score);\r\n      setAiScore(x01Score);\r\n      setShowMatchSummary(true);\r\n      return;\r\n    }\r\n    // Otherwise, start the next leg immediately\r\n    startNextLeg();\r\n  }\r\n\r\n  const isFreeSelected = freeGames.includes(selectedMode as any);\r\n  const lockedPremium = !isFreeSelected && !(user?.fullAccess || user?.admin);\r\n\r\n  // no external overlay: we render the match modal as absolute inset-0 inside this card\r\n\r\n  return (\r\n    <div className=\"card ndn-game-shell relative overflow-hidden\">\r\n      {showStartShowcase && (\r\n        <MatchStartShowcase\r\n          players={(match.players || []) as any}\r\n          onDone={() => setShowStartShowcase(false)}\r\n        />\r\n      )}\r\n      <h2 className=\"text-3xl font-bold text-brand-700 mb-4\">\r\n        Offline Mode{\" \"}\r\n        {offlineLayout === \"classic\" ? (\r\n          <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle\">\r\n            Classic layout\r\n          </span>\r\n        ) : (\r\n          <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle\">\r\n            Modern layout\r\n          </span>\r\n        )}\r\n      </h2>\r\n      <div className=\"ndn-shell-body\">\r\n        <div className=\"mb-4 flex flex-col gap-3\">\r\n          <select\r\n            onPointerDown={(e) => { (e as any).stopPropagation(); }}\r\n            onMouseDown={(e) => { e.stopPropagation(); }}\r\n            onTouchStart={(e) => { (e as any).stopPropagation?.(); }}\r\n            className=\"input w-full\"\r\n            value={selectedMode}\r\n            onChange={(e) => setSelectedMode(e.target.value)}\r\n          >\r\n            {freeGames.map((mode) => (\r\n              <option key={mode} value={mode}>\r\n                {mode}\r\n              </option>\r\n            ))}\r\n            {premiumGames.map((mode) => (\r\n              <option\r\n                key={mode}\r\n                value={mode}\r\n                disabled={!(user?.fullAccess || user?.admin)}\r\n              >\r\n                {mode} {user?.fullAccess || user?.admin ? \"\" : \"(Premium)\"}\r\n              </option>\r\n            ))}\r\n          </select>\r\n\r\n          {/* Calibration Status - displayed below game mode selector */}\r\n          <GameCalibrationStatus gameMode={selectedMode} compact={true} />\r\n\r\n          {selectedMode === \"Treble Practice\" && (\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end\">\r\n              <div className=\"sm:col-span-1\">\r\n                <label className=\"font-semibold\">Throws per game</label>\r\n                <input\r\n                  className=\"input w-full\"\r\n                  type=\"number\"\r\n                  min={3}\r\n                  step={3}\r\n                  value={trebleMaxDarts}\r\n                  onChange={(e) =>\r\n                    setTrebleMaxDarts(\r\n                      Math.max(3, Math.floor(Number(e.target.value) || 30)),\r\n                    )\r\n                  }\r\n                />\r\n              </div>\r\n              <div className=\"sm:col-span-2 text-xs text-slate-300\">\r\n                Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the\r\n                selected number of throws.\r\n              </div>\r\n            </div>\r\n          )}\r\n          {!user?.fullAccess && (\r\n            <div className=\"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2\">\r\n              <span>ðŸ”’</span>\r\n              <span>\r\n                Only X01 and Double Practice are free. Advanced modes (Killer,\r\n                Cricket, Shanghai, etc.) require PREMIUM.\r\n              </span>\r\n            </div>\r\n          )}\r\n          {selectedMode === \"X01\" && (\r\n            <>\r\n              <label className=\"font-semibold mt-2\">\r\n                Enter starting score (1-1001):\r\n              </label>\r\n              <input\r\n                className=\"input w-full\"\r\n                type=\"number\"\r\n                min={1}\r\n                max={1001}\r\n                value={x01Score}\r\n                onChange={(e) => setX01Score(Number(e.target.value))}\r\n              />\r\n              <label className=\"font-semibold mt-2\">Play against AI bot?</label>\r\n              <select\r\n                onPointerDown={(e) => { (e as any).stopPropagation(); }}\r\n                onMouseDown={(e) => { e.stopPropagation(); }}\r\n                onTouchStart={(e) => { (e as any).stopPropagation?.(); }}\r\n                className=\"input w-full\"\r\n                value={ai}\r\n                onChange={(e) => setAI(e.target.value)}\r\n              >\r\n                <option value=\"None\">None</option>\r\n                {aiLevels.map((level) => (\r\n                  <option key={level} value={level}>\r\n                    {level}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              {ai !== \"None\" && (\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2\">\r\n                  <div className=\"sm:col-span-2\">\r\n                    <label className=\"font-semibold\">\r\n                      AI throw delay (seconds)\r\n                    </label>\r\n                    <input\r\n                      className=\"input w-full\"\r\n                      type=\"number\"\r\n                      min={0.5}\r\n                      max={10}\r\n                      step={0.5}\r\n                      value={aiDelayMs / 1000}\r\n                      onChange={(e) =>\r\n                        setAiDelayMs(Math.round(Number(e.target.value) * 1000))\r\n                      }\r\n                    />\r\n                  </div>\r\n                  <div className=\"text-sm text-slate-300\">\r\n                    Controls how long the AI waits before its visit.\r\n                  </div>\r\n                </div>\r\n              )}\r\n              <button className=\"btn mt-2\" onClick={() => setShowRules(true)}>\r\n                X01 Rules & Regulations!\r\n              </button>\r\n            </>\r\n          )}\r\n          {selectedMode === \"Double Practice\" && (\r\n            <div className=\"mt-2 text-brand-600\">\r\n              Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and\r\n              X01 settings donâ€™t apply.\r\n            </div>\r\n          )}\r\n        </div>\r\n        {!inMatch && (\r\n          <button\r\n            className=\"btn\"\r\n            disabled={lockedPremium}\r\n            title={lockedPremium ? \"PREMIUM required for this mode\" : \"\"}\r\n            onClick={startMatch}\r\n          >\r\n            Start Match\r\n          </button>\r\n        )}\r\n        {/* Match Modal with turn-by-turn flow */}\r\n        {showMatchModal && (\r\n          <div\r\n            className={`absolute inset-0 z-[1000] ${maximized ? \"\" : \"flex items-center justify-center p-3 sm:p-4\"}`}\r\n          >\r\n            <ResizableModal\r\n              storageKey=\"ndn:modal:offline-match\"\r\n              className={`${maximized ? \"w-full h-full ndn-modal-tight\" : \"\"} relative flex flex-col overflow-hidden`}\r\n              fullScreen={maximized}\r\n              defaultWidth={1100}\r\n              defaultHeight={720}\r\n              minWidth={720}\r\n              minHeight={480}\r\n              maxWidth={1600}\r\n              maxHeight={1200}\r\n              initialFitHeight\r\n            >\r\n              {/* Header bar with visible mode and actions; sheen is clipped to this area */}\r\n              <div\r\n                className=\"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2\"\r\n                style={{ overflowY: \"scroll\" }}\r\n                ref={(el) => {\r\n                  (scrollerRef as any).current = el;\r\n                }}\r\n              >\r\n                <div\r\n                  ref={(el) => {\r\n                    (headerBarRef as any).current = el;\r\n                  }}\r\n                >\r\n                  <GameHeaderBar\r\n                    left={\r\n                      <>\r\n                        <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">\r\n                          Game Mode\r\n                        </span>\r\n                        <span className=\"font-medium whitespace-nowrap\">\r\n                          {selectedMode}\r\n                          {selectedMode === \"X01\" ? ` / ${x01Score}` : \"\"}\r\n                        </span>\r\n                        <span className=\"opacity-80 whitespace-nowrap\">\r\n                          First to {firstTo} Â· Legs {playerLegs}-{aiLegs}\r\n                        </span>\r\n                        <span\r\n                          className={`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${offlineLayout === \"modern\" ? \"bg-emerald-500/15 text-emerald-200 border-emerald-400/30\" : \"bg-white/10 text-white/70 border-white/20\"}`}\r\n                        >\r\n                          {offlineLayout === \"modern\"\r\n                            ? \"Modern layout\"\r\n                            : \"Classic layout\"}\r\n                        </span>\r\n                      </>\r\n                    }\r\n                    right={\r\n                      <>\r\n                        {/* Camera scale controls (match Online UI) */}\r\n                        <div className=\"hidden items-center gap-2 mr-2 text-xs\">\r\n                          <span className=\"opacity-80\">Cam</span>\r\n                          <button\r\n                            className=\"btn btn--ghost px-2 py-1\"\r\n                            onClick={() =>\r\n                              setCameraScale(\r\n                                Math.max(\r\n                                  0.5,\r\n                                  Math.round((cameraScale - 0.05) * 100) / 100,\r\n                                ),\r\n                              )\r\n                            }\r\n                            title=\"Decrease camera size\"\r\n                          >\r\n                            âˆ’\r\n                          </button>\r\n                          <span className=\"w-9 text-center\">\r\n                            {Math.round(cameraScale * 100)}%\r\n                          </span>\r\n                          <button\r\n                            className=\"btn btn--ghost px-2 py-1\"\r\n                            onClick={() =>\r\n                              setCameraScale(\r\n                                Math.min(\r\n                                  1.25,\r\n                                  Math.round((cameraScale + 0.05) * 100) / 100,\r\n                                ),\r\n                              )\r\n                            }\r\n                            title=\"Increase camera size\"\r\n                          >\r\n                            +\r\n                          </button>\r\n                        </div>\r\n                        <button\r\n                          className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                          title={fitAll ? \"Actual Size\" : \"Fit All\"}\r\n                          onClick={() => setFitAll((v) => !v)}\r\n                        >\r\n                          {fitAll ? \"Actual Size\" : \"Fit All\"}\r\n                        </button>\r\n                        <button\r\n                          className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                          title={maximized ? \"Restore\" : \"Maximize\"}\r\n                          onClick={() => setMaximized((m) => !m)}\r\n                        >\r\n                          {maximized ? \"Restore\" : \"Maximize\"}\r\n                        </button>\r\n                        <button\r\n                          className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                          onClick={() => {\r\n                            startMatch();\r\n                          }}\r\n                        >\r\n                          Restart\r\n                        </button>\r\n                        <button\r\n                          className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\r\n                          onClick={() => setShowQuitPause(true)}\r\n                        >\r\n                          Quit\r\n                        </button>\r\n                      </>\r\n                    }\r\n                  />\r\n                </div>\r\n                {showQuitPause && (\r\n                  <PauseQuitModal\r\n                    onClose={() => setShowQuitPause(false)}\r\n                    onQuit={() => {\r\n                      try {\r\n                        broadcastMessage({ type: \"quit\" });\r\n                      } catch {}\r\n                      setShowMatchModal(false);\r\n                      setInMatch(false);\r\n                      setShowQuitPause(false);\r\n                    }}\r\n                    onPause={(minutes) => {\r\n                      const endsAt = Date.now() + minutes * 60 * 1000;\r\n                      try {\r\n                        setPaused(true, endsAt);\r\n                        broadcastMessage({ type: \"pause\", pauseEndsAt: endsAt, pauseStartedAt: Date.now() });\r\n                      } catch {}\r\n                      setShowQuitPause(false);\r\n                    }}\r\n                  />\r\n                )}\r\n                <div\r\n                  ref={(el) => {\r\n                    (contentRef as any).current = el;\r\n                  }}\r\n                  className=\"will-change-transform\"\r\n                  style={\r\n                    fitAll\r\n                      ? {\r\n                          transform: `scale(${fitScale})`,\r\n                          transformOrigin: \"top left\",\r\n                          width: \"100%\",\r\n                          fontSize: `${Math.max(0.8, Math.min(1, fitScale))}em`,\r\n                        }\r\n                      : undefined\r\n                  }\r\n                >\r\n                  <h3 className=\"text-xl font-bold mb-2 mt-1 leading-tight\">\r\n                    {selectedMode === \"X01\" ? \"X01 Match\" : selectedMode}\r\n                  </h3>\r\n                  <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                      Mode: {selectedMode}\r\n                    </span>\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                      Start: {x01Score}\r\n                    </span>\r\n                    <div\r\n                      ref={formatRef}\r\n                      className=\"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10\"\r\n                    >\r\n                      <span>Format:</span>\r\n                      {(() => {\r\n                        const disabled =\r\n                          playerScore !== x01Score ||\r\n                          aiScore !== x01Score ||\r\n                          playerVisitDarts > 0;\r\n                        const pillCls = `pill ${disabled ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer\"} `;\r\n                        return (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className=\"flex items-center gap-1\">\r\n                              <button\r\n                                type=\"button\"\r\n                                className={`${pillCls} ${formatType === \"first\" ? \"pill--filled\" : \"pill--ghost\"}`}\r\n                                onClick={() => {\r\n                                  if (!disabled) setFormatType(\"first\");\r\n                                }}\r\n                                title=\"First to N\"\r\n                              >\r\n                                First to\r\n                              </button>\r\n                              <button\r\n                                type=\"button\"\r\n                                className={`${pillCls} ${formatType === \"best\" ? \"pill--filled\" : \"pill--ghost\"}`}\r\n                                onClick={() => {\r\n                                  if (!disabled) setFormatType(\"best\");\r\n                                }}\r\n                                title=\"Best of N (wins = ceil(N/2)\"\r\n                              >\r\n                                Best of\r\n                              </button>\r\n                            </div>\r\n                            <input\r\n                              className={`input w-16 text-center ${disabled ? \"opacity-50\" : \"\"}`}\r\n                              type=\"number\"\r\n                              min={1}\r\n                              step={1}\r\n                              value={formatCount}\r\n                              onChange={(e) =>\r\n                                setFormatCount(\r\n                                  Math.max(\r\n                                    1,\r\n                                    Math.floor(Number(e.target.value) || 1),\r\n                                  ),\r\n                                )\r\n                              }\r\n                              disabled={disabled}\r\n                              title={\r\n                                formatType === \"first\"\r\n                                  ? \"First to N\"\r\n                                  : \"Best of N (wins = ceil(N/2))\"\r\n                              }\r\n                            />\r\n                          </div>\r\n                        );\r\n                      })()}\r\n                    </div>\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                      Legs: {playerLegs}â€“{aiLegs}\r\n                    </span>\r\n                    {/* Move match type and team names to the right of Legs for a single-row header */}\r\n                    <div className=\"ml-auto flex items-center gap-1 text-[10px] flex-wrap\">\r\n                      <span className=\"opacity-70\">Match</span>\r\n                      <select\r\n                        className={`btn ${buttonSizeClass}`}\r\n                        value={matchType}\r\n                        onChange={(e) =>\r\n                          setMatchType(e.target.value as \"singles\" | \"doubles\")\r\n                        }\r\n                      >\r\n                        <option value=\"singles\">Singles</option>\r\n                        <option value=\"doubles\">Doubles</option>\r\n                      </select>\r\n                      <input\r\n                        className={`input ${buttonSizeClass} w-[7.5rem]`}\r\n                        value={teamAName}\r\n                        onChange={(e) => setTeamAName(e.target.value)}\r\n                        placeholder=\"Team A\"\r\n                      />\r\n                      <span className=\"opacity-50\">vs</span>\r\n                      <input\r\n                        className={`input ${buttonSizeClass} w-[7.5rem]`}\r\n                        value={teamBName}\r\n                        onChange={(e) => setTeamBName(e.target.value)}\r\n                        placeholder=\"Team B\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  {selectedMode !== \"X01\" ? (\r\n                    <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2\">\r\n                      {selectedMode === \"Double Practice\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span className=\"opacity-80\">Current Target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                              {DOUBLE_PRACTICE_ORDER[dpIndex]?.label || \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Around the Clock\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span className=\"opacity-80\">Current Target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                              {ATC_ORDER[atcIndex] === 25\r\n                                ? \"25 (Outer Bull)\"\r\n                                : ATC_ORDER[atcIndex] === 50\r\n                                  ? \"50 (Inner Bull)\"\r\n                                  : ATC_ORDER[atcIndex] || \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Cricket\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 mb-1\">\r\n                            Cricket â€” Close 20â€“15 and Bull; overflow scores\r\n                            points\r\n                          </div>\r\n                          <div className=\"grid grid-cols-7 gap-1 text-center text-[11px] mb-2\">\r\n                            {CRICKET_NUMBERS.map((n) => (\r\n                              <div\r\n                                key={n}\r\n                                className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\"\r\n                              >\r\n                                <div className=\"opacity-70\">\r\n                                  {n === 25 ? \"Bull\" : n}\r\n                                </div>\r\n                                <div className=\"font-semibold\">\r\n                                  {Math.min(3, cricket.marks?.[n] || 0)} / 3\r\n                                </div>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Points:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {cricket.points}\r\n                            </span>\r\n                          </div>\r\n                          {cricketClosedAll(cricket) && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setCricket(createCricketState());\r\n                                  setPracticeTurnDarts(0);\r\n                                  resetDartCount(\"Cricket\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Shanghai\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span>Round</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">\r\n                              {shanghai.round}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {shanghai.score}\r\n                          </div>\r\n                          {shanghai.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setShanghai(createShanghaiState());\r\n                                  setPracticeTurnDarts(0);\r\n                                  resetDartCount(\"Shanghai\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Halve It\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span>Stage</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">\r\n                              {halve.stage + 1}/{halve.targets.length}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Target:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {(() => {\r\n                                const t = getCurrentHalveTarget(halve);\r\n                                if (!t) return \"â€”\";\r\n                                if (t.kind === \"ANY_NUMBER\") return \"Any\";\r\n                                if (t.kind === \"BULL\") return \"Bull\";\r\n                                if (\r\n                                  t.kind === \"DOUBLE\" ||\r\n                                  t.kind === \"TRIPLE\" ||\r\n                                  t.kind === \"NUMBER\"\r\n                                )\r\n                                  return `${t.kind} ${(t as any).num}`;\r\n                                return \"â€”\";\r\n                              })()}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {halve.score}\r\n                          </div>\r\n                          {halve.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setHalve(createDefaultHalveIt());\r\n                                  setPracticeTurnDarts(0);\r\n                                  resetDartCount(\"Halve It\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"High-Low\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Round {highlow.round} Â· Target {highlow.target}\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {highlow.score}\r\n                          </div>\r\n                          {highlow.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setHighlow(createHighLow());\r\n                                  setPracticeTurnDarts(0);\r\n                                  resetDartCount(\"High-Low\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Bob's 27\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span>Target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold\">\r\n                              D{b27Stage}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {b27Score}\r\n                          </div>\r\n                          {b27Finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={resetB27}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Count-Up\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Round {cuRound}/8\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {cuScore}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"High Score\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Round {hsRound}/10\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {hsScore}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Low Score\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Round {lsRound}/10\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            Score: {lsScore}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Checkout 170\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Remaining\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {co170Rem}\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400 mt-1\">\r\n                            Attempts: {co170Attempts} Â· Successes:{\" \"}\r\n                            {co170Successes}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Checkout 121\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">\r\n                            Remaining\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {co121Rem}\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400 mt-1\">\r\n                            Attempts: {co121Attempts} Â· Successes:{\" \"}\r\n                            {co121Successes}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Treble Practice\" && (\r\n                        <>\r\n                          <div className=\"flex items-center justify-between gap-4\">\r\n                            <div>\r\n                              <div className=\"text-xs text-slate-600\">\r\n                                Treble Target: T{trebleTarget}\r\n                              </div>\r\n                              <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                                Hits: {trebleHits}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 flex-wrap\">\r\n                              <label className=\"text-sm\">Target</label>\r\n                              <div className=\"inline-flex items-center gap-1\">\r\n                                {[20, 19, 18].map((n) => (\r\n                                  <button\r\n                                    key={`tpick-header-${n}`}\r\n                                    className={`btn px-2 py-0.5 text-xs ${trebleTarget === n ? \"bg-emerald-600/30 border border-emerald-400/30\" : \"\"}`}\r\n                                    onClick={() => setTrebleTarget(n)}\r\n                                  >\r\n                                    T{n}\r\n                                  </button>\r\n                                ))}\r\n                              </div>\r\n                              <span className=\"opacity-60 text-xs\">or</span>\r\n                              <select\r\n                                className=\"input w-24\"\r\n                                value={trebleTarget}\r\n                                onChange={(e) =>\r\n                                  setTrebleTarget(parseInt(e.target.value, 10))\r\n                                }\r\n                              >\r\n                                {Array.from(\r\n                                  { length: 20 },\r\n                                  (_, i) => i + 1,\r\n                                ).map((n) => (\r\n                                  <option key={n} value={n}>\r\n                                    {n}\r\n                                  </option>\r\n                                ))}\r\n                              </select>\r\n                              <button\r\n                                className=\"btn px-3 py-1 text-sm\"\r\n                                onClick={resetTreble}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Baseball\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Inning</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {baseball.inning}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Score:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {baseball.score}\r\n                            </span>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Golf\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Hole</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {golf.hole}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Strokes:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {golf.strokes}\r\n                            </span>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Tic Tac Toe\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Turn</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {ttt.turn}\r\n                          </div>\r\n                          {ttt.finished && (\r\n                            <div className=\"mt-1 text-xs\">\r\n                              Winner: {ttt.winner || \"â€”\"}\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Scam\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Target</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {SCAM_TARGET_NAMES[scam.targetIndex]}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Progress:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {scam.targetIndex + 1}/{SCAM_TARGET_NAMES.length}\r\n                            </span>\r\n                          </div>\r\n                          {scam.finished && (\r\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\r\n                              ðŸŽ‰ Finished in {scam.darts} darts!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Fives\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Score</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {fives.score}/{fives.target}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Darts:{\" \"}\r\n                            <span className=\"font-semibold\">{fives.darts}</span>\r\n                          </div>\r\n                          {fives.finished && (\r\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\r\n                              âœ“ Reached {fives.target}!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Sevens\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600\">Score</div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {sevens.score}/{sevens.target}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Darts:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {sevens.darts}\r\n                            </span>\r\n                          </div>\r\n                          {sevens.finished && (\r\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\r\n                              âœ“ Reached {sevens.target}!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"American Cricket\" && (\r\n                        <>\r\n                          <div className=\"text-xs text-slate-600 mb-1\">\r\n                            Close 20â€“12 and Bull; overflow scores points\r\n                          </div>\r\n                          <div className=\"grid grid-cols-10 gap-1 text-center text-[11px] mb-2\">\r\n                            {AM_CRICKET_NUMBERS.map((n) => (\r\n                              <div\r\n                                key={n}\r\n                                className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\"\r\n                              >\r\n                                <div className=\"opacity-70\">\r\n                                  {n === 25 ? \"Bull\" : n}\r\n                                </div>\r\n                                <div className=\"font-semibold\">\r\n                                  {Math.min(3, amCricket.marks?.[n] || 0)} / 3\r\n                                </div>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            Points:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {amCricket.points}\r\n                            </span>\r\n                          </div>\r\n                          {hasClosedAllAm(amCricket) && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={resetAmCricket}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Killer\" && (\r\n                        <>\r\n                          {!killerSetupDone ? (\r\n                            <div className=\"text-xs text-slate-600\">\r\n                              Setup players and assign numbers\r\n                            </div>\r\n                          ) : (\r\n                            <>\r\n                              <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                                <span>Turn</span>\r\n                                <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                                  {killerPlayers[killerTurnIdx]?.name || \"â€”\"}\r\n                                </span>\r\n                              </div>\r\n                              <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                                {killerWinnerId\r\n                                  ? `${killerPlayers.find((p) => p.id === killerWinnerId)?.name || \"Winner\"} Wins`\r\n                                  : killerLastEvent || \"Ready\"}\r\n                              </div>\r\n                            </>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  ) : offlineLayout === \"modern\" ? (\r\n                    <div className=\"space-y-3 mb-2\">\r\n                      {!manualScoring ? (\r\n                        <>\r\n                          <div className=\"flex items-center flex-wrap gap-1.5 mt-1\">\r\n                            <div className=\"ml-auto flex items-center gap-1 text-[10px]\">\r\n                              <span className=\"opacity-70\">Cam</span>\r\n                              <button\r\n                                className={`btn ${buttonSizeClass}`}\r\n                                onClick={() =>\r\n                                  setCameraScale(\r\n                                    Math.max(\r\n                                      0.5,\r\n                                      Math.round((cameraScale - 0.05) * 100) /\r\n                                        100,\r\n                                    ),\r\n                                  )\r\n                                }\r\n                              >\r\n                                âˆ’\r\n                              </button>\r\n                              <span\r\n                                className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}\r\n                              >\r\n                                {Math.round(cameraScale * 100)}%\r\n                              </span>\r\n                              <button\r\n                                className={`btn ${buttonSizeClass}`}\r\n                                onClick={() =>\r\n                                  setCameraScale(\r\n                                    Math.min(\r\n                                      1.25,\r\n                                      Math.round((cameraScale + 0.05) * 100) /\r\n                                        100,\r\n                                    ),\r\n                                  )\r\n                                }\r\n                              >\r\n                                +\r\n                              </button>\r\n                              <span className=\"opacity-50\">|</span>\r\n                              <button\r\n                                className={`btn ${buttonSizeClass}`}\r\n                                title=\"Toggle fit/fill\"\r\n                                onClick={() =>\r\n                                  setCameraFitMode(\r\n                                    cameraFitMode === \"fill\" ? \"fit\" : \"fill\",\r\n                                  )\r\n                                }\r\n                              >\r\n                                {cameraFitMode === \"fill\" ? \"Fill\" : \"Fit\"}\r\n                              </button>\r\n                              <span className=\"opacity-50\">|</span>\r\n                              <button\r\n                                className={`btn ${buttonSizeClass}`}\r\n                                title=\"Toggle camera aspect\"\r\n                                onClick={() =>\r\n                                  setCameraAspect(\r\n                                    cameraAspect === \"square\"\r\n                                      ? \"wide\"\r\n                                      : \"square\",\r\n                                  )\r\n                                }\r\n                              >\r\n                                {cameraAspect === \"square\" ? \"Square\" : \"Wide\"}\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"relative\">\r\n                            <div className=\"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6\">\r\n                              <div className=\"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]\">\r\n                                <CameraView\r\n                                  scoringMode=\"x01\"\r\n                                  showToolbar={cameraToolbarVisible}\r\n                                  immediateAutoCommit\r\n                                  cameraAutoCommit=\"camera\"\r\n                                  onAutoDart={(value, ring, info) => {\r\n                                    // Camera owns commits for X01; parent should not applyDartValue to avoid duplicates.\r\n                                    // We can optionally log or provide telemetry here.\r\n                                  }}\r\n                                />\r\n                              </div>\r\n\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4\">\r\n                                  <div className=\"space-y-4\">\r\n                                    <div className=\"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\r\n                                      <div className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                        Current Shooter\r\n                                      </div>\r\n                                      <div className=\"mt-1 text-xl font-semibold text-white\">\r\n                                        {activePlayerName}\r\n                                      </div>\r\n                                      <div className=\"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80\">\r\n                                        <div>\r\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\r\n                                            Remaining\r\n                                          </div>\r\n                                          <div className=\"font-mono text-lg text-white\">\r\n                                            {activeRemaining}\r\n                                          </div>\r\n                                        </div>\r\n                                        <div>\r\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\r\n                                            Last Dart\r\n                                          </div>\r\n                                          <div className=\"font-mono text-lg text-white\">\r\n                                            {activeLastScore || 0}\r\n                                          </div>\r\n                                        </div>\r\n                                        <div>\r\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\r\n                                            Match Legs\r\n                                          </div>\r\n                                          <div className=\"font-semibold text-white\">\r\n                                            {playerLegs}-{aiLegs}\r\n                                          </div>\r\n                                        </div>\r\n                                        <div>\r\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\r\n                                            Next Up\r\n                                          </div>\r\n                                          <div className=\"font-medium text-white\">\r\n                                            {inactivePlayerName}\r\n                                          </div>\r\n                                        </div>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n\r\n                                  <div className=\"hidden md:block\">\r\n                                    <GameScoreboard\r\n                                      gameMode={selectedMode as any}\r\n                                      players={singlePlayerScoreboard}\r\n                                      matchScore={`${playerLegs}-${aiLegs}`}\r\n                                    />\r\n                                  </div>\r\n                                </div>\r\n\r\n                                <div className=\"md:hidden\">\r\n                                  <GameScoreboard\r\n                                    gameMode={selectedMode as any}\r\n                                    players={singlePlayerScoreboard}\r\n                                    matchScore={`${playerLegs}-${aiLegs}`}\r\n                                  />\r\n                                </div>\r\n\r\n                                {(selectedMode as any) === \"X01\" && (\r\n                                  <div className=\"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                      Manual Scoreboard Override\r\n                                    </div>\r\n                                    <p className=\"mt-1 text-xs text-white/40\">\r\n                                      Adjust the live totals if a dart was\r\n                                      misread. Values are clamped between 0 and{\" \"}\r\n                                      {x01Score}.\r\n                                    </p>\r\n                                    <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm\">\r\n                                      <div className=\"space-y-3\">\r\n                                        <div className=\"text-sm font-semibold text-white\">\r\n                                          {humanName}\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                            Commit Visit\r\n                                          </label>\r\n                                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                                            <MatchControls\r\n                                              inProgress={true}\r\n                                              startingScore={x01Score}\r\n                                              onAddVisit={makeOfflineAddVisitAdapter(\r\n                                                commitManualVisitTotal,\r\n                                              )}\r\n                                              quickButtons={[180, 140, 100, 60]}\r\n                                              onNextPlayer={() =>\r\n                                                matchActions?.nextPlayer()\r\n                                              }\r\n                                              onEndLeg={() => {\r\n                                                /* End leg handled via commitManualVisitTotal / addVisitTotal */\r\n                                              }}\r\n                                              onUndo={() => {\r\n                                                /* offline undo not implemented here; optionally reset pending visit */\r\n                                              }}\r\n                                              showDartsSelect={true}\r\n                                            />\r\n                                          </div>\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                            Legs Override\r\n                                          </label>\r\n                                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                                            <input\r\n                                              className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                              type=\"number\"\r\n                                              min={0}\r\n                                              value={manualPlayerLegsInput}\r\n                                              onChange={(e) =>\r\n                                                setManualPlayerLegsInput(\r\n                                                  e.target.value,\r\n                                                )\r\n                                              }\r\n                                              onKeyDown={(e) => {\r\n                                                if (e.key === \"Enter\")\r\n                                                  handleManualLegsOverride(\r\n                                                    \"player\",\r\n                                                  );\r\n                                              }}\r\n                                              placeholder={`${playerLegs}`}\r\n                                            />\r\n                                            <button\r\n                                              className=\"btn px-3 py-1 text-sm\"\r\n                                              onClick={() =>\r\n                                                handleManualLegsOverride(\r\n                                                  \"player\",\r\n                                                )\r\n                                              }\r\n                                            >\r\n                                              Set\r\n                                            </button>\r\n                                          </div>\r\n                                        </div>\r\n                                      </div>\r\n                                      <div className=\"space-y-3\">\r\n                                        <div className=\"text-sm font-semibold text-white\">\r\n                                          {aiDisplayName}\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                            Three Dart Edit\r\n                                          </label>\r\n                                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                                            <input\r\n                                              className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                              type=\"number\"\r\n                                              min={0}\r\n                                              max={x01Score}\r\n                                              value={manualOpponentScoreInput}\r\n                                              onChange={(e) =>\r\n                                                setManualOpponentScoreInput(\r\n                                                  e.target.value,\r\n                                                )\r\n                                              }\r\n                                              onKeyDown={(e) => {\r\n                                                if (e.key === \"Enter\")\r\n                                                  handleManualScoreOverride(\r\n                                                    \"ai\",\r\n                                                  );\r\n                                              }}\r\n                                              placeholder={`${aiScore}`}\r\n                                            />\r\n                                            <button\r\n                                              className=\"btn px-3 py-1 text-sm\"\r\n                                              onClick={() =>\r\n                                                handleManualScoreOverride(\"ai\")\r\n                                              }\r\n                                            >\r\n                                              Set\r\n                                            </button>\r\n                                          </div>\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                                            Legs Override\r\n                                          </label>\r\n                                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                                            <input\r\n                                              className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                              type=\"number\"\r\n                                              min={0}\r\n                                              value={manualOpponentLegsInput}\r\n                                              onChange={(e) =>\r\n                                                setManualOpponentLegsInput(\r\n                                                  e.target.value,\r\n                                                )\r\n                                              }\r\n                                              onKeyDown={(e) => {\r\n                                                if (e.key === \"Enter\")\r\n                                                  handleManualLegsOverride(\r\n                                                    \"ai\",\r\n                                                  );\r\n                                              }}\r\n                                              placeholder={`${aiLegs}`}\r\n                                            />\r\n                                            <button\r\n                                              className=\"btn px-3 py-1 text-sm\"\r\n                                              onClick={() =>\r\n                                                handleManualLegsOverride(\"ai\")\r\n                                              }\r\n                                            >\r\n                                              Set\r\n                                            </button>\r\n                                          </div>\r\n                                        </div>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </>\r\n                      ) : (\r\n                        <div className=\"card\">\r\n                          <div className=\"text-sm font-semibold mb-1\">\r\n                            Manual scoring active\r\n                          </div>\r\n                          <div className=\"text-xs opacity-70\">\r\n                            Camera previews are disabled. Use the manual entry\r\n                            controls below to record your turn.\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0\">\r\n                      <div className=\"flex items-stretch justify-center md:px-3 min-w-0\">\r\n                        <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                            <span className=\"opacity-80\">You Remain</span>\r\n                            {isPlayerTurn ? (\r\n                              <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                                THROWING\r\n                              </span>\r\n                            ) : (\r\n                              <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">\r\n                                WAITING TO THROW\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {playerScore}\r\n                          </div>\r\n                          <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                            <div\r\n                              className=\"h-full bg-emerald-400/70\"\r\n                              style={{\r\n                                width: `${Math.max(0, Math.min(100, (1 - playerScore / x01Score) * 100))}%`,\r\n                              }}\r\n                            />\r\n                          </div>\r\n                          <div className=\"text-sm mt-1 opacity-90\">\r\n                            Last dart:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {playerLastDart}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm opacity-90\">\r\n                            Last score:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {playerVisitDarts > 0\r\n                                ? playerVisitSum\r\n                                : (playerLastVisitScore ?? playerLastDart)}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm opacity-90\">\r\n                            3-Dart Avg:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {totalPlayerDarts > 0\r\n                                ? (\r\n                                    (totalPlayerPoints / totalPlayerDarts) *\r\n                                    3\r\n                                  ).toFixed(1)\r\n                                : \"0.0\"}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-xs opacity-70 flex items-center gap-2\">\r\n                            <span>Darts thrown: {playerDartsThrown}</span>\r\n                            <span\r\n                              className=\"inline-flex items-center gap-1\"\r\n                              aria-label=\"Visit darts\"\r\n                            >\r\n                              {[0, 1, 2].map((i) => (\r\n                                <span\r\n                                  key={i}\r\n                                  className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? \"bg-emerald-400\" : \"bg-white/20\"}`}\r\n                                ></span>\r\n                              ))}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-xs opacity-80 mt-1\">\r\n                            Doubles:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              Att {playerDoublesAtt} Â· Hit {playerDoublesHit}\r\n                            </span>\r\n                          </div>\r\n                          {playerScore <= 170 &&\r\n                            playerScore > 0 &&\r\n                            (() => {\r\n                              const sugs = suggestCheckouts(\r\n                                playerScore,\r\n                                favoriteDouble,\r\n                              );\r\n                              const first = sugs[0] || \"â€”\";\r\n                              return (\r\n                                <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\r\n                                  <span className=\"opacity-70\">Checkout</span>\r\n                                  <span className=\"font-semibold\">{first}</span>\r\n                                </div>\r\n                              );\r\n                            })()}\r\n                        </div>\r\n                        {/* Center camera preview: right-aligned and square when selected */}\r\n                        <div className=\"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall\">\r\n                          <ResizablePanel\r\n                            storageKey=\"ndn:camera:tile:offline:center:v4\"\r\n                            className=\"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card\"\r\n                            defaultWidth={0}\r\n                            defaultHeight={0}\r\n                            minWidth={300}\r\n                            minHeight={300}\r\n                            maxWidth={2000}\r\n                            maxHeight={1200}\r\n                            autoFill\r\n                          >\r\n                            <CameraTile\r\n                              label=\"Your Board\"\r\n                              autoStart={true}\r\n                              className=\"min-w-0 h-full\"\r\n                              aspect=\"classic\"\r\n                              fill\r\n                            />\r\n                          </ResizablePanel>\r\n                        </div>\r\n                        {/* Match summary (offline) */}\r\n                        <div\r\n                          className={`mt-2 ${boxSize === \"small\" ? \"p-2\" : boxSize === \"large\" ? \"p-4\" : \"p-3\"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === \"small\" ? \"text-xs\" : textSize === \"large\" ? \"text-base\" : \"text-sm\"}`}\r\n                        >\r\n                          <div className=\"font-semibold mb-2\">\r\n                            Match Summary\r\n                          </div>\r\n                          {(() => {\r\n                            // In offline X01, player is vs AI or practice\r\n                            const currentThrower = isPlayerTurn\r\n                              ? user?.username || \"You\"\r\n                              : ai === \"None\"\r\n                                ? \"â€”\"\r\n                                : `${ai} AI`;\r\n                            const currentRemaining = isPlayerTurn\r\n                              ? playerScore\r\n                              : ai === \"None\"\r\n                                ? 0\r\n                                : aiScore;\r\n                            const lastScoreDisplay = isPlayerTurn\r\n                              ? playerVisitDarts > 0\r\n                                ? playerVisitSum\r\n                                : (playerLastVisitScore ?? playerLastDart)\r\n                              : aiVisitDarts > 0\r\n                                ? aiVisitSum\r\n                                : (aiLastVisitScore ?? aiLastDart);\r\n                            const dartsThrown = isPlayerTurn\r\n                              ? playerDartsThrown\r\n                              : aiDartsThrown;\r\n                            const scored =\r\n                              x01Score -\r\n                              (isPlayerTurn\r\n                                ? playerScore\r\n                                : ai === \"None\"\r\n                                  ? x01Score\r\n                                  : aiScore);\r\n                            const avg3 =\r\n                              dartsThrown > 0 ? (scored / dartsThrown) * 3 : 0;\r\n                            const matchScore = `${playerLegs}-${aiLegs}`;\r\n                            const bestLegText =\r\n                              legStats.length > 0\r\n                                ? `${Math.min(...legStats.map((l) => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\r\n                                : \"â€”\";\r\n                            return (\r\n                              <div className=\"grid grid-cols-2 gap-y-1\">\r\n                                <div className=\"opacity-80\">Current score</div>\r\n                                <div className=\"font-mono text-right\">\r\n                                  {matchScore}\r\n                                </div>\r\n                                <div className=\"opacity-80\">\r\n                                  Current thrower\r\n                                </div>\r\n                                <div className=\"text-right font-semibold text-lg\">\r\n                                  {currentThrower}\r\n                                </div>\r\n                                <div className=\"opacity-80\">\r\n                                  Score remaining\r\n                                </div>\r\n                                <div className=\"text-right font-mono font-bold text-xl\">\r\n                                  {currentRemaining}\r\n                                </div>\r\n                                <div className=\"opacity-80\">3-dart avg</div>\r\n                                <div className=\"text-right font-mono\">\r\n                                  {avg3.toFixed(1)}\r\n                                </div>\r\n                                <div className=\"opacity-80\">Last score</div>\r\n                                <div className=\"text-right font-mono\">\r\n                                  {lastScoreDisplay}\r\n                                </div>\r\n                                <div className=\"opacity-80\">Best leg</div>\r\n                                <div className=\"text-right\">{bestLegText}</div>\r\n                              </div>\r\n                            );\r\n                          })()}\r\n                        </div>\r\n                        <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                          <div className=\"text-xs flex items-center justify-between opacity-80\">\r\n                            <span>\r\n                              {ai === \"None\" ? \"Opponent\" : `${ai} AI`} Remain\r\n                            </span>\r\n                            {!isPlayerTurn ? (\r\n                              <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\r\n                                THROWING\r\n                              </span>\r\n                            ) : (\r\n                              <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">\r\n                                WAITING TO THROW\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\r\n                            {ai !== \"None\" ? aiScore : \"N/A\"}\r\n                          </div>\r\n                          {ai !== \"None\" && (\r\n                            <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                              <div\r\n                                className=\"h-full bg-fuchsia-400/70\"\r\n                                style={{\r\n                                  width: `${Math.max(0, Math.min(100, (1 - aiScore / x01Score) * 100))}%`,\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"text-sm mt-1 opacity-90\">\r\n                            Last dart:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {ai === \"None\" ? 0 : aiLastDart}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm opacity-90\">\r\n                            Last score:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {ai === \"None\"\r\n                                ? \"â€”\"\r\n                                : aiVisitDarts > 0\r\n                                  ? aiVisitSum\r\n                                  : (aiLastVisitScore ?? aiLastDart)}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"text-sm opacity-90\">\r\n                            3-Dart Avg:{\" \"}\r\n                            <span className=\"font-semibold\">\r\n                              {ai !== \"None\"\r\n                                ? totalAiDarts > 0\r\n                                  ? (\r\n                                      (totalAiPoints / totalAiDarts) *\r\n                                      3\r\n                                    ).toFixed(1)\r\n                                  : \"0.0\"\r\n                                : \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {ai !== \"None\" && (\r\n                            <div className=\"text-xs opacity-70\">\r\n                              Darts thrown: {aiDartsThrown}\r\n                            </div>\r\n                          )}\r\n                          {ai !== \"None\" && (\r\n                            <div className=\"text-xs opacity-80 mt-1\">\r\n                              Doubles:{\" \"}\r\n                              <span className=\"font-semibold\">\r\n                                Att {aiDoublesAtt} Â· Hit {aiDoublesHit}\r\n                              </span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  {/* Turn area */}\r\n                  {selectedMode !== \"X01\" ? (\r\n                    <div className=\"space-y-2\">\r\n                      {selectedMode === \"Double Practice\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Target:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {DOUBLE_PRACTICE_ORDER[dpIndex]?.label || \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                onAutoDart={(value, ring) => {\r\n                                  if (\r\n                                    ring === \"DOUBLE\" ||\r\n                                    ring === \"INNER_BULL\"\r\n                                  ) {\r\n                                    const hit = isDoubleHit(value, dpIndex);\r\n                                    if (hit) {\r\n                                      const nh = dpHits + 1;\r\n                                      const ni = dpIndex + 1;\r\n                                      setDpHits(nh);\r\n                                      setDpIndex(ni);\r\n                                      if (nh >= DOUBLE_PRACTICE_ORDER.length)\r\n                                        setTimeout(() => {\r\n                                          setDpHits(0);\r\n                                          setDpIndex(0);\r\n                                        }, 250);\r\n                                      return true;\r\n                                    }\r\n                                  }\r\n                                  return false;\r\n                                }}\r\n                                immediateAutoCommit\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-col gap-2\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <input\r\n                                className=\"input w-24\"\r\n                                type=\"number\"\r\n                                min={0}\r\n                                max={60}\r\n                                value={playerDartPoints}\r\n                                onChange={(e) =>\r\n                                  setPlayerDartPoints(\r\n                                    Number(e.target.value || 0),\r\n                                  )\r\n                                }\r\n                                onKeyDown={(e) => {\r\n                                  if (e.key === \"Enter\") addDpNumeric();\r\n                                }}\r\n                              />\r\n                              <button\r\n                                className=\"btn px-3 py-1 text-sm\"\r\n                                onClick={addDpNumeric}\r\n                              >\r\n                                Add Dart\r\n                              </button>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <input\r\n                                className=\"input w-44\"\r\n                                placeholder=\"Manual (D16, 50, 25, T20)\"\r\n                                value={manualBox}\r\n                                onChange={(e) => setManualBox(e.target.value)}\r\n                                onKeyDown={(e) => {\r\n                                  if (e.key === \"Enter\") addDpManual();\r\n                                }}\r\n                              />\r\n                              <button\r\n                                className=\"btn px-3 py-1 text-sm\"\r\n                                onClick={addDpManual}\r\n                              >\r\n                                Add\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-300\">\r\n                            Progress: {dpHits} of 21\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Around the Clock\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Target:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {ATC_ORDER[atcIndex] === 25\r\n                                ? \"25 (Outer Bull)\"\r\n                                : ATC_ORDER[atcIndex] === 50\r\n                                  ? \"50 (Inner Bull)\"\r\n                                  : ATC_ORDER[atcIndex] || \"â€”\"}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addAtcValue(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addAtcNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addAtcNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-44\"\r\n                              placeholder=\"Manual (T20, D5, 25, 50)\"\r\n                              value={manualBox}\r\n                              onChange={(e) => setManualBox(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addAtcManual();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addAtcManual}\r\n                            >\r\n                              Add\r\n                            </button>\r\n                          </div>\r\n                          {atcHits >= ATC_ORDER.length && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={() => {\r\n                                  setAtcHits(0);\r\n                                  setAtcIndex(0);\r\n                                  resetDartCount(\"Around the Clock\");\r\n                                }}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Cricket\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addCricketAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addCricketNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addCricketNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setCricket(createCricketState());\r\n                                setPracticeTurnDarts(0);\r\n                                resetDartCount(\"Cricket\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Shanghai\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addShanghaiAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addShanghaiNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addShanghaiNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setShanghai(createShanghaiState());\r\n                                setPracticeTurnDarts(0);\r\n                                resetDartCount(\"Shanghai\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Halve It\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addHalveAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addHalveNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addHalveNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setHalve(createDefaultHalveIt());\r\n                                setPracticeTurnDarts(0);\r\n                                resetDartCount(\"Halve It\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"High-Low\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addHighLowAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addHighLowNumeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addHighLowNumeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setHighlow(createHighLow());\r\n                                setPracticeTurnDarts(0);\r\n                                resetDartCount(\"High-Low\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Bob's 27\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addB27Auto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addB27Numeric();\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addB27Numeric}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetB27}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Count-Up\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value) => addCountUpAuto(value)}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  addCountUpAuto(playerDartPoints);\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                addCountUpAuto(playerDartPoints);\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setCuRound(1);\r\n                                setCuScore(0);\r\n                                setCuDarts(0);\r\n                                resetDartCount(\"Count-Up\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Round {cuRound}/{cuMaxRounds}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"High Score\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value) => addHighScoreAuto(value)}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  addHighScoreAuto(playerDartPoints);\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                addHighScoreAuto(playerDartPoints);\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setHsRound(1);\r\n                                setHsScore(0);\r\n                                setHsDarts(0);\r\n                                resetDartCount(\"High Score\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Round {hsRound}/{hsMaxRounds}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Low Score\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value) => addLowScoreAuto(value)}\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={0}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  addLowScoreAuto(playerDartPoints);\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                addLowScoreAuto(playerDartPoints);\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setLsRound(1);\r\n                                setLsScore(0);\r\n                                setLsDarts(0);\r\n                                resetDartCount(\"Low Score\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Round {lsRound}/{lsMaxRounds}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Checkout 170\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring) =>\r\n                                  addCo170Auto(\r\n                                    value,\r\n                                    ring === \"MISS\" ? undefined : ring,\r\n                                  )\r\n                                }\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"text\"\r\n                              placeholder=\"Manual (D16, T20)\"\r\n                              value={manualBox}\r\n                              onChange={(e) => setManualBox(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addCoManual(true);\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => addCoManual(true)}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetCo170}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Remaining: {co170Rem} Â· Attempts: {co170Attempts} Â·\r\n                            Successes: {co170Successes}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Checkout 121\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring) =>\r\n                                  addCo121Auto(\r\n                                    value,\r\n                                    ring === \"MISS\" ? undefined : ring,\r\n                                  )\r\n                                }\r\n                                onAddVisit={makeOfflineAddVisitAdapter(\r\n                                  commitManualVisitTotal,\r\n                                )}\r\n                                onEndLeg={(s?: number) =>\r\n                                  matchActions.endLeg(s)\r\n                                }\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"text\"\r\n                              placeholder=\"Manual (D16, T20)\"\r\n                              value={manualBox}\r\n                              onChange={(e) => setManualBox(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") addCoManual(false);\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => addCoManual(false)}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetCo121}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Remaining: {co121Rem} Â· Attempts: {co121Attempts} Â·\r\n                            Successes: {co121Successes}\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Treble Practice\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addTrebleAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"text\"\r\n                              placeholder=\"Manual (T20)\"\r\n                              value={manualBox}\r\n                              onChange={(e) => setManualBox(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  const v = parseManualDart(manualBox);\r\n                                  if (v != null)\r\n                                    addTrebleAuto(v, undefined, undefined);\r\n                                  setManualBox(\"\");\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                const v = parseManualDart(manualBox);\r\n                                if (v != null)\r\n                                  addTrebleAuto(v, undefined, undefined);\r\n                                setManualBox(\"\");\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Hits: {trebleHits} Â· Misses:{\" \"}\r\n                            {Math.max(0, trebleDarts - trebleHits)} Â· Darts:{\" \"}\r\n                            {trebleDarts}\r\n                            {trebleMaxDarts > 0 ? `/${trebleMaxDarts}` : \"\"}\r\n                          </div>\r\n                          {trebleFinished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              Completed!{\" \"}\r\n                              <button\r\n                                className=\"ml-2 underline\"\r\n                                onClick={resetTreble}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Baseball\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addBaseballAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetBaseball}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Golf\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addGolfAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetGolf}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Tic Tac Toe\" && (\r\n                        <>\r\n                          <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                            {Array.from({ length: 9 }, (_, i) => i).map(\r\n                              (cell) => (\r\n                                <button\r\n                                  key={cell}\r\n                                  className={`h-16 rounded-xl border ${ttt.board[cell] ? \"bg-emerald-500/20 border-emerald-400/30\" : \"bg-slate-800/50 border-slate-700/50\"}`}\r\n                                  onClick={() => {\r\n                                    if (ttt.finished || ttt.board[cell]) return;\r\n                                    // One-tap claim attempt using autoscore last dart; fallback: prompt numeric\r\n                                    // For simplicity here, we use a no-op value and rely on next autoscore dart; as a usable fallback, open a numeric prompt\r\n                                    const promptVal = Number(\r\n                                      prompt(\r\n                                        \"Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)\",\r\n                                      ) || 0,\r\n                                    );\r\n                                    const ring =\r\n                                      promptVal % 3 === 0\r\n                                        ? \"TRIPLE\"\r\n                                        : promptVal % 2 === 0\r\n                                          ? \"DOUBLE\"\r\n                                          : \"SINGLE\";\r\n                                    const tcell = cell as unknown as\r\n                                      | 0\r\n                                      | 1\r\n                                      | 2\r\n                                      | 3\r\n                                      | 4\r\n                                      | 5\r\n                                      | 6\r\n                                      | 7\r\n                                      | 8;\r\n                                    const tgt = TTT_TARGETS[tcell];\r\n                                    const num =\r\n                                      tgt.type === \"BULL\"\r\n                                        ? null\r\n                                        : tgt.num || null;\r\n                                    addTttAuto(\r\n                                      tcell,\r\n                                      promptVal,\r\n                                      ring as any,\r\n                                      num as any,\r\n                                    );\r\n                                  }}\r\n                                >\r\n                                  {ttt.board[cell] || \"\"}\r\n                                </button>\r\n                              ),\r\n                            )}\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) => {\r\n                                  // Attempt to claim the currently tapped-looking cell not tracked; as a simple flow, map by round-robin preference or let user click a cell button above.\r\n                                  // No-op here; primary interaction is via buttons with prompt for now.\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetTtt}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"American Cricket\" && (\r\n                        <>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) =>\r\n                                  addAmCricketAuto(\r\n                                    value,\r\n                                    (ring === \"MISS\" ? undefined : ring) as any,\r\n                                    info?.sector ?? null,\r\n                                  )}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={resetAmCricket}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Scam\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Target:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {SCAM_TARGET_NAMES[scamPlayer.targetIndex]}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) => {\r\n                                  const r = ring === \"MISS\" ? undefined : ring;\r\n                                  recordDart(\"Scam\");\r\n                                  setScamPlayer(\r\n                                    addScamAuto(scamPlayer, value, r as any),\r\n                                  );\r\n                                  return true;\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={1}\r\n                              max={25}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  recordDart(\"Scam\");\r\n                                  setScamPlayer(\r\n                                    addScamNumeric(\r\n                                      scamPlayer,\r\n                                      playerDartPoints,\r\n                                    ),\r\n                                  );\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                recordDart(\"Scam\");\r\n                                setScamPlayer(\r\n                                  addScamNumeric(scamPlayer, playerDartPoints),\r\n                                );\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setScamPlayer(resetScam());\r\n                                resetDartCount(\"Scam\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          {scamPlayer.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              ðŸŽ‰ Finished in {scamPlayer.darts} darts!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Fives\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Score:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {fivesPlayer.score}/{fivesPlayer.target}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) => {\r\n                                  recordDart(\"Fives\");\r\n                                  setFivesPlayer(\r\n                                    addFivesAuto(fivesPlayer, value, ring as any),\r\n                                  );\r\n                                  return true;\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={5}\r\n                              max={50}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  recordDart(\"Fives\");\r\n                                  setFivesPlayer(\r\n                                    addFivesNumeric(\r\n                                      fivesPlayer,\r\n                                      playerDartPoints,\r\n                                    ),\r\n                                  );\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                recordDart(\"Fives\");\r\n                                setFivesPlayer(\r\n                                  addFivesNumeric(\r\n                                    fivesPlayer,\r\n                                    playerDartPoints,\r\n                                  ),\r\n                                );\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setFivesPlayer(resetFives(fivesPlayer.target));\r\n                                resetDartCount(\"Fives\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:{\" \"}\r\n                            {fivesPlayer.darts}\r\n                          </div>\r\n                          {fivesPlayer.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              âœ“ Reached {fivesPlayer.target} in{\" \"}\r\n                              {fivesPlayer.darts} darts!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Sevens\" && (\r\n                        <>\r\n                          <div className=\"font-semibold\">\r\n                            Score:{\" \"}\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                              {sevensPlayer.score}/{sevensPlayer.target}\r\n                            </span>\r\n                          </div>\r\n                          {cameraEnabled && (\r\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                              <CameraView\r\n                                scoringMode=\"custom\"\r\n                                showToolbar={cameraToolbarVisible}\r\n                                immediateAutoCommit\r\n                                onAutoDart={(value, ring, info) => {\r\n                                  recordDart(\"Sevens\");\r\n                                  setSevensPlayer(\r\n                                    addSevensAuto(sevensPlayer, value, ring as any),\r\n                                  );\r\n                                  return true;\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              className=\"input w-24\"\r\n                              type=\"number\"\r\n                              min={7}\r\n                              max={21}\r\n                              value={playerDartPoints}\r\n                              onChange={(e) =>\r\n                                setPlayerDartPoints(Number(e.target.value || 0))\r\n                              }\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") {\r\n                                  recordDart(\"Sevens\");\r\n                                  setSevensPlayer(\r\n                                    addSevensNumeric(\r\n                                      sevensPlayer,\r\n                                      playerDartPoints,\r\n                                    ),\r\n                                  );\r\n                                  setPlayerDartPoints(0);\r\n                                }\r\n                              }}\r\n                            />\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                recordDart(\"Sevens\");\r\n                                setSevensPlayer(\r\n                                  addSevensNumeric(\r\n                                    sevensPlayer,\r\n                                    playerDartPoints,\r\n                                  ),\r\n                                );\r\n                                setPlayerDartPoints(0);\r\n                              }}\r\n                            >\r\n                              Add Dart\r\n                            </button>\r\n                            <button\r\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                              onClick={() => {\r\n                                setSevensPlayer(\r\n                                  resetSevens(sevensPlayer.target),\r\n                                );\r\n                                resetDartCount(\"Sevens\");\r\n                              }}\r\n                            >\r\n                              Reset\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400\">\r\n                            Valid scores: 7, 14, 21 Â· Darts:{\" \"}\r\n                            {sevensPlayer.darts}\r\n                          </div>\r\n                          {sevensPlayer.finished && (\r\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                              âœ“ Reached {sevensPlayer.target} in{\" \"}\r\n                              {sevensPlayer.darts} darts!\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                      {selectedMode === \"Killer\" && (\r\n                        <>\r\n                          {!killerSetupDone ? (\r\n                            <div className=\"space-y-2\">\r\n                              <div className=\"font-semibold\">Players</div>\r\n                              <div className=\"space-y-1\">\r\n                                {killerPlayers.map((p, idx) => (\r\n                                  <div\r\n                                    key={p.id}\r\n                                    className=\"flex items-center gap-2\"\r\n                                  >\r\n                                    <input\r\n                                      className=\"input\"\r\n                                      value={p.name}\r\n                                      onChange={(e) => {\r\n                                        const name = e.target.value;\r\n                                        setKillerPlayers((list) =>\r\n                                          list.map((it, i) =>\r\n                                            i === idx ? { ...it, name } : it,\r\n                                          ),\r\n                                        );\r\n                                      }}\r\n                                    />\r\n                                    <button\r\n                                      className=\"btn px-2 py-1\"\r\n                                      onClick={() =>\r\n                                        setKillerPlayers((list) =>\r\n                                          list.filter((_, i) => i !== idx),\r\n                                        )\r\n                                      }\r\n                                      disabled={killerPlayers.length <= 2}\r\n                                    >\r\n                                      Remove\r\n                                    </button>\r\n                                  </div>\r\n                                ))}\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <button\r\n                                  className=\"btn px-2 py-1\"\r\n                                  onClick={() =>\r\n                                    setKillerPlayers((list) => {\r\n                                      const id = `p${list.length + 1}`;\r\n                                      return [\r\n                                        ...list,\r\n                                        {\r\n                                          id,\r\n                                          name: `Player ${list.length + 1}`,\r\n                                        },\r\n                                      ];\r\n                                    })\r\n                                  }\r\n                                >\r\n                                  Add Player\r\n                                </button>\r\n                                <button\r\n                                  className=\"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1\"\r\n                                  onClick={() => {\r\n                                    if (killerPlayers.length < 2) {\r\n                                      alert(\"Need at least 2 players\");\r\n                                      return;\r\n                                    }\r\n                                    const ids = killerPlayers.map((p) => p.id);\r\n                                    const assigned = assignKillerNumbers(ids);\r\n                                    const initStates: Record<\r\n                                      string,\r\n                                      KillerState\r\n                                    > = {};\r\n                                    ids.forEach((id) => {\r\n                                      initStates[id] = createKillerState(\r\n                                        assigned[id],\r\n                                      );\r\n                                    });\r\n                                    setKillerAssigned(assigned);\r\n                                    setKillerStates(initStates);\r\n                                    setKillerTurnIdx(0);\r\n                                    setKillerDarts(0);\r\n                                    setKillerWinnerId(null);\r\n                                    setKillerLastEvent(\"Assigned numbers\");\r\n                                    setKillerSetupDone(true);\r\n                                  }}\r\n                                >\r\n                                  Assign Numbers & Start\r\n                                </button>\r\n                              </div>\r\n                            </div>\r\n                          ) : (\r\n                            <div className=\"space-y-3\">\r\n                              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                                {killerPlayers.map((p) => {\r\n                                  const st = killerStates[p.id];\r\n                                  const num = killerAssigned[p.id];\r\n                                  return (\r\n                                    <div\r\n                                      key={p.id}\r\n                                      className={`p-2 rounded-xl border ${st?.eliminated ? \"opacity-50 border-red-500/40 bg-red-500/10\" : \"border-slate-700/50 bg-slate-800/50\"}`}\r\n                                    >\r\n                                      <div className=\"flex items-center justify-between text-xs\">\r\n                                        <div className=\"font-semibold\">\r\n                                          {p.name}\r\n                                        </div>\r\n                                        <div\r\n                                          className={`text-[10px] px-1.5 py-0.5 rounded ${st?.isKiller ? \"bg-purple-500/20 text-purple-200 border border-purple-400/30\" : \"bg-slate-600/30 text-slate-300\"}`}\r\n                                        >\r\n                                          {st?.isKiller\r\n                                            ? \"Killer\"\r\n                                            : \"Not Killer\"}\r\n                                        </div>\r\n                                      </div>\r\n                                      <div className=\"mt-1 text-sm\">\r\n                                        Number:{\" \"}\r\n                                        <span className=\"font-semibold\">\r\n                                          {num}\r\n                                        </span>\r\n                                      </div>\r\n                                      <div className=\"text-sm\">\r\n                                        Lives:{\" \"}\r\n                                        <span className=\"font-semibold\">\r\n                                          {st?.lives ?? 0}\r\n                                        </span>\r\n                                      </div>\r\n                                    </div>\r\n                                  );\r\n                                })}\r\n                              </div>\r\n                              {cameraEnabled && (\r\n                                <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                                  <CameraView\r\n                                    scoringMode=\"custom\"\r\n                                    showToolbar={cameraToolbarVisible}\r\n                                    immediateAutoCommit\r\n                                    onAutoDart={(value, ring, info) => {\r\n                                      if (killerWinnerId) return false;\r\n                                      const r =\r\n                                        ring === \"MISS\" ? undefined : ring;\r\n                                      const sector = info?.sector ?? null;\r\n                                      const cur = killerPlayers[killerTurnIdx];\r\n                                      if (!cur) return false;\r\n                                      setKillerStates((prev) => {\r\n                                        const copy: Record<\r\n                                          string,\r\n                                          KillerState\r\n                                        > = {};\r\n                                        Object.keys(prev).forEach(\r\n                                          (k) => (copy[k] = { ...prev[k] }),\r\n                                        );\r\n                                        const res = applyKillerDart(\r\n                                          cur.id,\r\n                                          copy,\r\n                                          r as any,\r\n                                          sector,\r\n                                        );\r\n                                        if (res.becameKiller)\r\n                                          setKillerLastEvent(\r\n                                            `${cur.name} became a Killer`,\r\n                                          );\r\n                                        else if (res.victimId) {\r\n                                          const v = killerPlayers.find(\r\n                                            (p) => p.id === res.victimId,\r\n                                          );\r\n                                          setKillerLastEvent(\r\n                                            `${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved || 0) > 1 ? \"s\" : \"\"})`,\r\n                                          );\r\n                                        } else setKillerLastEvent(\"No effect\");\r\n                                        // Check winner\r\n                                        const win = killerWinner(copy);\r\n                                        if (win) setKillerWinnerId(win);\r\n                                        return copy;\r\n                                      });\r\n                                      setKillerDarts((d) => {\r\n                                        const nd = d + 1;\r\n                                        if (nd >= 3) {\r\n                                          // advance to next alive\r\n                                          let next = killerTurnIdx;\r\n                                          for (\r\n                                            let i = 1;\r\n                                            i <= killerPlayers.length;\r\n                                            i++\r\n                                          ) {\r\n                                            const idx =\r\n                                              (killerTurnIdx + i) %\r\n                                              killerPlayers.length;\r\n                                            const pid = killerPlayers[idx].id;\r\n                                            const st = killerStates[pid];\r\n                                            if (\r\n                                              st &&\r\n                                              !st.eliminated &&\r\n                                              st.lives > 0\r\n                                            ) {\r\n                                              next = idx;\r\n                                              break;\r\n                                            }\r\n                                          }\r\n                                          setKillerTurnIdx(next);\r\n                                          return 0;\r\n                                        }\r\n                                        return nd;\r\n                                      });\r\n                                      return true;\r\n                                    }}\r\n                                  />\r\n                                </div>\r\n                              )}\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <input\r\n                                  className=\"input w-40\"\r\n                                  placeholder=\"Manual (D16, T5)\"\r\n                                  value={manualBox}\r\n                                  onChange={(e) => setManualBox(e.target.value)}\r\n                                  onKeyDown={(e) => {\r\n                                    if (e.key === \"Enter\") {\r\n                                      if (killerWinnerId) return;\r\n                                      const t = manualBox.trim().toUpperCase();\r\n                                      const m = t.match(\r\n                                        /^(S|D|T)?\\s*(\\d{1,2})$/,\r\n                                      );\r\n                                      if (!m) {\r\n                                        setManualBox(\"\");\r\n                                        return;\r\n                                      }\r\n                                      const mult = (m[1] || \"S\") as\r\n                                        | \"S\"\r\n                                        | \"D\"\r\n                                        | \"T\";\r\n                                      const num = parseInt(m[2], 10);\r\n                                      const ring =\r\n                                        mult === \"D\"\r\n                                          ? \"DOUBLE\"\r\n                                          : mult === \"T\"\r\n                                            ? \"TRIPLE\"\r\n                                            : \"SINGLE\";\r\n                                      const cur = killerPlayers[killerTurnIdx];\r\n                                      setKillerStates((prev) => {\r\n                                        const copy: Record<\r\n                                          string,\r\n                                          KillerState\r\n                                        > = {};\r\n                                        Object.keys(prev).forEach(\r\n                                          (k) => (copy[k] = { ...prev[k] }),\r\n                                        );\r\n                                        const res = applyKillerDart(\r\n                                          cur.id,\r\n                                          copy,\r\n                                          ring as any,\r\n                                          num,\r\n                                        );\r\n                                        if (res.becameKiller)\r\n                                          setKillerLastEvent(\r\n                                            `${cur.name} became a Killer`,\r\n                                          );\r\n                                        else if (res.victimId) {\r\n                                          const v = killerPlayers.find(\r\n                                            (p) => p.id === res.victimId,\r\n                                          );\r\n                                          setKillerLastEvent(\r\n                                            `${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved || 0) > 1 ? \"s\" : \"\"})`,\r\n                                          );\r\n                                        } else setKillerLastEvent(\"No effect\");\r\n                                        const win = killerWinner(copy);\r\n                                        if (win) setKillerWinnerId(win);\r\n                                        return copy;\r\n                                      });\r\n                                      setManualBox(\"\");\r\n                                      setKillerDarts((d) => {\r\n                                        const nd = d + 1;\r\n                                        if (nd >= 3) {\r\n                                          let next = killerTurnIdx;\r\n                                          for (\r\n                                            let i = 1;\r\n                                            i <= killerPlayers.length;\r\n                                            i++\r\n                                          ) {\r\n                                            const idx =\r\n                                              (killerTurnIdx + i) %\r\n                                              killerPlayers.length;\r\n                                            const pid = killerPlayers[idx].id;\r\n                                            const st = killerStates[pid];\r\n                                            if (\r\n                                              st &&\r\n                                              !st.eliminated &&\r\n                                              st.lives > 0\r\n                                            ) {\r\n                                              next = idx;\r\n                                              break;\r\n                                            }\r\n                                          }\r\n                                          setKillerTurnIdx(next);\r\n                                          return 0;\r\n                                        }\r\n                                        return nd;\r\n                                      });\r\n                                    }\r\n                                  }}\r\n                                />\r\n                                <button\r\n                                  className=\"btn px-3 py-1 text-sm\"\r\n                                  onClick={() => {\r\n                                    // Skip to next alive player\r\n                                    let next = killerTurnIdx;\r\n                                    for (\r\n                                      let i = 1;\r\n                                      i <= killerPlayers.length;\r\n                                      i++\r\n                                    ) {\r\n                                      const idx =\r\n                                        (killerTurnIdx + i) %\r\n                                        killerPlayers.length;\r\n                                      const pid = killerPlayers[idx].id;\r\n                                      const st = killerStates[pid];\r\n                                      if (\r\n                                        st &&\r\n                                        !st.eliminated &&\r\n                                        st.lives > 0\r\n                                      ) {\r\n                                        next = idx;\r\n                                        break;\r\n                                      }\r\n                                    }\r\n                                    setKillerTurnIdx(next);\r\n                                    setKillerDarts(0);\r\n                                  }}\r\n                                >\r\n                                  Next Player\r\n                                </button>\r\n                                <button\r\n                                  className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                                  onClick={() => {\r\n                                    // Reset Killer\r\n                                    setKillerStates({});\r\n                                    setKillerAssigned({});\r\n                                    setKillerSetupDone(false);\r\n                                    setKillerTurnIdx(0);\r\n                                    setKillerDarts(0);\r\n                                    setKillerWinnerId(null);\r\n                                    setKillerLastEvent(\"\");\r\n                                  }}\r\n                                >\r\n                                  Reset\r\n                                </button>\r\n                              </div>\r\n                              {killerWinnerId && (\r\n                                <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\r\n                                  Winner:{\" \"}\r\n                                  {\r\n                                    killerPlayers.find(\r\n                                      (p) => p.id === killerWinnerId,\r\n                                    )?.name\r\n                                  }{\" \"}\r\n                                  <button\r\n                                    className=\"ml-2 underline\"\r\n                                    onClick={() => {\r\n                                      setKillerStates({});\r\n                                      setKillerAssigned({});\r\n                                      setKillerSetupDone(false);\r\n                                      setKillerTurnIdx(0);\r\n                                      setKillerDarts(0);\r\n                                      setKillerWinnerId(null);\r\n                                      setKillerLastEvent(\"\");\r\n                                    }}\r\n                                  >\r\n                                    Play Again\r\n                                  </button>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-2\">\r\n                      {/* Scorecard + Camera split (Option A): Scoreboard LEFT, Camera RIGHT */}\r\n                      <div className=\"flex gap-3 min-h-0 flex-1 text-[14px]\">\r\n                        {/* Left column: Scoreboard + Manual Scoring (50% width) */}\r\n                        <div className=\"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm\">\r\n                          <div className=\"text-sm font-semibold opacity-80\">\r\n                            Scoreboard\r\n                          </div>\r\n                          {/* Scoreboard */}\r\n                          <div className=\"flex-shrink-0\">\r\n                            <GameScoreboard\r\n                              gameMode={selectedMode as any}\r\n                              players={statsX01}\r\n                              matchScore={`${playerLegs}-${aiLegs}`}\r\n                            />\r\n                          </div>\r\n\r\n                          {/* Manual Scoring Section */}\r\n                          {isPlayerTurn && (\r\n                            <div className=\"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0\">\r\n                              <div className=\"flex flex-wrap items-center justify-between gap-3\">\r\n                                <h4 className=\"text-sm font-semibold tracking-wide uppercase text-indigo-200\">\r\n                                  Manual Scoring\r\n                                </h4>\r\n                                <span className=\"text-xs text-white/60\">\r\n                                  Override a visit or enter dart-by-dart scores.\r\n                                </span>\r\n                              </div>\r\n                              <div className=\"mt-3 space-y-3\">\r\n                                <div className=\"flex flex-wrap items-center gap-2\">\r\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                                    Single Dart\r\n                                  </label>\r\n                                  <input\r\n                                    className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                    type=\"number\"\r\n                                    min={0}\r\n                                    max={60}\r\n                                    value={playerDartPoints}\r\n                                    onChange={(e) =>\r\n                                      setPlayerDartPoints(\r\n                                        Number(e.target.value || 0),\r\n                                      )\r\n                                    }\r\n                                    onKeyDown={(e) => {\r\n                                      if (e.key === \"Enter\")\r\n                                        e.shiftKey\r\n                                          ? replaceLast()\r\n                                          : addDartNumeric();\r\n                                    }}\r\n                                    placeholder=\"60\"\r\n                                  />\r\n                                  <button\r\n                                    className=\"btn px-3 py-1 text-sm\"\r\n                                    onClick={addDartNumeric}\r\n                                  >\r\n                                    Add Dart\r\n                                  </button>\r\n                                </div>\r\n\r\n                                <div className=\"flex flex-wrap items-center gap-2\">\r\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                                    Three Dart Edit\r\n                                  </label>\r\n                                  <input\r\n                                    className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                    type=\"number\"\r\n                                    min={0}\r\n                                    max={playerScore <= 170 ? 170 : 180}\r\n                                    value={visitTotalInput}\r\n                                    onChange={(e) =>\r\n                                      handleVisitTotalChange(e.target.value)\r\n                                    }\r\n                                    onKeyDown={(e) => {\r\n                                      if (e.key === \"Enter\") addVisitTotal();\r\n                                    }}\r\n                                    placeholder=\"100\"\r\n                                  />\r\n                                  <button\r\n                                    className=\"btn px-3 py-1 text-sm\"\r\n                                    onClick={addVisitTotal}\r\n                                  >\r\n                                    Commit Visit\r\n                                  </button>\r\n                                  <button\r\n                                    className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                                    onClick={replaceLast}\r\n                                  >\r\n                                    Undo Visit\r\n                                  </button>\r\n                                </div>\r\n\r\n                                <div className=\"flex flex-wrap items-center gap-2\">\r\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                                    Manual\r\n                                  </label>\r\n                                  <input\r\n                                    className=\"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                    value={manualBox}\r\n                                    onChange={(e) =>\r\n                                      setManualBox(e.target.value)\r\n                                    }\r\n                                    onKeyDown={(e) => {\r\n                                      if (e.key === \"Enter\")\r\n                                        e.shiftKey\r\n                                          ? replaceLastManual()\r\n                                          : addManual();\r\n                                    }}\r\n                                    placeholder=\"T20\"\r\n                                  />\r\n                                  <button\r\n                                    className=\"btn px-3 py-1 text-sm\"\r\n                                    onClick={addManual}\r\n                                  >\r\n                                    Apply\r\n                                  </button>\r\n                                  <button\r\n                                    className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                                    onClick={replaceLastManual}\r\n                                    disabled={playerVisitDarts === 0}\r\n                                  >\r\n                                    Replace Last\r\n                                  </button>\r\n                                </div>\r\n\r\n                                <div>\r\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                                    Multi-entry (one per line)\r\n                                  </label>\r\n                                  <textarea\r\n                                    className=\"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30\"\r\n                                    rows={3}\r\n                                    value={manualTextarea}\r\n                                    onChange={(e) =>\r\n                                      setManualTextarea(e.target.value)\r\n                                    }\r\n                                    placeholder={\"T20\\nD16\\n25\"}\r\n                                  />\r\n                                  <div className=\"mt-2 flex flex-wrap gap-2\">\r\n                                    <button\r\n                                      className=\"btn px-3 py-1 text-sm\"\r\n                                      onClick={addManualTextarea}\r\n                                    >\r\n                                      Apply All\r\n                                    </button>\r\n                                    <button\r\n                                      className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                                      onClick={() => setManualTextarea(\"\")}\r\n                                    >\r\n                                      Clear\r\n                                    </button>\r\n                                  </div>\r\n                                </div>\r\n\r\n                                <div className=\"pt-2 border-t border-white/10 mt-3\">\r\n                                  <button\r\n                                    className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\r\n                                    onClick={clearCurrentVisit}\r\n                                    disabled={\r\n                                      playerVisitDarts === 0 &&\r\n                                      playerVisitSum === 0\r\n                                    }\r\n                                  >\r\n                                    Clear Current Visit\r\n                                  </button>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* Right column: Main Camera Feed (50% width) */}\r\n                        {cameraEnabled && (\r\n                          <div className=\"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black\">\r\n                            <CameraView\r\n                              scoringMode=\"custom\"\r\n                              showToolbar={cameraToolbarVisible}\r\n                              immediateAutoCommit\r\n                              onAutoDart={(value, ring) => {\r\n                                const ringLabel = ring ?? \"MISS\";\r\n                                const safeValue = Number.isFinite(value)\r\n                                  ? Math.max(0, value)\r\n                                  : 0;\r\n                                const now = Date.now();\r\n                                if (safeValue <= 0) {\r\n                                  if (ringLabel !== \"MISS\") return;\r\n                                  if (\r\n                                    now - (lastBounceMissTsRef.current || 0) <\r\n                                    1200\r\n                                  ) {\r\n                                    return;\r\n                                  }\r\n                                  lastBounceMissTsRef.current = now;\r\n                                } else {\r\n                                  lastBounceMissTsRef.current = 0;\r\n                                }\r\n                                applyDartValue(safeValue);\r\n                              }}\r\n                            />\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      {/* Remove the separate camera view below scoreboard */}\r\n                      {(selectedMode as any) === \"X01\" && !cameraEnabled && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode={selectedMode as any}\r\n                            players={statsX01}\r\n                            matchScore={`${playerLegs}-${aiLegs}`}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {(selectedMode as any) === \"Cricket\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Cricket\"\r\n                            players={statsCricket}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Cricket auto-scoring */}\r\n                      {(selectedMode as any) === \"Cricket\" && cameraEnabled && (\r\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  const r = ring === \"MISS\" ? undefined : ring;\r\n                                  addCricketAuto(\r\n                                    value,\r\n                                    r as any,\r\n                                    info?.sector ?? null,\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      {(selectedMode as any) === \"Shanghai\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Shanghai\"\r\n                            players={statsShanghai}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Shanghai auto-scoring */}\r\n                      {(selectedMode as any) === \"Shanghai\" &&\r\n                        cameraEnabled && (\r\n                          <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                            <CameraView\r\n                              scoringMode=\"custom\"\r\n                              showToolbar={cameraToolbarVisible}\r\n                              immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  const r = ring === \"MISS\" ? undefined : ring;\r\n                                  addShanghaiAuto(\r\n                                    value,\r\n                                    r as any,\r\n                                    info?.sector ?? null,\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                            />\r\n                          </div>\r\n                        )}\r\n                      {(selectedMode as any) === \"Killer\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Killer\"\r\n                            players={statsKiller}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {(selectedMode as any) === \"Scam\" && (\r\n                        <>\r\n                          <GameScoreboard gameMode=\"Scam\" players={statsScam} />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Scam auto-scoring */}\r\n                      {(selectedMode as any) === \"Scam\" && cameraEnabled && (\r\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  setScamPlayer(\r\n                                    addScamAuto(scamPlayer, value, ring as any),\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      {(selectedMode as any) === \"Fives\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Fives\"\r\n                            players={statsFives}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Fives auto-scoring */}\r\n                      {(selectedMode as any) === \"Fives\" && cameraEnabled && (\r\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  setFivesPlayer(\r\n                                    addFivesAuto(fivesPlayer, value, ring as any),\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      {(selectedMode as any) === \"Sevens\" && (\r\n                        <>\r\n                          <GameScoreboard\r\n                            gameMode=\"Sevens\"\r\n                            players={statsSevens}\r\n                          />\r\n                        </>\r\n                      )}\r\n                      {/* Camera view for Sevens auto-scoring */}\r\n                      {(selectedMode as any) === \"Sevens\" && cameraEnabled && (\r\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                if (value > 0) {\r\n                                  setSevensPlayer(\r\n                                    addSevensAuto(\r\n                                      sevensPlayer,\r\n                                      value,\r\n                                      ring as any,\r\n                                    ),\r\n                                  );\r\n                                  return true;\r\n                                }\r\n                              }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      <div className=\"font-semibold\">Your Turn</div>\r\n                      <div className=\"flex flex-col gap-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input\r\n                            className=\"input w-24\"\r\n                            type=\"number\"\r\n                            min={0}\r\n                            max={60}\r\n                            value={playerDartPoints}\r\n                            onChange={(e) =>\r\n                              setPlayerDartPoints(Number(e.target.value || 0))\r\n                            }\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\")\r\n                                e.shiftKey ? replaceLast() : addDartNumeric();\r\n                            }}\r\n                          />\r\n                          <button\r\n                            className=\"btn px-3 py-1 text-sm\"\r\n                            onClick={addDartNumeric}\r\n                            title=\"Add a single dart (0â€“60)\"\r\n                          >\r\n                            Add Dart\r\n                          </button>\r\n                        </div>\r\n                        {/* Visit total entry */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input\r\n                            className=\"input w-28\"\r\n                            type=\"number\"\r\n                            min={0}\r\n                            max={playerScore <= 170 ? 170 : 180}\r\n                            placeholder=\"Visit total (0â€“180)\"\r\n                            value={visitTotalInput}\r\n                            onChange={(e) =>\r\n                              handleVisitTotalChange(e.target.value)\r\n                            }\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\") addVisitTotal();\r\n                            }}\r\n                          />\r\n                          <button\r\n                            className=\"btn px-3 py-1 text-sm\"\r\n                            onClick={addVisitTotal}\r\n                            title=\"Commit a full 3-dart total like 93\"\r\n                          >\r\n                            Commit Visit\r\n                          </button>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input\r\n                            className=\"input w-44\"\r\n                            placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                            value={manualBox}\r\n                            onChange={(e) => setManualBox(e.target.value)}\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\")\r\n                                e.shiftKey ? replaceLastManual() : addManual();\r\n                            }}\r\n                          />\r\n                          <button\r\n                            className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                            onClick={replaceLastManual}\r\n                            disabled={playerVisitDarts === 0}\r\n                          >\r\n                            Replace Last\r\n                          </button>\r\n                          <button\r\n                            className=\"btn px-3 py-1 text-sm\"\r\n                            onClick={addManual}\r\n                          >\r\n                            Add\r\n                          </button>\r\n                        </div>\r\n                        <div>\r\n                          <textarea\r\n                            className=\"input w-full h-24 resize-none\"\r\n                            placeholder=\"Type scores manually (one per line, e.g. T20&#10;D16&#10;5&#10;25&#10;50) - No camera needed!\"\r\n                            value={manualTextarea}\r\n                            onChange={(e) => setManualTextarea(e.target.value)}\r\n                          />\r\n                          <div className=\"flex gap-2 mt-1\">\r\n                            <button\r\n                              className=\"btn px-3 py-1 text-sm\"\r\n                              onClick={addManualTextarea}\r\n                            >\r\n                              Add All Scores\r\n                            </button>\r\n                            <button\r\n                              className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                              onClick={() => setManualTextarea(\"\")}\r\n                            >\r\n                              Clear\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-xs text-slate-300\">\r\n                        Tip: Enter to Add Â· Shift+Enter to Replace Last\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"h-1\" />\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        )}\r\n        {showRules && <X01RulesPopup onClose={() => setShowRules(false)} />}\r\n        {/* Frosted overlay when selecting premium mode without access */}\r\n        {lockedPremium && (\r\n          <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n            <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n            <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n              <div className=\"text-3xl mb-2\">ðŸ”’</div>\r\n              <div className=\"font-semibold\">Premium mode locked</div>\r\n              <div className=\"text-sm text-slate-200/80\">\r\n                Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai,\r\n                and more.\r\n              </div>\r\n              <button\r\n                onClick={async () => {\r\n                  try {\r\n                    const res = await fetch(\r\n                      `${API_URL}/api/stripe/create-checkout-session`,\r\n                      {\r\n                        method: \"POST\",\r\n                        headers: { \"Content-Type\": \"application/json\" },\r\n                        body: JSON.stringify({ email: user?.email }),\r\n                      },\r\n                    );\r\n                    const data = await res.json();\r\n                    if (data.ok && data.url) {\r\n                      window.location.href = data.url;\r\n                      if (data.development) {\r\n                        toast(\r\n                          \"Opened Stripe test checkout (development mode)\",\r\n                          { type: \"info\", timeout: 3000 },\r\n                        );\r\n                      }\r\n                    } else if (data.error === \"STRIPE_NOT_CONFIGURED\") {\r\n                      toast(\r\n                        \"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\",\r\n                        { type: \"error\", timeout: 4000 },\r\n                      );\r\n                    } else {\r\n                      toast(\r\n                        \"Failed to create checkout session. Please try again.\",\r\n                        { type: \"error\", timeout: 4000 },\r\n                      );\r\n                    }\r\n                  } catch (err) {\r\n                    toast(\"Error creating checkout. Please try again.\", {\r\n                      type: \"error\",\r\n                      timeout: 4000,\r\n                    });\r\n                  }\r\n                }}\r\n                className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n              >\r\n                Upgrade to PREMIUM Â·{\" \"}\r\n                {formatPriceInCurrency(getUserCurrency(), 5)}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n        {showCameraManager && typeof document !== \"undefined\"\r\n          ? createPortal(\r\n              <div\r\n                className=\"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4\"\r\n                onClick={() => setShowCameraManager(false)}\r\n              >\r\n                <ResizableModal\r\n                  storageKey=\"ndn:modal:offline-camera-manager\"\r\n                  className=\"relative\"\r\n                  defaultWidth={640}\r\n                  defaultHeight={520}\r\n                  minWidth={480}\r\n                  minHeight={420}\r\n                  maxWidth={1200}\r\n                  maxHeight={900}\r\n                  initialFitHeight\r\n                  onClose={() => setShowCameraManager(false)}\r\n                >\r\n                  <div\r\n                    className=\"space-y-3\"\r\n                    onClick={(e) => e.stopPropagation()}\r\n                  >\r\n                    <div className=\"flex items-center justify-between gap-3\">\r\n                      <div>\r\n                        <div className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                          Camera Devices\r\n                        </div>\r\n                        <div className=\"text-xl font-semibold text-white mt-1\">\r\n                          Manage Offline Camera Feeds\r\n                        </div>\r\n                      </div>\r\n                      <button\r\n                        className=\"btn bg-slate-800 hover:bg-slate-700 text-white\"\r\n                        onClick={() => setShowCameraManager(false)}\r\n                      >\r\n                        Close\r\n                      </button>\r\n                    </div>\r\n                    <CameraTile\r\n                      fill\r\n                      user={user}\r\n                      playerScore={playerScore}\r\n                      aiScore={aiScore}\r\n                      x01Score={x01Score}\r\n                      inMatch={inMatch}\r\n                      showWinPopup={showWinPopup}\r\n                      pendingLegWinner={pendingLegWinner}\r\n                      playerDartsThrown={playerDartsThrown}\r\n                      aiDartsThrown={aiDartsThrown}\r\n                      totalPlayerDarts={totalPlayerDarts}\r\n                      totalAiDarts={totalAiDarts}\r\n                      totalPlayerPoints={totalPlayerPoints}\r\n                      totalAiPoints={totalAiPoints}\r\n                      player180s={player180s}\r\n                      player140s={player140s}\r\n                      player100s={player100s}\r\n                      ai180s={ai180s}\r\n                      ai140s={ai140s}\r\n                      ai100s={ai100s}\r\n                      playerHighestCheckout={playerHighestCheckout}\r\n                      aiHighestCheckout={aiHighestCheckout}\r\n                      onClose={() => setShowCameraManager(false)}\r\n                      onOpen={() => setShowCameraManager(true)}\r\n                      layout={offlineLayout}\r\n                    />\r\n                  </div>\r\n                </ResizableModal>\r\n              </div>,\r\n              document.body,\r\n            )\r\n          : null}\r\n        {legOverrideConfirm && typeof document !== \"undefined\"\r\n          ? createPortal(\r\n              (() => {\r\n                const { target, value, stage } = legOverrideConfirm;\r\n                const targetName =\r\n                  target === \"player\" ? humanName : aiDisplayName;\r\n                const currentLegs = target === \"player\" ? playerLegs : aiLegs;\r\n                return (\r\n                  <div\r\n                    className=\"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4\"\r\n                    onClick={handleLegOverrideNo}\r\n                  >\r\n                    <ResizableModal\r\n                      storageKey=\"ndn:modal:offline-leg-override\"\r\n                      className=\"relative\"\r\n                      defaultWidth={360}\r\n                      defaultHeight={240}\r\n                      minWidth={280}\r\n                      minHeight={200}\r\n                      maxWidth={420}\r\n                      maxHeight={360}\r\n                      initialFitHeight\r\n                      onClose={handleLegOverrideNo}\r\n                    >\r\n                      <div\r\n                        className=\"space-y-3 max-w-[18rem] mx-auto\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                      >\r\n                        <div>\r\n                          <div className=\"text-xs uppercase tracking-wide text-white/50\">\r\n                            Step {stage} of 2\r\n                          </div>\r\n                          <div className=\"text-xl font-semibold text-white mt-1\">\r\n                            Override legs?\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-sm text-slate-200 leading-relaxed\">\r\n                          {stage === 1 ? (\r\n                            <>\r\n                              Set {targetName}&apos;s legs to{\" \"}\r\n                              <span className=\"font-semibold text-white\">\r\n                                {value}\r\n                              </span>\r\n                              ? Confirm to continue.\r\n                            </>\r\n                          ) : (\r\n                            <>\r\n                              Final confirmation: set {targetName}&apos;s legs\r\n                              to{\" \"}\r\n                              <span className=\"font-semibold text-white\">\r\n                                {value}\r\n                              </span>\r\n                              . Select{\" \"}\r\n                              <span className=\"font-semibold text-emerald-200\">\r\n                                Yes\r\n                              </span>{\" \"}\r\n                              to apply immediately.\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"rounded-xl bg-black/40 border border-white/10 p-3 text-sm\">\r\n                          <div className=\"text-xs uppercase tracking-wide text-white/50 mb-1\">\r\n                            Current legs\r\n                          </div>\r\n                          <div className=\"text-base font-semibold text-white\">\r\n                            {currentLegs}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center justify-end gap-2 pt-2\">\r\n                          <button\r\n                            className=\"btn bg-rose-600 hover:bg-rose-700 text-white\"\r\n                            onClick={handleLegOverrideNo}\r\n                          >\r\n                            No\r\n                          </button>\r\n                          <button\r\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n                            onClick={handleLegOverrideYes}\r\n                          >\r\n                            Yes\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </ResizableModal>\r\n                  </div>\r\n                );\r\n              })(),\r\n              document.body,\r\n            )\r\n          : null}\r\n        {showWinPopup && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n            <ResizableModal\r\n              storageKey=\"ndn:modal:offline-win\"\r\n              className=\"w-full relative\"\r\n              defaultWidth={420}\r\n              defaultHeight={360}\r\n              minWidth={360}\r\n              minHeight={300}\r\n              maxWidth={800}\r\n              maxHeight={700}\r\n              initialFitHeight\r\n            >\r\n              <h3 className=\"text-lg font-bold mb-2\">Leg Won!</h3>\r\n              <label className=\"block mb-1\">Darts to hit double:</label>\r\n              <div className=\"flex gap-2 mb-2\">\r\n                {[1, 2, 3].map((n) => (\r\n                  <button\r\n                    key={n}\r\n                    className={`btn ${doubleDarts === n ? \"bg-brand-600\" : \"\"}`}\r\n                    onClick={() => setDoubleDarts(n)}\r\n                  >\r\n                    {n}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <label className=\"block mb-1\">Darts for checkout:</label>\r\n              <div className=\"flex gap-2 mb-2\">\r\n                {[1, 2, 3].map((n) => (\r\n                  <button\r\n                    key={n}\r\n                    className={`btn ${checkoutDarts === n ? \"bg-brand-600\" : \"\"}`}\r\n                    onClick={() => setCheckoutDarts(n)}\r\n                  >\r\n                    {n}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <div className=\"grid grid-cols-1 gap-2 mt-2\">\r\n                <button className=\"btn w-full\" onClick={handleWinPopupSubmit}>\r\n                  Submit\r\n                </button>\r\n                <button\r\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700 w-full\"\r\n                  onClick={() => {\r\n                    setShowWinPopup(false);\r\n                    startMatch();\r\n                  }}\r\n                >\r\n                  Rematch\r\n                </button>\r\n                <button\r\n                  className=\"btn bg-slate-700 hover:bg-slate-800 w-full\"\r\n                  onClick={() => {\r\n                    setShowWinPopup(false);\r\n                    setShowMatchModal(false);\r\n                    setInMatch(false);\r\n                  }}\r\n                >\r\n                  Back to Menu\r\n                </button>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        )}\r\n        {showMatchSummary && (\r\n          <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]\">\r\n            <ResizableModal\r\n              storageKey=\"ndn:modal:offline-summary\"\r\n              className=\"w-full relative\"\r\n              defaultWidth={820}\r\n              defaultHeight={520}\r\n              minWidth={600}\r\n              minHeight={400}\r\n              maxWidth={1400}\r\n              maxHeight={1000}\r\n              initialFitHeight\r\n            >\r\n              <h3 className=\"text-xl font-extrabold mb-2\">Match Summary</h3>\r\n              <div className=\"text-xs opacity-80 mb-3\">\r\n                {selectedMode} Â· {x01Score} start Â· First to {firstTo}\r\n              </div>\r\n              {(() => {\r\n                const player3da =\r\n                  totalPlayerDarts > 0\r\n                    ? (totalPlayerPoints / totalPlayerDarts) * 3\r\n                    : 0;\r\n                const player9da = player3da * 3;\r\n                const playerBest = (() => {\r\n                  const darts = legStats\r\n                    .filter(\r\n                      (l) =>\r\n                        l.winner === \"player\" &&\r\n                        typeof l.winnerDarts === \"number\",\r\n                    )\r\n                    .map((l) => l.winnerDarts);\r\n                  if (!darts.length) return \"â€”\";\r\n                  return `${Math.min(...darts)} darts`;\r\n                })();\r\n                const playerWorst = (() => {\r\n                  const darts = legStats\r\n                    .filter(\r\n                      (l) =>\r\n                        l.winner === \"player\" &&\r\n                        typeof l.winnerDarts === \"number\",\r\n                    )\r\n                    .map((l) => l.winnerDarts);\r\n                  if (!darts.length) return \"â€”\";\r\n                  return `${Math.max(...darts)} darts`;\r\n                })();\r\n                const playerPct =\r\n                  playerDoublesAtt > 0\r\n                    ? Math.round((playerDoublesHit / playerDoublesAtt) * 100)\r\n                    : 0;\r\n\r\n                const ai3da =\r\n                  totalAiDarts > 0 ? (totalAiPoints / totalAiDarts) * 3 : 0;\r\n                const ai9da = ai3da * 3;\r\n                const aiBest = (() => {\r\n                  const darts = legStats\r\n                    .filter(\r\n                      (l) =>\r\n                        l.winner === \"ai\" && typeof l.winnerDarts === \"number\",\r\n                    )\r\n                    .map((l) => l.winnerDarts);\r\n                  if (!darts.length) return \"â€”\";\r\n                  return `${Math.min(...darts)} darts`;\r\n                })();\r\n                const aiWorst = (() => {\r\n                  const darts = legStats\r\n                    .filter(\r\n                      (l) =>\r\n                        l.winner === \"ai\" && typeof l.winnerDarts === \"number\",\r\n                    )\r\n                    .map((l) => l.winnerDarts);\r\n                  if (!darts.length) return \"â€”\";\r\n                  return `${Math.max(...darts)} darts`;\r\n                })();\r\n                const aiPct =\r\n                  aiDoublesAtt > 0\r\n                    ? Math.round((aiDoublesHit / aiDoublesAtt) * 100)\r\n                    : 0;\r\n\r\n                return (\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                    <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                      <div className=\"text-sm font-semibold mb-1\">\r\n                        {user?.username || \"You\"}\r\n                      </div>\r\n                      <div className=\"text-3xl font-extrabold\">\r\n                        {playerLegs}\r\n                      </div>\r\n                      <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                      <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                        <div>\r\n                          <span className=\"opacity-70\">Final 3DA</span>\r\n                          <div className=\"font-semibold\">\r\n                            {player3da.toFixed(1)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Final 9DA</span>\r\n                          <div className=\"font-semibold\">\r\n                            {player9da.toFixed(1)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Darts At Double</span>\r\n                          <div className=\"font-semibold\">\r\n                            {playerDoublesAtt}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Double %</span>\r\n                          <div className=\"font-semibold\">{playerPct}%</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Best Dart Leg</span>\r\n                          <div className=\"font-semibold\">{playerBest}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Worst Dart Leg</span>\r\n                          <div className=\"font-semibold\">{playerWorst}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">180's Hit</span>\r\n                          <div className=\"font-semibold\">{player180s}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"hidden md:flex items-center justify-center\">\r\n                      <div className=\"text-4xl font-black\">\r\n                        {playerLegs} â€“ {aiLegs}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                      <div className=\"text-sm font-semibold mb-1\">\r\n                        {ai === \"None\" ? \"Opponent\" : `${ai} AI`}\r\n                      </div>\r\n                      <div className=\"text-3xl font-extrabold\">{aiLegs}</div>\r\n                      <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                      <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                        <div>\r\n                          <span className=\"opacity-70\">Final 3DA</span>\r\n                          <div className=\"font-semibold\">\r\n                            {ai3da.toFixed(1)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Final 9DA</span>\r\n                          <div className=\"font-semibold\">\r\n                            {ai9da.toFixed(1)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Darts At Double</span>\r\n                          <div className=\"font-semibold\">{aiDoublesAtt}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Double %</span>\r\n                          <div className=\"font-semibold\">{aiPct}%</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Best Dart Leg</span>\r\n                          <div className=\"font-semibold\">{aiBest}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">Worst Dart Leg</span>\r\n                          <div className=\"font-semibold\">{aiWorst}</div>\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"opacity-70\">180's Hit</span>\r\n                          <div className=\"font-semibold\">{ai180s}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })()}\r\n              <div className=\"mt-4\">\r\n                <div className=\"text-sm font-semibold mb-2\">Legs Timeline</div>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  {legStats.map((leg, i) => (\r\n                    <div\r\n                      key={i}\r\n                      className={`px-3 py-1 rounded-full border text-xs ${leg.winner === \"player\" ? \"bg-emerald-500/15 border-emerald-400/30\" : \"bg-fuchsia-500/15 border-fuchsia-400/30\"}`}\r\n                    >\r\n                      Leg {i + 1}:{\" \"}\r\n                      {leg.winner === \"player\"\r\n                        ? \"You\"\r\n                        : ai === \"None\"\r\n                          ? \"Opp\"\r\n                          : \"AI\"}{\" \"}\r\n                      Â· Dbl {leg.doubleDarts} Â· CO {leg.checkoutDarts}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              <div className=\"mt-4\">\r\n                <div className=\"text-sm font-semibold mb-2\">Shot Heat Map</div>\r\n                <div className=\"rounded-2xl overflow-hidden bg-black p-3\">\r\n                  {/* Lazy-load HeatMap component to avoid increasing initial bundle too much */}\r\n                  <HeatMap />\r\n                </div>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n                <button\r\n                  className=\"btn bg-slate-700 hover:bg-slate-800\"\r\n                  onClick={() => setShowMatchSummary(false)}\r\n                >\r\n                  Close\r\n                </button>\r\n                <button\r\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700\"\r\n                  onClick={() => {\r\n                    setShowMatchSummary(false);\r\n                    startMatch();\r\n                  }}\r\n                >\r\n                  Rematch\r\n                </button>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        )}\r\n        {legStats.length > 0 && (\r\n          <div className=\"mt-4\">\r\n            <h4 className=\"font-semibold mb-2\">Leg Stats</h4>\r\n            <ul>\r\n              {legStats.map((leg, i) => (\r\n                <li key={i}>\r\n                  Leg {i + 1}: Double darts: {leg.doubleDarts}, Checkout darts:{\" \"}\r\n                  {leg.checkoutDarts}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n        )}\r\n\r\n        {/* Phone camera overlay removed per UX preference; use header badge preview only */}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["doubles","dVal","tag","prefsDoubleScore","fav","suggestCheckouts","remaining","favoriteDouble","hardcoded","target","routes","t","s","sayScore","name","scored","voiceName","opts","synth","msg","isCheckout","isOneEighty","v","CameraTile","label","autoStart","scaleOverride","className","aspect","style","fill","videoRef","useRef","cameraSession","useCameraSession","streaming","setStreaming","useState","ws","setWs","pairCode","setPairCode","pc","setPc","lastRegisteredModeRef","registerStream","useCallback","stream","modeOverride","err","preferredCameraLabel","useUserSettings","mode","setMode","setExpiresAt","setPaired","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","cameraEnabledSetting","setPreferredCameraLocked","preferredCameraLocked","setPreferredCamera","preferredCameraId","fallbackClass","fallbackStyle","jsx","useEffect","h","apiFetch","r","j","ip","x","mobileUrl","useMemo","code","envUrl","u","host","useHttps","port","manualModeSetAt","setManualModeSetAt","cancelled","desiredLabel","timer","start","stop","apply","startWifiConnection","startPhonePairing","constraints","devices","discoverNetworkDevices","error","connectToWifiDevice","device","d","connectToNetworkDevice","startUsbConnection","discoverUSBDevices","newDevice","requestUSBDevice","prev","connectToUsbDevice","connectToUSBDevice","handleModeSelect","newMode","onStart","ev","modeFromEvent","ensureWS","normalizedEnv","proto","sameOrigin","isLocalhost","isRenderHost","renderWS","url","socket","data","peer","e","inbound","offer","regenerateCode","stopAll","CameraFrame","props","cameraScale","storedAspect","onModeSelect","modeDisplayName","reconnectOptions","copyFeedback","setCopyFeedback","copyTimeoutRef","globalFitMode","effectiveFitMode","scale","raw","clamped","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","usbActive","videoElement","baseVideoClass","copyValue","value","type","textarea","jsxs","Fragment","option","isActive","polarToCartesian","cx","cy","angleDeg","a","sectorAngle","sector","HeatMap","width","height","samples","useHeatmapStore","ref","c","ctx","BoardRadii","radii","ringOrder","k","points","angle","p","grd","sectorCounts","secStr","sec","pos","DOUBLE_PRACTICE_ORDER","_","isDoubleHit","targetIdx","parseManualDart","input","m","mult","num","ATC_ORDER","CRICKET_NUMBERS","createCricketState","marks","n","applyCricketDart","state","ring","opponentClosed","hits","cand","before","remainToClose","toApply","overflow","after","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","endShanghaiTurn","next","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","endHalveItTurn","createHighLow","applyHighLowDart","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","i","res","id","idx","applyKillerDart","selfId","states","me","victimId","pid","victim","delta","killerWinner","alive","st","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","TTT_TARGETS","createTicTacToe","checkWin","board","lines","b","tryClaimCell","cell","tgt","ok","w","createScamState","SCAM_TARGETS","SCAM_TARGET_NAMES","getScamTarget","addScamAuto","newIndex","finished","addScamNumeric","resetScam","createFivesState","FIVES_VALID_NUMBERS","isFivesValid","addFivesAuto","newScore","addFivesNumeric","resetFives","createSevensState","SEVENS_VALID_NUMBERS","isSevensValid","addSevensAuto","addSevensNumeric","resetSevens","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","makeOfflineAddVisitAdapter","commitManualVisitTotal","score","darts","createOfflineMatchActions","args","match","endTurn","meta","useOfflineGameStats","gameMode","playerScore","aiScore","playerLegs","aiLegs","playerLastDart","aiLastDart","playerVisitSum","aiVisitSum","playerLastVisitScore","aiLastVisitScore","playerVisitDartCount","aiVisitDartCount","playerDoublesHit","playerDoublesAtt","aiDoublesHit","aiDoublesAtt","legStats","isPlayerTurn","ai","x01Score","cricket","shanghai","killerPlayers","killerStates","killerAssigned","killerTurnIdx","players","playerMatchAvg","playerDarts","playerScored","leg","resolvedPlayerLastScore","l","getAllTimeAvg","resolvedAiLastScore","aiLevels","clamp","min","max","BOARD_CLEAR_GRACE_MS","aiVisitScore","level","candidates","X01RulesPopup","onClose","API_URL","OfflinePlay","user","offlineLayout","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","rememberLastOffline","setLastOffline","autoStartOffline","setCameraScale","cameraAspect","setCameraAspect","cameraFitMode","setCameraFitMode","cameraEnabled","textSize","boxSize","autoCommitMode","matchType","setMatchType","teamAName","setTeamAName","teamBName","setTeamBName","manualScoring","cameraToolbarVisible","waitForBoardClear","selectedMode","setSelectedMode","setX01Score","setAI","showRules","setShowRules","inMatch","setInMatch","setPlayerScore","setAiScore","onDouble","setOnDouble","showWinPopup","setShowWinPopup","firstTo","setFirstTo","setPlayerLegs","useMatch","showStartShowcase","setShowStartShowcase","startedShowcasedRef","setAiLegs","pendingLegWinner","setPendingLegWinner","doubleDarts","setDoubleDarts","checkoutDarts","setCheckoutDarts","setLegStats","aiDelayMs","setAiDelayMs","toast","useToast","showMatchModal","setShowMatchModal","showQuitPause","setShowQuitPause","setPaused","useMatchControl","onQuit","maximized","setMaximized","fitAll","setFitAll","fitScale","setFitScale","fitOverflowing","setFitOverflowing","setIsPlayerTurn","handleOpenManager","setShowCameraManager","playerDartPoints","setPlayerDartPoints","dpIndex","setDpIndex","dpHits","setDpHits","atcIndex","setAtcIndex","atcHits","setAtcHits","setCricket","setShanghai","halve","setHalve","highlow","setHighlow","practiceTurnDarts","setPracticeTurnDarts","b27Stage","setB27Stage","b27Score","setB27Score","b27Darts","setB27Darts","b27Hits","setB27Hits","b27Finished","setB27Finished","cuRound","setCuRound","cuScore","setCuScore","cuDarts","setCuDarts","cuMaxRounds","hsRound","setHsRound","hsScore","setHsScore","hsDarts","setHsDarts","hsMaxRounds","lsRound","setLsRound","lsScore","setLsScore","lsDarts","setLsDarts","lsMaxRounds","co170Rem","setCo170Rem","co170Darts","setCo170Darts","co170Attempts","setCo170Attempts","co170Successes","setCo170Successes","co121Rem","setCo121Rem","co121Darts","setCo121Darts","co121Attempts","setCo121Attempts","co121Successes","setCo121Successes","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","trebleMaxDarts","setTrebleMaxDarts","trebleFinished","setTrebleFinished","baseball","setBaseball","golf","setGolf","ttt","setTTT","amCricket","setAmCricket","setKillerPlayers","setKillerStates","setKillerAssigned","killerSetupDone","setKillerSetupDone","setKillerTurnIdx","killerDarts","setKillerDarts","killerWinnerId","setKillerWinnerId","killerLastEvent","setKillerLastEvent","scam","setScam","scamPlayer","setScamPlayer","fives","setFives","fivesPlayer","setFivesPlayer","sevens","setSevens","sevensPlayer","setSevensPlayer","playerDartsThrown","setPlayerDartsThrown","setPlayerLastDart","playerVisitDarts","setPlayerVisitDarts","playerVisitStart","setPlayerVisitStart","setPlayerVisitSum","setPlayerLastVisitScore","playerVisitDartsAtDouble","setPlayerVisitDartsAtDouble","lastBounceMissTsRef","lastVisitDartsRef","playerScoreRef","playerVisitDartsRef","playerVisitSumRef","playerVisitStartRef","playerVisitDartsAtDoubleRef","aiCountdownMs","setAiCountdownMs","aiDartsThrown","setAiDartsThrown","setAiLastDart","setAiVisitSum","aiVisitDarts","setAiVisitDarts","setAiLastVisitScore","aiVisitDartsAtDouble","setAiVisitDartsAtDouble","setPlayerDoublesAtt","setPlayerDoublesHit","setAiDoublesAtt","setAiDoublesHit","totalPlayerDarts","setTotalPlayerDarts","totalAiDarts","setTotalAiDarts","totalPlayerPoints","setTotalPlayerPoints","totalAiPoints","setTotalAiPoints","player180s","setPlayer180s","player140s","setPlayer140s","player100s","setPlayer100s","ai180s","setAi180s","ai140s","setAi140s","ai100s","setAi100s","playerHighestCheckout","setPlayerHighestCheckout","aiHighestCheckout","setAiHighestCheckout","showMatchSummary","setShowMatchSummary","manualBox","setManualBox","manualTextarea","setManualTextarea","manualPlayerScoreInput","setManualPlayerScoreInput","manualOpponentScoreInput","setManualOpponentScoreInput","manualPlayerLegsInput","setManualPlayerLegsInput","manualOpponentLegsInput","setManualOpponentLegsInput","legOverrideConfirm","setLegOverrideConfirm","showCameraManager","dartCounts","setDartCounts","awaitingBoardClear","setAwaitingBoardClear","pendingVisitRef","pendingVisitTimerRef","clearPendingVisitTimer","speakAutoVisit","pending","speaker","commitPendingVisit","_trigger","visitTotal","preRemaining","doubleAttempts","doubleWindow","highestCheckout","useAudit","finalizePendingVisit","trigger","queuePendingVisit","handler","humanName","aiDisplayName","statsX01","statsCricket","statsShanghai","statsKiller","statsScam","statsFives","statsSevens","activeScoreboardStats","list","playerResolvedLastScore","aiResolvedLastScore","player","singlePlayerScoreboard","matchAvg","allTimeAvg","rest","inactivePlayerName","activePlayerName","activeRemaining","activeLastScore","recordDart","count","resetDartCount","parseManualScoreOverride","parsed","parseManualLegsOverride","cancelPendingAutoVisit","nextScore","safeScore","nextVisitStart","handleManualScoreOverride","applyManualLegOverride","handleManualLegsOverride","handleLegOverrideYes","handleLegOverrideNo","handleKey","event","buttonSizeClass","size","scrollerRef","contentRef","headerBarRef","formatType","setFormatType","formatCount","setFormatCount","formatRef","wins","measure","scroller","content","headerH","availH","availW","rect","currentScale","naturalHeight","naturalWidth","scaleH","scaleW","scaledHeight","overflowing","RO","ro","onAuto","startMatch","onFmt","raf","last","tick","now","dt","visitDarts","targetVisit","dart","preRem","postRem","checkout","startNextLeg","nextRemaining","applyDartValue","currentScore","currentVisitDarts","currentVisitSum","currentVisitStart","currentVisitDartsAtDouble","newVisitDarts","postRemaining","attemptsThisVisit","newVisitSum","startedDoubleWindow","stillInDoubleWindow","doubleAttemptsNow","inDoubleWindow","attemptsForVisit","addDartNumeric","rawTotal","visitStart","liveScore","existingDarts","existingSum","hadPartialVisit","checkoutCap","total","matchActions","visitTotalInput","setVisitTotalInput","handleVisitTotalChange","numericOnly","maxAllowed","safe","addVisitTotal","bounded","clearCurrentVisit","onClearRequest","evt","detail","addDpValue","val","nextHits","addDpNumeric","addDpManual","addB27Auto","hit","nd","totalHits","addB27Numeric","resetB27","addCountUpAuto","addHighScoreAuto","addLowScoreAuto","applyCheckout","rem","setRem","setDarts","setAttempts","setSuccesses","addCo170Auto","addCo121Auto","addCoManual","is170","isDouble","resetCo170","resetCo121","addTrebleAuto","cycle","resetTreble","addBaseballAuto","cp","resetBaseball","addGolfAuto","resetGolf","addTttAuto","resetTtt","addAmCricketAuto","resetAmCricket","addAtcValue","newHits","addAtcNumeric","addAtcManual","addCricketAuto","copy","addCricketNumeric","addShanghaiAuto","addShanghaiNumeric","addHalveAuto","addHalveNumeric","addHighLowAuto","addHighLowNumeric","parseManualBox","addManual","addManualTextarea","line","replaceLast","replaceLastManual","rewind","handleWinPopupSubmit","winner","legDoublesAtt","legDoublesHit","winnerDarts","bumpGameMode","lockedPremium","freeGames","MatchStartShowcase","premiumGames","GameCalibrationStatus","ResizableModal","el","GameHeaderBar","PauseQuitModal","broadcastMessage","minutes","endsAt","disabled","pillCls","cricketClosedAll","CameraView","info","GameScoreboard","MatchControls","first","ResizablePanel","currentThrower","currentRemaining","lastScoreDisplay","dartsThrown","avg3","matchScore","bestLegText","nh","ni","promptVal","tcell","cur","win","it","ids","initStates","ringLabel","safeValue","formatPriceInCurrency","getUserCurrency","createPortal","stage","targetName","currentLegs","player3da","player9da","playerBest","playerWorst","playerPct","ai3da","ai9da","aiBest","aiWorst","aiPct"],"mappings":"yeAGA,MAAMA,GAAU,CACd,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,IACF,EAEA,SAASC,GAAKC,EAAqB,CACjC,OAAIA,IAAQ,KAAa,GACf,OAAOA,EAAI,MAAM,CAAC,CAAC,EAClB,CACb,CAEA,SAASC,GAAiBC,EAAqB,CAC7C,OAAKJ,GAAQ,SAASI,CAAG,EAClBH,GAAKG,CAAG,EADoB,EAErC,CAEO,SAASC,GACdC,EACAC,EAAyB,MACf,CACV,GAAID,EAAY,KAAOA,GAAa,QAAU,CAAA,EAE9C,MAAME,EAAsC,CAC1C,IAAK,CAAC,YAAY,EAClB,IAAK,CAAC,YAAY,EAClB,IAAK,CAAC,YAAY,EAClB,IAAK,CAAC,YAAY,EAClB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,YAAY,EAClB,IAAK,CAAC,eAAgB,YAAY,EAClC,IAAK,CAAC,aAAc,YAAY,EAChC,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,aAAa,EACnB,IAAK,CAAC,YAAY,EAClB,IAAK,CAAC,YAAY,EAClB,IAAK,CAAC,aAAc,YAAY,EAChC,IAAK,CAAC,aAAc,aAAa,EACjC,IAAK,CAAC,YAAY,EAClB,IAAK,CAAC,SAAS,EACf,GAAI,CAAC,aAAc,aAAa,EAChC,GAAI,CAAC,SAAS,EACd,GAAI,CAAC,SAAS,EACd,GAAI,CAAC,SAAS,EACd,GAAI,CAAC,SAAS,EACd,GAAI,CAAC,SAAS,EACd,GAAI,CAAC,UAAW,SAAS,EACzB,GAAI,CAAC,SAAS,EACd,GAAI,CAAC,UAAW,SAAS,EACzB,GAAI,CAAC,WAAY,SAAS,EAC1B,GAAI,CAAC,SAAS,EACd,GAAI,CAAC,UAAW,SAAS,EACzB,GAAI,CAAC,SAAS,EACd,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,UAAW,SAAS,EACzB,GAAI,CAAC,UAAW,QAAQ,EACxB,GAAI,CAAC,SAAU,UAAU,EACzB,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,UAAW,SAAS,EACzB,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,UAAW,SAAS,EACzB,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,OAAQ,QAAQ,EACrB,GAAI,CAAC,SAAU,SAAS,EACxB,GAAI,CAAC,QAAQ,EACb,GAAI,CAAC,QAAQ,EACb,GAAI,CAAC,QAAQ,EACb,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,KAAK,EACV,GAAI,CAAC,IAAI,EACT,GAAI,CAAC,IAAI,EACT,GAAI,CAAC,IAAI,EACT,GAAI,CAAC,IAAI,EACT,GAAI,CAAC,IAAI,EACT,EAAG,CAAC,IAAI,EACR,EAAG,CAAC,IAAI,EACR,EAAG,CAAC,IAAI,EACR,EAAG,CAAC,IAAI,CAAA,EAEV,GAAIA,EAAUF,CAAS,EAAG,OAAOE,EAAUF,CAAS,EAEpD,MAAMG,EAASN,GAAiBI,CAAc,EACxCG,EAAmB,CAAA,EAEzB,UAAWC,IAAK,CAAC,GAAI,GAAI,GAAI,GAAI,EAAE,EAGjC,GADaL,EAAYK,IACZF,EAAQ,CACnBC,EAAO,KAAK,IAAIC,EAAI,CAAC,IAAIJ,CAAc,EAAE,EACzC,KACF,CAEF,GAAI,CAACG,EAAO,QACV,UAAWE,IAAK,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAErC,GADaN,EAAYM,IACZH,EAAQ,CACnBC,EAAO,KAAK,GAAGE,CAAC,IAAIL,CAAc,EAAE,EACpC,KACF,EAGJ,OAAOG,CACT,CAEO,SAASG,GACdC,EACAC,EACAT,EACAU,EACAC,EACA,CACA,GAAI,CACF,MAAMC,EAAQ,OAAO,gBACrB,GAAI,CAACA,EAAO,OACZ,MAAMC,EAAM,IAAI,yBACVC,EAAad,GAAa,KAAOA,EAAY,EAC7Ce,EAAcN,IAAW,IAE/B,GAAI,EADmB,CAACE,GAAM,cAAgBG,GAAcC,GACvC,OAmBrB,GAjBIA,GACFF,EAAI,KAAO,GAAGL,CAAI,gBAClBK,EAAI,KAAO,KACXA,EAAI,MAAQ,MACHC,GACTD,EAAI,KAAO,GAAGL,CAAI,KAAKR,CAAS,cAChCa,EAAI,KAAO,EACXA,EAAI,MAAQ,GACHJ,IAAW,GACpBI,EAAI,KAAO,GAAGL,CAAI,cAClBK,EAAI,KAAO,EACXA,EAAI,MAAQ,IAEZA,EAAI,KAAO,GAAGL,CAAI,KAAKC,CAAM,IAC7BI,EAAI,KAAO,EACXA,EAAI,MAAQ,GAEVH,EAAW,CACb,MAAMM,EAAIJ,EAAM,YAAY,KAAMI,GAAMA,EAAE,OAASN,CAAS,EACxDM,MAAO,MAAQA,EACrB,CACI,OAAOL,GAAM,QAAW,SAC1BE,EAAI,OAAS,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGF,EAAK,MAAM,CAAC,IAC1C,OAAS,EAClB,GAAI,CACFC,EAAM,OAAA,CACR,MAAQ,CAAC,CACTA,EAAM,MAAMC,CAAG,CACjB,MAAQ,CAAC,CACX,CC5IA,SAAwBI,GAAW,CACjC,MAAAC,EACA,UAAAC,EACA,MAAOC,EACP,UAAAC,EACA,OAAAC,EAAS,UACT,MAAAC,EACA,KAAAC,EAAO,EACT,EAAoB,CAClB,MAAMC,EAAWC,EAAAA,OAAyB,IAAI,EACxCC,EAAgBC,GAAA,EAChB,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAS,EAAK,EAC1C,CAACC,EAAIC,CAAK,EAAIF,EAAAA,SAA2B,IAAI,EAC7C,CAACG,EAAUC,CAAW,EAAIJ,EAAAA,SAAwB,IAAI,EACtD,CAACK,EAAIC,CAAK,EAAIN,EAAAA,SAAmC,IAAI,EACrDO,GAAwBZ,EAAAA,OAAgC,IAAI,EAC5Da,EAAiBC,EAAAA,YACrB,CAACC,EAA4BC,EAAiC,UAAY,CACxE,GAAI,CACED,GACFd,EAAc,eAAec,CAAM,EAC/BhB,EAAS,SACXE,EAAc,mBAAmBF,EAAS,OAAO,EAEnDE,EAAc,QAAQe,CAAY,EAClCf,EAAc,aAAa,EAAI,EAC/BW,GAAsB,QAAUI,GAEhCJ,GAAsB,SACtBA,GAAsB,UAAY,UAElCX,EAAc,aAAa,EAAK,EAChCA,EAAc,eAAe,IAAI,EACjCW,GAAsB,QAAU,KAEpC,OAASK,EAAK,CACZ,QAAQ,KACN,8DACAA,CAAA,CAEJ,CACF,EACA,CAAChB,CAAa,CAAA,EAIViB,EAAuBC,GAAiBvC,GAAMA,EAAE,oBAAoB,EACpE,CAACwC,GAAMC,EAAO,EAAIhB,EAAAA,SAAqC,IAEvDa,IAAyB,eAIpB,QAGK,aAAa,QAAQ,iBAAiB,GAMpC,OACjB,EAEK,EAAGI,EAAY,EAAIjB,EAAAA,SAAwB,IAAI,EAC/C,EAAGkB,EAAS,EAAIlB,EAAAA,SAAkB,EAAK,EACvC,CAACmB,GAASC,EAAU,EAAIpB,EAAAA,SAAwB,IAAI,EACpD,CAACqB,GAAWC,EAAY,EAAItB,EAAAA,SAGxB,IAAI,EACR,CAACuB,EAAUC,EAAW,EAAIxB,EAAAA,SAAkB,EAAI,EAChD,CAACyB,EAAaC,EAAc,EAAI1B,EAAAA,SAA0B,CAAA,CAAE,EAC5D,CAAC2B,EAAiBC,EAAkB,EAAI5B,EAAAA,SAAkB,EAAK,EAC/D,CAAC6B,EAAYC,EAAa,EAAI9B,EAAAA,SAAsB,CAAA,CAAE,EACtD,CAAC+B,GAAgBC,EAAiB,EAAIhC,EAAAA,SAAkB,EAAK,EAC7DiC,GAAoBnB,GAAiBvC,GAAMA,EAAE,iBAAiB,EAC9D2D,GAAuBpB,GAAiBvC,GAAMA,EAAE,aAAa,EAC7D4D,EAA2BrB,GAC9BvC,GAAMA,EAAE,wBAAA,EAEL6D,EAAwBtB,GAAiBvC,GAAMA,EAAE,qBAAqB,EACtE8D,EAAqBvB,GAAiBvC,GAAMA,EAAE,kBAAkB,EAChE+D,GAAoBxB,GAAiBvC,GAAMA,EAAE,iBAAiB,EAEpE,GAAI0D,KAAsB,SAAU,CAIlC,MAAMM,EAAgB,CAHD9C,EACjB,4DACA,sDACiCH,CAAS,EAC3C,OAAO,OAAO,EACd,KAAK,GAAG,EACR,KAAA,EACGkD,EAA+B,CAAE,GAAIhD,GAAS,EAAC,EACrD,MACE,CAACC,GACD+C,EAAc,cAAgB,QAC9BA,EAAc,SAAW,QACzBA,EAAc,YAAc,SAE5BA,EAAc,YAAc,eAG3B,MAAA,CAAI,UAAWD,EAAe,MAAOC,EACpC,SAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,4GAA4G,SAAA,yDAAA,CAE3H,EACF,CAEJ,CACAC,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAI,OAAO,SAAS,UACtBA,IAAM,aAAeA,IAAM,cAC7BC,GAAS,YAAY,EAClB,KAAMC,GAAMA,EAAE,KAAA,CAAM,EACpB,KAAMC,GAAM,CACX,MAAMC,EAAK,MAAM,QAAQD,GAAG,KAAK,GAAKA,EAAE,MAAM,KAAME,GAAcA,CAAC,EAC/DD,MAAeA,CAAE,CACvB,CAAC,EACA,MAAM,IAAM,CAAC,CAAC,EAGnBH,GAAS,iBAAiB,EACvB,KAAMC,GAAMA,EAAE,KAAA,CAAM,EACpB,KAAMC,GAAM,CACPA,GAAK,OAAOA,EAAE,OAAU,WAC1BxB,GAAa,CAAE,MAAO,CAAC,CAACwB,EAAE,MAAO,KAAM,OAAOA,EAAE,IAAI,GAAK,IAAA,CAAM,CACnE,CAAC,EACA,MAAM,IAAM,CAAC,CAAC,CACnB,EAAG,CAAA,CAAE,EACL,MAAMG,GAAYC,EAAAA,QAAQ,IAAM,CAC9B,MAAMC,EAAOhD,GAAY,OAEnBiD,EAAU,sBAChB,GAAcA,EAAO,OAAS,EAC5B,GAAI,CAEF,MAAMC,EAAI,IAAI,IAAID,CAAM,EAIxB,MAAO,GAFQ,GADEC,EAAE,WAAa,OACH,QAAU,MAAM,MAAMA,EAAE,IAAI,GAAGA,EAAE,SAAS,SAAS,KAAK,EAAI,GAAKA,EAAE,QAAQ,GACpF,QAAQ,UAAW,EAAE,CAC3B,yBAAyBF,CAAI,EACjD,MAAY,CAAC,CAGX,MAAMG,EAAOnC,IAAW,OAAO,SAAS,SAClCoC,EAAW,CAAC,CAAClC,IAAW,MACxBmC,EAAOD,EAAWlC,IAAW,MAAQ,KAAO,KAElD,MAAO,GADOkC,EAAW,QAAU,MACpB,MAAMD,CAAI,IAAIE,CAAI,yBAAyBL,CAAI,EAChE,EAAG,CAAChD,EAAUgB,GAASE,EAAS,CAAC,EACjCqB,EAAAA,UAAU,IAAM,CAEd,aAAa,QAAQ,kBAAmB3B,EAAI,CAC9C,EAAG,CAACA,EAAI,CAAC,EAET,KAAM,CAAC0C,GAAiBC,EAAkB,EAAI1D,EAAAA,SAAwB,IAAI,EAO1E0C,EAAAA,UAAU,IAAM,CACC5B,GAAgB,SAAA,EAAW,2BAatC2C,IAAmB,KAAK,IAAA,EAAQA,GAAkB,KAClD5C,IAAyB,gBAAkBE,KAAS,SAEtDC,GAAQ,OAAO,CAEnB,EAAG,CAACH,EAAsBE,GAAM0C,EAAe,CAAC,EAMhDf,EAAAA,UAAU,IAAM,CACd,GACE,GAACR,IACAD,IACCA,KAAsB,YACtBA,KAAsB,gBAGtB7C,IAAc,OAClB,IAAIA,EAAW,CACb,IAAIuE,EAAY,GAChB,MAAMC,EAAe/C,GAAwB,UACvCgD,EAAQ,OAAO,WAAW,IAAM,CAChCF,GAAa7D,GACjBgE,EAAA,EAAQ,MAAOlD,GACb,QAAQ,KACN,sCAAsCgD,CAAY,IAClDhD,CAAA,CACF,CAEJ,EAAG,GAAG,EACN,MAAO,IAAM,CACX+C,EAAY,GACZ,OAAO,aAAaE,CAAK,CAC3B,CACF,CACAE,GAAA,EACF,EAAG,CACD3E,EACAU,EACAoC,GACAD,GACApB,EACAiD,EACAC,EAAA,CACD,EAGDrB,EAAAA,UAAU,IAAM,CACd,MAAMsB,EAAQ,SAAY,CACxB,GAAI,CAKF,GAAI,EAHDnD,IAAyB,iBACvB,CAAC4C,IAAmB,KAAK,IAAA,EAAQA,IAAmB,MACvD1C,KAAS,SACY,OACvB,MAAMxC,EAAIqB,EAAc,eAAA,EAClBX,EAAIS,EAAS,QACnB,GAAI,CAACT,GAAK,CAACV,EAAG,OACVU,EAAE,YAAcV,IAClBU,EAAE,UAAYV,GAEhBU,EAAE,MAAQ,GACTA,EAAU,YAAc,GACzB,GAAI,CACF,MAAMA,EAAE,KAAA,CACV,MAAQ,CAAC,CACTc,EAAa,EAAI,CACnB,MAAQ,CAAC,CACX,EAEAiE,EAAA,EACA,MAAM1F,EAAI,YAAY0F,EAAO,GAAG,EAChC,MAAO,IAAM,cAAc1F,CAAC,CAC9B,EAAG,CAACuC,EAAsBE,GAAMnB,EAAeA,EAAc,WAAW,CAAC,EAEzE,MAAMkE,EAAQrD,EAAAA,YAAY,SAAY,CAEpC,GAAIM,KAAS,OACX,OAAOkD,GAAA,EAKT,GAAIpD,IAAyB,gBAAkBE,KAAS,QAAS,CAC/D,MAAMxC,EAAIqB,EAAc,eAAA,EACxB,GAAIrB,GAAKmB,EAAS,QAChB,GAAI,CACFA,EAAS,QAAQ,UAAYnB,EAC7B,MAAMmB,EAAS,QAAQ,KAAA,EACvBK,EAAa,EAAI,EACjB,MACF,MAAQ,CAAC,CAGX,GAAIgB,KAAS,QACX,GAAI,CACF,MAAMmD,GAAA,EACN,MACF,MAAQ,CAAC,CAEb,CAEA,GAAI,CAEF,KAAM,CAAE,kBAAA5B,EAAmB,mBAAAD,CAAAA,EACzBvB,GAAgB,SAAA,EACZqD,EAAsC7B,EACxC,CAAE,MAAO,CAAE,SAAU,CAAE,MAAOA,CAAAA,CAAkB,EAAK,MAAO,IAC5D,CAAE,MAAO,GAAM,MAAO,EAAA,EAC1B,IAAI5B,EACJ,GAAI,CACFA,EAAS,MAAM,UAAU,aAAa,aAAayD,CAAW,CAChE,OAASvD,EAAU,CACjB,MAAMnC,GAAQmC,IAAQA,EAAI,MAAQA,EAAI,OAAU,GAChD,GACE0B,IACC7D,KAAS,wBAA0BA,KAAS,iBAE7CiC,EAAS,MAAM,UAAU,aAAa,aAAa,CACjD,MAAO,GACP,MAAO,EAAA,CACR,MAED,OAAME,CAEV,CACIlB,EAAS,UACXA,EAAS,QAAQ,UAAYgB,EAC7B,MAAMhB,EAAS,QAAQ,KAAA,EACvBK,EAAa,EAAI,EACjBS,EAAeE,EAAQ,OAAO,EAGlC,MAAQ,CAAC,CACX,EAAG,CAACK,GAAMF,EAAsBjB,EAAeY,EAAgB0D,GAAmBD,EAAmB,CAAC,EAChGF,GAAOtD,EAAAA,YAAY,IAAM,CACzBf,EAAS,SAAWA,EAAS,QAAQ,YACvBA,EAAS,QAAQ,UAA0B,UAAA,EACpD,QAASpB,GAAMA,EAAE,MAAM,EAC9BoB,EAAS,QAAQ,UAAY,KAC7BK,EAAa,EAAK,EAClBS,EAAe,IAAI,EAEvB,EAAG,CAACA,CAAc,CAAC,EAEnB,eAAeyD,IAAsB,CACnCrC,GAAmB,EAAI,EACvB,GAAI,CACF,MAAMwC,EAAU,MAAMC,GAAA,EACtB3C,GAAe0C,CAAO,EAClBA,EAAQ,SAAW,GACrB,MACE,oHAAA,CAGN,OAASE,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,EACpD,MACE,wEAAA,CAEJ,QAAA,CACE1C,GAAmB,EAAK,CAC1B,CACF,CAEA,eAAe2C,GAAoBC,EAAuB,CACxD,GAAI,CACF9C,GAAgB0C,GACdA,EAAQ,IAAKK,GACXA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,cAA0BA,CAAA,CACjE,EAGF,MAAM/D,EAAS,MAAMgE,GAAuBF,CAAM,EAClD,GAAI9D,GAAUhB,EAAS,QACrBA,EAAS,QAAQ,UAAYgB,EAC7B,MAAMhB,EAAS,QAAQ,KAAA,EACvBK,EAAa,EAAI,EACjBS,EAAeE,EAAQ,MAAM,EAC7BgB,GAAgB0C,GACdA,EAAQ,IAAKK,GACXA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,UAAsBA,CAAA,CAC7D,MAGF,OAAM,IAAI,MAAM,4BAA4B,CAEhD,OAASH,EAAO,CACd,QAAQ,MAAM,oCAAqCA,CAAK,EACxD,MACE,wBAAwBE,EAAO,IAAI,0CAAA,EAErC9C,GAAgB0C,GACdA,EAAQ,IAAKK,GACXA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,WAAuBA,CAAA,CAC9D,CAEJ,CACF,CAEA,eAAeE,GAAqB,CAClC3C,GAAkB,EAAI,EACtB,GAAI,CAEF,MAAMoC,EAAU,MAAMQ,GAAA,EACtB9C,GAAcsC,CAAO,EAGrB,MAAMS,EAAY,MAAMC,GAAA,EACpBD,GACF/C,GAAeiD,GAAS,CAAC,GAAGA,EAAMF,CAAS,CAAC,EAG1CT,EAAQ,SAAW,GAAK,CAACS,GAC3B,MACE,sEAAA,CAGN,OAASP,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,EACnD,MAAM,kEAAkE,CAC1E,QAAA,CACEtC,GAAkB,EAAK,CACzB,CACF,CAEA,eAAegD,GAAmBR,EAAmB,CACnD,GAAI,CACF1C,GAAesC,GACbA,EAAQ,IAAKK,GACXA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,cAA0BA,CAAA,CACjE,EAEF,MAAM/D,EAAS,MAAMuE,GAAmBT,CAAM,EAC9C,GAAI9D,GAAUhB,EAAS,QACrBA,EAAS,QAAQ,UAAYgB,EAC7B,MAAMhB,EAAS,QAAQ,KAAA,EACvBK,EAAa,EAAI,EACjBiB,GAAQ,MAAM,EACdR,EAAeE,EAAQ,MAAM,EAC7BoB,GAAesC,GACbA,EAAQ,IAAKK,GACXA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,UAAsBA,CAAA,CAC7D,MAGF,OAAM,IAAI,MAAM,4BAA4B,CAEhD,OAASH,EAAO,CACd,QAAQ,MAAM,mCAAoCA,CAAK,EACvD,MACE,wBAAwBE,EAAO,IAAI,0CAAA,EAErC1C,GAAesC,GACbA,EAAQ,IAAKK,GACXA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,WAAuBA,CAAA,CAC9D,CAEJ,CACF,CAGA,MAAMS,GAAmBzE,EAAAA,YACtB0E,GAAgD,CAC/C,GAAI,CACFnE,GAAQmE,IAAY,MAAQ,OAASA,CAAO,EAC5CzB,GAAmB,KAAK,KAAK,EAE7B,GAAI,CACF,GAAIyB,IAAY,QAAS,CACvB,GAAI,CACF9C,EAAmBC,GAAmB,QAAS,EAAI,CACrD,MAAQ,CAAC,CACT,GAAI,CACFH,EAAyB,EAAI,CAC/B,MAAQ,CAAC,CACX,SAAWgD,IAAY,QAAS,CAC9B,GAAI,CACF9C,EAAmB,OAAW,eAAgB,EAAI,CACpD,MAAQ,CAAC,CACT,GAAI,CACFF,EAAyB,EAAI,CAC/B,MAAQ,CAAC,CACX,SAAWgD,IAAY,QAAUA,IAAY,MAAO,CAClD,GAAI,CACF9C,EAAmB,OAAW,WAAY,EAAI,CAChD,MAAQ,CAAC,CACT,GAAI,CACFF,EAAyB,EAAI,CAC/B,MAAQ,CAAC,CACX,CACF,MAAQ,CAAC,CACLgD,IAAY,QACdrB,EAAA,EAAQ,MAAM,IAAM,CAAC,CAAC,EACbqB,IAAY,QACrBjB,GAAA,EACSiB,IAAY,OACrBlB,GAAA,EACSkB,IAAY,OACrBR,EAAA,CAEJ,OAAS/D,EAAK,CACZ,QAAQ,KAAK,uCAAwCA,CAAG,CAC1D,CACF,EACA,CACEkD,EACAI,GACAD,GACAU,EACAtC,EACAF,EACAG,EAAA,CACF,EAGFI,EAAAA,UAAU,IAAM,CACd,MAAM0C,EAAWC,GAAY,CAC3B,GAAI,CACF,MAAMC,EAAgBD,GAAMA,EAAG,QAAUA,EAAG,OAAO,KAEjDC,GACA,CAAC,QAAS,QAAS,OAAQ,KAAK,EAAE,SAASA,CAAa,GAGxDJ,GAAiBI,CAAa,EAE9BxB,EAAA,EAAQ,MAAM,IAAM,CAAC,CAAC,GAGtBA,EAAA,EAAQ,MAAM,IAAM,CAAC,CAAC,CAE1B,MAAQ,CAAC,CACX,EACA,cAAO,iBAAiB,mBAA2BsB,CAAc,EAC1D,IAAM,CACX,OAAO,oBAAoB,mBAA2BA,CAAc,CACtE,CACF,EAAG,CAACtB,EAAOoB,EAAgB,CAAC,EAG5B,SAASK,IAAW,CAClB,GAAItF,GAAMA,EAAG,aAAe,UAAU,KAAM,OAAOA,EACnD,MAAMmD,EAAU,sBACVoC,EACMpC,EAAO,OAAS,EACtBA,EAAO,SAAS,KAAK,EACnBA,EACAA,EAAO,QAAQ,MAAO,EAAE,EAAI,MAC9B,OACAqC,EAAQ,OAAO,SAAS,WAAa,SAAW,MAAQ,KACxDC,EAAa,GAAGD,CAAK,MAAM,OAAO,SAAS,IAAI,MAC/CnC,EAAO,OAAO,SAAS,SACvBqC,GAAcrC,IAAS,aAAeA,IAAS,YAC/CsC,EAAetC,EAAK,SAAS,cAAc,EAE3CuC,GAAW,uCACjB,IAAIC,GAAMN,EACLM,KACCH,GACFG,GAAM,GAAGL,CAAK,MAAMnC,CAAI,WACfsC,EACTE,GAAMJ,EAENI,GAAMD,IAILC,KAAKA,GAAMJ,GAChB,MAAMK,GAAS,IAAI,UAAUD,EAAG,EAChC,OAAA5F,EAAM6F,EAAM,EACLA,EACT,CACA,eAAe7B,IAAoB,CACjClD,GAAQ,OAAO,EACfE,GAAU,EAAK,EACf,MAAM6E,EAASR,GAAA,EACXQ,EAAO,aAAe,UAAU,KAClCA,EAAO,KAAK,KAAK,UAAU,CAAE,KAAM,YAAA,CAAc,CAAC,EAElDA,EAAO,OAAS,IAAMA,EAAO,KAAK,KAAK,UAAU,CAAE,KAAM,YAAA,CAAc,CAAC,EAE1EA,EAAO,UAAY,MAAOV,GAAO,CAC/B,MAAMW,EAAO,KAAK,MAAMX,EAAG,IAAI,EAC/B,GAAIW,EAAK,OAAS,WAChB5F,EAAY4F,EAAK,IAAI,EACjBA,EAAK,WAAW/E,GAAa+E,EAAK,SAAS,UACtCA,EAAK,OAAS,kBAAmB,CAC1C9E,GAAU,EAAI,EAEd,MAAM+E,EAAO,IAAI,kBAAkB,CACjC,WAAY,CAAC,CAAE,KAAM,+BAAgC,CAAA,CACtD,EACD3F,EAAM2F,CAAI,EACVA,EAAK,eAAkBC,IAAM,CACvBA,GAAE,WAAa/F,GACjB4F,EAAO,KACL,KAAK,UAAU,CACb,KAAM,UACN,KAAM5F,EACN,QAAS+F,GAAE,SAAA,CACZ,CAAA,CAEP,EACAD,EAAK,QAAWZ,IAAO,CACrB,GAAI3F,EAAS,QAAS,CACpB,MAAMyG,EAAUd,GAAG,UAAU,CAAC,EAC1Bc,IACFzG,EAAS,QAAQ,UAAYyG,EAC7BzG,EAAS,QAAQ,KAAA,EAAO,MAAM,IAAM,CAAC,CAAC,EACtCK,EAAa,EAAI,EAErB,CACF,EACA,MAAMqG,EAAQ,MAAMH,EAAK,YAAY,CACnC,oBAAqB,GACrB,oBAAqB,EAAA,CACtB,EACD,MAAMA,EAAK,oBAAoBG,CAAK,EAChCjG,GACF4F,EAAO,KACL,KAAK,UAAU,CACb,KAAM,YACN,KAAM5F,EACN,QAASiG,CAAA,CACV,CAAA,CAEP,SAAWJ,EAAK,OAAS,aACnB3F,GACF,MAAMA,EAAG,qBACP,IAAI,sBAAsB2F,EAAK,OAAO,CAAA,UAEjCA,EAAK,OAAS,WACnB3F,EACF,GAAI,CACF,MAAMA,EAAG,gBAAgB2F,EAAK,OAAO,CACvC,MAAQ,CAAC,CAEf,CACF,CACA,SAASK,IAAiB,CACxBjG,EAAY,IAAI,EAChBa,GAAa,IAAI,EACjBC,GAAU,EAAK,EACXjB,GAAMA,EAAG,aAAe,UAAU,KACpCA,EAAG,KAAK,KAAK,UAAU,CAAE,KAAM,YAAA,CAAc,CAAC,EAE9CiE,GAAA,EAEF,GAAI,CACF/B,EAAyB,EAAI,CAC/B,MAAQ,CAAC,CACX,CAEA,SAASmE,IAAU,CAKjB,GAJAvC,GAAA,EACA3D,EAAY,IAAI,EAChBc,GAAU,EAAK,EACfD,GAAa,IAAI,EACbZ,EAAI,CACN,GAAI,CACFA,EAAG,MAAA,CACL,MAAQ,CAAC,CACTC,EAAM,IAAI,CACZ,CACF,CACA,OACEmC,EAAAA,IAAC8D,GAAA,CACC,MAAApH,EACA,UAAAC,EACA,MAAA0E,EACA,QAAAwC,GACA,kBAAApC,GACA,oBAAAD,GACA,mBAAAU,EACA,oBAAAJ,GACA,mBAAAS,GACA,SAAAtF,EACA,UAAAI,EACA,KAAAiB,GACA,QAAAC,GACA,SAAAb,EACA,UAAA8C,GACA,eAAAoD,GACA,UAAAhF,GACA,SAAAE,EACA,YAAAC,GACA,YAAAC,EACA,WAAAI,EACA,gBAAAF,EACA,eAAAI,GACA,cAAA1C,EACA,UAAAC,EACA,OAAAC,EACA,MAAAC,EACA,KAAAC,EACA,aAAcyF,GACd,sBAAA9C,CAAA,CAAA,CAGN,CAEA,SAASmE,GAAYC,EAAY,CAC/B,MAAM5G,EAAgBC,GAAA,EAChB,CAAE,YAAA4G,EAAa,aAAcC,CAAA,EAAiB5F,GAAA,EAC9C,CACJ,MAAA3B,EACA,MAAA2E,EACA,QAAAwC,EACA,kBAAApC,EACA,oBAAAD,EACA,mBAAAU,EACA,oBAAAJ,EACA,mBAAAS,EACA,SAAAtF,EACA,UAAAI,EACA,KAAAiB,EACA,QAAAC,EACA,aAAA2F,EACA,SAAAxG,GACA,UAAA8C,EACA,eAAAoD,EACA,UAAAhF,GACA,SAAAE,GACA,YAAAC,GACA,YAAAC,GACA,WAAAI,GACA,gBAAAF,GACA,eAAAI,GACA,UAAAzC,GACA,OAAAC,EACA,MAAAC,GACA,KAAAC,EACA,sBAAA2C,EAAA,EACEoE,EAEEI,EAA0C,CAC9C,MAAO,QACP,MAAO,WACP,KAAM,WAAA,EAGFC,GAAmB3D,EAAAA,QAAQ,IACxB,CACL,CACE,GAAI,QACJ,MAAO,eACP,YAAa,0CACb,OAAQ,IAAM,CACRyD,KAA2B,OAAO,CACxC,CAAA,EAEF,CACE,GAAI,QACJ,MAAO,WACP,YAAa,8CACb,OAAQ,IAAM,CACRA,KAA2B,OAAO,CACxC,CAAA,EAEF,CACE,GAAI,OACJ,MAAO,YACP,YAAa,oDACb,OAAQ,IAAM,CACRA,KAA2B,MAAM,CACvC,CAAA,EAEF,CACE,GAAI,MACJ,MAAO,MACP,YAAa,yDACb,OAAQ,IAAM,CACRA,KAA2B,KAAK,CACtC,CAAA,CACF,EAED,CACD3F,EACA8C,EACAI,EACAD,EACAU,CAAA,CACD,EAEK,CAACmC,EAAcC,EAAe,EAAI/G,EAAAA,SACtC,IAAA,EAEIgH,GAAiBrH,EAAAA,OAAsB,IAAI,EAEjD+C,EAAAA,UAAU,IACD,IAAM,CACPsE,GAAe,SAAS,OAAO,aAAaA,GAAe,OAAO,CACxE,EACC,CAAA,CAAE,EAIL,KAAM,CAAE,cAAeC,EAAA,EAAkBnG,GAAA,EACnCoG,GAAmCzH,EACrC,OACAwH,IAAiB,OAEfE,IAAS,IAAM,CACnB,MAAMC,EAAM,OAAOZ,EAAM,eAAiBC,GAAe,CAAC,EACpDY,GAAU,KAAK,IAAI,GAAK,KAAK,IAAI,KAAMD,CAAG,CAAC,EACjD,OAAOF,KAAqB,OAAS,KAAK,IAAI,EAAGG,EAAO,EAAIA,EAC9D,GAAA,EACMC,EACJ7H,GAAQyH,KAAqB,OACzB,OACA3H,GAAUA,IAAW,UACnBA,EACCmH,GAAwB,OAE3Ba,EAAuBD,IAAiB,OACxCE,EAAcD,EAChBD,IAAiB,SACf,gBACAA,IAAiB,WACf,eACAA,IAAiB,UACf,eACA,eACN,GAKEG,GAAiB,CAHDhI,EAClB,wGACA,gHACmCH,EAAS,EAC7C,OAAO,OAAO,EACd,KAAK,GAAG,EACR,KAAA,EACGoI,GAAgC,CAAE,GAAIlI,IAAS,EAAC,EAEhDmI,GAAgBlI,EAClB,yCACA,2BAEEmI,EAAmB,CACvB,MAAO,CAAE,UAAW,SAAST,EAAK,IAAK,gBAAiB,QAAA,CAAkB,EAGtEU,GACJ9G,IAAS,QAAUc,GAAW,KAAM4C,GAAiBA,EAAE,SAAW,QAAQ,EAEtEqD,IAAgB,IAAM,CAG1B,MAAMC,GADQb,KAAqB,MAG/B,6EAEA,2EACJ,OAAIzH,EACE8H,EAEA9E,EAAAA,IAAC,MAAA,CAAI,UAAU,oDACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAW,yCAAyC+E,CAAW,GAE/D,SAAA/E,EAAAA,IAAC,QAAA,CACC,IAAK/C,EACL,UAAWqI,GACV,GAAGH,CAAA,CAAA,CACN,CAAA,EAEJ,EAIFnF,EAAAA,IAAC,QAAA,CACC,IAAK/C,EACL,UAAWqI,GACV,GAAGH,CAAA,CAAA,EAINL,QAEC,MAAA,CAAI,UAAW,mBAAmBC,CAAW,GAC5C,SAAA/E,EAAAA,IAAC,QAAA,CACC,IAAK/C,EACL,UAAWqI,GACV,GAAGH,CAAA,CAAA,EAER,EAIFnF,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACb,SAAAA,EAAAA,IAAC,QAAA,CACC,IAAK/C,EACL,UAAWqI,GACV,GAAGH,CAAA,CAAA,EAER,CAEJ,GAAA,EAEA,eAAeI,GACbC,EACAC,GACA,CACA,GAAKD,EACL,GAAI,CACF,GAAI,UAAU,WAAa,UAAU,UAAU,UAC7C,MAAM,UAAU,UAAU,UAAUA,CAAK,MACpC,CACL,MAAME,GAAW,SAAS,cAAc,UAAU,EAClDA,GAAS,MAAQF,EACjBE,GAAS,MAAM,SAAW,QAC1BA,GAAS,MAAM,QAAU,IACzB,SAAS,KAAK,YAAYA,EAAQ,EAClCA,GAAS,MAAA,EACTA,GAAS,OAAA,EACT,SAAS,YAAY,MAAM,EAC3B,SAAS,KAAK,YAAYA,EAAQ,CACpC,CACApB,GAAgBmB,EAAI,EAChBlB,GAAe,SAAS,OAAO,aAAaA,GAAe,OAAO,EACtEA,GAAe,QAAU,OAAO,WAC9B,IAAMD,GAAgB,IAAI,EAC1B,IAAA,CAEJ,OAASnG,GAAK,CACZ,QAAQ,KAAK,4BAA6BA,EAAG,EAC7CmG,GAAgB,IAAI,CACtB,CACF,CAEA,cACG,MAAA,CAAI,UAAWU,GAAgB,MAAOC,GACrC,SAAA,CAAAU,EAAAA,KAAC,MAAA,CAAI,UAAWT,GACb,SAAA,CAAAG,GACAlI,EAAc,aAAemB,IAAS,gBACpC,MAAA,CAAI,UAAU,gLACb,SAAA,CAAA0B,EAAAA,IAAC,OAAA,CAAK,UAAU,kEAAkE,EAClFA,EAAAA,IAAC,QAAK,SAAA,MAAG,CAAA,EACX,CAAA,EAEJ,EACA2F,EAAAA,KAAC,MAAA,CAAI,UAAU,qJACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,uBACb,SAAA,CAAAjJ,IACEW,EACGiB,IAAS,QACP,aACAA,IAAS,OACP,YACA,OACJ,UACLqB,UACE,OAAA,CAAK,UAAU,0BAA0B,SAAA,KAAE,CAAA,EAEhD,EACAgG,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAA,CAACtI,GACAsI,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAA5F,EAAAA,IAAC,SAAA,CACC,UAAW,6DAA6D1B,IAAS,QAAU,4BAA8B,gDAAgD,GACzK,QAAS,IAAM4F,EAAa,OAAO,EACpC,SAAA,OAAA,CAAA,EAGDlE,EAAAA,IAAC,SAAA,CACC,UAAW,6DAA6D1B,IAAS,QAAU,4BAA8B,gDAAgD,GACzK,QAAS,IAAM4F,EAAa,OAAO,EACpC,SAAA,OAAA,CAAA,EAGDlE,EAAAA,IAAC,SAAA,CACC,UAAW,6DAA6D1B,IAAS,OAAS,4BAA8B,gDAAgD,GACxK,QAAS,IAAM4F,EAAa,MAAM,EACnC,SAAA,MAAA,CAAA,EAGDlE,EAAAA,IAAC,SAAA,CACC,UAAW,6DAA6D1B,IAAS,OAAS,4BAA8B,gDAAgD,GACxK,QAAS,IAAM4F,EAAa,KAAK,EAClC,SAAA,KAAA,CAAA,CAED,EACF,EAED7G,EACC2C,EAAAA,IAAC,SAAA,CACC,UAAU,qGACV,QAAS6D,EACV,SAAA,MAAA,CAAA,EAGC,IAAA,EACN,CAAA,EACF,EACCvF,IAAS,SAAWZ,IAAY,CAACL,UAC/B,MAAA,CAAI,UAAU,yCACb,SAAA,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,yBAAsB,EAC1DsI,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,UAAU,iIACV,QAAS,IAAMJ,GAAU/E,EAAW,MAAM,EAC1C,MAAM,0BAEN,SAAA,OAAC,OAAA,CAAK,UAAU,qCACb,SAAAA,EACH,QACC,OAAA,CAAK,UAAU,wEACb,SAAA6D,IAAiB,OAAS,UAAY,MAAA,CACzC,CAAA,CAAA,CAAA,EAEFsB,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAA3F,EAAAA,IAAC,IAAA,CACC,KAAMQ,EACN,OAAO,SACP,IAAI,aACJ,UAAU,kGACX,SAAA,WAAA,CAAA,EAGDmF,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,UAAU,4IACV,QAAS,IAAMJ,GAAU7H,GAAU,MAAM,EACzC,MAAM,oBAEN,SAAA,OAAC,OAAA,CAAK,UAAU,qCACb,SAAAA,GACH,QACC,OAAA,CAAK,UAAU,wEACb,SAAA2G,IAAiB,OAAS,UAAY,MAAA,CACzC,CAAA,CAAA,CAAA,CACF,EACF,EACArE,EAAAA,IAAC,MAAA,CAAI,UAAU,+BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAAS4D,EACV,SAAA,YAAA,CAAA,EAGH,EACC9E,IACC6G,EAAAA,KAAC,MAAA,CAAI,UAAU,6EACb,SAAA,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,kBAAe,EACnDA,EAAAA,KAAC,KAAA,CAAG,UAAU,2BACZ,SAAA,CAAA3F,EAAAA,IAAC,MAAG,SAAA,uDAAoD,SACvD,KAAA,CAAG,SAAA,CAAA,yDACqD,IACtDpB,IAAW,MAAQA,GAAU,KAAO,KAAK,IAAA,EAC5C,EACAoB,EAAAA,IAAC,MAAG,SAAA,kEAGJ,CAAA,EACF,EACAA,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAAS,IAAMjB,GAAY,EAAK,EACjC,SAAA,WAAA,CAAA,EAGH,CAAA,EACF,CAAA,EAEJ,EAEDT,IAAS,QAAU,CAACjB,UAClB,MAAA,CAAI,UAAU,yCACb,SAAA,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,kBAAe,EAGnDsI,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,MAAA,CAAI,UAAU,mBAAmB,SAAA,eAAY,EAC7CzG,GACCyG,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,4DAA4D,EAC3EA,EAAAA,IAAC,QAAK,SAAA,sBAAmB,CAAA,EAC3B,EACEhB,GAAY,OAAS,EACvB2G,OAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAA3G,GAAY,IAAK+C,GAChB4D,EAAAA,KAAC,MAAA,CAEC,UAAU,gEAEV,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,uBAAwB,SAAA+B,EAAO,KAAK,EACnD4D,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACZ,SAAA,CAAA5D,EAAO,GAAG,IAAEA,EAAO,IAAA,EACtB,CAAA,EACF,EACA/B,EAAAA,IAAC,SAAA,CACC,UAAW,kCACT+B,EAAO,SAAW,aACd,gBACAA,EAAO,SAAW,SAChB,eACA,aACR,GACA,QAAS,IAAMD,EAAoBC,CAAM,EACzC,SAAUA,EAAO,SAAW,aAE3B,SAAAA,EAAO,SAAW,aAAe,MAAQ,SAAA,CAAA,CAC5C,CAAA,EArBKA,EAAO,EAAA,CAuBf,EACD/B,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,8CACV,QAASwB,EACV,SAAA,aAAA,CAAA,EAGH,CAAA,CAAA,CACF,EAEAmE,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,OAAC,MAAA,CAAI,UAAU,kBAAkB,SAAA,wBAAqB,EACtD3F,EAAAA,IAAC,SAAA,CACC,UAAU,8CACV,QAASwB,EACV,SAAA,WAAA,CAAA,CAED,EACF,CAAA,EAEJ,SAGC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,mBAAmB,SAAA,cAAW,EAC5ClC,GACCqG,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,4DAA4D,EAC3EA,EAAAA,IAAC,QAAK,SAAA,kBAAe,CAAA,EACvB,EACEZ,GAAW,OAAS,EACtBuG,OAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAAvG,GAAW,IAAK2C,GACf4D,EAAAA,KAAC,MAAA,CAEC,UAAU,gEAEV,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,uBAAwB,SAAA+B,EAAO,KAAK,QAClD,MAAA,CAAI,UAAU,wBACZ,SAAAA,EAAO,KAAK,aAAY,CAC3B,CAAA,EACF,EACA/B,EAAAA,IAAC,SAAA,CACC,UAAW,kCACT+B,EAAO,SAAW,aACd,gBACAA,EAAO,SAAW,SAChB,eACA,aACR,GACA,QAAS,IAAMQ,EAAmBR,CAAM,EACxC,SAAUA,EAAO,SAAW,aAE3B,SAAAA,EAAO,SAAW,aAAe,MAAQ,SAAA,CAAA,CAC5C,CAAA,EArBKA,EAAO,EAAA,CAuBf,EACD/B,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,8CACV,QAASkC,EACV,SAAA,YAAA,CAAA,EAGH,CAAA,CAAA,CACF,EAEAyD,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,OAAC,MAAA,CAAI,UAAU,kBAAkB,SAAA,uBAAoB,EACrD3F,EAAAA,IAAC,SAAA,CACC,UAAU,8CACV,QAASkC,EACV,SAAA,UAAA,CAAA,CAED,EACF,CAAA,EAEJ,CAAA,EACF,EAED,CAAC7E,GACAsI,EAAAA,KAAC,MAAA,CAAI,UAAU,iFACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,qDAAqD,SAAA,eAEpE,QACC,MAAA,CAAI,UAAU,uCAAuC,SAAA,mBAEtD,CAAA,EACF,EACAA,EAAAA,KAAC,OAAA,CAAK,UAAU,yBAAyB,SAAA,CAAA,YAC7BxB,EAAgB7F,CAAI,GAAK,OAAA,EACrC,CAAA,EACF,QACC,IAAA,CAAE,UAAU,8BAA8B,SAAA,mDAE3C,QACC,MAAA,CAAI,UAAU,yBACZ,SAAA8F,GAAiB,IAAKyB,GAAW,CAChC,MAAMC,GACJD,EAAO,KAAO,MAAQT,GAAYS,EAAO,KAAOvH,EAClD,OACEqH,EAAAA,KAAC,SAAA,CAEC,KAAK,SACL,QAASE,EAAO,OAChB,UAAW,oCAAoCC,GAAW,0CAA4C,gDAAgD,cAEtJ,SAAA,CAAA9F,EAAAA,IAAC,MAAA,CAAI,UAAU,+DACZ,SAAA6F,EAAO,MACV,EACA7F,EAAAA,IAAC,MAAA,CAAI,UAAU,kCACZ,WAAO,YACV,EACC8F,UACE,MAAA,CAAI,UAAU,oCAAoC,SAAA,SAEnD,CAAA,CAAA,EAdGD,EAAO,EAAA,CAkBlB,CAAC,EACH,CAAA,EACF,CAAA,EAEJ,CAEJ,CC1vCA,SAASE,GAAiBC,EAAYC,EAAY7F,EAAW8F,EAAkB,CAC7E,MAAMC,GAAMD,EAAW,IAAM,KAAK,GAAM,IACxC,MAAO,CAAE,EAAGF,EAAK5F,EAAI,KAAK,IAAI+F,CAAC,EAAG,EAAGF,EAAK7F,EAAI,KAAK,IAAI+F,CAAC,CAAA,CAC1D,CAEA,SAASC,GAAYC,EAAgB,CAOnC,MALoB,CAClB,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,CAAA,EAE9C,QAAQA,CAAM,EACpB,GAAK,CAEzB,CAEA,SAAwBC,GAAQ,CAC9B,MAAAC,EAAQ,IACR,OAAAC,EAAS,GACX,EAGG,CACD,MAAMC,EAAUC,GAAiB5K,GAAMA,EAAE,OAAO,EAC1C6K,EAAMzJ,EAAAA,OAAiC,IAAI,EAEjD+C,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAM2G,EAAID,EAAI,QACd,GAAI,CAACC,EAAG,OACR,MAAMC,EAAMD,EAAE,WAAW,IAAI,EAC7B,GAAI,CAACC,EAAK,OACVD,EAAE,MAAQL,EACVK,EAAE,OAASJ,EACXK,EAAI,UAAU,EAAG,EAAGN,EAAOC,CAAM,EAEjC,MAAMR,EAAKO,EAAQ,EACbN,EAAKO,EAAS,EACd9B,EAAQ,KAAK,IAAI6B,EAAOC,CAAM,GAAKM,GAAW,YAAc,EAAI,IAChEC,EAAQ,CACZ,UAAWD,GAAW,UAAYpC,EAClC,UAAWoC,GAAW,UAAYpC,EAClC,YAAaoC,GAAW,YAAcpC,EACtC,YAAaoC,GAAW,YAAcpC,EACtC,YAAaoC,GAAW,YAAcpC,EACtC,YAAaoC,GAAW,YAAcpC,CAAA,EAGxCmC,EAAI,YAAc,yBAClBA,EAAI,UAAY,EAChB,MAAMG,EAAY,CAChB,cACA,cACA,cACA,cACA,YACA,WAAA,EAEF,UAAWC,KAAKD,EACdH,EAAI,UAAA,EACJA,EAAI,IAAIb,EAAIC,EAAKc,EAAcE,CAAC,EAAG,EAAG,KAAK,GAAK,CAAC,EACjDJ,EAAI,OAAA,EAIN,MAAMK,EAAgD,CAAA,EACtD,UAAWpL,KAAK2K,EAAS,CAEvB,IAAIU,EAAQ,KAAK,OAAA,EAAW,IACxB/G,EAAI,KAAK,OAAA,EAAW2G,EAAM,YAC1B,OAAOjL,EAAE,QAAW,UAAYA,EAAE,QAAU,GAAKA,EAAE,QAAU,KAC/DqL,EAAQf,GAAYtK,EAAE,MAAM,EAExBA,EAAE,OAAS,SACbsE,GAAK2G,EAAM,YAAcA,EAAM,aAAe,EACvCjL,EAAE,OAAS,SAClBsE,GAAK2G,EAAM,YAAcA,EAAM,aAAe,EACvCjL,EAAE,OAAS,aAAcsE,EAAI2G,EAAM,UAAY,GAC/CjL,EAAE,OAAS,OAAQsE,EAAI2G,EAAM,UAAY,GAEhD3G,GACI2G,EAAM,YAAcA,EAAM,aAAe,GAC1C,GAAM,KAAK,SAAW,KAE7B,MAAMK,EAAIrB,GAAiBC,EAAIC,EAAI7F,EAAG+G,CAAK,EAC3CD,EAAO,KAAK,CAAE,EAAGE,EAAE,EAAG,EAAGA,EAAE,EAAG,EAAG,CAAA,CAAG,CACtC,CAGA,UAAWA,KAAKF,EAAQ,CACtB,MAAMG,EAAMR,EAAI,qBAAqBO,EAAE,EAAGA,EAAE,EAAG,EAAGA,EAAE,EAAGA,EAAE,EAAG,EAAE,EAC9DC,EAAI,aAAa,EAAG,mBAAmB,EACvCA,EAAI,aAAa,GAAK,qBAAqB,EAC3CA,EAAI,aAAa,EAAG,mBAAmB,EACvCR,EAAI,UAAYQ,EAChBR,EAAI,UAAA,EACJA,EAAI,IAAIO,EAAE,EAAGA,EAAE,EAAG,GAAI,EAAG,KAAK,GAAK,CAAC,EACpCP,EAAI,KAAA,CACN,CAGAA,EAAI,UAAY,yBAChBA,EAAI,KAAO,qBAEX,MAAMS,EAAuC,CAAA,EAC7C,UAAWxL,KAAK2K,EACV3K,EAAE,SAAQwL,EAAaxL,EAAE,MAAM,GAAKwL,EAAaxL,EAAE,MAAM,GAAK,GAAK,GACzE,UAAWyL,KAAU,OAAO,KAAKD,CAAY,EAAG,CAC9C,MAAME,EAAM,OAAOD,CAAM,EACnBpB,EAAIC,GAAYoB,CAAG,EACnBC,EAAM1B,GAAiBC,EAAIC,EAAIc,EAAM,YAAc,GAAIZ,CAAC,EAC9DU,EAAI,SAAS,OAAOS,EAAaE,CAAG,CAAC,EAAGC,EAAI,EAAI,EAAGA,EAAI,EAAI,CAAC,CAC9D,CACF,EAAG,CAAChB,EAASF,EAAOC,CAAM,CAAC,EAGzBxG,EAAAA,IAAC,SAAA,CACC,IAAA2G,EACA,MAAO,CACL,MAAO,OACP,OAAQ,OACR,aAAc,EACd,WAAY,SAAA,CACd,CAAA,CAGN,CClHO,MAAMe,GAIP,CACJ,GAAG,MAAM,KAAK,CAAE,OAAQ,IAAM,CAACC,EAAG,KAAO,CACvC,MAAO,IAAI,EAAI,CAAC,GAChB,OAAQ,EAAI,GAAK,CAAA,EACjB,EACF,CAAE,MAAO,QAAS,MAAO,GAAI,OAAQ,EAAA,CACvC,EAEO,SAASC,GAAYpC,EAAeqC,EAA4B,CACrE,MAAMhM,EAAI6L,GAAsBG,CAAS,EACzC,MAAO,CAAC,CAAChM,GAAK2J,IAAU3J,EAAE,KAC5B,CAEO,SAASiM,GAAgBC,EAA8B,CAC5D,MAAMlM,EAAIkM,EAAM,KAAA,EAAO,YAAA,EACvB,GAAI,CAAClM,EAAG,OAAO,KACf,GAAIA,IAAM,MAAQA,IAAM,QAAUA,IAAM,SAAWA,IAAM,QAAS,MAAO,IACzE,GAAIA,IAAM,MAAQA,IAAM,QAAS,MAAO,IACxC,MAAMmM,EAAInM,EAAE,MAAM,wBAAwB,EAC1C,GAAI,CAACmM,EAAG,OAAO,KACf,MAAMC,EAAQD,EAAE,CAAC,GAAK,IAChBE,EAAM,SAASF,EAAE,CAAC,EAAG,EAAE,EAC7B,OAAIE,EAAM,GAAKA,EAAM,GAAW,KAEzBA,GADSD,IAAS,IAAM,EAAIA,IAAS,IAAM,EAAI,EAExD,CCtCO,MAAME,GAAsB,CACjC,GAAG,MAAM,KAAK,CAAE,OAAQ,IAAM,CAACR,EAAG,IAAM,EAAI,CAAC,EAC7C,GACA,EACF,ECCaS,GAAmC,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAEpE,SAASC,IAAmC,CACjD,MAAMC,EAAa,CAAA,EACnB,OAAAF,GAAgB,QAASG,GAAM,CAC7BD,EAAMC,CAAC,EAAI,CACb,CAAC,EACM,CAAE,MAAAD,EAAO,OAAQ,CAAA,CAC1B,CAIO,SAASE,GACdC,EACAjD,EACAkD,EACArC,EACAsC,EAAgD,IAAM,GAC9C,CAER,IAAIT,EAA4B,KAC5BU,EAAO,EACX,GACEF,IAAS,QACTA,IAAS,cACTlD,IAAU,IACVA,IAAU,GAEV0C,EAAM,GACNU,EAAOF,IAAS,cAAgBlD,IAAU,GAAK,EAAI,UAEnD,OAAOa,GAAW,UACjBA,GAAqB,IACrBA,GAAqB,GAEtB6B,EAAM7B,EACFqC,IAAS,SAAUE,EAAO,EACrBF,IAAS,SAAUE,EAAO,EAC9BA,EAAO,UACHpD,EAAO,CAEhB,MAAMqD,EAAwB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EACrD,UAAWjC,KAAKiC,EAAM,CACpB,GAAIrD,IAAUoB,EAAG,CACfsB,EAAMtB,EACNgC,EAAO,EACP,KACF,CACA,GAAIpD,IAAUoB,EAAI,EAAG,CACnBsB,EAAMtB,EACNgC,EAAO,EACP,KACF,CACA,GAAIpD,IAAUoB,EAAI,EAAG,CACnBsB,EAAMtB,EACNgC,EAAO,EACP,KACF,CACF,CACI,CAACV,IAAQ1C,IAAU,IAAMA,IAAU,MACrC0C,EAAM,GACNU,EAAOpD,IAAU,GAAK,EAAI,EAE9B,CACA,GAAI,CAAC0C,EAAK,MAAO,GAEjB,MAAMY,EAASL,EAAM,MAAMP,CAAG,EACxBa,EAAgB,KAAK,IAAI,EAAG,EAAID,CAAM,EACtCE,EAAU,KAAK,IAAID,EAAeH,CAAI,EACtCK,EAAW,KAAK,IAAI,EAAGL,EAAOI,CAAO,EAErCE,EAASJ,EAASE,EACxBP,EAAM,MAAMP,CAAG,EAAIgB,EAAQ,EAAI,EAAIA,EAGnC,IAAIhC,EAAS,EACb,OAAI+B,EAAW,GAAK,CAACN,EAAeT,CAAG,IACjCA,IAAQ,GAENQ,IAAS,aAAcxB,GAAU,GAAK+B,KAC3B,GAAKA,EAEpB/B,GAAUgB,EAAMe,GAIpBR,EAAM,QAAUvB,EACTA,CACT,CAEO,SAASiC,GAAaV,EAA8B,CACzD,OAAOL,GAAgB,MAAOG,IAAOE,EAAM,MAAMF,CAAC,GAAK,IAAM,CAAC,CAChE,CCxEO,SAASa,IAAqC,CACnD,MAAO,CACL,MAAO,EACP,MAAO,EACP,SAAU,GACV,iBAAkB,GAClB,SAAU,CAAE,QAAS,EAAG,QAAS,EAAG,QAAS,CAAA,CAAE,CAEnD,CAEO,SAASC,GAAeZ,EAA8B,CAC3D,OAAOA,EAAM,KACf,CAGO,SAASa,GACdb,EACAjD,EACAkD,EACArC,EACQ,CACR,GAAIoC,EAAM,SAAU,MAAO,GAC3B,MAAM9M,EAAS0N,GAAeZ,CAAK,EACnC,IAAIvB,EAAS,EACb,OAAI,OAAOb,GAAW,UAAYA,IAAW1K,EACvC+M,IAAS,UACXxB,EAASvL,EAAS,EAClB8M,EAAM,SAAS,WACNC,IAAS,UAClBxB,EAASvL,EAAS,EAClB8M,EAAM,SAAS,WACNC,IAAS,WAClBxB,EAASvL,EAAS,EAClB8M,EAAM,SAAS,WAGjB,CAACpC,IACAb,IAAU7J,GAAU6J,IAAU7J,EAAS,GAAK6J,IAAU7J,EAAS,KAG5D6J,IAAU7J,EAAS,GACrBuL,EAASvL,EAAS,EAClB8M,EAAM,SAAS,WACNjD,IAAU7J,EAAS,GAC5BuL,EAASvL,EAAS,EAClB8M,EAAM,SAAS,WACNjD,IAAU7J,IACnBuL,EAASvL,EACT8M,EAAM,SAAS,YAGnBA,EAAM,OAASvB,EACRA,CACT,CAGO,SAASqC,GAAgBd,EAAsB,CACpD,GAAI,CAACA,EAAM,SAAU,CACnB,GACEA,EAAM,SAAS,QAAU,GACzBA,EAAM,SAAS,QAAU,GACzBA,EAAM,SAAS,QAAU,EACzB,CACAA,EAAM,iBAAmB,GACzBA,EAAM,SAAW,GACjB,MACF,CACA,MAAMe,EAAQf,EAAM,MAAQ,EACxBe,EAAO,GACTf,EAAM,SAAW,GAEjBA,EAAM,MAAQe,CAElB,CAEAf,EAAM,SAAW,CAAE,QAAS,EAAG,QAAS,EAAG,QAAS,CAAA,CACtD,CC3FO,SAASgB,IAAqC,CASnD,MAAO,CAAE,MAAO,EAAG,QARc,CAC/B,CAAE,KAAM,SAAU,IAAK,EAAA,EACvB,CAAE,KAAM,SAAU,IAAK,EAAA,EACvB,CAAE,KAAM,SAAU,IAAK,EAAA,EACvB,CAAE,KAAM,SAAU,IAAK,EAAA,EACvB,CAAE,KAAM,MAAA,EACR,CAAE,KAAM,YAAA,CAAa,EAEK,MAAO,EAAG,SAAU,GAAO,aAAc,EAAA,CACvE,CAEO,SAASC,GACdjB,EACsB,CACtB,OAAOA,EAAM,QAAQA,EAAM,KAAK,GAAK,IACvC,CAEO,SAASkB,GACdlB,EACAjD,EACAkD,EACArC,EACQ,CACR,GAAIoC,EAAM,SAAU,MAAO,GAC3B,MAAM5M,EAAI6N,GAAsBjB,CAAK,EACrC,GAAI,CAAC5M,EAAG,MAAO,GACf,IAAII,EAAS,EACb,OAAQJ,EAAE,KAAA,CACR,IAAK,SAAU,CACT,OAAOwK,GAAW,UAAYA,IAAWxK,EAAE,IACzC6M,IAAS,SAAUzM,EAASJ,EAAE,IAAM,EAC/B6M,IAAS,SAAUzM,EAASJ,EAAE,IAAM,EACpC6M,IAAS,WAAUzM,EAASJ,EAAE,KAEvC,CAACwK,IACAb,IAAU3J,EAAE,KAAO2J,IAAU3J,EAAE,IAAM,GAAK2J,IAAU3J,EAAE,IAAM,KAE7DI,EAASuJ,GAEPvJ,EAAS,IAAGwM,EAAM,aAAe,IACrC,KACF,CACA,IAAK,SAAU,EACRC,IAAS,UAAYrC,IAAWxK,EAAE,KAAQ2J,IAAU3J,EAAE,IAAM,KAC/DI,EAASJ,EAAE,IAAM,EACjB4M,EAAM,aAAe,IAEvB,KACF,CACA,IAAK,SAAU,EACRC,IAAS,UAAYrC,IAAWxK,EAAE,KAAQ2J,IAAU3J,EAAE,IAAM,KAC/DI,EAASJ,EAAE,IAAM,EACjB4M,EAAM,aAAe,IAEvB,KACF,CACA,IAAK,OAAQ,EAETC,IAAS,QACTA,IAAS,cACTlD,IAAU,IACVA,IAAU,MAEVvJ,EAASyM,IAAS,cAAgBlD,IAAU,GAAK,GAAK,GACtDiD,EAAM,aAAe,IAEvB,KACF,CACA,IAAK,aAAc,CAEbjD,EAAQ,IACVvJ,EAASuJ,EACTiD,EAAM,aAAe,IAEvB,KACF,CAAA,CAEF,OAAAA,EAAM,OAASxM,EACRA,CACT,CAEO,SAAS2N,GAAenB,EAAqB,CAC9CA,EAAM,WACLA,EAAM,eACTA,EAAM,MAAQ,KAAK,MAAMA,EAAM,MAAQ,CAAC,GAE1CA,EAAM,aAAe,GACrBA,EAAM,OAAS,EACXA,EAAM,OAASA,EAAM,QAAQ,WAAc,SAAW,IAC5D,CClGO,SAASoB,IAA8B,CAC5C,MAAO,CAAE,MAAO,EAAG,MAAO,EAAG,OAAQ,OAAQ,SAAU,EAAA,CACzD,CAEO,SAASC,GACdrB,EACAjD,EACAkD,EACArC,EACQ,CACR,GAAIoC,EAAM,SAAU,MAAO,GAG3B,IAAIxM,EAAS,EACb,GAAIwM,EAAM,SAAW,OACnB,GAAIC,IAAS,aAAczM,EAAS,WAC3B,OAAOoK,GAAW,SAAU,CAEnC,MAAM7J,EAAI6J,GADGqC,IAAS,SAAW,EAAIA,IAAS,SAAW,EAAI,GAEzDrC,GAAU,KAAIpK,EAASO,EAC7B,MAEMgJ,GAAS,KAAIvJ,EAASuJ,WAGxB,OAAOa,GAAW,SAAU,CAE9B,MAAM7J,EAAI6J,GADGqC,IAAS,SAAW,EAAIA,IAAS,SAAW,EAAI,GAEzDrC,GAAU,KAAIpK,EAASO,EAC7B,MACMgJ,EAAQ,GAAKA,GAAS,KAAIvJ,EAASuJ,GAG3C,OAAAiD,EAAM,OAASxM,EACRA,CACT,CAEO,SAAS8N,GAAetB,EAAqB,CAClD,GAAI,CAAAA,EAAM,SAEV,IADAA,EAAM,OAAS,EACXA,EAAM,MAAQ,GAAI,CACpBA,EAAM,SAAW,GACjB,MACF,CACAA,EAAM,OAASA,EAAM,SAAW,OAAS,MAAQ,OACnD,CC7CO,SAASuB,GAAkBC,EAAkBC,EAAQ,EAAgB,CAC1E,MAAO,CAAE,OAAQD,EAAU,MAAAC,EAAO,SAAU,GAAO,WAAY,EAAA,CACjE,CAGO,SAASC,GACdC,EACmB,CACnB,MAAMC,EAAO,MAAM,KAAK,CAAE,OAAQ,EAAA,EAAM,CAAC1C,EAAG2C,IAAMA,EAAI,CAAC,EACjDC,EAAW,CAAA,EACjB,UAAWC,KAAMJ,EAAW,CAE1B,MAAMK,EAAM,KAAK,MAAM,KAAK,OAAA,EAAWJ,EAAK,MAAM,EAC5CnC,EAAMmC,EAAK,OAAOI,EAAK,CAAC,EAAE,CAAC,EACjCF,EAAIC,CAAE,EAAItC,CACZ,CACA,OAAOqC,CACT,CAIO,SAASG,GACdC,EACAC,EACAlC,EACArC,EACqE,CACrE,MAAMwE,EAAKD,EAAOD,CAAM,EACxB,GAAI,CAACE,GAAM,CAACxE,GAAU,CAACqC,EAAM,MAAO,CAAE,aAAc,EAAA,EAEpD,GAAI,CAACmC,EAAG,UAAYnC,IAAS,UAAYrC,IAAWwE,EAAG,OACrD,OAAAA,EAAG,SAAW,GACP,CAAE,aAAc,EAAA,EAGzB,GAAIA,EAAG,WAAanC,IAAS,UAAYA,IAAS,UAAW,CAC3D,MAAMoC,EAAW,OAAO,KAAKF,CAAM,EAAE,KAClCG,GACCA,IAAQJ,GACR,CAACC,EAAOG,CAAG,EAAE,YACbH,EAAOG,CAAG,EAAE,SAAW1E,CAAA,EAE3B,GAAIyE,EAAU,CACZ,MAAME,EAASJ,EAAOE,CAAQ,EACxBG,EAAQvC,IAAS,SAAW,EAAI,EACtC,OAAAsC,EAAO,MAAQ,KAAK,IAAI,EAAGA,EAAO,MAAQC,CAAK,EAC3CD,EAAO,QAAU,IAAGA,EAAO,WAAa,IACrC,CAAE,aAAc,GAAO,SAAAF,EAAU,aAAcG,CAAA,CACxD,CACF,CACA,MAAO,CAAE,aAAc,EAAA,CACzB,CAEO,SAASC,GACdN,EACe,CACf,MAAMO,EAAQ,OAAO,QAAQP,CAAM,EAAE,OACnC,CAAC,CAAA,CAAGQ,CAAE,IAAM,CAACA,EAAG,YAAcA,EAAG,MAAQ,CAAA,EAE3C,OAAID,EAAM,SAAW,EAAUA,EAAM,CAAC,EAAE,CAAC,EAClC,IACT,CC3DO,SAASE,IAAgC,CAC9C,MAAO,CAAE,OAAQ,EAAG,MAAO,EAAG,gBAAiB,EAAG,SAAU,EAAA,CAC9D,CAGO,SAASC,GACd7C,EACAjD,EACAkD,EACArC,EACQ,CACR,GAAIoC,EAAM,SAAU,MAAO,GAC3B,IAAI8C,EAAO,EAeX,GAdI,OAAOlF,GAAW,UAAYA,IAAWoC,EAAM,OAC7CC,IAAS,SAAU6C,EAAO,EACrB7C,IAAS,SAAU6C,EAAO,EAC9BA,EAAO,EAEZ,CAAClF,IACAb,IAAUiD,EAAM,QACfjD,IAAUiD,EAAM,OAAS,GACzBjD,IAAUiD,EAAM,OAAS,KAE3B8C,EAAO/F,IAAUiD,EAAM,OAAS,EAAI,EAAIjD,IAAUiD,EAAM,OAAS,EAAI,EAAI,GAE3EA,EAAM,OAAS8C,EACf9C,EAAM,iBAAmB,EACrBA,EAAM,iBAAmB,EAAG,CAC9B,MAAMe,EAAQf,EAAM,OAAS,EACzBe,EAAO,EAAGf,EAAM,SAAW,IAE7BA,EAAM,OAASe,EACff,EAAM,gBAAkB,EAE5B,CACA,OAAO8C,CACT,CCtBO,MAAMC,GAAyC,CACpD,EAAG,EACH,EAAG,GACH,EAAG,EACH,EAAG,GACH,EAAG,EACH,EAAG,GACH,EAAG,EACH,EAAG,GACH,EAAG,GACH,GAAI,EACJ,GAAI,GACJ,GAAI,EACJ,GAAI,GACJ,GAAI,EACJ,GAAI,GACJ,GAAI,EACJ,GAAI,GACJ,GAAI,EACN,EASO,SAASC,IAAwB,CACtC,MAAO,CAAE,KAAM,EAAG,QAAS,EAAG,cAAe,EAAG,SAAU,EAAA,CAC5D,CAEO,SAASC,GACdjD,EACAjD,EACAkD,EACArC,EACS,CACT,GAAIoC,EAAM,SAAU,MAAO,GAC3B,MAAM9M,EAAS6P,GAAa/C,EAAM,IAAI,EAQtC,GAPAA,EAAM,eAAiB,EAEpB,OAAOpC,GAAW,UACjBA,IAAW1K,IACV+M,IAAS,UAAYA,IAAS,UAAYA,IAAS,WACrD,CAACrC,IACCb,IAAU7J,GAAU6J,IAAU7J,EAAS,GAAK6J,IAAU7J,EAAS,GAC3D,CACP8M,EAAM,SAAWA,EAAM,cAEvB,MAAMe,EAAQf,EAAM,KAAO,EAC3B,OAAIe,EAAO,GAAIf,EAAM,SAAW,IAE9BA,EAAM,KAAOe,EACbf,EAAM,cAAgB,GAEjB,EACT,CAEA,GAAIA,EAAM,eAAiB,EAAG,CAC5BA,EAAM,SAAW,EACjB,MAAMe,EAAQf,EAAM,KAAO,EACvBe,EAAO,GAAIf,EAAM,SAAW,IAE9BA,EAAM,KAAOe,EACbf,EAAM,cAAgB,EAE1B,CACA,MAAO,EACT,CCzFO,MAAMkD,GAGT,CACF,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACvB,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACvB,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACvB,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACvB,EAAG,CAAE,KAAM,MAAA,EACX,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACvB,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACvB,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACvB,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,CACzB,EASO,SAASC,IAAkC,CAChD,MAAO,CACL,MAAO,MAAM,CAAC,EAAE,KAAK,IAAI,EACzB,KAAM,IACN,SAAU,GACV,OAAQ,IAAA,CAEZ,CAEA,SAASC,GAASC,EAA2D,CAC3E,MAAMC,EAAQ,CACZ,CAAC,EAAG,EAAG,CAAC,EACR,CAAC,EAAG,EAAG,CAAC,EACR,CAAC,EAAG,EAAG,CAAC,EACR,CAAC,EAAG,EAAG,CAAC,EACR,CAAC,EAAG,EAAG,CAAC,EACR,CAAC,EAAG,EAAG,CAAC,EACR,CAAC,EAAG,EAAG,CAAC,EACR,CAAC,EAAG,EAAG,CAAC,CAAA,EAEV,SAAW,CAAC5F,EAAG6F,EAAGpF,CAAC,IAAKmF,EACtB,GAAID,EAAM3F,CAAC,GAAK2F,EAAM3F,CAAC,IAAM2F,EAAME,CAAC,GAAKF,EAAM3F,CAAC,IAAM2F,EAAMlF,CAAC,EAC3D,OAAOkF,EAAM3F,CAAC,EAElB,OAAI2F,EAAM,MAAOlF,GAAMA,CAAC,EAAU,OAC3B,IACT,CAEO,SAASqF,GACdxD,EACAyD,EACA1G,EACAkD,EACArC,EACS,CACT,GAAIoC,EAAM,UAAYA,EAAM,MAAMyD,CAAI,EAAG,MAAO,GAChD,MAAMC,EAAMR,GAAYO,CAAI,EAC5B,IAAIE,EAAK,GAYT,GAXID,EAAI,OAAS,OACfC,EACE1D,IAAS,QAAUA,IAAS,cAAgBlD,IAAU,IAAMA,IAAU,GACjE2G,EAAI,OAAS,OAAS,OAAOA,EAAI,KAAQ,WAC5C,OAAO9F,GAAW,UAAYA,IAAW8F,EAAI,KAE/C,CAAC9F,IACAb,IAAU2G,EAAI,KAAO3G,IAAU2G,EAAI,IAAM,GAAK3G,IAAU2G,EAAI,IAAM,MAEnEC,EAAK,IAEL,CAACA,EAAI,MAAO,GAChB3D,EAAM,MAAMyD,CAAI,EAAIzD,EAAM,KAC1B,MAAM4D,EAAIR,GAASpD,EAAM,KAAK,EAC9B,OAAI4D,GACF5D,EAAM,SAAW,GACjBA,EAAM,OAAS4D,EACR,KAET5D,EAAM,KAAOA,EAAM,OAAS,IAAM,IAAM,IACjC,GACT,CCrEO,SAAS6D,IAA6B,CAC3C,MAAO,CACL,YAAa,EACb,MAAO,EACP,SAAU,EAAA,CAEd,CAEO,MAAMC,GAAe,CAC1B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACzE,EACaC,GAAoB,CAC/B,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACF,EAEO,SAASC,GAAchE,EAA0B,CACtD,OAAO8D,GAAa9D,EAAM,WAAW,CACvC,CAEO,SAASiE,GACdjE,EACAjD,EACAkD,EACW,CACX,GAAID,EAAM,SAAU,OAAOA,EAE3B,MAAM9M,EAAS8Q,GAAchE,CAAK,EAOlC,GAAI,EALDC,IAAS,UAAYlD,IAAU7J,GAC/B+M,IAAS,UAAYlD,IAAU7J,GAC/B+M,IAAS,UAAYlD,IAAU7J,GAC/B+M,IAAS,cAAgB/M,IAAW,IAEvB,OAAO8M,EAGvB,MAAMkE,EAAWlE,EAAM,YAAc,EAC/BmE,EAAWD,GAAYJ,GAAa,OAE1C,MAAO,CACL,YAAaI,EACb,MAAOlE,EAAM,MAAQ,EACrB,SAAAmE,CAAA,CAEJ,CAEO,SAASC,GAAepE,EAAkBjD,EAA0B,CAEzE,OAAOkH,GAAYjE,EAAOjD,EAAO,QAAQ,CAC3C,CAEO,SAASsH,IAAuB,CACrC,OAAOR,GAAA,CACT,CAUO,SAASS,GAAiBpR,EAAiB,GAAgB,CAChE,MAAO,CACL,MAAO,EACP,MAAO,EACP,SAAU,GACV,OAAAA,CAAA,CAEJ,CAEO,MAAMqR,GAAsB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,EAAE,EAElD,SAASC,GAAazH,EAAwB,CACnD,OAAOwH,GAAoB,SAASxH,CAAK,CAC3C,CAEO,SAAS0H,GACdzE,EACAjD,EACAkD,EACY,CACZ,GAAID,EAAM,SAAU,OAAOA,EAG3B,GAAI,CAACwE,GAAazH,CAAK,EACrB,MAAO,CAAE,GAAGiD,EAAO,MAAOA,EAAM,MAAQ,CAAA,EAG1C,MAAM0E,EAAW1E,EAAM,MAAQjD,EACzBoH,EAAWO,GAAY1E,EAAM,OAEnC,MAAO,CACL,MAAOmE,EAAWnE,EAAM,OAAS0E,EACjC,MAAO1E,EAAM,MAAQ,EACrB,SAAAmE,EACA,OAAQnE,EAAM,MAAA,CAElB,CAEO,SAAS2E,GAAgB3E,EAAmBjD,EAA2B,CAC5E,OAAO0H,GAAazE,EAAOjD,CAAe,CAC5C,CAEO,SAAS6H,GAAW1R,EAAiB,GAAgB,CAC1D,OAAOoR,GAAiBpR,CAAM,CAChC,CAUO,SAAS2R,GAAkB3R,EAAiB,GAAiB,CAClE,MAAO,CACL,MAAO,EACP,MAAO,EACP,SAAU,GACV,OAAAA,CAAA,CAEJ,CAEO,MAAM4R,GAAuB,CAAC,EAAG,GAAI,EAAE,EAEvC,SAASC,GAAchI,EAAwB,CACpD,OAAO+H,GAAqB,SAAS/H,CAAK,CAC5C,CAEO,SAASiI,GACdhF,EACAjD,EACAkD,EACa,CACb,GAAID,EAAM,SAAU,OAAOA,EAG3B,GAAI,CAAC+E,GAAchI,CAAK,EACtB,MAAO,CAAE,GAAGiD,EAAO,MAAOA,EAAM,MAAQ,CAAA,EAG1C,MAAM0E,EAAW1E,EAAM,MAAQjD,EACzBoH,EAAWO,GAAY1E,EAAM,OAEnC,MAAO,CACL,MAAOmE,EAAWnE,EAAM,OAAS0E,EACjC,MAAO1E,EAAM,MAAQ,EACrB,SAAAmE,EACA,OAAQnE,EAAM,MAAA,CAElB,CAEO,SAASiF,GACdjF,EACAjD,EACa,CACb,OAAOiI,GAAchF,EAAOjD,CAAe,CAC7C,CAEO,SAASmI,GAAYhS,EAAiB,GAAiB,CAC5D,OAAO2R,GAAkB3R,CAAM,CACjC,CC/LO,MAAMiS,GAAwC,CACnD,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACtC,EAEO,SAASC,IAAuC,CACrD,MAAMvF,EAAa,CAAA,EACnB,OAAAsF,GAAmB,QAASrF,GAAM,CAChCD,EAAMC,CAAC,EAAI,CACb,CAAC,EACM,CAAE,MAAAD,EAAO,OAAQ,CAAA,CAC1B,CAEO,SAASwF,GACdrF,EACAjD,EACAkD,EACArC,EACAsC,EAAkD,IAAM,GAChD,CACR,IAAIT,EAA8B,KAC9BU,EAAO,EACX,GACEF,IAAS,QACTA,IAAS,cACTlD,IAAU,IACVA,IAAU,GAEV0C,EAAM,GACNU,EAAOF,IAAS,cAAgBlD,IAAU,GAAK,EAAI,UAC1C,OAAOa,GAAW,UAAYA,GAAU,IAAMA,GAAU,GACjE6B,EAAM7B,EACFqC,IAAS,SAAUE,EAAO,EACrBF,IAAS,SAAUE,EAAO,EAC9BA,EAAO,UACHpD,EAAO,CAChB,UAAWoB,IAAK,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAAwB,CACzE,GAAIpB,IAAUoB,EAAG,CACfsB,EAAMtB,EACNgC,EAAO,EACP,KACF,CACA,GAAIpD,IAAUoB,EAAI,EAAG,CACnBsB,EAAMtB,EACNgC,EAAO,EACP,KACF,CACA,GAAIpD,IAAUoB,EAAI,EAAG,CACnBsB,EAAMtB,EACNgC,EAAO,EACP,KACF,CACF,CACI,CAACV,IAAQ1C,IAAU,IAAMA,IAAU,MACrC0C,EAAM,GACNU,EAAOpD,IAAU,GAAK,EAAI,EAE9B,CACA,GAAI,CAAC0C,EAAK,MAAO,GAEjB,MAAMY,EAASL,EAAM,MAAMP,CAAG,EACxB6F,EAAU,KAAK,IAAI,EAAG,EAAIjF,CAAM,EAChCE,EAAU,KAAK,IAAI+E,EAASnF,CAAI,EAChCK,EAAW,KAAK,IAAI,EAAGL,EAAOI,CAAO,EACrCE,EAASJ,EAASE,EACxBP,EAAM,MAAMP,CAAG,EAAIgB,EAAQ,EAAI,EAAIA,EAEnC,IAAIhC,EAAS,EACb,OAAI+B,EAAW,GAAK,CAACN,EAAeT,CAAG,IACjCA,IAAQ,GACNQ,IAAS,aAAcxB,GAAU,GAAK+B,KAC3B,GAAKA,EAEpB/B,GAAWgB,EAAiBe,GAGhCR,EAAM,QAAUvB,EACTA,CACT,CAEO,SAAS8G,GAAevF,EAAgC,CAC7D,OAAOmF,GAAmB,MAAOrF,IAAOE,EAAM,MAAMF,CAAC,GAAK,IAAM,CAAC,CACnE,CChFO,SAAS0F,GACdC,EACA,CACA,MAAO,CAACC,EAAeC,IAAkB,CACvCF,EAAuBC,CAAK,CAC9B,CACF,CC6CO,SAASE,GAA0BC,EAIlB,CACtB,KAAM,CAAE,MAAAC,EAAO,uBAAAL,EAAwB,QAAAM,CAAA,EAAYF,EACnD,MAAO,CACL,SAAU,CAACH,EAAeC,EAAQ,EAAGK,IAAe,CAClD,GAAIP,EAAwB,CAC1BA,EAAuBC,CAAK,EAC5B,MACF,CACA,GAAI,CACFI,EAAM,SAASJ,EAAOC,EAAOK,CAAI,CACnC,MAAQ,CACNF,EAAM,SAASJ,EAAOC,CAAK,CAC7B,CACF,EACA,UAAW,IAAM,CACfG,EAAM,UAAA,CACR,EACA,WAAY,IAAM,CAChB,GAAIC,EACF,GAAI,CACFA,EAAQ,CAAC,CACX,MAAQ,CACND,EAAM,WAAA,CACR,MAEAA,EAAM,WAAA,CAEV,EACA,OAASJ,GAAmB,CACtB,OAAOA,GAAU,SAAUI,EAAM,OAAOJ,CAAK,EAC5CI,EAAM,OAAO,CAAC,CACrB,EACA,QAAS,IAAM,CACbA,EAAM,QAAA,CACR,CAAA,CAEJ,CC3FO,SAASG,GACdC,EAEAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GACAC,EACAC,EACAC,GAEAC,GAEAC,GAEAC,GACAC,GACAC,GACAC,GACe,CACf,OAAO5P,EAAAA,QAAQ,IAAM,CACnB,MAAM6P,GAAyB,CAAA,EAE/B,GAAI3B,IAAa,MAAO,CAEtB,IAAI4B,EAAiB,EACjBC,GAAc,EACdC,EAAe,EACnB,GAAIb,IAAYA,GAAS,OAAS,EAAG,CACnC,UAAWc,MAAOd,GACZc,GAAI,aAAeA,GAAI,cACzBF,IAAeE,GAAI,YACnBD,GAAgBC,GAAI,aAGpBF,GAAc,IAChBD,EAAkBE,EAAeD,GAAe,EAEpD,CAQA,MAAMG,IALmBrB,GAAwB,GACG,EACtBJ,GAAkB,EACnBE,GAAwB,OACzBJ,GAAkB,GAwB9C,GAnBAsB,GAAQ,KAAK,CACX,KAAM,MACN,cAAe,CAAC,CAACT,EACjB,QAASf,GAAc,EACvB,MAAOF,GAAe,EACtB,UAAW+B,GACX,aACElB,GAAoBA,EAAmB,EACnC,KAAK,OAAQD,GAAoB,GAAKC,EAAoB,GAAG,EAC7D,EACN,QACEG,IAAYA,GAAS,OAAS,EAC1B,GAAG,KAAK,IAAI,GAAGA,GAAS,IAAKgB,IAAMA,GAAE,aAAeA,GAAE,eAAiB,EAAE,CAAC,GAAK,CAAC,SAChF,IACN,SAAUL,EACV,WAAYM,GAAc,KAAK,GAAK,CAAA,CACrC,EAGGf,GAAMA,IAAO,OAAQ,CAMvB,MAAMgB,GALevB,GAAoB,GACG,EAClBJ,GAAc,EACfE,GAAoB,OACrBJ,GAAc,GAKtCqB,GAAQ,KAAK,CACX,KAAM,GAAGR,CAAE,MACX,cAAe,CAACD,EAChB,QAASd,GAAU,EACnB,MAAOF,GAAW,EAClB,UAAWiC,EACX,aACEnB,GAAgBA,EAAe,EAC3B,KAAK,OAAQD,GAAgB,GAAKC,EAAgB,GAAG,EACrD,EACN,QAAS,GAAA,CACV,CACH,CACF,CAEA,OAAIhB,IAAa,YACf2B,GAAQ,KAAK,CACX,KAAM,MACN,cAAe,CAAC,CAACT,EACjB,OAAQG,IAAS,OAAS,CAAA,EAC1B,OAAQA,IAAS,QAAU,CAAA,CAC5B,EAEGF,GAAMA,IAAO,QACfQ,GAAQ,KAAK,CACX,KAAM,GAAGR,CAAE,MACX,cAAe,CAACD,EAChB,OAAQ,CAAA,EACR,OAAQ,CAAA,CACT,GAIDlB,IAAa,aACf2B,GAAQ,KAAK,CACX,KAAM,MACN,cAAe,CAAC,CAACT,EACjB,MAAOI,IAAU,OAAS,EAC1B,OAAQA,IAAU,QAAU,EAC5B,MAAOA,IAAU,OAAS,CAAA,CAC3B,EAEGH,GAAMA,IAAO,QACfQ,GAAQ,KAAK,CACX,KAAM,GAAGR,CAAE,MACX,cAAe,CAACD,EAChB,MAAOI,IAAU,OAAS,EAC1B,OAAQA,IAAU,QAAU,EAC5B,MAAO,CAAA,CACR,GAIDtB,IAAa,UAAYuB,IAAiBA,GAAc,OAAS,GACnEA,GAAc,QAAQ,CAAC9I,EAAGqD,KAAQ,CAChC,MAAMhC,EAAQ0H,KAAe/I,EAAE,EAAE,EACjCkJ,GAAQ,KAAK,CACX,KAAMlJ,EAAE,KACR,cAAeqD,KAAQ4F,GACvB,OAAQD,KAAiBhJ,EAAE,EAAE,EAC7B,MAAOqB,GAAO,OAAS,EACvB,WAAYA,GAAO,YAAc,EAAA,CAClC,CACH,CAAC,EAGI6H,EACT,EAAG,CACD3B,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GACAC,EACAC,EACAE,GACAC,GACAC,GACAC,GACAC,GACAC,EAAA,CACD,CACH,CCtGA,MAAMU,GAAW,CAAC,OAAQ,SAAU,UAAU,EAE9C,SAASC,GAAM,EAAWC,EAAaC,EAAa,CAClD,OAAO,KAAK,IAAID,EAAK,KAAK,IAAIC,EAAK,CAAC,CAAC,CACvC,CAcA,MAAMC,GAAuB,KAE7B,SAASC,GAAa5V,EAAmB6V,EAAuB,CAC9D,IAAI1V,EAAS,EACb,GAAI0V,IAAU,OAAQ,CACpB,MAAMC,EAAa,CAAC,GAAI,GAAI,GAAI,GAAI,EAAE,EACtC3V,EAAS2V,EAAW,KAAK,MAAM,KAAK,SAAWA,EAAW,MAAM,CAAC,CACnE,MAAWD,IAAU,SACnB1V,EAAS,KAAK,MAAMqV,GAAM,IAAM,KAAK,OAAA,EAAW,GAAK,IAAK,GAAI,GAAG,CAAC,EAElErV,EAAS,KAAK,MAAMqV,GAAM,IAAM,KAAK,OAAA,EAAW,GAAK,IAAK,GAAI,GAAG,CAAC,EAEpE,OAAIxV,GAAa,EAAU,EACvBG,EAASH,EACE,CAAC,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,CAAC,EAAE,KACvDgB,GAAMA,GAAKhB,CAAA,GAEC,EAEVG,CACT,CAEA,SAAS4V,GAAc,CAAE,QAAAC,GAAoC,CAC3D,aACG,MAAA,CAAI,UAAU,6EACb,SAAA7L,EAAAA,KAAC,MAAA,CAAI,UAAU,gCACb,SAAA,CAAA3F,EAAAA,IAAC,SAAA,CACC,UAAU,uCACV,QAASwR,EACV,SAAA,OAAA,CAAA,QAGA,KAAA,CAAG,UAAU,yBAAyB,SAAA,0BAAuB,EAC9D7L,EAAAA,KAAC,KAAA,CAAG,UAAU,gCACZ,SAAA,CAAA3F,EAAAA,IAAC,MAAG,SAAA,wDAAqD,EACzDA,EAAAA,IAAC,MAAG,SAAA,yEAGJ,EACAA,EAAAA,IAAC,MAAG,SAAA,yEAGJ,EACAA,EAAAA,IAAC,MAAG,SAAA,8DAA2D,EAC/DA,EAAAA,IAAC,MAAG,SAAA,0EAGJ,EACAA,EAAAA,IAAC,MAAG,SAAA,oEAEJ,CAAA,EACF,QACC,IAAA,CAAE,UAAU,yBAAyB,SAAA,6DAEtC,CAAA,CAAA,CACF,CAAA,CACF,CAEJ,CAEA,MAAMyR,GAAW,wBAEjB,SAAwBC,GAAY,CAAE,KAAAC,GAAuB,CAC3D,KAAM,CACJ,cAAAC,EACA,eAAAnW,EACA,cAAAoW,EACA,YAAAC,EACA,aAAAC,EACA,kBAAAC,EACA,oBAAAC,EACA,eAAAC,EACA,iBAAAC,EACA,YAAAnO,EACA,eAAAoO,EACA,aAAAC,EAAe,OACf,gBAAAC,EACA,cAAAC,EAAgB,OAChB,iBAAAC,EACA,cAAAC,EACA,SAAAC,GACA,QAAAC,EACA,kBAAAnT,EACA,eAAAoT,GAAiB,iBACjB,UAAAC,GAAY,UACZ,aAAAC,GACA,UAAAC,GAAY,SACZ,aAAAC,GACA,UAAAC,GAAY,SACZ,aAAAC,EAAA,EACE7U,GAAA,EACE8U,GAAgB3T,IAAsB,SACtC4T,EAAuBX,GAAiB,CAACU,GACzCE,GACJZ,GAAiB,CAACU,IAAiBP,KAAmB,YAClD,CAACU,EAAcC,EAAe,EAAIhW,EAAAA,SAAiB,KAAK,EACxD,CAACwS,EAAUyD,EAAW,EAAIjW,EAAAA,SAAS,GAAG,EACtC,CAACuS,EAAI2D,EAAK,EAAIlW,EAAAA,SAAS,MAAM,EAC7B,CAACmW,GAAWC,EAAY,EAAIpW,EAAAA,SAAS,EAAK,EAC1C,CAACqW,GAASC,EAAU,EAAItW,EAAAA,SAAS,EAAK,EACtC,CAACqR,EAAakF,CAAc,EAAIvW,EAAAA,SAASwS,CAAQ,EACjD,CAAClB,EAASkF,EAAU,EAAIxW,EAAAA,SAASwS,CAAQ,EACzC,CAACiE,GAAUC,EAAW,EAAI1W,EAAAA,SAAS,EAAK,EACxC,CAAC2W,GAAcC,CAAe,EAAI5W,EAAAA,SAAS,EAAK,EAEhD,CAAC6W,GAASC,EAAU,EAAI9W,EAAAA,SAAiB,CAAC,EAC1C,CAACuR,GAAYwF,CAAa,EAAI/W,EAAAA,SAAiB,CAAC,EAChDgR,GAAQgG,GAAA,EACR,CAACC,GAAmBC,EAAoB,EAAIlX,EAAAA,SAAS,EAAK,EAC1DmX,GAAsBxX,EAAAA,OAAO,EAAK,EAClC,CAAC6R,GAAQ4F,EAAS,EAAIpX,EAAAA,SAAiB,CAAC,EAGxC,CAACqX,EAAkBC,CAAmB,EAAItX,EAAAA,SAE9C,IAAI,EACA,CAACuX,EAAaC,CAAc,EAAIxX,EAAAA,SAAS,CAAC,EAC1C,CAACyX,EAAeC,EAAgB,EAAI1X,EAAAA,SAAS,CAAC,EAC9C,CAACqS,EAAUsF,EAAW,EAAI3X,EAAAA,SAS9B,CAAA,CAAE,EAEE,CAAC4X,GAAWC,EAAY,EAAI7X,EAAAA,SAAiB,GAAI,EACjD8X,GAAQC,GAAA,EAER,CAACC,GAAgBC,EAAiB,EAAIjY,EAAAA,SAAS,EAAK,EACpD,CAACkY,GAAeC,EAAgB,EAAInY,EAAAA,SAAS,EAAK,EAClDoY,GAAYC,GAAiB9Z,GAAMA,EAAE,SAAS,EACpDmE,EAAAA,UAAU,IAAM,CACd,MAAM4V,EAAS,IAAM,CACnBL,GAAkB,EAAK,EACvB3B,GAAW,EAAK,EAChB6B,GAAiB,EAAK,CACxB,EACA,GAAI,CACF,OAAO,iBAAiB,iBAAyBG,CAAa,CAChE,MAAQ,CAAC,CACT,MAAO,IAAM,CACX,GAAI,CACF,OAAO,oBAAoB,iBAAyBA,CAAa,CACnE,MAAQ,CAAC,CACX,CACF,EAAG,CAAA,CAAE,EAEL,KAAM,CAACC,GAAWC,EAAY,EAAIxY,EAAAA,SAASqU,IAAkB,QAAQ,EAC/D,CAACoE,GAAQC,EAAS,EAAI1Y,EAAAA,SAASqU,IAAkB,QAAQ,EAE/D3R,EAAAA,UAAU,IAAM,CACd8V,GAAanE,IAAkB,QAAQ,EACvCqE,GAAUrE,IAAkB,QAAQ,CACtC,EAAG,CAACA,CAAa,CAAC,EAClB3R,EAAAA,UAAU,IAAM,CACVsS,IAAkB,OACpBC,EAAiB,KAAK,CAE1B,EAAG,CAACD,EAAeC,CAAgB,CAAC,EACpC,KAAM,CAAC0D,GAAUC,EAAW,EAAI5Y,EAAAA,SAAS,CAAC,EACpC,CAAC6Y,GAAgBC,EAAiB,EAAI9Y,EAAAA,SAAS,EAAK,EACpD,CAACsS,GAAcyG,EAAe,EAAI/Y,EAAAA,SAAS,EAAI,EACrD0C,EAAAA,UAAU,IAAM,CACd,MAAMsW,EAAoB,IAAMC,GAAqB,EAAI,EACzD,cAAO,iBAAiB,0BAA2BD,CAAiB,EAC7D,IACL,OAAO,oBAAoB,0BAA2BA,CAAiB,CAC3E,EAAG,CAAA,CAAE,EAEL,KAAM,CAACE,EAAkBC,CAAmB,EAAInZ,EAAAA,SAAiB,CAAC,EAC5D,CAACoZ,GAASC,EAAU,EAAIrZ,EAAAA,SAAiB,CAAC,EAC1C,CAACsZ,GAAQC,EAAS,EAAIvZ,EAAAA,SAAiB,CAAC,EAExC,CAACwZ,GAAUC,EAAW,EAAIzZ,EAAAA,SAAiB,CAAC,EAC5C,CAAC0Z,GAASC,EAAU,EAAI3Z,EAAAA,SAAiB,CAAC,EAE1C,CAACyS,GAASmH,EAAU,EAAI5Z,EAAAA,SAAS8K,IAAoB,EACrD,CAAC4H,GAAUmH,EAAW,EAAI7Z,EAAAA,SAAS6L,IAAqB,EACxD,CAACiO,GAAOC,EAAQ,EAAI/Z,EAAAA,SAASkM,IAAsB,EACnD,CAAC8N,GAASC,EAAU,EAAIja,EAAAA,SAASsM,IAAe,EAChD,CAAC4N,GAAmBC,EAAoB,EAAIna,EAAAA,SAAiB,CAAC,EAE9D,CAACoa,GAAUC,EAAW,EAAIra,EAAAA,SAAiB,CAAC,EAC5C,CAACsa,GAAUC,EAAW,EAAIva,EAAAA,SAAiB,EAAE,EAC7C,CAACwa,GAAUC,EAAW,EAAIza,EAAAA,SAAiB,CAAC,EAC5C,CAAC0a,GAASC,EAAU,EAAI3a,EAAAA,SAAiB,CAAC,EAC1C,CAAC4a,GAAaC,EAAc,EAAI7a,EAAAA,SAAkB,EAAK,EACvD,CAAC8a,GAASC,EAAU,EAAI/a,EAAAA,SAAiB,CAAC,EAC1C,CAACgb,GAASC,EAAU,EAAIjb,EAAAA,SAAiB,CAAC,EAC1C,CAACkb,GAASC,EAAU,EAAInb,EAAAA,SAAiB,CAAC,EAC1Cob,GAAc,EACd,CAACC,GAASC,EAAU,EAAItb,EAAAA,SAAiB,CAAC,EAC1C,CAACub,GAASC,EAAU,EAAIxb,EAAAA,SAAiB,CAAC,EAC1C,CAACyb,GAASC,EAAU,EAAI1b,EAAAA,SAAiB,CAAC,EAC1C2b,GAAc,GACd,CAACC,GAASC,EAAU,EAAI7b,EAAAA,SAAiB,CAAC,EAC1C,CAAC8b,GAASC,EAAU,EAAI/b,EAAAA,SAAiB,CAAC,EAC1C,CAACgc,GAASC,EAAU,EAAIjc,EAAAA,SAAiB,CAAC,EAC1Ckc,GAAc,GACd,CAACC,GAAUC,EAAW,EAAIpc,EAAAA,SAAiB,GAAG,EAC9C,CAACqc,GAAYC,EAAa,EAAItc,EAAAA,SAAiB,CAAC,EAChD,CAACuc,GAAeC,EAAgB,EAAIxc,EAAAA,SAAiB,CAAC,EACtD,CAACyc,GAAgBC,EAAiB,EAAI1c,EAAAA,SAAiB,CAAC,EACxD,CAAC2c,GAAUC,EAAW,EAAI5c,EAAAA,SAAiB,GAAG,EAC9C,CAAC6c,GAAYC,EAAa,EAAI9c,EAAAA,SAAiB,CAAC,EAChD,CAAC+c,GAAeC,EAAgB,EAAIhd,EAAAA,SAAiB,CAAC,EACtD,CAACid,GAAgBC,EAAiB,EAAIld,EAAAA,SAAiB,CAAC,EACxD,CAACmd,GAAcC,EAAe,EAAIpd,EAAAA,SAAiB,EAAE,EACrD,CAACqd,GAAYC,EAAa,EAAItd,EAAAA,SAAiB,CAAC,EAChD,CAACud,GAAaC,EAAc,EAAIxd,EAAAA,SAAiB,CAAC,EAClD,CAACyd,GAAgBC,EAAiB,EAAI1d,EAAAA,SAAiB,EAAE,EACzD,CAAC2d,GAAgBC,EAAiB,EAAI5d,EAAAA,SAAkB,EAAK,EAE7D,CAAC6d,GAAUC,EAAW,EAAI9d,EAAAA,SAAS8N,IAAgB,EACnD,CAACiQ,GAAMC,EAAO,EAAIhe,EAAAA,SAASkO,IAAY,EACvC,CAAC+P,GAAKC,EAAM,EAAIle,EAAAA,SAASqO,IAAiB,EAC1C,CAAC8P,GAAWC,EAAY,EAAIpe,EAAAA,SAASsQ,IAAsB,EAE3D,CAACqC,EAAe0L,EAAgB,EAAIre,WAExC,CACA,CAAE,GAAI,KAAM,KAAM,UAAA,EAClB,CAAE,GAAI,KAAM,KAAM,UAAA,CAAW,CAC9B,EACK,CAAC4S,GAAc0L,EAAe,EAAIte,EAAAA,SACtC,CAAA,CAAC,EAEG,CAAC6S,GAAgB0L,EAAiB,EAAIve,EAAAA,SAC1C,CAAA,CAAC,EAEG,CAACwe,GAAiBC,EAAkB,EAAIze,EAAAA,SAAkB,EAAK,EAC/D,CAAC8S,GAAe4L,EAAgB,EAAI1e,EAAAA,SAAiB,CAAC,EACtD,CAAC2e,GAAaC,EAAc,EAAI5e,EAAAA,SAAiB,CAAC,EAClD,CAAC6e,GAAgBC,EAAiB,EAAI9e,EAAAA,SAAwB,IAAI,EAClE,CAAC+e,GAAiBC,EAAkB,EAAIhf,EAAAA,SAAiB,EAAE,EAE3D,CAACif,GAAMC,EAAO,EAAIlf,EAAAA,SAAS+O,IAAiB,EAC5C,CAACoQ,GAAYC,EAAa,EAAIpf,EAAAA,SAAS+O,IAAiB,EAExD,CAACsQ,GAAOC,EAAQ,EAAItf,EAAAA,SAASwP,GAAiB,EAAE,CAAC,EACjD,CAAC+P,GAAaC,EAAc,EAAIxf,EAAAA,SAASwP,GAAiB,EAAE,CAAC,EAE7D,CAACiQ,GAAQC,EAAS,EAAI1f,EAAAA,SAAS+P,GAAkB,EAAE,CAAC,EACpD,CAAC4P,GAAcC,EAAe,EAAI5f,EAAAA,SAAS+P,GAAkB,EAAE,CAAC,EAChE,CAAC8P,GAAmBC,EAAoB,EAAI9f,EAAAA,SAAiB,CAAC,EAC9D,CAACyR,GAAgBsO,EAAiB,EAAI/f,EAAAA,SAAiB,CAAC,EACxD,CAACggB,GAAkBC,EAAmB,EAAIjgB,EAAAA,SAAiB,CAAC,EAC5D,CAACkgB,GAAkBC,EAAmB,EAAIngB,EAAAA,SAAiBwS,CAAQ,EACnE,CAACb,GAAgByO,EAAiB,EAAIpgB,EAAAA,SAAiB,CAAC,EACxD,CAAC6R,GAAsBwO,EAAuB,EAAIrgB,EAAAA,SAEtD,IAAI,EACA,CAACsgB,GAA0BC,EAA2B,EAC1DvgB,EAAAA,SAAiB,CAAC,EACdwgB,GAAsB7gB,EAAAA,OAAe,CAAC,EACtC8gB,GAAoB9gB,EAAAA,OAAe,CAAC,EACpC+gB,GAAiB/gB,EAAAA,OAAe0R,CAAW,EAC3CsP,GAAsBhhB,EAAAA,OAAeqgB,EAAgB,EACrDY,GAAoBjhB,EAAAA,OAAegS,EAAc,EACjDkP,GAAsBlhB,EAAAA,OAAeugB,EAAgB,EACrDY,GAA8BnhB,EAAAA,OAAe2gB,EAAwB,EAE3E5d,EAAAA,UAAU,IAAM,CACdge,GAAe,QAAUrP,CAC3B,EAAG,CAACA,CAAW,CAAC,EAChB3O,EAAAA,UAAU,IAAM,CACdie,GAAoB,QAAUX,EAChC,EAAG,CAACA,EAAgB,CAAC,EACrBtd,EAAAA,UAAU,IAAM,CACdke,GAAkB,QAAUjP,EAC9B,EAAG,CAACA,EAAc,CAAC,EACnBjP,EAAAA,UAAU,IAAM,CACdme,GAAoB,QAAUX,EAChC,EAAG,CAACA,EAAgB,CAAC,EACrBxd,EAAAA,UAAU,IAAM,CACdoe,GAA4B,QAAUR,EACxC,EAAG,CAACA,EAAwB,CAAC,EAC7B,KAAM,CAACS,GAAeC,EAAgB,EAAIhhB,EAAAA,SAAiB,CAAC,EACzCL,EAAAA,OAAsB,IAAI,EAC7C,KAAM,CAACshB,GAAeC,EAAgB,EAAIlhB,EAAAA,SAAiB,CAAC,EACtD,CAAC0R,GAAYyP,EAAa,EAAInhB,EAAAA,SAAiB,CAAC,EAChD,CAAC4R,GAAYwP,EAAa,EAAIphB,EAAAA,SAAiB,CAAC,EAChD,CAACqhB,GAAcC,EAAe,EAAIthB,EAAAA,SAAiB,CAAC,EACpD,CAAC8R,GAAkByP,EAAmB,EAAIvhB,EAAAA,SAAwB,IAAI,EACtE,CAACwhB,GAAsBC,EAAuB,EAAIzhB,EAAAA,SAAiB,CAAC,EAEpE,CAACkS,GAAkBwP,EAAmB,EAAI1hB,EAAAA,SAAiB,CAAC,EAC5D,CAACiS,GAAkB0P,EAAmB,EAAI3hB,EAAAA,SAAiB,CAAC,EAC5D,CAACoS,GAAcwP,EAAe,EAAI5hB,EAAAA,SAAiB,CAAC,EACpD,CAACmS,GAAc0P,EAAe,EAAI7hB,EAAAA,SAAiB,CAAC,EAEpD,CAAC8hB,GAAkBC,EAAmB,EAAI/hB,EAAAA,SAAiB,CAAC,EAC5D,CAACgiB,GAAcC,EAAe,EAAIjiB,EAAAA,SAAiB,CAAC,EACpD,CAACkiB,GAAmBC,EAAoB,EAAIniB,EAAAA,SAAiB,CAAC,EAC9D,CAACoiB,GAAeC,EAAgB,EAAIriB,EAAAA,SAAiB,CAAC,EAEtD,CAACsiB,GAAYC,EAAa,EAAIviB,EAAAA,SAAiB,CAAC,EAChD,CAACwiB,GAAYC,EAAa,EAAIziB,EAAAA,SAAiB,CAAC,EAChD,CAAC0iB,GAAYC,EAAa,EAAI3iB,EAAAA,SAAiB,CAAC,EAChD,CAAC4iB,GAAQC,EAAS,EAAI7iB,EAAAA,SAAiB,CAAC,EACxC,CAAC8iB,GAAQC,EAAS,EAAI/iB,EAAAA,SAAiB,CAAC,EACxC,CAACgjB,GAAQC,EAAS,EAAIjjB,EAAAA,SAAiB,CAAC,EACxC,CAACkjB,GAAuBC,EAAwB,EAAInjB,EAAAA,SAAiB,CAAC,EACtE,CAACojB,GAAmBC,EAAoB,EAAIrjB,EAAAA,SAAiB,CAAC,EAE9D,CAACsjB,GAAkBC,EAAmB,EAAIvjB,EAAAA,SAAkB,EAAK,EAEjE,CAACwjB,GAAWC,EAAY,EAAIzjB,EAAAA,SAAiB,EAAE,EAC/C,CAAC0jB,GAAgBC,EAAiB,EAAI3jB,EAAAA,SAAiB,EAAE,EACzD,CAAC4jB,GAAwBC,EAAyB,EACtD7jB,EAAAA,SAAiB,EAAE,EACf,CAAC8jB,GAA0BC,EAA2B,EAC1D/jB,EAAAA,SAAiB,EAAE,EACf,CAACgkB,GAAuBC,EAAwB,EACpDjkB,EAAAA,SAAiB,EAAE,EACf,CAACkkB,GAAyBC,EAA0B,EACxDnkB,EAAAA,SAAiB,EAAE,EACf,CAACokB,GAAoBC,EAAqB,EAAIrkB,EAAAA,SAI1C,IAAI,EACR,CAACskB,GAAmBrL,EAAoB,EAAIjZ,EAAAA,SAAkB,EAAK,EACnE,CAACukB,GAAYC,EAAa,EAAIxkB,EAAAA,SAAiC,CAAA,CAAE,EACjE,CAACykB,GAAoBC,EAAqB,EAAI1kB,EAAAA,SAAkB,EAAK,EACrE2kB,GAAkBhlB,EAAAA,OAAgC,IAAI,EACtDilB,GAAuBjlB,EAAAA,OAC3B,IAAA,EAGIklB,GAAyBpkB,EAAAA,YAAY,IAAM,CAC/C,MAAMoD,EAAQ+gB,GAAqB,QAC/B/gB,IACF,aAAaA,CAAK,EAClB+gB,GAAqB,QAAU,KAEnC,EAAG,CAAA,CAAE,EAECE,GAAiBrkB,EAAAA,YACpBskB,GAA8B,CAC7B,GAAI,CAACzQ,EAAe,OACpB,MAAM0Q,EAAU5Q,GAAM,UAAY,SAClC,GAAI,CACF5V,GACEwmB,EACAD,EAAQ,WACR,KAAK,IAAIA,EAAQ,UAAW,CAAC,EAC7BxQ,EACA,CAAE,OAAQC,EAAc,aAAcC,CAAA,CAAkB,CAE5D,MAAQ,CAAC,CACX,EACA,CACEH,EACAC,EACAC,EACAC,EACAL,GAAM,QAAA,CACR,EAGI6Q,GAAqBxkB,EAAAA,YACzB,CACEskB,EACAG,IACG,CACHR,GAAsB,EAAK,EAC3B,KAAM,CACJ,WAAAS,EACA,MAAAtU,EACA,aAAAuU,EACA,UAAAnnB,EACA,eAAAonB,EACA,SAAAhW,EACA,aAAAiW,EACA,gBAAAC,CAAA,EACER,EAEC1V,GAIHkH,EAAe,CAAC,EAChBmK,GAAe,QAAU,EACrB,OAAO6E,GAAoB,UAAYA,EAAkB,GAC3DpC,GAA0BxgB,GAAM,KAAK,IAAIA,EAAG4iB,CAAe,CAAC,IAN9DhP,EAAetY,CAAS,EACxByiB,GAAe,QAAUziB,GAS3BoiB,GAAwB8E,CAAU,EAE9BA,IAAe,IAAK5C,GAAevX,GAAMA,EAAI,CAAC,EACzCma,GAAc,IAAK1C,GAAezX,GAAMA,EAAI,CAAC,EAC7Cma,GAAc,KAAKxC,GAAe3X,GAAMA,EAAI,CAAC,EAElDsa,GAAgBD,EAAiB,IACnC3D,GAAqB9Y,GAAMA,EAAIyc,CAAc,EACzChW,GAAUsS,GAAqBhf,GAAMA,EAAI,CAAC,GAG3CoiB,EAAQ,WAAWD,GAAeC,CAAO,EAE9C,GAAI,CACFS,GAAS,SAAA,EAAW,YAAY,cAAe3U,EAAOsU,EAAY,CAChE,aAAAC,EACA,cAAe/V,EAAW,EAAIpR,EAC9B,OAAQoR,EACR,KAAM,EAAA,CACP,CACH,MAAQ,CAAC,CAELA,IACFiI,EAAoB,QAAQ,EAC5BV,EAAgB,EAAI,GAGtB3F,GAAQ5B,EAAW,EAAIpR,CAAS,EAEhCmiB,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BX,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BJ,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,CACxC,EACA,CACE7P,GACAkS,GACA7L,EACAf,EACA8J,GACAD,GACAH,GACAM,GACA3J,EACA2L,GACAE,GACAE,GACAjB,GACAC,GACAmD,EAAA,CACF,EAGIW,GAAuBhlB,EAAAA,YAC1BilB,GAAiC,CAChC,MAAMX,EAAUJ,GAAgB,QAC3BI,IACLJ,GAAgB,QAAU,KAC1BE,GAAA,EACAI,GAAmBF,EAASW,CAAO,EACrC,EACA,CAACb,GAAwBI,EAAkB,CAAA,EAGvCU,GAAoBllB,EAAAA,YACvBskB,GAA8B,CAC7BD,GAAeC,CAAO,EACtBJ,GAAgB,QAAU,CAAE,GAAGI,EAAS,UAAW,EAAA,EACnDL,GAAsB,EAAI,EAC1BG,GAAA,EACAD,GAAqB,QAAU,WAC7B,IAAMa,GAAqB,SAAS,EACpC7R,EAAA,CAEJ,EACA,CAACiR,GAAwBY,GAAsBX,EAAc,CAAA,EAG/DpiB,EAAAA,UAAU,IAAM,CACd,GAAI,CAACoT,GAAmB,OACxB,MAAM8P,EAAU,IAAMH,GAAqB,OAAO,EAClD,cAAO,iBAAiB,oBAAqBG,CAAwB,EAC9D,IACL,OAAO,oBAAoB,oBAAqBA,CAAwB,CAC5E,EAAG,CAAC9P,GAAmB2P,EAAoB,CAAC,EAE5C/iB,EAAAA,UAAU,IAAM,CACToT,IAAmB2P,GAAqB,SAAS,CACxD,EAAG,CAAC3P,GAAmB2P,EAAoB,CAAC,EAE5C/iB,EAAAA,UAAU,IAAM,IAAMmiB,KAA0B,CAACA,EAAsB,CAAC,EAExEniB,EAAAA,UAAU,IAAM,CACd,GAAIsd,KAAqB,EAAG,CAC1B,GAAI,CACF,OAAO,cACL,IAAI,YAAY,oBAAqB,CACnC,OAAQ,CAAE,OAAQ,eAAgB,GAAI,KAAK,KAAI,CAAE,CAClD,CAAA,CAEL,MAAQ,CAAC,CACTQ,GAAoB,QAAU,CAChC,CACAC,GAAkB,QAAUT,EAC9B,EAAG,CAACA,EAAgB,CAAC,EAErB,MAAM6F,GAAYzR,GAAM,UAAY,WAC9B0R,GAAgBvT,IAAO,OAAS,WAAaA,EAG7CwT,GAAW5U,GACf,MACAE,EACAC,EACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAkO,GACAqB,GACApP,GACAC,GACAC,GACAC,GACAC,EACAC,GACAC,CAEF,EACMyT,GAAe7U,GACnB,UACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAsB,EAAA,EAEIwT,GAAgB9U,GACpB,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAmB,GACAC,EACA,OACAE,GACAC,EAAA,EAEIwT,GAAc/U,GAClB,SACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAwB,EACAC,GACAC,GACAC,EAAA,EAEIqT,GAAYhV,GAAoB,MAAa,EAC7CiV,GAAajV,GAAoB,OAAc,EAC/CkV,GAAclV,GAAoB,QAAe,EAEjDmV,GAAwBpjB,EAAAA,QAAQ,IAAM,CAC1C,MAAMqjB,EAAOR,IAAY,CAAA,EACnBS,EACJxG,GAAmB,EACfrO,GACCE,IAAwBJ,GACzBgV,EACJpF,GAAe,EAAIzP,GAAcE,IAAoBJ,GACvD,OAAI6U,EAAK,SAAW,EACX,CACL,KAAMjU,GAAeuT,GAAYC,GACjC,cAAe,GACf,QAASxT,GAAef,GAAaC,GACrC,MAAOc,GAAejB,EAAcC,EACpC,UAAWgB,GAAekU,EAA0BC,CAAA,EAGjDF,EAAK,KAAMG,GAAWA,EAAO,aAAa,GAAKH,EAAK,CAAC,CAC9D,EAAG,CACDR,GACAzT,GACAuT,GACAC,GACAvU,GACAC,GACAH,EACAC,EACA0O,GACArO,GACAE,GACAJ,GACAG,GACAE,GACAJ,GACA2P,EAAA,CACD,EAEKsF,GAAwCzjB,EAAAA,QAAQ,IAAM,CAC1D,GAAI,CAACojB,GAAuB,MAAO,CAAA,EACnC,KAAM,CAAE,SAAAM,EAAU,WAAAC,EAAY,GAAGC,GAASR,GAC1C,MAAO,CACL,CAAE,GAAGQ,EAAM,SAAU,OAAW,WAAY,MAAA,CAAU,CAE1D,EAAG,CAACR,EAAqB,CAAC,EAEpBS,GAAqBzU,GAAewT,GAAgBD,GACpDmB,GACJV,IAAuB,OAAShU,GAAeuT,GAAYC,IACvDmB,GAAkB3U,GAAejB,EAAcC,EAC/C4V,GAAkB5U,GACpB0N,GAAmB,EACjBrO,GACCE,IAAwBJ,GAC3B4P,GAAe,EACbzP,GACCE,IAAoBJ,GAErByV,EAAa1mB,EAAAA,YAAY,CAACM,EAAcqmB,EAAQ,IAAM,CACtD,CAACrmB,GAAQqmB,GAAS,GACtB5C,GAAezf,IAAU,CACvB,GAAGA,EACH,CAAChE,CAAI,GAAIgE,EAAKhE,CAAI,GAAK,GAAKqmB,CAAA,EAC5B,CACJ,EAAG,CAAA,CAAE,EAECC,EAAiB5mB,cAAaM,GAAiB,CAC9CA,GACLyjB,GAAezf,GACTA,EAAKhE,CAAI,IAAM,OAAkBgE,EAC9B,CAAE,GAAGA,EAAM,CAAChE,CAAI,EAAG,CAAA,CAC3B,CACH,EAAG,CAAA,CAAE,EAEmBwjB,GAAWxO,CAAY,EAE/C,MAAMuR,GAA4Brf,GAAiC,CACjE,GAAI,CAACA,EAAM,KAAA,EAAQ,OAAO,KAC1B,MAAMsf,EAAS,OAAOtf,CAAK,EAC3B,OAAK,OAAO,SAASsf,CAAM,EACpB9T,GAAM,KAAK,MAAM8T,CAAM,EAAG,EAAG/U,CAAQ,EADP,IAEvC,EAEMgV,GAA2Bvf,GAAiC,CAChE,GAAI,CAACA,EAAM,KAAA,EAAQ,OAAO,KAC1B,MAAMsf,EAAS,OAAOtf,CAAK,EAC3B,OAAK,OAAO,SAASsf,CAAM,EACpB,KAAK,IAAI,EAAG,KAAK,MAAMA,CAAM,CAAC,EADA,IAEvC,EAEME,GAAyBhnB,EAAAA,YAAY,IAAM,CAC3CkkB,GAAgB,UAClBA,GAAgB,QAAU,MAE5BE,GAAA,EACAH,GAAsB,EAAK,CAC7B,EAAG,CAACG,EAAsB,CAAC,EAEMpkB,EAAAA,YAC9BinB,GAAsB,CACrB,MAAMC,EAAYlU,GAAMiU,EAAW,EAAGlV,CAAQ,EAC9CiV,GAAA,EACAlR,EAAeoR,CAAS,EACxBjH,GAAe,QAAUiH,EAEzB,MAAMC,EAAiBD,IAAc,EAAInV,EAAWmV,EACpDxH,GAAoByH,CAAc,EAClC/G,GAAoB,QAAU+G,EAE9BxH,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BX,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BJ,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EAEtCT,GAAwB,IAAI,EAC5BN,GAAkB,CAAC,EACnB5G,EAAoB,CAAC,EACrBqH,GAAoB,QAAU,EAE1BmH,IAAc,GAChBrQ,EAAoB,QAAQ,EAC5BV,EAAgB,EAAI,IAEpBU,EAAoB,IAAI,EACxBV,EAAgB,EAAK,EAEzB,EACA,CACE6Q,GACAlR,EACA/D,EACA2N,GACAC,GACAH,GACAM,GACAF,GACAN,GACA5G,EACA7B,EACAV,CAAA,CACF,EAGF,MAAMiR,GAA6BzpB,GAA4B,CAG7D,MAAMmpB,EAASD,GADkCxD,EACH,EAC9C,GAAIyD,IAAW,KAAM,CACnBzP,GAAM,gCAAgCtF,CAAQ,GAAI,CAChD,KAAM,QACN,QAAS,IAAA,CACV,EACD,MACF,CAMEgE,GAAW+Q,CAAM,EACjBnG,GAAc,CAAC,EACfE,GAAgB,CAAC,EACjBC,GAAoB,IAAI,EACxBE,GAAwB,CAAC,EACzBN,GAAc,CAAC,EACf4C,GAA4B,EAAE,EAEhCzM,EAAoB,IAAI,EACxBV,EAAgB,EAAK,CACvB,EAEMkR,GAAyBrnB,EAAAA,YAC7B,CAACrC,EAAyB6J,IAAkB,CACtC7J,IAAW,UACb2Y,EAAc9O,CAAK,EACnBgc,GAAyB,EAAE,IAE3B7M,GAAUnP,CAAK,EACfkc,GAA2B,EAAE,GAE/B7M,EAAoB,IAAI,EACxBV,EAAgB,EAAK,CACvB,EACA,CACEQ,GACA+M,GACAF,GACA3M,EACAP,EACAH,CAAA,CACF,EAGImR,GAA4B3pB,GAA4B,CAG5D,MAAMmpB,EAASC,GADbppB,IAAW,SAAW4lB,GAAwBE,EACH,EAC7C,GAAIqD,IAAW,KAAM,CACnBzP,GAAM,6CAA8C,CAClD,KAAM,QACN,QAAS,IAAA,CACV,EACD,MACF,CACAuM,GAAsB,CAAE,OAAAjmB,EAAQ,MAAOmpB,EAAQ,MAAO,EAAG,CAC3D,EAEMS,GAAuBvnB,EAAAA,YAAY,IAAM,CAC7C4jB,GAAuBtf,GAChBA,IACDA,EAAK,QAAU,EAAU,CAAE,GAAGA,EAAM,MAAO,CAAA,GAC/C+iB,GAAuB/iB,EAAK,OAAQA,EAAK,KAAK,EACvC,MACR,CACH,EAAG,CAAC+iB,EAAsB,CAAC,EAErBG,GAAsBxnB,EAAAA,YAAY,IAAM,CAC5C4jB,GAAsB,IAAI,CAC5B,EAAG,CAAA,CAAE,EAEL3hB,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC0hB,GAAoB,OACzB,MAAM8D,EAAaC,GAAyB,CACtCA,EAAM,MAAQ,WAChBA,EAAM,eAAA,EACNF,GAAA,EAEJ,EACA,cAAO,iBAAiB,UAAWC,CAAS,EACrC,IAAM,OAAO,oBAAoB,UAAWA,CAAS,CAC9D,EAAG,CAACD,GAAqB7D,EAAkB,CAAC,EAa5C,MAAMgE,IAVwBC,GAAiB,CAC7C,OAAQA,EAAA,CACN,IAAK,QACH,MAAO,wBACT,IAAK,QACH,MAAO,oBACT,QACE,MAAO,qBAAA,CAEb,GAC6ClT,EAAQ,EAE/CmT,GAAc3oB,EAAAA,OAA8B,IAAI,EAChD4oB,GAAa5oB,EAAAA,OAA8B,IAAI,EAC/C6oB,GAAe7oB,EAAAA,OAA8B,IAAI,EAEjD,CAAC8oB,GAAYC,EAAa,EAAI1oB,EAAAA,SAA2B,OAAO,EAChE,CAAC2oB,GAAaC,EAAc,EAAI5oB,EAAAA,SAAiB,CAAC,EAClD6oB,GAAYlpB,EAAAA,OAA8B,IAAI,EAEpD+C,EAAAA,UAAU,IAAM,CACd,MAAMsI,EAAI,KAAK,IAAI,EAAG,KAAK,MAAM,OAAO2d,EAAW,GAAK,CAAC,CAAC,EACpDG,EAAOL,KAAe,QAAUzd,EAAI,KAAK,IAAI,EAAG,KAAK,KAAKA,EAAI,CAAC,CAAC,EACtE8L,GAAWgS,CAAI,CACjB,EAAG,CAACL,GAAYE,EAAW,CAAC,EAC5BjmB,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC+V,GAAQ,CACXG,GAAY,CAAC,EACbE,GAAkB,EAAK,EACvB,MACF,CACA,MAAMiQ,EAAU,IAAM,CACpB,MAAMC,EAAWV,GAAY,QACvBW,EAAUV,GAAW,QAC3B,GAAI,CAACS,GAAY,CAACC,EAAS,OAE3B,MAAMC,EAAUV,GAAa,QACzBA,GAAa,QAAQ,sBAAA,EAAwB,OAC7C,EACEW,EAAS,KAAK,IAAI,EAAGH,EAAS,aAAeE,EAAU,CAAC,EACxDE,EAAS,KAAK,IAAI,EAAGJ,EAAS,YAAc,CAAC,EAE7CK,EAAOJ,EAAQ,sBAAA,EACfK,EAAe3Q,IAAY,EAC3B4Q,EAAgBF,EAAK,OAASC,EAC9BE,EAAeH,EAAK,MAAQC,EAE5BG,GAASN,EAAS,EAAIA,EAASI,EAAgB,EAC/CG,GAASN,EAAS,EAAIA,EAASI,EAAe,EAC9Cvd,GAAO,KAAK,IAAI,EAAG,KAAK,IAAI,GAAK,KAAK,IAAIwd,GAAQC,EAAM,CAAC,CAAC,EAC1DC,GAAeJ,EAAgBtd,GAC/B2d,GAAcT,EAAS,GAAKQ,GAAeR,EAAS,EAC1DrQ,GAAkB8Q,EAAW,EAC7BhR,GAAY3M,EAAI,CAClB,EACA8c,EAAA,EACA,MAAMc,EAAW,OAAe,eAC1BC,EAAKD,EAAK,IAAIA,EAAG,IAAMd,EAAA,CAAS,EAAI,KAC1C,OAAAe,GAAMxB,GAAY,SAAWwB,EAAG,QAAQxB,GAAY,OAAc,EAClEwB,GAAMvB,GAAW,SAAWuB,EAAG,QAAQvB,GAAW,OAAc,EAChE,OAAO,iBAAiB,SAAUQ,CAAO,EAClC,IAAM,CACX,OAAO,oBAAoB,SAAUA,CAAO,EAC5C,GAAI,CACFe,GAAMxB,GAAY,SAAWwB,EAAG,UAAUxB,GAAY,OAAc,CACtE,MAAQ,CAAC,CACT,GAAI,CACFwB,GAAMvB,GAAW,SAAWuB,EAAG,UAAUvB,GAAW,OAAc,CACpE,MAAQ,CAAC,CACX,CACF,EAAG,CAAC9P,GAAQE,EAAQ,CAAC,EAGrBjW,EAAAA,UAAU,IAAM,CACd,MAAMqnB,EAAU7jB,GAAW,CACzB,MAAMuE,EAAIvE,GAAG,QAAQ,KAChBuE,IACLuL,GAAgBvL,CAAC,EAEjBuf,GAAA,EACF,EACA,cAAO,iBAAiB,iBAAkBD,CAAa,EAChD,IAAM,OAAO,oBAAoB,iBAAkBA,CAAa,CACzE,EAAG,CAAA,CAAE,EAGLrnB,EAAAA,UAAU,IAAM,CACd,MAAMunB,EAAS/jB,GAAW,CACxB,MAAM5H,EAAI4H,GAAG,QAAQ,WACfmD,EAAInD,GAAG,QAAQ,YACf3H,EAAI2H,GAAG,QAAQ,YACjB5H,IAAM,SAAWA,IAAM,YAAsBA,CAAC,EAC9C,OAAO+K,GAAM,UAAY,SAASA,CAAC,GACrCuf,GAAe,KAAK,IAAI,EAAG,KAAK,MAAMvf,CAAC,CAAC,CAAC,EACvC,OAAO9K,GAAM,UAAY,SAASA,CAAC,GACrC0X,GAAY,KAAK,IAAI,EAAG,KAAK,MAAM1X,CAAC,CAAC,CAAC,CAC1C,EACA,cAAO,iBAAiB,qBAAsB0rB,CAAY,EACnD,IAAM,OAAO,oBAAoB,qBAAsBA,CAAY,CAC5E,EAAG,CAAA,CAAE,EAGLvnB,EAAAA,UAAU,IAAM,CACd,GAAI,CAACkS,EAAkB,OAEvB,MAAM3H,EAAK,WAAW,IAAM+c,GAAA,EAAc,EAAE,EAC5C,MAAO,IAAM,aAAa/c,CAAE,CAC9B,EAAG,CAAC2H,CAAgB,CAAC,EAGrBlS,EAAAA,UAAU,IAAM,CACd,GAAI,CAACsV,IAAkB1F,IAAgBC,IAAO,QAAUwO,IAAiB,EACvE,OACF,IAAImJ,EACAC,EAAO,YAAY,IAAA,EACvB,MAAMC,EAAQC,GAAgB,CAC5B,MAAMC,EAAKD,EAAMF,EACjBA,EAAOE,EACPrJ,GAAkBjc,GAAS,CACzB,MAAMkH,EAAOlH,EAAOulB,EACpB,GAAIre,GAAQ,EAAG,CAEb,IAAIse,EAAa,EACbpF,EAAa,EACblnB,EAAYqT,EAEhB,IADAgQ,GAAgB,CAAC,EACViJ,EAAa,GAAKtsB,EAAY,GAAG,CACtC,MAAMusB,EAAc3W,GAAa5V,EAAWsU,CAAE,EAExCkY,EAAOhX,GACX+W,EAAcD,EAAa,GAC3B,EACA,KAAK,IAAI,GAAItsB,CAAS,CAAA,EAElB0N,GAAQ1N,EAAYwsB,EAI1B,GAHAtJ,GAAcsJ,CAAI,EAClBvJ,GAAkBzc,IAAMA,GAAI,CAAC,EAC7Bwd,GAAiBxd,IAAMA,GAAI,CAAC,EACxBkH,GAAQ,EAAG,CAEb1N,EAAYqT,EACZ8P,GAAc,CAAC,EACfK,GAAwB,CAAC,EACzB0D,EAAa,EACb5D,GAAoB,CAAC,EACrBD,GAAgB,CAAC,EACjB,KACF,CAEA6D,GAAcsF,EACdrJ,GAAe7iB,IAAMA,GAAIksB,CAAI,EAC7BpI,GAAkBxY,IAAMA,GAAI4gB,CAAI,EAEhC,MAAMC,GAASzsB,EACT0sB,GAAUhf,GAMhB,GALI+e,GAAS,IAAMC,IAAW,MAA4B,CAAC,EAClDD,IAAU,IAAIjJ,GAAyBpY,IAAMA,GAAI,CAAC,EAC3DpL,EAAY0N,GACZ4e,GAAc,EACdjJ,GAAgBiJ,CAAU,EACtBtsB,IAAc,EAAG,KACvB,CAEA,GADAuY,GAAWvY,CAAS,EAChBA,IAAc,EAAG,CAEfknB,IAAe,IAAKtC,GAAW7X,GAAMA,EAAI,CAAC,EACrCma,GAAc,IAAKpC,GAAW/X,GAAMA,EAAI,CAAC,EACzCma,GAAc,KAAKlC,GAAWjY,GAAMA,EAAI,CAAC,EAElD,MAAM4f,EAAWtZ,EACbsZ,GAAY,KACdvH,GAAsB1gB,GAAM,KAAK,IAAIA,EAAGioB,CAAQ,CAAC,EAE/CtZ,GAAW,KACbsQ,GACGhZ,GACCA,GAAK4Y,GAAuB,EAAIA,GAAuB,EAAA,EAE3DK,GAAiBlf,GAAMA,EAAI,CAAC,GAE9B4e,GAAoB4D,CAAU,EAC9B/D,GAAc,CAAC,EACfK,GAAwB,CAAC,EACzBH,GAAgB,CAAC,EAEjBhK,EAAoB,IAAI,EACxBV,EAAgB,EAAI,CACtB,CAEA,OAAI3Y,EAAY,GAAKssB,GAAc,IAC7BpF,IAAe,IAAKtC,GAAW7X,GAAMA,EAAI,CAAC,EACrCma,GAAc,IAAKpC,GAAW/X,GAAMA,EAAI,CAAC,EACzCma,GAAc,KAAKlC,GAAWjY,GAAMA,EAAI,CAAC,EAClDuW,GAAoB4D,CAAU,EAC9B/D,GAAc,CAAC,EACfK,GAAwB,CAAC,EACzBH,GAAgB,CAAC,GAGnBA,GAAgB,CAAC,EACjBvI,GAAgB,EAAI,EACb,CACT,CACA,OAAO9M,CACT,CAAC,EACDie,EAAM,sBAAsBE,CAAI,CAClC,EACA,OAAAF,EAAM,sBAAsBE,CAAI,EACzB,IAAM,qBAAqBF,CAAG,CACvC,EAAG,CAAClS,GAAgB1F,GAAcC,EAAIjB,CAAO,CAAC,EAE9C5O,EAAAA,UAAU,IAAM,CACTsO,GAAM,aACPmG,GAAoB,UACxBD,GAAqB,EAAI,EACzBC,GAAoB,QAAU,IAChC,EAAG,CAACnG,GAAM,UAAU,CAAC,EAErB,SAASgZ,IAAa,CACpB1T,GAAW,EAAI,EACfC,EAAe/D,CAAQ,EACvBkO,GAAe,QAAUlO,EACzBgE,GAAWhE,CAAQ,EACnBkE,GAAY,EAAK,EACjBuB,GAAkB,EAAI,EACtBc,GAAgB,EAAI,EACpBI,EAAoB,CAAC,EACrB2G,GAAqB,CAAC,EACtBC,GAAkB,CAAC,EACnBE,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BR,GAAoB3N,CAAQ,EAC5B4N,GAAkB,CAAC,EACnBC,GAAwB,IAAI,EAC5BE,GAA4B,CAAC,EAC7BS,GAAiB,CAAC,EAClBE,GAAiB,CAAC,EAClBC,GAAc,CAAC,EACfC,GAAc,CAAC,EACfE,GAAgB,CAAC,EACjBC,GAAoB,IAAI,EACxBjK,EAAoB,IAAI,EAExBP,EAAc,CAAC,EACfK,GAAU,CAAC,EACXO,GAAY,CAAA,CAAE,EAEd2F,GAAc,CAAC,EACfE,GAAe,CAAC,EAChBI,GAAkB,EAAK,EAEvBmE,GAAoB,CAAC,EACrBE,GAAgB,CAAC,EACjBE,GAAqB,CAAC,EACtBE,GAAiB,CAAC,EAClBE,GAAc,CAAC,EACfE,GAAc,CAAC,EACfE,GAAc,CAAC,EACfE,GAAU,CAAC,EACXE,GAAU,CAAC,EACXE,GAAU,CAAC,EACXE,GAAyB,CAAC,EAC1BE,GAAqB,CAAC,EACtB3B,GAAoB,CAAC,EACrBC,GAAoB,CAAC,EACrBC,GAAgB,CAAC,EACjBC,GAAgB,CAAC,EACjBwF,EAAe,KAAK,EAEpB,MAAMrc,EAAI,KAAK,IAAI,EAAG,KAAK,MAAM,OAAO2d,EAAW,GAAK,CAAC,CAAC,EAE1D,GADA7R,GAAW2R,KAAe,QAAUzd,EAAI,KAAK,IAAI,EAAG,KAAK,KAAKA,EAAI,CAAC,CAAC,CAAC,EACjE0J,EACF,GAAI,CACFC,EAAe,CACb,KAAMoB,EACN,SAAUvD,EACV,QAAAqE,GACA,QAAStE,CAAA,CACV,CACH,MAAQ,CAAC,CAEb,CAEA,SAASsY,IAAe,CACtBtU,EAAe/D,CAAQ,EACvBkO,GAAe,QAAUlO,EACzBgE,GAAWhE,CAAQ,EACnBkE,GAAY,EAAK,EACjBuB,GAAkB,EAAI,EACtBc,GAAgB,EAAI,EACpBI,EAAoB,CAAC,EACrB2G,GAAqB,CAAC,EACtBC,GAAkB,CAAC,EACnBE,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BR,GAAoB3N,CAAQ,EAC5B4N,GAAkB,CAAC,EACnBS,GAAoB,QAAUrO,EAC9BoO,GAAkB,QAAU,EAC5BP,GAAwB,IAAI,EAC5BE,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtCA,GAA4B,QAAU,EACtCE,GAAiB,CAAC,EAClBE,GAAiB,CAAC,EAClBC,GAAc,CAAC,EACfC,GAAc,CAAC,EACfE,GAAgB,CAAC,EACjBC,GAAoB,IAAI,EACxBjK,EAAoB,IAAI,CAC1B,CAGA,SAASrG,GAAQ6Z,EAAuB,CACtC7K,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BR,GAAoB2K,IAAkB,EAAItY,EAAWsY,CAAa,EAClEjK,GAAoB,QAClBiK,IAAkB,EAAItY,EAAWsY,EACnCvK,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EAClCvO,IAAO,QACTwG,GAAgB,EAAK,EACrBiI,GAAiBpJ,EAAS,IAE1BoJ,GAAiB,CAAC,EAClBjI,GAAgB,EAAI,EAExB,CAEA,SAASgS,GAAeN,EAAc,CACpC,GAAI3U,IAAqB6O,GAAgB,QAAS,CAC3CF,IAAoBC,GAAsB,EAAI,EACnD5M,GAAM,mDAAoD,CACxD,KAAM,OACN,QAAS,IAAA,CACV,EACD,MACF,CACAqP,EAAW,KAAK,EAChB,MAAM6D,EAAetK,GAAe,QAC9BuK,EAAoBtK,GAAoB,QACxCuK,EAAkBtK,GAAkB,QACpCuK,EAAoBtK,GAAoB,QACxCuK,EAA4BtK,GAA4B,QACxD7iB,EAAY+sB,EAAeP,EAC3BY,EAAgBJ,EAAoB,EAM1C,GAJAlL,GAAkB0K,CAAI,EACtB3K,GAAsBrb,IAAMA,GAAI,CAAC,EACjCsd,GAAqBtd,IAAMA,GAAI,CAAC,EAE5BxG,EAAY,EAAG,CACjB,GAAI,CACF,MAAMmnB,GAAe4F,EACfM,GAAgBH,EACtB3F,GAAS,SAAA,EAAW,YAAY,cAAe6F,EAAe,EAAG,CAC/D,aAAAjG,GACA,cAAAkG,GACA,KAAM,GACN,OAAQ,EAAA,CACT,CACH,MAAQ,CAAC,CAIT,GAHA/U,EAAe4U,CAAiB,EAChCzK,GAAe,QAAUyK,EAErBH,GAAgB,GAAI,CACtB,MAAMO,IAAqBH,GAA6B,GAAK,EAC7D1J,GAAqB9Y,IAAMA,GAAI2iB,EAAiB,CAClD,CAEA,GAAIjX,EACF,GAAI,CACF9V,GACE4V,GAAM,UAAY,SAClB,EACA,KAAK,IAAI+W,EAAmB,CAAC,EAC7B5W,EACA,CAAE,OAAQC,EAAc,aAAcC,CAAA,CAAkB,CAE5D,MAAQ,CAAC,CAGX4L,GAAwB,CAAC,EACzBlH,EAAoB,CAAC,EACrBiH,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtC7P,GAAQka,CAAiB,EACzB,MACF,CAEA5U,EAAetY,CAAS,EACxByiB,GAAe,QAAUziB,EAEzBgiB,GAAoBoL,CAAa,EACjC1K,GAAoB,QAAU0K,EAC9B,MAAMG,EAAcN,EAAkBT,EACtCrK,GAAkBoL,CAAW,EAC7B5K,GAAkB,QAAU4K,EAE5BrJ,GAAsBtY,IAAMA,GAAI4gB,CAAI,EACpCtR,EAAoB,CAAC,EAErB,MAAMiM,EAAe4F,EACfM,EAAgBrtB,EAChBwtB,EAAsBrG,EAAe,IAAMkG,GAAiB,GAC5DI,GAAsBtG,GAAgB,GACxCqG,GACFlL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,GAC7B4K,KACTnL,GAA6BlX,IAAMA,GAAI,CAAC,EACxCyX,GAA4B,SACzBsK,GAA6B,GAAK,GAGvC,MAAMO,GAAoB7K,GAA4B,SAAW,EAC3D8K,GAAiBxG,GAAgB,GACjCyG,GAAmBD,GACrB,KAAK,IAAID,GAAmB,KAAK,IAAIN,EAAe,CAAC,CAAC,EACtD,EAEJ,GAAIptB,IAAc,EAAG,CACnB,MAAM8mB,GAA4B,CAChC,WAAYyG,EACZ,MAAOH,EACP,aAAcL,EACd,UAAW,EACX,eAAgBa,GAChB,SAAU,GACV,aAAcD,GACd,gBAAiBT,GAAqB,IAAMA,EAAoB,IAAA,EAE9DrV,GACF6P,GAAkBZ,EAAO,EAEzBE,GAAmBF,GAAS,WAAW,EAEzC,MACF,CAEA,GAAIsG,GAAiB,EAAG,CACtB,MAAMtG,GAA4B,CAChC,WAAYyG,EACZ,MAAOH,EACP,aAAcL,EACd,UAAA/sB,EACA,eAAgB4tB,GAChB,SAAU,GACV,aAAcD,GACd,gBAAiB,IAAA,EAEf9V,GACF6P,GAAkBZ,EAAO,EAEzBE,GAAmBF,GAAS,WAAW,EAEzC,MACF,CACF,CAEA,SAAS+G,IAAiB,CACxB,MAAMrB,EAAOhX,GAAM,KAAK,MAAM,OAAOyF,CAAgB,GAAK,CAAC,EAAG,EAAG,EAAE,EACnE6R,GAAeN,CAAI,CACrB,CAEA,SAAS9Z,GAAuBob,EAA2B,CACzD,GAAI,CAAC,OAAO,SAASA,CAAQ,EAAG,MAAO,GAEvC,MAAMC,EAAanL,GAAoB,QACjCoL,EAAYvL,GAAe,QAC3BwL,EAAgBvL,GAAoB,QACpCwL,EAAcvL,GAAkB,QAChCwL,EAAkBF,EAAgB,GAAKC,EAAc,EAEvDC,IACF7V,EAAeyV,CAAU,EACzBtL,GAAe,QAAUsL,EACzB/L,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BP,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtCf,GAAkB,CAAC,EACnB5G,EAAoB,CAAC,EACrB2G,GAAsBrb,GAAM,KAAK,IAAI,EAAGA,EAAIynB,CAAa,CAAC,EAC1DnK,GAAqBtd,GAAM,KAAK,IAAI,EAAGA,EAAIynB,CAAa,CAAC,EACzD/J,GAAsB,GAAM,KAAK,IAAI,EAAG,EAAIgK,CAAW,CAAC,EACxD3L,GAAoB,QAAU,GAGhC,MAAM4E,EAAegH,EAAkBJ,EAAaC,EAC9CI,EAAcjH,GAAgB,IAAM,IAAM,IAC1CkH,EAAQ7Y,GAAM,KAAK,MAAMsY,CAAQ,EAAG,EAAGM,CAAW,EAExDlF,EAAW,MAAO,CAAC,EACnBrH,GAAsBrb,GAAMA,EAAI,CAAC,EACjCsd,GAAqBtd,GAAMA,EAAI,CAAC,EAChCwb,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BP,GAAkBkM,CAAK,EACvB1L,GAAkB,QAAU0L,EAC5BjM,GAAwBiM,CAAK,EAEzBA,IAAU,IAAK/J,GAAevX,GAAMA,EAAI,CAAC,EACpCshB,GAAS,IAAK7J,GAAezX,GAAMA,EAAI,CAAC,EACxCshB,GAAS,KAAK3J,GAAe3X,GAAMA,EAAI,CAAC,EAEjD,MAAM/M,EAAYmnB,EAAekH,EAEjC,GAAIruB,EAAY,EAAG,CACjB,GAAIqW,EACF,GAAI,CACF9V,GAASqnB,GAAW,EAAG,KAAK,IAAImG,EAAY,CAAC,EAAGzX,EAAa,CAC3D,OAAQC,EACR,aAAcC,CAAA,CACf,CACH,MAAQ,CAAC,CAEX,GAAI,CACF+Q,GAAS,SAAA,EAAW,YAAY,cAAe,EAAG,EAAG,CACnD,aAAAJ,EACA,cAAe4G,EACf,KAAM,GACN,OAAQ,EAAA,CACT,CACH,MAAQ,CAAC,CACT,OAAAzV,EAAeyV,CAAU,EACzBtL,GAAe,QAAUsL,EACzB3L,GAAwB,CAAC,EACzBD,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BX,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BJ,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtC7P,GAAQ+a,CAAU,EACX,EACT,CAMA,GAJAzV,EAAetY,CAAS,EACxByiB,GAAe,QAAUziB,EACzBkkB,GAAsB,GAAM,EAAImK,CAAK,EAEjChY,EACF,GAAI,CACF9V,GAASqnB,GAAWyG,EAAO,KAAK,IAAIruB,EAAW,CAAC,EAAGsW,EAAa,CAC9D,OAAQC,EACR,aAAcC,CAAA,CACf,CACH,MAAQ,CAAC,CAQX,GALI2Q,GAAgB,KAClB1D,GAAqB9Y,GAAMA,EAAI,CAAC,EAC5B3K,IAAc,GAAG0jB,GAAqBhf,GAAMA,EAAI,CAAC,GAGnD1E,IAAc,EAAG,CACfmnB,GAAgB,KAClBjC,GAA0BxgB,GAAM,KAAK,IAAIA,EAAGyiB,CAAY,CAAC,EAC3D,GAAI,CACFI,GAAS,SAAA,EAAW,YAAY,cAAe,EAAG8G,EAAO,CACvD,aAAAlH,EACA,cAAe,EACf,OAAQ,GACR,KAAM,EAAA,CACP,CACH,MAAQ,CAAC,CACT,OAAA9N,EAAoB,QAAQ,EAC5BV,EAAgB,EAAI,EACpBqJ,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BP,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EAC/B,EACT,CAEA,GAAI,CACF0E,GAAS,SAAA,EAAW,YAAY,cAAe,EAAG8G,EAAO,CACvD,aAAAlH,EACA,cAAennB,EACf,OAAQ,GACR,KAAM,EAAA,CACP,CACH,MAAQ,CAAC,CACT,OAAAgT,GAAQhT,CAAS,EACjBmiB,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BX,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BJ,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EAC/B,EACT,CAGA,MAAMyL,GAAoCzb,GAA0B,CAClE,MAAAE,GACA,uBAAAL,GACA,QAAAM,EAAA,CACD,EAGK,CAACub,GAAiBC,EAAkB,EAAIzsB,EAAAA,SAAiB,EAAE,EAC3D0sB,GAA0BtlB,GAAgB,CAC9C,GAAI,CAACA,EAAK,CACRqlB,GAAmB,EAAE,EACrB,MACF,CACA,MAAME,EAAcvlB,EAAI,QAAQ,UAAW,EAAE,EAC7C,GAAI,CAACulB,EAAa,CAChBF,GAAmB,EAAE,EACrB,MACF,CACA,MAAMlF,EAAS,OAAOoF,CAAW,EACjC,GAAI,CAAC,OAAO,SAASpF,CAAM,EAAG,OAC9B,MAAMqF,EAAalM,GAAe,SAAW,IAAM,IAAM,IACnDmM,EAAOpZ,GAAM,KAAK,MAAM8T,CAAM,EAAG,EAAGqF,CAAU,EACpDH,GAAmB,OAAOI,CAAI,CAAC,CACjC,EACA,SAASC,IAAgB,CACvB,GAAI,CAACN,GAAiB,CACpB,MAAM,sCAAsC,EAC5C,MACF,CACA,MAAMjF,EAAS,OAAOiF,EAAe,EACrC,GAAI,CAAC,OAAO,SAASjF,CAAM,EAAG,CAC5B,MAAM,sCAAsC,EAC5C,MACF,CACA,MAAMqF,EAAalM,GAAe,SAAW,IAAM,IAAM,IACnDqM,EAAUtZ,GAAM,KAAK,MAAM8T,CAAM,EAAG,EAAGqF,CAAU,EACnDrF,EAASqF,GACX9U,GAAM,8BAA8B8U,CAAU,IAAK,CACjD,KAAM,OACN,QAAS,IAAA,CACV,EAECjc,GAAuBoc,CAAO,GAChCN,GAAmB,EAAE,CAEzB,CAEA,MAAMO,GAAoBvsB,EAAAA,YAAY,IAAM,CACtCkkB,GAAgB,UAClBA,GAAgB,QAAU,KAC1BE,GAAA,EACAH,GAAsB,EAAK,GAE7B,MAAM6F,EAAa5J,GAAoB,QACjCwE,EAAavE,GAAkB,QAC/BoL,EAAanL,GAAoB,QACnC0J,IAAe,GAAKpF,IAAe,IACvC5O,EAAeyV,CAAU,EACzBtL,GAAe,QAAUsL,EACzB/L,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BP,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtCf,GAAkB,CAAC,EACnB5G,EAAoB,CAAC,EACrB2G,GAAsBrb,GAAM,KAAK,IAAI,EAAGA,EAAI8lB,CAAU,CAAC,EACvDxI,GAAqBtd,GAAM,KAAK,IAAI,EAAGA,EAAI8lB,CAAU,CAAC,EACtDpI,GAAsBtY,GAAM,KAAK,IAAI,EAAGA,EAAIsb,CAAU,CAAC,EACvD3E,GAAoB,QAAU,EAChC,EAAG,CAACqE,EAAsB,CAAC,EAE3BniB,EAAAA,UAAU,IAAM,CACd,MAAMuqB,EAAkBC,GAAe,CACrC,MAAMC,EAAUD,GAAqB,OACjC,CAACC,GAAUA,GAAQ,SAAW,gBAClCH,GAAA,CACF,EACA,cAAO,iBACL,0BACAC,CAAA,EAEK,IACL,OAAO,oBACL,0BACAA,CAAA,CAEN,EAAG,CAACD,EAAiB,CAAC,EAGtB,SAASI,GAAWC,EAAa,CAC/BlG,EAAW,iBAAiB,EAC5B,MAAMsD,EAAOhX,GAAM,KAAK,MAAM4Z,GAAO,CAAC,EAAG,EAAG,EAAE,EAI9C,GAHAtN,GAAkB0K,CAAI,EACtB3K,GAAsBrb,GAAMA,EAAI,CAAC,EACjCsd,GAAqBtd,GAAMA,EAAI,CAAC,EAC5B4F,GAAYogB,EAAMrR,EAAO,EAAG,CAC9B,MAAMkU,EAAWhU,GAAS,EAC1BC,GAAU+T,CAAQ,EAClBjU,GAAYtM,GAAM,KAAK,IAAI,GAAIA,EAAI,CAAC,CAAC,EAEjCugB,GAAY,KACdhW,EAAoB,QAAQ,EAC5BV,EAAgB,EAAI,EAExB,CACAuC,EAAoB,CAAC,CACvB,CACA,SAASoU,IAAe,CACtBH,GAAW,OAAOlU,CAAgB,CAAC,CACrC,CACA,SAASsU,IAAc,CACrB,MAAMvuB,EAAIsL,GAAgBiZ,EAAS,EACnC,GAAIvkB,GAAK,KAAM,CACb,MAAM,6BAA6B,EACnC,MACF,CACAmuB,GAAWnuB,CAAC,EACZwkB,GAAa,EAAE,CACjB,CAGA,SAASgK,GACPxlB,EACAkD,EACArC,EACS,CACT,GAAI8R,GAAa,MAAO,GACxBuM,EAAW,UAAU,EACrB,MAAM/oB,EAASgc,GACTsT,EACHviB,IAAS,UAAYrC,IAAW1K,GAChC,CAAC+M,GAAQlD,IAAU7J,EAAS,EAC/B,OAAIsvB,GAAK/S,GAAYhY,GAAMA,EAAI,CAAC,EAChC8X,GAAahW,GAAM,CACjB,MAAMkpB,EAAKlpB,EAAI,EACf,GAAIkpB,GAAM,EAAG,CACX,MAAMC,EAAYlT,IAAWgT,EAAM,EAAI,GACnCE,EAAY,EAAGrT,GAAahc,GAAMA,EAAIqvB,EAAYxvB,EAAS,CAAC,EAC3Dmc,GAAahc,GAAMA,EAAIH,EAAS,CAAC,EACtC,MAAM6N,EAAO7N,EAAS,EACtB,OAAAic,GAAYpO,CAAI,EAChB0O,GAAW,CAAC,EACR1O,EAAO,IAAI4O,GAAe,EAAI,EAC3B,CACT,CACA,OAAO8S,CACT,CAAC,EACM,EACT,CACA,SAASE,IAAgB,CACvBJ,GAAW,KAAK,IAAI,EAAGvU,EAAmB,CAAC,CAAC,EAC5CC,EAAoB,CAAC,CACvB,CACA,SAAS2U,IAAW,CAClBzT,GAAY,CAAC,EACbE,GAAY,EAAE,EACdE,GAAY,CAAC,EACbE,GAAW,CAAC,EACZE,GAAe,EAAK,EACpBwM,EAAe,UAAU,CAC3B,CAGA,SAAS0G,GAAe9lB,EAAwB,CAC9C,OAAAkf,EAAW,UAAU,EACrBlM,GAAY,GAAM,EAAI,KAAK,IAAI,EAAGhT,EAAQ,CAAC,CAAC,EAC5CkT,GAAY1W,GAAM,CAChB,MAAMkpB,EAAKlpB,EAAI,EACf,OAAIkpB,GAAM,GACR5S,GAAYlY,GAAMA,EAAI,CAAC,EAChB,GAEF8qB,CACT,CAAC,EACM,EACT,CACA,SAASK,GAAiB/lB,EAAwB,CAChD,OAAAkf,EAAW,YAAY,EACvB3L,GAAY,GAAM,EAAI,KAAK,IAAI,EAAGvT,EAAQ,CAAC,CAAC,EAC5CyT,GAAYjX,GAAM,CAChB,MAAMkpB,EAAKlpB,EAAI,EACf,OAAIkpB,GAAM,GACRrS,GAAYzY,GAAMA,EAAI,CAAC,EAChB,GAEF8qB,CACT,CAAC,EACM,EACT,CACA,SAASM,GAAgBhmB,EAAwB,CAC/C,OAAAkf,EAAW,WAAW,EACtBpL,GAAY,GAAM,EAAI,KAAK,IAAI,EAAG9T,EAAQ,CAAC,CAAC,EAC5CgU,GAAYxX,GAAM,CAChB,MAAMkpB,EAAKlpB,EAAI,EACf,OAAIkpB,GAAM,GACR9R,GAAYhZ,GAAMA,EAAI,CAAC,EAChB,GAEF8qB,CACT,CAAC,EACM,EACT,CAGA,SAASO,GACPC,EACAC,EACAvd,EACAwd,EACAC,EACAC,EACAtmB,EACAkD,EACA,CACA,MAAMc,EAAOkiB,EAAMlmB,EACnB,GAAI,EAAAgE,EAAO,GAEX,GAAWA,IAAS,EAAG,CACrB,GAAId,IAAS,UAAYA,IAAS,aAAc,CAC9CojB,EAAchwB,GAAMA,EAAI,CAAC,EACzB+vB,EAAa1lB,GAAMA,EAAI,CAAC,EACxBylB,EAAS,IAAM,CAAC,EAChBD,EAAOD,CAAG,EACV,MACF,CACAC,EAAOniB,CAAI,CACb,MACEmiB,EAAOniB,CAAI,EAEboiB,EAAU5pB,GAAM,CACd,MAAMkpB,EAAKlpB,EAAI,EACf,OAAIkpB,GAAM,GACRW,EAAa1lB,GAAMA,EAAI,CAAC,EACjB,GAEF+kB,CACT,CAAC,CACH,CACA,SAASa,GACPvmB,EACAkD,EACS,CACT,OAAAgc,EAAW,cAAc,EACzB+G,GACE/R,GACAC,GACAC,GACAC,GACAE,GACAE,GACAzU,EACAkD,CAAA,EAEEkR,GAAa,GAAK,GAAGD,GAAY,GAAG,EACjC,EACT,CACA,SAASqS,GACPxmB,EACAkD,EACS,CACT,OAAAgc,EAAW,cAAc,EACzB+G,GACEvR,GACAC,GACAC,GACAC,GACAE,GACAE,GACAjV,EACAkD,CAAA,EAEE0R,GAAa,GAAK,GAAGD,GAAY,GAAG,EACjC,EACT,CACA,SAAS8R,GAAYC,EAAgB,CACnC,MAAM1vB,EAAIsL,GAAgBiZ,EAAS,EACnC,GAAIvkB,GAAK,KAAM,CACb,MAAM,6BAA6B,EACnC,MACF,CACA,MAAMX,EAAIklB,GAAU,KAAA,EAAO,YAAA,EACrBoL,EACJtwB,EAAE,WAAW,GAAG,GAChBA,IAAM,MACNA,IAAM,QACNA,IAAM,SACNA,IAAM,SACNA,EAAE,SAAS,OAAO,EAChBqwB,EAAOH,GAAavvB,EAAG2vB,EAAW,SAAW,MAAS,EACrDH,GAAaxvB,EAAG2vB,EAAW,SAAW,MAAS,EACpDnL,GAAa,EAAE,CACjB,CACA,SAASoL,IAAa,CACpBzS,GAAY,GAAG,EACfE,GAAc,CAAC,EACfE,GAAiB,CAAC,EAClBE,GAAkB,CAAC,EACnB2K,EAAe,cAAc,CAC/B,CACA,SAASyH,IAAa,CACpBlS,GAAY,GAAG,EACfE,GAAc,CAAC,EACfE,GAAiB,CAAC,EAClBE,GAAkB,CAAC,EACnBmK,EAAe,cAAc,CAC/B,CAGA,SAAS0H,GACP9mB,EACAkD,EACArC,EACS,CACT,OAAI6U,GAAuB,IAC3BwJ,EAAW,iBAAiB,GAEzBhc,IAAS,UAAYrC,IAAWqU,IAChC,CAAChS,GAAQlD,IAAUkV,GAAe,IAC1BG,GAAe3a,GAAMA,EAAI,CAAC,EACrC6a,GAAgB/Y,GAAM,CACpB,MAAMkpB,EAAKlpB,EAAI,EAEf,GAAIkpB,EAAK,IAAM,GAAK,CAAC,GAAI,GAAI,EAAE,EAAE,SAASxQ,EAAY,EAAG,CACvD,MAAM6R,EAAQ,CAAC,GAAI,GAAI,EAAE,EACnB9hB,EAAM8hB,EAAM,QAAQ7R,EAAY,EAChClR,EAAO+iB,GAAO9hB,EAAM,GAAK8hB,EAAM,MAAM,EAC3C5R,GAAgBnR,CAAI,CACtB,CAEA,OAAIwR,GAAiB,GAAKkQ,GAAMlQ,OAAkC,EAAI,EAC/DkQ,CACT,CAAC,EACM,GACT,CACA,SAASsB,IAAc,CACrB3R,GAAc,CAAC,EACfE,GAAe,CAAC,EAChBI,GAAkB,EAAK,EACvByJ,EAAe,iBAAiB,CAClC,CAGA,SAAS6H,GACPjnB,EACAkD,EACArC,EACS,CACT,OAAAqe,EAAW,UAAU,EACrBrJ,GAAa/Y,GAAS,CACpB,MAAMoqB,EAAK,CAAE,GAAGpqB,CAAA,EAChB,OAAAgJ,GAAkBohB,EAAWlnB,EAAOkD,EAAarC,CAAM,EAChDqmB,CACT,CAAC,EACM,EACT,CACA,SAASC,IAAgB,CACvBtR,GAAYhQ,IAAgB,EAC5BuZ,EAAe,UAAU,CAC3B,CAGA,SAASgI,GACPpnB,EACAkD,EACArC,EACS,CACT,OAAAqe,EAAW,MAAM,EACjBnJ,GAASjZ,GAAS,CAChB,MAAMoqB,EAAK,CAAE,GAAGpqB,CAAA,EAChB,OAAAoJ,GAAcghB,EAAWlnB,EAAOkD,EAAarC,CAAM,EAC5CqmB,CACT,CAAC,EACM,EACT,CACA,SAASG,IAAY,CACnBtR,GAAQ9P,IAAY,EACpBmZ,EAAe,MAAM,CACvB,CAGA,SAASkI,GACP5gB,EACA1G,EACAkD,EACArC,EACS,CACT,OAAAqe,EAAW,aAAa,EACxBjJ,GAAQnZ,GAAS,CACf,MAAMoqB,EAAK,CAAE,GAAGpqB,EAAM,MAAO,CAAC,GAAGA,EAAK,KAAK,CAAA,EAC3C,OAAA2J,GAAaygB,EAAWxgB,EAAa1G,EAAOkD,EAAarC,CAAM,EACxDqmB,CACT,CAAC,EACM,EACT,CACA,SAASK,IAAW,CAClBtR,GAAO7P,IAAiB,EACxBgZ,EAAe,aAAa,CAC9B,CAGA,SAASoI,GACPxnB,EACAkD,EACArC,EACS,CACT,OAAAqe,EAAW,kBAAkB,EAC7B/I,GAAcrZ,GAAS,CACrB,MAAMoqB,EAAK,CAAE,GAAGpqB,EAAM,MAAO,CAAE,GAAGA,EAAK,MAAM,EAC7C,OAAAwL,GAAmB4e,EAAWlnB,EAAOkD,EAAarC,EAAQ,IAAM,EAAK,EAC9DqmB,CACT,CAAC,EACM,EACT,CACA,SAASO,IAAiB,CACxBtR,GAAa9N,IAAsB,EACnC+W,EAAe,kBAAkB,CACnC,CAGA,SAASsI,GACPtC,EACAliB,EACArC,EACS,CACTqe,EAAW,kBAAkB,EAC7B,MAAM/oB,EAASwM,GAAU4O,EAAQ,EACjC,IAAIkU,EAAM,GAcZ,GAZI,OAAO5kB,GAAW,UAClBA,IAAW1K,IACV+M,IAAS,UAAYA,IAAS,UAAYA,IAAS,YAEpDuiB,EAAM,IACJtvB,IAAW,KAAO+M,IAAS,QAAUkiB,IAAQ,MAAKK,EAAM,IACxDtvB,IAAW,KAAO+M,IAAS,cAAgBkiB,IAAQ,MAAKK,EAAM,IAC7DA,IAECL,IAAQjvB,GAAUivB,IAAQjvB,EAAS,GAAKivB,IAAQjvB,EAAS,KAC3DsvB,EAAM,IAERA,EAAK,CACL,MAAMkC,EAAUlW,GAAU,EAC1B,OAAAC,GAAWiW,CAAO,EAClBnW,GAAa1M,GAAMA,EAAI,CAAC,EACjB,EACT,CACA,MAAO,EACT,CACA,SAAS8iB,IAAgB,CACvBF,GAAY,KAAK,IAAI,EAAGzW,EAAmB,CAAC,CAAC,EAC7CC,EAAoB,CAAC,CACvB,CACA,SAAS2W,IAAe,CACtB,MAAM7wB,EAAIsL,GAAgBiZ,EAAS,EACnC,GAAIvkB,GAAK,KAAM,CACb,MAAM,4BAA4B,EAClC,MACF,CACA0wB,GAAY1wB,CAAC,EACbwkB,GAAa,EAAE,CACjB,CAGA,SAASsM,GACP9nB,EACAkD,EACArC,EACS,CACT,OAAAqe,EAAW,SAAS,EACpBvN,GAAY7U,GAAS,CACnB,MAAMirB,EAAO,CAAE,GAAGjrB,EAAM,MAAO,CAAE,GAAGA,EAAK,MAAM,EAC/C,OAAAkG,GAAiB+kB,EAAa/nB,EAAOkD,EAAMrC,EAAQ,IAAM,EAAK,EACvDknB,CACT,CAAC,EACD7V,GAAsB1V,GAAM,CAC1B,MAAMkpB,EAAKlpB,EAAI,EACf,OAAIkpB,GAAM,EAAU,EACbA,CACT,CAAC,EACM,EACT,CACA,SAASsC,IAAoB,CAC3BF,GAAe,KAAK,IAAI,EAAG7W,EAAmB,CAAC,CAAC,EAChDC,EAAoB,CAAC,CACvB,CAGA,SAAS+W,GACPjoB,EACAkD,EACArC,EACS,CACT,OAAAqe,EAAW,UAAU,EACrBtN,GAAa9U,GAAS,CACpB,MAAMirB,EAAO,CAAE,GAAGjrB,EAAM,SAAU,CAAE,GAAGA,EAAK,SAAS,EACrD,OAAAgH,GAAkBikB,EAAa/nB,EAAOkD,EAAMrC,CAAM,EAC3CknB,CACT,CAAC,EACD7V,GAAsB1V,GAAM,CAC1B,MAAMkpB,EAAKlpB,EAAI,EACf,OAAIkpB,GAAM,GACR9T,GAAa9U,GAAS,CACpB,MAAMoqB,EAAK,CAAE,GAAGpqB,EAAM,SAAU,CAAE,GAAGA,EAAK,SAAS,EACnD,OAAAiH,GAAgBmjB,CAAS,EAClBA,CACT,CAAC,EACM,GAEFxB,CACT,CAAC,EACM,EACT,CACA,SAASwC,IAAqB,CAC5BD,GAAgB,KAAK,IAAI,EAAGhX,EAAmB,CAAC,CAAC,EACjDC,EAAoB,CAAC,CACvB,CAGA,SAASiX,GACPnoB,EACAkD,EACArC,EACS,CACT,OAAAqe,EAAW,UAAU,EACrBpN,GAAUhV,GAAS,CACjB,MAAMirB,EAAO,CAAE,GAAGjrB,EAAM,QAAS,CAAC,GAAGA,EAAK,OAAO,CAAA,EACjD,OAAAqH,GAAiB4jB,EAAa/nB,EAAOkD,EAAMrC,CAAM,EAC1CknB,CACT,CAAC,EACD7V,GAAsB1V,GAAM,CAC1B,MAAMkpB,EAAKlpB,EAAI,EACf,OAAIkpB,GAAM,GACR5T,GAAUhV,GAAS,CACjB,MAAMoqB,EAAK,CAAE,GAAGpqB,EAAM,QAAS,CAAC,GAAGA,EAAK,OAAO,CAAA,EAC/C,OAAAsH,GAAe8iB,CAAS,EACjBA,CACT,CAAC,EACM,GAEFxB,CACT,CAAC,EACM,EACT,CACA,SAAS0C,IAAkB,CACzBD,GAAa,KAAK,IAAI,EAAGlX,EAAmB,CAAC,CAAC,EAC9CC,EAAoB,CAAC,CACvB,CAGA,SAASmX,GACProB,EACAkD,EACArC,EACS,CACT,OAAAqe,EAAW,UAAU,EACrBlN,GAAYlV,GAAS,CACnB,MAAMirB,EAAO,CAAE,GAAGjrB,CAAA,EAClB,OAAAwH,GAAiByjB,EAAa/nB,EAAOkD,EAAMrC,CAAM,EAC1CknB,CACT,CAAC,EACD7V,GAAsB1V,GAAM,CAC1B,MAAMkpB,EAAKlpB,EAAI,EACf,OAAIkpB,GAAM,GACR1T,GAAYlV,GAAS,CACnB,MAAMoqB,EAAK,CAAE,GAAGpqB,CAAA,EAChB,OAAAyH,GAAe2iB,CAAS,EACjBA,CACT,CAAC,EACM,GAEFxB,CACT,CAAC,EACM,EACT,CACA,SAAS4C,IAAoB,CAC3BD,GAAe,KAAK,IAAI,EAAGpX,EAAmB,CAAC,CAAC,EAChDC,EAAoB,CAAC,CACvB,CAEA,SAASqX,IAAgC,CACvC,MAAM,EAAIhN,GAAU,KAAA,EAAO,YAAA,EAC3B,GAAI,CAAC,EAAG,OAAO,KACf,GAAI,IAAM,MAAQ,IAAM,QAAU,IAAM,SAAW,IAAM,QAAS,MAAO,IACzE,GAAI,IAAM,MAAQ,IAAM,QAAS,MAAO,IACxC,MAAM/Y,EAAI,EAAE,MAAM,wBAAwB,EAC1C,GAAI,CAACA,EAAG,OAAO,KACf,MAAMC,EAAQD,EAAE,CAAC,GAAK,IAChBE,EAAM,SAASF,EAAE,CAAC,EAAG,EAAE,EAC7B,OAAIE,EAAM,GAAKA,EAAM,GAAW,KAEzBA,GADSD,IAAS,IAAM,EAAIA,IAAS,IAAM,EAAI,EAExD,CAEA,SAAS+lB,IAAY,CACnB,MAAMpD,EAAMmD,GAAA,EACZ,GAAInD,GAAO,KAAM,CACf,MAAM,gCAAgC,EACtC,MACF,CACAtC,GAAesC,CAAG,EAClB5J,GAAa,EAAE,CACjB,CAEA,SAASiN,IAAoB,CAC3B,MAAMliB,EAAQkV,GACX,KAAA,EACA,MAAM;AAAA,CAAI,EACV,IAAKrQ,GAAMA,EAAE,KAAA,CAAM,EACnB,OAAQA,GAAMA,CAAC,EAClB,GAAI7E,EAAM,SAAW,EACrB,WAAWmiB,KAAQniB,EAAO,CACxB,MAAM6e,EAAM9iB,GAAgBomB,CAAI,EAChC,GAAItD,GAAO,KAAM,CACf,MAAM,kBAAkBsD,CAAI,EAAE,EAC9B,MACF,CACA5F,GAAesC,CAAG,CACpB,CACA1J,GAAkB,EAAE,EACtB,CAEA,SAASiN,IAAc,CACjB5Q,KAAqB,IAEzBzJ,EAAgBhY,GAAMA,EAAIkT,EAAc,EACxCwO,GAAqBxb,GAAM,KAAK,IAAI,EAAGA,EAAI,CAAC,CAAC,EAC/C,CAEA,SAASosB,IAAoB,CAC3B,MAAMxD,EAAMmD,GAAA,EACZ,GAAInD,GAAO,KAAM,CACf,MAAM,gCAAgC,EACtC,MACF,CACA,GAAIrN,KAAqB,EAAG,CAC1ByQ,GAAA,EACA,MACF,CAEA,MAAMK,EAASrf,GACf8E,EAAgBhY,GAAMA,EAAIuyB,CAAM,EAChC7Q,GAAqBxb,GAAM,KAAK,IAAI,EAAGA,EAAI,CAAC,CAAC,EAE7C,WAAW,IAAMsmB,GAAesC,CAAG,EAAG,CAAC,EACvC5J,GAAa,EAAE,CACjB,CAyBA,SAASsN,IAAuB,CAC9B,MAAMC,EAAS3Z,GAAoB,SAE7B4Z,EACJD,IAAW,SACP1Q,IAA4B,OAC5BkB,IAAwB,OACxB0P,EAAgB,EAChBC,EAAcH,IAAW,SAAWnR,GAAoBoB,GAC9DtJ,GAAY,CACV,GAAGtF,EACH,CACE,OAAA2e,EACA,YAAAzZ,EACA,cAAAE,EACA,YAAA0Z,EACA,WAAYF,EACZ,WAAYC,CAAA,CACd,CACD,EACDta,EAAgB,EAAK,EAErB,IAAI/M,EAAI0H,GACJ3I,EAAI4I,GAOR,GANI6F,IAAqB,SAAUxN,GAAK,EAC/BwN,IAAqB,OAAMzO,GAAK,GACzCmO,EAAclN,CAAC,EACfuN,GAAUxO,CAAC,EACX0O,EAAoB,IAAI,EAEpBzN,GAAKgN,IAAWjO,GAAKiO,GAAS,CAGhC,GAAI,CACFua,GAAarb,EAAcib,IAAW,QAAQ,CAChD,MAAQ,CAAC,CACT/Y,GAAkB,EAAK,EACvB3B,GAAW,EAAK,EAEhBC,EAAe/D,CAAQ,EACvBgE,GAAWhE,CAAQ,EACnB+Q,GAAoB,EAAI,EACxB,MACF,CAEAsH,GAAA,CACF,CAGA,MAAMwG,GAAgB,CADCC,GAAU,SAASvb,CAAmB,GACpB,EAAE3B,GAAM,YAAcA,GAAM,OAIrE,OACEhM,EAAAA,KAAC,MAAA,CAAI,UAAU,+CACZ,SAAA,CAAA6O,IACCxU,EAAAA,IAAC8uB,GAAA,CACC,QAAUvgB,GAAM,SAAW,CAAA,EAC3B,OAAQ,IAAMkG,GAAqB,EAAK,CAAA,CAAA,EAG5C9O,EAAAA,KAAC,KAAA,CAAG,UAAU,yCAAyC,SAAA,CAAA,eACxC,IACZiM,IAAkB,UACjB5R,EAAAA,IAAC,OAAA,CAAK,UAAU,wFAAwF,SAAA,gBAAA,CAExG,QAEC,OAAA,CAAK,UAAU,qHAAqH,SAAA,gBAErI,CAAA,EAEJ,EACA2F,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,cAAgBlC,GAAM,CAAGA,EAAU,gBAAA,CAAmB,EACtD,YAAcA,GAAM,CAAEA,EAAE,gBAAA,CAAmB,EAC3C,aAAeA,GAAM,CAAGA,EAAU,kBAAA,CAAqB,EACvD,UAAU,eACV,MAAO6P,EACP,SAAW7P,GAAM8P,GAAgB9P,EAAE,OAAO,KAAK,EAE9C,SAAA,CAAAorB,GAAU,IAAKvwB,GACd0B,EAAAA,IAAC,UAAkB,MAAO1B,EACvB,SAAAA,CAAA,EADUA,CAEb,CACD,EACAywB,GAAa,IAAKzwB,GACjBqH,EAAAA,KAAC,SAAA,CAEC,MAAOrH,EACP,SAAU,EAAEqT,GAAM,YAAcA,GAAM,OAErC,SAAA,CAAArT,EAAK,IAAEqT,GAAM,YAAcA,GAAM,MAAQ,GAAK,WAAA,CAAA,EAJ1CrT,CAAA,CAMR,CAAA,CAAA,CAAA,QAIF0wB,GAAA,CAAsB,SAAU1b,EAAc,QAAS,GAAM,EAE7DA,IAAiB,mBAChB3N,OAAC,MAAA,CAAI,UAAU,kDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,OAAC,QAAA,CAAM,UAAU,gBAAgB,SAAA,kBAAe,EAChD3F,EAAAA,IAAC,QAAA,CACC,UAAU,eACV,KAAK,SACL,IAAK,EACL,KAAM,EACN,MAAOgb,GACP,SAAWvX,GACTwX,GACE,KAAK,IAAI,EAAG,KAAK,MAAM,OAAOxX,EAAE,OAAO,KAAK,GAAK,EAAE,CAAC,CAAA,CACtD,CAAA,CAEJ,EACF,QACC,MAAA,CAAI,UAAU,uCAAuC,SAAA,0FAGtD,CAAA,EACF,EAED,CAACkO,GAAM,YACNhM,EAAAA,KAAC,MAAA,CAAI,UAAU,gHACb,SAAA,CAAA3F,EAAAA,IAAC,QAAK,SAAA,KAAE,EACRA,EAAAA,IAAC,QAAK,SAAA,2GAGN,CAAA,EACF,EAEDsT,IAAiB,OAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,QAAA,CAAM,UAAU,qBAAqB,SAAA,iCAEtC,EACA5F,EAAAA,IAAC,QAAA,CACC,UAAU,eACV,KAAK,SACL,IAAK,EACL,IAAK,KACL,MAAO+P,EACP,SAAWtM,GAAM+P,GAAY,OAAO/P,EAAE,OAAO,KAAK,CAAC,CAAA,CAAA,QAEpD,QAAA,CAAM,UAAU,qBAAqB,SAAA,uBAAoB,EAC1DkC,EAAAA,KAAC,SAAA,CACC,cAAgBlC,GAAM,CAAGA,EAAU,gBAAA,CAAmB,EACtD,YAAcA,GAAM,CAAEA,EAAE,gBAAA,CAAmB,EAC3C,aAAeA,GAAM,CAAGA,EAAU,kBAAA,CAAqB,EACvD,UAAU,eACV,MAAOqM,EACP,SAAWrM,GAAMgQ,GAAMhQ,EAAE,OAAO,KAAK,EAErC,SAAA,OAAC,SAAA,CAAO,MAAM,OAAO,SAAA,OAAI,EACxBsN,GAAS,IAAKM,GACbrR,EAAAA,IAAC,UAAmB,MAAOqR,EACxB,SAAAA,CAAA,EADUA,CAEb,CACD,CAAA,CAAA,CAAA,EAEFvB,IAAO,QACNnK,OAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,OAAC,QAAA,CAAM,UAAU,gBAAgB,SAAA,2BAEjC,EACA3F,EAAAA,IAAC,QAAA,CACC,UAAU,eACV,KAAK,SACL,IAAK,GACL,IAAK,GACL,KAAM,GACN,MAAOmV,GAAY,IACnB,SAAW1R,GACT2R,GAAa,KAAK,MAAM,OAAO3R,EAAE,OAAO,KAAK,EAAI,GAAI,CAAC,CAAA,CAAA,CAE1D,EACF,QACC,MAAA,CAAI,UAAU,yBAAyB,SAAA,mDAExC,CAAA,EACF,EAEFzD,EAAAA,IAAC,UAAO,UAAU,WAAW,QAAS,IAAM2T,GAAa,EAAI,EAAG,SAAA,0BAAA,CAEhE,CAAA,EACF,EAEDL,IAAiB,mBAChBtT,EAAAA,IAAC,MAAA,CAAI,UAAU,sBAAsB,SAAA,4FAAA,CAGrC,CAAA,EAEJ,EACC,CAAC4T,IACA5T,EAAAA,IAAC,SAAA,CACC,UAAU,MACV,SAAU4uB,GACV,MAAOA,GAAgB,iCAAmC,GAC1D,QAASrH,GACV,SAAA,aAAA,CAAA,EAKFhS,IACCvV,EAAAA,IAAC,MAAA,CACC,UAAW,6BAA6B8V,GAAY,GAAK,6CAA6C,GAEtG,SAAA9V,EAAAA,IAACivB,GAAA,CACC,WAAW,0BACX,UAAW,GAAGnZ,GAAY,gCAAkC,EAAE,0CAC9D,WAAYA,GACZ,aAAc,KACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,KACV,UAAW,KACX,iBAAgB,GAGhB,SAAAnQ,EAAAA,KAAC,MAAA,CACC,UAAU,kDACV,MAAO,CAAE,UAAW,QAAA,EACpB,IAAMupB,GAAO,CACVrJ,GAAoB,QAAUqJ,CACjC,EAEA,SAAA,CAAAlvB,EAAAA,IAAC,MAAA,CACC,IAAMkvB,GAAO,CACVnJ,GAAqB,QAAUmJ,CAClC,EAEA,SAAAlvB,EAAAA,IAACmvB,GAAA,CACC,KACExpB,EAAAA,KAAAC,WAAA,CACE,SAAA,OAAC,OAAA,CAAK,UAAU,gIAAgI,SAAA,YAEhJ,EACAD,EAAAA,KAAC,OAAA,CAAK,UAAU,gCACb,SAAA,CAAA2N,EACAA,IAAiB,MAAQ,MAAMvD,CAAQ,GAAK,EAAA,EAC/C,EACApK,EAAAA,KAAC,OAAA,CAAK,UAAU,+BAA+B,SAAA,CAAA,YACnCyO,GAAQ,WAAStF,GAAW,IAAEC,EAAA,EAC1C,EACA/O,EAAAA,IAAC,OAAA,CACC,UAAW,+DAA+D4R,IAAkB,SAAW,2DAA6D,2CAA2C,GAE9M,SAAAA,IAAkB,SACf,gBACA,gBAAA,CAAA,CACN,EACF,EAEF,MACEjM,EAAAA,KAAAC,WAAA,CAEE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,MAAG,EAChC3F,EAAAA,IAAC,SAAA,CACC,UAAU,2BACV,QAAS,IACPoS,EACE,KAAK,IACH,GACA,KAAK,OAAOpO,EAAc,KAAQ,GAAG,EAAI,GAAA,CAC3C,EAGJ,MAAM,uBACP,SAAA,GAAA,CAAA,EAGD2B,EAAAA,KAAC,OAAA,CAAK,UAAU,kBACb,SAAA,CAAA,KAAK,MAAM3B,EAAc,GAAG,EAAE,GAAA,EACjC,EACAhE,EAAAA,IAAC,SAAA,CACC,UAAU,2BACV,QAAS,IACPoS,EACE,KAAK,IACH,KACA,KAAK,OAAOpO,EAAc,KAAQ,GAAG,EAAI,GAAA,CAC3C,EAGJ,MAAM,uBACP,SAAA,GAAA,CAAA,CAED,EACF,EACAhE,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,MAAOgW,GAAS,cAAgB,UAChC,QAAS,IAAMC,GAAWzZ,GAAM,CAACA,CAAC,EAEjC,YAAS,cAAgB,SAAA,CAAA,EAE5BwD,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,MAAO8V,GAAY,UAAY,WAC/B,QAAS,IAAMC,GAAc/N,GAAM,CAACA,CAAC,EAEpC,YAAY,UAAY,UAAA,CAAA,EAE3BhI,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbunB,GAAA,CACF,EACD,SAAA,SAAA,CAAA,EAGDvnB,EAAAA,IAAC,SAAA,CACC,UAAU,sDACV,QAAS,IAAM0V,GAAiB,EAAI,EACrC,SAAA,MAAA,CAAA,CAED,EACF,CAAA,CAAA,CAEJ,CAAA,EAEDD,IACCzV,EAAAA,IAACovB,GAAA,CACC,QAAS,IAAM1Z,GAAiB,EAAK,EACrC,OAAQ,IAAM,CACZ,GAAI,CACF2Z,GAAiB,CAAE,KAAM,OAAQ,CACnC,MAAQ,CAAC,CACT7Z,GAAkB,EAAK,EACvB3B,GAAW,EAAK,EAChB6B,GAAiB,EAAK,CACxB,EACA,QAAU4Z,GAAY,CACpB,MAAMC,EAAS,KAAK,IAAA,EAAQD,EAAU,GAAK,IAC3C,GAAI,CACF3Z,GAAU,GAAM4Z,CAAM,EACtBF,GAAiB,CAAE,KAAM,QAAS,YAAaE,EAAQ,eAAgB,KAAK,IAAA,EAAO,CACrF,MAAQ,CAAC,CACT7Z,GAAiB,EAAK,CACxB,CAAA,CAAA,EAGJ/P,EAAAA,KAAC,MAAA,CACC,IAAMupB,GAAO,CACVpJ,GAAmB,QAAUoJ,CAChC,EACA,UAAU,wBACV,MACElZ,GACI,CACE,UAAW,SAASE,EAAQ,IAC5B,gBAAiB,WACjB,MAAO,OACP,SAAU,GAAG,KAAK,IAAI,GAAK,KAAK,IAAI,EAAGA,EAAQ,CAAC,CAAC,IAAA,EAEnD,OAGN,SAAA,CAAAlW,MAAC,MAAG,UAAU,4CACX,SAAAsT,IAAiB,MAAQ,YAAcA,EAC1C,EACA3N,EAAAA,KAAC,MAAA,CAAI,UAAU,iDACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,8DAA8D,SAAA,CAAA,SACrE2N,CAAA,EACT,EACA3N,EAAAA,KAAC,OAAA,CAAK,UAAU,8DAA8D,SAAA,CAAA,UACpEoK,CAAA,EACV,EACApK,EAAAA,KAAC,MAAA,CACC,IAAKygB,GACL,UAAU,6FAEV,SAAA,CAAApmB,EAAAA,IAAC,QAAK,SAAA,UAAO,GACX,IAAM,CACN,MAAMwvB,EACJ5gB,IAAgBmB,GAChBlB,IAAYkB,GACZwN,GAAmB,EACfkS,EAAU,QAAQD,EAAW,gCAAkC,gBAAgB,IACrF,OACE7pB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAW,GAAGyvB,CAAO,IAAIzJ,KAAe,QAAU,eAAiB,aAAa,GAChF,QAAS,IAAM,CACRwJ,GAAUvJ,GAAc,OAAO,CACtC,EACA,MAAM,aACP,SAAA,UAAA,CAAA,EAGDjmB,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAW,GAAGyvB,CAAO,IAAIzJ,KAAe,OAAS,eAAiB,aAAa,GAC/E,QAAS,IAAM,CACRwJ,GAAUvJ,GAAc,MAAM,CACrC,EACA,MAAM,8BACP,SAAA,SAAA,CAAA,CAED,EACF,EACAjmB,EAAAA,IAAC,QAAA,CACC,UAAW,0BAA0BwvB,EAAW,aAAe,EAAE,GACjE,KAAK,SACL,IAAK,EACL,KAAM,EACN,MAAOtJ,GACP,SAAWziB,GACT0iB,GACE,KAAK,IACH,EACA,KAAK,MAAM,OAAO1iB,EAAE,OAAO,KAAK,GAAK,CAAC,CAAA,CACxC,EAGJ,SAAA+rB,EACA,MACExJ,KAAe,QACX,aACA,8BAAA,CAAA,CAER,EACF,CAEJ,GAAA,CAAG,CAAA,CAAA,EAELrgB,EAAAA,KAAC,OAAA,CAAK,UAAU,8DAA8D,SAAA,CAAA,SACrEmJ,GAAW,IAAEC,EAAA,EACtB,EAEApJ,EAAAA,KAAC,MAAA,CAAI,UAAU,wDACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,QAAK,EAClCA,EAAAA,KAAC,SAAA,CACC,UAAW,OAAOggB,EAAe,GACjC,MAAO9S,GACP,SAAWpP,GACTqP,GAAarP,EAAE,OAAO,KAA8B,EAGtD,SAAA,OAAC,SAAA,CAAO,MAAM,UAAU,SAAA,UAAO,QAC9B,SAAA,CAAO,MAAM,UAAU,SAAA,UAAO,CAAA,CAAA,CAAA,EAEjCzD,EAAAA,IAAC,QAAA,CACC,UAAW,SAAS2lB,EAAe,cACnC,MAAO5S,GACP,SAAWtP,GAAMuP,GAAavP,EAAE,OAAO,KAAK,EAC5C,YAAY,QAAA,CAAA,QAEb,OAAA,CAAK,UAAU,aAAa,SAAA,KAAE,EAC/BzD,EAAAA,IAAC,QAAA,CACC,UAAW,SAAS2lB,EAAe,cACnC,MAAO1S,GACP,SAAWxP,GAAMyP,GAAazP,EAAE,OAAO,KAAK,EAC5C,YAAY,QAAA,CAAA,CACd,EACF,CAAA,EACF,EACC6P,IAAiB,MAChB3N,OAAC,MAAA,CAAI,UAAU,4FACZ,SAAA,CAAA2N,IAAiB,mBAChBtT,MAAA4F,EAAAA,SAAA,CACE,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,iBAAc,EAC3C3F,MAAC,QAAK,UAAU,gFACb,YAAsB2W,EAAO,GAAG,OAAS,GAAA,CAC5C,CAAA,CAAA,CACF,CAAA,CAEF,EAEDrD,IAAiB,oBAChBtT,MAAA4F,EAAAA,SAAA,CACE,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,iBAAc,QAC1C,OAAA,CAAK,UAAU,gFACb,SAAAwC,GAAU4O,EAAQ,IAAM,GACrB,kBACA5O,GAAU4O,EAAQ,IAAM,GACtB,kBACA5O,GAAU4O,EAAQ,GAAK,IAC/B,CAAA,CAAA,CACF,CAAA,CAEF,EAEDzD,IAAiB,WAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,yDAG7C,QACC,MAAA,CAAI,UAAU,sDACZ,SAAAwC,GAAgB,IAAKG,GACpB5C,EAAAA,KAAC,MAAA,CAEC,UAAU,yDAEV,SAAA,CAAA3F,MAAC,OAAI,UAAU,aACZ,SAAAuI,IAAM,GAAK,OAASA,EACvB,EACA5C,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACZ,SAAA,CAAA,KAAK,IAAI,EAAGqK,GAAQ,QAAQzH,CAAC,GAAK,CAAC,EAAE,MAAA,EACxC,CAAA,CAAA,EARKA,CAAA,CAUR,EACH,EACA5C,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,UACf,IACR3F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,YAAQ,OACX,CAAA,EACF,EACC0vB,GAAiB1f,EAAO,GACvBrK,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX3F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbmX,GAAW9O,IAAoB,EAC/BqP,GAAqB,CAAC,EACtBkN,EAAe,SAAS,CAC1B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDtR,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAA3F,EAAAA,IAAC,QAAK,SAAA,QAAK,EACXA,EAAAA,IAAC,OAAA,CAAK,UAAU,iHACb,YAAS,MACZ,CAAA,EACF,EACA2F,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9CsK,GAAS,KAAA,EACnB,EACCA,GAAS,UACRtK,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX3F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACboX,GAAYhO,IAAqB,EACjCsO,GAAqB,CAAC,EACtBkN,EAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDtR,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAA3F,EAAAA,IAAC,QAAK,SAAA,QAAK,EACX2F,EAAAA,KAAC,OAAA,CAAK,UAAU,iHACb,SAAA,CAAA0R,GAAM,MAAQ,EAAE,IAAEA,GAAM,QAAQ,MAAA,EACnC,CAAA,EACF,EACA1R,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,UACf,UACP,OAAA,CAAK,UAAU,gBACZ,UAAA,IAAM,CACN,MAAM,EAAI+D,GAAsB2N,EAAK,EACrC,OAAK,EACD,EAAE,OAAS,aAAqB,MAChC,EAAE,OAAS,OAAe,OAE5B,EAAE,OAAS,UACX,EAAE,OAAS,UACX,EAAE,OAAS,SAEJ,GAAG,EAAE,IAAI,IAAK,EAAU,GAAG,GAC7B,IATQ,GAUjB,KACF,CAAA,EACF,EACA1R,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9C0R,GAAM,KAAA,EAChB,EACCA,GAAM,UACL1R,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX3F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbsX,GAAS7N,IAAsB,EAC/BiO,GAAqB,CAAC,EACtBkN,EAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDtR,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/B4R,GAAQ,MAAM,aAAWA,GAAQ,MAAA,EAC1C,EACA5R,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9C4R,GAAQ,KAAA,EAClB,EACCA,GAAQ,UACP5R,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX3F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbwX,GAAW3N,IAAe,EAC1B6N,GAAqB,CAAC,EACtBkN,EAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDtR,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAA3F,EAAAA,IAAC,QAAK,SAAA,SAAM,EACZ2F,EAAAA,KAAC,OAAA,CAAK,UAAU,oFAAoF,SAAA,CAAA,IAChGgS,EAAA,EACJ,CAAA,EACF,EACAhS,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9CkS,EAAA,EACV,EACCM,IACCxS,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX3F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAASqrB,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAED/X,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/B0S,GAAQ,IAAA,EACjB,EACA1S,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9C4S,EAAA,EACV,CAAA,EACF,EAEDjF,IAAiB,cAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BiT,GAAQ,KAAA,EACjB,EACAjT,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9CmT,EAAA,EACV,CAAA,EACF,EAEDxF,IAAiB,aAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BwT,GAAQ,KAAA,EACjB,EACAxT,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9C0T,EAAA,EACV,CAAA,EACF,EAED/F,IAAiB,gBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,YAExC,QACC,MAAA,CAAI,UAAU,yCACZ,SAAA8T,GACH,EACA/T,EAAAA,KAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,CAAA,aAChCmU,GAAc,gBAAc,IACtCE,EAAA,EACH,CAAA,EACF,EAED1G,IAAiB,gBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,YAExC,QACC,MAAA,CAAI,UAAU,yCACZ,SAAAsU,GACH,EACAvU,EAAAA,KAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,CAAA,aAChC2U,GAAc,gBAAc,IACtCE,EAAA,EACH,CAAA,EACF,EAEDlH,IAAiB,mBAChBtT,MAAA4F,EAAAA,SAAA,CACE,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,mBACrB+U,EAAA,EACnB,EACA/U,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,SAC/CiV,EAAA,EACT,CAAA,EACF,EACAjV,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,QAAA,CAAM,UAAU,UAAU,SAAA,SAAM,EACjC3F,EAAAA,IAAC,MAAA,CAAI,UAAU,iCACZ,SAAA,CAAC,GAAI,GAAI,EAAE,EAAE,IAAKuI,GACjB5C,EAAAA,KAAC,SAAA,CAEC,UAAW,2BAA2B+U,KAAiBnS,EAAI,iDAAmD,EAAE,GAChH,QAAS,IAAMoS,GAAgBpS,CAAC,EACjC,SAAA,CAAA,IACGA,CAAA,CAAA,EAJG,gBAAgBA,CAAC,EAAA,CAMzB,EACH,QACC,OAAA,CAAK,UAAU,qBAAqB,SAAA,KAAE,EACvCvI,EAAAA,IAAC,SAAA,CACC,UAAU,aACV,MAAO0a,GACP,SAAWjX,GACTkX,GAAgB,SAASlX,EAAE,OAAO,MAAO,EAAE,CAAC,EAG7C,SAAA,MAAM,KACL,CAAE,OAAQ,EAAA,EACV,CAACkE,EAAG2C,IAAMA,EAAI,CAAA,EACd,IAAK/B,GACLvI,EAAAA,IAAC,UAAe,MAAOuI,EACpB,SAAAA,CAAA,EADUA,CAEb,CACD,CAAA,CAAA,EAEHvI,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASwsB,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,CAAA,CACF,CAAA,CACF,EAEDlZ,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,SAAM,EAC9C5F,EAAAA,IAAC,MAAA,CAAI,UAAU,yCACZ,YAAS,OACZ,EACA2F,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,SAChB,IACP3F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,YAAS,MACZ,CAAA,EACF,CAAA,EACF,EAEDsT,IAAiB,QAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,OAAI,EAC5C5F,EAAAA,IAAC,MAAA,CAAI,UAAU,yCACZ,YAAK,KACR,EACA2F,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,WACd,IACT3F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,YAAK,QACR,CAAA,EACF,CAAA,EACF,EAEDsT,IAAiB,eAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,OAAI,EAC5C5F,EAAAA,IAAC,MAAA,CAAI,UAAU,yCACZ,YAAI,KACP,EACCwb,GAAI,UACH7V,OAAC,MAAA,CAAI,UAAU,eAAe,SAAA,CAAA,WACnB6V,GAAI,QAAU,GAAA,EACzB,CAAA,EAEJ,EAEDlI,IAAiB,QAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,SAAM,QAC7C,MAAA,CAAI,UAAU,yCACZ,SAAA4G,GAAkBgQ,GAAK,WAAW,EACrC,EACA7W,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,YACb,IACVA,EAAAA,KAAC,OAAA,CAAK,UAAU,gBACb,SAAA,CAAA6W,GAAK,YAAc,EAAE,IAAEhQ,GAAkB,MAAA,EAC5C,CAAA,EACF,EACCgQ,GAAK,UACJ7W,OAAC,MAAA,CAAI,UAAU,oEAAoE,SAAA,CAAA,kBACjE6W,GAAK,MAAM,SAAA,EAC7B,CAAA,EAEJ,EAEDlJ,IAAiB,SAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,QAAK,EAC7CD,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACZ,SAAA,CAAAiX,GAAM,MAAM,IAAEA,GAAM,MAAA,EACvB,EACAjX,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,SAChB,IACP3F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBAAiB,YAAM,MAAM,CAAA,EAC/C,EACC4c,GAAM,UACLjX,OAAC,MAAA,CAAI,UAAU,oEAAoE,SAAA,CAAA,aACtEiX,GAAM,OAAO,GAAA,EAC1B,CAAA,EAEJ,EAEDtJ,IAAiB,UAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,QAAK,EAC7CD,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACZ,SAAA,CAAAqX,GAAO,MAAM,IAAEA,GAAO,MAAA,EACzB,EACArX,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,SAChB,IACP3F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,YAAO,MACV,CAAA,EACF,EACCgd,GAAO,UACNrX,OAAC,MAAA,CAAI,UAAU,oEAAoE,SAAA,CAAA,aACtEqX,GAAO,OAAO,GAAA,EAC3B,CAAA,EAEJ,EAED1J,IAAiB,oBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,+CAE7C,QACC,MAAA,CAAI,UAAU,uDACZ,SAAAgI,GAAmB,IAAKrF,GACvB5C,EAAAA,KAAC,MAAA,CAEC,UAAU,yDAEV,SAAA,CAAA3F,MAAC,OAAI,UAAU,aACZ,SAAAuI,IAAM,GAAK,OAASA,EACvB,EACA5C,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACZ,SAAA,CAAA,KAAK,IAAI,EAAG+V,GAAU,QAAQnT,CAAC,GAAK,CAAC,EAAE,MAAA,EAC1C,CAAA,CAAA,EARKA,CAAA,CAUR,EACH,EACA5C,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,UACf,IACR3F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,YAAU,OACb,CAAA,EACF,EACCgO,GAAe0N,EAAS,GACvB/V,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX3F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAASitB,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAED3Z,IAAiB,UAChBtT,MAAA4F,EAAAA,SAAA,CACG,SAACmW,GAKApW,OAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAA3F,EAAAA,IAAC,QAAK,SAAA,OAAI,EACVA,MAAC,QAAK,UAAU,gFACb,WAAcqQ,EAAa,GAAG,MAAQ,GAAA,CACzC,CAAA,EACF,QACC,MAAA,CAAI,UAAU,yCACZ,SAAA+L,GACG,GAAGlM,EAAc,KAAM9I,GAAMA,EAAE,KAAOgV,EAAc,GAAG,MAAQ,QAAQ,QACvEE,IAAmB,OAAA,CACzB,CAAA,CAAA,CACF,EAhBAtc,MAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,kCAAA,CAExC,CAcA,CAEJ,CAAA,EAEJ,EACE4R,IAAkB,eACnB,OAAI,UAAU,iBACZ,SAACuB,GA6SAxN,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,wBAE5C,QACC,MAAA,CAAI,UAAU,qBAAqB,SAAA,yFAGpC,CAAA,EACF,EApTAA,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAA5F,EAAAA,IAAC,OAAI,UAAU,2CACb,SAAA2F,EAAAA,KAAC,MAAA,CAAI,UAAU,8CACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,MAAG,EAChC3F,EAAAA,IAAC,SAAA,CACC,UAAW,OAAO2lB,EAAe,GACjC,QAAS,IACPvT,EACE,KAAK,IACH,GACA,KAAK,OAAOpO,EAAc,KAAQ,GAAG,EACnC,GAAA,CACJ,EAGL,SAAA,GAAA,CAAA,EAGD2B,EAAAA,KAAC,OAAA,CACC,UAAW,OAAOggB,EAAe,8BAEhC,SAAA,CAAA,KAAK,MAAM3hB,EAAc,GAAG,EAAE,GAAA,CAAA,CAAA,EAEjChE,EAAAA,IAAC,SAAA,CACC,UAAW,OAAO2lB,EAAe,GACjC,QAAS,IACPvT,EACE,KAAK,IACH,KACA,KAAK,OAAOpO,EAAc,KAAQ,GAAG,EACnC,GAAA,CACJ,EAGL,SAAA,GAAA,CAAA,QAGA,OAAA,CAAK,UAAU,aAAa,SAAA,IAAC,EAC9BhE,EAAAA,IAAC,SAAA,CACC,UAAW,OAAO2lB,EAAe,GACjC,MAAM,kBACN,QAAS,IACPnT,EACED,IAAkB,OAAS,MAAQ,MAAA,EAItC,SAAAA,IAAkB,OAAS,OAAS,KAAA,CAAA,QAEtC,OAAA,CAAK,UAAU,aAAa,SAAA,IAAC,EAC9BvS,EAAAA,IAAC,SAAA,CACC,UAAW,OAAO2lB,EAAe,GACjC,MAAM,uBACN,QAAS,IACPrT,EACED,IAAiB,SACb,OACA,QAAA,EAIP,SAAAA,IAAiB,SAAW,SAAW,MAAA,CAAA,CAC1C,CAAA,CACF,CAAA,CACF,QACC,MAAA,CAAI,UAAU,WACb,SAAA1M,EAAAA,KAAC,MAAA,CAAI,UAAU,kEACb,SAAA,CAAA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,8FACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,MACZ,YAAavc,EACb,oBAAmB,GACnB,iBAAiB,SACjB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CAGnC,CAAA,CAAA,EAEJ,EAEAjqB,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,4FACb,SAAA,CAAA3F,EAAAA,IAAC,OAAI,UAAU,YACb,SAAA2F,EAAAA,KAAC,MAAA,CAAI,UAAU,mGACb,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,kBAE/D,QACC,MAAA,CAAI,UAAU,wCACZ,SAAA4e,GACH,EACA5e,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,YAE/D,QACC,MAAA,CAAI,UAAU,+BACZ,SAAA6e,GACH,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,YAE/D,EACAxkB,EAAAA,IAAC,MAAA,CAAI,UAAU,+BACZ,aAAmB,EACtB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,aAE/D,EACA2F,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACZ,SAAA,CAAAmJ,GAAW,IAAEC,EAAA,EAChB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,UAE/D,QACC,MAAA,CAAI,UAAU,yBACZ,SAAAuV,GACH,CAAA,EACF,CAAA,EACF,CAAA,CAAA,CACF,CAAA,CACF,EAEAtkB,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACb,SAAAA,EAAAA,IAAC6vB,GAAA,CACC,SAAUvc,EACV,QAAS4Q,GACT,WAAY,GAAGpV,EAAU,IAAIC,EAAM,EAAA,CAAA,EAEvC,CAAA,EACF,EAEA/O,EAAAA,IAAC,MAAA,CAAI,UAAU,YACb,SAAAA,EAAAA,IAAC6vB,GAAA,CACC,SAAUvc,EACV,QAAS4Q,GACT,WAAY,GAAGpV,EAAU,IAAIC,EAAM,EAAA,CAAA,EAEvC,EAEEuE,IAAyB,OACzB3N,OAAC,MAAA,CAAI,UAAU,gHACb,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,6BAE/D,EACAA,EAAAA,KAAC,IAAA,CAAE,UAAU,6BAA6B,SAAA,CAAA,iFAEE,IACzCoK,EAAS,GAAA,EACZ,EACApK,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,MAAA,CAAI,UAAU,mCACZ,SAAAyd,GACH,EACAzd,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,eAEjE,EACA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,oCACb,SAAAA,EAAAA,IAAC8vB,GAAA,CACC,WAAY,GACZ,cAAe/f,EACf,WAAY9B,GACVC,EAAA,EAEF,aAAc,CAAC,IAAK,IAAK,IAAK,EAAE,EAChC,aAAc,IACZ4b,IAAc,WAAA,EAEhB,SAAU,IAAM,CAEhB,EACA,OAAQ,IAAM,CAEd,EACA,gBAAiB,EAAA,CAAA,EAErB,CAAA,EACF,EACAnkB,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,gBAEjE,EACAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,MAAOuhB,GACP,SAAW9d,GACT+d,GACE/d,EAAE,OAAO,KAAA,EAGb,UAAYA,GAAM,CACZA,EAAE,MAAQ,SACZ6hB,GACE,QAAA,CAEN,EACA,YAAa,GAAGxW,EAAU,EAAA,CAAA,EAE5B9O,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IACPslB,GACE,QAAA,EAGL,SAAA,KAAA,CAAA,CAED,EACF,CAAA,EACF,CAAA,EACF,EACA3f,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,MAAA,CAAI,UAAU,mCACZ,SAAA0d,GACH,EACA1d,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,kBAEjE,EACAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,IAAK+P,EACL,MAAOsR,GACP,SAAW5d,GACT6d,GACE7d,EAAE,OAAO,KAAA,EAGb,UAAYA,GAAM,CACZA,EAAE,MAAQ,SACZ2hB,GAEA,CACJ,EACA,YAAa,GAAGvW,CAAO,EAAA,CAAA,EAEzB7O,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IACPolB,GAA8B,EAEjC,SAAA,KAAA,CAAA,CAED,EACF,CAAA,EACF,EACAzf,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,gBAEjE,EACAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,MAAOyhB,GACP,SAAWhe,GACTie,GACEje,EAAE,OAAO,KAAA,EAGb,UAAYA,GAAM,CACZA,EAAE,MAAQ,SACZ6hB,GACE,IAAA,CAEN,EACA,YAAa,GAAGvW,EAAM,EAAA,CAAA,EAExB/O,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IACPslB,GAAyB,IAAI,EAEhC,SAAA,KAAA,CAAA,CAED,EACF,CAAA,EACF,CAAA,EACF,CAAA,EACF,CAAA,EACF,CAAA,EAEJ,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CACF,CAUA,CAEJ,QAEC,MAAA,CAAI,UAAU,+HACb,SAAA3f,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,aAAU,EACtCkK,GACC7P,EAAAA,IAAC,OAAA,CAAK,UAAU,gFAAgF,SAAA,UAAA,CAEhG,QAEC,OAAA,CAAK,UAAU,4EAA4E,SAAA,mBAE5F,CAAA,EAEJ,QACC,MAAA,CAAI,UAAU,yCACZ,SAAA4O,EACH,EACA5O,EAAAA,IAAC,MAAA,CAAI,UAAU,6DACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,2BACV,MAAO,CACL,MAAO,GAAG,KAAK,IAAI,EAAG,KAAK,IAAI,KAAM,EAAI4O,EAAcmB,GAAY,GAAG,CAAC,CAAC,GAAA,CAC1E,CAAA,EAEJ,EACApK,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,aAC5B,UACV,OAAA,CAAK,UAAU,gBACb,SAAAqJ,GACH,CAAA,EACF,EACArJ,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,cACtB,IACZ3F,EAAAA,IAAC,QAAK,UAAU,gBACb,YAAmB,EAChBkP,GACCE,IAAwBJ,EAAA,CAC/B,CAAA,EACF,EACArJ,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,cACtB,IACZ3F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,SAAAqf,GAAmB,GAEbI,GAAoBJ,GACrB,GACA,QAAQ,CAAC,EACX,MACN,CAAA,EACF,EACA1Z,EAAAA,KAAC,MAAA,CAAI,UAAU,6CACb,SAAA,CAAAA,OAAC,OAAA,CAAK,SAAA,CAAA,iBAAeyX,EAAA,EAAkB,EACvCpd,EAAAA,IAAC,OAAA,CACC,UAAU,iCACV,aAAW,cAEV,UAAC,EAAG,EAAG,CAAC,EAAE,IAAKsK,GACdtK,EAAAA,IAAC,OAAA,CAEC,UAAW,wBAAwBsK,EAAIiT,GAAmB,iBAAmB,aAAa,EAAA,EADrFjT,CAAA,CAGR,CAAA,CAAA,CACH,EACF,EACA3E,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,WAC9B,IACTA,EAAAA,KAAC,OAAA,CAAK,UAAU,gBAAgB,SAAA,CAAA,OACzB8J,GAAiB,UAAQD,EAAA,EAChC,CAAA,EACF,EACCZ,GAAe,KACdA,EAAc,IACb,IAAM,CAKL,MAAMmhB,EAJOx0B,GACXqT,EACAnT,CAAA,EAEiB,CAAC,GAAK,IACzB,OACEkK,EAAAA,KAAC,MAAA,CAAI,UAAU,mHACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,WAAQ,QACpC,OAAA,CAAK,UAAU,gBAAiB,SAAAoqB,EAAM,CAAA,EACzC,CAEJ,GAAA,CAAG,EACP,EAEA/vB,EAAAA,IAAC,MAAA,CAAI,UAAU,kGACb,SAAAA,EAAAA,IAACgwB,GAAA,CACC,WAAW,oCACX,UAAU,6EACV,aAAc,EACd,cAAe,EACf,SAAU,IACV,UAAW,IACX,SAAU,IACV,UAAW,KACX,SAAQ,GAER,SAAAhwB,EAAAA,IAACvD,GAAA,CACC,MAAM,aACN,UAAW,GACX,UAAU,iBACV,OAAO,UACP,KAAI,EAAA,CAAA,CACN,CAAA,EAEJ,EAEAkJ,EAAAA,KAAC,MAAA,CACC,UAAW,QAAQgN,IAAY,QAAU,MAAQA,IAAY,QAAU,MAAQ,KAAK,kEAAkED,KAAa,QAAU,UAAYA,KAAa,QAAU,YAAc,SAAS,GAEvO,SAAA,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,gBAEpC,GACE,IAAM,CAEN,MAAMud,EAAiBpgB,GACnB8B,GAAM,UAAY,MAClB7B,IAAO,OACL,IACA,GAAGA,CAAE,MACLogB,EAAmBrgB,GACrBjB,EACAkB,IAAO,OACL,EACAjB,EACAshB,EAAmBtgB,GACrB0N,GAAmB,EACjBrO,GACCE,IAAwBJ,GAC3B4P,GAAe,EACbzP,GACCE,IAAoBJ,GACrBmhB,EAAcvgB,GAChBuN,GACAoB,GACEviB,EACJ8T,GACCF,GACGjB,EACAkB,IAAO,OACLC,EACAlB,GACFwhB,EACJD,EAAc,EAAKn0B,EAASm0B,EAAe,EAAI,EAC3CE,EAAa,GAAGxhB,EAAU,IAAIC,EAAM,GACpCwhB,EACJ3gB,EAAS,OAAS,EACd,GAAG,KAAK,IAAI,GAAGA,EAAS,IAAKgB,GAAMA,EAAE,aAAeA,EAAE,eAAiB,EAAE,CAAC,GAAK,CAAC,SAChF,IACN,OACEjL,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACb,SAAA,OAAC,MAAA,CAAI,UAAU,aAAa,SAAA,gBAAa,QACxC,MAAA,CAAI,UAAU,uBACZ,SAAA2qB,EACH,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,kBAE5B,QACC,MAAA,CAAI,UAAU,mCACZ,SAAAL,EACH,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,kBAE5B,QACC,MAAA,CAAI,UAAU,yCACZ,SAAAC,EACH,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,aAAU,QACrC,MAAA,CAAI,UAAU,uBACZ,SAAAG,EAAK,QAAQ,CAAC,EACjB,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,aAAU,QACrC,MAAA,CAAI,UAAU,uBACZ,SAAAF,EACH,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,WAAQ,QACnC,MAAA,CAAI,UAAU,aAAc,SAAAI,EAAY,CAAA,EAC3C,CAEJ,GAAA,CAAG,CAAA,CAAA,EAEL5qB,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAA,OAAC,OAAA,CACE,SAAA,CAAAmK,IAAO,OAAS,WAAa,GAAGA,CAAE,MAAM,SAAA,EAC3C,EACED,SAKC,OAAA,CAAK,UAAU,4EAA4E,SAAA,mBAE5F,EANA7P,EAAAA,IAAC,OAAA,CAAK,UAAU,gFAAgF,SAAA,UAAA,CAEhG,CAIA,EAEJ,QACC,MAAA,CAAI,UAAU,yCACZ,SAAA8P,IAAO,OAASjB,EAAU,MAC7B,EACCiB,IAAO,QACN9P,MAAC,MAAA,CAAI,UAAU,6DACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,2BACV,MAAO,CACL,MAAO,GAAG,KAAK,IAAI,EAAG,KAAK,IAAI,KAAM,EAAI6O,EAAUkB,GAAY,GAAG,CAAC,CAAC,GAAA,CACtE,CAAA,EAEJ,EAEFpK,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,aAC5B,UACV,OAAA,CAAK,UAAU,gBACb,SAAAmK,IAAO,OAAS,EAAIb,EAAA,CACvB,CAAA,EACF,EACAtJ,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,cACtB,IACZ3F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,SAAA8P,IAAO,OACJ,IACA8O,GAAe,EACbzP,GACCE,IAAoBJ,GAC7B,CAAA,EACF,EACAtJ,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,cACtB,UACX,OAAA,CAAK,UAAU,gBACb,aAAO,OACJ4Z,GAAe,GAEVI,GAAgBJ,GACjB,GACA,QAAQ,CAAC,EACX,MACF,IACN,CAAA,EACF,EACCzP,IAAO,QACNnK,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,iBACnB6Y,EAAA,EACjB,EAED1O,IAAO,QACNnK,OAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,WAC9B,IACTA,EAAAA,KAAC,OAAA,CAAK,UAAU,gBAAgB,SAAA,CAAA,OACzBgK,GAAa,UAAQD,EAAA,EAC5B,CAAA,EACF,CAAA,EAEJ,CAAA,CAAA,CACF,CAAA,CACF,EAGD4D,IAAiB,MAChB3N,OAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAA2N,IAAiB,mBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,UACrB,IACR3F,MAAC,QAAK,UAAU,8DACb,YAAsB2W,EAAO,GAAG,OAAS,GAAA,CAC5C,CAAA,EACF,EACClE,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,WAAY,CAAC5N,EAAOkD,IAAS,CAC3B,IACEA,IAAS,UACTA,IAAS,eAEGd,GAAYpC,EAAOmR,EAAO,EAC7B,CACP,MAAM6Z,EAAK3Z,GAAS,EACd4Z,EAAK9Z,GAAU,EACrB,OAAAG,GAAU0Z,CAAE,EACZ5Z,GAAW6Z,CAAE,EACTD,GAAM9oB,GAAsB,QAC9B,WAAW,IAAM,CACfoP,GAAU,CAAC,EACXF,GAAW,CAAC,CACd,EAAG,GAAG,EACD,EACT,CAEF,MAAO,EACT,EACA,oBAAmB,GACnB,WAAY3I,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOyW,EACP,SAAWhT,GACTiT,EACE,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAA,EAG9B,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASqnB,GAAA,CACzB,CAAA,CAAA,EAEF9qB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS8qB,GACV,SAAA,UAAA,CAAA,CAED,EACF,EACAnlB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,YAAY,4BACZ,MAAO+gB,GACP,SAAWtd,GAAMud,GAAavd,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASsnB,GAAA,CACzB,CAAA,CAAA,EAEF/qB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS+qB,GACV,SAAA,KAAA,CAAA,CAED,EACF,CAAA,EACF,EACAplB,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,aAC3BkR,GAAO,QAAA,EACpB,CAAA,EACF,EAEDvD,IAAiB,oBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,UACrB,UACP,OAAA,CAAK,UAAU,8DACb,SAAAwC,GAAU4O,EAAQ,IAAM,GACrB,kBACA5O,GAAU4O,EAAQ,IAAM,GACtB,kBACA5O,GAAU4O,EAAQ,GAAK,IAC/B,CAAA,EACF,EACCtE,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxB1C,GACE1nB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,EAEpB,WAAY3hB,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS2pB,GAAA,CACzB,CAAA,CAAA,EAEFptB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASotB,GACV,SAAA,UAAA,CAAA,CAED,EACF,EACAznB,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,YAAY,2BACZ,MAAO+gB,GACP,SAAWtd,GAAMud,GAAavd,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS4pB,GAAA,CACzB,CAAA,CAAA,EAEFrtB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASqtB,GACV,SAAA,KAAA,CAAA,CAED,EACF,EACCpW,IAAW9O,GAAU,QACpBxC,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX3F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbkX,GAAW,CAAC,EACZF,GAAY,CAAC,EACb4N,EAAe,kBAAkB,CACnC,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDtR,IAAiB,WAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxBtC,GACE9nB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,EAEpB,WAAY3hB,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS+pB,GAAA,CACzB,CAAA,CAAA,EAEFxtB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASwtB,GACV,SAAA,UAAA,CAAA,EAGDxtB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbmX,GAAW9O,IAAoB,EAC/BqP,GAAqB,CAAC,EACtBkN,EAAe,SAAS,CAC1B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDtR,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxBnC,GACEjoB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,EAEpB,WAAY3hB,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASiqB,GAAA,CACzB,CAAA,CAAA,EAEF1tB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS0tB,GACV,SAAA,UAAA,CAAA,EAGD1tB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACboX,GAAYhO,IAAqB,EACjCsO,GAAqB,CAAC,EACtBkN,EAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDtR,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxBjC,GACEnoB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,EAEpB,WAAY3hB,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASmqB,GAAA,CACzB,CAAA,CAAA,EAEF5tB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS4tB,GACV,SAAA,UAAA,CAAA,EAGD5tB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbsX,GAAS7N,IAAsB,EAC/BiO,GAAqB,CAAC,EACtBkN,EAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDtR,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxB/B,GACEroB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,EAEpB,WAAY3hB,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASqqB,GAAA,CACzB,CAAA,CAAA,EAEF9tB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS8tB,GACV,SAAA,UAAA,CAAA,EAGD9tB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbwX,GAAW3N,IAAe,EAC1B6N,GAAqB,CAAC,EACtBkN,EAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDtR,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxB5E,GACExlB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,EAEpB,WAAY3hB,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS2nB,GAAA,CACzB,CAAA,CAAA,EAEFprB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASorB,GACV,SAAA,UAAA,CAAA,EAGDprB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAASqrB,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAED/X,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAa5N,GAAU8lB,GAAe9lB,CAAK,EAC3C,WAAYyI,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZ6nB,GAAe7U,CAAgB,EAC/BC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEF1W,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACbsrB,GAAe7U,CAAgB,EAC/BC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGD1W,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbsY,GAAW,CAAC,EACZE,GAAW,CAAC,EACZE,GAAW,CAAC,EACZkM,EAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAjf,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/B0S,GAAQ,IAAEM,EAAA,EACnB,CAAA,EACF,EAEDrF,IAAiB,cAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAa5N,GAAU+lB,GAAiB/lB,CAAK,EAC7C,WAAYyI,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZ8nB,GAAiB9U,CAAgB,EACjCC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEF1W,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACburB,GAAiB9U,CAAgB,EACjCC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGD1W,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACb6Y,GAAW,CAAC,EACZE,GAAW,CAAC,EACZE,GAAW,CAAC,EACZ2L,EAAe,YAAY,CAC7B,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAjf,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BiT,GAAQ,IAAEM,EAAA,EACnB,CAAA,EACF,EAED5F,IAAiB,aAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAa5N,GAAUgmB,GAAgBhmB,CAAK,EAC5C,WAAYyI,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZ+nB,GAAgB/U,CAAgB,EAChCC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEF1W,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACbwrB,GAAgB/U,CAAgB,EAChCC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGD1W,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACboZ,GAAW,CAAC,EACZE,GAAW,CAAC,EACZE,GAAW,CAAC,EACZoL,EAAe,WAAW,CAC5B,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAjf,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BwT,GAAQ,IAAEM,EAAA,EACnB,CAAA,EACF,EAEDnG,IAAiB,gBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,IAClBqjB,GACEvmB,EACAkD,IAAS,OAAS,OAAYA,CAAA,EAGlC,WAAYuF,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,OACL,YAAY,oBACZ,MAAO+gB,GACP,SAAWtd,GAAMud,GAAavd,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASwoB,GAAY,EAAI,CACzC,CAAA,CAAA,EAEFjsB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAMisB,GAAY,EAAI,EAChC,SAAA,UAAA,CAAA,EAGDjsB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAASosB,GACV,SAAA,OAAA,CAAA,CAED,EACF,EACAzmB,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,cAC1B+T,GAAS,gBAAcI,GAAc,iBACrCE,EAAA,EACd,CAAA,EACF,EAED1G,IAAiB,gBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,IAClBsjB,GACExmB,EACAkD,IAAS,OAAS,OAAYA,CAAA,EAGlC,WAAYuF,GACVC,EAAA,EAEF,SAAWpS,GACTguB,GAAa,OAAOhuB,CAAC,CAAA,CAAA,EAG3B,EAEF6J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,OACL,YAAY,oBACZ,MAAO+gB,GACP,SAAWtd,GAAMud,GAAavd,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASwoB,GAAY,EAAK,CAC1C,CAAA,CAAA,EAEFjsB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAMisB,GAAY,EAAK,EACjC,SAAA,UAAA,CAAA,EAGDjsB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAASqsB,GACV,SAAA,OAAA,CAAA,CAED,EACF,EACA1mB,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,cAC1BuU,GAAS,gBAAcI,GAAc,iBACrCE,EAAA,EACd,CAAA,EACF,EAEDlH,IAAiB,mBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxBtD,GACE9mB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,CAClB,CAAA,EAEN,EAEFjqB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,OACL,YAAY,eACZ,MAAO+gB,GACP,SAAWtd,GAAMud,GAAavd,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CAChB,GAAIA,EAAE,MAAQ,QAAS,CACrB,MAAMjH,EAAIsL,GAAgBiZ,EAAS,EAC/BvkB,GAAK,MACP8vB,GAAc9vB,EAAG,OAAW,MAAS,EACvCwkB,GAAa,EAAE,CACjB,CACF,CAAA,CAAA,EAEFhhB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACb,MAAMxD,EAAIsL,GAAgBiZ,EAAS,EAC/BvkB,GAAK,MACP8vB,GAAc9vB,EAAG,OAAW,MAAS,EACvCwkB,GAAa,EAAE,CACjB,EACD,SAAA,UAAA,CAAA,CAED,EACF,EACArb,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BiV,GAAW,aAAW,IAC5B,KAAK,IAAI,EAAGE,GAAcF,EAAU,EAAE,YAAU,IAChDE,GACAE,GAAiB,EAAI,IAAIA,EAAc,GAAK,EAAA,EAC/C,EACCE,IACCvV,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX3F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAASwsB,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDlZ,IAAiB,YAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxBnD,GACEjnB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,CAClB,CAAA,EAEN,EAEF5vB,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS2sB,GACV,SAAA,OAAA,CAAA,EAGH,CAAA,EACF,EAEDrZ,IAAiB,QAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxBhD,GACEpnB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,CAClB,CAAA,EAEN,EAEF5vB,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS6sB,GACV,SAAA,OAAA,CAAA,EAGH,CAAA,EACF,EAEDvZ,IAAiB,eAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,8BACZ,SAAA,MAAM,KAAK,CAAE,OAAQ,GAAK,CAAC+B,EAAG2C,IAAMA,CAAC,EAAE,IACrC4B,GACClM,EAAAA,IAAC,SAAA,CAEC,UAAW,0BAA0Bwb,GAAI,MAAMtP,CAAI,EAAI,0CAA4C,qCAAqC,GACxI,QAAS,IAAM,CACb,GAAIsP,GAAI,UAAYA,GAAI,MAAMtP,CAAI,EAAG,OAGrC,MAAMwkB,EAAY,OAChB,OACE,wEAAA,GACG,CAAA,EAEDhoB,EACJgoB,EAAY,IAAM,EACd,SACAA,EAAY,IAAM,EAChB,SACA,SACFC,EAAQzkB,EAURC,EAAMR,GAAYglB,CAAK,EACvBzoB,EACJiE,EAAI,OAAS,OACT,KACAA,EAAI,KAAO,KACjB2gB,GACE6D,EACAD,EACAhoB,EACAR,CAAA,CAEJ,EAEC,SAAAsT,GAAI,MAAMtP,CAAI,GAAK,EAAA,EAxCfA,CAAA,CAyCP,EAGN,EACCuG,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CAGnC,CAAA,CAAA,EAEJ,EAEF5vB,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS+sB,GACV,SAAA,OAAA,CAAA,EAGH,CAAA,EACF,EAEDzZ,IAAiB,oBAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAA6M,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IACxB5C,GACExnB,EACCkD,IAAS,OAAS,OAAYA,EAC/BknB,GAAM,QAAU,IAAA,CAClB,CAAA,EAEN,EAEF5vB,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAASitB,GACV,SAAA,OAAA,CAAA,EAGH,CAAA,EACF,EAED3Z,IAAiB,QAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,UACrB,UACP,OAAA,CAAK,UAAU,8DACb,SAAA6G,GAAkBkQ,GAAW,WAAW,CAAA,CAC3C,CAAA,EACF,EACCjK,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CACjC,MAAMxvB,EAAIsI,IAAS,OAAS,OAAYA,EACxC,OAAAgc,EAAW,MAAM,EACjB/H,GACEjQ,GAAYgQ,GAAYlX,EAAOpF,CAAQ,CAAA,EAElC,EACT,CAAA,CAAA,EAEJ,EAEFuF,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZihB,EAAW,MAAM,EACjB/H,GACE9P,GACE6P,GACAjG,CAAA,CACF,EAEFC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEF1W,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACb0kB,EAAW,MAAM,EACjB/H,GACE9P,GAAe6P,GAAYjG,CAAgB,CAAA,EAE7CC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGD1W,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACb2c,GAAc7P,IAAW,EACzB8X,EAAe,MAAM,CACvB,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACClI,GAAW,UACV/W,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,kBAC3G+W,GAAW,MAAM,SAAA,EACnC,CAAA,EAEJ,EAEDpJ,IAAiB,SAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,SACtB,IACPA,EAAAA,KAAC,OAAA,CAAK,UAAU,8DACb,SAAA,CAAAmX,GAAY,MAAM,IAAEA,GAAY,MAAA,EACnC,CAAA,EACF,EACCrK,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,KACxBlL,EAAW,OAAO,EAClB3H,GACE7P,GAAa4P,GAAatX,CAAkB,CAAA,EAEvC,GACT,CAAA,EAEJ,EAEFG,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZihB,EAAW,OAAO,EAClB3H,GACE3P,GACE0P,GACArG,CAAA,CACF,EAEFC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEF1W,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACb0kB,EAAW,OAAO,EAClB3H,GACE3P,GACE0P,GACArG,CAAA,CACF,EAEFC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGD1W,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACb+c,GAAe1P,GAAWyP,GAAY,MAAM,CAAC,EAC7C8H,EAAe,OAAO,CACxB,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAjf,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,+CACO,IAC5CmX,GAAY,KAAA,EACf,EACCA,GAAY,UACXnX,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChHmX,GAAY,OAAO,MAAI,IACjCA,GAAY,MAAM,SAAA,EACrB,CAAA,EAEJ,EAEDxJ,IAAiB,UAChB3N,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,SACtB,IACPA,EAAAA,KAAC,OAAA,CAAK,UAAU,8DACb,SAAA,CAAAuX,GAAa,MAAM,IAAEA,GAAa,MAAA,EACrC,CAAA,EACF,EACCzK,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,KACxBlL,EAAW,QAAQ,EACnBvH,GACE1P,GAAcyP,GAAc1X,CAAkB,CAAA,EAEzC,GACT,CAAA,EAEJ,EAEFG,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZihB,EAAW,QAAQ,EACnBvH,GACEzP,GACEwP,GACAzG,CAAA,CACF,EAEFC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEF1W,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACb0kB,EAAW,QAAQ,EACnBvH,GACEzP,GACEwP,GACAzG,CAAA,CACF,EAEFC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGD1W,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbmd,GACExP,GAAYuP,GAAa,MAAM,CAAA,EAEjC0H,EAAe,QAAQ,CACzB,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAjf,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,mCACL,IAChCuX,GAAa,KAAA,EAChB,EACCA,GAAa,UACZvX,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChHuX,GAAa,OAAO,MAAI,IAClCA,GAAa,MAAM,SAAA,EACtB,CAAA,EAEJ,EAED5J,IAAiB,UAChBtT,EAAAA,IAAA4F,EAAAA,SAAA,CACG,SAACmW,GAqFApW,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAA3F,MAAC,OAAI,UAAU,wCACZ,SAAAkQ,EAAc,IAAK9I,GAAM,CACxB,MAAMgE,EAAK+E,GAAa/I,EAAE,EAAE,EACtBc,EAAMkI,GAAehJ,EAAE,EAAE,EAC/B,OACEzB,EAAAA,KAAC,MAAA,CAEC,UAAW,yBAAyByF,GAAI,WAAa,6CAA+C,qCAAqC,GAEzI,SAAA,CAAAzF,EAAAA,KAAC,MAAA,CAAI,UAAU,4CACb,SAAA,CAAA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,gBACZ,SAAAoH,EAAE,KACL,EACApH,EAAAA,IAAC,MAAA,CACC,UAAW,qCAAqCoL,GAAI,SAAW,+DAAiE,gCAAgC,GAE/J,SAAAA,GAAI,SACD,SACA,YAAA,CAAA,CACN,EACF,EACAzF,EAAAA,KAAC,MAAA,CAAI,UAAU,eAAe,SAAA,CAAA,UACpB,UACP,OAAA,CAAK,UAAU,gBACb,SAAAuC,EACH,CAAA,EACF,EACAvC,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,SAChB,UACN,OAAA,CAAK,UAAU,gBACb,SAAAyF,GAAI,OAAS,CAAA,CAChB,CAAA,EACF,CAAA,CAAA,EA1BKhE,EAAE,EAAA,CA6Bb,CAAC,EACH,EACCqL,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CACjC,GAAIxT,GAAgB,MAAO,GAC3B,MAAMhc,EACJsI,IAAS,OAAS,OAAYA,EAC1BrC,EAASupB,GAAM,QAAU,KACzBgB,EAAM1gB,EAAcG,EAAa,EACvC,OAAKugB,GACL/U,GAAiBvZ,GAAS,CACxB,MAAMirB,EAGF,CAAA,EACJ,OAAO,KAAKjrB,CAAI,EAAE,QACf2E,GAAOsmB,EAAKtmB,CAAC,EAAI,CAAE,GAAG3E,EAAK2E,CAAC,CAAA,CAAE,EAEjC,MAAMsD,EAAMG,GACVkmB,EAAI,GACJrD,EACAntB,EACAiG,CAAA,EAEF,GAAIkE,EAAI,aACNgS,GACE,GAAGqU,EAAI,IAAI,kBAAA,UAENrmB,EAAI,SAAU,CACrB,MAAM/N,EAAI0T,EAAc,KACrB9I,GAAMA,EAAE,KAAOmD,EAAI,QAAA,EAEtBgS,GACE,GAAGqU,EAAI,IAAI,QAAQp0B,GAAG,IAAI,MAAM4T,GAAe7F,EAAI,QAAQ,CAAC,KAAKA,EAAI,YAAY,SAASA,EAAI,cAAgB,GAAK,EAAI,IAAM,EAAE,GAAA,CAEnI,SAA0B,WAAW,EAErC,MAAMsmB,EAAM3lB,GAAaqiB,CAAI,EAC7B,OAAIsD,MAAuBA,CAAG,EACvBtD,CACT,CAAC,EACDpR,GAAgBna,GAAM,CACpB,MAAMkpB,EAAKlpB,EAAI,EACf,GAAIkpB,GAAM,EAAG,CAEX,IAAI1hB,EAAO6G,GACX,QACM/F,EAAI,EACRA,GAAK4F,EAAc,OACnB5F,IACA,CACA,MAAMG,GACH4F,GAAgB/F,GACjB4F,EAAc,OACVnF,EAAMmF,EAAczF,CAAG,EAAE,GACzBW,GAAK+E,GAAapF,CAAG,EAC3B,GACEK,IACA,CAACA,GAAG,YACJA,GAAG,MAAQ,EACX,CACA5B,EAAOiB,EACP,KACF,CACF,CACA,OAAAwR,GAAiBzS,CAAI,EACd,CACT,CACA,OAAO0hB,CACT,CAAC,EACM,IA7DU,EA8DnB,CAAA,CAAA,EAEJ,EAEFvlB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,YAAY,mBACZ,MAAO+gB,GACP,SAAWtd,GAAMud,GAAavd,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CAChB,GAAIA,EAAE,MAAQ,QAAS,CACrB,GAAI2Y,GAAgB,OAEpB,MAAMpU,EADI+Y,GAAU,KAAA,EAAO,YAAA,EACf,MACV,wBAAA,EAEF,GAAI,CAAC/Y,EAAG,CACNgZ,GAAa,EAAE,EACf,MACF,CACA,MAAM/Y,EAAQD,EAAE,CAAC,GAAK,IAIhBE,EAAM,SAASF,EAAE,CAAC,EAAG,EAAE,EACvBU,EACJT,IAAS,IACL,SACAA,IAAS,IACP,SACA,SACF2oB,EAAM1gB,EAAcG,EAAa,EACvCwL,GAAiBvZ,GAAS,CACxB,MAAMirB,EAGF,CAAA,EACJ,OAAO,KAAKjrB,CAAI,EAAE,QACf2E,GAAOsmB,EAAKtmB,CAAC,EAAI,CAAE,GAAG3E,EAAK2E,CAAC,CAAA,CAAE,EAEjC,MAAMsD,EAAMG,GACVkmB,EAAI,GACJrD,EACA7kB,EACAR,CAAA,EAEF,GAAIqC,EAAI,aACNgS,GACE,GAAGqU,EAAI,IAAI,kBAAA,UAENrmB,EAAI,SAAU,CACrB,MAAM/N,EAAI0T,EAAc,KACrB9I,IAAMA,GAAE,KAAOmD,EAAI,QAAA,EAEtBgS,GACE,GAAGqU,EAAI,IAAI,QAAQp0B,GAAG,IAAI,MAAM4T,GAAe7F,EAAI,QAAQ,CAAC,KAAKA,EAAI,YAAY,SAASA,EAAI,cAAgB,GAAK,EAAI,IAAM,EAAE,GAAA,CAEnI,SAA0B,WAAW,EACrC,MAAMsmB,EAAM3lB,GAAaqiB,CAAI,EAC7B,OAAIsD,MAAuBA,CAAG,EACvBtD,CACT,CAAC,EACDvM,GAAa,EAAE,EACf7E,GAAgBna,GAAM,CACpB,MAAMkpB,EAAKlpB,EAAI,EACf,GAAIkpB,GAAM,EAAG,CACX,IAAI1hB,EAAO6G,GACX,QACM/F,EAAI,EACRA,GAAK4F,EAAc,OACnB5F,IACA,CACA,MAAMG,GACH4F,GAAgB/F,GACjB4F,EAAc,OACVnF,GAAMmF,EAAczF,CAAG,EAAE,GACzBW,GAAK+E,GAAapF,EAAG,EAC3B,GACEK,IACA,CAACA,GAAG,YACJA,GAAG,MAAQ,EACX,CACA5B,EAAOiB,EACP,KACF,CACF,CACA,OAAAwR,GAAiBzS,CAAI,EACd,CACT,CACA,OAAO0hB,CACT,CAAC,CACH,CACF,CAAA,CAAA,EAEFlrB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CAEb,IAAIwJ,EAAO6G,GACX,QACM/F,EAAI,EACRA,GAAK4F,EAAc,OACnB5F,IACA,CACA,MAAMG,GACH4F,GAAgB/F,GACjB4F,EAAc,OACVnF,EAAMmF,EAAczF,CAAG,EAAE,GACzBW,EAAK+E,GAAapF,CAAG,EAC3B,GACEK,GACA,CAACA,EAAG,YACJA,EAAG,MAAQ,EACX,CACA5B,EAAOiB,EACP,KACF,CACF,CACAwR,GAAiBzS,CAAI,EACrB2S,GAAe,CAAC,CAClB,EACD,SAAA,aAAA,CAAA,EAGDnc,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CAEb6b,GAAgB,CAAA,CAAE,EAClBC,GAAkB,CAAA,CAAE,EACpBE,GAAmB,EAAK,EACxBC,GAAiB,CAAC,EAClBE,GAAe,CAAC,EAChBE,GAAkB,IAAI,EACtBE,GAAmB,EAAE,CACvB,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACCH,IACCzW,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,UACnH,IAENuK,EAAc,KACX9I,GAAMA,EAAE,KAAOgV,EAAA,GACf,KACH,IACFpc,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACb6b,GAAgB,CAAA,CAAE,EAClBC,GAAkB,CAAA,CAAE,EACpBE,GAAmB,EAAK,EACxBC,GAAiB,CAAC,EAClBE,GAAe,CAAC,EAChBE,GAAkB,IAAI,EACtBE,GAAmB,EAAE,CACvB,EACD,SAAA,YAAA,CAAA,CAED,EACF,CAAA,CAAA,CAEJ,EAzWA5W,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,UAAO,EACtC3F,EAAAA,IAAC,OAAI,UAAU,YACZ,WAAc,IAAI,CAACoH,EAAGqD,IACrB9E,EAAAA,KAAC,MAAA,CAEC,UAAU,0BAEV,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,QACV,MAAOoH,EAAE,KACT,SAAW3D,GAAM,CACf,MAAMzH,EAAOyH,EAAE,OAAO,MACtBmY,GAAkBkI,GAChBA,EAAK,IAAI,CAACgN,EAAIxmB,IACZA,IAAMG,EAAM,CAAE,GAAGqmB,EAAI,KAAA90B,GAAS80B,CAAA,CAChC,CAEJ,CAAA,CAAA,EAEF9wB,EAAAA,IAAC,SAAA,CACC,UAAU,gBACV,QAAS,IACP4b,GAAkBkI,GAChBA,EAAK,OAAO,CAACnc,EAAG2C,IAAMA,IAAMG,CAAG,CAAA,EAGnC,SAAUyF,EAAc,QAAU,EACnC,SAAA,QAAA,CAAA,CAED,CAAA,EAzBK9I,EAAE,EAAA,CA2BV,EACH,EACAzB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,SAAA,CACC,UAAU,gBACV,QAAS,IACP4b,GAAkBkI,GAAS,CACzB,MAAMtZ,EAAK,IAAIsZ,EAAK,OAAS,CAAC,GAC9B,MAAO,CACL,GAAGA,EACH,CACE,GAAAtZ,EACA,KAAM,UAAUsZ,EAAK,OAAS,CAAC,EAAA,CACjC,CAEJ,CAAC,EAEJ,SAAA,YAAA,CAAA,EAGD9jB,EAAAA,IAAC,SAAA,CACC,UAAU,oDACV,QAAS,IAAM,CACb,GAAIkQ,EAAc,OAAS,EAAG,CAC5B,MAAM,yBAAyB,EAC/B,MACF,CACA,MAAM6gB,EAAM7gB,EAAc,IAAK9I,GAAMA,EAAE,EAAE,EACnC6C,EAAWE,GAAoB4mB,CAAG,EAClCC,EAGF,CAAA,EACJD,EAAI,QAASvmB,GAAO,CAClBwmB,EAAWxmB,CAAE,EAAIR,GACfC,EAASO,CAAE,CAAA,CAEf,CAAC,EACDsR,GAAkB7R,CAAQ,EAC1B4R,GAAgBmV,CAAU,EAC1B/U,GAAiB,CAAC,EAClBE,GAAe,CAAC,EAChBE,GAAkB,IAAI,EACtBE,GAAmB,kBAAkB,EACrCP,GAAmB,EAAI,CACzB,EACD,SAAA,wBAAA,CAAA,CAED,EACF,CAAA,CAAA,CACF,CAuRA,CAEJ,CAAA,CAAA,CAEJ,EAEArW,EAAAA,KAAC,MAAA,CAAI,UAAU,YAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,wCAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,8EACb,SAAA,OAAC,MAAA,CAAI,UAAU,mCAAmC,SAAA,aAElD,EAEA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,gBACb,SAAAA,EAAAA,IAAC6vB,GAAA,CACC,SAAUvc,EACV,QAASgQ,GACT,WAAY,GAAGxU,EAAU,IAAIC,EAAM,EAAA,CAAA,EAEvC,EAGCc,IACClK,EAAAA,KAAC,MAAA,CAAI,UAAU,iHACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,OAAC,KAAA,CAAG,UAAU,gEAAgE,SAAA,iBAE9E,QACC,OAAA,CAAK,UAAU,wBAAwB,SAAA,iDAExC,CAAA,EACF,EACAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,cAEjE,EACA3F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOyW,EACP,SAAWhT,GACTiT,EACE,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAA,EAG9B,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZA,EAAE,SACE0qB,GAAA,EACA9E,GAAA,EACR,EACA,YAAY,IAAA,CAAA,EAEdrpB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASqpB,GACV,SAAA,UAAA,CAAA,CAED,EACF,EAEA1jB,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,kBAEjE,EACA3F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,IAAK4O,GAAe,IAAM,IAAM,IAChC,MAAOmb,GACP,SAAWtmB,GACTwmB,GAAuBxmB,EAAE,OAAO,KAAK,EAEvC,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS4mB,GAAA,CACzB,EACA,YAAY,KAAA,CAAA,EAEdrqB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASqqB,GACV,SAAA,cAAA,CAAA,EAGDrqB,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAASmuB,GACV,SAAA,YAAA,CAAA,CAED,EACF,EAEAxoB,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,SAEjE,EACA3F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,MAAO+gB,GACP,SAAWtd,GACTud,GAAavd,EAAE,OAAO,KAAK,EAE7B,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZA,EAAE,SACE2qB,GAAA,EACAJ,GAAA,EACR,EACA,YAAY,KAAA,CAAA,EAEdhuB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASguB,GACV,SAAA,OAAA,CAAA,EAGDhuB,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAASouB,GACT,SAAU7Q,KAAqB,EAChC,SAAA,cAAA,CAAA,CAED,EACF,SAEC,MAAA,CACC,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,6BAEjE,EACAvd,EAAAA,IAAC,WAAA,CACC,UAAU,sMACV,KAAM,EACN,MAAOihB,GACP,SAAWxd,GACTyd,GAAkBzd,EAAE,OAAO,KAAK,EAElC,YAAa;AAAA;AAAA,GAAA,CAAA,EAEfkC,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAA3F,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASiuB,GACV,SAAA,WAAA,CAAA,EAGDjuB,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAAS,IAAMkhB,GAAkB,EAAE,EACpC,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEAlhB,EAAAA,IAAC,MAAA,CAAI,UAAU,qCACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,sDACV,QAASuqB,GACT,SACEhN,KAAqB,GACrBrO,KAAmB,EAEtB,SAAA,qBAAA,CAAA,EAGH,CAAA,EACF,CAAA,EACF,CAAA,EAEJ,EAGCuD,GACCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,kEACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,IAAS,CAC3B,MAAMuoB,EAAYvoB,GAAQ,OACpBwoB,EAAY,OAAO,SAAS1rB,CAAK,EACnC,KAAK,IAAI,EAAGA,CAAK,EACjB,EACEoiB,EAAM,KAAK,IAAA,EACjB,GAAIsJ,GAAa,EAAG,CAElB,GADID,IAAc,QAEhBrJ,GAAO7J,GAAoB,SAAW,GACtC,KAEA,OAEFA,GAAoB,QAAU6J,CAChC,MACE7J,GAAoB,QAAU,EAEhCuK,GAAe4I,CAAS,CAC1B,CAAA,CAAA,EAEJ,CAAA,EAEJ,EAEE5d,IAAyB,OAAS,CAACb,GACnCzS,EAAAA,IAAA4F,EAAAA,SAAA,CACE,SAAA5F,EAAAA,IAAC6vB,GAAA,CACC,SAAUvc,EACV,QAASgQ,GACT,WAAY,GAAGxU,EAAU,IAAIC,EAAM,EAAA,CAAA,EAEvC,EAEAuE,IAAyB,WACzBtT,EAAAA,IAAA4F,EAAAA,SAAA,CACE,SAAA5F,EAAAA,IAAC6vB,GAAA,CACC,SAAS,UACT,QAAStM,EAAA,CAAA,EAEb,EAGAjQ,IAAyB,WAAab,GACtCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACjB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CACjC,GAAIpqB,EAAQ,EAEV,OAAA8nB,GACE9nB,EAFQkD,IAAS,OAAS,OAAYA,EAItCknB,GAAM,QAAU,IAAA,EAEX,EAEX,CAAA,CAAA,EAEN,EAEAtc,IAAyB,YACzBtT,EAAAA,IAAA4F,EAAAA,SAAA,CACE,SAAA5F,EAAAA,IAAC6vB,GAAA,CACC,SAAS,WACT,QAASrM,EAAA,CAAA,EAEb,EAGAlQ,IAAyB,YACzBb,GACEzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACnB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CACjC,GAAIpqB,EAAQ,EAEV,OAAAioB,GACEjoB,EAFQkD,IAAS,OAAS,OAAYA,EAItCknB,GAAM,QAAU,IAAA,EAEX,EAEX,CAAA,CAAA,EAEJ,EAEFtc,IAAyB,UACzBtT,EAAAA,IAAA4F,EAAAA,SAAA,CACE,SAAA5F,EAAAA,IAAC6vB,GAAA,CACC,SAAS,SACT,QAASpM,EAAA,CAAA,EAEb,EAEAnQ,IAAyB,QACzBtT,EAAAA,IAAA4F,EAAAA,SAAA,CACE,SAAA5F,EAAAA,IAAC6vB,IAAe,SAAS,OAAO,QAASnM,EAAA,CAAW,EACtD,EAGApQ,IAAyB,QAAUb,GACnCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACjB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CACjC,GAAIpqB,EAAQ,EACV,OAAAmX,GACEjQ,GAAYgQ,GAAYlX,EAAOkD,CAAW,CAAA,EAErC,EAEX,CAAA,CAAA,EAEN,EAEA4K,IAAyB,SACzBtT,EAAAA,IAAA4F,EAAAA,SAAA,CACE,SAAA5F,EAAAA,IAAC6vB,GAAA,CACC,SAAS,QACT,QAASlM,EAAA,CAAA,EAEb,EAGArQ,IAAyB,SAAWb,GACpCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACjB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CACjC,GAAIpqB,EAAQ,EACV,OAAAuX,GACE7P,GAAa4P,GAAatX,CAAkB,CAAA,EAEvC,EAEX,CAAA,CAAA,EAEN,EAEA8N,IAAyB,UACzBtT,EAAAA,IAAA4F,EAAAA,SAAA,CACE,SAAA5F,EAAAA,IAAC6vB,GAAA,CACC,SAAS,SACT,QAASjM,EAAA,CAAA,EAEb,EAGAtQ,IAAyB,UAAYb,GACrCzS,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAAC2vB,EAAA,CACC,YAAY,SACZ,YAAavc,EACb,oBAAmB,GACjB,WAAY,CAAC5N,EAAOkD,EAAMknB,IAAS,CACjC,GAAIpqB,EAAQ,EACV,OAAA2X,GACE1P,GACEyP,GACA1X,CAEF,CAAA,EAEK,EAEX,CAAA,CAAA,EAEN,QAED,MAAA,CAAI,UAAU,gBAAgB,SAAA,YAAS,EACxCG,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOyW,EACP,SAAWhT,GACTiT,EAAoB,OAAOjT,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZA,EAAE,SAAW0qB,GAAA,EAAgB9E,GAAA,EACjC,CAAA,CAAA,EAEFrpB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASqpB,GACT,MAAM,2BACP,SAAA,UAAA,CAAA,CAED,EACF,EAEA1jB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK4O,GAAe,IAAM,IAAM,IAChC,YAAY,sBACZ,MAAOmb,GACP,SAAWtmB,GACTwmB,GAAuBxmB,EAAE,OAAO,KAAK,EAEvC,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS4mB,GAAA,CACzB,CAAA,CAAA,EAEFrqB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASqqB,GACT,MAAM,qCACP,SAAA,cAAA,CAAA,CAED,EACF,EACA1kB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA3F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,YAAY,+BACZ,MAAO+gB,GACP,SAAWtd,GAAMud,GAAavd,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZA,EAAE,SAAW2qB,GAAA,EAAsBJ,GAAA,EACvC,CAAA,CAAA,EAEFhuB,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAASouB,GACT,SAAU7Q,KAAqB,EAChC,SAAA,cAAA,CAAA,EAGDvd,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASguB,GACV,SAAA,KAAA,CAAA,CAED,EACF,SACC,MAAA,CACC,SAAA,CAAAhuB,EAAAA,IAAC,WAAA,CACC,UAAU,gCACV,YAAY;AAAA;AAAA;AAAA;AAAA,yBACZ,MAAOihB,GACP,SAAWxd,GAAMyd,GAAkBzd,EAAE,OAAO,KAAK,CAAA,CAAA,EAEnDkC,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAA3F,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASiuB,GACV,SAAA,gBAAA,CAAA,EAGDjuB,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAAS,IAAMkhB,GAAkB,EAAE,EACpC,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,CAAA,EACF,QACC,MAAA,CAAI,UAAU,yBAAyB,SAAA,kDAExC,CAAA,EACF,EAEFlhB,EAAAA,IAAC,MAAA,CAAI,UAAU,MAAM,CAAA,CAAA,CAAA,CACvB,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EAGH0T,UAAcnC,GAAA,CAAc,QAAS,IAAMoC,GAAa,EAAK,EAAG,EAEhEib,IACCjpB,EAAAA,KAAC,MAAA,CAAI,UAAU,yDACb,SAAA,CAAA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,oDAAoD,EACnE2F,EAAAA,KAAC,MAAA,CAAI,UAAU,+EACb,SAAA,OAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,KAAE,QAChC,MAAA,CAAI,UAAU,gBAAgB,SAAA,sBAAmB,QACjD,MAAA,CAAI,UAAU,4BAA4B,SAAA,6EAG3C,EACAA,EAAAA,KAAC,SAAA,CACC,QAAS,SAAY,CACnB,GAAI,CASF,MAAMpC,EAAO,MARD,MAAM,MAChB,GAAGkO,EAAO,sCACV,CACE,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,MAAOE,GAAM,MAAO,CAAA,CAC7C,GAEqB,KAAA,EACnBpO,EAAK,IAAMA,EAAK,KAClB,OAAO,SAAS,KAAOA,EAAK,IACxBA,EAAK,aACP8R,GACE,iDACA,CAAE,KAAM,OAAQ,QAAS,GAAA,CAAK,GAGzB9R,EAAK,QAAU,wBACxB8R,GACE,oHACA,CAAE,KAAM,QAAS,QAAS,GAAA,CAAK,EAGjCA,GACE,uDACA,CAAE,KAAM,QAAS,QAAS,GAAA,CAAK,CAGrC,MAAc,CACZA,GAAM,6CAA8C,CAClD,KAAM,QACN,QAAS,GAAA,CACV,CACH,CACF,EACA,UAAU,gFACX,SAAA,CAAA,uBACsB,IACpB8b,GAAsBC,GAAA,EAAmB,CAAC,CAAA,CAAA,CAAA,CAC7C,EACF,CAAA,EACF,EAEDvP,IAAqB,OAAO,SAAa,IACtCwP,GAAAA,aACErxB,EAAAA,IAAC,MAAA,CACC,UAAU,yEACV,QAAS,IAAMwW,GAAqB,EAAK,EAEzC,SAAAxW,EAAAA,IAACivB,GAAA,CACC,WAAW,mCACX,UAAU,WACV,aAAc,IACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,KACV,UAAW,IACX,iBAAgB,GAChB,QAAS,IAAMzY,GAAqB,EAAK,EAEzC,SAAA7Q,EAAAA,KAAC,MAAA,CACC,UAAU,YACV,QAAUlC,GAAMA,EAAE,gBAAA,EAElB,SAAA,CAAAkC,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,iBAE/D,QACC,MAAA,CAAI,UAAU,wCAAwC,SAAA,8BAEvD,CAAA,EACF,EACA3F,EAAAA,IAAC,SAAA,CACC,UAAU,iDACV,QAAS,IAAMwW,GAAqB,EAAK,EAC1C,SAAA,OAAA,CAAA,CAED,EACF,EACAxW,EAAAA,IAACvD,GAAA,CACC,KAAI,GACJ,KAAAkV,EACA,YAAA/C,EACA,QAAAC,EACA,SAAAkB,EACA,QAAA6D,GACA,aAAAM,GACA,iBAAAU,EACA,kBAAAwI,GACA,cAAAoB,GACA,iBAAAa,GACA,aAAAE,GACA,kBAAAE,GACA,cAAAE,GACA,WAAAE,GACA,WAAAE,GACA,WAAAE,GACA,OAAAE,GACA,OAAAE,GACA,OAAAE,GACA,sBAAAE,GACA,kBAAAE,GACA,QAAS,IAAMnK,GAAqB,EAAK,EACzC,OAAQ,IAAMA,GAAqB,EAAI,EACvC,OAAQ5E,CAAA,CAAA,CACV,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EAEF,SAAS,IAAA,EAEX,KACH+P,IAAsB,OAAO,SAAa,IACvC0P,GAAAA,cACG,IAAM,CACL,KAAM,CAAE,OAAA11B,EAAQ,MAAA6J,EAAO,MAAA8rB,CAAA,EAAU3P,GAC3B4P,EACJ51B,IAAW,SAAWynB,GAAYC,GAC9BmO,EAAc71B,IAAW,SAAWmT,GAAaC,GACvD,OACE/O,EAAAA,IAAC,MAAA,CACC,UAAU,yEACV,QAASwlB,GAET,SAAAxlB,EAAAA,IAACivB,GAAA,CACC,WAAW,iCACX,UAAU,WACV,aAAc,IACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,IACV,UAAW,IACX,iBAAgB,GAChB,QAASzJ,GAET,SAAA7f,EAAAA,KAAC,MAAA,CACC,UAAU,kCACV,QAAUlC,GAAMA,EAAE,gBAAA,EAElB,SAAA,CAAAkC,OAAC,MAAA,CACC,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,CAAA,QACvD2rB,EAAM,OAAA,EACd,QACC,MAAA,CAAI,UAAU,wCAAwC,SAAA,iBAEvD,CAAA,EACF,QACC,MAAA,CAAI,UAAU,yCACZ,SAAAA,IAAU,EACT3rB,EAAAA,KAAAC,EAAAA,SAAA,CAAE,SAAA,CAAA,OACK2rB,EAAW,aAAgB,UAC/B,OAAA,CAAK,UAAU,2BACb,SAAA/rB,EACH,EAAO,wBAAA,EAET,EAEAG,EAAAA,KAAAC,EAAAA,SAAA,CAAE,SAAA,CAAA,2BACyB2rB,EAAW,aACjC,UACF,OAAA,CAAK,UAAU,2BACb,SAAA/rB,EACH,EAAO,WACE,UACR,OAAA,CAAK,UAAU,iCAAiC,SAAA,MAEjD,EAAQ,IAAI,uBAAA,CAAA,CAEd,CAAA,CAEJ,EACAG,EAAAA,KAAC,MAAA,CAAI,UAAU,4DACb,SAAA,OAAC,MAAA,CAAI,UAAU,qDAAqD,SAAA,eAEpE,QACC,MAAA,CAAI,UAAU,qCACZ,SAAA6rB,EACH,CAAA,EACF,EACA7rB,EAAAA,KAAC,MAAA,CAAI,UAAU,2CACb,SAAA,CAAA3F,EAAAA,IAAC,SAAA,CACC,UAAU,+CACV,QAASwlB,GACV,SAAA,IAAA,CAAA,EAGDxlB,EAAAA,IAAC,SAAA,CACC,UAAU,qDACV,QAASulB,GACV,SAAA,KAAA,CAAA,CAED,EACF,CAAA,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAGN,GAAA,EACA,SAAS,IAAA,EAEX,KACHrR,IACClU,EAAAA,IAAC,MAAA,CAAI,UAAU,6EACb,SAAA2F,EAAAA,KAACspB,GAAA,CACC,WAAW,wBACX,UAAU,kBACV,aAAc,IACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,IACV,UAAW,IACX,iBAAgB,GAEhB,SAAA,OAAC,KAAA,CAAG,UAAU,yBAAyB,SAAA,WAAQ,QAC9C,QAAA,CAAM,UAAU,aAAa,SAAA,uBAAoB,EAClDjvB,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACZ,SAAA,CAAC,EAAG,EAAG,CAAC,EAAE,IAAKuI,GACdvI,EAAAA,IAAC,SAAA,CAEC,UAAW,OAAO8U,IAAgBvM,EAAI,eAAiB,EAAE,GACzD,QAAS,IAAMwM,EAAexM,CAAC,EAE9B,SAAAA,CAAA,EAJIA,CAAA,CAMR,EACH,QACC,QAAA,CAAM,UAAU,aAAa,SAAA,sBAAmB,EACjDvI,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACZ,SAAA,CAAC,EAAG,EAAG,CAAC,EAAE,IAAKuI,GACdvI,EAAAA,IAAC,SAAA,CAEC,UAAW,OAAOgV,IAAkBzM,EAAI,eAAiB,EAAE,GAC3D,QAAS,IAAM0M,GAAiB1M,CAAC,EAEhC,SAAAA,CAAA,EAJIA,CAAA,CAMR,EACH,EACA5C,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAA3F,MAAC,SAAA,CAAO,UAAU,aAAa,QAASsuB,GAAsB,SAAA,SAE9D,EACAtuB,EAAAA,IAAC,SAAA,CACC,UAAU,iDACV,QAAS,IAAM,CACbmU,EAAgB,EAAK,EACrBoT,GAAA,CACF,EACD,SAAA,SAAA,CAAA,EAGDvnB,EAAAA,IAAC,SAAA,CACC,UAAU,6CACV,QAAS,IAAM,CACbmU,EAAgB,EAAK,EACrBqB,GAAkB,EAAK,EACvB3B,GAAW,EAAK,CAClB,EACD,SAAA,cAAA,CAAA,CAED,EACF,CAAA,CAAA,CAAA,EAEJ,EAEDgN,IACC7gB,EAAAA,IAAC,MAAA,CAAI,UAAU,oEACb,SAAA2F,EAAAA,KAACspB,GAAA,CACC,WAAW,4BACX,UAAU,kBACV,aAAc,IACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,KACV,UAAW,IACX,iBAAgB,GAEhB,SAAA,OAAC,KAAA,CAAG,UAAU,8BAA8B,SAAA,gBAAa,EACzDtpB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAA2N,EAAa,MAAIvD,EAAS,qBAAmBqE,EAAA,EAChD,GACE,IAAM,CACN,MAAMqd,EACJpS,GAAmB,EACdI,GAAoBJ,GAAoB,EACzC,EACAqS,EAAYD,EAAY,EACxBE,GAAc,IAAM,CACxB,MAAMvjB,EAAQwB,EACX,OACEgB,GACCA,EAAE,SAAW,UACb,OAAOA,EAAE,aAAgB,QAAA,EAE5B,IAAKA,GAAMA,EAAE,WAAW,EAC3B,OAAKxC,EAAM,OACJ,GAAG,KAAK,IAAI,GAAGA,CAAK,CAAC,SADF,GAE5B,GAAA,EACMwjB,GAAe,IAAM,CACzB,MAAMxjB,EAAQwB,EACX,OACEgB,GACCA,EAAE,SAAW,UACb,OAAOA,EAAE,aAAgB,QAAA,EAE5B,IAAKA,GAAMA,EAAE,WAAW,EAC3B,OAAKxC,EAAM,OACJ,GAAG,KAAK,IAAI,GAAGA,CAAK,CAAC,SADF,GAE5B,GAAA,EACMyjB,EACJpiB,GAAmB,EACf,KAAK,MAAOD,GAAmBC,GAAoB,GAAG,EACtD,EAEAqiB,EACJvS,GAAe,EAAKI,GAAgBJ,GAAgB,EAAI,EACpDwS,EAAQD,EAAQ,EAChBE,GAAU,IAAM,CACpB,MAAM5jB,EAAQwB,EACX,OACEgB,GACCA,EAAE,SAAW,MAAQ,OAAOA,EAAE,aAAgB,QAAA,EAEjD,IAAKA,GAAMA,EAAE,WAAW,EAC3B,OAAKxC,EAAM,OACJ,GAAG,KAAK,IAAI,GAAGA,CAAK,CAAC,SADF,GAE5B,GAAA,EACM6jB,GAAW,IAAM,CACrB,MAAM7jB,EAAQwB,EACX,OACEgB,GACCA,EAAE,SAAW,MAAQ,OAAOA,EAAE,aAAgB,QAAA,EAEjD,IAAKA,GAAMA,EAAE,WAAW,EAC3B,OAAKxC,EAAM,OACJ,GAAG,KAAK,IAAI,GAAGA,CAAK,CAAC,SADF,GAE5B,GAAA,EACM8jB,EACJviB,GAAe,EACX,KAAK,MAAOD,GAAeC,GAAgB,GAAG,EAC9C,EAEN,OACEhK,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,+CACb,SAAA,CAAA3F,MAAC,MAAA,CAAI,UAAU,6BACZ,SAAA2R,GAAM,UAAY,MACrB,QACC,MAAA,CAAI,UAAU,0BACZ,SAAA7C,GACH,QACC,MAAA,CAAI,UAAU,qBAAqB,SAAA,WAAQ,EAC5CnJ,EAAAA,KAAC,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBACZ,SAAA8rB,EAAU,QAAQ,CAAC,CAAA,CACtB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBACZ,SAAAC,EAAU,QAAQ,CAAC,CAAA,CACtB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,kBAAe,QAC3C,MAAA,CAAI,UAAU,gBACZ,SAAAjiB,GACH,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,WAAQ,EACrC9J,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAiB,SAAA,CAAAksB,EAAU,GAAA,EAAC,CAAA,EAC7C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,gBAAa,QACzC,MAAA,CAAI,UAAU,gBAAiB,SAAAF,EAAW,CAAA,EAC7C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,iBAAc,QAC1C,MAAA,CAAI,UAAU,gBAAiB,SAAAC,EAAY,CAAA,EAC9C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBAAiB,SAAA/R,GAAW,CAAA,EAC7C,CAAA,EACF,CAAA,EACF,QACC,MAAA,CAAI,UAAU,6CACb,SAAAla,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACZ,SAAA,CAAAmJ,GAAW,MAAIC,EAAA,CAAA,CAClB,CAAA,CACF,EACApJ,EAAAA,KAAC,MAAA,CAAI,UAAU,+CACb,SAAA,CAAA3F,EAAAA,IAAC,MAAA,CAAI,UAAU,6BACZ,SAAA8P,IAAO,OAAS,WAAa,GAAGA,CAAE,KAAA,CACrC,QACC,MAAA,CAAI,UAAU,0BAA2B,SAAAf,GAAO,QAChD,MAAA,CAAI,UAAU,qBAAqB,SAAA,WAAQ,EAC5CpJ,EAAAA,KAAC,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBACZ,SAAAmsB,EAAM,QAAQ,CAAC,CAAA,CAClB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBACZ,SAAAC,EAAM,QAAQ,CAAC,CAAA,CAClB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,kBAAe,QAC3C,MAAA,CAAI,UAAU,gBAAiB,SAAApiB,GAAa,CAAA,EAC/C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,WAAQ,EACrChK,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAiB,SAAA,CAAAusB,EAAM,GAAA,EAAC,CAAA,EACzC,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,gBAAa,QACzC,MAAA,CAAI,UAAU,gBAAiB,SAAAF,EAAO,CAAA,EACzC,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,iBAAc,QAC1C,MAAA,CAAI,UAAU,gBAAiB,SAAAC,EAAQ,CAAA,EAC1C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBAAiB,SAAA9R,GAAO,CAAA,EACzC,CAAA,EACF,CAAA,EACF,CAAA,EACF,CAEJ,GAAA,EACAxa,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,gBAAa,EACzD3F,EAAAA,IAAC,OAAI,UAAU,uBACZ,WAAS,IAAI,CAAC0Q,EAAKpG,IAClB3E,EAAAA,KAAC,MAAA,CAEC,UAAW,yCAAyC+K,EAAI,SAAW,SAAW,0CAA4C,yCAAyC,GACpK,SAAA,CAAA,OACMpG,EAAI,EAAE,IAAE,IACZoG,EAAI,SAAW,SACZ,MACAZ,IAAO,OACL,MACA,KAAM,IAAI,SACTY,EAAI,YAAY,SAAOA,EAAI,aAAA,CAAA,EAT7BpG,CAAA,CAWR,EACH,CAAA,EACF,EACA3E,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,gBAAa,QACxD,MAAA,CAAI,UAAU,2CAEb,SAAA3F,EAAAA,IAACsG,KAAQ,CAAA,CACX,CAAA,EACF,EACAX,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAA3F,EAAAA,IAAC,SAAA,CACC,UAAU,sCACV,QAAS,IAAM8gB,GAAoB,EAAK,EACzC,SAAA,OAAA,CAAA,EAGD9gB,EAAAA,IAAC,SAAA,CACC,UAAU,0CACV,QAAS,IAAM,CACb8gB,GAAoB,EAAK,EACzByG,GAAA,CACF,EACD,SAAA,SAAA,CAAA,CAED,EACF,CAAA,CAAA,CAAA,EAEJ,EAED3X,EAAS,OAAS,GACjBjK,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,KAAA,CAAG,UAAU,qBAAqB,SAAA,YAAS,EAC5C3F,EAAAA,IAAC,MACE,SAAA4P,EAAS,IAAI,CAACc,EAAKpG,WACjB,KAAA,CAAW,SAAA,CAAA,OACLA,EAAI,EAAE,mBAAiBoG,EAAI,YAAY,oBAAkB,IAC7DA,EAAI,aAAA,CAAA,EAFEpG,CAGT,CACD,EACH,CAAA,EACF,CAAA,EAIJ,CAAA,EACF,CAEJ"}
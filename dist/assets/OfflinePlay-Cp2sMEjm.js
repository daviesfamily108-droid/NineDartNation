import{b as Hr,u as st,j as e,c as ji,d as Tl,e as Ll,f as Ml,r as El,h as Rl,i as ya,s as Al,k as Hi,l as Il,m as Vr,D as Pl,n as Fn,o as or,R as Vn,F as Ni,p as Pe,q as wi,B as Is,t as Bl,v as Ol,a as Ul,w as yi,x as Si,y as Fl,z as Vl,A as $l,C as Hl}from"./index-CQ32xty6.js";import{r as n}from"./ui-gqBJRRJB.js";import{G as _l}from"./GameCalibrationStatus-DrVaDDtY.js";import{u as Ci,M as Wl}from"./MatchControls-36iKtGo4.js";import{M as Kl}from"./MatchStartShowcase-DtmkGApf.js";import"./vendor-D3F3s8fL.js";const zl=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function Gl(s){return s==="DB"?50:Number(s.slice(1))*2}function ql(s){return zl.includes(s)?Gl(s):32}function Xl(s,i="D16"){if(s>170||s<=1)return[];const d={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(d[s])return d[s];const u=ql(i),l=[];for(const m of[60,57,54,51,48])if(s-m===u){l.push(`T${m/3} ${i}`);break}if(!l.length){for(const m of[20,19,18,17,16,15])if(s-m===u){l.push(`${m} ${i}`);break}}return l}function Ur(s,i,d,u,l){try{const m=window.speechSynthesis;if(!m)return;const p=new SpeechSynthesisUtterance,L=d<=170&&d>0,z=i===180;if(!(!l?.checkoutOnly||L||z))return;if(z?(p.text=`${s}! One eighty!`,p.rate=1.04,p.pitch=1.15):L?(p.text=`${s}, ${d} remaining.`,p.rate=1,p.pitch=1):i===0?(p.text=`${s}, no score.`,p.rate=1,p.pitch=1):(p.text=`${s}, ${i}.`,p.rate=1,p.pitch=1),u){const W=m.getVoices().find(Q=>Q.name===u);W&&(p.voice=W)}typeof l?.volume=="number"?p.volume=Math.max(0,Math.min(1,l.volume)):p.volume=1;try{m.cancel()}catch{}m.speak(p)}catch{}}function ki({label:s,autoStart:i,scale:d,className:u,aspect:l="inherit",style:m,fill:p=!1}){const L=n.useRef(null),z=Hr(),[G,W]=n.useState(!1),[Q,q]=n.useState(null),[S,w]=n.useState(null),[J,C]=n.useState(null),fe=n.useRef(null),me=n.useCallback((b,y="local")=>{try{b?(z.setMediaStream(b),L.current&&z.setVideoElementRef(L.current),z.setMode(y),z.setStreaming(!0),fe.current=y):fe.current&&fe.current!=="phone"&&(z.setStreaming(!1),z.setMediaStream(null),fe.current=null)}catch(D){console.warn("[CameraTile] Failed to register stream with camera session:",D)}},[z]),pe=st(b=>b.preferredCameraLabel),[O,ne]=n.useState(()=>pe==="Phone Camera"?"phone":localStorage.getItem("ndn:camera:mode")||"local"),[,Ae]=n.useState(null),[,Ne]=n.useState(!1),[We,Ge]=n.useState(null),[qe,Be]=n.useState(null),[T,ce]=n.useState(!0),[g,St]=n.useState([]),[F,Ct]=n.useState(!1),[re,Z]=n.useState([]),[Ke,mt]=n.useState(!1),jt=st(b=>b.autoscoreProvider),Xe=st(b=>b.cameraEnabled),ee=st(b=>b.setPreferredCameraLocked),ve=st(b=>b.preferredCameraLocked),be=st(b=>b.setPreferredCamera),is=st(b=>b.preferredCameraId);if(jt==="manual"){const y=[p?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",u].filter(Boolean).join(" ").trim(),D={...m||{}};return!p&&D.aspectRatio===void 0&&D.height===void 0&&D.minHeight===void 0&&(D.aspectRatio="4 / 3"),e.jsx("div",{className:y,style:D,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}n.useEffect(()=>{const b=window.location.hostname;(b==="localhost"||b==="127.0.0.1")&&ji("/api/hosts").then(y=>y.json()).then(y=>{const D=Array.isArray(y?.hosts)&&y.hosts.find($=>$);D&&Ge(D)}).catch(()=>{}),ji("/api/https-info").then(y=>y.json()).then(y=>{y&&typeof y.https=="boolean"&&Be({https:!!y.https,port:Number(y.port)||8788})}).catch(()=>{})},[]);const ln=n.useMemo(()=>{const b=S||"____",y="ws://localhost:8787";if(y.length>0)try{const Y=new URL(y);return`${`${Y.protocol==="wss:"?"https":"http"}://${Y.host}${Y.pathname.endsWith("/ws")?"":Y.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${b}`}catch{}const D=We||window.location.hostname,$=!!qe?.https,I=$?qe?.port||8788:8787;return`${$?"https":"http"}://${D}:${I}/mobile-cam.html?code=${b}`},[S,We,qe]);n.useEffect(()=>{localStorage.setItem("ndn:camera:mode",O)},[O]);const[De,he]=n.useState(null);n.useEffect(()=>{st.getState().ignorePreferredCameraSync||De&&Date.now()-De<3e4||pe==="Phone Camera"&&O!=="phone"&&ne("phone")},[pe,O,De]),n.useEffect(()=>{if(!(!Xe||jt&&jt!=="built-in"&&jt!=="external-ws")&&i!==void 0){if(i){let b=!1;const y=pe||"default",D=window.setTimeout(()=>{b||G||ge().catch($=>console.warn(`[CameraTile] Auto-start failed for ${y}:`,$))},200);return()=>{b=!0,window.clearTimeout(D)}}Ut()}},[i,G,Xe,jt,pe,ge,Ut]),n.useEffect(()=>{const b=async()=>{try{if(!(pe==="Phone Camera"&&(!De||Date.now()-De>=3e4)||O==="phone"))return;const $=z.getMediaStream(),I=L.current;if(!I||!$)return;I.srcObject!==$&&(I.srcObject=$),I.muted=!0,I.playsInline=!0;try{await I.play()}catch{}W(!0)}catch{}};b();const y=setInterval(b,800);return()=>clearInterval(y)},[pe,O,z,z.isStreaming]);const ge=n.useCallback(async()=>{if(O==="wifi")return es();if(pe==="Phone Camera"||O==="phone"){const b=z.getMediaStream();if(b&&L.current)try{L.current.srcObject=b,await L.current.play(),W(!0);return}catch{}if(O==="phone")try{await zt();return}catch{}}try{const{preferredCameraId:b,setPreferredCamera:y}=st.getState(),D=b?{video:{deviceId:{exact:b}},audio:!1}:{video:!0,audio:!1};let $;try{$=await navigator.mediaDevices.getUserMedia(D)}catch(I){const je=I&&(I.name||I.code)||"";if(b&&(je==="OverconstrainedError"||je==="NotFoundError"))$=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw I}L.current&&(L.current.srcObject=$,await L.current.play(),W(!0),me($,"local"))}catch{}},[O,pe,z,me,zt,es]),Ut=n.useCallback(()=>{L.current&&L.current.srcObject&&(L.current.srcObject.getTracks().forEach(y=>y.stop()),L.current.srcObject=null,W(!1),me(null))},[me]);async function es(){Ct(!0);try{const b=await Tl();St(b),b.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(b){console.error("Wifi device discovery failed:",b),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Ct(!1)}}async function Oe(b){try{St(D=>D.map($=>$.id===b.id?{...$,status:"connecting"}:$));const y=await Ll(b);if(y&&L.current)L.current.srcObject=y,await L.current.play(),W(!0),me(y,"wifi"),St(D=>D.map($=>$.id===b.id?{...$,status:"online"}:$));else throw new Error("Failed to get video stream")}catch(y){console.error("Failed to connect to wifi device:",y),alert(`Failed to connect to ${b.name}. Please check the device and try again.`),St(D=>D.map($=>$.id===b.id?{...$,status:"offline"}:$))}}async function K(){mt(!0);try{const b=await Ml();Z(b);const y=await El();y&&Z(D=>[...D,y]),b.length===0&&!y&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(b){console.error("USB device discovery failed:",b),alert("Failed to discover USB devices. Please check device connections.")}finally{mt(!1)}}async function nt(b){try{Z(D=>D.map($=>$.id===b.id?{...$,status:"connecting"}:$));const y=await Rl(b);if(y&&L.current)L.current.srcObject=y,await L.current.play(),W(!0),ne("wifi"),me(y,"wifi"),Z(D=>D.map($=>$.id===b.id?{...$,status:"online"}:$));else throw new Error("Failed to get video stream")}catch(y){console.error("Failed to connect to USB device:",y),alert(`Failed to connect to ${b.name}. Please check the device and try again.`),Z(D=>D.map($=>$.id===b.id?{...$,status:"offline"}:$))}}const ht=n.useCallback(b=>{try{ne(b==="usb"?"wifi":b),he(Date.now());try{if(b==="local"){try{be(is,"Local",!0)}catch{}try{ee(!0)}catch{}}else if(b==="phone"){try{be(void 0,"Phone Camera",!0)}catch{}try{ee(!0)}catch{}}else if(b==="wifi"||b==="usb"){try{be(void 0,"WiFi/USB",!0)}catch{}try{ee(!0)}catch{}}}catch{}b==="local"?ge().catch(()=>{}):b==="phone"?zt():b==="wifi"?es():b==="usb"&&K()}catch(y){console.warn("[CameraTile] handleModeSelect failed",y)}},[ge,zt,es,K,be,ee,is]);n.useEffect(()=>{const b=y=>{try{const D=y&&y.detail&&y.detail.mode;D&&["local","phone","wifi","usb"].includes(D)?(ht(D),ge().catch(()=>{})):ge().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",b),()=>{window.removeEventListener("ndn:start-camera",b)}},[ge,ht]);function Ye(){if(Q&&Q.readyState===WebSocket.OPEN)return Q;const b="ws://localhost:8787",y=b.length>0?b.endsWith("/ws")?b:b.replace(/\/$/,"")+"/ws":void 0,D=window.location.protocol==="https:"?"wss":"ws",$=`${D}://${window.location.host}/ws`,I=window.location.hostname,je=I==="localhost"||I==="127.0.0.1",Y=I.endsWith("onrender.com"),kt="wss://ninedartnation.onrender.com/ws";let we=y;we||(je?we=`${D}://${I}:8787/ws`:Y?we=$:we=kt),we||(we=$);const ae=new WebSocket(we);return q(ae),ae}async function zt(){ne("phone"),Ne(!1);const b=Ye();b.readyState===WebSocket.OPEN?b.send(JSON.stringify({type:"cam-create"})):b.onopen=()=>b.send(JSON.stringify({type:"cam-create"})),b.onmessage=async y=>{const D=JSON.parse(y.data);if(D.type==="cam-code")w(D.code),D.expiresAt&&Ae(D.expiresAt);else if(D.type==="cam-peer-joined"){Ne(!0);const $=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});C($),$.onicecandidate=je=>{je.candidate&&S&&b.send(JSON.stringify({type:"cam-ice",code:S,payload:je.candidate}))},$.ontrack=je=>{if(L.current){const Y=je.streams?.[0];Y&&(L.current.srcObject=Y,L.current.play().catch(()=>{}),W(!0))}};const I=await $.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await $.setLocalDescription(I),S&&b.send(JSON.stringify({type:"cam-offer",code:S,payload:I}))}else if(D.type==="cam-answer")J&&await J.setRemoteDescription(new RTCSessionDescription(D.payload));else if(D.type==="cam-ice"&&J)try{await J.addIceCandidate(D.payload)}catch{}}}function ze(){w(null),Ae(null),Ne(!1),Q&&Q.readyState===WebSocket.OPEN?Q.send(JSON.stringify({type:"cam-create"})):zt();try{ee(!0)}catch{}}function Nt(){if(Ut(),w(null),Ne(!1),Ae(null),J){try{J.close()}catch{}C(null)}}return e.jsx(Yl,{label:s,autoStart:i,start:ge,stopAll:Nt,startPhonePairing:zt,startWifiConnection:es,startUsbConnection:K,connectToWifiDevice:Oe,connectToUsbDevice:nt,videoRef:L,streaming:G,mode:O,setMode:ne,pairCode:S,mobileUrl:ln,regenerateCode:ze,httpsInfo:qe,showTips:T,setShowTips:ce,wifiDevices:g,usbDevices:re,discoveringWifi:F,discoveringUsb:Ke,scaleOverride:d,className:u,aspect:l,style:m,fill:p,onModeSelect:ht,preferredCameraLocked:ve})}function Yl(s){const i=Hr(),{cameraScale:d,cameraAspect:u}=st(),{label:l,start:m,stopAll:p,startPhonePairing:L,startWifiConnection:z,startUsbConnection:G,connectToWifiDevice:W,connectToUsbDevice:Q,videoRef:q,streaming:S,mode:w,setMode:J,onModeSelect:C,pairCode:fe,mobileUrl:me,regenerateCode:pe,httpsInfo:O,showTips:ne,setShowTips:Ae,wifiDevices:Ne,usbDevices:We,discoveringWifi:Ge,discoveringUsb:qe,className:Be,aspect:T,style:ce,fill:g,preferredCameraLocked:St}=s,F={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},Ct=n.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{C&&C("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{C&&C("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{C&&C("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{C&&C("usb")}}],[J,m,L,z,G]),[re,Z]=n.useState(null),Ke=n.useRef(null);n.useEffect(()=>()=>{Ke.current&&window.clearTimeout(Ke.current)},[]);const{cameraFitMode:mt}=st(),jt=g?"fill":mt||"fill",Xe=(()=>{const K=Number(s.scaleOverride??d??1),nt=Math.max(.5,Math.min(1.25,K));return jt==="fill"?Math.max(1,nt):nt})(),ee=g&&jt==="fill"?"free":T&&T!=="inherit"?T:u||"wide",ve=ee!=="free",be=ve?ee==="square"?"aspect-square":ee==="portrait"?"aspect-[3/4]":ee==="classic"?"aspect-[4/3]":"aspect-video":"",ln=[g?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",Be].filter(Boolean).join(" ").trim(),De={...ce||{}},he=g?"relative flex-1 min-h-[420px] bg-black":"relative w-full bg-black",ge={style:{transform:`scale(${Xe})`,transformOrigin:"center"}},Ut=w==="wifi"&&We.some(K=>K.status==="online"),es=(()=>{const nt=jt==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return g?ve?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${be}`,children:e.jsx("video",{ref:q,className:nt,...ge})})}):e.jsx("video",{ref:q,className:nt,...ge}):ve?e.jsx("div",{className:`relative w-full ${be}`,children:e.jsx("video",{ref:q,className:nt,...ge})}):e.jsx("div",{className:"relative w-full",children:e.jsx("video",{ref:q,className:nt,...ge})})})();async function Oe(K,nt){if(K)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(K);else{const ht=document.createElement("textarea");ht.value=K,ht.style.position="fixed",ht.style.opacity="0",document.body.appendChild(ht),ht.focus(),ht.select(),document.execCommand("copy"),document.body.removeChild(ht)}Z(nt),Ke.current&&window.clearTimeout(Ke.current),Ke.current=window.setTimeout(()=>Z(null),1500)}catch(ht){console.warn("Copy to clipboard failed:",ht),Z(null)}}return e.jsxs("div",{className:ln,style:De,children:[e.jsxs("div",{className:he,children:[es,i.isStreaming&&w==="phone"&&e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{children:"REC"})]})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[e.jsxs("span",{className:"truncate font-medium",children:[l||(S?w==="phone"?"PHONE LIVE":w==="wifi"?"WIFI LIVE":"LIVE":"Camera"),St&&e.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!S&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${w==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>C("local"),children:"Local"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${w==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>C("phone"),children:"Phone"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${w==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>C("wifi"),children:"WiFi"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${w==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>C("usb"),children:"USB"})]}),S?e.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:p,children:"Stop"}):null]})]}),w==="phone"&&fe&&!S&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>Oe(me,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:me}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:re==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:me,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>Oe(fe,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:fe}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:re==="code"?"Copied!":"Copy"})]})]}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:pe,children:"Regenerate"})}),ne&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and"," ",O?.https?O.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>Ae(!1),children:"Hide tips"})})]})]}),w==="wifi"&&!S&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),Ge?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):Ne.length>0?e.jsxs("div",{className:"space-y-1",children:[Ne.map(K=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:K.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[K.ip,":",K.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${K.status==="connecting"?"bg-yellow-600":K.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>W(K),disabled:K.status==="connecting",children:K.status==="connecting"?"...":"Connect"})]},K.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:z,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:z,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),qe?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):We.length>0?e.jsxs("div",{className:"space-y-1",children:[We.map(K=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:K.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:K.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${K.status==="connecting"?"bg-yellow-600":K.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>Q(K),disabled:K.status==="connecting",children:K.status==="connecting"?"...":"Connect"})]},K.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:G,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:G,children:"Scan USB"})]})]})]}),!S&&e.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",F[w]||"Local"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ct.map(K=>{const nt=K.id==="usb"?Ut:K.id===w;return e.jsxs("button",{type:"button",onClick:K.action,className:`text-left p-3 rounded-2xl border ${nt?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:K.title}),e.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:K.description}),nt&&e.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},K.id)})})]})]})}function Di(s,i){const d=ya(s,i);return Al(d)}function Jl(s){try{if(!s||typeof s!="object")return null;if((s.type==="dart"||s.kind==="dart"||s.event==="dart")&&typeof s.value=="number"){const i=Ti(s.ring);return Li(s.value,i)}if(typeof s.value=="number"&&s.ring){const i=Ti(s.ring);return Li(s.value,i)}if(typeof s.score=="string"){const i=s.score.trim().toUpperCase();if(i==="50"||i==="DBULL"||i==="INNER_BULL")return{value:50,ring:"INNER_BULL",sector:null,mult:0};if(i==="25"||i==="BULL"||i==="OBULL")return{value:25,ring:"BULL",sector:null,mult:0};const d=i.match(/^(S|D|T)(\d{1,2})$/);if(d){const u=d[1]==="S"?1:d[1]==="D"?2:3,l=parseInt(d[2],10);if(l>=1&&l<=20)return{value:l*u,ring:u===1?"SINGLE":u===2?"DOUBLE":"TRIPLE",sector:l,mult:u}}}if(typeof s.sector=="number"&&typeof s.mult=="number"){const i=Math.max(1,Math.min(20,Math.floor(s.sector))),d=s.mult===1?1:s.mult===2?2:3;return{value:i*d,ring:d===1?"SINGLE":d===2?"DOUBLE":"TRIPLE",sector:i,mult:d}}if(s.bull){const i=String(s.bull).toLowerCase()==="inner"||s.bull===!0;return{value:i?50:25,ring:i?"INNER_BULL":"BULL",sector:null,mult:0}}}catch{}return null}function Ti(s){const i=String(s||"").toUpperCase();return i.startsWith("TR")?"TRIPLE":i.startsWith("DO")?"DOUBLE":i.startsWith("SI")?"SINGLE":i==="INNER_BULL"||i==="DBULL"||i==="50"||i==="IBULL"?"INNER_BULL":i==="BULL"||i==="25"||i==="OBULL"||i==="OUTER_BULL"?"BULL":i==="MISS"||i==="0"?"MISS":"SINGLE"}function Li(s,i){const d=Math.max(0,Math.min(60,Math.round(Number(s)||0)));return i==="INNER_BULL"?{value:50,ring:i}:i==="BULL"?{value:25,ring:i}:{value:d,ring:i}}function Ql(s,i){let d=null,u=!0,l=null,m=0;const p=400,L=[],z=new Set;function G(Q,q){const S=typeof Q?.id=="string"||typeof Q?.id=="number"?String(Q.id):null;if(S){if(z.has(S))return;if(z.add(S),L.push(S),L.length>200){const C=L.shift();C&&z.delete(C)}}const w=`${q.value}|${q.ring}|${q.sector??""}|${q.mult??""}`,J=Date.now();w===l&&J-m<p||(l=w,m=J,i(q))}function W(){if(u)try{d=new WebSocket(s),d.onmessage=Q=>{try{const q=JSON.parse(Q.data),S=Jl(q);S&&G(q,S)}catch{}},d.onclose=()=>{d=null,setTimeout(W,1500)},d.onerror=()=>{}}catch{setTimeout(W,2e3)}}return W(),{close:()=>{u=!1;try{d?.close()}catch{}}}}function Sa({storageKey:s,children:i,className:d,defaultWidth:u=640,defaultHeight:l=360,minWidth:m=320,minHeight:p=200,maxWidth:L=1600,maxHeight:z=1200,autoFill:G=!1}){const[W,Q]=n.useState(()=>{try{const O=localStorage.getItem(s);if(O)return JSON.parse(O)}catch{}return G?{width:u}:{width:u,height:l}}),q=n.useRef(null),S=n.useRef(null);n.useEffect(()=>{function O(){try{localStorage.removeItem(s)}catch{}Q({width:u,height:l})}return window.addEventListener("ndn:layout-reset",O),window.addEventListener("ndn:camera-reset",O),()=>{window.removeEventListener("ndn:layout-reset",O),window.removeEventListener("ndn:camera-reset",O)}},[s,u,l]),n.useEffect(()=>{try{localStorage.setItem(s,JSON.stringify(W))}catch{}},[W,s]);function w(O,ne,Ae){return Math.max(ne,Math.min(Ae,O))}function J(O,ne){O.preventDefault();const Ae=S.current;if(!Ae)return;const Ne=Ae.getBoundingClientRect();q.current={x:O.clientX,y:O.clientY,w:Ne.width,h:Ne.height,dir:ne},window.addEventListener("mousemove",C),window.addEventListener("mouseup",fe)}function C(O){const ne=q.current;if(!ne)return;const Ae=O.clientX-ne.x,Ne=O.clientY-ne.y;let We=ne.w,Ge=ne.h;ne.dir.includes("e")&&(We=w(ne.w+Ae,m,L)),!G&&ne.dir.includes("s")&&(Ge=w(ne.h+Ne,p,z)),ne.dir.includes("w")&&(We=w(ne.w-Ae,m,L)),!G&&ne.dir.includes("n")&&(Ge=w(ne.h-Ne,p,z)),Q({width:Math.round(We),height:Math.round(Ge)})}function fe(){window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",fe),q.current=null}function me(O,ne){const Ne=O.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"," "].includes(Ne))return;O.preventDefault();const We=Ne==="ArrowLeft"||Ne==="ArrowUp"?-20:20;Q(Ge=>{const qe=Ge.width||u,Be=Ge.height||l;let T=qe,ce=Be;return ne.includes("e")&&(T=w(qe+We,m,L)),ne.includes("w")&&(T=w(qe-We,m,L)),!G&&ne.includes("s")&&(ce=w(Be+We,p,z)),!G&&ne.includes("n")&&(ce=w(Be-We,p,z)),{width:Math.round(T),height:Math.round(ce)}})}const pe={width:G?"100%":W.width?`${W.width}px`:void 0,height:G?"100%":W.height?`${W.height}px`:void 0,maxWidth:"100%",maxHeight:G?"100%":"80vh",position:"relative",...G?{display:"flex",flexDirection:"column",flex:"1 1 auto"}:{}};return e.jsxs("div",{ref:S,className:`${d||""}`,style:pe,children:[i,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:O=>J(O,"nw"),role:"button",tabIndex:0,"aria-label":"Resize north-west",onKeyDown:O=>me(O,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:O=>J(O,"ne"),role:"button",tabIndex:0,"aria-label":"Resize north-east",onKeyDown:O=>me(O,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:O=>J(O,"sw"),role:"button",tabIndex:0,"aria-label":"Resize south-west",onKeyDown:O=>me(O,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:O=>J(O,"se"),role:"button",tabIndex:0,"aria-label":"Resize south-east",onKeyDown:O=>me(O,"se")})]})}const _i=Hi((s,i)=>({samples:[],addSample:d=>s(u=>({samples:[...u.samples,d]})),clear:()=>s({samples:[]}),export:()=>i().samples.slice()})),Zl=Hi(s=>({paused:!1,pauseEndsAt:null,setPaused:(i,d=null)=>s({paused:i,pauseEndsAt:d??null})})),ec=2,tc=200,As=400,sc=450,nc=5e3,Fr=150,rc=.9,ac=6500,Se=n.forwardRef(function({onVisitCommitted:i,showToolbar:d=!0,onAutoDart:u,immediateAutoCommit:l=!1,hideInlinePanels:m=!1,scoringMode:p="x01",onGenericDart:L,onGenericReplace:z,x01DoubleInOverride:G,onAddVisit:W,onEndLeg:Q,cameraAutoCommit:q="camera"},S){const w=n.useRef(null),{preferredCameraId:J,preferredCameraLabel:C,setPreferredCamera:fe,autoscoreProvider:me,autoscoreWsUrl:pe,cameraAspect:O,cameraFitMode:ne,autoCommitMode:Ae="wait-for-clear",cameraEnabled:Ne,setCameraEnabled:We,preferredCameraLocked:Ge,hideCameraOverlay:qe,setHideCameraOverlay:Be}=st();st(r=>r.preserveCalibrationOverlay);const T=me==="manual",[ce,g]=n.useState([]),St=n.useRef(null),F=n.useRef(null),[Ct,re]=n.useState(!1),Z=Hr(),Ke=C==="Phone Camera",mt=Z.getMediaStream?.()||null,jt=Z.isStreaming,Xe=Ke&&Z.mode==="phone"&&jt&&!!mt,ee=Ct||jt||!1,[ve,be]=n.useState(!1),[is,ln]=n.useState(null),{H:De,imageSize:he,overlaySize:ge,reset:Ut,_hydrated:es,locked:Oe,errorPx:K}=Il(),ht=!!De&&!!he&&(Oe||typeof K=="number"&&K<=6);n.useEffect(()=>{Ge&&!qe&&Be(!0)},[Ge,qe,Be]);const[Ye,zt]=n.useState(""),[ze,Nt]=n.useState(""),[b,y]=n.useState(0),[D,$]=n.useState("MISS"),[I,je]=n.useState(0),Y=n.useRef(0),[kt,we]=n.useState(0),[ae,Te]=n.useState([]),ue=Vr(r=>r),bs=!!(ue&&ue.roomId)&&ae.some(r=>r.meta&&r.meta.source==="camera"&&!r.meta.calibrationValid),[Js,Ft]=n.useState(0),[Qs,Gt]=n.useState(0),[ts,_r]=n.useState(!1),on=n.useRef(null),Le=n.useRef(null),rt=q!=="camera"&&!l&&Ae!=="immediate",[te,X]=n.useState(0),[Zs,$n]=n.useState([]),Je=n.useRef(null),dn=n.useRef([]),ls=n.useRef(0),ps=n.useRef(0),qt=n.useRef(!1),ss=n.useRef(null),Mt=n.useRef(0),Ps=n.useRef(null),[Bs,un]=n.useState([]),[Os,mn]=n.useState(!1),gs=n.useCallback(()=>{Le.current&&(clearTimeout(Le.current),Le.current=null)},[]);n.useImperativeHandle(S,()=>({runDetectionTick:()=>{try{Ps.current&&Ps.current()}catch{}},__test_addDart:void 0}));const Us=n.useCallback(r=>{const c=[...dn.current.slice(-8),r];dn.current=c,un(c);try{window.ndnCameraDiagnostics=c}catch{}},[]),vs=n.useCallback(r=>{const c=on.current;if(c&&(on.current=null,gs(),_r(!1),i))try{i(c.score,c.darts,c.finished)}catch{}},[i,gs]),Qe=n.useCallback(r=>{if(i){if(!rt){try{i(r.score,r.darts,r.finished)}catch{}return}on.current=r,_r(!0),gs(),Le.current=window.setTimeout(()=>vs("timeout"),ac)}},[i,rt,gs,vs]),en=n.useCallback(r=>{je(0),Y.current=0,we(0),Te([]),Ft(0),Gt(0),at(!1);try{window.dispatchEvent(new CustomEvent("ndn:clear-visit-request",{detail:{source:"camera-view",reason:r,ts:Date.now()}}))}catch{}},[]);n.useEffect(()=>{if(!rt)return;const r=()=>vs("event");return window.addEventListener("ndn:darts-cleared",r),()=>window.removeEventListener("ndn:darts-cleared",r)},[rt,vs]),n.useEffect(()=>{rt||vs("timeout")},[rt,vs]),n.useEffect(()=>()=>vs("teardown"),[vs]);const dr=n.useCallback(()=>{en("indicator"),X(r=>r+1)},[en]),Wr=n.useCallback(()=>{I===0&&kt===0||(en("toolbar"),X(r=>r+1))},[en,I,kt]),Hn=n.useCallback(()=>{if(!T)try{window.dispatchEvent(new CustomEvent("ndn:open-camera-manager",{detail:{source:"camera-view",ts:Date.now()}}))}catch(r){console.warn("[CameraView] Failed to request camera manager:",r)}},[T]),Aa=st(r=>r.x01DoubleIn),js=typeof G=="boolean"?!!G:!!Aa,[Kr,hn]=n.useState({}),tn=ue.players[ue.currentPlayerIdx]?.id,Ns=!!(tn&&Kr[tn]),_n=r=>{tn&&hn(c=>({...c,[tn]:r}))},xn=ue?.inProgress,ur=Ci(r=>r.setVisit),Wn=Ci(r=>r.reset);n.useEffect(()=>{try{ur(ae,I,kt)}catch{}},[ae,I,kt,ur]),n.useEffect(()=>()=>{try{Wn()}catch{}},[Wn]);const Ia=Vr(r=>r.addVisit),mr=Vr(r=>r.endLeg),ns=(r,c,x)=>{try{Pe("CameraView: callAddVisit",r,c,x),W?W(r,c,x):Ia(r,c,x)}catch{}},Kn=r=>{try{Q?Q(r):mr(typeof r=="number"?r:0)}catch{}},fn=_i(r=>r.addSample),[bn,hr]=n.useState(""),[zn,xr]=n.useState(""),[Xt,Ue]=n.useState(0),[fr,Et]=n.useState(!1),[Rt,at]=n.useState(!1),[Gn,pn]=n.useState(!1),At=n.useRef(null),[gn,Yt]=n.useState("auto"),[vn,Jt]=n.useState(!1),[br,sn]=n.useState(!1),[pr,jn]=n.useState(!1),Nn=n.useRef(null),Fs=st(r=>r.dartTimerEnabled),wn=st(r=>r.dartTimerSeconds)||10,[ws,yn]=n.useState(null),Vt=n.useRef(null),ys=Zl(r=>r.paused),$t=n.useRef(null),rs=n.useRef(null),Sn=n.useRef(null),Cn=n.useRef(0),wt=n.useRef(null),pt=n.useRef(0),Ss=n.useRef(!1),[gr,qn]=n.useState(0),Vs=n.useCallback(()=>{try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{source:"camera-view",ts:Date.now()}}))}catch(r){console.warn("[CameraView] Phone camera reconnect dispatch failed:",r)}},[]);n.useEffect(()=>{const r=()=>{T||sn(!0)};return window.addEventListener("ndn:open-autoscore",r),()=>window.removeEventListener("ndn:open-autoscore",r)},[T]),n.useEffect(()=>()=>{try{At.current&&clearTimeout(At.current)}catch{}},[]),n.useEffect(()=>{const r=()=>jn(!0);return window.addEventListener("ndn:open-scoring",r),()=>window.removeEventListener("ndn:open-scoring",r)},[]),n.useEffect(()=>{const r=()=>{X(c=>c+1),je(0),Y.current=0,we(0),Te([]),Ft(0),Gt(0),at(!1)};return window.addEventListener("ndn:darts-cleared",r),()=>window.removeEventListener("ndn:darts-cleared",r)},[]),n.useEffect(()=>{$n(r=>{if(ae.length>r.length){const c=ae.length-r.length;return[...r,...Array(c).fill(te)]}return ae.length<r.length?r.slice(0,ae.length):r})},[ae,te]),n.useEffect(()=>{if(ss.current&&(clearTimeout(ss.current),ss.current=null),T){qt.current=!1,ps.current=0,Je.current=null;return}return ee?(ps.current=performance.now(),Je.current=null,qt.current=!1,Mt.current=0,ss.current=window.setTimeout(()=>{qt.current=!0,ss.current=null},nc)):(ps.current=0,Je.current=null,qt.current=!1,Mt.current=0),()=>{ss.current&&(clearTimeout(ss.current),ss.current=null),qt.current=!1,Mt.current=0,Ps.current=null}},[ee,T]),n.useEffect(()=>{let r=!0;async function c(){try{if(!navigator?.mediaDevices?.enumerateDevices)return;const x=await navigator.mediaDevices.enumerateDevices();if(!r)return;g(x.filter(B=>B.kind==="videoinput"))}catch(x){console.warn("[CAMERA] enumerateDevices failed:",x)}}c();try{navigator.mediaDevices.addEventListener("devicechange",c)}catch{try{navigator.mediaDevices.ondevicechange=c}catch{}}return()=>{r=!1;try{navigator.mediaDevices.removeEventListener("devicechange",c)}catch{}}},[]),n.useEffect(()=>{const r=()=>{Yt("manual"),Jt(!0)},c=()=>{Yt("auto"),Jt(!1)};return window.addEventListener("ndn:open-manual",r),window.addEventListener("ndn:close-manual",c),()=>{window.removeEventListener("ndn:open-manual",r),window.removeEventListener("ndn:close-manual",c)}},[]),n.useEffect(()=>{T&&(Yt("manual"),sn(!1))},[T]),n.useEffect(()=>{try{const r=ue.players[ue.currentPlayerIdx],c=r?.legs?.[r.legs.length-1];if(!r)return;(!c||c.dartsThrown===0)&&hn(x=>({...x,[r.id]:!1}))}catch{}},[ue.currentPlayerIdx,ue.players?.[ue.currentPlayerIdx]?.legs?.length]),n.useEffect(()=>{const r=!!Fs&&xn&&!ys&&I<3;if(Vt.current&&(clearInterval(Vt.current),Vt.current=null),!r){yn(null);return}return yn(wn),Vt.current=window.setInterval(()=>{yn(c=>{const x=(c??wn)-1;if(x<=0){try{xt(0,"MISS 0","MISS")}catch{}return Vt.current&&(clearInterval(Vt.current),Vt.current=null),0}return x})},1e3),()=>{Vt.current&&(clearInterval(Vt.current),Vt.current=null)}},[Fs,wn,I,ue.currentPlayerIdx,ue?.inProgress,ys]),n.useEffect(()=>{if(!vn)return;const r=setInterval(()=>{try{const c=w.current,x=Nn.current;if(!c||!x)return;const B=c.videoWidth||0,M=c.videoHeight||0;if(!B||!M)return;const v=x.clientWidth||640,H=x.clientHeight||360;x.width!==v&&(x.width=v),x.height!==H&&(x.height=H);const P=x.getContext("2d");if(!P)return;P.imageSmoothingEnabled=!0;const se=Math.min(v/B,H/M),Fe=Math.round(B*se),V=Math.round(M*se),oe=Math.floor((v-Fe)/2),Ht=Math.floor((H-V)/2);P.fillStyle="#000",P.fillRect(0,0,v,H),P.drawImage(c,oe,Ht,Fe,V)}catch(c){console.warn("Manual preview update error:",c)}},120);return()=>clearInterval(r)},[vn]),n.useEffect(()=>()=>{},[]);const Xn=Ke&&!Xe;async function Cs(){if(!(ve||Ct)){if(Ke&&Xe){be(!1);return}be(!0);try{const r=J?{video:{deviceId:{exact:J}},audio:!1}:{video:{facingMode:"environment"},audio:!1};Pe("[CAMERA] Using constraints:",r);let c;try{c=await navigator.mediaDevices.getUserMedia(r),Pe("[CAMERA] Got stream:",!!c)}catch(x){console.warn("[CAMERA] First attempt failed:",x);const B=x&&(x.name||x.code)||"";if(J&&(B==="OverconstrainedError"||B==="NotFoundError"))Pe("[CAMERA] Trying fallback without deviceId"),c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else if(!J&&(B==="OverconstrainedError"||B==="NotFoundError"||B==="NotSupportedError"))Pe("[CAMERA] Trying fallback for facingMode not supported"),c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw x}if(w.current){Pe("[CAMERA] Setting stream to video element"),w.current.srcObject=c,Pe("[CAMERA] Stream tracks:",c.getTracks().length,"video tracks:",c.getVideoTracks().length),w.current.addEventListener("loadeddata",()=>Pe("[CAMERA] Video loadeddata")),w.current.addEventListener("canplay",()=>Pe("[CAMERA] Video canplay")),w.current.addEventListener("play",()=>Pe("[CAMERA] Video started playing")),w.current.addEventListener("error",x=>console.error("[CAMERA] Video error:",x));try{w.current.play(),Pe("[CAMERA] Play called successfully")}catch(x){console.error("[CAMERA] Video play failed:",x),setTimeout(()=>{try{w.current?.play(),Pe("[CAMERA] Retry play called")}catch(B){console.error("[CAMERA] Retry play failed:",B)}},100)}try{Z.setVideoElementRef?.(w.current),Z.setMediaStream?.(c),Z.setMode?.("local"),Z.setStreaming?.(!0)}catch(x){console.warn("[CAMERA] Failed to sync camera session with local stream:",x)}}else console.error("[CAMERA] Video element not found");re(!0);try{const x=await navigator.mediaDevices.enumerateDevices();g(x.filter(B=>B.kind==="videoinput")),Pe("[CAMERA] Found cameras:",x.filter(B=>B.kind==="videoinput").length)}catch(x){console.warn("[CAMERA] Failed to enumerate devices:",x)}}catch(r){console.error("[CAMERA] Camera start failed:",r),alert("Camera permission denied or not available.")}finally{be(!1)}}}function nn(){try{const r=Z.getMediaStream?.()||null;r&&r.getTracks().forEach(c=>c.stop())}catch{}if(w.current)try{w.current.srcObject=null}catch{}try{Z.setMediaStream?.(null),Z.setStreaming?.(!1),Z.setVideoElementRef?.(null)}catch{}re(!1),be(!1)}n.useEffect(()=>{const r=w.current;if(!r)return;const c=Z.getMediaStream?.()||null,B=(Z.getVideoElementRef?.()||null)?.srcObject||null,M=c||B;if(M){r.srcObject!==M&&(r.srcObject=M),r.muted=!0,r.playsInline=!0;try{r.play?.()}catch{}Ct||re(!0)}},[Z.mode,Z.isStreaming,Ct,Z]);function Yn(){try{if(!St.current)return;const r=w.current,c=Z.getVideoElementRef?.()||null,x=r&&r.videoWidth>0&&r.videoHeight>0?r:c||r;if(!x)return;const B=x,M=St.current;M.width=B.videoWidth,M.height=B.videoHeight;const v=M.getContext("2d");if(!v)return;v.drawImage(B,0,0,M.width,M.height);const H=M.toDataURL("image/png");ln(H)}catch(r){console.warn("Capture error:",r)}}async function ks(){try{if(!navigator?.mediaDevices?.getUserMedia)throw new Error("getUserMedia not supported");const r=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});try{r.getTracks().forEach(c=>c.stop())}catch{}try{const c=await navigator.mediaDevices.enumerateDevices();g(c.filter(x=>x.kind==="videoinput"))}catch(c){console.warn("[CAMERA] enumerateDevices failed after permission:",c)}}catch(r){console.warn("[CAMERA] request permission failed:",r),alert("Failed to request camera permission. Please enable camera access in your browser.")}}function Jn(){const[r,c]=n.useState(!1),[x,B]=n.useState(""),M=async v=>{if(ve)return;const H=ce.find(P=>P.deviceId===v)?.label;fe(v||void 0,H||"",!0),nn(),await new Promise(P=>setTimeout(P,150));try{await Cs()}catch{}};return e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs",children:[e.jsx("span",{children:"Cam:"}),e.jsxs("select",{onPointerDown:v=>{v.stopPropagation()},onMouseDown:v=>{v.stopPropagation()},onTouchStart:v=>{v.stopPropagation?.()},className:"bg-black/20 rounded px-1 py-0.5",value:J||"",onChange:async v=>{if(ve)return;const H=v.target.value||void 0,P=ce.find(se=>se.deviceId===H)?.label;fe(H,P||"",!0),nn(),await new Promise(se=>setTimeout(se,150));try{await Cs()}catch(se){console.warn("Failed to start camera after device switch:",se),setTimeout(async()=>{try{await Cs()}catch(Fe){console.error("Camera switch failed after retry:",Fe),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),e.jsx("option",{value:"manual",children:"~ Enter device ID ..."}),ce.map(v=>e.jsx("option",{value:v.deviceId,children:v.label||(v.deviceId?`Camera (${v.deviceId.slice(0,6)})`:"Camera")},v.deviceId))]}),J==="manual"&&e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("input",{className:"input input--small",placeholder:"Device ID",value:x,onChange:v=>B(v.target.value)}),e.jsx("button",{className:"btn btn--ghost btn-sm",onClick:()=>M(x||void 0),children:"Apply"})]}),ce.length===0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-yellow-300",children:"No cameras found"}),e.jsx("button",{className:"btn btn--ghost btn-sm ml-2",onClick:ks,title:"Request camera permission",children:"Enable local camera"})]}),e.jsx("button",{className:"btn btn--ghost btn-sm ml-2",onClick:async()=>{try{const v=await navigator.mediaDevices.enumerateDevices();g(v.filter(H=>H.kind==="videoinput"))}catch(v){console.warn("Rescan failed:",v),alert("Failed to rescan devices. Ensure camera permissions are granted.")}},title:"Rescan connected cameras",children:"Rescan"}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:e.jsx("button",{className:"btn btn--ghost btn-sm",onClick:()=>{c(v=>!v),r||(async()=>{try{const v=await navigator.mediaDevices.enumerateDevices();g(v.filter(H=>H.kind==="videoinput"))}catch{}})()},children:r?"Hide devices":"Show devices"})}),r&&e.jsxs("div",{className:"mt-2 space-y-1 ml-1 text-xs",children:[e.jsx("div",{className:"opacity-60 text-xxs mb-1",children:"If you don't see your virtual camera (e.g., OBS), ensure the virtual camera is enabled and your browser has camera permission. Click Rescan after enabling."}),ce.map(v=>{const H=String(v.label||"").toLowerCase().includes("obs")||String(v.label||"").toLowerCase().includes("virtual");return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"truncate",children:[v.label||"Unnamed device"," ",H&&e.jsx("span",{className:"text-xs opacity-60 ml-1",children:"(OBS)"})]}),e.jsx("div",{className:"opacity-60 ml-1",children:v.deviceId}),e.jsx("button",{className:"btn btn--ghost btn-xs ml-2",onClick:()=>M(v.deviceId),children:"Select"})]},v.deviceId)})]})]})}n.useEffect(()=>{},[De,he,ee,T,Ke,Ge,qe]),n.useEffect(()=>{if(T||me!=="built-in")return;const r=Hr.getState();let x=st.getState().preferredCameraLabel==="Phone Camera"?r.getVideoElementRef?.()||null:w.current;if(!x||!De||!he)return;let B=!1;const M=x,v=M.videoWidth||0,H=M.videoHeight||0,P=St.current;if(!P)return;if(!$t.current){let Fe=60,V=18,oe=3;v>0&&H>0&&v*H<1280*720&&(Fe=40,V=16,oe=2),$t.current=new Pl({minArea:Fe,thresh:V,requireStableN:oe,angMaxDeg:70})}const se=()=>{let Fe=!1;if(!B){try{const V=M.videoWidth||0,oe=M.videoHeight||0;if(!V||!oe){rs.current=requestAnimationFrame(se);return}P.width!==V&&(P.width=V),P.height!==oe&&(P.height=oe);const Ht=P.getContext("2d",{willReadFrequently:!0});if(!Ht){rs.current=requestAnimationFrame(se);return}Ht.drawImage(M,0,0,V,oe);const Me=Ht.getImageData(0,0,V,oe);Mt.current++;const ot=wi(De,{x:0,y:0}),it=wi(De,{x:Is.doubleOuter,y:0}),gt=V/he.w,It=oe/he.h,Qt=ot.x*gt,Zt=ot.y*It,cs=it.x*gt,Ze=it.y*It,ft=Math.hypot(cs-Qt,Ze-Zt)*1.08,rn=$t.current;gr>=0&&rn.setROI(Qt,Zt,Math.max(24,Math.min(Math.max(V,oe),ft)));{const Ee=!ys,Ve=I<3,lt=qt.current,os=Mt.current>Fr;Pe("CameraView: detection conditions",{condPaused:Ee,condPending:Ve,condArmed:lt,condFrame:os,frameCount:Mt.current,minFrames:Fr})}if(!ys&&I<3&&qt.current&&Mt.current>Fr){Pe("CameraView: entering detection branch",{paused:ys,pendingDarts:I,detectionArmed:qt.current,frameCount:Mt.current,DETECTION_MIN_FRAMES:Fr});const Ee=rn.detect(Me);Pe("CameraView: raw detection",Ee);const Ve=performance.now();if(Je.current&&Ve-Je.current.firstTs>900&&(Je.current=null),Ee&&Ee.confidence>=rc){Pe("CameraView: detected raw",Ee.confidence,Ee.tip),Pe("CameraView: detected raw",Ee.confidence,Ee.tip);const lt=ps.current>0&&Ve-ps.current<sc;let os=!1;const ct=Bl(P,Ee.tip,6),Pt={x:ct.x/gt,y:ct.y/It},Ce=Di(De,Pt);let et=null;try{et=ya(De,Pt)}catch{et=null}if(u)try{const N=`${Ce.base}|${Ce.ring}|${Ce.mult}`,xe=performance.now();N===wt.current&&xe-pt.current<As||u(Ce.base,Ce.ring,{sector:Ce.sector??null,mult:Math.max(0,Number(Ce.mult)||0),calibrationValid:!!Ls,pBoard:et})===!0&&(wt.current=N,pt.current=xe,os=!0)}catch{}const bt=Ce.ring,de=Ce.base,_e=`${bt} ${de>0?de:""}`.trim(),tt=Ce.sector??null,Bt=Math.max(0,Number(Ce.mult)||0);let $e=!1;Pe("CameraView: detection details",{value:de,ring:bt,calibrationGood:Ls,tipInVideo:us,pCalInImage:as,isGhost:_t});const Gr=6,ds=3,Ts=3,Ls=!!De&&!!he&&(Oe||(typeof K=="number"?K:0)<=Gr),us=ct.x>=-ds&&ct.x<=V+ds&&ct.y>=-ds&&ct.y<=oe+ds,as=he?Pt.x>=-Ts&&Pt.x<=he.w+Ts&&Pt.y>=-Ts&&Pt.y<=he.h+Ts:!1;let Ks=!1;try{if(De){const N=ya(De,Pt);Ks=Math.hypot(N.x,N.y)<=Is.doubleOuter+3}}catch{}const _t=!Ls||!us||!as;zt(_e),y(de),$(bt);const Ms=async N=>{Pe("CameraView: applyAutoHit",N.value,N.ring,N.sector),Pe("CameraView: applyAutoHit",N.value,N.ring,N.sector);const xe=performance.now();if(Ss.current)return;Ss.current=!0;try{window.setTimeout(()=>{Ss.current=!1},Math.max(120,As))}catch{}const ie=`${N.value}|${N.ring}|${N.mult}`;if(!(xe-Cn.current<As&&ie===Sn.current)){if(Sn.current=ie,Cn.current=xe,N.value>0){at(!0),pn(!0);try{At.current&&clearTimeout(At.current)}catch{}At.current=window.setTimeout(()=>{pn(!1),At.current=null},1500);try{if(q==="camera"){let ke=!1;if(u)try{const Re=ie,dt=performance.now();Re===wt.current&&dt-pt.current<As||await Promise.resolve(u(N.value,N.ring,{sector:N.sector,mult:N.mult,calibrationValid:!0,pBoard:et}))&&(ke=!0,wt.current=Re,pt.current=dt)}catch{}if(!ke){try{Pe("CameraView: cameraAutoCommit committing locally",N.value,N.label,N.ring),xt(N.value,N.label,N.ring,{calibrationValid:!0,pBoard:et,source:"camera"})}catch{}try{Pe("CameraView: calling callAddVisit from cameraAutoCommit",N.value),ns(N.value,1,{visitTotal:N.value,calibrationValid:!0,pBoard:et,source:"camera"})}catch{}}try{const Re=ie,dt=performance.now();!u||Re===wt.current&&dt-pt.current<As||(u&&u(N.value,N.ring,{sector:N.sector,mult:N.mult,calibrationValid:!0,pBoard:et}),wt.current=Re,pt.current=dt)}catch{}}else if(q==="parent"){let ke=!1;if(u)try{const Re=ie,dt=performance.now();Re===wt.current&&dt-pt.current<As||(ke=!!await Promise.resolve(u(N.value,N.ring,{sector:N.sector,mult:N.mult,calibrationValid:!0,pBoard:et})),ke&&(wt.current=Re,pt.current=dt))}catch{}ke||xt(N.value,N.label,N.ring,{calibrationValid:!0,pBoard:et,source:"camera"}),ke&&(wt.current=ie,pt.current=performance.now())}else{try{xt(N.value,N.label,N.ring,{calibrationValid:!0,pBoard:et,source:"camera"})}catch{}try{const ke=ie,Re=performance.now();!u||ke===wt.current&&Re-pt.current<As||(u&&u(N.value,N.ring,{sector:N.sector,mult:N.mult,calibrationValid:!0,pBoard:et}),wt.current=ke,pt.current=Re)}catch{}}}catch{}}else at(!1);if(N.value<=0)try{u&&u(N.value,N.ring,{sector:N.sector,mult:N.mult})}catch{}}};if(lt)Je.current=null,$e=!0;else if(_t){Pe("CameraView: ignoring ghost detection (calibrationGood:",Ls,"tipInVideo:",us,"pCalInImage:",as,")"),Je.current=null,at(!1),$e=!1;try{u&&u(de,bt,{sector:tt,mult:Bt,calibrationValid:!1,pBoard:null})}catch{}Us({ts:Ve,label:_e,value:de,ring:bt,pCal:Pt,tip:ct,confidence:Ee.confidence,ready:!1,accepted:!1,warmup:lt})}else if(bt==="MISS"||de<=0){Je.current=null,at(!1);try{u&&u(de,bt,{sector:tt,mult:Bt,calibrationValid:!0,pBoard:et})}catch{}$e=!0}else{const N=Je.current;!N||N.value!==de||N.ring!==bt?Je.current={value:de,ring:bt,label:_e,sector:tt,mult:Bt,firstTs:Ve,frames:1}:Je.current={...N,label:_e,frames:N.frames+1};const xe=Je.current,ie=Ve-xe.firstTs,ke=xe.frames>=ec||ie>=tc,Re=Ve-ls.current>=As;ke&&Re&&(Pe("CameraView: candidate ready and cooled",{value:de,ring:bt,frames:xe.frames,nowPerf:Ve}),Ms(xe),Fe=!0,Je.current=null,ls.current=Ve,$e=!0)}Us({ts:Ve,label:_e,value:de,ring:bt,pCal:Pt,tip:ct,confidence:Ee.confidence,ready:$e,accepted:$e&&de>0&&bt!=="MISS",warmup:lt});try{if(de>0&&bt!=="MISS"&&!_t){const xe=F.current;if(xe){const ie=xe.getContext("2d");if(ie){const ke=ct.x/V*xe.width,Re=ct.y/oe*xe.height;if(ie.save(),ie.beginPath(),ie.strokeStyle="#f59e0b",ie.lineWidth=2,ie.arc(ke,Re,6,0,Math.PI*2),ie.stroke(),Ee.axis){const dt=Ee.axis,Es=dt.x1/V*xe.width,Rs=dt.y1/oe*xe.height,Tn=dt.x2/V*xe.width,er=dt.y2/oe*xe.height;ie.beginPath(),ie.moveTo(Es,Rs),ie.lineTo(Tn,er),ie.stroke()}if(Ee.bbox){const dt=Ee.bbox.x/V*xe.width,Es=Ee.bbox.y/oe*xe.height,Rs=Ee.bbox.w/V*xe.width,Tn=Ee.bbox.h/oe*xe.height;ie.strokeStyle="#22d3ee",ie.strokeRect(dt,Es,Rs,Tn)}ie.restore()}}}}catch{}if($e&&!Fe){rn.accept(Me,Ee);try{let N=!1;if(u)try{const xe=`${de}|${bt}|${Bt}`,ie=performance.now();xe===wt.current&&ie-pt.current<As||u(de,bt,{sector:tt,mult:Bt,calibrationValid:!0,pBoard:et})===!0&&(wt.current=xe,pt.current=ie,N=!0)}catch{}N||Ms({value:de,ring:bt,label:_e,sector:tt,mult:Bt,firstTs:Ve,frames:1})}catch{}}}else Je.current&&Ve-Je.current.firstTs>800&&(Je.current=null)}}catch{}rs.current=requestAnimationFrame(se),Ps.current=se}};return rs.current=requestAnimationFrame(se),()=>{B=!0,rs.current&&cancelAnimationFrame(rs.current),rs.current=null}},[T,me,ee,De,he,ys,I,gr,Us]);const $s=n.useCallback(async()=>{try{if(Ke){const r=ce.find(c=>c.kind==="videoinput");r?fe(r.deviceId,r.label||"",!0):fe(void 0,"",!0)}await Cs()}catch(r){console.warn("[CameraView] Local camera fallback failed:",r)}},[ce,Ke,fe]);n.useEffect(()=>{try{if(Ge||J)return;const r=ce.find(c=>/obs|virtual/i.test(String(c.label||"")));r&&fe(r.deviceId,r.label||"",!0)}catch{}},[ce,J,Ge,fe]),n.useEffect(()=>{try{Fn.getState().setCalibrationStatus({hasHomography:!!De,imageSize:he,overlaySize:ge})}catch{}},[De,he]),n.useEffect(()=>{try{if(!F.current||!he)return;const r=F.current;typeof he.w=="number"&&typeof he.h=="number"&&(r.width!==he.w||r.height!==he.h)&&(r.width=he.w,r.height=he.h)}catch{}},[F,he]),n.useEffect(()=>{if(me!=="external-ws"||!pe)return;const r=Ql(pe,c=>{if(!(!qt.current||performance.now()-ps.current<5e3))if(u){try{u(c.value,c.ring,{sector:c.sector??null,mult:c.mult??0})}catch{}try{fn({playerId:ue.players[ue.currentPlayerIdx]?.id??null,sector:c.sector??null,mult:c.mult??0,ring:c.ring,ts:Date.now()})}catch{}}else{const x=c.ring==="INNER_BULL"?"INNER_BULL 50":c.ring==="BULL"?"BULL 25":`${c.ring[0]}${c.value/(c.mult||1)||c.value} ${c.value}`;xt(c.value,x,c.ring,{calibrationValid:!1,pBoard:null,source:"camera"});try{fn({playerId:ue.players[ue.currentPlayerIdx]?.id??null,sector:c.sector??null,mult:c.mult??0,ring:c.ring,ts:Date.now()})}catch{}}});return()=>r.close()},[me,pe]);function Qn(r){if(!F.current||!De||!he)return;const c=F.current.getBoundingClientRect(),x=r.clientX-c.left,B=r.clientY-c.top,M=F.current.width&&he.w?F.current.width/he.w:1,v=F.current.height&&he.h?F.current.height/he.h:1,H={x:x/M,y:B/v},P=Di(De,H),se=`${P.ring} ${P.base>0?P.base:""}`.trim();zt(se),y(P.base),$(P.ring),at(!0);try{if(l&&u){u(P.base,P.ring,{sector:P.sector,mult:P.mult});try{fn({playerId:ue.players[ue.currentPlayerIdx]?.id??null,sector:P.sector??null,mult:P.mult??0,ring:P.ring,ts:Date.now()})}catch{}at(!1)}}catch{}}function Ie(r){const c=r.trim().toUpperCase();if(!c)return null;const x=c==="BULL"||c==="50"||c==="DBULL"||c==="IBULL",B=c==="25"||c==="OBULL";if(x)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(B)return{label:"BULL 25",value:25,ring:"BULL"};const M=c.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!M)return null;const v=M[1]||"S",H=parseInt(M[2],10);if(H<1||H>20)return null;const P=v==="S"?1:v==="D"?2:3,se=v==="S"?"SINGLE":v==="D"?"DOUBLE":"TRIPLE";return{label:`${v}${H} ${H*P}`,value:H*P,ring:se}}function kn(){const r=ue;if(!r.players.length)return r.startingScore;const c=r.players[r.currentPlayerIdx],x=c.legs[c.legs.length-1];return x?x.totalScoreRemaining:r.startingScore}function xt(r,c,x,B){if(rt&&ts){if(!Gn){pn(!0);try{At.current&&clearTimeout(At.current)}catch{}At.current=window.setTimeout(()=>{pn(!1),At.current=null},1200)}return}const M=B??{calibrationValid:!1,pBoard:null,source:"manual"};if(p==="custom"){if(L)try{L(r,x,{label:c})}catch{}if((Y.current||0)>=3){je(1),we(r),Te([{label:c,value:r,ring:x,meta:M}]);return}const Me=I+1;je(Me),Y.current=Me,we(ot=>ot+r),Te(ot=>[...ot,{label:c,value:r,ring:x,meta:M}]);return}if((Y.current||0)>=3){const Me=kt,ot=I;ns(Me,ot,{preOpenDarts:Js||0,doubleWindowDarts:Qs||0,finishedByDouble:!1,visitTotal:Me});try{const It=ue.players[ue.currentPlayerIdx]?.name;It&&or(It,ot,Me)}catch{}const it=!js||Ns||x==="DOUBLE"||x==="INNER_BULL",gt=it?r:0;je(1),Y.current=1,we(gt),Te([{label:c,value:gt,ring:x,meta:M}]),Ft(it?0:1),Gt(0),js&&!Ns&&(x==="DOUBLE"||x==="INNER_BULL")&&_n(!0),Qe({score:Me,darts:ot,finished:!1});return}const v=(Y.current||0)+1,P=!js||Ns||x==="DOUBLE"||x==="INNER_BULL"?r:0;js&&!Ns&&(x==="DOUBLE"||x==="INNER_BULL")&&_n(!0);const se=kt+P,V=kn()-se,oe=V===0&&(x==="DOUBLE"||x==="INNER_BULL");if(V<0||V===1||V===0&&!oe){const ot=(Js||0)+(js&&!Ns&&!(x==="DOUBLE"||x==="INNER_BULL")?1:0),it=V,gt=V+P,It=gt>50&&it<=50||gt<=50?1:0,Qt=(Qs||0)+It;ns(0,v,{preOpenDarts:ot,doubleWindowDarts:Qt,finishedByDouble:!1,visitTotal:0}),je(0),Y.current=0,we(0),Te([]),Ft(0),Gt(0),Qe({score:0,darts:v,finished:!1});return}je(v),Y.current=v,we(se),Te(Me=>[...Me,{label:c,value:P,ring:x,meta:M}]),js&&!Ns&&!(x==="DOUBLE"||x==="INNER_BULL")&&Ft(Me=>(Me||0)+1);{const Me=V,ot=V+P;(ot>50&&Me<=50||ot<=50)&&Gt(gt=>(gt||0)+1)}if(oe){ns(se,v,{preOpenDarts:Js||0,doubleWindowDarts:Qs||0,finishedByDouble:!0,visitTotal:se}),Kn(se),je(0),Y.current=0,we(0),Te([]),Ft(0),Gt(0),Qe({score:se,darts:v,finished:!0});return}v>=3&&(ns(se,v,{preOpenDarts:Js||0,doubleWindowDarts:Qs||0,finishedByDouble:!1,visitTotal:se}),je(0),Y.current=0,we(0),Te([]),Ft(0),Gt(0),Qe({score:se,darts:v,finished:!1}))}function Hs(){if(!(rt&&ts)&&Ye){if(u)try{u(b,D,void 0)}catch{}else xt(b,Ye,D);Ue(0),at(!1)}}function Ds(){if(rt&&ts)return;const r=Ie(ze);if(!r){alert("Enter like T20, D16, 5, 25, 50");return}if(!Rt||!Ye||D==="MISS"||b===0){const c=Xt+1;Ue(c),c>=5&&Et(!0)}else Ue(0);xt(r.value,r.label,r.ring),Nt(""),at(!1)}function Dn(){if(rt&&ts)return;const r=Ie(ze);if(!r){alert("Enter like T20, D16, 5, 25, 50");return}if(I===0||ae.length===0){Ds();return}if(p==="custom"){if(!Rt||!Ye||D==="MISS"||b===0){const V=Xt+1;Ue(V),V>=5&&Et(!0)}else Ue(0);if(Te(V=>[...V.slice(0,-1),{label:r.label,value:r.value,ring:r.ring}]),z)try{z(r.value,r.ring,{label:r.label})}catch{}Nt(""),at(!1);return}if(!Rt||!Ye||D==="MISS"||b===0){const V=Xt+1;Ue(V),V>=5&&Et(!0)}else Ue(0);const c=ae[ae.length-1],x=I-1,B=kt-(c?.value||0),M=kn(),v=B+r.value,H=x+1,P=M-v,se=P===0&&(r.ring==="DOUBLE"||r.ring==="INNER_BULL");if(P<0||P===1||P===0&&!se){ns(0,H);try{const V=ue.players[ue.currentPlayerIdx]?.name;V&&or(V,H,0)}catch{}je(0),Y.current=0,we(0),Te([]),Qe({score:0,darts:H,finished:!1}),Nt(""),at(!1);return}if(je(H),Y.current=H,we(v),Te(V=>[...V.slice(0,-1),{label:r.label,value:r.value,ring:r.ring}]),se){ns(v,H),Kn(v);try{const V=ue.players[ue.currentPlayerIdx]?.name;V&&or(V,H,v)}catch{}je(0),Y.current=0,we(0),Te([]),Qe({score:v,darts:H,finished:!0}),Nt(""),at(!1);return}if(H>=3){ns(v,H);try{const V=ue.players[ue.currentPlayerIdx]?.name;V&&or(V,H,v)}catch{}je(0),Y.current=0,we(0),Te([]),Qe({score:v,darts:H,finished:!1})}Nt(""),at(!1)}function vr(){Et(!1),Ue(0);try{window.dispatchEvent(new CustomEvent("ndn:request-calibrate"))}catch{}}function Zn(){Ut(),Et(!1),Ue(0)}n.useEffect(()=>{function r(c){try{const B=document.activeElement?.tagName?.toLowerCase();c.key==="m"&&B!=="input"&&B!=="textarea"&&(Yt("manual"),Jt(!0))}catch{}}return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]);function Dt(r,c){if(I>=3||rt&&ts)return;const x=r*(c==="S"?1:c==="D"?2:3),B=c==="S"?"SINGLE":c==="D"?"DOUBLE":"TRIPLE";if(!Rt||!Ye||D==="MISS"||b===0){const M=Xt+1;Ue(M),M>=5&&Et(!0)}else Ue(0);xt(x,`${c}${r} ${x}`,B),at(!1)}function _s(){if(I===0)return;const r=ae[ae.length-1];je(c=>c-1),Y.current=Math.max(0,(Y.current||0)-1),we(c=>c-(r?.value||0)),Te(c=>c.slice(0,-1))}function zr(){if(I===0||rt&&ts)return;if(bs){try{window.alert("Cannot commit: pending camera detections are not calibration validated for online matches")}catch{}return}if(p==="custom"){je(0),Y.current=0,Y.current=0,we(0),Te([]);return}const r=kt,c=I;ns(r,c);try{const x=ue.players[ue.currentPlayerIdx]?.name;x&&or(x,c,r)}catch{}je(0),Y.current=0,we(0),Te([]),Qe({score:r,darts:c,finished:!1})}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[d&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!T&&e.jsx("button",{className:`btn px-3 py-1 text-sm ${gn==="auto"?"tab--active":""}`,onClick:()=>{Yt("auto"),Jt(!1),sn(!0)},children:"Autoscore"}),e.jsx("button",{className:`btn px-3 py-1 text-sm ${gn==="manual"?"tab--active":""}`,onClick:()=>{Yt("manual"),Jt(!0)},title:"Open Manual Correction",children:"Manual Correction"}),T&&e.jsx("span",{className:"text-xs opacity-70",children:"Manual scoring mode active"})]})}),!m&&!T?e.jsxs("div",{className:"card relative camera-fullwidth-card lg:col-span-2",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(Sa,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,autoFill:!0,children:[e.jsx(Jn,{}),(()=>{const r=O||st.getState().cameraAspect||"wide",c=(ne||st.getState().cameraFitMode||"fit")==="fit",x=r==="square"?"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black":c?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",B=r==="square"?"relative w-full mx-auto aspect-square bg-black":"relative w-full aspect-[4/3] bg-black",M=()=>e.jsxs("div",{className:B,children:[e.jsx("video",{ref:w,className:x,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:F,className:"absolute inset-0 w-full h-full",onClick:Qn}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3 cursor-pointer select-none",onDoubleClick:dr,"aria-label":`Visit status: ${ae[0]?ae[0].value>0?"hit":"miss":"pending"}, ${ae[1]?ae[1].value>0?"hit":"miss":"pending"}, ${ae[2]?ae[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(v=>{const H=ae[v],P=Zs[v],se=!H,Fe=!!H&&P===te,V=typeof H?.value=="number"?H.value>0:!1,oe=(H?.ring&&H.ring!=="MISS")??!1,Me=Fe?Fe&&(V||oe)?"bg-emerald-400":"bg-rose-500":"bg-gray-500/70",ot=Fe&&!se;return e.jsx("span",{className:`visit-dot ${ot?"active":"inactive"} ${Me}`},v)}),Fs&&ws!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,ws),"s"]})]}),rt&&ts?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return Ke?Xe?M():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Vs,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{Z.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:$s,disabled:!ce.length,children:"Use Local Camera"})]})]})}):M()})()]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsxs("button",{className:"btn btn--ghost px-3 py-1 text-xs font-semibold",onClick:()=>mn(r=>!r),children:[Os?"Hide":"Show"," detection log"]}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Recent detections: ",Bs.length]})]}),Os&&e.jsx("div",{className:"mt-2 rounded-2xl border border-white/15 bg-slate-900/80 p-3 text-xs text-white font-mono max-h-36 overflow-y-auto space-y-1",children:Bs.length===0?e.jsx("div",{className:"text-center text-slate-400",children:"No autoscore detections yet."}):Bs.slice().reverse().map(r=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"truncate flex-1",title:`Value ${r.value} ${r.ring}`,children:r.label.padEnd(6," ")}),e.jsx("span",{className:"text-slate-400",children:r.confidence.toFixed(2)}),e.jsx("span",{className:`px-2 rounded-full text-[10px] font-semibold ${r.accepted?"bg-emerald-500/80":r.ready?"bg-amber-500/80":"bg-rose-500/80"}`,children:r.accepted?"accepted":r.ready?"queued":"ignored"})]},r.ts))}),xn?e.jsx("div",{className:"absolute top-3 right-3 z-30",children:(()=>{let r="bg-white/90 text-slate-800",c="Manual Correction (M)";Rt&&(!!Ye&&D!=="MISS"&&b>0?(r="bg-emerald-600 text-white",c=`Manual Correction (M) â€” Autoscore: ${Ye} (confirmed)`):(r="bg-amber-400 text-black",c=`Manual Correction (M) â€” Autoscore ambiguous: ${Ye||"â€”"}`));const x="px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90",B=Rt&&!!Ye&&D!=="MISS"&&b>0,M=Gn&&B?"ring-4 ring-emerald-400/60 animate-ping":Rt&&!B?"animate-pulse":"";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`${x} ${r} ${M}`,onClick:()=>{Yt("manual"),Jt(!0)},title:c,children:"Manual"}),e.jsx("button",{"data-testid":"commit-visit-btn",className:"px-3 py-1 rounded bg-emerald-500 text-white text-sm",onClick:zr,disabled:I===0||bs,title:"Commit visit",children:"Commit"})]})})()}):null,e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[Ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${Xe?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:Xe?"ðŸ“± Phone camera stream active":"ðŸ“± Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Vs,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{Z.setShowOverlay?.(!Z.showOverlay)}catch{}},children:Z.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!Xe,onClick:()=>{try{Z.clearSession?.()}catch{}},children:"Stop Phone Feed"}),Xn&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:$s,disabled:!ce.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:Ct?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:nn,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:Cs,disabled:ve,children:ve?"Connecting Camera...":"Connect Camera"})}),!T&&e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:Hn,title:"Open phone, WiFi, and USB camera options",children:"Camera Devices"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Be(!qe),title:"Toggle the board guide overlay",children:qe?"Show board guides":"Hide board guides"}),e.jsx("button",{className:`btn ${Ne?"bg-rose-600 hover:bg-rose-700 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white"}`,onClick:()=>We(!Ne),title:"Toggle whether the camera is used for scoring",children:Ne?"Disable camera mode":"Enable camera mode"}),e.jsx("button",{className:"btn",onClick:Yn,disabled:!ee,children:"Capture Still"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",disabled:!ee,onClick:()=>{$t.current=null,qn(r=>r+1)},children:"Reset Autoscore Background"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}):null,xn?e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{className:"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg",title:"Open Manual Correction (M)",onClick:()=>{Yt("manual"),Jt(!0)},children:"âœï¸"})}):null,!m&&T&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Manual Scoring"}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:"Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{Jt(!0),Yt("manual")},children:"Open Manual Correction"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Manage Pending Visit"})]})]}),e.jsx("canvas",{ref:St,className:"hidden"}),br&&!T&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(Vn,{storageKey:"ndn:autoscore:size",className:"w-full max-w-3xl",defaultWidth:720,defaultHeight:520,minWidth:420,minHeight:320,maxWidth:1400,maxHeight:900,initialFitHeight:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Autoscore"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn btn--ghost",onClick:()=>sn(!1),children:"Close"})})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Click the camera overlay to autoscore. Use Manual Correction if the last auto is off."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:Ye||"â€”"}),e.jsx("button",{className:"btn",onClick:Hs,disabled:I>=3,children:"Add Auto Dart"}),Xt>0&&e.jsxs("span",{className:"text-sm opacity-80",children:["No-registers: ",Xt,"/3"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:I>=3,onClick:()=>{if(!Rt||!Ye||D==="MISS"||b===0){const r=Xt+1;Ue(r),r>=5&&Et(!0)}else Ue(0);xt(25,"BULL 25","BULL"),at(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:I>=3,onClick:()=>{if(!Rt||!Ye||D==="MISS"||b===0){const r=Xt+1;Ue(r),r>=5&&Et(!0)}else Ue(0);xt(50,"INNER_BULL 50","INNER_BULL"),at(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"autoscore-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:bn,onChange:r=>hr(r.target.value.toUpperCase()),onKeyDown:r=>{if(r.key==="Enter"){const c=bn.match(/^(S|D|T)(\d{1,2})$/);c&&Dt(parseInt(c[2],10),c[1])}}}),e.jsx("datalist",{id:"autoscore-quick-list",children:["D","S","T"].map(r=>Array.from({length:20},(c,x)=>x+1).map(c=>e.jsx("option",{value:`${r}${c}`},`${r}${c}`)))}),e.jsx("button",{className:"btn",disabled:!bn||I>=3,onClick:()=>{const r=bn.match(/^(S|D|T)(\d{1,2})$/);if(!r)return;const c=r[1],x=parseInt(r[2],10);Dt(x,c)},children:"Add"})]})]})]})})}),vn&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex flex-col",children:e.jsxs(Ni,{returnFocus:!0,children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{Jt(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:Nn,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:Ye||"â€”"}),e.jsx("button",{className:"btn",onClick:Hs,disabled:I>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-[1.2]",placeholder:"Manual (T20, D16, 5, 25, 50)",value:ze,onChange:r=>Nt(r.target.value),onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),Ds()),r.key==="Enter"&&r.shiftKey&&(r.preventDefault(),Dn())}}),e.jsx("button",{className:"btn btn--ghost",onClick:Dn,disabled:I===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:Ds,disabled:I>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add Â· Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Number pad"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 max-w-sm",children:[["7","8","9","4","5","6","1","2","3","0"].map(r=>e.jsx("button",{className:"btn text-lg",onClick:()=>{Nt(c=>/^[SDT]/i.test(c)?c+r:(c||"")+r)},children:r},r)),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:()=>Nt(""),children:"Clear"}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 text-white",onClick:()=>Nt(r=>(r||"").slice(0,-1)),children:"âŒ«"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>Ds(),disabled:I>=3,children:"Enter"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Tap numbers then press Enter to submit. Use D/T prefixes for doubles/trebles (e.g., D16)."})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:I>=3,onClick:()=>{if(!Rt||!Ye||D==="MISS"||b===0){const r=Xt+1;Ue(r),r>=5&&Et(!0)}else Ue(0);xt(25,"BULL 25","BULL"),at(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:I>=3,onClick:()=>{if(!Rt||!Ye||D==="MISS"||b===0){const r=Xt+1;Ue(r),r>=5&&Et(!0)}else Ue(0);xt(50,"INNER_BULL 50","INNER_BULL"),at(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:zn,onChange:r=>xr(r.target.value.toUpperCase()),onKeyDown:r=>{if(r.key==="Enter"){const c=zn.match(/^(S|D|T)(\d{1,2})$/);c&&Dt(parseInt(c[2],10),c[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(r=>Array.from({length:20},(c,x)=>x+1).map(c=>e.jsx("option",{value:`${r}${c}`},`${r}${c}`)))}),e.jsx("button",{className:"btn",disabled:!zn||I>=3,onClick:()=>{const r=zn.match(/^(S|D|T)(\d{1,2})$/);if(!r)return;const c=r[1],x=parseInt(r[2],10);Dt(x,c)},children:"Add"})]})]})]})]})})]})})}),pr&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsx(Ni,{returnFocus:!0,children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",role:"dialog","aria-modal":"true",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>jn(!1),"aria-label":"Close scoring dialog",children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(Sa,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,children:[e.jsx(Jn,{}),(()=>{const c=(st.getState().cameraFitMode||"fit")==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",x=()=>e.jsxs("div",{className:"relative w-full aspect-[4/3] bg-black",children:[e.jsx("video",{ref:w,className:c,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:F,className:"absolute inset-0 w-full h-full",onClick:Qn}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${ae[0]?ae[0].value>0?"hit":"miss":"pending"}, ${ae[1]?ae[1].value>0?"hit":"miss":"pending"}, ${ae[2]?ae[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(B=>{const M=ae[B],v=!M,H=!!M&&(typeof M.value=="number"?M.value>0:!0),P=v?"bg-gray-500/70":H?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${P}`},B)}),Fs&&ws!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,ws),"s"]})]}),rt&&ts?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return Ke?Xe?x():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Vs,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{Z.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:$s,disabled:!ce.length,children:"Use Local Camera"})]})]})}):x()})()]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[Ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${Xe?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:Xe?"ðŸ“± Phone camera stream active":"ðŸ“± Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Vs,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{Z.setShowOverlay?.(!Z.showOverlay)}catch{}},children:Z.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!Xe,onClick:()=>{try{Z.clearSession?.()}catch{}},children:"Stop Phone Feed"}),Xn&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:$s,disabled:!ce.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:Ct?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:nn,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Cs,children:"Connect Camera"})}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:Yn,disabled:!ee,children:"Capture Still"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold",disabled:!ee,onClick:()=>{$t.current=null,qn(r=>r+1)},children:"Reset Autoscore Background"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pending Visit"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 ml-auto",children:[e.jsx("span",{className:`inline-block w-2.5 h-2.5 rounded-full ${ht?"bg-emerald-400":"bg-rose-500"}`}),e.jsx("span",{children:ht?"Cal OK":"Cal invalid"})]})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[0,1,2].map(r=>{const c=ae[r],x=!c,B=!!c&&(typeof c.value=="number"?c.value>0:!0),M=x?"bg-gray-500/70":B?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-2.5 h-2.5 rounded-full shadow ${M}`},r)}),Fs&&ws!==null&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold",children:[Math.max(0,ws),"s"]})]}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:ae.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):ae.map((r,c)=>e.jsx("li",{children:r.label},c))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",I,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",kt]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:_s,disabled:I===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:zr,disabled:I===0||bs,"data-testid":"commit-visit-btn",children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:Wr,disabled:I===0,children:"Clear"})]})]})]})]})})}),fr&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>{Et(!1),Ue(0)},children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-white",children:"Recalibration Recommended"}),e.jsx("div",{className:"mb-4 text-lg font-semibold text-indigo-200",children:"We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:vr,children:"Go to Calibrate"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:Zn,children:"Reset Calibration"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{Et(!1),Ue(0)},children:"Dismiss"})]})]})})]})});function Mi(s,i,d,u){const l=(u-90)*Math.PI/180;return{x:s+d*Math.cos(l),y:i+d*Math.sin(l)}}function Ei(s){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(s)*18+9}function ic({width:s=320,height:i=320}){const d=_i(l=>l.samples),u=n.useRef(null);return n.useEffect(()=>{const l=u.current;if(!l)return;const m=l.getContext("2d");if(!m)return;l.width=s,l.height=i,m.clearRect(0,0,s,i);const p=s/2,L=i/2,z=Math.min(s,i)/(Is.doubleOuter*2+20),G={bullInner:Is.bullInner*z,bullOuter:Is.bullOuter*z,trebleInner:Is.trebleInner*z,trebleOuter:Is.trebleOuter*z,doubleInner:Is.doubleInner*z,doubleOuter:Is.doubleOuter*z};m.strokeStyle="rgba(255,255,255,0.06)",m.lineWidth=1;const W=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const S of W)m.beginPath(),m.arc(p,L,G[S],0,Math.PI*2),m.stroke();const Q=[];for(const S of d){let w=Math.random()*360,J=Math.random()*G.doubleOuter;typeof S.sector=="number"&&S.sector>=1&&S.sector<=20&&(w=Ei(S.sector),S.ring==="DOUBLE"?J=(G.doubleInner+G.doubleOuter)/2:S.ring==="TRIPLE"?J=(G.trebleInner+G.trebleOuter)/2:S.ring==="INNER_BULL"?J=G.bullInner*.5:S.ring==="BULL"?J=G.bullOuter*.8:J=(G.trebleOuter+G.doubleInner)/2*(.6+Math.random()*.4));const C=Mi(p,L,J,w);Q.push({x:C.x,y:C.y,w:1})}for(const S of Q){const w=m.createRadialGradient(S.x,S.y,1,S.x,S.y,60);w.addColorStop(0,"rgba(255,0,0,0.9)"),w.addColorStop(.3,"rgba(255,100,0,0.5)"),w.addColorStop(1,"rgba(255,100,0,0)"),m.fillStyle=w,m.beginPath(),m.arc(S.x,S.y,60,0,Math.PI*2),m.fill()}m.fillStyle="rgba(255,255,255,0.85)",m.font="12px ui-sans-serif";const q={};for(const S of d)S.sector&&(q[S.sector]=(q[S.sector]||0)+1);for(const S of Object.keys(q)){const w=Number(S),J=Ei(w),C=Mi(p,L,G.trebleOuter+18,J);m.fillText(String(q[w]),C.x-6,C.y+4)}},[d,s,i]),e.jsx("canvas",{ref:u,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}const $r=[...Array.from({length:20},(s,i)=>({label:`D${i+1}`,score:(i+1)*2})),{label:"DBULL",score:50,isBull:!0}];function Ri(s,i){const d=$r[i];return!!d&&s===d.score}function Un(s){const i=s.trim().toUpperCase();if(!i)return null;if(i==="50"||i==="BULL"||i==="DBULL"||i==="IBULL")return 50;if(i==="25"||i==="OBULL")return 25;const d=i.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!d)return null;const u=d[1]||"S",l=parseInt(d[2],10);return l<1||l>20?null:l*(u==="S"?1:u==="D"?2:3)}const Ys=[...Array.from({length:20},(s,i)=>i+1),25,50],Ea=[20,19,18,17,16,15,25];function ga(){const s={};return Ea.forEach(i=>{s[i]=0}),{marks:s,points:0}}function lc(s,i,d,u,l=()=>!1){let m=null,p=0;if(d==="BULL"||d==="INNER_BULL"||i===25||i===50)m=25,p=d==="INNER_BULL"||i===50?2:1;else if(typeof u=="number"&&u>=15&&u<=20)m=u,d==="TRIPLE"?p=3:d==="DOUBLE"?p=2:p=1;else if(i){const S=[20,19,18,17,16,15];for(const w of S){if(i===w){m=w,p=1;break}if(i===w*2){m=w,p=2;break}if(i===w*3){m=w,p=3;break}}!m&&(i===25||i===50)&&(m=25,p=i===50?2:1)}if(!m)return 0;const L=s.marks[m],z=Math.max(0,3-L),G=Math.min(z,p),W=Math.max(0,p-G),Q=L+G;s.marks[m]=Q>3?3:Q;let q=0;return W>0&&!l(m)&&(m===25?d==="INNER_BULL"?q+=50*W:q+=25*W:q+=m*W),s.points+=q,q}function cc(s){return Ea.every(i=>(s.marks[i]||0)>=3)}function va(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function oc(s){return s.round}function dc(s,i,d,u){if(s.finished)return 0;const l=oc(s);let m=0;return typeof u=="number"&&u===l?d==="TRIPLE"?(m=l*3,s.turnHits.triples++):d==="DOUBLE"?(m=l*2,s.turnHits.doubles++):d==="SINGLE"&&(m=l*1,s.turnHits.singles++):!u&&(i===l||i===l*2||i===l*3)&&(i===l*3?(m=l*3,s.turnHits.triples++):i===l*2?(m=l*2,s.turnHits.doubles++):i===l&&(m=l,s.turnHits.singles++)),s.score+=m,m}function uc(s){if(!s.finished){if(s.turnHits.singles>0&&s.turnHits.doubles>0&&s.turnHits.triples>0){s.shanghaiAchieved=!0,s.finished=!0;return}const i=s.round+1;i>20?s.finished=!0:s.round=i}s.turnHits={singles:0,doubles:0,triples:0}}function ja(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function Wi(s){return s.targets[s.stage]||null}function mc(s,i,d,u){if(s.finished)return 0;const l=Wi(s);if(!l)return 0;let m=0;switch(l.kind){case"NUMBER":{typeof u=="number"&&u===l.num?d==="TRIPLE"?m=l.num*3:d==="DOUBLE"?m=l.num*2:d==="SINGLE"&&(m=l.num):!u&&(i===l.num||i===l.num*2||i===l.num*3)&&(m=i),m>0&&(s.hitThisRound=!0);break}case"DOUBLE":{(d==="DOUBLE"&&u===l.num||i===l.num*2)&&(m=l.num*2,s.hitThisRound=!0);break}case"TRIPLE":{(d==="TRIPLE"&&u===l.num||i===l.num*3)&&(m=l.num*3,s.hitThisRound=!0);break}case"BULL":{(d==="BULL"||d==="INNER_BULL"||i===25||i===50)&&(m=d==="INNER_BULL"||i===50?50:25,s.hitThisRound=!0);break}case"ANY_NUMBER":{i>0&&(m=i,s.hitThisRound=!0);break}}return s.score+=m,m}function hc(s){s.finished||(s.hitThisRound||(s.score=Math.floor(s.score/2)),s.hitThisRound=!1,s.stage+=1,s.stage>=s.targets.length&&(s.finished=!0))}function Na(){return{round:1,score:0,target:"HIGH",finished:!1}}function xc(s,i,d,u){if(s.finished)return 0;let l=0;if(s.target==="HIGH")if(d==="INNER_BULL")l=50;else if(typeof u=="number"){const p=u*(d==="TRIPLE"?3:d==="DOUBLE"?2:1);u>=20&&(l=p)}else i>=40&&(l=i);else if(typeof u=="number"){const p=u*(d==="TRIPLE"?3:d==="DOUBLE"?2:1);u<=10&&(l=p)}else i>0&&i<=30&&(l=i);return s.score+=l,l}function fc(s){if(!s.finished){if(s.round+=1,s.round>10){s.finished=!0;return}s.target=s.target==="HIGH"?"LOW":"HIGH"}}function bc(s,i=3){return{number:s,lives:i,isKiller:!1,eliminated:!1}}function pc(s){const i=Array.from({length:20},(u,l)=>l+1),d={};for(const u of s){const l=Math.floor(Math.random()*i.length),m=i.splice(l,1)[0];d[u]=m}return d}function Ai(s,i,d,u){const l=i[s];if(!l||!u||!d)return{becameKiller:!1};if(!l.isKiller&&d==="DOUBLE"&&u===l.number)return l.isKiller=!0,{becameKiller:!0};if(l.isKiller&&(d==="DOUBLE"||d==="TRIPLE")){const m=Object.keys(i).find(p=>p!==s&&!i[p].eliminated&&i[p].number===u);if(m){const p=i[m],L=d==="TRIPLE"?2:1;return p.lives=Math.max(0,p.lives-L),p.lives===0&&(p.eliminated=!0),{becameKiller:!1,victimId:m,livesRemoved:L}}}return{becameKiller:!1}}function Ii(s){const i=Object.entries(s).filter(([,d])=>!d.eliminated&&d.lives>0);return i.length===1?i[0][0]:null}function Pi(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function gc(s,i,d,u){if(s.finished)return 0;let l=0;if(typeof u=="number"&&u===s.inning?d==="TRIPLE"?l=3:d==="DOUBLE"?l=2:l=1:!u&&(i===s.inning||i===s.inning*2||i===s.inning*3)&&(l=i===s.inning*3?3:i===s.inning*2?2:1),s.score+=l,s.dartsThisInning+=1,s.dartsThisInning>=3){const m=s.inning+1;m>9?s.finished=!0:(s.inning=m,s.dartsThisInning=0)}return l}const vc={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function Bi(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function jc(s,i,d,u){if(s.finished)return!1;const l=vc[s.hole];if(s.dartsThisHole+=1,typeof u=="number"&&u===l&&(d==="SINGLE"||d==="DOUBLE"||d==="TRIPLE")||!u&&(i===l||i===l*2||i===l*3)){s.strokes+=s.dartsThisHole;const p=s.hole+1;return p>18?s.finished=!0:(s.hole=p,s.dartsThisHole=0),!0}if(s.dartsThisHole>=3){s.strokes+=3;const p=s.hole+1;p>18?s.finished=!0:(s.hole=p,s.dartsThisHole=0)}return!1}const Ki={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function Oi(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function Nc(s){const i=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[d,u,l]of i)if(s[d]&&s[d]===s[u]&&s[d]===s[l])return s[d];return s.every(d=>d)?"Draw":null}function wc(s,i,d,u,l){if(s.finished||s.board[i])return!1;const m=Ki[i];let p=!1;if(m.type==="BULL"?p=u==="BULL"||u==="INNER_BULL"||d===25||d===50:m.type==="NUM"&&typeof m.num=="number"&&(typeof l=="number"&&l===m.num||!l&&(d===m.num||d===m.num*2||d===m.num*3))&&(p=!0),!p)return!1;s.board[i]=s.turn;const L=Nc(s.board);return L?(s.finished=!0,s.winner=L,!0):(s.turn=s.turn==="X"?"O":"X",!0)}function Ca(){return{targetIndex:0,darts:0,finished:!1}}const zi=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25],wa=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","Bull"];function yc(s){return zi[s.targetIndex]}function ka(s,i,d){if(s.finished)return s;const u=yc(s);if(!(d==="SINGLE"&&i===u||d==="DOUBLE"&&i===u||d==="TRIPLE"&&i===u||d==="INNER_BULL"&&u===25))return s;const m=s.targetIndex+1,p=m>=zi.length;return{targetIndex:m,darts:s.darts+1,finished:p}}function Ui(s,i){return ka(s,i,"SINGLE")}function Sc(){return Ca()}function Da(s=50){return{score:0,darts:0,finished:!1,target:s}}const Cc=[5,10,15,20,25,50];function kc(s){return Cc.includes(s)}function Ta(s,i,d){if(s.finished)return s;if(!kc(i))return{...s,darts:s.darts+1};const u=s.score+i,l=u>=s.target;return{score:l?s.target:u,darts:s.darts+1,finished:l,target:s.target}}function Fi(s,i){return Ta(s,i)}function Dc(s=50){return Da(s)}function La(s=70){return{score:0,darts:0,finished:!1,target:s}}const Tc=[7,14,21];function Lc(s){return Tc.includes(s)}function Ma(s,i,d){if(s.finished)return s;if(!Lc(i))return{...s,darts:s.darts+1};const u=s.score+i,l=u>=s.target;return{score:l?s.target:u,darts:s.darts+1,finished:l,target:s.target}}function Vi(s,i){return Ma(s,i)}function Mc(s=70){return La(s)}const Ra=[20,19,18,17,16,15,14,13,12,25];function $i(){const s={};return Ra.forEach(i=>{s[i]=0}),{marks:s,points:0}}function Ec(s,i,d,u,l=()=>!1){let m=null,p=0;if(d==="BULL"||d==="INNER_BULL"||i===25||i===50)m=25,p=d==="INNER_BULL"||i===50?2:1;else if(typeof u=="number"&&u>=12&&u<=20)m=u,d==="TRIPLE"?p=3:d==="DOUBLE"?p=2:p=1;else if(i){for(const S of[20,19,18,17,16,15,14,13,12]){if(i===S){m=S,p=1;break}if(i===S*2){m=S,p=2;break}if(i===S*3){m=S,p=3;break}}!m&&(i===25||i===50)&&(m=25,p=i===50?2:1)}if(!m)return 0;const L=s.marks[m],z=Math.max(0,3-L),G=Math.min(z,p),W=Math.max(0,p-G),Q=L+G;s.marks[m]=Q>3?3:Q;let q=0;return W>0&&!l(m)&&(m===25?d==="INNER_BULL"?q+=50*W:q+=25*W:q+=m*W),s.points+=q,q}function Rc(s){return Ra.every(i=>(s.marks[i]||0)>=3)}function Ac({left:s,right:i,className:d="",sticky:u=!0}){return e.jsxs("div",{className:`${u?"sticky top-0":""} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${d}`,children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:s}),e.jsx("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:i})]})}function xs({gameMode:s,players:i,matchScore:d,gameRules:u}){return!i||i.length===0?null:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:i.map((l,m)=>e.jsxs("div",{className:`rounded-lg border p-3 ${l.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-2 uppercase tracking-wide ${l.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:l.name}),e.jsxs("div",{className:"space-y-1 text-sm",children:[s==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Legs Won",value:`â— ${l.legsWon||0}`,highlight:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0}),e.jsx(le,{label:"Last Score",value:l.lastScore||"0",mono:!0}),e.jsx(le,{label:"C/Out Rate",value:`${l.checkoutRate||0}%`,mono:!0}),e.jsx(le,{label:"Best Leg",value:l.bestLeg||"â€”",mono:!0}),l.matchAvg!==void 0&&l.allTimeAvg!==void 0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[e.jsx(le,{label:"Match Avg",value:l.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:l.matchAvg>0}),e.jsx(Ic,{matchAvg:l.matchAvg,allTimeAvg:l.allTimeAvg})]})})]}),(s==="Cricket"||s==="American Cricket")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Closed",value:Pc(l.closed),mono:!0}),e.jsx(le,{label:"Points",value:l.points||0,mono:!0,bold:!0}),e.jsx(le,{label:"Status",value:Bc(l),highlight:l.isCurrentTurn})]}),(s==="Shanghai"||s==="Halve It")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:s==="Shanghai"?"Round":"Stage",value:l.round||1,mono:!0}),e.jsx(le,{label:"Target",value:l.target||"â€”",mono:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Killer"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Target #",value:l.number||"â€”",mono:!0,bold:!0}),e.jsx(le,{label:"Lives",value:l.lives||0,mono:!0,bold:!0}),l.eliminated&&e.jsx(le,{label:"Status",value:"ELIMINATED",highlight:!1})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Round",value:l.round||1,mono:!0}),e.jsx(le,{label:"Target",value:l.target||"High",mono:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),(s==="Double Practice"||s==="Treble Practice"||s==="Around the Clock")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Target",value:l.target||"â€”",mono:!0,bold:!0}),e.jsx(le,{label:"Hits",value:l.hits||0,mono:!0,bold:!0}),l.totalNeeded&&e.jsx(le,{label:"Progress",value:`${l.hits||0} / ${l.totalNeeded}`,mono:!0})]}),(s==="Count-Up"||s==="High Score"||s==="Low Score")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Round",value:l.round||1,mono:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0}),s==="High Score"&&e.jsx(le,{label:"Best",value:l.bestScore||0,mono:!0})]}),(s==="Checkout 170"||s==="Checkout 121")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Remaining",value:l.remaining||0,mono:!0,bold:!0}),e.jsx(le,{label:"Attempts",value:l.attempts||0,mono:!0}),e.jsx(le,{label:"Successes",value:l.successes||0,mono:!0})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Target",value:`D${l.target||1}`,mono:!0,bold:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Inning",value:l.inning||1,mono:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Hole",value:l.hole||1,mono:!0}),e.jsx(le,{label:"Strokes",value:l.strokes||0,mono:!0,bold:!0})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Turn",value:l.turn||1,mono:!0}),l.winner&&e.jsx(le,{label:"Result",value:"WINNER!",highlight:!0})]}),d&&(s==="X01"||s==="Cricket"||s==="American Cricket")&&m===1&&e.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:e.jsx(le,{label:"Match",value:d,mono:!0,bold:!0,highlight:!0})})]})]},m))})}function le({label:s,value:i,mono:d=!1,bold:u=!1,highlight:l=!1}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"opacity-70",children:[s,":"]}),e.jsx("span",{className:`${d?"font-mono":""} ${u?"font-semibold":""} ${l?"text-emerald-300":""}`,children:i})]})}function Ic({matchAvg:s,allTimeAvg:i}){const d=s-i,u=d>0,l=Math.abs(d)<.01;let m="",p="text-slate-300";return l?(m="= All-time",p="text-slate-300"):u?(m=`+${d.toFixed(2)} vs avg`,p="text-emerald-400"):(m=`${d.toFixed(2)} vs avg`,p="text-orange-400"),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-70",children:"AVG vs Avg:"}),e.jsx("span",{className:`font-mono font-semibold ${p}`,children:m})]})}function Pc(s){return!s||Object.keys(s).length===0?"â€”":Object.entries(s).filter(([d,u])=>u===3).map(([d])=>d==="25"?"B":d).join(",")||"â€”"}function Bc(s){if(!s.closed)return"Starting";const i=Object.values(s.closed).filter(d=>d===3).length;return i===0?"No marks":i<7?`${i}/7`:"Closing in"}function Kt(s){return(i,d)=>{s(i)}}function Oc(s){const{match:i,commitManualVisitTotal:d,endTurn:u}=s;return{addVisit:(l,m=3,p)=>{if(d){d(l);return}try{i.addVisit(l,m,p)}catch{i.addVisit(l,m)}},undoVisit:()=>{i.undoVisit()},nextPlayer:()=>{if(u)try{u(0)}catch{i.nextPlayer()}else i.nextPlayer()},endLeg:l=>{typeof l=="number"?i.endLeg(l):i.endLeg(0)},endGame:()=>{i.endGame()}}}function an(s,i,d,u,l,m,p,L,z,G,W,Q,q,S,w,J,C,fe,me,pe,O,ne,Ae,Ne,We,Ge,qe){return n.useMemo(()=>{const Be=[];if(s==="X01"){let T=0,ce=0,g=0;if(fe&&fe.length>0){for(const mt of fe)mt.dartsThrown&&mt.totalScored&&(ce+=mt.dartsThrown,g+=mt.totalScored);ce>0&&(T=g/ce*3)}const Ke=(Q??0)>0?L??0:G??null??(m??0);if(Be.push({name:"You",isCurrentTurn:!!me,legsWon:u||0,score:i||0,lastScore:Ke,checkoutRate:w&&w>0?Math.round((S||0)/w*100):0,bestLeg:fe&&fe.length>0?`${Math.min(...fe.map(mt=>mt.doubleDarts+(mt.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:T,allTimeAvg:Ol("You")||0}),pe&&pe!=="None"){const be=(q??0)>0?z??0:W??null??(p??0);Be.push({name:`${pe} AI`,isCurrentTurn:!me,legsWon:l||0,score:d||0,lastScore:be,checkoutRate:C&&C>0?Math.round((J||0)/C*100):0,bestLeg:"â€”"})}}return s==="Cricket"&&(Be.push({name:"You",isCurrentTurn:!!me,closed:ne?.marks||{},points:ne?.points||0}),pe&&pe!=="None"&&Be.push({name:`${pe} AI`,isCurrentTurn:!me,closed:{},points:0})),s==="Shanghai"&&(Be.push({name:"You",isCurrentTurn:!!me,round:Ae?.round||1,target:Ae?.target||1,score:Ae?.score||0}),pe&&pe!=="None"&&Be.push({name:`${pe} AI`,isCurrentTurn:!me,round:Ae?.round||1,target:Ae?.target||1,score:0})),s==="Killer"&&Ne&&Ne.length>0&&Ne.forEach((T,ce)=>{const g=We?.[T.id];Be.push({name:T.name,isCurrentTurn:ce===qe,number:Ge?.[T.id],lives:g?.lives||0,eliminated:g?.eliminated||!1})}),Be},[s,i,d,u,l,m,p,L,z,G,W,Q,q,S,w,J,C,fe,me,pe,ne,Ae,Ne,We,Ge,qe])}const Uc=["Easy","Medium","Hardened"];function fs(s,i,d){return Math.max(i,Math.min(d,s))}const Fc=6500;function Vc(s,i){let d=0;if(i==="Easy"){const u=[22,26,41,45,60];d=u[Math.floor(Math.random()*u.length)]}else i==="Medium"?d=Math.round(fs(60+(Math.random()*30-15),30,100)):d=Math.round(fs(80+(Math.random()*20-10),50,120));return s<=0?0:d>s?[100,85,81,60,57,45,41,26,22,20,1].find(l=>l<=s)??0:d}function $c({onClose:s}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:s,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const Hc="http://localhost:8787";function Zc({user:s}){const{offlineLayout:i,favoriteDouble:d,callerEnabled:u,callerVoice:l,callerVolume:m,speakCheckoutOnly:p,rememberLastOffline:L,setLastOffline:z,autoStartOffline:G,cameraScale:W,setCameraScale:Q,cameraAspect:q="wide",setCameraAspect:S,cameraFitMode:w="fill",setCameraFitMode:J,cameraEnabled:C,textSize:fe,boxSize:me,autoscoreProvider:pe,autoCommitMode:O="wait-for-clear",matchType:ne="singles",setMatchType:Ae,teamAName:Ne="Team A",setTeamAName:We,teamBName:Ge="Team B",setTeamBName:qe}=st(),Be=pe==="manual",T=C&&!Be,ce=C&&!Be&&O!=="immediate",[g,St]=n.useState("X01"),[F,Ct]=n.useState(501),[re,Z]=n.useState("None"),[Ke,mt]=n.useState(!1),[jt,Xe]=n.useState(!1),[ee,ve]=n.useState(F),[be,is]=n.useState(F),[ln,De]=n.useState(!1),[he,ge]=n.useState(!1),[Ut,es]=n.useState(1),[Oe,K]=n.useState(0),nt=Vr(),[ht,Ye]=n.useState(!1),zt=n.useRef(!1),[ze,Nt]=n.useState(0),[b,y]=n.useState(null),[D,$]=n.useState(1),[I,je]=n.useState(1),[Y,kt]=n.useState([]),[we,ae]=n.useState(2e3),Te=Ul(),[ue,cn]=n.useState(!1),[bs,Js]=n.useState(i==="modern"),[Ft,Qs]=n.useState(i==="modern");n.useEffect(()=>{Js(i==="modern"),Qs(i==="modern")},[i]),n.useEffect(()=>{w!=="fit"&&J("fit")},[w,J]);const[Gt,ts]=n.useState(1),[_r,on]=n.useState(!1),[Le,rt]=n.useState(!0);n.useEffect(()=>{const t=()=>Mn(!0);return window.addEventListener("ndn:open-camera-manager",t),()=>window.removeEventListener("ndn:open-camera-manager",t)},[]);const[te,X]=n.useState(0),[Zs,$n]=n.useState(0),[Je,dn]=n.useState(0),[ls,ps]=n.useState(0),[qt,ss]=n.useState(0),[Mt,Ps]=n.useState(ga()),[Bs,un]=n.useState(va()),[Os,mn]=n.useState(ja()),[gs,Us]=n.useState(Na()),[vs,Qe]=n.useState(0),[en,dr]=n.useState(1),[Wr,Hn]=n.useState(27),[Aa,js]=n.useState(0),[Kr,hn]=n.useState(0),[tn,Ns]=n.useState(!1),[_n,xn]=n.useState(1),[ur,Wn]=n.useState(0),[Ia,mr]=n.useState(0),ns=8,[Kn,fn]=n.useState(1),[bn,hr]=n.useState(0),[zn,xr]=n.useState(0),Xt=10,[Ue,fr]=n.useState(1),[Et,Rt]=n.useState(0),[at,Gn]=n.useState(0),pn=10,[At,gn]=n.useState(170),[Yt,vn]=n.useState(0),[Jt,br]=n.useState(0),[sn,pr]=n.useState(0),[jn,Nn]=n.useState(121),[Fs,wn]=n.useState(0),[ws,yn]=n.useState(0),[Vt,ys]=n.useState(0),[$t,rs]=n.useState(20),[Sn,Cn]=n.useState(0),[wt,pt]=n.useState(0),[Ss,gr]=n.useState(30),[qn,Vs]=n.useState(!1),[Xn,Cs]=n.useState(Pi()),[nn,Yn]=n.useState(Bi()),[ks,Jn]=n.useState(Oi()),[$s,Qn]=n.useState($i()),[Ie,kn]=n.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[xt,Hs]=n.useState({}),[Ds,Dn]=n.useState({}),[vr,Zn]=n.useState(!1),[Dt,_s]=n.useState(0),[zr,r]=n.useState(0),[c,x]=n.useState(null),[B,M]=n.useState(""),[v,H]=n.useState(Ca()),[P,se]=n.useState(Ca()),[Fe,V]=n.useState(Da(50)),[oe,Ht]=n.useState(Da(50)),[Me,ot]=n.useState(La(70)),[it,gt]=n.useState(La(70)),[It,Qt]=n.useState(0),[Zt,cs]=n.useState(0),[Ze,ft]=n.useState(0),[rn,Ee]=n.useState(F),[Ve,lt]=n.useState(0),[os,ct]=n.useState(null),[Pt,Ce]=n.useState(0),et=n.useRef(0),bt=n.useRef(0),de=n.useRef(ee),_e=n.useRef(Ze),tt=n.useRef(Ve),Bt=n.useRef(rn),$e=n.useRef(Pt);n.useEffect(()=>{de.current=ee},[ee]),n.useEffect(()=>{_e.current=Ze},[Ze]),n.useEffect(()=>{tt.current=Ve},[Ve]),n.useEffect(()=>{Bt.current=rn},[rn]),n.useEffect(()=>{$e.current=Pt},[Pt]);const[Gr,ds]=n.useState(0);n.useRef(null);const[Ts,jr]=n.useState(0),[Ws,Ls]=n.useState(0),[us,as]=n.useState(0),[Ks,_t]=n.useState(0),[Ms,N]=n.useState(null),[xe,ie]=n.useState(0),[ke,Re]=n.useState(0),[dt,Es]=n.useState(0),[Rs,Tn]=n.useState(0),[er,Pa]=n.useState(0),[tr,Ln]=n.useState(0),[sr,Ba]=n.useState(0),[qr,nr]=n.useState(0),[Xr,Oa]=n.useState(0),[Ua,Nr]=n.useState(0),[Gi,wr]=n.useState(0),[qi,yr]=n.useState(0),[Fa,Yr]=n.useState(0),[Xi,Jr]=n.useState(0),[Yi,Qr]=n.useState(0),[Ji,Sr]=n.useState(0),[Qi,Va]=n.useState(0),[Zi,Zr]=n.useState(!1),[yt,vt]=n.useState(""),[ea,rr]=n.useState(""),[_c,Wc]=n.useState(""),[$a,Ha]=n.useState(""),[_a,ta]=n.useState(""),[Wa,sa]=n.useState(""),[Cr,na]=n.useState(null),[el,Mn]=n.useState(!1),[tl,Ka]=n.useState({}),[sl,ar]=n.useState(!1),zs=n.useRef(null),ra=n.useRef(null),ms=n.useCallback(()=>{const t=ra.current;t&&(clearTimeout(t),ra.current=null)},[]),kr=n.useCallback(t=>{if(!u)return;const a=s?.username||"Player";try{Ur(a,t.visitTotal,Math.max(t.remaining,0),l,{volume:m,checkoutOnly:p})}catch{}},[u,l,m,p,s?.username]),Dr=n.useCallback((t,a)=>{ar(!1);const{visitTotal:o,darts:h,preRemaining:f,remaining:R,doubleAttempts:E,finished:_,doubleWindow:k,highestCheckout:A}=t;_?(ve(0),de.current=0,typeof A=="number"&&A>0&&Sr(j=>Math.max(j,A))):(ve(R),de.current=R),ct(o),o===180?Nr(j=>j+1):o>=140?wr(j=>j+1):o>=100&&yr(j=>j+1),k&&E>0&&(Re(j=>j+E),_&&Es(j=>j+1)),t.announced||kr(t);try{Fn.getState().recordVisit("offline-x01",h,o,{preRemaining:f,postRemaining:_?0:R,finish:_,bust:!1})}catch{}_&&(y("player"),ge(!0)),On(_?0:R),lt(0),tt.current=0,ft(0),_e.current=0,Ce(0),$e.current=0},[On,Sr,y,ve,ct,lt,ft,Ce,ge,Nr,wr,yr,Re,Es,kr]),En=n.useCallback(t=>{const a=zs.current;a&&(zs.current=null,ms(),Dr(a,t))},[ms,Dr]),za=n.useCallback(t=>{kr(t),zs.current={...t,announced:!0},ar(!0),ms(),ra.current=setTimeout(()=>En("timeout"),Fc)},[ms,En,kr]);n.useEffect(()=>{if(!ce)return;const t=()=>En("event");return window.addEventListener("ndn:darts-cleared",t),()=>window.removeEventListener("ndn:darts-cleared",t)},[ce,En]),n.useEffect(()=>{ce||En("timeout")},[ce,En]),n.useEffect(()=>()=>ms(),[ms]),n.useEffect(()=>{if(Ze===0){try{window.dispatchEvent(new CustomEvent("ndn:darts-cleared",{detail:{source:"offline-play",ts:Date.now()}}))}catch{}et.current=0}bt.current=Ze},[Ze]);const Gs=s?.username||"Player 1",Rn=re==="None"?"Player 2":re,Tr=an("X01",ee,be,Oe,ze,Zt,Ws,Ve,us,os,Ms,Ze,Ks,dt,ke,er,Rs,Y,Le,re),nl=an("Cricket",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Mt),rl=an("Shanghai",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Le,re,void 0,Mt,Bs),al=an("Killer",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ie,xt,Ds,Dt),il=an("Scam"),ll=an("Fives"),cl=an("Sevens"),Lr=n.useMemo(()=>{const t=Tr||[],a=Ze>0?Ve:os??Zt,o=Ks>0?us:Ms??Ws;return t.length===0?{name:Le?Gs:Rn,isCurrentTurn:!0,legsWon:Le?Oe:ze,score:Le?ee:be,lastScore:Le?a:o}:t.find(h=>h.isCurrentTurn)??t[0]},[Tr,Le,Gs,Rn,Oe,ze,ee,be,Ze,Ve,os,Zt,us,Ms,Ws,Ks]),Ga=n.useMemo(()=>{if(!Lr)return[];const{matchAvg:t,allTimeAvg:a,...o}=Lr;return[{...o,matchAvg:void 0,allTimeAvg:void 0}]},[Lr]),ol=Le?Rn:Gs,dl=Lr?.name??(Le?Gs:Rn),ul=Le?ee:be,ml=Le?Ze>0?Ve:os??Zt:Ks>0?us:Ms??Ws,ye=n.useCallback((t,a=1)=>{!t||a<=0||Ka(o=>({...o,[t]:(o[t]||0)+a}))},[]),He=n.useCallback(t=>{t&&Ka(a=>a[t]===void 0?a:{...a,[t]:0})},[]);tl[g];const hl=t=>{if(!t.trim())return null;const a=Number(t);return Number.isFinite(a)?fs(Math.round(a),0,F):null},xl=t=>{if(!t.trim())return null;const a=Number(t);return Number.isFinite(a)?Math.max(0,Math.round(a)):null},qa=n.useCallback(()=>{zs.current&&(zs.current=null),ms(),ar(!1)},[ms]);n.useCallback(t=>{const a=fs(t,0,F);qa(),ve(a),de.current=a;const o=a===0?F:a;Ee(o),Bt.current=o,lt(0),tt.current=0,ft(0),_e.current=0,Ce(0),$e.current=0,ct(null),cs(0),X(0),et.current=0,a===0?(y("player"),ge(!0)):(y(null),ge(!1))},[qa,ve,F,Ee,lt,ft,Ce,ct,cs,X,y,ge]);const Xa=t=>{const o=hl($a);if(o===null){Te(`Enter a number between 0 and ${F}`,{type:"error",timeout:2500});return}is(o),as(0),_t(0),N(null),ie(0),Ls(0),Ha(""),y(null),ge(!1)},Ya=n.useCallback((t,a)=>{t==="player"?(K(a),ta("")):(Nt(a),sa("")),y(null),ge(!1)},[Nt,sa,ta,y,K,ge]),Mr=t=>{const o=xl(t==="player"?_a:Wa);if(o===null){Te("Enter a non-negative whole number for legs",{type:"error",timeout:2500});return}na({target:t,value:o,stage:1})},fl=n.useCallback(()=>{na(t=>t&&(t.stage===1?{...t,stage:2}:(Ya(t.target,t.value),null)))},[Ya]),ir=n.useCallback(()=>{na(null)},[]);n.useEffect(()=>{if(!Cr)return;const t=a=>{a.key==="Escape"&&(a.preventDefault(),ir())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[ir,Cr]);const qs=(t=>{switch(t){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(fe),An=n.useRef(null),In=n.useRef(null),aa=n.useRef(null),[Pn,ia]=n.useState("first"),[Er,Ja]=n.useState(1),bl=n.useRef(null);n.useEffect(()=>{const t=Math.max(1,Math.floor(Number(Er)||1)),a=Pn==="first"?t:Math.max(1,Math.ceil(t/2));es(a)},[Pn,Er]),n.useEffect(()=>{if(!Ft){ts(1),on(!1);return}const t=()=>{const h=An.current,f=In.current;if(!h||!f)return;const R=aa.current?aa.current.getBoundingClientRect().height:0,E=Math.max(0,h.clientHeight-R-6),_=Math.max(0,h.clientWidth-8),k=f.getBoundingClientRect(),A=Gt||1,j=k.height/A,U=k.width/A,Lt=E>0?E/j:1,hs=_>0?_/U:1,Xs=Math.min(1,Math.max(.5,Math.min(Lt,hs))),Ot=j*Xs,ut=E>0&&Ot-E>1;on(ut),ts(Xs)};t();const a=window.ResizeObserver,o=a?new a(()=>t()):null;return o&&An.current&&o.observe(An.current),o&&In.current&&o.observe(In.current),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t);try{o&&An.current&&o.unobserve(An.current)}catch{}try{o&&In.current&&o.unobserve(In.current)}catch{}}},[Ft,Gt]),n.useEffect(()=>{const t=a=>{const o=a?.detail?.mode;o&&(St(o),Bn())};return window.addEventListener("ndn:auto-start",t),()=>window.removeEventListener("ndn:auto-start",t)},[]),n.useEffect(()=>{const t=a=>{const o=a?.detail?.formatType,h=a?.detail?.formatCount,f=a?.detail?.startScore;(o==="first"||o==="best")&&ia(o),typeof h=="number"&&isFinite(h)&&Ja(Math.max(1,Math.floor(h))),typeof f=="number"&&isFinite(f)&&Ct(Math.max(1,Math.floor(f)))};return window.addEventListener("ndn:offline-format",t),()=>window.removeEventListener("ndn:offline-format",t)},[]),n.useEffect(()=>{if(!G)return;const t=setTimeout(()=>Bn(),50);return()=>clearTimeout(t)},[G]),n.useEffect(()=>{if(!ue||Le||re==="None"||Gr<=0)return;let t,a=performance.now();const o=h=>{const f=h-a;a=h,ds(R=>{const E=R-f;if(E<=0){let _=0,k=0,A=be;for(_t(0);_<3&&A>0;){const j=Vc(A,re),U=fs(j-_*20,0,Math.min(60,A)),Lt=A-U;if(Ls(U),jr(Ot=>Ot+1),Ba(Ot=>Ot+1),Lt<0){A=be,as(0),ie(0),k=0,N(0),_t(0);break}k+=U,as(Ot=>Ot+U),Oa(Ot=>Ot+U);const hs=A,Xs=Lt;if(hs>50&&Xs<=50?ie(1):hs<=50&&ie(Ot=>Ot+1),A=Lt,_+=1,_t(_),A===0)break}if(is(A),A===0){k===180?Yr(U=>U+1):k>=140?Jr(U=>U+1):k>=100&&Qr(U=>U+1);const j=be;j<=170&&Va(U=>Math.max(U,j)),be<=50&&(Tn(U=>U+(xe>0?xe:1)),Pa(U=>U+1)),N(k),as(0),ie(0),_t(0),y("ai"),ge(!0)}return A>0&&_>=3&&(k===180?Yr(j=>j+1):k>=140?Jr(j=>j+1):k>=100&&Qr(j=>j+1),N(k),as(0),ie(0),_t(0)),_t(0),rt(!0),0}return E}),t=requestAnimationFrame(o)};return t=requestAnimationFrame(o),()=>cancelAnimationFrame(t)},[ue,Le,re,be]),n.useEffect(()=>{nt.inProgress&&(zt.current||(Ye(!0),zt.current=!0))},[nt.inProgress]);function Bn(){Xe(!0),ve(F),de.current=F,is(F),De(!1),cn(!0),rt(!0),X(0),Qt(0),cs(0),ft(0),_e.current=0,Ee(F),lt(0),ct(null),Ce(0),ds(0),jr(0),Ls(0),as(0),_t(0),N(null),y(null),K(0),Nt(0),kt([]),Cn(0),pt(0),Vs(!1),Ln(0),Ba(0),nr(0),Oa(0),Nr(0),wr(0),yr(0),Yr(0),Jr(0),Qr(0),Sr(0),Va(0),Re(0),Es(0),Tn(0),Pa(0),He("X01");const t=Math.max(1,Math.floor(Number(Er)||1));if(es(Pn==="first"?t:Math.max(1,Math.ceil(t/2))),L)try{z({mode:g,x01Start:F,firstTo:Ut,aiLevel:re})}catch{}}function pl(){ve(F),de.current=F,is(F),De(!1),cn(!0),rt(!0),X(0),Qt(0),cs(0),ft(0),_e.current=0,Ee(F),lt(0),Bt.current=F,tt.current=0,ct(null),Ce(0),$e.current=0,$e.current=0,ds(0),jr(0),Ls(0),as(0),_t(0),N(null),y(null)}function On(t){ft(0),_e.current=0,Ee(t===0?F:t),Bt.current=t===0?F:t,Ce(0),$e.current=0,re!=="None"?(rt(!1),ds(we)):(ds(0),rt(!0))}function lr(t){if(ce&&zs.current){sl||ar(!0),Te("Remove your darts before starting the next throw",{type:"info",timeout:1800});return}ye("X01");const a=de.current,o=_e.current,h=tt.current,f=Bt.current,R=$e.current,E=a-t,_=o+1;if(cs(t),Qt(ut=>ut+1),Ln(ut=>ut+1),E<0){try{const ut=a,pa=f;Fn.getState().recordVisit("offline-x01",_,0,{preRemaining:ut,postRemaining:pa,bust:!0,finish:!1})}catch{}if(ve(f),de.current=f,a<=50){const ut=(R||0)+1;Re(pa=>pa+ut)}if(u)try{Ur(s?.username||"Player",0,Math.max(f,0),l,{volume:m,checkoutOnly:p})}catch{}ct(0),X(0),lt(0),tt.current=0,Ce(0),$e.current=0,On(f);return}ve(E),de.current=E,ft(_),_e.current=_;const k=h+t;lt(k),tt.current=k,nr(ut=>ut+t),X(0);const A=a,j=E,U=A>50&&j<=50,Lt=A<=50;U?(Ce(1),$e.current=1):Lt&&(Ce(ut=>ut+1),$e.current=(R||0)+1);const hs=$e.current||0,Xs=A<=50,Ot=Xs?Math.max(hs,Math.min(_,3)):0;if(E===0){const ut={visitTotal:k,darts:_,preRemaining:a,remaining:0,doubleAttempts:Ot,finished:!0,doubleWindow:Xs,highestCheckout:f<=170?f:null};ce?za(ut):Dr(ut,"immediate");return}if(_>=3){const ut={visitTotal:k,darts:_,preRemaining:a,remaining:E,doubleAttempts:Ot,finished:!1,doubleWindow:Xs,highestCheckout:null};ce?za(ut):Dr(ut,"immediate");return}}function Rr(){const t=fs(Math.round(Number(te)||0),0,60);lr(t)}function Tt(t){if(!Number.isFinite(t))return!1;const a=Bt.current,o=de.current,h=_e.current,f=tt.current,R=h>0||f>0;R&&(ve(a),de.current=a,ft(0),_e.current=0,lt(0),tt.current=0,Ce(0),$e.current=0,cs(0),X(0),Qt(j=>Math.max(0,j-h)),Ln(j=>Math.max(0,j-h)),nr(j=>Math.max(0,j-f)),et.current=0);const E=R?a:o,_=E<=170?170:180,k=fs(Math.round(t),0,_);ye("X01",3),Qt(j=>j+3),Ln(j=>j+3),ft(3),_e.current=3,lt(k),tt.current=k,ct(k),k===180?Nr(j=>j+1):k>=140?wr(j=>j+1):k>=100&&yr(j=>j+1);const A=E-k;if(A<0){if(u)try{Ur(Gs,0,Math.max(a,0),l,{volume:m,checkoutOnly:p})}catch{}try{Fn.getState().recordVisit("offline-x01",3,0,{preRemaining:E,postRemaining:a,bust:!0,finish:!1})}catch{}return ve(a),de.current=a,ct(0),lt(0),tt.current=0,ft(0),_e.current=0,Ce(0),$e.current=0,On(a),!0}if(ve(A),de.current=A,nr(j=>j+k),u)try{Ur(Gs,k,Math.max(A,0),l,{volume:m,checkoutOnly:p})}catch{}if(E<=50&&(Re(j=>j+3),A===0&&Es(j=>j+1)),A===0){E<=170&&Sr(j=>Math.max(j,E));try{Fn.getState().recordVisit("offline-x01",3,k,{preRemaining:E,postRemaining:0,finish:!0,bust:!1})}catch{}return y("player"),ge(!0),ft(0),_e.current=0,lt(0),tt.current=0,Ce(0),$e.current=0,!0}try{Fn.getState().recordVisit("offline-x01",3,k,{preRemaining:E,postRemaining:A,finish:!1,bust:!1})}catch{}return On(A),lt(0),tt.current=0,ft(0),_e.current=0,Ce(0),$e.current=0,!0}const Wt=Oc({match:nt,commitManualVisitTotal:Tt,endTurn:On}),[Ar,Ir]=n.useState(""),Qa=t=>{if(!t){Ir("");return}const a=t.replace(/[^0-9]/g,"");if(!a){Ir("");return}const o=Number(a);if(!Number.isFinite(o))return;const h=de.current<=170?170:180,f=fs(Math.round(o),0,h);Ir(String(f))};function Pr(){if(!Ar){alert("Enter a number 0â€“180 for visit total");return}const t=Number(Ar);if(!Number.isFinite(t)){alert("Enter a number 0â€“180 for visit total");return}const a=de.current<=170?170:180,o=fs(Math.round(t),0,a);t>a&&Te(`Visit totals cannot exceed ${a}.`,{type:"info",timeout:2200}),Tt(o)&&Ir("")}const la=n.useCallback(()=>{zs.current&&(zs.current=null,ms(),ar(!1));const t=_e.current,a=tt.current,o=Bt.current;t===0&&a===0||(ve(o),de.current=o,ft(0),_e.current=0,lt(0),tt.current=0,Ce(0),$e.current=0,cs(0),X(0),Qt(h=>Math.max(0,h-t)),Ln(h=>Math.max(0,h-t)),nr(h=>Math.max(0,h-a)),et.current=0)},[ms]);n.useEffect(()=>{const t=a=>{const o=a?.detail;!o||o?.source==="offline-play"||la()};return window.addEventListener("ndn:clear-visit-request",t),()=>window.removeEventListener("ndn:clear-visit-request",t)},[la]);function Za(t){ye("Double Practice");const a=fs(Math.round(t||0),0,60);if(cs(a),Qt(o=>o+1),Ln(o=>o+1),Ri(a,Zs)){const o=Je+1;dn(o),$n(h=>Math.min(20,h+1)),o>=21&&(y("player"),ge(!0))}X(0)}function ei(){Za(Number(te))}function ti(){const t=Un(yt);if(t==null){alert("Enter like D16, 50, 25, T20");return}Za(t),vt("")}function si(t,a,o){if(tn)return!1;ye("Bob's 27");const h=en,f=a==="DOUBLE"&&o===h||!a&&t===h*2;return f&&hn(R=>R+1),js(R=>{const E=R+1;if(E>=3){const _=Kr+(f?1:0);_>0?Hn(A=>A+_*h*2):Hn(A=>A-h*2);const k=h+1;return dr(k),hn(0),k>20&&Ns(!0),0}return E}),!0}function ni(){si(Math.max(0,te|0)),X(0)}function ri(){dr(1),Hn(27),js(0),hn(0),Ns(!1),He("Bob's 27")}function ca(t){return ye("Count-Up"),Wn(a=>a+Math.max(0,t|0)),mr(a=>{const o=a+1;return o>=3?(xn(h=>h+1),0):o}),!0}function oa(t){return ye("High Score"),hr(a=>a+Math.max(0,t|0)),xr(a=>{const o=a+1;return o>=3?(fn(h=>h+1),0):o}),!0}function da(t){return ye("Low Score"),Rt(a=>a+Math.max(0,t|0)),Gn(a=>{const o=a+1;return o>=3?(fr(h=>h+1),0):o}),!0}function ai(t,a,o,h,f,R,E,_){const k=t-E;if(!(k<0))if(k===0){if(_==="DOUBLE"||_==="INNER_BULL"){R(A=>A+1),f(A=>A+1),h(()=>0),a(t);return}a(k)}else a(k);h(A=>{const j=A+1;return j>=3?(f(U=>U+1),0):j})}function ii(t,a){return ye("Checkout 170"),ai(At,gn,Yt,vn,br,pr,t,a),Yt+1>=3&&gn(170),!0}function li(t,a){return ye("Checkout 121"),ai(jn,Nn,Fs,wn,yn,ys,t,a),Fs+1>=3&&Nn(121),!0}function Br(t){const a=Un(yt);if(a==null){alert("Enter like T20, D16, 25, 50");return}const o=yt.trim().toUpperCase(),h=o.startsWith("D")||o==="50"||o==="BULL"||o==="DBULL"||o==="IBULL"||o.includes("INNER");t?ii(a,h?"DOUBLE":void 0):li(a,h?"DOUBLE":void 0),vt("")}function gl(){gn(170),vn(0),br(0),pr(0),He("Checkout 170")}function vl(){Nn(121),wn(0),yn(0),ys(0),He("Checkout 121")}function ua(t,a,o){return qn?!1:(ye("Treble Practice"),(a==="TRIPLE"&&o===$t||!a&&t===$t*3)&&Cn(f=>f+1),pt(f=>{const R=f+1;if(R%3===0&&[20,19,18].includes($t)){const E=[20,19,18],_=E.indexOf($t),k=E[(_+1)%E.length];rs(k)}return Ss>0&&R>=Ss&&Vs(!0),R}),!0)}function ci(){Cn(0),pt(0),Vs(!1),He("Treble Practice")}function jl(t,a,o){return ye("Baseball"),Cs(h=>{const f={...h};return gc(f,t,a,o),f}),!0}function Nl(){Cs(Pi()),He("Baseball")}function wl(t,a,o){return ye("Golf"),Yn(h=>{const f={...h};return jc(f,t,a,o),f}),!0}function yl(){Yn(Bi()),He("Golf")}function Sl(t,a,o,h){return ye("Tic Tac Toe"),Jn(f=>{const R={...f,board:[...f.board]};return wc(R,t,a,o,h),R}),!0}function Cl(){Jn(Oi()),He("Tic Tac Toe")}function kl(t,a,o){return ye("American Cricket"),Qn(h=>{const f={...h,marks:{...h.marks}};return Ec(f,t,a,o,()=>!1),f}),!0}function oi(){Qn($i()),He("American Cricket")}function ma(t,a,o){ye("Around the Clock");const h=Ys[ls];let f=!1;if(typeof o=="number"&&o===h&&(a==="SINGLE"||a==="DOUBLE"||a==="TRIPLE")&&(f=!0),h===25&&(a==="BULL"||t===25)&&(f=!0),h===50&&(a==="INNER_BULL"||t===50)&&(f=!0),f||(t===h||t===h*2||t===h*3)&&(f=!0),f){const R=qt+1;return ss(R),ps(E=>E+1),!0}return!0}function di(){ma(Math.max(0,te|0)),X(0)}function ui(){const t=Un(yt);if(t==null){alert("Enter like T20, D5, 25, 50");return}ma(t),vt("")}function ha(t,a,o){return ye("Cricket"),Ps(h=>{const f={...h,marks:{...h.marks}};return lc(f,t,a,o,()=>!1),f}),Qe(h=>{const f=h+1;return f>=3?0:f}),!0}function mi(){ha(Math.max(0,te|0)),X(0)}function xa(t,a,o){return ye("Shanghai"),un(h=>{const f={...h,turnHits:{...h.turnHits}};return dc(f,t,a,o),f}),Qe(h=>{const f=h+1;return f>=3?(un(R=>{const E={...R,turnHits:{...R.turnHits}};return uc(E),E}),0):f}),!0}function hi(){xa(Math.max(0,te|0)),X(0)}function xi(t,a,o){return ye("Halve It"),mn(h=>{const f={...h,targets:[...h.targets]};return mc(f,t,a,o),f}),Qe(h=>{const f=h+1;return f>=3?(mn(R=>{const E={...R,targets:[...R.targets]};return hc(E),E}),0):f}),!0}function fi(){xi(Math.max(0,te|0)),X(0)}function bi(t,a,o){return ye("High-Low"),Us(h=>{const f={...h};return xc(f,t,a,o),f}),Qe(h=>{const f=h+1;return f>=3?(Us(R=>{const E={...R};return fc(E),E}),0):f}),!0}function pi(){bi(Math.max(0,te|0)),X(0)}function gi(){const t=yt.trim().toUpperCase();if(!t)return null;if(t==="50"||t==="BULL"||t==="DBULL"||t==="IBULL")return 50;if(t==="25"||t==="OBULL")return 25;const a=t.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!a)return null;const o=a[1]||"S",h=parseInt(a[2],10);return h<1||h>20?null:h*(o==="S"?1:o==="D"?2:3)}function cr(){const t=gi();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}lr(t),vt("")}function vi(){const t=ea.trim().split(`
`).map(a=>a.trim()).filter(a=>a);if(t.length!==0){for(const a of t){const o=Un(a);if(o==null){alert(`Invalid score: ${a}`);return}lr(o)}rr("")}}function fa(){Ze!==0&&(ve(t=>t+Zt),ft(t=>Math.max(0,t-1)))}function Or(){const t=gi();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}if(Ze===0){cr();return}const a=Zt;ve(o=>o+a),ft(o=>Math.max(0,o-1)),setTimeout(()=>lr(t),0),vt("")}function Dl(){const t=b??"player",a=t==="player"?Pt||void 0:xe||void 0,o=1,h=t==="player"?It:Ts;kt([...Y,{winner:t,doubleDarts:D,checkoutDarts:I,winnerDarts:h,doublesAtt:a,doublesHit:o}]),ge(!1);let f=Oe,R=ze;if(b==="player"?f+=1:b==="ai"&&(R+=1),K(f),Nt(R),y(null),f>=Ut||R>=Ut){try{Hl(g,t==="player")}catch{}cn(!1),Xe(!1),ve(F),is(F),Zr(!0);return}pl()}const ba=!Si.includes(g)&&!(s?.fullAccess||s?.admin);return e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[ht&&e.jsx(Kl,{players:nt.players||[],onDone:()=>Ye(!1)}),e.jsxs("h2",{className:"text-3xl font-bold text-brand-700 mb-4",children:["Offline Mode"," ",i==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"ndn-shell-body",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsxs("select",{onPointerDown:t=>{t.stopPropagation()},onMouseDown:t=>{t.stopPropagation()},onTouchStart:t=>{t.stopPropagation?.()},className:"input w-full",value:g,onChange:t=>St(t.target.value),children:[Si.map(t=>e.jsx("option",{value:t,children:t},t)),Fl.map(t=>e.jsxs("option",{value:t,disabled:!(s?.fullAccess||s?.admin),children:[t," ",s?.fullAccess||s?.admin?"":"(Premium)"]},t))]}),e.jsx(_l,{gameMode:g,compact:!0}),g==="Treble Practice"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"font-semibold",children:"Throws per game"}),e.jsx("input",{className:"input w-full",type:"number",min:3,step:3,value:Ss,onChange:t=>gr(Math.max(3,Math.floor(Number(t.target.value)||30)))})]}),e.jsx("div",{className:"sm:col-span-2 text-xs text-slate-300",children:"Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws."})]}),!s?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),g==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:F,onChange:t=>Ct(Number(t.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{onPointerDown:t=>{t.stopPropagation()},onMouseDown:t=>{t.stopPropagation()},onTouchStart:t=>{t.stopPropagation?.()},className:"input w-full",value:re,onChange:t=>Z(t.target.value),children:[e.jsx("option",{value:"None",children:"None"}),Uc.map(t=>e.jsx("option",{value:t,children:t},t))]}),re!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:we/1e3,onChange:t=>ae(Math.round(Number(t.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>mt(!0),children:"X01 Rules & Regulations!"})]}),g==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply."})]}),!jt&&e.jsx("button",{className:"btn",disabled:ba,title:ba?"PREMIUM required for this mode":"",onClick:Bn,children:"Start Match"}),ue&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${bs?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(Vn,{storageKey:"ndn:modal:offline-match",className:`${bs?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:bs,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:"scroll"},ref:t=>{An.current=t},children:[e.jsx("div",{ref:t=>{aa.current=t},children:e.jsx(Ac,{left:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[g,g==="X01"?` / ${F}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",Ut," Â· Legs ",Oe,"-",ze]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${i==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:i==="modern"?"Modern layout":"Classic layout"})]}),right:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>Q(Math.max(.5,Math.round((W-.05)*100)/100)),title:"Decrease camera size",children:"âˆ’"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(W*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>Q(Math.min(1.25,Math.round((W+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:Ft?"Actual Size":"Fit All",onClick:()=>Qs(t=>!t),children:Ft?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:bs?"Restore":"Maximize",onClick:()=>Js(t=>!t),children:bs?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Bn()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{cn(!1),Xe(!1)},children:"Quit"})]})})}),e.jsxs("div",{ref:t=>{In.current=t},className:"will-change-transform",style:Ft?{transform:`scale(${Gt})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,Gt))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:g==="X01"?"X01 Match":g}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",g]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",F]}),e.jsxs("div",{ref:bl,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const t=ee!==F||be!==F||Ze>0,a=`px-2 py-0.5 rounded border text-xs ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${a} ${Pn==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||ia("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${a} ${Pn==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||ia("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${t?"opacity-50":""}`,type:"number",min:1,step:1,value:Er,onChange:o=>Ja(Math.max(1,Math.floor(Number(o.target.value)||1))),disabled:t,title:Pn==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",Oe,"â€“",ze]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Match"}),e.jsxs("select",{className:`btn ${qs}`,value:ne,onChange:t=>Ae(t.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${qs} w-[7.5rem]`,value:Ne,onChange:t=>We(t.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${qs} w-[7.5rem]`,value:Ge,onChange:t=>qe(t.target.value),placeholder:"Team B"})]})]}),g!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[g==="Double Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:$r[Zs]?.label||"â€”"})]})}),g==="Around the Clock"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Ys[ls]===25?"25 (Outer Bull)":Ys[ls]===50?"50 (Inner Bull)":Ys[ls]||"â€”"})]})}),g==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket â€” Close 20â€“15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:Ea.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,Mt.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points:"," ",e.jsx("span",{className:"font-semibold",children:Mt.points})]}),cc(Mt)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Ps(ga()),Qe(0),He("Cricket")},children:"Reset"})]})]}),g==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Bs.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Bs.score]}),Bs.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{un(va()),Qe(0),He("Shanghai")},children:"Reset"})]})]}),g==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[Os.stage+1,"/",Os.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target:"," ",e.jsx("span",{className:"font-semibold",children:(()=>{const t=Wi(Os);return t?t.kind==="ANY_NUMBER"?"Any":t.kind==="BULL"?"Bull":t.kind==="DOUBLE"||t.kind==="TRIPLE"||t.kind==="NUMBER"?`${t.kind} ${t.num}`:"â€”":"â€”"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Os.score]}),Os.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{mn(ja()),Qe(0),He("Halve It")},children:"Reset"})]})]}),g==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",gs.round," Â· Target ",gs.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",gs.score]}),gs.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Us(Na()),Qe(0),He("High-Low")},children:"Reset"})]})]}),g==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",en]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Wr]}),tn&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:ri,children:"Reset"})]})]}),g==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",_n,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",ur]})]}),g==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Kn,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",bn]})]}),g==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Ue,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Et]})]}),g==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:At}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",Jt," Â· Successes:"," ",sn]})]}),g==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:jn}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",ws," Â· Successes:"," ",Vt]})]}),g==="Treble Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",$t]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",Sn]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("div",{className:"inline-flex items-center gap-1",children:[20,19,18].map(t=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${$t===t?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>rs(t),children:["T",t]},`tpick-header-${t}`))}),e.jsx("span",{className:"opacity-60 text-xs",children:"or"}),e.jsx("select",{className:"input w-24",value:$t,onChange:t=>rs(parseInt(t.target.value,10)),children:Array.from({length:20},(t,a)=>a+1).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ci,children:"Reset"})]})]})}),g==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Xn.inning}),e.jsxs("div",{className:"text-sm",children:["Score:"," ",e.jsx("span",{className:"font-semibold",children:Xn.score})]})]}),g==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:nn.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes:"," ",e.jsx("span",{className:"font-semibold",children:nn.strokes})]})]}),g==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ks.turn}),ks.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",ks.winner||"â€”"]})]}),g==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Target"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:wa[v.targetIndex]}),e.jsxs("div",{className:"text-sm",children:["Progress:"," ",e.jsxs("span",{className:"font-semibold",children:[v.targetIndex+1,"/",wa.length]})]}),v.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["ðŸŽ‰ Finished in ",v.darts," darts!"]})]}),g==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Fe.score,"/",Fe.target]}),e.jsxs("div",{className:"text-sm",children:["Darts:"," ",e.jsx("span",{className:"font-semibold",children:Fe.darts})]}),Fe.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",Fe.target,"!"]})]}),g==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Me.score,"/",Me.target]}),e.jsxs("div",{className:"text-sm",children:["Darts:"," ",e.jsx("span",{className:"font-semibold",children:Me.darts})]}),Me.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",Me.target,"!"]})]}),g==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20â€“12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:Ra.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,$s.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points:"," ",e.jsx("span",{className:"font-semibold",children:$s.points})]}),Rc($s)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:oi,children:"Reset"})]})]}),g==="Killer"&&e.jsx(e.Fragment,{children:vr?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Ie[Dt]?.name||"â€”"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:c?`${Ie.find(t=>t.id===c)?.name||"Winner"} Wins`:B||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):i==="modern"?e.jsx("div",{className:"space-y-3 mb-2",children:Be?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${qs}`,onClick:()=>Q(Math.max(.5,Math.round((W-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${qs} min-w-[2.5rem] text-center`,children:[Math.round(W*100),"%"]}),e.jsx("button",{className:`btn ${qs}`,onClick:()=>Q(Math.min(1.25,Math.round((W+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${qs}`,title:"Toggle fit/fill",onClick:()=>J(w==="fill"?"fit":"fill"),children:w==="fill"?"Fill":"Fit"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${qs}`,title:"Toggle camera aspect",onClick:()=>S(q==="square"?"wide":"square"),children:q==="square"?"Square":"Wide"})]})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6",children:[e.jsx("div",{className:"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]",children:e.jsx(Se,{scoringMode:"x01",showToolbar:T,immediateAutoCommit:!0,cameraAutoCommit:"camera",onAutoDart:(t,a,o)=>{}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Current Shooter"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-white",children:dl}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Remaining"}),e.jsx("div",{className:"font-mono text-lg text-white",children:ul})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Last Dart"}),e.jsx("div",{className:"font-mono text-lg text-white",children:ml||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Match Legs"}),e.jsxs("div",{className:"font-semibold text-white",children:[Oe,"-",ze]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Next Up"}),e.jsx("div",{className:"font-medium text-white",children:ol})]})]})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(xs,{gameMode:g,players:Ga,matchScore:`${Oe}-${ze}`})})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(xs,{gameMode:g,players:Ga,matchScore:`${Oe}-${ze}`})}),g==="X01"&&e.jsxs("div",{className:"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Manual Scoreboard Override"}),e.jsxs("p",{className:"mt-1 text-xs text-white/40",children:["Adjust the live totals if a dart was misread. Values are clamped between 0 and"," ",F,"."]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:Gs}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Commit Visit"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx(Wl,{inProgress:!0,startingScore:F,onAddVisit:Kt(Tt),quickButtons:[180,140,100,60],onNextPlayer:()=>Wt?.nextPlayer(),onEndLeg:()=>{},onUndo:()=>{},showDartsSelect:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:_a,onChange:t=>ta(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Mr("player")},placeholder:`${Oe}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Mr("player"),children:"Set"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:Rn}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Three Dart Edit"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:F,value:$a,onChange:t=>Ha(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Xa()},placeholder:`${be}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Xa(),children:"Set"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:Wa,onChange:t=>sa(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Mr("ai")},placeholder:`${ze}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Mr("ai"),children:"Set"})]})]})]})]})]})]})]})})]})}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),Le?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ee}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-ee/F)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart:"," ",e.jsx("span",{className:"font-semibold",children:Zt})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score:"," ",e.jsx("span",{className:"font-semibold",children:Ze>0?Ve:os??Zt})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg:"," ",e.jsx("span",{className:"font-semibold",children:tr>0?(qr/tr*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",It]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(t=>e.jsx("span",{className:`w-2 h-2 rounded-full ${t<Ze?"bg-emerald-400":"bg-white/20"}`},t))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles:"," ",e.jsxs("span",{className:"font-semibold",children:["Att ",ke," Â· Hit ",dt]})]}),ee<=170&&ee>0&&(()=>{const a=Xl(ee,d)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:a})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall",children:e.jsx(Sa,{storageKey:"ndn:camera:tile:offline:center:v4",className:"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card",defaultWidth:0,defaultHeight:0,minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:1200,autoFill:!0,children:e.jsx(ki,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic",fill:!0})})}),e.jsxs("div",{className:`mt-2 ${me==="small"?"p-2":me==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${fe==="small"?"text-xs":fe==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const t=Le?s?.username||"You":re==="None"?"â€”":`${re} AI`,a=Le?ee:re==="None"?0:be,o=Le?Ze>0?Ve:os??Zt:Ks>0?us:Ms??Ws,h=Le?It:Ts,f=F-(Le?ee:re==="None"?F:be),R=h>0?f/h*3:0,E=`${Oe}-${ze}`,_=Y.length>0?`${Math.min(...Y.map(k=>k.doubleDarts+(k.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:E}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:t}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:a}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:R.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:o}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:_})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[re==="None"?"Opponent":`${re} AI`," Remain"]}),Le?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:re!=="None"?be:"N/A"}),re!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-be/F)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart:"," ",e.jsx("span",{className:"font-semibold",children:re==="None"?0:Ws})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score:"," ",e.jsx("span",{className:"font-semibold",children:re==="None"?"â€”":Ks>0?us:Ms??Ws})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg:"," ",e.jsx("span",{className:"font-semibold",children:re!=="None"?sr>0?(Xr/sr*3).toFixed(1):"0.0":"â€”"})]}),re!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",Ts]}),re!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles:"," ",e.jsxs("span",{className:"font-semibold",children:["Att ",Rs," Â· Hit ",er]})]})]})]})}),g!=="X01"?e.jsxs("div",{className:"space-y-2",children:[g==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:$r[Zs]?.label||"â€”"})]}),C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,onAutoDart:(t,a)=>{if((a==="DOUBLE"||a==="INNER_BULL")&&Ri(t,Zs)){const h=Je+1,f=Zs+1;return dn(h),$n(f),h>=$r.length&&setTimeout(()=>{dn(0),$n(0)},250),!0}return!1},immediateAutoCommit:!0,onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&ei()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ei,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:yt,onChange:t=>vt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ti()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ti,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",Je," of 21"]})]}),g==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Ys[ls]===25?"25 (Outer Bull)":Ys[ls]===50?"50 (Inner Bull)":Ys[ls]||"â€”"})]}),C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>ma(t,a==="MISS"?void 0:a,o?.sector??null),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&di()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:di,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:yt,onChange:t=>vt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ui()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ui,children:"Add"})]}),qt>=Ys.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ss(0),ps(0),He("Around the Clock")},children:"Reset"})]})]}),g==="Cricket"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>ha(t,a==="MISS"?void 0:a,o?.sector??null),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&mi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:mi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ps(ga()),Qe(0),He("Cricket")},children:"Reset"})]})]}),g==="Shanghai"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>xa(t,a==="MISS"?void 0:a,o?.sector??null),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&hi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:hi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{un(va()),Qe(0),He("Shanghai")},children:"Reset"})]})]}),g==="Halve It"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>xi(t,a==="MISS"?void 0:a,o?.sector??null),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&fi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:fi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{mn(ja()),Qe(0),He("Halve It")},children:"Reset"})]})]}),g==="High-Low"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>bi(t,a==="MISS"?void 0:a,o?.sector??null),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&pi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:pi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Us(Na()),Qe(0),He("High-Low")},children:"Reset"})]})]}),g==="Bob's 27"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>si(t,a==="MISS"?void 0:a,o?.sector??null),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&ni()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ni,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:ri,children:"Reset"})]})]}),g==="Count-Up"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>ca(t),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ca(te),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ca(te),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{xn(1),Wn(0),mr(0),He("Count-Up")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",_n,"/",ns]})]}),g==="High Score"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>oa(t),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(oa(te),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{oa(te),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{fn(1),hr(0),xr(0),He("High Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Kn,"/",Xt]})]}),g==="Low Score"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:t=>da(t),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(da(te),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{da(te),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{fr(1),Rt(0),Gn(0),He("Low Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Ue,"/",pn]})]}),g==="Checkout 170"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a)=>ii(t,a==="MISS"?void 0:a),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:yt,onChange:t=>vt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Br(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Br(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:gl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",At," Â· Attempts: ",Jt," Â· Successes: ",sn]})]}),g==="Checkout 121"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a)=>li(t,a==="MISS"?void 0:a),onAddVisit:Kt(Tt),onEndLeg:t=>Wt.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:yt,onChange:t=>vt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Br(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Br(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:vl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",jn," Â· Attempts: ",ws," Â· Successes: ",Vt]})]}),g==="Treble Practice"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>ua(t,a==="MISS"?void 0:a,o?.sector??null)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:yt,onChange:t=>vt(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const a=Un(yt);a!=null&&ua(a,void 0,void 0),vt("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const t=Un(yt);t!=null&&ua(t,void 0,void 0),vt("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",Sn," Â· Misses:"," ",Math.max(0,wt-Sn)," Â· Darts:"," ",wt,Ss>0?`/${Ss}`:""]}),qn&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:ci,children:"Reset"})]})]}),g==="Baseball"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>jl(t,a==="MISS"?void 0:a,o?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Nl,children:"Reset"})})]}),g==="Golf"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>wl(t,a==="MISS"?void 0:a,o?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:yl,children:"Reset"})})]}),g==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(t,a)=>a).map(t=>e.jsx("button",{className:`h-16 rounded-xl border ${ks.board[t]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(ks.finished||ks.board[t])return;const a=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),o=a%3===0?"TRIPLE":a%2===0?"DOUBLE":"SINGLE",h=t,f=Ki[h],R=f.type==="BULL"?null:f.num||null;Sl(h,a,o,R)},children:ks.board[t]||""},t))}),C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Cl,children:"Reset"})})]}),g==="American Cricket"&&e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>kl(t,a==="MISS"?void 0:a,o?.sector??null)})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:oi,children:"Reset"})})]}),g==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:wa[P.targetIndex]})]}),C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>{const h=a==="MISS"?void 0:a;return ye("Scam"),se(ka(P,t,h)),!0}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:1,max:25,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ye("Scam"),se(Ui(P,te)),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ye("Scam"),se(Ui(P,te)),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{se(Sc()),He("Scam")},children:"Reset"})]}),P.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["ðŸŽ‰ Finished in ",P.darts," darts!"]})]}),g==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[oe.score,"/",oe.target]})]}),C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>(ye("Fives"),Ht(Ta(oe,t)),!0)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:5,max:50,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ye("Fives"),Ht(Fi(oe,te)),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ye("Fives"),Ht(Fi(oe,te)),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ht(Dc(oe.target)),He("Fives")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:"," ",oe.darts]}),oe.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",oe.target," in"," ",oe.darts," darts!"]})]}),g==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[it.score,"/",it.target]})]}),C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>(ye("Sevens"),gt(Ma(it,t)),!0)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:7,max:21,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ye("Sevens"),gt(Vi(it,te)),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ye("Sevens"),gt(Vi(it,te)),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{gt(Mc(it.target)),He("Sevens")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 7, 14, 21 Â· Darts:"," ",it.darts]}),it.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",it.target," in"," ",it.darts," darts!"]})]}),g==="Killer"&&e.jsx(e.Fragment,{children:vr?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Ie.map(t=>{const a=xt[t.id],o=Ds[t.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${a?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${a?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:a?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number:"," ",e.jsx("span",{className:"font-semibold",children:o})]}),e.jsxs("div",{className:"text-sm",children:["Lives:"," ",e.jsx("span",{className:"font-semibold",children:a?.lives??0})]})]},t.id)})}),C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>{if(c)return!1;const h=a==="MISS"?void 0:a,f=o?.sector??null,R=Ie[Dt];return R?(Hs(E=>{const _={};Object.keys(E).forEach(j=>_[j]={...E[j]});const k=Ai(R.id,_,h,f);if(k.becameKiller)M(`${R.name} became a Killer`);else if(k.victimId){const j=Ie.find(U=>U.id===k.victimId);M(`${R.name} hit ${j?.name}'s ${Ds[k.victimId]} (${k.livesRemoved} life${(k.livesRemoved||0)>1?"s":""})`)}else M("No effect");const A=Ii(_);return A&&x(A),_}),r(E=>{const _=E+1;if(_>=3){let k=Dt;for(let A=1;A<=Ie.length;A++){const j=(Dt+A)%Ie.length,U=Ie[j].id,Lt=xt[U];if(Lt&&!Lt.eliminated&&Lt.lives>0){k=j;break}}return _s(k),0}return _}),!0):!1}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:yt,onChange:t=>vt(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){if(c)return;const o=yt.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!o){vt("");return}const h=o[1]||"S",f=parseInt(o[2],10),R=h==="D"?"DOUBLE":h==="T"?"TRIPLE":"SINGLE",E=Ie[Dt];Hs(_=>{const k={};Object.keys(_).forEach(U=>k[U]={..._[U]});const A=Ai(E.id,k,R,f);if(A.becameKiller)M(`${E.name} became a Killer`);else if(A.victimId){const U=Ie.find(Lt=>Lt.id===A.victimId);M(`${E.name} hit ${U?.name}'s ${Ds[A.victimId]} (${A.livesRemoved} life${(A.livesRemoved||0)>1?"s":""})`)}else M("No effect");const j=Ii(k);return j&&x(j),k}),vt(""),r(_=>{const k=_+1;if(k>=3){let A=Dt;for(let j=1;j<=Ie.length;j++){const U=(Dt+j)%Ie.length,Lt=Ie[U].id,hs=xt[Lt];if(hs&&!hs.eliminated&&hs.lives>0){A=U;break}}return _s(A),0}return k})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let t=Dt;for(let a=1;a<=Ie.length;a++){const o=(Dt+a)%Ie.length,h=Ie[o].id,f=xt[h];if(f&&!f.eliminated&&f.lives>0){t=o;break}}_s(t),r(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Hs({}),Dn({}),Zn(!1),_s(0),r(0),x(null),M("")},children:"Reset"})]}),c&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner:"," ",Ie.find(t=>t.id===c)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Hs({}),Dn({}),Zn(!1),_s(0),r(0),x(null),M("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:Ie.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:t.name,onChange:o=>{const h=o.target.value;kn(f=>f.map((R,E)=>E===a?{...R,name:h}:R))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>kn(o=>o.filter((h,f)=>f!==a)),disabled:Ie.length<=2,children:"Remove"})]},t.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>kn(t=>{const a=`p${t.length+1}`;return[...t,{id:a,name:`Player ${t.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(Ie.length<2){alert("Need at least 2 players");return}const t=Ie.map(h=>h.id),a=pc(t),o={};t.forEach(h=>{o[h]=bc(a[h])}),Dn(a),Hs(o),_s(0),r(0),x(null),M("Assigned numbers"),Zn(!0)},children:"Assign Numbers & Start"})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-3 min-h-0 flex-1 text-[14px]",children:[e.jsxs("div",{className:"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm",children:[e.jsx("div",{className:"text-sm font-semibold opacity-80",children:"Scoreboard"}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(xs,{gameMode:g,players:Tr,matchScore:`${Oe}-${ze}`})}),Le&&e.jsxs("div",{className:"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h4",{className:"text-sm font-semibold tracking-wide uppercase text-indigo-200",children:"Manual Scoring"}),e.jsx("span",{className:"text-xs text-white/60",children:"Override a visit or enter dart-by-dart scores."})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Single Dart"}),e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:60,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?fa():Rr())},placeholder:"60"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Rr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Three Dart Edit"}),e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:ee<=170?170:180,value:Ar,onChange:t=>Qa(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Pr()},placeholder:"100"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Pr,children:"Commit Visit"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:fa,children:"Undo Visit"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Manual"}),e.jsx("input",{className:"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",value:yt,onChange:t=>vt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Or():cr())},placeholder:"T20"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:cr,children:"Apply"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Or,disabled:Ze===0,children:"Replace Last"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Multi-entry (one per line)"}),e.jsx("textarea",{className:"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30",rows:3,value:ea,onChange:t=>rr(t.target.value),placeholder:`T20
D16
25`}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:vi,children:"Apply All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>rr(""),children:"Clear"})]})]}),e.jsx("div",{className:"pt-2 border-t border-white/10 mt-3",children:e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:la,disabled:Ze===0&&Ve===0,children:"Clear Current Visit"})})]})]})]}),C&&e.jsx("div",{className:"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a)=>{const o=a??"MISS",h=Number.isFinite(t)?Math.max(0,t):0,f=Date.now();if(h<=0){if(o!=="MISS"||f-(et.current||0)<1200)return;et.current=f}else et.current=0;lr(h)}})})]}),g==="X01"&&!C&&e.jsx(e.Fragment,{children:e.jsx(xs,{gameMode:g,players:Tr,matchScore:`${Oe}-${ze}`})}),g==="Cricket"&&e.jsx(e.Fragment,{children:e.jsx(xs,{gameMode:"Cricket",players:nl})}),g==="Cricket"&&C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>{if(t>0)return ha(t,a==="MISS"?void 0:a,o?.sector??null),!0}})}),g==="Shanghai"&&e.jsx(e.Fragment,{children:e.jsx(xs,{gameMode:"Shanghai",players:rl})}),g==="Shanghai"&&C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>{if(t>0)return xa(t,a==="MISS"?void 0:a,o?.sector??null),!0}})}),g==="Killer"&&e.jsx(e.Fragment,{children:e.jsx(xs,{gameMode:"Killer",players:al})}),g==="Scam"&&e.jsx(e.Fragment,{children:e.jsx(xs,{gameMode:"Scam",players:il})}),g==="Scam"&&C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>{if(t>0)return se(ka(P,t,a)),!0}})}),g==="Fives"&&e.jsx(e.Fragment,{children:e.jsx(xs,{gameMode:"Fives",players:ll})}),g==="Fives"&&C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>{if(t>0)return Ht(Ta(oe,t)),!0}})}),g==="Sevens"&&e.jsx(e.Fragment,{children:e.jsx(xs,{gameMode:"Sevens",players:cl})}),g==="Sevens"&&C&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Se,{scoringMode:"custom",showToolbar:T,immediateAutoCommit:!0,onAutoDart:(t,a,o)=>{if(t>0)return gt(Ma(it,t)),!0}})}),e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:te,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?fa():Rr())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Rr,title:"Add a single dart (0â€“60)",children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,max:ee<=170?170:180,placeholder:"Visit total (0â€“180)",value:Ar,onChange:t=>Qa(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Pr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Pr,title:"Commit a full 3-dart total like 93",children:"Commit Visit"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:yt,onChange:t=>vt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Or():cr())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Or,disabled:Ze===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:cr,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:ea,onChange:t=>rr(t.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:vi,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>rr(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add Â· Shift+Enter to Replace Last"})]}),e.jsx("div",{className:"h-1"})]})]})})}),Ke&&e.jsx($c,{onClose:()=>mt(!1)}),ba&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const a=await(await fetch(`${Hc}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s?.email})})).json();a.ok&&a.url?(window.location.href=a.url,a.development&&Te("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):a.error==="STRIPE_NOT_CONFIGURED"?Te("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):Te("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{Te("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â·"," ",Vl($l(),5)]})]})]}),el&&typeof document<"u"?yi.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4",onClick:()=>Mn(!1),children:e.jsx(Vn,{storageKey:"ndn:modal:offline-camera-manager",className:"relative",defaultWidth:640,defaultHeight:520,minWidth:480,minHeight:420,maxWidth:1200,maxHeight:900,initialFitHeight:!0,onClose:()=>Mn(!1),children:e.jsxs("div",{className:"space-y-3",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Camera Devices"}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Manage Offline Camera Feeds"})]}),e.jsx("button",{className:"btn bg-slate-800 hover:bg-slate-700 text-white",onClick:()=>Mn(!1),children:"Close"})]}),e.jsx(ki,{fill:!0,user:s,playerScore:ee,aiScore:be,x01Score:F,inMatch:jt,showWinPopup:he,pendingLegWinner:b,playerDartsThrown:It,aiDartsThrown:Ts,totalPlayerDarts:tr,totalAiDarts:sr,totalPlayerPoints:qr,totalAiPoints:Xr,player180s:Ua,player140s:Gi,player100s:qi,ai180s:Fa,ai140s:Xi,ai100s:Yi,playerHighestCheckout:Ji,aiHighestCheckout:Qi,onClose:()=>Mn(!1),onOpen:()=>Mn(!0),layout:i})]})})}),document.body):null,Cr&&typeof document<"u"?yi.createPortal((()=>{const{target:t,value:a,stage:o}=Cr,h=t==="player"?Gs:Rn,f=t==="player"?Oe:ze;return e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4",onClick:ir,children:e.jsx(Vn,{storageKey:"ndn:modal:offline-leg-override",className:"relative",defaultWidth:360,defaultHeight:240,minWidth:280,minHeight:200,maxWidth:420,maxHeight:360,initialFitHeight:!0,onClose:ir,children:e.jsxs("div",{className:"space-y-3 max-w-[18rem] mx-auto",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide text-white/50",children:["Step ",o," of 2"]}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Override legs?"})]}),e.jsx("div",{className:"text-sm text-slate-200 leading-relaxed",children:o===1?e.jsxs(e.Fragment,{children:["Set ",h,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:a}),"? Confirm to continue."]}):e.jsxs(e.Fragment,{children:["Final confirmation: set ",h,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:a}),". Select"," ",e.jsx("span",{className:"font-semibold text-emerald-200",children:"Yes"})," ","to apply immediately."]})}),e.jsxs("div",{className:"rounded-xl bg-black/40 border border-white/10 p-3 text-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50 mb-1",children:"Current legs"}),e.jsx("div",{className:"text-base font-semibold text-white",children:f})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:ir,children:"No"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:fl,children:"Yes"})]})]})})})})(),document.body):null,he&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(Vn,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${D===t?"bg-brand-600":""}`,onClick:()=>$(t),children:t},t))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${I===t?"bg-brand-600":""}`,onClick:()=>je(t),children:t},t))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:Dl,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{ge(!1),Bn()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{ge(!1),cn(!1),Xe(!1)},children:"Back to Menu"})]})]})}),Zi&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(Vn,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[g," Â· ",F," start Â· First to ",Ut]}),(()=>{const t=tr>0?qr/tr*3:0,a=t*3,o=(()=>{const j=Y.filter(U=>U.winner==="player"&&typeof U.winnerDarts=="number").map(U=>U.winnerDarts);return j.length?`${Math.min(...j)} darts`:"â€”"})(),h=(()=>{const j=Y.filter(U=>U.winner==="player"&&typeof U.winnerDarts=="number").map(U=>U.winnerDarts);return j.length?`${Math.max(...j)} darts`:"â€”"})(),f=ke>0?Math.round(dt/ke*100):0,R=sr>0?Xr/sr*3:0,E=R*3,_=(()=>{const j=Y.filter(U=>U.winner==="ai"&&typeof U.winnerDarts=="number").map(U=>U.winnerDarts);return j.length?`${Math.min(...j)} darts`:"â€”"})(),k=(()=>{const j=Y.filter(U=>U.winner==="ai"&&typeof U.winnerDarts=="number").map(U=>U.winnerDarts);return j.length?`${Math.max(...j)} darts`:"â€”"})(),A=Rs>0?Math.round(er/Rs*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:s?.username||"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:Oe}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:t.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:a.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:ke})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[f,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:o})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:h})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Ua})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[Oe," â€“ ",ze]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:re==="None"?"Opponent":`${re} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:ze}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:R.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:E.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:Rs})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[A,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:_})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:k})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Fa})]})]})]})]})})(),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map((t,a)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${t.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",a+1,":"," ",t.winner==="player"?"You":re==="None"?"Opp":"AI"," ","Â· Dbl ",t.doubleDarts," Â· CO ",t.checkoutDarts]},a))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(ic,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>Zr(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{Zr(!1),Bn()},children:"Rematch"})]})]})}),Y.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:Y.map((t,a)=>e.jsxs("li",{children:["Leg ",a+1,": Double darts: ",t.doubleDarts,", Checkout darts:"," ",t.checkoutDarts]},a))})]})]})]})}export{Zc as default};
//# sourceMappingURL=OfflinePlay-Cp2sMEjm.js.map

{"version":3,"file":"OpsDashboard-BnSSltru.js","sources":["../../src/components/OpsDashboard.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { useIsAdmin } from \"../utils/admin\";\r\nimport { apiFetch } from \"../utils/api\";\r\n\r\ntype Ready = {\r\n  ok: boolean;\r\n  ws?: boolean;\r\n  rooms?: number;\r\n  clients?: number;\r\n  mem?: { rss: number; heapUsed: number };\r\n};\r\n\r\nexport default function OpsDashboard({ user }: { user: any }) {\r\n  const isAdmin = useIsAdmin(user?.email);\r\n  const [ready, setReady] = useState<Ready | null>(null);\r\n  const [ann, setAnn] = useState<string>(\"\");\r\n  const [msg, setMsg] = useState<string>(\"\");\r\n\r\n  async function refresh() {\r\n    try {\r\n      const res = await apiFetch(\"/readyz\");\r\n      setReady(await res.json());\r\n    } catch {}\r\n  }\r\n  useEffect(() => {\r\n    refresh();\r\n    const id = setInterval(refresh, 5000);\r\n    return () => clearInterval(id);\r\n  }, []);\r\n\r\n  if (!isAdmin)\r\n    return (\r\n      <div className=\"card\">\r\n        <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\r\n        <div>Restricted</div>\r\n      </div>\r\n    );\r\n\r\n  async function toggleMaintenance(enabled: boolean) {\r\n    setMsg(\"\");\r\n    try {\r\n      const res = await apiFetch(\"/api/admin/maintenance\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ enabled, requesterEmail: user?.email }),\r\n      });\r\n      const j = await res.json();\r\n      if (!res.ok || !j?.ok) setMsg(j?.error || \"Failed\");\r\n      else setMsg(`Maintenance ${enabled ? \"enabled\" : \"disabled\"}`);\r\n    } catch {\r\n      setMsg(\"Network error\");\r\n    }\r\n  }\r\n\r\n  async function announce() {\r\n    setMsg(\"\");\r\n    const text = ann.trim();\r\n    if (!text) return;\r\n    try {\r\n      const res = await apiFetch(\"/api/admin/announce\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ message: text, requesterEmail: user?.email }),\r\n      });\r\n      const j = await res.json();\r\n      if (!res.ok || !j?.ok) setMsg(j?.error || \"Failed\");\r\n      else setMsg(\"Announcement broadcasted\");\r\n      setAnn(\"\");\r\n    } catch {\r\n      setMsg(\"Network error\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Readiness</div>\r\n          <div className=\"text-sm\">\r\n            HTTP:{\" \"}\r\n            <span\r\n              className={`font-semibold ${ready?.ok ? \"text-emerald-300\" : \"text-rose-300\"}`}\r\n            >\r\n              {String(!!ready?.ok)}\r\n            </span>\r\n          </div>\r\n          <div className=\"text-sm\">\r\n            WS:{\" \"}\r\n            <span\r\n              className={`font-semibold ${ready?.ws ? \"text-emerald-300\" : \"text-rose-300\"}`}\r\n            >\r\n              {String(!!ready?.ws)}\r\n            </span>\r\n          </div>\r\n          <div className=\"text-sm\">\r\n            Clients:{\" \"}\r\n            <span className=\"font-semibold\">{ready?.clients ?? 0}</span>\r\n          </div>\r\n          <div className=\"text-sm\">\r\n            Rooms: <span className=\"font-semibold\">{ready?.rooms ?? 0}</span>\r\n          </div>\r\n          <div className=\"text-sm\">\r\n            Heap Used:{\" \"}\r\n            <span className=\"font-semibold\">\r\n              {ready?.mem ? Math.round(ready.mem.heapUsed / 1024 / 1024) : 0} MB\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Maintenance</div>\r\n          <div className=\"flex gap-2\">\r\n            <button className=\"btn\" onClick={() => toggleMaintenance(true)}>\r\n              Enable\r\n            </button>\r\n            <button\r\n              className=\"btn bg-slate-700 hover:bg-slate-800\"\r\n              onClick={() => toggleMaintenance(false)}\r\n            >\r\n              Disable\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Announcement</div>\r\n          <div className=\"flex gap-2\">\r\n            <input\r\n              className=\"input flex-1\"\r\n              placeholder=\"Message to broadcast\"\r\n              value={ann}\r\n              onChange={(e) => setAnn(e.target.value)}\r\n            />\r\n            <button className=\"btn\" onClick={announce}>\r\n              Send\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {msg && <div className=\"text-xs mt-2\">{msg}</div>}\r\n      <div className=\"text-xs opacity-70 mt-2\">\r\n        âœ… Clustering enabled! For 1.5k+ concurrent users, deploy behind a\r\n        reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets.\r\n        Set NODE_WORKERS environment variable to control worker count.\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["OpsDashboard","user","isAdmin","useIsAdmin","ready","setReady","useState","ann","setAnn","msg","setMsg","refresh","res","apiFetch","useEffect","id","jsxs","jsx","toggleMaintenance","enabled","j","announce","text","e"],"mappings":"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"}
import{t as je,u as O,j as n,n as we,v as Re,l as Be,w as Ie,x as $e,y as Ae,z as Pe,G as Oe,m as De}from"./index-QB6Os3F3.js";import{r as h,m as xe,R as Te,n as Fe,o as He,Z as Me}from"./ui-CuWypN7C.js";async function We(){const e=[];try{const t=await _e();for(const r of t){const a=await Ge(r,[80,8080,8787,8788,3e3,5e3]);for(const s of a){const i=await qe(s.ip,s.port);i&&e.push(i)}}}catch(t){console.error("Network discovery failed:",t)}return e}async function _e(){const e=[];try{const t=new RTCPeerConnection({iceServers:[]});t.createDataChannel("");const r=await t.createOffer();return await t.setLocalDescription(r),new Promise(a=>{const s=setTimeout(()=>{t.close(),a(e)},5e3);t.onicecandidate=i=>{if(i.candidate){const l=i.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(l&&l[1]&&!e.includes(l[1])){const m=l[1];Ve(m)&&e.push(m)}}else clearTimeout(s),t.close(),a(e)}})}catch(t){return console.error("Failed to get local IPs:",t),["192.168.1.0"]}}function Ve(e){const t=e.split(".").map(Number);return t[0]===10||t[0]===172&&t[1]>=16&&t[1]<=31||t[0]===192&&t[1]===168}async function Ge(e,t){const r=[],a=e.split(".").slice(0,3).join("."),s=[];for(let o=1;o<=254;o++){const l=`${a}.${o}`;for(const m of t)s.push(Ke(l,m))}return(await Promise.allSettled(s)).forEach((o,l)=>{if(o.status==="fulfilled"&&o.value){const m=l%t.length,w=Math.floor(l/t.length),x=`${a}.${w+1}`;r.push({ip:x,port:t[m]})}}),r}async function Ke(e,t){try{const r=await fetch(`http://${e}:${t}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(2e3)});return!0}catch{return!1}}async function qe(e,t){try{const r=["/","/api/info","/api/status","/camera","/stream"];for(const a of r)try{const s=await fetch(`http://${e}:${t}${a}`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(s.ok){const i=s.headers.get("content-type")||"",o=await s.text();if(o.includes("OMNI")||o.includes("omni")||a.includes("omni"))return{id:`omni-${e}-${t}`,name:`OMNI Camera (${e})`,ip:e,port:t,type:"omni",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(o.includes("VERT")||o.includes("vert")||a.includes("vert"))return{id:`vert-${e}-${t}`,name:`VERT Camera (${e})`,ip:e,port:t,type:"vert",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(i.includes("video")||o.includes("stream")||a==="/stream")return{id:`generic-${e}-${t}`,name:`Network Camera (${e})`,ip:e,port:t,type:"generic",capabilities:["video"],status:"online",connectionType:"wifi"}}}catch{}}catch(r){console.error(`Failed to probe device ${e}:${t}:`,r)}return null}async function ze(){const e=[];try{if(!("serial"in navigator))return console.warn("Web Serial API not supported in this browser"),e;const t=await navigator.serial.getPorts();for(const r of t){const a=await Ne(r);a&&e.push(a)}}catch(t){console.error("USB device discovery failed:",t)}return e}async function Je(){try{if(!("serial"in navigator))return alert("Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge."),null;const e=await navigator.serial.requestPort();return await Ne(e)}catch(e){return e.name!=="NotFoundError"&&console.error("USB device request failed:",e),null}}async function Ne(e){try{await e.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none"});const t=e.readable?.getReader();if(t)try{const r=setTimeout(()=>t.cancel(),2e3),{value:a,done:s}=await t.read();if(clearTimeout(r),!s&&a){const i=new TextDecoder().decode(a);if(i.includes("OMNI")||i.includes("omni"))return t.releaseLock(),{id:`usb-omni-${Date.now()}`,name:"OMNI Camera (USB)",type:"omni",capabilities:["video","calibration"],status:"online",port:e};if(i.includes("VERT")||i.includes("vert"))return t.releaseLock(),{id:`usb-vert-${Date.now()}`,name:"VERT Camera (USB)",type:"vert",capabilities:["video","calibration"],status:"online",port:e}}}catch{}finally{try{t.releaseLock()}catch{}}return{id:`usb-generic-${Date.now()}`,name:"USB Scoring Device",type:"generic",capabilities:["video"],status:"online",port:e}}catch(t){return console.error("Failed to probe USB device:",t),null}}async function Xe(e){try{const t=`http://${e.ip}:${e.port}/stream`,r=document.createElement("video");return r.src=t,r.crossOrigin="anonymous",new Promise((a,s)=>{r.onloadeddata=()=>{const i=document.createElement("canvas"),o=i.getContext("2d");i.width=r.videoWidth,i.height=r.videoHeight;const l=i.captureStream(30),m=()=>{r.readyState>=2&&o.drawImage(r,0,0),requestAnimationFrame(m)};m(),a(l)},r.onerror=()=>s(new Error("Failed to load video stream")),r.load()})}catch(t){return console.error("Failed to connect to network device:",t),null}}async function Qe(e){try{if(!e.port)throw new Error("No serial port available");return console.log("USB device connection not fully implemented yet"),null}catch(t){return console.error("Failed to connect to USB device:",t),null}}const Ye={};function ht({label:e,autoStart:t,scale:r,className:a,aspect:s="inherit",style:i,fill:o=!1}){const l=h.useRef(null),m=je(),[w,x]=h.useState(!1),[j,T]=h.useState(null),[g,v]=h.useState(null),[$,C]=h.useState(null),L=h.useRef(null),E=h.useCallback((c,d="local")=>{try{c?(m.setMediaStream(c),l.current&&m.setVideoElementRef(l.current),m.setMode(d),m.setStreaming(!0),L.current=d):L.current&&L.current!=="phone"&&(m.setStreaming(!1),m.setMediaStream(null),L.current=null)}catch(u){console.warn("[CameraTile] Failed to register stream with camera session:",u)}},[m]),D=O(c=>c.preferredCameraLabel),[S,A]=h.useState(()=>{if(D==="Phone Camera")return console.log("[CAMERATILE] Initializing mode to phone (from preferred camera selection)"),"phone";const c=localStorage.getItem("ndn:camera:mode");return console.log("[CAMERATILE] Initializing mode to",c||"local","(from localStorage)"),c||"local"}),[U,F]=h.useState(null),[X,Q]=h.useState(Date.now()),[Y,R]=h.useState(!1),[P,W]=h.useState(null),[B,ae]=h.useState(null),[G,ce]=h.useState(!0),[le,K]=h.useState([]),[Z,k]=h.useState(!1),[de,H]=h.useState([]),[ue,q]=h.useState(!1),_=O(c=>c.autoscoreProvider),se=O(c=>c.cameraEnabled),ee=O(c=>c.setPreferredCameraLocked);O(c=>c.preferredCameraLocked);const te=O(c=>c.setPreferredCamera),fe=O(c=>c.preferredCameraId);if(_==="manual"){const d=[o?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",a].filter(Boolean).join(" ").trim(),u={...i||{}};return!o&&u.aspectRatio===void 0&&u.height===void 0&&u.minHeight===void 0&&(u.aspectRatio="4 / 3"),n.jsx("div",{className:d,style:u,children:n.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}h.useEffect(()=>{const c=window.location.hostname;(c==="localhost"||c==="127.0.0.1")&&we("/api/hosts").then(d=>d.json()).then(d=>{const u=Array.isArray(d?.hosts)&&d.hosts.find(f=>f);u&&W(u)}).catch(()=>{}),we("/api/https-info").then(d=>d.json()).then(d=>{d&&typeof d.https=="boolean"&&ae({https:!!d.https,port:Number(d.port)||8788})}).catch(()=>{})},[]);const re=h.useMemo(()=>{const c=g||"____",d="ws://localhost:8787";if(d.length>0)try{const V=new URL(d);return`${`${V.protocol==="wss:"?"https":"http"}://${V.host}${V.pathname.endsWith("/ws")?"":V.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${c}`}catch{}const u=P||window.location.hostname,f=!!B?.https,y=f?B?.port||8788:8787;return`${f?"https":"http"}://${u}:${y}/mobile-cam.html?code=${c}`},[g,P,B]);h.useEffect(()=>{console.log("[CAMERATILE] Mode changed to:",S,"- persisting to localStorage"),localStorage.setItem("ndn:camera:mode",S)},[S]),h.useEffect(()=>{const c=O.getState().ignorePreferredCameraSync;console.log("[CAMERATILE] Checking camera selection sync: preferredCameraLabel=",D,"mode=",S,"ignoreSync=",c,"manualModeSetAt=",z),!c&&(z&&Date.now()-z<3e4||D==="Phone Camera"&&S!=="phone"&&(console.log("[CAMERATILE] Syncing mode to phone from Calibrator selection"),A("phone")))},[D,S,z]);const[ne,ie]=h.useState(""),[z,me]=h.useState(null);h.useEffect(()=>{if(!g){ie("");return}const c=Ye?.VITE_QR_LOGO_URL||"/dart-thrower.svg";Re(re,{width:160,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"},logo:{logoUrl:c,logoScale:.2,mask:!0,shape:"circle"}}).then(ie).catch(()=>ie(""))},[re,g]),h.useEffect(()=>{if(!U)return;const c=setInterval(()=>Q(Date.now()),1e3);return()=>clearInterval(c)},[U]);const b=h.useMemo(()=>U?Math.max(0,Math.ceil((U-X)/1e3)):null,[U,X]);h.useEffect(()=>{if(!(!se||_==="manual")&&t!==void 0){if(t){let c=!1;const d=D||"default",u=window.setTimeout(()=>{c||w||N().catch(f=>console.warn(`[CameraTile] Auto-start failed for ${d}:`,f))},200);return()=>{c=!0,window.clearTimeout(u)}}I()}},[t,w,se,_,D,N,I]),h.useEffect(()=>{const c=async()=>{try{if(!(D==="Phone Camera"&&(!z||Date.now()-z>=3e4)||S==="phone"))return;const f=m.getMediaStream(),y=l.current;if(!y||!f)return;y.srcObject!==f&&(y.srcObject=f),y.muted=!0,y.playsInline=!0;try{await y.play()}catch{}x(!0)}catch{}};c();const d=setInterval(c,800);return()=>clearInterval(d)},[D,S,m,m.isStreaming]);async function N(){if(console.log("[CameraTile] start() invoked with mode=",S),S==="wifi")return he();if(console.log("[CameraTile] Attempting to attach global stream for phone mode..."),D==="Phone Camera"||S==="phone"){const c=m.getMediaStream();if(c&&l.current)try{l.current.srcObject=c,await l.current.play(),x(!0);return}catch{}if(S==="phone")try{await oe();return}catch{}}try{const{preferredCameraId:c,setPreferredCamera:d}=O.getState(),u=c?{video:{deviceId:{exact:c}},audio:!1}:{video:!0,audio:!1};let f;try{f=await navigator.mediaDevices.getUserMedia(u)}catch(y){const M=y&&(y.name||y.code)||"";if(c&&(M==="OverconstrainedError"||M==="NotFoundError"))f=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw y}l.current&&(l.current.srcObject=f,await l.current.play(),x(!0),E(f,"local"))}catch{}}function I(){l.current&&l.current.srcObject&&(l.current.srcObject.getTracks().forEach(d=>d.stop()),l.current.srcObject=null,x(!1),E(null))}async function he(){k(!0);try{const c=await We();K(c),c.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(c){console.error("Wifi device discovery failed:",c),alert("Failed to discover wifi devices. Please check your network connection.")}finally{k(!1)}}async function Se(c){try{K(u=>u.map(f=>f.id===c.id?{...f,status:"connecting"}:f));const d=await Xe(c);if(d&&l.current)l.current.srcObject=d,await l.current.play(),x(!0),E(d,"wifi"),K(u=>u.map(f=>f.id===c.id?{...f,status:"online"}:f));else throw new Error("Failed to get video stream")}catch(d){console.error("Failed to connect to wifi device:",d),alert(`Failed to connect to ${c.name}. Please check the device and try again.`),K(u=>u.map(f=>f.id===c.id?{...f,status:"offline"}:f))}}async function be(){q(!0);try{const c=await ze();H(c);const d=await Je();d&&H(u=>[...u,d]),c.length===0&&!d&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(c){console.error("USB device discovery failed:",c),alert("Failed to discover USB devices. Please check device connections.")}finally{q(!1)}}h.useEffect(()=>{const c=d=>{try{const u=d&&d.detail&&d.detail.mode;u&&["local","phone","wifi","usb"].includes(u)?(pe(u),N().catch(()=>{})):N().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",c),()=>{window.removeEventListener("ndn:start-camera",c)}},[N,pe]);async function ke(c){try{H(u=>u.map(f=>f.id===c.id?{...f,status:"connecting"}:f));const d=await Qe(c);if(d&&l.current)l.current.srcObject=d,await l.current.play(),x(!0),A("wifi"),E(d,"wifi"),H(u=>u.map(f=>f.id===c.id?{...f,status:"online"}:f));else throw new Error("Failed to get video stream")}catch(d){console.error("Failed to connect to USB device:",d),alert(`Failed to connect to ${c.name}. Please check the device and try again.`),H(u=>u.map(f=>f.id===c.id?{...f,status:"offline"}:f))}}const pe=h.useCallback(c=>{try{A(c==="usb"?"wifi":c),me(Date.now());try{if(c==="local"){try{te(fe,"Local",!0)}catch{}try{ee(!0)}catch{}}else if(c==="phone"){try{te(void 0,"Phone Camera",!0)}catch{}try{ee(!0)}catch{}}else if(c==="wifi"||c==="usb"){try{te(void 0,"WiFi/USB",!0)}catch{}try{ee(!0)}catch{}}}catch{}c==="local"?N().catch(()=>{}):c==="phone"?oe():c==="wifi"?he():c==="usb"&&be()}catch(d){console.warn("[CameraTile] handleModeSelect failed",d)}},[N,oe,he,be,te,ee,fe]);function Le(){if(j&&j.readyState===WebSocket.OPEN)return j;const c="ws://localhost:8787",d=c.length>0?c.endsWith("/ws")?c:c.replace(/\/$/,"")+"/ws":void 0,u=window.location.protocol==="https:"?"wss":"ws",f=`${u}://${window.location.host}/ws`,y=window.location.hostname,M=y==="localhost"||y==="127.0.0.1",V=y.endsWith("onrender.com"),ve="wss://ninedartnation.onrender.com/ws";let J=d;J||(M?J=`${u}://${y}:8787/ws`:V?J=f:J=ve),J||(J=f);const ge=new WebSocket(J);return T(ge),ge}async function oe(){A("phone"),R(!1);const c=Le();c.readyState===WebSocket.OPEN?c.send(JSON.stringify({type:"cam-create"})):c.onopen=()=>c.send(JSON.stringify({type:"cam-create"})),c.onmessage=async d=>{const u=JSON.parse(d.data);if(u.type==="cam-code")v(u.code),u.expiresAt&&F(u.expiresAt);else if(u.type==="cam-peer-joined"){R(!0);const f=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});C(f),f.onicecandidate=M=>{M.candidate&&g&&c.send(JSON.stringify({type:"cam-ice",code:g,payload:M.candidate}))},f.ontrack=M=>{if(l.current){const V=M.streams?.[0];V&&(l.current.srcObject=V,l.current.play().catch(()=>{}),x(!0))}};const y=await f.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await f.setLocalDescription(y),g&&c.send(JSON.stringify({type:"cam-offer",code:g,payload:y}))}else if(u.type==="cam-answer")$&&await $.setRemoteDescription(new RTCSessionDescription(u.payload));else if(u.type==="cam-ice"&&$)try{await $.addIceCandidate(u.payload)}catch{}}}function Ee(){v(null),F(null),R(!1),j&&j.readyState===WebSocket.OPEN?j.send(JSON.stringify({type:"cam-create"})):oe();try{ee(!0)}catch{}}function Ue(){if(I(),v(null),R(!1),F(null),$){try{$.close()}catch{}C(null)}}return n.jsx(Ze,{label:e,autoStart:t,start:N,stopAll:Ue,startPhonePairing:oe,startWifiConnection:he,startUsbConnection:be,connectToWifiDevice:Se,connectToUsbDevice:ke,videoRef:l,streaming:w,mode:S,setMode:A,pairCode:g,mobileUrl:re,ttl:b,qrDataUrl:ne,regenerateCode:Ee,httpsInfo:B,showTips:G,setShowTips:ce,wifiDevices:le,usbDevices:de,discoveringWifi:Z,discoveringUsb:ue,scaleOverride:r,className:a,aspect:s,style:i,fill:o,onModeSelect:pe})}function Ze(e){const t=je(),{cameraScale:r,cameraAspect:a}=O(),{label:s,start:i,stopAll:o,startPhonePairing:l,startWifiConnection:m,startUsbConnection:w,connectToWifiDevice:x,connectToUsbDevice:j,videoRef:T,streaming:g,mode:v,setMode:$,onModeSelect:C,pairCode:L,mobileUrl:E,ttl:D,qrDataUrl:S,regenerateCode:A,httpsInfo:U,showTips:F,setShowTips:X,wifiDevices:Q,usbDevices:Y,discoveringWifi:R,discoveringUsb:P,className:W,aspect:B,style:ae,fill:G}=e,ce={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},le=h.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{C&&C("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{C&&C("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{C&&C("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{C&&C("usb")}}],[$,i,l,m,w]),[K,Z]=h.useState(null),k=h.useRef(null);h.useEffect(()=>()=>{k.current&&window.clearTimeout(k.current)},[]);const{cameraFitMode:de}=O(),H=G?"fill":de||"fill",ue=(()=>{const b=Number(e.scaleOverride??r??1),N=Math.max(.5,Math.min(1.25,b));return H==="fill"?Math.max(1,N):N})(),q=G&&H==="fill"?"free":B&&B!=="inherit"?B:a||"wide",_=q!=="free",se=_?q==="square"?"aspect-square":q==="portrait"?"aspect-[3/4]":q==="classic"?"aspect-[4/3]":"aspect-video":"",te=[G?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",W].filter(Boolean).join(" ").trim(),fe={...ae||{}},re=G?"relative flex-1 min-h-[420px] bg-black":"relative w-full bg-black",ne={style:{transform:`scale(${ue})`,transformOrigin:"center"}},ie=v==="wifi"&&Y.some(b=>b.status==="online"),z=(()=>{const N=H==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return G?_?n.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:n.jsx("div",{className:`relative w-full max-w-full max-h-full ${se}`,children:n.jsx("video",{ref:T,className:N,...ne})})}):n.jsx("video",{ref:T,className:N,...ne}):_?n.jsx("div",{className:`relative w-full ${se}`,children:n.jsx("video",{ref:T,className:N,...ne})}):n.jsx("video",{ref:T,className:N,...ne})})();async function me(b,N){if(b)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(b);else{const I=document.createElement("textarea");I.value=b,I.style.position="fixed",I.style.opacity="0",document.body.appendChild(I),I.focus(),I.select(),document.execCommand("copy"),document.body.removeChild(I)}Z(N),k.current&&window.clearTimeout(k.current),k.current=window.setTimeout(()=>Z(null),1500)}catch(I){console.warn("Copy to clipboard failed:",I),Z(null)}}return n.jsxs("div",{className:te,style:fe,children:[n.jsxs("div",{className:re,children:[z,t.isStreaming&&v==="phone"&&n.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[n.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),n.jsx("span",{children:"REC"})]})]}),n.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[n.jsxs("span",{className:"truncate font-medium",children:[s||(g?v==="phone"?"PHONE LIVE":v==="wifi"?"WIFI LIVE":"LIVE":"Camera"),preferredCameraLocked&&n.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[!g&&n.jsxs(n.Fragment,{children:[n.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>(C||handleModeSelect)("local"),children:"Local"}),n.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>(C||handleModeSelect)("phone"),children:"Phone"}),n.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>(C||handleModeSelect)("wifi"),children:"WiFi"}),n.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>(C||handleModeSelect)("usb"),children:"USB"})]}),g?n.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:o,children:"Stop"}):null]})]}),v==="phone"&&L&&!g&&n.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[n.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),n.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>me(E,"link"),title:"Copy mobile camera link",children:[n.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:E}),n.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:K==="link"?"Copied!":"Copy"})]}),n.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[n.jsx("a",{href:E,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),n.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>me(L,"code"),title:"Copy pairing code",children:[n.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:L}),n.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:K==="code"?"Copied!":"Copy"})]})]}),S&&n.jsx("img",{className:"mt-1 w-[160px] h-[160px] bg-white rounded",alt:"Scan to open",src:S}),n.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[D!==null&&n.jsxs("span",{children:["Expires in ",D,"s"]}),n.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:A,children:"Regenerate"})]}),F&&n.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[n.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),n.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[n.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),n.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",U?.https?U.port:8788,")."]}),n.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),n.jsx("div",{className:"mt-2 text-right",children:n.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>X(!1),children:"Hide tips"})})]})]}),v==="wifi"&&!g&&n.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[n.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),n.jsxs("div",{className:"mb-3",children:[n.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),R?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),n.jsx("span",{children:"Scanning network..."})]}):Q.length>0?n.jsxs("div",{className:"space-y-1",children:[Q.map(b=>n.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-medium truncate",children:b.name}),n.jsxs("div",{className:"opacity-70 text-[9px]",children:[b.ip,":",b.port]})]}),n.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${b.status==="connecting"?"bg-yellow-600":b.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>x(b),disabled:b.status==="connecting",children:b.status==="connecting"?"...":"Connect"})]},b.id)),n.jsx("div",{className:"text-center mt-2",children:n.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:m,children:"Rescan WiFi"})})]}):n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),n.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:m,children:"Scan WiFi"})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),P?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),n.jsx("span",{children:"Scanning USB..."})]}):Y.length>0?n.jsxs("div",{className:"space-y-1",children:[Y.map(b=>n.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-medium truncate",children:b.name}),n.jsx("div",{className:"opacity-70 text-[9px]",children:b.type.toUpperCase()})]}),n.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${b.status==="connecting"?"bg-yellow-600":b.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>j(b),disabled:b.status==="connecting",children:b.status==="connecting"?"...":"Connect"})]},b.id)),n.jsx("div",{className:"text-center mt-2",children:n.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:w,children:"Rescan USB"})})]}):n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),n.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:w,children:"Scan USB"})]})]})]}),!g&&n.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes"}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera"})]}),n.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",ce[v]||"Local"]})]}),n.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),n.jsx("div",{className:"grid grid-cols-2 gap-2",children:le.map(b=>{const N=b.id==="usb"?ie:b.id===v;return n.jsxs("button",{type:"button",onClick:b.action,className:`text-left p-3 rounded-2xl border ${N?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[n.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:b.title}),n.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:b.description}),N&&n.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},b.id)})})]})]})}const et=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function tt(e){return e==="DB"?50:Number(e.slice(1))*2}function nt(e){return et.includes(e)?tt(e):32}function xt(e,t="D16"){if(e>170||e<=1)return[];const r={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(r[e])return r[e];const a=nt(t),s=[];for(const i of[60,57,54,51,48])if(e-i===a){s.push(`T${i/3} ${t}`);break}if(!s.length){for(const i of[20,19,18,17,16,15])if(e-i===a){s.push(`${i} ${t}`);break}}return s}function bt(e,t,r,a,s){try{const i=window.speechSynthesis;if(!i)return;const o=new SpeechSynthesisUtterance,l=r<=170&&r>0,m=t===180;if(!(!s?.checkoutOnly||l||m))return;if(m?(o.text=`${e}! One eighty!`,o.rate=1.04,o.pitch=1.15):l?(o.text=`${e}, ${r} remaining.`,o.rate=1,o.pitch=1):t===0?(o.text=`${e}, no score.`,o.rate=1,o.pitch=1):(o.text=`${e}, ${t}.`,o.rate=1,o.pitch=1),a){const x=i.getVoices().find(j=>j.name===a);x&&(o.voice=x)}typeof s?.volume=="number"?o.volume=Math.max(0,Math.min(1,s.volume)):o.volume=1;try{i.cancel()}catch{}i.speak(o)}catch{}}function pt({gameMode:e,compact:t=!1,onRecalibrate:r}){const{H:a,errorPx:s}=Be(),i=Ie(e,s),o=$e(e,s),{quality:l,text:m}=Ae(e,s),w=Pe(e),x=Oe[e];if(!a||!s)return t?n.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30",children:[n.jsx(xe,{className:"w-3 h-3"}),"Not calibrated"]}):n.jsxs("div",{className:"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2",children:[n.jsx(xe,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-medium text-red-300",children:"Calibration Required"}),n.jsxs("div",{className:"text-xs opacity-80",children:["Please calibrate before playing ",e]})]}),r&&n.jsx("button",{className:"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700",onClick:r,children:"Calibrate"})]});const j=o?"bg-emerald-500/20 border-emerald-600/30":"bg-amber-500/20 border-amber-600/30",T=o?"text-emerald-300":"text-amber-300",g=o?Fe:xe;return t?n.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${j} ${T}`,children:[Te.createElement(g,{className:"w-3 h-3"}),n.jsx("span",{children:m}),!o&&w&&n.jsx("span",{className:"w-3 h-3 cursor-help",title:w,children:n.jsx(He,{className:"w-3 h-3 inline"})})]}):n.jsxs("div",{className:`px-3 py-2 rounded border ${j} space-y-1`,children:[n.jsxs("div",{className:"flex items-center gap-2",children:[Te.createElement(g,{className:`w-4 h-4 ${o?"text-emerald-400":"text-amber-400"} flex-shrink-0`}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:`font-medium ${o?"text-emerald-300":"text-amber-300"}`,children:["Calibration for ",e]}),n.jsxs("div",{className:"text-xs opacity-80",children:["Error: ",Math.round(s),"px | ",m]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"flex-1 h-1.5 rounded bg-black/30 overflow-hidden",children:n.jsx("div",{className:`h-full transition-all ${o?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Math.min(100,i)}%`}})}),n.jsxs("span",{className:"text-xs font-mono",children:[Math.round(i),"%"]})]}),x&&n.jsx("div",{className:"text-xs opacity-75",children:n.jsxs("div",{children:["Tolerance: Â±",x.tolerancePx,"px | Min: ",x.minConfidence,"%"]})}),n.jsxs("div",{className:"space-y-1",children:[!o&&n.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1",children:[n.jsx(xe,{className:"w-3 h-3 flex-shrink-0"}),"Calibration quality is below minimum for ",e]}),w&&n.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1",children:[n.jsx(Me,{className:"w-3 h-3 flex-shrink-0"}),w]})]}),!o&&r&&n.jsxs("button",{className:"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700",onClick:r,children:["Recalibrate for ",e]})]})}function gt({left:e,right:t,className:r="",sticky:a=!0}){return n.jsxs("div",{className:`${a?"sticky top-0":""} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${r}`,children:[n.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),n.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:e}),n.jsx("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:t})]})}const st=[...Array.from({length:20},(e,t)=>({label:`D${t+1}`,score:(t+1)*2})),{label:"DBULL",score:50,isBull:!0}];function vt(e,t){const r=st[t];return!!r&&e===r.score}function wt(e){const t=e.trim().toUpperCase();if(!t)return null;if(t==="50"||t==="BULL"||t==="DBULL"||t==="IBULL")return 50;if(t==="25"||t==="OBULL")return 25;const r=t.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!r)return null;const a=r[1]||"S",s=parseInt(r[2],10);return s<1||s>20?null:s*(a==="S"?1:a==="D"?2:3)}const Tt=[...Array.from({length:20},(e,t)=>t+1),25,50],ye=[20,19,18,17,16,15,25];function jt(){const e={};return ye.forEach(t=>{e[t]=0}),{marks:e,points:0}}function Dt(e,t,r,a,s=()=>!1){let i=null,o=0;if(r==="BULL"||r==="INNER_BULL"||t===25||t===50)i=25,o=r==="INNER_BULL"||t===50?2:1;else if(typeof a=="number"&&a>=15&&a<=20)i=a,r==="TRIPLE"?o=3:r==="DOUBLE"?o=2:o=1;else if(t){const g=[20,19,18,17,16,15];for(const v of g){if(t===v){i=v,o=1;break}if(t===v*2){i=v,o=2;break}if(t===v*3){i=v,o=3;break}}!i&&(t===25||t===50)&&(i=25,o=t===50?2:1)}if(!i)return 0;const l=e.marks[i];let m=Math.max(0,3-l);const w=Math.min(m,o),x=Math.max(0,o-w),j=l+w;e.marks[i]=j>3?3:j;let T=0;return x>0&&!s(i)&&(i===25?r==="INNER_BULL"?T+=50*x:T+=25*x:T+=i*x),e.points+=T,T}function Nt(e){return ye.every(t=>(e.marks[t]||0)>=3)}function yt(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function rt(e){return e.round}function Ct(e,t,r,a){if(e.finished)return 0;const s=rt(e);let i=0;return typeof a=="number"&&a===s?r==="TRIPLE"?(i=s*3,e.turnHits.triples++):r==="DOUBLE"?(i=s*2,e.turnHits.doubles++):r==="SINGLE"&&(i=s*1,e.turnHits.singles++):!a&&(t===s||t===s*2||t===s*3)&&(t===s*3?(i=s*3,e.turnHits.triples++):t===s*2?(i=s*2,e.turnHits.doubles++):t===s&&(i=s,e.turnHits.singles++)),e.score+=i,i}function St(e){if(!e.finished){if(e.turnHits.singles>0&&e.turnHits.doubles>0&&e.turnHits.triples>0){e.shanghaiAchieved=!0,e.finished=!0;return}const t=e.round+1;t>20?e.finished=!0:e.round=t}e.turnHits={singles:0,doubles:0,triples:0}}function kt(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function it(e){return e.targets[e.stage]||null}function Lt(e,t,r,a){if(e.finished)return 0;const s=it(e);if(!s)return 0;let i=0;switch(s.kind){case"NUMBER":{typeof a=="number"&&a===s.num?r==="TRIPLE"?i=s.num*3:r==="DOUBLE"?i=s.num*2:r==="SINGLE"&&(i=s.num):!a&&(t===s.num||t===s.num*2||t===s.num*3)&&(i=t),i>0&&(e.hitThisRound=!0);break}case"DOUBLE":{(r==="DOUBLE"&&a===s.num||t===s.num*2)&&(i=s.num*2,e.hitThisRound=!0);break}case"TRIPLE":{(r==="TRIPLE"&&a===s.num||t===s.num*3)&&(i=s.num*3,e.hitThisRound=!0);break}case"BULL":{(r==="BULL"||r==="INNER_BULL"||t===25||t===50)&&(i=r==="INNER_BULL"||t===50?50:25,e.hitThisRound=!0);break}case"ANY_NUMBER":{t>0&&(i=t,e.hitThisRound=!0);break}}return e.score+=i,i}function Et(e){e.finished||(e.hitThisRound||(e.score=Math.floor(e.score/2)),e.hitThisRound=!1,e.stage+=1,e.stage>=e.targets.length&&(e.finished=!0))}function Ut(){return{round:1,score:0,target:"HIGH",finished:!1}}function Rt(e,t,r,a){if(e.finished)return 0;let s=0;if(e.target==="HIGH")if(r==="INNER_BULL")s=50;else if(typeof a=="number"){const o=a*(r==="TRIPLE"?3:r==="DOUBLE"?2:1);a>=20&&(s=o)}else t>=40&&(s=t);else if(typeof a=="number"){const o=a*(r==="TRIPLE"?3:r==="DOUBLE"?2:1);a<=10&&(s=o)}else t>0&&t<=30&&(s=t);return e.score+=s,s}function Bt(e){if(!e.finished){if(e.round+=1,e.round>10){e.finished=!0;return}e.target=e.target==="HIGH"?"LOW":"HIGH"}}function It(e,t=3){return{number:e,lives:t,isKiller:!1,eliminated:!1}}function $t(e){const t=Array.from({length:20},(a,s)=>s+1),r={};for(const a of e){const s=Math.floor(Math.random()*t.length),i=t.splice(s,1)[0];r[a]=i}return r}function At(e,t,r,a){const s=t[e];if(!s||!a||!r)return{becameKiller:!1};if(!s.isKiller&&r==="DOUBLE"&&a===s.number)return s.isKiller=!0,{becameKiller:!0};if(s.isKiller&&(r==="DOUBLE"||r==="TRIPLE")){const i=Object.keys(t).find(o=>o!==e&&!t[o].eliminated&&t[o].number===a);if(i){const o=t[i],l=r==="TRIPLE"?2:1;return o.lives=Math.max(0,o.lives-l),o.lives===0&&(o.eliminated=!0),{becameKiller:!1,victimId:i,livesRemoved:l}}}return{becameKiller:!1}}function Pt(e){const t=Object.entries(e).filter(([,r])=>!r.eliminated&&r.lives>0);return t.length===1?t[0][0]:null}const Ce=[20,19,18,17,16,15,14,13,12,25];function Ot(){const e={};return Ce.forEach(t=>{e[t]=0}),{marks:e,points:0}}function Ft(e,t,r,a,s=()=>!1){let i=null,o=0;if(r==="BULL"||r==="INNER_BULL"||t===25||t===50)i=25,o=r==="INNER_BULL"||t===50?2:1;else if(typeof a=="number"&&a>=12&&a<=20)i=a,r==="TRIPLE"?o=3:r==="DOUBLE"?o=2:o=1;else if(t){for(const g of[20,19,18,17,16,15,14,13,12]){if(t===g){i=g,o=1;break}if(t===g*2){i=g,o=2;break}if(t===g*3){i=g,o=3;break}}!i&&(t===25||t===50)&&(i=25,o=t===50?2:1)}if(!i)return 0;const l=e.marks[i],m=Math.max(0,3-l),w=Math.min(m,o),x=Math.max(0,o-w),j=l+w;e.marks[i]=j>3?3:j;let T=0;return x>0&&!s(i)&&(i===25?r==="INNER_BULL"?T+=50*x:T+=25*x:T+=i*x),e.points+=T,T}function Ht(e){return Ce.every(t=>(e.marks[t]||0)>=3)}function Mt(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function Wt(e,t,r,a){if(e.finished)return 0;let s=0;if(typeof a=="number"&&a===e.inning?r==="TRIPLE"?s=3:r==="DOUBLE"?s=2:s=1:!a&&(t===e.inning||t===e.inning*2||t===e.inning*3)&&(s=t===e.inning*3?3:t===e.inning*2?2:1),e.score+=s,e.dartsThisInning+=1,e.dartsThisInning>=3){const i=e.inning+1;i>9?e.finished=!0:(e.inning=i,e.dartsThisInning=0)}return s}const ot={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function _t(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function Vt(e,t,r,a){if(e.finished)return!1;const s=ot[e.hole];if(e.dartsThisHole+=1,typeof a=="number"&&a===s&&(r==="SINGLE"||r==="DOUBLE"||r==="TRIPLE")||!a&&(t===s||t===s*2||t===s*3)){e.strokes+=e.dartsThisHole;const o=e.hole+1;return o>18?e.finished=!0:(e.hole=o,e.dartsThisHole=0),!0}if(e.dartsThisHole>=3){e.strokes+=3;const o=e.hole+1;o>18?e.finished=!0:(e.hole=o,e.dartsThisHole=0)}return!1}const at={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function Gt(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function ct(e){const t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[r,a,s]of t)if(e[r]&&e[r]===e[a]&&e[r]===e[s])return e[r];return e.every(r=>r)?"Draw":null}function Kt(e,t,r,a,s){if(e.finished||e.board[t])return!1;const i=at[t];let o=!1;if(i.type==="BULL"?o=a==="BULL"||a==="INNER_BULL"||r===25||r===50:i.type==="NUM"&&typeof i.num=="number"&&(typeof s=="number"&&s===i.num||!s&&(r===i.num||r===i.num*2||r===i.num*3))&&(o=!0),!o)return!1;e.board[t]=e.turn;const l=ct(e.board);return l?(e.finished=!0,e.winner=l,!0):(e.turn=e.turn==="X"?"O":"X",!0)}function qt({gameMode:e,players:t,matchScore:r,gameRules:a}){return!t||t.length===0?null:n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:t.map((s,i)=>n.jsxs("div",{className:`rounded-lg border p-3 ${s.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[n.jsx("div",{className:`text-sm font-semibold mb-2 uppercase tracking-wide ${s.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:s.name}),n.jsxs("div",{className:"space-y-1 text-sm",children:[e==="X01"&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Legs Won",value:`â— ${s.legsWon||0}`,highlight:!0}),n.jsx(p,{label:"Score",value:s.score||0,mono:!0,bold:!0}),n.jsx(p,{label:"Last Score",value:s.lastScore||"0",mono:!0}),n.jsx(p,{label:"C/Out Rate",value:`${s.checkoutRate||0}%`,mono:!0}),n.jsx(p,{label:"Best Leg",value:s.bestLeg||"â€”",mono:!0}),s.matchAvg!==void 0&&s.allTimeAvg!==void 0&&n.jsx(n.Fragment,{children:n.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[n.jsx(p,{label:"Match Avg",value:s.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:s.matchAvg>0}),n.jsx(lt,{matchAvg:s.matchAvg,allTimeAvg:s.allTimeAvg})]})})]}),(e==="Cricket"||e==="American Cricket")&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Closed",value:dt(s.closed),mono:!0}),n.jsx(p,{label:"Points",value:s.points||0,mono:!0,bold:!0}),n.jsx(p,{label:"Status",value:ut(s),highlight:s.isCurrentTurn})]}),(e==="Shanghai"||e==="Halve It")&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:e==="Shanghai"?"Round":"Stage",value:s.round||1,mono:!0}),n.jsx(p,{label:"Target",value:s.target||"â€”",mono:!0}),n.jsx(p,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Killer"&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Target #",value:s.number||"â€”",mono:!0,bold:!0}),n.jsx(p,{label:"Lives",value:s.lives||0,mono:!0,bold:!0}),s.eliminated&&n.jsx(p,{label:"Status",value:"ELIMINATED",highlight:!1})]}),e==="High-Low"&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Round",value:s.round||1,mono:!0}),n.jsx(p,{label:"Target",value:s.target||"High",mono:!0}),n.jsx(p,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),(e==="Double Practice"||e==="Treble Practice"||e==="Around the Clock")&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Target",value:s.target||"â€”",mono:!0,bold:!0}),n.jsx(p,{label:"Hits",value:s.hits||0,mono:!0,bold:!0}),s.totalNeeded&&n.jsx(p,{label:"Progress",value:`${s.hits||0} / ${s.totalNeeded}`,mono:!0})]}),(e==="Count-Up"||e==="High Score"||e==="Low Score")&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Round",value:s.round||1,mono:!0}),n.jsx(p,{label:"Score",value:s.score||0,mono:!0,bold:!0}),e==="High Score"&&n.jsx(p,{label:"Best",value:s.bestScore||0,mono:!0})]}),(e==="Checkout 170"||e==="Checkout 121")&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Remaining",value:s.remaining||0,mono:!0,bold:!0}),n.jsx(p,{label:"Attempts",value:s.attempts||0,mono:!0}),n.jsx(p,{label:"Successes",value:s.successes||0,mono:!0})]}),e==="Bob's 27"&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Target",value:`D${s.target||1}`,mono:!0,bold:!0}),n.jsx(p,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Baseball"&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Inning",value:s.inning||1,mono:!0}),n.jsx(p,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Golf"&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Hole",value:s.hole||1,mono:!0}),n.jsx(p,{label:"Strokes",value:s.strokes||0,mono:!0,bold:!0})]}),e==="Tic Tac Toe"&&n.jsxs(n.Fragment,{children:[n.jsx(p,{label:"Turn",value:s.turn||1,mono:!0}),s.winner&&n.jsx(p,{label:"Result",value:"WINNER!",highlight:!0})]}),r&&(e==="X01"||e==="Cricket"||e==="American Cricket")&&i===1&&n.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:n.jsx(p,{label:"Match",value:r,mono:!0,bold:!0,highlight:!0})})]})]},i))})}function p({label:e,value:t,mono:r=!1,bold:a=!1,highlight:s=!1}){return n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("span",{className:"opacity-70",children:[e,":"]}),n.jsx("span",{className:`${r?"font-mono":""} ${a?"font-semibold":""} ${s?"text-emerald-300":""}`,children:t})]})}function lt({matchAvg:e,allTimeAvg:t}){const r=e-t,a=r>0,s=Math.abs(r)<.01;let i="",o="text-slate-300";return s?(i="= All-time",o="text-slate-300"):a?(i=`+${r.toFixed(2)} vs avg`,o="text-emerald-400"):(i=`${r.toFixed(2)} vs avg`,o="text-orange-400"),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"opacity-70",children:"AVG vs Avg:"}),n.jsx("span",{className:`font-mono font-semibold ${o}`,children:i})]})}function dt(e){return!e||Object.keys(e).length===0?"â€”":Object.entries(e).filter(([r,a])=>a===3).map(([r])=>r==="25"?"B":r).join(",")||"â€”"}function ut(e){if(!e.closed)return"Starting";const t=Object.values(e.closed).filter(r=>r===3).length;return t===0?"No marks":t<7?`${t}/7`:"Closing in"}function zt(e,t,r,a,s,i,o,l,m,w,x,j,T,g,v,$,C,L,E,D,S,A,U,F,X,Q,Y){return h.useMemo(()=>{const R=[];if(e==="X01"){let P=0,W=0,B=0;if(L&&L.length>0){for(const k of L)k.dartsThrown&&k.totalScored&&(W+=k.dartsThrown,B+=k.totalScored);W>0&&(P=B/W*3)}const Z=(j??0)>0?l??0:w??null??(i??0);if(R.push({name:"You",isCurrentTurn:!!E,legsWon:a||0,score:t||0,lastScore:Z,checkoutRate:v&&v>0?Math.round((g||0)/v*100):0,bestLeg:L&&L.length>0?`${Math.min(...L.map(k=>k.doubleDarts+(k.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:P,allTimeAvg:De("You")||0}),D&&D!=="None"){const _=(T??0)>0?m??0:x??null??(o??0);R.push({name:`${D} AI`,isCurrentTurn:!E,legsWon:s||0,score:r||0,lastScore:_,checkoutRate:C&&C>0?Math.round(($||0)/C*100):0,bestLeg:"â€”"})}}return e==="Cricket"&&(R.push({name:"You",isCurrentTurn:!!E,closed:A?.marks||{},points:A?.points||0}),D&&D!=="None"&&R.push({name:`${D} AI`,isCurrentTurn:!E,closed:{},points:0})),e==="Shanghai"&&(R.push({name:"You",isCurrentTurn:!!E,round:U?.round||1,target:U?.target||1,score:U?.score||0}),D&&D!=="None"&&R.push({name:`${D} AI`,isCurrentTurn:!E,round:U?.round||1,target:U?.target||1,score:0})),e==="Killer"&&F&&F.length>0&&F.forEach((P,W)=>{const B=X?.[P.id];R.push({name:P.name,isCurrentTurn:W===Y,number:Q?.[P.id],lives:B?.lives||0,eliminated:B?.eliminated||!1})}),R},[e,t,r,a,s,i,o,l,m,w,x,j,T,g,v,$,C,L,E,D,A,U,F,X,Q,Y])}function Jt(e,t,r){return h.useMemo(()=>{const a=[];return!t||!t.players||t.players.length===0||t.players.forEach((s,i)=>{const o=i===t.currentPlayerIdx;if(e==="X01"){let l=0,m=0,w=0;if(s.legs&&s.legs.length>0){for(const x of s.legs)if(x.finished){const j=x.dartsThrown||0,T=Math.max(0,x.totalScoreStart-x.totalScoreRemaining)||0;m+=j,w+=T}}m>0&&(l=w/m*3),a.push({name:s.name||`Player ${i+1}`,isCurrentTurn:o,legsWon:s.legsWon||0,score:s.score||0,lastScore:s.lastVisitScore||0,checkoutRate:s.doublesAttempted>0?Math.round(s.doublesHit/s.doublesAttempted*100):0,bestLeg:s.bestLegDarts?`${s.bestLegDarts} darts`:"â€”",matchAvg:l,allTimeAvg:s.name?De(s.name):0})}e==="Cricket"&&a.push({name:s.name||`Player ${i+1}`,isCurrentTurn:o,closed:s.cricket?.marks||{},points:s.cricket?.points||0}),e==="Killer"&&a.push({name:s.name||`Player ${i+1}`,isCurrentTurn:o,number:s.killerNumber||null,lives:s.killerLives||3,eliminated:s.killerEliminated||!1})}),a},[e,t,r])}export{Tt as A,Ft as B,ye as C,st as D,Dt as E,Ct as F,pt as G,St as H,Lt as I,Et as J,Rt as K,Bt as L,It as M,Jt as N,ot as O,at as T,yt as a,kt as b,jt as c,Ut as d,Mt as e,_t as f,Gt as g,Ot as h,gt as i,Nt as j,it as k,Ht as l,Ce as m,qt as n,xt as o,ht as p,vt as q,wt as r,bt as s,$t as t,zt as u,At as v,Pt as w,Wt as x,Vt as y,Kt as z};
//# sourceMappingURL=useGameStats-CAX-O-Rt.js.map

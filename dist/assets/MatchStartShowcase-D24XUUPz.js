import{o as Q,N as V,Q as W,S as X,g as Y,U as q,j as e,H as J,p as Z,b as _}from"./index-BjeBmmUT.js";import{r}from"./ui-Vpbk6UnN.js";function k({label:o,value:x,className:f="",scale:u=1}){return e.jsxs("div",{className:`flex flex-col items-center gap-1 ${f}`,children:[e.jsx("div",{className:"text-xs opacity-70",children:o}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold transform transition-transform duration-200 ease-out",style:{transform:`scale(${u})`},children:x})]})}function D({player:o,user:x,playerCalibrations:f}){const u=r.useRef(null),m=!!f[o.name];return r.useEffect(()=>{const h=u.current;if(!h)return;const i=h.getContext("2d");if(!i)return;i.clearRect(0,0,h.width,h.height);const d=h.width/2,a=h.height/2,b=Math.min(d,a)-2;i.strokeStyle="#fff",i.lineWidth=1,i.beginPath(),i.arc(d,a,b,0,2*Math.PI),i.stroke(),i.fillStyle="#f00",i.beginPath(),i.arc(d,a,4,0,2*Math.PI),i.fill(),m&&(i.fillStyle="#0f0",[[d-b*.5,a],[d+b*.5,a],[d,a-b*.5],[d,a+b*.5]].forEach(([w,g])=>{i.beginPath(),i.arc(w,g,2,0,2*Math.PI),i.fill()}))},[m]),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("canvas",{ref:u,width:40,height:40,className:"border border-white/20 rounded"}),e.jsx("span",{className:`text-xs ${m?"text-green-400":"text-gray-400"}`,children:m?"Calibrated":"Not Calibrated"})]})}function se({players:o,user:x,onDone:f,initialSeconds:u=15,roomId:M,onChoice:m,choices:h={},bullActive:i=!1,onBullThrow:d}){const[a,b]=r.useState(u||15),[$,w]=r.useState(1),[g,j]=r.useState(!0),[S,P]=r.useState(!1),[p,F]=r.useState({}),[I,B]=r.useState({}),L=r.useRef(null),E=r.useRef(null),T=r.useRef(null),C=r.useRef(null);r.useEffect(()=>{if(!g)return;try{setTimeout(()=>{try{E.current?.focus()}catch{}},0)}catch{}try{C.current=document.activeElement}catch{}const t=document.getElementById("root"),l=t?t.getAttribute("aria-hidden"):null;try{t&&t.setAttribute("aria-hidden","true")}catch{}const s=v?setInterval(()=>b(n=>n-1),1e3):null,c=n=>{if(n.key==="Escape"){n.preventDefault(),j(!1);try{f?.()}catch{}try{C.current?.focus()}catch{}}};return document.addEventListener("keydown",c),()=>{try{t&&l===null?t.setAttribute("aria-hidden","false"):t&&l!==null&&t.setAttribute("aria-hidden",l)}catch{}s&&clearInterval(s),document.removeEventListener("keydown",c)}},[g,f]);const v=o.every(t=>p[t.id]),A=v;r.useEffect(()=>{g&&(a===(u||15)&&!S&&(P(!0),(async()=>{const l={};for(const s of o)if(x?.username&&s.name===x.username){const{H:c,imageSize:n,locked:y}=_.getState();c&&y&&(l[s.name]={H:c,imageSize:n,locked:y})}else try{const c=await fetch(`/api/users/${encodeURIComponent(s.name)}/calibration`);if(c.ok){const n=await c.json();n.calibration&&(l[s.name]=n.calibration)}}catch(c){console.warn("Failed to fetch calibration for",s.name,c)}B(l)})()),v&&(a<=3&&a>0&&w(t=>t+.4),a<=0&&setTimeout(()=>{j(!1);try{f?.()}catch{}try{C.current?.focus()}catch{}},1e3)))},[a,f,g,S,v,o,x]);const U=r.useMemo(()=>o.map(t=>{const l=Q(t.name),s=V(t.name),c=W(t.name),n=X(t.name);Y(t.name);const y=q(t.name);let R=0;try{for(const O of t.legs||[])for(const K of O.visits||[])Number(K.score||0)===180&&(R+=1)}catch{}const H=`${R}/${y}`;return{id:t.id,name:t.name,avg3:l.toFixed(1),best9:s.toFixed(1),bestCheckout:c,bestLeg:n,one80s:H}}),[o]);if(!g)return null;const z=()=>{const t=o.filter(s=>p[s.id]),l=o.filter(s=>!p[s.id]);return e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/90 p-4",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"Calibration Check"}),e.jsx("p",{className:"text-sm opacity-70 mb-6 text-center",children:"Check your dartboard calibration before the match starts. Both players must skip or confirm to begin."}),t.length>0&&l.length>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[t.map(s=>s.name).join(", ")," ",t.length===1?"has":"have"," chosen to skip.",l.map(s=>s.name).join(", "),", would you like to skip as well?"]})}),e.jsx("div",{className:"space-y-4",children:o.map(s=>{const c=p[s.id];return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:s.name.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(D,{player:s,user:x,playerCalibrations:I})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>{try{m&&m("bull")}catch{}},children:"Bull Up"}),e.jsx("button",{className:`btn btn-sm ${c?"bg-emerald-600":"btn-primary"}`,onClick:()=>{F(n=>({...n,[s.id]:!0}));try{m&&m("skip")}catch{}},disabled:c,children:c?"Skipped âœ“":"Skip"})]})]},s.id)})}),e.jsx("div",{className:"mt-6 flex justify-center gap-4",children:e.jsxs("button",{className:`btn ${A?"btn-primary":"btn-ghost opacity-50 cursor-not-allowed"}`,onClick:()=>{if(A){P(!1);try{m&&m("skip")}catch{}}},disabled:!A,children:["Start Match (",l.length," remaining)"]})})]})})},N=t=>t<=0?1.8:t===1?1.6:t===2?1.4:t===3?1.2:1,G=e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",children:e.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"match-start-heading",tabIndex:-1,children:e.jsx(J,{returnFocus:!0,children:e.jsx("div",{ref:L,children:e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-3xl p-8 md:p-12 max-w-7xl w-full backdrop-blur-sm shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("div",{id:"match-start-heading",className:"text-2xl font-bold opacity-90",children:"Match Starting Soon"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-6xl font-extrabold text-emerald-400","aria-live":"polite",children:a>0?a:"GO"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{ref:E,className:"btn btn-lg",onClick:()=>{j(!1);try{f?.()}catch{}},"aria-label":"Start match now",children:"Start Now"}),e.jsx("button",{ref:T,className:"btn btn-ghost btn-sm",onClick:()=>{j(!1);try{f?.()}catch{}},"aria-label":"Close match start showcase",children:"Close"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:U.map(t=>e.jsxs("div",{className:"p-6 rounded-2xl bg-white/8 border border-white/12 flex flex-col items-center shadow-xl",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-2xl font-bold text-white mb-4 shadow-lg",children:t.name.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2)}),e.jsx("div",{className:"text-xl font-semibold mb-4 text-center",children:t.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full",children:[e.jsx(k,{label:"3-Dart Avg",value:t.avg3,scale:N(a)}),e.jsx(k,{label:"First-9 Avg",value:t.best9,scale:N(a)}),e.jsx(k,{label:"Best Checkout",value:t.bestCheckout||"â€”",scale:N(a)}),e.jsx(k,{label:"Best Leg",value:t.bestLeg||"â€”",scale:N(a)})]}),e.jsxs("div",{className:"mt-4 opacity-70 text-sm",children:["180s (match / career): ",t.one80s]})]},t.id))}),e.jsx("div",{className:"text-center",children:a<=1?e.jsx("div",{className:"text-3xl font-bold text-emerald-400",children:"Good luck â€” Game on! ðŸŽ¯"}):e.jsx("div",{className:"text-lg opacity-70",children:o.map(t=>t.name).join(" vs ")})}),i&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-4",children:[e.jsx("div",{className:"text-sm opacity-70",children:"Bull-up round: indicate result"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>{try{d&&d(50)}catch{}},children:"Hit (Bull 50)"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>{try{d&&d(0)}catch{}},children:"Miss"})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-center opacity-80",children:[i?"Bull-up active â€” throw to win the tie!":"",Object.keys(h||{}).length>0&&e.jsxs("div",{className:"mt-2",children:["Choices: ",Object.entries(h).map(([t,l])=>`${t}:${l}`).join(", ")]})]})]})})})})});return Z.createPortal(e.jsxs(e.Fragment,{children:[S&&e.jsx(z,{}),G]}),document.body)}export{se as M};
//# sourceMappingURL=MatchStartShowcase-D24XUUPz.js.map

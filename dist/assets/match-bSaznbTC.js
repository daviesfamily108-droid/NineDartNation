import{k as u}from"./index-C32VqwCm.js";const g=u((n,s)=>({recent:[],totals:{visits:0,darts:0,points:0,finishes:0,busts:0,byMode:{}},calibration:{hasHomography:!1,imageSize:null,lastUpdated:void 0},recordVisit:(e,r,i,t)=>n(o=>{const a={ts:Date.now(),mode:e,darts:r,visitTotal:i,preOpenDarts:t?.preOpenDarts,preRemaining:t?.preRemaining,postRemaining:t?.postRemaining,bust:t?.bust,finish:t?.finish},l=[...o.recent,a].slice(-50),d={...o.totals};d.visits+=1,d.darts+=r,d.points+=i,a.finish&&(d.finishes+=1),a.bust&&(d.busts+=1);const h=d.byMode[e]||{visits:0,darts:0,points:0};h.visits+=1,h.darts+=r,h.points+=i,d.byMode[e]=h;try{const p=a.finish?"FINISH":a.bust?"BUST":"VISIT";console.info(`[Audit:${p}]`,{mode:e,darts:r,visitTotal:i,preOpenDarts:a.preOpenDarts??0,preRemaining:a.preRemaining,postRemaining:a.postRemaining})}catch{}try{localStorage.setItem("ndn_audit_recent",JSON.stringify(l))}catch{}return{...o,recent:l,totals:d}}),setCalibrationStatus:e=>n(r=>{const i={hasHomography:e.hasHomography??r.calibration.hasHomography,imageSize:e.imageSize===void 0?r.calibration.imageSize:e.imageSize,lastUpdated:Date.now()};try{console.info("[Audit:Calibration]",i)}catch{}return{...r,calibration:i}}),reset:()=>n({recent:[],totals:{visits:0,darts:0,points:0,finishes:0,busts:0,byMode:{}},calibration:{hasHomography:!1,imageSize:null,lastUpdated:void 0}})}));try{typeof window<"u"&&(window.__NDN_AUDIT__={get:()=>g.getState(),subscribe:g.subscribe,reset:()=>g.getState().reset()})}catch{}try{if(typeof window<"u"){const n=localStorage.getItem("ndn_audit_recent");if(n){const s=JSON.parse(n);Array.isArray(s)&&s.length&&g.setState(e=>({...e,recent:s.slice(-50)}))}}}catch{}function f(n){return n.dartsThrown===0?0:(n.totalScoreStart-n.totalScoreRemaining)/n.dartsThrown*3}function m(n){const s=f(n),e=n.finished;return{avg:s,isCompleted:e,darts:n.dartsThrown,checkout:n.checkoutScore??0}}function b(n){if(n.legs.length===0)return;const s=[];let e,r=n.bestCheckout??0;for(const i of n.legs){if(!i.finished)continue;const t=m(i);s.push(t.avg),(!e||t.darts<e.darts||t.darts===e.darts&&(i.endTime??0)<e.timestamp)&&(e={darts:t.darts,timestamp:i.endTime??Date.now()}),t.checkout>r&&(r=t.checkout)}s.length&&(n.bestThreeDartAvg=Math.max(...s),n.worstThreeDartAvg=Math.min(...s)),e&&(n.bestNineDart=e),n.bestCheckout=r}const y=u((n,s)=>({roomId:"",players:[],currentPlayerIdx:0,startingScore:501,inProgress:!1,newMatch:(e,r,i="")=>n(()=>({players:e.map((o,c)=>({id:`${c}`,name:o,legsWon:0,legs:[]})),currentPlayerIdx:0,startingScore:r,inProgress:!0,roomId:i,bestLegThisMatch:void 0})),addVisit:(e,r,i)=>n(t=>{if(!t.inProgress)return t;const o=t.players[t.currentPlayerIdx];let c=o.legs[o.legs.length-1];(!c||c.finished)&&(c={visits:[],totalScoreStart:t.startingScore,totalScoreRemaining:t.startingScore,dartsThrown:0,finished:!1,checkoutScore:null,startTime:Date.now()},o.legs.push(c));const a=c.totalScoreRemaining,l=Math.max(0,a-e);c.visits.push({darts:r,score:e,preOpenDarts:i?.preOpenDarts,doubleWindowDarts:i?.doubleWindowDarts,finishedByDouble:i?.finishedByDouble,visitTotal:i?.visitTotal??e}),c.dartsThrown+=r,c.totalScoreRemaining=l;try{const d=e===0&&r>0&&l===a,h=l===0;g.getState().recordVisit("x01-match",r,e,{preOpenDarts:i?.preOpenDarts??0,preRemaining:a,postRemaining:l,bust:d,finish:h})}catch{}return{...t}}),undoVisit:()=>n(e=>{const r=e.players[e.currentPlayerIdx],i=r.legs[r.legs.length-1];if(!i||i.finished||i.visits.length===0)return e;const t=i.visits.pop();return i.dartsThrown-=t.darts,i.totalScoreRemaining+=t.score,{...e}}),endLeg:e=>n(r=>{const i=r.players[r.currentPlayerIdx],t=i.legs[i.legs.length-1];if(!t||t.finished)return r;if(t.finished=!0,t.checkoutScore=e,t.endTime=Date.now(),t.totalScoreRemaining===0){i.legsWon+=1;const o=r.bestLegThisMatch;(!o||t.dartsThrown<o.darts)&&(r.bestLegThisMatch={playerId:i.id,darts:t.dartsThrown,timestamp:t.endTime})}return{...r}}),nextPlayer:()=>n(e=>({...e,currentPlayerIdx:(e.currentPlayerIdx+1)%e.players.length})),endGame:()=>n(e=>{for(const r of e.players)b(r);return{...e,inProgress:!1}}),importState:e=>n(()=>({...e}))}));export{g as a,y as u};
//# sourceMappingURL=match-bSaznbTC.js.map

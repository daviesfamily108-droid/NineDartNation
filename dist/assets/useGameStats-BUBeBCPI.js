import{t as je,u as P,j as t,n as we,v as Ue,w as Re,x as Ae,y as Be,z as Ie,A as $e,l as Oe,C as Pe,D as Fe,E as He,F as Me,G as We,m as De}from"./index-hEoLjEue.js";import{r as m,m as xe,R as Te,n as _e,o as Ve,Z as Ge}from"./ui-CuWypN7C.js";const Ke={};function lt({label:e,autoStart:n,scale:r,className:l,aspect:s="inherit",style:i,fill:a=!1}){const f=m.useRef(null),p=je(),[w,b]=m.useState(!1),[j,T]=m.useState(null),[g,v]=m.useState(null),[I,S]=m.useState(null),L=m.useRef(null),E=m.useCallback((o,c="local")=>{try{o?(p.setMediaStream(o),f.current&&p.setVideoElementRef(f.current),p.setMode(c),p.setStreaming(!0),L.current=c):L.current&&L.current!=="phone"&&(p.setStreaming(!1),p.setMediaStream(null),L.current=null)}catch(d){console.warn("[CameraTile] Failed to register stream with camera session:",d)}},[p]),D=P(o=>o.preferredCameraLabel),[y,$]=m.useState(()=>{if(D==="Phone Camera")return console.log("[CAMERATILE] Initializing mode to phone (from preferred camera selection)"),"phone";const o=localStorage.getItem("ndn:camera:mode");return console.log("[CAMERATILE] Initializing mode to",o||"local","(from localStorage)"),o||"local"}),[U,F]=m.useState(null),[X,Q]=m.useState(Date.now()),[Y,R]=m.useState(!1),[O,W]=m.useState(null),[A,ae]=m.useState(null),[G,le]=m.useState(!0),[ce,K]=m.useState([]),[Z,k]=m.useState(!1),[de,H]=m.useState([]),[ue,q]=m.useState(!1),_=P(o=>o.autoscoreProvider),ne=P(o=>o.cameraEnabled),ee=P(o=>o.setPreferredCameraLocked);P(o=>o.preferredCameraLocked);const te=P(o=>o.setPreferredCamera),fe=P(o=>o.preferredCameraId);if(_==="manual"){const c=[a?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",l].filter(Boolean).join(" ").trim(),d={...i||{}};return!a&&d.aspectRatio===void 0&&d.height===void 0&&d.minHeight===void 0&&(d.aspectRatio="4 / 3"),t.jsx("div",{className:c,style:d,children:t.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}m.useEffect(()=>{const o=window.location.hostname;(o==="localhost"||o==="127.0.0.1")&&we("/api/hosts").then(c=>c.json()).then(c=>{const d=Array.isArray(c?.hosts)&&c.hosts.find(u=>u);d&&W(d)}).catch(()=>{}),we("/api/https-info").then(c=>c.json()).then(c=>{c&&typeof c.https=="boolean"&&ae({https:!!c.https,port:Number(c.port)||8788})}).catch(()=>{})},[]);const re=m.useMemo(()=>{const o=g||"____",c="ws://localhost:8787";if(c.length>0)try{const V=new URL(c);return`${`${V.protocol==="wss:"?"https":"http"}://${V.host}${V.pathname.endsWith("/ws")?"":V.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${o}`}catch{}const d=O||window.location.hostname,u=!!A?.https,C=u?A?.port||8788:8787;return`${u?"https":"http"}://${d}:${C}/mobile-cam.html?code=${o}`},[g,O,A]);m.useEffect(()=>{console.log("[CAMERATILE] Mode changed to:",y,"- persisting to localStorage"),localStorage.setItem("ndn:camera:mode",y)},[y]),m.useEffect(()=>{const o=P.getState().ignorePreferredCameraSync;console.log("[CAMERATILE] Checking camera selection sync: preferredCameraLabel=",D,"mode=",y,"ignoreSync=",o,"manualModeSetAt=",z),!o&&(z&&Date.now()-z<3e4||D==="Phone Camera"&&y!=="phone"&&(console.log("[CAMERATILE] Syncing mode to phone from Calibrator selection"),$("phone")))},[D,y,z]);const[se,ie]=m.useState(""),[z,me]=m.useState(null);m.useEffect(()=>{if(!g){ie("");return}const o=Ke?.VITE_QR_LOGO_URL||"/dart-thrower.svg";Ue(re,{width:160,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"},logo:{logoUrl:o,logoScale:.2,mask:!0,shape:"circle"}}).then(ie).catch(()=>ie(""))},[re,g]),m.useEffect(()=>{if(!U)return;const o=setInterval(()=>Q(Date.now()),1e3);return()=>clearInterval(o)},[U]);const h=m.useMemo(()=>U?Math.max(0,Math.ceil((U-X)/1e3)):null,[U,X]);m.useEffect(()=>{if(!(!ne||_==="manual")&&n!==void 0){if(n){let o=!1;const c=D||"default",d=window.setTimeout(()=>{o||w||N().catch(u=>console.warn(`[CameraTile] Auto-start failed for ${c}:`,u))},200);return()=>{o=!0,window.clearTimeout(d)}}B()}},[n,w,ne,_,D,N,B]),m.useEffect(()=>{const o=async()=>{try{if(!(D==="Phone Camera"&&(!z||Date.now()-z>=3e4)||y==="phone"))return;const u=p.getMediaStream(),C=f.current;if(!C||!u)return;C.srcObject!==u&&(C.srcObject=u),C.muted=!0,C.playsInline=!0;try{await C.play()}catch{}b(!0)}catch{}};o();const c=setInterval(o,800);return()=>clearInterval(c)},[D,y,p,p.isStreaming]);async function N(){if(console.log("[CameraTile] start() invoked with mode=",y),y==="wifi")return he();if(console.log("[CameraTile] Attempting to attach global stream for phone mode..."),D==="Phone Camera"||y==="phone"){const o=p.getMediaStream();if(o&&f.current)try{f.current.srcObject=o,await f.current.play(),b(!0);return}catch{}if(y==="phone")try{await oe();return}catch{}}try{const{preferredCameraId:o,setPreferredCamera:c}=P.getState(),d=o?{video:{deviceId:{exact:o}},audio:!1}:{video:!0,audio:!1};let u;try{u=await navigator.mediaDevices.getUserMedia(d)}catch(C){const M=C&&(C.name||C.code)||"";if(o&&(M==="OverconstrainedError"||M==="NotFoundError"))u=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw C}f.current&&(f.current.srcObject=u,await f.current.play(),b(!0),E(u,"local"))}catch{}}function B(){f.current&&f.current.srcObject&&(f.current.srcObject.getTracks().forEach(c=>c.stop()),f.current.srcObject=null,b(!1),E(null))}async function he(){k(!0);try{const o=await Re();K(o),o.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(o){console.error("Wifi device discovery failed:",o),alert("Failed to discover wifi devices. Please check your network connection.")}finally{k(!1)}}async function Se(o){try{K(d=>d.map(u=>u.id===o.id?{...u,status:"connecting"}:u));const c=await Ae(o);if(c&&f.current)f.current.srcObject=c,await f.current.play(),b(!0),E(c,"wifi"),K(d=>d.map(u=>u.id===o.id?{...u,status:"online"}:u));else throw new Error("Failed to get video stream")}catch(c){console.error("Failed to connect to wifi device:",c),alert(`Failed to connect to ${o.name}. Please check the device and try again.`),K(d=>d.map(u=>u.id===o.id?{...u,status:"offline"}:u))}}async function be(){q(!0);try{const o=await Be();H(o);const c=await Ie();c&&H(d=>[...d,c]),o.length===0&&!c&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(o){console.error("USB device discovery failed:",o),alert("Failed to discover USB devices. Please check device connections.")}finally{q(!1)}}m.useEffect(()=>{const o=c=>{try{const d=c&&c.detail&&c.detail.mode;d&&["local","phone","wifi","usb"].includes(d)?(pe(d),N().catch(()=>{})):N().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",o),()=>{window.removeEventListener("ndn:start-camera",o)}},[N,pe]);async function ye(o){try{H(d=>d.map(u=>u.id===o.id?{...u,status:"connecting"}:u));const c=await $e(o);if(c&&f.current)f.current.srcObject=c,await f.current.play(),b(!0),$("wifi"),E(c,"wifi"),H(d=>d.map(u=>u.id===o.id?{...u,status:"online"}:u));else throw new Error("Failed to get video stream")}catch(c){console.error("Failed to connect to USB device:",c),alert(`Failed to connect to ${o.name}. Please check the device and try again.`),H(d=>d.map(u=>u.id===o.id?{...u,status:"offline"}:u))}}const pe=m.useCallback(o=>{try{$(o==="usb"?"wifi":o),me(Date.now());try{if(o==="local"){try{te(fe,"Local",!0)}catch{}try{ee(!0)}catch{}}else if(o==="phone"){try{te(void 0,"Phone Camera",!0)}catch{}try{ee(!0)}catch{}}else if(o==="wifi"||o==="usb"){try{te(void 0,"WiFi/USB",!0)}catch{}try{ee(!0)}catch{}}}catch{}o==="local"?N().catch(()=>{}):o==="phone"?oe():o==="wifi"?he():o==="usb"&&be()}catch(c){console.warn("[CameraTile] handleModeSelect failed",c)}},[N,oe,he,be,te,ee,fe]);function ke(){if(j&&j.readyState===WebSocket.OPEN)return j;const o="ws://localhost:8787",c=o.length>0?o.endsWith("/ws")?o:o.replace(/\/$/,"")+"/ws":void 0,d=window.location.protocol==="https:"?"wss":"ws",u=`${d}://${window.location.host}/ws`,C=window.location.hostname,M=C==="localhost"||C==="127.0.0.1",V=C.endsWith("onrender.com"),ve="wss://ninedartnation.onrender.com/ws";let J=c;J||(M?J=`${d}://${C}:8787/ws`:V?J=u:J=ve),J||(J=u);const ge=new WebSocket(J);return T(ge),ge}async function oe(){$("phone"),R(!1);const o=ke();o.readyState===WebSocket.OPEN?o.send(JSON.stringify({type:"cam-create"})):o.onopen=()=>o.send(JSON.stringify({type:"cam-create"})),o.onmessage=async c=>{const d=JSON.parse(c.data);if(d.type==="cam-code")v(d.code),d.expiresAt&&F(d.expiresAt);else if(d.type==="cam-peer-joined"){R(!0);const u=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});S(u),u.onicecandidate=M=>{M.candidate&&g&&o.send(JSON.stringify({type:"cam-ice",code:g,payload:M.candidate}))},u.ontrack=M=>{if(f.current){const V=M.streams?.[0];V&&(f.current.srcObject=V,f.current.play().catch(()=>{}),b(!0))}};const C=await u.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await u.setLocalDescription(C),g&&o.send(JSON.stringify({type:"cam-offer",code:g,payload:C}))}else if(d.type==="cam-answer")I&&await I.setRemoteDescription(new RTCSessionDescription(d.payload));else if(d.type==="cam-ice"&&I)try{await I.addIceCandidate(d.payload)}catch{}}}function Le(){v(null),F(null),R(!1),j&&j.readyState===WebSocket.OPEN?j.send(JSON.stringify({type:"cam-create"})):oe();try{ee(!0)}catch{}}function Ee(){if(B(),v(null),R(!1),F(null),I){try{I.close()}catch{}S(null)}}return t.jsx(qe,{label:e,autoStart:n,start:N,stopAll:Ee,startPhonePairing:oe,startWifiConnection:he,startUsbConnection:be,connectToWifiDevice:Se,connectToUsbDevice:ye,videoRef:f,streaming:w,mode:y,setMode:$,pairCode:g,mobileUrl:re,ttl:h,qrDataUrl:se,regenerateCode:Le,httpsInfo:A,showTips:G,setShowTips:le,wifiDevices:ce,usbDevices:de,discoveringWifi:Z,discoveringUsb:ue,scaleOverride:r,className:l,aspect:s,style:i,fill:a,onModeSelect:pe})}function qe(e){const n=je(),{cameraScale:r,cameraAspect:l}=P(),{label:s,start:i,stopAll:a,startPhonePairing:f,startWifiConnection:p,startUsbConnection:w,connectToWifiDevice:b,connectToUsbDevice:j,videoRef:T,streaming:g,mode:v,setMode:I,onModeSelect:S,pairCode:L,mobileUrl:E,ttl:D,qrDataUrl:y,regenerateCode:$,httpsInfo:U,showTips:F,setShowTips:X,wifiDevices:Q,usbDevices:Y,discoveringWifi:R,discoveringUsb:O,className:W,aspect:A,style:ae,fill:G}=e,le={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},ce=m.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{S&&S("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{S&&S("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{S&&S("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{S&&S("usb")}}],[I,i,f,p,w]),[K,Z]=m.useState(null),k=m.useRef(null);m.useEffect(()=>()=>{k.current&&window.clearTimeout(k.current)},[]);const{cameraFitMode:de}=P(),H=G?"fill":de||"fill",ue=(()=>{const h=Number(e.scaleOverride??r??1),N=Math.max(.5,Math.min(1.25,h));return H==="fill"?Math.max(1,N):N})(),q=G&&H==="fill"?"free":A&&A!=="inherit"?A:l||"wide",_=q!=="free",ne=_?q==="square"?"aspect-square":q==="portrait"?"aspect-[3/4]":q==="classic"?"aspect-[4/3]":"aspect-video":"",te=[G?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",W].filter(Boolean).join(" ").trim(),fe={...ae||{}},re=G?"relative flex-1 min-h-[420px] bg-black":"relative w-full bg-black",se={style:{transform:`scale(${ue})`,transformOrigin:"center"}},ie=v==="wifi"&&Y.some(h=>h.status==="online"),z=(()=>{const N=H==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return G?_?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:`relative w-full max-w-full max-h-full ${ne}`,children:t.jsx("video",{ref:T,className:N,...se})})}):t.jsx("video",{ref:T,className:N,...se}):_?t.jsx("div",{className:`relative w-full ${ne}`,children:t.jsx("video",{ref:T,className:N,...se})}):t.jsx("video",{ref:T,className:N,...se})})();async function me(h,N){if(h)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(h);else{const B=document.createElement("textarea");B.value=h,B.style.position="fixed",B.style.opacity="0",document.body.appendChild(B),B.focus(),B.select(),document.execCommand("copy"),document.body.removeChild(B)}Z(N),k.current&&window.clearTimeout(k.current),k.current=window.setTimeout(()=>Z(null),1500)}catch(B){console.warn("Copy to clipboard failed:",B),Z(null)}}return t.jsxs("div",{className:te,style:fe,children:[t.jsxs("div",{className:re,children:[z,n.isStreaming&&v==="phone"&&t.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[t.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),t.jsx("span",{children:"REC"})]})]}),t.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[t.jsxs("span",{className:"truncate font-medium",children:[s||(g?v==="phone"?"PHONE LIVE":v==="wifi"?"WIFI LIVE":"LIVE":"Camera"),preferredCameraLocked&&t.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!g&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>(S||handleModeSelect)("local"),children:"Local"}),t.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>(S||handleModeSelect)("phone"),children:"Phone"}),t.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>(S||handleModeSelect)("wifi"),children:"WiFi"}),t.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>(S||handleModeSelect)("usb"),children:"USB"})]}),g?t.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:a,children:"Stop"}):null]})]}),v==="phone"&&L&&!g&&t.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[t.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),t.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>me(E,"link"),title:"Copy mobile camera link",children:[t.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:E}),t.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:K==="link"?"Copied!":"Copy"})]}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.jsx("a",{href:E,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),t.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>me(L,"code"),title:"Copy pairing code",children:[t.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:L}),t.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:K==="code"?"Copied!":"Copy"})]})]}),y&&t.jsx("img",{className:"mt-1 w-[160px] h-[160px] bg-white rounded",alt:"Scan to open",src:y}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[D!==null&&t.jsxs("span",{children:["Expires in ",D,"s"]}),t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:$,children:"Regenerate"})]}),F&&t.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[t.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),t.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[t.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),t.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",U?.https?U.port:8788,")."]}),t.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),t.jsx("div",{className:"mt-2 text-right",children:t.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>X(!1),children:"Hide tips"})})]})]}),v==="wifi"&&!g&&t.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[t.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),R?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),t.jsx("span",{children:"Scanning network..."})]}):Q.length>0?t.jsxs("div",{className:"space-y-1",children:[Q.map(h=>t.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium truncate",children:h.name}),t.jsxs("div",{className:"opacity-70 text-[9px]",children:[h.ip,":",h.port]})]}),t.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${h.status==="connecting"?"bg-yellow-600":h.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>b(h),disabled:h.status==="connecting",children:h.status==="connecting"?"...":"Connect"})]},h.id)),t.jsx("div",{className:"text-center mt-2",children:t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:p,children:"Rescan WiFi"})})]}):t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:p,children:"Scan WiFi"})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),O?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),t.jsx("span",{children:"Scanning USB..."})]}):Y.length>0?t.jsxs("div",{className:"space-y-1",children:[Y.map(h=>t.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium truncate",children:h.name}),t.jsx("div",{className:"opacity-70 text-[9px]",children:h.type.toUpperCase()})]}),t.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${h.status==="connecting"?"bg-yellow-600":h.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>j(h),disabled:h.status==="connecting",children:h.status==="connecting"?"...":"Connect"})]},h.id)),t.jsx("div",{className:"text-center mt-2",children:t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:w,children:"Rescan USB"})})]}):t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:w,children:"Scan USB"})]})]})]}),!g&&t.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes"}),t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera"})]}),t.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",le[v]||"Local"]})]}),t.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:ce.map(h=>{const N=h.id==="usb"?ie:h.id===v;return t.jsxs("button",{type:"button",onClick:h.action,className:`text-left p-3 rounded-2xl border ${N?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:h.title}),t.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:h.description}),N&&t.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},h.id)})})]})]})}const ze=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function Je(e){return e==="DB"?50:Number(e.slice(1))*2}function Xe(e){return ze.includes(e)?Je(e):32}function ct(e,n="D16"){if(e>170||e<=1)return[];const r={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(r[e])return r[e];const l=Xe(n),s=[];for(const i of[60,57,54,51,48])if(e-i===l){s.push(`T${i/3} ${n}`);break}if(!s.length){for(const i of[20,19,18,17,16,15])if(e-i===l){s.push(`${i} ${n}`);break}}return s}function dt(e,n,r,l,s){try{const i=window.speechSynthesis;if(!i)return;const a=new SpeechSynthesisUtterance,f=r<=170&&r>0,p=n===180;if(!(!s?.checkoutOnly||f||p))return;if(p?(a.text=`${e}! One eighty!`,a.rate=1.04,a.pitch=1.15):f?(a.text=`${e}, ${r} remaining.`,a.rate=1,a.pitch=1):n===0?(a.text=`${e}, no score.`,a.rate=1,a.pitch=1):(a.text=`${e}, ${n}.`,a.rate=1,a.pitch=1),l){const b=i.getVoices().find(j=>j.name===l);b&&(a.voice=b)}typeof s?.volume=="number"?a.volume=Math.max(0,Math.min(1,s.volume)):a.volume=1;try{i.cancel()}catch{}i.speak(a)}catch{}}function ut({gameMode:e,compact:n=!1,onRecalibrate:r}){const{H:l,errorPx:s}=Oe(),i=Pe(e,s),a=Fe(e,s),{quality:f,text:p}=He(e,s),w=Me(e),b=We[e];if(!l||!s)return n?t.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30",children:[t.jsx(xe,{className:"w-3 h-3"}),"Not calibrated"]}):t.jsxs("div",{className:"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2",children:[t.jsx(xe,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-red-300",children:"Calibration Required"}),t.jsxs("div",{className:"text-xs opacity-80",children:["Please calibrate before playing ",e]})]}),r&&t.jsx("button",{className:"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700",onClick:r,children:"Calibrate"})]});const j=a?"bg-emerald-500/20 border-emerald-600/30":"bg-amber-500/20 border-amber-600/30",T=a?"text-emerald-300":"text-amber-300",g=a?_e:xe;return n?t.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${j} ${T}`,children:[Te.createElement(g,{className:"w-3 h-3"}),t.jsx("span",{children:p}),!a&&w&&t.jsx("span",{className:"w-3 h-3 cursor-help",title:w,children:t.jsx(Ve,{className:"w-3 h-3 inline"})})]}):t.jsxs("div",{className:`px-3 py-2 rounded border ${j} space-y-1`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[Te.createElement(g,{className:`w-4 h-4 ${a?"text-emerald-400":"text-amber-400"} flex-shrink-0`}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:`font-medium ${a?"text-emerald-300":"text-amber-300"}`,children:["Calibration for ",e]}),t.jsxs("div",{className:"text-xs opacity-80",children:["Error: ",Math.round(s),"px | ",p]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-1 h-1.5 rounded bg-black/30 overflow-hidden",children:t.jsx("div",{className:`h-full transition-all ${a?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Math.min(100,i)}%`}})}),t.jsxs("span",{className:"text-xs font-mono",children:[Math.round(i),"%"]})]}),b&&t.jsx("div",{className:"text-xs opacity-75",children:t.jsxs("div",{children:["Tolerance: Â±",b.tolerancePx,"px | Min: ",b.minConfidence,"%"]})}),t.jsxs("div",{className:"space-y-1",children:[!a&&t.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1",children:[t.jsx(xe,{className:"w-3 h-3 flex-shrink-0"}),"Calibration quality is below minimum for ",e]}),w&&t.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1",children:[t.jsx(Ge,{className:"w-3 h-3 flex-shrink-0"}),w]})]}),!a&&r&&t.jsxs("button",{className:"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700",onClick:r,children:["Recalibrate for ",e]})]})}function ft({left:e,right:n,className:r="",sticky:l=!0}){return t.jsxs("div",{className:`${l?"sticky top-0":""} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${r}`,children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),t.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:e}),t.jsx("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:n})]})}const Qe=[...Array.from({length:20},(e,n)=>({label:`D${n+1}`,score:(n+1)*2})),{label:"DBULL",score:50,isBull:!0}];function mt(e,n){const r=Qe[n];return!!r&&e===r.score}function ht(e){const n=e.trim().toUpperCase();if(!n)return null;if(n==="50"||n==="BULL"||n==="DBULL"||n==="IBULL")return 50;if(n==="25"||n==="OBULL")return 25;const r=n.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!r)return null;const l=r[1]||"S",s=parseInt(r[2],10);return s<1||s>20?null:s*(l==="S"?1:l==="D"?2:3)}const xt=[...Array.from({length:20},(e,n)=>n+1),25,50],Ne=[20,19,18,17,16,15,25];function bt(){const e={};return Ne.forEach(n=>{e[n]=0}),{marks:e,points:0}}function pt(e,n,r,l,s=()=>!1){let i=null,a=0;if(r==="BULL"||r==="INNER_BULL"||n===25||n===50)i=25,a=r==="INNER_BULL"||n===50?2:1;else if(typeof l=="number"&&l>=15&&l<=20)i=l,r==="TRIPLE"?a=3:r==="DOUBLE"?a=2:a=1;else if(n){const g=[20,19,18,17,16,15];for(const v of g){if(n===v){i=v,a=1;break}if(n===v*2){i=v,a=2;break}if(n===v*3){i=v,a=3;break}}!i&&(n===25||n===50)&&(i=25,a=n===50?2:1)}if(!i)return 0;const f=e.marks[i];let p=Math.max(0,3-f);const w=Math.min(p,a),b=Math.max(0,a-w),j=f+w;e.marks[i]=j>3?3:j;let T=0;return b>0&&!s(i)&&(i===25?r==="INNER_BULL"?T+=50*b:T+=25*b:T+=i*b),e.points+=T,T}function gt(e){return Ne.every(n=>(e.marks[n]||0)>=3)}function vt(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function Ye(e){return e.round}function wt(e,n,r,l){if(e.finished)return 0;const s=Ye(e);let i=0;return typeof l=="number"&&l===s?r==="TRIPLE"?(i=s*3,e.turnHits.triples++):r==="DOUBLE"?(i=s*2,e.turnHits.doubles++):r==="SINGLE"&&(i=s*1,e.turnHits.singles++):!l&&(n===s||n===s*2||n===s*3)&&(n===s*3?(i=s*3,e.turnHits.triples++):n===s*2?(i=s*2,e.turnHits.doubles++):n===s&&(i=s,e.turnHits.singles++)),e.score+=i,i}function Tt(e){if(!e.finished){if(e.turnHits.singles>0&&e.turnHits.doubles>0&&e.turnHits.triples>0){e.shanghaiAchieved=!0,e.finished=!0;return}const n=e.round+1;n>20?e.finished=!0:e.round=n}e.turnHits={singles:0,doubles:0,triples:0}}function jt(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function Ze(e){return e.targets[e.stage]||null}function Dt(e,n,r,l){if(e.finished)return 0;const s=Ze(e);if(!s)return 0;let i=0;switch(s.kind){case"NUMBER":{typeof l=="number"&&l===s.num?r==="TRIPLE"?i=s.num*3:r==="DOUBLE"?i=s.num*2:r==="SINGLE"&&(i=s.num):!l&&(n===s.num||n===s.num*2||n===s.num*3)&&(i=n),i>0&&(e.hitThisRound=!0);break}case"DOUBLE":{(r==="DOUBLE"&&l===s.num||n===s.num*2)&&(i=s.num*2,e.hitThisRound=!0);break}case"TRIPLE":{(r==="TRIPLE"&&l===s.num||n===s.num*3)&&(i=s.num*3,e.hitThisRound=!0);break}case"BULL":{(r==="BULL"||r==="INNER_BULL"||n===25||n===50)&&(i=r==="INNER_BULL"||n===50?50:25,e.hitThisRound=!0);break}case"ANY_NUMBER":{n>0&&(i=n,e.hitThisRound=!0);break}}return e.score+=i,i}function Nt(e){e.finished||(e.hitThisRound||(e.score=Math.floor(e.score/2)),e.hitThisRound=!1,e.stage+=1,e.stage>=e.targets.length&&(e.finished=!0))}function Ct(){return{round:1,score:0,target:"HIGH",finished:!1}}function St(e,n,r,l){if(e.finished)return 0;let s=0;if(e.target==="HIGH")if(r==="INNER_BULL")s=50;else if(typeof l=="number"){const a=l*(r==="TRIPLE"?3:r==="DOUBLE"?2:1);l>=20&&(s=a)}else n>=40&&(s=n);else if(typeof l=="number"){const a=l*(r==="TRIPLE"?3:r==="DOUBLE"?2:1);l<=10&&(s=a)}else n>0&&n<=30&&(s=n);return e.score+=s,s}function yt(e){if(!e.finished){if(e.round+=1,e.round>10){e.finished=!0;return}e.target=e.target==="HIGH"?"LOW":"HIGH"}}function kt(e,n=3){return{number:e,lives:n,isKiller:!1,eliminated:!1}}function Lt(e){const n=Array.from({length:20},(l,s)=>s+1),r={};for(const l of e){const s=Math.floor(Math.random()*n.length),i=n.splice(s,1)[0];r[l]=i}return r}function Et(e,n,r,l){const s=n[e];if(!s||!l||!r)return{becameKiller:!1};if(!s.isKiller&&r==="DOUBLE"&&l===s.number)return s.isKiller=!0,{becameKiller:!0};if(s.isKiller&&(r==="DOUBLE"||r==="TRIPLE")){const i=Object.keys(n).find(a=>a!==e&&!n[a].eliminated&&n[a].number===l);if(i){const a=n[i],f=r==="TRIPLE"?2:1;return a.lives=Math.max(0,a.lives-f),a.lives===0&&(a.eliminated=!0),{becameKiller:!1,victimId:i,livesRemoved:f}}}return{becameKiller:!1}}function Ut(e){const n=Object.entries(e).filter(([,r])=>!r.eliminated&&r.lives>0);return n.length===1?n[0][0]:null}const Ce=[20,19,18,17,16,15,14,13,12,25];function Rt(){const e={};return Ce.forEach(n=>{e[n]=0}),{marks:e,points:0}}function At(e,n,r,l,s=()=>!1){let i=null,a=0;if(r==="BULL"||r==="INNER_BULL"||n===25||n===50)i=25,a=r==="INNER_BULL"||n===50?2:1;else if(typeof l=="number"&&l>=12&&l<=20)i=l,r==="TRIPLE"?a=3:r==="DOUBLE"?a=2:a=1;else if(n){for(const g of[20,19,18,17,16,15,14,13,12]){if(n===g){i=g,a=1;break}if(n===g*2){i=g,a=2;break}if(n===g*3){i=g,a=3;break}}!i&&(n===25||n===50)&&(i=25,a=n===50?2:1)}if(!i)return 0;const f=e.marks[i],p=Math.max(0,3-f),w=Math.min(p,a),b=Math.max(0,a-w),j=f+w;e.marks[i]=j>3?3:j;let T=0;return b>0&&!s(i)&&(i===25?r==="INNER_BULL"?T+=50*b:T+=25*b:T+=i*b),e.points+=T,T}function Bt(e){return Ce.every(n=>(e.marks[n]||0)>=3)}function It(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function $t(e,n,r,l){if(e.finished)return 0;let s=0;if(typeof l=="number"&&l===e.inning?r==="TRIPLE"?s=3:r==="DOUBLE"?s=2:s=1:!l&&(n===e.inning||n===e.inning*2||n===e.inning*3)&&(s=n===e.inning*3?3:n===e.inning*2?2:1),e.score+=s,e.dartsThisInning+=1,e.dartsThisInning>=3){const i=e.inning+1;i>9?e.finished=!0:(e.inning=i,e.dartsThisInning=0)}return s}const et={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function Ot(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function Pt(e,n,r,l){if(e.finished)return!1;const s=et[e.hole];if(e.dartsThisHole+=1,typeof l=="number"&&l===s&&(r==="SINGLE"||r==="DOUBLE"||r==="TRIPLE")||!l&&(n===s||n===s*2||n===s*3)){e.strokes+=e.dartsThisHole;const a=e.hole+1;return a>18?e.finished=!0:(e.hole=a,e.dartsThisHole=0),!0}if(e.dartsThisHole>=3){e.strokes+=3;const a=e.hole+1;a>18?e.finished=!0:(e.hole=a,e.dartsThisHole=0)}return!1}const tt={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function Ft(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function st(e){const n=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[r,l,s]of n)if(e[r]&&e[r]===e[l]&&e[r]===e[s])return e[r];return e.every(r=>r)?"Draw":null}function Ht(e,n,r,l,s){if(e.finished||e.board[n])return!1;const i=tt[n];let a=!1;if(i.type==="BULL"?a=l==="BULL"||l==="INNER_BULL"||r===25||r===50:i.type==="NUM"&&typeof i.num=="number"&&(typeof s=="number"&&s===i.num||!s&&(r===i.num||r===i.num*2||r===i.num*3))&&(a=!0),!a)return!1;e.board[n]=e.turn;const f=st(e.board);return f?(e.finished=!0,e.winner=f,!0):(e.turn=e.turn==="X"?"O":"X",!0)}function Mt({gameMode:e,players:n,matchScore:r,gameRules:l}){return!n||n.length===0?null:t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:n.map((s,i)=>t.jsxs("div",{className:`rounded-lg border p-3 ${s.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[t.jsx("div",{className:`text-sm font-semibold mb-2 uppercase tracking-wide ${s.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:s.name}),t.jsxs("div",{className:"space-y-1 text-sm",children:[e==="X01"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Legs Won",value:`â— ${s.legsWon||0}`,highlight:!0}),t.jsx(x,{label:"Score",value:s.score||0,mono:!0,bold:!0}),t.jsx(x,{label:"Last Score",value:s.lastScore||"0",mono:!0}),t.jsx(x,{label:"C/Out Rate",value:`${s.checkoutRate||0}%`,mono:!0}),t.jsx(x,{label:"Best Leg",value:s.bestLeg||"â€”",mono:!0}),s.matchAvg!==void 0&&s.allTimeAvg!==void 0&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[t.jsx(x,{label:"Match Avg",value:s.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:s.matchAvg>0}),t.jsx(nt,{matchAvg:s.matchAvg,allTimeAvg:s.allTimeAvg})]})})]}),(e==="Cricket"||e==="American Cricket")&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Closed",value:rt(s.closed),mono:!0}),t.jsx(x,{label:"Points",value:s.points||0,mono:!0,bold:!0}),t.jsx(x,{label:"Status",value:it(s),highlight:s.isCurrentTurn})]}),(e==="Shanghai"||e==="Halve It")&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:e==="Shanghai"?"Round":"Stage",value:s.round||1,mono:!0}),t.jsx(x,{label:"Target",value:s.target||"â€”",mono:!0}),t.jsx(x,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Killer"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Target #",value:s.number||"â€”",mono:!0,bold:!0}),t.jsx(x,{label:"Lives",value:s.lives||0,mono:!0,bold:!0}),s.eliminated&&t.jsx(x,{label:"Status",value:"ELIMINATED",highlight:!1})]}),e==="High-Low"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Round",value:s.round||1,mono:!0}),t.jsx(x,{label:"Target",value:s.target||"High",mono:!0}),t.jsx(x,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),(e==="Double Practice"||e==="Treble Practice"||e==="Around the Clock")&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Target",value:s.target||"â€”",mono:!0,bold:!0}),t.jsx(x,{label:"Hits",value:s.hits||0,mono:!0,bold:!0}),s.totalNeeded&&t.jsx(x,{label:"Progress",value:`${s.hits||0} / ${s.totalNeeded}`,mono:!0})]}),(e==="Count-Up"||e==="High Score"||e==="Low Score")&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Round",value:s.round||1,mono:!0}),t.jsx(x,{label:"Score",value:s.score||0,mono:!0,bold:!0}),e==="High Score"&&t.jsx(x,{label:"Best",value:s.bestScore||0,mono:!0})]}),(e==="Checkout 170"||e==="Checkout 121")&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Remaining",value:s.remaining||0,mono:!0,bold:!0}),t.jsx(x,{label:"Attempts",value:s.attempts||0,mono:!0}),t.jsx(x,{label:"Successes",value:s.successes||0,mono:!0})]}),e==="Bob's 27"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Target",value:`D${s.target||1}`,mono:!0,bold:!0}),t.jsx(x,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Baseball"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Inning",value:s.inning||1,mono:!0}),t.jsx(x,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Golf"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Hole",value:s.hole||1,mono:!0}),t.jsx(x,{label:"Strokes",value:s.strokes||0,mono:!0,bold:!0})]}),e==="Tic Tac Toe"&&t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"Turn",value:s.turn||1,mono:!0}),s.winner&&t.jsx(x,{label:"Result",value:"WINNER!",highlight:!0})]}),r&&(e==="X01"||e==="Cricket"||e==="American Cricket")&&i===1&&t.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:t.jsx(x,{label:"Match",value:r,mono:!0,bold:!0,highlight:!0})})]})]},i))})}function x({label:e,value:n,mono:r=!1,bold:l=!1,highlight:s=!1}){return t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"opacity-70",children:[e,":"]}),t.jsx("span",{className:`${r?"font-mono":""} ${l?"font-semibold":""} ${s?"text-emerald-300":""}`,children:n})]})}function nt({matchAvg:e,allTimeAvg:n}){const r=e-n,l=r>0,s=Math.abs(r)<.01;let i="",a="text-slate-300";return s?(i="= All-time",a="text-slate-300"):l?(i=`+${r.toFixed(2)} vs avg`,a="text-emerald-400"):(i=`${r.toFixed(2)} vs avg`,a="text-orange-400"),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"opacity-70",children:"AVG vs Avg:"}),t.jsx("span",{className:`font-mono font-semibold ${a}`,children:i})]})}function rt(e){return!e||Object.keys(e).length===0?"â€”":Object.entries(e).filter(([r,l])=>l===3).map(([r])=>r==="25"?"B":r).join(",")||"â€”"}function it(e){if(!e.closed)return"Starting";const n=Object.values(e.closed).filter(r=>r===3).length;return n===0?"No marks":n<7?`${n}/7`:"Closing in"}function Wt(e,n,r,l,s,i,a,f,p,w,b,j,T,g,v,I,S,L,E,D,y,$,U,F,X,Q,Y){return m.useMemo(()=>{const R=[];if(e==="X01"){let O=0,W=0,A=0;if(L&&L.length>0){for(const k of L)k.dartsThrown&&k.totalScored&&(W+=k.dartsThrown,A+=k.totalScored);W>0&&(O=A/W*3)}const Z=(j??0)>0?f??0:w??null??(i??0);if(R.push({name:"You",isCurrentTurn:!!E,legsWon:l||0,score:n||0,lastScore:Z,checkoutRate:v&&v>0?Math.round((g||0)/v*100):0,bestLeg:L&&L.length>0?`${Math.min(...L.map(k=>k.doubleDarts+(k.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:O,allTimeAvg:De("You")||0}),D&&D!=="None"){const _=(T??0)>0?p??0:b??null??(a??0);R.push({name:`${D} AI`,isCurrentTurn:!E,legsWon:s||0,score:r||0,lastScore:_,checkoutRate:S&&S>0?Math.round((I||0)/S*100):0,bestLeg:"â€”"})}}return e==="Cricket"&&(R.push({name:"You",isCurrentTurn:!!E,closed:$?.marks||{},points:$?.points||0}),D&&D!=="None"&&R.push({name:`${D} AI`,isCurrentTurn:!E,closed:{},points:0})),e==="Shanghai"&&(R.push({name:"You",isCurrentTurn:!!E,round:U?.round||1,target:U?.target||1,score:U?.score||0}),D&&D!=="None"&&R.push({name:`${D} AI`,isCurrentTurn:!E,round:U?.round||1,target:U?.target||1,score:0})),e==="Killer"&&F&&F.length>0&&F.forEach((O,W)=>{const A=X?.[O.id];R.push({name:O.name,isCurrentTurn:W===Y,number:Q?.[O.id],lives:A?.lives||0,eliminated:A?.eliminated||!1})}),R},[e,n,r,l,s,i,a,f,p,w,b,j,T,g,v,I,S,L,E,D,$,U,F,X,Q,Y])}function _t(e,n,r){return m.useMemo(()=>{const l=[];return!n||!n.players||n.players.length===0||n.players.forEach((s,i)=>{const a=i===n.currentPlayerIdx;if(e==="X01"){let f=0,p=0,w=0;if(s.legs&&s.legs.length>0){for(const b of s.legs)if(b.finished){const j=b.dartsThrown||0,T=Math.max(0,b.totalScoreStart-b.totalScoreRemaining)||0;p+=j,w+=T}}p>0&&(f=w/p*3),l.push({name:s.name||`Player ${i+1}`,isCurrentTurn:a,legsWon:s.legsWon||0,score:s.score||0,lastScore:s.lastVisitScore||0,checkoutRate:s.doublesAttempted>0?Math.round(s.doublesHit/s.doublesAttempted*100):0,bestLeg:s.bestLegDarts?`${s.bestLegDarts} darts`:"â€”",matchAvg:f,allTimeAvg:s.name?De(s.name):0})}e==="Cricket"&&l.push({name:s.name||`Player ${i+1}`,isCurrentTurn:a,closed:s.cricket?.marks||{},points:s.cricket?.points||0}),e==="Killer"&&l.push({name:s.name||`Player ${i+1}`,isCurrentTurn:a,number:s.killerNumber||null,lives:s.killerLives||3,eliminated:s.killerEliminated||!1})}),l},[e,n,r])}export{xt as A,At as B,Ne as C,Qe as D,pt as E,wt as F,ut as G,Tt as H,Dt as I,Nt as J,St as K,yt as L,kt as M,_t as N,et as O,tt as T,vt as a,jt as b,bt as c,Ct as d,It as e,Ot as f,Ft as g,Rt as h,ft as i,gt as j,Ze as k,Bt as l,Ce as m,Mt as n,ct as o,lt as p,mt as q,ht as r,dt as s,Lt as t,Wt as u,Et as v,Ut as w,$t as x,Pt as y,Ht as z};
//# sourceMappingURL=useGameStats-BUBeBCPI.js.map

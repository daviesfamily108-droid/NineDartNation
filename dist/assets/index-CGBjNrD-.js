import{r as li,a as Wl,g as Wa}from"./vendor-D3F3s8fL.js";import{r as d,S as ha,L as sc,M as En,a as nc,U as Kr,T as Oa,C as ql,P as ac,R as rc,b as ir,c as Fi,d as ic,e as lc,G as oc,V as cc,E as zl,f as dc,g as Vl,h as Gl,i as mc,j as uc,k as hc,X as fc}from"./ui-Dx22kTqm.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var lr={exports:{}},da={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _i;function xc(){if(_i)return da;_i=1;var t=li(),a=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,m,c){var u,f={},x=null,p=null;c!==void 0&&(x=""+c),m.key!==void 0&&(x=""+m.key),m.ref!==void 0&&(p=m.ref);for(u in m)r.call(m,u)&&!i.hasOwnProperty(u)&&(f[u]=m[u]);if(l&&l.defaultProps)for(u in m=l.defaultProps,m)f[u]===void 0&&(f[u]=m[u]);return{$$typeof:a,type:l,key:x,ref:p,props:f,_owner:n.current}}return da.Fragment=s,da.jsx=o,da.jsxs=o,da}var Hi;function pc(){return Hi||(Hi=1,lr.exports=xc()),lr.exports}var e=pc(),Aa={},Wi;function bc(){if(Wi)return Aa;Wi=1;var t=Wl();return Aa.createRoot=t.createRoot,Aa.hydrateRoot=t.hydrateRoot,Aa}var gc=bc();const yc=Wa(gc);var Yr=Wl();const vc=Wa(Yr),Jl=t=>`ndn_online_quota_${t}`;function Ba(t=new Date){const a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),s=a.getUTCDay()||7;a.setUTCDate(a.getUTCDate()+4-s);const r=new Date(Date.UTC(a.getUTCFullYear(),0,1)),n=Math.ceil(((a.getTime()-r.getTime())/864e5+1)/7),i=String(n).padStart(2,"0");return`${a.getUTCFullYear()}-${i}`}function Kl(t){try{const a=localStorage.getItem(Jl(t));if(!a)return{week:Ba(),used:0};const s=JSON.parse(a),r=Ba();return!s.week||s.week!==r?{week:r,used:0}:{week:String(s.week),used:Number(s.used)||0}}catch{return{week:Ba(),used:0}}}function jc(t,a){try{localStorage.setItem(Jl(t),JSON.stringify(a))}catch{}}function qi(t,a=3){const s=Ba(),r=Kl(t),n={week:s,used:(r.week===s?r.used:0)+1};return jc(t,n),n}function Yl(t,a=3){const s=Kl(t);return Math.max(0,a-(s.used||0))}const Xl={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8787",VITE_WS_URL:"ws://localhost:8787"},Ql="ndn:isAdmin:v1";function Zl(){try{const t=localStorage.getItem(Ql);return t?JSON.parse(t):{}}catch{return{}}}function Nc(t,a){try{const s=Zl();s[(t||"").toLowerCase()]={v:a,ts:Date.now()},localStorage.setItem(Ql,JSON.stringify(s))}catch{}}async function wc(t){const a=String(t||"").toLowerCase();if(!a)return!1;try{const n=String(Xl?.VITE_OWNER_EMAIL||"").toLowerCase();if(n&&a===n)return!0}catch{}if(a==="daviesfamily108@gmail.com")return!0;try{const n=localStorage.getItem("ndn:forceAdmin");if(n==="1"||n==="true")return!0}catch{}const r=Zl()[a];if(r&&Date.now()-r.ts<300*1e3)return!!r.v;try{const o=!!(await(await fetch(`/api/admins/check?email=${encodeURIComponent(a)}`)).json().catch(()=>({})))?.isAdmin;return Nc(a,o),o}catch{return!!r?.v}}function eo(t){const a=String(t||"").toLowerCase(),[s,r]=d.useState(!1);return d.useEffect(()=>{let n=!0;if(!a){r(!1);return}try{const i=String(Xl?.VITE_OWNER_EMAIL||"").toLowerCase(),o=(()=>{try{const l=localStorage.getItem("ndn:forceAdmin");return l==="1"||l==="true"}catch{return!1}})();if(i&&a===i){r(!0);return}if(o){r(!0);return}}catch{}if(a==="daviesfamily108@gmail.com"){r(!0);return}return wc(a).then(i=>{n&&r(!!i)}),()=>{n=!1}},[a]),s}const Sc={},Cc=5,kc={GBP:1,EUR:1.16,USD:1.26,AUD:1.92,NZD:2.08,CAD:1.73};function to(t,a=Cc){const s=(t||"GBP").toUpperCase(),r=kc[s]??1,n=a*r;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s}).format(n)}catch{return`${s} ${n.toFixed(2)}`}}function so(){try{const t=new Intl.NumberFormat().resolvedOptions(),a=String(t.locale).toLowerCase();return a.includes("-gb")?"GBP":a.includes("-ie")||a.includes("-de")||a.includes("-fr")||a.includes("-es")||a.includes("-it")||a.includes("-nl")?"EUR":a.includes("-us")?"USD":a.includes("-au")?"AUD":a.includes("-nz")?"NZD":a.includes("-ca")?"CAD":"GBP"}catch{return"GBP"}}const Ec=Sc?.VITE_DISCORD_INVITE_URL||"https://discord.gg/nCfT4hJz";let Vs=null;function Tc(){if(Vs)return Vs;const t="http://localhost:8787".trim();if(t)return Vs=t.replace(/\/$/,""),Vs;if(typeof window<"u"){const{protocol:a,host:s,hostname:r}=window.location,n=`${a}//${s}`;return r.endsWith("onrender.com")||r==="localhost"||r==="127.0.0.1"?Vs=n.replace(/\/$/,""):Vs="https://ninedartnation.onrender.com",Vs}return Vs="https://ninedartnation.onrender.com",Vs}function Mc(t){if(/^https?:\/\//i.test(t))return t;const a=Tc(),s=t.startsWith("/")?t:`/${t}`;return`${a}${s}`}function Ua(t){return Mc(t)}function kt(t,a){const s=Ua(t);return fetch(s,a)}function Ic(){if(typeof window>"u"||typeof window.fetch!="function")return;const t=window;if(t.__ndnApiPatched)return;const a=window.fetch.bind(window);window.fetch=(s,r)=>{try{if(typeof s=="string")return s.startsWith("/")?a(Ua(s),r):a(s,r);if(s instanceof Request){const n=s.url.startsWith("/")?Ua(s.url):s.url;if(n===s.url)return a(s,r);const i=new Request(n,s);return a(i,r)}if(s instanceof URL){const n=s.href.startsWith("/")?Ua(s.href):s.href;return a(n,r)}}catch(n){console.warn("[API] Interceptor failed, falling back to original fetch",n)}return a(s,r)},t.__ndnApiPatched=!0}function Dc(t){const a=[{key:"score",label:"Home",icon:nc},{key:"online",label:"Online",icon:Kr},{key:"offline",label:"Offline",icon:Oa},{key:"tournaments",label:"Tournaments",icon:Oa},{key:"friends",label:"Friends",icon:Kr},{key:"stats",label:"Stats",icon:Oa},{key:"calibrate",label:"Calibrate",icon:ql},{key:"settings",label:"Settings",icon:ha}];return t?.fullAccess||a.push({key:"fullaccess",label:"PREMIUM Â£â‚¬$",icon:ac}),a}function no({active:t,onChange:a,user:s,className:r}){const n=Dc(s),i=eo(s?.email);if(i&&!n.some(p=>p.key==="admin")){const p=n.findIndex(w=>w.key==="settings"),g={key:"admin",label:"Admin",icon:ha};p>=0?n.splice(p,0,g):n.push(g)}const[o,l]=d.useState(!1),[m,c]=d.useState(!1),u=s?.username&&!s?.fullAccess?Yl(s.username):1/0,[f,x]=d.useState({friendRequests:0,messages:0,tournaments:0});return d.useEffect(()=>{if(!s?.email)return;const p=async()=>{try{const[w,I]=await Promise.all([kt(`/api/friends/requests?email=${encodeURIComponent(s.email)}`),kt(`/api/friends/messages?email=${encodeURIComponent(s.email)}`)]),A=w.ok?await w.json():{requests:[]},E=(I.ok?await I.json():{messages:[]}).messages?.filter(M=>!M.read).length||0;x({friendRequests:A.requests?.length||0,messages:E,tournaments:0})}catch(w){console.error("Failed to fetch notifications:",w)}};p();const g=setInterval(p,3e4);return()=>clearInterval(g)},[s?.email]),d.useEffect(()=>{if(!o)return;const p=g=>{(g.key==="Escape"||g.key==="Enter")&&l(!1)};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[o]),e.jsxs("aside",{className:`${s?.fullAccess?"premium-sidebar":""} sidebar glass ${r?"":"w-60"} p-2 sm:p-4 rounded-2xl ${r??"hidden sm:flex"} flex-col gap-2 overflow-y-auto overflow-x-hidden ${r?"":"fixed top-2 bottom-2 sm:top-4 sm:bottom-4"}`,children:[n.map(({key:p,label:g,icon:w})=>p==="admin"&&!i?null:e.jsxs("button",{className:`tab whitespace-nowrap flex items-center justify-start gap-3 ${t===p?"tab--active":"tab--inactive"} `,onClick:()=>a(p),title:g,style:{fontWeight:700,fontSize:"1.1rem",color:t===p?"#fff":"#E5E7EB",letterSpacing:"0.02em"},children:[e.jsx(w,{className:"w-6 h-6"}),e.jsxs("span",{className:"flex items-center gap-2",children:[g,p==="online"&&!s?.fullAccess&&u<=0&&e.jsxs("span",{title:"Weekly free games used",className:"inline-flex items-center gap-1 text-[0.65rem] px-2 py-0.5 rounded-full bg-rose-600 text-white",children:[e.jsx(sc,{className:"w-3 h-3"}),"Locked"]}),p==="friends"&&f.friendRequests>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:f.friendRequests>9?"9+":f.friendRequests}),p==="score"&&(f.messages>0||f.tournaments>0)&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:f.messages+f.tournaments>9?"9+":f.messages+f.tournaments})]})]},p)),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-2",onClick:()=>l(!0),title:"BullseyeDartsLeague",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(En,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"BullseyeDartsLeague"})]}),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-1",onClick:()=>c(!0),title:"NineDartNation",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(En,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"NineDartNation"})]}),o&&Yr.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>l(!1),onTouchStart:()=>l(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>l(!1),children:"âœ•"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(En,{className:"w-6 h-6"})," BullseyeDartsLeague"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join this fantastic Online Darts League with divisions and other cool stuff included"}),e.jsx("a",{href:Ec,target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body),m&&Yr.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>c(!1),onTouchStart:()=>c(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>c(!1),children:"âœ•"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(En,{className:"w-6 h-6"})," NineDartNation"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join the NineDartNation Discord community"}),e.jsx("a",{href:"https://discord.gg/Q33J5FTVve",target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body)]})}const Ac={},zi=t=>{let a;const s=new Set,r=(u,f)=>{const x=typeof u=="function"?u(a):u;if(!Object.is(x,a)){const p=a;a=f??(typeof x!="object"||x===null)?x:Object.assign({},a,x),s.forEach(g=>g(a,p))}},n=()=>a,m={setState:r,getState:n,getInitialState:()=>c,subscribe:u=>(s.add(u),()=>s.delete(u)),destroy:()=>{(Ac?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},c=a=t(r,n,m);return m},Pc=t=>t?zi(t):zi;var or={exports:{}},cr={},dr={exports:{}},mr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vi;function Rc(){if(Vi)return mr;Vi=1;var t=li();function a(f,x){return f===x&&(f!==0||1/f===1/x)||f!==f&&x!==x}var s=typeof Object.is=="function"?Object.is:a,r=t.useState,n=t.useEffect,i=t.useLayoutEffect,o=t.useDebugValue;function l(f,x){var p=x(),g=r({inst:{value:p,getSnapshot:x}}),w=g[0].inst,I=g[1];return i(function(){w.value=p,w.getSnapshot=x,m(w)&&I({inst:w})},[f,p,x]),n(function(){return m(w)&&I({inst:w}),f(function(){m(w)&&I({inst:w})})},[f]),o(p),p}function m(f){var x=f.getSnapshot;f=f.value;try{var p=x();return!s(f,p)}catch{return!0}}function c(f,x){return x()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:l;return mr.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,mr}var Gi;function Lc(){return Gi||(Gi=1,dr.exports=Rc()),dr.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ji;function Oc(){if(Ji)return cr;Ji=1;var t=li(),a=Lc();function s(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var r=typeof Object.is=="function"?Object.is:s,n=a.useSyncExternalStore,i=t.useRef,o=t.useEffect,l=t.useMemo,m=t.useDebugValue;return cr.useSyncExternalStoreWithSelector=function(c,u,f,x,p){var g=i(null);if(g.current===null){var w={hasValue:!1,value:null};g.current=w}else w=g.current;g=l(function(){function A(D){if(!S){if(S=!0,E=D,D=x(D),p!==void 0&&w.hasValue){var v=w.value;if(p(v,D))return M=v}return M=D}if(v=M,r(E,D))return v;var b=x(D);return p!==void 0&&p(v,b)?(E=D,v):(E=D,M=b)}var S=!1,E,M,F=f===void 0?null:f;return[function(){return A(u())},F===null?void 0:function(){return A(F())}]},[u,f,x,p]);var I=n(c,g[0],g[1]);return o(function(){w.hasValue=!0,w.value=I},[I]),m(I),I},cr}var Ki;function Bc(){return Ki||(Ki=1,or.exports=Oc()),or.exports}var Uc=Bc();const $c=Wa(Uc),ao={},{useDebugValue:Fc}=rc,{useSyncExternalStoreWithSelector:_c}=$c;let Yi=!1;const Hc=t=>t;function Wc(t,a=Hc,s){(ao?"production":void 0)!=="production"&&s&&!Yi&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Yi=!0);const r=_c(t.subscribe,t.getState,t.getServerState||t.getInitialState,a,s);return Fc(r),r}const Xi=t=>{(ao?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof t=="function"?Pc(t):t,s=(r,n)=>Wc(a,r,n);return Object.assign(s,a),s},qs=t=>t?Xi(t):Xi;let qc=1;const Xr=qs(t=>({toasts:[],push:(a,s)=>t(r=>{const n=qc++,i={id:n,message:a,type:s?.type||"info",timeout:s?.timeout??3e3};return i.timeout&&i.timeout>0&&setTimeout(()=>{t(o=>({toasts:o.toasts.filter(l=>l.id!==n)}))},i.timeout),{toasts:[...r.toasts,i]}}),remove:a=>t(s=>({toasts:s.toasts.filter(r=>r.id!==a)})),clear:()=>t({toasts:[]})}));function sa(){return Xr(a=>a.push)}function dt(t){return(t??0).toFixed(2)}const zc=t=>`ndn_stats_${t}`,ro=t=>`ndn_stats_ts_${t}`;function ps(t){try{const a=localStorage.getItem(zc(t));if(!a)return{darts:0,scored:0};const s=JSON.parse(a);return{darts:Number(s.darts)||0,scored:Number(s.scored)||0,fnDarts:Number(s.fnDarts)||0,fnScored:Number(s.fnScored)||0,best3:typeof s.best3=="number"?s.best3:0,worst3:typeof s.worst3=="number"?s.worst3:0,bestLegDarts:typeof s.bestLegDarts=="number"?s.bestLegDarts:0,bestCheckout:typeof s.bestCheckout=="number"?s.bestCheckout:0,worstLegDarts:typeof s.worstLegDarts=="number"?s.worstLegDarts:0,bestFNAvg:typeof s.bestFNAvg=="number"?s.bestFNAvg:0,worstFNAvg:typeof s.worstFNAvg=="number"?s.worstFNAvg:0}}catch{return{darts:0,scored:0}}}function an(t){const{darts:a,scored:s}=ps(t);return a?s/a*3:0}function ur(t){const{fnDarts:a=0,fnScored:s=0}=ps(t);return a?s/a*3:0}const io="ndn_game_mode_stats";function oi(t){let a={};try{const s=localStorage.getItem(io);s&&(a=JSON.parse(s))}catch{}if(Array.isArray(t))for(const s of t)a[s]||(a[s]={played:0,won:0});return a}function Vc(t){try{localStorage.setItem(io,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{gameModes:!0}}))}catch{}}function Gc(t,a){const s=oi(),r=s[t]||{played:0,won:0};r.played+=1,a&&(r.won+=1),s[t]=r,Vc(s)}function qa(t){try{const a=localStorage.getItem(ro(t));if(!a)return[];const s=JSON.parse(a);return Array.isArray(s)?s.map(r=>({t:Number(r.t)||0,darts:Number(r.darts)||0,scored:Number(r.scored)||0,fnDarts:Number(r.fnDarts)||0,fnScored:Number(r.fnScored)||0})).filter(r=>r.t>0):[]}catch{return[]}}function Jc(t,a){try{localStorage.setItem(ro(t),JSON.stringify(a)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t}}))}catch{}}function Kc(t,a){const s=Date.now();return t.filter(r=>s-r.t<=a)}function en(t,a,s,r=Date.now(),n,i){if(a<=0)return;const o=qa(t),l=Kc([...o,{t:r,darts:a,scored:s,fnDarts:n,fnScored:i}],1e3*60*60*24*30);Jc(t,l)}function Yc(t,a=1e3*60*60*24){const s=qa(t);if(!s.length)return 0;const r=Date.now();let n=0,i=0;for(const o of s)r-o.t<=a&&(n+=o.darts,i+=o.scored);return n<=0?0:i/n*3}function Xc(t,a=1e3*60*60*24*30){const s=qa(t);if(!s.length)return 0;const r=Date.now();let n=0,i=0;for(const o of s)r-o.t<=a&&(n+=o.fnDarts||0,i+=o.fnScored||0);return n<=0?0:i/n*3}function hr(t){const s=qa(t);if(!s.length)return 0;const r=Date.now(),n=s.filter(c=>r-c.t<=2592e6),i=n.filter(c=>typeof c.fnDarts=="number"),o=i.length?i:n;let l=0,m=0;for(const c of o)l+=c.darts,m+=c.scored;return l<=0?0:m/l*3}function fr(t){return Xc(t,2592e6)}const lo="ndn_user_settings";function Qr(){try{const t=localStorage.getItem(lo);if(!t)return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,cameraEnabled:!0,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",textSize:"medium",boxSize:"medium",matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1};const a=JSON.parse(t);return{favoriteDouble:a.favoriteDouble||"D16",callerEnabled:typeof a.callerEnabled=="boolean"?a.callerEnabled:!0,callerVoice:a.callerVoice||"",callerVolume:typeof a.callerVolume=="number"?Math.max(0,Math.min(1,a.callerVolume)):1,speakCheckoutOnly:!!a.speakCheckoutOnly,avgMode:a.avgMode==="24h"?"24h":"all-time",autoStartOffline:!!a.autoStartOffline,rememberLastOffline:typeof a.rememberLastOffline=="boolean"?a.rememberLastOffline:!0,lastOffline:a.lastOffline&&typeof a.lastOffline=="object"?{mode:a.lastOffline.mode||"X01",x01Start:Number(a.lastOffline.x01Start)||501,firstTo:Number(a.lastOffline.firstTo)||1,aiLevel:a.lastOffline.aiLevel||"None"}:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!!a.reducedMotion,compactHeader:!!a.compactHeader,allowSpectate:typeof a.allowSpectate=="boolean"?a.allowSpectate:!0,cameraScale:typeof a.cameraScale=="number"&&isFinite(a.cameraScale)?Math.max(.5,Math.min(1.25,a.cameraScale)):1,cameraAspect:a.cameraAspect==="square"?"square":"wide",cameraFitMode:a.cameraFitMode==="fit"||a.cameraFitMode==="fill"?a.cameraFitMode:"fit",autoscoreProvider:a.autoscoreProvider==="external-ws"?"external-ws":a.autoscoreProvider==="manual"?"manual":"built-in",autoscoreWsUrl:typeof a.autoscoreWsUrl=="string"?a.autoscoreWsUrl:"",calibrationGuide:typeof a.calibrationGuide=="boolean"?a.calibrationGuide:!0,preferredCameraId:typeof a.preferredCameraId=="string"?a.preferredCameraId:void 0,preferredCameraLabel:typeof a.preferredCameraLabel=="string"?a.preferredCameraLabel:void 0,preferredCameraLocked:typeof a.preferredCameraLocked=="boolean"?a.preferredCameraLocked:!1,cameraEnabled:typeof a.cameraEnabled=="boolean"?a.cameraEnabled:!0,offlineLayout:a.offlineLayout==="classic"?"classic":"modern",textSize:a.textSize==="small"||a.textSize==="large"?a.textSize:"medium",boxSize:a.boxSize==="small"||a.boxSize==="large"?a.boxSize:"medium",matchType:a.matchType==="doubles"?"doubles":"singles",teamAName:typeof a.teamAName=="string"?a.teamAName:"Team A",teamBName:typeof a.teamBName=="string"?a.teamBName:"Team B",dartTimerEnabled:typeof a.dartTimerEnabled=="boolean"?a.dartTimerEnabled:!1,dartTimerSeconds:typeof a.dartTimerSeconds=="number"&&isFinite(a.dartTimerSeconds)?Math.max(3,Math.min(60,a.dartTimerSeconds)):10,x01DoubleIn:typeof a.x01DoubleIn=="boolean"?a.x01DoubleIn:!1}}catch{return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preferredCameraLocked:!1,cameraEnabled:!0,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",textSize:"medium",boxSize:"medium",matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1}}}function rt(t){try{const a=Qr();localStorage.setItem(lo,JSON.stringify({...a,...t}))}catch{}}const Ot=qs((t,a)=>({...Qr(),setFavoriteDouble:s=>{rt({favoriteDouble:s}),t({favoriteDouble:s})},setCallerEnabled:s=>{rt({callerEnabled:s}),t({callerEnabled:s})},setCallerVoice:s=>{rt({callerVoice:s}),t({callerVoice:s})},setAvgMode:s=>{rt({avgMode:s}),t({avgMode:s})},setCallerVolume:s=>{const r=Math.max(0,Math.min(1,s));rt({callerVolume:r}),t({callerVolume:r})},setSpeakCheckoutOnly:s=>{rt({speakCheckoutOnly:s}),t({speakCheckoutOnly:s})},setAutoStartOffline:s=>{rt({autoStartOffline:s}),t({autoStartOffline:s})},setRememberLastOffline:s=>{rt({rememberLastOffline:s}),t({rememberLastOffline:s})},setLastOffline:s=>{const n={...Qr().lastOffline,...s};rt({lastOffline:n}),t({lastOffline:n})},setReducedMotion:s=>{rt({reducedMotion:s}),t({reducedMotion:s})},setCompactHeader:s=>{rt({compactHeader:s}),t({compactHeader:s})},setAllowSpectate:s=>{rt({allowSpectate:s}),t({allowSpectate:s})},setCameraScale:s=>{const r=Math.max(.5,Math.min(1.25,s));rt({cameraScale:r}),t({cameraScale:r})},setCameraAspect:s=>{const r=s==="square"?"square":"wide";rt({cameraAspect:r}),t({cameraAspect:r})},setCameraFitMode:s=>{const r=s==="fit"?"fit":"fill";rt({cameraFitMode:r}),t({cameraFitMode:r})},setAutoscoreProvider:s=>{rt({autoscoreProvider:s}),t({autoscoreProvider:s})},setAutoscoreWsUrl:s=>{rt({autoscoreWsUrl:s}),t({autoscoreWsUrl:s})},setCalibrationGuide:s=>{rt({calibrationGuide:s}),t({calibrationGuide:s})},setPreferredCamera:(s,r,n=!1)=>{try{const i=a();if(console.log("[USERSETTINGS] setPreferredCamera called:",{id:s,label:r,force:n,locked:i.preferredCameraLocked}),i.preferredCameraLocked&&!n){console.log("[USERSETTINGS] Camera selection locked and force=false, ignoring update");return}}catch{}console.log("[USERSETTINGS] Saving preferred camera:",{id:s,label:r}),rt({preferredCameraId:s,preferredCameraLabel:r}),t({preferredCameraId:s,preferredCameraLabel:r})},setPreferredCameraLocked:s=>{rt({preferredCameraLocked:s}),t({preferredCameraLocked:s})},setCameraEnabled:s=>{rt({cameraEnabled:s}),t({cameraEnabled:s})},setOfflineLayout:s=>{rt({offlineLayout:s}),t({offlineLayout:s})},setTextSize:s=>{rt({textSize:s}),t({textSize:s})},setBoxSize:s=>{rt({boxSize:s}),t({boxSize:s})},setMatchType:s=>{const r=s==="doubles"?"doubles":"singles";rt({matchType:r}),t({matchType:r})},setTeamAName:s=>{const r=s?.trim()||"Team A";rt({teamAName:r}),t({teamAName:r})},setTeamBName:s=>{const r=s?.trim()||"Team B";rt({teamBName:r}),t({teamBName:r})},setDartTimerEnabled:s=>{rt({dartTimerEnabled:s}),t({dartTimerEnabled:s})},setDartTimerSeconds:s=>{const r=Math.max(3,Math.min(60,Math.round(s)));rt({dartTimerSeconds:r}),t({dartTimerSeconds:r})},setX01DoubleIn:s=>{rt({x01DoubleIn:s}),t({x01DoubleIn:s})}}));function Pa(t){try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:t}}))}catch{}}const Qc="http://localhost:8787";function Zc({user:t}){const[a,s]=d.useState(!1),[r,n]=d.useState(!1),[i,o]=d.useState(""),{lastOffline:l}=Ot(),m=sa();return d.useEffect(()=>{const c=["The fastest televised 9-darter took roughly 25 seconds!","A perfect leg (501) can be finished in nine darts.","The inner bull is worth 50; the outer bull is 25.","Standard dartboards are made from compressed sisal fibers.","Doubles and trebles are the thin outer and middle rings.","Professional oche (throw line) distance is 7 ft 9Â¼ in (2.37 m).","â€œDartitisâ€ is a real condition affecting a playerâ€™s throwing motion.","Phil Taylor holds a record number of World Championship titles.","Checkout routes often end on a doubleâ€”classic â€œdouble-outâ€.","The highest 3-dart score is 180 (triple 20, triple 20, triple 20)."],u=Math.floor(Math.random()*c.length);o(c[u])},[]),e.jsxs("div",{className:`${t?.fullAccess?"premium-main":""} relative min-h-[600px] flex flex-col items-center justify-center overflow-hidden`,children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-700 via-indigo-500 to-blue-600 opacity-60 blur-2xl"}),e.jsx("div",{className:"absolute top-20 left-1/4 w-40 h-40 bg-pink-400 rounded-full opacity-30 blur-2xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-10 right-1/4 w-32 h-32 bg-blue-400 rounded-full opacity-30 blur-2xl animate-pulse"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-6xl mx-auto bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 lg:p-10 flex flex-col items-center",children:[e.jsx("h2",{className:"text-2xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-400 to-blue-400 mb-2 sm:mb-3 md:mb-4 drop-shadow-xl text-center leading-tight",children:"Welcome to Nine Dart Nation"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl lg:text-2xl text-white/80 mb-2 font-semibold text-center px-2",children:"Your home for competitive darts, stats, and online play."}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg text-white/60 mb-3 sm:mb-4 italic text-center px-2",children:'"Where every dart counts and every player matters."'}),i&&e.jsx("div",{className:"w-full mb-4 sm:mb-6 px-2 sm:px-0",children:e.jsxs("div",{className:"mx-auto max-w-xs sm:max-w-xl rounded-full px-3 sm:px-5 py-2 text-center text-indigo-100 bg-gradient-to-r from-indigo-600/80 to-fuchsia-600/80 shadow-md",children:[e.jsx("span",{className:"font-semibold text-sm sm:text-base",children:"Did you know?"})," ",e.jsx("span",{className:"opacity-90 text-sm sm:text-base",children:i})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4 md:gap-6 justify-center mb-6 md:mb-8 w-full max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>{Pa("offline");try{window.dispatchEvent(new CustomEvent("ndn:offline-format",{detail:{formatType:"first",formatCount:Number(l?.firstTo)||1,startScore:Number(l?.x01Start)||501}}))}catch{}try{setTimeout(()=>{window.dispatchEvent(new CustomEvent("ndn:auto-start",{detail:{mode:l?.mode||"X01"}}))},50)}catch{}},className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸŽ¯"})," Start New Match"]}),e.jsxs("button",{onClick:()=>Pa("stats"),className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ“Š"})," View Stats"]}),e.jsxs("button",{onClick:()=>Pa("online"),className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-green-500 to-blue-400 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ†"})," Join Online League"]}),e.jsxs("button",{onClick:()=>{Pa("offline");try{window.dispatchEvent(new CustomEvent("ndn:auto-start",{detail:{mode:"Double Practice"}}))}catch{}},className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-pink-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ’¡"})," Practice Doubles"]})]}),(()=>{const c=t?.username||"Player 1",u=ps(c),f=!!t?.fullAccess,x="grid grid-cols-[120px,1fr,1fr] sm:grid-cols-[160px,1fr,1fr]",p=({label:g,left:w,right:I,lock:A})=>e.jsxs("div",{className:`relative ${x} gap-2 items-center p-2 rounded-lg ${A?"bg-white/5 border border-white/10 overflow-hidden":"bg-indigo-500/10 border border-indigo-500/40"} mb-2`,children:[e.jsx("div",{className:"text-[12px] opacity-80 pl-2 text-left",children:g}),e.jsx("div",{className:`text-sm font-semibold text-center ${A?"opacity-50 blur-[0.5px]":""}`,children:w}),e.jsx("div",{className:`text-sm font-semibold text-center ${A?"opacity-50 blur-[0.5px]":""}`,children:I}),A&&e.jsx("button",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-slate-900/35 hover:bg-slate-900/45 transition",onClick:async()=>{try{const E=await(await fetch(`${Qc}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})})).json();E.ok&&E.url?window.location.href=E.url:E.error==="STRIPE_NOT_CONFIGURED"?m("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):m("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{m("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},title:"Unlock with PREMIUM",children:e.jsx("span",{className:"text-[12px] font-semibold",children:"Unlock PREMIUM"})})]});return e.jsxs("div",{className:"w-full mt-2 rounded-2xl p-2 sm:p-3 bg-white/5 border border-white/10 overflow-x-auto",children:[e.jsxs("div",{className:`${x} gap-2 mb-2 px-1 items-center min-w-[280px] sm:min-w-0`,children:[e.jsx("div",{className:"text-[12px] opacity-0 select-none",children:"label"}),e.jsx("div",{className:"text-[12px] font-semibold text-center",children:"BEST"}),e.jsx("div",{className:"text-[12px] font-semibold text-center",children:"WORST"})]}),e.jsx(p,{label:"3-dart avg",left:dt(u.best3||0),right:dt(u.worst3||0)}),e.jsx(p,{label:"9-dart avg",left:dt(u.bestFNAvg||0),right:dt(u.worstFNAvg||0),lock:!f}),e.jsx(p,{label:"Leg (darts)",left:String(u.bestLegDarts||0),right:String(u.worstLegDarts||0),lock:!f}),e.jsx(p,{label:"Checkout",left:String(u.bestCheckout||0),right:"â€”",lock:!f})]})})(),e.jsx("button",{className:"mt-6 sm:mt-8 md:mt-10 px-6 sm:px-8 md:px-10 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 text-base sm:text-lg md:text-xl touch-manipulation",onClick:()=>n(!0),children:"How to Play / Getting Started"})]}),e.jsx("footer",{className:"w-full py-2 md:py-2 text-center text-white/80 text-xs md:text-sm font-medium absolute bottom-0 left-0 z-20 flex items-center justify-center gap-1 md:gap-2",children:e.jsxs("button",{className:"flex items-center gap-1 md:gap-2 hover:text-white transition",onClick:()=>s(!0),children:[e.jsx("span",{children:"Â©"}),e.jsx("span",{style:{letterSpacing:"0.05em"},children:"NINEDARTNATION"})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>s(!1),children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Legal Information"}),e.jsxs("ul",{className:"list-disc pl-5 mb-2",children:[e.jsx("li",{children:"Terms & Conditions: All users must follow fair play and site rules."}),e.jsx("li",{children:"Privacy Policy: Your data is protected and never shared without consent."}),e.jsxs("li",{children:["Copyright Â© ",new Date().getFullYear()," NINEDARTNATION. All rights reserved."]}),e.jsx("li",{children:"Contact: support@ninedartnation.com"})]}),e.jsx("p",{className:"text-sm text-purple-200",children:"For full legal details, please contact us or visit our legal page."})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>n(!1),children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Getting Started"}),e.jsxs("ul",{className:"list-disc pl-5 mb-2",children:[e.jsx("li",{children:"Choose a game mode and invite friends or play solo."}),e.jsx("li",{children:"Track your stats and progress in the Stats tab."}),e.jsx("li",{children:"Join the BullseyeDartsLeague for online competition."}),e.jsx("li",{children:"Upgrade to PREMIUM for advanced features and modes."}),e.jsx("li",{children:"Need help? Visit the Settings tab for support and tips."})]}),e.jsx("p",{className:"text-sm text-purple-200",children:'Ready to play? Hit "Start New Match" and let the darts fly!'})]})})]})}function Hs({children:t,className:a,style:s}){const r=d.useRef(null);return d.useEffect(()=>{let n=0;const i=()=>{const m=r.current;if(!m)return;const c=document.getElementById("ndn-header");if(!c){m.style.clipPath="";return}const u=document.getElementById("ndn-main-scroll"),f=u?u.scrollTop:window.scrollY||0,x=c.getBoundingClientRect().height,p=f>0?x:0;m.style.marginTop=p>0?`${p}px`:"0px"};i();const o=()=>{n&&cancelAnimationFrame(n),n=requestAnimationFrame(i)},l=document.getElementById("ndn-main-scroll");return l?.addEventListener("scroll",o,{passive:!0}),window.addEventListener("scroll",o,{passive:!0}),window.addEventListener("resize",o),()=>{l?.removeEventListener("scroll",o),window.removeEventListener("scroll",o),window.removeEventListener("resize",o),n&&cancelAnimationFrame(n)}},[]),e.jsx("div",{ref:r,className:a,style:s,children:t})}const ed=({calibrationComplete:t})=>{const[a,s]=d.useState(!1),[r,n]=d.useState(!1);return d.useEffect(()=>{t?(s(!0),setTimeout(()=>n(!0),1200)):(s(!1),n(!1))},[t]),e.jsxs("div",{className:`flex flex-col items-center justify-center w-full h-full transition-opacity duration-700 ${r?"opacity-0":"opacity-100"}`,style:{pointerEvents:"none",position:"absolute",inset:0,zIndex:10},children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("svg",{width:"80",height:"80",viewBox:"0 0 80 80",className:`animate-spin-slow ${a?"opacity-0":"opacity-100"} transition-opacity duration-500`,style:{transition:"opacity 0.5s"},children:e.jsxs("g",{children:[e.jsx("rect",{x:"36",y:"10",width:"8",height:"40",rx:"3",fill:"#a78bfa"}),e.jsx("polygon",{points:"40,10 44,22 36,22",fill:"#f472b6"}),e.jsx("rect",{x:"36",y:"50",width:"8",height:"18",rx:"2",fill:"#22d3ee"}),e.jsx("polygon",{points:"36,68 44,68 40,78",fill:"#10b981"})]})}),a&&e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",className:"absolute",style:{left:0,top:0},children:[e.jsx("circle",{cx:"40",cy:"40",r:"32",fill:"none",stroke:"#10b981",strokeWidth:"6"}),e.jsx("polyline",{points:"28,44 38,54 54,30",fill:"none",stroke:"#10b981",strokeWidth:"6",strokeLinecap:"round",strokeLinejoin:"round"})]})]}),e.jsx("div",{className:"mt-4 text-lg font-semibold text-indigo-200",children:a?"Calibration Complete!":"Initializing Camera..."})]})};var Qn={},xr,Qi;function td(){return Qi||(Qi=1,xr=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),xr}var pr={},Qs={},Zi;function Mn(){if(Zi)return Qs;Zi=1;let t;const a=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Qs.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},Qs.getSymbolTotalCodewords=function(r){return a[r]},Qs.getBCHDigit=function(s){let r=0;for(;s!==0;)r++,s>>>=1;return r},Qs.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');t=r},Qs.isKanjiModeEnabled=function(){return typeof t<"u"},Qs.toSJIS=function(r){return t(r)},Qs}var br={},el;function ci(){return el||(el=1,(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function a(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+s)}}t.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},t.from=function(r,n){if(t.isValid(r))return r;try{return a(r)}catch{return n}}})(br)),br}var gr,tl;function sd(){if(tl)return gr;tl=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(a){const s=Math.floor(a/8);return(this.buffer[s]>>>7-a%8&1)===1},put:function(a,s){for(let r=0;r<s;r++)this.putBit((a>>>s-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(a){const s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),a&&(this.buffer[s]|=128>>>this.length%8),this.length++}},gr=t,gr}var yr,sl;function nd(){if(sl)return yr;sl=1;function t(a){if(!a||a<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=a,this.data=new Uint8Array(a*a),this.reservedBit=new Uint8Array(a*a)}return t.prototype.set=function(a,s,r,n){const i=a*this.size+s;this.data[i]=r,n&&(this.reservedBit[i]=!0)},t.prototype.get=function(a,s){return this.data[a*this.size+s]},t.prototype.xor=function(a,s,r){this.data[a*this.size+s]^=r},t.prototype.isReserved=function(a,s){return this.reservedBit[a*this.size+s]},yr=t,yr}var vr={},nl;function ad(){return nl||(nl=1,(function(t){const a=Mn().getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const n=Math.floor(r/7)+2,i=a(r),o=i===145?26:Math.ceil((i-13)/(2*n-2))*2,l=[i-7];for(let m=1;m<n-1;m++)l[m]=l[m-1]-o;return l.push(6),l.reverse()},t.getPositions=function(r){const n=[],i=t.getRowColCoords(r),o=i.length;for(let l=0;l<o;l++)for(let m=0;m<o;m++)l===0&&m===0||l===0&&m===o-1||l===o-1&&m===0||n.push([i[l],i[m]]);return n}})(vr)),vr}var jr={},al;function rd(){if(al)return jr;al=1;const t=Mn().getSymbolSize,a=7;return jr.getPositions=function(r){const n=t(r);return[[0,0],[n-a,0],[0,n-a]]},jr}var Nr={},rl;function id(){return rl||(rl=1,(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const a={N1:3,N2:3,N3:40,N4:10};t.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7},t.from=function(n){return t.isValid(n)?parseInt(n,10):void 0},t.getPenaltyN1=function(n){const i=n.size;let o=0,l=0,m=0,c=null,u=null;for(let f=0;f<i;f++){l=m=0,c=u=null;for(let x=0;x<i;x++){let p=n.get(f,x);p===c?l++:(l>=5&&(o+=a.N1+(l-5)),c=p,l=1),p=n.get(x,f),p===u?m++:(m>=5&&(o+=a.N1+(m-5)),u=p,m=1)}l>=5&&(o+=a.N1+(l-5)),m>=5&&(o+=a.N1+(m-5))}return o},t.getPenaltyN2=function(n){const i=n.size;let o=0;for(let l=0;l<i-1;l++)for(let m=0;m<i-1;m++){const c=n.get(l,m)+n.get(l,m+1)+n.get(l+1,m)+n.get(l+1,m+1);(c===4||c===0)&&o++}return o*a.N2},t.getPenaltyN3=function(n){const i=n.size;let o=0,l=0,m=0;for(let c=0;c<i;c++){l=m=0;for(let u=0;u<i;u++)l=l<<1&2047|n.get(c,u),u>=10&&(l===1488||l===93)&&o++,m=m<<1&2047|n.get(u,c),u>=10&&(m===1488||m===93)&&o++}return o*a.N3},t.getPenaltyN4=function(n){let i=0;const o=n.data.length;for(let m=0;m<o;m++)i+=n.data[m];return Math.abs(Math.ceil(i*100/o/5)-10)*a.N4};function s(r,n,i){switch(r){case t.Patterns.PATTERN000:return(n+i)%2===0;case t.Patterns.PATTERN001:return n%2===0;case t.Patterns.PATTERN010:return i%3===0;case t.Patterns.PATTERN011:return(n+i)%3===0;case t.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(i/3))%2===0;case t.Patterns.PATTERN101:return n*i%2+n*i%3===0;case t.Patterns.PATTERN110:return(n*i%2+n*i%3)%2===0;case t.Patterns.PATTERN111:return(n*i%3+(n+i)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(n,i){const o=i.size;for(let l=0;l<o;l++)for(let m=0;m<o;m++)i.isReserved(m,l)||i.xor(m,l,s(n,m,l))},t.getBestMask=function(n,i){const o=Object.keys(t.Patterns).length;let l=0,m=1/0;for(let c=0;c<o;c++){i(c),t.applyMask(c,n);const u=t.getPenaltyN1(n)+t.getPenaltyN2(n)+t.getPenaltyN3(n)+t.getPenaltyN4(n);t.applyMask(c,n),u<m&&(m=u,l=c)}return l}})(Nr)),Nr}var Ra={},il;function oo(){if(il)return Ra;il=1;const t=ci(),a=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return Ra.getBlocksCount=function(n,i){switch(i){case t.L:return a[(n-1)*4+0];case t.M:return a[(n-1)*4+1];case t.Q:return a[(n-1)*4+2];case t.H:return a[(n-1)*4+3];default:return}},Ra.getTotalCodewordsCount=function(n,i){switch(i){case t.L:return s[(n-1)*4+0];case t.M:return s[(n-1)*4+1];case t.Q:return s[(n-1)*4+2];case t.H:return s[(n-1)*4+3];default:return}},Ra}var wr={},ma={},ll;function ld(){if(ll)return ma;ll=1;const t=new Uint8Array(512),a=new Uint8Array(256);return(function(){let r=1;for(let n=0;n<255;n++)t[n]=r,a[r]=n,r<<=1,r&256&&(r^=285);for(let n=255;n<512;n++)t[n]=t[n-255]})(),ma.log=function(r){if(r<1)throw new Error("log("+r+")");return a[r]},ma.exp=function(r){return t[r]},ma.mul=function(r,n){return r===0||n===0?0:t[a[r]+a[n]]},ma}var ol;function od(){return ol||(ol=1,(function(t){const a=ld();t.mul=function(r,n){const i=new Uint8Array(r.length+n.length-1);for(let o=0;o<r.length;o++)for(let l=0;l<n.length;l++)i[o+l]^=a.mul(r[o],n[l]);return i},t.mod=function(r,n){let i=new Uint8Array(r);for(;i.length-n.length>=0;){const o=i[0];for(let m=0;m<n.length;m++)i[m]^=a.mul(n[m],o);let l=0;for(;l<i.length&&i[l]===0;)l++;i=i.slice(l)}return i},t.generateECPolynomial=function(r){let n=new Uint8Array([1]);for(let i=0;i<r;i++)n=t.mul(n,new Uint8Array([1,a.exp(i)]));return n}})(wr)),wr}var Sr,cl;function cd(){if(cl)return Sr;cl=1;const t=od();function a(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}return a.prototype.initialize=function(r){this.degree=r,this.genPoly=t.generateECPolynomial(this.degree)},a.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(r.length+this.degree);n.set(r);const i=t.mod(n,this.genPoly),o=this.degree-i.length;if(o>0){const l=new Uint8Array(this.degree);return l.set(i,o),l}return i},Sr=a,Sr}var Cr={},kr={},Er={},dl;function co(){return dl||(dl=1,Er.isValid=function(a){return!isNaN(a)&&a>=1&&a<=40}),Er}var Ws={},ml;function mo(){if(ml)return Ws;ml=1;const t="[0-9]+",a="[A-Z $%*+\\-./:]+";let s="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";s=s.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+s+`)(?:.|[\r
]))+`;Ws.KANJI=new RegExp(s,"g"),Ws.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Ws.BYTE=new RegExp(r,"g"),Ws.NUMERIC=new RegExp(t,"g"),Ws.ALPHANUMERIC=new RegExp(a,"g");const n=new RegExp("^"+s+"$"),i=new RegExp("^"+t+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Ws.testKanji=function(m){return n.test(m)},Ws.testNumeric=function(m){return i.test(m)},Ws.testAlphanumeric=function(m){return o.test(m)},Ws}var ul;function In(){return ul||(ul=1,(function(t){const a=co(),s=mo();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(i,o){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!a.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?i.ccBits[0]:o<27?i.ccBits[1]:i.ccBits[2]},t.getBestModeForData=function(i){return s.testNumeric(i)?t.NUMERIC:s.testAlphanumeric(i)?t.ALPHANUMERIC:s.testKanji(i)?t.KANJI:t.BYTE},t.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},t.isValid=function(i){return i&&i.bit&&i.ccBits};function r(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+n)}}t.from=function(i,o){if(t.isValid(i))return i;try{return r(i)}catch{return o}}})(kr)),kr}var hl;function dd(){return hl||(hl=1,(function(t){const a=Mn(),s=oo(),r=ci(),n=In(),i=co(),o=7973,l=a.getBCHDigit(o);function m(x,p,g){for(let w=1;w<=40;w++)if(p<=t.getCapacity(w,g,x))return w}function c(x,p){return n.getCharCountIndicator(x,p)+4}function u(x,p){let g=0;return x.forEach(function(w){const I=c(w.mode,p);g+=I+w.getBitsLength()}),g}function f(x,p){for(let g=1;g<=40;g++)if(u(x,g)<=t.getCapacity(g,p,n.MIXED))return g}t.from=function(p,g){return i.isValid(p)?parseInt(p,10):g},t.getCapacity=function(p,g,w){if(!i.isValid(p))throw new Error("Invalid QR Code version");typeof w>"u"&&(w=n.BYTE);const I=a.getSymbolTotalCodewords(p),A=s.getTotalCodewordsCount(p,g),S=(I-A)*8;if(w===n.MIXED)return S;const E=S-c(w,p);switch(w){case n.NUMERIC:return Math.floor(E/10*3);case n.ALPHANUMERIC:return Math.floor(E/11*2);case n.KANJI:return Math.floor(E/13);case n.BYTE:default:return Math.floor(E/8)}},t.getBestVersionForData=function(p,g){let w;const I=r.from(g,r.M);if(Array.isArray(p)){if(p.length>1)return f(p,I);if(p.length===0)return 1;w=p[0]}else w=p;return m(w.mode,w.getLength(),I)},t.getEncodedBits=function(p){if(!i.isValid(p)||p<7)throw new Error("Invalid QR Code version");let g=p<<12;for(;a.getBCHDigit(g)-l>=0;)g^=o<<a.getBCHDigit(g)-l;return p<<12|g}})(Cr)),Cr}var Tr={},fl;function md(){if(fl)return Tr;fl=1;const t=Mn(),a=1335,s=21522,r=t.getBCHDigit(a);return Tr.getEncodedBits=function(i,o){const l=i.bit<<3|o;let m=l<<10;for(;t.getBCHDigit(m)-r>=0;)m^=a<<t.getBCHDigit(m)-r;return(l<<10|m)^s},Tr}var Mr={},Ir,xl;function ud(){if(xl)return Ir;xl=1;const t=In();function a(s){this.mode=t.NUMERIC,this.data=s.toString()}return a.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(r){let n,i,o;for(n=0;n+3<=this.data.length;n+=3)i=this.data.substr(n,3),o=parseInt(i,10),r.put(o,10);const l=this.data.length-n;l>0&&(i=this.data.substr(n),o=parseInt(i,10),r.put(o,l*3+1))},Ir=a,Ir}var Dr,pl;function hd(){if(pl)return Dr;pl=1;const t=In(),a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(r){this.mode=t.ALPHANUMERIC,this.data=r}return s.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(n){let i;for(i=0;i+2<=this.data.length;i+=2){let o=a.indexOf(this.data[i])*45;o+=a.indexOf(this.data[i+1]),n.put(o,11)}this.data.length%2&&n.put(a.indexOf(this.data[i]),6)},Dr=s,Dr}var Ar,bl;function fd(){if(bl)return Ar;bl=1;const t=In();function a(s){this.mode=t.BYTE,typeof s=="string"?this.data=new TextEncoder().encode(s):this.data=new Uint8Array(s)}return a.getBitsLength=function(r){return r*8},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(s){for(let r=0,n=this.data.length;r<n;r++)s.put(this.data[r],8)},Ar=a,Ar}var Pr,gl;function xd(){if(gl)return Pr;gl=1;const t=In(),a=Mn();function s(r){this.mode=t.KANJI,this.data=r}return s.getBitsLength=function(n){return n*13},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(r){let n;for(n=0;n<this.data.length;n++){let i=a.toSJIS(this.data[n]);if(i>=33088&&i<=40956)i-=33088;else if(i>=57408&&i<=60351)i-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);i=(i>>>8&255)*192+(i&255),r.put(i,13)}},Pr=s,Pr}var Rr={exports:{}},yl;function pd(){return yl||(yl=1,(function(t){var a={single_source_shortest_paths:function(s,r,n){var i={},o={};o[r]=0;var l=a.PriorityQueue.make();l.push(r,0);for(var m,c,u,f,x,p,g,w,I;!l.empty();){m=l.pop(),c=m.value,f=m.cost,x=s[c]||{};for(u in x)x.hasOwnProperty(u)&&(p=x[u],g=f+p,w=o[u],I=typeof o[u]>"u",(I||w>g)&&(o[u]=g,l.push(u,g),i[u]=c))}if(typeof n<"u"&&typeof o[n]>"u"){var A=["Could not find a path from ",r," to ",n,"."].join("");throw new Error(A)}return i},extract_shortest_path_from_predecessor_list:function(s,r){for(var n=[],i=r;i;)n.push(i),s[i],i=s[i];return n.reverse(),n},find_path:function(s,r,n){var i=a.single_source_shortest_paths(s,r,n);return a.extract_shortest_path_from_predecessor_list(i,n)},PriorityQueue:{make:function(s){var r=a.PriorityQueue,n={},i;s=s||{};for(i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);return n.queue=[],n.sorter=s.sorter||r.default_sorter,n},default_sorter:function(s,r){return s.cost-r.cost},push:function(s,r){var n={value:s,cost:r};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=a})(Rr)),Rr.exports}var vl;function bd(){return vl||(vl=1,(function(t){const a=In(),s=ud(),r=hd(),n=fd(),i=xd(),o=mo(),l=Mn(),m=pd();function c(A){return unescape(encodeURIComponent(A)).length}function u(A,S,E){const M=[];let F;for(;(F=A.exec(E))!==null;)M.push({data:F[0],index:F.index,mode:S,length:F[0].length});return M}function f(A){const S=u(o.NUMERIC,a.NUMERIC,A),E=u(o.ALPHANUMERIC,a.ALPHANUMERIC,A);let M,F;return l.isKanjiModeEnabled()?(M=u(o.BYTE,a.BYTE,A),F=u(o.KANJI,a.KANJI,A)):(M=u(o.BYTE_KANJI,a.BYTE,A),F=[]),S.concat(E,M,F).sort(function(v,b){return v.index-b.index}).map(function(v){return{data:v.data,mode:v.mode,length:v.length}})}function x(A,S){switch(S){case a.NUMERIC:return s.getBitsLength(A);case a.ALPHANUMERIC:return r.getBitsLength(A);case a.KANJI:return i.getBitsLength(A);case a.BYTE:return n.getBitsLength(A)}}function p(A){return A.reduce(function(S,E){const M=S.length-1>=0?S[S.length-1]:null;return M&&M.mode===E.mode?(S[S.length-1].data+=E.data,S):(S.push(E),S)},[])}function g(A){const S=[];for(let E=0;E<A.length;E++){const M=A[E];switch(M.mode){case a.NUMERIC:S.push([M,{data:M.data,mode:a.ALPHANUMERIC,length:M.length},{data:M.data,mode:a.BYTE,length:M.length}]);break;case a.ALPHANUMERIC:S.push([M,{data:M.data,mode:a.BYTE,length:M.length}]);break;case a.KANJI:S.push([M,{data:M.data,mode:a.BYTE,length:c(M.data)}]);break;case a.BYTE:S.push([{data:M.data,mode:a.BYTE,length:c(M.data)}])}}return S}function w(A,S){const E={},M={start:{}};let F=["start"];for(let D=0;D<A.length;D++){const v=A[D],b=[];for(let _=0;_<v.length;_++){const J=v[_],T=""+D+_;b.push(T),E[T]={node:J,lastCount:0},M[T]={};for(let W=0;W<F.length;W++){const C=F[W];E[C]&&E[C].node.mode===J.mode?(M[C][T]=x(E[C].lastCount+J.length,J.mode)-x(E[C].lastCount,J.mode),E[C].lastCount+=J.length):(E[C]&&(E[C].lastCount=J.length),M[C][T]=x(J.length,J.mode)+4+a.getCharCountIndicator(J.mode,S))}}F=b}for(let D=0;D<F.length;D++)M[F[D]].end=0;return{map:M,table:E}}function I(A,S){let E;const M=a.getBestModeForData(A);if(E=a.from(S,M),E!==a.BYTE&&E.bit<M.bit)throw new Error('"'+A+'" cannot be encoded with mode '+a.toString(E)+`.
 Suggested mode is: `+a.toString(M));switch(E===a.KANJI&&!l.isKanjiModeEnabled()&&(E=a.BYTE),E){case a.NUMERIC:return new s(A);case a.ALPHANUMERIC:return new r(A);case a.KANJI:return new i(A);case a.BYTE:return new n(A)}}t.fromArray=function(S){return S.reduce(function(E,M){return typeof M=="string"?E.push(I(M,null)):M.data&&E.push(I(M.data,M.mode)),E},[])},t.fromString=function(S,E){const M=f(S,l.isKanjiModeEnabled()),F=g(M),D=w(F,E),v=m.find_path(D.map,"start","end"),b=[];for(let _=1;_<v.length-1;_++)b.push(D.table[v[_]].node);return t.fromArray(p(b))},t.rawSplit=function(S){return t.fromArray(f(S,l.isKanjiModeEnabled()))}})(Mr)),Mr}var jl;function gd(){if(jl)return pr;jl=1;const t=Mn(),a=ci(),s=sd(),r=nd(),n=ad(),i=rd(),o=id(),l=oo(),m=cd(),c=dd(),u=md(),f=In(),x=bd();function p(D,v){const b=D.size,_=i.getPositions(v);for(let J=0;J<_.length;J++){const T=_[J][0],W=_[J][1];for(let C=-1;C<=7;C++)if(!(T+C<=-1||b<=T+C))for(let Y=-1;Y<=7;Y++)W+Y<=-1||b<=W+Y||(C>=0&&C<=6&&(Y===0||Y===6)||Y>=0&&Y<=6&&(C===0||C===6)||C>=2&&C<=4&&Y>=2&&Y<=4?D.set(T+C,W+Y,!0,!0):D.set(T+C,W+Y,!1,!0))}}function g(D){const v=D.size;for(let b=8;b<v-8;b++){const _=b%2===0;D.set(b,6,_,!0),D.set(6,b,_,!0)}}function w(D,v){const b=n.getPositions(v);for(let _=0;_<b.length;_++){const J=b[_][0],T=b[_][1];for(let W=-2;W<=2;W++)for(let C=-2;C<=2;C++)W===-2||W===2||C===-2||C===2||W===0&&C===0?D.set(J+W,T+C,!0,!0):D.set(J+W,T+C,!1,!0)}}function I(D,v){const b=D.size,_=c.getEncodedBits(v);let J,T,W;for(let C=0;C<18;C++)J=Math.floor(C/3),T=C%3+b-8-3,W=(_>>C&1)===1,D.set(J,T,W,!0),D.set(T,J,W,!0)}function A(D,v,b){const _=D.size,J=u.getEncodedBits(v,b);let T,W;for(T=0;T<15;T++)W=(J>>T&1)===1,T<6?D.set(T,8,W,!0):T<8?D.set(T+1,8,W,!0):D.set(_-15+T,8,W,!0),T<8?D.set(8,_-T-1,W,!0):T<9?D.set(8,15-T-1+1,W,!0):D.set(8,15-T-1,W,!0);D.set(_-8,8,1,!0)}function S(D,v){const b=D.size;let _=-1,J=b-1,T=7,W=0;for(let C=b-1;C>0;C-=2)for(C===6&&C--;;){for(let Y=0;Y<2;Y++)if(!D.isReserved(J,C-Y)){let pe=!1;W<v.length&&(pe=(v[W]>>>T&1)===1),D.set(J,C-Y,pe),T--,T===-1&&(W++,T=7)}if(J+=_,J<0||b<=J){J-=_,_=-_;break}}}function E(D,v,b){const _=new s;b.forEach(function(Y){_.put(Y.mode.bit,4),_.put(Y.getLength(),f.getCharCountIndicator(Y.mode,D)),Y.write(_)});const J=t.getSymbolTotalCodewords(D),T=l.getTotalCodewordsCount(D,v),W=(J-T)*8;for(_.getLengthInBits()+4<=W&&_.put(0,4);_.getLengthInBits()%8!==0;)_.putBit(0);const C=(W-_.getLengthInBits())/8;for(let Y=0;Y<C;Y++)_.put(Y%2?17:236,8);return M(_,D,v)}function M(D,v,b){const _=t.getSymbolTotalCodewords(v),J=l.getTotalCodewordsCount(v,b),T=_-J,W=l.getBlocksCount(v,b),C=_%W,Y=W-C,pe=Math.floor(_/W),ue=Math.floor(T/W),Ie=ue+1,xe=pe-ue,bt=new m(xe);let He=0;const ge=new Array(W),oe=new Array(W);let O=0;const se=new Uint8Array(D.buffer);for(let Te=0;Te<W;Te++){const mt=Te<Y?ue:Ie;ge[Te]=se.slice(He,He+mt),oe[Te]=bt.encode(ge[Te]),He+=mt,O=Math.max(O,mt)}const ye=new Uint8Array(_);let be=0,De,Ge;for(De=0;De<O;De++)for(Ge=0;Ge<W;Ge++)De<ge[Ge].length&&(ye[be++]=ge[Ge][De]);for(De=0;De<xe;De++)for(Ge=0;Ge<W;Ge++)ye[be++]=oe[Ge][De];return ye}function F(D,v,b,_){let J;if(Array.isArray(D))J=x.fromArray(D);else if(typeof D=="string"){let pe=v;if(!pe){const ue=x.rawSplit(D);pe=c.getBestVersionForData(ue,b)}J=x.fromString(D,pe||40)}else throw new Error("Invalid data");const T=c.getBestVersionForData(J,b);if(!T)throw new Error("The amount of data is too big to be stored in a QR Code");if(!v)v=T;else if(v<T)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+T+`.
`);const W=E(v,b,J),C=t.getSymbolSize(v),Y=new r(C);return p(Y,v),g(Y),w(Y,v),A(Y,b,0),v>=7&&I(Y,v),S(Y,W),isNaN(_)&&(_=o.getBestMask(Y,A.bind(null,Y,b))),o.applyMask(_,Y),A(Y,b,_),{modules:Y,version:v,errorCorrectionLevel:b,maskPattern:_,segments:J}}return pr.create=function(v,b){if(typeof v>"u"||v==="")throw new Error("No input text");let _=a.M,J,T;return typeof b<"u"&&(_=a.from(b.errorCorrectionLevel,a.M),J=c.from(b.version),T=o.from(b.maskPattern),b.toSJISFunc&&t.setToSJISFunction(b.toSJISFunc)),F(v,J,_,T)},pr}var Lr={},Or={},Nl;function uo(){return Nl||(Nl=1,(function(t){function a(s){if(typeof s=="number"&&(s=s.toString()),typeof s!="string")throw new Error("Color should be defined as hex string");let r=s.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+s);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(i){return[i,i]}))),r.length===6&&r.push("F","F");const n=parseInt(r.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const n=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,i=r.width&&r.width>=21?r.width:void 0,o=r.scale||4;return{width:i,scale:i?4:o,margin:n,color:{dark:a(r.color.dark||"#000000ff"),light:a(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,n){return n.width&&n.width>=r+n.margin*2?n.width/(r+n.margin*2):n.scale},t.getImageWidth=function(r,n){const i=t.getScale(r,n);return Math.floor((r+n.margin*2)*i)},t.qrToImageData=function(r,n,i){const o=n.modules.size,l=n.modules.data,m=t.getScale(o,i),c=Math.floor((o+i.margin*2)*m),u=i.margin*m,f=[i.color.light,i.color.dark];for(let x=0;x<c;x++)for(let p=0;p<c;p++){let g=(x*c+p)*4,w=i.color.light;if(x>=u&&p>=u&&x<c-u&&p<c-u){const I=Math.floor((x-u)/m),A=Math.floor((p-u)/m);w=f[l[I*o+A]?1:0]}r[g++]=w.r,r[g++]=w.g,r[g++]=w.b,r[g]=w.a}}})(Or)),Or}var wl;function yd(){return wl||(wl=1,(function(t){const a=uo();function s(n,i,o){n.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=o,i.width=o,i.style.height=o+"px",i.style.width=o+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(i,o,l){let m=l,c=o;typeof m>"u"&&(!o||!o.getContext)&&(m=o,o=void 0),o||(c=r()),m=a.getOptions(m);const u=a.getImageWidth(i.modules.size,m),f=c.getContext("2d"),x=f.createImageData(u,u);return a.qrToImageData(x.data,i,m),s(f,c,u),f.putImageData(x,0,0),c},t.renderToDataURL=function(i,o,l){let m=l;typeof m>"u"&&(!o||!o.getContext)&&(m=o,o=void 0),m||(m={});const c=t.render(i,o,m),u=m.type||"image/png",f=m.rendererOpts||{};return c.toDataURL(u,f.quality)}})(Lr)),Lr}var Br={},Sl;function vd(){if(Sl)return Br;Sl=1;const t=uo();function a(n,i){const o=n.a/255,l=i+'="'+n.hex+'"';return o<1?l+" "+i+'-opacity="'+o.toFixed(2).slice(1)+'"':l}function s(n,i,o){let l=n+i;return typeof o<"u"&&(l+=" "+o),l}function r(n,i,o){let l="",m=0,c=!1,u=0;for(let f=0;f<n.length;f++){const x=Math.floor(f%i),p=Math.floor(f/i);!x&&!c&&(c=!0),n[f]?(u++,f>0&&x>0&&n[f-1]||(l+=c?s("M",x+o,.5+p+o):s("m",m,0),m=0,c=!1),x+1<i&&n[f+1]||(l+=s("h",u),u=0)):m++}return l}return Br.render=function(i,o,l){const m=t.getOptions(o),c=i.modules.size,u=i.modules.data,f=c+m.margin*2,x=m.color.light.a?"<path "+a(m.color.light,"fill")+' d="M0 0h'+f+"v"+f+'H0z"/>':"",p="<path "+a(m.color.dark,"stroke")+' d="'+r(u,c,m.margin)+'"/>',g='viewBox="0 0 '+f+" "+f+'"',I='<svg xmlns="http://www.w3.org/2000/svg" '+(m.width?'width="'+m.width+'" height="'+m.width+'" ':"")+g+' shape-rendering="crispEdges">'+x+p+`</svg>
`;return typeof l=="function"&&l(null,I),I},Br}var Cl;function jd(){if(Cl)return Qn;Cl=1;const t=td(),a=gd(),s=yd(),r=vd();function n(i,o,l,m,c){const u=[].slice.call(arguments,1),f=u.length,x=typeof u[f-1]=="function";if(!x&&!t())throw new Error("Callback required as last argument");if(x){if(f<2)throw new Error("Too few arguments provided");f===2?(c=l,l=o,o=m=void 0):f===3&&(o.getContext&&typeof c>"u"?(c=m,m=void 0):(c=m,m=l,l=o,o=void 0))}else{if(f<1)throw new Error("Too few arguments provided");return f===1?(l=o,o=m=void 0):f===2&&!o.getContext&&(m=l,l=o,o=void 0),new Promise(function(p,g){try{const w=a.create(l,m);p(i(w,o,m))}catch(w){g(w)}})}try{const p=a.create(l,m);c(null,i(p,o,m))}catch(p){c(p)}}return Qn.create=a.create,Qn.toCanvas=n.bind(null,s.render),Qn.toDataURL=n.bind(null,s.renderToDataURL),Qn.toString=n.bind(null,function(i,o,l){return r.render(i,l)}),Qn}var Nd=jd();const ho=Wa(Nd),wd={};function di(t,a){let s;try{s=t()}catch{return}return{getItem:n=>{var i;const o=m=>m===null?null:JSON.parse(m,void 0),l=(i=s.getItem(n))!=null?i:null;return l instanceof Promise?l.then(o):o(l)},setItem:(n,i)=>s.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>s.removeItem(n)}}const va=t=>a=>{try{const s=t(a);return s instanceof Promise?s:{then(r){return va(r)(s)},catch(r){return this}}}catch(s){return{then(r){return this},catch(r){return va(r)(s)}}}},Sd=(t,a)=>(s,r,n)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:I=>I,version:0,merge:(I,A)=>({...A,...I}),...a},o=!1;const l=new Set,m=new Set;let c;try{c=i.getStorage()}catch{}if(!c)return t((...I)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),s(...I)},r,n);const u=va(i.serialize),f=()=>{const I=i.partialize({...r()});let A;const S=u({state:I,version:i.version}).then(E=>c.setItem(i.name,E)).catch(E=>{A=E});if(A)throw A;return S},x=n.setState;n.setState=(I,A)=>{x(I,A),f()};const p=t((...I)=>{s(...I),f()},r,n);let g;const w=()=>{var I;if(!c)return;o=!1,l.forEach(S=>S(r()));const A=((I=i.onRehydrateStorage)==null?void 0:I.call(i,r()))||void 0;return va(c.getItem.bind(c))(i.name).then(S=>{if(S)return i.deserialize(S)}).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==i.version){if(i.migrate)return i.migrate(S.state,S.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return S.state}).then(S=>{var E;return g=i.merge(S,(E=r())!=null?E:p),s(g,!0),f()}).then(()=>{A?.(g,void 0),o=!0,m.forEach(S=>S(g))}).catch(S=>{A?.(void 0,S)})};return n.persist={setOptions:I=>{i={...i,...I},I.getStorage&&(c=I.getStorage())},clearStorage:()=>{c?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>w(),hasHydrated:()=>o,onHydrate:I=>(l.add(I),()=>{l.delete(I)}),onFinishHydration:I=>(m.add(I),()=>{m.delete(I)})},w(),g||p},Cd=(t,a)=>(s,r,n)=>{let i={storage:di(()=>localStorage),partialize:w=>w,version:0,merge:(w,I)=>({...I,...w}),...a},o=!1;const l=new Set,m=new Set;let c=i.storage;if(!c)return t((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),s(...w)},r,n);const u=()=>{const w=i.partialize({...r()});return c.setItem(i.name,{state:w,version:i.version})},f=n.setState;n.setState=(w,I)=>{f(w,I),u()};const x=t((...w)=>{s(...w),u()},r,n);n.getInitialState=()=>x;let p;const g=()=>{var w,I;if(!c)return;o=!1,l.forEach(S=>{var E;return S((E=r())!=null?E:x)});const A=((I=i.onRehydrateStorage)==null?void 0:I.call(i,(w=r())!=null?w:x))||void 0;return va(c.getItem.bind(c))(i.name).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==i.version){if(i.migrate)return[!0,i.migrate(S.state,S.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,S.state];return[!1,void 0]}).then(S=>{var E;const[M,F]=S;if(p=i.merge(F,(E=r())!=null?E:x),s(p,!0),M)return u()}).then(()=>{A?.(p,void 0),p=r(),o=!0,m.forEach(S=>S(p))}).catch(S=>{A?.(void 0,S)})};return n.persist={setOptions:w=>{i={...i,...w},w.storage&&(c=w.storage)},clearStorage:()=>{c?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:w=>(l.add(w),()=>{l.delete(w)}),onFinishHydration:w=>(m.add(w),()=>{m.delete(w)})},i.skipHydration||g(),p||x},kd=(t,a)=>"getStorage"in a||"serialize"in a||"deserialize"in a?((wd?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Sd(t,a)):Cd(t,a),fo=kd,za=qs()(fo((t,a)=>({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1,_hydrated:!1,setCalibration:s=>t(r=>({...r,...s})),reset:()=>t({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1})}),{name:"ndn-calibration-v1",storage:di(()=>localStorage),onRehydrateStorage:()=>(t,a)=>{if(!(a||!t))try{if(t&&!t.H){const s=localStorage.getItem("ndn:calibration:v1");if(s){const r=JSON.parse(s);r&&(r.H||r.imageSize)&&t.setCalibration({H:r.H??null,createdAt:r.createdAt??null,errorPx:r.errorPx??null,imageSize:r.imageSize??null,anchors:r.anchors??null,locked:!!r.locked})}}t._hydrated=!0}catch{}}}));let Ur=null,$r=null,Fr=null,_r=null;const na=qs()(fo((t,a)=>({isStreaming:!1,mode:"local",pairingCode:null,expiresAt:null,isPaired:!1,mobileUrl:null,showOverlay:!0,setStreaming:s=>{console.log("[CAMERA_SESSION] setStreaming:",s),t({isStreaming:s})},setMode:s=>{console.log("[CAMERA_SESSION] setMode:",s),t({mode:s})},setPairingCode:s=>t({pairingCode:s}),setExpiresAt:s=>t({expiresAt:s}),setPaired:s=>t({isPaired:s}),setMobileUrl:s=>t({mobileUrl:s}),setShowOverlay:s=>t({showOverlay:!!s}),setMediaStream:s=>{$r=s},getMediaStream:()=>$r,setPcRef:s=>{Fr=s},getPcRef:()=>Fr,setWsRef:s=>{_r=s},getWsRef:()=>_r,getVideoElementRef:()=>{const s=Ur;return s||console.warn("[cameraSession] âš ï¸ getVideoElementRef called but ref is NULL"),s},setVideoElementRef:s=>{s?console.log("[cameraSession] âœ… setVideoElementRef called - storing HTMLVideoElement",{tagName:s.tagName,hasStream:!!s.srcObject}):console.log("[cameraSession] ðŸ›‘ setVideoElementRef called - clearing ref"),Ur=s},clearSession:()=>{Ur=null,$r=null,Fr=null,_r=null,t({isStreaming:!1,pairingCode:null,expiresAt:null,isPaired:!1,mobileUrl:null})}}),{name:"ndn-camera-session",storage:di(()=>localStorage),partialize:t=>({isStreaming:t.isStreaming,mode:t.mode,pairingCode:t.pairingCode,expiresAt:t.expiresAt,isPaired:t.isPaired,mobileUrl:t.mobileUrl,showOverlay:t.showOverlay})})),ze={bullInner:6.35,bullOuter:15.9,trebleInner:99,trebleOuter:107,doubleInner:162,doubleOuter:170},Ed=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];function Va(t,a){const s=a.x,r=a.y,n=t[6]*s+t[7]*r+t[8],i=(t[0]*s+t[1]*r+t[2])/n,o=(t[3]*s+t[4]*r+t[5])/n;return{x:i,y:o}}function Td(t,a,s){return[a*t[0],a*t[1],a*t[2],s*t[3],s*t[4],s*t[5],t[6],t[7],t[8]]}function Md(t){const a=t,s=a[0],r=a[1],n=a[2],i=a[3],o=a[4],l=a[5],m=a[6],c=a[7],u=a[8],f=o*u-l*c,x=n*c-r*u,p=r*l-n*o,g=l*m-i*u,w=s*u-n*m,I=n*i-s*l,A=i*c-o*m,S=r*m-s*c,E=s*o-r*i,M=s*f+r*g+n*A;if(Math.abs(M)<1e-12)throw new Error("Singular homography");return[f/M,x/M,p/M,g/M,w/M,I/M,A/M,S/M,E/M]}function Zr(t,a){if(t.length<4||a.length<4)throw new Error("Need at least 4 correspondences");if(t.length!==a.length)throw new Error("Correspondences must have equal length");const s=[],r=[];for(let o=0;o<t.length;o++){const{x:l,y:m}=t[o],{x:c,y:u}=a[o];s.push([l,m,1,0,0,0,-c*l,-c*m]),r.push(c),s.push([0,0,0,l,m,1,-u*l,-u*m]),r.push(u)}const n=Id(s,r);return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],1]}function Id(t,a){const s=t.length,r=t[0].length,n=Array.from({length:r},()=>new Array(r).fill(0)),i=new Array(r).fill(0);for(let o=0;o<s;o++)for(let l=0;l<r;l++){i[l]+=t[o][l]*a[o];for(let m=0;m<r;m++)n[l][m]+=t[o][l]*t[o][m]}return Dd(n,i)}function Dd(t,a){const s=a.length,r=t.map((i,o)=>i.concat([a[o]]));for(let i=0;i<s;i++){let o=i;for(let l=i+1;l<s;l++)Math.abs(r[l][i])>Math.abs(r[o][i])&&(o=l);if(Math.abs(r[o][i])<1e-12)throw new Error("Singular matrix");if(o!==i){const l=r[i];r[i]=r[o],r[o]=l}for(let l=i+1;l<s;l++){const m=r[l][i]/r[i][i];for(let c=i;c<=s;c++)r[l][c]-=m*r[i][c]}}const n=new Array(s).fill(0);for(let i=s-1;i>=0;i--){let o=r[i][s];for(let l=i+1;l<s;l++)o-=r[i][l]*n[l];n[i]=o/r[i][i]}return n}function ua(){const t=ze.doubleOuter;return[{x:0,y:-t},{x:t,y:0},{x:0,y:t},{x:-t,y:0},{x:0,y:0},{x:0,y:-15.9}]}function xo(t,a,s=256){const r=[];for(let n=0;n<s;n++){const i=n/s*Math.PI*2,o=Va(t,{x:a*Math.cos(i),y:a*Math.sin(i)});r.push(o)}return r}function ei(t,a,s){let r=0;for(let n=0;n<a.length;n++){const i=Va(t,a[n]),o=i.x-s[n].x,l=i.y-s[n].y;r+=o*o+l*l}return Math.sqrt(r/a.length)}function Ad(t,a){const s=Md(t);return Va(s,a)}function Pd(t){const a=Math.hypot(t.x,t.y);let r=Math.atan2(t.y,t.x)*180/Math.PI;r=(r+360+90)%360;const n=Ed[Math.floor((360-r)%360/18)];return a<=ze.bullInner?{base:50,ring:"INNER_BULL",sector:25,mult:2}:a<=ze.bullOuter?{base:25,ring:"BULL",sector:25,mult:1}:a>=ze.doubleOuter?{base:0,ring:"MISS",sector:null,mult:0}:a>=ze.doubleInner?{base:n*2,ring:"DOUBLE",sector:n,mult:2}:a>=ze.trebleOuter?{base:n,ring:"SINGLE",sector:n,mult:1}:a>=ze.trebleInner?{base:n*3,ring:"TRIPLE",sector:n,mult:3}:{base:n,ring:"SINGLE",sector:n,mult:1}}function po(t,a,s="#10b981",r=2){if(a.length){t.save(),t.strokeStyle=s,t.lineWidth=r,t.beginPath(),t.moveTo(a[0].x,a[0].y);for(let n=1;n<a.length;n++)t.lineTo(a[n].x,a[n].y);t.closePath(),t.stroke(),t.restore()}}function Rd(t,a,s="#f59e0b"){t.save(),t.strokeStyle=s,t.lineWidth=2,t.beginPath(),t.moveTo(a.x-8,a.y),t.lineTo(a.x+8,a.y),t.moveTo(a.x,a.y-8),t.lineTo(a.x,a.y+8),t.stroke(),t.restore()}function $a(t,a,s){return Math.max(a,Math.min(s,t))}function Ld(t,a,s){const{width:r,data:n}=t,i=[[-1,0,1],[-2,0,2],[-1,0,1]],o=[[-1,-2,-1],[0,0,0],[1,2,1]];let l=0,m=0;for(let c=-1;c<=1;c++)for(let u=-1;u<=1;u++){const f=$a(a+u,0,r-1),p=($a(s+c,0,t.height-1)*r+f)*4,g=n[p],w=n[p+1],I=n[p+2],A=.299*g+.587*w+.114*I;l+=A*i[c+1][u+1],m+=A*o[c+1][u+1]}return Math.hypot(l,m)}function Od(t,a,s=6){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),i=$a(Math.round(a.x),1,t.width-2),o=$a(Math.round(a.y),1,t.height-2);let l={x:i,y:o,mag:-1};for(let m=o-s;m<=o+s;m++)for(let c=i-s;c<=i+s;c++){if(c<=0||m<=0||c>=t.width-1||m>=t.height-1)continue;const u=Ld(n,c,m);u>l.mag&&(l={x:c,y:m,mag:u})}return{x:l.x,y:l.y}}function Bd(t,a,s=6){return a.map(r=>Od(t,r,s))}var Hr,kl;function bo(){if(kl)return Hr;kl=1;var t=t||{};return t.Image=function(a,s,r){this.width=a||0,this.height=s||0,this.data=r||[]},t.grayscale=function(a,s){for(var r=a.data,n=s.data,i=r.length,o=0,l=0;o<i;o+=4)n[l++]=r[o]*.299+r[o+1]*.587+r[o+2]*.114+.5&255;return s.width=a.width,s.height=a.height,s},t.threshold=function(a,s,r){var n=a.data,i=s.data,o=n.length,l=[],m;for(m=0;m<256;++m)l[m]=m<=r?0:255;for(m=0;m<o;++m)i[m]=l[n[m]];return s.width=a.width,s.height=a.height,s},t.adaptiveThreshold=function(a,s,r,n){var i=a.data,o=s.data,l=i.length,m=[],c;for(t.stackBoxBlur(a,s,r),c=0;c<768;++c)m[c]=c-255<=-n?255:0;for(c=0;c<l;++c)o[c]=m[i[c]-o[c]+255];return s.width=a.width,s.height=a.height,s},t.otsu=function(a){var s=a.data,r=s.length,n=[],i=0,o=0,l=0,m=0,c=0,u=0,f,x,p;for(p=0;p<256;++p)n[p]=0;for(p=0;p<r;++p)n[s[p]]++;for(p=0;p<256;++p)o+=n[p]*p;for(p=0;p<256;++p)if(m+=n[p],m!==0){if(c=r-m,c===0)break;l+=n[p]*p,f=l/m-(o-l)/c,x=m*c*f*f,x>u&&(u=x,i=p)}return i},t.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265],t.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13],t.BlurStack=function(){this.color=0,this.next=null},t.stackBoxBlur=function(a,s,r){var n=a.data,i=s.data,o=a.height,l=a.width,m=o-1,c=l-1,u=r+r+1,f=r+1,x=t.stackBoxBlurMult[r],p=t.stackBoxBlurShift[r],g,w,I,A,S,E,M,F,D,v;for(g=w=new t.BlurStack,v=1;v<u;++v)g=g.next=new t.BlurStack;for(g.next=w,S=0,D=0;D<o;++D){for(E=S,I=n[S],A=f*I,g=w,v=0;v<f;++v)g.color=I,g=g.next;for(v=1;v<f;++v)g.color=n[S+v],A+=g.color,g=g.next;for(g=w,F=0;F<l;++F)i[S++]=A*x>>>p,M=F+f,M=E+(M<c?M:c),A-=g.color-n[M],g.color=n[M],g=g.next}for(F=0;F<l;++F){for(S=F,E=S+l,I=i[S],A=f*I,g=w,v=0;v<f;++v)g.color=I,g=g.next;for(v=1;v<f;++v)g.color=i[E],A+=g.color,g=g.next,E+=l;for(g=w,D=0;D<o;++D)i[S]=A*x>>>p,M=D+f,M=F+(M<m?M:m)*l,A-=g.color-i[M],g.color=i[M],g=g.next,S+=l}return s},t.gaussianBlur=function(a,s,r,n){var i=t.gaussianKernel(n);return s.width=a.width,s.height=a.height,r.width=a.width,r.height=a.height,t.gaussianBlurFilter(a,r,i,!0),t.gaussianBlurFilter(r,s,i,!1),s},t.gaussianBlurFilter=function(a,s,r,n){var i=a.data,o=s.data,l=a.height,m=a.width,c=0,u=r.length>>1,f,x,p,g,w;for(p=0;p<l;++p)for(g=0;g<m;++g){for(x=0,w=-u;w<=u;++w)n?(f=c+w,(g+w<0||g+w>=m)&&(f=c)):(f=c+w*m,(p+w<0||p+w>=l)&&(f=c)),x+=r[u+w]*i[f];o[c++]=n?x:x+.5&255}return s},t.gaussianKernel=function(a){var s=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],r=[],n,i,o,l,m,c;if(a<=7&&a%2===1)r=s[a>>1];else{for(n=(a-1)*.5,i=.8+.3*(n-1),o=-.5/(i*i),l=0,c=0;c<a;++c)m=c-n,l+=r[c]=Math.exp(o*m*m);for(l=1/l,c=0;c<a;++c)r[c]*=l}return r},t.findContours=function(a,s){var r=a.width,n=a.height,i=[],o,l,m,c,u,f,x,p,g;for(o=t.binaryBorder(a,s),l=t.neighborhoodDeltas(r+2),m=r+3,u=1,p=0;p<n;++p,m+=2)for(g=0;g<r;++g,++m)c=o[m],c!==0&&(f=x=!1,c===1&&o[m-1]===0?f=!0:c>=1&&o[m+1]===0&&(x=!0),(f||x)&&(++u,i.push(t.borderFollowing(o,m,u,{x:g,y:p},x,l))));return i},t.borderFollowing=function(a,s,r,n,i,o){var l=[],m,c,u,f,x;l.hole=i,f=x=i?0:4;do if(f=f-1&7,m=s+o[f],a[m]!==0)break;while(f!==x);if(f===x)a[s]=-r,l.push({x:n.x,y:n.y});else for(c=s;;){x=f;do u=c+o[++f];while(a[u]===0);if(f&=7,f-1>>>0<x>>>0?a[c]=-r:a[c]===1&&(a[c]=r),l.push({x:n.x,y:n.y}),n.x+=t.neighborhood[f][0],n.y+=t.neighborhood[f][1],u===s&&c===m)break;c=u,f=f+4&7}return l},t.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],t.neighborhoodDeltas=function(a){for(var s=[],r=t.neighborhood.length,n=0;n<r;++n)s[n]=t.neighborhood[n][0]+t.neighborhood[n][1]*a;return s.concat(s)},t.approxPolyDP=function(a,s){var r={start_index:0,end_index:0},n={start_index:0,end_index:0},i=[],o=[],l=a.length,m,c,u,f,x,p,g,w,I,A,S;for(s*=s,S=0,I=0;I<3;++I)for(x=0,S=(S+n.start_index)%l,c=a[S],++S===l&&(S=0),A=1;A<l;++A)m=a[S],++S===l&&(S=0),g=m.x-c.x,w=m.y-c.y,f=g*g+w*w,f>x&&(x=f,n.start_index=A);for(x<=s?i.push({x:c.x,y:c.y}):(r.start_index=S,r.end_index=n.start_index+=r.start_index,n.start_index-=n.start_index>=l?l:0,n.end_index=r.start_index,n.end_index<n.start_index&&(n.end_index+=l),o.push({start_index:n.start_index,end_index:n.end_index}),o.push({start_index:r.start_index,end_index:r.end_index}));o.length!==0;){if(r=o.pop(),u=a[r.end_index%l],c=a[S=r.start_index%l],++S===l&&(S=0),r.end_index<=r.start_index+1)p=!0;else{for(x=0,g=u.x-c.x,w=u.y-c.y,I=r.start_index+1;I<r.end_index;++I)m=a[S],++S===l&&(S=0),f=Math.abs((m.y-c.y)*g-(m.x-c.x)*w),f>x&&(x=f,n.start_index=I);p=x*x<=s*(g*g+w*w)}p?i.push({x:c.x,y:c.y}):(n.end_index=r.end_index,r.end_index=n.start_index,o.push({start_index:n.start_index,end_index:n.end_index}),o.push({start_index:r.start_index,end_index:r.end_index}))}return i},t.warp=function(a,s,r,n){var i=a.data,o=s.data,l=a.width,m=a.height,c=0,u,f,x,p,g,w,I,A,S,E,M,F,D,v,b,_,J,T,W,C,Y,pe,ue;for(D=t.getPerspectiveTransform(r,n-1),v=D[8],b=D[2],_=D[5],pe=0;pe<n;++pe)for(v+=D[7],b+=D[1],_+=D[4],J=v,T=b,W=_,ue=0;ue<n;++ue)J+=D[6],T+=D[0],W+=D[3],C=T/J,Y=W/J,u=C>>>0,f=u===l-1?u:u+1,x=C-u,p=1-x,g=Y>>>0,w=g===m-1?g:g+1,I=Y-g,A=1-I,S=E=g*l,M=F=w*l,o[c++]=A*(p*i[S+u]+x*i[E+f])+I*(p*i[M+u]+x*i[F+f])&255;return s.width=n,s.height=n,s},t.getPerspectiveTransform=function(a,s){var r=t.square2quad(a);return r[0]/=s,r[1]/=s,r[3]/=s,r[4]/=s,r[6]/=s,r[7]/=s,r},t.square2quad=function(a){var s=[],r,n,i,o,l,m,c;return r=a[0].x-a[1].x+a[2].x-a[3].x,n=a[0].y-a[1].y+a[2].y-a[3].y,r===0&&n===0?(s[0]=a[1].x-a[0].x,s[1]=a[2].x-a[1].x,s[2]=a[0].x,s[3]=a[1].y-a[0].y,s[4]=a[2].y-a[1].y,s[5]=a[0].y,s[6]=0,s[7]=0,s[8]=1):(i=a[1].x-a[2].x,o=a[3].x-a[2].x,l=a[1].y-a[2].y,m=a[3].y-a[2].y,c=i*m-o*l,s[6]=(r*m-o*n)/c,s[7]=(i*n-r*l)/c,s[8]=1,s[0]=a[1].x-a[0].x+s[6]*a[1].x,s[1]=a[3].x-a[0].x+s[7]*a[3].x,s[2]=a[0].x,s[3]=a[1].y-a[0].y+s[6]*a[1].y,s[4]=a[3].y-a[0].y+s[7]*a[3].y,s[5]=a[0].y),s},t.isContourConvex=function(a){var s=0,r=!0,n=a.length,i=0,o=0,l,m,c,u,f,x,p,g;for(m=a[n-1],l=a[0],f=l.x-m.x,x=l.y-m.y;i<n;++i){if(++o===n&&(o=0),m=l,l=a[o],p=l.x-m.x,g=l.y-m.y,c=p*x,u=g*f,s|=u>c?1:u<c?2:3,s===3){r=!1;break}f=p,x=g}return r},t.perimeter=function(a){for(var s=a.length,r=0,n=s-1,i=0,o,l;r<s;n=r++)o=a[r].x-a[n].x,l=a[r].y-a[n].y,i+=Math.sqrt(o*o+l*l);return i},t.minEdgeLength=function(a){for(var s=a.length,r=0,n=s-1,i=1/0,o,l,m;r<s;n=r++)l=a[r].x-a[n].x,m=a[r].y-a[n].y,o=l*l+m*m,o<i&&(i=o);return Math.sqrt(i)},t.countNonZero=function(a,s){var r=a.data,n=s.height,i=s.width,o=s.x+s.y*a.width,l=a.width-i,m=0,c,u;for(c=0;c<n;++c){for(u=0;u<i;++u)r[o++]!==0&&++m;o+=l}return m},t.binaryBorder=function(a,s){var r=a.data,n=a.height,i=a.width,o=0,l=0,m,c;for(c=-2;c<i;++c)s[l++]=0;for(m=0;m<n;++m){for(s[l++]=0,c=0;c<i;++c)s[l++]=r[o++]===0?0:1;s[l++]=0}for(c=-2;c<i;++c)s[l++]=0;return s},Hr=t,Hr}var Wr,El;function Ud(){if(El)return Wr;El=1;var t=bo(),a=a||{};return a.Marker=function(s,r){this.id=s,this.corners=r},a.Detector=function(){this.grey=new t.Image,this.thres=new t.Image,this.homography=new t.Image,this.binary=[],this.contours=[],this.polys=[],this.candidates=[]},a.Detector.prototype.detect=function(s){return t.grayscale(s,this.grey),t.adaptiveThreshold(this.grey,this.thres,2,7),this.contours=t.findContours(this.thres,this.binary),this.candidates=this.findCandidates(this.contours,s.width*.2,.05,10),this.candidates=this.clockwiseCorners(this.candidates),this.candidates=this.notTooNear(this.candidates,10),this.findMarkers(this.grey,this.candidates,49)},a.Detector.prototype.findCandidates=function(s,r,n,i){var o=[],l=s.length,m,c,u;for(this.polys=[],u=0;u<l;++u)m=s[u],m.length>=r&&(c=t.approxPolyDP(m,m.length*n),this.polys.push(c),c.length===4&&t.isContourConvex(c)&&t.minEdgeLength(c)>=i&&o.push(c));return o},a.Detector.prototype.clockwiseCorners=function(s){var r=s.length,n,i,o,l,m,c;for(c=0;c<r;++c)n=s[c][1].x-s[c][0].x,o=s[c][1].y-s[c][0].y,i=s[c][2].x-s[c][0].x,l=s[c][2].y-s[c][0].y,n*l-o*i<0&&(m=s[c][1],s[c][1]=s[c][3],s[c][3]=m);return s},a.Detector.prototype.notTooNear=function(s,r){var n=[],i=s.length,o,l,m,c,u,f;for(c=0;c<i;++c)for(u=c+1;u<i;++u){for(o=0,f=0;f<4;++f)l=s[c][f].x-s[u][f].x,m=s[c][f].y-s[u][f].y,o+=l*l+m*m;o/4<r*r&&(t.perimeter(s[c])<t.perimeter(s[u])?s[c].tooNear=!0:s[u].tooNear=!0)}for(c=0;c<i;++c)s[c].tooNear||n.push(s[c]);return n},a.Detector.prototype.findMarkers=function(s,r,n){var i=[],o=r.length,l,m,c;for(c=0;c<o;++c)l=r[c],t.warp(s,this.homography,l,n),t.threshold(this.homography,this.homography,t.otsu(this.homography)),m=this.getMarker(this.homography,l),m&&i.push(m);return i},a.Detector.prototype.getMarker=function(s,r){var n=s.width/7>>>0,i=n*n>>1,o=[],l=[],m=[],c,u,f,x,p;for(x=0;x<7;++x)for(f=x===0||x===6?1:6,p=0;p<7;p+=f)if(c={x:p*n,y:x*n,width:n,height:n},t.countNonZero(s,c)>i)return null;for(x=0;x<5;++x)for(o[x]=[],p=0;p<5;++p)c={x:(p+1)*n,y:(x+1)*n,width:n,height:n},o[x][p]=t.countNonZero(s,c)>i?1:0;for(l[0]=o,m[0]=this.hammingDistance(l[0]),u={first:m[0],second:0},x=1;x<4;++x)l[x]=this.rotate(l[x-1]),m[x]=this.hammingDistance(l[x]),m[x]<u.first&&(u.first=m[x],u.second=x);return u.first!==0?null:new a.Marker(this.mat2id(l[u.second]),this.rotate2(r,4-u.second))},a.Detector.prototype.hammingDistance=function(s){var r=[[1,0,0,0,0],[1,0,1,1,1],[0,1,0,0,1],[0,1,1,1,0]],n=0,i,o,l,m,c;for(l=0;l<5;++l){for(o=1/0,m=0;m<4;++m){for(i=0,c=0;c<5;++c)i+=s[l][c]===r[m][c]?0:1;i<o&&(o=i)}n+=o}return n},a.Detector.prototype.mat2id=function(s){var r=0,n;for(n=0;n<5;++n)r<<=1,r|=s[n][1],r<<=1,r|=s[n][3];return r},a.Detector.prototype.rotate=function(s){var r=[],n=s.length,i,o;for(i=0;i<n;++i)for(r[i]=[],o=0;o<s[i].length;++o)r[i][o]=s[s[i].length-o-1][i];return r},a.Detector.prototype.rotate2=function(s,r){var n=[],i=s.length,o;for(o=0;o<i;++o)n[o]=s[(r+o)%i];return n},Wr=a,Wr}var qr,Tl;function mi(){if(Tl)return qr;Tl=1;var t=t||{};return t.svdcmp=function(a,s,r,n,i){var o,l,m,c,u,f,x,p,g=0,w,I,A=0,S,E,M=0,F,D,v,b=[];for(l=0;l<r;++l){if(x=l+1,b[l]=M*A,A=E=M=0,l<s){for(f=l;f<s;++f)M+=Math.abs(a[f][l]);if(M!==0){for(f=l;f<s;++f)a[f][l]/=M,E+=a[f][l]*a[f][l];for(I=a[l][l],A=-t.sign(Math.sqrt(E),I),S=I*A-E,a[l][l]=I-A,c=x;c<r;++c){for(E=0,f=l;f<s;++f)E+=a[f][l]*a[f][c];for(I=E/S,f=l;f<s;++f)a[f][c]+=I*a[f][l]}for(f=l;f<s;++f)a[f][l]*=M}}if(n[l]=M*A,A=E=M=0,l<s&&l!==r-1){for(f=x;f<r;++f)M+=Math.abs(a[l][f]);if(M!==0){for(f=x;f<r;++f)a[l][f]/=M,E+=a[l][f]*a[l][f];for(I=a[l][x],A=-t.sign(Math.sqrt(E),I),S=I*A-E,a[l][x]=I-A,f=x;f<r;++f)b[f]=a[l][f]/S;for(c=x;c<s;++c){for(E=0,f=x;f<r;++f)E+=a[c][f]*a[l][f];for(f=x;f<r;++f)a[c][f]+=E*b[f]}for(f=x;f<r;++f)a[l][f]*=M}}g=Math.max(g,Math.abs(n[l])+Math.abs(b[l]))}for(l=r-1;l>=0;--l){if(l<r-1){if(A!==0){for(c=x;c<r;++c)i[c][l]=a[l][c]/a[l][x]/A;for(c=x;c<r;++c){for(E=0,f=x;f<r;++f)E+=a[l][f]*i[f][c];for(f=x;f<r;++f)i[f][c]+=E*i[f][l]}}for(c=x;c<r;++c)i[l][c]=i[c][l]=0}i[l][l]=1,A=b[l],x=l}for(l=Math.min(r,s)-1;l>=0;--l){for(x=l+1,A=n[l],c=x;c<r;++c)a[l][c]=0;if(A!==0){for(A=1/A,c=x;c<r;++c){for(E=0,f=x;f<s;++f)E+=a[f][l]*a[f][c];for(I=E/a[l][l]*A,f=l;f<s;++f)a[f][c]+=I*a[f][l]}for(c=l;c<s;++c)a[c][l]*=A}else for(c=l;c<s;++c)a[c][l]=0;++a[l][l]}for(f=r-1;f>=0;--f)for(m=1;m<=30;++m){for(o=!0,x=f;x>=0;--x){if(p=x-1,Math.abs(b[x])+g===g){o=!1;break}if(Math.abs(n[p])+g===g)break}if(o)for(w=0,E=1,l=x;l<=f&&(I=E*b[l],Math.abs(I)+g!==g);++l)for(A=n[l],S=t.pythag(I,A),n[l]=S,S=1/S,w=A*S,E=-I*S,c=1;c<=s;++c)D=a[c][p],v=a[c][l],a[c][p]=D*w+v*E,a[c][l]=v*w-D*E;if(v=n[f],x===f){if(v<0)for(n[f]=-v,c=0;c<r;++c)i[c][f]=-i[c][f];break}if(m===30)return!1;for(F=n[x],p=f-1,D=n[p],A=b[p],S=b[f],I=((D-v)*(D+v)+(A-S)*(A+S))/(2*S*D),A=t.pythag(I,1),I=((F-v)*(F+v)+S*(D/(I+t.sign(A,I))-S))/F,w=E=1,c=x;c<=p;++c){for(l=c+1,A=b[l],D=n[l],S=E*A,A=w*A,v=t.pythag(I,S),b[c]=v,w=I/v,E=S/v,I=F*w+A*E,A=A*w-F*E,S=D*E,D*=w,u=0;u<r;++u)F=i[u][c],v=i[u][l],i[u][c]=F*w+v*E,i[u][l]=v*w-F*E;for(v=t.pythag(I,S),n[c]=v,v!==0&&(v=1/v,w=I*v,E=S*v),I=w*A+E*D,F=w*D-E*A,u=0;u<s;++u)D=a[u][c],v=a[u][l],a[u][c]=D*w+v*E,a[u][l]=v*w-D*E}b[x]=0,b[f]=I,n[f]=F}return!0},t.pythag=function(a,s){var r=Math.abs(a),n=Math.abs(s),i;return r>n?(i=n/r,r*Math.sqrt(1+i*i)):n===0?0:(i=r/n,n*Math.sqrt(1+i*i))},t.sign=function(a,s){return s>=0?Math.abs(a):-Math.abs(a)},qr=t,qr}var zr,Ml;function $d(){if(Ml)return zr;Ml=1;var t=mi(),a=a||{};return a.Posit=function(s,r){this.objectPoints=this.buildModel(s),this.focalLength=r,this.objectVectors=[],this.objectNormal=[],this.objectMatrix=[[],[],[]],this.init()},a.Posit.prototype.buildModel=function(s){var r=s/2;return[[-r,r,0],[r,r,0],[r,-r,0],[-r,-r,0]]},a.Posit.prototype.init=function(){var s=this.objectPoints.length,r=[],n=[],i=0,o=2,l;for(l=0;l<s;++l)this.objectVectors[l]=[this.objectPoints[l][0]-this.objectPoints[0][0],this.objectPoints[l][1]-this.objectPoints[0][1],this.objectPoints[l][2]-this.objectPoints[0][2]],r[l]=[this.objectVectors[l][0],this.objectVectors[l][1],this.objectVectors[l][2]];for(;i===0;)n[0]=this.objectVectors[1][1]*this.objectVectors[o][2]-this.objectVectors[1][2]*this.objectVectors[o][1],n[1]=this.objectVectors[1][2]*this.objectVectors[o][0]-this.objectVectors[1][0]*this.objectVectors[o][2],n[2]=this.objectVectors[1][0]*this.objectVectors[o][1]-this.objectVectors[1][1]*this.objectVectors[o][0],i=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),++o;for(l=0;l<3;++l)this.objectNormal[l]=n[l]/i;a.pseudoInverse(r,s,this.objectMatrix)},a.Posit.prototype.pose=function(s){var r=[[],[],[]],n=[[],[],[]],i=[],o=[[],[],[]],l=[[],[],[]],m=[],c=[],u,f,x,p,g,w;for(this.pos(s,r,n,i),x=this.isValid(r,i),x?u=this.iterate(s,r,i,o,m):u={euclidean:-1,pixels:-1,maximum:-1},p=this.isValid(n,i),p?f=this.iterate(s,n,i,l,c):f={euclidean:-1,pixels:-1,maximum:-1},g=0;g<3;++g)for(w=0;w<3;++w)x&&(m[g]-=o[g][w]*this.objectPoints[0][w]),p&&(c[g]-=l[g][w]*this.objectPoints[0][w]);return u.euclidean<f.euclidean?new a.Pose(u.pixels,o,m,f.pixels,l,c):new a.Pose(f.pixels,l,c,u.pixels,o,m)},a.Posit.prototype.pos=function(s,r,n,i){var o=this.objectPoints.length,l=[],m=[],c=[],u=[],f=[],x=[],p=[],g=[],w,I,A,S,E,M,F,D,v,b;for(v=0;v<o;++v)l[v]=[s[v].x-s[0].x,s[v].y-s[0].y];for(v=0;v<3;++v)for(m[v]=0,c[v]=0,b=0;b<o;++b)m[v]+=this.objectMatrix[v][b]*l[b][0],c[v]+=this.objectMatrix[v][b]*l[b][1];for(w=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],I=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],A=m[0]*c[0]+m[1]*c[1]+m[2]*c[2],S=(I-w)*(I-w)+4*(A*A),I-w>=0?E=(I-w+Math.sqrt(S))/2:E=(I-w-Math.sqrt(S))/2,E>=0?(M=Math.sqrt(E),M===0?F=0:F=-A/M):(M=Math.sqrt(-(A*A)/E),M===0?F=Math.sqrt(w-I):F=-A/M),v=0;v<3;++v)u[v]=m[v]+M*this.objectNormal[v],f[v]=c[v]+F*this.objectNormal[v];for(D=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]),v=0;v<3;++v)x[v]=u[v]/D,p[v]=f[v]/D;for(g[0]=x[1]*p[2]-x[2]*p[1],g[1]=x[2]*p[0]-x[0]*p[2],g[2]=x[0]*p[1]-x[1]*p[0],v=0;v<3;++v)r[0][v]=x[v],r[1][v]=p[v],r[2][v]=g[v];for(v=0;v<3;++v)u[v]=m[v]-M*this.objectNormal[v],f[v]=c[v]-F*this.objectNormal[v];for(v=0;v<3;++v)x[v]=u[v]/D,p[v]=f[v]/D;for(g[0]=x[1]*p[2]-x[2]*p[1],g[1]=x[2]*p[0]-x[0]*p[2],g[2]=x[0]*p[1]-x[1]*p[0],v=0;v<3;++v)n[0][v]=x[v],n[1][v]=p[v],n[2][v]=g[v];i[0]=s[0].x/D,i[1]=s[0].y/D,i[2]=this.focalLength/D},a.Posit.prototype.isValid=function(s,r){for(var n=this.objectPoints.length,i=1/0,o=0,l;o<n;++o)l=r[2]+(s[2][0]*this.objectVectors[o][0]+s[2][1]*this.objectVectors[o][1]+s[2][2]*this.objectVectors[o][2]),l<i&&(i=l);return i>=0},a.Posit.prototype.iterate=function(s,r,n,i,o){var l=this.objectPoints.length,m=[],c=[],u=[[],[],[]],f=[[],[],[]],x=[],p=[],g=!1,w=0,I,A,S,E,M,F,D,v,b;for(v=0;v<l;++v)m[v]={x:s[v].x,y:s[v].y};for(v=0;v<3;++v){for(b=0;b<3;++b)i[v][b]=r[v][b];o[v]=n[v]}for(v=0;v<l;++v){for(S=0,b=0;b<3;++b)S+=this.objectVectors[v][b]*i[2][b]/o[2];c[v]={x:(1+S)*s[v].x,y:(1+S)*s[v].y}}for(A=0,v=0;v<l;++v)A+=Math.abs(c[v].x-m[v].x),A+=Math.abs(c[v].y-m[v].y);for(v=0;v<3;++v)x[v]=o[v]-(i[v][0]*this.objectPoints[0][0]+i[v][1]*this.objectPoints[0][1]+i[v][2]*this.objectPoints[0][2]);for(E=M=this.error(s,i,x),g=M.pixels===0||A<.01;w++<100&&!g;){for(v=0;v<l;++v)m[v].x=c[v].x,m[v].y=c[v].y;for(this.pos(c,u,f,o),v=0;v<3;++v)x[v]=o[v]-(u[v][0]*this.objectPoints[0][0]+u[v][1]*this.objectPoints[0][1]+u[v][2]*this.objectPoints[0][2]),p[v]=o[v]-(f[v][0]*this.objectPoints[0][0]+f[v][1]*this.objectPoints[0][1]+f[v][2]*this.objectPoints[0][2]);if(M=this.error(s,u,x),F=this.error(s,f,p),M.euclidean>=0&&F.euclidean>=0)if(F.euclidean<M.euclidean)for(E=F,v=0;v<3;++v)for(b=0;b<3;++b)i[v][b]=f[v][b];else for(E=M,v=0;v<3;++v)for(b=0;b<3;++b)i[v][b]=u[v][b];if(M.euclidean<0&&F.euclidean>=0)for(E=F,v=0;v<3;++v)for(b=0;b<3;++b)i[v][b]=f[v][b];if(F.euclidean<0&&M.euclidean>=0)for(E=M,v=0;v<3;++v)for(b=0;b<3;++b)i[v][b]=u[v][b];for(v=0;v<l;++v){for(S=0,b=0;b<3;++b)S+=this.objectVectors[v][b]*i[2][b]/o[2];c[v].x=(1+S)*s[v].x,c[v].y=(1+S)*s[v].y}for(I=A,A=0,v=0;v<l;++v)A+=Math.abs(c[v].x-m[v].x),A+=Math.abs(c[v].y-m[v].y);D=Math.abs(A-I),g=E.pixels===0||D<.01}return E},a.Posit.prototype.error=function(s,r,n){var i=this.objectPoints.length,o=[],l=[],m=[],c=0,u=0,f=0,x,p,g;if(!this.isValid(r,n))return{euclidean:-1,pixels:-1,maximum:-1};for(x=0;x<i;++x)for(o[x]=[],p=0;p<3;++p)o[x][p]=n[p];for(x=0;x<i;++x)for(p=0;p<3;++p)for(g=0;g<3;++g)o[x][p]+=r[p][g]*this.objectPoints[x][g];for(x=0;x<i;++x)for(l[x]=[],p=0;p<2;++p)l[x][p]=this.focalLength*o[x][p]/o[x][2];for(x=0;x<i;++x)m[x]=[l[x][0]-s[x].x,l[x][1]-s[x].y];for(x=0;x<i;++x)c+=Math.sqrt(m[x][0]*m[x][0]+m[x][1]*m[x][1]),u+=Math.abs(Math.round(l[x][0])-Math.round(s[x].x))+Math.abs(Math.round(l[x][1])-Math.round(s[x].y)),Math.abs(m[x][0])>f&&(f=Math.abs(m[x][0])),Math.abs(m[x][1])>f&&(f=Math.abs(m[x][1]));return{euclidean:c/i,pixels:u,maximum:f}},a.pseudoInverse=function(s,r,n){var i=[],o=[[],[],[]],l=[[],[],[]],m=0,c=0,u,f,x;for(t.svdcmp(s,r,3,i,o),u=0;u<3;++u)i[u]>m&&(m=i[u]);for(m*=.01,u=0;u<3;++u)i[u]<m&&(i[u]=0);for(f=0;f<3;++f)if(i[f]===0)for(++c,x=f;x<2;++x){for(u=0;u<r;++u)s[u][x]=s[u][x+1];for(u=0;u<3;++u)o[u][x]=o[u][x+1]}for(f=0;f<2;++f)i[f]===0&&(i[f]=i[f+1]);for(u=0;u<3;++u)for(f=0;f<3-c;++f)l[u][f]=o[u][f]/i[f];for(u=0;u<3;++u)for(f=0;f<r;++f)for(n[u][f]=0,x=0;x<3-c;++x)n[u][f]+=l[u][x]*s[f][x]},a.Pose=function(s,r,n,i,o,l){this.bestError=s,this.bestRotation=r,this.bestTranslation=n,this.alternativeError=i,this.alternativeRotation=o,this.alternativeTranslation=l},zr=a,zr}var Vr,Il;function Fd(){if(Il)return Vr;Il=1;var t=mi(),a=a||{};a.Posit=function(n,i){this.model=this.buildModel(n),this.focalLength=i,this.init()},a.Posit.prototype.buildModel=function(n){var i=n/2;return[new s(-i,i,0),new s(i,i,0),new s(i,-i,0),new s(-i,-i,0)]},a.Posit.prototype.init=function(){var n=new s,i=new r,o;this.modelVectors=r.fromRows(s.sub(this.model[1],this.model[0]),s.sub(this.model[2],this.model[0]),s.sub(this.model[3],this.model[0])),o=r.clone(this.modelVectors),t.svdcmp(o.m,3,3,n.v,i.m),this.modelPseudoInverse=r.mult(r.mult(i,r.fromDiagonal(s.inverse(n))),r.transpose(o)),this.modelNormal=i.column(n.minIndex())},a.Posit.prototype.pose=function(n){var i=new s(1,1,1),o=new r,l=new r,m=new s,c=new s,u,f;return this.pos(n,i,o,l,m,c),u=this.iterate(n,o,m),f=this.iterate(n,l,c),u<f?new a.Pose(u,o.m,m.v,f,l.m,c.v):new a.Pose(f,l.m,c.v,u,o.m,m.v)},a.Posit.prototype.pos=function(n,i,o,l,m,c){var u=new s(n[1].x,n[2].x,n[3].x),f=new s(n[1].y,n[2].y,n[3].y),x=s.addScalar(s.mult(u,i),-n[0].x),p=s.addScalar(s.mult(f,i),-n[0].y),g=r.multVector(this.modelPseudoInverse,x),w=r.multVector(this.modelPseudoInverse,p),I=w.square()-g.square(),A=s.dot(g,w),S=0,E=0,M,F,D,v,b,_,J,T,W;I===0?(S=Math.sqrt(Math.abs(2*A)),E=-Math.PI/2*(A<0?-1:A>0?1:0)):(S=Math.sqrt(Math.sqrt(I*I+4*A*A)),E=Math.atan(-2*A/I),I<0&&(E+=Math.PI),E/=2),T=S*Math.cos(E),W=S*Math.sin(E),M=s.add(g,s.multScalar(this.modelNormal,T)),F=s.add(w,s.multScalar(this.modelNormal,W)),v=M.normalize(),b=F.normalize(),D=s.cross(M,F),o.copy(r.fromRows(M,F,D)),_=(v+b)/2,J=r.multVector(o,this.model[0]),m.v=[n[0].x/_-J.v[0],n[0].y/_-J.v[1],this.focalLength/_],M=s.sub(g,s.multScalar(this.modelNormal,T)),F=s.sub(w,s.multScalar(this.modelNormal,W)),v=M.normalize(),b=F.normalize(),D=s.cross(M,F),l.copy(r.fromRows(M,F,D)),_=(v+b)/2,J=r.multVector(l,this.model[0]),c.v=[n[0].x/_-J.v[0],n[0].y/_-J.v[1],this.focalLength/_]},a.Posit.prototype.iterate=function(n,i,o){for(var l=1/0,m=new r,c=new r,u=new s,f=new s,x=0,p,g,w,I;x<100&&(p=s.addScalar(s.multScalar(r.multVector(this.modelVectors,i.row(2)),1/o.v[2]),1),this.pos(n,p,m,c,u,f),w=this.getError(n,m,u),I=this.getError(n,c,f),w<I?(i.copy(m),o.copy(u),g=w):(i.copy(c),o.copy(f),g=I),!(g<=2||g>l));++x)l=g;return g},a.Posit.prototype.getError=function(n,i,o){var l=s.add(r.multVector(i,this.model[0]),o),m=s.add(r.multVector(i,this.model[1]),o),c=s.add(r.multVector(i,this.model[2]),o),u=s.add(r.multVector(i,this.model[3]),o),f,x,p,g,w,I,A,S,E;return l=l.v,m=m.v,c=c.v,u=u.v,l[0]*=this.focalLength/l[2],l[1]*=this.focalLength/l[2],m[0]*=this.focalLength/m[2],m[1]*=this.focalLength/m[2],c[0]*=this.focalLength/c[2],c[1]*=this.focalLength/c[2],u[0]*=this.focalLength/u[2],u[1]*=this.focalLength/u[2],f=[{x:l[0],y:l[1]},{x:m[0],y:m[1]},{x:c[0],y:c[1]},{x:u[0],y:u[1]}],x=this.angle(n[0],n[1],n[3]),p=this.angle(n[1],n[2],n[0]),g=this.angle(n[2],n[3],n[1]),w=this.angle(n[3],n[0],n[2]),I=this.angle(f[0],f[1],f[3]),A=this.angle(f[1],f[2],f[0]),S=this.angle(f[2],f[3],f[1]),E=this.angle(f[3],f[0],f[2]),(Math.abs(x-I)+Math.abs(p-A)+Math.abs(g-S)+Math.abs(w-E))/4},a.Posit.prototype.angle=function(n,i,o){var l=i.x-n.x,m=i.y-n.y,c=o.x-n.x,u=o.y-n.y;return Math.acos((l*c+m*u)/(Math.sqrt(l*l+m*m)*Math.sqrt(c*c+u*u)))*180/Math.PI},a.Pose=function(n,i,o,l,m,c){this.bestError=n,this.bestRotation=i,this.bestTranslation=o,this.alternativeError=l,this.alternativeRotation=m,this.alternativeTranslation=c};var s=function(n,i,o){this.v=[n||0,i||0,o||0]};s.prototype.copy=function(n){var i=this.v;return n=n.v,i[0]=n[0],i[1]=n[1],i[2]=n[2],this},s.add=function(n,i){var o=new s,l=o.v;return n=n.v,i=i.v,l[0]=n[0]+i[0],l[1]=n[1]+i[1],l[2]=n[2]+i[2],o},s.sub=function(n,i){var o=new s,l=o.v;return n=n.v,i=i.v,l[0]=n[0]-i[0],l[1]=n[1]-i[1],l[2]=n[2]-i[2],o},s.mult=function(n,i){var o=new s,l=o.v;return n=n.v,i=i.v,l[0]=n[0]*i[0],l[1]=n[1]*i[1],l[2]=n[2]*i[2],o},s.addScalar=function(n,i){var o=new s,l=o.v;return n=n.v,l[0]=n[0]+i,l[1]=n[1]+i,l[2]=n[2]+i,o},s.multScalar=function(n,i){var o=new s,l=o.v;return n=n.v,l[0]=n[0]*i,l[1]=n[1]*i,l[2]=n[2]*i,o},s.dot=function(n,i){return n=n.v,i=i.v,n[0]*i[0]+n[1]*i[1]+n[2]*i[2]},s.cross=function(n,i){return n=n.v,i=i.v,new s(n[1]*i[2]-n[2]*i[1],n[2]*i[0]-n[0]*i[2],n[0]*i[1]-n[1]*i[0])},s.prototype.normalize=function(){var n=this.v,i=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return i>0&&(n[0]/=i,n[1]/=i,n[2]/=i),i},s.inverse=function(n){var i=new s,o=i.v;return n=n.v,n[0]!==0&&(o[0]=1/n[0]),n[1]!==0&&(o[1]=1/n[1]),n[2]!==0&&(o[2]=1/n[2]),i},s.prototype.square=function(){var n=this.v;return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},s.prototype.minIndex=function(){var n=this.v;return n[0]<n[1]?n[0]<n[2]?0:2:n[1]<n[2]?1:2};var r=function(){this.m=[[0,0,0],[0,0,0],[0,0,0]]};return r.clone=function(n){var i=new r,o=i.m;return n=n.m,o[0][0]=n[0][0],o[0][1]=n[0][1],o[0][2]=n[0][2],o[1][0]=n[1][0],o[1][1]=n[1][1],o[1][2]=n[1][2],o[2][0]=n[2][0],o[2][1]=n[2][1],o[2][2]=n[2][2],i},r.prototype.copy=function(n){var i=this.m;return n=n.m,i[0][0]=n[0][0],i[0][1]=n[0][1],i[0][2]=n[0][2],i[1][0]=n[1][0],i[1][1]=n[1][1],i[1][2]=n[1][2],i[2][0]=n[2][0],i[2][1]=n[2][1],i[2][2]=n[2][2],this},r.fromRows=function(n,i,o){var l=new r,m=l.m;return n=n.v,i=i.v,o=o.v,m[0][0]=n[0],m[0][1]=n[1],m[0][2]=n[2],m[1][0]=i[0],m[1][1]=i[1],m[1][2]=i[2],m[2][0]=o[0],m[2][1]=o[1],m[2][2]=o[2],l},r.fromDiagonal=function(n){var i=new r,o=i.m;return n=n.v,o[0][0]=n[0],o[1][1]=n[1],o[2][2]=n[2],i},r.transpose=function(n){var i=new r,o=i.m;return n=n.m,o[0][0]=n[0][0],o[0][1]=n[1][0],o[0][2]=n[2][0],o[1][0]=n[0][1],o[1][1]=n[1][1],o[1][2]=n[2][1],o[2][0]=n[0][2],o[2][1]=n[1][2],o[2][2]=n[2][2],i},r.mult=function(n,i){var o=new r,l=o.m;return n=n.m,i=i.m,l[0][0]=n[0][0]*i[0][0]+n[0][1]*i[1][0]+n[0][2]*i[2][0],l[0][1]=n[0][0]*i[0][1]+n[0][1]*i[1][1]+n[0][2]*i[2][1],l[0][2]=n[0][0]*i[0][2]+n[0][1]*i[1][2]+n[0][2]*i[2][2],l[1][0]=n[1][0]*i[0][0]+n[1][1]*i[1][0]+n[1][2]*i[2][0],l[1][1]=n[1][0]*i[0][1]+n[1][1]*i[1][1]+n[1][2]*i[2][1],l[1][2]=n[1][0]*i[0][2]+n[1][1]*i[1][2]+n[1][2]*i[2][2],l[2][0]=n[2][0]*i[0][0]+n[2][1]*i[1][0]+n[2][2]*i[2][0],l[2][1]=n[2][0]*i[0][1]+n[2][1]*i[1][1]+n[2][2]*i[2][1],l[2][2]=n[2][0]*i[0][2]+n[2][1]*i[1][2]+n[2][2]*i[2][2],o},r.multVector=function(n,i){return n=n.m,i=i.v,new s(n[0][0]*i[0]+n[0][1]*i[1]+n[0][2]*i[2],n[1][0]*i[0]+n[1][1]*i[1]+n[1][2]*i[2],n[2][0]*i[0]+n[2][1]*i[1]+n[2][2]*i[2])},r.prototype.column=function(n){var i=this.m;return new s(i[0][n],i[1][n],i[2][n])},r.prototype.row=function(n){var i=this.m;return new s(i[n][0],i[n][1],i[n][2])},Vr=a,Vr}var Gr,Dl;function _d(){return Dl||(Dl=1,Gr={CV:bo(),AR:Ud(),SVD:mi(),POS1:$d(),POS2:Fd()}),Gr}var Hd=_d();const Al=["top","right","bottom","left"],bs={top:0,right:1,bottom:2,left:3};let Jr=null;function Wd(){return Jr||(Jr=new Hd.AR.Detector),Jr}function qd(t){const a=t.reduce((r,n)=>({x:r.x+n.x,y:r.y+n.y}),{x:0,y:0}),s=t.length||1;return{x:a.x/s,y:a.y/s}}function zd(t){try{const s=Wd().detect(t)||[],r={},n=[];for(const f of s){const x=qd(f.corners);n.push({id:f.id,center:x});const p=Object.keys(bs).find(g=>bs[g]===f.id);p&&(r[p]={id:f.id,center:x})}const i=Object.keys(bs).filter(f=>!r[f]);if(i.length>0)return{success:!1,points:[],missing:i,markersFound:n,assignments:r,homography:null,errorPx:null,message:"Not all calibration markers were detected."};const o=[r.top.center,r.right.center,r.bottom.center,r.left.center],m=ua().slice(0,4),c=Zr(m,o),u=ei(c,m,o);return{success:!0,points:o,missing:[],markersFound:n,assignments:r,homography:c,errorPx:u}}catch(a){return{success:!1,points:[],missing:Object.keys(bs),markersFound:[],assignments:{},homography:null,errorPx:null,message:a instanceof Error?a.message:"Marker detection failed"}}}function Vd(t){const a=t.getContext("2d");if(!a)return{success:!1,points:[],missing:Object.keys(bs),markersFound:[],assignments:{},homography:null,errorPx:null,message:"Canvas context unavailable for marker detection."};const s=i=>zd(i);let r=a.getImageData(0,0,t.width,t.height),n=s(r);if(n.success||(n.markersFound?.length||0)>0)return n;try{const o=document.createElement("canvas");o.width=Math.round(t.width*1.75),o.height=Math.round(t.height*1.75);const l=o.getContext("2d");if(l.imageSmoothingEnabled=!1,l.drawImage(t,0,0,o.width,o.height),r=l.getImageData(0,0,o.width,o.height),n=s(r),n.success||(n.markersFound?.length||0)>0)return n}catch{}try{const i=t.width,o=t.height,l=a.getImageData(0,0,i,o),m=l.data;let c=255,u=0;for(let x=0;x<m.length;x+=4){const p=.2126*m[x]+.7152*m[x+1]+.0722*m[x+2];p<c&&(c=p),p>u&&(u=p)}const f=Math.max(1,u-c);for(let x=0;x<m.length;x+=4){const p=.2126*m[x]+.7152*m[x+1]+.0722*m[x+2],g=Math.max(0,Math.min(255,(p-c)*255/f));m[x]=m[x+1]=m[x+2]=g}if(n=s(l),n.success||(n.markersFound?.length||0)>0)return n}catch{}return{success:!1,points:[],missing:Object.keys(bs),markersFound:[],assignments:{},homography:null,errorPx:null,message:n.message||"No calibration markers detected. Ensure you are using the provided TOP/RIGHT/BOTTOM/LEFT ArUco markers printed at 100% on white paper."}}const Gd={"0,0":[1,0,0,0,0],"0,1":[1,0,1,1,1],"1,0":[0,1,0,0,1],"1,1":[0,1,1,1,0]};function Jd(t){const a=new Array(5);let s=t>>>0;for(let n=4;n>=0;n--){const i=s&1;s>>=1;const o=s&1;s>>=1;const l=Gd[`${o},${i}`];if(!l)throw new Error(`Unsupported marker id pattern for row ${n}`);a[n]=l.slice()}const r=Array.from({length:7},()=>new Array(7).fill(0));for(let n=0;n<5;n++)for(let i=0;i<5;i++)r[n+1][i+1]=a[n][i];return r}async function go(){const t=[];try{const a=await Kd();for(const s of a){const r=await Xd(s,[80,8080,8787,8788,3e3,5e3]);for(const n of r){const i=await Zd(n.ip,n.port);i&&t.push(i)}}}catch(a){console.error("Network discovery failed:",a)}return t}async function Kd(){const t=[];try{const a=new RTCPeerConnection({iceServers:[]});a.createDataChannel("");const s=await a.createOffer();return await a.setLocalDescription(s),new Promise(r=>{const n=setTimeout(()=>{a.close(),r(t)},5e3);a.onicecandidate=i=>{if(i.candidate){const l=i.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(l&&l[1]&&!t.includes(l[1])){const m=l[1];Yd(m)&&t.push(m)}}else clearTimeout(n),a.close(),r(t)}})}catch(a){return console.error("Failed to get local IPs:",a),["192.168.1.0"]}}function Yd(t){const a=t.split(".").map(Number);return a[0]===10||a[0]===172&&a[1]>=16&&a[1]<=31||a[0]===192&&a[1]===168}async function Xd(t,a){const s=[],r=t.split(".").slice(0,3).join("."),n=[];for(let o=1;o<=254;o++){const l=`${r}.${o}`;for(const m of a)n.push(Qd(l,m))}return(await Promise.allSettled(n)).forEach((o,l)=>{if(o.status==="fulfilled"&&o.value){const m=l%a.length,c=Math.floor(l/a.length),u=`${r}.${c+1}`;s.push({ip:u,port:a[m]})}}),s}async function Qd(t,a){try{const s=await fetch(`http://${t}:${a}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(2e3)});return!0}catch{return!1}}async function Zd(t,a){try{const s=["/","/api/info","/api/status","/camera","/stream"];for(const r of s)try{const n=await fetch(`http://${t}:${a}${r}`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(n.ok){const i=n.headers.get("content-type")||"",o=await n.text();if(o.includes("OMNI")||o.includes("omni")||r.includes("omni"))return{id:`omni-${t}-${a}`,name:`OMNI Camera (${t})`,ip:t,port:a,type:"omni",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(o.includes("VERT")||o.includes("vert")||r.includes("vert"))return{id:`vert-${t}-${a}`,name:`VERT Camera (${t})`,ip:t,port:a,type:"vert",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(i.includes("video")||o.includes("stream")||r==="/stream")return{id:`generic-${t}-${a}`,name:`Network Camera (${t})`,ip:t,port:a,type:"generic",capabilities:["video"],status:"online",connectionType:"wifi"}}}catch{}}catch(s){console.error(`Failed to probe device ${t}:${a}:`,s)}return null}async function em(){const t=[];try{if(!("serial"in navigator))return console.warn("Web Serial API not supported in this browser"),t;const a=await navigator.serial.getPorts();for(const s of a){const r=await yo(s);r&&t.push(r)}}catch(a){console.error("USB device discovery failed:",a)}return t}async function tm(){try{if(!("serial"in navigator))return alert("Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge."),null;const t=await navigator.serial.requestPort();return await yo(t)}catch(t){return t.name!=="NotFoundError"&&console.error("USB device request failed:",t),null}}async function yo(t){try{await t.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none"});const a=t.readable?.getReader();if(a)try{const s=setTimeout(()=>a.cancel(),2e3),{value:r,done:n}=await a.read();if(clearTimeout(s),!n&&r){const i=new TextDecoder().decode(r);if(i.includes("OMNI")||i.includes("omni"))return a.releaseLock(),{id:`usb-omni-${Date.now()}`,name:"OMNI Camera (USB)",type:"omni",capabilities:["video","calibration"],status:"online",port:t};if(i.includes("VERT")||i.includes("vert"))return a.releaseLock(),{id:`usb-vert-${Date.now()}`,name:"VERT Camera (USB)",type:"vert",capabilities:["video","calibration"],status:"online",port:t}}}catch{}finally{try{a.releaseLock()}catch{}}return{id:`usb-generic-${Date.now()}`,name:"USB Scoring Device",type:"generic",capabilities:["video"],status:"online",port:t}}catch(a){return console.error("Failed to probe USB device:",a),null}}async function vo(t){try{const a=`http://${t.ip}:${t.port}/stream`,s=document.createElement("video");return s.src=a,s.crossOrigin="anonymous",new Promise((r,n)=>{s.onloadeddata=()=>{const i=document.createElement("canvas"),o=i.getContext("2d");i.width=s.videoWidth,i.height=s.videoHeight;const l=i.captureStream(30),m=()=>{s.readyState>=2&&o.drawImage(s,0,0),requestAnimationFrame(m)};m(),r(l)},s.onerror=()=>n(new Error("Failed to load video stream")),s.load()})}catch(a){return console.error("Failed to connect to network device:",a),null}}async function sm(t){try{if(!t.port)throw new Error("No serial port available");return console.log("USB device connection not fully implemented yet"),null}catch(a){return console.error("Failed to connect to USB device:",a),null}}const nm={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8787",VITE_WS_URL:"ws://localhost:8787"};async function Pl(t){return new Promise((a,s)=>{const r=new Image;r.onload=()=>a(r),r.onerror=n=>s(n),r.src=t})}async function am(t,a){const[s,r]=await Promise.all([Pl(t),Pl(a)]),n=Math.max(160,s.width||160),i=Math.max(160,s.height||160),o=document.createElement("canvas");o.width=n,o.height=i;const l=o.getContext("2d");l.fillStyle="#ffffff",l.fillRect(0,0,n,i),l.imageSmoothingEnabled=!1,l.drawImage(s,0,0,n,i);const m=n/2,c=i/2,u=Math.round(Math.min(n,i)*.24);return l.drawImage(r,Math.round(m-u/2),Math.round(c-u/2),u,u),o.toDataURL("image/png")}function rm(){const t=d.useRef(null),a=d.useRef(null),s=d.useRef(null),r=d.useRef(null),[n,i]=d.useState(!1),[o,l]=d.useState(!1),[m,c]=d.useState("camera"),[u,f]=d.useState(()=>localStorage.getItem("ndn:cal:mode")||"local"),[x,p]=d.useState([]),[g,w]=d.useState(!1),[I,A]=d.useState(null),[S,E]=d.useState(1),[M,F]=d.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("ndn:cal:forceDesktop")==="1"}catch{return!1}}),[D,v]=d.useState(()=>typeof navigator>"u"?!1:/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)),{H:b,setCalibration:_,reset:J,errorPx:T,locked:W}=za(),C=na(),{calibrationGuide:Y,setCalibrationGuide:pe,preferredCameraId:ue,cameraEnabled:Ie,setCameraEnabled:xe,preferredCameraLocked:bt,setPreferredCameraLocked:He,setPreferredCamera:ge}=Ot(),[oe,O]=d.useState(null),[se,ye]=d.useState(!1),[be,De]=d.useState(0),[Ge,Te]=d.useState(null),mt=d.useCallback((P,q=480)=>{if(typeof document>"u")throw new Error("Marker rendering only available in browser context");const U=Jd(P),$=document.createElement("canvas");$.width=q,$.height=q;const H=$.getContext("2d");if(!H)throw new Error("Unable to create marker canvas context");H.imageSmoothingEnabled=!1,H.fillStyle="#ffffff",H.fillRect(0,0,q,q);const je=q*.08,ne=U.length,Ce=(q-je*2)/ne,tt=je;for(let vt=0;vt<ne;vt++)for(let ht=0;ht<ne;ht++){const wt=U[vt][ht];H.fillStyle=wt===1?"#000000":"#ffffff",H.fillRect(tt+ht*Ce,tt+vt*Ce,Ce,Ce)}return H.strokeStyle="#000000",H.lineWidth=Math.max(2,Ce*.08),H.strokeRect(tt,tt,Ce*ne,Ce*ne),$.toDataURL("image/png")},[]),Me=d.useCallback(()=>{try{const P=Al.map($=>{const H=bs[$];return{key:$,id:H,dataUrl:mt(H)}}),q=window.open("","_blank","width=900,height=1200");if(!q)throw new Error("Popup blocked by browser");const U=`<!DOCTYPE html>
			<html>
			<head>
				<meta charset="utf-8" />
				<title>Nine Dart Nation â€“ Marker Sheet</title>
				<style>
					body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 24px; color: #0f172a; }
					h1 { font-size: 20px; margin-bottom: 4px; }
					p { margin-top: 0; opacity: 0.7; }
					.grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 32px; margin-top: 24px; }
					.marker { text-align: center; }
					.marker h2 { font-size: 16px; margin: 12px 0 8px; }
					.marker img { width: 100%; max-width: 360px; border: 1px solid #0f172a; }
					footer { margin-top: 24px; font-size: 12px; opacity: 0.6; }
				</style>
			</head>
			<body>
				<h1>Marker sheet</h1>
				<p>Print at 100% scale on letter/A4 paper. Cut out and tape each marker so it is flush with the outer double ring.</p>
				<div class="grid">
					${P.map($=>`
						<div class="marker">
							<h2>${$.key.toUpperCase()} â€¢ ID ${$.id}</h2>
							<img src="${$.dataUrl}" alt="Marker ${$.key}" />
						</div>
					`).join("")}
				</div>
				<footer>Tip: Keep markers flat, smooth, and unobstructed for best detection results.</footer>
			</body>
			</html>`;q.document.write(U),q.document.close()}catch(P){console.error("Marker sheet generation failed",P),alert(`Unable to open marker sheet: ${P?.message||P}`)}},[mt]),[ce,Le]=d.useState(null),Xe=d.useRef(!1),[ot,Kt]=d.useState(null),Qe=d.useRef(null),ut=d.useCallback(P=>{Qe.current=P,Kt(P)},[Kt]),[Ae,le]=d.useState(null),[we,te]=d.useState(Date.now()),[X,qe]=d.useState(!1),Pe=d.useRef(null),ve=d.useRef([]),[k,ee]=d.useState(""),[et,Se]=d.useState(null),[gt,Ze]=d.useState(null),[Dt,st]=d.useState(!0),[cs,nt]=d.useState([]),[Ht,Yt]=d.useState(!1),[as,Ct]=d.useState(null),Wt=d.useRef(null);d.useEffect(()=>{const P=window.location.hostname;(P==="localhost"||P==="127.0.0.1")&&kt("/api/hosts").then(q=>q.json()).then(q=>{const U=Array.isArray(q?.hosts)&&q.hosts.find($=>$);U&&Se(U)}).catch(()=>{}),kt("/api/https-info").then(q=>q.json()).then(q=>{q&&typeof q.https=="boolean"&&Ze({https:!!q.https,port:Number(q.port)||8788})}).catch(()=>{})},[]);const at=d.useMemo(()=>{const P=ot||"____",q="ws://localhost:8787";if(q.length>0)try{const ne=new URL(q);return`${`${ne.protocol==="wss:"?"https":"http"}://${ne.host}${ne.pathname.endsWith("/ws")?"":ne.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${P}`}catch{}const U=et||window.location.hostname,$=!!gt?.https,H=$?gt?.port||8788:8787;return`${$?"https":"http"}://${U}:${H}/mobile-cam.html?code=${P}`},[ot,et,gt]),gs=d.useMemo(()=>{if(!at)return null;try{const P=new URL(at);return P.searchParams.delete("code"),P.toString().replace(/\?$/,"")}catch{return typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html"}},[at]);d.useEffect(()=>{localStorage.setItem("ndn:cal:mode",u)},[u]),d.useEffect(()=>{if(!(typeof window>"u"))try{M?window.localStorage.setItem("ndn:cal:forceDesktop","1"):window.localStorage.removeItem("ndn:cal:forceDesktop")}catch{}},[M]),d.useEffect(()=>{if(typeof window>"u")return;const P=window.matchMedia("(pointer: coarse)"),q=()=>{const U=typeof navigator<"u"&&/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent),$=typeof P.matches=="boolean"?P.matches:!1,H=window.innerWidth<=820;v(U||$||H)};q();try{typeof P.addEventListener=="function"?P.addEventListener("change",q):typeof P.addListener=="function"&&P.addListener(q)}catch{}return window.addEventListener("resize",q),()=>{try{typeof P.removeEventListener=="function"?P.removeEventListener("change",q):typeof P.removeListener=="function"&&P.removeListener(q)}catch{}window.removeEventListener("resize",q)}},[]),d.useEffect(()=>{if(!ot){ee("");return}ho.toDataURL(at,{width:256,margin:2,color:{dark:"#000000",light:"#ffffff"}}).then(async P=>{try{const q=nm?.VITE_QR_LOGO_URL||"/dart-thrower.svg",U=await am(P,q);ee(U)}catch{ee(P)}}).catch(()=>ee(""))},[at,ot]),d.useEffect(()=>{if(!Ae)return;const P=setInterval(()=>te(Date.now()),1e3);return()=>clearInterval(P)},[Ae]);const it=d.useMemo(()=>Ae?Math.max(0,Math.ceil((Ae-we)/1e3)):null,[Ae,we]);d.useEffect(()=>()=>{Wt.current&&window.clearTimeout(Wt.current)},[]);const As=d.useCallback(async(P,q)=>{if(P)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(P);else{const U=document.createElement("textarea");U.value=P,U.style.position="fixed",U.style.opacity="0",document.body.appendChild(U),U.focus(),U.select(),document.execCommand("copy"),document.body.removeChild(U)}Ct(q),Wt.current&&window.clearTimeout(Wt.current),Wt.current=window.setTimeout(()=>Ct(null),1500)}catch(U){console.warn("[Calibrator] Copy failed:",U),Ct(null)}},[]);d.useEffect(()=>{async function P(){try{if(console.log("[Calibrator] Requesting camera permission on load..."),await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),console.log("[Calibrator] Camera permission granted"),navigator.mediaDevices){const q=await navigator.mediaDevices.enumerateDevices();console.log("[Calibrator] Found devices:",q.filter(U=>U.kind==="videoinput").length,"cameras")}}catch(q){const U=q&&(q.name||q.code)||"";U==="NotAllowedError"?console.warn("[Calibrator] Camera permission denied by user"):U==="NotFoundError"||U==="NotAvailable"?console.warn("[Calibrator] No camera device found"):console.warn("[Calibrator] Camera permission request failed:",q)}}P()},[]),d.useEffect(()=>()=>{},[]),d.useEffect(()=>{const P=q=>{console.log("[Calibrator] Received reconnect request from PhoneCameraOverlay"),u==="phone"&&X&&(he(!1),setTimeout(()=>{qt()},500))};return window.addEventListener("ndn:phone-camera-reconnect",P),()=>{window.removeEventListener("ndn:phone-camera-reconnect",P)}},[u,X]),d.useEffect(()=>{console.log("[Calibrator] ðŸ”„ STREAMING CHANGED:",{streaming:n,videoRefAvailable:!!t.current}),t.current?(console.log("[Calibrator] âœ… Syncing videoElementRef on streaming change"),C.setVideoElementRef(t.current),t.current.srcObject instanceof MediaStream&&(console.log("[Calibrator] âœ… Setting mediaStream from video element"),C.setMediaStream(t.current.srcObject))):console.warn("[Calibrator] âš ï¸ videoRef.current is null on streaming change!")},[n]),d.useEffect(()=>(console.log("[Calibrator] ðŸš€ MOUNT: Initial mount - syncing videoRef"),console.log("[Calibrator] videoRef.current available:",!!t.current),console.log("[Calibrator] videoRef.current type:",t.current?.constructor?.name),t.current?(console.log("[Calibrator] âœ… Setting videoElementRef on mount"),console.log("[Calibrator] Video element:",{tagName:t.current.tagName,srcObject:!!t.current.srcObject,videoWidth:t.current.videoWidth,videoHeight:t.current.videoHeight}),C.setVideoElementRef(t.current),console.log("[Calibrator] âœ… videoElementRef set successfully")):console.error("[Calibrator] âŒ CRITICAL: videoRef.current is NULL at mount!"),()=>{}),[]);function Xt(){if(ce&&(ce.readyState===WebSocket.OPEN||ce.readyState===WebSocket.CONNECTING))return console.log("[Calibrator] ensureWS: Reusing existing WebSocket (state:",ce.readyState,")"),ce;const P="ws://localhost:8787",q=P.length>0?P.endsWith("/ws")?P:P.replace(/\/$/,"")+"/ws":void 0,$=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws`,H=window.location.hostname,ne=q||(H.endsWith("onrender.com")?$:"wss://ninedartnation.onrender.com/ws");console.log("[Calibrator] ensureWS: Creating new WebSocket to:",ne);let fe=new WebSocket(ne);return fe.onerror=Ce=>{console.error("[Calibrator] WebSocket connection error:",Ce),alert("Failed to connect to camera pairing service. Please check your internet connection and try again.")},fe.onclose=Ce=>{if(console.log("[Calibrator] WebSocket closed:",Ce.code,Ce.reason),Pe.current){try{Pe.current.close()}catch{}Pe.current=null}ut(null),le(null),qe(!1),Ce.code!==1e3&&(alert("Camera pairing connection lost. Please try pairing again."),u==="phone"&&f("local"))},Le(fe),fe}async function qt(){f("phone"),he(!1),At();try{xe(!0)}catch{}const P=Xt();P.readyState===WebSocket.OPEN?(console.log("[Calibrator] WebSocket open, sending cam-create"),P.send(JSON.stringify({type:"cam-create"}))):(console.log("[Calibrator] WebSocket connecting, will send cam-create on open"),P.onopen=()=>{console.log("[Calibrator] WebSocket now open, sending cam-create"),P.send(JSON.stringify({type:"cam-create"}))}),P.onmessage=async q=>{const U=JSON.parse(q.data);if(U.type==="cam-code")ut(U.code),U.expiresAt&&le(U.expiresAt);else if(U.type==="cam-peer-joined"){!Qe.current&&U.code&&ut(U.code),qe(!0);const $=Qe.current||U.code||null;$&&(Qe.current=$);try{if(W&&$){const je=a.current?{w:a.current.width,h:a.current.height}:null,ne={H:b,imageSize:je,errorPx:T??null,createdAt:Date.now()};P.send(JSON.stringify({type:"cam-calibration",code:$,payload:ne})),console.log("[Calibrator] Sent calibration to joined phone for code",$)}}catch(je){console.warn("[Calibrator] Failed to send calibration on peer join",je)}const H=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceCandidatePoolSize:10});Pe.current=H,H.onconnectionstatechange=()=>{console.log("WebRTC connection state:",H.connectionState),H.connectionState==="failed"||H.connectionState==="disconnected"?(console.error("WebRTC connection failed"),alert("Camera connection lost. Please try pairing again."),he(!1)):H.connectionState==="connected"&&console.log("WebRTC connection established")},H.onicecandidate=je=>{je.candidate&&$&&P.send(JSON.stringify({type:"cam-ice",code:$,payload:je.candidate}))},H.ontrack=je=>{if(console.log("[Calibrator] WebRTC ontrack received:",je.streams?.length,"streams, track kind:",je.track?.kind),t.current){const ne=je.streams?.[0];ne?(console.log("[Calibrator] Assigning video stream (tracks:",ne.getTracks().length,") to video element"),w(!1),setTimeout(()=>{t.current&&(console.log("[Calibrator] Setting srcObject and attempting play"),t.current.srcObject&&t.current.srcObject.getTracks().forEach(Ce=>Ce.stop()),t.current.srcObject=ne,t.current.muted=!0,t.current.playsInline=!0,t.current.play().then(()=>{console.log("[Calibrator] Video playback started successfully"),i(!0),c("capture"),C.setStreaming(!0),C.setMode("phone"),C.setMediaStream(ne);try{ge(void 0,"Phone Camera",!0)}catch{}if(!bt)try{He(!0),Xe.current=!0}catch{}try{xe(!0)}catch{}l(!1)}).catch(fe=>{console.error("[Calibrator] Video play failed:",fe),l(!0),console.warn("[Calibrator] video play blocked â€” prompting user interaction")}))},100)):console.error("[Calibrator] No inbound stream received in ontrack")}else console.error("[Calibrator] Video element not available")};try{const je=await H.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await H.setLocalDescription(je),console.log("[Calibrator] Sending cam-offer for code:",$),$?P.send(JSON.stringify({type:"cam-offer",code:$,payload:je})):console.warn("[Calibrator] Missing pairing code when sending offer")}catch(je){console.error("Failed to create WebRTC offer:",je),alert("Failed to establish camera connection. Please try again."),he(!1)}}else if(U.type==="cam-answer"){console.log("[Calibrator] Received cam-answer");const $=Pe.current;if($)try{await $.setRemoteDescription(new RTCSessionDescription(U.payload)),console.log("[Calibrator] Remote description set (answer)");const H=ve.current;console.log(`[Calibrator] Processing ${H.length} pending ICE candidates`);for(const je of H)try{await $.addIceCandidate(je),console.log("[Calibrator] Queued ICE candidate added")}catch(ne){console.error("Failed to add queued ICE candidate:",ne)}ve.current=[]}catch(H){console.error("Failed to set remote description:",H),alert("Camera pairing failed. Please try again."),he(!1)}else console.warn("[Calibrator] Received cam-answer but no peer connection exists")}else if(U.type==="cam-ice"){console.log("[Calibrator] Received cam-ice");const $=Pe.current;if($)if($.remoteDescription)try{await $.addIceCandidate(U.payload),console.log("[Calibrator] ICE candidate added")}catch(H){console.error("Failed to add ICE candidate:",H)}else console.log("[Calibrator] Remote description not set yet, queuing ICE candidate"),ve.current.push(U.payload);else console.warn("[Calibrator] Received ICE candidate but no peer connection exists")}else if(U.type==="cam-error")console.error("Camera pairing error:",U.code),alert(U.code==="EXPIRED"?"Code expired. Generate a new code.":`Camera error: ${U.code||"Unknown error"}`),he(!1);else if(U.type==="cam-calibration"){console.log("[Calibrator] Received calibration from peer:",U.payload);try{U.payload&&U.payload.H&&Array.isArray(U.payload.H)&&(_({H:U.payload.H,createdAt:U.payload.createdAt||Date.now(),errorPx:U.payload.errorPx,imageSize:U.payload.imageSize,locked:!0}),console.log("[Calibrator] Applied received calibration"))}catch($){console.error("[Calibrator] Failed to apply received calibration",$)}}}}async function zt(){Yt(!0);try{const P=await go();nt(P),P.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(P){console.error("Wifi device discovery failed:",P),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Yt(!1)}c("camera")}async function Ps(P){try{nt(U=>U.map($=>$.id===P.id?{...$,status:"connecting"}:$));const q=await vo(P);if(q&&t.current)t.current.srcObject&&t.current.srcObject.getTracks().forEach($=>$.stop()),t.current.srcObject=q,await t.current.play(),i(!0),c("capture"),nt(U=>U.map($=>$.id===P.id?{...$,status:"online"}:$));else throw new Error("Failed to get video stream")}catch(q){console.error("Failed to connect to wifi device:",q),alert(`Failed to connect to ${P.name}. Please check the device and try again.`),nt(U=>U.map($=>$.id===P.id?{...$,status:"offline"}:$))}}async function G(){if(u==="phone")return qt();if(u==="wifi")return zt();try{console.log("[Calibrator] Attempting camera access...");const P={video:ue?{deviceId:{exact:ue}}:{facingMode:"environment"},audio:!1};console.log("[Calibrator] Camera constraints:",P);let q;try{q=await navigator.mediaDevices.getUserMedia(P),console.log("[Calibrator] Camera stream obtained:",q)}catch(U){const $=U&&(U.name||U.code)||"";if(console.warn("[Calibrator] Preferred camera not available:",U),ue&&($==="OverconstrainedError"||$==="NotFoundError"||$==="NotAllowedError"))q=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),console.log("[Calibrator] Fallback camera stream obtained:",q);else throw U}if(t.current)t.current.srcObject&&t.current.srcObject.getTracks().forEach($=>$.stop()),t.current.srcObject=q,await t.current.play(),console.log("[Calibrator] Video playback started"),i(!0),c("capture");else throw console.warn("[Calibrator] videoRef.current is null - cannot display camera"),q.getTracks().forEach(U=>U.stop()),new Error("Camera element not available")}catch(P){console.error("[Calibrator] Camera access failed:",P),alert(`Camera access failed: ${P instanceof Error?P.message:"Unknown error"}. Try refreshing the page or check camera permissions.`)}}function he(P=!1){if(t.current&&t.current.srcObject&&(t.current.srcObject.getTracks().forEach(U=>U.stop()),t.current.srcObject=null,i(!1)),Pe.current){try{Pe.current.close()}catch{}Pe.current=null}if(ve.current=[],ut(null),le(null),qe(!1),Te(null),C.setStreaming(!1),C.setMediaStream(null),Xe.current){try{He(!1)}catch{}Xe.current=!1}P&&(u==="phone"||u==="wifi")&&f("local")}function yt(){ce&&ce.readyState===WebSocket.OPEN?ce.send(JSON.stringify({type:"cam-create"})):qt(),At()}function At(){try{bt?Xe.current:(He(!0),Xe.current=!0)}catch{}}function Et(){try{r.current?.click()}catch{}}function Pt(P){const q=P.target.files?.[0];if(!q)return;const U=new Image;U.onload=()=>{try{if(!a.current)return;const $=a.current;$.width=U.naturalWidth,$.height=U.naturalHeight,$.getContext("2d").drawImage(U,0,0,$.width,$.height),w(!0),A({w:$.width,h:$.height}),c("select"),p([]),Te(null),he(!1)}catch{}},U.onerror=()=>{alert("Could not load image. Please try a different photo.")},U.src=URL.createObjectURL(q);try{P.target.value=""}catch{}}function ds(){if(!t.current||!a.current)return;const P=t.current,q=a.current;q.width=P.videoWidth,q.height=P.videoHeight,q.getContext("2d").drawImage(P,0,0,q.width,q.height),w(!0),A({w:q.width,h:q.height}),c("select"),p([]),Te(null),se&&setTimeout(()=>{L()},0)}function Tt(P=x,q=null){if(!a.current||!s.current)return;const U=a.current,$=s.current;$.width=U.width,$.height=U.height;const H=$.getContext("2d");H.clearRect(0,0,$.width,$.height);const je=q||b;if(je){const ne=[ze.bullInner,ze.bullOuter,ze.trebleInner,ze.trebleOuter,ze.doubleInner,ze.doubleOuter];for(const fe of ne){const Ce=W?"#10b981":fe===ze.doubleOuter?"#22d3ee":"#a78bfa",tt=W||fe===ze.doubleOuter?3:2,vt=xo(je,fe,360);po(H,vt,Ce,tt)}}if(!je&&oe){const ne=(fe,Ce,tt=2)=>{H.save(),H.strokeStyle=Ce,H.lineWidth=tt,H.beginPath(),H.arc(oe.cx,oe.cy,fe,0,Math.PI*2),H.stroke(),H.restore()};ne(oe.doubleOuter,"#22d3ee",3),ne(oe.doubleInner,"#22d3ee",2),ne(oe.trebleOuter,"#fde047",2),ne(oe.trebleInner,"#fde047",2),ne(oe.bullOuter,"#34d399",2),ne(oe.bullInner,"#10b981",3)}if(P.length<6&&je){H.save(),H.strokeStyle="rgba(255,193,7,0.4)",H.lineWidth=2,H.setLineDash([4,4]);const ne=ua();for(let fe=P.length;fe<6&&fe<ne.length;fe++)try{const Ce=Va(je,ne[fe]);H.beginPath(),H.arc(Ce.x,Ce.y,12,0,Math.PI*2),H.stroke()}catch{}H.restore()}if(P.forEach((ne,fe)=>{Rd(H,ne,"#f472b6"),H.save(),H.fillStyle="#f472b6",H.font="14px sans-serif",H.fillText(String(fe+1),ne.x+6,ne.y-6),H.restore()}),Y&&!W){H.save(),H.fillStyle="rgba(59,130,246,0.10)";const ne=Math.round(Math.min($.width,$.height)*.08),fe=$.width-ne*2,Ce=$.height-ne*2;H.fillRect(ne,ne,fe,Ce),H.strokeStyle="rgba(34,197,94,0.9)",H.lineWidth=2,H.beginPath(),H.moveTo(ne,$.height/2),H.lineTo($.width-ne,$.height/2),H.stroke(),H.beginPath(),H.moveTo($.width/2,ne),H.lineTo($.width/2,$.height-ne),H.stroke(),H.strokeStyle="rgba(234,179,8,0.9)",H.setLineDash([6,4]);const tt=ne+30,vt=ne+30;H.beginPath(),H.moveTo(tt,vt+30),H.lineTo(tt+60,vt),H.stroke(),H.beginPath(),H.moveTo($.width-tt,vt+30),H.lineTo($.width-tt-60,vt),H.stroke(),H.restore(),H.save(),H.scale(1/S,1/S),H.fillStyle="rgba(255,255,255,0.85)",H.font="12px sans-serif",H.fillText("Tip: Frame board centered, edges parallel; slight top-down is okay. Keep bull near center.",ne*S,(ne+18)*S),H.restore()}}function ys(P){if(m!=="select")return;const q=P.target,U=q.getBoundingClientRect(),$=P.clientX-U.left,H=P.clientY-U.top,je=q.width>0?q.width/U.width:1,ne=q.height>0?q.height/U.height:1,fe=$*je,Ce=H*ne,tt=[...x,{x:fe,y:Ce}];tt.length<=6&&(p(tt),Tt(tt))}function vs(){const P=x.slice(0,-1);p(P),Tt(P)}function rs(){if(!a.current||x.length===0)return;const P=Bd(a.current,x,8);p(P),Tt(P)}function ms(){if(!a.current)return;if(x.length<4)return alert("Please click at least 4 points on the board.");if(x.length<6)return alert("For best accuracy, click all 6 calibration points: TOP, RIGHT, BOTTOM, LEFT of double rim, plus BULLSEYE center and OUTER BULL top.");const P=ua(),q=Zr(P,x);Tt(x,q);const U=ei(q,P,x);_({H:q,createdAt:Date.now(),errorPx:U,imageSize:{w:a.current.width,h:a.current.height},anchors:{src:P,dst:x}}),c("computed")}function us(){p([]),w(!1),c("camera"),Tt([]),Te(null),J()}async function L(){if(!a.current)return alert("Load a photo or capture a frame first.");Te(null);const P=a.current,U=Math.min(1,800/P.width),$=Math.max(1,Math.round(P.width*U)),H=Math.max(1,Math.round(P.height*U)),je=document.createElement("canvas");je.width=$,je.height=H;const ne=je.getContext("2d");ne.drawImage(P,0,0,$,H);const fe=ne.getImageData(0,0,$,H),Ce=new Float32Array($*H);for(let Oe=0,Je=0;Oe<fe.data.length;Oe+=4,Je++){const $e=fe.data[Oe],$t=fe.data[Oe+1],Ke=fe.data[Oe+2];Ce[Je]=.299*$e+.587*$t+.114*Ke}const tt=new Float32Array($*H),vt=new Float32Array($*H);for(let Oe=1;Oe<H-1;Oe++)for(let Je=1;Je<$-1;Je++){const $e=Oe*$+Je,$t=Ce[$e-$-1],Ke=Ce[$e-$],pt=Ce[$e-$+1],Nt=Ce[$e-1],St=Ce[$e+1],lt=Ce[$e+$-1],Ns=Ce[$e+$],Ee=Ce[$e+$+1];tt[$e]=-$t-2*Nt-lt+(pt+2*St+Ee),vt[$e]=-$t-2*Ke-pt+(lt+2*Ns+Ee)}const ht=new Float32Array($*H);let wt=1;for(let Oe=0;Oe<ht.length;Oe++){const Je=Math.hypot(tt[Oe],vt[Oe]);ht[Oe]=Je,Je>wt&&(wt=Je)}const Bt=Math.floor($/2),Gt=Math.floor(H/2),hs=Math.floor(Math.min($,H)*.35),Zt=Math.floor(Math.min($,H)*.52);let Mt={score:-1,cx:Bt,cy:Gt,r:Math.floor((hs+Zt)/2)};const Rs=Math.max(2,Math.floor(Math.min($,H)*.01)),ft=Math.max(2,Math.floor(Math.min($,H)*.01));for(let Oe=Gt-Math.floor(H*.08);Oe<=Gt+Math.floor(H*.08);Oe+=Rs)for(let Je=Bt-Math.floor($*.08);Je<=Bt+Math.floor($*.08);Je+=Rs)for(let $e=hs;$e<=Zt;$e+=ft){let $t=0;const Ke=360;for(let pt=0;pt<Ke;pt++){const Nt=pt*Math.PI/180,St=Math.round(Je+$e*Math.cos(Nt)),lt=Math.round(Oe+$e*Math.sin(Nt));St<=0||St>=$-1||lt<=0||lt>=H-1||($t+=ht[lt*$+St])}$t>Mt.score&&(Mt={score:$t,cx:Je,cy:Oe,r:$e})}const is=1/U,Rt=Mt.cx*is,xs=Mt.cy*is,ln=Mt.r*is;function Fs(Oe){let Je=0;const $e=Oe*U,$t=360;for(let Ke=0;Ke<$t;Ke++){const pt=Ke*Math.PI/180,Nt=Math.round(Mt.cx+$e*Math.cos(pt)),St=Math.round(Mt.cy+$e*Math.sin(pt));Nt<=0||Nt>=$-1||St<=0||St>=H-1||(Je+=ht[St*$+Nt])}return Je}const ls={bullInner:ze.bullInner/ze.doubleOuter,bullOuter:ze.bullOuter/ze.doubleOuter,trebleInner:ze.trebleInner/ze.doubleOuter,trebleOuter:ze.trebleOuter/ze.doubleOuter,doubleInner:ze.doubleInner/ze.doubleOuter};function os(Oe,Je=.08){const $e=Math.max(1,Math.floor(Oe*(1-Je))),$t=Math.max($e+1,Math.floor(Oe*(1+Je)));let Ke=$e,pt=-1;for(let Nt=$e;Nt<=$t;Nt++){const St=Fs(Nt);St>pt&&(pt=St,Ke=Nt)}return Ke}const es=ln,Jt=os(es*ls.doubleInner),xt=os(es*ls.trebleOuter),Qt=os(es*ls.trebleInner),Ls=os(es*ls.bullOuter),js=os(es*ls.bullInner);O({cx:Rt,cy:xs,bullInner:js,bullOuter:Ls,trebleInner:Qt,trebleOuter:xt,doubleInner:Jt,doubleOuter:es});const Ut=Oe=>{let $e=0;for(let $t=0;$t<180;$t++){const Ke=$t*Math.PI/90,pt=Math.round(Mt.cx+Oe*U*Math.cos(Ke)),Nt=Math.round(Mt.cy+Oe*U*Math.sin(Ke));pt<=0||pt>=$-1||Nt<=0||Nt>=H-1||($e+=ht[Nt*$+pt])}return $e/180},Os=(Ut(Mt.r)+Ut(xt)+Ut(Qt)+Ut(Jt)+Ut(Ls)+Ut(js))/(wt*6),_s=Math.max(0,Math.min(1,Os)),ts=Math.min(_s,Math.min(Ut(Mt.r)/wt,Ut(xt)/wt,Ut(Qt)/wt,Ut(Jt)/wt,Ut(Ls)/wt,Ut(js)/wt));De(Math.round(ts*100));const ss=[{x:Rt,y:xs-es},{x:Rt+es,y:xs},{x:Rt,y:xs+es},{x:Rt-es,y:xs},{x:Rt,y:xs},{x:Rt,y:xs-Ls}];p(ss),Tt(ss);try{const Oe=ua(),Je=Zr(Oe,ss);Tt(ss,Je);const $e=ei(Je,Oe,ss);_({H:Je,createdAt:Date.now(),errorPx:$e,imageSize:{w:a.current.width,h:a.current.height},anchors:{src:Oe,dst:ss}}),c("computed")}catch(Oe){console.error("[Calibrator] Auto-detect compute failed:",Oe)}const jt=ts>=.95;_({locked:jt})}function z(){if(!a.current)return alert("Capture a frame or upload a photo first.");const P=Vd(a.current);if(Te(P),!P.success||!P.homography){const H=P.missing.length?` Missing markers: ${P.missing.map(je=>`${je.toUpperCase()} (ID ${bs[je]})`).join(", ")}`:"";alert(P.message?`${P.message}${H}`:`Marker detection failed.${H}`);return}O(null),p(P.points),Tt(P.points,P.homography);const q=ua(),U={w:a.current.width,h:a.current.height},$=(P.errorPx??Number.POSITIVE_INFINITY)<=1.2;_({H:P.homography,createdAt:Date.now(),errorPx:P.errorPx??null,imageSize:U,anchors:{src:q,dst:P.points},locked:$?!0:W}),c("computed")}d.useEffect(()=>{Tt()},[g,b]),d.useEffect(()=>{if(!se||!n)return;let P=0;const q=()=>{try{ds()}catch{}P=requestAnimationFrame(q)};return P=requestAnimationFrame(q),()=>cancelAnimationFrame(P)},[se,n]),d.useEffect(()=>{(async()=>{try{if(!W||!ot)return;const P=a.current?{w:a.current.width,h:a.current.height}:null,q=JSON.stringify({H:b,anchors:null,imageSize:P,errorPx:T??null});try{await kt(`/cam/calibration/${ot}`,{method:"POST",headers:{"Content-Type":"application/json"},body:q}),console.log("[Calibrator] Posted calibration for code",ot)}catch(U){console.warn("[Calibrator] Upload calibration failed",U)}try{const U=localStorage.getItem("authToken");U&&(await kt("/api/user/calibration",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${U}`},body:q}),console.log("[Calibrator] Synced calibration to user account"))}catch(U){console.warn("[Calibrator] User calibration sync failed",U)}}catch{}})()},[W,ot]);function re(){const{preferredCameraId:P,preferredCameraLabel:q,setPreferredCamera:U,cameraEnabled:$,setCameraEnabled:H,preferredCameraLocked:je,setPreferredCameraLocked:ne}=Ot(),[fe,Ce]=d.useState([]),[tt,vt]=d.useState(""),[ht,wt]=d.useState(!1),Bt=d.useRef(null),Gt=document.getElementById("dropdown-portal-root")||(()=>{const ft=document.createElement("div");return ft.id="dropdown-portal-root",document.body.appendChild(ft),ft})();async function hs(){vt("");try{try{await navigator.mediaDevices.getUserMedia({video:!0})}catch{}const is=(await navigator.mediaDevices.enumerateDevices()).filter(Rt=>Rt.kind==="videoinput");Ce(is)}catch{vt("Unable to list cameras. Grant camera permission in your browser.")}}d.useEffect(()=>{hs()},[]),d.useEffect(()=>{function ft(is){Bt.current&&!Bt.current.contains(is.target)&&wt(!1)}return document.addEventListener("mousedown",ft),()=>document.removeEventListener("mousedown",ft)},[]);const Zt=fe.find(ft=>ft.deviceId===P),Mt=Zt?`${Zt.label||"Camera"}`:P?"Camera (unavailable)":"Auto (browser default)",Rs=P&&!Zt;return e.jsxs("div",{className:"mt-3 p-3 rounded-lg border border-indigo-500/30 bg-indigo-500/5",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Select camera device"}),tt&&e.jsx("div",{className:"text-rose-400 text-sm mb-2",children:tt}),Rs&&e.jsxs("div",{className:"text-amber-400 text-sm mb-2",children:["Selected camera is no longer available.",e.jsx("button",{className:"underline ml-1",onClick:()=>U(void 0,"",!0),disabled:n,children:"Use auto-selection"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[je?e.jsx("div",{className:"text-xs text-emerald-400",children:"ðŸ”’ Camera selection locked"}):e.jsx("div",{className:"text-xs text-slate-400",children:"Camera selection unlocked"}),e.jsx("button",{className:"btn btn--ghost px-2 py-0.5 text-xs ml-2",onClick:()=>{Xe.current=!1,ne(!je)},children:je?"Unlock":"Lock"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled-calibrator",checked:$,onChange:ft=>H(ft.target.checked),className:"w-4 h-4",disabled:n}),e.jsx("label",{htmlFor:"cameraEnabled-calibrator",className:"text-sm",children:"Enable camera for scoring"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center text-sm",children:[e.jsxs("div",{className:"col-span-2 relative",ref:Bt,children:[e.jsxs("div",{className:"input w-full flex items-center justify-between cursor-pointer",onClick:()=>wt(!ht),children:[e.jsx("span",{className:"truncate",children:Mt}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${ht?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),ht&&vc.createPortal(e.jsx("div",{className:"fixed left-0 top-0 w-full h-full z-[9999]",style:{pointerEvents:"none"},children:e.jsx("div",{className:"absolute",style:{left:Bt.current?.getBoundingClientRect().left||0,top:Bt.current?.getBoundingClientRect().bottom||0,width:Bt.current?.offsetWidth||240,pointerEvents:"auto"},children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:[e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm",onClick:()=>{U(void 0,"",!0)},children:"Auto (browser default)"}),fe.map(ft=>{const is=`${ft.label||"Camera"}`;return e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm",onClick:()=>{U(ft.deviceId,ft.label||"",!0)},children:is},ft.deviceId)}),e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm text-indigo-400",onClick:()=>{f("phone"),c("camera"),i(!1),w(!1)},children:"ðŸ“± Phone Camera"},"phone-camera"),e.jsx("div",{className:"px-3 py-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>wt(!1),children:"Close"})})]})})}),Gt)]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn px-2 py-1",onClick:hs,disabled:n,children:"Refresh"})})]}),q&&e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["Selected: ",q]}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Tip: All camera technology is supported for autoscoring needsâ€”select your camera here and then open Calibrator to align."})]})}if(D&&!M){const P=gs??(typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html");return e.jsxs("div",{className:"mx-auto flex min-h-[calc(100vh-140px)] w-full max-w-xl flex-col justify-center gap-6 p-6",children:[e.jsxs("div",{className:"space-y-5 rounded-3xl border border-indigo-400/30 bg-slate-900/70 p-6 text-slate-100 shadow-xl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-indigo-300",children:"Mobile camera"}),e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-white",children:"This device is ready to stream as your dartboard camera"}),e.jsx("p",{className:"text-sm text-slate-200/80",children:"Open the lightweight mobile camera page to stream video to your desktop calibrator. You can still come back here if you need the full desktop tools."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:P,className:"btn w-full justify-center px-4 py-2 text-base",children:"Open mobile camera"}),e.jsx("button",{type:"button",className:"btn btn--ghost w-full justify-center px-4 py-2 text-sm",onClick:()=>As(P,"link"),children:as==="link"?"Link copied!":"Copy link"})]}),e.jsxs("p",{className:"text-xs text-slate-300/70",children:["On a desktop, open Calibrator and generate a pairing code. Then tap ",e.jsx("span",{className:"font-semibold",children:"Pair with Desktop"})," from the mobile camera page to connect this device."]})]}),e.jsx("button",{type:"button",className:"self-center text-xs font-medium text-indigo-200 underline decoration-dotted decoration-indigo-300/70 transition hover:text-indigo-100",onClick:()=>F(!0),children:"Continue to desktop calibrator"})]})}return e.jsxs("div",{className:"space-y-6",children:[D&&M&&e.jsx("div",{className:"rounded-2xl border border-indigo-400/30 bg-indigo-500/10 p-4 text-sm text-indigo-100",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"leading-relaxed",children:"Using a phone? Switch back to the streamlined mobile camera interface for an easier pairing flow."}),e.jsx("button",{type:"button",className:"btn btn--ghost px-3 py-1 text-xs",onClick:()=>F(!1),children:"Open mobile camera mode"})]})}),e.jsxs("div",{className:"card space-y-6 p-6",children:[e.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-indigo-300",children:"Marker calibration"}),e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-white",children:"Align your board with the autoscoring overlay"}),e.jsx("p",{className:"max-w-2xl text-sm opacity-80",children:"Place the printable fiducial markers around the double ring, capture a clear frame, and let the calibrator compute a precise homography."})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 text-xs font-medium",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-indigo-400/50 bg-indigo-500/10 px-3 py-1",children:[e.jsx("span",{className:"opacity-60",children:"Mode"}),e.jsx("span",{children:u==="local"?"Desktop camera":u==="phone"?"Phone camera":"Wifi device"})]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 ${n?"border-emerald-400/60 bg-emerald-500/10 text-emerald-100":"border-white/20 bg-white/5 text-slate-200"}`,children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${n?"bg-emerald-400":"bg-slate-400"}`}),n?"Live stream active":"Stream idle"]}),W?e.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-emerald-400/60 bg-emerald-500/10 px-3 py-1 text-emerald-100",children:e.jsxs("span",{children:["Locked â€¢ ",T!=null?`${T.toFixed(2)}px error`:"ready"]})}):e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-amber-400/40 bg-amber-500/10 px-3 py-1 text-amber-100",children:[e.jsx("span",{children:"Not locked"}),T!=null&&e.jsxs("span",{children:["â€¢ ",T.toFixed(2),"px"]})]})]})]}),W&&b&&e.jsxs("section",{className:"space-y-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 p-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-emerald-500/20",children:e.jsx("span",{className:"text-lg",children:"âœ“"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-emerald-100",children:"Calibration active"}),e.jsx("p",{className:"text-xs opacity-80",children:"Your calibration is saved and active across all game modes. It will be used in Online, Offline, and Tournaments."})]})]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs whitespace-nowrap",onClick:()=>_({locked:!1}),title:"Unlock to recalibrate",children:"Unlock"})]}),T!=null&&e.jsxs("div",{className:"text-xs opacity-75",children:["Precision: ",T.toFixed(2)," px RMS error"]})]}),e.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(320px,1fr)]",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4 rounded-2xl border border-white/10 bg-black/40 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"uppercase tracking-wide opacity-60",children:"Video source"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:`btn px-3 py-1 ${u==="local"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{f("local"),he(!1)},title:"Use local camera",children:"Local"}),e.jsx("button",{className:`btn px-3 py-1 ${u==="phone"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{f("phone"),he(!1)},title:"Pair phone camera",children:"Phone"}),e.jsx("button",{className:`btn px-3 py-1 ${u==="wifi"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{f("wifi"),he(!1),zt()},title:"Discover wifi/USB autoscoring devices",children:"Wifi"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-70",children:"Zoom"}),e.jsx("input",{type:"range",min:50,max:200,step:5,value:Math.round((S||1)*100),onChange:P=>E(Math.max(.5,Math.min(2,Number(P.target.value)/100)))}),e.jsxs("span",{className:"w-12 text-right",children:[Math.round((S||1)*100),"%"]})]}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>E(1),children:"Actual"})]})]}),e.jsxs("div",{className:"relative w-full overflow-hidden rounded-2xl border border-indigo-400/30 bg-black",style:{aspectRatio:I?`${I.w} / ${I.h}`:"16 / 9"},children:[(!n||!X)&&e.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-gradient-to-br from-black/40 to-black/10",children:e.jsx(ed,{calibrationComplete:m==="computed"})}),e.jsxs("div",{className:"absolute inset-0",style:{transform:`scale(${S||1})`,transformOrigin:"center center"},children:[e.jsx("video",{ref:t,onLoadedMetadata:P=>{try{const q=P.currentTarget;q.videoWidth&&q.videoHeight&&A({w:q.videoWidth,h:q.videoHeight})}catch{}},className:`absolute inset-0 h-full w-full object-cover transition-opacity duration-300 ${g?"opacity-0 -z-10":"opacity-100 z-10"}`,autoPlay:!0,playsInline:!0,muted:!0,controls:!1}),o&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur",children:e.jsx("button",{className:"rounded-lg bg-white px-4 py-2 font-semibold text-slate-900 shadow-lg",onClick:async()=>{try{await t.current?.play(),l(!1),i(!0),c("capture")}catch(P){console.warn("Tap-to-play retry failed",P),alert("Tap to enable video failed. Please check browser settings or reload the page.")}},children:"Tap to allow video"})}),e.jsx("canvas",{ref:a,className:`absolute inset-0 h-full w-full transition-opacity duration-300 ${g?"opacity-100 z-10":"opacity-0 -z-10"}`}),e.jsx("canvas",{ref:s,onClick:ys,className:"absolute inset-0 z-30 h-full w-full cursor-crosshair"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",className:"accent-indigo-600",checked:Y,onChange:P=>pe(P.target.checked)}),"Show preferred-view guide overlay"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Phase"}),e.jsx("div",{className:"text-sm font-semibold capitalize",children:m})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Points selected"}),e.jsxs("div",{className:"text-sm font-semibold",children:[x.length," / 6"]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Fit error"}),e.jsx("div",{className:"text-sm font-semibold",children:T!=null?`${T.toFixed(2)} px`:"â€”"})]})]})]}),e.jsxs("aside",{className:"space-y-4",children:[e.jsx(re,{}),u==="phone"&&e.jsxs("section",{className:"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white",children:[e.jsx("div",{className:"font-semibold",children:"Phone pairing"}),e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>As(at,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all text-[11px]",children:at}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:as==="link"?"Copied!":"Copy link"})]}),e.jsx("div",{className:"flex items-center gap-2 text-[11px]",children:e.jsx("a",{href:at,target:"_blank",rel:"noreferrer",className:"underline decoration-dotted text-indigo-200 hover:text-indigo-100 transition",children:"Open link in new tab"})}),e.jsxs("div",{className:"opacity-80",children:["WS: ",ce?ce.readyState===1?"open":ce.readyState===0?"connecting":ce.readyState===2?"closing":"closed":"not started"," Â· ",gt?.https?"HTTPS on":"HTTP only"]}),ot&&e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>As(ot,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:ot}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:as==="code"?"Copied!":"Copy code"})]}),k&&e.jsx("img",{className:"mt-1 h-40 w-40 bg-white",alt:"Scan to open",src:k}),e.jsxs("div",{className:"flex items-center gap-2",children:[it!==null&&e.jsxs("span",{children:["Expires in ",it,"s"]}),e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:yt,children:"Regenerate"})]}),Dt&&e.jsxs("div",{className:"space-y-2 rounded-lg border border-slate-700/50 bg-slate-900/60 p-3 text-slate-200",children:[e.jsx("div",{className:"font-semibold",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc space-y-1 pl-4",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",gt?.https?gt.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer HTTPS when enabled)."})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>st(!1),children:"Hide tips"})})]})]}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 1 Â· Capture image"}),e.jsx("p",{className:"text-xs opacity-70",children:"Start your preferred camera or upload a static photo of the board."})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>he(!0),children:"Stop camera"}),e.jsx("button",{className:"btn",onClick:ds,disabled:!n,children:"Capture frame"})]}):e.jsxs(e.Fragment,{children:[u==="local"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",onClick:G,title:"Click to enable camera (will request permission if needed)",children:"Enable camera"}),e.jsx("button",{className:"btn btn--ghost text-xs",onClick:async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),console.log("[Calibrator] Camera permission granted via button")}catch{alert("Camera permission denied. Please enable camera access in your browser settings.")}},children:"Request permission"})]}),u==="phone"&&e.jsx("button",{className:"btn",onClick:qt,children:"Pair phone camera"}),u==="wifi"&&e.jsx("button",{className:"btn",onClick:zt,children:"Connect wifi camera"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("input",{ref:r,type:"file",accept:"image/*",className:"hidden",onChange:Pt}),e.jsx("button",{className:"btn",onClick:Et,children:"Upload photo"})]})]}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 2 Â· Detect markers"}),e.jsx("p",{className:"text-xs opacity-70",children:"Use fiducials or auto-detect to seed the rim points."})]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] ${be>=85?"border-emerald-400/60 bg-emerald-500/10 text-emerald-100":"border-white/20 bg-white/5 text-slate-200"}`,children:[e.jsx("span",{className:"opacity-70",children:"Confidence"}),e.jsxs("span",{children:[be,"%"]})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",className:"accent-indigo-600",checked:se,onChange:P=>ye(P.target.checked)}),"Live auto-detect while streaming"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:!g,onClick:L,children:"Auto detect"}),e.jsx("button",{className:"btn",disabled:!g,onClick:z,children:"Detect markers"}),e.jsx("button",{className:"btn btn--ghost",onClick:Me,title:"Print 4 markers (TOP/RIGHT/BOTTOM/LEFT)",children:"Open marker sheet"})]}),e.jsx("p",{className:"text-[11px] opacity-70",children:"Tip: Use the 4 printed ArUco markers (IDs 0â€“3) at the double rimâ€™s TOP, RIGHT, BOTTOM, and LEFT. Print at 100% on white paper, avoid glare, and fill the frame when capturing."}),Ge&&e.jsx("div",{className:`rounded-lg border px-3 py-2 text-xs ${Ge.success?"bg-emerald-500/10 border-emerald-500/30 text-emerald-100":"bg-rose-500/10 border-rose-500/30 text-rose-100"}`,children:Ge.success?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Detected markers â†’ board anchors:"," ",Al.map(P=>{const q=Ge.assignments?.[P];return`${P.toUpperCase()}â†’${q?`ID ${q.id}`:"â€”"}`}).join(", ")]}),Ge.errorPx!=null&&e.jsxs("div",{children:["RMS error: ",Ge.errorPx.toFixed(2)," px"]}),e.jsxs("div",{className:"opacity-80",children:["Markers correspond to IDs TOP ",bs.top,", RIGHT ",bs.right,", BOTTOM ",bs.bottom,", LEFT ",bs.left,"."]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:Ge.message||"Unable to detect all markers."}),Ge.missing.length>0&&e.jsxs("div",{children:["Missing: ",Ge.missing.map(P=>`${P.toUpperCase()} (ID ${bs[P]})`).join(", ")]})]})})]}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 3 Â· Align & lock"}),e.jsx("p",{className:"text-xs opacity-70",children:"Click 6 points in order: â‘  TOP â‘¡ RIGHT â‘¢ BOTTOM â‘£ LEFT of double rim, then â‘¤ BULLSEYE center â‘¥ outer bull top. Refine edges, then lock."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:x.length<4,onClick:ms,children:"Compute"}),e.jsx("button",{className:`btn ${W?"bg-emerald-600 hover:bg-emerald-700":""}`,onClick:()=>_({locked:!W}),children:W?"Unlock":"Lock in"})]}),W&&e.jsxs("div",{className:"text-xs opacity-75",children:["Calibration saved ",T!=null?`Â· error ${T.toFixed(2)} px`:""]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:x.length===0,onClick:vs,children:"Undo"}),e.jsx("button",{className:"btn",disabled:x.length===0,onClick:rs,children:"Refine points"}),e.jsx("button",{className:"btn",onClick:us,children:"Reset"})]})]})]})]}),u==="wifi"&&!n&&e.jsxs("div",{className:"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white",children:[e.jsx("div",{className:"font-semibold",children:"Wifi scoring devices"}),Ht?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-white"}),e.jsx("span",{children:"Scanning network for devicesâ€¦"})]}):cs.length>0?e.jsxs("div",{className:"space-y-2",children:[cs.map(P=>e.jsxs("div",{className:"flex items-center justify-between rounded border border-slate-700/50 bg-slate-900/60 p-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:P.name}),e.jsxs("div",{className:"opacity-70",children:[P.ip,":",P.port," Â· ",P.type.toUpperCase()]}),e.jsxs("div",{className:"opacity-70 text-xs",children:["Capabilities: ",P.capabilities.join(", ")]})]}),e.jsx("button",{className:`btn px-2 py-1 text-xs ${P.status==="connecting"?"bg-yellow-600":P.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>Ps(P),disabled:P.status==="connecting",children:P.status==="connecting"?"Connectingâ€¦":"Connect"})]},P.id)),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:zt,children:"Rescan network"})})]}):e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("div",{children:"No wifi scoring devices found."}),e.jsx("div",{className:"opacity-70",children:"Ensure your wifi cameras are powered on and on the same network."}),e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:zt,children:"Scan again"})]})]})]})]})}const im=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function lm(t){return t==="DB"?50:Number(t.slice(1))*2}function om(t){return im.includes(t)?lm(t):32}function Fa(t,a="D16"){if(t>170||t<=1)return[];const s={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(s[t])return s[t];const r=om(a),n=[];for(const i of[60,57,54,51,48])if(t-i===r){n.push(`T${i/3} ${a}`);break}if(!n.length){for(const i of[20,19,18,17,16,15])if(t-i===r){n.push(`${i} ${a}`);break}}return n}function Zn(t,a,s,r,n){try{const i=window.speechSynthesis;if(!i)return;const o=new SpeechSynthesisUtterance,l=s<=170&&s>0;if(n?.checkoutOnly&&!l)return;if(o.text=l?`${t}, you have ${s} remaining.`:`${a}`,r){const m=i.getVoices().find(c=>c.name===r);m&&(o.voice=m)}typeof n?.volume=="number"&&(o.volume=Math.max(0,Math.min(1,n.volume))),o.rate=1,o.pitch=1,i.speak(o)}catch{}}function _a({label:t,autoStart:a=!1,scale:s,className:r,aspect:n="inherit",style:i,fill:o=!1}){const l=d.useRef(null),m=na(),[c,u]=d.useState(!1),[f,x]=d.useState(null),[p,g]=d.useState(null),[w,I]=d.useState(null),A=Ot(le=>le.preferredCameraLabel),[S,E]=d.useState(()=>{if(A==="Phone Camera")return console.log("[CAMERATILE] Initializing mode to phone (from preferred camera selection)"),"phone";const le=localStorage.getItem("ndn:camera:mode");return console.log("[CAMERATILE] Initializing mode to",le||"local","(from localStorage)"),le||"local"}),[M,F]=d.useState(null),[D,v]=d.useState(Date.now()),[b,_]=d.useState(!1),[J,T]=d.useState(null),[W,C]=d.useState(null),[Y,pe]=d.useState(!0),[ue,Ie]=d.useState([]),[xe,bt]=d.useState(!1),[He,ge]=d.useState([]),[oe,O]=d.useState(!1),se=Ot(le=>le.autoscoreProvider),ye=Ot(le=>le.setPreferredCameraLocked);if(se==="manual"){const we=[o?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",r].filter(Boolean).join(" ").trim(),te={...i||{}};return!o&&te.aspectRatio===void 0&&te.height===void 0&&te.minHeight===void 0&&(te.aspectRatio="4 / 3"),e.jsx("div",{className:we,style:te,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}d.useEffect(()=>{const le=window.location.hostname;(le==="localhost"||le==="127.0.0.1")&&kt("/api/hosts").then(we=>we.json()).then(we=>{const te=Array.isArray(we?.hosts)&&we.hosts.find(X=>X);te&&T(te)}).catch(()=>{}),kt("/api/https-info").then(we=>we.json()).then(we=>{we&&typeof we.https=="boolean"&&C({https:!!we.https,port:Number(we.port)||8788})}).catch(()=>{})},[]);const be=d.useMemo(()=>{const le=p||"____",we="ws://localhost:8787";if(we.length>0)try{const ve=new URL(we);return`${`${ve.protocol==="wss:"?"https":"http"}://${ve.host}${ve.pathname.endsWith("/ws")?"":ve.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${le}`}catch{}const te=J||window.location.hostname,X=!!W?.https,qe=X?W?.port||8788:8787;return`${X?"https":"http"}://${te}:${qe}/mobile-cam.html?code=${le}`},[p,J,W]);d.useEffect(()=>{console.log("[CAMERATILE] Mode changed to:",S,"- persisting to localStorage"),localStorage.setItem("ndn:camera:mode",S)},[S]),d.useEffect(()=>{console.log("[CAMERATILE] Checking camera selection sync: preferredCameraLabel=",A,"mode=",S),A==="Phone Camera"&&S!=="phone"&&(console.log("[CAMERATILE] Syncing mode to phone from Calibrator selection"),E("phone"))},[A,S]);const[De,Ge]=d.useState("");d.useEffect(()=>{if(!p){Ge("");return}ho.toDataURL(be,{width:160,margin:1,color:{dark:"#000000",light:"#ffffff"}}).then(Ge).catch(()=>Ge(""))},[be,p]),d.useEffect(()=>{if(!M)return;const le=setInterval(()=>v(Date.now()),1e3);return()=>clearInterval(le)},[M]);const Te=d.useMemo(()=>M?Math.max(0,Math.ceil((M-D)/1e3)):null,[M,D]);d.useEffect(()=>{a?mt().catch(()=>{}):Me()},[a,A]),d.useEffect(()=>{const le=async()=>{try{if(A!=="Phone Camera"&&S!=="phone")return;const te=m.getMediaStream(),X=l.current;if(!X||!te)return;X.srcObject!==te&&(X.srcObject=te),X.muted=!0,X.playsInline=!0;try{await X.play()}catch{}u(!0)}catch{}};le();const we=setInterval(le,800);return()=>clearInterval(we)},[A,S,m,m.isStreaming]);async function mt(){if(S==="wifi")return ce();if(A==="Phone Camera"||S==="phone"){const le=m.getMediaStream();if(le&&l.current)try{l.current.srcObject=le,await l.current.play(),u(!0);return}catch{}}try{const{preferredCameraId:le,setPreferredCamera:we}=Ot.getState(),te=le?{video:{deviceId:{exact:le}},audio:!1}:{video:!0,audio:!1};let X;try{X=await navigator.mediaDevices.getUserMedia(te)}catch(qe){const Pe=qe&&(qe.name||qe.code)||"";if(le&&(Pe==="OverconstrainedError"||Pe==="NotFoundError"))X=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw qe}l.current&&(l.current.srcObject=X,await l.current.play(),u(!0))}catch{}}function Me(){l.current&&l.current.srcObject&&(l.current.srcObject.getTracks().forEach(we=>we.stop()),l.current.srcObject=null,u(!1))}async function ce(){bt(!0);try{const le=await go();Ie(le),le.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(le){console.error("Wifi device discovery failed:",le),alert("Failed to discover wifi devices. Please check your network connection.")}finally{bt(!1)}}async function Le(le){try{Ie(te=>te.map(X=>X.id===le.id?{...X,status:"connecting"}:X));const we=await vo(le);if(we&&l.current)l.current.srcObject=we,await l.current.play(),u(!0),Ie(te=>te.map(X=>X.id===le.id?{...X,status:"online"}:X));else throw new Error("Failed to get video stream")}catch(we){console.error("Failed to connect to wifi device:",we),alert(`Failed to connect to ${le.name}. Please check the device and try again.`),Ie(te=>te.map(X=>X.id===le.id?{...X,status:"offline"}:X))}}async function Xe(){O(!0);try{const le=await em();ge(le);const we=await tm();we&&ge(te=>[...te,we]),le.length===0&&!we&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(le){console.error("USB device discovery failed:",le),alert("Failed to discover USB devices. Please check device connections.")}finally{O(!1)}}async function ot(le){try{ge(te=>te.map(X=>X.id===le.id?{...X,status:"connecting"}:X));const we=await sm(le);if(we&&l.current)l.current.srcObject=we,await l.current.play(),u(!0),E("wifi"),ge(te=>te.map(X=>X.id===le.id?{...X,status:"online"}:X));else throw new Error("Failed to get video stream")}catch(we){console.error("Failed to connect to USB device:",we),alert(`Failed to connect to ${le.name}. Please check the device and try again.`),ge(te=>te.map(X=>X.id===le.id?{...X,status:"offline"}:X))}}function Kt(){if(f&&f.readyState===WebSocket.OPEN)return f;const le="ws://localhost:8787",we=le.length>0?le.endsWith("/ws")?le:le.replace(/\/$/,"")+"/ws":void 0,te=window.location.protocol==="https:"?"wss":"ws",X=`${te}://${window.location.host}/ws`,qe=window.location.hostname,Pe=qe==="localhost"||qe==="127.0.0.1",ve=qe.endsWith("onrender.com"),k="wss://ninedartnation.onrender.com/ws";let ee=we;ee||(Pe?ee=`${te}://${qe}:8787/ws`:ve?ee=X:ee=k),ee||(ee=X);const et=new WebSocket(ee);return x(et),et}async function Qe(){E("phone"),_(!1);const le=Kt();le.readyState===WebSocket.OPEN?le.send(JSON.stringify({type:"cam-create"})):le.onopen=()=>le.send(JSON.stringify({type:"cam-create"})),le.onmessage=async we=>{const te=JSON.parse(we.data);if(te.type==="cam-code")g(te.code),te.expiresAt&&F(te.expiresAt);else if(te.type==="cam-peer-joined"){_(!0);const X=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});I(X),X.onicecandidate=Pe=>{Pe.candidate&&p&&le.send(JSON.stringify({type:"cam-ice",code:p,payload:Pe.candidate}))},X.ontrack=Pe=>{if(l.current){const ve=Pe.streams?.[0];ve&&(l.current.srcObject=ve,l.current.play().catch(()=>{}),u(!0))}};const qe=await X.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await X.setLocalDescription(qe),p&&le.send(JSON.stringify({type:"cam-offer",code:p,payload:qe}))}else if(te.type==="cam-answer")w&&await w.setRemoteDescription(new RTCSessionDescription(te.payload));else if(te.type==="cam-ice"&&w)try{await w.addIceCandidate(te.payload)}catch{}}}function ut(){g(null),F(null),_(!1),f&&f.readyState===WebSocket.OPEN?f.send(JSON.stringify({type:"cam-create"})):Qe();try{ye(!0)}catch{}}function Ae(){if(Me(),g(null),_(!1),F(null),w){try{w.close()}catch{}I(null)}}return e.jsx(cm,{label:t,autoStart:a,start:mt,stopAll:Ae,startPhonePairing:Qe,startWifiConnection:ce,startUsbConnection:Xe,connectToWifiDevice:Le,connectToUsbDevice:ot,videoRef:l,streaming:c,mode:S,setMode:E,pairCode:p,mobileUrl:be,ttl:Te,qrDataUrl:De,regenerateCode:ut,httpsInfo:W,showTips:Y,setShowTips:pe,wifiDevices:ue,usbDevices:He,discoveringWifi:xe,discoveringUsb:oe,scaleOverride:s,className:r,aspect:n,style:i,fill:o})}function cm(t){const a=na(),{cameraScale:s,cameraAspect:r}=Ot(),{label:n,start:i,stopAll:o,startPhonePairing:l,startWifiConnection:m,startUsbConnection:c,connectToWifiDevice:u,connectToUsbDevice:f,videoRef:x,streaming:p,mode:g,setMode:w,pairCode:I,mobileUrl:A,ttl:S,qrDataUrl:E,regenerateCode:M,httpsInfo:F,showTips:D,setShowTips:v,wifiDevices:b,usbDevices:_,discoveringWifi:J,discoveringUsb:T,className:W,aspect:C,style:Y,fill:pe}=t,[ue,Ie]=d.useState(null),xe=d.useRef(null);d.useEffect(()=>()=>{xe.current&&window.clearTimeout(xe.current)},[]);const{cameraFitMode:bt}=Ot(),He=pe?"fill":bt||"fill",ge=(()=>{const ce=Number(t.scaleOverride??s??1),Le=Math.max(.5,Math.min(1.25,ce));return He==="fill"?Math.max(1,Le):Le})(),oe=pe&&He==="fill"?"free":C&&C!=="inherit"?C:r||"wide",O=oe!=="free",se=O?oe==="square"?"aspect-square":oe==="portrait"?"aspect-[3/4]":oe==="classic"?"aspect-[4/3]":"aspect-video":"",be=[pe?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto flex flex-col",W].filter(Boolean).join(" ").trim(),De={...Y||{}},Ge=pe?"relative flex-1 min-h-[220px] bg-black":"relative w-full bg-black",Te={style:{transform:`scale(${ge})`,transformOrigin:"center"}},mt=(()=>{const Le=He==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black";return pe?O?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${se}`,children:e.jsx("video",{ref:x,className:Le,...Te})})}):e.jsx("video",{ref:x,className:Le,...Te}):O?e.jsx("div",{className:`relative w-full ${se}`,children:e.jsx("video",{ref:x,className:Le,...Te})}):e.jsx("video",{ref:x,className:Le,...Te})})();async function Me(ce,Le){if(ce)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(ce);else{const Xe=document.createElement("textarea");Xe.value=ce,Xe.style.position="fixed",Xe.style.opacity="0",document.body.appendChild(Xe),Xe.focus(),Xe.select(),document.execCommand("copy"),document.body.removeChild(Xe)}Ie(Le),xe.current&&window.clearTimeout(xe.current),xe.current=window.setTimeout(()=>Ie(null),1500)}catch(Xe){console.warn("Copy to clipboard failed:",Xe),Ie(null)}}return e.jsxs("div",{className:be,style:De,children:[e.jsxs("div",{className:Ge,children:[mt,a.isStreaming&&g==="phone"&&e.jsxs("div",{className:"absolute top-2 left-2 z-10 flex items-center gap-1 px-2 py-0.5 rounded-full bg-black/60 border border-rose-500/50 text-[10px] text-rose-200",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"REC"})]})]}),e.jsxs("div",{className:"p-1 flex items-center justify-between bg-black/60 text-white text-[10px] gap-1",children:[e.jsx("span",{className:"truncate",children:n||(p?g==="phone"?"PHONE LIVE":g==="wifi"?"WIFI LIVE":"LIVE":"Camera")}),e.jsxs("div",{className:"flex items-center gap-1",children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-1 py-0.5 rounded ${g==="local"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{w("local"),i()},children:"Local"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${g==="phone"?"bg-emerald-600":"bg-slate-700"}`,onClick:l,children:"Phone"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${g==="wifi"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{w("wifi"),m()},children:"Wifi"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${g==="wifi"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{w("wifi"),c()},children:"USB"})]}),p?e.jsx("button",{className:"px-1 py-0.5 rounded bg-rose-600",onClick:o,children:"Stop"}):null]})]}),g==="phone"&&I&&!p&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>Me(A,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:A}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:ue==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:A,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>Me(I,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:I}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:ue==="code"?"Copied!":"Copy"})]})]}),E&&e.jsx("img",{className:"mt-1 w-[160px] h-[160px] bg-white rounded",alt:"Scan to open",src:E}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[S!==null&&e.jsxs("span",{children:["Expires in ",S,"s"]}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:M,children:"Regenerate"})]}),D&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",F?.https?F.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>v(!1),children:"Hide tips"})})]})]}),g==="wifi"&&!p&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),J?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):b.length>0?e.jsxs("div",{className:"space-y-1",children:[b.map(ce=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:ce.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[ce.ip,":",ce.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${ce.status==="connecting"?"bg-yellow-600":ce.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>u(ce),disabled:ce.status==="connecting",children:ce.status==="connecting"?"...":"Connect"})]},ce.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:m,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:m,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),T?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):_.length>0?e.jsxs("div",{className:"space-y-1",children:[_.map(ce=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:ce.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:ce.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${ce.status==="connecting"?"bg-yellow-600":ce.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>f(ce),disabled:ce.status==="connecting",children:ce.status==="connecting"?"...":"Connect"})]},ce.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:c,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:c,children:"Scan USB"})]})]})]})]})}function dm(t){return t.dartsThrown===0?0:(t.totalScoreStart-t.totalScoreRemaining)/t.dartsThrown*3}function mm(t){const a=dm(t),s=t.finished;return{avg:a,isCompleted:s,darts:t.dartsThrown,checkout:t.checkoutScore??0}}function um(t){if(t.legs.length===0)return;const a=[];let s,r=t.bestCheckout??0;for(const n of t.legs){if(!n.finished)continue;const i=mm(n);a.push(i.avg),(!s||i.darts<s.darts||i.darts===s.darts&&(n.endTime??0)<s.timestamp)&&(s={darts:i.darts,timestamp:n.endTime??Date.now()}),i.checkout>r&&(r=i.checkout)}a.length&&(t.bestThreeDartAvg=Math.max(...a),t.worstThreeDartAvg=Math.min(...a)),s&&(t.bestNineDart=s),t.bestCheckout=r}const fa=qs((t,a)=>({roomId:"",players:[],currentPlayerIdx:0,startingScore:501,inProgress:!1,newMatch:(s,r,n="")=>t(()=>({players:s.map((o,l)=>({id:`${l}`,name:o,legsWon:0,legs:[]})),currentPlayerIdx:0,startingScore:r,inProgress:!0,roomId:n,bestLegThisMatch:void 0})),addVisit:(s,r)=>t(n=>{if(!n.inProgress)return n;const i=n.players[n.currentPlayerIdx];let o=i.legs[i.legs.length-1];return(!o||o.finished)&&(o={visits:[],totalScoreStart:n.startingScore,totalScoreRemaining:n.startingScore,dartsThrown:0,finished:!1,checkoutScore:null,startTime:Date.now()},i.legs.push(o)),o.visits.push({darts:r,score:s}),o.dartsThrown+=r,o.totalScoreRemaining=Math.max(0,o.totalScoreRemaining-s),{...n}}),undoVisit:()=>t(s=>{const r=s.players[s.currentPlayerIdx],n=r.legs[r.legs.length-1];if(!n||n.finished||n.visits.length===0)return s;const i=n.visits.pop();return n.dartsThrown-=i.darts,n.totalScoreRemaining+=i.score,{...s}}),endLeg:s=>t(r=>{const n=r.players[r.currentPlayerIdx],i=n.legs[n.legs.length-1];if(!i||i.finished)return r;if(i.finished=!0,i.checkoutScore=s,i.endTime=Date.now(),i.totalScoreRemaining===0){n.legsWon+=1;const o=r.bestLegThisMatch;(!o||i.dartsThrown<o.darts)&&(r.bestLegThisMatch={playerId:n.id,darts:i.dartsThrown,timestamp:i.endTime})}return{...r}}),nextPlayer:()=>t(s=>({...s,currentPlayerIdx:(s.currentPlayerIdx+1)%s.players.length})),endGame:()=>t(s=>{for(const r of s.players)um(r);return{...s,inProgress:!1}}),importState:s=>t(()=>({...s}))}));function hm(t,a){const s=Ad(t,a);return Pd(s)}function fm(t){try{if(!t||typeof t!="object")return null;if((t.type==="dart"||t.kind==="dart"||t.event==="dart")&&typeof t.value=="number"){const a=Rl(t.ring);return Ll(t.value,a)}if(typeof t.value=="number"&&t.ring){const a=Rl(t.ring);return Ll(t.value,a)}if(typeof t.score=="string"){const a=t.score.trim().toUpperCase();if(a==="50"||a==="DBULL"||a==="INNER_BULL")return{value:50,ring:"INNER_BULL",sector:null,mult:0};if(a==="25"||a==="BULL"||a==="OBULL")return{value:25,ring:"BULL",sector:null,mult:0};const s=a.match(/^(S|D|T)(\d{1,2})$/);if(s){const r=s[1]==="S"?1:s[1]==="D"?2:3,n=parseInt(s[2],10);if(n>=1&&n<=20)return{value:n*r,ring:r===1?"SINGLE":r===2?"DOUBLE":"TRIPLE",sector:n,mult:r}}}if(typeof t.sector=="number"&&typeof t.mult=="number"){const a=Math.max(1,Math.min(20,Math.floor(t.sector))),s=t.mult===1?1:t.mult===2?2:3;return{value:a*s,ring:s===1?"SINGLE":s===2?"DOUBLE":"TRIPLE",sector:a,mult:s}}if(t.bull){const a=String(t.bull).toLowerCase()==="inner"||t.bull===!0;return{value:a?50:25,ring:a?"INNER_BULL":"BULL",sector:null,mult:0}}}catch{}return null}function Rl(t){const a=String(t||"").toUpperCase();return a.startsWith("TR")?"TRIPLE":a.startsWith("DO")?"DOUBLE":a.startsWith("SI")?"SINGLE":a==="INNER_BULL"||a==="DBULL"||a==="50"||a==="IBULL"?"INNER_BULL":a==="BULL"||a==="25"||a==="OBULL"||a==="OUTER_BULL"?"BULL":a==="MISS"||a==="0"?"MISS":"SINGLE"}function Ll(t,a){const s=Math.max(0,Math.min(60,Math.round(Number(t)||0)));return a==="INNER_BULL"?{value:50,ring:a}:a==="BULL"?{value:25,ring:a}:{value:s,ring:a}}function xm(t,a){let s=null,r=!0,n=null,i=0;const o=400,l=[],m=new Set;function c(f,x){const p=typeof f?.id=="string"||typeof f?.id=="number"?String(f.id):null;if(p){if(m.has(p))return;if(m.add(p),l.push(p),l.length>200){const I=l.shift();I&&m.delete(I)}}const g=`${x.value}|${x.ring}|${x.sector??""}|${x.mult??""}`,w=Date.now();g===n&&w-i<o||(n=g,i=w,a(x))}function u(){if(r)try{s=new WebSocket(t),s.onmessage=f=>{try{const x=JSON.parse(f.data),p=fm(x);p&&c(x,p)}catch{}},s.onclose=()=>{s=null,setTimeout(u,1500)},s.onerror=()=>{}}catch{setTimeout(u,2e3)}}return u(),{close:()=>{r=!1;try{s?.close()}catch{}}}}function ea({storageKey:t,children:a,className:s,defaultWidth:r=640,defaultHeight:n=360,minWidth:i=320,minHeight:o=200,maxWidth:l=1600,maxHeight:m=1200}){const[c,u]=d.useState(()=>{try{const S=localStorage.getItem(t);if(S)return JSON.parse(S)}catch{}return{width:r,height:n}}),f=d.useRef(null),x=d.useRef(null);d.useEffect(()=>{function S(){try{localStorage.removeItem(t)}catch{}u({width:r,height:n})}return window.addEventListener("ndn:layout-reset",S),window.addEventListener("ndn:camera-reset",S),()=>{window.removeEventListener("ndn:layout-reset",S),window.removeEventListener("ndn:camera-reset",S)}},[t,r,n]),d.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(c))}catch{}},[c,t]);function p(S,E,M){return Math.max(E,Math.min(M,S))}function g(S,E){S.preventDefault();const M=x.current;if(!M)return;const F=M.getBoundingClientRect();f.current={x:S.clientX,y:S.clientY,w:F.width,h:F.height,dir:E},window.addEventListener("mousemove",w),window.addEventListener("mouseup",I)}function w(S){const E=f.current;if(!E)return;const M=S.clientX-E.x,F=S.clientY-E.y;let D=E.w,v=E.h;E.dir.includes("e")&&(D=p(E.w+M,i,l)),E.dir.includes("s")&&(v=p(E.h+F,o,m)),E.dir.includes("w")&&(D=p(E.w-M,i,l)),E.dir.includes("n")&&(v=p(E.h-F,o,m)),u({width:Math.round(D),height:Math.round(v)})}function I(){window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",I),f.current=null}const A={width:c.width?`${c.width}px`:void 0,height:c.height?`${c.height}px`:void 0,maxWidth:"100%",maxHeight:"80vh",position:"relative"};return e.jsxs("div",{ref:x,className:`${s||""}`,style:A,children:[a,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:S=>g(S,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:S=>g(S,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:S=>g(S,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:S=>g(S,"se")})]})}function rn({storageKey:t,children:a,className:s,defaultWidth:r=520,defaultHeight:n,minWidth:i=360,minHeight:o=200,maxWidth:l=1100,maxHeight:m=900,fullScreen:c=!1,initialFitHeight:u=!1}){const[f,x]=d.useState(()=>{if(!c){try{const F=localStorage.getItem(t);if(F)return JSON.parse(F)}catch{}return{width:r,height:n}}return{}}),p=d.useRef(null);d.useEffect(()=>{if(c)return;function F(){try{localStorage.removeItem(t)}catch{}if(u&&S.current?.parentElement){const D=S.current.parentElement,v=window.getComputedStyle(D),b=parseFloat(v.paddingTop||"0")||0,_=parseFloat(v.paddingBottom||"0")||0,J=Math.max(0,D.clientHeight-b-_),T=Math.max(o,Math.min(m,Math.round(J)));x({width:r,height:T});return}x({width:r,height:n})}return window.addEventListener("ndn:layout-reset",F),()=>window.removeEventListener("ndn:layout-reset",F)},[t,r,n,c]),d.useEffect(()=>{if(!c)try{localStorage.setItem(t,JSON.stringify(f))}catch{}},[f,t,c]),d.useEffect(()=>{if(c||!u)return;const F=S.current?.parentElement;if(!F)return;const D=window.getComputedStyle(F),v=parseFloat(D.paddingTop||"0")||0,b=parseFloat(D.paddingBottom||"0")||0,_=Math.max(0,F.clientHeight-v-b),J=Math.max(o,Math.min(m,Math.round(_)));try{const T=localStorage.getItem(t);if(T){const C=JSON.parse(T)?.height||0;(!C||C<J)&&x(Y=>({...Y,height:J}));return}}catch{}x(T=>({...T,height:J}))},[u,c,t,o,m]);function g(F,D,v){return Math.max(D,Math.min(v,F))}function w(F,D){F.preventDefault();const v=S.current;if(!v)return;const b=v.getBoundingClientRect();p.current={x:F.clientX,y:F.clientY,w:b.width,h:b.height,dir:D},window.addEventListener("mousemove",I),window.addEventListener("mouseup",A)}function I(F){const D=p.current;if(!D)return;const v=F.clientX-D.x,b=F.clientY-D.y,_=D.dir;let J=D.w,T=D.h,W=1/0;const C=S.current?.parentElement;if(C){const pe=window.getComputedStyle(C),ue=parseFloat(pe.paddingTop||"0")||0,Ie=parseFloat(pe.paddingBottom||"0")||0;W=Math.max(0,C.clientHeight-ue-Ie)}const Y=Math.min(m,isFinite(W)?W:m);_.includes("e")&&(J=g(D.w+v,i,l)),_.includes("s")&&(T=g(D.h+b,o,Y)),_.includes("w")&&(J=g(D.w-v,i,l)),_.includes("n")&&(T=g(D.h-b,o,Y)),x({width:Math.round(J),height:Math.round(T)})}function A(){window.removeEventListener("mousemove",I),window.removeEventListener("mouseup",A),p.current=null}const S=d.useRef(null),E=c?{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%"}:{width:f.width?`${f.width}px`:void 0,height:f.height?`${f.height}px`:void 0,maxWidth:`${l}px`,maxHeight:"100%"},M=c?"card relative ndn-modal-full":"card relative";return e.jsxs("div",{ref:S,className:`${M} ${s||""}`,style:E,children:[a,!c&&e.jsx("div",{className:"resizer resizer-nw",onMouseDown:F=>w(F,"nw")}),!c&&e.jsx("div",{className:"resizer resizer-ne",onMouseDown:F=>w(F,"ne")}),!c&&e.jsx("div",{className:"resizer resizer-sw",onMouseDown:F=>w(F,"sw")}),!c&&e.jsx("div",{className:"resizer resizer-se",onMouseDown:F=>w(F,"se")}),!c&&e.jsx("div",{className:"resizer-edge resizer-s",onMouseDown:F=>w(F,"s")})]})}const jo=qs((t,a)=>({samples:[],addSample:s=>t(r=>({samples:[...r.samples,s]})),clear:()=>t({samples:[]}),export:()=>a().samples.slice()})),Ol=qs(t=>({darts:0,total:0,entries:[],setVisit:(a,s,r)=>t({entries:a,darts:s,total:r}),reset:()=>t({darts:0,total:0,entries:[]})})),No=qs(t=>({paused:!1,pauseEndsAt:null,setPaused:(a,s=null)=>t({paused:a,pauseEndsAt:s??null})}));function Ve({onVisitCommitted:t,showToolbar:a=!0,onAutoDart:s,immediateAutoCommit:r=!1,hideInlinePanels:n=!1,scoringMode:i="x01",onGenericDart:o,onGenericReplace:l,x01DoubleInOverride:m}){const c=d.useRef(null),{preferredCameraId:u,preferredCameraLabel:f,setPreferredCamera:x,autoscoreProvider:p,autoscoreWsUrl:g}=Ot(),w=p==="manual",[I,A]=d.useState([]),S=d.useRef(null),E=d.useRef(null),[M,F]=d.useState(!1),[D,v]=d.useState(!1),[b,_]=d.useState(null),{H:J,imageSize:T,reset:W,_hydrated:C}=za(),[Y,pe]=d.useState(""),[ue,Ie]=d.useState(""),[xe,bt]=d.useState(0),[He,ge]=d.useState("MISS"),[oe,O]=d.useState(0),[se,ye]=d.useState(0),[be,De]=d.useState([]),Ge=Ot(L=>L.x01DoubleIn),Te=typeof m=="boolean"?!!m:!!Ge,[mt,Me]=d.useState({}),ce=Ae.players[Ae.currentPlayerIdx]?.id,Le=!!(ce&&mt[ce]),Xe=L=>{ce&&Me(z=>({...z,[ce]:L}))},ot=Ol(L=>L.setVisit),Kt=Ol(L=>L.reset);d.useEffect(()=>{try{ot(be,oe,se)}catch{}},[be,oe,se,ot]),d.useEffect(()=>()=>{try{Kt()}catch{}},[Kt]);const Qe=fa(L=>L.addVisit),ut=fa(L=>L.endLeg),Ae=fa(L=>L),le=jo(L=>L.addSample),[we,te]=d.useState(""),[X,qe]=d.useState(""),[Pe,ve]=d.useState(0),[k,ee]=d.useState(!1),[et,Se]=d.useState(!1),[gt,Ze]=d.useState("auto"),[Dt,st]=d.useState(!1),[cs,nt]=d.useState(!1),[Ht,Yt]=d.useState(!1),as=d.useRef(null),Ct=Ot(L=>L.dartTimerEnabled),Wt=Ot(L=>L.dartTimerSeconds)||10,[at,gs]=d.useState(null),it=d.useRef(null),As=No(L=>L.paused);d.useEffect(()=>{const L=()=>{w||nt(!0)};return window.addEventListener("ndn:open-autoscore",L),()=>window.removeEventListener("ndn:open-autoscore",L)},[w]),d.useEffect(()=>{const L=()=>Yt(!0);return window.addEventListener("ndn:open-scoring",L),()=>window.removeEventListener("ndn:open-scoring",L)},[]),d.useEffect(()=>{const L=()=>{Ze("manual"),st(!0)},z=()=>{Ze("auto"),st(!1)};return window.addEventListener("ndn:open-manual",L),window.addEventListener("ndn:close-manual",z),()=>{window.removeEventListener("ndn:open-manual",L),window.removeEventListener("ndn:close-manual",z)}},[]),d.useEffect(()=>{w&&(Ze("manual"),nt(!1))},[w]),d.useEffect(()=>{try{const L=Ae.players[Ae.currentPlayerIdx],z=L?.legs?.[L.legs.length-1];if(!L)return;(!z||z.dartsThrown===0)&&Me(re=>({...re,[L.id]:!1}))}catch{}},[Ae.currentPlayerIdx,Ae.players?.[Ae.currentPlayerIdx]?.legs?.length]),d.useEffect(()=>{const L=Ae?.inProgress,z=!!Ct&&L&&!As&&oe<3;if(it.current&&(clearInterval(it.current),it.current=null),!z){gs(null);return}return gs(Wt),it.current=window.setInterval(()=>{gs(re=>{const me=(re??Wt)-1;if(me<=0){try{Et(0,"MISS 0","MISS")}catch{}return it.current&&(clearInterval(it.current),it.current=null),0}return me})},1e3),()=>{it.current&&(clearInterval(it.current),it.current=null)}},[Ct,Wt,oe,Ae.currentPlayerIdx,Ae?.inProgress,As]),d.useEffect(()=>{if(!Dt)return;const L=setInterval(()=>{try{const z=c.current,re=as.current;if(!z||!re)return;const me=z.videoWidth||0,P=z.videoHeight||0;if(!me||!P)return;const q=re.clientWidth||640,U=re.clientHeight||360;re.width!==q&&(re.width=q),re.height!==U&&(re.height=U);const $=re.getContext("2d");if(!$)return;$.imageSmoothingEnabled=!0;const H=Math.min(q/me,U/P),je=Math.round(me*H),ne=Math.round(P*H),fe=Math.floor((q-je)/2),Ce=Math.floor((U-ne)/2);$.fillStyle="#000",$.fillRect(0,0,q,U),$.drawImage(z,fe,Ce,je,ne)}catch(z){console.warn("Manual preview update error:",z)}},120);return()=>clearInterval(L)},[Dt]),d.useEffect(()=>()=>qt(),[]);async function Xt(){if(!(D||M)){if(f==="Phone Camera"){console.log("[CAMERA] Phone camera is selected - skipping local camera startup"),console.log("[CAMERA] Phone camera feed shown via overlay in game tabs"),v(!1);return}v(!0),console.log("[CAMERA] Starting camera...");try{const L=u?{video:{deviceId:{exact:u}},audio:!1}:{video:{facingMode:"environment"},audio:!1};console.log("[CAMERA] Using constraints:",L);let z;try{z=await navigator.mediaDevices.getUserMedia(L),console.log("[CAMERA] Got stream:",!!z)}catch(re){console.warn("[CAMERA] First attempt failed:",re);const me=re&&(re.name||re.code)||"";if(u&&(me==="OverconstrainedError"||me==="NotFoundError"))console.log("[CAMERA] Trying fallback without deviceId"),z=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else if(!u&&(me==="OverconstrainedError"||me==="NotFoundError"||me==="NotSupportedError"))console.log("[CAMERA] Trying fallback for facingMode not supported"),z=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw re}if(c.current){console.log("[CAMERA] Setting stream to video element"),c.current.srcObject=z,console.log("[CAMERA] Stream tracks:",z.getTracks().length,"video tracks:",z.getVideoTracks().length),c.current.addEventListener("loadeddata",()=>console.log("[CAMERA] Video loadeddata")),c.current.addEventListener("canplay",()=>console.log("[CAMERA] Video canplay")),c.current.addEventListener("play",()=>console.log("[CAMERA] Video started playing")),c.current.addEventListener("error",re=>console.error("[CAMERA] Video error:",re));try{c.current.play(),console.log("[CAMERA] Play called successfully")}catch(re){console.error("[CAMERA] Video play failed:",re),setTimeout(()=>{try{c.current?.play(),console.log("[CAMERA] Retry play called")}catch(me){console.error("[CAMERA] Retry play failed:",me)}},100)}}else console.error("[CAMERA] Video element not found");F(!0);try{const re=await navigator.mediaDevices.enumerateDevices();A(re.filter(me=>me.kind==="videoinput")),console.log("[CAMERA] Found cameras:",re.filter(me=>me.kind==="videoinput").length)}catch(re){console.warn("[CAMERA] Failed to enumerate devices:",re)}}catch(L){console.error("[CAMERA] Camera start failed:",L),alert("Camera permission denied or not available.")}finally{v(!1)}}}function qt(){c.current&&c.current.srcObject&&(c.current.srcObject.getTracks().forEach(z=>z.stop()),c.current.srcObject=null,F(!1),v(!1))}function zt(){try{if(!c.current||!S.current)return;const L=c.current,z=S.current;z.width=L.videoWidth,z.height=L.videoHeight;const re=z.getContext("2d");if(!re)return;re.drawImage(L,0,0,z.width,z.height);const me=z.toDataURL("image/png");_(me)}catch(L){console.warn("Capture error:",L)}}function Ps(){return I.length?e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs",children:[e.jsx("span",{children:"Cam:"}),e.jsxs("select",{className:"bg-black/20 rounded px-1 py-0.5",value:u||"",onChange:async L=>{if(D)return;const z=L.target.value||void 0,re=I.find(me=>me.deviceId===z)?.label;x(z,re||"",!0),qt(),await new Promise(me=>setTimeout(me,100));try{await Xt()}catch(me){console.warn("Failed to start camera after device switch:",me),setTimeout(async()=>{try{await Xt()}catch(P){console.error("Camera switch failed after retry:",P),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),I.map(L=>e.jsx("option",{value:L.deviceId,children:L.label||"Camera"},L.deviceId))]})]}):null}function G(){try{if(!E.current||!c.current||!J||!T)return;const L=E.current,z=c.current,re=z.clientWidth,me=z.clientHeight;L.width=re,L.height=me;const P=L.getContext("2d");if(!P)return;P.clearRect(0,0,re,me);const q=re/T.w,U=me/T.h,$=Td(J,q,U),H=[ze.bullInner,ze.bullOuter,ze.trebleInner,ze.trebleOuter,ze.doubleInner,ze.doubleOuter];for(const je of H){const ne=xo($,je,360);po(P,ne,je===ze.doubleOuter?"#22d3ee":"#a78bfa",je===ze.doubleOuter?3:2)}}catch(L){console.warn("Overlay drawing error:",L)}}d.useEffect(()=>{if(w)return;const L=setInterval(G,250);return()=>clearInterval(L)},[J,T,M,w]),d.useEffect(()=>{if(p!=="external-ws"||!g)return;const L=xm(g,z=>{if(s){try{s(z.value,z.ring,{sector:z.sector??null,mult:z.mult??0})}catch{}try{le({playerId:Ae.players[Ae.currentPlayerIdx]?.id??null,sector:z.sector??null,mult:z.mult??0,ring:z.ring,ts:Date.now()})}catch{}}else{const re=z.ring==="INNER_BULL"?"INNER_BULL 50":z.ring==="BULL"?"BULL 25":`${z.ring[0]}${z.value/(z.mult||1)||z.value} ${z.value}`;Et(z.value,re,z.ring);try{le({playerId:Ae.players[Ae.currentPlayerIdx]?.id??null,sector:z.sector??null,mult:z.mult??0,ring:z.ring,ts:Date.now()})}catch{}}});return()=>L.close()},[p,g]);function he(L){if(!E.current||!J||!T)return;const z=E.current.getBoundingClientRect(),re=L.clientX-z.left,me=L.clientY-z.top,P=E.current.width/T.w,q=E.current.height/T.h,U={x:re/P,y:me/q},$=hm(J,U),H=`${$.ring} ${$.base>0?$.base:""}`.trim();pe(H),bt($.base),ge($.ring),Se(!0);try{if(r&&s){s($.base,$.ring,{sector:$.sector,mult:$.mult});try{le({playerId:Ae.players[Ae.currentPlayerIdx]?.id??null,sector:$.sector??null,mult:$.mult??0,ring:$.ring,ts:Date.now()})}catch{}Se(!1)}}catch{}}function yt(L){const z=L.trim().toUpperCase();if(!z)return null;const re=z==="BULL"||z==="50"||z==="DBULL"||z==="IBULL",me=z==="25"||z==="OBULL";if(re)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(me)return{label:"BULL 25",value:25,ring:"BULL"};const P=z.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!P)return null;const q=P[1]||"S",U=parseInt(P[2],10);if(U<1||U>20)return null;const $=q==="S"?1:q==="D"?2:3,H=q==="S"?"SINGLE":q==="D"?"DOUBLE":"TRIPLE";return{label:`${q}${U} ${U*$}`,value:U*$,ring:H}}function At(){const L=Ae;if(!L.players.length)return L.startingScore;const z=L.players[L.currentPlayerIdx],re=z.legs[z.legs.length-1];return re?re.totalScoreRemaining:L.startingScore}function Et(L,z,re){if(i==="custom"){if(o)try{o(L,re,{label:z})}catch{}if(oe>=3){O(1),ye(L),De([{label:z,value:L,ring:re}]);return}const fe=oe+1;O(fe),ye(Ce=>Ce+L),De(Ce=>[...Ce,{label:z,value:L,ring:re}]);return}if(oe>=3){Qe(se,oe);try{const fe=Ae.players[Ae.currentPlayerIdx]?.name;fe&&en(fe,oe,se)}catch{}O(1),ye(L),De([{label:z,value:L,ring:re}]),t&&t(se,oe,!1);return}const me=oe+1,q=!Te||Le||re==="DOUBLE"||re==="INNER_BULL"?L:0;Te&&!Le&&(re==="DOUBLE"||re==="INNER_BULL")&&Xe(!0);const U=se+q,H=At()-U,je=H===0&&(re==="DOUBLE"||re==="INNER_BULL");if(H<0||H===1||H===0&&!je){Qe(0,me),O(0),ye(0),De([]),t&&t(0,me,!1);return}if(O(me),ye(U),De(fe=>[...fe,{label:z,value:q,ring:re}]),je){Qe(U,me),ut(U),O(0),ye(0),De([]),t&&t(U,me,!0);return}me>=3&&(Qe(U,me),O(0),ye(0),De([]),t&&t(U,me,!1))}function Pt(){if(Y){if(s)try{s(xe,He,void 0)}catch{}else Et(xe,Y,He);ve(0),Se(!1)}}function ds(){const L=yt(ue);if(!L){alert("Enter like T20, D16, 5, 25, 50");return}if(!et||!Y||He==="MISS"||xe===0){const z=Pe+1;ve(z),z>=5&&ee(!0)}else ve(0);Et(L.value,L.label,L.ring),Ie(""),Se(!1)}function Tt(){const L=yt(ue);if(!L){alert("Enter like T20, D16, 5, 25, 50");return}if(oe===0||be.length===0){ds();return}if(i==="custom"){if(!et||!Y||He==="MISS"||xe===0){const ne=Pe+1;ve(ne),ne>=5&&ee(!0)}else ve(0);if(De(ne=>[...ne.slice(0,-1),{label:L.label,value:L.value,ring:L.ring}]),l)try{l(L.value,L.ring,{label:L.label})}catch{}Ie(""),Se(!1);return}if(!et||!Y||He==="MISS"||xe===0){const ne=Pe+1;ve(ne),ne>=5&&ee(!0)}else ve(0);const z=be[be.length-1],re=oe-1,me=se-(z?.value||0),P=At(),q=me+L.value,U=re+1,$=P-q,H=$===0&&(L.ring==="DOUBLE"||L.ring==="INNER_BULL");if($<0||$===1||$===0&&!H){Qe(0,U);try{const ne=Ae.players[Ae.currentPlayerIdx]?.name;ne&&en(ne,U,0)}catch{}O(0),ye(0),De([]),t&&t(0,U,!1),Ie(""),Se(!1);return}if(O(U),ye(q),De(ne=>[...ne.slice(0,-1),{label:L.label,value:L.value,ring:L.ring}]),H){Qe(q,U),ut(q);try{const ne=Ae.players[Ae.currentPlayerIdx]?.name;ne&&en(ne,U,q)}catch{}O(0),ye(0),De([]),t&&t(q,U,!0),Ie(""),Se(!1);return}if(U>=3){Qe(q,U);try{const ne=Ae.players[Ae.currentPlayerIdx]?.name;ne&&en(ne,U,q)}catch{}O(0),ye(0),De([]),t&&t(q,U,!1)}Ie(""),Se(!1)}function ys(){ee(!1),ve(0);try{window.dispatchEvent(new CustomEvent("ndn:request-calibrate"))}catch{}}function vs(){W(),ee(!1),ve(0)}function rs(L,z){if(oe>=3)return;const re=L*(z==="S"?1:z==="D"?2:3),me=z==="S"?"SINGLE":z==="D"?"DOUBLE":"TRIPLE";if(!et||!Y||He==="MISS"||xe===0){const P=Pe+1;ve(P),P>=5&&ee(!0)}else ve(0);Et(re,`${z}${L} ${re}`,me),Se(!1)}function ms(){if(oe===0)return;const L=be[be.length-1];O(z=>z-1),ye(z=>z-(L?.value||0)),De(z=>z.slice(0,-1))}function us(){if(oe!==0){if(i==="custom"){O(0),ye(0),De([]);return}Qe(se,oe);try{const L=Ae.players[Ae.currentPlayerIdx]?.name;L&&en(L,oe,se)}catch{}O(0),ye(0),De([]),t&&t(se,oe,!1)}}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!w&&e.jsx("button",{className:`btn px-3 py-1 text-sm ${gt==="auto"?"tab--active":""}`,onClick:()=>{Ze("auto"),st(!1),nt(!0)},children:"Autoscore"}),e.jsx("button",{className:`btn px-3 py-1 text-sm ${gt==="manual"?"tab--active":""}`,onClick:()=>{Ze("manual"),st(!0)},title:"Open Manual Correction",children:"Manual Correction"}),w&&e.jsx("span",{className:"text-xs opacity-70",children:"Manual scoring mode active"})]})}),!n&&!w?e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(ea,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:320,minHeight:240,maxWidth:1600,maxHeight:900,children:[e.jsx(Ps,{}),f==="Phone Camera"?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100 mb-2",children:"Phone Camera Active"}),e.jsx("div",{className:"text-sm text-slate-300 mb-4",children:"Your phone camera feed is shown in the floating overlay"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Camera controls available in Calibrator tab"})]})}):(()=>{const z=(Ot.getState().cameraFitMode||"fit")==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black";return e.jsxs("div",{className:"relative w-full aspect-[4/3] bg-black",children:[e.jsx("video",{ref:c,className:z,playsInline:!0,"webkit-playsinline":"true",muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:E,className:"absolute inset-0 w-full h-full",onClick:he}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${be[0]?be[0].value>0?"hit":"miss":"pending"}, ${be[1]?be[1].value>0?"hit":"miss":"pending"}, ${be[2]?be[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(re=>{const me=be[re],P=!me,q=!!me&&(typeof me.value=="number"?me.value>0:!0),U=P?"bg-gray-500/70":q?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${U}`},re)}),Ct&&at!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,at),"s"]})]})]})})()]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[f==="Phone Camera"?e.jsx("div",{className:"text-sm text-blue-200 px-3 py-2 rounded bg-blue-900/30 flex-1",children:"ðŸ“± Using phone camera from overlay"}):e.jsxs(e.Fragment,{children:[M?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:qt,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:Xt,disabled:D,children:D?"Connecting Camera...":"Connect Camera"}),e.jsx("button",{className:"btn",onClick:zt,disabled:!M,children:"Capture Still"})]}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}):null,!n&&w&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Manual Scoring"}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:"Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{st(!0),Ze("manual")},children:"Open Manual Correction"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Manage Pending Visit"})]})]}),e.jsx("canvas",{ref:S,className:"hidden"}),cs&&!w&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(rn,{storageKey:"ndn:autoscore:size",className:"w-full max-w-3xl",defaultWidth:720,defaultHeight:520,minWidth:420,minHeight:320,maxWidth:1400,maxHeight:900,initialFitHeight:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Autoscore"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn btn--ghost",onClick:()=>nt(!1),children:"Close"})})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Click the camera overlay to autoscore. Use Manual Correction if the last auto is off."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:Y||"â€”"}),e.jsx("button",{className:"btn",onClick:Pt,disabled:oe>=3,children:"Add Auto Dart"}),Pe>0&&e.jsxs("span",{className:"text-sm opacity-80",children:["No-registers: ",Pe,"/3"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:oe>=3,onClick:()=>{if(!et||!Y||He==="MISS"||xe===0){const L=Pe+1;ve(L),L>=5&&ee(!0)}else ve(0);Et(25,"BULL 25","BULL"),Se(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:oe>=3,onClick:()=>{if(!et||!Y||He==="MISS"||xe===0){const L=Pe+1;ve(L),L>=5&&ee(!0)}else ve(0);Et(50,"INNER_BULL 50","INNER_BULL"),Se(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"autoscore-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:we,onChange:L=>te(L.target.value.toUpperCase()),onKeyDown:L=>{if(L.key==="Enter"){const z=we.match(/^(S|D|T)(\d{1,2})$/);z&&rs(parseInt(z[2],10),z[1])}}}),e.jsx("datalist",{id:"autoscore-quick-list",children:["D","S","T"].map(L=>Array.from({length:20},(z,re)=>re+1).map(z=>e.jsx("option",{value:`${L}${z}`},`${L}${z}`)))}),e.jsx("button",{className:"btn",disabled:!we||oe>=3,onClick:()=>{const L=we.match(/^(S|D|T)(\d{1,2})$/);if(!L)return;const z=L[1],re=parseInt(L[2],10);rs(re,z)},children:"Add"})]})]})]})})}),Dt&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{st(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:as,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:Y||"â€”"}),e.jsx("button",{className:"btn",onClick:Pt,disabled:oe>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Manual (T20, D16, 5, 25, 50)",value:ue,onChange:L=>Ie(L.target.value),onKeyDown:L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),ds()),L.key==="Enter"&&L.shiftKey&&(L.preventDefault(),Tt())}}),e.jsx("button",{className:"btn btn--ghost",onClick:Tt,disabled:oe===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:ds,disabled:oe>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add Â· Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:oe>=3,onClick:()=>{if(!et||!Y||He==="MISS"||xe===0){const L=Pe+1;ve(L),L>=5&&ee(!0)}else ve(0);Et(25,"BULL 25","BULL"),Se(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:oe>=3,onClick:()=>{if(!et||!Y||He==="MISS"||xe===0){const L=Pe+1;ve(L),L>=5&&ee(!0)}else ve(0);Et(50,"INNER_BULL 50","INNER_BULL"),Se(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:X,onChange:L=>qe(L.target.value.toUpperCase()),onKeyDown:L=>{if(L.key==="Enter"){const z=X.match(/^(S|D|T)(\d{1,2})$/);z&&rs(parseInt(z[2],10),z[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(L=>Array.from({length:20},(z,re)=>re+1).map(z=>e.jsx("option",{value:`${L}${z}`},`${L}${z}`)))}),e.jsx("button",{className:"btn",disabled:!X||oe>=3,onClick:()=>{const L=X.match(/^(S|D|T)(\d{1,2})$/);if(!L)return;const z=L[1],re=parseInt(L[2],10);rs(re,z)},children:"Add"})]})]})]})]})})]})}),Ht&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>Yt(!1),children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(ea,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:320,minHeight:240,maxWidth:1600,maxHeight:900,children:[e.jsx(Ps,{}),f==="Phone Camera"?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100 mb-2",children:"Phone Camera Active"}),e.jsx("div",{className:"text-sm text-slate-300 mb-4",children:"Your phone camera feed is shown in the floating overlay"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Camera controls available in Calibrator tab"})]})}):(()=>{const z=(Ot.getState().cameraFitMode||"fit")==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black";return e.jsxs("div",{className:"relative w-full aspect-[4/3] bg-black",children:[e.jsx("video",{ref:c,className:z,playsInline:!0,"webkit-playsinline":"true",muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:E,className:"absolute inset-0 w-full h-full",onClick:he}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${be[0]?be[0].value>0?"hit":"miss":"pending"}, ${be[1]?be[1].value>0?"hit":"miss":"pending"}, ${be[2]?be[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(re=>{const me=be[re],P=!me,q=!!me&&(typeof me.value=="number"?me.value>0:!0),U=P?"bg-gray-500/70":q?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${U}`},re)}),Ct&&at!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,at),"s"]})]})]})})()]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[f==="Phone Camera"?e.jsx("div",{className:"text-sm text-blue-200 px-3 py-2 rounded bg-blue-900/30 flex-1",children:"ðŸ“± Using phone camera from overlay"}):e.jsxs(e.Fragment,{children:[M?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:qt,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Xt,children:"Connect Camera"}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:zt,disabled:!M,children:"Capture Still"})]}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[0,1,2].map(L=>{const z=be[L],re=!z,me=!!z&&(typeof z.value=="number"?z.value>0:!0),P=re?"bg-gray-500/70":me?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-2.5 h-2.5 rounded-full shadow ${P}`},L)}),Ct&&at!==null&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold",children:[Math.max(0,at),"s"]})]}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:be.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):be.map((L,z)=>e.jsx("li",{children:L.label},z))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",oe,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",se]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:ms,disabled:oe===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:us,disabled:oe===0,children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{O(0),ye(0),De([])},disabled:oe===0,children:"Clear"})]})]})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>{ee(!1),ve(0)},children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-white",children:"Recalibration Recommended"}),e.jsx("div",{className:"mb-4 text-lg font-semibold text-indigo-200",children:"We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:ys,children:"Go to Calibrate"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:vs,children:"Reset Calibration"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{ee(!1),ve(0)},children:"Dismiss"})]})]})}),n?null:e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[0,1,2].map(L=>{const z=be[L],re=!z,me=!!z&&(typeof z.value=="number"?z.value>0:!0),P=re?"bg-gray-500/70":me?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-2.5 h-2.5 rounded-full shadow ${P}`},L)}),Ct&&at!==null&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold",children:[Math.max(0,at),"s"]})]}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:be.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):be.map((L,z)=>e.jsx("li",{children:L.label},z))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",oe,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",se]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:ms,disabled:oe===0,children:"Undo Dart"}),e.jsx("button",{className:"btn",onClick:us,disabled:oe===0,children:"Commit Visit"}),e.jsx("button",{className:"btn",onClick:()=>{O(0),ye(0),De([])},disabled:oe===0,children:"Clear"})]})]})]})}function Bl(t,a,s,r){const n=(r-90)*Math.PI/180;return{x:t+s*Math.cos(n),y:a+s*Math.sin(n)}}function Ul(t){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(t)*18+9}function pm({width:t=320,height:a=320}){const s=jo(n=>n.samples),r=d.useRef(null);return d.useEffect(()=>{const n=r.current;if(!n)return;const i=n.getContext("2d");if(!i)return;n.width=t,n.height=a,i.clearRect(0,0,t,a);const o=t/2,l=a/2,m=Math.min(t,a)/(ze.doubleOuter*2+20),c={bullInner:ze.bullInner*m,bullOuter:ze.bullOuter*m,trebleInner:ze.trebleInner*m,trebleOuter:ze.trebleOuter*m,doubleInner:ze.doubleInner*m,doubleOuter:ze.doubleOuter*m};i.strokeStyle="rgba(255,255,255,0.06)",i.lineWidth=1;const u=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const p of u)i.beginPath(),i.arc(o,l,c[p],0,Math.PI*2),i.stroke();const f=[];for(const p of s){let g=Math.random()*360,w=Math.random()*c.doubleOuter;typeof p.sector=="number"&&p.sector>=1&&p.sector<=20&&(g=Ul(p.sector),p.ring==="DOUBLE"?w=(c.doubleInner+c.doubleOuter)/2:p.ring==="TRIPLE"?w=(c.trebleInner+c.trebleOuter)/2:p.ring==="INNER_BULL"?w=c.bullInner*.5:p.ring==="BULL"?w=c.bullOuter*.8:w=(c.trebleOuter+c.doubleInner)/2*(.6+Math.random()*.4));const I=Bl(o,l,w,g);f.push({x:I.x,y:I.y,w:1})}for(const p of f){const g=i.createRadialGradient(p.x,p.y,1,p.x,p.y,60);g.addColorStop(0,"rgba(255,0,0,0.9)"),g.addColorStop(.3,"rgba(255,100,0,0.5)"),g.addColorStop(1,"rgba(255,100,0,0)"),i.fillStyle=g,i.beginPath(),i.arc(p.x,p.y,60,0,Math.PI*2),i.fill()}i.fillStyle="rgba(255,255,255,0.85)",i.font="12px ui-sans-serif";const x={};for(const p of s)p.sector&&(x[p.sector]=(x[p.sector]||0)+1);for(const p of Object.keys(x)){const g=Number(p),w=Ul(g),I=Bl(o,l,c.trebleOuter+18,w);i.fillText(String(x[g]),I.x-6,I.y+4)}},[s,t,a]),e.jsx("canvas",{ref:r,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}const Ds=[...Array.from({length:20},(t,a)=>({label:`D${a+1}`,score:(a+1)*2})),{label:"DBULL",score:50,isBull:!0}];function ti(t,a){const s=Ds[a];return!!s&&t===s.score}function Gs(t){const a=t.trim().toUpperCase();if(!a)return null;if(a==="50"||a==="BULL"||a==="DBULL"||a==="IBULL")return 50;if(a==="25"||a==="OBULL")return 25;const s=a.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!s)return null;const r=s[1]||"S",n=parseInt(s[2],10);return n<1||n>20?null:n*(r==="S"?1:r==="D"?2:3)}const _t=[...Array.from({length:20},(t,a)=>a+1),25,50],ja=[20,19,18,17,16,15,25];function Tn(){const t={};return ja.forEach(a=>{t[a]=0}),{marks:t,points:0}}function wo(t,a,s,r,n=()=>!1){let i=null,o=0;if(s==="BULL"||s==="INNER_BULL"||a===25||a===50)i=25,o=s==="INNER_BULL"||a===50?2:1;else if(typeof r=="number"&&r>=15&&r<=20)i=r,s==="TRIPLE"?o=3:s==="DOUBLE"?o=2:o=1;else if(a){const p=[20,19,18,17,16,15];for(const g of p){if(a===g){i=g,o=1;break}if(a===g*2){i=g,o=2;break}if(a===g*3){i=g,o=3;break}}!i&&(a===25||a===50)&&(i=25,o=a===50?2:1)}if(!i)return 0;const l=t.marks[i];let m=Math.max(0,3-l);const c=Math.min(m,o),u=Math.max(0,o-c),f=l+c;t.marks[i]=f>3?3:f;let x=0;return u>0&&!n(i)&&(i===25?s==="INNER_BULL"?x+=50*u:x+=25*u:x+=i*u),t.points+=x,x}function bm(t){return ja.every(a=>(t.marks[a]||0)>=3)}function tn(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function gm(t){return t.round}function So(t,a,s,r){if(t.finished)return 0;const n=gm(t);let i=0;return typeof r=="number"&&r===n?s==="TRIPLE"?(i=n*3,t.turnHits.triples++):s==="DOUBLE"?(i=n*2,t.turnHits.doubles++):s==="SINGLE"&&(i=n*1,t.turnHits.singles++):!r&&(a===n||a===n*2||a===n*3)&&(a===n*3?(i=n*3,t.turnHits.triples++):a===n*2?(i=n*2,t.turnHits.doubles++):a===n&&(i=n,t.turnHits.singles++)),t.score+=i,i}function Co(t){if(!t.finished){if(t.turnHits.singles>0&&t.turnHits.doubles>0&&t.turnHits.triples>0){t.shanghaiAchieved=!0,t.finished=!0;return}const a=t.round+1;a>20?t.finished=!0:t.round=a}t.turnHits={singles:0,doubles:0,triples:0}}function sn(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function Ha(t){return t.targets[t.stage]||null}function ko(t,a,s,r){if(t.finished)return 0;const n=Ha(t);if(!n)return 0;let i=0;switch(n.kind){case"NUMBER":{typeof r=="number"&&r===n.num?s==="TRIPLE"?i=n.num*3:s==="DOUBLE"?i=n.num*2:s==="SINGLE"&&(i=n.num):!r&&(a===n.num||a===n.num*2||a===n.num*3)&&(i=a),i>0&&(t.hitThisRound=!0);break}case"DOUBLE":{(s==="DOUBLE"&&r===n.num||a===n.num*2)&&(i=n.num*2,t.hitThisRound=!0);break}case"TRIPLE":{(s==="TRIPLE"&&r===n.num||a===n.num*3)&&(i=n.num*3,t.hitThisRound=!0);break}case"BULL":{(s==="BULL"||s==="INNER_BULL"||a===25||a===50)&&(i=s==="INNER_BULL"||a===50?50:25,t.hitThisRound=!0);break}case"ANY_NUMBER":{a>0&&(i=a,t.hitThisRound=!0);break}}return t.score+=i,i}function Eo(t){t.finished||(t.hitThisRound||(t.score=Math.floor(t.score/2)),t.hitThisRound=!1,t.stage+=1,t.stage>=t.targets.length&&(t.finished=!0))}function nn(){return{round:1,score:0,target:"HIGH",finished:!1}}function To(t,a,s,r){if(t.finished)return 0;let n=0;if(t.target==="HIGH")if(s==="INNER_BULL")n=50;else if(typeof r=="number"){const o=r*(s==="TRIPLE"?3:s==="DOUBLE"?2:1);r>=20&&(n=o)}else a>=40&&(n=a);else if(typeof r=="number"){const o=r*(s==="TRIPLE"?3:s==="DOUBLE"?2:1);r<=10&&(n=o)}else a>0&&a<=30&&(n=a);return t.score+=n,n}function Mo(t){if(!t.finished){if(t.round+=1,t.round>10){t.finished=!0;return}t.target=t.target==="HIGH"?"LOW":"HIGH"}}function Io(t,a=3){return{number:t,lives:a,isKiller:!1,eliminated:!1}}function ym(t){const a=Array.from({length:20},(r,n)=>n+1),s={};for(const r of t){const n=Math.floor(Math.random()*a.length),i=a.splice(n,1)[0];s[r]=i}return s}function si(t,a,s,r){const n=a[t];if(!n||!r||!s)return{becameKiller:!1};if(!n.isKiller&&s==="DOUBLE"&&r===n.number)return n.isKiller=!0,{becameKiller:!0};if(n.isKiller&&(s==="DOUBLE"||s==="TRIPLE")){const i=Object.keys(a).find(o=>o!==t&&!a[o].eliminated&&a[o].number===r);if(i){const o=a[i],l=s==="TRIPLE"?2:1;return o.lives=Math.max(0,o.lives-l),o.lives===0&&(o.eliminated=!0),{becameKiller:!1,victimId:i,livesRemoved:l}}}return{becameKiller:!1}}function ni(t){const a=Object.entries(t).filter(([,s])=>!s.eliminated&&s.lives>0);return a.length===1?a[0][0]:null}function xa(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function Do(t,a,s,r){if(t.finished)return 0;let n=0;if(typeof r=="number"&&r===t.inning?s==="TRIPLE"?n=3:s==="DOUBLE"?n=2:n=1:!r&&(a===t.inning||a===t.inning*2||a===t.inning*3)&&(n=a===t.inning*3?3:a===t.inning*2?2:1),t.score+=n,t.dartsThisInning+=1,t.dartsThisInning>=3){const i=t.inning+1;i>9?t.finished=!0:(t.inning=i,t.dartsThisInning=0)}return n}const Ao={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function pa(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function Po(t,a,s,r){if(t.finished)return!1;const n=Ao[t.hole];if(t.dartsThisHole+=1,typeof r=="number"&&r===n&&(s==="SINGLE"||s==="DOUBLE"||s==="TRIPLE")||!r&&(a===n||a===n*2||a===n*3)){t.strokes+=t.dartsThisHole;const o=t.hole+1;return o>18?t.finished=!0:(t.hole=o,t.dartsThisHole=0),!0}if(t.dartsThisHole>=3){t.strokes+=3;const o=t.hole+1;o>18?t.finished=!0:(t.hole=o,t.dartsThisHole=0)}return!1}const ba={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function ai(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function vm(t){const a=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[s,r,n]of a)if(t[s]&&t[s]===t[r]&&t[s]===t[n])return t[s];return t.every(s=>s)?"Draw":null}function Ro(t,a,s,r,n){if(t.finished||t.board[a])return!1;const i=ba[a];let o=!1;if(i.type==="BULL"?o=r==="BULL"||r==="INNER_BULL"||s===25||s===50:i.type==="NUM"&&typeof i.num=="number"&&(typeof n=="number"&&n===i.num||!n&&(s===i.num||s===i.num*2||s===i.num*3))&&(o=!0),!o)return!1;t.board[a]=t.turn;const l=vm(t.board);return l?(t.finished=!0,t.winner=l,!0):(t.turn=t.turn==="X"?"O":"X",!0)}const Ga=[20,19,18,17,16,15,14,13,12,25];function ga(){const t={};return Ga.forEach(a=>{t[a]=0}),{marks:t,points:0}}function Lo(t,a,s,r,n=()=>!1){let i=null,o=0;if(s==="BULL"||s==="INNER_BULL"||a===25||a===50)i=25,o=s==="INNER_BULL"||a===50?2:1;else if(typeof r=="number"&&r>=12&&r<=20)i=r,s==="TRIPLE"?o=3:s==="DOUBLE"?o=2:o=1;else if(a){for(const p of[20,19,18,17,16,15,14,13,12]){if(a===p){i=p,o=1;break}if(a===p*2){i=p,o=2;break}if(a===p*3){i=p,o=3;break}}!i&&(a===25||a===50)&&(i=25,o=a===50?2:1)}if(!i)return 0;const l=t.marks[i],m=Math.max(0,3-l),c=Math.min(m,o),u=Math.max(0,o-c),f=l+c;t.marks[i]=f>3?3:f;let x=0;return u>0&&!n(i)&&(i===25?s==="INNER_BULL"?x+=50*u:x+=25*u:x+=i*u),t.points+=x,x}function jm(t){return Ga.every(a=>(t.marks[a]||0)>=3)}const $l=["X01","Double Practice"],Nm=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice"],wm=["Easy","Medium","Hardened"];function ya(t,a,s){return Math.max(a,Math.min(s,t))}function Sm(t,a){let s=0;if(a==="Easy"){const r=[22,26,41,45,60];s=r[Math.floor(Math.random()*r.length)]}else a==="Medium"?s=Math.round(ya(60+(Math.random()*30-15),30,100)):s=Math.round(ya(80+(Math.random()*20-10),50,120));return t<=0?0:s>t?[100,85,81,60,57,45,41,26,22,20,1].find(n=>n<=t)??0:s}function Cm({onClose:t}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:t,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const km="http://localhost:8787";function Em({user:t}){const{offlineLayout:a}=Ot(),[s,r]=d.useState("X01"),[n,i]=d.useState(501),[o,l]=d.useState("None"),[m,c]=d.useState(!1),[u,f]=d.useState(!1),[x,p]=d.useState(n),[g,w]=d.useState(n),[I,A]=d.useState(!1),[S,E]=d.useState(!1),[M,F]=d.useState(1),[D,v]=d.useState(0),[b,_]=d.useState(0),[J,T]=d.useState(null),[W,C]=d.useState(1),[Y,pe]=d.useState(1),[ue,Ie]=d.useState([]),[xe,bt]=d.useState(2e3),He=sa(),[ge,oe]=d.useState(!1),[O,se]=d.useState(a==="modern"),[ye,be]=d.useState(a==="modern");d.useEffect(()=>{se(a==="modern"),be(a==="modern")},[a]);const[De,Ge]=d.useState(1),[Te,mt]=d.useState(!0),[Me,ce]=d.useState(0),[Le,Xe]=d.useState(0),[ot,Kt]=d.useState(0),[Qe,ut]=d.useState(0),[Ae,le]=d.useState(0),[we,te]=d.useState(Tn()),[X,qe]=d.useState(tn()),[Pe,ve]=d.useState(sn()),[k,ee]=d.useState(nn()),[et,Se]=d.useState(0),[gt,Ze]=d.useState(1),[Dt,st]=d.useState(27),[cs,nt]=d.useState(0),[Ht,Yt]=d.useState(0),[as,Ct]=d.useState(!1),[Wt,at]=d.useState(1),[gs,it]=d.useState(0),[As,Xt]=d.useState(0),qt=8,[zt,Ps]=d.useState(1),[G,he]=d.useState(0),[yt,At]=d.useState(0),Et=10,[Pt,ds]=d.useState(1),[Tt,ys]=d.useState(0),[vs,rs]=d.useState(0),ms=10,[us,L]=d.useState(170),[z,re]=d.useState(0),[me,P]=d.useState(0),[q,U]=d.useState(0),[$,H]=d.useState(121),[je,ne]=d.useState(0),[fe,Ce]=d.useState(0),[tt,vt]=d.useState(0),[ht,wt]=d.useState(20),[Bt,Gt]=d.useState(0),[hs,Zt]=d.useState(0),[Mt,Rs]=d.useState(30),[ft,is]=d.useState(!1),[Rt,xs]=d.useState(xa()),[ln,Fs]=d.useState(pa()),[ls,os]=d.useState(ai()),[es,Jt]=d.useState(ga()),[xt,Qt]=d.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[Ls,js]=d.useState({}),[Ut,on]=d.useState({}),[Os,_s]=d.useState(!1),[ts,ss]=d.useState(0),[jt,Oe]=d.useState(0),[Je,$e]=d.useState(null),[$t,Ke]=d.useState(""),[pt,Nt]=d.useState(0),[St,lt]=d.useState(0),[Ns,Ee]=d.useState(0),[Js,Dn]=d.useState(n),[ws,Ss]=d.useState(0),[cn,Cs]=d.useState(0),[An,ks]=d.useState(0);d.useRef(null);const[Ft,dn]=d.useState(0),[mn,un]=d.useState(0),[Es,Ts]=d.useState(0),[Pn,Bs]=d.useState(0),[Rn,hn]=d.useState(0),[fn,Ln]=d.useState(0),[xn,On]=d.useState(0),[pn,Bn]=d.useState(0),[bn,We]=d.useState(0),[Un,gn]=d.useState(0),[yn,vn]=d.useState(0),[Na,$n]=d.useState(0),[wa,Fn]=d.useState(0),[aa,_n]=d.useState(0),[Sa,Hn]=d.useState(0),[ct,jn]=d.useState(0),[ra,Nn]=d.useState(0),[ia,wn]=d.useState(0),[Ca,la]=d.useState(0),[ka,Ea]=d.useState(0),[Sn,zs]=d.useState(!1),[Lt,It]=d.useState(""),[Ks,Wn]=d.useState(""),{favoriteDouble:oa,callerEnabled:qn,callerVoice:Cn,callerVolume:zn,speakCheckoutOnly:Ys,rememberLastOffline:Ka,setLastOffline:Ya,autoStartOffline:Ta,cameraScale:h,setCameraScale:j,cameraAspect:N="wide",setCameraAspect:R,cameraFitMode:Q="fill",setCameraFitMode:de,cameraEnabled:ae,textSize:V,boxSize:Fe,autoscoreProvider:ns,matchType:fs="singles",setMatchType:Ms,teamAName:Re="Team A",setTeamAName:Vn,teamBName:ca="Team B",setTeamBName:Gn}=Ot(),Us=ns==="manual",Xs=(y=>{switch(y){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(V),Jn=d.useRef(null),Kn=d.useRef(null),Xa=d.useRef(null),[Yn,Qa]=d.useState("first"),[Ma,fi]=d.useState(1),Ho=d.useRef(null);d.useEffect(()=>{const y=Math.max(1,Math.floor(Number(Ma)||1)),B=Yn==="first"?y:Math.max(1,Math.ceil(y/2));F(B)},[Yn,Ma]),d.useEffect(()=>{if(!ye){Ge(1);return}const y=()=>{const Z=Jn.current,ie=Kn.current;if(!Z||!ie)return;const Ue=Xa.current?Xa.current.getBoundingClientRect().height:0,_e=Math.max(0,Z.clientHeight-Ue-6),ke=Math.max(0,Z.clientWidth-8),Ne=ie.getBoundingClientRect(),Be=De||1,Ye=Ne.height/Be,Vt=Ne.width/Be,Is=_e>0?_e/Ye:1,kn=ke>0?ke/Vt:1,$s=Math.min(1,Math.max(.5,Math.min(Is,kn)));Ge($s)};y();const B=window.ResizeObserver,K=B?new B(()=>y()):null;return K&&Jn.current&&K.observe(Jn.current),K&&Kn.current&&K.observe(Kn.current),window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y);try{K&&Jn.current&&K.unobserve(Jn.current)}catch{}try{K&&Kn.current&&K.unobserve(Kn.current)}catch{}}},[ye,De]),d.useEffect(()=>{const y=B=>{const K=B?.detail?.mode;K&&(r(K),Xn())};return window.addEventListener("ndn:auto-start",y),()=>window.removeEventListener("ndn:auto-start",y)},[]),d.useEffect(()=>{const y=B=>{const K=B?.detail?.formatType,Z=B?.detail?.formatCount,ie=B?.detail?.startScore;(K==="first"||K==="best")&&Qa(K),typeof Z=="number"&&isFinite(Z)&&fi(Math.max(1,Math.floor(Z))),typeof ie=="number"&&isFinite(ie)&&i(Math.max(1,Math.floor(ie)))};return window.addEventListener("ndn:offline-format",y),()=>window.removeEventListener("ndn:offline-format",y)},[]),d.useEffect(()=>{if(!Ta)return;const y=setTimeout(()=>Xn(),50);return()=>clearTimeout(y)},[Ta]),d.useEffect(()=>{if(!ge||Te||o==="None"||An<=0)return;let y,B=performance.now();const K=Z=>{const ie=Z-B;B=Z,ks(Ue=>{const _e=Ue-ie;if(_e<=0){let ke=0,Ne=g;for(;ke<3&&Ne>0;){const Be=Sm(Ne,o),Ye=ya(Be-ke*20,0,Math.min(60,Ne)),Vt=Ne-Ye;if(un(Ye),dn($s=>$s+1),gn($s=>$s+1),Vt<0){Ne=g,Ts(0),Bs(0);break}Ts($s=>$s+Ye),$n($s=>$s+Ye);const Is=Ne,kn=Vt;if(Is>50&&kn<=50?Bs(1):Is<=50&&Bs($s=>$s+1),Ne=Vt,ke+=1,Ne===0)break}if(w(Ne),Ne===0){Es===180?jn(Ye=>Ye+1):Es>=140?Nn(Ye=>Ye+1):Es>=100&&wn(Ye=>Ye+1);const Be=g;Be<=170&&Ea(Ye=>Math.max(Ye,Be)),g<=50&&(On(Ye=>Ye+(Pn>0?Pn:1)),Bn(Ye=>Ye+1)),Ts(0),Bs(0),T("ai"),E(!0)}return Ne>0&&ke>=3&&(Es===180?jn(Be=>Be+1):Es>=140?Nn(Be=>Be+1):Es>=100&&wn(Be=>Be+1),Ts(0),Bs(0)),mt(!0),0}return _e}),An>0&&(y=requestAnimationFrame(K))};return y=requestAnimationFrame(K),()=>cancelAnimationFrame(y)},[ge,Te,o,An,g]);function Xn(){f(!0),p(n),w(n),A(!1),oe(!0),mt(!0),ce(0),Nt(0),lt(0),Ee(0),Dn(n),Ss(0),Cs(0),ks(0),dn(0),un(0),Ts(0),T(null),v(0),_(0),Ie([]),Gt(0),Zt(0),is(!1),We(0),gn(0),vn(0),$n(0),Fn(0),_n(0),Hn(0),jn(0),Nn(0),wn(0),la(0),Ea(0),hn(0),Ln(0),On(0),Bn(0);const y=Math.max(1,Math.floor(Number(Ma)||1));if(F(Yn==="first"?y:Math.max(1,Math.ceil(y/2))),Ka)try{Ya({mode:s,x01Start:n,firstTo:M,aiLevel:o})}catch{}}function Wo(){p(n),w(n),A(!1),oe(!0),mt(!0),ce(0),Nt(0),lt(0),Ee(0),Dn(n),Ss(0),Cs(0),ks(0),dn(0),un(0),Ts(0),T(null)}function xi(y){Ee(0),Dn(y===0?n:x),Cs(0),o!=="None"?(mt(!1),ks(xe)):mt(!1)}function Ia(y){const B=x-y,K=Ns+1;if(lt(y),Nt(ke=>ke+1),We(ke=>ke+1),B<0){if(p(Js),qn)try{Zn(t?.username||"Player",0,Math.max(Js,0),Cn,{volume:zn,checkoutOnly:Ys})}catch{}xi(Js),ce(0),Ss(0),Cs(0);return}p(B),Ee(K),Ss(ke=>ke+y),vn(ke=>ke+y),ce(0);const Z=x,ie=B,Ue=Z>50&&ie<=50,_e=Z<=50;if(Ue?Cs(1):_e&&Cs(ke=>ke+1),B===0){ws+y===180?Fn(Ne=>Ne+1):ws+y>=140?_n(Ne=>Ne+1):ws+y>=100&&Hn(Ne=>Ne+1);const ke=Js;if(ke<=170&&la(Ne=>Math.max(Ne,ke)),Z<=50&&(hn(Ne=>Ne+(cn>0?cn:1)),Ln(Ne=>Ne+1)),qn){const Ne=ws+y;try{Zn(t?.username||"Player",Ne,0,Cn,{volume:zn,checkoutOnly:Ys})}catch{}}T("player"),E(!0);return}if(K>=3){if(ws+y===180?Fn(ke=>ke+1):ws+y>=140?_n(ke=>ke+1):ws+y>=100&&Hn(ke=>ke+1),qn){const ke=ws+y;try{Zn(t?.username||"Player",ke,Math.max(B,0),Cn,{volume:zn,checkoutOnly:Ys})}catch{}}xi(B),Ss(0),Cs(0)}}function pi(){const y=ya(Math.round(Number(Me)||0),0,60);Ia(y)}function bi(y){const B=ya(Math.round(y||0),0,60);if(lt(B),Nt(K=>K+1),We(K=>K+1),ti(B,Le)){const K=ot+1;Kt(K),Xe(Z=>Math.min(20,Z+1)),K>=21&&(T("player"),E(!0))}ce(0)}function gi(){bi(Number(Me))}function yi(){const y=Gs(Lt);if(y==null){alert("Enter like D16, 50, 25, T20");return}bi(y),It("")}function vi(y,B,K){if(as)return;const Z=gt,ie=B==="DOUBLE"&&K===Z||!B&&y===Z*2;ie&&Yt(Ue=>Ue+1),nt(Ue=>{const _e=Ue+1;if(_e>=3){const ke=Ht+(ie?1:0);ke>0?st(Be=>Be+ke*Z*2):st(Be=>Be-Z*2);const Ne=Z+1;return Ze(Ne),Yt(0),Ne>20&&Ct(!0),0}return _e})}function ji(){vi(Math.max(0,Me|0)),ce(0)}function Ni(){Ze(1),st(27),nt(0),Yt(0),Ct(!1)}function Za(y){it(B=>B+Math.max(0,y|0)),Xt(B=>{const K=B+1;return K>=3?(at(Z=>Z+1),0):K})}function er(y){he(B=>B+Math.max(0,y|0)),At(B=>{const K=B+1;return K>=3?(Ps(Z=>Z+1),0):K})}function tr(y){ys(B=>B+Math.max(0,y|0)),rs(B=>{const K=B+1;return K>=3?(ds(Z=>Z+1),0):K})}function wi(y,B,K,Z,ie,Ue,_e,ke){const Ne=y-_e;if(!(Ne<0))if(Ne===0){if(ke==="DOUBLE"||ke==="INNER_BULL"){Ue(Be=>Be+1),ie(Be=>Be+1),Z(()=>0),B(y);return}}else B(Ne);Z(Be=>{const Ye=Be+1;return Ye>=3?(ie(Vt=>Vt+1),0):Ye})}function Si(y,B){wi(us,L,z,re,P,U,y,B),z+1>=3&&L(170)}function Ci(y,B){wi($,H,je,ne,Ce,vt,y,B),je+1>=3&&H(121)}function Da(y){const B=Gs(Lt);if(B==null){alert("Enter like T20, D16, 25, 50");return}const K=Lt.trim().toUpperCase(),Z=K.startsWith("D")||K==="50"||K==="BULL"||K==="DBULL"||K==="IBULL"||K.includes("INNER");y?Si(B,Z?"DOUBLE":void 0):Ci(B,Z?"DOUBLE":void 0),It("")}function qo(){L(170),re(0),P(0),U(0)}function zo(){H(121),ne(0),Ce(0),vt(0)}function sr(y,B,K){if(ft)return;(B==="TRIPLE"&&K===ht||!B&&y===ht*3)&&Gt(ie=>ie+1),Zt(ie=>{const Ue=ie+1;if(Ue%3===0&&[20,19,18].includes(ht)){const _e=[20,19,18],ke=_e.indexOf(ht),Ne=_e[(ke+1)%_e.length];wt(Ne)}return Mt>0&&Ue>=Mt&&is(!0),Ue})}function ki(){Gt(0),Zt(0),is(!1)}function Vo(y,B,K){xs(Z=>{const ie={...Z};return Do(ie,y,B,K),ie})}function Go(){xs(xa())}function Jo(y,B,K){Fs(Z=>{const ie={...Z};return Po(ie,y,B,K),ie})}function Ko(){Fs(pa())}function Yo(y,B,K,Z){os(ie=>{const Ue={...ie,board:[...ie.board]};return Ro(Ue,y,B,K,Z),Ue})}function Xo(){os(ai())}function Qo(y,B,K){Jt(Z=>{const ie={...Z,marks:{...Z.marks}};return Lo(ie,y,B,K,()=>!1),ie})}function Ei(){Jt(ga())}function nr(y,B,K){const Z=_t[Qe];let ie=!1;if(typeof K=="number"&&K===Z&&(B==="SINGLE"||B==="DOUBLE"||B==="TRIPLE")&&(ie=!0),Z===25&&(B==="BULL"||y===25)&&(ie=!0),Z===50&&(B==="INNER_BULL"||y===50)&&(ie=!0),ie||(y===Z||y===Z*2||y===Z*3)&&(ie=!0),ie){const Ue=Ae+1;le(Ue),ut(_e=>_e+1)}}function Ti(){nr(Math.max(0,Me|0)),ce(0)}function Mi(){const y=Gs(Lt);if(y==null){alert("Enter like T20, D5, 25, 50");return}nr(y),It("")}function Ii(y,B,K){te(Z=>{const ie={...Z,marks:{...Z.marks}};return wo(ie,y,B,K,()=>!1),ie}),Se(Z=>{const ie=Z+1;return ie>=3?0:ie})}function Di(){Ii(Math.max(0,Me|0)),ce(0)}function Ai(y,B,K){qe(Z=>{const ie={...Z,turnHits:{...Z.turnHits}};return So(ie,y,B,K),ie}),Se(Z=>{const ie=Z+1;return ie>=3?(qe(Ue=>{const _e={...Ue,turnHits:{...Ue.turnHits}};return Co(_e),_e}),0):ie})}function Pi(){Ai(Math.max(0,Me|0)),ce(0)}function Ri(y,B,K){ve(Z=>{const ie={...Z,targets:[...Z.targets]};return ko(ie,y,B,K),ie}),Se(Z=>{const ie=Z+1;return ie>=3?(ve(Ue=>{const _e={...Ue,targets:[...Ue.targets]};return Eo(_e),_e}),0):ie})}function Li(){Ri(Math.max(0,Me|0)),ce(0)}function Oi(y,B,K){ee(Z=>{const ie={...Z};return To(ie,y,B,K),ie}),Se(Z=>{const ie=Z+1;return ie>=3?(ee(Ue=>{const _e={...Ue};return Mo(_e),_e}),0):ie})}function Bi(){Oi(Math.max(0,Me|0)),ce(0)}function Ui(){const y=Lt.trim().toUpperCase();if(!y)return null;if(y==="50"||y==="BULL"||y==="DBULL"||y==="IBULL")return 50;if(y==="25"||y==="OBULL")return 25;const B=y.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!B)return null;const K=B[1]||"S",Z=parseInt(B[2],10);return Z<1||Z>20?null:Z*(K==="S"?1:K==="D"?2:3)}function ar(){const y=Ui();if(y==null){alert("Enter like T20, D16, 5, 25, 50");return}Ia(y),It("")}function Zo(){const y=Ks.trim().split(`
`).map(B=>B.trim()).filter(B=>B);if(y.length!==0){for(const B of y){const K=Gs(B);if(K==null){alert(`Invalid score: ${B}`);return}Ia(K)}Wn("")}}function ec(){Ns!==0&&(p(y=>y+St),Ee(y=>Math.max(0,y-1)))}function $i(){const y=Ui();if(y==null){alert("Enter like T20, D16, 5, 25, 50");return}if(Ns===0){ar();return}const B=St;p(K=>K+B),Ee(K=>Math.max(0,K-1)),setTimeout(()=>Ia(y),0),It("")}function tc(){const y=J??"player",B=y==="player"?cn||void 0:Pn||void 0;Ie([...ue,{winner:y,doubleDarts:W,checkoutDarts:Y,doublesAtt:B,doublesHit:1}]),E(!1);let Z=D,ie=b;if(J==="player"?Z+=1:J==="ai"&&(ie+=1),v(Z),_(ie),T(null),Z>=M||ie>=M){try{Gc(s,y==="player")}catch{}oe(!1),f(!1),p(n),w(n),zs(!0);return}Wo()}const rr=!$l.includes(s)&&!(t?.fullAccess||t?.admin);return e.jsxs("div",{className:"card relative overflow-hidden",children:[e.jsxs("h2",{className:"text-2xl font-bold text-brand-700 mb-4",children:["Offline Game Modes ",a==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsx("label",{className:"font-semibold",children:"Select game mode:"}),e.jsxs("select",{className:"input w-full",value:s,onChange:y=>r(y.target.value),children:[$l.map(y=>e.jsx("option",{value:y,children:y},y)),Nm.map(y=>e.jsxs("option",{value:y,disabled:!(t?.fullAccess||t?.admin),children:[y," ",t?.fullAccess||t?.admin?"":"(Premium)"]},y))]}),s==="Treble Practice"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"font-semibold",children:"Throws per game"}),e.jsx("input",{className:"input w-full",type:"number",min:3,step:3,value:Mt,onChange:y=>Rs(Math.max(3,Math.floor(Number(y.target.value)||30)))})]}),e.jsx("div",{className:"sm:col-span-2 text-xs text-slate-300",children:"Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws."})]}),!t?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),s==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:n,onChange:y=>i(Number(y.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{className:"input w-full",value:o,onChange:y=>l(y.target.value),children:[e.jsx("option",{value:"None",children:"None"}),wm.map(y=>e.jsx("option",{value:y,children:y},y))]}),o!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:xe/1e3,onChange:y=>bt(Math.round(Number(y.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>c(!0),children:"X01 Rules & Regulations!"})]}),s==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply."})]}),!u&&e.jsx("button",{className:"btn",disabled:rr,title:rr?"PREMIUM required for this mode":"",onClick:Xn,children:"Start Match"}),ge&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${O?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(rn,{storageKey:"ndn:modal:offline-match",className:`${O?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:O,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:ye?"hidden":"auto"},ref:y=>{Jn.current=y},children:[e.jsxs("div",{ref:y=>{Xa.current=y},className:"sticky top-0 relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[s,s==="X01"?` / ${n}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",M," Â· Legs ",D,"-",b]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${a==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:a==="modern"?"Modern layout":"Classic layout"})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>j(Math.max(.5,Math.round((h-.05)*100)/100)),title:"Decrease camera size",children:"âˆ’"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(h*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>j(Math.min(1.25,Math.round((h+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:ye?"Actual Size":"Fit All",onClick:()=>be(y=>!y),children:ye?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:O?"Restore":"Maximize",onClick:()=>se(y=>!y),children:O?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Xn()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{oe(!1),f(!1)},children:"Quit"})]})]}),e.jsxs("div",{ref:y=>{Kn.current=y},className:"will-change-transform",style:ye?{transform:`scale(${De})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,De))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:s==="X01"?"X01 Match":s}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",s]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",n]}),e.jsxs("div",{ref:Ho,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const y=x!==n||g!==n||Ns>0,B=`px-2 py-0.5 rounded border text-xs ${y?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${B} ${Yn==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{y||Qa("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${B} ${Yn==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{y||Qa("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${y?"opacity-50":""}`,type:"number",min:1,step:1,value:Ma,onChange:K=>fi(Math.max(1,Math.floor(Number(K.target.value)||1))),disabled:y,title:Yn==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",D,"â€“",b]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Match"}),e.jsxs("select",{className:`btn ${Xs}`,value:fs,onChange:y=>Ms(y.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${Xs} w-[7.5rem]`,value:Re,onChange:y=>Vn(y.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${Xs} w-[7.5rem]`,value:ca,onChange:y=>Gn(y.target.value),placeholder:"Team B"})]})]}),s!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[s==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Ds[Le]?.label||"â€”"})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[ot," / 21"]})]}),s==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:_t[Qe]===25?"25 (Outer Bull)":_t[Qe]===50?"50 (Inner Bull)":_t[Qe]||"â€”"})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Ae," / ",_t.length]})]}),s==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket â€” Close 20â€“15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:ja.map(y=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:y===25?"Bull":y}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,we.marks?.[y]||0)," / 3"]})]},y))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:we.points})]}),bm(we)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{te(Tn()),Se(0)},children:"Reset"})]})]}),s==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:X.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",X.score]}),X.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{qe(tn()),Se(0)},children:"Reset"})]})]}),s==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[Pe.stage+1,"/",Pe.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const y=Ha(Pe);return y?y.kind==="ANY_NUMBER"?"Any":y.kind==="BULL"?"Bull":y.kind==="DOUBLE"||y.kind==="TRIPLE"||y.kind==="NUMBER"?`${y.kind} ${y.num}`:"â€”":"â€”"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Pe.score]}),Pe.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ve(sn()),Se(0)},children:"Reset"})]})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",k.round," Â· Target ",k.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",k.score]}),k.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ee(nn()),Se(0)},children:"Reset"})]})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",gt]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Dt]}),as&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:Ni,children:"Reset"})]})]}),s==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Wt,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",gs]})]}),s==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",zt,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",G]})]}),s==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Pt,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Tt]})]}),s==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:us}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",me," Â· Successes: ",q]})]}),s==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:$}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",fe," Â· Successes: ",tt]})]}),s==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",ht]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",Bt]})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Rt.inning}),e.jsxs("div",{className:"text-sm",children:["Score: ",e.jsx("span",{className:"font-semibold",children:Rt.score})]})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ln.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes: ",e.jsx("span",{className:"font-semibold",children:ln.strokes})]})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ls.turn}),ls.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",ls.winner||"â€”"]})]}),s==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20â€“12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:Ga.map(y=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:y===25?"Bull":y}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,es.marks?.[y]||0)," / 3"]})]},y))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:es.points})]}),jm(es)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:Ei,children:"Reset"})]})]}),s==="Killer"&&e.jsx(e.Fragment,{children:Os?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:xt[ts]?.name||"â€”"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Je?`${xt.find(y=>y.id===Je)?.name||"Winner"} Wins`:$t||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):a==="modern"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-2 items-stretch",children:[e.jsxs("div",{className:"flex flex-col gap-2 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),Te?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:x}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-x/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:St})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:pt>0?((n-x)/pt*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",pt]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(y=>e.jsx("span",{className:`w-2 h-2 rounded-full ${y<Ns?"bg-emerald-400":"bg-white/20"}`},y))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",Rn," Â· Hit ",fn]})]}),x<=170&&x>0&&(()=>{const B=Fa(x,oa)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:B})]})})()]}),e.jsxs("div",{className:`${Fe==="small"?"p-2":Fe==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${V==="small"?"text-xs":V==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const y=Te?t?.username||"You":o==="None"?"â€”":`${o} AI`,B=Te?x:o==="None"?0:g,K=Te?St:mn,Z=Te?ws:Es,ie=Te?pt:Ft,Ue=n-(Te?x:o==="None"?n:g),_e=ie>0?Ue/ie*3:0,ke=`${D}-${b}`,Ne=ue.length>0?`${Math.min(...ue.map(Be=>Be.doubleDarts+(Be.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:ke}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:y}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:B}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:_e.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:Z||K}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:Ne})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[o==="None"?"Opponent":`${o} AI`," Remain"]}),Te?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:o!=="None"?g:"N/A"}),o!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-g/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:o==="None"?0:mn})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:o!=="None"?Ft>0?((n-g)/Ft*3).toFixed(1):"0.0":"â€”"})]}),o!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",Ft]}),o!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",xn," Â· Hit ",pn]})]})]})]}),e.jsx("div",{className:"md:col-span-2 min-w-0 space-y-2",children:Us?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${Xs}`,onClick:()=>j(Math.max(.5,Math.round((h-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${Xs} min-w-[2.5rem] text-center`,children:[Math.round(h*100),"%"]}),e.jsx("button",{className:`btn ${Xs}`,onClick:()=>j(Math.min(1.25,Math.round((h+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Xs}`,title:"Toggle fit/fill",onClick:()=>de(Q==="fill"?"fit":"fill"),children:Q==="fill"?"Fill":"Fit"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Xs}`,title:"Toggle camera aspect",onClick:()=>R(N==="square"?"wide":"square"),children:N==="square"?"Square":"Wide"})]})}),e.jsx("div",{className:"flex items-stretch justify-end min-w-0",children:e.jsx(ea,{storageKey:"ndn:camera:tile:offline:primary",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:720,defaultHeight:420,minWidth:320,minHeight:220,maxWidth:1600,maxHeight:900,children:e.jsx(_a,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic"})})})]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:1fr_1.2fr_1fr] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),Te?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:x}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-x/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:St})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:pt>0?((n-x)/pt*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",pt]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(y=>e.jsx("span",{className:`w-2 h-2 rounded-full ${y<Ns?"bg-emerald-400":"bg-white/20"}`},y))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",Rn," Â· Hit ",fn]})]}),x<=170&&x>0&&(()=>{const B=Fa(x,oa)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:B})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-end md:px-3 min-w-0",children:e.jsx(ea,{storageKey:"ndn:camera:tile:offline:center",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:720,defaultHeight:420,minWidth:320,minHeight:220,maxWidth:1600,maxHeight:900,children:e.jsx(_a,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic",fill:!0})})}),e.jsxs("div",{className:`mt-2 ${Fe==="small"?"p-2":Fe==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${V==="small"?"text-xs":V==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const y=Te?t?.username||"You":o==="None"?"â€”":`${o} AI`,B=Te?x:o==="None"?0:g,K=Te?St:mn,Z=Te?ws:Es,ie=Te?pt:Ft,Ue=n-(Te?x:o==="None"?n:g),_e=ie>0?Ue/ie*3:0,ke=`${D}-${b}`,Ne=ue.length>0?`${Math.min(...ue.map(Be=>Be.doubleDarts+(Be.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:ke}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:y}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:B}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:_e.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:Z||K}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:Ne})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[o==="None"?"Opponent":`${o} AI`," Remain"]}),Te?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:o!=="None"?g:"N/A"}),o!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-g/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:o==="None"?0:mn})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:o!=="None"?Ft>0?((n-g)/Ft*3).toFixed(1):"0.0":"â€”"})]}),o!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",Ft]}),o!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",xn," Â· Hit ",pn]})]})]})]})}),s!=="X01"?e.jsxs("div",{className:"space-y-2",children:[s==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Ds[Le]?.label||"â€”"})]}),ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,onAutoDart:(y,B)=>{if((B==="DOUBLE"||B==="INNER_BULL")&&ti(y,Le)){const Z=ot+1,ie=Le+1;Kt(Z),Xe(ie),Z>=Ds.length&&setTimeout(()=>{Kt(0),Xe(0)},250)}},immediateAutoCommit:!0})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&gi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:gi,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:Lt,onChange:y=>It(y.target.value),onKeyDown:y=>{y.key==="Enter"&&yi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:yi,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",ot," of 21"]})]}),s==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:_t[Qe]===25?"25 (Outer Bull)":_t[Qe]===50?"50 (Inner Bull)":_t[Qe]||"â€”"})]}),ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{nr(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&Ti()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ti,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:Lt,onChange:y=>It(y.target.value),onKeyDown:y=>{y.key==="Enter"&&Mi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Mi,children:"Add"})]}),Ae>=_t.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{le(0),ut(0)},children:"Reset"})]})]}),s==="Cricket"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{Ii(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&Di()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Di,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{te(Tn()),Se(0)},children:"Reset"})]})]}),s==="Shanghai"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{Ai(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&Pi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Pi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{qe(tn()),Se(0)},children:"Reset"})]})]}),s==="Halve It"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{Ri(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&Li()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Li,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ve(sn()),Se(0)},children:"Reset"})]})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{Oi(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&Bi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Bi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ee(nn()),Se(0)},children:"Reset"})]})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{vi(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&ji()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ji,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Ni,children:"Reset"})]})]}),s==="Count-Up"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:y=>Za(y)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&(Za(Me),ce(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Za(Me),ce(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{at(1),it(0),Xt(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Wt,"/",qt]})]}),s==="High Score"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:y=>er(y)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&(er(Me),ce(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{er(Me),ce(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ps(1),he(0),At(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",zt,"/",Et]})]}),s==="Low Score"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:y=>tr(y)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&(tr(Me),ce(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{tr(Me),ce(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ds(1),ys(0),rs(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Pt,"/",ms]})]}),s==="Checkout 170"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B)=>Si(y,B==="MISS"?void 0:B)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:Lt,onChange:y=>It(y.target.value),onKeyDown:y=>{y.key==="Enter"&&Da(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Da(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:qo,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",us," Â· Attempts: ",me," Â· Successes: ",q]})]}),s==="Checkout 121"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B)=>Ci(y,B==="MISS"?void 0:B)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:Lt,onChange:y=>It(y.target.value),onKeyDown:y=>{y.key==="Enter"&&Da(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Da(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:zo,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",$," Â· Attempts: ",fe," Â· Successes: ",tt]})]}),s==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("div",{className:"inline-flex items-center gap-1",children:[20,19,18].map(y=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${ht===y?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>wt(y),children:["T",y]},`tpick-${y}`))}),e.jsx("span",{className:"opacity-60 text-xs",children:"or"}),e.jsx("select",{className:"input w-24",value:ht,onChange:y=>wt(parseInt(y.target.value,10)),children:Array.from({length:20},(y,B)=>B+1).map(y=>e.jsx("option",{value:y,children:y},y))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ki,children:"Reset"})]}),ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{sr(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:Lt,onChange:y=>It(y.target.value),onKeyDown:y=>{if(y.key==="Enter"){const B=Gs(Lt);B!=null&&sr(B,void 0,void 0),It("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const y=Gs(Lt);y!=null&&sr(y,void 0,void 0),It("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",Bt," Â· Misses: ",Math.max(0,hs-Bt)," Â· Darts: ",hs,Mt>0?`/${Mt}`:""]}),ft&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:ki,children:"Reset"})]})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{Vo(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Go,children:"Reset"})})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{Jo(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Ko,children:"Reset"})})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(y,B)=>B).map(y=>e.jsx("button",{className:`h-16 rounded-xl border ${ls.board[y]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(ls.finished||ls.board[y])return;const B=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),K=B%3===0?"TRIPLE":B%2===0?"DOUBLE":"SINGLE",Z=y,ie=ba[Z],Ue=ie.type==="BULL"?null:ie.num||null;Yo(Z,B,K,Ue)},children:ls.board[y]||""},y))}),ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Xo,children:"Reset"})})]}),s==="American Cricket"&&e.jsxs(e.Fragment,{children:[ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{Qo(y,B==="MISS"?void 0:B,K?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Ei,children:"Reset"})})]}),s==="Killer"&&e.jsx(e.Fragment,{children:Os?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:xt.map(y=>{const B=Ls[y.id],K=Ut[y.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${B?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:y.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${B?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:B?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number: ",e.jsx("span",{className:"font-semibold",children:K})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:B?.lives??0})]})]},y.id)})}),ae&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(y,B,K)=>{if(Je)return;const Z=B==="MISS"?void 0:B,ie=K?.sector??null,Ue=xt[ts];Ue&&(js(_e=>{const ke={};Object.keys(_e).forEach(Ye=>ke[Ye]={..._e[Ye]});const Ne=si(Ue.id,ke,Z,ie);if(Ne.becameKiller)Ke(`${Ue.name} became a Killer`);else if(Ne.victimId){const Ye=xt.find(Vt=>Vt.id===Ne.victimId);Ke(`${Ue.name} hit ${Ye?.name}'s ${Ut[Ne.victimId]} (${Ne.livesRemoved} life${(Ne.livesRemoved||0)>1?"s":""})`)}else Ke("No effect");const Be=ni(ke);return Be&&$e(Be),ke}),Oe(_e=>{const ke=_e+1;if(ke>=3){let Ne=ts;for(let Be=1;Be<=xt.length;Be++){const Ye=(ts+Be)%xt.length,Vt=xt[Ye].id,Is=Ls[Vt];if(Is&&!Is.eliminated&&Is.lives>0){Ne=Ye;break}}return ss(Ne),0}return ke}))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:Lt,onChange:y=>It(y.target.value),onKeyDown:y=>{if(y.key==="Enter"){if(Je)return;const K=Lt.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!K){It("");return}const Z=K[1]||"S",ie=parseInt(K[2],10),Ue=Z==="D"?"DOUBLE":Z==="T"?"TRIPLE":"SINGLE",_e=xt[ts];js(ke=>{const Ne={};Object.keys(ke).forEach(Vt=>Ne[Vt]={...ke[Vt]});const Be=si(_e.id,Ne,Ue,ie);if(Be.becameKiller)Ke(`${_e.name} became a Killer`);else if(Be.victimId){const Vt=xt.find(Is=>Is.id===Be.victimId);Ke(`${_e.name} hit ${Vt?.name}'s ${Ut[Be.victimId]} (${Be.livesRemoved} life${(Be.livesRemoved||0)>1?"s":""})`)}else Ke("No effect");const Ye=ni(Ne);return Ye&&$e(Ye),Ne}),It(""),Oe(ke=>{const Ne=ke+1;if(Ne>=3){let Be=ts;for(let Ye=1;Ye<=xt.length;Ye++){const Vt=(ts+Ye)%xt.length,Is=xt[Vt].id,kn=Ls[Is];if(kn&&!kn.eliminated&&kn.lives>0){Be=Vt;break}}return ss(Be),0}return Ne})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let y=ts;for(let B=1;B<=xt.length;B++){const K=(ts+B)%xt.length,Z=xt[K].id,ie=Ls[Z];if(ie&&!ie.eliminated&&ie.lives>0){y=K;break}}ss(y),Oe(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{js({}),on({}),_s(!1),ss(0),Oe(0),$e(null),Ke("")},children:"Reset"})]}),Je&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner: ",xt.find(y=>y.id===Je)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{js({}),on({}),_s(!1),ss(0),Oe(0),$e(null),Ke("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:xt.map((y,B)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:y.name,onChange:K=>{const Z=K.target.value;Qt(ie=>ie.map((Ue,_e)=>_e===B?{...Ue,name:Z}:Ue))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Qt(K=>K.filter((Z,ie)=>ie!==B)),disabled:xt.length<=2,children:"Remove"})]},y.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Qt(y=>{const B=`p${y.length+1}`;return[...y,{id:B,name:`Player ${y.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(xt.length<2){alert("Need at least 2 players");return}const y=xt.map(Z=>Z.id),B=ym(y),K={};y.forEach(Z=>{K[Z]=Io(B[Z])}),on(B),js(K),ss(0),Oe(0),$e(null),Ke("Assigned numbers"),_s(!0)},children:"Assign Numbers & Start"})]})]})})]}):Te?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:Me,onChange:y=>ce(Number(y.target.value||0)),onKeyDown:y=>{y.key==="Enter"&&(y.shiftKey?ec():pi())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:pi,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:Lt,onChange:y=>It(y.target.value),onKeyDown:y=>{y.key==="Enter"&&(y.shiftKey?$i():ar())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:$i,disabled:Ns===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ar,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:Ks,onChange:y=>Wn(y.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Zo,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Wn(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add Â· Shift+Enter to Replace Last"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"font-semibold",children:[o==="None"?"Opponent":`${o} AI`," Turn"]}),o!=="None"?e.jsxs("div",{className:"text-sm text-slate-300",children:["Throwing in ",Math.ceil(An/1e3),"s..."]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>mt(!0),children:"Switch Back to You"})})]}),e.jsx("div",{className:"h-1"})]})]})})}),m&&e.jsx(Cm,{onClose:()=>c(!1)}),rr&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const B=await(await fetch(`${km}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t?.email})})).json();B.ok&&B.url?(window.location.href=B.url,B.development&&He("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):B.error==="STRIPE_NOT_CONFIGURED"?He("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):He("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{He("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â· ",to(so(),5)]})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(rn,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(y=>e.jsx("button",{className:`btn ${W===y?"bg-brand-600":""}`,onClick:()=>C(y),children:y},y))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(y=>e.jsx("button",{className:`btn ${Y===y?"bg-brand-600":""}`,onClick:()=>pe(y),children:y},y))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:tc,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{E(!1),Xn()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{E(!1),oe(!1),f(!1)},children:"Back to Menu"})]})]})}),Sn&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(rn,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[s," Â· ",n," start Â· First to ",M]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:D}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"3-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:bn>0?(yn/bn*3).toFixed(1):"0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"1-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:bn>0?(yn/bn).toFixed(2):"0.00"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180s"}),e.jsx("div",{className:"font-semibold",children:wa})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"140+"}),e.jsx("div",{className:"font-semibold",children:aa})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"100+"}),e.jsx("div",{className:"font-semibold",children:Sa})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"High Checkout"}),e.jsx("div",{className:"font-semibold",children:Ca||"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Att"}),e.jsx("div",{className:"font-semibold",children:Rn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Hit"}),e.jsx("div",{className:"font-semibold",children:fn})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[D," â€“ ",b]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:o==="None"?"Opponent":`${o} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:b}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"3-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:Un>0?(Na/Un*3).toFixed(1):"0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"1-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:Un>0?(Na/Un).toFixed(2):"0.00"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180s"}),e.jsx("div",{className:"font-semibold",children:ct})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"140+"}),e.jsx("div",{className:"font-semibold",children:ra})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"100+"}),e.jsx("div",{className:"font-semibold",children:ia})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"High Checkout"}),e.jsx("div",{className:"font-semibold",children:ka||"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Att"}),e.jsx("div",{className:"font-semibold",children:xn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Hit"}),e.jsx("div",{className:"font-semibold",children:pn})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ue.map((y,B)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${y.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",B+1,": ",y.winner==="player"?"You":o==="None"?"Opp":"AI"," Â· Dbl ",y.doubleDarts," Â· CO ",y.checkoutDarts]},B))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(pm,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>zs(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{zs(!1),Xn()},children:"Rematch"})]})]})}),ue.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:ue.map((y,B)=>e.jsxs("li",{children:["Leg ",B+1,": Double darts: ",y.doubleDarts,", Checkout darts: ",y.checkoutDarts]},B))})]})]})}const Oo="ndn:messages:inbox",Bo="ndn:messages:unread";function Tm(){try{const t=localStorage.getItem(Oo),a=t?JSON.parse(t):[],s=Number(localStorage.getItem(Bo)||"0")||0;return{inbox:Array.isArray(a)?a.filter(n=>n&&typeof n.id=="string").slice(0,200):[],unread:s}}catch{return{inbox:[],unread:0}}}function La(t,a){try{localStorage.setItem(Oo,JSON.stringify(t))}catch{}try{localStorage.setItem(Bo,String(a))}catch{}}const Fl=Tm(),ri=qs((t,a)=>({inbox:Fl.inbox,unread:Fl.unread,inGame:!1,setInGame:s=>t({inGame:s}),add:s=>t(r=>{const n=r.inbox.some(l=>l.id===s.id&&l.ts===s.ts),i=n?r.inbox:[s,...r.inbox].slice(0,200),o=r.unread+(n?0:1);return La(i,o),{inbox:i,unread:o}}),load:s=>t(r=>{const n=[...s].sort((i,o)=>o.ts-i.ts).slice(0,200);return La(n,r.unread),{inbox:n,unread:r.unread}}),markAllRead:()=>{const s=a();La(s.inbox,0),t({unread:0})},remove:s=>t(r=>{const n=r.inbox.filter(o=>o.id!==s),i=r.unread;return La(n,i),{inbox:n,unread:i}})})),Uo=[/\b(f+[\W_]*u+[\W_]*c+[\W_]*k+)\b/gi,/\b(s+[\W_]*h+[\W_]*i+[\W_]*t+)\b/gi,/\b(b+[\W_]*i+[\W_]*t+[\W_]*c+[\W_]*h+)\b/gi,/\b(a+[\W_]*s+[\W_]*s+[\W_]*h+[\W_]*o+[\W_]*l+[\W_]*e+)\b/gi,/\b(d+[\W_]*a+[\W_]*m+[\W_]*n+)\b/gi,/\b(c+[\W_]*r+[\W_]*a+[\W_]*p+)\b/gi,/\b(p+[\W_]*i+[\W_]*s+[\W_]*s+)\b/gi];function Mm(t){return t.replace(/[\p{L}\p{N}]/gu,"*")}function $o(t){if(!t)return t;let a=t;for(const s of Uo)a=a.replace(s,r=>Mm(r));return a}function Im(t){return t?Uo.some(a=>a.test(t)):!1}function Ja({tabs:t,active:a,onChange:s,className:r}){return e.jsxs("div",{className:`relative ${r||""}`,children:[e.jsx("div",{className:"absolute inset-0 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 pointer-events-none"}),e.jsx("div",{className:"relative overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx("div",{className:"flex items-center gap-2 min-w-max",children:t.map(n=>{const i=n.key===a;return e.jsx("button",{type:"button",onClick:()=>s(n.key),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98]
                  ${i?"bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white shadow-indigo-500/30":"bg-white/10 text-slate-100 hover:bg-white/15"}
                `,"aria-pressed":i,children:n.label},n.key)})})}),e.jsx("style",{children:`
        /* Hide scrollbars on WebKit/Firefox for a cleaner pill row */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})}function Dm(t){if(!t)return"";const a=Math.floor((Date.now()-t)/1e3);if(a<60)return`${a}s ago`;const s=Math.floor(a/60);if(s<60)return`${s}m ago`;const r=Math.floor(s/60);return r<24?`${r}h ago`:`${Math.floor(r/24)}d ago`}function Am({user:t}){const a=sa(),s=String(t?.email||"").toLowerCase(),[r,n]=d.useState([]),[i,o]=d.useState([]),[l,m]=d.useState([]),[c,u]=d.useState(""),[f,x]=d.useState("all"),[p,g]=d.useState(!1),w=ri(),[I,A]=d.useState([]),[S,E]=d.useState([]),[M,F]=d.useState({show:!1});async function D(){if(s)try{const[C,Y,pe,ue]=await Promise.all([fetch(`/api/friends/list?email=${encodeURIComponent(s)}`).then(Ie=>Ie.json()),fetch(`/api/friends/suggested?email=${encodeURIComponent(s)}`).then(Ie=>Ie.json()),fetch(`/api/friends/requests?email=${encodeURIComponent(s)}`).then(Ie=>Ie.json()),fetch(`/api/friends/outgoing?email=${encodeURIComponent(s)}`).then(Ie=>Ie.json())]);n(C.friends||[]),o(Y.suggestions||[]),A(pe.requests||[]),E(ue.requests||[])}catch{}}d.useEffect(()=>{D()},[s]);async function v(C){if(u(C),!C){m([]);return}try{const pe=await(await fetch(`/api/friends/search?q=${encodeURIComponent(C)}`)).json();m(pe.results||[])}catch{}}async function b(C){if(!(!s||!C)){g(!0);try{await fetch("/api/friends/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:C})}),await D(),u(""),m([]),a("Friend added",{type:"success"})}finally{g(!1)}}}async function _(C){if(!(!s||!C)){g(!0);try{await fetch("/api/friends/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:C})}),await D(),a("Friend removed",{type:"info"})}finally{g(!1)}}}const J=d.useMemo(()=>f==="all"?r:r.filter(C=>(C.status||"offline")===f),[r,f]);async function T(C){if(!C){a("Room unavailable",{type:"error"});return}try{const Y=new CustomEvent("ndn:spectate-request",{detail:{roomId:C}});window.dispatchEvent(Y),a("Opening spectator viewâ€¦",{type:"info"})}catch{}}const W=I.length+S.length;return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Friends"}),e.jsx("p",{className:"mb-2 text-brand-600",children:"Manage your friends. See whoâ€™s online, in-game, or offline; find new teammates; and invite people to play."}),e.jsxs("div",{className:"text-xs opacity-70 mb-3",children:["Online: ",r.filter(C=>C.status==="online").length," Â· In-game: ",r.filter(C=>C.status==="ingame").length," Â· Offline: ",r.filter(C=>!C.status||C.status==="offline").length]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"md:col-span-2 p-3 rounded-2xl bg-black/30 border border-white/10",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"font-semibold text-white/90",children:"Your Friends"})}),e.jsx(Ja,{tabs:[{key:"all",label:"All"},{key:"online",label:"Online"},{key:"ingame",label:"In-Game"},{key:"offline",label:"Offline"},{key:"requests",label:`Requests ${W>0?"("+W+")":""}`}],active:f,onChange:C=>x(C),className:"mb-3"}),f==="requests"?e.jsx("ul",{className:"space-y-2",children:W>0?e.jsxs(e.Fragment,{children:[I.length>0&&I.map(C=>e.jsxs("li",{className:"p-3 rounded bg-black/20 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:C.fromUsername||C.fromEmail||"Unknown User"}),e.jsx("span",{className:"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded",children:"Incoming"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{g(!0);try{if((await fetch("/api/friends/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requester:C.fromEmail})})).ok){A(ue=>ue.filter(Ie=>Ie.id!==C.id));const pe={email:C.fromEmail,username:C.fromUsername,status:"offline"};n(ue=>[...ue,pe]),E(ue=>ue.filter(Ie=>Ie.toEmail!==C.fromEmail)),a("Friend request accepted",{type:"success"}),setTimeout(()=>D(),100)}else a("Failed to accept request",{type:"error"})}catch{a("Error accepting request",{type:"error"})}finally{g(!1)}},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:async()=>{g(!0);try{(await fetch("/api/friends/decline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requester:C.fromEmail})})).ok?(A(pe=>pe.filter(ue=>ue.id!==C.id)),E(pe=>pe.filter(ue=>ue.toEmail!==C.fromEmail)),a("Friend request declined",{type:"info"}),setTimeout(()=>D(),100)):a("Failed to decline request",{type:"error"})}finally{g(!1)}},children:"Decline"})]})]},`incoming-${C.id||C.fromEmail}`)),S.length>0&&S.map(C=>e.jsxs("li",{className:"p-3 rounded bg-black/20 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:C.toUsername||C.toEmail||"Unknown User"}),e.jsx("span",{className:"text-xs bg-amber-600/20 text-amber-400 px-2 py-1 rounded",children:"Pending"})]}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 self-start",onClick:async()=>{g(!0);try{(await fetch("/api/friends/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:C.toEmail})})).ok?(E(pe=>pe.filter(ue=>ue.id!==C.id)),a("Friend request cancelled",{type:"info"}),setTimeout(()=>D(),100)):a("Failed to cancel request",{type:"error"})}finally{g(!1)}},children:"Cancel"})]},`outgoing-${C.id||C.toEmail}`))]}):e.jsx("li",{className:"text-sm opacity-70",children:"No friend requests yet."})}):e.jsxs("ul",{className:"space-y-2",children:[J.map(C=>e.jsxs("li",{className:"p-2 rounded bg-black/20 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${C.status==="online"?"bg-emerald-400":C.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{className:"font-semibold",children:C.username||C.email}),e.jsxs("span",{className:"text-xs opacity-70",children:[C.status||"offline",C.status!=="online"&&C.lastSeen?` Â· ${Dm(C.lastSeen)}`:""]}),C.status==="ingame"&&C.match&&e.jsxs("span",{className:"text-[10px] opacity-70 px-2 py-0.5 rounded bg-indigo-500/20 border border-indigo-600/30",children:[C.match.game," ",C.match.mode==="firstto"?"FT":"BO"," ",C.match.value,C.match.game==="X01"&&C.match.startingScore?` Â· ${C.match.startingScore}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[C.status==="ingame"&&C.roomId&&e.jsx("button",{className:"btn",onClick:()=>T(C.roomId),children:"Spectate"}),e.jsx("button",{className:"btn",disabled:p||C.status!=="online"&&C.status!=="ingame",onClick:async()=>{g(!0);try{(await(await fetch("/api/friends/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:C.email,game:"X01",mode:"bestof",value:3,startingScore:501})})).json().catch(()=>({})))?.delivered?a("Invite sent",{type:"success"}):a("Friend is offline; invite queued",{type:"info"})}finally{g(!1)}},children:"Invite"}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>F({show:!0,toUser:C.username||C.email,toEmail:C.email}),children:"Message"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:p,onClick:()=>_(C.email),children:"Remove"})]})]},C.email)),J.length===0&&e.jsxs("li",{className:"text-sm opacity-70",children:["No friends ",f!=="all"?`in ${f}`:""," yet."]})]})]}),e.jsxs("div",{className:"p-3 rounded-2xl bg-black/20 border border-white/10",children:[e.jsx("div",{className:"font-semibold mb-2 text-white/90",children:"Find Friends"}),e.jsx("input",{className:"input w-full mb-2",placeholder:"Search by name or email",value:c,onChange:C=>v(C.target.value)}),e.jsxs("ul",{className:"space-y-1 mb-3 max-h-48 overflow-auto",children:[l.map(C=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${C.status==="online"?"bg-emerald-400":C.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{children:C.username||C.email})]}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>b(C.email),children:"Add"})]},C.email)),l.length===0&&e.jsx("li",{className:"text-xs opacity-60",children:"Type to searchâ€¦"})]}),e.jsx("div",{className:"font-semibold mb-1 text-white/90",children:"Suggested"}),e.jsxs("ul",{className:"space-y-1 max-h-48 overflow-auto",children:[i.map(C=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${C.status==="online"?"bg-emerald-400":C.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{children:C.username||C.email})]}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>b(C.email),children:"Add"})]},C.email)),i.length===0&&e.jsx("li",{className:"text-xs opacity-60",children:"No suggestions right now."})]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>w.markAllRead(),children:"Mark all read"})]}),w.inbox.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No messages yet."}):e.jsx("ul",{className:"space-y-2 max-h-72 overflow-auto",children:w.inbox.map(C=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:C.from})," ",e.jsxs("span",{className:"opacity-70 text-xs",children:["Â· ",new Date(C.ts).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:()=>F({show:!0,toUser:C.from,toEmail:C.from,replyTo:C.from}),children:"Reply"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-2 py-1 text-xs",title:"Delete this message",onClick:()=>w.remove(C.id),children:"Delete"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-2 py-1 text-xs",onClick:async()=>{const Y=prompt("Report reason (what happened)?");if(Y)try{await fetch("/api/friends/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reporterEmail:s,offenderEmail:C.from,reason:Y,messageId:C.id})}),a("Report sent to admin",{type:"info"})}catch{}},children:"Report"})]})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap break-words",children:$o(C.message)})]},C.id))})]}),M.show&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("div",{className:"text-center mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Type Message To ",M.toUser]})}),e.jsx("textarea",{className:"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none",placeholder:"Type your message here...",id:"message-input",autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{className:"flex-1 btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const Y=document.getElementById("message-input")?.value?.trim();if(Y){g(!0);try{await fetch("/api/friends/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:M.toEmail,message:Y})}),a("Message sent",{type:"success"}),F({show:!1})}catch{a("Failed to send message",{type:"error"})}finally{g(!1)}}},disabled:p,children:"Send"}),e.jsx("button",{className:"flex-1 btn bg-slate-600 hover:bg-slate-700",onClick:()=>F({show:!1}),children:"Cancel"})]})]})})]})}function Pm(){const t=Xr(s=>s.toasts),a=Xr(s=>s.remove);return t.length?e.jsxs(e.Fragment,{children:[t.filter(s=>s.type==="success").map(s=>e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50",children:e.jsx("div",{className:"p-4 rounded-lg shadow-lg border text-sm bg-emerald-700/90 border-emerald-500/60 text-white max-w-sm text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("span",{className:"flex-1 font-semibold",children:s.message})})})},s.id)),t.filter(s=>s.type!=="success").length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 sm:right-4 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 w-[calc(100%-1.5rem)] sm:w-auto max-w-sm",children:t.filter(s=>s.type!=="success").map(s=>e.jsx("div",{className:`p-3 rounded-lg shadow-lg border text-sm ${s.type==="error"?"bg-rose-700/80 border-rose-500/60 text-white":"bg-black/70 border-slate-700 text-slate-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>a(s.id),children:"Dismiss"})]})},s.id))})]}):null}function ii({data:t,height:a=220,barWidth:s=28,gap:r=6,showValues:n=!1}){const i=Math.max(1,...t.map(l=>l.value)),o=t.length*(s+r);return e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"relative",style:{height:a,width:Math.max(600,o)},children:e.jsx("div",{className:"absolute inset-0 flex items-end",children:t.map((l,m)=>{const c=Math.round(l.value/i*(a-40));return e.jsxs("div",{className:"flex flex-col items-center justify-end",style:{width:s,marginRight:r},children:[e.jsx("div",{className:"w-full rounded-t-md bg-gradient-to-b from-indigo-400 to-fuchsia-500 shadow-sm",style:{height:c},title:`${l.label}: ${l.value}`}),n&&e.jsx("div",{className:"text-[10px] mt-1 opacity-80",children:l.value}),e.jsx("div",{className:"text-[10px] mt-1 opacity-70 select-none",children:l.label})]},m)})})})})}const Rm=["X01","Double Practice"],Zs=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice","Baseball","Golf","Tic Tac Toe","American Cricket"],ta=[...Rm,...Zs],Lm="daviesfamily108@gmail.com";function Om({user:t}){const[a,s]=d.useState([]),[r,n]=d.useState(""),[i,o]=d.useState(null),[l,m]=d.useState(""),[c,u]=d.useState(!1),[f,x]=d.useState([]),[p,g]=d.useState([]),[w,I]=d.useState(""),[A,S]=d.useState([]),[E,M]=d.useState({title:"Official Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:30,capacity:16,prizeType:"premium",prizeAmount:3,currency:"GBP",prizeNotes:""}),[F,D]=d.useState({reset:{},reminder:{},confirmEmail:{},changed:{}}),[v,b]=d.useState({open:!1}),[_,J]=d.useState("general"),T=t?.email?.toLowerCase()===Lm,[W,C]=d.useState([]),[Y,pe]=d.useState([]),[ue,Ie]=d.useState([]),[xe,bt]=d.useState(null),[He,ge]=d.useState(0);d.useEffect(()=>{const k=()=>ge(ee=>ee+1);return window.addEventListener("ndn:stats-updated",k),()=>window.removeEventListener("ndn:stats-updated",k)},[]);const oe=d.useMemo(()=>oi(ta),[He]),O=d.useMemo(()=>ta.map(k=>({label:k,value:oe[k]?.played||0,won:oe[k]?.won||0})),[oe]);async function se(){try{const ee=await(await fetch("/api/admins")).json();if(s(Array.isArray(ee.admins)?ee.admins:[]),T){const et=await fetch(`/api/admin/status?requesterEmail=${encodeURIComponent(t?.email||"")}`);et.ok&&o(await et.json());const Se=await fetch(`/api/admin/tournaments?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Se.ok){const st=await Se.json();x(Array.isArray(st.tournaments)?st.tournaments:[])}const gt=await fetch(`/api/admin/reports?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(gt.ok){const st=await gt.json();pe(Array.isArray(st.reports)?st.reports:[])}const Ze=await fetch(`/api/admin/premium-winners?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Ze.ok){const st=await Ze.json();C(Array.isArray(st.winners)?st.winners:[])}const Dt=await fetch(`/api/admin/wallet/withdrawals?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Dt.ok){const st=await Dt.json();g(Array.isArray(st.withdrawals)?st.withdrawals:[])}}}catch{}}d.useEffect(()=>{se()},[]);async function ye(){r&&(await fetch("/api/admins/grant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,requesterEmail:t?.email})}),n(""),se())}async function be(k){await fetch("/api/admins/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:k,requesterEmail:t?.email})}),se()}async function De(k,ee){k&&(await fetch("/api/admin/premium/grant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:k,days:ee,requesterEmail:t?.email})}),await se())}async function Ge(k){await fetch("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:k,requesterEmail:t?.email})}),await se()}async function Te(k){u(!0);try{await fetch("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:k,requesterEmail:t?.email})}),await se()}finally{u(!1)}}async function mt(){if(l.trim()){u(!0);try{await fetch("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:l,requesterEmail:t?.email})}),m(""),await se()}finally{u(!1)}}}async function Me(){if(w.trim())try{const k=await fetch(`/api/admin/users/search?q=${encodeURIComponent(w)}&requesterEmail=${encodeURIComponent(t?.email||"")}`);if(k.ok){const ee=await k.json();S(Array.isArray(ee.users)?ee.users:[])}}catch(k){console.error("Search failed:",k)}}async function ce(k){try{await fetch("/api/admin/users/ban",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:k,requesterEmail:t?.email})}),await Me()}catch(ee){console.error("Ban failed:",ee)}}async function Le(k){try{await fetch("/api/admin/users/unban",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:k,requesterEmail:t?.email})}),await Me()}catch(ee){console.error("Unban failed:",ee)}}async function Xe(){u(!0);try{const k=new Date(E.startAt).getTime();await fetch("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:E.title,game:E.game,mode:E.mode,value:Number(E.value),description:E.description,startAt:k,checkinMinutes:Number(E.checkinMinutes),capacity:Number(E.capacity),creatorEmail:t?.email,creatorName:t?.username,requesterEmail:t?.email,official:!0,prizeType:E.prizeType,prizeAmount:Number(E.prizeAmount||0),currency:E.currency,prizeNotes:E.prizeNotes})}),await se()}finally{u(!1)}}async function ot(k,ee){u(!0);try{await fetch("/api/admin/tournaments/winner",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:k,winnerEmail:ee,requesterEmail:t?.email})}),await se()}finally{u(!1)}}async function Kt(k){u(!0);try{await fetch("/api/admin/tournaments/mark-paid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:k,requesterEmail:t?.email})}),await se()}finally{u(!1)}}async function Qe(k){u(!0);try{await fetch("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:k,requesterEmail:t?.email})}),await se()}finally{u(!1)}}async function ut(){u(!0);try{await fetch("/api/admin/tournaments/reseed-weekly",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requesterEmail:t?.email})}),await se()}finally{u(!1)}}async function Ae(k,ee){u(!0);try{await fetch("/api/admin/wallet/withdrawals/decide",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:k,approve:ee,requesterEmail:t?.email})}),await se()}finally{u(!1)}}async function le(k){u(!0);try{await fetch("/api/admin/matches/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matchId:k,requesterEmail:t?.email})}),await se()}finally{u(!1)}}async function we(){try{const k=await fetch(`/api/admin/logs?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(k.ok){const ee=await k.json();ee?.ok&&Ie(ee.logs||[])}}catch(k){console.error("Failed to fetch logs:",k)}}async function te(){try{const k=await fetch(`/api/admin/system-health?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(k.ok){const ee=await k.json();ee?.ok&&bt(ee.health)}}catch(k){console.error("Failed to fetch system health:",k)}}async function X(){try{const k=await fetch(`/api/admin/email-copy?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(k.ok){const ee=await k.json();ee?.ok&&D(ee.copy||F)}}catch{}}d.useEffect(()=>{T&&X()},[T]),d.useEffect(()=>{T&&(_==="general"||_==="maintenance")&&(we(),te())},[T,_]);async function qe(k,ee){await fetch("/api/admin/email-copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requesterEmail:t?.email,kind:k,...ee})}),await X()}async function Pe(k){try{const et=await(await fetch(`/api/email/preview?kind=${encodeURIComponent(k)}&requesterEmail=${encodeURIComponent(t?.email||"")}`)).text();b({open:!0,kind:k,html:et})}catch{b({open:!0,kind:k,html:'<!doctype html><html><body style="font-family:sans-serif;padding:16px">Failed to load preview.</body></html>'})}}d.useEffect(()=>{if(!v.open)return;function k(ee){ee.key==="Escape"&&b({open:!1})}return document.addEventListener("keydown",k),()=>document.removeEventListener("keydown",k)},[v.open]);function ve({kind:k,label:ee}){const Se=F?.[k==="confirm-email"?"confirmEmail":k==="changed"?"changed":k]||{title:"",intro:"",buttonLabel:""},[gt,Ze]=d.useState(Se.title||""),[Dt,st]=d.useState(Se.intro||""),[cs,nt]=d.useState(Se.buttonLabel||"");return d.useEffect(()=>{Ze(Se.title||""),st(Se.intro||""),nt(Se.buttonLabel||"")},[Se.title,Se.intro,Se.buttonLabel]),e.jsxs("div",{className:"p-2 rounded bg-black/20 space-y-2",children:[e.jsx("div",{className:"font-semibold",children:ee}),e.jsx("input",{className:"input w-full",placeholder:"Title (optional)",value:gt,onChange:Ht=>Ze(Ht.target.value)}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Intro line (optional)",value:Dt,onChange:Ht=>st(Ht.target.value)}),e.jsx("input",{className:"input w-full",placeholder:"Button label (optional)",value:cs,onChange:Ht=>nt(Ht.target.value)}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("a",{className:"btn",href:`/api/email/preview?kind=${encodeURIComponent(k)}&requesterEmail=${encodeURIComponent(t?.email||"")}`,target:"_blank",rel:"noreferrer",children:"Preview"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>Pe(k),children:"Popup"}),e.jsx("button",{className:"btn",onClick:()=>qe(k,{title:gt,intro:Dt,buttonLabel:cs}),children:"Save"})]})]})}return T?e.jsxs("div",{className:"space-y-4",children:[T&&e.jsx(Ja,{tabs:[{key:"general",label:"General"},{key:"maintenance",label:"Maintenance"},{key:"premium",label:"Premium"}],active:_,onChange:k=>J(k),className:"mb-4"}),_==="general"&&e.jsxs(e.Fragment,{children:[T&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Game Usage"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Bar height shows total plays per mode. Wins are listed under each label. This helps decide which modes to keep or iterate on."}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(ii,{data:O.map(k=>({label:k.label,value:k.value}))}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:O.map((k,ee)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:k.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",k.value," Â· Won ",k.won]})]},ee))})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Admin to trusted users. Only the owner can perform these actions."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:r,onChange:k=>n(k.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:ye,children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>be(r),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Current Admins:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:a.map(k=>e.jsx("div",{className:"px-2 py-1 rounded bg-indigo-600/20 border border-indigo-500/40 text-sm",children:k},k))}),e.jsx("hr",{className:"border-indigo-500/20 my-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Premium Access Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Premium subscription access to users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:r,onChange:k=>n(k.target.value)}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c||!r.trim(),onClick:()=>De(r,30),children:"Grant Premium"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>Ge(r),children:"Revoke Premium"})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Premium grants provide 30 days of unlimited access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tournament Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Users who have won premium prizes in tournaments and need access granted."}),e.jsxs("div",{className:"space-y-2",children:[f.filter(k=>k.status==="completed"&&k.winnerEmail&&k.prizeType==="premium").map(k=>{const ee=W.find(Se=>Se.email===k.winnerEmail),et=ee&&!ee.expired;return e.jsxs("div",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:k.title}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(k.startAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:k.winnerEmail}),e.jsxs("div",{className:"text-xs opacity-70",children:["Prize: ",k.prizeAmount," month",k.prizeAmount>1?"s":""," PREMIUM"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:et?e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Access Granted"}):e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-xs",disabled:c,onClick:()=>De(k.winnerEmail,k.prizeAmount*30*24*60*60*1e3),children:"Grant Access"})})]})]},k.id)}),f.filter(k=>k.status==="completed"&&k.winnerEmail&&k.prizeType==="premium").length===0&&e.jsx("div",{className:"text-center py-4 text-sm opacity-60",children:"No completed premium tournaments."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Announcements"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Send a message to all users. This will appear as a toast notification."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Announcement message...",value:l,onChange:k=>m(k.target.value)}),e.jsx("button",{className:"btn",disabled:c||!l.trim(),onClick:mt,children:"Send"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Search"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Search for users by email or name."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"Search users...",value:w,onChange:k=>I(k.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:Me,children:"Search"})]}),A.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),A.map(k=>e.jsx("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:k.name||"No name"}),e.jsx("div",{className:"opacity-70",children:k.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(k.createdAt).toLocaleDateString()]})]})},k.email))]})]}),T&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Tournaments Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Create Official"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"input w-full",placeholder:"Title",value:E.title,onChange:k=>M(ee=>({...ee,title:k.target.value}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("select",{className:"input",value:E.game,onChange:k=>M(ee=>({...ee,game:k.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low"].map(k=>e.jsx("option",{value:k,children:k},k))}),e.jsxs("select",{className:"input",value:E.mode,onChange:k=>M(ee=>({...ee,mode:k.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]}),e.jsx("input",{className:"input",type:"number",min:1,value:E.value,onChange:k=>M(ee=>({...ee,value:Number(k.target.value)}))})]}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Description",value:E.description,onChange:k=>M(ee=>({...ee,description:k.target.value}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"input",type:"datetime-local",value:E.startAt,onChange:k=>M(ee=>({...ee,startAt:k.target.value}))}),e.jsx("input",{className:"input",type:"number",min:0,value:E.checkinMinutes,onChange:k=>M(ee=>({...ee,checkinMinutes:Number(k.target.value)}))})]}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,value:E.capacity,onChange:k=>M(ee=>({...ee,capacity:Number(k.target.value)}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[e.jsxs("select",{className:"input",value:E.prizeType,onChange:k=>{const ee=k.target.value;M(et=>({...et,prizeType:ee,prizeAmount:ee==="premium"?3:0}))},children:[e.jsx("option",{value:"premium",children:"PREMIUM"}),e.jsx("option",{value:"cash",children:"Cash"})]}),E.prizeType==="premium"?e.jsxs("select",{className:"input",value:E.prizeAmount,onChange:k=>M(ee=>({...ee,prizeAmount:Number(k.target.value)})),children:[e.jsx("option",{value:1,children:"1 month"}),e.jsx("option",{value:3,children:"3 months"})]}):e.jsx("input",{className:"input",type:"number",min:0,value:E.prizeAmount,onChange:k=>M(ee=>({...ee,prizeAmount:Number(k.target.value)}))}),e.jsxs("select",{className:"input",disabled:E.prizeType!=="cash",value:E.currency,onChange:k=>M(ee=>({...ee,currency:k.target.value})),children:[e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"CAD",children:"CAD"}),e.jsx("option",{value:"AUD",children:"AUD"})]})]}),e.jsx("input",{className:"input w-full",placeholder:"Prize notes (optional)",value:E.prizeNotes,onChange:k=>M(ee=>({...ee,prizeNotes:k.target.value}))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn",disabled:c,onClick:Xe,children:"Create"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Existing"}),e.jsxs("ul",{className:"space-y-2",children:[f.map(k=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:k.title}),e.jsx("div",{className:"opacity-70",children:k.status})]}),e.jsxs("div",{className:"opacity-80",children:[k.game," Â· ",k.mode==="firstto"?"FT":"BO"," ",k.value," Â· ",new Date(k.startAt).toLocaleString()," Â· ",k.capacity," cap"]}),k.prize&&e.jsxs("div",{className:"text-xs mt-1",children:["Prize: ",k.prizeType==="cash"&&k.prizeAmount?`${k.currency||"USD"} ${k.prizeAmount}`:`${k.prizeAmount||3} month${(k.prizeAmount||3)>1?"s":""} PREMIUM`," ",k.prizeType==="cash"&&k.status==="completed"&&k.payoutStatus&&e.jsx("span",{className:`ml-2 px-1.5 py-0.5 rounded ${k.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:k.payoutStatus})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:c||k.status!=="scheduled",onClick:()=>ot(k.id,prompt("Winner email?")||""),children:"Set Winner"}),k.prizeType==="cash"&&k.status==="completed"&&k.payoutStatus!=="paid"&&e.jsx("button",{className:"btn",disabled:c,onClick:()=>Kt(k.id),children:"Mark Paid"})]})]},k.id)),f.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{className:"btn",disabled:c,onClick:ut,children:"Reseed Weekly Giveaway"})})]})]})]}),T&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Email Templates"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Customize titles, intro lines, and button text. Previews open in a new tab or as a popup."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(ve,{kind:"reset",label:"Password reset"}),e.jsx(ve,{kind:"reminder",label:"Password reset reminder"}),e.jsx(ve,{kind:"confirm-email",label:"Confirm new email"}),e.jsx(ve,{kind:"changed",label:"Password changed notice"})]})]})]}),_==="maintenance"&&T&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Management"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Ban or unban users. Use with caution."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:w,onChange:k=>I(k.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:Me,children:"Search"})]}),A.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),A.map(k=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:k.name||"No name"}),e.jsx("div",{className:"opacity-70",children:k.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(k.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",onClick:()=>ce(k.email),children:"Ban"}),e.jsx("button",{className:"btn bg-green-600 hover:bg-green-700 text-xs",onClick:()=>Le(k.email),children:"Unban"})]})]},k.email))]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Withdrawals"}),e.jsxs("ul",{className:"space-y-2",children:[p.map(k=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:k.id}),e.jsxs("div",{children:[k.email," Â· ",k.currency," ",(k.amountCents/100).toFixed(2)]}),e.jsxs("div",{className:"opacity-70",children:[k.status," Â· ",new Date(k.requestedAt).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2",children:k.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c,onClick:()=>Ae(k.id,!0),children:"Approve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>Ae(k.id,!1),children:"Reject"})]})})]},k.id)),p.length===0&&e.jsx("li",{className:"opacity-60",children:"No withdrawal requests."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),xe?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${xe.database?"bg-emerald-600":"bg-red-600"}`,children:xe.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${xe.websocket?"bg-emerald-600":"bg-red-600"}`,children:xe.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${xe.https?"bg-emerald-600":"bg-amber-600"}`,children:xe.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${xe.maintenance?"bg-red-600":"bg-emerald-600"}`,children:xe.maintenance?"Active":"Normal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(xe.uptime/3600),"h ",Math.floor(xe.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",Math.round(xe.memory.heapUsed/1024/1024),"MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",xe.version]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:te,children:"Refresh"})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:te,children:"Load Health Status"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"User Reports"}),e.jsxs("ul",{className:"space-y-2",children:[Y.map(k=>e.jsx("li",{className:"p-2 rounded bg-black/20 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:k.id}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:k.reporter})," â†’ ",e.jsx("span",{className:"font-semibold",children:k.offender})," Â· ",new Date(k.ts).toLocaleString()]}),e.jsxs("div",{className:"opacity-80",children:["Reason: ",k.reason]}),k.messageId&&e.jsxs("div",{className:"opacity-60 text-xs",children:["Message ID: ",k.messageId]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${k.status==="open"?"bg-amber-600":"bg-emerald-600"}`,children:k.status}),k.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c,onClick:async()=>{await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:k.id,action:"resolved",requesterEmail:t?.email})}),await se()},children:"Resolve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:async()=>{const ee=prompt("Enter notes for action taken (e.g., warning, block):")||"";await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:k.id,action:"actioned",notes:ee,requesterEmail:t?.email})}),await se()},children:"Action"})]})]})]})},k.id)),Y.length===0&&e.jsx("li",{className:"opacity-60",children:"No reports."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),xe?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${xe.database?"bg-emerald-600":"bg-red-600"}`,children:xe.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${xe.websocket?"bg-emerald-600":"bg-red-600"}`,children:xe.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${xe.https?"bg-emerald-600":"bg-amber-600"}`,children:xe.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${xe.maintenance?"bg-red-600":"bg-emerald-600"}`,children:xe.maintenance?"Active":"Normal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(xe.uptime/3600),"h ",Math.floor(xe.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",Math.round(xe.memory.heapUsed/1024/1024),"MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",xe.version]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:te,children:"Refresh"})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:te,children:"Load Health Status"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Open Matches"}),e.jsxs("ul",{className:"space-y-1",children:[(i?.matches||[]).map(k=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs",children:k.id}),e.jsx("span",{className:"opacity-80",children:k.creatorName}),e.jsxs("span",{className:"opacity-60",children:[k.game," ",k.mode==="firstto"?"FT":"BO"," ",k.value," ",k.game==="X01"?`/${k.startingScore}`:""]})]}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>le(k.id),children:"Remove"})]},k.id)),(!i?.matches||i.matches.length===0)&&e.jsx("li",{className:"text-sm opacity-60",children:"No open matches."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Dangerous Operations"}),e.jsx("div",{className:"text-sm opacity-80 mb-3 text-red-400",children:"âš ï¸ These operations can cause data loss or service disruption. Use with extreme caution."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"Tournament Deletion"}),e.jsxs("ul",{className:"space-y-2",children:[f.map(k=>e.jsxs("li",{className:"p-2 rounded bg-red-900/20 border border-red-500/40 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:k.title}),e.jsx("div",{className:"opacity-70",children:k.status})]}),e.jsxs("div",{className:"opacity-80",children:[k.game," Â· ",k.mode==="firstto"?"FT":"BO"," ",k.value]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",disabled:c,onClick:()=>Qe(k.id),children:"Delete Tournament"})})]},k.id)),f.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"System Maintenance"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"p-3 rounded bg-red-900/20 border border-red-500/40",children:[e.jsx("div",{className:"font-semibold text-red-400 mb-2",children:"Maintenance Mode"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Put the entire site into maintenance mode. Users won't be able to access games or create matches."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${i?.maintenance?"bg-red-600":"bg-green-600"}`,children:i?.maintenance?"MAINTENANCE ACTIVE":"NORMAL OPERATION"}),e.jsx("button",{className:`btn ${i?.maintenance?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:c,onClick:()=>Te(!i?.maintenance),children:i?.maintenance?"Disable":"Enable"})]})]})})]})]})]})]}),_==="premium"&&T&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Subscription Grants"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke premium subscriptions for users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:r,onChange:k=>n(k.target.value)}),e.jsx("button",{className:"btn",disabled:c||!r.trim(),onClick:()=>De(r,30),children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>Ge(r),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Premium users get 30 days of access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Users who have won premium through tournaments."}),e.jsxs("div",{className:"space-y-2",children:[W.map(k=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:k.name||"No name"}),e.jsx("div",{className:"opacity-70",children:k.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Expires ",new Date(k.expiresAt).toLocaleDateString()]})]}),e.jsx("div",{className:"flex gap-2",children:k.expired?e.jsx("span",{className:"px-2 py-1 rounded bg-amber-600 text-xs",children:"Premium Expired"}):e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Premium Active"})})]},k.email)),W.length===0&&e.jsx("div",{className:"opacity-60",children:"No premium winners."})]})]})]}),v.open&&e.jsxs("div",{className:"fixed inset-0 z-[1000]",onClick:()=>b({open:!1}),children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsx("div",{className:"absolute inset-0 p-4 md:p-8 overflow-auto flex items-start md:items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-3xl bg-[#0b1020] rounded-2xl border border-indigo-500/40 shadow-2xl",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20",children:[e.jsxs("div",{className:"font-semibold",children:["Preview: ",v.kind]}),e.jsx("button",{className:"btn",onClick:()=>b({open:!1}),children:"Close"})]}),e.jsx("div",{className:"p-0 bg-black/30",children:e.jsx("iframe",{title:"Email Preview",style:{width:"100%",height:"70vh",border:"0",background:"transparent"},srcDoc:v.html||""})}),e.jsx("div",{className:"px-4 py-3 border-t border-indigo-500/20 text-xs opacity-70",children:"Click outside this panel or press Esc to close."})]})})]})]}):e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin"}),e.jsx("div",{className:"text-sm opacity-80",children:"You donâ€™t have permission to manage admins."})]})}function Bm({user:t}){const{favoriteDouble:a,callerEnabled:s,callerVoice:r,callerVolume:n,speakCheckoutOnly:i,avgMode:o,autoStartOffline:l,rememberLastOffline:m,reducedMotion:c,compactHeader:u,allowSpectate:f,cameraScale:x,cameraAspect:p,cameraFitMode:g,autoscoreProvider:w,autoscoreWsUrl:I,calibrationGuide:A,preferredCameraId:S,preferredCameraLabel:E,cameraEnabled:M,offlineLayout:F,textSize:D,boxSize:v,setFavoriteDouble:b,setCallerEnabled:_,setCallerVoice:J,setCallerVolume:T,setSpeakCheckoutOnly:W,setAvgMode:C,setAutoStartOffline:Y,setRememberLastOffline:pe,setReducedMotion:ue,setCompactHeader:Ie,setAllowSpectate:xe,setCameraScale:bt,setCameraAspect:He,setCameraFitMode:ge,setAutoscoreProvider:oe,setAutoscoreWsUrl:O,setCalibrationGuide:se,setPreferredCamera:ye,setCameraEnabled:be,setOfflineLayout:De,setTextSize:Ge,setBoxSize:Te,dartTimerEnabled:mt,dartTimerSeconds:Me,setDartTimerEnabled:ce,setDartTimerSeconds:Le,x01DoubleIn:Xe,setX01DoubleIn:ot}=Ot(),[Kt,Qe]=d.useState([{key:"first180",label:"First 180",unlocked:!1,icon:"ðŸŽ¯",desc:"Score 180 in a match."},{key:"hundredGames",label:"100 Games Played",unlocked:!1,icon:"ðŸ…",desc:"Play 100 games."},{key:"tournamentWin",label:"Tournament Winner",unlocked:!1,icon:"ðŸ¥‡",desc:"Win a tournament."},{key:"bestLeg",label:"Best Leg",unlocked:!1,icon:"âš¡",desc:"Finish a leg in 12 darts or less."},{key:"comeback",label:"Comeback",unlocked:!1,icon:"ðŸ”¥",desc:"Win after trailing by 3 legs."}]);d.useEffect(()=>{const G=t?.username||"";G&&Qe(he=>he.map(yt=>({...yt,unlocked:!!localStorage.getItem(`ndn:achieve:${yt.key}:${G}`)})))},[t?.username]);const[ut,Ae]=d.useState(!1),[le,we]=d.useState(""),[te,X]=d.useState(""),[qe,Pe]=d.useState(""),[ve,k]=d.useState(""),[ee,et]=d.useState(""),[Se,gt]=d.useState(!0),[Ze,Dt]=d.useState(null),[st,cs]=d.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[nt,Ht]=d.useState("");d.useEffect(()=>{const G=t?.username||"";if(G)try{we(localStorage.getItem(`ndn:bio:favPlayer:${G}`)||""),X(localStorage.getItem(`ndn:bio:favTeam:${G}`)||""),Pe(localStorage.getItem(`ndn:bio:favDarts:${G}`)||""),k(localStorage.getItem(`ndn:bio:bio:${G}`)||""),et(localStorage.getItem(`ndn:bio:profilePhoto:${G}`)||""),gt(localStorage.getItem(`ndn:settings:allowAnalytics:${G}`)!=="false")}catch{}},[t?.username]),d.useEffect(()=>{t?.email&&kt(`/api/subscription?email=${encodeURIComponent(t.email)}`).then(G=>G.json()).then(Dt).catch(()=>{})},[t?.email]);const Yt=()=>{const G=t?.username||"";if(G)try{localStorage.setItem(`ndn:bio:favPlayer:${G}`,le),localStorage.setItem(`ndn:bio:favTeam:${G}`,te),localStorage.setItem(`ndn:bio:favDarts:${G}`,qe),localStorage.setItem(`ndn:bio:bio:${G}`,ve),localStorage.setItem(`ndn:bio:profilePhoto:${G}`,ee);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:G,avatar:ee}}))}catch{}localStorage.setItem(`ndn:settings:allowAnalytics:${G}`,Se.toString()),Ae(!1)}catch{}},as=G=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:G}}))}catch(he){console.error("Navigation failed:",he)}},Ct=G=>{const he=G.toLowerCase();return he.includes("username")||he.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:he.includes("premium")||he.includes("upgrade")||he.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:he.includes("calibrat")||he.includes("camera")||he.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:he.includes("voice")||he.includes("caller")||he.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:he.includes("friend")||he.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:he.includes("stat")||he.includes("score")||he.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:he.includes("setting")||he.includes("customiz")||he.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:he.includes("tournament")||he.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:he.includes("help")||he.includes("support")||he.includes("faq")?{text:"You're already in the help section! Check the Support section above for more resources.",links:[{text:"Scroll to Support",tab:"settings"}]}:he.includes("how to play")||he.includes("game")||he.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},Wt=()=>{if(!nt.trim())return;const G=nt.toLowerCase();cs(yt=>[...yt,{text:nt,isUser:!0}]),Ht("");const he=Ct(G);setTimeout(()=>{cs(yt=>[...yt,{text:he,isUser:!1}])},500)},[at,gs]=d.useState(""),[it,As]=d.useState(!1),[Xt,qt]=d.useState(""),[zt,Ps]=d.useState([]);return d.useEffect(()=>{const G=()=>{const he=speechSynthesis.getVoices();Ps(he.filter(yt=>yt.lang.startsWith("en")))};G(),speechSynthesis.onvoiceschanged=G},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-black",children:[e.jsx(ir,{className:"w-5 h-5"})," Account"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:logout")),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Logout"})}),e.jsxs("div",{className:"border-t border-red-500/20 pt-3",children:[e.jsxs("div",{className:"font-medium mb-2 text-black",children:["Change Username (",(()=>{const G=t?.usernameChangeCount||0;return G<2?`${2-G} free changes remaining`:"Â£2 per change"})(),")"]}),e.jsx("div",{className:"text-sm text-black mb-2",children:"You can change your username up to 2 times for free. Additional changes cost Â£2 each."}),t?.usernameChangeCount>=2&&!at.trim()?e.jsx("div",{className:"text-amber-400 text-sm mb-2",children:"âš ï¸ Additional username changes cost Â£2"}):null,e.jsx("input",{className:"input w-full mb-2",type:"text",placeholder:"New username",value:at,onChange:G=>gs(G.target.value),disabled:it}),Xt&&e.jsx("div",{className:"text-red-400 text-sm mb-2",children:Xt}),e.jsx("button",{onClick:async()=>{if(qt(""),!at.trim()){qt("Username required");return}if(at.length<3||at.length>20){qt("Username must be 3-20 characters");return}(t?.usernameChangeCount||0)<2?(localStorage.setItem("pendingUsernameChange",at.trim()),window.location.href="/?username-change=free"):window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02"},disabled:it||!at.trim(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:it?"Processing...":(t?.usernameChangeCount||0)<2?"Change Username (FREE)":"Change Username (Â£2)"})]})]})]})}),Ze&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-black",children:[e.jsx(Fi,{className:"w-5 h-5"})," Premium"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:["Status: ",Ze.fullAccess?"Active":"Inactive"]}),Ze.source&&e.jsxs("div",{className:"text-xs opacity-80",children:["Source: ",Ze.source]}),Ze.expiresAt&&e.jsxs("div",{className:"text-xs opacity-80",children:["Expires: ",new Date(Ze.expiresAt).toLocaleDateString()]}),Ze.renewalWarning&&e.jsxs("div",{className:"text-amber-600 text-xs mt-2 p-2 bg-amber-100 rounded",children:["âš ï¸ ",Ze.renewalWarning]})]}),Ze.source==="tournament"&&e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:async()=>{if(confirm("Are you sure you want to cancel your premium subscription? You will lose access to premium features."))try{await kt("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,requesterEmail:t.email})});const G=await kt(`/api/subscription?email=${encodeURIComponent(t.email)}`);Dt(await G.json())}catch{alert("Failed to cancel premium. Please try again.")}},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Cancel Premium"})})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(ir,{className:"w-5 h-5 text-brand-400"})," Profile Bio"]}),ut?e.jsxs("button",{onClick:Yt,className:"flex items-center gap-2 px-3 py-1 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400 text-sm transition-colors",children:[e.jsx(lc,{className:"w-4 h-4"})," Save"]}):e.jsxs("button",{onClick:()=>Ae(!0),className:"flex items-center gap-2 px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400 text-sm transition-colors",children:[e.jsx(ic,{className:"w-4 h-4"})," Edit"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Player:"}),ut?e.jsx("input",{className:"input w-full",type:"text",value:le,onChange:G=>we(G.target.value),placeholder:"e.g. Michael van Gerwen"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:le||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Football Team:"}),ut?e.jsx("input",{className:"input w-full",type:"text",value:te,onChange:G=>X(G.target.value),placeholder:"e.g. Manchester United"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:te||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Darts:"}),ut?e.jsx("input",{className:"input w-full",type:"text",value:qe,onChange:G=>Pe(G.target.value),placeholder:"e.g. Unicorn Phase 5, 24g"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:qe||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Short Bio / Quote:"}),ut?e.jsx("textarea",{className:"input w-full",value:ve,onChange:G=>k(G.target.value),placeholder:"Write something about yourself...",rows:3}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[4rem] flex items-start",children:ve||"No bio set"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(ir,{className:"w-5 h-5 text-cyan-400"})," Profile Photo"]}),e.jsxs("div",{children:[ee&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:ee,alt:"Profile",className:"w-16 h-16 rounded-full object-cover"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:G=>{const he=G.target.files?.[0];if(he){const yt=new FileReader;yt.onload=At=>{const Et=At.target?.result;et(Et);const Pt=t?.username||"";Pt&&localStorage.setItem(`ndn:bio:profilePhoto:${Pt}`,Et);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:Pt,avatar:Et}}))}catch{}},yt.readAsDataURL(he)}},className:"hidden",id:"profile-photo-upload"}),e.jsx("label",{htmlFor:"profile-photo-upload",className:"btn bg-cyan-600 hover:bg-cyan-700 cursor-pointer",children:ee?"Change Photo":"Upload Photo"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(oc,{className:"w-5 h-5 text-green-400"})," Game Preferences"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"dartTimerEnabled",checked:!!mt,onChange:G=>ce(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"dartTimerEnabled",className:"text-sm",children:"Enable per-dart throw timer"})]}),mt&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Time per throw: ",Me?Math.round(Me):0,"s"]}),e.jsx("input",{type:"range",min:"3",max:"60",step:"1",value:Me||10,onChange:G=>Le(parseInt(G.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"When the timer reaches zero, the dart is recorded as a miss and advances to the next throw."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Favourite Double:"}),e.jsxs("select",{className:"input w-full",value:a,onChange:G=>b(G.target.value),children:[e.jsx("option",{value:"any",children:"Any Double"}),e.jsx("option",{value:"D20",children:"Double 20"}),e.jsx("option",{value:"D19",children:"Double 19"}),e.jsx("option",{value:"D18",children:"Double 18"}),e.jsx("option",{value:"D17",children:"Double 17"}),e.jsx("option",{value:"D16",children:"Double 16"}),e.jsx("option",{value:"D15",children:"Double 15"}),e.jsx("option",{value:"D14",children:"Double 14"}),e.jsx("option",{value:"D13",children:"Double 13"}),e.jsx("option",{value:"D12",children:"Double 12"}),e.jsx("option",{value:"D11",children:"Double 11"}),e.jsx("option",{value:"D10",children:"Double 10"}),e.jsx("option",{value:"D9",children:"Double 9"}),e.jsx("option",{value:"D8",children:"Double 8"}),e.jsx("option",{value:"D7",children:"Double 7"}),e.jsx("option",{value:"D6",children:"Double 6"}),e.jsx("option",{value:"D5",children:"Double 5"}),e.jsx("option",{value:"D4",children:"Double 4"}),e.jsx("option",{value:"D3",children:"Double 3"}),e.jsx("option",{value:"D2",children:"Double 2"}),e.jsx("option",{value:"D1",children:"Double 1"}),e.jsx("option",{value:"DB",children:"Bullseye"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Average Display Mode:"}),e.jsxs("select",{className:"input w-full",value:o,onChange:G=>C(G.target.value),children:[e.jsx("option",{value:"all-time",children:"All Time Average"}),e.jsx("option",{value:"24h",children:"24 Hour Average"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"x01DoubleIn",checked:!!Xe,onChange:G=>ot(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"x01DoubleIn",className:"text-sm",children:"Require Double-In for X01"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"autoStartOffline",checked:l,onChange:G=>Y(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoStartOffline",className:"text-sm",children:"Auto-start offline games"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"rememberLastOffline",checked:m,onChange:G=>pe(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"rememberLastOffline",className:"text-sm",children:"Remember last offline game settings"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Offline Game Layout:"}),e.jsxs("select",{className:"input w-full",value:F||"classic",onChange:G=>De(G.target.value),children:[e.jsx("option",{value:"classic",children:"Classic Layout"}),e.jsx("option",{value:"modern",children:"Modern Layout"})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(cc,{className:"w-5 h-5 text-purple-400"})," Audio & Voice"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"callerEnabled",checked:s,onChange:G=>_(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"callerEnabled",className:"text-sm font-medium",children:"Enable Voice Caller"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Caller mode:"}),e.jsxs("select",{className:"input w-full",value:s?i?"checkout":"visit":"off",onChange:G=>{const he=G.target.value;he==="off"?_(!1):he==="checkout"?(_(!0),W(!0)):(_(!0),W(!1))},children:[e.jsx("option",{value:"visit",children:"Visit totals only"}),e.jsx("option",{value:"checkout",children:"Checkouts only"}),e.jsx("option",{value:"off",children:"Off"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Choose when the caller speaks: at the end of each 3-dart visit, only on finishes, or disable entirely."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Voice:"}),e.jsx("select",{className:"input w-full",value:r,onChange:G=>J(G.target.value),children:zt.map(G=>e.jsxs("option",{value:G.name,children:[G.name," (",G.lang,")"]},G.name))}),e.jsx("button",{onClick:()=>{const G=new SpeechSynthesisUtterance("Test voice: 180 scored!");G.voice=zt.find(he=>he.name===r)||null,G.volume=n,speechSynthesis.speak(G)},className:"btn bg-blue-600 hover:bg-blue-700 mt-2",children:"Test Voice"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Volume: ",Math.round(n*100),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:n,onChange:G=>T(parseFloat(G.target.value)),className:"w-full"})]}),!1]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ql,{className:"w-5 h-5 text-blue-400"})," Camera & Vision"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled",checked:M,onChange:G=>be(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraEnabled",className:"text-sm",children:"Enable camera for scoring"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Camera Scale: ",x.toFixed(2),"x"]}),e.jsx("input",{type:"range",min:"0.5",max:"1.25",step:"0.05",value:x,onChange:G=>bt(parseFloat(G.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Camera Aspect Ratio:"}),e.jsxs("select",{className:"input w-full",value:p||"wide",onChange:G=>He(G.target.value),children:[e.jsx("option",{value:"wide",children:"Wide (16:9)"}),e.jsx("option",{value:"square",children:"Square (1:1)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Camera Display:"}),e.jsxs("select",{className:"input w-full",value:g||"fill",onChange:G=>ge(G.target.value),children:[e.jsx("option",{value:"fit",children:"Fit (show entire frame)"}),e.jsx("option",{value:"fill",children:"Fill (full-bleed)"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Fit shows the whole camera with possible letterboxing. Fill covers the panel edge-to-edge and may crop."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Text Size:"}),e.jsxs("select",{className:"input w-full",value:D,onChange:G=>Ge(G.target.value),children:[e.jsx("option",{value:"small",children:"Small"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"large",children:"Large"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Box Size:"}),e.jsxs("select",{className:"input w-full",value:v,onChange:G=>Te(G.target.value),children:[e.jsx("option",{value:"small",children:"Small"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"large",children:"Large"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"calibrationGuide",checked:A,onChange:G=>se(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"calibrationGuide",className:"text-sm",children:"Show calibration guide"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Autoscore Provider:"}),e.jsxs("select",{className:"input w-full",value:w||"built-in",onChange:G=>oe(G.target.value),children:[e.jsx("option",{value:"built-in",children:"Built-in Vision"}),e.jsx("option",{value:"manual",children:"Manual scoring only"}),e.jsx("option",{value:"external-ws",children:"External WebSocket"})]})]}),w==="manual"&&e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews and autoscore overlays are hidden while manual scoring is selected. Use the score inputs or keyboard shortcuts to record each visit."}),w==="external-ws"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"External WebSocket URL:"}),e.jsx("input",{className:"input w-full",type:"url",value:I||"",onChange:G=>O(G.target.value),placeholder:"ws://localhost:8080"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-orange-500/40 bg-orange-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(zl,{className:"w-5 h-5 text-orange-400"})," UI & Accessibility"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"reducedMotion",checked:c,onChange:G=>ue(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"reducedMotion",className:"text-sm",children:"Reduce motion/animations"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"compactHeader",checked:u,onChange:G=>Ie(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"compactHeader",className:"text-sm",children:"Compact header layout"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-pink-500/40 bg-pink-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(dc,{className:"w-5 h-5 text-pink-400"})," Online & Social"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowSpectate",checked:f,onChange:G=>xe(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowSpectate",className:"text-sm",children:"Allow others to spectate my games"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-yellow-700",children:[e.jsx(ha,{className:"w-5 h-5"})," Achievements & Badges"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Kt.map(G=>e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-xl border ${G.unlocked?"border-emerald-400 bg-emerald-500/10":"border-slate-400 bg-slate-700/10"}`,children:[e.jsx("div",{className:"text-3xl mb-2",children:G.icon}),e.jsx("div",{className:`font-bold mb-1 text-center ${G.unlocked?"text-emerald-400":"text-slate-400"}`,children:G.label}),e.jsx("div",{className:"text-xs text-slate-300 text-center mb-2",children:G.desc}),!G.unlocked&&e.jsx("div",{className:"text-xs text-amber-400 font-medium",children:"ðŸ”’ Locked"}),G.unlocked&&e.jsx("div",{className:"text-xs text-emerald-400 font-medium",children:"âœ… Unlocked!"})]},G.key))})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-gray-500/40 bg-gray-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ha,{className:"w-5 h-5 text-gray-400"})," Data & Privacy"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowAnalytics",checked:Se,onChange:G=>gt(G.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowAnalytics",className:"text-sm",children:"Allow anonymous usage analytics"})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{const G={username:t?.username,email:t?.email,favPlayer:le,favTeam:te,favDarts:qe,bio:ve,profilePhoto:ee,settings:{favoriteDouble:a,avgMode:o,autoStartOffline:l,rememberLastOffline:m,reducedMotion:c,compactHeader:u,allowSpectate:f,cameraScale:x,cameraAspect:p,autoscoreProvider:w,autoscoreWsUrl:I,calibrationGuide:A,cameraFitMode:g,callerEnabled:s,callerVoice:r,callerVolume:n,speakCheckoutOnly:i,textSize:D}},he=new Blob([JSON.stringify(G,null,2)],{type:"application/json"}),yt=URL.createObjectURL(he),At=document.createElement("a");At.href=yt,At.download="ninedartnation-data.json",At.click(),URL.revokeObjectURL(yt)},className:"btn bg-blue-600 hover:bg-blue-700",children:"Export My Data"})}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete your account? This action cannot be undone.")&&alert("Account deletion not yet implemented. Please contact support.")},className:"btn bg-red-600 hover:bg-red-700",children:"Delete Account"})})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Fi,{className:"w-5 h-5 text-red-400"})," Privacy & Copyright Notice"]}),e.jsx("div",{className:"space-y-3 text-sm text-slate-300",children:e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-red-300 mb-2",children:"âš ï¸ IMPORTANT LEGAL NOTICE"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Copyright Protection:"})," All code, assets, and intellectual property in Nine Dart Nation are protected by copyright law. Unauthorized copying, modification, or distribution of this software is strictly prohibited."]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Legal Consequences:"})," Any attempt to edit, reverse-engineer, or redistribute this code will result in immediate legal action, including but not limited to copyright infringement lawsuits and potential criminal charges."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Privacy:"})," Your personal data and gameplay information are protected. Any unauthorized access or data collection violates privacy laws and will be prosecuted to the full extent of the law."]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-teal-500/40 bg-teal-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ha,{className:"w-5 h-5 text-teal-400"})," Support & Help"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-300 mb-2",children:"Need help? Contact us:"}),e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"btn bg-teal-600 hover:bg-teal-700",children:"Email Support"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Vl,{className:"w-5 h-5 text-blue-400"})," Help Assistant"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-slate-800 rounded-lg p-4 max-h-96 overflow-y-auto space-y-3",children:st.map((G,he)=>e.jsx("div",{className:`flex ${G.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${G.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof G.text=="string"?G.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:G.text.text}),G.text.links&&e.jsx("div",{className:"space-y-1",children:G.text.links.map((yt,At)=>e.jsx("button",{onClick:()=>as(yt.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:yt.text},At))})]})})},he))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:nt,onChange:G=>Ht(G.target.value),onKeyPress:G=>G.key==="Enter"&&Wt(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:Wt,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(Gl,{className:"w-4 h-4"})})]})]})]})})]})}const Um={};function $m({onAuth:t}){const[a,s]=d.useState("signin"),[r,n]=d.useState(""),[i,o]=d.useState(""),[l,m]=d.useState(""),[c,u]=d.useState(""),[f,x]=d.useState(""),[p,g]=d.useState(!1),[w,I]=d.useState(!1),A="http://localhost:8787";async function S(D){if(D.preventDefault(),x(""),I(!0),!i||!l){x("Username and password required."),I(!1);return}try{const v=await fetch(`${A}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:l})}),b=await v.json();v.ok&&b?.user&&b?.token?(localStorage.setItem("authToken",b.token),t(b.user)):x(b?.error||"Invalid username or password.")}catch{x("Network error.")}finally{I(!1)}}async function E(D){if(D.preventDefault(),x(""),I(!0),!r||!i||!l){x("Email, username, and password required."),I(!1);return}try{const v=await fetch(`${A}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,username:i,password:l})}),b=await v.json();v.ok&&b?.user&&b?.token?(localStorage.setItem("authToken",b.token),t(b.user)):x(b?.error||"Signup failed.")}catch{x("Network error.")}finally{I(!1)}}async function M(D){if(D.preventDefault(),x(""),I(!0),!r||!r.includes("@")){x("Enter your email address."),I(!1);return}try{const b=await(await fetch(`${A}/api/auth/send-reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})})).json();if(!b?.ok)throw new Error(b?.error||"Failed to send reset email");x("Password reset link sent to your email.")}catch(v){x(v?.message||"Failed to send reset email")}finally{I(!1)}}async function F(D){if(D.preventDefault(),x(""),I(!0),!r||!r.includes("@")){x("Enter your email address."),I(!1);return}try{const b=await(await fetch(`${A}/api/auth/send-username`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})})).json();if(!b?.ok)throw new Error(b?.error||"Failed to send username email");x("Your username has been emailed to you.")}catch(v){x(v?.message||"Failed to send username email")}finally{I(!1)}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsxs("div",{className:"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsxs("form",{className:"card w-full space-y-4",onSubmit:a==="signin"?S:a==="signup"?E:M,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:[e.jsx("h1",{className:"logo text-center",children:"NINE-DART-NATION ðŸŽ¯"}),e.jsx("span",{className:"badge",children:"Welcome"})]}),e.jsx("h2",{className:"text-2xl font-bold",children:a==="signin"?"Sign In":a==="signup"?"Create Account":"Reset Password"}),(a==="signup"||a==="reset")&&e.jsx("input",{className:"input w-full",type:"email",placeholder:"Email",value:r,onChange:D=>n(D.target.value),required:!0}),a!=="reset"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Username",value:i,onChange:D=>o(D.target.value),required:!0}),a!=="reset"&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input w-full pr-10",type:p?"text":"password",placeholder:"Password",value:l,onChange:D=>m(D.target.value),autoComplete:"current-password",required:!0,onFocus:()=>g(!1),onBlur:()=>g(!1)}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white",tabIndex:-1,onMouseDown:D=>{D.preventDefault(),g(!0)},onMouseUp:D=>{D.preventDefault(),g(!1)},onMouseLeave:()=>g(!1),onTouchStart:D=>{D.preventDefault(),g(!0)},onTouchEnd:D=>{D.preventDefault(),g(!1)},"aria-label":"Toggle password visibility",children:p?e.jsx(mc,{className:"w-5 h-5"}):e.jsx(zl,{className:"w-5 h-5"})})]}),a==="signup"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Password Reminder (optional)",value:c,onChange:D=>u(D.target.value)}),f&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:f}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:w,children:w?"Signing In...":a==="signin"?"Sign In":a==="signup"?"Sign Up":"Send Reset Link"}),a==="reset"&&e.jsx("button",{className:"btn w-full mt-2 bg-white/10 hover:bg-white/20",type:"button",onClick:F,disabled:w,children:"Email me my username"}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("button",{type:"button",className:"underline",onClick:()=>s(a==="signin"?"signup":"signin"),disabled:w,children:a==="signin"?"Need an account? Sign Up":"Already have an account? Sign In"}),e.jsx("button",{type:"button",className:"underline",onClick:()=>s("reset"),disabled:w,children:"Forgot password?"})]})]}),e.jsxs("aside",{className:"card w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Whatâ€™s inside"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(Kr,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Online & Friends"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Challenge friends, chat, and join leagues."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(uc,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Deep Stats"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Track 3-dart averages, best legs, and more."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(Oa,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Game Modes"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Start with 3 free online games upon signup. After that, PREMIUM is required to play all games."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(hc,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Premium Perks"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Polished UI, upcoming features, and early access."})]})]})]}),e.jsxs("a",{href:Um?.VITE_DISCORD_INVITE_URL||"https://discord.gg/8GtbZ6RU",target:"_blank",rel:"noopener noreferrer",className:"btn mt-4 flex items-center justify-center gap-2",children:[e.jsx(En,{className:"w-5 h-5"})," Join BullseyeDartsLeague"]}),e.jsxs("a",{href:"https://discord.gg/NineDartNation",target:"_blank",rel:"noopener noreferrer",className:"btn mt-2 flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20",children:[e.jsx(En,{className:"w-5 h-5"})," Join NineDartNation"]})]})]})]})}const Fm=d.createContext({theme:"default",setTheme:t=>{}}),_l="ndn_theme";function _m({children:t}){const[a,s]=d.useState("default");return d.useEffect(()=>{try{const r=localStorage.getItem(_l);r&&s(r)}catch{}},[]),d.useEffect(()=>{try{localStorage.setItem(_l,a)}catch{}},[a]),e.jsx(Fm.Provider,{value:{theme:a,setTheme:s},children:e.jsx("div",{className:`theme-${a}`,children:t})})}const Fo=d.createContext(null);function Hm({children:t}){const[a,s]=d.useState(!1),[r,n]=d.useState("connecting"),i=d.useRef(null),o=d.useRef(new Set),l=d.useRef(!0),m=d.useRef(0),c=d.useRef(null),u=d.useRef(null),f=d.useRef(null),x=d.useRef(0),p=()=>{if(f.current)return f.current;const M="ws://localhost:8787";if(M.length>0){const _=M.endsWith("/ws")?M:M.replace(/\/$/,"")+"/ws";return f.current=[_],f.current}const F=window.location.protocol==="https:"?"wss":"ws",D=window.location.hostname,b=[`${F}://${window.location.host}`+"/ws",`${F}://${D}/ws`,`${F}://${D}:8787/ws`,`${F}://${D}:3000/ws`];return f.current=Array.from(new Set(b)),f.current},g=()=>{const M=p();return x.current=(x.current+1)%M.length,M[x.current]},w=()=>{const M=p();return M[x.current]||M[0]},I=d.useCallback(()=>{if(i.current&&(i.current.readyState===WebSocket.OPEN||i.current.readyState===WebSocket.CONNECTING))return;n("connecting");const F=`${w()}`,D=new WebSocket(F);i.current=D,D.onopen=()=>{s(!0),n("connected"),m.current=0,u.current&&clearInterval(u.current),u.current=setInterval(()=>{try{i.current?.readyState===WebSocket.OPEN&&i.current?.send(JSON.stringify({type:"ping",t:Date.now()}))}catch{}},2e4)},D.onmessage=v=>{try{const b=JSON.parse(v.data);o.current.forEach(_=>{try{_(b)}catch{}})}catch{}},D.onerror=()=>{},D.onclose=()=>{if(s(!1),n("disconnected"),u.current&&(clearInterval(u.current),u.current=null),!l.current)return;const v=(m.current||0)+1;m.current=v,v%2===0&&g();const b=1e3*Math.pow(2,v-1),_=Math.floor(Math.random()*1e3);let J=Math.min(3e4,b+_);v===1&&(J=0),c.current&&clearTimeout(c.current),J===0?I():c.current=setTimeout(I,J)}},[]);d.useEffect(()=>{l.current=!0,I();const M=()=>{l.current=!1;try{i.current?.close()}catch{}};window.addEventListener("beforeunload",M);const F=()=>{document.visibilityState==="visible"&&(a||I())};return document.addEventListener("visibilitychange",F),window.addEventListener("online",I),()=>{l.current=!1,c.current&&clearTimeout(c.current),u.current&&clearInterval(u.current);try{i.current?.close()}catch{}document.removeEventListener("visibilitychange",F),window.removeEventListener("online",I),window.removeEventListener("beforeunload",M)}},[I]);const A=d.useCallback(M=>{try{i.current&&i.current.readyState===WebSocket.OPEN&&i.current.send(typeof M=="string"?M:JSON.stringify(M))}catch{}},[]),S=d.useCallback(M=>(o.current.add(M),()=>{o.current.delete(M)}),[]),E=d.useMemo(()=>({connected:a,status:r,send:A,addListener:S}),[a,r,A,S]);return e.jsx(Fo.Provider,{value:E,children:t})}function ui(){const t=d.useContext(Fo);if(!t)throw new Error("useWS must be used within WSProvider");return t}function Wm({status:t,title:a,size:s=12}){const r=s;return t==="connecting"?e.jsx("span",{role:"img","aria-label":"Connecting",title:a||"Connectingâ€¦",className:"inline-flex items-center justify-center",style:{width:r,height:r},children:e.jsxs("svg",{width:r,height:r,viewBox:"0 0 24 24",className:"animate-spin","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#A7F3D0",strokeWidth:"3",fill:"none",opacity:"0.35"}),e.jsx("path",{d:"M22 12a10 10 0 0 0-10-10",stroke:"#34D399",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]})}):t==="connected"?e.jsx("span",{role:"img","aria-label":"Connected",title:a||"Connected",className:"inline-flex items-center justify-center",style:{width:r,height:r},children:e.jsx("svg",{width:r,height:r,viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#34D399"})})}):e.jsx("span",{role:"img","aria-label":"Disconnected",title:a||"Not connected",className:"inline-flex items-center justify-center",style:{width:r,height:r},children:e.jsxs("svg",{width:r,height:r,viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#F87171",opacity:"0.15"}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"#F87171",strokeWidth:"2",fill:"none"}),e.jsx("rect",{x:"6",y:"11",width:"12",height:"2",rx:"1",fill:"#F87171"})]})})}const _o="ndn:blocked:v1";function qm(){try{const t=localStorage.getItem(_o);return t?JSON.parse(t):{}}catch{return{}}}function Hl(t){try{localStorage.setItem(_o,JSON.stringify(t))}catch{}}const zm=qs((t,a)=>({blocked:qm(),isBlocked:s=>!!a().blocked[(s||"").toLowerCase()],block:s=>t(r=>{const n={...r.blocked};return n[(s||"").toLowerCase()]=Date.now(),Hl(n),{blocked:n}}),unblock:s=>t(r=>{const n={...r.blocked};return delete n[(s||"").toLowerCase()],Hl(n),{blocked:n}}),all:()=>Object.keys(a().blocked)}));function Vm({user:t}){const a="http://localhost:8787",s=sa(),r=(()=>{try{return ui()}catch{return null}})(),n=zm(),[i,o]=d.useState("room-1"),[l,m]=d.useState(!1),[c,u]=d.useState([]),[f,x]=d.useState(!1),[p,g]=d.useState(!1),w=d.useRef(null),[I,A]=d.useState(null),S=d.useRef(null),E=d.useRef(0),M=d.useRef(null),F=d.useRef(!0),D=d.useRef(0),v=d.useRef(!1),b=fa(),_=ri(),{favoriteDouble:J,callerEnabled:T,callerVoice:W,callerVolume:C,speakCheckoutOnly:Y,allowSpectate:pe,cameraScale:ue,setCameraScale:Ie,cameraFitMode:xe="fill",setCameraFitMode:bt,cameraEnabled:He,textSize:ge,boxSize:oe,autoscoreProvider:O,matchType:se="singles",setMatchType:ye,teamAName:be="Team A",setTeamAName:De,teamBName:Ge="Team B",setTeamBName:Te,x01DoubleIn:mt}=Ot(),Me=O==="manual",Le=(h=>{switch(h){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(ge),[Xe,ot]=d.useState(2),[Kt,Qe]=d.useState(!1),[ut,Ae]=d.useState([]),[le,we]=d.useState(0),[te,X]=d.useState(0),[qe,Pe]=d.useState(0),[ve,k]=d.useState(0),[ee,et]=d.useState(""),[Se,gt]=d.useState(0),[Ze,Dt]=d.useState(0),[st,cs]=d.useState(""),[nt,Ht]=d.useState(20),[Yt,as]=d.useState(0),[Ct,Wt]=d.useState(0),[at,gs]=d.useState(""),[it,As]=d.useState(30),[Xt,qt]=d.useState(!1),[zt,Ps]=d.useState(null),[G,he]=d.useState(null),yt=d.useRef(null),[At,Et]=d.useState(""),[Pt,ds]=d.useState({}),[Tt,ys]=d.useState({}),[vs,rs]=d.useState({}),[ms,us]=d.useState({}),[L,z]=d.useState({}),[re,me]=d.useState({}),[P,q]=d.useState({}),[U,$]=d.useState({}),[H,je]=d.useState(()=>ai()),[ne,fe]=d.useState(0),[Ce,tt]=d.useState(!1),[vt,ht]=d.useState(null),[wt,Bt]=d.useState({}),[Gt,hs]=d.useState(null),[Zt,Mt]=d.useState(300),Rs=No(h=>h.setPaused),[ft,is]=d.useState(()=>{try{const h=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(h)}catch{return!1}}),[Rt,xs]=d.useState(null),ln=d.useRef(null),Fs=d.useRef(null);d.useEffect(()=>{if(!Ce||!Gt)return;const h=setInterval(()=>{Date.now()>=(Gt||0)&&(tt(!1),ht(null),Bt({}),hs(null),Rs(!1,null),We())},1e3);return()=>clearInterval(h)},[Ce,Gt]);function ls(){try{if(!Fs.current){const h=window.AudioContext||window.webkitAudioContext;h&&(Fs.current=new h)}Fs.current?.resume?.().catch(()=>{})}catch{}}function os(h,j,N=0,R=.05){const Q=Fs.current;if(!Q)return;const de=Q.createOscillator(),ae=Q.createGain();de.type="square",de.frequency.value=h,ae.gain.value=R,de.connect(ae),ae.connect(Q.destination);const V=Q.currentTime+N;de.start(V),de.stop(V+j/1e3)}function es(h){ls(),Fs.current&&(h==="180"?(os(880,110,0,.06),os(1175,110,.06,.06),os(1568,140,.12,.06)):(os(659,140,0,.07),os(784,140,.08,.07),os(987,200,.16,.07)))}function Jt(h,j){const N=Date.now(),R=ln.current;R&&R.kind===h&&R.by===j&&N-R.ts<500||(ln.current={kind:h,by:j,ts:N},xs({kind:h,by:j,turnIdx:b.currentPlayerIdx,ts:N}),es(h))}const[xt,Qt]=d.useState(!1),[Ls,js]=d.useState([]),[Ut,on]=d.useState("bestof"),[Os,_s]=d.useState(5),[ts,ss]=d.useState(501),[jt,Oe]=d.useState(null),[Je,$e]=d.useState("");function $t(h){$e(h),setTimeout(()=>$e(""),4e3);try{s(h||"Stripe checkout failed",{type:"error"})}catch{}}const[Ke,pt]=d.useState(null),[Nt,St]=d.useState(null),[lt,Ns]=d.useState("X01"),[Ee,Js]=d.useState("X01"),[Dn,ws]=d.useState(!1),[Ss,cn]=d.useState(30),[Cs,An]=d.useState(!!mt),ks=t?.username&&!t?.fullAccess?Yl(t.username):1/0,Ft=!t?.fullAccess&&ks<=0,[dn,mn]=d.useState("all"),[un,Es]=d.useState("all"),[Ts,Pn]=d.useState("all"),[Bs,Rn]=d.useState(!1),[hn,fn]=d.useState(10),{H:Ln}=za(),xn=t?.username?an(t.username):0,On=ri(h=>h.unread),pn=(Ls||[]).filter(h=>!(dn!=="all"&&h.mode!==dn||un!=="all"&&Number(h.startingScore)!==Number(un)||Ts!=="all"&&h.game!==Ts||Bs&&(!xn||!h.creatorAvg||Math.abs(Number(h.creatorAvg)-Number(xn))>hn)));d.useEffect(()=>{const h=j=>{const N=j?.detail||{};N.game&&Ns(N.game),(N.mode==="bestof"||N.mode==="firstto")&&on(N.mode),typeof N.value=="number"&&isFinite(N.value)&&_s(Math.max(1,Math.floor(N.value))),typeof N.start=="number"&&isFinite(N.start)&&ss(Math.max(1,Math.floor(N.start))),Qt(!0)};return window.addEventListener("ndn:online-demo",h),()=>window.removeEventListener("ndn:online-demo",h)},[]),d.useEffect(()=>{const h=String(t?.email||"").toLowerCase();h&&kt(`/api/friends/messages?email=${encodeURIComponent(h)}`).then(j=>j.json()).then(j=>{j?.ok&&Array.isArray(j.messages)&&_.load(j.messages)}).catch(()=>{})},[t?.email]),d.useEffect(()=>{const h=j=>{try{const N=j?.detail||{},R=Number(N.start||501);b.newMatch([t?.username||"You","Opponent"],R,i),b.addVisit(60,3),b.nextPlayer(),b.addVisit(85,3),b.nextPlayer(),b.addVisit(100,3),Js("X01"),Qe(!0)}catch{}};return window.addEventListener("ndn:online-match-demo",h),()=>window.removeEventListener("ndn:online-match-demo",h)},[]),d.useEffect(()=>(F.current=!0,Bn(),()=>{F.current=!1,M.current&&clearTimeout(M.current);try{S.current?.close()}catch{}}),[]),d.useEffect(()=>{_.setInGame(b.inProgress)},[b.inProgress]),d.useEffect(()=>{Rt&&b.currentPlayerIdx!==Rt.turnIdx&&xs(null)},[b.currentPlayerIdx,Rt?.turnIdx]),d.useEffect(()=>{try{r&&r.connected?r.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:pe}):S.current&&S.current.readyState===WebSocket.OPEN&&S.current.send(JSON.stringify({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:pe}))}catch{}},[pe,r?.connected]),d.useEffect(()=>{const h=j=>{const N=j?.detail?.roomId;N&&(o(N),r?r.send({type:"spectate",roomId:N}):S.current?.send(JSON.stringify({type:"spectate",roomId:N})),Qe(!0),Qt(!1))};return window.addEventListener("ndn:spectate-room",h),()=>window.removeEventListener("ndn:spectate-room",h)},[r]);function Bn(){if(r){r.connected&&(r.send({type:"join",roomId:i}),r.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:pe}),r.send({type:"list-matches"}),m(!0));return}try{if(S.current&&(S.current.readyState===WebSocket.OPEN||S.current.readyState===WebSocket.CONNECTING))return}catch{}const h="ws://localhost:8787",j=window.location.protocol==="https:"?"wss":"ws",N=window.location.hostname,R=`${j}://${N}${window.location.port?"":":8787"}`,Q=h.length>0?h:R,de=new WebSocket(Q);S.current=de,de.onopen=()=>{m(!0),E.current=0,v.current?s("Reconnected to lobby",{type:"success"}):(s("Connected to lobby",{type:"success"}),v.current=!0),de.send(JSON.stringify({type:"join",roomId:i})),de.send(JSON.stringify({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:pe})),de.send(JSON.stringify({type:"list-matches"}))},de.onmessage=ae=>{const V=JSON.parse(ae.data);if(V.type==="state"){b.importState(V.payload);const Fe=Number(V.payload._dpIndex),ns=Number(V.payload._dpHits);Number.isFinite(Fe)&&Pe(Math.max(0,Fe)),Number.isFinite(ns)&&k(Math.max(0,ns));const fs=Number(V.payload._atcIndex),Ms=Number(V.payload._atcHits);Number.isFinite(fs)&&gt(Math.max(0,fs)),Number.isFinite(Ms)&&Dt(Math.max(0,Ms));try{const Re=Number(V.payload._trebleTarget),Vn=Number(V.payload._trebleHits),ca=Number(V.payload._trebleDarts),Gn=Number(V.payload._trebleMaxDarts);Number.isFinite(Re)&&Ht(Math.max(1,Math.min(20,Re))),Number.isFinite(Vn)&&as(Math.max(0,Vn)),Number.isFinite(ca)&&Wt(Math.max(0,ca)),Number.isFinite(Gn)&&As(Math.max(0,Gn))}catch{}try{const Re=V.payload._cricketById;Re&&typeof Re=="object"&&ds(Re)}catch{}try{const Re=V.payload._shanghaiById;Re&&typeof Re=="object"&&ys(Re)}catch{}try{const Re=V.payload._halveById;Re&&typeof Re=="object"&&rs(Re)}catch{}try{const Re=V.payload._highlowById;Re&&typeof Re=="object"&&us(Re)}catch{}try{const Re=V.payload._killerById;Re&&typeof Re=="object"&&z(Re)}catch{}try{const Re=V.payload._amCricketById;Re&&typeof Re=="object"&&me(Re)}catch{}try{const Re=V.payload._baseballById;Re&&typeof Re=="object"&&q(Re)}catch{}try{const Re=V.payload._golfById;Re&&typeof Re=="object"&&$(Re)}catch{}try{const Re=V.payload._tttState;Re&&typeof Re=="object"&&je(Re)}catch{}try{const Re=Number(V.payload._turnDarts);Number.isFinite(Re)&&fe(Math.max(0,Re))}catch{}try{const Re=V.payload._x01DoubleIn;typeof Re=="boolean"&&qt(Re)}catch{}}else if(V.type==="joined")V.id&&A(V.id);else if(V.type==="presence"||V.type==="peer-joined")Ae(Fe=>{const ns=new Set(Fe);return V.id&&ns.add(V.id),Array.from(ns)});else if(V.type==="chat"){const Fe=!!(V.from&&I&&V.from===I),ns=Fe?t?.username||"me":V.from||"peer",fs=String(V.from||"");if(!Fe&&fs&&n.isBlocked(fs))return;if(Fe&&w.current&&String(V.message||"")===w.current.text){w.current=null;return}u(Ms=>[...Ms,{from:ns,message:V.message,fromId:fs||void 0}])}else if(V.type==="matches")js(Array.isArray(V.matches)?V.matches:[]);else if(V.type==="invite")Oe({matchId:V.matchId,fromId:V.fromId,fromName:V.fromName,calibrated:!!V.calibrated,boardPreview:V.boardPreview||null,game:V.game,mode:V.mode,value:V.value,startingScore:V.startingScore});else if(V.type==="match-start")o(V.roomId),de.send(JSON.stringify({type:"join",roomId:V.roomId})),Qe(!0),Qt(!1),V.match?.game&&Js(V.match.game),t?.username&&!t?.fullAccess&&qi(t.username);else if(V.type==="declined")s("Invite declined",{type:"info"});else if(V.type==="error"){const Fe=typeof V.message=="string"?V.message:"Action not allowed";if($e(Fe),V.code==="SPECTATE_NOT_ALLOWED")try{s("This player has spectating turned off.",{type:"error"})}catch{}V.code==="NOT_FOUND"&&Ke&&St({game:Ke.game,mode:Ke.mode,value:Ke.value,startingScore:Ke.startingScore}),setTimeout(()=>$e(""),3500)}else if(V.type==="friend-invite")confirm(`${V.fromName||V.fromEmail} invited you to play ${V.game||"X01"} (${V.mode==="firstto"?"First To":"Best Of"} ${V.value||1}). Accept?`)?de.send(JSON.stringify({type:"start-friend-match",toEmail:V.fromEmail,game:V.game,mode:V.mode,value:V.value,startingScore:V.startingScore})):s("Invite declined",{type:"info"});else if(V.type==="friend-message")_.add({id:V.id||`${V.ts}-${V.from}`,from:V.from,message:V.message,ts:V.ts||Date.now()}),b.inProgress||s(`${V.from}: ${V.message}`,{type:"info"});else if(V.type==="celebration"){const Fe=V.by||"Player",ns=V.kind==="leg"?"leg":"180";Jt(ns,Fe)}else if(V.type==="cam-code")console.log("Received cam-code:",V.code),Ps(V.code),s(`Pairing code: ${V.code}`,{type:"info"});else if(V.type==="cam-peer-joined")console.log("Mobile peer joined for code:",V.code),Ta(V.code);else if(V.type==="cam-answer"){console.log("Received cam-answer");const Fe=window.mobilePC;Fe&&Fe.setRemoteDescription(new RTCSessionDescription(V.payload))}else if(V.type==="cam-ice"){console.log("Received cam-ice");const Fe=window.mobilePC;Fe&&Fe.addIceCandidate(V.payload)}},de.onclose=()=>{if(m(!1),!F.current)return;const ae=(E.current||0)+1;E.current=ae;const V=Math.min(3e4,1e3*Math.pow(2,ae-1)),Fe=Date.now();Fe-D.current>4e3&&(s(`Disconnected. Reconnecting in ${Math.round(V/1e3)}s...`,{type:"error"}),D.current=Fe),M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{Bn()},V)}}function bn(){const h=b.players||[],j=b.currentPlayerIdx||0,N=h[j],R=N?.legs?.[N?.legs?.length-1],Q=R?R.totalScoreRemaining:b.startingScore,de=R?.dartsThrown||0,ae=R?R.totalScoreStart-R.totalScoreRemaining:0,V=de>0?ae/de*3:0,Fe=R?.visits?.[R.visits.length-1]?.score??0;let ns="Ã”Ã‡Ã¶";h.length===2?ns=`${h[0]?.legsWon||0}-${h[1]?.legsWon||0}`:h.length>2&&(ns=h.map(Us=>`${Us.name}:${Us.legsWon||0}`).join(" = "));const fs=b.bestLegThisMatch,Ms=fs?`${fs.darts} darts${(()=>{const Us=h.find(hi=>hi.id===fs.playerId);return Us?` (${Us.name})`:""})()}`:"-",Vn=(Us=>{switch(Us){case"small":return"text-xs";case"large":return"text-base";default:return"text-sm"}})(ge),Gn=(Us=>{switch(Us){case"small":return"p-2";case"large":return"p-4";default:return"p-3"}})(oe);return e.jsxs("div",{className:`${Gn} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${Vn}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:ns}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold",children:N?.name||"Ã”Ã‡Ã¶"}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-lg",children:Q}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:V.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:Fe}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:Ms})]})]})}d.useEffect(()=>{if(!r)return;m(r.connected);const h=r.addListener(j=>{try{if(j.type==="state"){b.importState(j.payload);try{const N=Number(j.payload._dpIndex),R=Number(j.payload._dpHits);Number.isFinite(N)&&Pe(Math.max(0,N)),Number.isFinite(R)&&k(Math.max(0,R))}catch{}try{const N=Number(j.payload._atcIndex),R=Number(j.payload._atcHits);Number.isFinite(N)&&gt(Math.max(0,N)),Number.isFinite(R)&&Dt(Math.max(0,R))}catch{}try{const N=j.payload._cricketById;N&&typeof N=="object"&&ds(N)}catch{}try{const N=j.payload._shanghaiById;N&&typeof N=="object"&&ys(N)}catch{}try{const N=j.payload._halveById;N&&typeof N=="object"&&rs(N)}catch{}try{const N=j.payload._highlowById;N&&typeof N=="object"&&us(N)}catch{}try{const N=j.payload._killerById;N&&typeof N=="object"&&z(N)}catch{}try{const N=j.payload._amCricketById;N&&typeof N=="object"&&me(N)}catch{}try{const N=j.payload._baseballById;N&&typeof N=="object"&&q(N)}catch{}try{const N=j.payload._golfById;N&&typeof N=="object"&&$(N)}catch{}try{const N=j.payload._tttState;N&&typeof N=="object"&&je(N)}catch{}try{const N=Number(j.payload._turnDarts);Number.isFinite(N)&&fe(Math.max(0,N))}catch{}try{const N=!!j.payload._paused;tt(N)}catch{}try{const N=Number(j.payload._pauseEndsAt);hs(Number.isFinite(N)?N:null)}catch{}try{const N=j.payload._pauseRequestedBy;ht(typeof N=="string"?N:null)}catch{}try{const N=j.payload._pauseAcceptedBy;N&&typeof N=="object"&&Bt(N)}catch{}try{const N=Number(j.payload._pauseDurationSec);Number.isFinite(N)&&Mt(Math.max(60,Math.min(600,N)))}catch{}try{const N=j.payload._x01DoubleIn;typeof N=="boolean"&&qt(N)}catch{}Rs(!!j.payload._paused,Number(j.payload._pauseEndsAt)||null)}else if(j.type==="joined")j.id&&A(j.id);else if(j.type==="presence"||j.type==="peer-joined")Ae(N=>Array.from(new Set([...N||[],j.id].filter(Boolean))));else if(j.type==="chat"){const N=!!(j.from&&I&&j.from===I),R=N?t?.username||"me":j.from||"peer",Q=String(j.from||"");if(!N&&Q&&n.isBlocked(Q))return;u(de=>[...de,{from:R,message:j.message,fromId:Q||void 0}])}else if(j.type==="matches")js(Array.isArray(j.matches)?j.matches:[]);else if(j.type==="invite")Oe({matchId:j.matchId,fromId:j.fromId,fromName:j.fromName,calibrated:!!j.calibrated,boardPreview:j.boardPreview||null,game:j.game,mode:j.mode,value:j.value,startingScore:j.startingScore});else if(j.type==="match-start")o(j.roomId),r.send({type:"join",roomId:j.roomId}),Qe(!0),Qt(!1),j.match?.game&&Js(j.match.game),t?.username&&!t?.fullAccess&&qi(t.username);else if(j.type==="declined")s("Invite declined",{type:"info"});else if(j.type==="error"){const N=typeof j.message=="string"?j.message:"Action not allowed";if($e(N),j.code==="SPECTATE_NOT_ALLOWED")try{s("This player has spectating turned off.",{type:"error"})}catch{}j.code==="NOT_FOUND"&&Ke&&St({game:Ke.game,mode:Ke.mode,value:Ke.value,startingScore:Ke.startingScore}),setTimeout(()=>$e(""),3500)}else if(j.type==="friend-invite")confirm(`${j.fromName||j.fromEmail} invited you to play ${j.game||"X01"} (${j.mode==="firstto"?"First To":"Best Of"} ${j.value||1}). Accept?`)?r.send({type:"start-friend-match",toEmail:j.fromEmail,game:j.game,mode:j.mode,value:j.value,startingScore:j.startingScore}):s("Invite declined",{type:"info"});else if(j.type==="friend-message")_.add({id:j.id||`${j.ts}-${j.from}`,from:j.from,message:j.message,ts:j.ts||Date.now()}),b.inProgress||s(`${j.from}: ${j.message}`,{type:"info"});else if(j.type==="celebration"){const N=j.by||"Player",R=j.kind==="leg"?"leg":"180";Jt(R,N)}}catch{}});return r.connected&&(r.send({type:"join",roomId:i}),r.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:pe}),r.send({type:"list-matches"})),()=>{h()}},[r?.connected]);function We(){if(r){r.send({type:"state",payload:{...b,_turnIdx:le,_participants:ut,_dpIndex:qe,_dpHits:ve,_atcIndex:Se,_atcHits:Ze,_trebleTarget:nt,_trebleHits:Yt,_trebleDarts:Ct,_trebleMaxDarts:it,_x01DoubleIn:Xt,_cricketById:Pt,_shanghaiById:Tt,_halveById:vs,_highlowById:ms,_killerById:L,_amCricketById:re,_baseballById:P,_golfById:U,_tttState:H,_turnDarts:ne,_paused:Ce,_pauseEndsAt:Gt,_pauseRequestedBy:vt,_pauseAcceptedBy:wt,_pauseDurationSec:Zt}});return}const h=S.current;!h||h.readyState!==WebSocket.OPEN||h.send(JSON.stringify({type:"state",payload:{...b,_turnIdx:le,_participants:ut,_dpIndex:qe,_dpHits:ve,_atcIndex:Se,_atcHits:Ze,_trebleTarget:nt,_trebleHits:Yt,_trebleDarts:Ct,_trebleMaxDarts:it,_x01DoubleIn:Xt,_cricketById:Pt,_shanghaiById:Tt,_halveById:vs,_highlowById:ms,_killerById:L,_amCricketById:re,_baseballById:P,_golfById:U,_tttState:H,_turnDarts:ne,_paused:Ce,_pauseEndsAt:Gt,_pauseRequestedBy:vt,_pauseAcceptedBy:wt,_pauseDurationSec:Zt}}))}function Un(h){const j=t?.username||"me";if(u(R=>[...R,{from:j,message:h,fromId:I||"self"}]),w.current={text:h,ts:Date.now()},r){r.send({type:"chat",message:h});return}const N=S.current;!N||N.readyState!==WebSocket.OPEN||N.send(JSON.stringify({type:"chat",message:h}))}function gn(h){if(ti(h,qe)){const N=ve+1,R=qe+1;k(N),Pe(R);try{if(N>=Ds.length){const Q=b.players[b.currentPlayerIdx]?.name||"Player";Jt("leg",Q),k(0),Pe(0)}}catch{}}We()}function yn(){const h=Math.max(0,Math.floor(te|0));gn(h),X(0)}function vn(){const h=Gs(ee);h!=null&&(gn(h),et(""))}function Na(h,j,N){const R=_t[Se];return R==null?!1:typeof N=="number"&&N>=1&&N<=20&&N===R&&(j==="SINGLE"||j==="DOUBLE"||j==="TRIPLE")?!0:R===25?j==="BULL"||h===25:R===50?j==="INNER_BULL"||h===50:h===R||h===R*2||h===R*3}function $n(h,j,N){if(Na(h,j,N)){const R=Ze+1,Q=Se+1;Dt(R),gt(Q);try{if(R>=_t.length){const de=b.players[b.currentPlayerIdx]?.name||"Player";Jt("leg",de),Dt(0),gt(0)}}catch{}}We()}function wa(){const h=Math.max(0,Math.floor(te|0));$n(h),X(0)}function Fn(){const h=Gs(st);h!=null&&($n(h),cs(""))}function aa(h,j,N){if(it>0&&Ct>=it)return;(j==="TRIPLE"&&N===nt||!j&&h===nt*3)&&as(Q=>Q+1),Wt(Q=>{const de=Q+1;if(de%3===0&&[20,19,18].includes(nt)){const ae=[20,19,18],V=ae.indexOf(nt),Fe=ae[(V+1)%ae.length];Ht(Fe)}return de}),We()}function _n(){const h=Math.max(0,Math.floor(te|0));aa(h),X(0)}function Sa(){const h=Gs(at);h!=null&&(aa(h),gs(""))}function Hn(){as(0),Wt(0)}function ct(){return b.players[b.currentPlayerIdx]?.id??String(b.currentPlayerIdx)}function jn(h){Pt[h]||ds(j=>({...j,[h]:Tn()}))}function ra(h){Tt[h]||ys(j=>({...j,[h]:tn()}))}function Nn(h){vs[h]||rs(j=>({...j,[h]:sn()}))}function ia(h){ms[h]||us(j=>({...j,[h]:nn()}))}function wn(h){if(!L[h]){const j=new Set(Object.values(L||{}).map(Q=>Q.number)),N=[];for(let Q=1;Q<=20;Q++)j.has(Q)||N.push(Q);const R=N.length>0?N[Math.floor(Math.random()*N.length)]:20;z(Q=>({...Q,[h]:Io(R,3)}))}}function Ca(h){re[h]||me(j=>({...j,[h]:ga()}))}function la(h){P[h]||q(j=>({...j,[h]:xa()}))}function ka(h){U[h]||$(j=>({...j,[h]:pa()}))}d.useEffect(()=>{fe(0)},[b.currentPlayerIdx,Ee]);function Ea(h,j){const N=b.players.filter(R=>R.id!==j);return N.length===0?!1:N.every(R=>(Pt[R.id]?.marks?.[h]||0)>=3)}function Sn(h,j,N){const R=ct();jn(R),ds(de=>{const ae={...de},V={...ae[R]||Tn()};return wo(V,h,j,N,Fe=>Ea(Fe,R)),ae[R]=V,ae});const Q=ne+1;fe(Q),Q>=3&&(fe(0),b.nextPlayer()),We()}function zs(h,j,N){const R=ct();ra(R),ys(de=>{const ae={...de},V={...ae[R]||tn()};return So(V,h,j,N),ae[R]=V,ae});const Q=ne+1;fe(Q),Q>=3&&(ys(de=>{const ae={...de},V={...ae[R]||tn()};return Co(V),ae[R]=V,ae}),fe(0),b.nextPlayer()),We()}function Lt(h,j,N){const R=ct();Nn(R),rs(de=>{const ae={...de},V={...ae[R]||sn()};return ko(V,h,j,N),ae[R]=V,ae});const Q=ne+1;fe(Q),Q>=3&&(rs(de=>{const ae={...de},V={...ae[R]||sn()};return Eo(V),ae[R]=V,ae}),fe(0),b.nextPlayer()),We()}function It(h,j,N){const R=ct();ia(R),us(de=>{const ae={...de},V={...ae[R]||nn()};return To(V,h,j,N),ae[R]=V,ae});const Q=ne+1;fe(Q),Q>=3&&(us(de=>{const ae={...de},V={...ae[R]||nn()};return Mo(V),ae[R]=V,ae}),fe(0),b.nextPlayer()),We()}function Ks(h,j){const N=ct();b.players.forEach(Q=>wn(Q.id)),z(Q=>{const de={};for(const[V,Fe]of Object.entries(Q))de[V]={...Fe};si(N,de,h,j);const ae=ni(de);if(ae)try{Jt("leg",b.players.find(V=>V.id===ae)?.name||"Player")}catch{}return de});const R=ne+1;fe(R),R>=3&&(fe(0),b.nextPlayer()),We()}function Wn(h,j,N){const R=ct();Ca(R),me(de=>{const ae={...de},Fe={...ae[R]||ga()};return Lo(Fe,h,j,N,fs=>b.players.filter(Ms=>Ms.id!==R).every(Ms=>(re[Ms.id]?.marks?.[fs]||0)>=3)),ae[R]=Fe,ae});const Q=ne+1;fe(Q),Q>=3&&(fe(0),b.nextPlayer()),We()}function oa(h,j,N){const R=ct();la(R),q(de=>{const ae={...de},V={...ae[R]||xa()};return Do(V,h,j,N),ae[R]=V,ae});const Q=ne+1;fe(Q),Q>=3&&(fe(0),b.nextPlayer()),We()}function qn(h,j,N){const R=ct();ka(R),$(de=>{const ae={...de},V={...ae[R]||pa()};return Po(V,h,j,N),ae[R]=V,ae});const Q=ne+1;fe(Q),Q>=3&&(fe(0),b.nextPlayer()),We()}function Cn(h,j,N,R){je(de=>{const ae={...de,board:[...de.board]};return Ro(ae,h,j,N,R),ae});const Q=ne+1;fe(Q),Q>=3&&(fe(0),b.nextPlayer()),We()}function zn(){try{window.dispatchEvent(new Event("ndn:open-manual"))}catch{}}function Ys(h){const j=Math.max(0,h|0);b.addVisit(j,3),X(0);const N=b.players[b.currentPlayerIdx],R=N.legs[N.legs.length-1];try{j===180&&Jt("180",N?.name||"Player"),R&&R.totalScoreRemaining===0&&Jt("leg",N?.name||"Player")}catch{}if(R&&R.totalScoreRemaining===0?b.endLeg(j):b.nextPlayer(),T){const Q=R?R.totalScoreRemaining:b.startingScore;Zn(t?.username||"Player",j,Math.max(0,Q),W,{volume:C,checkoutOnly:Y})}t?.username&&N?.name===t.username&&en(t.username,3,j),We()}function Ka(h,j){const N={type:"report",offenderId:h,reason:"Inappropriate language",message:j};try{r?r.send(N):S.current?.send(JSON.stringify(N))}catch{}try{s("Report submitted",{type:"info"})}catch{}}async function Ya(){try{const h=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),j=h.getVideoTracks?.()[0],N=document.createElement("video");N.srcObject=h,await N.play().catch(()=>{}),await new Promise(Fe=>setTimeout(Fe,120));const R=Math.min(320,N.videoWidth||320),Q=Math.max(1,Math.floor((N.videoHeight||180)*(R/Math.max(1,N.videoWidth||320)))),de=document.createElement("canvas");de.width=R,de.height=Q,de.getContext("2d").drawImage(N,0,0,R,Q);const V=de.toDataURL("image/jpeg",.7);try{j&&j.stop()}catch{}try{h.getTracks?.().forEach(Fe=>Fe.stop())}catch{}return V}catch{return null}}const Ta=async h=>{console.log("Starting WebRTC for code:",h);try{const j=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});j.ontrack=R=>{console.log("Received track:",R.streams[0]),he(R.streams[0]),yt.current&&(yt.current.srcObject=R.streams[0],console.log("Set video srcObject"))},j.onicecandidate=R=>{R.candidate&&(console.log("Sending ICE candidate"),r?r.send({type:"cam-ice",code:h,payload:R.candidate}):S.current&&S.current.readyState===WebSocket.OPEN&&S.current.send(JSON.stringify({type:"cam-ice",code:h,payload:R.candidate})))},j.onconnectionstatechange=()=>console.log("Connection state:",j.connectionState);const N=await j.createOffer();if(await j.setLocalDescription(N),console.log("Sending offer"),r)console.log("Sending offer via wsGlobal"),r.send({type:"cam-offer",code:h,payload:N});else if(S.current&&S.current.readyState===WebSocket.OPEN)console.log("Sending offer via wsRef"),S.current.send(JSON.stringify({type:"cam-offer",code:h,payload:N}));else{console.log("WS not available, POSTing offer to /cam/signal");try{await kt(`/cam/signal/${h}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"cam-offer",payload:N,source:"desktop"})})}catch(R){console.warn("REST offer failed",R)}}window.mobilePC=j}catch(j){console.error("WebRTC error:",j),s("Failed to start mobile camera",{type:"error"})}};return e.jsxs("div",{className:"card flex flex-col min-h-[85vh] relative overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Online Play"}),Ce&&e.jsxs("div",{className:"absolute inset-0 z-40 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold mb-2",children:"Game Paused"}),e.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Resumes ",Gt?`in ${Math.max(0,Math.ceil((Gt-Date.now())/1e3))}s`:"soon"]}),e.jsx("div",{className:"text-xs opacity-60",children:"Both players can see this pause screen."})]}),On>0&&!b.inProgress&&e.jsxs("div",{className:"mb-3 text-sm px-3 py-2 rounded bg-amber-600/30 border border-amber-500/40",children:["You have ",On," unread message",On>1?"s":"",". Check the Friends tab."]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs opacity-70 shrink-0",children:"Room"}),e.jsx("input",{className:"input w-28",value:i,onChange:h=>o(h.target.value),placeholder:"room-1"})]}),l?e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0",children:"Connected"}):e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 shrink-0",onClick:Bn,children:"Connect"}),e.jsx("button",{className:"btn shrink-0",onClick:We,disabled:!l,children:"Sync"}),!Ce&&!vt&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs opacity-70",children:"Pause (max 10m)"}),e.jsxs("select",{className:"input w-28",value:Zt,onChange:h=>Mt(Math.max(60,Math.min(600,parseInt(h.target.value)||300))),children:[e.jsx("option",{value:120,children:"2 min"}),e.jsx("option",{value:300,children:"5 min"}),e.jsx("option",{value:600,children:"10 min"})]}),e.jsx("button",{className:"btn",disabled:!l,onClick:()=>{const h=t?.username||"player";ht(h),Bt({[h]:!0}),tt(!1),hs(null),We()},children:"Request Pause"})]}),!Ce&&vt&&!wt[t?.username||""]&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"opacity-80",children:[vt," requested a ",Math.round((Zt||300)/60),"m pause"]}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{const h=t?.username||"",j={...wt,[h]:!0};Bt(j);const N=Object.keys(j).filter(Q=>j[Q]).length,R=Math.max(2,ut?.length||2);if(N>=2||N>=R){const Q=Date.now()+Math.min(600,Math.max(60,Zt||300))*1e3;tt(!0),hs(Q),Rs(!0,Q)}We()},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>{ht(null),Bt({}),tt(!1),hs(null),Rs(!1,null),We()},children:"Decline"})]}),Ce&&e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-yellow-500/25 text-yellow-100 border border-yellow-400/40 shrink-0",children:["Paused Â· ",Math.max(0,Math.ceil(((Gt||Date.now())-Date.now())/1e3)),"s"]}),e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40 shrink-0",title:"Open a simulated online match demo",onClick:()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch{}},children:"DEMO"}),l&&e.jsx("button",{className:"btn shrink-0",onClick:()=>Qe(!0),disabled:Ft,title:Ft?"Weekly free games used":"",children:"Open Match"})]})}),e.jsx("div",{className:`mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end ${!l||Ft?"opacity-60 cursor-not-allowed":"cursor-pointer"}`,role:"button",title:l?Ft?"Weekly free games used":"Create a new match":"Connect to the lobby first",onClick:()=>{!l||Ft||(Qt(!0),r?r.send({type:"list-matches"}):S.current?.send(JSON.stringify({type:"list-matches"})))},children:e.jsx("button",{className:"btn",disabled:!l||Ft,children:"Create Match +"})}),e.jsx("p",{className:"text-sm text-slate-600 mt-3",children:"Open this app on another device and join the same Room ID to sync scores."}),!t?.fullAccess&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Weekly free online games remaining: ",ks===1/0?"Ã”Ã‡Ã¶":ks]}),!t?.fullAccess&&ks!==1/0&&ks<=0&&e.jsx("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm",children:"You've used your 3 free online games this week. PREMIUM required to continue."}),Je&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"material-icons text-rose-300",children:"error_outline"}),Je]}),Nt&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-700/30 border border-indigo-600/40 text-indigo-100 text-sm flex items-center justify-between gap-2",children:[e.jsx("div",{children:"That room is full or no longer available. Create a new clean room with the same settings?"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const{game:h,mode:j,value:N,startingScore:R}=Nt,Q=t?.username?an(t.username):0;r?(r.send({type:"create-match",game:h,mode:j,value:N,startingScore:R||501,creatorAvg:Q}),r.send({type:"list-matches"})):(S.current?.send(JSON.stringify({type:"create-match",game:h,mode:j,value:N,startingScore:R||501,creatorAvg:Q})),S.current?.send(JSON.stringify({type:"list-matches"}))),St(null)},children:"Create New Match"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>St(null),children:"Dismiss"})]})]}),l&&e.jsxs("div",{className:"mt-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10 flex-1 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"World Lobby"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs opacity-80",children:["Matches: ",pn.length]}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>r?r.send({type:"list-matches"}):S.current?.send(JSON.stringify({type:"list-matches"})),children:"Refresh"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",title:l?Ft?"Weekly free games used":"Create a new match":"Connect to the lobby first",disabled:!l||Ft,onClick:()=>{!l||Ft||(Qt(!0),r?r.send({type:"list-matches"}):S.current?.send(JSON.stringify({type:"list-matches"})))},children:"Create Match +"})]})]}),e.jsxs("div",{className:"space-y-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Mode"}),e.jsx(Ja,{tabs:[{key:"all",label:"All"},{key:"bestof",label:"Best of"},{key:"firstto",label:"First to"}],active:dn,onChange:h=>mn(h)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Game"}),e.jsxs("select",{className:"input w-full",value:Ts,onChange:h=>Pn(h.target.value),children:[e.jsx("option",{value:"all",children:"All"}),ta.map(h=>e.jsx("option",{value:h,children:h},h))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Starting Score"}),e.jsxs("select",{className:"input w-full",value:un,onChange:h=>{const j=h.target.value;Es(j==="all"?"all":Number(j))},disabled:Ts!=="all"&&Ts!=="X01",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"301",children:"301"}),e.jsx("option",{value:"501",children:"501"}),e.jsx("option",{value:"701",children:"701"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Opponent near my avg"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"nearavg",type:"checkbox",className:"accent-purple-500",checked:Bs,onChange:h=>Rn(h.target.checked),disabled:!xn}),e.jsx("label",{htmlFor:"nearavg",className:"cursor-pointer text-sm",children:"Near my average"}),e.jsx("input",{className:"input w-24",type:"number",min:5,max:40,step:1,value:hn,onChange:h=>fn(parseInt(h.target.value||"10")),disabled:!Bs})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 max-w-sm",children:[e.jsx("label",{className:`block text-xs opacity-70 mb-1 ${Bs?"":"opacity-40"}`,children:"Avg tolerance (Â±)"}),e.jsx("input",{className:"w-full",type:"range",min:1,max:50,value:hn,onChange:h=>fn(parseInt(h.target.value||"10")),disabled:!Bs}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["Â± ",hn]})]}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{mn("all"),Pn("all"),Es("all"),Rn(!1),fn(10)},children:"Reset"})]})]}),pn.length===0?e.jsx("div",{className:"text-sm text-slate-300",children:"No games waiting. Create one!"}):e.jsx("div",{className:"space-y-2",children:pn.map(h=>e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 flex items-center justify-between relative",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[h.game||"X01"," ",h.game==="X01"?` ${h.startingScore}`:""," - ",h.mode==="bestof"?`Best Of ${h.value}`:`First To ${h.value}`," - Created by ",h.creatorName]}),h.requireCalibration&&e.jsx("div",{className:"text-[11px] inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-600/30 mt-1",children:"Calibration required"}),h.creatorAvg?e.jsxs("div",{className:"text-xs opacity-70",children:["Creator avg: ",Number(h.creatorAvg).toFixed(1)]}):null,e.jsxs("div",{className:"text-xs opacity-70",children:["ID: ",h.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm bg-green-600 hover:bg-green-700",disabled:Ft||!t?.fullAccess&&Zs.includes(h.game)||!!h.requireCalibration&&!Ln,title:!t?.fullAccess&&Zs.includes(h.game)?"PREMIUM game":Ft?"Weekly free games used":h.requireCalibration&&!Ln?"Calibration required":"",onClick:async()=>{pt({game:h.game,mode:h.mode,value:h.value,startingScore:h.startingScore});const j=!!Ln,N=await Ya();try{r?r.send({type:"join-match",matchId:h.id,calibrated:j,boardPreview:N}):S.current?.send(JSON.stringify({type:"join-match",matchId:h.id,calibrated:j,boardPreview:N}))}catch(R){$t(R?.message||"Failed to create Stripe checkout session. Please try again later.")}},children:"Join Now!"}),I&&h.creatorId===I&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Close this match",onClick:()=>{r?r.send({type:"cancel-match",matchId:h.id}):S.current?.send(JSON.stringify({type:"cancel-match",matchId:h.id}))},"aria-label":"Close match",children:"Ã—"})]})]},h.id))})]}),!t?.fullAccess&&ks!==1/0&&ks<=0&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"Â­Æ’Ã¶Ã†"}),e.jsx("div",{className:"font-semibold",children:"Online play locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"YouÃ”Ã‡Ã–ve used your 3 free online games this week. Upgrade to PREMIUM to play all modes."}),e.jsxs("button",{onClick:async()=>{try{const j=await(await fetch(`${a}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t?.email})})).json();j.ok&&j.url?window.location.href=j.url:alert("Failed to create payment session: "+(j.error||"Unknown error"))}catch{alert("Network error")}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM = ",to(so(),5)]})]})]}),Kt&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-2 md:p-3 flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:"Online Match"})}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>Qe(!1),children:"Close"})]}),e.jsx("div",{className:"relative flex-1 overflow-hidden p-2 md:p-3",children:e.jsxs("div",{className:"card w-full h-full overflow-hidden relative p-2.5 md:p-3",children:[Rt&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-start justify-center pt-8 z-20",children:[e.jsxs("div",{className:`px-4 py-2 rounded-full text-lg font-bold shadow ${Rt.kind==="leg"?"bg-indigo-500/20 border border-indigo-400/40 text-indigo-100":"bg-emerald-500/20 border border-emerald-400/40 text-emerald-100"}`,children:[Rt.kind==="leg"?"Â­Æ’Ã…Ã¼ LEG WON Ã”Ã‡Ã¶ ":"Â­Æ’Ã„Â» ONE HUNDRED AND EIGHTY! Ã”Ã‡Ã¶ ",Rt.by]}),Rt.kind==="leg"&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:"@keyframes ndn-confetti-fall{0%{transform:translateY(-10%) rotate(0deg);opacity:1}100%{transform:translateY(120%) rotate(360deg);opacity:0}}"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(24)].map((h,j)=>{const N=Math.random()*100,R=Math.random()*.2,Q=1.2+Math.random()*.8,de=6+Math.random()*6,ae=Math.floor(Math.random()*360);return e.jsx("span",{style:{position:"absolute",top:0,left:N+"%",width:de,height:de,background:`hsl(${ae} 90% 60%)`,borderRadius:2,animation:`ndn-confetti-fall ${Q}s ease-out ${R}s forwards`}},j)})})]})]}),e.jsxs("div",{className:"mb-1.5 text-xs md:text-sm flex items-center justify-between gap-2",children:[e.jsxs("span",{children:["Participants: ",ut.length||1]}),e.jsx("button",{className:"text-[11px] px-2 py-0.5 rounded-full bg-slate-700/50 hover:bg-slate-700 border border-slate-600",onClick:()=>is(h=>!h),title:ft?"Switch to full multi-player view":"Switch to compact player-by-player view",children:ft?"Full view":"Compact view"})]}),(()=>{const h=b.players?.[0]?.legsWon||0,j=b.players?.[1]?.legsWon||0;return e.jsxs("div",{className:"mb-2 flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10 text-white",children:["Legs: ",h,"â€“",j]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Match"}),e.jsxs("select",{className:`btn ${Le}`,value:se,onChange:N=>ye(N.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${Le} w-[7.5rem]`,value:be,onChange:N=>De(N.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${Le} w-[7.5rem]`,value:Ge,onChange:N=>Te(N.target.value),placeholder:"Team B"})]})]})})(),ft?e.jsxs("div",{className:"mb-3",children:[(()=>{const h=b.currentPlayerIdx,j=b.players[h];if(!j)return null;const N=j.legs[j.legs.length-1],R=N?N.totalScoreRemaining:b.startingScore,Q=t?.username&&j.name===t.username,de=N&&N.visits.length?N.visits[N.visits.length-1].score:0,ae=N?N.dartsThrown:0,V=ae>0?((N?.totalScoreStart??b.startingScore)-R)/ae*3:0;return Ee==="X01"?e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${h===b.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${h===b.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:h===b.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-4xl font-extrabold",children:R}),e.jsxs("div",{className:"text-sm mt-1",children:["Last score: ",e.jsx("span",{className:"font-semibold",children:de})]}),e.jsxs("div",{className:"text-sm",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:V.toFixed(1)})]}),Q&&h===b.currentPlayerIdx&&R<=170&&R>0&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",J,"): ",Fa(R,J).join("  Ã”Ã‡Ã³  ")||"Ã”Ã‡Ã¶"]})]}):e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${h===b.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${h===b.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:h===b.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-sm opacity-80",children:Ee}),Ee==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Ds[qe]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[ve," / ",Ds.length]})]}),Ee==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:_t[Se]===25?"25 (Outer Bull)":_t[Se]===50?"50 (Inner Bull)":_t[Se]||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[Ze," / ",_t.length]})]}),Ee==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Treble Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:["T",nt]})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[Yt," / ",Ct]})]})]})})(),b.players.length>1&&e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Next up: ",b.players[(b.currentPlayerIdx+1)%b.players.length]?.name]})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-3 flex flex-wrap items-center gap-2",children:b.players.map((h,j)=>{const N=h.legs[h.legs.length-1],R=N?N.totalScoreRemaining:b.startingScore;return e.jsxs("div",{className:`px-2 py-1 rounded bg-black/20 border border-slate-700/40 text-xs ${j===b.currentPlayerIdx?"ring-1 ring-brand-400":""}`,children:[e.jsx("span",{className:"font-semibold",children:h.name}),Ee==="X01"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:R})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:Ee==="Double Practice"?`${ve}/${Ds.length}`:Ee==="Around the Clock"?`${Ze}/${_t.length}`:Ee==="Treble Practice"?`${Yt}/${Ct}`:Ee==="Cricket"?`${Pt[h.id]?.points||0} pts`:Ee==="Shanghai"?`${Tt[h.id]?.score||0} pts = R${Tt[h.id]?.round||1}`:Ee==="Halve It"?`${vs[h.id]?.score||0} pts = S${(vs[h.id]?.stage||0)+1}`:Ee==="High-Low"?`${ms[h.id]?.score||0} pts = ${ms[h.id]?.target||"HIGH"}`:Ee==="Killer"?(()=>{const Q=L[h.id];return Q?`#${Q.number} = ${Q.lives}Ã”Ã˜Ã± ${Q.isKiller?"= K":""}`:"Ã”Ã‡Ã¶"})():Ee==="American Cricket"?`${re[h.id]?.points||0} pts`:Ee==="Baseball"?(()=>{const Q=P[h.id];return Q?`R${Q.score} = I${Q.inning}`:"Ã”Ã‡Ã¶"})():Ee==="Golf"?(()=>{const Q=U[h.id];return Q?`S${Q.strokes} = H${Q.hole}`:"Ã”Ã‡Ã¶"})():Ee==="Tic Tac Toe"?(()=>{const Q=(H.board||[]).filter(ae=>ae==="X").length,de=(H.board||[]).filter(ae=>ae==="O").length;return`X${Q}-O${de}`})():Ee})]})]},`strip-${h.id}`)})})}),ft?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-col gap-2 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`btn ${Le}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${Le}`,onClick:zn,children:"Manual Correction"}),!Me&&e.jsx("button",{className:`btn ${Le}`,onClick:()=>{console.log("Sending cam-create"),r?r.send({type:"cam-create"}):S.current&&S.current.readyState===WebSocket.OPEN?S.current.send(JSON.stringify({type:"cam-create"})):s("Not connected to server",{type:"error"})},children:"Pair Phone"}),!Me&&zt&&e.jsxs("div",{className:"ml-2 text-sm bg-blue-900/50 p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Mobile pairing code: "}),e.jsx("span",{className:"font-mono font-bold text-lg",children:zt})]}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["On your phone, go to: ",e.jsxs("a",{href:`/mobile-cam.html?code=${zt}`,target:"_blank",className:"underline",children:[window.location.origin,"/mobile-cam.html?code=",zt]})]})]}),!Me&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[11px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam size"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>Ie(Math.max(.5,Math.round((ue-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${Le} min-w-[2.5rem] text-center`,children:[Math.round(ue*100),"%"]}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>Ie(Math.min(1.25,Math.round((ue+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Le}`,title:"Toggle fit/fill",onClick:()=>bt(xe==="fill"?"fit":"fill"),children:xe==="fill"?"Fill":"Fit"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 items-start",children:[e.jsx("div",{className:"order-1",children:e.jsx(bn,{})}),e.jsx("div",{className:"order-2",children:He?e.jsx("div",{className:"min-w-0 relative z-10",children:e.jsx(ea,{storageKey:"ndn:camera:tile:online:top",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:520,defaultHeight:320,minWidth:280,minHeight:200,maxWidth:1600,maxHeight:900,children:e.jsx(_a,{label:"Your Board",autoStart:t?.username&&b.players[b.currentPlayerIdx]?.name===t.username,aspect:"classic",fill:!0})})}):null})]}),e.jsxs("div",{className:"font-semibold",children:["Current: ",b.players[b.currentPlayerIdx]?.name||"Ã”Ã‡Ã¶"]}),Ee==="X01"&&He&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{x01DoubleInOverride:Xt,hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(h,j,N)=>{if(T){const Q=b.players[b.currentPlayerIdx],de=Q?.legs[Q.legs.length-1],ae=de?de.totalScoreRemaining:b.startingScore;Zn(t?.username||"Player",h,Math.max(0,ae),W,{volume:C,checkoutOnly:Y})}const R=b.players[b.currentPlayerIdx];t?.username&&R?.name===t.username&&en(t.username,j,h);try{h===180&&Jt("180",R?.name||"Player"),N&&Jt("leg",R?.name||"Player")}catch{}N||(ut?.length||0)>=2&&b.nextPlayer(),We()}}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>Ys(te),children:"Submit Visit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{b.undoVisit(),We()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-1.5 text-xs",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(h=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>Ys(h),children:h},h))]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 mb-2",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>g(!0),children:"Messages"})]})]}):Ee==="Double Practice"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Double Practice Ã”Ã‡Ã¶ Hit doubles D1Ã”Ã¥Ã†D20Ã”Ã¥Ã†DBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Ds[qe]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[ve," / ",Ds.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j)=>{(j==="DOUBLE"||j==="INNER_BULL")&&gn(h)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&yn()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:yn,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (D16, 50, 25, T20)",value:ee,onChange:h=>et(h.target.value),onKeyDown:h=>{h.key==="Enter"&&vn()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:vn,children:"Add"})]})]}):Ee==="Around the Clock"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Around the Clock Ã”Ã‡Ã¶ Hit 1Ã”Ã¥Ã†20 then 25 (outer) and 50 (inner)"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:_t[Se]===25?"25 (Outer Bull)":_t[Se]===50?"50 (Inner Bull)":_t[Se]||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Ze," / ",_t.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{$n(h,j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&wa()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:wa,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (T20, D5, 25, 50)",value:st,onChange:h=>cs(h.target.value),onKeyDown:h=>{h.key==="Enter"&&Fn()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Fn,children:"Add"})]})]}):Ee==="Treble Practice"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Treble Practice â€” Aim for triples only; count hits vs total darts"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Treble target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:["T",nt]})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Yt," / ",it>0?it:Ct]}),it>0&&Ct>=it&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:Hn,children:"Reset"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("span",{className:"opacity-70 text-xs",children:"Quick:"}),[20,19,18].map(h=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${nt===h?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>Ht(h),children:["T",h]},`tquick-${h}`)),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("select",{className:"input w-24 text-sm",value:nt,onChange:h=>Ht(parseInt(h.target.value,10)),children:Array.from({length:20},(h,j)=>j+1).map(h=>e.jsx("option",{value:h,children:h},h))}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:Hn,children:"Reset"})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{aa(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&_n()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:_n,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (T20)",value:at,onChange:h=>gs(h.target.value),onKeyDown:h=>{h.key==="Enter"&&Sa()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Sa,children:"Add"})]})]}):Ee==="Cricket"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Cricket Ã”Ã‡Ã¶ Close 15-20 and Bull; overflow scores points"}),(()=>{const h=ct();jn(h);const j=Pt[h]||Tn();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:ja.map(N=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:N===25?"Bull":N}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[N]||0)," / 3"]})]},N))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:Pt[ct()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{Sn(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Sn(Math.max(0,te|0)),X(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Sn(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="Shanghai"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();ra(h);const j=Tt[h]||tn();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Shanghai Ã”Ã‡Ã¶ Hit only the round's number; Single/Double/Triple score"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j.round})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{zs(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(zs(Math.max(0,te|0)),X(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{zs(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="Halve It"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();Nn(h);const j=vs[h]||sn(),N=Ha(j);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Halve It Ã”Ã‡Ã¶ Hit the target each round or your score halves"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[j.stage+1,"/",j.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const R=N;return R?R.kind==="ANY_NUMBER"?"Any":R.kind==="BULL"?"Bull":R.kind==="DOUBLE"||R.kind==="TRIPLE"||R.kind==="NUMBER"?`${R.kind} ${R.num}`:"Ã”Ã‡Ã¶":"Ã”Ã‡Ã¶"})()})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{Lt(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Lt(Math.max(0,te|0)),X(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Lt(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="High-Low"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();ia(h);const j=ms[h]||nn();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"High-Low Ã”Ã‡Ã¶ Alternate aiming for high then low segments"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j.round})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:j.target})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{It(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(It(Math.max(0,te|0)),X(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{It(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="American Cricket"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"American Cricket Ã”Ã‡Ã¶ Close 12-20 and Bull; overflow scores"}),(()=>{const h=ct();Ca(h);const j=re[h]||ga();return e.jsx("div",{className:"mb-2 grid grid-cols-5 gap-1 text-center text-[11px]",children:Ga.map(N=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:N===25?"Bull":N}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[N]||0)," / 3"]})]},N))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:re[ct()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{Wn(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Wn(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="Baseball"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();la(h);const j=P[h]||xa();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Baseball Ã”Ã‡Ã¶ Inning ",j.inning," Ã”Ã‡Ã³ Runs ",j.score]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{oa(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{oa(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="Golf"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();ka(h);const j=U[h]||pa();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Golf Ã”Ã‡Ã¶ Hole ",j.hole," (target ",Ao[j.hole],") Ã”Ã‡Ã³ Strokes ",j.strokes]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{qn(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{qn(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="Tic Tac Toe"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Tic Tac Toe Ã”Ã‡Ã¶ Tap a cell to claim by hitting its target"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(h,j)=>j).map(h=>e.jsx("button",{className:`h-12 rounded-xl border ${H.board[h]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(H.finished||H.board[h])return;const j=ba[h],N=Number(At||0),R=N%3===0?"TRIPLE":N%2===0?"DOUBLE":"SINGLE",Q=j.type==="BULL"?null:j.num||null;Cn(h,N,R,Q),Et("")},children:H.board[h]||""},h))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Enter dart score (e.g. 20, 40, 60, 25, 50)",value:At,onChange:h=>Et(h.target.value),onKeyDown:h=>{if(h.key==="Enter"){const j=Array.from({length:9},(N,R)=>R).find(N=>!H.board[N]&&!H.finished);if(j!==void 0){const N=ba[j],R=Number(At||0),Q=R%3===0?"TRIPLE":R%2===0?"DOUBLE":"SINGLE",de=N.type==="BULL"?null:N.num||null;Cn(j,R,Q,de),Et("")}}}}),e.jsx("button",{className:"btn",onClick:()=>{const h=Array.from({length:9},(j,N)=>N).find(j=>!H.board[j]&&!H.finished);if(h!==void 0){const j=ba[h],N=Number(At||0),R=N%3===0?"TRIPLE":N%2===0?"DOUBLE":"SINGLE",Q=j.type==="BULL"?null:j.num||null;Cn(h,N,R,Q),Et("")}},children:"Claim Cell"})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{}})})]}):Ee==="Killer"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer Ã”Ã‡Ã¶ Hit your own double to become Killer; then remove othersÃ”Ã‡Ã– lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:(()=>{const h=ct();return b.players.forEach(j=>wn(j.id)),L[h]?.number||"Ã”Ã‡Ã¶"})()})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:(()=>{const h=ct();return L[h]?.lives??"Ã”Ã‡Ã¶"})()})," ",(()=>{const h=ct();return L[h]?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null})()]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{Ks(j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Ks("SINGLE",Math.max(0,te|0)),X(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Ks("SINGLE",Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-xs mb-1.5",children:[Ee," (online) Ã”Ã‡Ã¶ manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const h=Math.max(0,te|0);b.addVisit(h,3),X(0),b.nextPlayer(),We()},children:"Submit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{b.undoVisit(),We()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>g(!0),children:"Messages"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsx(bn,{})}),e.jsxs("div",{className:`md:col-span-${Xe} space-y-1.5 relative`,children:[e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("button",{className:`btn ${Le}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${Le}`,onClick:zn,children:"Manual Correction"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[e.jsx("span",{className:"text-xs opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>Ie(Math.max(.5,Math.round((ue-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${Le} bg-transparent border-slate-600 text-center min-w-[3rem]`,children:[Math.round(ue*100),"%"]}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>Ie(Math.min(1.25,Math.round((ue+.05)*100)/100)),children:"+"}),e.jsx("button",{className:`btn ${Le}`,onClick:()=>ot(Xe===2?3:2),title:Xe===2?"Expand camera":"Shrink camera",children:Xe===2?"â†”":"â†™"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Le}`,title:"Toggle fit/fill",onClick:()=>bt(xe==="fill"?"fit":"fill"),children:xe==="fill"?"Fill":"Fit"})]})]}),e.jsxs("div",{className:"mt-2 relative",children:[e.jsx(ea,{storageKey:"ndn:camera:tile:online:row",className:"relative rounded-2xl overflow-hidden bg-black w-full",defaultWidth:720,defaultHeight:400,minWidth:320,minHeight:220,maxWidth:1600,maxHeight:900,children:e.jsx(_a,{label:"Your Board",autoStart:t?.username&&b.players[b.currentPlayerIdx]?.name===t.username,aspect:"classic",fill:!0})}),Xe<3&&e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-slate-600/20 hover:bg-slate-600/40 transition-colors flex items-center justify-center group",onMouseDown:h=>{h.preventDefault();const j=h.clientX,N=Xe,R=de=>{de.clientX-j>50&&N===2&&ot(3)},Q=()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",Q)};document.addEventListener("mousemove",R),document.addEventListener("mouseup",Q)},children:e.jsx("div",{className:"w-0.5 h-8 bg-slate-400 group-hover:bg-slate-300 transition-colors"})})]}),e.jsxs("div",{className:"font-semibold text-sm md:text-base",children:["Current: ",b.players[b.currentPlayerIdx]?.name||"Ã”Ã‡Ã¶"]}),Ee==="X01"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{x01DoubleInOverride:Xt,hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(h,j,N)=>{if(T){const Q=b.players[b.currentPlayerIdx],de=Q?.legs[Q.legs.length-1],ae=de?de.totalScoreRemaining:b.startingScore;Zn(t?.username||"Player",h,Math.max(0,ae),W,{volume:C,checkoutOnly:Y})}const R=b.players[b.currentPlayerIdx];t?.username&&R?.name===t.username&&en(t.username,j,h);try{h===180&&Jt("180",R?.name||"Player"),N&&Jt("leg",R?.name||"Player")}catch{}N?We():(ut?.length||0)>=2?setTimeout(()=>{try{b.nextPlayer(),We()}catch{}},750):We()}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>Ys(te),children:"Submit Visit (Manual)"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{b.undoVisit(),We()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(h=>e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Ys(h),children:h},h))]}),(()=>{const h=b.players[b.currentPlayerIdx],j=h?.legs?.[h.legs?.length-1],N=j?j.totalScoreRemaining:b.startingScore;return N>0&&N<=170?e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",J,"): ",Fa(N,J).join("  Ã”Ã‡Ã³  ")||"Ã”Ã‡Ã¶"]}):null})()]}):Ee==="Double Practice"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Double Practice Ã”Ã‡Ã¶ Hit doubles D1Ã”Ã¥Ã†D20Ã”Ã¥Ã†DBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Ds[qe]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[ve," / ",Ds.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j)=>{(j==="DOUBLE"||j==="INNER_BULL")&&gn(h)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&yn()}}),e.jsx("button",{className:"btn",onClick:yn,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:ee,onChange:h=>et(h.target.value),onKeyDown:h=>{h.key==="Enter"&&vn()}}),e.jsx("button",{className:"btn",onClick:vn,children:"Add"})]})]}):Ee==="Cricket"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Cricket Ã”Ã‡Ã¶ Close 15-20 and Bull; overflow scores points"}),(()=>{const h=ct();jn(h);const j=Pt[h]||Tn();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:ja.map(N=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:N===25?"Bull":N}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[N]||0)," / 3"]})]},N))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:Pt[ct()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{Sn(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Sn(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="Shanghai"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();ra(h);const j=Tt[h]||tn();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["Shanghai Ã”Ã‡Ã¶ Round ",j.round," Ã”Ã‡Ã³ Score ",j.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{zs(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{zs(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="Halve It"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();Nn(h);const j=vs[h]||sn(),N=Ha(j);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm mb-2",children:["Halve It Ã”Ã‡Ã¶ Stage ",j.stage+1,"/",j.targets.length," Ã”Ã‡Ã³ Score ",j.score]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const R=N;return R?R.kind==="ANY_NUMBER"?"Any":R.kind==="BULL"?"Bull":R.kind==="DOUBLE"||R.kind==="TRIPLE"||R.kind==="NUMBER"?`${R.kind} ${R.num}`:"Ã”Ã‡Ã¶":"Ã”Ã‡Ã¶"})()})]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{Lt(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Lt(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="High-Low"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();ia(h);const j=ms[h]||nn();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["High-Low Ã”Ã‡Ã¶ Round ",j.round," Ã”Ã‡Ã³ Target ",j.target," Ã”Ã‡Ã³ Score ",j.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{It(h,j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{It(Math.max(0,te|0)),X(0)},children:"Add Dart"})]})]}):Ee==="Killer"&&t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=ct();b.players.forEach(N=>wn(N.id));const j=L[h];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer Ã”Ã‡Ã¶ Hit your own double to become Killer; then remove othersÃ”Ã‡Ã– lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j?.number||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:j?.lives??"Ã”Ã‡Ã¶"})," ",j?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 gap-1 text-[11px]",children:b.players.map(N=>{const R=L[N.id];return e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80 truncate",children:N.name}),e.jsx("span",{className:"font-mono",children:R?`#${R.number} = ${R.lives}Ã”Ã˜Ã±${R.isKiller?" = K":""}`:"Ã”Ã‡Ã¶"})]},N.id)})})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 my-2",children:e.jsx(Ve,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,N)=>{Ks(j==="MISS"?void 0:j,N?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Ks("SINGLE",Math.max(0,te|0)),X(0)},children:"Add Dart"})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Tip: Only doubles/triples on the opponentsÃ”Ã‡Ã– numbers remove lives. To become Killer, hit your own double."})]}):t?.username&&b.players[b.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-sm mb-2",children:[Ee," (online) Ã”Ã‡Ã¶ manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:te,onChange:h=>X(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const h=Math.max(0,te|0);b.addVisit(h,3),X(0),b.nextPlayer(),We()},children:"Submit"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{b.undoVisit(),We()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>g(!0),children:"Messages"})]})})]})]})})]})]}),xt&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50",children:e.jsx("div",{className:"w-full h-full flex items-stretch justify-stretch p-0",children:e.jsxs(rn,{storageKey:"ndn:modal:create-match",className:"w-full h-full rounded-none !border-0 !shadow-none relative",fullScreen:!0,children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-slate-900/80 backdrop-blur border-b border-slate-700 z-10 px-2 py-2",children:e.jsx("h3",{className:"text-xl font-bold",children:"Create Match"})}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 overflow-auto px-2",style:{maxHeight:"calc(100vh - 120px)"},children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:lt,onChange:h=>Ns(h.target.value),children:ta.map(h=>e.jsxs("option",{value:h,disabled:!t?.fullAccess&&Zs.includes(h),children:[h," ",!t?.fullAccess&&Zs.includes(h)?"(PREMIUM)":""]},h))})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:Ut,onChange:h=>on(h.target.value),children:[e.jsx("option",{value:"bestof",children:"Best Of"}),e.jsx("option",{value:"firstto",children:"First To"})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Value"}),lt==="X01"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:[101,201,301,401,501].map(h=>e.jsx("button",{className:`btn px-2 py-1 text-xs ${Os===h?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>_s(h),children:h},h))}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:Os,onChange:h=>_s(parseInt(h.target.value||"1")),placeholder:"Or enter custom value"})]}):e.jsx("input",{className:"input w-full",type:"number",min:1,value:Os,onChange:h=>_s(parseInt(h.target.value||"1"))}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Example: Best Of 5 â€” first to 3"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Starting Score"}),lt==="X01"?e.jsx("select",{className:"input w-full",value:ts,onChange:h=>ss(parseInt(h.target.value||"501")),children:[301,501,701].map(h=>e.jsx("option",{value:h,children:h},h))}):e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Starting score applies to X01 only"})]}),lt==="X01"&&e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"X01 Rules"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"create-x01di",type:"checkbox",className:"accent-purple-500",checked:!!Cs,onChange:h=>An(h.target.checked)}),e.jsx("label",{htmlFor:"create-x01di",className:"text-sm opacity-80",children:"Require Double-In"})]})]}),lt==="Treble Practice"&&e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Throws per game"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[[9,12,18,30,60].map(h=>e.jsx("button",{className:`btn px-2 py-1 text-xs ${Ss===h?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>cn(h),children:h},h)),e.jsx("button",{className:`btn px-2 py-1 text-xs ${Ss===0?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>cn(0),title:"Unlimited",children:"âˆž"})]}),e.jsx("input",{className:"input w-full",type:"number",min:0,placeholder:"0 = unlimited",value:Ss,onChange:h=>cn(Math.max(0,parseInt(h.target.value||"0")))})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Require Calibration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"calibreq",type:"checkbox",className:"accent-purple-500",checked:Dn,onChange:h=>ws(h.target.checked)}),e.jsx("label",{htmlFor:"calibreq",className:"text-sm opacity-80",children:"Players must be calibrated"})]})]}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 border border-slate-700/40",children:[e.jsx("div",{className:"text-xs text-slate-300 uppercase tracking-wide mb-1",children:"Summary"}),e.jsxs("div",{className:"text-sm font-semibold",children:[lt," â€” ",Ut==="bestof"?`Best Of ${Os}`:`First To ${Os}`," ",lt==="X01"?`â€” ${ts}`:""]}),lt==="X01"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Double-In: ",Cs?"On":"Off"]}),lt==="Treble Practice"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Throws per game: ",Ss||"Unlimited"]}),!t?.fullAccess&&Zs.includes(lt)&&e.jsx("div",{className:"text-xs text-rose-300 mt-1",children:"PREMIUM required"})]})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-900/80 backdrop-blur border-t border-slate-700 z-10 px-2 py-2",children:[e.jsx("button",{className:"btn w-full",disabled:!t?.fullAccess&&Zs.includes(lt),title:!t?.fullAccess&&Zs.includes(lt)?"PREMIUM game":"",onClick:()=>{const h=t?.username?an(t.username):0;lt==="Treble Practice"&&As(Math.max(0,Ss|0)),lt==="X01"&&qt(!!Cs);const j={type:"create-match",game:lt,mode:Ut,value:Os,startingScore:ts,creatorAvg:h,requireCalibration:Dn};lt==="Treble Practice"&&(j.trebleMaxDarts=Math.max(0,Ss|0)),lt==="X01"&&(j.x01DoubleIn=!!Cs),r?(r.send(j),Qt(!1),r.send({type:"list-matches"})):(S.current?.send(JSON.stringify(j)),Qt(!1),S.current?.send(JSON.stringify({type:"list-matches"})))},children:"START GAME!"}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx("button",{className:"btn px-2 py-1",onClick:()=>Qt(!1),children:"Close"})})]})]})})}),jt&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(rn,{storageKey:"ndn:modal:invite",className:"w-full relative",defaultWidth:620,defaultHeight:420,minWidth:520,minHeight:320,maxWidth:1e3,maxHeight:800,children:[e.jsx("h3",{className:"text-xl font-bold mb-1",children:"Incoming Match Request"}),e.jsxs("div",{className:"text-sm mb-2",children:[e.jsx("span",{className:"font-semibold",children:jt.fromName})," wants to join your match.",e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${jt.calibrated?"bg-emerald-500/20 text-emerald-300 border border-emerald-600/30":"bg-amber-500/20 text-amber-200 border border-amber-600/30"}`,children:jt.calibrated?"Calibrated":"Not calibrated"})]}),(jt.game||jt.mode)&&e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[jt.game||"X01"," Ã”Ã‡Ã³ ",jt.mode==="firstto"?`First To ${jt.value}`:`Best Of ${jt.value}`," ",jt.game==="X01"&&jt.startingScore?`Ã”Ã‡Ã³ ${jt.startingScore}`:""]}),jt.boardPreview?e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:jt.boardPreview,alt:"Board preview",className:"rounded-lg w-full max-h-64 object-contain bg-black/40 border border-slate-700"})}):e.jsx("div",{className:"mb-3 text-xs opacity-60",children:"No camera preview provided."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{r?r.send({type:"invite-response",matchId:jt.matchId,accept:!0,toId:jt.fromId}):S.current?.send(JSON.stringify({type:"invite-response",matchId:jt.matchId,accept:!0,toId:jt.fromId})),Oe(null)},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>{r?r.send({type:"invite-response",matchId:jt.matchId,accept:!1,toId:jt.fromId}):S.current?.send(JSON.stringify({type:"invite-response",matchId:jt.matchId,accept:!1,toId:jt.fromId})),Oe(null)},children:"Decline"})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(rn,{storageKey:"ndn:modal:quick-chat",className:"w-full relative",defaultWidth:520,defaultHeight:280,minWidth:360,minHeight:220,maxWidth:900,maxHeight:700,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>x(!1),children:"Close"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["Good luck!","Good game!","Nice darts!","Well played!","Ready?"].map(h=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Un(h),x(!1)},disabled:!l,children:h},h))})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(rn,{storageKey:"ndn:modal:messages",className:"w-full relative",defaultWidth:560,defaultHeight:360,minWidth:380,minHeight:260,maxWidth:1e3,maxHeight:800,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>g(!1),children:"Close"})]}),e.jsx(Gm,{items:c.slice(-30).filter(h=>!n.isBlocked(String(h.fromId||""))).map((h,j)=>({key:String(j),from:h.from,id:String(h.fromId||h.from),text:h.message})),onDelete:h=>u(j=>j.filter((N,R)=>R!==h)),onReport:h=>{const N=c.slice(-30).filter(R=>!n.isBlocked(String(R.fromId||"")))[h];N&&Ka(null,N.message)},onBlock:h=>{const N=c.slice(-30).filter(R=>!n.isBlocked(String(R.fromId||"")))[h];if(N){try{n.block(String(N.fromId||N.from))}catch{}u(R=>R.filter(Q=>String(Q.fromId||Q.from)!==String(N.fromId||N.from)));try{s(`${N.from} blocked`,{type:"info"})}catch{}}}})]})})]})}function Gm({items:t,onDelete:a,onReport:s,onBlock:r}){const n=(()=>{try{const c=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(c)}catch{return!1}})(),[i,o]=d.useState(null),[l,m]=d.useState(null);return e.jsx("div",{className:"h-24 overflow-auto text-sm divide-y divide-slate-700/40",children:t.length===0?e.jsx("div",{className:"opacity-60 py-1",children:"No messages yet."}):t.map((c,u)=>{const f=$o(c.text),x=Im(c.text);return e.jsxs("div",{className:"relative group px-1 py-1 flex items-start gap-2",onTouchStart:n?p=>{const g=p.touches[0];o({x:g.clientX,y:g.clientY,i:u,t:Date.now()})}:void 0,onTouchMove:n?p=>{if(!i||i.i!==u)return;p.touches[0].clientX-i.x<-40&&m(u)}:void 0,onTouchEnd:n?()=>{const p=i?Date.now()-i.t:0;(l===u||p>600)&&(a(u),m(null)),o(null)}:void 0,children:[e.jsxs("span",{className:"text-slate-400 shrink-0",children:["[",c.from,"]"]}),e.jsx("span",{className:"text-white break-words whitespace-pre-wrap flex-1",children:f}),!n&&e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 ml-2",children:[e.jsx("button",{className:"w-5 h-5 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center",title:"Delete message","aria-label":"Delete message",onClick:()=>a(u),children:"â”œÃ¹"}),r&&e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-slate-700 hover:bg-slate-800 text-slate-100 text-[11px]",onClick:()=>r(u),title:"Block sender",children:"Block"}),e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-amber-600/40 hover:bg-amber-600/60 text-amber-100 text-[11px]",onClick:()=>s(u),title:"Report message",children:"Report"})]}),x&&e.jsx("span",{className:"ml-2 text-[10px] px-1 rounded bg-rose-600/30 text-rose-200 border border-rose-600/40",children:"Filtered"})]},c.key)})})}function Jm({user:t}){const{players:a,inProgress:s,startingScore:r,newMatch:n}=fa(),[i,o]=d.useState("x01"),[l,m]=d.useState("Player 1, Player 2"),[c,u]=d.useState(501),[f,x]=d.useState([]),[p,g]=d.useState(""),[w,I]=d.useState(!1),[A,S]=d.useState(""),[E,M]=d.useState([]),[F,D]=d.useState(!1),v=String(t?.email||"").toLowerCase();d.useEffect(()=>{let T=!1;async function W(){try{if(!v)return;const pe=await(await fetch(`/api/friends/list?email=${encodeURIComponent(v)}`)).json().catch(()=>({friends:[]}));T||x(pe.friends||[])}catch{}}W();const C=setInterval(W,2e4);return()=>{T=!0,clearInterval(C)}},[v]),d.useEffect(()=>{try{const T=v?`ndn:stats:opponent:${v}`:"ndn:stats:opponent",W=localStorage.getItem(T);W&&g(W)}catch{}},[v]),d.useEffect(()=>{try{const T=v?`ndn:stats:opponent:${v}`:"ndn:stats:opponent";p?localStorage.setItem(T,p):localStorage.removeItem(T)}catch{}},[p,v]);async function b(T){if(S(T),!T.trim()){M([]);return}D(!0);try{const C=await(await fetch(`/api/friends/search?q=${encodeURIComponent(T)}`)).json().catch(()=>({results:[]}));M(C.results||[])}finally{D(!1)}}const _=d.useMemo(()=>{const T=new Map;if(i==="x01")for(const C of a)for(const Y of C.legs)for(const pe of Y.visits){const ue=Math.max(0,Math.min(180,pe.score));T.set(ue,(T.get(ue)??0)+1)}const W=Array.from(T.entries()).sort((C,Y)=>C[0]-Y[0]);return W.length===0&&i==="x01"?([0,26,41,60,81,100,120,140,160,180].forEach(C=>T.set(C,0)),Array.from(T.entries()).sort((C,Y)=>C[0]-Y[0]).map(([C,Y])=>({label:C,value:Y}))):W.map(([C,Y])=>({label:C,value:Y}))},[a,i]),J=d.useMemo(()=>{const T=oi(ta);return ta.map(W=>{const C=T[W]||{played:0,won:0};return{label:W,value:C.played,extra:C.won}})},[i]);return d.useEffect(()=>{const T=()=>o(W=>W);return window.addEventListener("ndn:stats-updated",T),()=>window.removeEventListener("ndn:stats-updated",T)},[]),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Match Stats"}),e.jsx("span",{className:"text-xs opacity-70",children:"View"})]}),e.jsx(Ja,{tabs:[{key:"x01",label:"X01"},{key:"other",label:"Other Modes"}],active:i,onChange:T=>o(T)})]}),a.length===0&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-2",children:"No match data yet"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Start a quick X01 match to generate stats. Stats like Best/Worst 3-dart are finalized when you end the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-300 mb-1",children:"Players (comma separated)"}),e.jsx("input",{className:"input w-full",value:l,onChange:T=>m(T.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-300 mb-1",children:"Starting Score"}),e.jsx("input",{className:"input w-full",type:"number",value:c,onChange:T=>u(parseInt(T.target.value||"501"))})]}),e.jsx("div",{children:e.jsx("button",{className:"btn w-full",onClick:()=>{const T=l.split(",").map(W=>W.trim()).filter(Boolean);if(!T.length)return alert("Enter at least one player");n(T,c)},children:"Start Match"})})]})]}),s&&e.jsx("div",{className:"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200",children:"Note: Detailed leg stats are finalized at the end of the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.map((T,W)=>e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:W===1&&!p?T.name||"Opponent":W===1&&p?p:T.name}),W===1&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10",onClick:()=>I(C=>!C),title:"Search user to compare",children:"Select Friend"}),f.slice(0,6).map(C=>{const Y=C.username||C.email,pe=p===Y;return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${pe?"bg-indigo-500/30 border-indigo-400/50":"bg-white/5 border-white/10 hover:bg-white/10"}`,onClick:()=>g(Y),title:`Compare vs ${Y}`,children:Y},C.email)}),f.length===0&&e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10",disabled:!0,children:"Find friends to compare"})]})]}),W===1&&w&&e.jsxs("div",{className:"mb-2 p-2 rounded-lg bg-black/20 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1 py-1",placeholder:"Search by name or email",value:A,onChange:C=>b(C.target.value)}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>b(A),disabled:F,children:"Search"})]}),e.jsxs("ul",{className:"max-h-40 overflow-auto space-y-1",children:[E.map(C=>{const Y=C.username||C.email;return e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm",onClick:()=>{g(Y),I(!1)},children:Y})},C.email)}),!E.length&&e.jsx("li",{className:"text-xs opacity-70",children:A.trim()?"No results":"Type to searchâ€¦"})]})]}),W===1&&p?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:dt(ps(p).best3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:dt(ps(p).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const C=ps(p);return C.bestLegDarts?`${C.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:ps(p).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",dt(an(p))," Â· ",dt(hr(p))]}),e.jsxs("span",{children:["First 9: ",dt(ur(p))," Â· ",dt(fr(p))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const C=ps(p);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",dt(C.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",dt(C.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",C.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",C.bestCheckout||0]})]})})()]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:dt(T.bestThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:dt(T.worstThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:T.bestNineDart?`${T.bestNineDart.darts} darts`:"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:T.bestCheckout??"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",dt(an(T.name))," Â· ",dt(hr(T.name))]}),e.jsxs("span",{children:["First 9: ",dt(ur(T.name))," Â· ",dt(fr(T.name))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const C=ps(T.name);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",dt(C.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",dt(C.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",C.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",C.bestCheckout||0]})]})})()]})]})]},T.id)),a.length<=1&&e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Opponent"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[f.slice(0,6).map(T=>{const W=T.username||T.email,C=p===(T.username||T.email);return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${C?"bg-indigo-500/30 border-indigo-400/50":"bg-white/5 border-white/10 hover:bg-white/10"}`,onClick:()=>g(W),title:`Compare vs ${W}`,children:W},T.email)}),f.length===0&&e.jsx("span",{className:"text-xs opacity-70",children:"Add friends to compare stats."})]})]}),p?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Comparing to"}),e.jsx("div",{className:"font-semibold",children:p})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:dt(an(p))})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:dt(ps(p).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const T=ps(p);return T.bestLegDarts?`${T.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:ps(p).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",dt(an(p))," Â· ",dt(hr(p))]}),e.jsxs("span",{children:["First 9: ",dt(ur(p))," Â· ",dt(fr(p))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const T=ps(p);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",dt(T.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",dt(T.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",T.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",T.bestCheckout||0]})]})})()]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Select a friend above to compare."})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Score Distribution (",i.toUpperCase(),"): Visits by scored points"]}),e.jsx("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:e.jsx(ii,{data:_,showValues:!1})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-2 text-sm opacity-80",children:"Other Modes: games played (bar height) with wins shown beneath each label"}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(ii,{data:J.map(T=>({label:T.label,value:T.value})),showValues:!1}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:J.map((T,W)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:T.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",T.value," Â· Won ",T.extra]})]},W))})]})]})]})}function Km({user:t}){const a=sa(),s=(()=>{try{return ui()}catch{return null}})(),{matchType:r="singles",setMatchType:n,teamAName:i="Team A",setTeamAName:o,teamBName:l="Team B",setTeamBName:m}=Ot(),[c,u]=d.useState([]),[f,x]=d.useState(!1),[p,g]=d.useState(""),[w,I]=d.useState(null),[A,S]=d.useState(!1),[E,M]=d.useState({open:!1,t:null}),[F,D]=d.useState({open:!1,t:null}),[v,b]=d.useState({title:"Community X01 Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:15,capacity:8,startingScore:501}),_=(()=>{try{return"ontouchstart"in window||(navigator.maxTouchPoints||0)>0}catch{return!1}})();async function J(){try{const se=await(await kt("/api/tournaments")).json();u(Array.isArray(se.tournaments)?se.tournaments:[])}catch{}}d.useEffect(()=>{J()},[]),d.useEffect(()=>{if(!s)return;const O=s.addListener(se=>{try{se.type==="tournaments"&&u(se.tournaments||[]),se.type==="tournament-win"&&se.message&&a(se.message,{type:"success",timeout:1e4})}catch{}});return()=>{O()}},[s?.connected]);const T=String(t?.email||"").toLowerCase(),W=()=>e.jsxs("div",{className:"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Default match"}),e.jsxs("select",{className:"btn py-1 px-2",value:r,onChange:O=>n(O.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:"input py-1 px-2 w-[8rem]",value:i,onChange:O=>o(O.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:"input py-1 px-2 w-[8rem]",value:l,onChange:O=>m(O.target.value),placeholder:"Team B"})]});d.useEffect(()=>{let O=!1;async function se(){if(!T){I(null);return}try{const be=await(await kt(`/api/subscription?email=${encodeURIComponent(T)}`)).json();O||(be?.source==="tournament"&&typeof be.expiresAt=="number"&&be.expiresAt>Date.now()?I(be.expiresAt):I(null))}catch{O||I(null)}}return se(),()=>{O=!0}},[T]);function C(O){return!!O.participants?.some(se=>se.email===T)}async function Y(O){T&&D({open:!0,t:O})}async function pe(){const O=F.t;if(!(!O||!T)){D({open:!1,t:null}),x(!0);try{let se=await kt("/api/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:O.id,requesterEmail:T})});if(!se.ok&&se.status===403&&String(T)==="daviesfamily108@gmail.com"&&(se=await kt("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:O.id,requesterEmail:T})})),!se.ok){let ye="Delete failed";try{const be=await se.json();be?.error&&(ye=`Delete failed: ${String(be.error)}`)}catch{}a(ye,{type:"error"});return}a("Tournament deleted",{type:"success"}),await J()}finally{x(!1)}}}async function ue(O){if(T){x(!0);try{const se=await kt("/api/tournaments/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:O.id,email:T,username:t?.username})});if(!se.ok){let ye={};try{ye=await se.json()}catch{}ye?.error==="WINNER_COOLDOWN"&&typeof ye.until=="number"?(g(`You're a recent NDN tournament winner. You can re-enter after ${oe(ye.until)}.`),setTimeout(()=>g(""),6e3),a("Join blocked: winner cooldown active",{type:"error"})):ye?.error==="ALREADY_IN_TOURNAMENT"?(g(String(ye.message||"You can only join one tournament at a time.")),setTimeout(()=>g(""),6e3),a("Join blocked: already in another tournament",{type:"error"})):ye?.error&&(g(String(ye.error)),setTimeout(()=>g(""),3500),a(`Join failed: ${String(ye.error)}`,{type:"error"}));return}a("Joined tournament",{type:"success"}),await J()}finally{x(!1)}}}async function Ie(O){if(T){x(!0);try{const se=await kt("/api/tournaments/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:O.id,email:T})});if(!se.ok){let ye={};try{ye=await se.json()}catch{}ye?.error?a(`Leave failed: ${String(ye.error)}`,{type:"error"}):se.status===404?a("Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.",{type:"error"}):a("Leave failed. Please try again.",{type:"error"});return}a("Left tournament",{type:"success"}),u(ye=>ye.map(be=>be.id===O.id?{...be,participants:(be.participants||[]).filter(De=>De.email!==T)}:be)),await J()}finally{x(!1)}}}async function xe(){x(!0);try{const O=new Date(v.startAt).getTime();await kt("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:v.title,game:v.game,mode:v.mode,value:Number(v.value),description:v.description,startAt:O,checkinMinutes:Number(v.checkinMinutes),capacity:Number(v.capacity),startingScore:v.game==="X01"?Number(v.startingScore||501):void 0,creatorEmail:t?.email,creatorName:t?.username})}),S(!1),a("Tournament created",{type:"success"}),await J()}finally{x(!1)}}d.useEffect(()=>{if(!A)return;const O=se=>{se.key==="Escape"&&S(!1)};return document.addEventListener("keydown",O),()=>document.removeEventListener("keydown",O)},[A]);const bt=d.useMemo(()=>c.filter(O=>O.official),[c]),He=d.useMemo(()=>c.filter(O=>!O.official),[c]),ge=d.useMemo(()=>bt.filter(se=>se.status==="scheduled").sort((se,ye)=>se.startAt-ye.startAt)[0]||null,[bt]);function oe(O){return new Date(O).toLocaleString()}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Tournaments"})}),e.jsxs("div",{className:"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(W,{})}),e.jsx("div",{className:"shrink-0",children:e.jsx("button",{className:"btn",onClick:()=>S(!0),children:"Create Tournament +"})})]}),e.jsx("div",{className:"mb-2 text-sm font-semibold text-slate-300",children:"World Lobby"}),ge&&e.jsx("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm uppercase tracking-wide text-indigo-300 font-semibold",children:"Weekly Official Tournament"}),e.jsx("div",{className:"font-bold",children:ge.title}),e.jsxs("div",{className:"text-sm opacity-80",children:[ge.game,ge.game==="X01"&&ge.startingScore?`/${ge.startingScore}`:""," Â· ",ge.mode==="firstto"?"First to":"Best of"," ",ge.value," Â· Starts ",oe(ge.startAt)," Â· Cap ",ge.capacity," Â· Joined ",ge.participants.length]}),ge.prize&&e.jsxs("div",{className:"text-xs mt-1",children:["Prize: ",ge.prizeType==="cash"&&ge.prizeAmount?`${ge.currency||"USD"} ${ge.prizeAmount}`:"3 months PREMIUM"]}),ge.status!=="scheduled"&&e.jsxs("div",{className:"text-xs",children:["Status: ",ge.status]}),w&&w>Date.now()&&e.jsxs("div",{className:"text-xs text-rose-300",children:["Recent winners can re-enter after ",oe(w),"."]})]}),e.jsx("div",{className:"shrink-0",children:e.jsx("button",{className:`btn ${C(ge)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:C(ge)?"Double-click to leave this tournament":ge.official&&w&&w>Date.now()?`Recent winners can re-enter after ${oe(w)}`:"",disabled:f||ge.status!=="scheduled"||!C(ge)&&(ge.participants.length>=ge.capacity||!!w&&w>Date.now()),onClick:()=>{C(ge)?_&&M({open:!0,t:ge}):ue(ge)},onDoubleClick:()=>{!_&&C(ge)&&M({open:!0,t:ge})},"aria-label":C(ge)?"Already Joined":"Join Now",children:C(ge)?"Already Joined!":"Join Now"})})]})}),p&&e.jsx("div",{className:"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm",children:p}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("section",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Official"}),e.jsx("div",{className:"text-xs opacity-70 mb-2",children:w&&w>Date.now()?e.jsxs(e.Fragment,{children:["Youâ€™re a recent NDN tournament winner â€” to keep it fair, you can re-enter after ",oe(w),"."]}):e.jsx(e.Fragment,{children:"Note: Weekly winners can re-enter once their 3 months of PREMIUM ends."})}),e.jsxs("ul",{className:"space-y-2",children:[bt.map(O=>e.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"font-semibold",children:[O.title," ",O.prize&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 align-middle",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-amber-500 text-black",children:"Prize"}),e.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help",title:O.prizeType==="cash"?"Official cash prize tournament â€” payout handled by admin.":"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.","aria-label":"Prize info",children:"i"})]})]}),e.jsxs("div",{className:"text-sm opacity-80",children:[O.game,O.game==="X01"&&O.startingScore?`/${O.startingScore}`:""," Â· ",O.mode==="firstto"?"First to":"Best of"," ",O.value," Â· ",oe(O.startAt)," Â· Cap ",O.capacity," Â· Joined ",O.participants.length]}),O.prize&&e.jsxs("div",{className:"text-xs",children:["Prize: ",O.prizeType==="cash"&&O.prizeAmount?`${O.currency||"USD"} ${O.prizeAmount}`:"3 months PREMIUM",O.status==="completed"&&O.prizeType==="cash"&&O.payoutStatus&&e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded ${O.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:O.payoutStatus==="paid"?"Paid":"Pending"})]}),O.status!=="scheduled"&&e.jsxs("div",{className:"text-xs",children:["Status: ",O.status]}),C(O)&&e.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"}),O.official&&w&&w>Date.now()&&e.jsxs("div",{className:"text-xs text-rose-300",children:["Cooldown active until ",oe(w),"."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`btn ${C(O)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:C(O)?"Double-click to leave this tournament":O.official&&w&&w>Date.now()?`Recent winners can re-enter after ${oe(w)}`:"",disabled:f||O.status!=="scheduled"||!C(O)&&(O.participants.length>=O.capacity||O.official&&!!w&&w>Date.now()),onClick:()=>{C(O)?_&&M({open:!0,t:O}):ue(O)},onDoubleClick:()=>{!_&&C(O)&&M({open:!0,t:O})},"aria-label":C(O)?"Already Joined":"Join Now",children:C(O)?"Already Joined!":"Join Now"}),O.status==="scheduled"&&T&&O.creatorEmail&&String(O.creatorEmail).toLowerCase()===T&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>Y(O),"aria-label":"Delete tournament",children:"Ã—"})]})]},O.id)),bt.length===0&&e.jsx("li",{className:"text-sm opacity-60",children:"No official tournaments yet."})]})]}),e.jsxs("section",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Community"}),e.jsxs("ul",{className:"space-y-2",children:[He.map(O=>e.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-semibold",children:O.title}),e.jsxs("div",{className:"text-sm opacity-80",children:[O.game,O.game==="X01"&&O.startingScore?`/${O.startingScore}`:""," Â· ",O.mode==="firstto"?"First to":"Best of"," ",O.value," Â· ",oe(O.startAt)," Â· Cap ",O.capacity," Â· Joined ",O.participants.length]}),O.description&&e.jsx("div",{className:"text-xs opacity-80",children:O.description}),C(O)&&e.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",title:C(O)?"Double-click to leave this tournament":"",disabled:f||O.status!=="scheduled"||!C(O)&&O.participants.length>=O.capacity,onClick:()=>{C(O)?_&&M({open:!0,t:O}):ue(O)},onDoubleClick:()=>{!_&&C(O)&&M({open:!0,t:O})},children:C(O)?"Already Joined":"Join Now"}),O.status==="scheduled"&&T&&O.creatorEmail&&String(O.creatorEmail).toLowerCase()===T&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>Y(O),"aria-label":"Delete tournament",children:"Ã—"})]})]},O.id)),He.length===0&&e.jsx("li",{className:"text-sm opacity-60",children:"No community tournaments yet."})]})]})]}),A&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"card relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Create Tournament"}),e.jsx("button",{className:"btn",onClick:()=>S(!1),children:"Close"})]}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 pr-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Title"}),e.jsx("input",{className:"input w-full",value:v.title,onChange:O=>b(se=>({...se,title:O.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:v.game,onChange:O=>b(se=>({...se,game:O.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer"].map(O=>e.jsx("option",{value:O,children:O},O))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:v.mode,onChange:O=>b(se=>({...se,mode:O.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Number"}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:v.value,onChange:O=>b(se=>({...se,value:Number(O.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Description"}),e.jsx("textarea",{className:"input w-full",rows:5,value:v.description,onChange:O=>b(se=>({...se,description:O.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Start time"}),e.jsx("input",{className:"input w-full",type:"datetime-local",value:v.startAt,onChange:O=>b(se=>({...se,startAt:O.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Check-in reminder (min)"}),e.jsx("input",{className:"input w-full",type:"number",min:0,value:v.checkinMinutes,onChange:O=>b(se=>({...se,checkinMinutes:Number(O.target.value)}))})]})]}),v.game==="X01"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"X01 Starting Score"}),e.jsx("select",{className:"input w-full",value:String(v.startingScore),onChange:O=>b(se=>({...se,startingScore:Number(O.target.value)})),children:[301,501,701].map(O=>e.jsx("option",{value:O,children:O},O))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Capacity"}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,value:v.capacity,onChange:O=>b(se=>({...se,capacity:Number(O.target.value)}))})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Note: community tournaments do not award prizes."}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn",disabled:f,onClick:xe,children:"Create"})})]})]})}),E.open&&E.t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>M({open:!1,t:null})}),e.jsxs("div",{className:"relative card p-4 w-[360px] max-w-[90vw]",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Leave tournament?"}),e.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Are you sure you want to remove yourself from â€œ",E.t.title,"â€?"]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>M({open:!1,t:null}),children:"Decline"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const O=E.t;M({open:!1,t:null}),await Ie(O)},children:"Accept"})]})]})]}),F.open&&F.t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold mb-4 text-white",children:"Delete Tournament"}),e.jsxs("div",{className:"text-slate-300 mb-6",children:["Are you sure you want to delete ",e.jsxs("span",{className:"font-semibold text-white",children:['"',F.t.title,'"']}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-sm text-slate-400",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",onClick:()=>D({open:!1,t:null}),children:"Decline"}),e.jsx("button",{className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",onClick:pe,children:"Continue"})]})]})})})]})}function Ym({user:t}){const[a,s]=d.useState(null),[r,n]=d.useState(!0),[i,o]=d.useState(null),l="http://localhost:8787",m=sa();if(d.useEffect(()=>{(async()=>{try{const f=t?.email?`?email=${encodeURIComponent(t.email)}`:"",x=await fetch(`${l}/api/subscription`+f);if(!x.ok)throw new Error("Failed to fetch subscription");const p=await x.json();s(p)}catch(f){o(f instanceof Error?f.message:"Something went wrong")}finally{n(!1)}})()},[t?.email]),r)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-4"}),e.jsx("p",{children:"Loading subscription..."})]})});if(i)return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-300 mb-2",children:"Subscription Error"}),e.jsx("p",{className:"mb-4 text-red-200",children:i}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn bg-red-600 hover:bg-red-700",children:"Retry"})]});const c=a?.fullAccess;return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-300 mb-2",children:c?"PREMIUM Active":"PREMIUM"}),c?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 text-green-300 font-semibold mb-2",children:"âœ… PREMIUM Access Active"}),e.jsx("p",{className:"text-green-200 text-sm",children:"You have full access to all premium features!"}),a?.source&&e.jsxs("p",{className:"text-green-200 text-xs mt-1",children:["Source: ",a.source,a?.expiresAt&&` (expires: ${new Date(a.expiresAt).toLocaleDateString()})`]})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-indigo-200",children:"Your Benefits:"})]}):e.jsx("p",{className:"mb-2 text-indigo-200",children:"Unlock every game mode known to darts, advanced stats, and premium features."}),e.jsxs("ul",{className:"mb-4",children:[e.jsx("li",{children:"All game modes (including paid/advanced)"}),e.jsx("li",{children:"Online play with all rules and variations"}),e.jsx("li",{children:"Advanced analytics and leaderboards"}),e.jsx("li",{children:"Premium camera modes and autoscoring"})]}),!c&&e.jsx("button",{onClick:async()=>{try{const f=await(await fetch(`${l}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})})).json();f.ok&&f.url?window.location.href=f.url:f.error==="STRIPE_NOT_CONFIGURED"?m("Premium purchases are not available. Payment link not configured.",{type:"error",timeout:4e3}):m("Failed to get payment link. Please try again.",{type:"error",timeout:4e3})}catch{m("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold shadow-lg hover:scale-105 transition",children:"Subscribe to PREMIUM"})]})}function Xm({open:t,onClose:a,width:s=700,title:r,footer:n,children:i,side:o="right"}){return d.useEffect(()=>{function l(m){m.key==="Escape"&&a()}return t&&document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[t,a]),e.jsxs("div",{className:`fixed inset-0 z-50 ${t?"":"pointer-events-none"}`,"aria-hidden":!t,children:[e.jsx("div",{className:`absolute inset-0 bg-black/60 transition-opacity ${t?"opacity-100":"opacity-0"}`,onClick:a}),e.jsxs("div",{className:`absolute top-0 ${o==="right"?"right-0 border-l":"left-0 border-r"} h-full bg-slate-900 border-slate-700 shadow-2xl w-full sm:w-auto flex flex-col transition-transform duration-200 ${t?"translate-x-0":o==="right"?"translate-x-full":"-translate-x-full"}`,style:{width:typeof s=="number"?`${s}px`:s},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-700 sticky top-0 bg-slate-900 z-10",children:[e.jsx("div",{className:"text-lg font-semibold",children:r}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:a,children:"Close"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:i}),n&&e.jsx("div",{className:"px-4 py-3 border-t border-slate-700 sticky bottom-0 bg-slate-900 z-10",children:n})]})]})}function Qm({user:t}){const a=eo(t?.email),[s,r]=d.useState(null),[n,i]=d.useState(""),[o,l]=d.useState("");async function m(){try{const f=await kt("/readyz");r(await f.json())}catch{}}if(d.useEffect(()=>{m();const f=setInterval(m,5e3);return()=>clearInterval(f)},[]),!a)return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Ops"}),e.jsx("div",{children:"Restricted"})]});async function c(f){l("");try{const x=await kt("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:f,requesterEmail:t?.email})}),p=await x.json();!x.ok||!p?.ok?l(p?.error||"Failed"):l(`Maintenance ${f?"enabled":"disabled"}`)}catch{l("Network error")}}async function u(){l("");const f=n.trim();if(f)try{const x=await kt("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,requesterEmail:t?.email})}),p=await x.json();!x.ok||!p?.ok?l(p?.error||"Failed"):l("Announcement broadcasted"),i("")}catch{l("Network error")}}return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Ops"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Readiness"}),e.jsxs("div",{className:"text-sm",children:["HTTP: ",e.jsx("span",{className:`font-semibold ${s?.ok?"text-emerald-300":"text-rose-300"}`,children:String(!!s?.ok)})]}),e.jsxs("div",{className:"text-sm",children:["WS: ",e.jsx("span",{className:`font-semibold ${s?.ws?"text-emerald-300":"text-rose-300"}`,children:String(!!s?.ws)})]}),e.jsxs("div",{className:"text-sm",children:["Clients: ",e.jsx("span",{className:"font-semibold",children:s?.clients??0})]}),e.jsxs("div",{className:"text-sm",children:["Rooms: ",e.jsx("span",{className:"font-semibold",children:s?.rooms??0})]}),e.jsxs("div",{className:"text-sm",children:["Heap Used: ",e.jsxs("span",{className:"font-semibold",children:[s?.mem?Math.round(s.mem.heapUsed/1024/1024):0," MB"]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Maintenance"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>c(!0),children:"Enable"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>c(!1),children:"Disable"})]})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Announcement"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Message to broadcast",value:n,onChange:f=>i(f.target.value)}),e.jsx("button",{className:"btn",onClick:u,children:"Send"})]})]})]}),o&&e.jsx("div",{className:"text-xs mt-2",children:o}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"âœ… Clustering enabled! For 1.5k+ concurrent users, deploy behind a reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets. Set NODE_WORKERS environment variable to control worker count."})]})}function Zm({}){const[t,a]=d.useState(!1),[s,r]=d.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[n,i]=d.useState(""),o=c=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:c}})),a(!1)}catch(u){console.error("Navigation failed:",u)}},l=c=>{const u=c.toLowerCase();return u.includes("username")||u.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:u.includes("premium")||u.includes("upgrade")||u.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:u.includes("calibrat")||u.includes("camera")||u.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:u.includes("voice")||u.includes("caller")||u.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:u.includes("friend")||u.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:u.includes("stat")||u.includes("score")||u.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:u.includes("setting")||u.includes("customiz")||u.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:u.includes("tournament")||u.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:u.includes("help")||u.includes("support")||u.includes("faq")?{text:"You're already in the help section! Check Settings for more resources.",links:[{text:"Go to Settings > Support",tab:"settings"}]}:u.includes("how to play")||u.includes("game")||u.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},m=()=>{if(!n.trim())return;const c=n.toLowerCase();r(f=>[...f,{text:n,isUser:!0}]),i("");const u=l(c);setTimeout(()=>{r(f=>[...f,{text:u,isUser:!1}])},500)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-colors",title:"Help Assistant",children:e.jsx(Vl,{className:"w-6 h-6"})}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-end p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsxs("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-md h-96 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(En,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"font-semibold",children:"Help Assistant"})]}),e.jsx("button",{onClick:()=>a(!1),className:"text-slate-400 hover:text-white",children:e.jsx(fc,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:s.map((c,u)=>e.jsx("div",{className:`flex ${c.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${c.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof c.text=="string"?c.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:c.text.text}),c.text.links&&e.jsx("div",{className:"space-y-1",children:c.text.links.map((f,x)=>e.jsx("button",{onClick:()=>o(f.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:f.text},x))})]})})},u))}),e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:c=>i(c.target.value),onKeyPress:c=>c.key==="Enter"&&m(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:m,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(Gl,{className:"w-4 h-4"})})]})})]})]})]})}function eu(){const t=na(),a=d.useRef({}),s=d.useRef({});return d.useEffect(()=>{function r(c="[GlobalCamera]"){try{const u=t.getVideoElementRef(),f=t.getMediaStream(),x=t.getPcRef&&t.getPcRef(),p=t.getWsRef&&t.getWsRef();console.log(c,{isStreaming:t.isStreaming,mode:t.mode,showOverlay:t.showOverlay,hasVideoElement:!!u,video:u?{videoWidth:u.videoWidth,videoHeight:u.videoHeight,srcObject:!!u.srcObject}:null,mediaTracks:f?f.getTracks().map(g=>({kind:g.kind,enabled:g.enabled,id:g.id})):null,pcState:x?x.connectionState||x.iceConnectionState:null,wsState:p?p.readyState||"unknown":null})}catch(u){console.warn("[GlobalCamera] dumpState failed",u)}}r("[GlobalCamera] INIT");let n=!0;const i=setInterval(()=>{if(n)try{const c=t.getVideoElementRef(),u=t.getMediaStream(),f=t.getPcRef&&t.getPcRef(),x={isStreaming:t.isStreaming,mode:t.mode,hasVideo:!!c,videoW:c?c.videoWidth:0,videoH:c?c.videoHeight:0,tracks:u?u.getTracks().length:0,pcState:f?f.connectionState||f.iceConnectionState:null},p=a.current;(x.isStreaming!==p.isStreaming||x.hasVideo!==p.hasVideo||x.videoW!==p.videoW||x.videoH!==p.videoH||x.tracks!==p.tracks||x.pcState!==p.pcState||t.showOverlay!==p.showOverlay)&&(a.current=x,r("[GlobalCamera] CHANGE"))}catch(c){console.warn("[GlobalCamera] poll failed",c)}},750);function o(c){try{const u=s.current.video;if(u&&u.el===c)return;if(u&&u.el){try{u.el.removeEventListener("loadedmetadata",u.loadedmetadata)}catch{}try{u.el.removeEventListener("playing",u.playing)}catch{}try{u.el.removeEventListener("pause",u.pause)}catch{}try{u.el.removeEventListener("ended",u.ended)}catch{}}if(s.current.video=null,c){const f=()=>console.log("[GlobalCamera] video loadedmetadata",{videoWidth:c.videoWidth,videoHeight:c.videoHeight}),x=()=>{console.log("[GlobalCamera] video playing",{paused:c.paused});try{t.setStreaming(!0)}catch{}},p=()=>{console.log("[GlobalCamera] video pause");try{t.setStreaming(!1)}catch{}},g=()=>{console.log("[GlobalCamera] video ended");try{t.setStreaming(!1)}catch{}};c.addEventListener("loadedmetadata",f),c.addEventListener("playing",x),c.addEventListener("pause",p),c.addEventListener("ended",g),s.current.video={el:c,loadedmetadata:f,playing:x,pause:p,ended:g}}}catch(u){console.warn("[GlobalCamera] attachVideoListeners failed",u)}}function l(c){try{const u=s.current.pc;if(u&&u.pc===c)return;if(u&&u.pc)try{u.pc.removeEventListener("connectionstatechange",u.connChange)}catch{}if(s.current.pc=null,c){const f=()=>console.log("[GlobalCamera] pc state change",{connectionState:c.connectionState,iceState:c.iceConnectionState});c.addEventListener("connectionstatechange",f),s.current.pc={pc:c,connChange:f}}}catch(u){console.warn("[GlobalCamera] attachPc failed",u)}}const m=setInterval(()=>{try{o(t.getVideoElementRef()),l(t.getPcRef&&t.getPcRef())}catch{}},1e3);return()=>{n=!1,clearInterval(i),clearInterval(m);try{const c=s.current.video;c&&c.el&&(c.el.removeEventListener("loadedmetadata",c.loadedmetadata),c.el.removeEventListener("playing",c.playing))}catch{}try{const c=s.current.pc;c&&c.pc&&c.pc.removeEventListener("connectionstatechange",c.connChange)}catch{}}},[t]),null}function tu(){const t=na(),a=d.useRef(null),s=d.useRef(null),r=d.useRef(0),n=d.useRef(0),i=d.useRef(0),o=d.useRef(0);return d.useEffect(()=>{a.current&&t.setVideoElementRef(a.current)},[t]),d.useEffect(()=>{let l=!0;const m=async()=>{if(l)try{const u=t.getMediaStream(),f=a.current;if(!f||!u)return;(s.current!==u||f.srcObject!==u)&&(f.srcObject=u,s.current=u),f.muted=!0,f.playsInline=!0;try{await f.play()}catch{}}catch{}};m();const c=setInterval(m,750);return()=>{l=!1,clearInterval(c)}},[t]),d.useEffect(()=>{const m=setInterval(()=>{const c=a.current,u=Date.now();if(!c||!t.isStreaming||t.mode!=="phone"||!c.srcObject){n.current=0;return}const f=c.currentTime||0;if(Number.isFinite(f))if(f===r.current?n.current+=1:n.current=0,r.current=f,n.current>=3){const x=[3e3,6e3,1e4][Math.min(o.current,2)];if(u-i.current>=x){i.current=u,o.current=Math.min(o.current+1,3);try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{reason:"stall",ts:u}})),c.play().catch(()=>{})}catch{}}}else n.current===0&&(o.current=0)},1e3);return()=>clearInterval(m)},[t]),e.jsx("video",{ref:a,style:{position:"fixed",width:1,height:1,left:-9999,top:-9999,opacity:0},muted:!0,playsInline:!0,"aria-hidden":!0})}function su(){const t=na(),a=d.useRef(null),s=d.useRef(null),r=t.isStreaming&&t.mode==="phone",n=t.getVideoElementRef();d.useEffect(()=>{const o=a.current;if(!o)return;let l=!0;const m=o.getContext("2d");if(!m)return;const c=()=>{if(l){try{if(m.clearRect(0,0,o.width,o.height),r&&n&&n.readyState>=2){const u=n.videoWidth||640,f=n.videoHeight||360,x=o.width,p=o.height,g=u/f,w=x/p;let I=0,A=0,S=u,E=f;if(g>w){const M=f*w;I=(u-M)/2,S=M}else if(g<w){const M=u/w;A=(f-M)/2,E=M}m.drawImage(n,I,A,S,E,0,0,x,p)}else m.fillStyle="rgba(148, 163, 184, 0.25)",m.fillRect(0,0,o.width,o.height),m.fillStyle="rgba(226,232,240,0.8)",m.font="10px system-ui, sans-serif",m.textAlign="center",m.textBaseline="middle",m.fillText("Camera",o.width/2,o.height/2)}catch{}s.current=requestAnimationFrame(c)}};return s.current=requestAnimationFrame(c),()=>{l=!1,s.current&&cancelAnimationFrame(s.current)}},[r,n]);const i=()=>{try{window.dispatchEvent(new CustomEvent("ndn:toggle-phone-overlay"))}catch{}};return e.jsxs("button",{type:"button",onClick:i,className:"relative inline-flex items-center gap-1 rounded-lg border border-white/15 bg-white/5 hover:bg-white/10 transition-colors shadow-sm overflow-hidden",style:{height:36},title:r?"Camera connected â€“ click to toggle overlay":"Camera not connected",children:[e.jsx("canvas",{ref:a,width:64,height:36,className:"block"}),e.jsx("span",{className:"pr-2 text-xs text-slate-100 select-none hidden xs:inline",children:r?"Phone Cam":"No Camera"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-lg pointer-events-none drop-shadow","aria-hidden":"true",children:r?"âœ…":"âšª"})]})}function nu(){const t=d.useRef(null),[a,s]=d.useState(""),[r,n]=d.useState(!1),[i,o]=d.useState(null),l=(()=>{try{return ui()}catch{return null}})(),[m,c]=d.useState("score"),[u,f]=d.useState(!1),[x,p]=d.useState(!1),[g,w]=d.useState(null),[I,A]=d.useState(0),{avgMode:S}=Ot(),{H:E,locked:M,errorPx:F}=za();d.useEffect(()=>{const b=localStorage.getItem("authToken");b&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${b}`}}).then(J=>J.json()).then(J=>{J?.user?(w(J.user),D(J.user)):localStorage.removeItem("authToken")}).catch(()=>{})},[]),d.useEffect(()=>{const b=()=>{try{localStorage.removeItem("mockUser"),localStorage.removeItem("authToken")}catch{}w(null),c("score")};return window.addEventListener("ndn:logout",b),()=>window.removeEventListener("ndn:logout",b)},[]),d.useEffect(()=>{if(!g?.username)return;const b=()=>A(S==="24h"?Yc(g.username):an(g.username));b();const _=()=>b();return window.addEventListener("ndn:stats-updated",_),()=>window.removeEventListener("ndn:stats-updated",_)},[g?.username,S]),d.useEffect(()=>{if(!g?.username){s("");return}const b=localStorage.getItem(`ndn:bio:profilePhoto:${g.username}`);s(b||"")},[g?.username]),d.useEffect(()=>{const b=W=>{W.key?.startsWith("ndn:bio:profilePhoto:")&&g?.username&&W.key.endsWith(g.username)&&s(W.newValue||"")},_=W=>{if(W.detail?.username===g?.username&&s(W.detail?.avatar||""),g?.username){const C=localStorage.getItem(`ndn:bio:profilePhoto:${g.username}`);s(C||"")}},J=()=>{if(!document.hidden&&g?.username){const W=localStorage.getItem(`ndn:bio:profilePhoto:${g.username}`);s(W||"")}},T=setInterval(()=>{if(g?.username){const W=localStorage.getItem(`ndn:bio:profilePhoto:${g.username}`);W&&W!==a&&s(W)}},2e3);return window.addEventListener("storage",b),window.addEventListener("ndn:avatar-updated",_),document.addEventListener("visibilitychange",J),()=>{window.removeEventListener("storage",b),window.removeEventListener("ndn:avatar-updated",_),document.removeEventListener("visibilitychange",J),clearInterval(T)}},[g?.username,a]),d.useEffect(()=>{const b=new URLSearchParams(window.location.search),_=b.get("paid"),J=b.get("username-change");if(_==="1"||_==="username-change"||J==="free"){const T=localStorage.getItem("pendingUsernameChange");T&&g?.email&&fetch("http://localhost:8787/api/change-username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:g.email,newUsername:T})}).then(C=>C.json()).then(C=>{C.ok?(alert("Username changed successfully!"),localStorage.removeItem("pendingUsernameChange"),C.token&&localStorage.setItem("authToken",C.token),C.user&&w(C.user),window.history.replaceState({},document.title,window.location.pathname)):alert("Failed to change username: "+(C.error||"Unknown error"))}).catch(()=>{alert("Network error while changing username")})}},[g?.email]),d.useEffect(()=>{new URLSearchParams(window.location.search).get("subscription")==="success"&&g?.email&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}).then(T=>T.json()).then(T=>{T?.user&&(w(T.user),alert("Premium subscription activated successfully!"),window.history.replaceState({},document.title,window.location.pathname))}).catch(()=>{alert("Subscription activated, but failed to refresh user data. Please refresh the page.")})},[g?.email]),d.useEffect(()=>{const b=()=>{const T=window.innerWidth,W=window.matchMedia("(max-width: 768px)").matches,C=window.matchMedia("(max-width: 1024px) and (min-width: 769px)").matches,Y=/Mobi|Android|iPhone|iPad|iPod|Mobile|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent||""),pe=/iPad|Android(?=.*\bMobile\b)|Tablet|PlayBook|Silk/i.test(navigator.userAgent||""),ue="ontouchstart"in window||navigator.maxTouchPoints>0,Ie=T<769,xe=C&&ue||pe||T>=769&&T<=1024&&ue,He=W||Y||Ie||T<769&&ue||xe;f(He)};b(),window.addEventListener("resize",b),window.addEventListener("orientationchange",b);const _=window.matchMedia("(max-width: 768px)"),J=window.matchMedia("(max-width: 1024px) and (min-width: 769px)");try{_.addEventListener("change",b),J.addEventListener("change",b)}catch{}return()=>{window.removeEventListener("resize",b),window.removeEventListener("orientationchange",b);try{_.removeEventListener("change",b),J.removeEventListener("change",b)}catch{}}},[]),d.useEffect(()=>{const b=()=>{try{localStorage.removeItem("ndn:avatar")}catch{}w(null),c("score")};return window.addEventListener("ndn:logout",b),()=>window.removeEventListener("ndn:logout",b)},[]),d.useEffect(()=>{const b=_=>{try{const J=String(_?.detail?.username||"").trim();if(!J)return;w(T=>T&&{...T,username:J});try{const T=(g?.email||"").toLowerCase();l&&J&&T&&l.send({type:"presence",username:J,email:T})}catch{}}catch{}};return window.addEventListener("ndn:username-changed",b),()=>window.removeEventListener("ndn:username-changed",b)},[l,g?.email]),d.useEffect(()=>{const b=_=>{try{const J=String(_?.detail?.tab||"").trim();J&&["score","offline","online","stats","settings","admin","tournaments","friends"].includes(J)&&c(J)}catch{}};return window.addEventListener("ndn:change-tab",b),()=>window.removeEventListener("ndn:change-tab",b)},[]);async function D(b){try{const _=b?.email?`?email=${encodeURIComponent(b.email)}`:"",J=await fetch("/api/subscription"+_);if(!J.ok)return;const T=await J.json();w({...b,fullAccess:!!T?.fullAccess})}catch{}}if(!g)return e.jsx($m,{onAuth:b=>{w(b),D(b)}});const v=`https://ui-avatars.com/api/?name=${encodeURIComponent(g.username||"NDN")}&background=8F43EE&color=fff&bold=true&rounded=true&size=64`;return e.jsxs(_m,{children:[e.jsxs("div",{ref:t,className:`${g?.fullAccess?"premium-body":""} h-screen overflow-hidden p-1 xs:p-2 sm:p-3 md:p-4`,children:[e.jsx(Pm,{}),e.jsxs("div",{className:"max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-[auto,1fr] gap-2 xs:gap-3 sm:gap-4 h-full overflow-hidden",children:[!u&&e.jsx("div",{className:"relative hidden lg:block",style:{width:240},children:e.jsx(no,{active:m,onChange:b=>{c(b)},user:g})}),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"pt-1 xs:pt-2",children:e.jsxs("header",{id:"ndn-header",className:"header glass flex-col xs:flex-col sm:flex-row gap-2 xs:gap-2 sm:gap-3",children:[e.jsx("div",{className:"flex items-center gap-2 order-1",children:e.jsx("h1",{className:"text-lg xs:text-xl sm:text-xl md:text-2xl font-bold text-brand-700 whitespace-nowrap cursor-pointer select-none",onClick:()=>{u&&c("score")},title:u?"Go Home":void 0,children:"NINE-DART-NATION ðŸŽ¯"})}),e.jsxs("div",{className:"order-3 xs:order-3 sm:order-2 w-full sm:w-auto flex-1 flex flex-col items-center justify-center text-center sm:text-left !text-black",children:[e.jsxs("span",{className:"text-sm xs:text-base sm:text-base md:text-lg font-semibold flex items-center gap-2 max-w-full truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[e.jsx("span",{className:"hidden xs:inline !text-black",children:"Welcome"}),e.jsx("img",{src:a||v,alt:"avatar",className:"w-5 h-5 xs:w-6 xs:h-6 sm:w-6 sm:h-6 md:w-7 md:h-7 rounded-full ring-2 ring-white/20"}),e.jsxs("span",{className:"truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[g.username,"ðŸŽ¯"]})]}),e.jsxs("span",{className:"hidden xs:inline text-xs xs:text-xs sm:text-xs md:text-sm !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:["All-time 3-dart avg: ",e.jsx("span",{className:"font-semibold !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:I.toFixed(2)})]}),u&&e.jsx("button",{className:"btn px-3 py-1 xs:px-3 xs:py-1 sm:px-3 sm:py-1 mt-1 text-sm xs:text-sm","aria-label":"Open navigation",onClick:()=>p(!0),children:"â˜° Menu"})]}),M&&E&&e.jsxs("button",{onClick:()=>c("calibrate"),className:"order-4 sm:order-4 md:order-3 px-3 py-1 text-xs sm:text-sm rounded-full bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-100 border border-emerald-400/50 transition-colors",title:"Click to adjust calibration",children:["âœ“ Calibration Active ",F!=null&&`â€¢ ${F.toFixed(1)}px`]}),e.jsxs("div",{className:"order-2 md:order-3 ml-0 md:ml-auto flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"px-3 py-1 text-sm rounded-full bg-white/5 hover:bg-white/10 border border-white/10",onClick:()=>{const b=t.current;b&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):b.requestFullscreen().catch(()=>{}))},title:r?"Exit Full Screen":"Enter Full Screen",children:r?"Exit Full Screen":"Full Screen"}),m==="online"&&e.jsx("button",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40",title:"Open a simulated online match",onClick:()=>{setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch{}},40)},children:"ONLINE DEMO"}),e.jsx(su,{}),l?e.jsx("span",{className:"ml-0 md:ml-2",children:e.jsx(Wm,{status:l.status})}):null,i?.https?e.jsx("span",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/40",title:`Phone HTTPS active on :${i.port}`,children:"HTTPS READY"}):e.jsx("span",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-slate-600/30 text-slate-300 border border-slate-400/30",title:"Enable HTTPS for iPhone camera pairing",children:"HTTP ONLY"})]})]})}),u&&e.jsx(au,{open:x,onClose:()=>p(!1),active:m,onChange:b=>{c(b),p(!1)},user:g}),e.jsxs("main",{id:"ndn-main-scroll",className:"space-y-4 flex-1 overflow-y-auto pr-1",children:[m==="settings"&&e.jsx(Hs,{children:e.jsx(Bm,{user:g})}),m==="score"&&e.jsx(Hs,{children:e.jsx(Zc,{user:g})}),m==="online"&&e.jsx(Hs,{children:e.jsx(Vm,{user:g})}),m==="offline"&&e.jsx(Hs,{children:e.jsx(Em,{user:g})}),e.jsx("div",{className:m==="calibrate"?"":"hidden",children:e.jsx(Hs,{children:e.jsx(rm,{})})}),m==="friends"&&e.jsx(Hs,{children:e.jsx(Am,{user:g})}),m==="stats"&&e.jsx(Hs,{children:e.jsx(Jm,{user:g})}),m==="tournaments"&&e.jsx(Hs,{children:e.jsx(Km,{user:g})}),m==="admin"&&e.jsx(Hs,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Om,{user:g}),e.jsx(Qm,{user:g})]})}),m==="fullaccess"&&e.jsx(Hs,{children:e.jsx(Ym,{user:g})})]})]})]})]}),e.jsx(Zm,{}),e.jsx(eu,{}),e.jsx(tu,{})]})}function au({open:t,onClose:a,active:s,onChange:r,user:n}){return e.jsx(Xm,{open:t,onClose:a,width:320,side:"left",title:"Navigate",children:e.jsx("div",{className:"mt-2",children:e.jsx(no,{active:s,onChange:r,user:n,className:"flex relative static max-h-[80vh] w-full"})})})}function ru(t){return t.length>=10&&/\d/.test(t)&&/[^A-Za-z0-9]/.test(t)}function iu(){const[t,a]=d.useState(""),[s,r]=d.useState(""),[n,i]=d.useState(""),[o,l]=d.useState(""),[m,c]=d.useState("");d.useEffect(()=>{try{const x=new URLSearchParams(window.location.search).get("token")||"";a(x)}catch{}},[]);async function u(f){if(f.preventDefault(),l(""),c(""),!t){l("Missing or invalid reset token.");return}if(!s||s!==n){l("Passwords do not match.");return}if(!ru(s)){l("Password must be at least 10 chars and include a number and symbol.");return}try{const p=await(await fetch("/api/auth/confirm-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,newPassword:s})})).json();if(!p?.ok)throw new Error(p?.error||"Reset failed");c("Password changed. You can now sign in.")}catch(x){l(x?.message||"Reset failed")}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsx("div",{className:"relative z-10 w-full max-w-lg mx-auto p-4",children:e.jsxs("form",{className:"card w-full space-y-4",onSubmit:u,children:[e.jsx("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:e.jsx("h1",{className:"logo text-center",children:"Reset your password"})}),!t&&e.jsx("div",{className:"text-red-400",children:"This reset link is missing a token. Please use the link from your email."}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"New password",value:s,onChange:f=>r(f.target.value),required:!0}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"Confirm password",value:n,onChange:f=>i(f.target.value),required:!0}),o&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:o}),m&&e.jsx("div",{className:"text-emerald-400 font-semibold text-sm",children:m}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:!t,children:"Change Password"}),e.jsx("a",{className:"underline text-sm text-center",href:"/",children:"Back to sign in"})]})})]})}class lu extends d.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,message:String(a?.message||a)}}componentDidCatch(a,s){console.error("[ErrorBoundary]",a,s)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"card max-w-lg w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"opacity-80 mb-4",children:"Please refresh the page. If this persists, let us know."}),this.state.message&&e.jsx("pre",{className:"text-xs bg-black/40 rounded p-2 overflow-auto text-left",children:this.state.message}),e.jsx("button",{className:"btn mt-4",onClick:()=>window.location.reload(),children:"Reload"})]})}):this.props.children}}try{window.React=window.React||{}}catch{}Ic();yc.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(lu,{children:e.jsx(Hm,{children:e.jsx(ou,{})})})}));function ou(){return window.location.pathname==="/reset"?e.jsx(iu,{}):e.jsx(nu,{})}
//# sourceMappingURL=index-CGBjNrD-.js.map

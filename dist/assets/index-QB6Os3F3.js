const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-irkAiYpD.js","assets/ui-CuWypN7C.js","assets/vendor-D3F3s8fL.js","assets/stats-X3jz_E9o.js","assets/OnlinePlay-DTlubsKN.js","assets/match-DA6kjEGb.js","assets/CameraView-C1ehnpRI.js","assets/pendingVisit-CK_ujpKW.js","assets/useGameStats-CAX-O-Rt.js","assets/profanity-_ZQ4W8dR.js","assets/OfflinePlay-7y_YoV87.js","assets/MatchControls-CZOUFskO.js","assets/Scoreboard-l-TGftja.js","assets/StatsPanel-RyyJrZuP.js","assets/Friends-M1KU-teV.js","assets/Tournaments-DizC2fUW.js","assets/AdminAccess-DzgyrIQI.js","assets/OpsDashboard-BDKYYM-M.js"])))=>i.map(i=>d[i]);
import{r as Sn,a as Dr,g as Cn}from"./vendor-D3F3s8fL.js";import{r as w,S as kn,L as cs,M as Ie,a as ds,U as bn,T as vt,C as yn,P as us,R as Ce,Z as _n,X as Or,b as wt,c as En,d as mt,E as vn,V as ms,e as hs,f as fs,G as gs,g as wn,h as ps,i as xs,j as bs,k as ys}from"./ui-CuWypN7C.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();var Mt={exports:{}},ht={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bn;function vs(){if(Bn)return ht;Bn=1;var a=Sn(),r=Symbol.for("react.element"),t=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,n=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(i,d,l){var m,u={},h=null,g=null;l!==void 0&&(h=""+l),d.key!==void 0&&(h=""+d.key),d.ref!==void 0&&(g=d.ref);for(m in d)o.call(d,m)&&!s.hasOwnProperty(m)&&(u[m]=d[m]);if(i&&i.defaultProps)for(m in d=i.defaultProps,d)u[m]===void 0&&(u[m]=d[m]);return{$$typeof:r,type:i,key:h,ref:g,props:u,_owner:n.current}}return ht.Fragment=t,ht.jsx=c,ht.jsxs=c,ht}var Un;function ws(){return Un||(Un=1,Mt.exports=vs()),Mt.exports}var e=ws(),bt={},Fn;function js(){if(Fn)return bt;Fn=1;var a=Dr();return bt.createRoot=a.createRoot,bt.hydrateRoot=a.hydrateRoot,bt}var Ns=js();const Ss=Cn(Ns),Cs="modulepreload",ks=function(a){return"/"+a},qn={},me=function(r,t,o){let n=Promise.resolve();if(t&&t.length>0){let d=function(l){return Promise.all(l.map(m=>Promise.resolve(m).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),i=c?.nonce||c?.getAttribute("nonce");n=d(t.map(l=>{if(l=ks(l),l in qn)return;qn[l]=!0;const m=l.endsWith(".css"),u=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=m?"stylesheet":Cs,m||(h.as="script"),h.crossOrigin="",h.href=l,i&&h.setAttribute("nonce",i),document.head.appendChild(h),m)return new Promise((g,p)=>{h.addEventListener("load",g),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return n.then(c=>{for(const i of c||[])i.status==="rejected"&&s(i.reason);return r().catch(s)})};var $n=Dr();const _r=a=>`ndn_online_quota_${a}`;function jt(a=new Date){const r=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate())),t=r.getUTCDay()||7;r.setUTCDate(r.getUTCDate()+4-t);const o=new Date(Date.UTC(r.getUTCFullYear(),0,1)),n=Math.ceil(((r.getTime()-o.getTime())/864e5+1)/7),s=String(n).padStart(2,"0");return`${r.getUTCFullYear()}-${s}`}function Br(a){try{const r=localStorage.getItem(_r(a));if(!r)return{week:jt(),used:0};const t=JSON.parse(r),o=jt();return!t.week||t.week!==o?{week:o,used:0}:{week:String(t.week),used:Number(t.used)||0}}catch{return{week:jt(),used:0}}}function Es(a,r){try{localStorage.setItem(_r(a),JSON.stringify(r))}catch{}}function Ho(a,r=3){const t=jt(),o=Br(a),n={week:t,used:(o.week===t?o.used:0)+1};return Es(a,n),n}function Ts(a,r=3){const t=Br(a);return Math.max(0,r-(t.used||0))}const Ur={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8787",VITE_WS_URL:"ws://localhost:8787"},Fr="ndn:isAdmin:v1";function qr(){try{const a=localStorage.getItem(Fr);return a?JSON.parse(a):{}}catch{return{}}}function Is(a,r){try{const t=qr();t[(a||"").toLowerCase()]={v:r,ts:Date.now()},localStorage.setItem(Fr,JSON.stringify(t))}catch{}}async function Ps(a){const r=String(a||"").toLowerCase();if(!r)return!1;try{const n=String(Ur?.VITE_OWNER_EMAIL||"").toLowerCase();if(n&&r===n)return!0}catch{}if(r==="daviesfamily108@gmail.com")return!0;try{const n=localStorage.getItem("ndn:forceAdmin");if(n==="1"||n==="true")return!0}catch{}const o=qr()[r];if(o&&Date.now()-o.ts<300*1e3)return!!o.v;try{const c=!!(await(await fetch(`/api/admins/check?email=${encodeURIComponent(r)}`)).json().catch(()=>({})))?.isAdmin;return Is(r,c),c}catch{return!!o?.v}}function Rs(a){const r=String(a||"").toLowerCase(),[t,o]=w.useState(!1);return w.useEffect(()=>{let n=!0;if(!r){o(!1);return}try{const s=String(Ur?.VITE_OWNER_EMAIL||"").toLowerCase(),c=(()=>{try{const i=localStorage.getItem("ndn:forceAdmin");return i==="1"||i==="true"}catch{return!1}})();if(s&&r===s){o(!0);return}if(c){o(!0);return}}catch{}if(r==="daviesfamily108@gmail.com"){o(!0);return}return Ps(r).then(s=>{n&&o(!!s)}),()=>{n=!1}},[r]),t}const As={},Ms=5,Ls={GBP:1,EUR:1.16,USD:1.26,AUD:1.92,NZD:2.08,CAD:1.73};function Wo(a,r=Ms){const t=(a||"GBP").toUpperCase(),o=Ls[t]??1,n=r*o;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:t}).format(n)}catch{return`${t} ${n.toFixed(2)}`}}function Go(){try{const a=new Intl.NumberFormat().resolvedOptions(),r=String(a.locale).toLowerCase();return r.includes("-gb")?"GBP":r.includes("-ie")||r.includes("-de")||r.includes("-fr")||r.includes("-es")||r.includes("-it")||r.includes("-nl")?"EUR":r.includes("-us")?"USD":r.includes("-au")?"AUD":r.includes("-nz")?"NZD":r.includes("-ca")?"CAD":"GBP"}catch{return"GBP"}}const Ds=As?.VITE_DISCORD_INVITE_URL||"https://discord.gg/nCfT4hJz";let De=null;function Os(){if(De)return De;const a="http://localhost:8787".trim();if(a)return De=a.replace(/\/$/,""),De;if(typeof window<"u"){const{protocol:r,host:t,hostname:o}=window.location,n=`${r}//${t}`;return o.endsWith("onrender.com")||o==="localhost"||o==="127.0.0.1"?De=n.replace(/\/$/,""):De="https://ninedartnation.onrender.com",De}return De="https://ninedartnation.onrender.com",De}function _s(a){if(/^https?:\/\//i.test(a))return a;const r=Os(),t=a.startsWith("/")?a:`/${a}`;return`${r}${t}`}function Nt(a){return _s(a)}function ze(a,r){const t=Nt(a);return fetch(t,r)}function Bs(){if(typeof window>"u"||typeof window.fetch!="function")return;const a=window;if(a.__ndnApiPatched)return;const r=window.fetch.bind(window);window.fetch=(t,o)=>{try{if(typeof t=="string")return t.startsWith("/")?r(Nt(t),o):r(t,o);if(t instanceof Request){const n=t.url.startsWith("/")?Nt(t.url):t.url;if(n===t.url)return r(t,o);const s=new Request(n,t);return r(s,o)}if(t instanceof URL){const n=t.href.startsWith("/")?Nt(t.href):t.href;return r(n,o)}}catch(n){console.warn("[API] Interceptor failed, falling back to original fetch",n)}return r(t,o)},a.__ndnApiPatched=!0}function Us(a){const r=[{key:"score",label:"Home",icon:ds},{key:"online",label:"Online",icon:bn},{key:"offline",label:"Offline",icon:vt},{key:"tournaments",label:"Tournaments",icon:vt},{key:"friends",label:"Friends",icon:bn},{key:"stats",label:"Stats",icon:vt},{key:"calibrate",label:"Calibrate",icon:yn},{key:"settings",label:"Settings",icon:kn}];return a?.fullAccess||r.push({key:"fullaccess",label:"PREMIUM £€$",icon:us}),r}function $r({active:a,onChange:r,user:t,className:o}){const n=Us(t),s=Rs(t?.email);if(s&&!n.some(g=>g.key==="admin")){const g=n.findIndex(y=>y.key==="settings"),p={key:"admin",label:"Admin",icon:kn};g>=0?n.splice(g,0,p):n.push(p)}const[c,i]=w.useState(!1),[d,l]=w.useState(!1),m=t?.username&&!t?.fullAccess?Ts(t.username):1/0,[u,h]=w.useState({friendRequests:0,messages:0,tournaments:0});return w.useEffect(()=>{if(!t?.email)return;const g=async()=>{try{const[y,v]=await Promise.all([ze(`/api/friends/requests?email=${encodeURIComponent(t.email)}`),ze(`/api/friends/messages?email=${encodeURIComponent(t.email)}`)]),b=y.ok?await y.json():{requests:[]},N=(v.ok?await v.json():{messages:[]}).messages?.filter(C=>!C.read).length||0;h({friendRequests:b.requests?.length||0,messages:N,tournaments:0})}catch(y){console.error("Failed to fetch notifications:",y)}};g();const p=setInterval(g,3e4);return()=>clearInterval(p)},[t?.email]),w.useEffect(()=>{if(!c)return;const g=p=>{(p.key==="Escape"||p.key==="Enter")&&i(!1)};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[c]),e.jsxs("aside",{className:`${t?.fullAccess?"premium-sidebar":""} sidebar glass ${o?"":"w-60"} p-2 sm:p-4 rounded-2xl ${o??"hidden sm:flex"} flex-col gap-2 overflow-y-auto overflow-x-hidden ${o?"":"fixed top-2 bottom-2 sm:top-4 sm:bottom-4"}`,children:[n.map(({key:g,label:p,icon:y})=>g==="admin"&&!s?null:e.jsxs("button",{className:`tab whitespace-nowrap flex items-center justify-start gap-3 ${a===g?"tab--active":"tab--inactive"} `,onClick:()=>r(g),title:p,style:{fontWeight:700,fontSize:"1.1rem",color:a===g?"#fff":"#E5E7EB",letterSpacing:"0.02em"},children:[e.jsx(y,{className:"w-6 h-6"}),e.jsxs("span",{className:"flex items-center gap-2",children:[p,g==="online"&&!t?.fullAccess&&m<=0&&e.jsxs("span",{title:"Weekly free games used",className:"inline-flex items-center gap-1 text-[0.65rem] px-2 py-0.5 rounded-full bg-rose-600 text-white",children:[e.jsx(cs,{className:"w-3 h-3"}),"Locked"]}),g==="friends"&&u.friendRequests>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:u.friendRequests>9?"9+":u.friendRequests}),g==="score"&&(u.messages>0||u.tournaments>0)&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:u.messages+u.tournaments>9?"9+":u.messages+u.tournaments})]})]},g)),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-2",onClick:()=>i(!0),title:"BullseyeDartsLeague",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(Ie,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"BullseyeDartsLeague"})]}),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-1",onClick:()=>l(!0),title:"NineDartNation",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(Ie,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"NineDartNation"})]}),c&&$n.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>i(!1),onTouchStart:()=>i(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>i(!1),children:"✕"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(Ie,{className:"w-6 h-6"})," BullseyeDartsLeague"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join this fantastic Online Darts League with divisions and other cool stuff included"}),e.jsx("a",{href:Ds,target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body),d&&$n.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>l(!1),onTouchStart:()=>l(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>l(!1),children:"✕"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(Ie,{className:"w-6 h-6"})," NineDartNation"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join the NineDartNation Discord community"}),e.jsx("a",{href:"https://discord.gg/Q33J5FTVve",target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body)]})}function Ee({children:a,className:r,style:t}){const o=w.useRef(null);return w.useEffect(()=>{let n=0;const s=()=>{const d=o.current;if(!d)return;const l=document.getElementById("ndn-header");if(!l){d.style.clipPath="";return}const m=document.getElementById("ndn-main-scroll"),u=m?m.scrollTop:window.scrollY||0,h=l.getBoundingClientRect().height,g=u>0?h:0;try{let p=d.querySelector("[data-ndn-top-mask]");p||(p=document.createElement("div"),p.setAttribute("data-ndn-top-mask","1"),Object.assign(p.style,{position:"absolute",left:"0px",right:"0px",top:"0px",height:"0px",pointerEvents:"none",zIndex:"20",background:"linear-gradient(to bottom, rgba(17,24,39,1), rgba(17,24,39,0))"}),d.style.position=d.style.position||"relative",d.insertBefore(p,d.firstChild)),g>0?(p.style.height=`${g}px`,p.style.display=""):(p.style.height="0px",p.style.display="none"),d.style.marginTop="0px"}catch{d.style.marginTop="0px"}};s();const c=()=>{n&&cancelAnimationFrame(n),n=requestAnimationFrame(s)},i=document.getElementById("ndn-main-scroll");return i?.addEventListener("scroll",c,{passive:!0}),window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c),()=>{i?.removeEventListener("scroll",c),window.removeEventListener("scroll",c),window.removeEventListener("resize",c),n&&cancelAnimationFrame(n)}},[]),e.jsx("div",{ref:o,className:r,style:t,children:a})}var ot={},Lt,zn;function Fs(){return zn||(zn=1,Lt=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),Lt}var Dt={},$e={},Vn;function Ke(){if(Vn)return $e;Vn=1;let a;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return $e.getSymbolSize=function(o){if(!o)throw new Error('"version" cannot be null or undefined');if(o<1||o>40)throw new Error('"version" should be in range from 1 to 40');return o*4+17},$e.getSymbolTotalCodewords=function(o){return r[o]},$e.getBCHDigit=function(t){let o=0;for(;t!==0;)o++,t>>>=1;return o},$e.setToSJISFunction=function(o){if(typeof o!="function")throw new Error('"toSJISFunc" is not a valid function.');a=o},$e.isKanjiModeEnabled=function(){return typeof a<"u"},$e.toSJIS=function(o){return a(o)},$e}var Ot={},Hn;function Tn(){return Hn||(Hn=1,(function(a){a.L={bit:1},a.M={bit:0},a.Q={bit:3},a.H={bit:2};function r(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return a.L;case"m":case"medium":return a.M;case"q":case"quartile":return a.Q;case"h":case"high":return a.H;default:throw new Error("Unknown EC Level: "+t)}}a.isValid=function(o){return o&&typeof o.bit<"u"&&o.bit>=0&&o.bit<4},a.from=function(o,n){if(a.isValid(o))return o;try{return r(o)}catch{return n}}})(Ot)),Ot}var _t,Wn;function qs(){if(Wn)return _t;Wn=1;function a(){this.buffer=[],this.length=0}return a.prototype={get:function(r){const t=Math.floor(r/8);return(this.buffer[t]>>>7-r%8&1)===1},put:function(r,t){for(let o=0;o<t;o++)this.putBit((r>>>t-o-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(r){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),r&&(this.buffer[t]|=128>>>this.length%8),this.length++}},_t=a,_t}var Bt,Gn;function $s(){if(Gn)return Bt;Gn=1;function a(r){if(!r||r<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=r,this.data=new Uint8Array(r*r),this.reservedBit=new Uint8Array(r*r)}return a.prototype.set=function(r,t,o,n){const s=r*this.size+t;this.data[s]=o,n&&(this.reservedBit[s]=!0)},a.prototype.get=function(r,t){return this.data[r*this.size+t]},a.prototype.xor=function(r,t,o){this.data[r*this.size+t]^=o},a.prototype.isReserved=function(r,t){return this.reservedBit[r*this.size+t]},Bt=a,Bt}var Ut={},Jn;function zs(){return Jn||(Jn=1,(function(a){const r=Ke().getSymbolSize;a.getRowColCoords=function(o){if(o===1)return[];const n=Math.floor(o/7)+2,s=r(o),c=s===145?26:Math.ceil((s-13)/(2*n-2))*2,i=[s-7];for(let d=1;d<n-1;d++)i[d]=i[d-1]-c;return i.push(6),i.reverse()},a.getPositions=function(o){const n=[],s=a.getRowColCoords(o),c=s.length;for(let i=0;i<c;i++)for(let d=0;d<c;d++)i===0&&d===0||i===0&&d===c-1||i===c-1&&d===0||n.push([s[i],s[d]]);return n}})(Ut)),Ut}var Ft={},Yn;function Vs(){if(Yn)return Ft;Yn=1;const a=Ke().getSymbolSize,r=7;return Ft.getPositions=function(o){const n=a(o);return[[0,0],[n-r,0],[0,n-r]]},Ft}var qt={},Kn;function Hs(){return Kn||(Kn=1,(function(a){a.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const r={N1:3,N2:3,N3:40,N4:10};a.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7},a.from=function(n){return a.isValid(n)?parseInt(n,10):void 0},a.getPenaltyN1=function(n){const s=n.size;let c=0,i=0,d=0,l=null,m=null;for(let u=0;u<s;u++){i=d=0,l=m=null;for(let h=0;h<s;h++){let g=n.get(u,h);g===l?i++:(i>=5&&(c+=r.N1+(i-5)),l=g,i=1),g=n.get(h,u),g===m?d++:(d>=5&&(c+=r.N1+(d-5)),m=g,d=1)}i>=5&&(c+=r.N1+(i-5)),d>=5&&(c+=r.N1+(d-5))}return c},a.getPenaltyN2=function(n){const s=n.size;let c=0;for(let i=0;i<s-1;i++)for(let d=0;d<s-1;d++){const l=n.get(i,d)+n.get(i,d+1)+n.get(i+1,d)+n.get(i+1,d+1);(l===4||l===0)&&c++}return c*r.N2},a.getPenaltyN3=function(n){const s=n.size;let c=0,i=0,d=0;for(let l=0;l<s;l++){i=d=0;for(let m=0;m<s;m++)i=i<<1&2047|n.get(l,m),m>=10&&(i===1488||i===93)&&c++,d=d<<1&2047|n.get(m,l),m>=10&&(d===1488||d===93)&&c++}return c*r.N3},a.getPenaltyN4=function(n){let s=0;const c=n.data.length;for(let d=0;d<c;d++)s+=n.data[d];return Math.abs(Math.ceil(s*100/c/5)-10)*r.N4};function t(o,n,s){switch(o){case a.Patterns.PATTERN000:return(n+s)%2===0;case a.Patterns.PATTERN001:return n%2===0;case a.Patterns.PATTERN010:return s%3===0;case a.Patterns.PATTERN011:return(n+s)%3===0;case a.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(s/3))%2===0;case a.Patterns.PATTERN101:return n*s%2+n*s%3===0;case a.Patterns.PATTERN110:return(n*s%2+n*s%3)%2===0;case a.Patterns.PATTERN111:return(n*s%3+(n+s)%2)%2===0;default:throw new Error("bad maskPattern:"+o)}}a.applyMask=function(n,s){const c=s.size;for(let i=0;i<c;i++)for(let d=0;d<c;d++)s.isReserved(d,i)||s.xor(d,i,t(n,d,i))},a.getBestMask=function(n,s){const c=Object.keys(a.Patterns).length;let i=0,d=1/0;for(let l=0;l<c;l++){s(l),a.applyMask(l,n);const m=a.getPenaltyN1(n)+a.getPenaltyN2(n)+a.getPenaltyN3(n)+a.getPenaltyN4(n);a.applyMask(l,n),m<d&&(d=m,i=l)}return i}})(qt)),qt}var yt={},Zn;function zr(){if(Zn)return yt;Zn=1;const a=Tn(),r=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],t=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return yt.getBlocksCount=function(n,s){switch(s){case a.L:return r[(n-1)*4+0];case a.M:return r[(n-1)*4+1];case a.Q:return r[(n-1)*4+2];case a.H:return r[(n-1)*4+3];default:return}},yt.getTotalCodewordsCount=function(n,s){switch(s){case a.L:return t[(n-1)*4+0];case a.M:return t[(n-1)*4+1];case a.Q:return t[(n-1)*4+2];case a.H:return t[(n-1)*4+3];default:return}},yt}var $t={},ft={},Qn;function Ws(){if(Qn)return ft;Qn=1;const a=new Uint8Array(512),r=new Uint8Array(256);return(function(){let o=1;for(let n=0;n<255;n++)a[n]=o,r[o]=n,o<<=1,o&256&&(o^=285);for(let n=255;n<512;n++)a[n]=a[n-255]})(),ft.log=function(o){if(o<1)throw new Error("log("+o+")");return r[o]},ft.exp=function(o){return a[o]},ft.mul=function(o,n){return o===0||n===0?0:a[r[o]+r[n]]},ft}var Xn;function Gs(){return Xn||(Xn=1,(function(a){const r=Ws();a.mul=function(o,n){const s=new Uint8Array(o.length+n.length-1);for(let c=0;c<o.length;c++)for(let i=0;i<n.length;i++)s[c+i]^=r.mul(o[c],n[i]);return s},a.mod=function(o,n){let s=new Uint8Array(o);for(;s.length-n.length>=0;){const c=s[0];for(let d=0;d<n.length;d++)s[d]^=r.mul(n[d],c);let i=0;for(;i<s.length&&s[i]===0;)i++;s=s.slice(i)}return s},a.generateECPolynomial=function(o){let n=new Uint8Array([1]);for(let s=0;s<o;s++)n=a.mul(n,new Uint8Array([1,r.exp(s)]));return n}})($t)),$t}var zt,er;function Js(){if(er)return zt;er=1;const a=Gs();function r(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}return r.prototype.initialize=function(o){this.degree=o,this.genPoly=a.generateECPolynomial(this.degree)},r.prototype.encode=function(o){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(o.length+this.degree);n.set(o);const s=a.mod(n,this.genPoly),c=this.degree-s.length;if(c>0){const i=new Uint8Array(this.degree);return i.set(s,c),i}return s},zt=r,zt}var Vt={},Ht={},Wt={},tr;function Vr(){return tr||(tr=1,Wt.isValid=function(r){return!isNaN(r)&&r>=1&&r<=40}),Wt}var Te={},nr;function Hr(){if(nr)return Te;nr=1;const a="[0-9]+",r="[A-Z $%*+\\-./:]+";let t="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";t=t.replace(/u/g,"\\u");const o="(?:(?![A-Z0-9 $%*+\\-./:]|"+t+`)(?:.|[\r
]))+`;Te.KANJI=new RegExp(t,"g"),Te.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Te.BYTE=new RegExp(o,"g"),Te.NUMERIC=new RegExp(a,"g"),Te.ALPHANUMERIC=new RegExp(r,"g");const n=new RegExp("^"+t+"$"),s=new RegExp("^"+a+"$"),c=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Te.testKanji=function(d){return n.test(d)},Te.testNumeric=function(d){return s.test(d)},Te.testAlphanumeric=function(d){return c.test(d)},Te}var rr;function Ze(){return rr||(rr=1,(function(a){const r=Vr(),t=Hr();a.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},a.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},a.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},a.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},a.MIXED={bit:-1},a.getCharCountIndicator=function(s,c){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!r.isValid(c))throw new Error("Invalid version: "+c);return c>=1&&c<10?s.ccBits[0]:c<27?s.ccBits[1]:s.ccBits[2]},a.getBestModeForData=function(s){return t.testNumeric(s)?a.NUMERIC:t.testAlphanumeric(s)?a.ALPHANUMERIC:t.testKanji(s)?a.KANJI:a.BYTE},a.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},a.isValid=function(s){return s&&s.bit&&s.ccBits};function o(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return a.NUMERIC;case"alphanumeric":return a.ALPHANUMERIC;case"kanji":return a.KANJI;case"byte":return a.BYTE;default:throw new Error("Unknown mode: "+n)}}a.from=function(s,c){if(a.isValid(s))return s;try{return o(s)}catch{return c}}})(Ht)),Ht}var sr;function Ys(){return sr||(sr=1,(function(a){const r=Ke(),t=zr(),o=Tn(),n=Ze(),s=Vr(),c=7973,i=r.getBCHDigit(c);function d(h,g,p){for(let y=1;y<=40;y++)if(g<=a.getCapacity(y,p,h))return y}function l(h,g){return n.getCharCountIndicator(h,g)+4}function m(h,g){let p=0;return h.forEach(function(y){const v=l(y.mode,g);p+=v+y.getBitsLength()}),p}function u(h,g){for(let p=1;p<=40;p++)if(m(h,p)<=a.getCapacity(p,g,n.MIXED))return p}a.from=function(g,p){return s.isValid(g)?parseInt(g,10):p},a.getCapacity=function(g,p,y){if(!s.isValid(g))throw new Error("Invalid QR Code version");typeof y>"u"&&(y=n.BYTE);const v=r.getSymbolTotalCodewords(g),b=t.getTotalCodewordsCount(g,p),S=(v-b)*8;if(y===n.MIXED)return S;const N=S-l(y,g);switch(y){case n.NUMERIC:return Math.floor(N/10*3);case n.ALPHANUMERIC:return Math.floor(N/11*2);case n.KANJI:return Math.floor(N/13);case n.BYTE:default:return Math.floor(N/8)}},a.getBestVersionForData=function(g,p){let y;const v=o.from(p,o.M);if(Array.isArray(g)){if(g.length>1)return u(g,v);if(g.length===0)return 1;y=g[0]}else y=g;return d(y.mode,y.getLength(),v)},a.getEncodedBits=function(g){if(!s.isValid(g)||g<7)throw new Error("Invalid QR Code version");let p=g<<12;for(;r.getBCHDigit(p)-i>=0;)p^=c<<r.getBCHDigit(p)-i;return g<<12|p}})(Vt)),Vt}var Gt={},ar;function Ks(){if(ar)return Gt;ar=1;const a=Ke(),r=1335,t=21522,o=a.getBCHDigit(r);return Gt.getEncodedBits=function(s,c){const i=s.bit<<3|c;let d=i<<10;for(;a.getBCHDigit(d)-o>=0;)d^=r<<a.getBCHDigit(d)-o;return(i<<10|d)^t},Gt}var Jt={},Yt,or;function Zs(){if(or)return Yt;or=1;const a=Ze();function r(t){this.mode=a.NUMERIC,this.data=t.toString()}return r.getBitsLength=function(o){return 10*Math.floor(o/3)+(o%3?o%3*3+1:0)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(o){let n,s,c;for(n=0;n+3<=this.data.length;n+=3)s=this.data.substr(n,3),c=parseInt(s,10),o.put(c,10);const i=this.data.length-n;i>0&&(s=this.data.substr(n),c=parseInt(s,10),o.put(c,i*3+1))},Yt=r,Yt}var Kt,ir;function Qs(){if(ir)return Kt;ir=1;const a=Ze(),r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function t(o){this.mode=a.ALPHANUMERIC,this.data=o}return t.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(n){let s;for(s=0;s+2<=this.data.length;s+=2){let c=r.indexOf(this.data[s])*45;c+=r.indexOf(this.data[s+1]),n.put(c,11)}this.data.length%2&&n.put(r.indexOf(this.data[s]),6)},Kt=t,Kt}var Zt,lr;function Xs(){if(lr)return Zt;lr=1;const a=Ze();function r(t){this.mode=a.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}return r.getBitsLength=function(o){return o*8},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(t){for(let o=0,n=this.data.length;o<n;o++)t.put(this.data[o],8)},Zt=r,Zt}var Qt,cr;function ea(){if(cr)return Qt;cr=1;const a=Ze(),r=Ke();function t(o){this.mode=a.KANJI,this.data=o}return t.getBitsLength=function(n){return n*13},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(o){let n;for(n=0;n<this.data.length;n++){let s=r.toSJIS(this.data[n]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),o.put(s,13)}},Qt=t,Qt}var Xt={exports:{}},dr;function ta(){return dr||(dr=1,(function(a){var r={single_source_shortest_paths:function(t,o,n){var s={},c={};c[o]=0;var i=r.PriorityQueue.make();i.push(o,0);for(var d,l,m,u,h,g,p,y,v;!i.empty();){d=i.pop(),l=d.value,u=d.cost,h=t[l]||{};for(m in h)h.hasOwnProperty(m)&&(g=h[m],p=u+g,y=c[m],v=typeof c[m]>"u",(v||y>p)&&(c[m]=p,i.push(m,p),s[m]=l))}if(typeof n<"u"&&typeof c[n]>"u"){var b=["Could not find a path from ",o," to ",n,"."].join("");throw new Error(b)}return s},extract_shortest_path_from_predecessor_list:function(t,o){for(var n=[],s=o;s;)n.push(s),t[s],s=t[s];return n.reverse(),n},find_path:function(t,o,n){var s=r.single_source_shortest_paths(t,o,n);return r.extract_shortest_path_from_predecessor_list(s,n)},PriorityQueue:{make:function(t){var o=r.PriorityQueue,n={},s;t=t||{};for(s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);return n.queue=[],n.sorter=t.sorter||o.default_sorter,n},default_sorter:function(t,o){return t.cost-o.cost},push:function(t,o){var n={value:t,cost:o};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};a.exports=r})(Xt)),Xt.exports}var ur;function na(){return ur||(ur=1,(function(a){const r=Ze(),t=Zs(),o=Qs(),n=Xs(),s=ea(),c=Hr(),i=Ke(),d=ta();function l(b){return unescape(encodeURIComponent(b)).length}function m(b,S,N){const C=[];let E;for(;(E=b.exec(N))!==null;)C.push({data:E[0],index:E.index,mode:S,length:E[0].length});return C}function u(b){const S=m(c.NUMERIC,r.NUMERIC,b),N=m(c.ALPHANUMERIC,r.ALPHANUMERIC,b);let C,E;return i.isKanjiModeEnabled()?(C=m(c.BYTE,r.BYTE,b),E=m(c.KANJI,r.KANJI,b)):(C=m(c.BYTE_KANJI,r.BYTE,b),E=[]),S.concat(N,C,E).sort(function(f,k){return f.index-k.index}).map(function(f){return{data:f.data,mode:f.mode,length:f.length}})}function h(b,S){switch(S){case r.NUMERIC:return t.getBitsLength(b);case r.ALPHANUMERIC:return o.getBitsLength(b);case r.KANJI:return s.getBitsLength(b);case r.BYTE:return n.getBitsLength(b)}}function g(b){return b.reduce(function(S,N){const C=S.length-1>=0?S[S.length-1]:null;return C&&C.mode===N.mode?(S[S.length-1].data+=N.data,S):(S.push(N),S)},[])}function p(b){const S=[];for(let N=0;N<b.length;N++){const C=b[N];switch(C.mode){case r.NUMERIC:S.push([C,{data:C.data,mode:r.ALPHANUMERIC,length:C.length},{data:C.data,mode:r.BYTE,length:C.length}]);break;case r.ALPHANUMERIC:S.push([C,{data:C.data,mode:r.BYTE,length:C.length}]);break;case r.KANJI:S.push([C,{data:C.data,mode:r.BYTE,length:l(C.data)}]);break;case r.BYTE:S.push([{data:C.data,mode:r.BYTE,length:l(C.data)}])}}return S}function y(b,S){const N={},C={start:{}};let E=["start"];for(let j=0;j<b.length;j++){const f=b[j],k=[];for(let R=0;R<f.length;R++){const L=f[R],I=""+j+R;k.push(I),N[I]={node:L,lastCount:0},C[I]={};for(let P=0;P<E.length;P++){const A=E[P];N[A]&&N[A].node.mode===L.mode?(C[A][I]=h(N[A].lastCount+L.length,L.mode)-h(N[A].lastCount,L.mode),N[A].lastCount+=L.length):(N[A]&&(N[A].lastCount=L.length),C[A][I]=h(L.length,L.mode)+4+r.getCharCountIndicator(L.mode,S))}}E=k}for(let j=0;j<E.length;j++)C[E[j]].end=0;return{map:C,table:N}}function v(b,S){let N;const C=r.getBestModeForData(b);if(N=r.from(S,C),N!==r.BYTE&&N.bit<C.bit)throw new Error('"'+b+'" cannot be encoded with mode '+r.toString(N)+`.
 Suggested mode is: `+r.toString(C));switch(N===r.KANJI&&!i.isKanjiModeEnabled()&&(N=r.BYTE),N){case r.NUMERIC:return new t(b);case r.ALPHANUMERIC:return new o(b);case r.KANJI:return new s(b);case r.BYTE:return new n(b)}}a.fromArray=function(S){return S.reduce(function(N,C){return typeof C=="string"?N.push(v(C,null)):C.data&&N.push(v(C.data,C.mode)),N},[])},a.fromString=function(S,N){const C=u(S,i.isKanjiModeEnabled()),E=p(C),j=y(E,N),f=d.find_path(j.map,"start","end"),k=[];for(let R=1;R<f.length-1;R++)k.push(j.table[f[R]].node);return a.fromArray(g(k))},a.rawSplit=function(S){return a.fromArray(u(S,i.isKanjiModeEnabled()))}})(Jt)),Jt}var mr;function ra(){if(mr)return Dt;mr=1;const a=Ke(),r=Tn(),t=qs(),o=$s(),n=zs(),s=Vs(),c=Hs(),i=zr(),d=Js(),l=Ys(),m=Ks(),u=Ze(),h=na();function g(j,f){const k=j.size,R=s.getPositions(f);for(let L=0;L<R.length;L++){const I=R[L][0],P=R[L][1];for(let A=-1;A<=7;A++)if(!(I+A<=-1||k<=I+A))for(let O=-1;O<=7;O++)P+O<=-1||k<=P+O||(A>=0&&A<=6&&(O===0||O===6)||O>=0&&O<=6&&(A===0||A===6)||A>=2&&A<=4&&O>=2&&O<=4?j.set(I+A,P+O,!0,!0):j.set(I+A,P+O,!1,!0))}}function p(j){const f=j.size;for(let k=8;k<f-8;k++){const R=k%2===0;j.set(k,6,R,!0),j.set(6,k,R,!0)}}function y(j,f){const k=n.getPositions(f);for(let R=0;R<k.length;R++){const L=k[R][0],I=k[R][1];for(let P=-2;P<=2;P++)for(let A=-2;A<=2;A++)P===-2||P===2||A===-2||A===2||P===0&&A===0?j.set(L+P,I+A,!0,!0):j.set(L+P,I+A,!1,!0)}}function v(j,f){const k=j.size,R=l.getEncodedBits(f);let L,I,P;for(let A=0;A<18;A++)L=Math.floor(A/3),I=A%3+k-8-3,P=(R>>A&1)===1,j.set(L,I,P,!0),j.set(I,L,P,!0)}function b(j,f,k){const R=j.size,L=m.getEncodedBits(f,k);let I,P;for(I=0;I<15;I++)P=(L>>I&1)===1,I<6?j.set(I,8,P,!0):I<8?j.set(I+1,8,P,!0):j.set(R-15+I,8,P,!0),I<8?j.set(8,R-I-1,P,!0):I<9?j.set(8,15-I-1+1,P,!0):j.set(8,15-I-1,P,!0);j.set(R-8,8,1,!0)}function S(j,f){const k=j.size;let R=-1,L=k-1,I=7,P=0;for(let A=k-1;A>0;A-=2)for(A===6&&A--;;){for(let O=0;O<2;O++)if(!j.isReserved(L,A-O)){let W=!1;P<f.length&&(W=(f[P]>>>I&1)===1),j.set(L,A-O,W),I--,I===-1&&(P++,I=7)}if(L+=R,L<0||k<=L){L-=R,R=-R;break}}}function N(j,f,k){const R=new t;k.forEach(function(O){R.put(O.mode.bit,4),R.put(O.getLength(),u.getCharCountIndicator(O.mode,j)),O.write(R)});const L=a.getSymbolTotalCodewords(j),I=i.getTotalCodewordsCount(j,f),P=(L-I)*8;for(R.getLengthInBits()+4<=P&&R.put(0,4);R.getLengthInBits()%8!==0;)R.putBit(0);const A=(P-R.getLengthInBits())/8;for(let O=0;O<A;O++)R.put(O%2?17:236,8);return C(R,j,f)}function C(j,f,k){const R=a.getSymbolTotalCodewords(f),L=i.getTotalCodewordsCount(f,k),I=R-L,P=i.getBlocksCount(f,k),A=R%P,O=P-A,W=Math.floor(R/P),Z=Math.floor(I/P),se=Z+1,ae=W-Z,fe=new d(ae);let we=0;const xe=new Array(P),je=new Array(P);let Ne=0;const Oe=new Uint8Array(j.buffer);for(let le=0;le<P;le++){const He=le<O?Z:se;xe[le]=Oe.slice(we,we+He),je[le]=fe.encode(xe[le]),we+=He,Ne=Math.max(Ne,He)}const G=new Uint8Array(R);let Ve=0,Q,de;for(Q=0;Q<Ne;Q++)for(de=0;de<P;de++)Q<xe[de].length&&(G[Ve++]=xe[de][Q]);for(Q=0;Q<ae;Q++)for(de=0;de<P;de++)G[Ve++]=je[de][Q];return G}function E(j,f,k,R){let L;if(Array.isArray(j))L=h.fromArray(j);else if(typeof j=="string"){let W=f;if(!W){const Z=h.rawSplit(j);W=l.getBestVersionForData(Z,k)}L=h.fromString(j,W||40)}else throw new Error("Invalid data");const I=l.getBestVersionForData(L,k);if(!I)throw new Error("The amount of data is too big to be stored in a QR Code");if(!f)f=I;else if(f<I)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+I+`.
`);const P=N(f,k,L),A=a.getSymbolSize(f),O=new o(A);return g(O,f),p(O),y(O,f),b(O,k,0),f>=7&&v(O,f),S(O,P),isNaN(R)&&(R=c.getBestMask(O,b.bind(null,O,k))),c.applyMask(R,O),b(O,k,R),{modules:O,version:f,errorCorrectionLevel:k,maskPattern:R,segments:L}}return Dt.create=function(f,k){if(typeof f>"u"||f==="")throw new Error("No input text");let R=r.M,L,I;return typeof k<"u"&&(R=r.from(k.errorCorrectionLevel,r.M),L=l.from(k.version),I=c.from(k.maskPattern),k.toSJISFunc&&a.setToSJISFunction(k.toSJISFunc)),E(f,L,R,I)},Dt}var en={},tn={},hr;function Wr(){return hr||(hr=1,(function(a){function r(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let o=t.slice().replace("#","").split("");if(o.length<3||o.length===5||o.length>8)throw new Error("Invalid hex color: "+t);(o.length===3||o.length===4)&&(o=Array.prototype.concat.apply([],o.map(function(s){return[s,s]}))),o.length===6&&o.push("F","F");const n=parseInt(o.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+o.slice(0,6).join("")}}a.getOptions=function(o){o||(o={}),o.color||(o.color={});const n=typeof o.margin>"u"||o.margin===null||o.margin<0?4:o.margin,s=o.width&&o.width>=21?o.width:void 0,c=o.scale||4;return{width:s,scale:s?4:c,margin:n,color:{dark:r(o.color.dark||"#000000ff"),light:r(o.color.light||"#ffffffff")},type:o.type,rendererOpts:o.rendererOpts||{}}},a.getScale=function(o,n){return n.width&&n.width>=o+n.margin*2?n.width/(o+n.margin*2):n.scale},a.getImageWidth=function(o,n){const s=a.getScale(o,n);return Math.floor((o+n.margin*2)*s)},a.qrToImageData=function(o,n,s){const c=n.modules.size,i=n.modules.data,d=a.getScale(c,s),l=Math.floor((c+s.margin*2)*d),m=s.margin*d,u=[s.color.light,s.color.dark];for(let h=0;h<l;h++)for(let g=0;g<l;g++){let p=(h*l+g)*4,y=s.color.light;if(h>=m&&g>=m&&h<l-m&&g<l-m){const v=Math.floor((h-m)/d),b=Math.floor((g-m)/d);y=u[i[v*c+b]?1:0]}o[p++]=y.r,o[p++]=y.g,o[p++]=y.b,o[p]=y.a}}})(tn)),tn}var fr;function sa(){return fr||(fr=1,(function(a){const r=Wr();function t(n,s,c){n.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=c,s.width=c,s.style.height=c+"px",s.style.width=c+"px"}function o(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}a.render=function(s,c,i){let d=i,l=c;typeof d>"u"&&(!c||!c.getContext)&&(d=c,c=void 0),c||(l=o()),d=r.getOptions(d);const m=r.getImageWidth(s.modules.size,d),u=l.getContext("2d"),h=u.createImageData(m,m);return r.qrToImageData(h.data,s,d),t(u,l,m),u.putImageData(h,0,0),l},a.renderToDataURL=function(s,c,i){let d=i;typeof d>"u"&&(!c||!c.getContext)&&(d=c,c=void 0),d||(d={});const l=a.render(s,c,d),m=d.type||"image/png",u=d.rendererOpts||{};return l.toDataURL(m,u.quality)}})(en)),en}var nn={},gr;function aa(){if(gr)return nn;gr=1;const a=Wr();function r(n,s){const c=n.a/255,i=s+'="'+n.hex+'"';return c<1?i+" "+s+'-opacity="'+c.toFixed(2).slice(1)+'"':i}function t(n,s,c){let i=n+s;return typeof c<"u"&&(i+=" "+c),i}function o(n,s,c){let i="",d=0,l=!1,m=0;for(let u=0;u<n.length;u++){const h=Math.floor(u%s),g=Math.floor(u/s);!h&&!l&&(l=!0),n[u]?(m++,u>0&&h>0&&n[u-1]||(i+=l?t("M",h+c,.5+g+c):t("m",d,0),d=0,l=!1),h+1<s&&n[u+1]||(i+=t("h",m),m=0)):d++}return i}return nn.render=function(s,c,i){const d=a.getOptions(c),l=s.modules.size,m=s.modules.data,u=l+d.margin*2,h=d.color.light.a?"<path "+r(d.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",g="<path "+r(d.color.dark,"stroke")+' d="'+o(m,l,d.margin)+'"/>',p='viewBox="0 0 '+u+" "+u+'"',v='<svg xmlns="http://www.w3.org/2000/svg" '+(d.width?'width="'+d.width+'" height="'+d.width+'" ':"")+p+' shape-rendering="crispEdges">'+h+g+`</svg>
`;return typeof i=="function"&&i(null,v),v},nn}var pr;function oa(){if(pr)return ot;pr=1;const a=Fs(),r=ra(),t=sa(),o=aa();function n(s,c,i,d,l){const m=[].slice.call(arguments,1),u=m.length,h=typeof m[u-1]=="function";if(!h&&!a())throw new Error("Callback required as last argument");if(h){if(u<2)throw new Error("Too few arguments provided");u===2?(l=i,i=c,c=d=void 0):u===3&&(c.getContext&&typeof l>"u"?(l=d,d=void 0):(l=d,d=i,i=c,c=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(i=c,c=d=void 0):u===2&&!c.getContext&&(d=i,i=c,c=void 0),new Promise(function(g,p){try{const y=r.create(i,d);g(s(y,c,d))}catch(y){p(y)}})}try{const g=r.create(i,d);l(null,s(g,c,d))}catch(g){l(g)}}return ot.create=r.create,ot.toCanvas=n.bind(null,t.render),ot.toDataURL=n.bind(null,t.renderToDataURL),ot.toString=n.bind(null,function(s,c,i){return o.render(s,i)}),ot}var ia=oa();const la=Cn(ia);async function xr(a){return new Promise((r,t)=>{const o=new Image;o.onload=()=>r(o),o.onerror=n=>t(n),o.src=a})}async function ca(a,r){const[t,o]=await Promise.all([xr(a),xr(r.logoUrl)]),n=Math.max(160,t.width||160),s=Math.max(160,t.height||160),c=document.createElement("canvas");c.width=n,c.height=s;const i=c.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,n,s),i.imageSmoothingEnabled=!1,i.drawImage(t,0,0,n,s);const d=n/2,l=s/2,m=Math.max(.14,Math.min(.28,r.logoScale??.2)),u=Math.round(Math.min(n,s)*m),h=Math.round(d-u/2),g=Math.round(l-u/2);if(r.mask!==!1){const p=r.shape||"rounded-rect",y=Math.max(2,Math.round(u*.08)),v=h-y,b=g-y,S=u+y*2,N=u+y*2;if(i.beginPath(),p==="circle"){const C=Math.min(S,N)/2;i.arc(v+S/2,b+N/2,C,0,Math.PI*2)}else if(p==="rect")i.rect(v,b,S,N);else{const C=Math.max(4,r.radiusPx??Math.round(u*.12)),E=Math.min(C,S/2,N/2);i.moveTo(v+E,b),i.arcTo(v+S,b,v+S,b+N,E),i.arcTo(v+S,b+N,v,b+N,E),i.arcTo(v,b+N,v,b,E),i.arcTo(v,b,v+S,b,E),i.closePath()}i.fillStyle="#ffffff",i.fill(),i.lineWidth=1,i.strokeStyle=r.maskStroke||"rgba(0,0,0,0.12)",i.stroke()}if(i.save(),r.shape==="circle"){const p=u/2;i.beginPath(),i.arc(h+p,g+p,p,0,Math.PI*2),i.clip()}return i.imageSmoothingEnabled=!0,i.drawImage(o,h,g,u,u),i.restore(),c.toDataURL("image/png")}async function da(a,r){const{width:t=256,margin:o=2,errorCorrectionLevel:n="H",color:s={dark:"#000000",light:"#ffffff"},logo:c}=r||{},i=await la.toDataURL(a,{width:t,margin:o,errorCorrectionLevel:n,color:s});return c?ca(i,c):i}const ua={},br=a=>{let r;const t=new Set,o=(m,u)=>{const h=typeof m=="function"?m(r):m;if(!Object.is(h,r)){const g=r;r=u??(typeof h!="object"||h===null)?h:Object.assign({},r,h),t.forEach(p=>p(r,g))}},n=()=>r,d={setState:o,getState:n,getInitialState:()=>l,subscribe:m=>(t.add(m),()=>t.delete(m)),destroy:()=>{(ua?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},l=r=a(o,n,d);return d},ma=a=>a?br(a):br;var rn={exports:{}},sn={},an={exports:{}},on={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yr;function ha(){if(yr)return on;yr=1;var a=Sn();function r(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var t=typeof Object.is=="function"?Object.is:r,o=a.useState,n=a.useEffect,s=a.useLayoutEffect,c=a.useDebugValue;function i(u,h){var g=h(),p=o({inst:{value:g,getSnapshot:h}}),y=p[0].inst,v=p[1];return s(function(){y.value=g,y.getSnapshot=h,d(y)&&v({inst:y})},[u,g,h]),n(function(){return d(y)&&v({inst:y}),u(function(){d(y)&&v({inst:y})})},[u]),c(g),g}function d(u){var h=u.getSnapshot;u=u.value;try{var g=h();return!t(u,g)}catch{return!0}}function l(u,h){return h()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:i;return on.useSyncExternalStore=a.useSyncExternalStore!==void 0?a.useSyncExternalStore:m,on}var vr;function fa(){return vr||(vr=1,an.exports=ha()),an.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wr;function ga(){if(wr)return sn;wr=1;var a=Sn(),r=fa();function t(l,m){return l===m&&(l!==0||1/l===1/m)||l!==l&&m!==m}var o=typeof Object.is=="function"?Object.is:t,n=r.useSyncExternalStore,s=a.useRef,c=a.useEffect,i=a.useMemo,d=a.useDebugValue;return sn.useSyncExternalStoreWithSelector=function(l,m,u,h,g){var p=s(null);if(p.current===null){var y={hasValue:!1,value:null};p.current=y}else y=p.current;p=i(function(){function b(j){if(!S){if(S=!0,N=j,j=h(j),g!==void 0&&y.hasValue){var f=y.value;if(g(f,j))return C=f}return C=j}if(f=C,o(N,j))return f;var k=h(j);return g!==void 0&&g(f,k)?(N=j,f):(N=j,C=k)}var S=!1,N,C,E=u===void 0?null:u;return[function(){return b(m())},E===null?void 0:function(){return b(E())}]},[m,u,h,g]);var v=n(l,p[0],p[1]);return c(function(){y.hasValue=!0,y.value=v},[v]),d(v),v},sn}var jr;function pa(){return jr||(jr=1,rn.exports=ga()),rn.exports}var xa=pa();const ba=Cn(xa),Gr={},{useDebugValue:ya}=Ce,{useSyncExternalStoreWithSelector:va}=ba;let Nr=!1;const wa=a=>a;function ja(a,r=wa,t){(Gr?"production":void 0)!=="production"&&t&&!Nr&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Nr=!0);const o=va(a.subscribe,a.getState,a.getServerState||a.getInitialState,r,t);return ya(o),o}const Sr=a=>{(Gr?"production":void 0)!=="production"&&typeof a!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const r=typeof a=="function"?ma(a):a,t=(o,n)=>ja(r,o,n);return Object.assign(t,r),t},Ct=a=>a?Sr(a):Sr,Na={};function In(a,r){let t;try{t=a()}catch{return}return{getItem:n=>{var s;const c=d=>d===null?null:JSON.parse(d,void 0),i=(s=t.getItem(n))!=null?s:null;return i instanceof Promise?i.then(c):c(i)},setItem:(n,s)=>t.setItem(n,JSON.stringify(s,void 0)),removeItem:n=>t.removeItem(n)}}const gt=a=>r=>{try{const t=a(r);return t instanceof Promise?t:{then(o){return gt(o)(t)},catch(o){return this}}}catch(t){return{then(o){return this},catch(o){return gt(o)(t)}}}},Sa=(a,r)=>(t,o,n)=>{let s={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:v=>v,version:0,merge:(v,b)=>({...b,...v}),...r},c=!1;const i=new Set,d=new Set;let l;try{l=s.getStorage()}catch{}if(!l)return a((...v)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),t(...v)},o,n);const m=gt(s.serialize),u=()=>{const v=s.partialize({...o()});let b;const S=m({state:v,version:s.version}).then(N=>l.setItem(s.name,N)).catch(N=>{b=N});if(b)throw b;return S},h=n.setState;n.setState=(v,b)=>{h(v,b),u()};const g=a((...v)=>{t(...v),u()},o,n);let p;const y=()=>{var v;if(!l)return;c=!1,i.forEach(S=>S(o()));const b=((v=s.onRehydrateStorage)==null?void 0:v.call(s,o()))||void 0;return gt(l.getItem.bind(l))(s.name).then(S=>{if(S)return s.deserialize(S)}).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==s.version){if(s.migrate)return s.migrate(S.state,S.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return S.state}).then(S=>{var N;return p=s.merge(S,(N=o())!=null?N:g),t(p,!0),u()}).then(()=>{b?.(p,void 0),c=!0,d.forEach(S=>S(p))}).catch(S=>{b?.(void 0,S)})};return n.persist={setOptions:v=>{s={...s,...v},v.getStorage&&(l=v.getStorage())},clearStorage:()=>{l?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>y(),hasHydrated:()=>c,onHydrate:v=>(i.add(v),()=>{i.delete(v)}),onFinishHydration:v=>(d.add(v),()=>{d.delete(v)})},y(),p||g},Ca=(a,r)=>(t,o,n)=>{let s={storage:In(()=>localStorage),partialize:y=>y,version:0,merge:(y,v)=>({...v,...y}),...r},c=!1;const i=new Set,d=new Set;let l=s.storage;if(!l)return a((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),t(...y)},o,n);const m=()=>{const y=s.partialize({...o()});return l.setItem(s.name,{state:y,version:s.version})},u=n.setState;n.setState=(y,v)=>{u(y,v),m()};const h=a((...y)=>{t(...y),m()},o,n);n.getInitialState=()=>h;let g;const p=()=>{var y,v;if(!l)return;c=!1,i.forEach(S=>{var N;return S((N=o())!=null?N:h)});const b=((v=s.onRehydrateStorage)==null?void 0:v.call(s,(y=o())!=null?y:h))||void 0;return gt(l.getItem.bind(l))(s.name).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==s.version){if(s.migrate)return[!0,s.migrate(S.state,S.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,S.state];return[!1,void 0]}).then(S=>{var N;const[C,E]=S;if(g=s.merge(E,(N=o())!=null?N:h),t(g,!0),C)return m()}).then(()=>{b?.(g,void 0),g=o(),c=!0,d.forEach(S=>S(g))}).catch(S=>{b?.(void 0,S)})};return n.persist={setOptions:y=>{s={...s,...y},y.storage&&(l=y.storage)},clearStorage:()=>{l?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>p(),hasHydrated:()=>c,onHydrate:y=>(i.add(y),()=>{i.delete(y)}),onFinishHydration:y=>(d.add(y),()=>{d.delete(y)})},s.skipHydration||p(),g||h},ka=(a,r)=>"getStorage"in r||"serialize"in r||"deserialize"in r?((Na?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Sa(a,r)):Ca(a,r),Jr=ka,Pn=Ct()(Jr((a,r)=>({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1,_hydrated:!1,setCalibration:t=>a(o=>({...o,...t})),reset:()=>a({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1})}),{name:"ndn-calibration-v1",storage:In(()=>localStorage),onRehydrateStorage:()=>(a,r)=>{if(!(r||!a))try{if(a&&!a.H){const t=localStorage.getItem("ndn:calibration:v1");if(t){const o=JSON.parse(t);o&&(o.H||o.imageSize)&&a.setCalibration({H:o.H??null,createdAt:o.createdAt??null,errorPx:o.errorPx??null,imageSize:o.imageSize??null,anchors:o.anchors??null,locked:!!o.locked})}}a._hydrated=!0}catch{}}}));let ln=null,cn=null,dn=null,un=null;const kt=Ct()(Jr((a,r)=>({isStreaming:!1,mode:"local",pairingCode:null,expiresAt:null,isPaired:!1,mobileUrl:null,showOverlay:!0,setStreaming:t=>{console.log("[CAMERA_SESSION] setStreaming:",t),a({isStreaming:t})},setMode:t=>{console.log("[CAMERA_SESSION] setMode:",t),a({mode:t})},setPairingCode:t=>a({pairingCode:t}),setExpiresAt:t=>a({expiresAt:t}),setPaired:t=>a({isPaired:t}),setMobileUrl:t=>a({mobileUrl:t}),setShowOverlay:t=>a({showOverlay:!!t}),setMediaStream:t=>{cn=t},getMediaStream:()=>cn,setPcRef:t=>{dn=t},getPcRef:()=>dn,setWsRef:t=>{un=t},getWsRef:()=>un,getVideoElementRef:()=>{const t=ln;return t||console.warn("[cameraSession] ⚠️ getVideoElementRef called but ref is NULL"),t},setVideoElementRef:t=>{t?console.log("[cameraSession] ✅ setVideoElementRef called - storing HTMLVideoElement",{tagName:t.tagName,hasStream:!!t.srcObject}):console.log("[cameraSession] 🛑 setVideoElementRef called - clearing ref"),ln=t},clearSession:()=>{ln=null,cn=null,dn=null,un=null,a({isStreaming:!1,pairingCode:null,expiresAt:null,isPaired:!1,mobileUrl:null})}}),{name:"ndn-camera-session",storage:In(()=>localStorage),partialize:a=>({isStreaming:a.isStreaming,mode:a.mode,pairingCode:a.pairingCode,expiresAt:a.expiresAt,isPaired:a.isPaired,mobileUrl:a.mobileUrl,showOverlay:a.showOverlay})})),V={bullInner:6.35,bullOuter:15.9,trebleInner:99,trebleOuter:107,doubleInner:162,doubleOuter:170},Ea=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];function Et(a,r){const t=r.x,o=r.y,n=a[6]*t+a[7]*o+a[8],s=(a[0]*t+a[1]*o+a[2])/n,c=(a[3]*t+a[4]*o+a[5])/n;return{x:s,y:c}}function Ta(a){const r=a,t=r[0],o=r[1],n=r[2],s=r[3],c=r[4],i=r[5],d=r[6],l=r[7],m=r[8],u=c*m-i*l,h=n*l-o*m,g=o*i-n*c,p=i*d-s*m,y=t*m-n*d,v=n*s-t*i,b=s*l-c*d,S=o*d-t*l,N=t*c-o*s,C=t*u+o*p+n*b;if(Math.abs(C)<1e-12)throw new Error("Singular homography");return[u/C,h/C,g/C,p/C,y/C,v/C,b/C,S/C,N/C]}function Yr(a,r){if(a.length<4||r.length<4)throw new Error("Need at least 4 correspondences");if(a.length!==r.length)throw new Error("Correspondences must have equal length");const t=[],o=[];for(let c=0;c<a.length;c++){const{x:i,y:d}=a[c],{x:l,y:m}=r[c];t.push([i,d,1,0,0,0,-l*i,-l*d]),o.push(l),t.push([0,0,0,i,d,1,-m*i,-m*d]),o.push(m)}const n=Ia(t,o);return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],1]}function Ia(a,r){const t=a.length,o=a[0].length,n=Array.from({length:o},()=>new Array(o).fill(0)),s=new Array(o).fill(0);for(let c=0;c<t;c++)for(let i=0;i<o;i++){s[i]+=a[c][i]*r[c];for(let d=0;d<o;d++)n[i][d]+=a[c][i]*a[c][d]}return Pa(n,s)}function Pa(a,r){const t=r.length,o=a.map((s,c)=>s.concat([r[c]]));for(let s=0;s<t;s++){let c=s;for(let i=s+1;i<t;i++)Math.abs(o[i][s])>Math.abs(o[c][s])&&(c=i);if(Math.abs(o[c][s])<1e-12)throw new Error("Singular matrix");if(c!==s){const i=o[s];o[s]=o[c],o[c]=i}for(let i=s+1;i<t;i++){const d=o[i][s]/o[s][s];for(let l=s;l<=t;l++)o[i][l]-=d*o[s][l]}}const n=new Array(t).fill(0);for(let s=t-1;s>=0;s--){let c=o[s][t];for(let i=s+1;i<t;i++)c-=o[s][i]*n[i];n[s]=c/o[s][s]}return n}function Cr(){const a=V.doubleOuter;return[{x:0,y:-a},{x:a,y:0},{x:0,y:a},{x:-a,y:0},{x:0,y:0}]}function Ra(a,r,t=256){const o=[];for(let n=0;n<t;n++){const s=n/t*Math.PI*2,c=Et(a,{x:r*Math.cos(s),y:r*Math.sin(s)});o.push(c)}return o}function Kr(a,r,t){let o=0;for(let n=0;n<r.length;n++){const s=Et(a,r[n]),c=s.x-t[n].x,i=s.y-t[n].y;o+=c*c+i*i}return Math.sqrt(o/r.length)}function Jo(a,r){const t=Ta(a);return Et(t,r)}function Yo(a){const r=Math.hypot(a.x,a.y);let o=Math.atan2(a.y,a.x)*180/Math.PI;o=(o+360+90)%360;const n=Ea[Math.floor((360-o)%360/18)];return r<=V.bullInner?{base:50,ring:"INNER_BULL",sector:25,mult:2}:r<=V.bullOuter?{base:25,ring:"BULL",sector:25,mult:1}:r>=V.doubleOuter?{base:0,ring:"MISS",sector:null,mult:0}:r>=V.doubleInner?{base:n*2,ring:"DOUBLE",sector:n,mult:2}:r>=V.trebleOuter?{base:n,ring:"SINGLE",sector:n,mult:1}:r>=V.trebleInner?{base:n*3,ring:"TRIPLE",sector:n,mult:3}:{base:n,ring:"SINGLE",sector:n,mult:1}}function Aa(a,r,t="#10b981",o=2){if(r.length){a.save(),a.strokeStyle=t,a.lineWidth=o,a.beginPath(),a.moveTo(r[0].x,r[0].y);for(let n=1;n<r.length;n++)a.lineTo(r[n].x,r[n].y);a.closePath(),a.stroke(),a.restore()}}function Ma(a,r,t="#f59e0b"){a.save(),a.strokeStyle=t,a.lineWidth=2,a.beginPath(),a.moveTo(r.x-8,r.y),a.lineTo(r.x+8,r.y),a.moveTo(r.x,r.y-8),a.lineTo(r.x,r.y+8),a.stroke(),a.restore()}function St(a,r,t){return Math.max(r,Math.min(t,a))}function La(a,r,t){const{width:o,data:n}=a,s=[[-1,0,1],[-2,0,2],[-1,0,1]],c=[[-1,-2,-1],[0,0,0],[1,2,1]];let i=0,d=0;for(let l=-1;l<=1;l++)for(let m=-1;m<=1;m++){const u=St(r+m,0,o-1),g=(St(t+l,0,a.height-1)*o+u)*4,p=n[g],y=n[g+1],v=n[g+2],b=.299*p+.587*y+.114*v;i+=b*s[l+1][m+1],d+=b*c[l+1][m+1]}return Math.hypot(i,d)}function Ko(a,r,t=6){const n=a.getContext("2d").getImageData(0,0,a.width,a.height),s=St(Math.round(r.x),1,a.width-2),c=St(Math.round(r.y),1,a.height-2);let i={x:s,y:c,mag:-1};for(let d=c-t;d<=c+t;d++)for(let l=s-t;l<=s+t;l++){if(l<=0||d<=0||l>=a.width-1||d>=a.height-1)continue;const m=La(n,l,d);m>i.mag&&(i={x:l,y:d,mag:m})}return{x:i.x,y:i.y}}var mn,kr;function Zr(){if(kr)return mn;kr=1;var a=a||{};return a.Image=function(r,t,o){this.width=r||0,this.height=t||0,this.data=o||[]},a.grayscale=function(r,t){for(var o=r.data,n=t.data,s=o.length,c=0,i=0;c<s;c+=4)n[i++]=o[c]*.299+o[c+1]*.587+o[c+2]*.114+.5&255;return t.width=r.width,t.height=r.height,t},a.threshold=function(r,t,o){var n=r.data,s=t.data,c=n.length,i=[],d;for(d=0;d<256;++d)i[d]=d<=o?0:255;for(d=0;d<c;++d)s[d]=i[n[d]];return t.width=r.width,t.height=r.height,t},a.adaptiveThreshold=function(r,t,o,n){var s=r.data,c=t.data,i=s.length,d=[],l;for(a.stackBoxBlur(r,t,o),l=0;l<768;++l)d[l]=l-255<=-n?255:0;for(l=0;l<i;++l)c[l]=d[s[l]-c[l]+255];return t.width=r.width,t.height=r.height,t},a.otsu=function(r){var t=r.data,o=t.length,n=[],s=0,c=0,i=0,d=0,l=0,m=0,u,h,g;for(g=0;g<256;++g)n[g]=0;for(g=0;g<o;++g)n[t[g]]++;for(g=0;g<256;++g)c+=n[g]*g;for(g=0;g<256;++g)if(d+=n[g],d!==0){if(l=o-d,l===0)break;i+=n[g]*g,u=i/d-(c-i)/l,h=d*l*u*u,h>m&&(m=h,s=g)}return s},a.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265],a.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13],a.BlurStack=function(){this.color=0,this.next=null},a.stackBoxBlur=function(r,t,o){var n=r.data,s=t.data,c=r.height,i=r.width,d=c-1,l=i-1,m=o+o+1,u=o+1,h=a.stackBoxBlurMult[o],g=a.stackBoxBlurShift[o],p,y,v,b,S,N,C,E,j,f;for(p=y=new a.BlurStack,f=1;f<m;++f)p=p.next=new a.BlurStack;for(p.next=y,S=0,j=0;j<c;++j){for(N=S,v=n[S],b=u*v,p=y,f=0;f<u;++f)p.color=v,p=p.next;for(f=1;f<u;++f)p.color=n[S+f],b+=p.color,p=p.next;for(p=y,E=0;E<i;++E)s[S++]=b*h>>>g,C=E+u,C=N+(C<l?C:l),b-=p.color-n[C],p.color=n[C],p=p.next}for(E=0;E<i;++E){for(S=E,N=S+i,v=s[S],b=u*v,p=y,f=0;f<u;++f)p.color=v,p=p.next;for(f=1;f<u;++f)p.color=s[N],b+=p.color,p=p.next,N+=i;for(p=y,j=0;j<c;++j)s[S]=b*h>>>g,C=j+u,C=E+(C<d?C:d)*i,b-=p.color-s[C],p.color=s[C],p=p.next,S+=i}return t},a.gaussianBlur=function(r,t,o,n){var s=a.gaussianKernel(n);return t.width=r.width,t.height=r.height,o.width=r.width,o.height=r.height,a.gaussianBlurFilter(r,o,s,!0),a.gaussianBlurFilter(o,t,s,!1),t},a.gaussianBlurFilter=function(r,t,o,n){var s=r.data,c=t.data,i=r.height,d=r.width,l=0,m=o.length>>1,u,h,g,p,y;for(g=0;g<i;++g)for(p=0;p<d;++p){for(h=0,y=-m;y<=m;++y)n?(u=l+y,(p+y<0||p+y>=d)&&(u=l)):(u=l+y*d,(g+y<0||g+y>=i)&&(u=l)),h+=o[m+y]*s[u];c[l++]=n?h:h+.5&255}return t},a.gaussianKernel=function(r){var t=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],o=[],n,s,c,i,d,l;if(r<=7&&r%2===1)o=t[r>>1];else{for(n=(r-1)*.5,s=.8+.3*(n-1),c=-.5/(s*s),i=0,l=0;l<r;++l)d=l-n,i+=o[l]=Math.exp(c*d*d);for(i=1/i,l=0;l<r;++l)o[l]*=i}return o},a.findContours=function(r,t){var o=r.width,n=r.height,s=[],c,i,d,l,m,u,h,g,p;for(c=a.binaryBorder(r,t),i=a.neighborhoodDeltas(o+2),d=o+3,m=1,g=0;g<n;++g,d+=2)for(p=0;p<o;++p,++d)l=c[d],l!==0&&(u=h=!1,l===1&&c[d-1]===0?u=!0:l>=1&&c[d+1]===0&&(h=!0),(u||h)&&(++m,s.push(a.borderFollowing(c,d,m,{x:p,y:g},h,i))));return s},a.borderFollowing=function(r,t,o,n,s,c){var i=[],d,l,m,u,h;i.hole=s,u=h=s?0:4;do if(u=u-1&7,d=t+c[u],r[d]!==0)break;while(u!==h);if(u===h)r[t]=-o,i.push({x:n.x,y:n.y});else for(l=t;;){h=u;do m=l+c[++u];while(r[m]===0);if(u&=7,u-1>>>0<h>>>0?r[l]=-o:r[l]===1&&(r[l]=o),i.push({x:n.x,y:n.y}),n.x+=a.neighborhood[u][0],n.y+=a.neighborhood[u][1],m===t&&l===d)break;l=m,u=u+4&7}return i},a.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],a.neighborhoodDeltas=function(r){for(var t=[],o=a.neighborhood.length,n=0;n<o;++n)t[n]=a.neighborhood[n][0]+a.neighborhood[n][1]*r;return t.concat(t)},a.approxPolyDP=function(r,t){var o={start_index:0,end_index:0},n={start_index:0,end_index:0},s=[],c=[],i=r.length,d,l,m,u,h,g,p,y,v,b,S;for(t*=t,S=0,v=0;v<3;++v)for(h=0,S=(S+n.start_index)%i,l=r[S],++S===i&&(S=0),b=1;b<i;++b)d=r[S],++S===i&&(S=0),p=d.x-l.x,y=d.y-l.y,u=p*p+y*y,u>h&&(h=u,n.start_index=b);for(h<=t?s.push({x:l.x,y:l.y}):(o.start_index=S,o.end_index=n.start_index+=o.start_index,n.start_index-=n.start_index>=i?i:0,n.end_index=o.start_index,n.end_index<n.start_index&&(n.end_index+=i),c.push({start_index:n.start_index,end_index:n.end_index}),c.push({start_index:o.start_index,end_index:o.end_index}));c.length!==0;){if(o=c.pop(),m=r[o.end_index%i],l=r[S=o.start_index%i],++S===i&&(S=0),o.end_index<=o.start_index+1)g=!0;else{for(h=0,p=m.x-l.x,y=m.y-l.y,v=o.start_index+1;v<o.end_index;++v)d=r[S],++S===i&&(S=0),u=Math.abs((d.y-l.y)*p-(d.x-l.x)*y),u>h&&(h=u,n.start_index=v);g=h*h<=t*(p*p+y*y)}g?s.push({x:l.x,y:l.y}):(n.end_index=o.end_index,o.end_index=n.start_index,c.push({start_index:n.start_index,end_index:n.end_index}),c.push({start_index:o.start_index,end_index:o.end_index}))}return s},a.warp=function(r,t,o,n){var s=r.data,c=t.data,i=r.width,d=r.height,l=0,m,u,h,g,p,y,v,b,S,N,C,E,j,f,k,R,L,I,P,A,O,W,Z;for(j=a.getPerspectiveTransform(o,n-1),f=j[8],k=j[2],R=j[5],W=0;W<n;++W)for(f+=j[7],k+=j[1],R+=j[4],L=f,I=k,P=R,Z=0;Z<n;++Z)L+=j[6],I+=j[0],P+=j[3],A=I/L,O=P/L,m=A>>>0,u=m===i-1?m:m+1,h=A-m,g=1-h,p=O>>>0,y=p===d-1?p:p+1,v=O-p,b=1-v,S=N=p*i,C=E=y*i,c[l++]=b*(g*s[S+m]+h*s[N+u])+v*(g*s[C+m]+h*s[E+u])&255;return t.width=n,t.height=n,t},a.getPerspectiveTransform=function(r,t){var o=a.square2quad(r);return o[0]/=t,o[1]/=t,o[3]/=t,o[4]/=t,o[6]/=t,o[7]/=t,o},a.square2quad=function(r){var t=[],o,n,s,c,i,d,l;return o=r[0].x-r[1].x+r[2].x-r[3].x,n=r[0].y-r[1].y+r[2].y-r[3].y,o===0&&n===0?(t[0]=r[1].x-r[0].x,t[1]=r[2].x-r[1].x,t[2]=r[0].x,t[3]=r[1].y-r[0].y,t[4]=r[2].y-r[1].y,t[5]=r[0].y,t[6]=0,t[7]=0,t[8]=1):(s=r[1].x-r[2].x,c=r[3].x-r[2].x,i=r[1].y-r[2].y,d=r[3].y-r[2].y,l=s*d-c*i,t[6]=(o*d-c*n)/l,t[7]=(s*n-o*i)/l,t[8]=1,t[0]=r[1].x-r[0].x+t[6]*r[1].x,t[1]=r[3].x-r[0].x+t[7]*r[3].x,t[2]=r[0].x,t[3]=r[1].y-r[0].y+t[6]*r[1].y,t[4]=r[3].y-r[0].y+t[7]*r[3].y,t[5]=r[0].y),t},a.isContourConvex=function(r){var t=0,o=!0,n=r.length,s=0,c=0,i,d,l,m,u,h,g,p;for(d=r[n-1],i=r[0],u=i.x-d.x,h=i.y-d.y;s<n;++s){if(++c===n&&(c=0),d=i,i=r[c],g=i.x-d.x,p=i.y-d.y,l=g*h,m=p*u,t|=m>l?1:m<l?2:3,t===3){o=!1;break}u=g,h=p}return o},a.perimeter=function(r){for(var t=r.length,o=0,n=t-1,s=0,c,i;o<t;n=o++)c=r[o].x-r[n].x,i=r[o].y-r[n].y,s+=Math.sqrt(c*c+i*i);return s},a.minEdgeLength=function(r){for(var t=r.length,o=0,n=t-1,s=1/0,c,i,d;o<t;n=o++)i=r[o].x-r[n].x,d=r[o].y-r[n].y,c=i*i+d*d,c<s&&(s=c);return Math.sqrt(s)},a.countNonZero=function(r,t){var o=r.data,n=t.height,s=t.width,c=t.x+t.y*r.width,i=r.width-s,d=0,l,m;for(l=0;l<n;++l){for(m=0;m<s;++m)o[c++]!==0&&++d;c+=i}return d},a.binaryBorder=function(r,t){var o=r.data,n=r.height,s=r.width,c=0,i=0,d,l;for(l=-2;l<s;++l)t[i++]=0;for(d=0;d<n;++d){for(t[i++]=0,l=0;l<s;++l)t[i++]=o[c++]===0?0:1;t[i++]=0}for(l=-2;l<s;++l)t[i++]=0;return t},mn=a,mn}var hn,Er;function Da(){if(Er)return hn;Er=1;var a=Zr(),r=r||{};return r.Marker=function(t,o){this.id=t,this.corners=o},r.Detector=function(){this.grey=new a.Image,this.thres=new a.Image,this.homography=new a.Image,this.binary=[],this.contours=[],this.polys=[],this.candidates=[]},r.Detector.prototype.detect=function(t){return a.grayscale(t,this.grey),a.adaptiveThreshold(this.grey,this.thres,2,7),this.contours=a.findContours(this.thres,this.binary),this.candidates=this.findCandidates(this.contours,t.width*.2,.05,10),this.candidates=this.clockwiseCorners(this.candidates),this.candidates=this.notTooNear(this.candidates,10),this.findMarkers(this.grey,this.candidates,49)},r.Detector.prototype.findCandidates=function(t,o,n,s){var c=[],i=t.length,d,l,m;for(this.polys=[],m=0;m<i;++m)d=t[m],d.length>=o&&(l=a.approxPolyDP(d,d.length*n),this.polys.push(l),l.length===4&&a.isContourConvex(l)&&a.minEdgeLength(l)>=s&&c.push(l));return c},r.Detector.prototype.clockwiseCorners=function(t){var o=t.length,n,s,c,i,d,l;for(l=0;l<o;++l)n=t[l][1].x-t[l][0].x,c=t[l][1].y-t[l][0].y,s=t[l][2].x-t[l][0].x,i=t[l][2].y-t[l][0].y,n*i-c*s<0&&(d=t[l][1],t[l][1]=t[l][3],t[l][3]=d);return t},r.Detector.prototype.notTooNear=function(t,o){var n=[],s=t.length,c,i,d,l,m,u;for(l=0;l<s;++l)for(m=l+1;m<s;++m){for(c=0,u=0;u<4;++u)i=t[l][u].x-t[m][u].x,d=t[l][u].y-t[m][u].y,c+=i*i+d*d;c/4<o*o&&(a.perimeter(t[l])<a.perimeter(t[m])?t[l].tooNear=!0:t[m].tooNear=!0)}for(l=0;l<s;++l)t[l].tooNear||n.push(t[l]);return n},r.Detector.prototype.findMarkers=function(t,o,n){var s=[],c=o.length,i,d,l;for(l=0;l<c;++l)i=o[l],a.warp(t,this.homography,i,n),a.threshold(this.homography,this.homography,a.otsu(this.homography)),d=this.getMarker(this.homography,i),d&&s.push(d);return s},r.Detector.prototype.getMarker=function(t,o){var n=t.width/7>>>0,s=n*n>>1,c=[],i=[],d=[],l,m,u,h,g;for(h=0;h<7;++h)for(u=h===0||h===6?1:6,g=0;g<7;g+=u)if(l={x:g*n,y:h*n,width:n,height:n},a.countNonZero(t,l)>s)return null;for(h=0;h<5;++h)for(c[h]=[],g=0;g<5;++g)l={x:(g+1)*n,y:(h+1)*n,width:n,height:n},c[h][g]=a.countNonZero(t,l)>s?1:0;for(i[0]=c,d[0]=this.hammingDistance(i[0]),m={first:d[0],second:0},h=1;h<4;++h)i[h]=this.rotate(i[h-1]),d[h]=this.hammingDistance(i[h]),d[h]<m.first&&(m.first=d[h],m.second=h);return m.first!==0?null:new r.Marker(this.mat2id(i[m.second]),this.rotate2(o,4-m.second))},r.Detector.prototype.hammingDistance=function(t){var o=[[1,0,0,0,0],[1,0,1,1,1],[0,1,0,0,1],[0,1,1,1,0]],n=0,s,c,i,d,l;for(i=0;i<5;++i){for(c=1/0,d=0;d<4;++d){for(s=0,l=0;l<5;++l)s+=t[i][l]===o[d][l]?0:1;s<c&&(c=s)}n+=c}return n},r.Detector.prototype.mat2id=function(t){var o=0,n;for(n=0;n<5;++n)o<<=1,o|=t[n][1],o<<=1,o|=t[n][3];return o},r.Detector.prototype.rotate=function(t){var o=[],n=t.length,s,c;for(s=0;s<n;++s)for(o[s]=[],c=0;c<t[s].length;++c)o[s][c]=t[t[s].length-c-1][s];return o},r.Detector.prototype.rotate2=function(t,o){var n=[],s=t.length,c;for(c=0;c<s;++c)n[c]=t[(o+c)%s];return n},hn=r,hn}var fn,Tr;function Rn(){if(Tr)return fn;Tr=1;var a=a||{};return a.svdcmp=function(r,t,o,n,s){var c,i,d,l,m,u,h,g,p=0,y,v,b=0,S,N,C=0,E,j,f,k=[];for(i=0;i<o;++i){if(h=i+1,k[i]=C*b,b=N=C=0,i<t){for(u=i;u<t;++u)C+=Math.abs(r[u][i]);if(C!==0){for(u=i;u<t;++u)r[u][i]/=C,N+=r[u][i]*r[u][i];for(v=r[i][i],b=-a.sign(Math.sqrt(N),v),S=v*b-N,r[i][i]=v-b,l=h;l<o;++l){for(N=0,u=i;u<t;++u)N+=r[u][i]*r[u][l];for(v=N/S,u=i;u<t;++u)r[u][l]+=v*r[u][i]}for(u=i;u<t;++u)r[u][i]*=C}}if(n[i]=C*b,b=N=C=0,i<t&&i!==o-1){for(u=h;u<o;++u)C+=Math.abs(r[i][u]);if(C!==0){for(u=h;u<o;++u)r[i][u]/=C,N+=r[i][u]*r[i][u];for(v=r[i][h],b=-a.sign(Math.sqrt(N),v),S=v*b-N,r[i][h]=v-b,u=h;u<o;++u)k[u]=r[i][u]/S;for(l=h;l<t;++l){for(N=0,u=h;u<o;++u)N+=r[l][u]*r[i][u];for(u=h;u<o;++u)r[l][u]+=N*k[u]}for(u=h;u<o;++u)r[i][u]*=C}}p=Math.max(p,Math.abs(n[i])+Math.abs(k[i]))}for(i=o-1;i>=0;--i){if(i<o-1){if(b!==0){for(l=h;l<o;++l)s[l][i]=r[i][l]/r[i][h]/b;for(l=h;l<o;++l){for(N=0,u=h;u<o;++u)N+=r[i][u]*s[u][l];for(u=h;u<o;++u)s[u][l]+=N*s[u][i]}}for(l=h;l<o;++l)s[i][l]=s[l][i]=0}s[i][i]=1,b=k[i],h=i}for(i=Math.min(o,t)-1;i>=0;--i){for(h=i+1,b=n[i],l=h;l<o;++l)r[i][l]=0;if(b!==0){for(b=1/b,l=h;l<o;++l){for(N=0,u=h;u<t;++u)N+=r[u][i]*r[u][l];for(v=N/r[i][i]*b,u=i;u<t;++u)r[u][l]+=v*r[u][i]}for(l=i;l<t;++l)r[l][i]*=b}else for(l=i;l<t;++l)r[l][i]=0;++r[i][i]}for(u=o-1;u>=0;--u)for(d=1;d<=30;++d){for(c=!0,h=u;h>=0;--h){if(g=h-1,Math.abs(k[h])+p===p){c=!1;break}if(Math.abs(n[g])+p===p)break}if(c)for(y=0,N=1,i=h;i<=u&&(v=N*k[i],Math.abs(v)+p!==p);++i)for(b=n[i],S=a.pythag(v,b),n[i]=S,S=1/S,y=b*S,N=-v*S,l=1;l<=t;++l)j=r[l][g],f=r[l][i],r[l][g]=j*y+f*N,r[l][i]=f*y-j*N;if(f=n[u],h===u){if(f<0)for(n[u]=-f,l=0;l<o;++l)s[l][u]=-s[l][u];break}if(d===30)return!1;for(E=n[h],g=u-1,j=n[g],b=k[g],S=k[u],v=((j-f)*(j+f)+(b-S)*(b+S))/(2*S*j),b=a.pythag(v,1),v=((E-f)*(E+f)+S*(j/(v+a.sign(b,v))-S))/E,y=N=1,l=h;l<=g;++l){for(i=l+1,b=k[i],j=n[i],S=N*b,b=y*b,f=a.pythag(v,S),k[l]=f,y=v/f,N=S/f,v=E*y+b*N,b=b*y-E*N,S=j*N,j*=y,m=0;m<o;++m)E=s[m][l],f=s[m][i],s[m][l]=E*y+f*N,s[m][i]=f*y-E*N;for(f=a.pythag(v,S),n[l]=f,f!==0&&(f=1/f,y=v*f,N=S*f),v=y*b+N*j,E=y*j-N*b,m=0;m<t;++m)j=r[m][l],f=r[m][i],r[m][l]=j*y+f*N,r[m][i]=f*y-j*N}k[h]=0,k[u]=v,n[u]=E}return!0},a.pythag=function(r,t){var o=Math.abs(r),n=Math.abs(t),s;return o>n?(s=n/o,o*Math.sqrt(1+s*s)):n===0?0:(s=o/n,n*Math.sqrt(1+s*s))},a.sign=function(r,t){return t>=0?Math.abs(r):-Math.abs(r)},fn=a,fn}var gn,Ir;function Oa(){if(Ir)return gn;Ir=1;var a=Rn(),r=r||{};return r.Posit=function(t,o){this.objectPoints=this.buildModel(t),this.focalLength=o,this.objectVectors=[],this.objectNormal=[],this.objectMatrix=[[],[],[]],this.init()},r.Posit.prototype.buildModel=function(t){var o=t/2;return[[-o,o,0],[o,o,0],[o,-o,0],[-o,-o,0]]},r.Posit.prototype.init=function(){var t=this.objectPoints.length,o=[],n=[],s=0,c=2,i;for(i=0;i<t;++i)this.objectVectors[i]=[this.objectPoints[i][0]-this.objectPoints[0][0],this.objectPoints[i][1]-this.objectPoints[0][1],this.objectPoints[i][2]-this.objectPoints[0][2]],o[i]=[this.objectVectors[i][0],this.objectVectors[i][1],this.objectVectors[i][2]];for(;s===0;)n[0]=this.objectVectors[1][1]*this.objectVectors[c][2]-this.objectVectors[1][2]*this.objectVectors[c][1],n[1]=this.objectVectors[1][2]*this.objectVectors[c][0]-this.objectVectors[1][0]*this.objectVectors[c][2],n[2]=this.objectVectors[1][0]*this.objectVectors[c][1]-this.objectVectors[1][1]*this.objectVectors[c][0],s=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),++c;for(i=0;i<3;++i)this.objectNormal[i]=n[i]/s;r.pseudoInverse(o,t,this.objectMatrix)},r.Posit.prototype.pose=function(t){var o=[[],[],[]],n=[[],[],[]],s=[],c=[[],[],[]],i=[[],[],[]],d=[],l=[],m,u,h,g,p,y;for(this.pos(t,o,n,s),h=this.isValid(o,s),h?m=this.iterate(t,o,s,c,d):m={euclidean:-1,pixels:-1,maximum:-1},g=this.isValid(n,s),g?u=this.iterate(t,n,s,i,l):u={euclidean:-1,pixels:-1,maximum:-1},p=0;p<3;++p)for(y=0;y<3;++y)h&&(d[p]-=c[p][y]*this.objectPoints[0][y]),g&&(l[p]-=i[p][y]*this.objectPoints[0][y]);return m.euclidean<u.euclidean?new r.Pose(m.pixels,c,d,u.pixels,i,l):new r.Pose(u.pixels,i,l,m.pixels,c,d)},r.Posit.prototype.pos=function(t,o,n,s){var c=this.objectPoints.length,i=[],d=[],l=[],m=[],u=[],h=[],g=[],p=[],y,v,b,S,N,C,E,j,f,k;for(f=0;f<c;++f)i[f]=[t[f].x-t[0].x,t[f].y-t[0].y];for(f=0;f<3;++f)for(d[f]=0,l[f]=0,k=0;k<c;++k)d[f]+=this.objectMatrix[f][k]*i[k][0],l[f]+=this.objectMatrix[f][k]*i[k][1];for(y=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],v=l[0]*l[0]+l[1]*l[1]+l[2]*l[2],b=d[0]*l[0]+d[1]*l[1]+d[2]*l[2],S=(v-y)*(v-y)+4*(b*b),v-y>=0?N=(v-y+Math.sqrt(S))/2:N=(v-y-Math.sqrt(S))/2,N>=0?(C=Math.sqrt(N),C===0?E=0:E=-b/C):(C=Math.sqrt(-(b*b)/N),C===0?E=Math.sqrt(y-v):E=-b/C),f=0;f<3;++f)m[f]=d[f]+C*this.objectNormal[f],u[f]=l[f]+E*this.objectNormal[f];for(j=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),f=0;f<3;++f)h[f]=m[f]/j,g[f]=u[f]/j;for(p[0]=h[1]*g[2]-h[2]*g[1],p[1]=h[2]*g[0]-h[0]*g[2],p[2]=h[0]*g[1]-h[1]*g[0],f=0;f<3;++f)o[0][f]=h[f],o[1][f]=g[f],o[2][f]=p[f];for(f=0;f<3;++f)m[f]=d[f]-C*this.objectNormal[f],u[f]=l[f]-E*this.objectNormal[f];for(f=0;f<3;++f)h[f]=m[f]/j,g[f]=u[f]/j;for(p[0]=h[1]*g[2]-h[2]*g[1],p[1]=h[2]*g[0]-h[0]*g[2],p[2]=h[0]*g[1]-h[1]*g[0],f=0;f<3;++f)n[0][f]=h[f],n[1][f]=g[f],n[2][f]=p[f];s[0]=t[0].x/j,s[1]=t[0].y/j,s[2]=this.focalLength/j},r.Posit.prototype.isValid=function(t,o){for(var n=this.objectPoints.length,s=1/0,c=0,i;c<n;++c)i=o[2]+(t[2][0]*this.objectVectors[c][0]+t[2][1]*this.objectVectors[c][1]+t[2][2]*this.objectVectors[c][2]),i<s&&(s=i);return s>=0},r.Posit.prototype.iterate=function(t,o,n,s,c){var i=this.objectPoints.length,d=[],l=[],m=[[],[],[]],u=[[],[],[]],h=[],g=[],p=!1,y=0,v,b,S,N,C,E,j,f,k;for(f=0;f<i;++f)d[f]={x:t[f].x,y:t[f].y};for(f=0;f<3;++f){for(k=0;k<3;++k)s[f][k]=o[f][k];c[f]=n[f]}for(f=0;f<i;++f){for(S=0,k=0;k<3;++k)S+=this.objectVectors[f][k]*s[2][k]/c[2];l[f]={x:(1+S)*t[f].x,y:(1+S)*t[f].y}}for(b=0,f=0;f<i;++f)b+=Math.abs(l[f].x-d[f].x),b+=Math.abs(l[f].y-d[f].y);for(f=0;f<3;++f)h[f]=c[f]-(s[f][0]*this.objectPoints[0][0]+s[f][1]*this.objectPoints[0][1]+s[f][2]*this.objectPoints[0][2]);for(N=C=this.error(t,s,h),p=C.pixels===0||b<.01;y++<100&&!p;){for(f=0;f<i;++f)d[f].x=l[f].x,d[f].y=l[f].y;for(this.pos(l,m,u,c),f=0;f<3;++f)h[f]=c[f]-(m[f][0]*this.objectPoints[0][0]+m[f][1]*this.objectPoints[0][1]+m[f][2]*this.objectPoints[0][2]),g[f]=c[f]-(u[f][0]*this.objectPoints[0][0]+u[f][1]*this.objectPoints[0][1]+u[f][2]*this.objectPoints[0][2]);if(C=this.error(t,m,h),E=this.error(t,u,g),C.euclidean>=0&&E.euclidean>=0)if(E.euclidean<C.euclidean)for(N=E,f=0;f<3;++f)for(k=0;k<3;++k)s[f][k]=u[f][k];else for(N=C,f=0;f<3;++f)for(k=0;k<3;++k)s[f][k]=m[f][k];if(C.euclidean<0&&E.euclidean>=0)for(N=E,f=0;f<3;++f)for(k=0;k<3;++k)s[f][k]=u[f][k];if(E.euclidean<0&&C.euclidean>=0)for(N=C,f=0;f<3;++f)for(k=0;k<3;++k)s[f][k]=m[f][k];for(f=0;f<i;++f){for(S=0,k=0;k<3;++k)S+=this.objectVectors[f][k]*s[2][k]/c[2];l[f].x=(1+S)*t[f].x,l[f].y=(1+S)*t[f].y}for(v=b,b=0,f=0;f<i;++f)b+=Math.abs(l[f].x-d[f].x),b+=Math.abs(l[f].y-d[f].y);j=Math.abs(b-v),p=N.pixels===0||j<.01}return N},r.Posit.prototype.error=function(t,o,n){var s=this.objectPoints.length,c=[],i=[],d=[],l=0,m=0,u=0,h,g,p;if(!this.isValid(o,n))return{euclidean:-1,pixels:-1,maximum:-1};for(h=0;h<s;++h)for(c[h]=[],g=0;g<3;++g)c[h][g]=n[g];for(h=0;h<s;++h)for(g=0;g<3;++g)for(p=0;p<3;++p)c[h][g]+=o[g][p]*this.objectPoints[h][p];for(h=0;h<s;++h)for(i[h]=[],g=0;g<2;++g)i[h][g]=this.focalLength*c[h][g]/c[h][2];for(h=0;h<s;++h)d[h]=[i[h][0]-t[h].x,i[h][1]-t[h].y];for(h=0;h<s;++h)l+=Math.sqrt(d[h][0]*d[h][0]+d[h][1]*d[h][1]),m+=Math.abs(Math.round(i[h][0])-Math.round(t[h].x))+Math.abs(Math.round(i[h][1])-Math.round(t[h].y)),Math.abs(d[h][0])>u&&(u=Math.abs(d[h][0])),Math.abs(d[h][1])>u&&(u=Math.abs(d[h][1]));return{euclidean:l/s,pixels:m,maximum:u}},r.pseudoInverse=function(t,o,n){var s=[],c=[[],[],[]],i=[[],[],[]],d=0,l=0,m,u,h;for(a.svdcmp(t,o,3,s,c),m=0;m<3;++m)s[m]>d&&(d=s[m]);for(d*=.01,m=0;m<3;++m)s[m]<d&&(s[m]=0);for(u=0;u<3;++u)if(s[u]===0)for(++l,h=u;h<2;++h){for(m=0;m<o;++m)t[m][h]=t[m][h+1];for(m=0;m<3;++m)c[m][h]=c[m][h+1]}for(u=0;u<2;++u)s[u]===0&&(s[u]=s[u+1]);for(m=0;m<3;++m)for(u=0;u<3-l;++u)i[m][u]=c[m][u]/s[u];for(m=0;m<3;++m)for(u=0;u<o;++u)for(n[m][u]=0,h=0;h<3-l;++h)n[m][u]+=i[m][h]*t[u][h]},r.Pose=function(t,o,n,s,c,i){this.bestError=t,this.bestRotation=o,this.bestTranslation=n,this.alternativeError=s,this.alternativeRotation=c,this.alternativeTranslation=i},gn=r,gn}var pn,Pr;function _a(){if(Pr)return pn;Pr=1;var a=Rn(),r=r||{};r.Posit=function(n,s){this.model=this.buildModel(n),this.focalLength=s,this.init()},r.Posit.prototype.buildModel=function(n){var s=n/2;return[new t(-s,s,0),new t(s,s,0),new t(s,-s,0),new t(-s,-s,0)]},r.Posit.prototype.init=function(){var n=new t,s=new o,c;this.modelVectors=o.fromRows(t.sub(this.model[1],this.model[0]),t.sub(this.model[2],this.model[0]),t.sub(this.model[3],this.model[0])),c=o.clone(this.modelVectors),a.svdcmp(c.m,3,3,n.v,s.m),this.modelPseudoInverse=o.mult(o.mult(s,o.fromDiagonal(t.inverse(n))),o.transpose(c)),this.modelNormal=s.column(n.minIndex())},r.Posit.prototype.pose=function(n){var s=new t(1,1,1),c=new o,i=new o,d=new t,l=new t,m,u;return this.pos(n,s,c,i,d,l),m=this.iterate(n,c,d),u=this.iterate(n,i,l),m<u?new r.Pose(m,c.m,d.v,u,i.m,l.v):new r.Pose(u,i.m,l.v,m,c.m,d.v)},r.Posit.prototype.pos=function(n,s,c,i,d,l){var m=new t(n[1].x,n[2].x,n[3].x),u=new t(n[1].y,n[2].y,n[3].y),h=t.addScalar(t.mult(m,s),-n[0].x),g=t.addScalar(t.mult(u,s),-n[0].y),p=o.multVector(this.modelPseudoInverse,h),y=o.multVector(this.modelPseudoInverse,g),v=y.square()-p.square(),b=t.dot(p,y),S=0,N=0,C,E,j,f,k,R,L,I,P;v===0?(S=Math.sqrt(Math.abs(2*b)),N=-Math.PI/2*(b<0?-1:b>0?1:0)):(S=Math.sqrt(Math.sqrt(v*v+4*b*b)),N=Math.atan(-2*b/v),v<0&&(N+=Math.PI),N/=2),I=S*Math.cos(N),P=S*Math.sin(N),C=t.add(p,t.multScalar(this.modelNormal,I)),E=t.add(y,t.multScalar(this.modelNormal,P)),f=C.normalize(),k=E.normalize(),j=t.cross(C,E),c.copy(o.fromRows(C,E,j)),R=(f+k)/2,L=o.multVector(c,this.model[0]),d.v=[n[0].x/R-L.v[0],n[0].y/R-L.v[1],this.focalLength/R],C=t.sub(p,t.multScalar(this.modelNormal,I)),E=t.sub(y,t.multScalar(this.modelNormal,P)),f=C.normalize(),k=E.normalize(),j=t.cross(C,E),i.copy(o.fromRows(C,E,j)),R=(f+k)/2,L=o.multVector(i,this.model[0]),l.v=[n[0].x/R-L.v[0],n[0].y/R-L.v[1],this.focalLength/R]},r.Posit.prototype.iterate=function(n,s,c){for(var i=1/0,d=new o,l=new o,m=new t,u=new t,h=0,g,p,y,v;h<100&&(g=t.addScalar(t.multScalar(o.multVector(this.modelVectors,s.row(2)),1/c.v[2]),1),this.pos(n,g,d,l,m,u),y=this.getError(n,d,m),v=this.getError(n,l,u),y<v?(s.copy(d),c.copy(m),p=y):(s.copy(l),c.copy(u),p=v),!(p<=2||p>i));++h)i=p;return p},r.Posit.prototype.getError=function(n,s,c){var i=t.add(o.multVector(s,this.model[0]),c),d=t.add(o.multVector(s,this.model[1]),c),l=t.add(o.multVector(s,this.model[2]),c),m=t.add(o.multVector(s,this.model[3]),c),u,h,g,p,y,v,b,S,N;return i=i.v,d=d.v,l=l.v,m=m.v,i[0]*=this.focalLength/i[2],i[1]*=this.focalLength/i[2],d[0]*=this.focalLength/d[2],d[1]*=this.focalLength/d[2],l[0]*=this.focalLength/l[2],l[1]*=this.focalLength/l[2],m[0]*=this.focalLength/m[2],m[1]*=this.focalLength/m[2],u=[{x:i[0],y:i[1]},{x:d[0],y:d[1]},{x:l[0],y:l[1]},{x:m[0],y:m[1]}],h=this.angle(n[0],n[1],n[3]),g=this.angle(n[1],n[2],n[0]),p=this.angle(n[2],n[3],n[1]),y=this.angle(n[3],n[0],n[2]),v=this.angle(u[0],u[1],u[3]),b=this.angle(u[1],u[2],u[0]),S=this.angle(u[2],u[3],u[1]),N=this.angle(u[3],u[0],u[2]),(Math.abs(h-v)+Math.abs(g-b)+Math.abs(p-S)+Math.abs(y-N))/4},r.Posit.prototype.angle=function(n,s,c){var i=s.x-n.x,d=s.y-n.y,l=c.x-n.x,m=c.y-n.y;return Math.acos((i*l+d*m)/(Math.sqrt(i*i+d*d)*Math.sqrt(l*l+m*m)))*180/Math.PI},r.Pose=function(n,s,c,i,d,l){this.bestError=n,this.bestRotation=s,this.bestTranslation=c,this.alternativeError=i,this.alternativeRotation=d,this.alternativeTranslation=l};var t=function(n,s,c){this.v=[n||0,s||0,c||0]};t.prototype.copy=function(n){var s=this.v;return n=n.v,s[0]=n[0],s[1]=n[1],s[2]=n[2],this},t.add=function(n,s){var c=new t,i=c.v;return n=n.v,s=s.v,i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],c},t.sub=function(n,s){var c=new t,i=c.v;return n=n.v,s=s.v,i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],c},t.mult=function(n,s){var c=new t,i=c.v;return n=n.v,s=s.v,i[0]=n[0]*s[0],i[1]=n[1]*s[1],i[2]=n[2]*s[2],c},t.addScalar=function(n,s){var c=new t,i=c.v;return n=n.v,i[0]=n[0]+s,i[1]=n[1]+s,i[2]=n[2]+s,c},t.multScalar=function(n,s){var c=new t,i=c.v;return n=n.v,i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,c},t.dot=function(n,s){return n=n.v,s=s.v,n[0]*s[0]+n[1]*s[1]+n[2]*s[2]},t.cross=function(n,s){return n=n.v,s=s.v,new t(n[1]*s[2]-n[2]*s[1],n[2]*s[0]-n[0]*s[2],n[0]*s[1]-n[1]*s[0])},t.prototype.normalize=function(){var n=this.v,s=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return s>0&&(n[0]/=s,n[1]/=s,n[2]/=s),s},t.inverse=function(n){var s=new t,c=s.v;return n=n.v,n[0]!==0&&(c[0]=1/n[0]),n[1]!==0&&(c[1]=1/n[1]),n[2]!==0&&(c[2]=1/n[2]),s},t.prototype.square=function(){var n=this.v;return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},t.prototype.minIndex=function(){var n=this.v;return n[0]<n[1]?n[0]<n[2]?0:2:n[1]<n[2]?1:2};var o=function(){this.m=[[0,0,0],[0,0,0],[0,0,0]]};return o.clone=function(n){var s=new o,c=s.m;return n=n.m,c[0][0]=n[0][0],c[0][1]=n[0][1],c[0][2]=n[0][2],c[1][0]=n[1][0],c[1][1]=n[1][1],c[1][2]=n[1][2],c[2][0]=n[2][0],c[2][1]=n[2][1],c[2][2]=n[2][2],s},o.prototype.copy=function(n){var s=this.m;return n=n.m,s[0][0]=n[0][0],s[0][1]=n[0][1],s[0][2]=n[0][2],s[1][0]=n[1][0],s[1][1]=n[1][1],s[1][2]=n[1][2],s[2][0]=n[2][0],s[2][1]=n[2][1],s[2][2]=n[2][2],this},o.fromRows=function(n,s,c){var i=new o,d=i.m;return n=n.v,s=s.v,c=c.v,d[0][0]=n[0],d[0][1]=n[1],d[0][2]=n[2],d[1][0]=s[0],d[1][1]=s[1],d[1][2]=s[2],d[2][0]=c[0],d[2][1]=c[1],d[2][2]=c[2],i},o.fromDiagonal=function(n){var s=new o,c=s.m;return n=n.v,c[0][0]=n[0],c[1][1]=n[1],c[2][2]=n[2],s},o.transpose=function(n){var s=new o,c=s.m;return n=n.m,c[0][0]=n[0][0],c[0][1]=n[1][0],c[0][2]=n[2][0],c[1][0]=n[0][1],c[1][1]=n[1][1],c[1][2]=n[2][1],c[2][0]=n[0][2],c[2][1]=n[1][2],c[2][2]=n[2][2],s},o.mult=function(n,s){var c=new o,i=c.m;return n=n.m,s=s.m,i[0][0]=n[0][0]*s[0][0]+n[0][1]*s[1][0]+n[0][2]*s[2][0],i[0][1]=n[0][0]*s[0][1]+n[0][1]*s[1][1]+n[0][2]*s[2][1],i[0][2]=n[0][0]*s[0][2]+n[0][1]*s[1][2]+n[0][2]*s[2][2],i[1][0]=n[1][0]*s[0][0]+n[1][1]*s[1][0]+n[1][2]*s[2][0],i[1][1]=n[1][0]*s[0][1]+n[1][1]*s[1][1]+n[1][2]*s[2][1],i[1][2]=n[1][0]*s[0][2]+n[1][1]*s[1][2]+n[1][2]*s[2][2],i[2][0]=n[2][0]*s[0][0]+n[2][1]*s[1][0]+n[2][2]*s[2][0],i[2][1]=n[2][0]*s[0][1]+n[2][1]*s[1][1]+n[2][2]*s[2][1],i[2][2]=n[2][0]*s[0][2]+n[2][1]*s[1][2]+n[2][2]*s[2][2],c},o.multVector=function(n,s){return n=n.m,s=s.v,new t(n[0][0]*s[0]+n[0][1]*s[1]+n[0][2]*s[2],n[1][0]*s[0]+n[1][1]*s[1]+n[1][2]*s[2],n[2][0]*s[0]+n[2][1]*s[1]+n[2][2]*s[2])},o.prototype.column=function(n){var s=this.m;return new t(s[0][n],s[1][n],s[2][n])},o.prototype.row=function(n){var s=this.m;return new t(s[n][0],s[n][1],s[n][2])},pn=r,pn}var xn,Rr;function Ba(){return Rr||(Rr=1,xn={CV:Zr(),AR:Da(),SVD:Rn(),POS1:Oa(),POS2:_a()}),xn}Ba();const Ua={"0,0":[1,0,0,0,0],"0,1":[1,0,1,1,1],"1,0":[0,1,0,0,1],"1,1":[0,1,1,1,0]};function Fa(a){const r=new Array(5);let t=a>>>0;for(let n=4;n>=0;n--){const s=t&1;t>>=1;const c=t&1;t>>=1;const i=Ua[`${c},${s}`];if(!i)throw new Error(`Unsupported marker id pattern for row ${n}`);r[n]=i.slice()}const o=Array.from({length:7},()=>new Array(7).fill(0));for(let n=0;n<5;n++)for(let s=0;s<5;s++)o[n+1][s+1]=r[n][s];return o}const qa=a=>!!a&&Number.isFinite(a.x)&&Number.isFinite(a.y),$a=a=>Array.isArray(a)&&a.length===9&&a.every(Number.isFinite);function za(a){const r=a.getContext("2d");if(!r)return null;const t=a.width,o=a.height,s=r.getImageData(0,0,t,o).data,c=[];for(let y=2;y<o-2;y++)for(let v=2;v<t-2;v++){let b=0,S=0;for(let C=-1;C<=1;C++)for(let E=-1;E<=1;E++){const j=((y+C)*t+(v+E))*4,f=s[j]*.299+s[j+1]*.587+s[j+2]*.114;E!==0&&(b+=(E>0?1:-1)*f),C!==0&&(S+=(C>0?1:-1)*f)}const N=Math.hypot(b,S);N>20&&c.push({x:v,y,mag:N})}if(c.length===0)return null;let i=null,d=0;for(let y=o*.3;y<o*.7;y+=10)for(let v=t*.3;v<t*.7;v+=10){let b=0,S=0;const N=[15,30,150,162,180,205];for(const C of N){let E=0,j=0;for(const f of c){const k=Math.hypot(f.x-v,f.y-y);Math.abs(k-C)<3&&(E+=f.mag,j++)}j>10&&E>500&&(b++,S+=E)}b>=4&&S>d&&(d=S,i={cx:v,cy:y})}if(!i)return null;const l=i.cx,m=i.cy;let u=170,h=0;for(let y=120;y<=250;y+=5){let v=0,b=0;for(const S of c){const N=Math.hypot(S.x-l,S.y-m);Math.abs(N-y)<2&&(v+=S.mag,b++)}b>20&&v>h&&(h=v,u=y)}let g=0;const p=u/V.doubleOuter;for(const y of[V.bullInner,V.bullOuter,V.trebleInner,V.trebleOuter,V.doubleInner,V.doubleOuter]){const v=y*p;for(const b of c){const S=Math.hypot(b.x-l,b.y-m);if(Math.abs(S-v)<3){g+=15;break}}}return g=Math.min(100,g),{cx:l,cy:m,r:u,confidence:g}}function Va(a){try{const r=a.width,t=a.height,o=r/2,n=t/2,s=za(a);if(!s)return{success:!1,cx:o,cy:n,bullInner:0,bullOuter:0,trebleInner:0,trebleOuter:0,doubleInner:0,doubleOuter:0,confidence:0,homography:null,errorPx:null,calibrationPoints:[],message:"No dartboard detected. Ensure board is clearly visible with good contrast between rings and background."};const c=s.r/V.doubleOuter,i={cx:s.cx,cy:s.cy,bullInner:V.bullInner*c,bullOuter:V.bullOuter*c,trebleInner:V.trebleInner*c,trebleOuter:V.trebleOuter*c,doubleInner:V.doubleInner*c,doubleOuter:s.r},d=[{x:i.cx,y:i.cy-i.doubleOuter},{x:i.cx+i.doubleOuter,y:i.cy},{x:i.cx,y:i.cy+i.doubleOuter},{x:i.cx-i.doubleOuter,y:i.cy}],l=[{x:0,y:-V.doubleOuter},{x:V.doubleOuter,y:0},{x:0,y:V.doubleOuter},{x:-V.doubleOuter,y:0}];let m=null,u=null,h=s.confidence;try{m=Yr(l,d),u=Kr(m,l,d);const v=Math.max(10,Math.min(95,100-Math.max(0,u-1)*10));h=(h+v)/2}catch{h=Math.max(40,h)}const g=d.every(qa),p=$a(m);return{success:!!p&&g&&h>50,cx:i.cx,cy:i.cy,bullInner:i.bullInner,bullOuter:i.bullOuter,trebleInner:i.trebleInner,trebleOuter:i.trebleOuter,doubleInner:i.doubleInner,doubleOuter:i.doubleOuter,confidence:h,homography:p?m:null,errorPx:p?u:null,calibrationPoints:g?d:[],message:!g||!p?"❌ Detection produced unstable calibration data. Adjust camera framing or calibrate manually.":h>80?"✅ High confidence detection":h>50?"⚠️ Detection found but could be better":"❌ Low confidence - try better lighting"}}catch(r){return{success:!1,cx:a.width/2,cy:a.height/2,bullInner:0,bullOuter:0,trebleInner:0,trebleOuter:0,doubleInner:0,doubleOuter:0,confidence:0,homography:null,errorPx:null,calibrationPoints:[],message:r instanceof Error?r.message:"Board detection failed"}}}function Ha(a){if(a.confidence>70)return a;const r={bullInner_to_bullOuter:V.bullInner/V.bullOuter,bullOuter_to_trebleInner:V.bullOuter/V.trebleInner,trebleOuter_to_doubleInner:V.trebleOuter/V.doubleInner,doubleInner_to_doubleOuter:V.doubleInner/V.doubleOuter},t={bullInner_to_bullOuter:a.bullInner/a.bullOuter,bullOuter_to_trebleInner:a.bullOuter/a.trebleInner,trebleOuter_to_doubleInner:a.trebleOuter/a.doubleInner,doubleInner_to_doubleOuter:a.doubleInner/a.doubleOuter};let o=0,n=0;for(const[i,d]of Object.entries(r)){const l=t[i],m=Math.abs(l-d)/d;o+=m,n++}const s=o/n,c=Math.max(10,a.confidence-s*100);return{...a,confidence:c,message:c>70?"✅ High confidence detection":c>50?"⚠️ Rings detected but ratios off - may need refinement":"❌ Low confidence - try repositioning camera"}}const Qr="ndn_user_settings";function jn(){try{const a=localStorage.getItem(Qr);if(!a)return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,cameraEnabled:!0,hideCameraOverlay:!1,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",autoCommitMode:"wait-for-clear",textSize:"medium",boxSize:"medium",matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1};const r=JSON.parse(a);return{favoriteDouble:r.favoriteDouble||"D16",callerEnabled:typeof r.callerEnabled=="boolean"?r.callerEnabled:!0,callerVoice:r.callerVoice||"",callerVolume:typeof r.callerVolume=="number"?Math.max(0,Math.min(1,r.callerVolume)):1,speakCheckoutOnly:!!r.speakCheckoutOnly,avgMode:r.avgMode==="24h"?"24h":"all-time",autoStartOffline:!!r.autoStartOffline,rememberLastOffline:typeof r.rememberLastOffline=="boolean"?r.rememberLastOffline:!0,lastOffline:r.lastOffline&&typeof r.lastOffline=="object"?{mode:r.lastOffline.mode||"X01",x01Start:Number(r.lastOffline.x01Start)||501,firstTo:Number(r.lastOffline.firstTo)||1,aiLevel:r.lastOffline.aiLevel||"None"}:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!!r.reducedMotion,compactHeader:!!r.compactHeader,allowSpectate:typeof r.allowSpectate=="boolean"?r.allowSpectate:!0,cameraScale:typeof r.cameraScale=="number"&&isFinite(r.cameraScale)?Math.max(.5,Math.min(1.25,r.cameraScale)):1,cameraAspect:r.cameraAspect==="square"?"square":"wide",cameraFitMode:r.cameraFitMode==="fit"||r.cameraFitMode==="fill"?r.cameraFitMode:"fit",autoscoreProvider:r.autoscoreProvider==="external-ws"?"external-ws":r.autoscoreProvider==="manual"?"manual":"built-in",autoscoreWsUrl:typeof r.autoscoreWsUrl=="string"?r.autoscoreWsUrl:"",autoCommitMode:r.autoCommitMode==="immediate"?"immediate":"wait-for-clear",calibrationGuide:typeof r.calibrationGuide=="boolean"?r.calibrationGuide:!0,preferredCameraId:typeof r.preferredCameraId=="string"?r.preferredCameraId:void 0,preferredCameraLabel:typeof r.preferredCameraLabel=="string"?r.preferredCameraLabel:void 0,preferredCameraLocked:typeof r.preferredCameraLocked=="boolean"?r.preferredCameraLocked:!1,cameraEnabled:typeof r.cameraEnabled=="boolean"?r.cameraEnabled:!0,hideCameraOverlay:typeof r.hideCameraOverlay=="boolean"?r.hideCameraOverlay:!1,offlineLayout:r.offlineLayout==="classic"?"classic":"modern",textSize:r.textSize==="small"||r.textSize==="large"?r.textSize:"medium",boxSize:r.boxSize==="small"||r.boxSize==="large"?r.boxSize:"medium",matchType:r.matchType==="doubles"?"doubles":"singles",teamAName:typeof r.teamAName=="string"?r.teamAName:"Team A",teamBName:typeof r.teamBName=="string"?r.teamBName:"Team B",dartTimerEnabled:typeof r.dartTimerEnabled=="boolean"?r.dartTimerEnabled:!1,dartTimerSeconds:typeof r.dartTimerSeconds=="number"&&isFinite(r.dartTimerSeconds)?Math.max(3,Math.min(60,r.dartTimerSeconds)):10,x01DoubleIn:typeof r.x01DoubleIn=="boolean"?r.x01DoubleIn:!1}}catch{return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preferredCameraLocked:!1,cameraEnabled:!0,hideCameraOverlay:!1,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",autoCommitMode:"wait-for-clear",textSize:"medium",boxSize:"medium",matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1}}}function K(a){try{const r=jn();localStorage.setItem(Qr,JSON.stringify({...r,...a}))}catch{}}const An=Ct((a,r)=>({...jn(),setFavoriteDouble:t=>{K({favoriteDouble:t}),a({favoriteDouble:t})},setCallerEnabled:t=>{K({callerEnabled:t}),a({callerEnabled:t})},setCallerVoice:t=>{K({callerVoice:t}),a({callerVoice:t})},setAvgMode:t=>{K({avgMode:t}),a({avgMode:t})},setCallerVolume:t=>{const o=Math.max(0,Math.min(1,t));K({callerVolume:o}),a({callerVolume:o})},setSpeakCheckoutOnly:t=>{K({speakCheckoutOnly:t}),a({speakCheckoutOnly:t})},setAutoStartOffline:t=>{K({autoStartOffline:t}),a({autoStartOffline:t})},setRememberLastOffline:t=>{K({rememberLastOffline:t}),a({rememberLastOffline:t})},setLastOffline:t=>{const n={...jn().lastOffline,...t};K({lastOffline:n}),a({lastOffline:n})},setReducedMotion:t=>{K({reducedMotion:t}),a({reducedMotion:t})},setCompactHeader:t=>{K({compactHeader:t}),a({compactHeader:t})},setAllowSpectate:t=>{K({allowSpectate:t}),a({allowSpectate:t})},ignorePreferredCameraSync:!1,setIgnorePreferredCameraSync:t=>{K({}),a({ignorePreferredCameraSync:t})},setCameraScale:t=>{const o=Math.max(.5,Math.min(1.25,t));K({cameraScale:o}),a({cameraScale:o})},setCameraAspect:t=>{const o=t==="square"?"square":"wide";K({cameraAspect:o}),a({cameraAspect:o})},setCameraFitMode:t=>{const o=t==="fit"?"fit":"fill";K({cameraFitMode:o}),a({cameraFitMode:o})},setAutoscoreProvider:t=>{K({autoscoreProvider:t}),a({autoscoreProvider:t})},setAutoscoreWsUrl:t=>{K({autoscoreWsUrl:t}),a({autoscoreWsUrl:t})},setAutoCommitMode:t=>{const o=t==="immediate"?"immediate":"wait-for-clear";K({autoCommitMode:o}),a({autoCommitMode:o})},setCalibrationGuide:t=>{K({calibrationGuide:t}),a({calibrationGuide:t})},setPreferredCamera:(t,o,n=!1)=>{try{const s=r();if(console.log("[USERSETTINGS] setPreferredCamera called:",{id:t,label:o,force:n,locked:s.preferredCameraLocked}),s.preferredCameraLocked&&!n){console.log("[USERSETTINGS] Camera selection locked and force=false, ignoring update");return}}catch{}console.log("[USERSETTINGS] Saving preferred camera:",{id:t,label:o}),K({preferredCameraId:t,preferredCameraLabel:o}),a({preferredCameraId:t,preferredCameraLabel:o})},setPreferredCameraLocked:t=>{K({preferredCameraLocked:t}),a({preferredCameraLocked:t})},setCameraEnabled:t=>{K({cameraEnabled:t}),a({cameraEnabled:t})},setHideCameraOverlay:t=>{K({hideCameraOverlay:t}),a({hideCameraOverlay:t})},setOfflineLayout:t=>{K({offlineLayout:t}),a({offlineLayout:t})},setTextSize:t=>{K({textSize:t}),a({textSize:t})},setBoxSize:t=>{K({boxSize:t}),a({boxSize:t})},setMatchType:t=>{const o=t==="doubles"?"doubles":"singles";K({matchType:o}),a({matchType:o})},setTeamAName:t=>{const o=t?.trim()||"Team A";K({teamAName:o}),a({teamAName:o})},setTeamBName:t=>{const o=t?.trim()||"Team B";K({teamBName:o}),a({teamBName:o})},setDartTimerEnabled:t=>{K({dartTimerEnabled:t}),a({dartTimerEnabled:t})},setDartTimerSeconds:t=>{const o=Math.max(3,Math.min(60,Math.round(t)));K({dartTimerSeconds:o}),a({dartTimerSeconds:o})},setX01DoubleIn:t=>{K({x01DoubleIn:t}),a({x01DoubleIn:t})}})),Wa={};function Ga(){const a=w.useRef(null),r=w.useRef(null),t=w.useRef(null);w.useRef(null);const[o,n]=w.useState("unknown"),[s,c]=w.useState([]),[i,d]=w.useState(null),[l,m]=w.useState(!1),[u,h]=w.useState(!1),[g,p]=w.useState("camera"),[y,v]=w.useState(()=>localStorage.getItem("ndn:cal:mode")||"local"),[b,S]=w.useState([]),[N,C]=w.useState(!1),[E,j]=w.useState(null),[f,k]=w.useState(1),[R,L]=w.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("ndn:cal:forceDesktop")==="1"}catch{return!1}}),[I,P]=w.useState(()=>typeof navigator>"u"?!1:/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)),{H:A,setCalibration:O,reset:W,errorPx:Z,locked:se}=Pn(),ae=kt(),{calibrationGuide:fe,setCalibrationGuide:we,preferredCameraId:xe,cameraEnabled:je,setCameraEnabled:Ne,preferredCameraLocked:Oe,setPreferredCameraLocked:G,setPreferredCamera:Ve}=An(),[Q,de]=w.useState(null),[le,He]=w.useState(!1),[Pt,it]=w.useState(0),[Pe,lt]=w.useState(!1),[We,ct]=w.useState(!0),[re,Qe]=w.useState(null),[Xe,et]=w.useState([]);w.useCallback((_,$=480)=>{if(typeof document>"u")throw new Error("Marker rendering only available in browser context");const U=Fa(_),q=document.createElement("canvas");q.width=$,q.height=$;const D=q.getContext("2d");if(!D)return"";D.fillStyle="#ffffff",D.fillRect(0,0,$,$);const ee=U.length,z=U[0]?.length||ee,X=$/z,oe=$/ee;for(let he=0;he<ee;he++)for(let ue=0;ue<z;ue++)U[he][ue]&&(D.fillStyle="#000000",D.fillRect(Math.round(ue*X),Math.round(he*oe),Math.ceil(X),Math.ceil(oe)));return q.toDataURL("image/png")},[]);const[Re,_e]=w.useState(null),ke=w.useRef(null),[be,tt]=w.useState(null),ie=w.useRef(null),Ae=w.useRef([]),[ye,Be]=w.useState(null),[Ge,nt]=w.useState(Date.now()),[Je,Ue]=w.useState(!1);function ce(_){try{_e(_),ke.current=_}catch{}}const[pt,Ye]=w.useState(""),[ve,Me]=w.useState(null),[Fe,rt]=w.useState(null),[xt,dt]=w.useState(!0),[qe,x]=w.useState([]),[M,B]=w.useState(!1),[Y,J]=w.useState(null),ne=w.useRef(null);w.useEffect(()=>{console.log("[Calibrator] 🔄 STREAMING STATE CHANGED:",{streaming:l,phase:g,videoRefExists:!!a.current})},[l,g]),w.useEffect(()=>{const _=window.location.hostname;(_==="localhost"||_==="127.0.0.1")&&ze("/api/hosts").then($=>$.json()).then($=>{const U=Array.isArray($?.hosts)&&$.hosts.find(q=>q);U&&Me(U)}).catch(()=>{}),ze("/api/https-info").then($=>$.json()).then($=>{$&&typeof $.https=="boolean"&&rt({https:!!$.https,port:Number($.port)||8788})}).catch(()=>{})},[]);const ge=w.useMemo(()=>{const _=Re||"____",$="ws://localhost:8787";if($.length>0)try{const z=new URL($);return`${`${z.protocol==="wss:"?"https":"http"}://${z.host}${z.pathname.endsWith("/ws")?"":z.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${_}`}catch{}const U=ve||window.location.hostname,q=!!Fe?.https,D=q?Fe?.port||8788:8787;return`${q?"https":"http"}://${U}:${D}/mobile-cam.html?code=${_}`},[Re,ve,Fe]);w.useMemo(()=>{if(!ge)return null;try{const _=new URL(ge);return _.searchParams.delete("code"),_.toString().replace(/\?$/,"")}catch{return typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html"}},[ge]),w.useEffect(()=>{localStorage.setItem("ndn:cal:mode",y)},[y]),w.useEffect(()=>{if(!(typeof window>"u"))try{R?window.localStorage.setItem("ndn:cal:forceDesktop","1"):window.localStorage.removeItem("ndn:cal:forceDesktop")}catch{}},[R]),w.useEffect(()=>{if(typeof window>"u")return;const _=window.matchMedia("(pointer: coarse)"),$=()=>{const U=typeof navigator<"u"&&/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent),q=typeof _.matches=="boolean"?_.matches:!1,D=window.innerWidth<=820;P(U||q||D)};$();try{typeof _.addEventListener=="function"?_.addEventListener("change",$):typeof _.addListener=="function"&&_.addListener($)}catch{}return window.addEventListener("resize",$),()=>{try{typeof _.removeEventListener=="function"?_.removeEventListener("change",$):typeof _.removeListener=="function"&&_.removeListener($)}catch{}window.removeEventListener("resize",$)}},[]),w.useEffect(()=>{if(!Re){Ye("");return}const _=Wa?.VITE_QR_LOGO_URL||"/dart-thrower.svg";da(ge,{width:256,margin:2,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"},logo:{logoUrl:_,logoScale:.2,mask:!0,shape:"circle"}}).then(Ye).catch(()=>Ye(""))},[ge,Re]),w.useEffect(()=>{if(typeof navigator>"u"||!navigator.permissions){n("unsupported");return}let _=!0;return(async()=>{try{const $=await navigator.permissions.query({name:"camera"});if(!_)return;n($.state||"unknown"),$.onchange=()=>{_&&n($.state)}}catch{_&&n("unknown")}})(),()=>{_=!1}},[]),w.useEffect(()=>{if(!ye)return;const _=setInterval(()=>nt(Date.now()),1e3);return()=>clearInterval(_)},[ye]),w.useMemo(()=>ye?Math.max(0,Math.ceil((ye-Ge)/1e3)):null,[ye,Ge]),w.useEffect(()=>()=>{ne.current&&window.clearTimeout(ne.current)},[]),w.useCallback(async(_,$)=>{if(_)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(_);else{const U=document.createElement("textarea");U.value=_,U.style.position="fixed",U.style.opacity="0",document.body.appendChild(U),U.focus(),U.select(),document.execCommand("copy"),document.body.removeChild(U)}J($),ne.current&&window.clearTimeout(ne.current),ne.current=window.setTimeout(()=>J(null),1500)}catch(U){console.warn("[Calibrator] Copy failed:",U),J(null)}},[]),w.useEffect(()=>()=>{},[]),w.useEffect(()=>{const _=$=>{console.log("[Calibrator] Received reconnect request from PhoneCameraOverlay"),y==="phone"&&Je&&(Se(!1),setTimeout(()=>{ut()},500))};return window.addEventListener("ndn:phone-camera-reconnect",_),()=>{window.removeEventListener("ndn:phone-camera-reconnect",_)}},[y,Je]),w.useEffect(()=>{console.log("[Calibrator] 🔄 STREAMING CHANGED:",{streaming:l,videoRefAvailable:!!a.current}),a.current?(console.log("[Calibrator] ✅ Syncing videoElementRef on streaming change"),ae.setVideoElementRef(a.current),a.current.srcObject instanceof MediaStream&&(console.log("[Calibrator] ✅ Setting mediaStream from video element"),ae.setMediaStream(a.current.srcObject))):console.warn("[Calibrator] ⚠️ videoRef.current is null on streaming change!")},[l]),w.useEffect(()=>(console.log("[Calibrator] 🚀 MOUNT: Initial mount - syncing videoRef"),console.log("[Calibrator] videoRef.current available:",!!a.current),console.log("[Calibrator] videoRef.current type:",a.current?.constructor?.name),a.current?(console.log("[Calibrator] ✅ Setting videoElementRef on mount"),console.log("[Calibrator] Video element:",{tagName:a.current.tagName,srcObject:!!a.current.srcObject,videoWidth:a.current.videoWidth,videoHeight:a.current.videoHeight}),ae.setVideoElementRef(a.current),console.log("[Calibrator] ✅ videoElementRef set successfully")):console.error("[Calibrator] ❌ CRITICAL: videoRef.current is NULL at mount!"),()=>{}),[]);function st(){if(be&&(be.readyState===WebSocket.OPEN||be.readyState===WebSocket.CONNECTING))return console.log("[Calibrator] ensureWS: Reusing existing WebSocket (state:",be.readyState,")"),be;const _="ws://localhost:8787",$=_.length>0?_.endsWith("/ws")?_:_.replace(/\/$/,"")+"/ws":void 0,q=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws`,D=window.location.hostname,z=$||(D.endsWith("onrender.com")?q:"wss://ninedartnation.onrender.com/ws");console.log("[Calibrator] ensureWS: Creating new WebSocket to:",z);let X=new WebSocket(z);return X.onerror=oe=>{console.error("[Calibrator] WebSocket connection error:",oe),alert("Failed to connect to camera pairing service. Please check your internet connection and try again.")},X.onclose=oe=>{if(console.log("[Calibrator] WebSocket closed:",oe.code,oe.reason),ie.current){try{ie.current.close()}catch{}ie.current=null}ce(null),Be(null),Ue(!1),oe.code!==1e3&&(alert("Camera pairing connection lost. Please try pairing again."),y==="phone"&&v("local"))},tt(X),X}async function ut(){v("phone"),Se(!1),pe();try{Ne(!0)}catch{}const _=st();_.readyState===WebSocket.OPEN?(console.log("[Calibrator] WebSocket open, sending cam-create"),_.send(JSON.stringify({type:"cam-create"}))):(console.log("[Calibrator] WebSocket connecting, will send cam-create on open"),_.onopen=()=>{console.log("[Calibrator] WebSocket now open, sending cam-create"),_.send(JSON.stringify({type:"cam-create"}))}),_.onmessage=async $=>{const U=JSON.parse($.data);if(U.type==="cam-code")ce(U.code),U.expiresAt&&Be(U.expiresAt);else if(U.type==="cam-peer-joined"){!ke.current&&U.code&&ce(U.code),Ue(!0);const q=ke.current||U.code||null;q&&(ke.current=q);try{if(se&&q){const ee=r.current?{w:r.current.width,h:r.current.height}:null,z={H:A,imageSize:ee,errorPx:Z??null,createdAt:Date.now()};_.send(JSON.stringify({type:"cam-calibration",code:q,payload:z})),console.log("[Calibrator] Sent calibration to joined phone for code",q)}}catch(ee){console.warn("[Calibrator] Failed to send calibration on peer join",ee)}const D=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceCandidatePoolSize:10});ie.current=D,D.onconnectionstatechange=()=>{console.log("WebRTC connection state:",D.connectionState),D.connectionState==="failed"||D.connectionState==="disconnected"?(console.error("WebRTC connection failed"),alert("Camera connection lost. Please try pairing again."),Se(!1)):D.connectionState==="connected"&&console.log("WebRTC connection established")},D.onicecandidate=ee=>{ee.candidate&&q&&_.send(JSON.stringify({type:"cam-ice",code:q,payload:ee.candidate}))},D.ontrack=ee=>{if(console.log("[Calibrator] WebRTC ontrack received:",ee.streams?.length,"streams, track kind:",ee.track?.kind),a.current){const z=ee.streams?.[0];z?(console.log("[Calibrator] Assigning video stream (tracks:",z.getTracks().length,") to video element"),C(!1),setTimeout(()=>{a.current&&(console.log("[Calibrator] Setting srcObject and attempting play"),a.current.srcObject&&a.current.srcObject.getTracks().forEach(oe=>oe.stop()),a.current.srcObject=z,a.current.muted=!0,a.current.playsInline=!0,a.current.play().then(()=>{console.log("[Calibrator] Video playback started successfully"),m(!0),p("capture"),ae.setStreaming(!0),ae.setMode("phone"),ae.setMediaStream(z);try{Ve(void 0,"Phone Camera",!0)}catch{}if(!Oe)try{G(!0)}catch{}try{Ne(!0)}catch{}h(!1)}).catch(X=>{console.error("[Calibrator] Video play failed:",X),h(!0),console.warn("[Calibrator] video play blocked — prompting user interaction")}))},100)):console.error("[Calibrator] No inbound stream received in ontrack")}else console.error("[Calibrator] Video element not available")};try{const ee=await D.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await D.setLocalDescription(ee),console.log("[Calibrator] Sending cam-offer for code:",q),q?_.send(JSON.stringify({type:"cam-offer",code:q,payload:ee})):console.warn("[Calibrator] Missing pairing code when sending offer")}catch(ee){console.error("Failed to create WebRTC offer:",ee),alert("Failed to establish camera connection. Please try again."),Se(!1)}}else if(U.type==="cam-answer"){console.log("[Calibrator] Received cam-answer");const q=ie.current;if(q)try{await q.setRemoteDescription(new RTCSessionDescription(U.payload)),console.log("[Calibrator] Remote description set (answer)");const D=Ae.current;console.log(`[Calibrator] Processing ${D.length} pending ICE candidates`);for(const ee of D)try{await q.addIceCandidate(ee),console.log("[Calibrator] Queued ICE candidate added")}catch(z){console.error("Failed to add queued ICE candidate:",z)}Ae.current=[]}catch(D){console.error("Failed to set remote description:",D),alert("Camera pairing failed. Please try again."),Se(!1)}else console.warn("[Calibrator] Received cam-answer but no peer connection exists")}else if(U.type==="cam-ice"){console.log("[Calibrator] Received cam-ice");const q=ie.current;if(q)if(q.remoteDescription)try{await q.addIceCandidate(U.payload),console.log("[Calibrator] ICE candidate added")}catch(D){console.error("Failed to add ICE candidate:",D)}else console.log("[Calibrator] Remote description not set yet, queuing ICE candidate"),Ae.current.push(U.payload);else console.warn("[Calibrator] Received ICE candidate but no peer connection exists")}else if(U.type==="cam-error")console.error("Camera pairing error:",U.code),alert(U.code==="EXPIRED"?"Code expired. Generate a new code.":`Camera error: ${U.code||"Unknown error"}`),Se(!1);else if(U.type==="cam-calibration"){console.log("[Calibrator] Received calibration from peer:",U.payload);try{U.payload&&U.payload.H&&Array.isArray(U.payload.H)&&(O({H:U.payload.H,createdAt:U.payload.createdAt||Date.now(),errorPx:U.payload.errorPx,imageSize:U.payload.imageSize,locked:!0}),console.log("[Calibrator] Applied received calibration"))}catch(q){console.error("[Calibrator] Failed to apply received calibration",q)}}}}function Se(_=!1){if(a.current&&a.current.srcObject&&(a.current.srcObject.getTracks().forEach(U=>U.stop()),a.current.srcObject=null,m(!1)),ie.current){try{ie.current.close()}catch{}ie.current=null}Ae.current=[],ce(null),Be(null),Ue(!1),Qe(null),ae.setStreaming(!1),ae.setMediaStream(null),_&&(y==="phone"||y==="wifi")&&v("local")}function pe(){try{Oe||G(!0)}catch{}}function Rt(_=b,$=null){if(!r.current||!t.current)return;const U=r.current,q=t.current;q.width=U.width,q.height=U.height;const D=q.getContext("2d");D.clearRect(0,0,q.width,q.height);const ee=$||A;if(ee){const z=[V.bullInner,V.bullOuter,V.trebleInner,V.trebleOuter,V.doubleInner,V.doubleOuter];for(const X of z){if(!Number.isFinite(X))continue;const oe=se?"#10b981":X===V.doubleOuter?"#22d3ee":"#a78bfa",he=se||X===V.doubleOuter?3:2;try{const ue=Ra(ee,X,360);if(!ue.length||ue.some(At=>!Number.isFinite(At.x)||!Number.isFinite(At.y)))continue;Aa(D,ue,oe,he)}catch(ue){console.warn("[Calibrator] Skipped invalid ring overlay",{radius:X,err:ue})}}}if(!ee&&Q){const z=(X,oe,he=2)=>{!Number.isFinite(X)||X<=0||(D.save(),D.strokeStyle=oe,D.lineWidth=he,D.beginPath(),D.arc(Q.cx,Q.cy,X,0,Math.PI*2),D.stroke(),D.restore())};z(Q.doubleOuter,"#22d3ee",3),z(Q.doubleInner,"#22d3ee",2),z(Q.trebleOuter,"#fde047",2),z(Q.trebleInner,"#fde047",2),z(Q.bullOuter,"#34d399",2),z(Q.bullInner,"#10b981",3)}if(_.length<6&&ee){D.save(),D.strokeStyle="rgba(255,193,7,0.4)",D.lineWidth=2,D.setLineDash([4,4]);const z=Cr();for(let X=_.length;X<6&&X<z.length;X++)try{const oe=Et(ee,z[X]);D.beginPath(),D.arc(oe.x,oe.y,12,0,Math.PI*2),D.stroke()}catch{}D.restore()}if(_.forEach((z,X)=>{Ma(D,z,"#f472b6"),D.save(),D.fillStyle="#f472b6",D.font="14px sans-serif",D.fillText(String(X+1),z.x+6,z.y-6),D.restore()}),fe&&!se){D.save(),D.fillStyle="rgba(59,130,246,0.10)";const z=Math.round(Math.min(q.width,q.height)*.08),X=q.width-z*2,oe=q.height-z*2;D.fillRect(z,z,X,oe),D.strokeStyle="rgba(34,197,94,0.9)",D.lineWidth=2,D.beginPath(),D.moveTo(z,q.height/2),D.lineTo(q.width-z,q.height/2),D.stroke(),D.beginPath(),D.moveTo(q.width/2,z),D.lineTo(q.width/2,q.height-z),D.stroke(),D.strokeStyle="rgba(234,179,8,0.9)",D.setLineDash([6,4]);const he=z+30,ue=z+30;D.beginPath(),D.moveTo(he,ue+30),D.lineTo(he+60,ue),D.stroke(),D.beginPath(),D.moveTo(q.width-he,ue+30),D.lineTo(q.width-he-60,ue),D.stroke(),D.restore(),D.save(),D.scale(1/f,1/f),D.fillStyle="rgba(255,255,255,0.85)",D.font="12px sans-serif",D.fillText("Tip: Frame board centered, edges parallel; slight top-down is okay. Keep bull near center.",z*f,(z+18)*f),D.restore()}}const at=w.useRef(null);if(w.useEffect(()=>{let _=null;try{_=new Worker(new URL("/assets/boardDetection.worker-DkETM2wk.js",import.meta.url),{type:"module"}),at.current=_,console.log("[Calibrator] Board detection worker created")}catch($){console.warn("[Calibrator] Failed to create board detection worker, will fallback to main thread: ",$),at.current=null}return()=>{try{_?.terminate()}catch{}}},[]),!r.current)return alert("Capture a frame or upload a photo first.");let T=Va(r.current);if(T=Ha(T),We)try{T.confidence=100}catch{}if(We&&(!T.homography||!Array.isArray(T.calibrationPoints)||T.calibrationPoints.length<4))try{const _=T.calibrationPoints||[];if(_.length>=4){const $=[{x:0,y:-V.doubleOuter},{x:V.doubleOuter,y:0},{x:0,y:V.doubleOuter},{x:-V.doubleOuter,y:0}],U=Yr($,_.slice(0,4));T.homography=U;const q=Kr(U,$,_.slice(0,4));T.errorPx=q}}catch(_){console.warn("[Calibrator] Forced homography compute failed",_)}if(!T.success||!T.homography||!We&&T.confidence<50){alert(`❌ Board Detection Failed

Confidence: ${Math.round(T.confidence)}%

${T.message}

Try:
• Better lighting
• Closer camera angle
• Make sure entire board is visible
• Use manual calibration instead (click 5 points)`);return}const F=T.homography,te=T.calibrationPoints||[],Le=Array.isArray(te)&&te.length>=4&&te.every(_=>_&&Number.isFinite(_.x)&&Number.isFinite(_.y)),is=Array.isArray(F)&&F.length===9&&F.every(Number.isFinite);if(!Le||!is){console.error("[Calibrator] Auto-calibration produced invalid data",{boardDetection:T}),alert("❌ Auto-calibration produced unstable results. Adjust camera framing or calibrate manually.");return}de({cx:T.cx,cy:T.cy,bullInner:T.bullInner,bullOuter:T.bullOuter,trebleInner:T.trebleInner,trebleOuter:T.trebleOuter,doubleInner:T.doubleInner,doubleOuter:T.doubleOuter}),S(T.calibrationPoints),Rt(T.calibrationPoints,T.homography);const On=(T.errorPx??Number.POSITIVE_INFINITY)<=2;O({H:T.homography,createdAt:Date.now(),errorPx:T.errorPx??null,imageSize:{w:r.current.width,h:r.current.height},anchors:{src:Cr().slice(0,4),dst:T.calibrationPoints},locked:On?!0:se}),p("computed");const ls=T.confidence>90?"🟢 Excellent":T.confidence>80?"🟢 Good":T.confidence>70?"🟡 Fair":"🟡 Acceptable";alert(`✅ Auto-Calibration Successful!

Confidence: ${ls} (${Math.round(T.confidence)}%)
Error: ${T.errorPx?.toFixed(2)??"?"} pixels

Calibration has been ${On?"locked":"computed (not locked yet)"}.`)}w.useEffect(()=>{drawOverlay()},[snapshotSet,H]);w.useEffect(()=>{if(!liveDetect||!streaming)return;let a=0;const r=()=>{try{captureFrame()}catch{}a=requestAnimationFrame(r)};return a=requestAnimationFrame(r),()=>cancelAnimationFrame(a)},[liveDetect,streaming]);w.useEffect(()=>{(async()=>{try{if(!locked||!pairCode)return;const a=canvasRef.current?{w:canvasRef.current.width,h:canvasRef.current.height}:null,r=JSON.stringify({H,anchors:null,imageSize:a,errorPx:errorPx??null});try{await ze(`/cam/calibration/${pairCode}`,{method:"POST",headers:{"Content-Type":"application/json"},body:r}),console.log("[Calibrator] Posted calibration for code",pairCode)}catch(t){console.warn("[Calibrator] Upload calibration failed",t)}try{const t=localStorage.getItem("authToken");t&&(await ze("/api/user/calibration",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:r}),console.log("[Calibrator] Synced calibration to user account"))}catch(t){console.warn("[Calibrator] User calibration sync failed",t)}}catch{}})()},[locked,pairCode]);let Ja=1;const Nn=Ct(a=>({toasts:[],push:(r,t)=>a(o=>{const n=Ja++,s={id:n,message:r,type:t?.type||"info",timeout:t?.timeout??3e3};return s.timeout&&s.timeout>0&&setTimeout(()=>{a(c=>({toasts:c.toasts.filter(i=>i.id!==n)}))},s.timeout),{toasts:[...o.toasts,s]}}),remove:r=>a(t=>({toasts:t.toasts.filter(o=>o.id!==r)})),clear:()=>a({toasts:[]})}));function Zo(){return Nn(r=>r.push)}function Ya(){const a=Nn(t=>t.toasts),r=Nn(t=>t.remove);return a.length?e.jsxs(e.Fragment,{children:[a.filter(t=>t.type==="success").map(t=>e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50",children:e.jsx("div",{className:"p-4 rounded-lg shadow-lg border text-sm bg-emerald-700/90 border-emerald-500/60 text-white max-w-sm text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("span",{className:"flex-1 font-semibold",children:t.message})})})},t.id)),a.filter(t=>t.type!=="success").length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 sm:right-4 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 w-[calc(100%-1.5rem)] sm:w-auto max-w-sm",children:a.filter(t=>t.type!=="success").map(t=>e.jsx("div",{className:`p-3 rounded-lg shadow-lg border text-sm ${t.type==="error"?"bg-rose-700/80 border-rose-500/60 text-white":"bg-black/70 border-slate-700 text-slate-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex-1",children:t.message}),e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>r(t.id),children:"Dismiss"})]})},t.id))})]}):null}function Ka({data:a,height:r=220,barWidth:t=28,gap:o=6,showValues:n=!1}){const s=Math.max(1,...a.map(i=>i.value)),c=a.length*(t+o);return e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"relative",style:{height:r,width:Math.max(600,c)},children:e.jsx("div",{className:"absolute inset-0 flex items-end",children:a.map((i,d)=>{const l=Math.round(i.value/s*(r-40));return e.jsxs("div",{className:"flex flex-col items-center justify-end",style:{width:t,marginRight:o},children:[e.jsx("div",{className:"w-full rounded-t-md bg-gradient-to-b from-indigo-400 to-fuchsia-500 shadow-sm",style:{height:l},title:`${i.label}: ${i.value}`}),n&&e.jsx("div",{className:"text-[10px] mt-1 text-indigo-200 font-semibold",children:i.value}),e.jsx("div",{className:"text-[10px] mt-1 text-slate-200 font-medium select-none",children:i.label})]},d)})})})})}function Za({tabs:a,active:r,onChange:t,className:o}){return e.jsxs("div",{className:`relative ${o||""}`,children:[e.jsx("div",{className:"absolute inset-0 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 pointer-events-none"}),e.jsx("div",{className:"relative overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx("div",{className:"flex items-center gap-2 min-w-max",children:a.map(n=>{const s=n.key===r;return e.jsx("button",{type:"button",onClick:()=>t(n.key),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98]
                  ${s?"bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white shadow-indigo-500/30":"bg-white/10 text-slate-100 hover:bg-white/15"}
                `,"aria-pressed":s,children:n.label},n.key)})})}),e.jsx("style",{children:`
        /* Hide scrollbars on WebKit/Firefox for a cleaner pill row */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})}const Xr=a=>`ndn_stats_${a}`,es=a=>`ndn_stats_ts_${a}`;function Mn(a){try{const r=localStorage.getItem(Xr(a));if(!r)return{darts:0,scored:0};const t=JSON.parse(r);return{darts:Number(t.darts)||0,scored:Number(t.scored)||0,fnDarts:Number(t.fnDarts)||0,fnScored:Number(t.fnScored)||0,best3:typeof t.best3=="number"?t.best3:0,worst3:typeof t.worst3=="number"?t.worst3:0,bestLegDarts:typeof t.bestLegDarts=="number"?t.bestLegDarts:0,bestCheckout:typeof t.bestCheckout=="number"?t.bestCheckout:0,worstLegDarts:typeof t.worstLegDarts=="number"?t.worstLegDarts:0,bestFNAvg:typeof t.bestFNAvg=="number"?t.bestFNAvg:0,worstFNAvg:typeof t.worstFNAvg=="number"?t.worstFNAvg:0}}catch{return{darts:0,scored:0}}}function Qa(a,r){try{localStorage.setItem(Xr(a),JSON.stringify(r)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:a,totals:r}}))}catch{}}function Xa(a){const{darts:r,scored:t}=Mn(a);return r?t/r*3:0}function Qo(a){const{fnDarts:r=0,fnScored:t=0}=Mn(a);return r?t/r*3:0}const ts="ndn_game_mode_stats";function ns(a){let r={};try{const t=localStorage.getItem(ts);t&&(r=JSON.parse(t))}catch{}if(Array.isArray(a))for(const t of a)r[t]||(r[t]={played:0,won:0});return r}function eo(a){try{localStorage.setItem(ts,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{gameModes:!0}}))}catch{}}function Xo(a,r){const t=ns(),o=t[a]||{played:0,won:0};o.played+=1,r&&(o.won+=1),t[a]=o,eo(t)}function Tt(a){try{const r=localStorage.getItem(es(a));if(!r)return[];const t=JSON.parse(r);return Array.isArray(t)?t.map(o=>({t:Number(o.t)||0,darts:Number(o.darts)||0,scored:Number(o.scored)||0,fnDarts:Number(o.fnDarts)||0,fnScored:Number(o.fnScored)||0})).filter(o=>o.t>0):[]}catch{return[]}}function to(a,r){try{localStorage.setItem(es(a),JSON.stringify(r)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:a}}))}catch{}}function no(a,r){const t=Date.now();return a.filter(o=>t-o.t<=r)}function ro(a,r,t,o=Date.now(),n,s){if(r<=0)return;const c=Tt(a),i=no([...c,{t:o,darts:r,scored:t,fnDarts:n,fnScored:s}],1e3*60*60*24*30);to(a,i)}function so(a,r=1e3*60*60*24){const t=Tt(a);if(!t.length)return 0;const o=Date.now();let n=0,s=0;for(const c of t)o-c.t<=r&&(n+=c.darts,s+=c.scored);return n<=0?0:s/n*3}function ao(a,r=1e3*60*60*24*30){const t=Tt(a);if(!t.length)return 0;const o=Date.now();let n=0,s=0;for(const c of t)o-c.t<=r&&(n+=c.fnDarts||0,s+=c.fnScored||0);return n<=0?0:s/n*3}function ei(a){const t=Tt(a);if(!t.length)return 0;const o=Date.now(),n=t.filter(l=>o-l.t<=2592e6),s=n.filter(l=>typeof l.fnDarts=="number"),c=s.length?s:n;let i=0,d=0;for(const l of c)i+=l.darts,d+=l.scored;return i<=0?0:d/i*3}function ti(a){return ao(a,2592e6)}function ni(a){for(const r of a){let t=0,o=0,n=0,s=0,c=0,i=0,d=0,l=0,m=0,u=0,h=0;for(const g of r.legs){if(!g.finished)continue;t+=g.dartsThrown,o+=Math.max(0,g.totalScoreStart-g.totalScoreRemaining);const{d:p,s:y}=oo(g);n+=p,s+=y;const v=Math.max(0,g.dartsThrown),b=Math.max(0,g.totalScoreStart-g.totalScoreRemaining),S=v>0?b/v*3:0,N=p>0?y/p*3:0;if(S>0&&(c=Math.max(c,S),i=i===0?S:Math.min(i,S)),N>0&&(u=Math.max(u,N),h=h===0?N:Math.min(h,N)),g.totalScoreRemaining===0){(d===0||v<d)&&(d=v),(m===0||v>m)&&(m=v);const E=typeof g.checkoutScore=="number"?g.checkoutScore:0;E>l&&(l=E)}}if(t>0){const g=Mn(r.name),p={darts:g.darts+t,scored:g.scored+o,fnDarts:(g.fnDarts||0)+n,fnScored:(g.fnScored||0)+s,best3:Math.max(g.best3||0,c||0),worst3:(()=>{const y=g.worst3||0;return y===0?i||0:i===0?y:Math.min(y,i)})(),bestLegDarts:(()=>{const y=g.bestLegDarts||0;return y===0?d||0:d===0?y:Math.min(y,d)})(),bestCheckout:Math.max(g.bestCheckout||0,l||0),worstLegDarts:(()=>{const y=g.worstLegDarts||0;return y===0?m||0:m===0?y:Math.max(y,m)})(),bestFNAvg:Math.max(g.bestFNAvg||0,u||0),worstFNAvg:(()=>{const y=g.worstFNAvg||0;return y===0?h||0:h===0?y:Math.min(y,h)})()};Qa(r.name,p),ro(r.name,t,o,Date.now(),n,s)}}}function oo(a){let r=Math.min(9,a.dartsThrown);if(r<=0)return{d:0,s:0};let t=0;for(const n of a.visits){if(r<=0)break;const s=Math.min(r,n.darts);s===n.darts?t+=n.score:t+=Math.round(n.score/n.darts*s),r-=s}return{d:Math.min(9,a.dartsThrown),s:t}}const io=["X01","Double Practice"],lo=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice","Baseball","Golf","Tic Tac Toe","American Cricket","Scam","Fives","Sevens"],Ar=[...io,...lo],rs=w.createContext(null);function co({children:a}){const[r,t]=w.useState(!1),[o,n]=w.useState("connecting"),s=w.useRef(null),c=w.useRef(new Set),i=w.useRef(!0),d=w.useRef(0),l=w.useRef(null),m=w.useRef(null),u=w.useRef(null),h=w.useRef(0),g=()=>{if(u.current)return u.current;const E="ws://localhost:8787";if(E.length>0){const L=E.endsWith("/ws")?E:E.replace(/\/$/,"")+"/ws";return u.current=[L],u.current}const j=window.location.protocol==="https:"?"wss":"ws",f=window.location.hostname,R=[`${j}://${window.location.host}`+"/ws",`${j}://${f}/ws`,`${j}://${f}:8787/ws`,`${j}://${f}:3000/ws`];return u.current=Array.from(new Set(R)),u.current},p=()=>{const E=g();return h.current=(h.current+1)%E.length,E[h.current]},y=()=>{const E=g();return E[h.current]||E[0]},v=w.useCallback(()=>{if(s.current&&(s.current.readyState===WebSocket.OPEN||s.current.readyState===WebSocket.CONNECTING))return;n("connecting");const j=`${y()}`,f=new WebSocket(j);s.current=f,f.onopen=()=>{t(!0),n("connected"),d.current=0,m.current&&clearInterval(m.current),m.current=setInterval(()=>{try{s.current?.readyState===WebSocket.OPEN&&s.current?.send(JSON.stringify({type:"ping",t:Date.now()}))}catch{}},2e4)},f.onmessage=k=>{try{const R=JSON.parse(k.data);c.current.forEach(L=>{try{L(R)}catch{}})}catch{}},f.onerror=()=>{},f.onclose=()=>{if(t(!1),n("disconnected"),m.current&&(clearInterval(m.current),m.current=null),!i.current)return;const k=(d.current||0)+1;d.current=k,k%2===0&&p();const R=1e3*Math.pow(2,k-1),L=Math.floor(Math.random()*1e3);let I=Math.min(3e4,R+L);k===1&&(I=0),l.current&&clearTimeout(l.current),I===0?v():l.current=setTimeout(v,I)}},[]),b=w.useCallback(()=>{try{i.current=!1,l.current&&(clearTimeout(l.current),l.current=null),m.current&&(clearInterval(m.current),m.current=null);try{s.current?.close()}catch{}s.current=null}catch{}d.current=0,i.current=!0,n("connecting"),t(!1),v()},[v]);w.useEffect(()=>{i.current=!0,v();const E=()=>{i.current=!1;try{s.current?.close()}catch{}};window.addEventListener("beforeunload",E);const j=()=>{document.visibilityState==="visible"&&(r||v())};return document.addEventListener("visibilitychange",j),window.addEventListener("online",v),()=>{i.current=!1,l.current&&clearTimeout(l.current),m.current&&clearInterval(m.current);try{s.current?.close()}catch{}document.removeEventListener("visibilitychange",j),window.removeEventListener("online",v),window.removeEventListener("beforeunload",E)}},[v]);const S=w.useCallback(E=>{try{s.current&&s.current.readyState===WebSocket.OPEN&&s.current.send(typeof E=="string"?E:JSON.stringify(E))}catch{}},[]),N=w.useCallback(E=>(c.current.add(E),()=>{c.current.delete(E)}),[]),C=w.useMemo(()=>({connected:r,status:o,send:S,addListener:N,reconnect:b}),[r,o,S,N,b]);return e.jsx(rs.Provider,{value:C,children:a})}function It(){const a=w.useContext(rs);if(!a)throw new Error("useWS must be used within WSProvider");return a}function ss({status:a,title:r,size:t=12}){const o=t;return a==="connecting"?e.jsx("span",{role:"img","aria-label":"Connecting",title:r||"Connecting…",className:"inline-flex items-center justify-center",style:{width:o,height:o},children:e.jsxs("svg",{width:o,height:o,viewBox:"0 0 24 24",className:"animate-spin","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#A7F3D0",strokeWidth:"3",fill:"none",opacity:"0.35"}),e.jsx("path",{d:"M22 12a10 10 0 0 0-10-10",stroke:"#34D399",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]})}):a==="connected"?e.jsx("span",{role:"img","aria-label":"Connected",title:r||"Connected",className:"inline-flex items-center justify-center",style:{width:o,height:o},children:e.jsx("svg",{width:o,height:o,viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#34D399"})})}):e.jsx("span",{role:"img","aria-label":"Disconnected",title:r||"Not connected",className:"inline-flex items-center justify-center",style:{width:o,height:o},children:e.jsxs("svg",{width:o,height:o,viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#F87171",opacity:"0.15"}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"#F87171",strokeWidth:"2",fill:"none"}),e.jsx("rect",{x:"6",y:"11",width:"12",height:"2",rx:"1",fill:"#F87171"})]})})}function as(){const a=kt(),r=w.useRef(null),t=w.useRef(null),o=a.getVideoElementRef(),s=!!(a.getMediaStream?.()||o?.srcObject),c=a.isStreaming&&a.mode==="phone"&&s;w.useEffect(()=>{const d=r.current;if(!d)return;let l=!0;const m=d.getContext("2d");if(!m)return;const u=()=>{if(l){try{if(m.clearRect(0,0,d.width,d.height),c&&o&&o.readyState>=2){const h=o.videoWidth||640,g=o.videoHeight||360,p=d.width,y=d.height,v=h/g,b=p/y;let S=0,N=0,C=h,E=g;if(v>b){const j=g*b;S=(h-j)/2,C=j}else if(v<b){const j=h/b;N=(g-j)/2,E=j}m.drawImage(o,S,N,C,E,0,0,p,y)}else m.fillStyle="rgba(148, 163, 184, 0.25)",m.fillRect(0,0,d.width,d.height),m.fillStyle="rgba(226,232,240,0.8)",m.font="10px system-ui, sans-serif",m.textAlign="center",m.textBaseline="middle",m.fillText("Camera",d.width/2,d.height/2)}catch{}t.current=requestAnimationFrame(u)}};return t.current=requestAnimationFrame(u),()=>{l=!1,t.current&&cancelAnimationFrame(t.current)}},[c,o]);const i=()=>{try{window.dispatchEvent(new CustomEvent("ndn:toggle-phone-overlay"))}catch{}};return e.jsxs("button",{type:"button",onClick:i,className:"relative inline-flex items-center gap-1 rounded-lg border border-white/15 bg-white/5 hover:bg-white/10 transition-colors shadow-sm overflow-hidden",style:{height:36},title:c?"Camera connected – click to toggle overlay":"Camera not connected",children:[e.jsx("canvas",{ref:r,width:64,height:36,className:"block"}),e.jsx("span",{className:"pr-2 text-xs text-slate-100 select-none hidden xs:inline",children:c?"Phone Cam":"No Camera"}),e.jsx("span",{className:"absolute -top-1 -right-1 text-lg pointer-events-none drop-shadow","aria-hidden":"true",children:c?"✅":"⚪"})]})}const Mr={calibration:{keywords:["calibration","calibrate","camera","score","accuracy","aim","setup"],title:"How Calibration Works",explanation:`Calibration helps our AI precisely detect where your darts land on the board. Here's how it works:

1. **D20**: Click on the 20 segment to calibrate that area
2. **D6**: Click on the 6 segment to calibrate that area
3. **D3**: Click on the 3 segment to calibrate that area
4. **D11**: Click on the 11 segment to calibrate that area
5. **Bullseye**: Click on the bullseye to calibrate the center

Each click teaches the system about your board's position and angle. After calibrating all areas, your scoring will be much more accurate!`,actions:[{id:"D20",label:"📍 Click D20",color:"bg-blue-600"},{id:"D6",label:"📍 Click D6",color:"bg-purple-600"},{id:"D3",label:"📍 Click D3",color:"bg-pink-600"},{id:"D11",label:"📍 Click D11",color:"bg-cyan-600"},{id:"Bullseye",label:"🎯 Click Bullseye",color:"bg-yellow-600"}]},scoring:{keywords:["score","points","counting","how do i score","scoring system"],title:"Dart Scoring",explanation:`In darts, each segment on the board has a value:
- Single areas: Face value (1-20)
- Double ring (outer): 2× the segment number
- Triple ring (inner): 3× the segment number
- Bullseye: 50 points
- Bull (outer bull): 25 points

For example: hitting Triple 20 = 60 points, Double 10 = 20 points`},gameplay:{keywords:["game","how to play","rules","x01","cricket","match","round"],title:"How to Play",explanation:`Nine Dart Nation supports multiple game modes:

**X01** (501, 301, 701): Start from the set score and count down to exactly 0. Final dart must be on a double.

**Cricket**: Players try to "close" numbers 15-20 and bullseye by hitting them. First to close all and have the highest score wins.

**Killer**: Players mark their "number" and try to knock out other players' lives.

Select your game mode when creating a match, and follow the on-screen instructions!`},premium:{keywords:["premium","subscription","features","upgrade","cost","paid"],title:"Premium Features",explanation:`Our Premium subscription gives you:
- Tournament creation and entry
- Advanced statistics and replays
- Priority matchmaking
- Custom profiles and themes
- Ad-free experience

Premium grants are often awarded as tournament prizes!`},connection:{keywords:["connection","disconnect","lag","latency","websocket","error","offline"],title:"Connection Issues",explanation:`If you're experiencing connection issues:
1. Check your internet connection
2. Refresh the page (Ctrl+R or Cmd+R)
3. Clear browser cache
4. Try a different browser
5. Check if the site status page shows any issues

Most connection issues resolve in seconds. Contact admin if problems persist.`},camera:{keywords:["camera","phone camera","mobile","video","pairing","connect"],title:"Camera Setup",explanation:`To use our phone camera feature:
1. Open Nine Dart Nation on your phone
2. Go to Settings > Camera Pairing
3. Scan the QR code or enter the pairing code
4. Position your phone to capture the dartboard
5. Run calibration (see calibration help for details)

Your phone will now act as a live dartboard camera!`},tournament:{keywords:["tournament","compete","bracket","prize","winner","playoffs"],title:"Tournaments",explanation:`Tournaments are competitive events where you can:
- Play against other skilled players
- Win prizes (Premium subscriptions or cash)
- Climb leaderboards
- Compete in structured brackets

Check the Tournaments tab to see upcoming events. Registration typically opens 30 minutes before start time.`}};function uo(a){const r=a.toLowerCase();for(const[t,o]of Object.entries(Mr))for(const n of o.keywords)if(r.includes(n))return{type:"explanation",title:o.title,message:o.explanation,actions:o.actions,followUp:"Do you need further assistance? I can connect you with an admin if needed."};return{type:"suggestion",title:"Need More Help?",message:`I couldn't find a specific answer to your question. Common topics I can help with:

${Object.values(Mr).map(t=>`• ${t.title}`).join(`
`)}

Or I can connect you with an admin who can help further.`,followUp:"Would you like to speak with an admin?"}}function mo(){const a=new Date().getHours();return a>=20||a<7?"20-30 minutes (off-peak hours)":a>=12&&a<14?"10-15 minutes (moderate traffic)":a>=18&&a<20?"15-20 minutes (peak hours)":"5-10 minutes"}function os({request:a,user:r,onClose:t}){const o=(()=>{try{return It()}catch{return null}})(),[n,s]=w.useState(a?.messages||[]),[c,i]=w.useState(""),[d,l]=w.useState({}),[m,u]=w.useState(!1),[h,g]=w.useState(""),p=w.useRef(null),y=w.useRef(null);w.useEffect(()=>{if(!o)return;const N=o.addListener(C=>{try{if(C?.type==="help-message"&&String(C.requestId)===String(a.id)&&s(E=>[...E,C.message]),C?.type==="help-request-updated"&&C.request?.id===a.id&&(s(C.request.messages||[]),u(!!C.request.claimedBy)),C?.type==="help-typing"&&String(C.requestId)===String(a.id)){const E=C.fromName||C.fromEmail||(C.admin?"admin":"user");l(j=>({...j,[E]:Date.now()}))}}catch{}});return()=>{N()}},[o,a?.id]);const v=()=>{if(!c.trim())return;const N=c,C={type:"help-message",requestId:a.id,message:N};try{o?.send(C)}catch{}const E={fromEmail:r?.email||null,fromName:r?.username||null,message:N,ts:Date.now(),admin:!1};s(j=>[...j,E]),i(""),m||setTimeout(()=>{const j=uo(N);if(j){const f={fromName:"AI Assistant",message:`${j.title}

${j.message}`,ts:Date.now(),admin:!0,actions:j.actions,followUp:j.followUp};s(k=>[...k,f])}},500)},b=N=>{if(!N){const E={fromName:"You",message:"No, I think I have it now. Thanks!",ts:Date.now(),admin:!1};s(j=>[...j,E]),setTimeout(()=>{const j={fromName:"AI Assistant",message:"✅ Great! Glad I could help. Feel free to reach out anytime you need assistance.",ts:Date.now(),admin:!0};s(f=>[...f,j])},300);return}const C={fromName:"You",message:"Yes, I need to speak with an admin",ts:Date.now(),admin:!1};s(E=>[...E,C]);try{o?.send({type:"help-escalate",requestId:a.id})}catch{}g(mo()),setTimeout(()=>{const E={fromName:"System",message:`⏳ Connecting you with an admin...

📊 Estimated wait time: ${h}

An admin will be with you shortly. Please stay on this chat.`,ts:Date.now(),admin:!0};s(j=>[...j,E])},500)};w.useEffect(()=>{if(p.current)try{p.current.scrollTop=p.current.scrollHeight}catch{}},[n]);const S=w.useCallback(()=>{try{o?.send({type:"help-typing",requestId:a.id,fromName:r?.username,fromEmail:r?.email,admin:!!r?.isAdmin})}catch{}y.current&&clearTimeout(y.current),y.current=window.setTimeout(()=>{l(N=>{const C={...N};return delete C[r?.username||r?.email||"me"],C})},3e3)},[o,a.id,r]);return w.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]),e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:t}),e.jsxs("div",{className:"relative w-full max-w-2xl bg-slate-900 rounded-lg shadow-xl overflow-hidden flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-slate-700 bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(_n,{className:"w-4 h-4 text-yellow-400"}),"Help Desk — ",a.username||"Anonymous"]}),m&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-emerald-600",children:"Admin Connected"})]}),e.jsx("button",{className:"px-2 py-1 rounded bg-neutral-700 hover:bg-neutral-600 text-sm",onClick:t,children:e.jsx(Or,{className:"w-4 h-4"})})]}),e.jsxs("div",{ref:p,className:"flex-1 overflow-y-auto p-3 space-y-3 bg-black/20",children:[n.map((N,C)=>e.jsx("div",{children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded ${N.admin?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-100 ml-auto":"bg-slate-700 text-slate-100"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs opacity-70 font-semibold flex items-center gap-1",children:[N.admin?e.jsx(_n,{className:"w-3 h-3"}):e.jsx(wt,{className:"w-3 h-3"}),N.fromName||N.fromEmail||(N.admin?"AI Assistant":"You")]}),e.jsx("div",{className:"text-xs opacity-50 ml-2",children:N.ts?new Date(N.ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("div",{className:"whitespace-pre-wrap break-words text-sm",children:N.message}),N.actions&&N.actions.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold opacity-80",children:"🎯 Try these calibration points:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:N.actions.map(E=>e.jsx("button",{className:`${E.color} text-white text-xs py-2 px-2 rounded font-medium hover:opacity-90 transition-opacity`,onClick:()=>{const j={fromName:"You",message:`Clicked: ${E.label}`,ts:Date.now(),admin:!1};s(f=>[...f,j]);try{o?.send({type:"help-message",requestId:a.id,message:`User clicked: ${E.id}`})}catch{}},children:E.label},E.id))})]}),N.followUp&&!m&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs opacity-80",children:N.followUp}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white text-xs py-2 px-3 rounded font-medium transition-colors",onClick:()=>b(!0),children:"✅ Yes, connect me"}),e.jsx("button",{className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white text-xs py-2 px-3 rounded font-medium transition-colors",onClick:()=>b(!1),children:"❌ No thanks"})]})]})]})},C)),Object.keys(d).length>0&&e.jsxs("div",{className:"text-xs text-slate-300 opacity-80 flex items-center gap-2",children:[e.jsxs("span",{children:[Object.keys(d).join(", ")," typing"]}),e.jsxs("span",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce"}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce delay-100"}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce delay-200"})]})]})]}),e.jsxs("div",{className:"p-3 border-t border-slate-700 bg-slate-800 flex gap-2",children:[e.jsx("input",{className:"input flex-1 text-sm",value:c,onChange:N=>{i(N.target.value),S()},onKeyDown:N=>{N.key==="Enter"&&!N.shiftKey&&(N.preventDefault(),v())},placeholder:"Ask a question (e.g., 'How does calibration work?')..."}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white",onClick:v,children:e.jsx(En,{className:"w-4 h-4"})})]})]})]})}const Ln={X01:{tolerancePx:10,requiredTargets:["SINGLE","DOUBLE","TREBLE","BULL","OUTER_BULL"],criticalZones:["D20","D1","BULLSEYE","T20","SINGLE_20"],minConfidence:80},"Double Practice":{tolerancePx:12,requiredTargets:["DOUBLE","BULL"],criticalZones:["D20","D1","D6","D17"],minConfidence:75},"Treble Practice":{tolerancePx:8,requiredTargets:["TREBLE"],criticalZones:["T20","T1","T5"],minConfidence:85},"Checkout 170":{tolerancePx:9,requiredTargets:["DOUBLE"],criticalZones:["D25","D20","D8"],minConfidence:82},"Checkout 121":{tolerancePx:9,requiredTargets:["DOUBLE"],criticalZones:["D20","D5","D1"],minConfidence:82},Cricket:{tolerancePx:15,requiredTargets:["20","19","18","17","16","15","BULL"],criticalZones:["20","15","BULL"],minConfidence:70},"American Cricket":{tolerancePx:15,requiredTargets:["20","19","18","17","16","15","BULL"],criticalZones:["20","15","BULL"],minConfidence:70},"Around the Clock":{tolerancePx:12,requiredTargets:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],criticalZones:["1","20","6","15"],minConfidence:78},Shanghai:{tolerancePx:13,requiredTargets:["1","2","3","4","5","6","7","SINGLE","DOUBLE","TREBLE"],criticalZones:["1","7","S1","D1","T1"],minConfidence:75},"High Score":{tolerancePx:14,requiredTargets:["TREBLE","DOUBLE","BULL"],criticalZones:["T20","BULL","D20"],minConfidence:72},"Low Score":{tolerancePx:11,requiredTargets:["SINGLE"],criticalZones:["1","2","3"],minConfidence:76},"Count-Up":{tolerancePx:13,requiredTargets:["SINGLE","DOUBLE","TREBLE"],criticalZones:["20","DOUBLE","TREBLE"],minConfidence:74},"Halve It":{tolerancePx:12,requiredTargets:["TREBLE","SINGLE"],criticalZones:["T20","T5","SINGLE"],minConfidence:73},"High-Low":{tolerancePx:13,requiredTargets:["SINGLE","DOUBLE","BULL"],criticalZones:["HIGH (>10)","LOW (<5)","BULL"],minConfidence:72},Killer:{tolerancePx:12,requiredTargets:["ALL_NUMBERS"],criticalZones:["RANDOM_TARGETS"],minConfidence:74},Baseball:{tolerancePx:14,requiredTargets:["1-9","SINGLE","DOUBLE","TREBLE"],criticalZones:["1","9","TRIPLE"],minConfidence:71},Golf:{tolerancePx:14,requiredTargets:["1-18","TREBLE"],criticalZones:["T1","T18"],minConfidence:71},"Tic Tac Toe":{tolerancePx:16,requiredTargets:["1-9","SINGLE"],criticalZones:["CENTER","CORNERS"],minConfidence:68},"Bob's 27":{tolerancePx:13,requiredTargets:["SINGLE","DOUBLE"],criticalZones:["1-20","BULL"],minConfidence:73},Scam:{tolerancePx:14,requiredTargets:["ALL_NUMBERS","OUTER_BULL"],criticalZones:["TARGET_NUMBER","OUTER_BULL"],minConfidence:70},Fives:{tolerancePx:14,requiredTargets:["ALL_NUMBERS","OUTER_BULL"],criticalZones:["5","10","15","20"],minConfidence:70},Sevens:{tolerancePx:14,requiredTargets:["ALL_NUMBERS","OUTER_BULL"],criticalZones:["7","14"],minConfidence:70}};function Dn(a,r){if(!r||r<0)return 0;const t=Ln[a];if(!t)return 50;if(r<=t.tolerancePx)return Math.min(100,100-r/t.tolerancePx*20);{const o=r-t.tolerancePx;return Math.max(0,50-o*2)}}function ri(a,r){if(!r)return!1;const t=Ln[a];return t?Dn(a,r)>=t.minConfidence:!0}function ho(a,r){if(!r)return{quality:"none",text:"Not calibrated"};const t=Dn(a,r);return t>=90?{quality:"excellent",text:`Excellent (${Math.round(t)}%)`}:t>=75?{quality:"good",text:`Good (${Math.round(t)}%)`}:t>=50?{quality:"fair",text:`Fair (${Math.round(t)}%)`}:{quality:"poor",text:`Poor (${Math.round(t)}%)`}}function si(a){const r=Ln[a];return!r||r.criticalZones.length===0?null:`Recalibrate focusing on: ${r.criticalZones.join(", ")}`}const fo="daviesfamily108@gmail.com";function go({user:a}){const r=(()=>{try{return It()}catch{return null}})(),[t,o]=w.useState([]),[n,s]=w.useState(""),[c,i]=w.useState(null),[d,l]=w.useState(""),[m,u]=w.useState(!1),[h,g]=w.useState([]),[p,y]=w.useState([]),[v,b]=w.useState(""),[S,N]=w.useState([]),[C,E]=w.useState({title:"Official Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:30,capacity:16,prizeType:"premium",prizeAmount:3,currency:"GBP",prizeNotes:""}),[j,f]=w.useState({reset:{},reminder:{},confirmEmail:{},changed:{}}),[k,R]=w.useState({open:!1}),[L,I]=w.useState("general"),P=a?.email?.toLowerCase()===fo,[A,O]=w.useState([]),[W,Z]=w.useState([]),[se,ae]=w.useState([]),[fe,we]=w.useState({}),[xe,je]=w.useState(null),[Ne,Oe]=w.useState([]),[G,Ve]=w.useState(null),[Q,de]=w.useState(!1),[le,He]=w.useState(1500),[Pt,it]=w.useState(0);w.useEffect(()=>{const x=()=>it(M=>M+1);return window.addEventListener("ndn:stats-updated",x),()=>window.removeEventListener("ndn:stats-updated",x)},[]);const Pe=w.useMemo(()=>ns(Ar),[Pt]),lt=Pn();w.useEffect(()=>{if(!k.open)return;function x(M){M.key==="Escape"&&R({open:!1})}return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[k.open]);const We=w.useMemo(()=>{const x=lt.errorPx??null,M=[];for(const B of Ar){const Y=Dn(B,x),J=ho(B,x);M.push({game:B,confidence:Y,qualityInfo:J})}return M},[lt.errorPx]),ct=w.useMemo(()=>{const x=[];if(Pe&&typeof Pe=="object")for(const[M,B]of Object.entries(Pe)){const Y=B;x.push({label:M,value:Y?.played||0,won:Y?.won||0})}return x},[Pe]);async function re(){try{const x={Authorization:`Bearer ${localStorage.getItem("authToken")}`},[M,B,Y]=await Promise.all([fetch("/api/admin/help-requests",{headers:x}),fetch("/api/admins",{headers:x}),fetch("/api/tournaments",{headers:x})]);if(M.ok){const J=await M.json();ae(Array.isArray(J)?J:J.requests||[])}if(B.ok){const J=await B.json();o(Array.isArray(J)?J:J.admins||[])}if(Y.ok){const J=await Y.json();g(Array.isArray(J)?J:J.tournaments||J)}}catch(x){console.error("refresh failed",x)}}async function Qe(x){try{await fetch("/api/admins/revoke",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:x})}),await re()}catch{}}async function Xe(x,M){if(x)try{await fetch("/api/admin/premium/grant",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:x,days:M})}),await re()}catch{}}async function et(x){try{await fetch("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:x})}),await re()}catch{}}async function Re(){if(d.trim())try{await fetch("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({message:d})}),l(""),await re()}catch{}}async function _e(x){try{await fetch("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({maintenance:x})}),await re()}catch{}}w.useEffect(()=>{if(!r)return;const x=r.addListener(B=>{try{if(B?.type==="help-typing"){const Y=String(B.requestId||"");if(!Y)return;we(J=>({...J,[Y]:{who:B.fromName||"someone",ts:Date.now()}}));return}if(B?.type==="help-request"){const Y=B.request;if(!Y||!Y.id)return;ae(J=>{const ne=(J||[]).filter(ge=>String(ge.id)!==String(Y.id));return[Y,...ne]});return}B?.type==="help-request-updated"&&re()}catch{}}),M=setInterval(()=>{const B=Date.now();let Y=!1;const J={...fe};for(const ne of Object.keys(J))B-J[ne].ts>3500&&(delete J[ne],Y=!0);Y&&we(J)},1500);return()=>{try{x()}catch{}clearInterval(M)}},[r]);async function ke(x){try{const M={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`};(await fetch(`/api/admin/help-requests/${encodeURIComponent(x)}/claim`,{method:"POST",headers:M,body:JSON.stringify({})})).ok&&await re()}catch{}}async function be(x){try{const M={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`};(await fetch(`/api/admin/help-requests/${encodeURIComponent(x)}/resolve`,{method:"POST",headers:M,body:JSON.stringify({})})).ok&&await re()}catch{}}async function tt(){n&&(await fetch("/api/admins/grant",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:n})}),s(""))}async function ie(){if(v.trim())try{const x={Authorization:`Bearer ${localStorage.getItem("authToken")}`},M=await fetch(`/api/admin/users/search?q=${encodeURIComponent(v)}`,{headers:x});if(M.ok){const B=await M.json();N(Array.isArray(B.users)?B.users:[])}}catch(x){console.error("Search failed:",x)}}async function Ae(x){try{await fetch("/api/admin/users/ban",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:x})}),await ie()}catch(M){console.error("Ban failed:",M)}}async function ye(x){try{await fetch("/api/admin/users/unban",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:x})}),await ie()}catch(M){console.error("Unban failed:",M)}}async function Be(){u(!0);try{const x=new Date(C.startAt).getTime(),M=await fetch("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:C.title,game:C.game,mode:C.mode,value:Number(C.value),description:C.description,startAt:x,checkinMinutes:Number(C.checkinMinutes),capacity:Number(C.capacity),requireCalibration:!!C.requireCalibration,creatorEmail:a?.email,creatorName:a?.username,requesterEmail:a?.email,official:!0,prizeType:C.prizeType,prizeAmount:Number(C.prizeAmount||0),currency:C.currency,prizeNotes:C.prizeNotes})});await re();try{const B=await M.json();B&&B.tournament&&B.tournament.id&&window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:"tournaments"}}))}catch{}}finally{u(!1)}}async function Ge(x,M){u(!0);try{await fetch("/api/admin/tournaments/winner",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({tournamentId:x,winnerEmail:M})}),await re()}finally{u(!1)}}async function nt(x){u(!0);try{await fetch("/api/admin/tournaments/mark-paid",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({tournamentId:x})}),await re()}finally{u(!1)}}async function Je(x){u(!0);try{await fetch("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({tournamentId:x})}),await re()}finally{u(!1)}}async function Ue(){u(!0);try{await fetch("/api/admin/tournaments/reseed-weekly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({})}),await re()}finally{u(!1)}}async function ce(x,M){u(!0);try{await fetch("/api/admin/wallet/withdrawals/decide",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({id:x,approve:M})}),await re()}finally{u(!1)}}async function pt(x){u(!0);try{await fetch("/api/admin/matches/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({matchId:x})}),await re()}finally{u(!1)}}async function Ye(){try{const x={Authorization:`Bearer ${localStorage.getItem("authToken")}`},M=await fetch("/api/admin/logs",{headers:x});if(M.ok){const B=await M.json();B?.ok&&Oe(B.logs||[])}}catch(x){console.error("Failed to fetch logs:",x)}}async function ve(){try{const x={Authorization:`Bearer ${localStorage.getItem("authToken")}`},M=await fetch("/api/admin/system-health",{headers:x});if(M.ok){const B=await M.json();B?.ok&&B?.health&&(Ve({database:B.health.database||!1,websocket:B.health.websocket||!1,https:B.health.https||!1,maintenance:B.health.maintenance||!1,clustering:B.health.clustering||!1,uptime:B.health.uptime||0,memory:B.health.memory||{heapUsed:0},version:B.health.version||"unknown"}),de(B.health?.clustering||!1))}}catch(x){console.error("Failed to fetch system health:",x)}}async function Me(x){u(!0);try{const B=await(await fetch("/api/admin/clustering",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({enabled:x,maxWorkers:4,capacity:le})})).json();console.log("Clustering response:",B),B?.ok?(alert(`Clustering ${x?"enabled":"disabled"} successfully. Max capacity: ${le.toLocaleString()} concurrent users. NODE_WORKERS environment variable is set to max capacity.`),await ve()):alert(`Failed: ${B?.error||B?.message||"Unknown error"}`)}catch(M){console.error("Clustering toggle failed:",M),alert("Clustering toggle failed: "+(M instanceof Error?M.message:String(M)))}finally{u(!1)}}async function Fe(x){He(x)}async function rt(){try{const x={Authorization:`Bearer ${localStorage.getItem("authToken")}`},M=await fetch("/api/admin/email-copy",{headers:x});if(M.ok){const B=await M.json();B?.ok&&f(B.copy||j)}}catch{}}w.useEffect(()=>{P&&rt()},[P]),w.useEffect(()=>{P&&(L==="general"||L==="maintenance")&&(Ye(),ve())},[P,L]);async function xt(x,M){await fetch("/api/admin/email-copy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({kind:x,...M})}),await rt()}async function dt(x,M){try{const B={Authorization:`Bearer ${localStorage.getItem("authToken")}`},J=await(await fetch(`/api/email/preview?kind=${encodeURIComponent(x)}`,{headers:B})).text();if(M){const ne=window.open();if(ne){ne.document.open(),ne.document.write(J),ne.document.close();return}}R({open:!0,kind:x,html:J})}catch{R({open:!0,kind:x,html:'<!doctype html><html><body style="font-family:sans-serif;padding:16px">Failed to load preview.</body></html>'})}}w.useEffect(()=>{if(!k.open)return;function x(M){M.key==="Escape"&&R({open:!1})}return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[k.open]);function qe({kind:x,label:M}){const Y=j?.[x==="confirm-email"?"confirmEmail":x==="changed"?"changed":x]||{title:"",intro:"",buttonLabel:""},[J,ne]=w.useState(Y.title||""),[ge,st]=w.useState(Y.intro||""),[ut,Se]=w.useState(Y.buttonLabel||"");return w.useEffect(()=>{ne(Y.title||""),st(Y.intro||""),Se(Y.buttonLabel||"")},[Y.title,Y.intro,Y.buttonLabel]),e.jsxs("div",{className:"p-2 rounded bg-black/20 space-y-2",children:[e.jsx("div",{className:"font-semibold",children:M}),e.jsx("input",{className:"input w-full",placeholder:"Title (optional)",value:J,onChange:pe=>ne(pe.target.value)}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Intro line (optional)",value:ge,onChange:pe=>st(pe.target.value)}),e.jsx("input",{className:"input w-full",placeholder:"Button label (optional)",value:ut,onChange:pe=>Se(pe.target.value)}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"btn",type:"button",onClick:()=>dt(x,!0),children:"Preview"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>dt(x),children:"Popup"}),e.jsx("button",{className:"btn",onClick:()=>xt(x,{title:J,intro:ge,buttonLabel:ut}),children:"Save"})]})]})}return P?(se.length>0&&(se.length,se.slice(0,6).map(x=>e.jsxs("div",{className:"p-2 rounded bg-black/10 border border-white/10 min-w-[220px]",children:[e.jsx("div",{className:"font-medium",children:x.username||"Anonymous"}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(x.ts||0).toLocaleTimeString()}),e.jsx("div",{className:"text-sm truncate mt-1",children:x.message}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[x.status==="open"?e.jsx("button",{className:"btn",onClick:()=>ke(x.id),children:"Claim"}):e.jsxs("span",{className:"text-xs opacity-70",children:[x.status," by ",x.claimedBy||"—"]}),e.jsx("button",{className:"btn",onClick:()=>je(x),children:"Chat"})]})]},x.id))),e.jsxs("div",{className:"space-y-4 ndn-game-shell",children:[e.jsxs("div",{className:"card p-2 rounded-xl bg-white/10 border border-white/10 flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Connection Status"}),r?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ss,{status:r.status,title:`WebSocket: ${r.status}`}),e.jsxs("span",{className:"text-xs opacity-80",children:["WS: ",r.status]})]}):e.jsx("span",{className:"text-xs opacity-70",children:"WS: unavailable"})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[e.jsx(as,{}),r&&r.reconnect&&e.jsx("button",{onClick:()=>r.reconnect(),className:"ml-1 rounded-md bg-neutral-700/60 hover:bg-neutral-600/70 px-2.5 py-1 text-xs border border-white/10",title:"Force close and recreate the WebSocket connection",children:"Recreate WS"})]})]}),P&&e.jsx(Za,{tabs:[{key:"general",label:"General"},{key:"maintenance",label:"Maintenance"},{key:"premium",label:"Premium"},{key:"tourneys",label:"Tourneys"},{key:"helpdesk",label:"Help Desk"}],active:L,onChange:x=>I(x),className:"mb-4"}),"			",L==="general"&&e.jsxs(e.Fragment,{children:[P&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Game Usage"}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(Ka,{data:ct.map(x=>({label:"",value:x.value}))}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:ct.map((x,M)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:x.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",x.value," · Won ",x.won]})]},M))})]})]}),P&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Calibration Quality Status"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Camera calibration confidence by game mode. Shows current system calibration readiness for each game."}),e.jsx("div",{className:"rounded-xl border border-amber-500/40 bg-amber-500/5 p-3",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px]",children:We.map(x=>{const M=x.confidence>=85?"bg-emerald-500/20 border-emerald-500/40 text-emerald-200":x.confidence>=70?"bg-amber-500/20 border-amber-500/40 text-amber-200":"bg-rose-500/20 border-rose-500/40 text-rose-200";return e.jsxs("div",{className:`px-2 py-2 rounded-md border ${M}`,children:[e.jsx("div",{className:"font-semibold text-xs truncate",children:x.game}),e.jsx("div",{className:"text-[10px] opacity-80 truncate",children:x.qualityInfo.quality}),e.jsxs("div",{className:"text-[10px] font-mono mt-0.5",children:[Math.round(x.confidence),"%"]})]},x.game)})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Admin to trusted users. Only the owner can perform these actions."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:n,onChange:x=>s(x.target.value)}),e.jsx("button",{className:"btn",disabled:m,onClick:tt,children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:m,onClick:()=>Qe(n),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Current Admins:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:t.map(x=>e.jsx("div",{className:"px-2 py-1 rounded bg-indigo-600/20 border border-indigo-500/40 text-sm",children:x},x))}),e.jsx("hr",{className:"border-indigo-500/20 my-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Premium Access Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Premium subscription access to users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:n,onChange:x=>s(x.target.value)}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:m||!n.trim(),onClick:()=>Xe(n,30),children:"Grant Premium"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:m,onClick:()=>et(n),children:"Revoke Premium"})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Premium grants provide 30 days of unlimited access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Announcements"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Send a message to all users. This will appear as a toast notification."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Announcement message...",value:d,onChange:x=>l(x.target.value)}),e.jsx("button",{className:"btn",disabled:m||!d.trim(),onClick:Re,children:"Send"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Search"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Search for users by email or name."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"Search users...",value:v,onChange:x=>b(x.target.value)}),e.jsx("button",{className:"btn",disabled:m,onClick:ie,children:"Search"})]}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),S.map(x=>e.jsx("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:x.name||"No name"}),e.jsx("div",{className:"opacity-70",children:x.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(x.createdAt).toLocaleDateString()]})]})},x.email))]})]}),P&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Email Templates"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Customize titles, intro lines, and button text. Previews open in a new tab or as a popup."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(qe,{kind:"reset",label:"Password reset"}),e.jsx(qe,{kind:"reminder",label:"Password reset reminder"}),e.jsx(qe,{kind:"confirm-email",label:"Confirm new email"}),e.jsx(qe,{kind:"changed",label:"Password changed notice"})]})]})]}),L==="maintenance"&&P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Management"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Ban or unban users. Use with caution."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:v,onChange:x=>b(x.target.value)}),e.jsx("button",{className:"btn",disabled:m,onClick:ie,children:"Search"})]}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),S.map(x=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:x.name||"No name"}),e.jsx("div",{className:"opacity-70",children:x.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(x.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",onClick:()=>Ae(x.email),children:"Ban"}),e.jsx("button",{className:"btn bg-green-600 hover:bg-green-700 text-xs",onClick:()=>ye(x.email),children:"Unban"})]})]},x.email))]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Withdrawals"}),e.jsxs("ul",{className:"space-y-2",children:[p.map(x=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:x.id}),e.jsxs("div",{children:[x.email," · ",x.currency," ",(x.amountCents/100).toFixed(2)]}),e.jsxs("div",{className:"opacity-70",children:[x.status," · ",new Date(x.requestedAt).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2",children:x.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:m,onClick:()=>ce(x.id,!0),children:"Approve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:m,onClick:()=>ce(x.id,!1),children:"Reject"})]})})]},x.id)),p.length===0&&e.jsx("li",{className:"opacity-60",children:"No withdrawal requests."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),G?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${G.database?"bg-emerald-600":"bg-red-600"}`,children:G.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${G.websocket?"bg-emerald-600":"bg-red-600"}`,children:G.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${G.https?"bg-emerald-600":"bg-amber-600"}`,children:G.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${G.maintenance?"bg-red-600":"bg-emerald-600"}`,children:G.maintenance?"Active":"Normal"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Clustering (Auto-Scaling)"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${Q?"bg-emerald-600":"bg-amber-600"}`,children:Q?"Enabled":"Disabled"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(G.uptime/3600),"h ",Math.floor(G.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",G.memory?Math.round(G.memory.heapUsed/1024/1024):"?","MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",G.version]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{className:"btn",onClick:ve,children:"Refresh"}),e.jsxs("button",{className:`btn ${Q?"bg-amber-600 hover:bg-amber-700":"bg-emerald-600 hover:bg-emerald-700"}`,disabled:m,onClick:()=>Me(!Q),children:[Q?"Disable":"Enable"," Clustering"]})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:ve,children:"Load Health Status"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Clustering Capacity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"font-semibold",children:"Max Concurrent Users"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>setShowCreate(!1),children:"Close"}),e.jsx("button",{className:"btn",onClick:po,disabled:!P||m,children:"Force broadcast"})]})]}),e.jsx("input",{type:"range",min:"1500",max:"50000",step:"500",value:le,onChange:x=>Fe(Number(x.target.value)),disabled:m,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",style:{background:Q?`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(le-1500)/48500*100}%, #374151 ${(le-1500)/48500*100}%, #374151 100%)`:"#374151"}}),e.jsxs("div",{className:"flex justify-between text-xs opacity-60 mt-1",children:[e.jsx("span",{children:"1.5k"}),e.jsx("span",{children:"50k"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("button",{className:`btn ${Q?"bg-amber-600 hover:bg-amber-700":"bg-emerald-600 hover:bg-emerald-700"}`,disabled:m,onClick:()=>Me(!Q),children:[Q?"Disable":"Enable"," Clustering"]})})]}),e.jsxs("div",{className:"text-xs opacity-70 mt-2 p-2 bg-white/5 rounded",children:["💡 Clustering enables auto-scaling with capacity up to ",le.toLocaleString()," concurrent users. Adjust the slider to set maximum capacity. NODE_WORKERS environment variable is set to handle the configured load behind a reverse proxy."]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"User Reports"}),e.jsxs("ul",{className:"space-y-2",children:[W.map(x=>e.jsx("li",{className:"p-2 rounded bg-black/20 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:x.id}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:x.reporter})," → ",e.jsx("span",{className:"font-semibold",children:x.offender})," · ",new Date(x.ts).toLocaleString()]}),e.jsxs("div",{className:"opacity-80",children:["Reason: ",x.reason]}),x.messageId&&e.jsxs("div",{className:"opacity-60 text-xs",children:["Message ID: ",x.messageId]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${x.status==="open"?"bg-amber-600":"bg-emerald-600"}`,children:x.status}),x.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:m,onClick:async()=>{await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({id:x.id,action:"resolved"})}),await re()},children:"Resolve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:m,onClick:async()=>{const M=prompt("Enter notes for action taken (e.g., warning, block):")||"";await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({id:x.id,action:"actioned",notes:M})}),await re()},children:"Action"})]})]})]})},x.id)),W.length===0&&e.jsx("li",{className:"opacity-60",children:"No reports."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),G?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${G.database?"bg-emerald-600":"bg-red-600"}`,children:G.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${G.websocket?"bg-emerald-600":"bg-red-600"}`,children:G.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${G.https?"bg-emerald-600":"bg-amber-600"}`,children:G.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${G.maintenance?"bg-red-600":"bg-emerald-600"}`,children:G.maintenance?"Active":"Normal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(G.uptime/3600),"h ",Math.floor(G.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",Math.round(G.memory.heapUsed/1024/1024),"MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",G.version]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:ve,children:"Refresh"})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:ve,children:"Load Health Status"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Open Matches"}),e.jsxs("ul",{className:"space-y-1",children:[(c?.matches||[]).map(x=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs",children:x.id}),e.jsx("span",{className:"opacity-80",children:x.creatorName}),e.jsxs("span",{className:"opacity-60",children:[x.game," ",x.mode==="firstto"?"FT":"BO"," ",x.value," ",x.game==="X01"?`/${x.startingScore}`:""]})]}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:m,onClick:()=>pt(x.id),children:"Remove"})]},x.id)),(!c?.matches||c.matches.length===0)&&e.jsx("li",{className:"text-sm opacity-60",children:"No open matches."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Dangerous Operations"}),e.jsx("div",{className:"text-sm opacity-80 mb-3 text-red-400",children:"⚠️ These operations can cause data loss or service disruption. Use with extreme caution."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"Tournament Deletion"}),e.jsxs("ul",{className:"space-y-2",children:[h.map(x=>e.jsxs("li",{className:"p-2 rounded bg-red-900/20 border border-red-500/40 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:x.title}),e.jsx("div",{className:"opacity-70",children:x.status})]}),e.jsxs("div",{className:"opacity-80",children:[x.game," · ",x.mode==="firstto"?"FT":"BO"," ",x.value]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",disabled:m,onClick:()=>Je(x.id),children:"Delete Tournament"})})]},x.id)),h.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"System Maintenance"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"p-3 rounded bg-red-900/20 border border-red-500/40",children:[e.jsx("div",{className:"font-semibold text-red-400 mb-2",children:"Maintenance Mode"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Put the entire site into maintenance mode. Users won't be able to access games or create matches."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${c?.maintenance?"bg-red-600":"bg-green-600"}`,children:c?.maintenance?"MAINTENANCE ACTIVE":"NORMAL OPERATION"}),e.jsx("button",{className:`btn ${c?.maintenance?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:m,onClick:()=>_e(!c?.maintenance),children:c?.maintenance?"Disable":"Enable"})]})]})})]})]})]}),xe&&e.jsx(os,{request:xe,user:{email:a?.email,username:a?.username,isAdmin:!0},onClose:()=>je(null)})]}),L==="premium"&&P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Subscription Grants"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke premium subscriptions for users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:n,onChange:x=>s(x.target.value)}),e.jsx("button",{className:"btn",disabled:m||!n.trim(),onClick:()=>Xe(n,30),children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:m,onClick:()=>et(n),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Premium users get 30 days of access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Users who have won premium through tournaments."}),e.jsxs("div",{className:"space-y-2",children:[A.map(x=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:x.name||"No name"}),e.jsx("div",{className:"opacity-70",children:x.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Expires ",new Date(x.expiresAt).toLocaleDateString()]})]}),e.jsx("div",{className:"flex gap-2",children:x.expired?e.jsx("span",{className:"px-2 py-1 rounded bg-amber-600 text-xs",children:"Premium Expired"}):e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Premium Active"})})]},x.email)),A.length===0&&e.jsx("div",{className:"opacity-60",children:"No premium winners."})]})]})]}),L==="tourneys"&&P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Create Official Tournament"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Set up a new official tournament with custom rules, timing, and prizes."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"input w-full",placeholder:"Tournament Title",value:C.title,onChange:x=>E(M=>({...M,title:x.target.value}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("select",{className:"input",value:C.game,onChange:x=>E(M=>({...M,game:x.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low"].map(x=>e.jsx("option",{value:x,children:x},x))}),e.jsxs("select",{className:"input",value:C.mode,onChange:x=>E(M=>({...M,mode:x.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]}),e.jsx("input",{className:"input",type:"number",min:1,value:C.value,onChange:x=>E(M=>({...M,value:Number(x.target.value)}))})]}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Description",value:C.description,onChange:x=>E(M=>({...M,description:x.target.value}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"input",type:"datetime-local",value:C.startAt,onChange:x=>E(M=>({...M,startAt:x.target.value}))}),e.jsx("input",{className:"input",type:"number",min:0,placeholder:"Checkin minutes",value:C.checkinMinutes,onChange:x=>E(M=>({...M,checkinMinutes:Number(x.target.value)}))})]}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,placeholder:"Capacity",value:C.capacity,onChange:x=>E(M=>({...M,capacity:Number(x.target.value)}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[e.jsxs("select",{className:"input",value:C.prizeType,onChange:x=>{const M=x.target.value;E(B=>({...B,prizeType:M,prizeAmount:M==="premium"?3:0}))},children:[e.jsx("option",{value:"premium",children:"PREMIUM"}),e.jsx("option",{value:"cash",children:"Cash"})]}),C.prizeType==="premium"?e.jsxs("select",{className:"input",value:C.prizeAmount,onChange:x=>E(M=>({...M,prizeAmount:Number(x.target.value)})),children:[e.jsx("option",{value:1,children:"1 month"}),e.jsx("option",{value:3,children:"3 months"})]}):e.jsx("input",{className:"input",type:"number",min:0,value:C.prizeAmount,onChange:x=>E(M=>({...M,prizeAmount:Number(x.target.value)}))}),e.jsxs("select",{className:"input",disabled:C.prizeType!=="cash",value:C.currency,onChange:x=>E(M=>({...M,currency:x.target.value})),children:[e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"CAD",children:"CAD"}),e.jsx("option",{value:"AUD",children:"AUD"})]})]}),e.jsx("input",{className:"input w-full",placeholder:"Prize notes (optional)",value:C.prizeNotes,onChange:x=>E(M=>({...M,prizeNotes:x.target.value}))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:m,onClick:Be,children:"Create Tournament"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Tournament Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Users who have won premium prizes in tournaments. Grant them access here."}),e.jsxs("div",{className:"space-y-2",children:[h.filter(x=>x.status==="completed"&&x.winnerEmail&&x.prizeType==="premium").map(x=>{const M=A.find(Y=>Y.email===x.winnerEmail),B=M&&!M.expired;return e.jsxs("div",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:x.title}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(x.startAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:x.winnerEmail}),e.jsxs("div",{className:"text-xs opacity-70",children:["Prize: ",x.prizeAmount," month",x.prizeAmount>1?"s":""," PREMIUM"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:B?e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"✓ Access Granted"}):e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-xs",disabled:m,onClick:()=>Xe(x.winnerEmail,x.prizeAmount*30),children:"Grant Access"})})]})]},x.id)}),h.filter(x=>x.status==="completed"&&x.winnerEmail&&x.prizeType==="premium").length===0&&e.jsx("div",{className:"text-center py-4 text-sm opacity-60",children:"No completed premium tournaments."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Manage Tournaments"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"View and manage all tournaments. Set winners or mark payouts."}),e.jsxs("ul",{className:"space-y-2",children:[h.map(x=>e.jsxs("li",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:x.title}),e.jsxs("div",{className:"opacity-80",children:[x.game," · ",x.mode==="firstto"?"First to":"Best of"," ",x.value]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-semibold ${x.status==="scheduled"?"bg-blue-600":x.status==="running"?"bg-green-600":x.status==="completed"?"bg-purple-600":"bg-gray-600"}`,children:x.status})]}),e.jsxs("div",{className:"text-xs opacity-70 mb-2",children:["Start: ",new Date(x.startAt).toLocaleString()," · Capacity: ",x.capacity]}),x.prize&&e.jsxs("div",{className:"text-xs mb-2",children:["Prize: ",x.prizeType==="cash"&&x.prizeAmount?`${x.currency||"USD"} ${x.prizeAmount}`:`${x.prizeAmount||3} month${(x.prizeAmount||3)>1?"s":""} PREMIUM`,x.prizeType==="cash"&&x.status==="completed"&&x.payoutStatus&&e.jsx("span",{className:`ml-2 px-1.5 py-0.5 rounded ${x.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:x.payoutStatus})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn text-xs",disabled:m||x.status!=="scheduled",onClick:()=>Ge(x.id,prompt("Winner email?")||""),children:"Set Winner"}),x.prizeType==="cash"&&x.status==="completed"&&x.payoutStatus!=="paid"&&e.jsx("button",{className:"btn text-xs",disabled:m,onClick:()=>nt(x.id),children:"Mark Paid"}),e.jsx("button",{className:"btn text-xs",disabled:m,onClick:()=>Ue(),children:"Reseed"})]})]},x.id)),h.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]})]}),L==="helpdesk"&&P&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Helpdesk Requests"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Incoming requests from users who asked to speak with an admin. Claim to take over the chat."}),se.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No open requests."}):e.jsx("div",{className:"space-y-2",children:se.map(x=>e.jsxs("div",{className:"p-2 rounded bg-black/10 border border-white/10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:x.username||"Anonymous"}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(x.ts||0).toLocaleString()}),e.jsx("div",{className:"text-sm mt-1",children:x.message}),fe[x.id]&&e.jsxs("div",{className:"text-xs text-amber-300 mt-1",children:[fe[x.id].who," typing..."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x.status==="open"?e.jsx("button",{className:"btn",onClick:()=>ke(x.id),children:"Claim"}):e.jsxs("span",{className:"text-xs opacity-70",children:[x.status," by ",x.claimedBy||"—"]}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>be(x.id),children:"Resolve"}),e.jsx("button",{className:"btn",onClick:()=>je(x),children:"Chat"})]})]},x.id))})]})}),k.open&&e.jsxs("div",{className:"fixed inset-0 z-[1000]",onClick:()=>R({open:!1}),children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsx("div",{className:"absolute inset-0 p-4 md:p-8 overflow-auto flex items-start md:items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-3xl bg-[#0b1020] rounded-2xl border border-indigo-500/40 shadow-2xl",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20",children:[e.jsxs("div",{className:"font-semibold",children:["Preview: ",k.kind]}),e.jsx("button",{className:"btn",onClick:()=>R({open:!1}),children:"Close"})]}),e.jsx("div",{className:"p-0 bg-black/30",children:e.jsx("iframe",{title:"Email Preview",style:{width:"100%",height:"70vh",border:"0",background:"transparent"},srcDoc:k.html||""})}),e.jsx("div",{className:"px-4 py-3 border-t border-indigo-500/20 text-xs opacity-70",children:"Click outside this panel or press Esc to close."})]})})]})]})):e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin"}),e.jsx("div",{className:"text-sm opacity-80",children:"You don’t have permission to manage admins."})]})}async function po(){setLoading(!0);try{const a={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`};(await fetch("/api/admin/tournaments/broadcast",{method:"POST",headers:a})).ok?toast("Tournaments broadcast triggered",{type:"success"}):toast("Broadcast failed",{type:"error"})}catch{toast("Broadcast request failed",{type:"error"})}finally{setLoading(!1)}}function xo({user:a}){const{favoriteDouble:r,callerEnabled:t,callerVoice:o,callerVolume:n,speakCheckoutOnly:s,avgMode:c,autoStartOffline:i,rememberLastOffline:d,reducedMotion:l,compactHeader:m,allowSpectate:u,cameraScale:h,cameraAspect:g,cameraFitMode:p,autoscoreProvider:y,autoscoreWsUrl:v,autoCommitMode:b,calibrationGuide:S,preferredCameraId:N,preferredCameraLabel:C,cameraEnabled:E,offlineLayout:j,textSize:f,boxSize:k,setFavoriteDouble:R,setCallerEnabled:L,setCallerVoice:I,setCallerVolume:P,setSpeakCheckoutOnly:A,setAvgMode:O,setAutoStartOffline:W,setRememberLastOffline:Z,setReducedMotion:se,setCompactHeader:ae,setAllowSpectate:fe,setCameraScale:we,setCameraAspect:xe,setCameraFitMode:je,setAutoscoreProvider:Ne,setAutoscoreWsUrl:Oe,setAutoCommitMode:G,setCalibrationGuide:Ve,setPreferredCamera:Q,setCameraEnabled:de,setOfflineLayout:le,setTextSize:He,setBoxSize:Pt,dartTimerEnabled:it,dartTimerSeconds:Pe,setDartTimerEnabled:lt,setDartTimerSeconds:We,x01DoubleIn:ct,setX01DoubleIn:re}=An(),[Qe,Xe]=w.useState([{key:"first180",label:"First 180",unlocked:!1,icon:"🎯",desc:"Score 180 in a match."},{key:"hundredGames",label:"100 Games Played",unlocked:!1,icon:"🏅",desc:"Play 100 games."},{key:"tournamentWin",label:"Tournament Winner",unlocked:!1,icon:"🥇",desc:"Win a tournament."},{key:"bestLeg",label:"Best Leg",unlocked:!1,icon:"⚡",desc:"Finish a leg in 12 darts or less."},{key:"comeback",label:"Comeback",unlocked:!1,icon:"🔥",desc:"Win after trailing by 3 legs."}]);w.useEffect(()=>{const T=a?.username||"";T&&Xe(F=>F.map(te=>({...te,unlocked:!!localStorage.getItem(`ndn:achieve:${te.key}:${T}`)})))},[a?.username]);const[et,Re]=w.useState(!1),[_e,ke]=w.useState(""),[be,tt]=w.useState(""),[ie,Ae]=w.useState(""),[ye,Be]=w.useState(""),[Ge,nt]=w.useState(""),[Je,Ue]=w.useState(!0),[ce,pt]=w.useState(null),[Ye,ve]=w.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[Me,Fe]=w.useState("");w.useEffect(()=>{const T=a?.username||"";if(T)try{ke(localStorage.getItem(`ndn:bio:favPlayer:${T}`)||""),tt(localStorage.getItem(`ndn:bio:favTeam:${T}`)||""),Ae(localStorage.getItem(`ndn:bio:favDarts:${T}`)||""),Be(localStorage.getItem(`ndn:bio:bio:${T}`)||""),nt(localStorage.getItem(`ndn:bio:profilePhoto:${T}`)||""),Ue(localStorage.getItem(`ndn:settings:allowAnalytics:${T}`)!=="false")}catch{}},[a?.username]),w.useEffect(()=>{a?.email&&ze(`/api/subscription?email=${encodeURIComponent(a.email)}`).then(T=>T.json()).then(pt).catch(()=>{})},[a?.email]);const rt=()=>{const T=a?.username||"";if(T)try{localStorage.setItem(`ndn:bio:favPlayer:${T}`,_e),localStorage.setItem(`ndn:bio:favTeam:${T}`,be),localStorage.setItem(`ndn:bio:favDarts:${T}`,ie),localStorage.setItem(`ndn:bio:bio:${T}`,ye),localStorage.setItem(`ndn:bio:profilePhoto:${T}`,Ge);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:T,avatar:Ge}}))}catch{}localStorage.setItem(`ndn:settings:allowAnalytics:${T}`,Je.toString()),Re(!1)}catch{}},xt=T=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:T}}))}catch(F){console.error("Navigation failed:",F)}},dt=T=>{const F=T.toLowerCase();return F.includes("username")||F.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:F.includes("premium")||F.includes("upgrade")||F.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:F.includes("calibrat")||F.includes("camera")||F.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:F.includes("voice")||F.includes("caller")||F.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:F.includes("friend")||F.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:F.includes("stat")||F.includes("score")||F.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:F.includes("setting")||F.includes("customiz")||F.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:F.includes("tournament")||F.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:F.includes("help")||F.includes("support")||F.includes("faq")?{text:"You're already in the help section! Check the Support section above for more resources.",links:[{text:"Scroll to Support",tab:"settings"}]}:F.includes("how to play")||F.includes("game")||F.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},qe=()=>{if(!Me.trim())return;const T=Me.toLowerCase();ve(te=>[...te,{text:Me,isUser:!0}]),Fe("");const F=dt(T);setTimeout(()=>{ve(te=>[...te,{text:F,isUser:!1}])},500)},[x,M]=w.useState(""),[B,Y]=w.useState(!1),[J,ne]=w.useState(""),[ge,st]=w.useState([]);w.useEffect(()=>{const T=()=>{const F=speechSynthesis.getVoices();st(F.filter(te=>te.lang.startsWith("en")))};T(),speechSynthesis.onvoiceschanged=T},[]);const[ut,Se]=w.useState(!1),[pe,Rt]=w.useState(null),at=({label:T,icon:F,pill:te,color:Le})=>e.jsxs("button",{onClick:()=>Rt(pe===te?null:te),type:"button",className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] bg-gradient-to-r ${Le} text-white flex items-center gap-2`,children:[e.jsx(F,{className:"w-4 h-4"})," ",T,e.jsx(ps,{className:`w-4 h-4 transition-transform ${pe===te?"rotate-180":""}`})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx(at,{label:"User Info",icon:wt,pill:"user",color:"from-indigo-500 to-fuchsia-500 shadow-indigo-500/30"})})}),pe==="user"&&e.jsx("div",{className:"p-6 rounded-2xl border border-white/10 bg-white/[0.02] animate-in fade-in duration-200 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-red-100",children:[e.jsx(wt,{className:"w-5 h-5"})," Account"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:logout")),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Logout"}),e.jsx("button",{onClick:()=>Se(!0),className:"px-4 py-2 bg-slate-700 hover:bg-slate-800 text-white rounded-lg font-medium transition-colors",children:"Highlights"})]}),e.jsxs("div",{className:"border-t border-red-500/20 pt-3",children:[e.jsxs("div",{className:"font-medium mb-2 text-red-100",children:["Change Username (",(()=>{const T=a?.usernameChangeCount||0;return T<2?`${2-T} free changes remaining`:"£2 per change"})(),")"]}),e.jsx("div",{className:"text-sm text-red-100 mb-2",children:"You can change your username up to 2 times for free. Additional changes cost £2 each."}),a?.usernameChangeCount>=2&&!x.trim()?e.jsx("div",{className:"text-amber-400 text-sm mb-2",children:"⚠️ Additional username changes cost £2"}):null,e.jsx("input",{className:"input w-full mb-2",type:"text",placeholder:"New username",value:x,onChange:T=>M(T.target.value),disabled:B}),J&&e.jsx("div",{className:"text-red-400 text-sm mb-2",children:J}),e.jsx("button",{onClick:async()=>{if(ne(""),!x.trim()){ne("Username required");return}if(x.length<3||x.length>20){ne("Username must be 3-20 characters");return}(a?.usernameChangeCount||0)<2?(localStorage.setItem("pendingUsernameChange",x.trim()),window.location.href="/?username-change=free"):window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02"},disabled:B||!x.trim(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:B?"Processing...":(a?.usernameChangeCount||0)<2?"Change Username (FREE)":"Change Username (£2)"})]})]})]})}),ce&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-green-100",children:[e.jsx(mt,{className:"w-5 h-5"})," Premium"]}),e.jsxs("div",{className:"space-y-3 text-sm text-green-100",children:[e.jsxs("div",{children:["Status: ",e.jsx("span",{className:ce?.status==="active"?"text-green-400":"text-yellow-400",children:ce?.status==="active"?"✓ Active":"Not Active"})]}),ce?.status==="active"&&ce?.nextBillingDate&&e.jsxs("div",{children:["Next Billing: ",new Date(ce.nextBillingDate).toLocaleDateString()]}),ce?.source==="tournament"&&ce?.status==="active"&&e.jsx("button",{onClick:()=>window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02",className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-medium transition-colors text-xs",children:"Cancel Subscription"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-cyan-100",children:[e.jsx(vn,{className:"w-5 h-5"})," Profile Photo"]}),e.jsx("input",{type:"file",accept:"image/*",onChange:T=>{const F=T.target.files?.[0];if(F){const te=new FileReader;te.onload=()=>nt(te.result),te.readAsDataURL(F)}},className:"w-full text-xs text-slate-100"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-purple-100",children:[e.jsx(Ie,{className:"w-5 h-5"})," Online & Socials"]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowSpectate",checked:u,onChange:T=>fe(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowSpectate",className:"text-sm text-purple-100",children:"Allow spectators"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-orange-500/40 bg-orange-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-orange-100",children:[e.jsx(mt,{className:"w-5 h-5"})," Data & Privacy"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowAnalytics",checked:Je,onChange:T=>Ue(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowAnalytics",className:"text-sm text-orange-100",children:"Allow analytics"})]}),e.jsx("button",{onClick:()=>{const T={achievements:Qe,bio:{favPlayer:_e,favTeam:be,favDarts:ie,bio:ye}},F=new Blob([JSON.stringify(T,null,2)],{type:"application/json"}),te=URL.createObjectURL(F),Le=document.createElement("a");Le.href=te,Le.download=`my-data-${new Date().toISOString().split("T")[0]}.json`,Le.click(),URL.revokeObjectURL(te)},className:"btn bg-orange-600 hover:bg-orange-700 w-full",children:"Export My Data"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5 text-red-400"})," Privacy & Copyright"]}),e.jsx("div",{className:"space-y-3 text-sm text-slate-300",children:e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-red-300 mb-2",children:"⚠️ Legal Notice"}),e.jsxs("p",{className:"mb-2 text-xs",children:[e.jsx("strong",{children:"Copyright:"})," All content is protected by copyright law."]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Privacy:"})," Your data is protected and unauthorized access is prohibited."]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-yellow-100",children:[e.jsx(mt,{className:"w-5 h-5"})," Blocked Users"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-yellow-100",children:"Manage players you've blocked from contacting you."}),e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:open-blocklist")),className:"btn bg-yellow-600 hover:bg-yellow-700 w-full text-sm",children:"View Blocked Users"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-blue-100",children:[e.jsx(Ie,{className:"w-5 h-5"})," Contact & Support"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"📧 Email Support"}),e.jsx("a",{href:"https://ninedartnation.com/help",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"❓ Help Center"}),e.jsx("a",{href:"https://ninedartnation.com/faq",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"📋 FAQ"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-red-100",children:[e.jsx(mt,{className:"w-5 h-5"})," Delete Account"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3 text-xs text-red-200",children:[e.jsx("p",{className:"font-semibold mb-1",children:"⚠️ Warning"}),e.jsx("p",{children:"Deleting your account is permanent and cannot be undone. All your stats, achievements, and data will be erased."})]}),e.jsx("button",{onClick:()=>{window.confirm(`Are you absolutely sure you want to delete your account? This action cannot be undone.

All your stats, achievements, and data will be permanently erased.`)&&window.confirm("This is your final warning. Click OK to permanently delete your account.")&&window.dispatchEvent(new CustomEvent("ndn:delete-account"))},className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Permanently Delete Account"})]})]})})]})}),e.jsx("div",{className:"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx(at,{label:"Calibration",icon:yn,pill:"calibration",color:"from-purple-500 to-pink-500 shadow-purple-500/30"})})}),pe==="calibration"&&e.jsx("div",{className:"p-6 rounded-2xl border border-white/10 bg-white/[0.02] animate-in fade-in duration-200 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(yn,{className:"w-5 h-5 text-blue-400"})," Camera & Vision"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled",checked:E,onChange:T=>de(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraEnabled",className:"text-sm",children:"Enable camera"})]}),E&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"cameraScale",className:"block text-sm mb-2",children:["Scale: ",h?.toFixed(2)]}),e.jsx("input",{type:"range",id:"cameraScale",min:"0.5",max:"3",step:"0.1",value:h||1,onChange:T=>we(parseFloat(T.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cameraAspect",className:"block text-sm mb-2",children:"Aspect Ratio"}),e.jsxs("select",{id:"cameraAspect",value:g||"wide",onChange:T=>xe(T.target.value),className:"input w-full",children:[e.jsx("option",{value:"wide",children:"Wide (16:9)"}),e.jsx("option",{value:"square",children:"Square (1:1)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cameraFitMode",className:"block text-sm mb-2",children:"Fit Mode"}),e.jsxs("select",{id:"cameraFitMode",value:p||"fit",onChange:T=>je(T.target.value),className:"input w-full",children:[e.jsx("option",{value:"fill",children:"Fill (crop)"}),e.jsx("option",{value:"fit",children:"Fit (letterbox)"})]})]}),e.jsx("button",{onClick:()=>{},className:"btn bg-indigo-600 hover:bg-indigo-700 w-full",children:"Calibration Guide"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"autoscoreProvider",className:"block text-sm mb-2",children:"Auto-score Provider"}),e.jsxs("select",{id:"autoscoreProvider",value:y||"manual",onChange:T=>Ne(T.target.value),className:"input w-full",children:[e.jsx("option",{value:"manual",children:"Manual Scoring"}),e.jsx("option",{value:"built-in",children:"Built-in Vision"}),e.jsx("option",{value:"external-ws",children:"External (WebSocket)"})]})]}),y==="external-ws"&&e.jsx("input",{type:"text",placeholder:"WebSocket URL",value:v||"",onChange:T=>Oe(T.target.value),className:"input w-full text-xs"}),y!=="manual"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"autoCommitMode",className:"block text-sm mb-2",children:"Turn Advance"}),e.jsxs("select",{id:"autoCommitMode",value:b||"wait-for-clear",onChange:T=>G(T.target.value),className:"input w-full",children:[e.jsx("option",{value:"wait-for-clear",children:"Wait for darts to be removed"}),e.jsx("option",{value:"immediate",children:"Advance immediately after 3 darts/bust"})]}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Waiting prevents the turn from rotating until you clear the board (or 6.5s pass)."})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ms,{className:"w-5 h-5 text-purple-400"})," Audio & Voice"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"callerEnabled",checked:t,onChange:T=>L(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"callerEnabled",className:"text-sm",children:"Enable voice caller"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"callerVoice",className:"block text-sm mb-2",children:"Voice"}),e.jsxs("select",{id:"callerVoice",value:o||"",onChange:T=>I(T.target.value),className:"input w-full text-xs",children:[e.jsx("option",{value:"",children:"Default"}),ge.map((T,F)=>e.jsx("option",{value:T.voiceURI,children:T.name},F))]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"callerVolume",className:"block text-sm mb-2",children:["Volume: ",Math.round((n||1)*100),"%"]}),e.jsx("input",{type:"range",id:"callerVolume",min:"0",max:"1",step:"0.1",value:n||1,onChange:T=>P(parseFloat(T.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"speakCheckoutOnly",checked:s,onChange:T=>A(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"speakCheckoutOnly",className:"text-sm",children:"Only speak checkout scores"})]}),e.jsx("button",{onClick:()=>{const T=new SpeechSynthesisUtterance("Test voice. 180!");T.voice=ge.find(F=>F.voiceURI===o)||null,T.volume=n||1,speechSynthesis.cancel(),speechSynthesis.speak(T)},className:"btn bg-purple-600 hover:bg-purple-700 w-full",children:"Test Voice"})]})]})]})})]})}),e.jsx("div",{className:"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx(at,{label:"Settings",icon:kn,pill:"settings",color:"from-cyan-500 to-blue-500 shadow-cyan-500/30"})})}),pe==="settings"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(wt,{className:"w-5 h-5 text-brand-400"})," Profile Bio"]}),et?e.jsxs("button",{onClick:rt,className:"flex items-center gap-2 px-3 py-1 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400 text-sm transition-colors",children:[e.jsx(fs,{className:"w-4 h-4"})," Save"]}):e.jsxs("button",{onClick:()=>Re(!0),className:"flex items-center gap-2 px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400 text-sm transition-colors",children:[e.jsx(hs,{className:"w-4 h-4"})," Edit"]})]}),e.jsx("div",{className:"space-y-3",children:et?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Player"}),e.jsx("input",{type:"text",value:_e,onChange:T=>ke(T.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Team"}),e.jsx("input",{type:"text",value:be,onChange:T=>tt(T.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Darts"}),e.jsx("input",{type:"text",value:ie,onChange:T=>Ae(T.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Bio / Quote"}),e.jsx("textarea",{value:ye,onChange:T=>Be(T.target.value),rows:3,className:"input w-full"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Favorite Player: ",e.jsx("span",{className:"text-brand-300",children:_e||"Not set"})]}),e.jsxs("div",{children:["Favorite Team: ",e.jsx("span",{className:"text-brand-300",children:be||"Not set"})]}),e.jsxs("div",{children:["Favorite Darts: ",e.jsx("span",{className:"text-brand-300",children:ie||"Not set"})]}),e.jsxs("div",{children:["Bio: ",e.jsx("span",{className:"text-brand-300",children:ye||"No bio set"})]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5 text-green-400"})," Game Preferences"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"dartTimerEnabled",checked:!!it,onChange:T=>lt(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"dartTimerEnabled",className:"text-sm",children:"Enable per-dart throw timer"})]}),it&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Time per throw: ",Pe?Math.round(Pe):0,"s"]}),e.jsx("input",{type:"range",min:"3",max:"30",value:Pe||10,onChange:T=>We(parseInt(T.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"When the timer reaches zero, the dart is recorded as a miss and advances to the next throw."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"favoriteDouble",className:"block text-sm mb-2",children:"Favorite Finish Double"}),e.jsxs("select",{id:"favoriteDouble",value:r,onChange:T=>R(T.target.value),className:"input w-full",children:[e.jsx("option",{value:"any",children:"Any Double"}),e.jsx("option",{value:"D20",children:"Double 20"}),e.jsx("option",{value:"D10",children:"Double 10"}),e.jsx("option",{value:"D5",children:"Double 5"}),e.jsx("option",{value:"D1",children:"Double 1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"avgMode",className:"block text-sm mb-2",children:"Average Display Mode"}),e.jsxs("select",{id:"avgMode",value:c,onChange:T=>O(T.target.value),className:"input w-full",children:[e.jsx("option",{value:"all-time",children:"All Time Average"}),e.jsx("option",{value:"24h",children:"24 Hour Average"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"x01DoubleIn",checked:!!ct,onChange:T=>re(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"x01DoubleIn",className:"text-sm",children:"Require Double-In for X01"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-pink-500/40 bg-pink-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(vn,{className:"w-5 h-5 text-pink-400"})," UI & Accessibility"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"autoStartOffline",checked:i,onChange:T=>W(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoStartOffline",className:"text-sm",children:"Auto-start offline games"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"rememberLastOffline",checked:d,onChange:T=>Z(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"rememberLastOffline",className:"text-sm",children:"Remember last offline game settings"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"offlineLayout",className:"block text-sm mb-2",children:"Offline Layout"}),e.jsxs("select",{id:"offlineLayout",value:j||"classic",onChange:T=>le(T.target.value),className:"input w-full",children:[e.jsx("option",{value:"classic",children:"Classic Layout"}),e.jsx("option",{value:"modern",children:"Modern Layout"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"reducedMotion",checked:l,onChange:T=>se(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"reducedMotion",className:"text-sm",children:"Reduce motion/animations"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"compactHeader",checked:m,onChange:T=>ae(T.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"compactHeader",className:"text-sm",children:"Compact header"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(wn,{className:"w-5 h-5 text-blue-400"})," Support & Help"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm opacity-80",children:"Need help? Contact us via email:"}),e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"btn bg-blue-600 hover:bg-blue-700 w-full text-xs",children:"Email Support"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-cyan-400"})," Help Assistant"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:Ye.map((T,F)=>e.jsx("div",{className:`${T.isUser?"text-right":""}`,children:e.jsx("div",{className:`inline-block max-w-xs px-3 py-2 rounded-lg text-sm ${T.isUser?"bg-indigo-600 text-white":"bg-white/10 text-slate-100"}`,children:typeof T.text=="string"?T.text:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:T.text.text}),T.text.links&&e.jsx("div",{className:"mt-2 space-y-1",children:T.text.links.map((te,Le)=>e.jsx("button",{onClick:()=>xt(te.tab),className:"block w-full text-left text-xs px-2 py-1 bg-white/20 hover:bg-white/30 rounded transition",children:te.text},Le))})]})})},F))}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("input",{type:"text",value:Me,onChange:T=>Fe(T.target.value),onKeyPress:T=>T.key==="Enter"&&qe(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:qe,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(En,{className:"w-4 h-4"})})]})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(wn,{className:"w-5 h-5 text-yellow-400"})," Achievements & Badges"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Qe.map(T=>e.jsxs("div",{className:`p-3 rounded-lg border ${T.unlocked?"border-yellow-500/40 bg-yellow-500/10":"border-white/10 bg-white/5"}`,title:T.desc,children:[e.jsx("div",{className:"text-lg",children:T.icon}),e.jsx("div",{className:"text-xs font-semibold mt-1",children:T.label}),e.jsx("div",{className:"text-[10px] opacity-70",children:T.unlocked?"✓ Unlocked":"Locked"})]},T.key))})]})})]})}const bo={};function yo({onAuth:a}){const[r,t]=w.useState("signin"),[o,n]=w.useState(""),[s,c]=w.useState(""),[i,d]=w.useState(""),[l,m]=w.useState(""),[u,h]=w.useState(""),[g,p]=w.useState(!1),[y,v]=w.useState(!1),b="http://localhost:8787";async function S(j){j.preventDefault(),h(""),v(!0);try{me(()=>import("./Home-irkAiYpD.js"),__vite__mapDeps([0,1,2,3])),me(()=>import("./OnlinePlay-DTlubsKN.js"),__vite__mapDeps([4,1,2,5,6,7,8,9])),me(()=>import("./OfflinePlay-7y_YoV87.js"),__vite__mapDeps([10,1,2,8,6,5,7,11])),me(()=>import("./Scoreboard-l-TGftja.js"),__vite__mapDeps([12,5,3,11,1,2,7])),me(()=>import("./StatsPanel-RyyJrZuP.js"),__vite__mapDeps([13,5,3,1,2]))}catch{}if(!s||!i){h("Username and password required."),v(!1);return}try{console.time("Auth:signIn roundtrip");const f=await fetch(`${b}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s.includes("@")?{email:s,password:i}:{username:s,password:i})}),k=await f.json();console.timeEnd("Auth:signIn roundtrip"),f.ok&&k?.user&&k?.token?(localStorage.setItem("authToken",k.token),a(k.user)):h(k?.error||"Invalid username or password.")}catch{h("Network error.")}finally{v(!1)}}async function N(j){if(j.preventDefault(),h(""),v(!0),!o||!s||!i){h("Email, username, and password required."),v(!1);return}try{const f=await fetch(`${b}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,username:s,password:i})}),k=await f.json();f.ok&&k?.user&&k?.token?(localStorage.setItem("authToken",k.token),a(k.user)):h(k?.error||"Signup failed.")}catch{h("Network error.")}finally{v(!1)}}async function C(j){if(j.preventDefault(),h(""),v(!0),!o||!o.includes("@")){h("Enter your email address."),v(!1);return}try{const k=await(await fetch(`${b}/api/auth/send-reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})})).json();if(!k?.ok)throw new Error(k?.error||"Failed to send reset email");h("Password reset link sent to your email.")}catch(f){h(f?.message||"Failed to send reset email")}finally{v(!1)}}async function E(j){if(j.preventDefault(),h(""),v(!0),!o||!o.includes("@")){h("Enter your email address."),v(!1);return}try{const k=await(await fetch(`${b}/api/auth/send-username`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})})).json();if(!k?.ok)throw new Error(k?.error||"Failed to send username email");h("Your username has been emailed to you.")}catch(f){h(f?.message||"Failed to send username email")}finally{v(!1)}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsxs("div",{className:"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsxs("form",{className:"card w-full space-y-4",onSubmit:r==="signin"?S:r==="signup"?N:C,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:[e.jsx("h1",{className:"logo text-center",children:"NINE-DART-NATION 🎯"}),e.jsx("span",{className:"badge",children:"Welcome"})]}),e.jsx("h2",{className:"text-2xl font-bold",children:r==="signin"?"Sign In":r==="signup"?"Create Account":"Reset Password"}),(r==="signup"||r==="reset")&&e.jsx("input",{className:"input w-full",type:"email",placeholder:"Email",value:o,onChange:j=>n(j.target.value),required:!0}),r!=="reset"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Username or Email",value:s,onChange:j=>c(j.target.value),required:!0}),r!=="reset"&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input w-full pr-10",type:g?"text":"password",placeholder:"Password",value:i,onChange:j=>d(j.target.value),autoComplete:"current-password",required:!0,onFocus:()=>p(!1),onBlur:()=>p(!1)}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white",tabIndex:-1,onMouseDown:j=>{j.preventDefault(),p(!0)},onMouseUp:j=>{j.preventDefault(),p(!1)},onMouseLeave:()=>p(!1),onTouchStart:j=>{j.preventDefault(),p(!0)},onTouchEnd:j=>{j.preventDefault(),p(!1)},"aria-label":"Toggle password visibility",children:g?e.jsx(xs,{className:"w-5 h-5"}):e.jsx(vn,{className:"w-5 h-5"})})]}),r==="signup"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Password Reminder (optional)",value:l,onChange:j=>m(j.target.value)}),u&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:u}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:y,children:y?"Signing In...":r==="signin"?"Sign In":r==="signup"?"Sign Up":"Send Reset Link"}),r==="reset"&&e.jsx("button",{className:"btn w-full mt-2 bg-white/10 hover:bg-white/20",type:"button",onClick:E,disabled:y,children:"Email me my username"}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("button",{type:"button",className:"underline",onClick:()=>t(r==="signin"?"signup":"signin"),disabled:y,children:r==="signin"?"Need an account? Sign Up":"Already have an account? Sign In"}),e.jsx("button",{type:"button",className:"underline",onClick:()=>t("reset"),disabled:y,children:"Forgot password?"})]})]}),e.jsxs("aside",{className:"card w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:"What’s inside"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(bn,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Online & Friends"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Challenge friends, chat, and join leagues."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(bs,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Deep Stats"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Track 3-dart averages, best legs, and more."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(vt,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Game Modes"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Start with 3 free online games upon signup. After that, PREMIUM is required to play all games."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(ys,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Premium Perks"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Polished UI, upcoming features, and early access."})]})]})]}),e.jsxs("a",{href:bo?.VITE_DISCORD_INVITE_URL||"https://discord.gg/8GtbZ6RU",target:"_blank",rel:"noopener noreferrer",className:"btn mt-4 flex items-center justify-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"})," Join BullseyeDartsLeague"]}),e.jsxs("a",{href:"https://discord.gg/NineDartNation",target:"_blank",rel:"noopener noreferrer",className:"btn mt-2 flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20",children:[e.jsx(Ie,{className:"w-5 h-5"})," Join NineDartNation"]})]})]})]})}const vo=w.createContext({theme:"default",setTheme:a=>{}}),Lr="ndn_theme";function wo({children:a}){const[r,t]=w.useState("default");return w.useEffect(()=>{try{const o=localStorage.getItem(Lr);o&&t(o)}catch{}},[]),w.useEffect(()=>{try{localStorage.setItem(Lr,r)}catch{}},[r]),e.jsx(vo.Provider,{value:{theme:r,setTheme:t},children:e.jsx("div",{className:`theme-${r}`,children:a})})}function jo({open:a,onClose:r,width:t=700,title:o,footer:n,children:s,side:c="right"}){return w.useEffect(()=>{function i(d){d.key==="Escape"&&r()}return a&&document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[a,r]),e.jsxs("div",{className:`fixed inset-0 z-50 ${a?"":"pointer-events-none"}`,"aria-hidden":!a,children:[e.jsx("div",{className:`absolute inset-0 bg-black/60 transition-opacity ${a?"opacity-100":"opacity-0"}`,onClick:r}),e.jsxs("div",{className:`absolute top-0 ${c==="right"?"right-0 border-l":"left-0 border-r"} h-full bg-slate-900 border-slate-700 shadow-2xl w-full sm:w-auto flex flex-col transition-transform duration-200 ${a?"translate-x-0":c==="right"?"translate-x-full":"-translate-x-full"}`,style:{width:typeof t=="number"?`${t}px`:t},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-700 sticky top-0 bg-slate-900 z-10",children:[e.jsx("div",{className:"text-lg font-semibold",children:o}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:r,children:"Close"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:s}),n&&e.jsx("div",{className:"px-4 py-3 border-t border-slate-700 sticky bottom-0 bg-slate-900 z-10",children:n})]})]})}function No({}){const[a,r]=w.useState(!1),[t,o]=w.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[n,s]=w.useState(""),[c,i]=w.useState(!1),[d,l]=w.useState(""),[m,u]=w.useState(null),h=(()=>{try{return It()}catch{return null}})();w.useEffect(()=>{if(!h)return;const v=h.addListener(b=>{try{b?.type==="help-message"&&m&&(String(b.requestId),String(m.id)),b?.type==="help-request-updated"&&m&&b.request?.id===m.id&&u(b.request)}catch{}});return()=>v()},[h,m]);const g=v=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:v}})),r(!1)}catch(b){console.error("Navigation failed:",b)}},p=v=>{const b=v.toLowerCase();return b.includes("username")||b.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:b.includes("premium")||b.includes("upgrade")||b.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:b.includes("calibrat")||b.includes("camera")||b.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:b.includes("voice")||b.includes("caller")||b.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:b.includes("friend")||b.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:b.includes("stat")||b.includes("score")||b.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:b.includes("setting")||b.includes("customiz")||b.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:b.includes("tournament")||b.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:b.includes("score")||b.includes("scoring")||b.includes("autoscore")?{text:"Auto-scoring assigns darts to board segments automatically. You can review and adjust placements in the Match Summary screen.",links:[{text:"Go to Match Summary",tab:"matchsummary"}]}:b.includes("pair")||b.includes("pairing")||b.includes("phone")||b.includes("camera pairing")?{text:"Use the Pairing flow to connect phones and cameras. Make sure devices are on the same Wi‑Fi and scan the QR code shown.",links:[{text:"Open Pairing",tab:"pairing"}]}:b.includes("highlight")||b.includes("download")||b.includes("save")?{text:"Highlights can be downloaded or saved to your account from the Highlights section. We keep a record when you hit milestone checkouts or visits.",links:[{text:"Open Highlights",tab:"highlights"}]}:b.includes("privacy")||b.includes("copyright")||b.includes("legal")?{text:"Our Legal Notice and Privacy information are available in the footer. You can view privacy, copyright, and contact details there.",links:[{text:"View Legal Notice",tab:"footer"}]}:b.includes("help")||b.includes("support")||b.includes("faq")?{text:"You're already in the help section! Check Settings for more resources.",links:[{text:"Go to Settings > Support",tab:"settings"}]}:b.includes("how to play")||b.includes("game")||b.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},y=()=>{if(!n.trim())return;const v=n.trim(),b=v.toLowerCase();if(o(N=>[...N,{text:v,isUser:!0}]),s(""),c)if(b.startsWith("y")){o(N=>[...N,{text:"Okay — I will notify an admin. Please wait for them to join the chat.",isUser:!1}]),i(!1),(async()=>{try{const E=await(await ze("/api/help/requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:d||v})})).json().catch(()=>null);E&&E.request?(u(E.request),o(j=>[...j,{text:"Okay — I will notify an admin. Please wait for them to join the chat.",isUser:!1}])):o(j=>[...j,{text:"Okay — I will notify an admin. Please wait for them to join the chat.",isUser:!1}])}catch{o(C=>[...C,{text:"Failed to contact admins. Please try again later.",isUser:!1}])}})();return}else{o(N=>[...N,{text:"Okay — I won't notify an admin. If you change your mind, just ask.",isUser:!1}]),i(!1);return}const S=p(b);if(typeof S.text=="string"&&S.text.includes("I'm not sure about that")){l(v),i(!0),setTimeout(()=>{o(N=>[...N,{text:{text:"I can connect you to a member of our admin team — would you like that? Type YES or NO.",links:[]},isUser:!1}])},350);return}setTimeout(()=>{o(N=>[...N,{text:S,isUser:!1}])},500)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(!0),className:"fixed bottom-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-colors",title:"Help Assistant",children:e.jsx(wn,{className:"w-6 h-6"})}),a&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-end p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>r(!1)}),e.jsxs("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-md h-96 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"font-semibold",children:"Help Assistant"})]}),e.jsx("button",{onClick:()=>r(!1),className:"text-slate-400 hover:text-white",children:e.jsx(Or,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.map((v,b)=>e.jsx("div",{className:`flex ${v.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${v.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof v.text=="string"?v.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:v.text.text}),v.text.links&&e.jsx("div",{className:"space-y-1",children:v.text.links.map((S,N)=>e.jsx("button",{onClick:()=>g(S.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:S.text},N))})]})})},b))}),e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:v=>s(v.target.value),onKeyPress:v=>v.key==="Enter"&&y(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:y,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(En,{className:"w-4 h-4"})})]})})]})]}),m&&e.jsx(os,{request:m,user:{email:null,username:null,isAdmin:!1},onClose:()=>u(null)})]})}function So(){const a=kt(),r=w.useRef({}),t=w.useRef({});return w.useEffect(()=>{function o(l="[GlobalCamera]"){try{const m=a.getVideoElementRef(),u=a.getMediaStream(),h=a.getPcRef&&a.getPcRef(),g=a.getWsRef&&a.getWsRef();console.log(l,{isStreaming:a.isStreaming,mode:a.mode,showOverlay:a.showOverlay,hasVideoElement:!!m,video:m?{videoWidth:m.videoWidth,videoHeight:m.videoHeight,srcObject:!!m.srcObject}:null,mediaTracks:u?u.getTracks().map(p=>({kind:p.kind,enabled:p.enabled,id:p.id})):null,pcState:h?h.connectionState||h.iceConnectionState:null,wsState:g?g.readyState||"unknown":null})}catch(m){console.warn("[GlobalCamera] dumpState failed",m)}}o("[GlobalCamera] INIT");let n=!0;const s=setInterval(()=>{if(n)try{const l=a.getVideoElementRef(),m=a.getMediaStream(),u=a.getPcRef&&a.getPcRef(),h={isStreaming:a.isStreaming,mode:a.mode,hasVideo:!!l,videoW:l?l.videoWidth:0,videoH:l?l.videoHeight:0,tracks:m?m.getTracks().length:0,pcState:u?u.connectionState||u.iceConnectionState:null},g=r.current;(h.isStreaming!==g.isStreaming||h.hasVideo!==g.hasVideo||h.videoW!==g.videoW||h.videoH!==g.videoH||h.tracks!==g.tracks||h.pcState!==g.pcState||a.showOverlay!==g.showOverlay)&&(r.current=h,o("[GlobalCamera] CHANGE"))}catch(l){console.warn("[GlobalCamera] poll failed",l)}},750);function c(l){try{const m=t.current.video;if(m&&m.el===l)return;if(m&&m.el){try{m.el.removeEventListener("loadedmetadata",m.loadedmetadata)}catch{}try{m.el.removeEventListener("playing",m.playing)}catch{}try{m.el.removeEventListener("pause",m.pause)}catch{}try{m.el.removeEventListener("ended",m.ended)}catch{}}if(t.current.video=null,l){const u=()=>console.log("[GlobalCamera] video loadedmetadata",{videoWidth:l.videoWidth,videoHeight:l.videoHeight}),h=()=>{console.log("[GlobalCamera] video playing",{paused:l.paused});try{a.setStreaming(!0)}catch{}},g=()=>{console.log("[GlobalCamera] video pause");try{a.setStreaming(!1)}catch{}},p=()=>{console.log("[GlobalCamera] video ended");try{a.setStreaming(!1)}catch{}};l.addEventListener("loadedmetadata",u),l.addEventListener("playing",h),l.addEventListener("pause",g),l.addEventListener("ended",p),t.current.video={el:l,loadedmetadata:u,playing:h,pause:g,ended:p}}}catch(m){console.warn("[GlobalCamera] attachVideoListeners failed",m)}}function i(l){try{const m=t.current.pc;if(m&&m.pc===l)return;if(m&&m.pc)try{m.pc.removeEventListener("connectionstatechange",m.connChange)}catch{}if(t.current.pc=null,l){const u=()=>console.log("[GlobalCamera] pc state change",{connectionState:l.connectionState,iceState:l.iceConnectionState});l.addEventListener("connectionstatechange",u),t.current.pc={pc:l,connChange:u}}}catch(m){console.warn("[GlobalCamera] attachPc failed",m)}}const d=setInterval(()=>{try{c(a.getVideoElementRef()),i(a.getPcRef&&a.getPcRef())}catch{}},1e3);return()=>{n=!1,clearInterval(s),clearInterval(d);try{const l=t.current.video;l&&l.el&&(l.el.removeEventListener("loadedmetadata",l.loadedmetadata),l.el.removeEventListener("playing",l.playing))}catch{}try{const l=t.current.pc;l&&l.pc&&l.pc.removeEventListener("connectionstatechange",l.connChange)}catch{}}},[a]),null}function Co(){const a=kt(),r=w.useRef(null),t=w.useRef(null),o=w.useRef(0),n=w.useRef(0),s=w.useRef(0),c=w.useRef(0);return w.useEffect(()=>{r.current&&a.setVideoElementRef(r.current)},[a]),w.useEffect(()=>{let i=!0;const d=async()=>{if(i)try{const m=a.getMediaStream(),u=r.current;if(!u||!m)return;(t.current!==m||u.srcObject!==m)&&(u.srcObject=m,t.current=m),u.muted=!0,u.playsInline=!0;try{await u.play()}catch{}}catch{}};d();const l=setInterval(d,750);return()=>{i=!1,clearInterval(l)}},[a]),w.useEffect(()=>{const d=setInterval(()=>{const l=r.current,m=Date.now();if(!l||!a.isStreaming||a.mode!=="phone"){n.current=0;return}if(!l.srcObject){const h=[3e3,6e3,1e4][Math.min(c.current,2)];if(m-s.current>=h){s.current=m,c.current=Math.min(c.current+1,3);try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{reason:"missing-stream",ts:m}})),l.play().catch(()=>{})}catch{}}return}const u=l.currentTime||0;if(Number.isFinite(u))if(u===o.current?n.current+=1:n.current=0,o.current=u,n.current>=3){const h=[3e3,6e3,1e4][Math.min(c.current,2)];if(m-s.current>=h){s.current=m,c.current=Math.min(c.current+1,3);try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{reason:"stall",ts:m}})),l.play().catch(()=>{})}catch{}}}else n.current===0&&(c.current=0)},1e3);return()=>clearInterval(d)},[a]),e.jsx("video",{ref:r,style:{position:"fixed",width:1,height:1,left:-9999,top:-9999,opacity:0},muted:!0,playsInline:!0,"aria-hidden":!0})}function ko({storageKey:a,children:r,className:t,defaultWidth:o=520,defaultHeight:n,minWidth:s=360,minHeight:c=200,maxWidth:i=1100,maxHeight:d=900,fullScreen:l=!1,initialFitHeight:m=!1,onClose:u}){const[h,g]=w.useState(()=>{if(!l){try{const j=localStorage.getItem(a);if(j)return JSON.parse(j)}catch{}return{width:o,height:n}}return{}}),p=w.useRef(null);w.useEffect(()=>{if(l)return;function j(){try{localStorage.removeItem(a)}catch{}if(m&&N.current?.parentElement){const f=N.current.parentElement,k=window.getComputedStyle(f),R=parseFloat(k.paddingTop||"0")||0,L=parseFloat(k.paddingBottom||"0")||0,I=Math.max(0,f.clientHeight-R-L),P=Math.max(c,Math.min(d,Math.round(I)));g({width:o,height:P});return}g({width:o,height:n})}return window.addEventListener("ndn:layout-reset",j),()=>window.removeEventListener("ndn:layout-reset",j)},[a,o,n,l]),w.useEffect(()=>{if(!l)try{localStorage.setItem(a,JSON.stringify(h))}catch{}},[h,a,l]),w.useEffect(()=>{if(l||!m)return;const j=N.current?.parentElement;if(!j)return;const f=window.getComputedStyle(j),k=parseFloat(f.paddingTop||"0")||0,R=parseFloat(f.paddingBottom||"0")||0,L=Math.max(0,j.clientHeight-k-R),I=Math.max(c,Math.min(d,Math.round(L)));try{const P=localStorage.getItem(a);if(P){const O=JSON.parse(P)?.height||0;(!O||O<I)&&g(W=>({...W,height:I}));return}}catch{}g(P=>({...P,height:I}))},[m,l,a,c,d]);function y(j,f,k){return Math.max(f,Math.min(k,j))}function v(j,f){j.preventDefault();const k=N.current;if(!k)return;const R=k.getBoundingClientRect();p.current={x:j.clientX,y:j.clientY,w:R.width,h:R.height,dir:f},window.addEventListener("mousemove",b),window.addEventListener("mouseup",S)}function b(j){const f=p.current;if(!f)return;const k=j.clientX-f.x,R=j.clientY-f.y,L=f.dir;let I=f.w,P=f.h,A=1/0;const O=N.current?.parentElement;if(O){const Z=window.getComputedStyle(O),se=parseFloat(Z.paddingTop||"0")||0,ae=parseFloat(Z.paddingBottom||"0")||0;A=Math.max(0,O.clientHeight-se-ae)}const W=Math.min(d,isFinite(A)?A:d);L.includes("e")&&(I=y(f.w+k,s,i)),L.includes("s")&&(P=y(f.h+R,c,W)),L.includes("w")&&(I=y(f.w-k,s,i)),L.includes("n")&&(P=y(f.h-R,c,W)),g({width:Math.round(I),height:Math.round(P)})}function S(){window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",S),p.current=null}const N=w.useRef(null),C=l?{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%"}:{width:h.width?`${h.width}px`:void 0,height:h.height?`${h.height}px`:void 0,maxWidth:`${i}px`,maxHeight:"100%"},E=l?"card relative ndn-modal-full":"card relative";return e.jsxs("div",{ref:N,className:`${E} ${t||""}`,style:C,children:[r,!l&&e.jsx("div",{className:"resizer resizer-nw",onMouseDown:j=>v(j,"nw")}),!l&&e.jsx("div",{className:"resizer resizer-ne",onMouseDown:j=>v(j,"ne")}),!l&&e.jsx("div",{className:"resizer resizer-sw",onMouseDown:j=>v(j,"sw")}),!l&&e.jsx("div",{className:"resizer resizer-se",onMouseDown:j=>v(j,"se")}),!l&&e.jsx("div",{className:"resizer-edge resizer-s",onMouseDown:j=>v(j,"s")})]})}function Eo(){const[a,r]=w.useState(!1),t=new Date().getFullYear();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full text-center text-xs text-gray-500 py-2 select-none",children:["© ",t," Nine Dart Nation — ",e.jsx("button",{className:"underline",onClick:()=>r(!0),children:"Legal Notice"})]}),a?e.jsx(ko,{storageKey:"ndn:modal:legal",className:"w-[640px]",defaultWidth:640,defaultHeight:420,minWidth:420,minHeight:220,initialFitHeight:!0,children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Privacy & Copyright Notice"}),e.jsx("div",{className:"text-sm",children:"⚠️ IMPORTANT LEGAL NOTICE"}),e.jsx("div",{className:"text-sm",children:"Copyright Protection: All code, assets, and intellectual property in Nine Dart Nation are protected by copyright law. Unauthorized copying, modification, or distribution of this software is strictly prohibited."}),e.jsx("div",{className:"text-sm",children:"Legal Consequences: Any attempt to edit, reverse-engineer, or redistribute this code will result in immediate legal action, including but not limited to copyright infringement lawsuits and potential criminal charges."}),e.jsx("div",{className:"text-sm",children:"Privacy: Your personal data and gameplay information are protected. Any unauthorized access or data collection violates privacy laws and will be prosecuted to the full extent of the law."}),e.jsx("div",{className:"flex items-center gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:()=>r(!1),children:"Close"})})]})}):null]})}const To={},Io=Ce.lazy(()=>me(()=>import("./Home-irkAiYpD.js"),__vite__mapDeps([0,1,2,3]))),Po=Ce.lazy(()=>me(()=>import("./OfflinePlay-7y_YoV87.js"),__vite__mapDeps([10,1,2,8,6,5,7,11]))),Ro=Ce.lazy(()=>me(()=>import("./Friends-M1KU-teV.js"),__vite__mapDeps([14,1,2,9])));Ce.lazy(()=>me(()=>import("./Scoreboard-l-TGftja.js"),__vite__mapDeps([12,5,3,11,1,2,7])));Ce.lazy(()=>me(()=>import("./CameraView-C1ehnpRI.js").then(a=>a.b),__vite__mapDeps([6,1,2,5,7])));const Ao=Ce.lazy(()=>me(()=>import("./OnlinePlay-DTlubsKN.js"),__vite__mapDeps([4,1,2,5,6,7,8,9]))),Mo=Ce.lazy(()=>me(()=>import("./StatsPanel-RyyJrZuP.js"),__vite__mapDeps([13,5,3,1,2]))),Lo=Ce.lazy(()=>me(()=>import("./Tournaments-DizC2fUW.js"),__vite__mapDeps([15,1,2]))),Do=Ce.lazy(()=>me(()=>import("./AdminAccess-DzgyrIQI.js"),__vite__mapDeps([16,1,2]))),Oo=Ce.lazy(()=>me(()=>import("./OpsDashboard-BDKYYM-M.js"),__vite__mapDeps([17,1,2])));function _o(){const a=w.useRef(null),[r,t]=w.useState(""),[o,n]=w.useState(!1),[s,c]=w.useState(null),i=(()=>{try{return It()}catch{return null}})(),[d,l]=w.useState("score"),[m,u]=w.useState(!1),[h,g]=w.useState(!1),[p,y]=w.useState(null),v=(To?.VITE_MINIMAL_AFTER_LOGIN||"").toString()==="1",[b,S]=w.useState(!1),[N,C]=w.useState(0),{avgMode:E}=An(),{H:j,locked:f,errorPx:k}=Pn();w.useEffect(()=>{if(p&&v){S(!0);const P=setTimeout(()=>S(!1),1500);return()=>clearTimeout(P)}const I=localStorage.getItem("authToken");I&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${I}`}}).then(A=>A.json()).then(A=>{A?.user?(y(A.user),R(A.user)):localStorage.removeItem("authToken")}).catch(()=>{})},[]),w.useEffect(()=>{const I=()=>{try{localStorage.removeItem("mockUser"),localStorage.removeItem("authToken")}catch{}y(null),l("score")};return window.addEventListener("ndn:logout",I),()=>window.removeEventListener("ndn:logout",I)},[]),w.useEffect(()=>{if(!p?.username)return;const I=()=>C(E==="24h"?so(p.username):Xa(p.username));I();const P=()=>I();return window.addEventListener("ndn:stats-updated",P),()=>window.removeEventListener("ndn:stats-updated",P)},[p?.username,E]),w.useEffect(()=>{if(!p?.username){t("");return}const I=localStorage.getItem(`ndn:bio:profilePhoto:${p.username}`);t(I||"")},[p?.username]),w.useEffect(()=>{const I=W=>{W.key?.startsWith("ndn:bio:profilePhoto:")&&p?.username&&W.key.endsWith(p.username)&&t(W.newValue||"")},P=W=>{if(W.detail?.username===p?.username&&t(W.detail?.avatar||""),p?.username){const Z=localStorage.getItem(`ndn:bio:profilePhoto:${p.username}`);t(Z||"")}},A=()=>{if(!document.hidden&&p?.username){const W=localStorage.getItem(`ndn:bio:profilePhoto:${p.username}`);t(W||"")}},O=setInterval(()=>{if(p?.username){const W=localStorage.getItem(`ndn:bio:profilePhoto:${p.username}`);W&&W!==r&&t(W)}},2e3);return window.addEventListener("storage",I),window.addEventListener("ndn:avatar-updated",P),document.addEventListener("visibilitychange",A),()=>{window.removeEventListener("storage",I),window.removeEventListener("ndn:avatar-updated",P),document.removeEventListener("visibilitychange",A),clearInterval(O)}},[p?.username,r]),w.useEffect(()=>{const I=new URLSearchParams(window.location.search),P=I.get("paid"),A=I.get("username-change");if(P==="1"||P==="username-change"||A==="free"){const O=localStorage.getItem("pendingUsernameChange");O&&p?.email&&fetch("http://localhost:8787/api/change-username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p.email,newUsername:O})}).then(Z=>Z.json()).then(Z=>{Z.ok?(alert("Username changed successfully!"),localStorage.removeItem("pendingUsernameChange"),Z.token&&localStorage.setItem("authToken",Z.token),Z.user&&y(Z.user),window.history.replaceState({},document.title,window.location.pathname)):alert("Failed to change username: "+(Z.error||"Unknown error"))}).catch(()=>{alert("Network error while changing username")})}},[p?.email]),w.useEffect(()=>{new URLSearchParams(window.location.search).get("subscription")==="success"&&p?.email&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}).then(O=>O.json()).then(O=>{O?.user&&(y(O.user),alert("Premium subscription activated successfully!"),window.history.replaceState({},document.title,window.location.pathname))}).catch(()=>{alert("Subscription activated, but failed to refresh user data. Please refresh the page.")})},[p?.email]),w.useEffect(()=>{const I=()=>{const O=window.innerWidth,W=window.matchMedia("(max-width: 768px)").matches,Z=window.matchMedia("(max-width: 1024px) and (min-width: 769px)").matches,se=/Mobi|Android|iPhone|iPad|iPod|Mobile|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent||""),ae=/iPad|Android(?=.*\bMobile\b)|Tablet|PlayBook|Silk/i.test(navigator.userAgent||""),fe="ontouchstart"in window||navigator.maxTouchPoints>0,we=O<769,xe=Z&&fe||ae||O>=769&&O<=1024&&fe,Ne=W||se||we||O<769&&fe||xe;u(Ne)};I(),window.addEventListener("resize",I),window.addEventListener("orientationchange",I);const P=window.matchMedia("(max-width: 768px)"),A=window.matchMedia("(max-width: 1024px) and (min-width: 769px)");try{P.addEventListener("change",I),A.addEventListener("change",I)}catch{}return()=>{window.removeEventListener("resize",I),window.removeEventListener("orientationchange",I);try{P.removeEventListener("change",I),A.removeEventListener("change",I)}catch{}}},[]),w.useEffect(()=>{const I=()=>{try{localStorage.removeItem("ndn:avatar")}catch{}y(null),l("score")};return window.addEventListener("ndn:logout",I),()=>window.removeEventListener("ndn:logout",I)},[]),w.useEffect(()=>{const I=P=>{try{const A=String(P?.detail?.username||"").trim();if(!A)return;y(O=>O&&{...O,username:A});try{const O=(p?.email||"").toLowerCase();i&&A&&O&&i.send({type:"presence",username:A,email:O})}catch{}}catch{}};return window.addEventListener("ndn:username-changed",I),()=>window.removeEventListener("ndn:username-changed",I)},[i,p?.email]),w.useEffect(()=>{const I=P=>{try{const A=String(P?.detail?.tab||"").trim();A&&["score","offline","online","stats","settings","admin","tournaments","friends"].includes(A)&&l(A)}catch{}};return window.addEventListener("ndn:change-tab",I),()=>window.removeEventListener("ndn:change-tab",I)},[]);async function R(I){try{const P=I?.email?`?email=${encodeURIComponent(I.email)}`:"",A=await fetch("/api/subscription"+P);if(!A.ok)return;const O=await A.json();y({...I,fullAccess:!!O?.fullAccess})}catch{}}if(!p)return e.jsx(yo,{onAuth:I=>{y(I),R(I)}});const L=`https://ui-avatars.com/api/?name=${encodeURIComponent(p.username||"NDN")}&background=8F43EE&color=fff&bold=true&rounded=true&size=64`;return e.jsxs(wo,{children:[e.jsxs("div",{ref:a,className:`${p?.fullAccess?"premium-body":""} h-screen overflow-hidden pt-1 pb-0 px-1 xs:pt-2 xs:pb-0 xs:px-2 sm:pt-3 sm:pb-0 sm:px-3 md:pt-4 md:pb-0 md:px-4`,children:[e.jsx(Ya,{}),e.jsxs("div",{className:"max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-[auto,1fr] gap-2 xs:gap-3 sm:gap-4 h-full overflow-hidden",children:[!m&&e.jsx("div",{className:"relative hidden lg:block",style:{width:240},children:e.jsx($r,{active:d,onChange:I=>{l(I)},user:p})}),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"pt-1 xs:pt-2",children:e.jsxs("header",{id:"ndn-header",className:"header glass flex-col xs:flex-col sm:flex-row gap-2 xs:gap-2 sm:gap-3",children:[e.jsx("div",{className:"flex items-center gap-2 order-1",children:e.jsx("h1",{className:"text-lg xs:text-xl sm:text-xl md:text-2xl font-bold text-brand-700 whitespace-nowrap cursor-pointer select-none",onClick:()=>{l("score")},title:"Go Home",children:"NINE-DART-NATION 🎯"})}),e.jsxs("div",{className:"order-3 xs:order-3 sm:order-2 w-full sm:w-auto flex-1 flex flex-col items-center justify-center text-center sm:text-left !text-black",children:[e.jsxs("span",{className:"text-sm xs:text-base sm:text-base md:text-lg font-semibold flex items-center gap-2 max-w-full truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[e.jsx("span",{className:"hidden xs:inline !text-black",children:"Welcome"}),e.jsx("img",{src:r||L,alt:"avatar",className:"w-5 h-5 xs:w-6 xs:h-6 sm:w-6 sm:h-6 md:w-7 md:h-7 rounded-full ring-2 ring-white/20"}),e.jsxs("span",{className:"truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[p.username,"🎯"]})]}),e.jsxs("span",{className:"hidden xs:inline text-xs xs:text-xs sm:text-xs md:text-sm !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:["All-time 3-dart avg: ",e.jsx("span",{className:"font-semibold !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:N.toFixed(2)})]}),m&&e.jsx("button",{className:"btn px-3 py-1 xs:px-3 xs:py-1 sm:px-3 sm:py-1 mt-1 text-sm xs:text-sm","aria-label":"Open navigation",onClick:()=>g(!0),children:"☰ Menu"})]}),f&&j&&e.jsxs("button",{onClick:()=>l("calibrate"),className:"order-4 sm:order-4 md:order-3 px-3 py-1 text-xs sm:text-sm rounded-full bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-100 border border-emerald-400/50 transition-colors",title:"Click to adjust calibration",children:["✓ Calibration Active ",k!=null&&`• ${k.toFixed(1)}px`]}),e.jsxs("div",{className:"order-2 md:order-3 ml-0 md:ml-auto flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"px-3 py-1 text-sm rounded-full bg-white/5 hover:bg-white/10 border border-white/10",onClick:()=>{const I=a.current;I&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):I.requestFullscreen().catch(()=>{}))},title:o?"Exit Full Screen":"Enter Full Screen",children:o?"Exit Full Screen":"Full Screen"}),d==="online"&&e.jsx("button",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40",title:"Open a simulated online match",onClick:()=>{setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch{}},40)},children:"ONLINE DEMO"}),e.jsx(as,{}),i?e.jsx("span",{className:"ml-0 md:ml-2",children:e.jsx(ss,{status:i.status})}):null]})]})}),m&&e.jsx(Bo,{open:h,onClose:()=>g(!1),active:d,onChange:I=>{l(I),g(!1)},user:p}),e.jsxs("main",{id:"ndn-main-scroll",className:"space-y-4 flex-1 overflow-y-auto pr-1 flex flex-col",children:[d==="settings"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading settings…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsx(xo,{user:p})})}),d==="score"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading home…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsx(Io,{user:p})})}),d==="online"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading online…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsx(Ao,{user:p})})}),d==="offline"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading offline…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsx(Po,{user:p})})}),e.jsx("div",{className:d==="calibrate"?"":"hidden",children:e.jsx(Ee,{children:e.jsx(Ga,{})})}),d==="friends"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading friends…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsx(Ro,{user:p})})}),d==="stats"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading stats…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsx(Mo,{user:p})})}),d==="tournaments"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading tournaments…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsx(Lo,{user:p})})}),d==="admin"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading admin…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"flex-1 min-h-0 space-y-6",children:[e.jsx(go,{user:p}),e.jsx(Oo,{user:p})]})})}),d==="fullaccess"&&e.jsx(w.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading admin access…"}),children:e.jsx(Ee,{className:"flex-1 min-h-0",children:e.jsx(Do,{user:p})})})]})]})]})]}),e.jsx(No,{}),e.jsx(Eo,{}),!b&&e.jsx(So,{}),!b&&e.jsx(Co,{})]})}function Bo({open:a,onClose:r,active:t,onChange:o,user:n}){return e.jsx(jo,{open:a,onClose:r,width:320,side:"left",title:"Navigate",children:e.jsx("div",{className:"mt-2",children:e.jsx($r,{active:t,onChange:o,user:n,className:"flex relative static max-h-[80vh] w-full"})})})}function Uo(a){return a.length>=10&&/\d/.test(a)&&/[^A-Za-z0-9]/.test(a)}function Fo(){const[a,r]=w.useState(""),[t,o]=w.useState(""),[n,s]=w.useState(""),[c,i]=w.useState(""),[d,l]=w.useState("");w.useEffect(()=>{try{const h=new URLSearchParams(window.location.search).get("token")||"";r(h)}catch{}},[]);async function m(u){if(u.preventDefault(),i(""),l(""),!a){i("Missing or invalid reset token.");return}if(!t||t!==n){i("Passwords do not match.");return}if(!Uo(t)){i("Password must be at least 10 chars and include a number and symbol.");return}try{const g=await(await fetch("/api/auth/confirm-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a,newPassword:t})})).json();if(!g?.ok)throw new Error(g?.error||"Reset failed");l("Password changed. You can now sign in.")}catch(h){i(h?.message||"Reset failed")}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsx("div",{className:"relative z-10 w-full max-w-lg mx-auto p-4",children:e.jsxs("form",{className:"card w-full space-y-4",onSubmit:m,children:[e.jsx("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:e.jsx("h1",{className:"logo text-center",children:"Reset your password"})}),!a&&e.jsx("div",{className:"text-red-400",children:"This reset link is missing a token. Please use the link from your email."}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"New password",value:t,onChange:u=>o(u.target.value),required:!0}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"Confirm password",value:n,onChange:u=>s(u.target.value),required:!0}),c&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:c}),d&&e.jsx("div",{className:"text-emerald-400 font-semibold text-sm",children:d}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:!a,children:"Change Password"}),e.jsx("a",{className:"underline text-sm text-center",href:"/",children:"Back to sign in"})]})})]})}class qo extends w.Component{constructor(r){super(r),this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0,message:String(r?.message||r)}}componentDidCatch(r,t){console.error("[ErrorBoundary]",r,t)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"card max-w-lg w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"opacity-80 mb-4",children:"Please refresh the page. If this persists, let us know."}),this.state.message&&e.jsx("pre",{className:"text-xs bg-black/40 rounded p-2 overflow-auto text-left",children:this.state.message}),e.jsx("button",{className:"btn mt-4",onClick:()=>window.location.reload(),children:"Reload"})]})}):this.props.children}}try{window.React=window.React||{}}catch{}Bs();Ss.createRoot(document.getElementById("root")).render(e.jsx(w.StrictMode,{children:e.jsx(qo,{children:e.jsx(co,{children:e.jsx($o,{})})})}));function $o(){return window.location.pathname==="/reset"?e.jsx(Fo,{}):e.jsx(_o,{})}export{Jo as A,V as B,Yo as C,Et as D,Ko as E,ns as F,Ln as G,ei as H,Qo as I,ti as J,Ka as K,Rs as L,ko as R,Za as T,Zo as a,Wo as b,Go as c,Xo as d,ni as e,io as f,Mn as g,Ct as h,It as i,e as j,Ts as k,Pn as l,Xa as m,ze as n,Ho as o,lo as p,Ar as q,$n as r,ro as s,kt as t,An as u,da as v,Dn as w,ri as x,ho as y,si as z};
//# sourceMappingURL=index-QB6Os3F3.js.map

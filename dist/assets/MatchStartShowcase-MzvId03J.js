import{Q as xe,S as ke,U as Ce,V as Se,W as Pe,X as $e,j as e,Y as Ee,Z as we,u as O,a as be,_ as Fe,b as Te,L as Re,$ as Ue,a0 as Ae,g as Ie,a1 as Le,a2 as Be,r as De}from"./index-DHjJuWW-.js";import{J as de,K as he,R as ge,Z as ve,N as Oe,r as d}from"./ui-C3zlW9wh.js";function ct({gameMode:a,compact:t=!1,onRecalibrate:n}){const{H:l,errorPx:m,confidence:p}=xe(),h=ke(a,m),x=Ce(a,m),{text:r}=Se(a,m),i=Pe(a),y=Ee[a],v=typeof p=="number"?p:$e(m),N=typeof v=="number"&&Math.abs(v-h)>=.5,S=!!l;if(!S)return t?e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30",children:[e.jsx(de,{className:"w-3 h-3"}),"Not calibrated âŒ"]}):e.jsxs("div",{className:"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-red-300",children:"Calibration Required âš ï¸"}),e.jsxs("div",{className:"text-xs opacity-80",children:["Please calibrate before playing ",a]})]}),n&&e.jsx("button",{className:"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700",onClick:n,children:"Calibrate ðŸ“"})]});if(S&&(m==null||Number.isNaN(m)))return t?e.jsxs("div",{className:"text-xs px-2 py-1 rounded inline-flex items-center gap-1 border bg-emerald-500/20 border-emerald-600/30 text-emerald-300",children:[e.jsx(he,{className:"w-3 h-3"}),"Calibrated âœ…"]}):e.jsx("div",{className:"px-3 py-2 rounded border bg-emerald-500/20 border-emerald-600/30 space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-emerald-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-emerald-300",children:["Calibration for ",a]}),e.jsx("div",{className:"text-xs opacity-80",children:"Calibrated (quality pending) â³"})]})]})});const g=r.includes("Perfect"),R=g?"bg-indigo-500/20 border-indigo-600/30":x?"bg-emerald-500/20 border-emerald-600/30":"bg-amber-500/20 border-amber-600/30",k=g?"text-indigo-300":x?"text-emerald-300":"text-amber-300",I=g?ve:x?he:de;return t?e.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${R} ${k}`,children:[ge.createElement(I,{className:"w-3 h-3"}),e.jsxs("span",{className:"flex flex-wrap gap-x-1",children:[e.jsx("span",{children:r}),typeof v=="number"&&e.jsxs("span",{children:["Â· Raw ",v.toFixed(1),"%"]}),N&&e.jsx("span",{children:`Â· ${a}: ${h.toFixed(1)}%`})]}),!x&&i&&e.jsx("span",{className:"w-3 h-3 cursor-help",title:i,children:e.jsx(Oe,{className:"w-3 h-3 inline"})})]}):e.jsxs("div",{className:`px-3 py-2 rounded border ${R} space-y-1`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ge.createElement(I,{className:`w-4 h-4 ${g?"text-indigo-400":x?"text-emerald-400":"text-amber-400"} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`font-medium ${g?"text-indigo-300":x?"text-emerald-300":"text-amber-300"}`,children:["Calibration for ",a]}),e.jsxs("div",{className:"text-xs opacity-80 flex flex-wrap gap-x-2 gap-y-1",children:[e.jsxs("span",{children:["Error: ",m!==null?`${m.toFixed(2)}px`:"Unknown"]}),e.jsx("span",{children:r}),typeof v=="number"&&e.jsxs("span",{children:["Raw: ",v.toFixed(1),"%"]}),N&&e.jsx("span",{children:`${a}: ${h.toFixed(1)}%`})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 rounded bg-black/30 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${g?"bg-indigo-500":x?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Math.min(100,h)}%`}})}),e.jsxs("span",{className:"text-xs font-mono",children:[h.toFixed(1),"%"]})]}),y&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{children:["Tolerance: Â±",y.tolerancePx,"px | Min:"," ",y.minConfidence,"%"]})}),e.jsxs("div",{className:"space-y-1",children:[!x&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3 flex-shrink-0"}),"Calibration quality is below minimum for ",a]}),i&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3 flex-shrink-0"}),i]})]}),!x&&n&&e.jsxs("button",{className:"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700",onClick:n,children:["Recalibrate for ",a]})]})}function Me({players:a,playerCalibrations:t,calibrationSkipped:n,onSkip:l,onOpenCalibrator:m,onClose:p}){const h=a.filter(i=>n[i.id]),x=a.filter(i=>!n[i.id]),r=x.length===0;return e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/90 p-4",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"Calibration Check ðŸŽ¯"}),e.jsx("p",{className:"text-sm opacity-70 mb-6 text-center",children:"Check your dartboard calibration before the match starts ðŸŽ¯. Both players must skip or confirm to begin ðŸŽ¯."}),h.length>0&&x.length>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[h.map(i=>i.name).join(", ")," ",h.length===1?"has":"have"," chosen to skip ðŸŽ¯."," ",x.map(i=>i.name).join(", "),", would you like to skip as well ðŸŽ¯?"]})}),e.jsx("div",{className:"space-y-4",children:a.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:i.name.split(" ").map(y=>y[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.name}),e.jsx("div",{className:"text-xs text-slate-400",children:t[i.name]?"Calibrated âœ…":"Needs calibration"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>m(i.id),children:"Bull Up ðŸŽ¯"}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>l(i.id),disabled:!!n[i.id],children:n[i.id]?"Skipped âœ“":"Skip ðŸŽ¯"})]})]},i.id))}),e.jsx("div",{className:"mt-6 flex justify-center gap-4",children:e.jsx("button",{className:`btn ${r?"btn-primary":"btn-ghost opacity-50 cursor-not-allowed"}`,disabled:!r,onClick:p,children:"Start Match ðŸŽ¯"})})]})})}async function We(){const a=[];try{const t=await He();for(const n of t){const l=await _e(n,[80,8080,8787,8788,3e3,5e3]);for(const m of l){const p=await qe(m.ip,m.port);p&&a.push(p)}}}catch(t){console.error("Network discovery failed:",t)}return a}async function He(){const a=[];try{const t=new RTCPeerConnection({iceServers:[]});t.createDataChannel("");const n=await t.createOffer();return await t.setLocalDescription(n),new Promise(l=>{const m=setTimeout(()=>{t.close(),l(a)},5e3);t.onicecandidate=p=>{if(p.candidate){const x=p.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(x&&x[1]&&!a.includes(x[1])){const r=x[1];Ve(r)&&a.push(r)}}else clearTimeout(m),t.close(),l(a)}})}catch(t){return console.error("Failed to get local IPs:",t),["192.168.1.0"]}}function Ve(a){const t=a.split(".").map(Number);return t[0]===10||t[0]===172&&t[1]>=16&&t[1]<=31||t[0]===192&&t[1]===168}async function _e(a,t){const n=[],l=a.split(".").slice(0,3).join("."),m=[];for(let h=1;h<=254;h++){const x=`${l}.${h}`;for(const r of t)m.push(Ge(x,r))}return(await Promise.allSettled(m)).forEach((h,x)=>{if(h.status==="fulfilled"&&h.value){const r=x%t.length,i=Math.floor(x/t.length),y=`${l}.${i+1}`;n.push({ip:y,port:t[r]})}}),n}async function Ge(a,t){try{const n=await fetch(`http://${a}:${t}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(2e3)});return!0}catch{return!1}}async function qe(a,t){try{const n=["/","/api/info","/api/status","/camera","/stream"];for(const l of n)try{const m=await fetch(`http://${a}:${t}${l}`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(m.ok){const p=m.headers.get("content-type")||"",h=await m.text();if(h.includes("OMNI")||h.includes("omni")||l.includes("omni"))return{id:`omni-${a}-${t}`,name:`OMNI Camera (${a})`,ip:a,port:t,type:"omni",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(h.includes("VERT")||h.includes("vert")||l.includes("vert"))return{id:`vert-${a}-${t}`,name:`VERT Camera (${a})`,ip:a,port:t,type:"vert",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(p.includes("video")||h.includes("stream")||l==="/stream")return{id:`generic-${a}-${t}`,name:`Network Camera (${a})`,ip:a,port:t,type:"generic",capabilities:["video"],status:"online",connectionType:"wifi"}}}catch{}}catch(n){console.error(`Failed to probe device ${a}:${t}:`,n)}return null}async function Je(){const a=[];try{if(!("serial"in navigator))return console.warn("Web Serial API not supported in this browser"),a;const t=await navigator.serial.getPorts();for(const n of t){const l=await ye(n);l&&a.push(l)}}catch(t){console.error("USB device discovery failed:",t)}return a}async function Qe(){try{if(!("serial"in navigator))return alert("Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge."),null;const a=await navigator.serial.requestPort();return await ye(a)}catch(a){return a.name!=="NotFoundError"&&console.error("USB device request failed:",a),null}}async function ye(a){try{await a.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none"});const t=a.readable?.getReader();if(t)try{const n=setTimeout(()=>t.cancel(),2e3),{value:l,done:m}=await t.read();if(clearTimeout(n),!m&&l){const p=new TextDecoder().decode(l);if(p.includes("OMNI")||p.includes("omni"))return t.releaseLock(),{id:`usb-omni-${Date.now()}`,name:"OMNI Camera (USB)",type:"omni",capabilities:["video","calibration"],status:"online",port:a};if(p.includes("VERT")||p.includes("vert"))return t.releaseLock(),{id:`usb-vert-${Date.now()}`,name:"VERT Camera (USB)",type:"vert",capabilities:["video","calibration"],status:"online",port:a}}}catch{}finally{try{t.releaseLock()}catch{}}return{id:`usb-generic-${Date.now()}`,name:"USB Scoring Device",type:"generic",capabilities:["video"],status:"online",port:a}}catch(t){return console.error("Failed to probe USB device:",t),null}}async function Ye(a){try{const t=`http://${a.ip}:${a.port}/stream`,n=document.createElement("video");return n.src=t,n.crossOrigin="anonymous",new Promise((l,m)=>{n.onloadeddata=()=>{const p=document.createElement("canvas"),h=p.getContext("2d");p.width=n.videoWidth,p.height=n.videoHeight;const x=p.captureStream(30),r=()=>{n.readyState>=2&&h.drawImage(n,0,0),requestAnimationFrame(r)};r(),l(x)},n.onerror=()=>m(new Error("Failed to load video stream")),n.load()})}catch(t){return console.error("Failed to connect to network device:",t),null}}async function Ze(a){try{if(!a.port)throw new Error("No serial port available");return console.log("USB device connection not fully implemented yet"),null}catch(t){return console.error("Failed to connect to USB device:",t),null}}function Ke({label:a,autoStart:t,scale:n,className:l,aspect:m="inherit",style:p,fill:h=!1,tileFitModeOverride:x}){const r=d.useRef(null),i=we(),[y,v]=d.useState(!1),[N,S]=d.useState(null),[g,R]=d.useState(null),[k,I]=d.useState(null),L=d.useRef(null),M=d.useCallback((s,o="local")=>{try{s?(i.setMediaStream(s),r.current&&i.setVideoElementRef(r.current),i.setMode(o),i.setStreaming(!0),L.current=o):L.current&&L.current!=="phone"&&(i.setStreaming(!1),i.setMediaStream(null),L.current=null)}catch(u){console.warn("[CameraTile] Failed to register stream with camera session:",u)}},[i]),$=O(s=>s.preferredCameraLabel),[P,U]=d.useState(()=>$==="Phone Camera"?"phone":localStorage.getItem("ndn:camera:mode")||"local"),[,q]=d.useState(null),[,A]=d.useState(!1),[_,ce]=d.useState(null),[c,w]=d.useState(null),[j,C]=d.useState(!0),[W,T]=d.useState([]),[K,se]=d.useState(!1),[oe,B]=d.useState([]),[X,H]=d.useState(!1),G=O(s=>s.autoscoreProvider),ae=O(s=>s.cameraEnabled),z=O(s=>s.setPreferredCameraLocked),re=O(s=>s.preferredCameraLocked),J=O(s=>s.setPreferredCamera),le=O(s=>s.preferredCameraId);if(G==="manual"){const o=[h?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",l].filter(Boolean).join(" ").trim(),u={...p||{}};return!h&&u.aspectRatio===void 0&&u.height===void 0&&u.minHeight===void 0&&(u.aspectRatio="4 / 3"),e.jsx("div",{className:o,style:u,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}d.useEffect(()=>{const s=window.location.hostname;(s==="localhost"||s==="127.0.0.1")&&be("/api/hosts").then(o=>o.json()).then(o=>{const u=Array.isArray(o?.hosts)&&o.hosts.find(f=>f);u&&ce(u)}).catch(()=>{}),be("/api/https-info").then(o=>o.json()).then(o=>{o&&typeof o.https=="boolean"&&w({https:!!o.https,port:Number(o.port)||8788})}).catch(()=>{})},[]);const pe=d.useMemo(()=>{const s=g||"____",o="ws://localhost:8787";if(o.length>0)try{const Z=new URL(o);return`${`${Z.protocol==="wss:"?"https":"http"}://${Z.host}${Z.pathname.endsWith("/ws")?"":Z.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${s}`}catch{}const u=_||window.location.hostname,f=!!c?.https,F=f?c?.port||8788:8787;return`${f?"https":"http"}://${u}:${F}/mobile-cam.html?code=${s}`},[g,_,c]);d.useEffect(()=>{localStorage.setItem("ndn:camera:mode",P)},[P]);const[ee,ue]=d.useState(null);d.useEffect(()=>{O.getState().ignorePreferredCameraSync||ee&&Date.now()-ee<3e4||$==="Phone Camera"&&P!=="phone"&&U("phone")},[$,P,ee]),d.useEffect(()=>{const s=async()=>{try{if(!($==="Phone Camera"&&(!ee||Date.now()-ee>=3e4)||P==="phone"))return;const f=i.getMediaStream(),F=r.current;if(!F||!f)return;F.srcObject!==f&&(F.srcObject=f),F.muted=!0,F.playsInline=!0;try{await F.play()}catch{}v(!0)}catch{}};s();const o=setInterval(s,800);return()=>clearInterval(o)},[$,P,i,i.isStreaming]);const V=d.useCallback(async()=>{if(P==="wifi")return te();if($==="Phone Camera"||P==="phone"){const s=i.getMediaStream();if(s&&r.current)try{r.current.srcObject=s,await r.current.play(),v(!0);return}catch{}if(P==="phone")try{await ie();return}catch{}}try{const{preferredCameraId:s,setPreferredCamera:o}=O.getState(),u=s?{video:{deviceId:{exact:s}},audio:!1}:{video:!0,audio:!1};let f;try{f=await navigator.mediaDevices.getUserMedia(u)}catch(F){const Y=F&&(F.name||F.code)||"";if(s&&(Y==="OverconstrainedError"||Y==="NotFoundError"))f=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw F}r.current&&(r.current.srcObject=f,await r.current.play(),v(!0),M(f,"local"))}catch{}},[P,$,i,M,ie,te]),Q=d.useCallback(()=>{r.current&&r.current.srcObject&&(r.current.srcObject.getTracks().forEach(o=>o.stop()),r.current.srcObject=null,v(!1),M(null))},[M]);d.useEffect(()=>{if(!(!ae||G&&G!=="built-in"&&G!=="external-ws")&&t!==void 0){if(t){let s=!1;const o=$||"default",u=window.setTimeout(()=>{s||y||V().catch(f=>console.warn(`[CameraTile] Auto-start failed for ${o}:`,f))},200);return()=>{s=!0,window.clearTimeout(u)}}Q()}},[t,y,ae,G,$,V,Q]);async function te(){se(!0);try{const s=await We();T(s),s.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(s){console.error("Wifi device discovery failed:",s),alert("Failed to discover wifi devices. Please check your network connection.")}finally{se(!1)}}async function fe(s){try{T(u=>u.map(f=>f.id===s.id?{...f,status:"connecting"}:f));const o=await Ye(s);if(o&&r.current)r.current.srcObject=o,await r.current.play(),v(!0),M(o,"wifi"),T(u=>u.map(f=>f.id===s.id?{...f,status:"online"}:f));else throw new Error("Failed to get video stream")}catch(o){console.error("Failed to connect to wifi device:",o),alert(`Failed to connect to ${s.name}. Please check the device and try again.`),T(u=>u.map(f=>f.id===s.id?{...f,status:"offline"}:f))}}async function ne(){H(!0);try{const s=await Je();B(s);const o=await Qe();o&&B(u=>[...u,o]),s.length===0&&!o&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(s){console.error("USB device discovery failed:",s),alert("Failed to discover USB devices. Please check device connections.")}finally{H(!1)}}async function b(s){try{B(u=>u.map(f=>f.id===s.id?{...f,status:"connecting"}:f));const o=await Ze(s);if(o&&r.current)r.current.srcObject=o,await r.current.play(),v(!0),U("wifi"),M(o,"wifi"),B(u=>u.map(f=>f.id===s.id?{...f,status:"online"}:f));else throw new Error("Failed to get video stream")}catch(o){console.error("Failed to connect to USB device:",o),alert(`Failed to connect to ${s.name}. Please check the device and try again.`),B(u=>u.map(f=>f.id===s.id?{...f,status:"offline"}:f))}}const E=d.useCallback(s=>{try{U(s==="usb"?"wifi":s),ue(Date.now());try{if(s==="local"){try{J(le,"Local",!0)}catch{}try{z(!0)}catch{}}else if(s==="phone"){try{J(void 0,"Phone Camera",!0)}catch{}try{z(!0)}catch{}}else if(s==="wifi"||s==="usb"){try{J(void 0,"WiFi/USB",!0)}catch{}try{z(!0)}catch{}}}catch{}s==="local"?V().catch(()=>{}):s==="phone"?ie():s==="wifi"?te():s==="usb"&&ne()}catch(o){console.warn("[CameraTile] handleModeSelect failed",o)}},[V,ie,te,ne,J,z,le]);d.useEffect(()=>{const s=o=>{try{const u=o&&o.detail&&o.detail.mode;u&&["local","phone","wifi","usb"].includes(u)?(E(u),V().catch(()=>{})):V().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",s),()=>{window.removeEventListener("ndn:start-camera",s)}},[V,E]);function D(){if(N&&N.readyState===WebSocket.OPEN)return N;const s=Fe(),o=new WebSocket(s);return S(o),o}async function ie(){U("phone"),A(!1);const s=D();s.readyState===WebSocket.OPEN?s.send(JSON.stringify({type:"cam-create"})):s.onopen=()=>s.send(JSON.stringify({type:"cam-create"})),s.onmessage=async o=>{const u=JSON.parse(o.data);if(u.type==="cam-code")R(u.code),u.expiresAt&&q(u.expiresAt);else if(u.type==="cam-peer-joined"){A(!0);const f=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});I(f),f.onicecandidate=Y=>{Y.candidate&&g&&s.send(JSON.stringify({type:"cam-ice",code:g,payload:Y.candidate}))},f.ontrack=Y=>{if(r.current){const Z=Y.streams?.[0];Z&&(r.current.srcObject=Z,r.current.play().catch(()=>{}),v(!0))}};const F=await f.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await f.setLocalDescription(F),g&&s.send(JSON.stringify({type:"cam-offer",code:g,payload:F}))}else if(u.type==="cam-answer")k&&await k.setRemoteDescription(new RTCSessionDescription(u.payload));else if(u.type==="cam-ice"&&k)try{await k.addIceCandidate(u.payload)}catch{}}}function je(){R(null),q(null),A(!1),N&&N.readyState===WebSocket.OPEN?N.send(JSON.stringify({type:"cam-create"})):ie();try{z(!0)}catch{}}function Ne(){if(Q(),R(null),A(!1),q(null),k){try{k.close()}catch{}I(null)}}return e.jsx(Xe,{label:a,autoStart:t,start:V,stopAll:Ne,startPhonePairing:ie,startWifiConnection:te,startUsbConnection:ne,connectToWifiDevice:fe,connectToUsbDevice:b,videoRef:r,streaming:y,mode:P,setMode:U,pairCode:g,mobileUrl:pe,regenerateCode:je,httpsInfo:c,showTips:j,setShowTips:C,wifiDevices:W,usbDevices:oe,discoveringWifi:K,discoveringUsb:X,scaleOverride:n,tileFitModeOverride:x,className:l,aspect:m,style:p,fill:h,onModeSelect:E,preferredCameraLocked:re})}function Xe(a){const t=we(),{cameraScale:n,cameraAspect:l}=O(),{label:m,start:p,stopAll:h,startPhonePairing:x,startWifiConnection:r,startUsbConnection:i,connectToWifiDevice:y,connectToUsbDevice:v,videoRef:N,streaming:S,mode:g,setMode:R,onModeSelect:k,pairCode:I,mobileUrl:L,regenerateCode:M,httpsInfo:$,showTips:P,setShowTips:U,wifiDevices:q,usbDevices:A,discoveringWifi:_,discoveringUsb:ce,scaleOverride:c,tileFitModeOverride:w,className:j,aspect:C,style:W,fill:T,preferredCameraLocked:K}=a,se={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},oe=d.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{k&&k("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{k&&k("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{k&&k("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{k&&k("usb")}}],[R,p,x,r,i]),[B,X]=d.useState(null),H=d.useRef(null);d.useEffect(()=>()=>{H.current&&window.clearTimeout(H.current)},[]);const{cameraFitMode:G}=O(),ae=w||(T?"fill":G||"fill"),z=(()=>{const b=Number(c??n??1),E=Math.max(.5,Math.min(2,b));return ae==="fill"?Math.max(1,E):E})(),re=T&&ae==="fill"?"free":C&&C!=="inherit"?C:l||"wide",J=re!=="free",le=J?re==="square"?"aspect-square":re==="portrait"?"aspect-[3/4]":re==="classic"?"aspect-[4/3]":"aspect-video":"",ee=[T?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",j].filter(Boolean).join(" ").trim(),ue={...W||{}},V=T?"relative flex-1 min-h-0 bg-black":"relative w-full bg-black",Q={style:{transform:`scale(${z})`,transformOrigin:"center"}},te=g==="wifi"&&A.some(b=>b.status==="online"),fe=(()=>{const E=ae==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return T?J?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${le}`,children:e.jsx("video",{ref:N,className:E,...Q})})}):e.jsx("video",{ref:N,className:E,...Q}):J?e.jsx("div",{className:`relative w-full ${le}`,children:e.jsx("video",{ref:N,className:E,...Q})}):e.jsx("div",{className:"relative w-full",children:e.jsx("video",{ref:N,className:E,...Q})})})();async function ne(b,E){if(b)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(b);else{const D=document.createElement("textarea");D.value=b,D.style.position="fixed",D.style.opacity="0",document.body.appendChild(D),D.focus(),D.select(),document.execCommand("copy"),document.body.removeChild(D)}X(E),H.current&&window.clearTimeout(H.current),H.current=window.setTimeout(()=>X(null),1500)}catch(D){console.warn("Copy to clipboard failed:",D),X(null)}}return e.jsxs("div",{className:ee,style:ue,children:[e.jsxs("div",{className:V,children:[fe,t.isStreaming&&g==="phone"&&e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{children:"REC"})]})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[e.jsxs("span",{className:"truncate font-medium",children:[m||(S?g==="phone"?"PHONE LIVE":g==="wifi"?"WIFI LIVE":"LIVE":"Camera"),K&&e.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!S&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${g==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("local"),children:"Local"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${g==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("phone"),children:"Phone"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${g==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("wifi"),children:"WiFi"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${g==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("usb"),children:"USB"})]}),S?e.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:h,children:"Stop"}):null]})]}),g==="phone"&&I&&!S&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>ne(L,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:L}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:B==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:L,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>ne(I,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:I}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:B==="code"?"Copied!":"Copy"})]})]}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:M,children:"Regenerate"})}),P&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wi-Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and"," ",$?.https?$.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>U(!1),children:"Hide tips"})})]})]}),g==="wifi"&&!S&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),_?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):q.length>0?e.jsxs("div",{className:"space-y-1",children:[q.map(b=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:b.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[b.ip,":",b.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${b.status==="connecting"?"bg-yellow-600":b.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>y(b),disabled:b.status==="connecting",children:b.status==="connecting"?"...":"Connect"})]},b.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:r,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:r,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),ce?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):A.length>0?e.jsxs("div",{className:"space-y-1",children:[A.map(b=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:b.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:b.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${b.status==="connecting"?"bg-yellow-600":b.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>v(b),disabled:b.status==="connecting",children:b.status==="connecting"?"...":"Connect ðŸ”Œ"})]},b.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:i,children:"Rescan USB ðŸ”"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found âŒ"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:i,children:"Scan USB ðŸ”"})]})]})]}),!S&&e.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes âš™ï¸"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera ðŸ”„"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",se[g]||"Local"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:oe.map(b=>{const E=b.id==="usb"?te:b.id===g;return e.jsxs("button",{type:"button",onClick:b.action,className:`text-left p-3 rounded-2xl border ${E?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:b.title}),e.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:b.description}),E&&e.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active âœ…"})]},b.id)})})]})]})}function me({label:a,value:t,className:n="",scale:l=1}){return e.jsxs("div",{className:`flex flex-col items-center gap-0 ${n}`,children:[e.jsx("div",{className:"text-[8px] opacity-70 uppercase font-bold tracking-tighter leading-none",children:a}),e.jsx("div",{className:"text-sm sm:text-base font-black transform transition-transform duration-200 ease-out leading-none",style:{transform:`scale(${l})`},children:t})]})}function ze({player:a,user:t,playerCalibrations:n}){const l=d.useRef(null),m=n[a.name],p=xe(r=>!!r.H),x=!!(t?.username&&a?.name&&a.name.toLowerCase()===t.username.toLowerCase()||a?.name==="You")?p:!!m;return d.useEffect(()=>{const r=l.current;if(!r)return;const i=r.getContext("2d");if(!i)return;const y=r.width/2,v=r.height/2,N=Math.min(y,v)-2;i.clearRect(0,0,r.width,r.height);try{typeof i.stroke=="function"&&(i.strokeStyle="#fff",i.lineWidth=1,i.beginPath(),i.arc(y,v,N,0,2*Math.PI),i.stroke()),typeof i.fill=="function"&&(i.fillStyle="#f00",i.beginPath(),i.arc(y,v,4,0,2*Math.PI),i.fill())}catch{}if(x)try{typeof i.fill=="function"&&(i.fillStyle="#0f0"),[[y-N*.5,v],[y+N*.5,v],[y,v-N*.5],[y,v+N*.5]].forEach(([g,R])=>{try{typeof i.beginPath=="function"&&i.beginPath(),typeof i.arc=="function"&&i.arc(g,R,2,0,2*Math.PI),typeof i.fill=="function"&&i.fill()}catch{}})}catch{}},[x]),e.jsxs("div",{className:"flex items-center gap-2 mt-1 bg-white/5 p-1.5 rounded-lg border border-white/10",children:[e.jsx("canvas",{ref:l,width:40,height:40,className:"border border-white/20 rounded-md bg-black/60 shadow-inner"}),e.jsx("span",{className:`text-xs font-black tracking-tight ${x?"text-emerald-400":"text-rose-400/70"}`,children:x?"Calibrated âœ…":"Not Calibrated âŒ"})]})}function et({player:a,limit:t=3}){const n=[];try{const l=a.legs||[];for(let m=l.length-1;m>=0&&n.length<t;m--){const h=l[m].visits||[];for(let x=h.length-1;x>=0&&n.length<t;x--){const r=h[x];n.push({score:Number(r?.score||0),darts:Number(r?.darts||3)})}}}catch{}return n.length?e.jsx("div",{className:"flex gap-1 items-center",children:n.map((l,m)=>e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded-md font-black shadow-sm ${l.score>=100?"bg-emerald-600/70 text-emerald-300 ring-1 ring-emerald-500/50":l.score>=60?"bg-amber-500/60 text-amber-300 ring-1 ring-amber-500/50":"bg-white/20 text-gray-200 ring-1 ring-white/20"}`,children:l.score},m))}):e.jsx("div",{className:"text-[10px] opacity-60",children:"No visits ðŸ“‰"})}function tt({secondsLeft:a,totalSeconds:t,size:n=60,stroke:l=6,color:m="emerald"}){const p=(n-l)/2,h=2*Math.PI*p,x=Math.max(0,Math.min(1,t>0?a/t:0)),r=h*(1-x),i=m==="emerald"?"#34d399":"#f59e0b";return e.jsxs("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,"aria-hidden":!0,children:[e.jsx("defs",{children:e.jsx("filter",{id:"softShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"3",floodColor:"#000",floodOpacity:"0.45"})})}),e.jsx("circle",{cx:n/2,cy:n/2,r:p,fill:"transparent",stroke:"rgba(255,255,255,0.06)",strokeWidth:l}),e.jsx("circle",{cx:n/2,cy:n/2,r:p,fill:"transparent",stroke:i,strokeWidth:l,strokeLinecap:"round",strokeDasharray:h,strokeDashoffset:r,transform:`rotate(-90 ${n/2} ${n/2})`,style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.4))"}}),e.jsx("text",{x:"50%",y:"50%",fill:"white",fontSize:n*.28,fontWeight:900,dominantBaseline:"middle",textAnchor:"middle",children:a>0?a:"GO! ðŸš€"})]})}function ot({open:a=!0,players:t,user:n,onDone:l,onRequestClose:m,initialSeconds:p=15,showCalibrationDefault:h=!1,disableEscClose:x=!1}){const[r,i]=d.useState(p||15),y=!!a,[v,N]=d.useState(!1),[S,g]=d.useState(()=>{const c={};if(!h)for(const w of t)c[w.id]=!0;return c}),[R,k]=d.useState({}),I=d.useRef(null),L=d.useRef(null),M=d.useRef(null),$=d.useRef(null),P=d.useRef(!1);d.useEffect(()=>(P.current=!0,()=>{P.current=!1}),[]),d.useEffect(()=>{h||g(c=>{const w={...c};for(const j of t)w[j.id]||(w[j.id]=!0);return w})},[t,h]);const U=t.every(c=>S[c.id]);d.useEffect(()=>{if(!y)return;try{setTimeout(()=>{try{L.current?.focus()}catch{}},0)}catch{}try{$.current=document.activeElement}catch{}const c=document.getElementById("root");try{c&&c.setAttribute("aria-hidden","true")}catch{}const w=U?setInterval(()=>i(C=>C-1),1e3):null,j=C=>{if(P.current&&!x&&(C.key==="Escape"||C.key==="Esc")){C.preventDefault();try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}try{$.current?.focus()}catch{}}};return document.addEventListener("keydown",j),()=>{try{c&&c.removeAttribute("aria-hidden")}catch{}w&&clearInterval(w),document.removeEventListener("keydown",j)}},[y,l,U]),d.useEffect(()=>{y&&(h&&r===(p||15)&&!v&&(N(!0),(async()=>{const w={};for(const j of t)if(n?.username&&j.name===n.username){const{H:C,imageSize:W,overlaySize:T,locked:K}=xe.getState();C&&(w[j.name]={H:C,imageSize:W,overlaySize:T,locked:K})}else try{const C=await fetch(`/api/users/${encodeURIComponent(j.name)}/calibration`);if(C.ok){const W=await C.json();W.calibration&&(w[j.name]=W.calibration)}}catch(C){console.warn("Failed to fetch calibration for",j.name,C)}k(w)})()),U&&r<=0&&setTimeout(()=>{try{l?.()}catch{}try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}try{$.current?.focus()}catch{}},1e3))},[r,l,y,v,U,t,n]);const q=d.useMemo(()=>t.map(c=>{try{const w=Te(c.name),j=Re(c.name),C=Ue(c.name),W=Ae(c.name),T=Ie(c.name),K=T.scored||0,se=T.darts||0,oe=Le(c.name);let B=0;try{for(const H of c.legs||[])for(const G of H.visits||[])Number(G.score||0)===180&&(B+=1)}catch{}const X=`${B}/${oe}`;return{id:c.id,name:c.name,avg3:w.toFixed(1),best9:j.toFixed(1),bestCheckout:C,bestLeg:W,one80s:X,lifetimeScored:K,lifetimeDarts:se}}catch{return{id:c.id,name:c.name,avg3:"â€”",best9:"â€”",bestCheckout:"â€”",bestLeg:"â€”",one80s:"â€”",lifetimeScored:0,lifetimeDarts:0}}}),[t]),A=d.useRef(typeof document<"u"?document.createElement("div"):null);if(d.useLayoutEffect(()=>{if(!A.current)return;const c=A.current;c.className="ndn-match-start-portal";try{Array.from(document.querySelectorAll(".ndn-match-start-portal")).forEach(j=>{try{j.parentNode?.removeChild(j)}catch{}})}catch{}return document.body.appendChild(c),()=>{try{c&&c.parentNode&&c.parentNode.removeChild(c)}catch{}}},[]),!y)return null;const _=c=>c<=0?1.8:c===1?1.6:c===2?1.4:c===3?1.2:1,ce=e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 backdrop-blur-sm",children:e.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"match-start-heading",tabIndex:-1,className:"w-full max-w-4xl",children:e.jsx(Be,{returnFocus:!0,children:e.jsxs("div",{ref:I,className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-indigo-500/20 via-purple-500/20 to-emerald-500/20 rounded-[3rem] blur-3xl -z-10 opacity-50 animate-pulse"}),e.jsxs("div",{className:"bg-[#13111C] border border-white/10 rounded-3xl p-4 md:p-6 w-full shadow-2xl ring-1 ring-white/5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none mix-blend-overlay"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-center justify-between gap-3 mb-4 border-b border-white/5 pb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold text-indigo-400 uppercase tracking-widest mb-0.5",children:"Get Ready ðŸš€"}),e.jsx("div",{id:"match-start-heading",className:"text-2xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/10 tracking-tighter",children:"Match Starting Soon ðŸŽ¯"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500/70 blur-[4rem] rounded-full animate-pulse"}),e.jsxs("div",{className:"relative",children:[e.jsx(tt,{secondsLeft:r,totalSeconds:p||15,size:60,stroke:6,color:r>5?"emerald":"amber"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-black text-white tabular-nums",children:r})})]})]})}),e.jsxs("div",{className:"flex flex-col gap-1.5 sm:flex-row",children:[e.jsx("button",{ref:L,className:"px-4 py-1.5 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40 hover:scale-105 transition-all duration-200 active:scale-95 text-xs",onClick:()=>{try{l?.()}catch{}try{try{document.getElementById("root")?.removeAttribute("aria-hidden")}catch{}setTimeout(()=>{try{m?.()}catch{}},0)}catch{}},"aria-label":"Start match now",children:"Start Now â–¶ï¸"}),e.jsx("button",{ref:M,className:"px-3 py-1.5 rounded-lg bg-white/5 text-white/70 font-semibold hover:bg-white/10 hover:text-white transition-colors text-xs",onClick:()=>{try{m?.()}catch{}},children:"Close âœ–ï¸"})]})]})]}),e.jsxs("div",{className:"relative grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-5 mb-4",children:[e.jsx("div",{className:"hidden md:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-20 w-16 h-16 bg-[#13111C] rounded-full items-center justify-center border-2 border-white/10 shadow-[0_0_30px_rgba(0,0,0,0.8)]",children:e.jsx("span",{className:"text-xl font-black text-white/20 italic tracking-tighter",children:"VS âš”ï¸"})}),q.map((c,w)=>e.jsxs("div",{className:`group relative p-3 md:p-4 rounded-3xl border border-white/5 flex flex-col items-center shadow-xl transition-all duration-300 hover:border-white/10 hover:bg-white/[0.02] max-h-[80vh] overflow-hidden ${w===0?"bg-gradient-to-br from-indigo-500/5 to-transparent":"bg-gradient-to-bl from-emerald-500/5 to-transparent"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 w-full",children:[e.jsx("div",{className:`w-12 h-12 shrink-0 rounded-xl rotate-3 group-hover:rotate-6 transition-transform duration-300 flex items-center justify-center text-xl font-black text-white shadow-lg ring-2 ring-white/10 ${w===0?"bg-gradient-to-br from-indigo-500 to-purple-600 shadow-indigo-500/50":"bg-gradient-to-br from-emerald-500 to-teal-600 shadow-emerald-500/50"}`,children:c.name.split(" ").map(j=>j[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsxs("div",{className:"text-2xl font-black text-white tracking-tighter truncate",children:[c.name," ðŸ‘¤"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n&&n.username===c.name&&e.jsx("div",{className:"text-[0.5rem] font-bold uppercase tracking-wider bg-white/10 text-white/60 px-1.5 py-0.5 rounded-md",children:"You â­"}),e.jsx(ze,{player:t.find(j=>j.id===c.id),user:n,playerCalibrations:R})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 w-full bg-black/50 rounded-xl p-2 border border-white/10 shadow-2xl",children:[e.jsx(me,{label:"Avg ðŸ“Š",value:c.avg3,scale:_(r)*.7,className:"p-0.5"}),e.jsx(me,{label:"F9 ðŸ“ˆ",value:c.best9,scale:_(r)*.7,className:"p-0.5"}),e.jsx(me,{label:"CO ðŸ†",value:c.bestCheckout||"â€”",scale:_(r)*.7,className:"p-0.5"}),e.jsx(me,{label:"Leg âš¡",value:c.bestLeg||"â€”",scale:_(r)*.7,className:"p-0.5"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full mt-2 text-[0.6rem]",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"tracking-widest uppercase text-white/40",children:"Lifetime pts"}),e.jsx("span",{className:"text-white/90 font-semibold",children:c.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"tracking-widest uppercase text-white/40",children:"Lifetime darts"}),e.jsx("span",{className:"text-white/90 font-semibold",children:c.lifetimeDarts.toLocaleString()})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between w-full px-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/40 font-black",children:[e.jsx("span",{children:"180s ðŸ”¥:"}),e.jsxs("span",{className:"text-white/90",children:[c.one80s," âœ¨"]})]}),e.jsx(et,{player:t.find(j=>j.id===c.id),limit:3})]}),w===0&&e.jsx("div",{className:"w-full mt-2",children:e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/30",children:e.jsx("div",{className:"w-full h-[200px] sm:h-[250px] md:h-[320px] flex flex-col",children:e.jsx(Ke,{autoStart:!0,fill:!0,aspect:"wide",tileFitModeOverride:"fit",scale:1})})})})]},c.id))]}),e.jsx("div",{className:"text-center pt-6 border-t border-white/50",children:r<=1?e.jsx("div",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 via-cyan-400 to-blue-400 animate-bounce tracking-tighter py-4",children:"GAME ON! ðŸš€"}):e.jsxs("div",{className:"text-lg font-black text-white/80 uppercase tracking-[1em]",children:[t.map(c=>c.name).join(" vs ")," âš”ï¸"]})})]})]})})})});return De.createPortal(e.jsxs(e.Fragment,{children:[v&&e.jsx(Me,{players:t,playerCalibrations:R,calibrationSkipped:S,onSkip:c=>g(w=>({...w,[c]:!0})),onOpenCalibrator:c=>{g(w=>({...w,[c]:!1}));try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:"calibrate"}}))}catch{}try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}},onClose:()=>{N(!1)}}),ce]}),A.current)}export{Ke as C,ct as G,ot as M};
//# sourceMappingURL=MatchStartShowcase-MzvId03J.js.map

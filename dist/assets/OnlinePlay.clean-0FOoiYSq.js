import{y as Ee,i as Je,u as kt,x as Ct,I as St,r as st,j as e,t as $,J as Et,K as Qe,L as Mt,B as at,b as Tt,N as Lt,O as It,Q as _t,g as Pt,S as Bt,F as Ot,k as I,l as Me,M as Dt}from"./index-B57aKmL2.js";import{r as a,X as Rt,p as ue,I as Ft,J as At,Z as Ge,C as Ue,o as $t,R as Z,T as Wt,K as Gt,U as He,v as Ke,h as Ze}from"./ui-Cl5S-Tv0.js";import{o as Ut,I as Vt,l as zt}from"./matchWindow-CLGQRRUv.js";import"./vendor-D3F3s8fL.js";import"./aroundTheClock-DY6sitx7.js";function qt({open:o,onClose:i,onCreate:x}){const[p]=a.useState(()=>document.createElement("div")),[m,v]=a.useState("X01"),[l,D]=a.useState("bestof"),[W,f]=a.useState(3),u=a.useRef(null),[k,g]=a.useState(0),[L,_]=a.useState(()=>Ee(m)?.[0]),[P,h]=a.useState(()=>Je(m)),N=kt().username||"Anonymous";function E(r){v(r);const d=Ee(r);_(d?.[0]),h(Je(r));const w=Qe[r];if(w?.modeOptions?.length){const U=w.modeOptions.includes(l)?l:w.modeOptions[0];D(U)}}a.useLayoutEffect(()=>(p.className="ndn-create-match-portal",document.body.appendChild(p),()=>{try{p&&p.remove()}catch{}}),[p]),a.useLayoutEffect(()=>{function r(d){d.key==="Escape"&&i()}return o&&document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[o,i]);const G=Ct(m),R=St(m,l),c=$(m),j=()=>{const r={createdBy:N,game:m,modeType:l,legs:W,avgChoice:k,startingScore:L,...P};x(r),i()};return!o||!p?null:st.createPortal(e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-2 sm:p-6",children:[e.jsx("button",{"aria-label":"Close dialog",className:"absolute inset-0 w-full h-full bg-transparent",onClick:i}),e.jsxs("div",{className:"rounded-2xl p-5 sm:p-6 max-w-lg w-full relative text-white shadow-2xl border border-indigo-500/30 max-h-[85vh] overflow-y-auto",style:{background:"var(--ndn-card-bg, #0f172a)"},role:"dialog",children:[e.jsx("button",{"aria-label":"Close",className:"absolute top-3 right-3 w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors",onClick:i,children:"‚úï"}),e.jsxs("h2",{className:"text-base sm:text-lg font-bold tracking-tight mb-3",children:[c.emoji," Create Match"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Created By"}),e.jsx("div",{className:"p-2 rounded-lg border border-indigo-500/20 bg-indigo-500/10 text-sm text-white",children:N})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-game",children:"Game"}),e.jsx("select",{id:"match-game",className:"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white",value:m,onChange:r=>E(r.target.value),onPointerDown:r=>{r.stopPropagation()},onMouseDown:r=>{r.stopPropagation()},onTouchStart:r=>{r.stopPropagation?.()},children:Et.map(r=>{const d=$(r);return e.jsxs("option",{value:r,className:"bg-slate-900 text-white",children:[d.emoji," ",r]},r)})}),c.tagline&&e.jsx("div",{className:"text-[10px] mt-0.5 px-0.5",style:{color:c.color},children:c.tagline})]}),Ee(m).length>0?e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-start",children:`${m} Starting Score`}),e.jsx("select",{id:"match-start",className:"p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white w-full",value:L,onChange:r=>_(Number(r.target.value)),onPointerDown:r=>{r.stopPropagation()},onMouseDown:r=>{r.stopPropagation()},onTouchStart:r=>{r.stopPropagation?.()},children:Ee(m).map(r=>e.jsx("option",{value:r,className:"bg-slate-900 text-white",children:r},r))})]}):null,G.length>0&&e.jsx("div",{className:"space-y-2",children:G.map(r=>e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:`match-extra-${r.key}`,children:r.label}),r.type==="select"&&r.options?e.jsx("select",{id:`match-extra-${r.key}`,className:"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white",value:P[r.key]??r.defaultValue,onChange:d=>h(w=>({...w,[r.key]:Number(d.target.value)})),onPointerDown:d=>{d.stopPropagation()},onMouseDown:d=>{d.stopPropagation()},onTouchStart:d=>{d.stopPropagation?.()},children:r.options.map(d=>e.jsx("option",{value:d,className:"bg-slate-900 text-white",children:d},d))}):e.jsx("input",{id:`match-extra-${r.key}`,type:"number",min:r.min??1,max:r.max,step:r.step??1,value:P[r.key]??r.defaultValue,onChange:d=>h(w=>({...w,[r.key]:Number(d.target.value)})),className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"}),r.hint&&e.jsx("div",{className:"text-[10px] text-slate-400 mt-0.5 px-0.5",children:r.hint})]},r.key))}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Mode"}),e.jsx("div",{className:"flex gap-2 mt-1 justify-center flex-wrap",children:(Qe[m]?.modeOptions??["bestof","firstto"]).map(r=>e.jsxs("label",{className:`btn ${l===r?"btn-primary":"btn-ghost"}`,children:[e.jsx("input",{type:"radio",name:"mode",value:r,checked:l===r,onChange:()=>{D(r),f(r==="bestof"?d=>{const w=Math.max(1,d||3);return w%2===1?w:w+1}:d=>Math.max(1,d||3)),setTimeout(()=>u.current?.focus(),0)},className:"sr-only"})," ",r==="bestof"?"Best Of":r==="firstto"?"First To":r==="innings"?"Innings":r==="holes"?"Holes":r==="rounds"?"Rounds":r==="practice"?"Practice":r]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-legs",children:R}),e.jsx("input",{id:"match-legs",type:"number",min:1,value:W,onChange:r=>f(Math.max(1,Number(r.target.value||1))),ref:u,className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-avg",children:"Average Choice (¬±)"}),e.jsx("input",{id:"match-avg",type:"number",value:k,onChange:r=>g(Number(r.target.value||0)),className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-3 border-t border-indigo-500/20",children:[e.jsx("button",{className:"flex-1 btn btn-ghost text-xs",onClick:i,children:"Cancel"}),e.jsx("button",{className:"flex-1 btn text-xs",onClick:j,children:"Create Match"})]})]})]}),p)}const ee=400,S=ee/2,T=ee/2,Xt=6.35,re=15.9,Ae=99,$e=107,We=162,Le=170,O=(ee/2-15)/Le,rt=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5],nt={};rt.forEach((o,i)=>{nt[o]=i%2===0?{dark:"#1a1a2e",light:"#c0392b"}:{dark:"#f0e6d3",light:"#27ae60"}});function et(o){try{const i=Tt(o).toFixed(1),x=Lt(o).toFixed(1),p=It(o),m=_t(o),v=Pt(o),l=Bt(o);return{avg3:i,best9:x,bestCheckout:p||"‚Äì",bestLeg:m||"‚Äì",lifetimeScored:v.scored||0,lifetimeDarts:v.darts||0,career180s:l||0}}catch{return{avg3:"0.0",best9:"0.0",bestCheckout:"‚Äì",bestLeg:"‚Äì",lifetimeScored:0,lifetimeDarts:0,career180s:0}}}function me(o,i,x,p){const m=(p-90)*Math.PI/180;return{x:o+x*Math.cos(m),y:i+x*Math.sin(m)}}function Yt(o,i){const x=o-S,p=i-T;return Math.sqrt(x*x+p*p)/O}function Te({label:o,value:i,highlight:x}){return e.jsxs("div",{className:`flex flex-col items-center px-1.5 py-1 rounded-lg ${x?"bg-indigo-500/20 ring-1 ring-indigo-500/30":"bg-white/5"}`,children:[e.jsx("span",{className:"text-[7px] sm:text-[8px] uppercase tracking-wider font-bold text-white/50",children:o}),e.jsx("span",{className:`text-xs sm:text-sm font-black ${x?"text-indigo-300":"text-white"}`,children:i})]})}function Jt({onSelect:o,selectedPoint:i,disabled:x,label:p}){const m=a.useRef(null),v=a.useCallback((f,u)=>{const k=m.current;if(!k)return null;const g=k.getBoundingClientRect(),L=(f-g.left)/g.width*ee,_=(u-g.top)/g.height*ee,P=Yt(L,_);return{x:L,y:_,dist:Math.round(P*10)/10}},[]),l=a.useCallback(f=>{if(x)return;const u=v(f.clientX,f.clientY);u&&o(u.x,u.y,u.dist)},[o,x,v]),D=a.useCallback(f=>{if(x)return;f.preventDefault();const u=f.changedTouches[0];if(!u)return;const k=v(u.clientX,u.clientY);k&&o(k.x,k.y,k.dist)},[o,x,v]),W=a.useMemo(()=>{const f=[];for(let k=0;k<20;k++){const g=rt[k],L=k*18-18/2,_=L+18,P=nt[g];[{inner:$e,outer:We,fill:P.dark},{inner:We,outer:Le,fill:P.light},{inner:re,outer:Ae,fill:P.dark},{inner:Ae,outer:$e,fill:P.light}].forEach((E,G)=>{const R=E.inner*O,c=E.outer*O,j=me(S,T,R,L),r=me(S,T,c,L),d=me(S,T,c,_),w=me(S,T,R,_),U=0,B=[`M ${j.x} ${j.y}`,`L ${r.x} ${r.y}`,`A ${c} ${c} 0 ${U} 1 ${d.x} ${d.y}`,`L ${w.x} ${w.y}`,`A ${R} ${R} 0 ${U} 0 ${j.x} ${j.y}`,"Z"].join(" ");f.push(e.jsx("path",{d:B,fill:E.fill,stroke:"rgba(255,255,255,0.08)",strokeWidth:.5,opacity:.85},`s${g}-r${G}`))});const N=me(S,T,(Le+12)*O,k*18);f.push(e.jsx("text",{x:N.x,y:N.y,textAnchor:"middle",dominantBaseline:"central",fill:"rgba(255,255,255,0.8)",fontSize:"11",fontWeight:"bold",fontFamily:"system-ui, sans-serif",children:g},`label-${g}`))}return f},[]);return e.jsxs("div",{className:"relative",children:[p&&e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${x&&i?"text-emerald-400":"text-white/50"}`,children:p})}),e.jsxs("svg",{ref:m,viewBox:`0 0 ${ee} ${ee}`,className:`w-full h-full touch-none select-none ${x?"pointer-events-none":"cursor-crosshair"}`,style:{opacity:x&&!i?.5:1},onClick:l,onTouchEnd:D,children:[e.jsx("circle",{cx:S,cy:T,r:S,fill:"#0a0a1a"}),W,e.jsx("circle",{cx:S,cy:T,r:Ae*O,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:S,cy:T,r:$e*O,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:S,cy:T,r:We*O,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:S,cy:T,r:Le*O,fill:"none",stroke:"rgba(192,192,192,0.2)",strokeWidth:1}),e.jsx("circle",{cx:S,cy:T,r:re*O,fill:"#27ae60",stroke:"rgba(192,192,192,0.2)",strokeWidth:.8}),e.jsx("circle",{cx:S,cy:T,r:Xt*O,fill:"#c0392b",stroke:"rgba(192,192,192,0.2)",strokeWidth:.8}),!i&&!x&&e.jsxs("circle",{cx:S,cy:T,r:re*O*1.8,fill:"none",stroke:"rgba(234,179,8,0.4)",strokeWidth:1.5,strokeDasharray:"4,4",children:[e.jsx("animate",{attributeName:"r",values:`${re*O*1.5};${re*O*2.2};${re*O*1.5}`,dur:"2s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",values:"0.5;0.15;0.5",dur:"2s",repeatCount:"indefinite"})]}),e.jsx("line",{x1:S-6,y1:T,x2:S+6,y2:T,stroke:"rgba(255,255,255,0.25)",strokeWidth:.5}),e.jsx("line",{x1:S,y1:T-6,x2:S,y2:T+6,stroke:"rgba(255,255,255,0.25)",strokeWidth:.5}),i&&e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:S,y1:T,x2:i.x,y2:i.y,stroke:x?"rgba(34,197,94,0.6)":"rgba(234,179,8,0.5)",strokeWidth:1,strokeDasharray:"3,3"}),e.jsx("circle",{cx:i.x+1,cy:i.y+1,r:6,fill:"rgba(0,0,0,0.4)"}),e.jsx("circle",{cx:i.x,cy:i.y,r:6,fill:x?"#22c55e":"#eab308",stroke:"#fff",strokeWidth:2,className:"drop-shadow-lg"}),e.jsx("circle",{cx:i.x,cy:i.y,r:2.5,fill:"#fff"}),x&&e.jsx("text",{x:i.x,y:i.y-14,textAnchor:"middle",fill:"#22c55e",fontSize:"10",fontWeight:"bold",children:"üîí"})]})]})]})}function tt({name:o,stats:i,isLocal:x,showCamera:p,isWinner:m,legDiff:v}){const l=typeof v=="number"?`${v>0?"+":""}${v}`:null;return e.jsxs("div",{className:`relative rounded-xl border p-2 sm:p-3 transition-all duration-500 ${m?"border-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/5 shadow-xl shadow-amber-500/10 ring-1 ring-amber-400/30":"border-white/10 bg-white/5"}`,children:[m&&e.jsxs("div",{className:"absolute -top-2.5 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-amber-500 text-black text-[9px] font-black uppercase tracking-widest rounded-full shadow-lg",children:[e.jsx($t,{className:"w-2.5 h-2.5 inline mr-0.5"}),"Throws First"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-black ${x?"bg-gradient-to-br from-indigo-500 to-purple-600 text-white":"bg-gradient-to-br from-rose-500 to-orange-500 text-white"}`,children:o.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-sm sm:text-base tracking-tight",children:o}),e.jsx("div",{className:"text-[9px] text-white/50 font-semibold uppercase tracking-wider",children:x?"You":"Opponent"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 mb-2",children:[e.jsx(Te,{label:"Avg",value:i.avg3,highlight:!0}),e.jsx(Te,{label:"F9",value:i.best9}),e.jsx(Te,{label:"CO",value:String(i.bestCheckout)}),e.jsx(Te,{label:"Leg Diff",value:l??"0"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[9px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"180s"}),e.jsx("span",{className:"font-bold text-white",children:i.career180s})]}),e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Scored"}),e.jsx("span",{className:"font-bold text-white",children:i.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Darts"}),e.jsx("span",{className:"font-bold text-white",children:i.lifetimeDarts.toLocaleString()})]})]}),p&&e.jsxs("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/40",children:[e.jsxs("div",{className:"px-2 py-1 flex items-center gap-1.5 text-[9px] text-white/60 border-b border-white/5",children:[e.jsx(Ue,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-semibold uppercase tracking-wider",children:x?"Your Camera":"Opponent Camera"}),e.jsx("span",{className:"ml-auto text-emerald-400 font-bold",children:"‚óè Live"})]}),e.jsx("div",{className:"aspect-video relative bg-black",children:x?e.jsx(at,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",tileFitModeOverride:"fit",scale:1}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/30 text-[10px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ue,{className:"w-6 h-6 mx-auto mb-1 opacity-30"}),"Waiting for opponent's feed‚Ä¶"]})})})]})]})}function Qt({open:o,matchInfo:i,localUser:x,opponentName:p,opponentStats:m,countdown:v=15,onChoice:l,onBullThrow:D,onAccept:W,onCancel:f,remoteChoice:u,bullActive:k,bullWinner:g,bullTied:L}){const[_,P]=a.useState(v),[h,N]=a.useState("preview"),[E,G]=a.useState(null),[R,c]=a.useState(null),[j,r]=a.useState(null),[d,w]=a.useState(!1),[U,B]=a.useState(!1),F=a.useRef(typeof document<"u"?document.createElement("div"):null),Ve=a.useMemo(()=>et(x?.username||""),[x?.username]),Ie=a.useMemo(()=>m?{avg3:m.avg3||"0.0",best9:m.best9||"0.0",bestCheckout:m.bestCheckout||"‚Äì",bestLeg:m.bestLeg||"‚Äì",career180s:m.career180s||0,lifetimeScored:0,lifetimeDarts:0}:et(p),[p,m]);a.useEffect(()=>{const y=F.current;if(!(!y||typeof document>"u"))return y.className="ndn-match-prestart-portal",document.body.appendChild(y),()=>{try{y.parentNode?.removeChild(y)}catch{}}},[]),a.useEffect(()=>{o&&(P(v),N("preview"),G(null),c(null),r(null),w(!1),B(!1))},[o,v]),a.useEffect(()=>{if(!o||h==="result"||h==="go")return;const y=window.setInterval(()=>{P(ge=>{const J=ge-1;return J<=0?(window.clearInterval(y),h==="preview"?(N("choice"),v):(h==="choice"&&!E&&(G("skip"),l("skip")),0)):(h==="preview"&&v-J>=5&&N("choice"),J)})},1e3);return()=>window.clearInterval(y)},[o,h,v,E,l]),a.useEffect(()=>{k&&(N("bull"),c(null),r(null),w(!1),B(!1))},[k]),a.useEffect(()=>{if(g){N("result");const y=setTimeout(()=>N("go"),3e3);return()=>clearTimeout(y)}},[g]),a.useEffect(()=>{L&&(c(null),r(null),w(!1),B(!1),N("bull"))},[L]),a.useEffect(()=>{if(E==="skip"&&u==="skip"){N("result");const y=setTimeout(()=>N("go"),2e3);return()=>clearTimeout(y)}},[E,u]),a.useEffect(()=>{if(h!=="go")return;const y=setTimeout(()=>{W()},1500);return()=>clearTimeout(y)},[h,W]);const fe=a.useCallback((y,ge,J)=>{d||(c({x:y,y:ge}),r(J),w(!0))},[d]),pe=a.useCallback(()=>{j!=null&&(B(!0),D(j))},[j,D]),_e=a.useCallback(y=>{G(y),l(y)},[l]),A=x?.username||"You",V=a.useMemo(()=>Mt(A,p),[A,p]),ne=V.played?V.diffA:null,Pe=V.played?V.diffB:null;if(!o||!F.current||!i)return null;const z=g===A,Be=g===p,q=E==="skip"&&u==="skip",Oe=e.jsxs("div",{className:"fixed inset-0 z-[9998] bg-black/95 backdrop-blur-xl flex flex-col",style:{height:"100dvh",maxHeight:"100dvh",overflow:"hidden"},role:"dialog","aria-modal":"true","aria-label":"Match pre-start",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-2 sm:p-4 min-h-0",children:e.jsxs("div",{className:"relative w-full max-w-5xl max-h-full flex flex-col",children:[e.jsx("button",{className:"absolute -top-2 -right-2 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition-all border border-white/10",onClick:f,"aria-label":"Cancel match",children:e.jsx(Rt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-2 sm:mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] sm:text-[11px] font-bold uppercase tracking-widest text-white/60 mb-2",children:[e.jsx(ue,{className:"w-3 h-3"}),i.game," ¬∑"," ",i.modeType==="bestof"?"Best Of":"First To"," ",i.legs," ¬∑ ",i.startingScore||501]}),h==="preview"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tighter",children:"Match Found"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:"Reviewing opponent stats‚Ä¶"})]}),h==="choice"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white tracking-tighter",children:"Who Throws First?"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:"Bull up to decide, or skip and let the creator go first"})]}),h==="bull"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-amber-300 tracking-tighter",children:"üéØ Bull Up!"}),e.jsx("p",{className:"text-[10px] sm:text-xs text-white/50 mt-0.5",children:"Throw your dart at the bullseye, then tap where it landed on the board"}),e.jsx("p",{className:"text-[9px] text-white/30",children:"Both players mark their throw ‚Äî closest to the bull throws first"})]}),h==="result"&&e.jsx("div",{className:"animate-in fade-in zoom-in-95 duration-700",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-amber-500 tracking-tighter",children:["üéâ ",g," Wins the Bull!"]}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/50 mt-1",children:[g," throws first"]})]}):q?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white tracking-tighter",children:"Both Players Skipped"}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:[i.createdBy||i.creatorName||A," ","throws first"]})]}):null}),h==="go"&&e.jsx("div",{className:"animate-in fade-in zoom-in-50 duration-300",children:e.jsx("h2",{className:"text-5xl sm:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500 tracking-tighter",children:"GO!"})})]}),h!=="result"&&h!=="go"&&e.jsxs("div",{className:"mb-2 sm:mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ft,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white/40"}),e.jsx("span",{className:"text-xl sm:text-2xl font-black text-white tabular-nums",children:_}),e.jsx("span",{className:"text-[10px] sm:text-xs text-white/40 font-semibold",children:"seconds"})]}),e.jsx("div",{className:"h-0.5 sm:h-1 bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000 ease-linear",style:{width:`${_/v*100}%`}})})]}),(h==="preview"||h==="choice"||h==="result")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-2 sm:gap-4 items-start mb-2 sm:mb-4 flex-shrink-0",children:[e.jsx(tt,{name:A,stats:Ve,isLocal:!0,showCamera:h==="preview",legDiff:ne,isWinner:h==="result"&&(z||q&&(i.createdBy===A||i.creatorName===A))}),e.jsxs("div",{className:"hidden md:flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-indigo-500/30 ring-2 ring-white/10",children:"VS"}),e.jsx("div",{className:"w-px h-12 bg-gradient-to-b from-indigo-500/30 to-transparent mt-2"})]}),e.jsx("div",{className:"flex md:hidden items-center justify-center py-2",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-xl shadow-indigo-500/30",children:"VS"})}),e.jsx(tt,{name:p,stats:Ie,isLocal:!1,showCamera:h==="preview",legDiff:Pe,isWinner:h==="result"&&(Be||q&&(i.createdBy===p||i.creatorName===p))})]}),h==="choice"&&!E&&e.jsx("div",{className:"flex flex-col items-center gap-3 animate-in fade-in slide-in-from-bottom-4 duration-500 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{className:"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 text-white font-black text-base sm:text-lg hover:shadow-xl hover:shadow-amber-500/30 hover:scale-105 transition-all duration-200 border border-amber-400/30",onClick:()=>_e("bull"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Bull Up"})]}),e.jsx("div",{className:"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-80",children:"Throw at the bullseye to decide"})]}),e.jsxs("button",{className:"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-white/5 border border-white/10 text-white font-bold text-base sm:text-lg hover:bg-white/10 hover:border-white/20 hover:scale-105 transition-all duration-200",onClick:()=>_e("skip"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-5 h-5"}),e.jsx("span",{children:"Skip"})]}),e.jsx("div",{className:"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-50",children:"Creator throws first"})]})]})}),h==="choice"&&E&&!k&&e.jsx("div",{className:"text-center animate-in fade-in duration-300",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-white/70",children:[e.jsx(Ge,{className:"w-4 h-4 text-amber-400"}),"You chose"," ",e.jsx("span",{className:"font-bold text-white",children:E==="bull"?"Bull Up":"Skip"}),u?e.jsxs(e.Fragment,{children:[" ","¬∑ Opponent chose"," ",e.jsx("span",{className:"font-bold text-white",children:u==="bull"?"Bull Up":"Skip"})]}):e.jsxs(e.Fragment,{children:[" ","¬∑ Waiting for opponent",e.jsx("span",{className:"animate-pulse",children:"‚Ä¶"})]})]})}),h==="bull"&&e.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-3 animate-in fade-in zoom-in-95 duration-500 flex-1 min-h-0 overflow-hidden",children:[e.jsx("div",{className:"w-full max-w-[280px] sm:max-w-sm mx-auto rounded-xl border border-white/10 bg-black/60 overflow-hidden shadow-xl shadow-black/40 flex-shrink-0",children:e.jsxs("div",{className:"relative aspect-[16/10]",children:[e.jsx(at,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",className:"w-full h-full"}),e.jsxs("div",{className:"absolute top-1 left-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-black/60 backdrop-blur-sm border border-white/10",children:[e.jsx(Ue,{className:"w-2.5 h-2.5 text-emerald-400"}),e.jsx("span",{className:"text-[9px] font-bold text-white/80 uppercase tracking-wider",children:"Live Feed"})]}),e.jsx("div",{className:"absolute top-1 right-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30",children:e.jsx("span",{className:"text-[9px] font-bold text-emerald-400",children:"‚óè LIVE"})})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] sm:text-xs text-white/50 flex-shrink-0",children:[e.jsx(ue,{className:"w-3 h-3 text-amber-400"}),e.jsx("span",{children:"See your dart above, then tap the board below where it landed"})]}),e.jsx("div",{className:"w-full max-w-[240px] sm:max-w-[280px] md:max-w-xs mx-auto rounded-xl border border-white/10 bg-black/40 p-2 sm:p-3 shadow-2xl shadow-black/50 flex-1 min-h-0",children:e.jsx(Jt,{onSelect:fe,selectedPoint:R,disabled:d||U,label:d?"Dart position locked":"Tap where your dart landed"})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-3 flex-shrink-0",children:[j!=null&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-xl bg-white/5 border border-white/10 animate-in fade-in duration-300",children:[e.jsx(ue,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-xl font-black text-white tabular-nums",children:j.toFixed(1)}),e.jsx("span",{className:"text-sm text-white/50",children:"mm"})]}),U?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-xs text-white/70",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-amber-400/30 border-t-amber-400 rounded-full animate-spin"}),"Waiting for opponent‚Ä¶"]}):e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-emerald-500/30 hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:pointer-events-none border border-emerald-400/30",disabled:j==null,onClick:pe,children:"‚úÖ Confirm"})]}),L&&e.jsx("div",{className:"text-xs text-amber-300 font-bold animate-bounce px-3 py-1.5 rounded-lg bg-amber-500/10 border border-amber-500/20 flex-shrink-0",children:"üîÑ It's a tie! Throw again."})]}),h==="preview"&&e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 mt-2 sm:mt-4 flex-shrink-0",children:[e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-indigo-500/30 hover:scale-105 transition-all",onClick:()=>N("choice"),children:"Ready ‚Äî Continue"}),e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-white/5 border border-white/10 text-white/70 font-semibold text-sm sm:text-base hover:bg-white/10 transition-all",onClick:f,children:"Cancel"})]})]})})]});return st.createPortal(Oe,F.current)}function rs({user:o}){const i=o?.username||"You",[x,p]=a.useState(0),[m,v]=a.useState(()=>[{id:1,name:"page-1",matches:[]}]),l=(()=>{try{return Ot()}catch{return null}})(),[D,W]=a.useState([]),f=I(t=>t.inProgress),u=I(t=>t.matchContext),k=I(t=>t.players),[g,L]=a.useState(!1),_=a.useRef(null),P=String(o?.email||"").toLowerCase()==="daviesfamily108@gmail.com";a.useEffect(()=>{if(!g)return;function t(s){try{if(!_.current)return;_.current.contains(s.target)||L(!1)}catch{}}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[g]);const[h,N]=a.useState(!1),E=Z.useRef(!1);a.useEffect(()=>{if(!f||u!=="online"){E.current=!1,N(!1);return}E.current||(I.getState().players||[]).some(n=>(n.legs||[]).some(b=>(b.visits||[]).length>0))||(E.current=!0,N(!0))},[f,u]),a.useEffect(()=>{if(!(!f||u!=="online"))try{const t=I.getState();if((t?.game||"X01")!=="X01"||!t.roomId)return;const n=`ndn:matchWindowOpened:${t.roomId}`;if(window.sessionStorage.getItem(n)==="1")return;window.sessionStorage.setItem(n,"1"),Ut()}catch{}},[f,u]),a.useEffect(()=>{f&&u==="online"||(E.current=!1)},[f,u]),a.useEffect(()=>{if(l?.connected&&o?.username)try{l.send({type:"presence",username:o.username,email:o.email||""})}catch{}},[l?.connected,o]),a.useEffect(()=>(window.__ndn_online_mounted=!0,()=>{window.__ndn_online_mounted=!1}),[]),a.useEffect(()=>{const t=()=>{try{I.getState().endGame()}catch{}w(null),B(null),j(null),z(null),ve(null),F.current=null;try{window.__ndn_pending_invite=null}catch{}};try{window.addEventListener("ndn:match-quit",t)}catch{}return()=>{try{window.removeEventListener("ndn:match-quit",t)}catch{}}},[]);const[G,R]=a.useState(!1),[c,j]=a.useState(null),r=Z.useRef(null),[d,w]=a.useState(null),[U,B]=a.useState(null),F=a.useRef(null),[Ve,Ie]=a.useState(null),[fe,pe]=a.useState({}),[_e,A]=a.useState(30),V=a.useRef([]);a.useEffect(()=>{V.current=D||[]},[D]),a.useEffect(()=>{c&&(F.current={...c})},[c]);const ne=Z.useRef(!1),[Pe,z]=a.useState(null),[Be,q]=a.useState({}),[Oe,y]=a.useState(!1),[ge,J]=a.useState(null),[lt,De]=a.useState(null),[Ht,ze]=a.useState(null),[Kt,be]=a.useState(!1),[it,we]=a.useState(!1),[qe,ve]=a.useState(null),[ot,ct]=a.useState("X01"),[dt,Xe]=a.useState(null),[le,xt]=a.useState(""),[ie,ht]=a.useState("all"),[oe,mt]=a.useState("all"),[je,ut]=a.useState("newest"),[Q,ye]=a.useState(1),Re=12,ce=m[x],Ne=999,ke=Z.useCallback(t=>{if(!t)return t;const s=t.modeType||t.mode||"",n=t.legs??t.value??t.bestOf??t.sets??t.games??1,b=t.createdBy||t.creatorName||t.creator||t.host||"",C=t.createdAt||t.ts||Date.now();return{...t,modeType:s,mode:s||t.mode,legs:n,value:typeof t.value=="number"?t.value:n,createdBy:b,creatorName:t.creatorName||b,createdAt:C}},[]),te=a.useMemo(()=>(t=[])=>(t||[]).map(ke).filter(s=>!(s?.isTest||s?.test||s?.migrated||s?.isMigration||s?.migration||s?.seeded||s?.status==="completed"||s?.status==="played"||s?.declineCount&&s.declineCount>=3||typeof s?.createdBy=="string"&&s.createdBy.toLowerCase().includes("test")||typeof s?.creatorName=="string"&&s.creatorName.toLowerCase().includes("test")||typeof s?.createdBy=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(s.createdBy)||typeof s?.creatorName=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(s.creatorName)||!(s?.game&&s?.modeType&&s?.legs))),[ke]),H=a.useMemo(()=>{let t=te(ce?.matches||[]);if((t?.length||0)===0&&(D?.length||0)>0&&(t=te(D)),(t?.length||0)===0&&(V.current?.length||0)>0&&(t=te(V.current)),le.trim()){const s=le.toLowerCase();t=t.filter(n=>(n.game||"").toLowerCase().includes(s)||(n.createdBy||n.creatorName||"").toLowerCase().includes(s)||(n.id||"").toLowerCase().includes(s))}return ie!=="all"&&(t=t.filter(s=>(s.game||"").toLowerCase()===ie)),oe!=="all"&&(t=t.filter(s=>{const n=(s.modeType||"").replace("_","").toLowerCase(),b=oe.replace("_","").toLowerCase();return n.includes(b)})),t=(t||[]).slice(),t.sort((s,n)=>{const b=s.createdAt||0,C=n.createdAt||0;return je==="newest"?C-b:b-C}),t.slice(0,Ne)},[ce,D,te,le,ie,oe,je,Ne]);a.useEffect(()=>{ye(1)},[le,ie,oe,je,x]);const K=Math.ceil(H.length/Re),ft=H.slice((Q-1)*Re,Q*Re),pt=()=>{H.length>0&&Ye(H[0])},gt=t=>{const s={id:`m-${Date.now()}`,createdBy:t.createdBy||i,game:t.game,modeType:t.modeType,legs:t.legs,startingScore:t.startingScore,createdAt:Date.now()};l?.connected||v(n=>n.map((b,C)=>C===x?{...b,matches:[s,...b.matches]}:b));try{l?.connected&&(o?.username&&l.send({type:"presence",username:o.username,email:o.email||""}),l.send({type:"create-match",game:t.game,mode:t.modeType,value:t.legs,startingScore:t.startingScore,creatorAvg:t.avgChoice||0}))}catch{}},bt=()=>{W([]),v(t=>{const s=t.length+1,n=[...t,{id:s,name:`page-${s}`,matches:[]}];return p(n.length-1),n})},de=Z.useCallback(t=>{try{if(console.log("[OnlinePlay] handleInviteOrPrestart:",t?.type,t),t?.type==="invite"){const s={id:t.matchId,game:t.game,mode:t.mode||"firstto",value:t.value||1,startingScore:t.startingScore||501,fromName:t.fromName||"Opponent",fromId:t.fromId};w(s);try{const n=new Audio("/sounds/notify.mp3");n.volume=.5,n.play().catch(()=>{})}catch{}}if(t?.type==="invite-waiting"&&B(t.creatorName||"Creator"),t?.type==="match-prestart"){if(I.getState().inProgress)return;w(null),B(null);const s=ke(t.match||null);if(s&&(s.prestartEndsAt=t.prestartEndsAt),s){const b=(o?.username||"").toLowerCase(),C=(s.creatorName||s.createdBy||"").toLowerCase();b&&C===b&&(s._isCreatorView=!0)}try{s?.creatorId&&s?.creatorName&&pe(b=>({...b,[s.creatorId]:s.creatorName}))}catch{}ne.current=!0,j(s);const n=t.prestartEndsAt||Date.now();A(Math.max(0,Math.ceil(((n||Date.now())-Date.now())/1e3))),setTimeout(()=>{ne.current=!1},0),z(null),q({}),y(!1),J(null),De(null),we(!1)}t?.type==="invite-expired"&&(w(null),B(null),j(s=>s&&t.matchId===s.id?null:s)),t?.type==="declined"&&(w(null),B(null),j(s=>s&&t.matchId===s.id?null:s))}catch{}},[ke,o]),xe=Z.useCallback(t=>{if(t?.type!=="match-start"||I.getState().inProgress)return;const s=t.match||{},n=F.current||{},b=t.roomId||n.id||"",C=s.startingScore||n.startingScore||501,M=i,X=s.creatorName||n.creatorName||n.createdBy||"",Y=s.joinerName||n.joinerName||"",se=t.firstThrowerId||t.firstPlayerId||null,ae=n._isCreatorView||X.toLowerCase()===M.toLowerCase(),Ce=ae?Y||"Opponent":X||"Opponent";let he;if(se){const Se=s.creatorId||n.creatorId;he=ae?se===Se:se!==Se}else he=ae;const yt=he?[M,Ce]:[Ce,M];try{I.getState().newMatch(yt,C,b,"online")}catch(Se){console.error("[OnlinePlay] newMatch failed:",Se)}const Nt=s.game||n.game||"X01";ct(Nt);try{l?.connected&&l.send({type:"join",roomId:b})}catch{}F.current=null,j(null),z(null),q({})},[i,l]);a.useEffect(()=>l?(l.connected&&l.send({type:"list-matches"}),l.addListener(s=>{try{if(s?.type==="joined"&&s.id&&Ie(s.id),s?.type==="presence")try{s.id&&pe(n=>({...n,[s.id]:s.username||s.name||s.id}))}catch{}if(s?.type==="matches"){const n=te(s.matches||[]);W(n),V.current=n,v(b=>b.map((C,M)=>M===x?{...C,matches:n}:C))}if(de(s),s?.type==="match-start"&&xe(s),s?.type==="prestart-choice-notify"){const{roomId:n,playerId:b,choice:C}=s;if(!n||!C)return;q(M=>({...M||{},[b]:C}))}if(s?.type==="prestart-bull"&&(y(!0),be(!1),ze(null)),s?.type==="prestart-bull-winner"&&(De(s.winnerName||s.winnerId||null),y(!1),be(!1),we(!1)),s?.type==="prestart-bull-tie"&&(De(null),y(!1),be(!1),we(!0),setTimeout(()=>we(!1),2e3)),s?.type==="opponent-quit"&&ve(s.quitterName||"Opponent"),s?.type==="opponent-paused")try{Me.getState().setPaused(!0,null,s.pauserName||"Opponent")}catch{}if(s?.type==="opponent-unpaused")try{Me.getState().setPaused(!1,null)}catch{}if(s?.type==="state"&&s.payload)try{I.getState().importState(s.payload)}catch{}s?.type==="camera-frame"&&s.frame&&Xe(s.frame)}catch{}})):void 0,[l,Pe,te,x,de,xe]),a.useEffect(()=>{try{const s=window.__ndn_pending_invite;s&&(window.__ndn_pending_invite=null,s.type==="match-start"?xe(s):de(s))}catch{}const t=s=>{try{const n=s.detail;if(!n)return;n.type==="match-start"?xe(n):de(n)}catch{}};return window.addEventListener("ndn:match-invite",t),()=>window.removeEventListener("ndn:match-invite",t)},[de,xe]),a.useEffect(()=>{if(!c||ne.current||c.prestartEndsAt)return;A(30),z(null),q({});const t=setInterval(()=>A(s=>Math.max(0,s-1)),1e3);return()=>clearInterval(t)},[c]),a.useEffect(()=>{c&&setTimeout(()=>r.current?.focus(),0)},[c]);const wt=()=>{N(!0),c&&(F.current={...c});try{if(l?.connected&&c?.id){const t=!!c._isCreatorView;l.send({type:"invite-response",matchId:c.id,accept:!0,toId:t?c.joinerId:c.creatorId})}}catch{}j(null)},Ye=t=>{j(t);try{l?.connected&&(o?.username&&l.send({type:"presence",username:o.username,email:o.email||""}),l.send({type:"join-match",matchId:t.id,calibrated:!0}))}catch{}},vt=t=>{z(t);try{l?.connected&&c?.id&&l.send({type:"prestart-choice",roomId:c.id,choice:t})}catch{}},Fe=Z.useCallback(()=>{try{if(l?.connected){const t=I.getState();l.send({type:"state",payload:t})}}catch{}},[l]);a.useEffect(()=>{if(!f||u!=="online"||!l?.connected)return;const t=setInterval(()=>{try{const n=window.__ndn_camera_debug?.videoEl?.();if(!n||!n.videoWidth||!n.videoHeight)return;const b=320,C=Math.round(n.videoHeight/n.videoWidth*b)||180,M=document.createElement("canvas");M.width=b,M.height=C;const X=M.getContext("2d");if(!X)return;X.drawImage(n,0,0,b,C);const Y=M.toDataURL("image/jpeg",.4);l.send({type:"camera-frame",frame:Y})}catch{}},1500);return()=>clearInterval(t)},[f,u,l]),a.useEffect(()=>{(!f||u!=="online")&&Xe(null)},[f,u]);const jt=()=>{zt({players:[i,"Opponent"],startingScore:501,roomId:"online-demo",visits:[{score:60},{score:85},{score:100}]})};if(f&&u==="online"){const s=(I.getState().players||[]).findIndex(n=>n?.name&&n.name.toLowerCase()===i.toLowerCase());return e.jsxs(e.Fragment,{children:[e.jsx(Vt,{user:o,showStartShowcase:h,onShowStartShowcaseChange:N,onCommitVisit:(n,b,C)=>{try{const M=I.getState(),X=M.players[M.currentPlayerIdx],Y=X?.legs?.[X.legs.length-1],se=Y?Y.totalScoreRemaining:M.startingScore,ae=Math.max(0,se-n),Ce=se<=50?3:ae<=50?1:0,he=ae===0;M.addVisit(n,3,{preOpenDarts:0,doubleWindowDarts:Ce,finishedByDouble:he,visitTotal:n}),Y&&Y.totalScoreRemaining===0?M.endLeg(n):M.nextPlayer()}catch{I.getState().addVisit(n,3),I.getState().nextPlayer()}Fe()},onQuit:()=>{try{I.getState().endGame()}catch{}try{l?.connected&&l.send({type:"match-quit"})}catch{}w(null),B(null),j(null),z(null),ve(null),F.current=null;try{window.__ndn_pending_invite=null}catch{}Fe();try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},onPause:()=>{try{Me.getState().setPaused(!0,null,i)}catch{}try{l?.connected&&l.send({type:"match-pause"})}catch{}},onResume:()=>{try{Me.getState().setPaused(!1,null)}catch{}try{l?.connected&&l.send({type:"match-unpause"})}catch{}},onStateChange:Fe,localPlayerIndexOverride:s>=0?s:void 0,gameModeOverride:ot,isOnline:!0,remoteFrame:dt}),qe&&e.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl",children:[e.jsx("div",{className:"text-4xl mb-3",children:"üö™"}),e.jsxs("h3",{className:"text-lg font-bold text-white mb-2",children:[qe," left the match"]}),e.jsx("p",{className:"text-sm text-white/60 mb-5",children:"Your opponent has quit. You can leave the match now."}),e.jsx("button",{className:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all",onClick:()=>{try{I.getState().endGame()}catch{}ve(null),w(null),B(null),j(null),z(null),F.current=null;try{window.__ndn_pending_invite=null}catch{}try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},children:"Leave Match"})]})})]})}return e.jsx("div",{className:"flex-1 min-h-0 ndn-page",style:{position:"relative",marginTop:0},children:e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col",children:[h&&e.jsx(Dt,{players:k||[],user:o,onDone:()=>N(!1),onRequestClose:()=>N(!1)}),e.jsx("h2",{className:"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title",children:"Online Lobby üåê"}),e.jsx("div",{className:"ndn-shell-body flex-1 overflow-hidden p-3 pb-0",children:e.jsxs("div",{className:"h-full flex flex-col gap-3",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"text-sm text-white/70",children:"Page"}),e.jsxs("div",{className:"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium",children:["Page ",ce?.id]}),e.jsx("button",{className:"btn btn-ghost btn-sm rounded-lg",onClick:bt,children:"New Page"})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg",onClick:()=>R(!0),disabled:(ce?.matches?.length||0)>=Ne,children:[e.jsx(Wt,{className:"w-4 h-4"}),"Create Match +"]}),P&&e.jsx("button",{className:"btn btn-sm btn-ghost rounded-lg",onClick:jt,children:"Demo In-Play"}),(ce?.matches?.length||0)>=Ne&&e.jsx("div",{className:"text-xs text-rose-400",children:"Page full ‚Äî create a new page"})]})]}),!f&&e.jsx("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3",children:e.jsxs("div",{className:"ndn-filterbar",children:[e.jsxs("div",{className:"flex-1 min-w-[240px] relative",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",placeholder:"Search matches, players...",className:"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all",value:le,onChange:t=>xt(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:ie,onChange:t=>ht(t.target.value),children:[e.jsx("option",{value:"all",children:"All Games"}),e.jsxs("option",{value:"x01",children:[$("X01").emoji," X01"]}),e.jsxs("option",{value:"cricket",children:[$("Cricket").emoji," Cricket"]}),e.jsxs("option",{value:"bermuda",children:[$("Bermuda").emoji," Bermuda"]}),e.jsxs("option",{value:"gotcha",children:[$("Gotcha").emoji," Gotcha"]})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:oe,onChange:t=>mt(t.target.value),children:[e.jsx("option",{value:"all",children:"All Modes"}),e.jsx("option",{value:"first_to",children:"First To"}),e.jsx("option",{value:"best_of",children:"Best Of"})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:je,onChange:t=>ut(t.target.value),children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${g?"bg-red-600 text-white border-red-500":"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900"}`,onClick:()=>L(t=>!t),"aria-pressed":g,title:"Toggle focus mode: hide small details and show focused view",children:g?"Exit Focus":"Focus Mode"})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg",onClick:pt,disabled:H.length===0,children:[e.jsx(Ge,{className:"w-4 h-4 fill-current"}),"Quick Join"]})})]})}),e.jsxs("div",{className:"flex-1 overflow-auto flex flex-col",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-indigo-400"}),"Active Matches ÔøΩÔ∏è"]}),e.jsx("div",{className:"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col",children:e.jsxs("div",{className:"flex-1 overflow-auto",children:[(H.length||0)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center opacity-60",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4",children:e.jsx(ue,{className:"w-8 h-8 text-white/20"})}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No matches found"}),e.jsx("p",{className:"text-sm max-w-xs mx-auto",children:"Create a new match to get started or try adjusting your filters."})]}):null,(H.length||0)!==0&&e.jsxs("div",{className:"relative",children:[g&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out",children:e.jsx("button",{onClick:()=>L(!1),className:"w-full text-center",children:"FOCUS MODE ‚Äî Click to exit"})})}),e.jsx("div",{ref:_,className:`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 max-h-[28rem] overflow-auto p-1 ${g?"opacity-90":""}`,"data-testid":"matches-grid",children:ft.map(t=>e.jsxs("div",{className:"group relative p-4 rounded-lg border border-slate-700/30 bg-slate-950/40 hover:border-indigo-500/50 hover:bg-slate-900/50 transition-all duration-150 shadow-sm hover:shadow-[0_8px_24px_-12px_rgba(99,102,241,0.4)] flex flex-col gap-3 min-h-[6.5rem]","data-testid":`match-${t.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[!g&&e.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center border group-hover:border-opacity-60 transition-colors text-sm",style:{backgroundColor:`${$(t.game).color}15`,borderColor:`${$(t.game).color}30`},children:$(t.game).emoji}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"font-bold group-hover:text-indigo-300 transition-colors truncate",style:{color:$(t.game).color},children:[$(t.game).emoji," ",t.game]}),e.jsxs("div",{className:"text-xs text-white/50 flex items-center gap-1",children:[e.jsx(Ke,{className:"w-3 h-3"}),new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})}),t.roomName&&e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-none bg-slate-950 border border-slate-850 text-white/70",children:t.roomName})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm text-white/70 bg-transparent border-t border-slate-850 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 rounded-none bg-white/5 text-xs font-medium border border-slate-850",children:t.modeType==="bestof"?"Best Of":"First To"}),e.jsx("span",{className:"font-mono text-indigo-300",children:t.legs}),e.jsx("span",{children:"legs"}),t.startingScore&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-white/20"}),e.jsx("span",{className:"font-mono text-amber-300",children:t.startingScore})]})]}),!g&&e.jsxs("div",{className:"text-xs text-white/40 flex items-center gap-1 mt-1",children:[e.jsx(He,{className:"w-3 h-3"}),"Created by:"," ",e.jsx("span",{className:"text-white/60",children:t.createdBy||t.creatorName||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2 border-t border-white/5",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:!g&&e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white",children:(t.createdBy||t.creatorName||"U").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-xs text-white/60 truncate max-w-[120px]",children:t.createdBy||t.creatorName})]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-4 rounded-none",onClick:()=>Ye(t),children:"Join"})})]})]},t.id))})]}),K>1&&e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5",children:[e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:Q===1,onClick:()=>ye(t=>Math.max(1,t-1)),children:[e.jsx(Ze,{className:"w-4 h-4 rotate-90"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,K)},(t,s)=>{let n=s+1;return K>5&&(Q>3&&(n=Q-2+s),n>K&&(n=K-4+s)),e.jsx("button",{className:`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${Q===n?"bg-indigo-600 text-white shadow-sm":"bg-slate-950 text-white/70 hover:bg-slate-900"}`,onClick:()=>ye(n),children:n},n)})}),e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:Q===K,onClick:()=>ye(t=>Math.min(K,t+1)),children:["Next",e.jsx(Ze,{className:"w-4 h-4 -rotate-90"})]})]})]})})]})]})}),e.jsx(qt,{open:G,onClose:()=>R(!1),onCreate:t=>{gt(t),R(!1)}}),d&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-md mx-4 p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-indigo-500/30 shadow-2xl shadow-indigo-500/20",children:[e.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 ring-2 ring-indigo-500/30",children:e.jsx(Ge,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-white",children:"Match Invite!"}),e.jsx("p",{className:"text-sm text-white/60",children:"Someone wants to play"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold text-sm",children:(d.fromName||"?").substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-lg",children:d.fromName||"Opponent"}),e.jsx("div",{className:"text-xs text-white/50",children:"wants to join your match"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-sm text-white/70",children:[e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-medium",children:d.game||"X01"}),e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10",children:[d.mode==="bestof"?"Best Of":"First To"," ",d.value||1]}),e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-mono text-amber-300",children:d.startingScore||501})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{l?.connected&&d?.id&&l.send({type:"invite-accept",matchId:d.id})}catch{}w(null)},children:"‚úÖ Accept"}),e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-white/5 hover:bg-rose-600/80 text-white/80 hover:text-white font-bold text-lg border border-white/10 hover:border-rose-500/50 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{l?.connected&&d?.id&&l.send({type:"invite-decline",matchId:d.id})}catch{}w(null)},children:"‚ùå Decline"})]})]})]})}),U&&!c&&e.jsx("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-sm mx-4 p-6 rounded-2xl bg-slate-900 border border-slate-700/50 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-indigo-500/10 flex items-center justify-center",children:e.jsx(Ke,{className:"w-8 h-8 text-indigo-400 animate-pulse"})}),e.jsxs("h3",{className:"text-xl font-bold text-white mb-2",children:["Waiting for ",U]}),e.jsx("p",{className:"text-sm text-white/50 mb-5",children:"The match creator needs to accept your request‚Ä¶"}),e.jsx("button",{className:"px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 transition-all text-sm font-medium",onClick:()=>B(null),children:"Cancel"})]})}),e.jsx(Qt,{open:!!c,matchInfo:c,localUser:o,opponentName:(()=>{if(!c)return"Opponent";const t=(o?.username||"").toLowerCase(),s=c.createdBy||c.creatorName||"";return c._isCreatorView||s.toLowerCase()===t?c.joinerName||(c.joinerId?fe[c.joinerId]||c.joinerId:"Opponent"):s||(c.creatorId?fe[c.creatorId]||c.creatorId:"Opponent")})(),countdown:15,onChoice:vt,onBullThrow:t=>{try{l?.connected&&c?.id&&l.send({type:"prestart-bull-throw",roomId:c.id,score:t})}catch{}ze(t),be(!0)},onAccept:wt,onCancel:()=>{try{l?.connected&&c?.id&&c._isCreatorView&&l.send({type:"invite-decline",matchId:c.id})}catch{}j(null)},remoteChoice:Object.values(Be)[0]||null,bullActive:Oe,bullWinner:lt,bullTied:it})]})})}export{rs as default};
//# sourceMappingURL=OnlinePlay.clean-0FOoiYSq.js.map

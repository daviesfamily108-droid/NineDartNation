{"version":3,"file":"OnlinePlay-w62freSc.js","sources":["../../src/components/MatchSummaryModal.tsx","../../src/store/blocklist.ts","../../src/components/OnlinePlay.tsx"],"sourcesContent":["import ResizableModal from './ui/ResizableModal'\r\nimport type { Player, Leg } from '../store/match'\r\n\r\nfunction computeTotals(p: Player) {\r\n  let points = 0\r\n  let darts = 0\r\n  let bestLeg: number | null = null\r\n  let worstLeg: number | null = null\r\n  let oneEighties = 0\r\n  for (const L of (p.legs || [])) {\r\n    points += (L.totalScoreStart - L.totalScoreRemaining)\r\n    const legDarts = (L.visits || []).reduce((a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0), 0)\r\n    darts += legDarts\r\n    if (L.finished) {\r\n      if (bestLeg === null || L.dartsThrown < bestLeg) bestLeg = L.dartsThrown\r\n      if (worstLeg === null || L.dartsThrown > worstLeg) worstLeg = L.dartsThrown\r\n    }\r\n    // Count 180s: any visit with 180 points\r\n    for (const v of (L.visits || [])) {\r\n      if ((v?.score || 0) === 180) oneEighties += 1\r\n    }\r\n  }\r\n  const threeDA = darts > 0 ? (points / darts) * 3 : 0\r\n  const nineDA = threeDA * 3\r\n  return { points, darts, threeDA, nineDA, bestLeg, worstLeg, oneEighties }\r\n}\r\n\r\nexport default function MatchSummaryModal({\r\n  open,\r\n  onClose,\r\n  title = 'Match Summary',\r\n  players,\r\n  centerScore,\r\n  doublesStats,\r\n  allowRematch,\r\n  onRematch,\r\n}: {\r\n  open: boolean\r\n  onClose: () => void\r\n  title?: string\r\n  players: Player[]\r\n  centerScore?: string\r\n  doublesStats?: Record<string, { dartsAtDouble?: number; doublesHit?: number }>\r\n  allowRematch?: boolean\r\n  onRematch?: () => void\r\n}) {\r\n  if (!open) return null\r\n  const cards = players.map(p => {\r\n    const t = computeTotals(p)\r\n    const dbl = doublesStats?.[p.id] || {}\r\n    const att = Math.max(0, Number(dbl.dartsAtDouble || 0))\r\n    const hit = Math.max(0, Number(dbl.doublesHit || 0))\r\n    const pct = att > 0 ? Math.round((hit/att)*100) : null\r\n    return { id: p.id, name: p.name, legsWon: p.legsWon, ...t, dartsAtDouble: att, doublesHit: hit, doublePct: pct }\r\n  })\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[120]\">\r\n      <ResizableModal\r\n        storageKey=\"ndn:modal:match-summary\"\r\n        className=\"w-full relative\"\r\n        defaultWidth={860}\r\n        defaultHeight={540}\r\n        minWidth={640}\r\n        minHeight={420}\r\n        maxWidth={1400}\r\n        maxHeight={1000}\r\n        initialFitHeight\r\n      >\r\n        <h3 className=\"text-xl font-extrabold mb-2\">{title}</h3>\r\n        <div className=\"text-xs opacity-80 mb-3\">Players: {players.map(p=>p.name).join(' vs ')}</div>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n          {cards[0] && (\r\n            <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n              <div className=\"text-sm font-semibold mb-1\">{cards[0].name}</div>\r\n              <div className=\"text-3xl font-extrabold\">{cards[0].legsWon}</div>\r\n              <div className=\"text-xs opacity-80\">Legs Won</div>\r\n              <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{cards[0].threeDA.toFixed(1)}</div></div>\r\n                <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{cards[0].nineDA.toFixed(1)}</div></div>\r\n                <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{cards[0].dartsAtDouble ?? '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{cards[0].doublePct !== null && cards[0].doublePct !== undefined ? `${cards[0].doublePct}%` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{cards[0].bestLeg ? `${cards[0].bestLeg} darts` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{cards[0].worstLeg ? `${cards[0].worstLeg} darts` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{cards[0].oneEighties}</div></div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div className=\"hidden md:flex items-center justify-center\">\r\n            <div className=\"text-4xl font-black\">{centerScore || (players.length===2 ? `${cards[0]?.legsWon ?? 0} – ${cards[1]?.legsWon ?? 0}` : '')}</div>\r\n          </div>\r\n          {cards[1] && (\r\n            <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n              <div className=\"text-sm font-semibold mb-1\">{cards[1].name}</div>\r\n              <div className=\"text-3xl font-extrabold\">{cards[1].legsWon}</div>\r\n              <div className=\"text-xs opacity-80\">Legs Won</div>\r\n              <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{cards[1].threeDA.toFixed(1)}</div></div>\r\n                <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{cards[1].nineDA.toFixed(1)}</div></div>\r\n                <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{cards[1].dartsAtDouble ?? '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{cards[1].doublePct !== null && cards[1].doublePct !== undefined ? `${cards[1].doublePct}%` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{cards[1].bestLeg ? `${cards[1].bestLeg} darts` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{cards[1].worstLeg ? `${cards[1].worstLeg} darts` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{cards[1].oneEighties}</div></div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n          <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={onClose}>Close</button>\r\n          {allowRematch && <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={onRematch}>Rematch</button>}\r\n        </div>\r\n      </ResizableModal>\r\n    </div>\r\n  )\r\n}\r\n","import { create } from 'zustand'\r\n\r\ntype BlockState = {\r\n  blocked: Record<string, number> // email/username -> ts\r\n  isBlocked: (id: string) => boolean\r\n  block: (id: string) => void\r\n  unblock: (id: string) => void\r\n  all: () => string[]\r\n}\r\n\r\nconst LS = 'ndn:blocked:v1'\r\n\r\nfunction load(): Record<string, number> {\r\n  try { const raw = localStorage.getItem(LS); return raw ? JSON.parse(raw) : {} } catch { return {} }\r\n}\r\nfunction save(map: Record<string, number>) {\r\n  try { localStorage.setItem(LS, JSON.stringify(map)) } catch {}\r\n}\r\n\r\nexport const useBlocklist = create<BlockState>((set, get) => ({\r\n  blocked: load(),\r\n  isBlocked: (id) => !!get().blocked[(id||'').toLowerCase()],\r\n  block: (id) => set((s) => { const map = { ...s.blocked }; map[(id||'').toLowerCase()] = Date.now(); save(map); return { blocked: map } }),\r\n  unblock: (id) => set((s) => { const map = { ...s.blocked }; delete map[(id||'').toLowerCase()]; save(map); return { blocked: map } }),\r\n  all: () => Object.keys(get().blocked),\r\n}))\r\n","import { useEffect, useRef, useState } from 'react'\r\nimport { useMatch } from '../store/match'\r\nimport CameraView from './CameraView'\r\nimport CameraTile from './CameraTile'\r\nimport ResizablePanel from './ui/ResizablePanel'\r\nimport { suggestCheckouts, sayScore } from '../utils/checkout'\r\nimport { addSample, getAllTimeAvg } from '../store/profileStats'\r\nimport MatchStartShowcase from './ui/MatchStartShowcase'\r\nimport { getFreeRemaining, incOnlineUsage } from '../utils/quota'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCalibration } from '../store/calibration'\r\nimport GameCalibrationStatus from './GameCalibrationStatus'\r\nimport MatchSummaryModal from './MatchSummaryModal'\r\nimport { freeGames, premiumGames, allGames, type GameKey } from '../utils/games'\r\nimport { getUserCurrency, formatPriceInCurrency } from '../utils/config'\r\nimport ResizableModal from './ui/ResizableModal'\r\nimport GameHeaderBar from './ui/GameHeaderBar'\r\nimport { useToast } from '../store/toast'\r\n// import { TabKey } from './Sidebar'\r\nimport { useWS } from './WSProvider'\r\nimport { useMessages } from '../store/messages'\r\nimport { censorProfanity, containsProfanity } from '../utils/profanity'\r\nimport { useBlocklist } from '../store/blocklist'\r\nimport TabPills from './ui/TabPills'\r\nimport { DOUBLE_PRACTICE_ORDER, isDoubleHit, parseManualDart, ringSectorToDart } from '../game/types'\r\nimport { ATC_ORDER } from '../game/aroundTheClock'\r\nimport { createCricketState, applyCricketDart, CRICKET_NUMBERS, hasClosedAll as cricketClosedAll, cricketWinner } from '../game/cricket'\r\nimport { createShanghaiState, getRoundTarget as shanghaiTarget, applyShanghaiDart, endShanghaiTurn } from '../game/shanghai'\r\nimport { createDefaultHalveIt, getCurrentHalveTarget, applyHalveItDart, endHalveItTurn } from '../game/halveIt'\r\nimport { createHighLow, applyHighLowDart, endHighLowTurn } from '../game/highLow'\r\nimport { assignKillerNumbers, createKillerState, applyKillerDart, killerWinner } from '../game/killer'\r\nimport { apiFetch } from '../utils/api'\r\n// Phase 2 premium games (Online support)\r\nimport { createAmCricketState, applyAmCricketDart, AM_CRICKET_NUMBERS } from '../game/americanCricket'\r\nimport { createBaseball, applyBaseballDart } from '../game/baseball'\r\nimport { createGolf, applyGolfDart, GOLF_TARGETS } from '../game/golf'\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from '../game/ticTacToe'\r\nimport { useMatchControl } from '../store/matchControl'\r\nimport GameScoreboard from './scoreboards/GameScoreboard'\r\nimport { useOnlineGameStats } from './scoreboards/useGameStats'\r\n\r\nexport default function OnlinePlay({ user }: { user?: any }) {\r\n  const API_URL = (import.meta as any).env?.VITE_API_URL || ''\r\n  const toast = useToast();\r\n  const wsGlobal = (() => { try { return useWS() } catch { return null } })()\r\n  const blocklist = useBlocklist()\r\n  const [roomId, setRoomId] = useState('room-1')\r\n  const [connected, setConnected] = useState(false)\r\n  const [chat, setChat] = useState<{from:string;message:string; fromId?: string}[]>([])\r\n  const [showQuick, setShowQuick] = useState(false)\r\n  const [showMessages, setShowMessages] = useState(false)\r\n  // Track last locally-sent chat to avoid duplicating when the server echoes it back\r\n  const lastSentChatRef = useRef<{ text: string; ts: number } | null>(null)\r\n  const [selfId, setSelfId] = useState<string | null>(null)\r\n  const wsRef = useRef<WebSocket | null>(null)\r\n  // Reconnect handling\r\n  const reconnectAttemptsRef = useRef(0)\r\n  const reconnectTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\r\n  const shouldReconnectRef = useRef(true)\r\n  const lastToastRef = useRef(0)\r\n  const firstConnectDoneRef = useRef(false)\r\n  const match = useMatch()\r\n  const msgs = useMessages()\r\n  const { favoriteDouble, callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, allowSpectate, cameraScale, setCameraScale, cameraFitMode = 'fill', setCameraFitMode, cameraEnabled, textSize, boxSize, autoscoreProvider, matchType = 'singles', setMatchType, teamAName = 'Team A', setTeamAName, teamBName = 'Team B', setTeamBName, x01DoubleIn: defaultX01DoubleIn } = useUserSettings()\r\n  const manualScoring = autoscoreProvider === 'manual'\r\n  useEffect(() => {\r\n    if (cameraFitMode !== 'fit') {\r\n      setCameraFitMode('fit')\r\n    }\r\n  }, [cameraFitMode, setCameraFitMode])\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case 'small': return 'px-1.5 py-0.5 text-xs'\r\n      case 'large': return 'px-3 py-1 text-sm'\r\n      default: return 'px-2 py-0.5 text-sm'\r\n    }\r\n  }\r\n  const buttonSizeClass = getButtonSizeClasses(textSize)\r\n  // Camera resize state\r\n  const [cameraColSpan, setCameraColSpan] = useState(2)\r\n  // Turn-by-turn modal\r\n  const [showMatchModal, setShowMatchModal] = useState(false)\r\n  const [participants, setParticipants] = useState<string[]>([])\r\n  const [turnIdx, setTurnIdx] = useState(0)\r\n  const [visitScore, setVisitScore] = useState(0)\r\n  // Double Practice (online) minimal state synchronized via WS state payload\r\n  const [dpIndex, setDpIndex] = useState(0)\r\n  const [dpHits, setDpHits] = useState(0)\r\n  const [dpManual, setDpManual] = useState('')\r\n  // Around the Clock (online) minimal state\r\n  const [atcIndex, setAtcIndex] = useState(0)\r\n  const [atcHits, setAtcHits] = useState(0)\r\n  const [atcManual, setAtcManual] = useState('')\r\n  // Treble Practice (online)\r\n  const [trebleTarget, setTrebleTarget] = useState<number>(20)\r\n  const [trebleHits, setTrebleHits] = useState<number>(0)\r\n  const [trebleDarts, setTrebleDarts] = useState<number>(0)\r\n  const [trebleManual, setTrebleManual] = useState<string>('')\r\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30)\r\n  // X01 Double-In per-match flag (synced over WS)\r\n  const [x01DoubleInMatch, setX01DoubleInMatch] = useState<boolean>(false)\r\n  // Mobile camera pairing\r\n  const [pairingCode, setPairingCode] = useState<string | null>(null)\r\n  // Highlight auto-download UI\r\n  const [highlightCandidate, setHighlightCandidate] = useState<any | null>(null)\r\n  const [showHighlightModal, setShowHighlightModal] = useState(false)\r\n\r\n  // Download highlight to device as a JSON file\r\n  function downloadHighlightToDevice() {\r\n    if (!highlightCandidate) return\r\n    try {\r\n      const blob = new Blob([JSON.stringify(highlightCandidate, null, 2)], { type: 'application/json' })\r\n      const url = URL.createObjectURL(blob)\r\n      const a = document.createElement('a')\r\n      const name = `ndn-highlight-${highlightCandidate.player || 'player'}-${highlightCandidate.ts || Date.now()}.json`\r\n      a.href = url\r\n      a.download = name\r\n      document.body.appendChild(a)\r\n      a.click()\r\n      a.remove()\r\n      URL.revokeObjectURL(url)\r\n  toast?.('Downloaded highlight to device', { type: 'success' })\r\n      setShowHighlightModal(false)\r\n    } catch (err) {\r\n  toast?.('Download failed', { type: 'error' })\r\n    }\r\n  }\r\n\r\n  async function saveHighlightToAccount() {\r\n    if (!highlightCandidate) return\r\n    const token = localStorage.getItem('authToken')\r\n  if (!token) { toast?.('You must be signed in to save to account', { type: 'error' }); return }\r\n    try {\r\n      const res = await apiFetch('/api/user/highlights', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }, body: JSON.stringify(highlightCandidate) })\r\n      if (!res.ok) {\r\n        const j = await res.json().catch(()=>({}))\r\n  toast?.(`Save failed: ${j.error || res.statusText}`, { type: 'error' })\r\n        return\r\n      }\r\n      const j = await res.json()\r\n  toast?.('Saved highlight to your account', { type: 'success' })\r\n      setShowHighlightModal(false)\r\n    } catch (err) {\r\n  toast?.('Save failed', { type: 'error' })\r\n    }\r\n  }\r\n  // WebRTC for mobile camera\r\n  const [mobileStream, setMobileStream] = useState<MediaStream | null>(null)\r\n  const mobileVideoRef = useRef<HTMLVideoElement>(null)\r\n  // Tic Tac Toe manual input\r\n  const [tttManual, setTttManual] = useState('')\r\n  // Per-player states for premium games\r\n  const [cricketById, setCricketById] = useState<Record<string, ReturnType<typeof createCricketState>>>({})\r\n  const [shanghaiById, setShanghaiById] = useState<Record<string, ReturnType<typeof createShanghaiState>>>({})\r\n  const [halveById, setHalveById] = useState<Record<string, ReturnType<typeof createDefaultHalveIt>>>({})\r\n  const [highlowById, setHighlowById] = useState<Record<string, ReturnType<typeof createHighLow>>>({})\r\n  const [killerById, setKillerById] = useState<Record<string, ReturnType<typeof createKillerState>>>({})\r\n  const [amCricketById, setAmCricketById] = useState<Record<string, ReturnType<typeof createAmCricketState>>>({})\r\n  const [baseballById, setBaseballById] = useState<Record<string, ReturnType<typeof createBaseball>>>({})\r\n  const [golfById, setGolfById] = useState<Record<string, ReturnType<typeof createGolf>>>({})\r\n  const [ttt, setTTT] = useState<ReturnType<typeof createTicTacToe>>(() => createTicTacToe())\r\n  // Track darts this turn for non-X01 games to auto-advance after 3\r\n  const [turnDarts, setTurnDarts] = useState(0)\r\n  // Pause state (synced over WS)\r\n  const [paused, setPausedLocal] = useState<boolean>(false)\r\n  const [pauseRequestedBy, setPauseRequestedBy] = useState<string | null>(null)\r\n  const [pauseAcceptedBy, setPauseAcceptedBy] = useState<Record<string, boolean>>({})\r\n  const [pauseEndsAt, setPauseEndsAt] = useState<number | null>(null)\r\n  const [pauseDurationSec, setPauseDurationSec] = useState<number>(300)\r\n  const setPausedGlobal = useMatchControl(s => s.setPaused)\r\n  // View mode: compact player-by-player (mobile) vs full overview (desktop)\r\n  const [compactView, setCompactView] = useState<boolean>(() => {\r\n    try { const ua = navigator.userAgent || ''; return /Android|iPhone|iPad|iPod|Mobile/i.test(ua) } catch { return false }\r\n  })\r\n  // Online end-of-match summary modal (appears when inProgress flips from true->false)\r\n  const [showX01EndSummary, setShowX01EndSummary] = useState(false)\r\n  const endSummaryPrevRef = useRef<boolean>(!!useMatch.getState().inProgress)\r\n  const [showStartShowcase, setShowStartShowcase] = useState(false)\r\n  const startedShowcasedRef = useRef(false)\r\n  useEffect(() => {\r\n    const prev = endSummaryPrevRef.current\r\n    const now = !!match.inProgress\r\n    if (prev && !now) {\r\n      const hasFinished = (match.players || []).some(p => (p.legs||[]).some(L => L.finished))\r\n      if (hasFinished) setShowX01EndSummary(true)\r\n    }\r\n    endSummaryPrevRef.current = now\r\n    // Reset the showcased flag when match ends\r\n    if (!now) startedShowcasedRef.current = false\r\n    // When match starts, show the start showcase once\r\n    if (now && !startedShowcasedRef.current) {\r\n      startedShowcasedRef.current = true\r\n      setShowStartShowcase(true)\r\n    }\r\n  }, [match.inProgress, match.players])\r\n  // Dev-only: auto-simulate a short X01 leg to validate double-out stats via ?autotest=doubleout\r\n  useEffect(() => {\r\n    try {\r\n      if (!(import.meta as any).env?.DEV) return\r\n      const q = new URLSearchParams(window.location.search)\r\n      if (q.get('autotest') !== 'doubleout') return\r\n      // Prevent re-run on HMR\r\n      if ((window as any).__NDN_AUTO_TESTED__) return\r\n      ;(window as any).__NDN_AUTO_TESTED__ = true\r\n      // Create simple 101 match and simulate visits:\r\n      // You: 41 (attempts=0) -> Opp: 26 -> You: 10 (cross into window; attempts=1) -> Opp: 26 -> You: 40 finish on D20 (attempts=1, finishedByDouble=true)\r\n      match.newMatch([user?.username || 'You', 'Opponent'], 101, 'local-dev')\r\n      // You visit 1: 41 (no attempts yet)\r\n      match.addVisit(41, 3, { preOpenDarts: 0, doubleWindowDarts: 0, finishedByDouble: false, visitTotal: 41 })\r\n      match.nextPlayer()\r\n      // Opponent visit: dummy 26\r\n      match.addVisit(26, 3, { preOpenDarts: 0, doubleWindowDarts: 0, finishedByDouble: false, visitTotal: 26 })\r\n      match.nextPlayer()\r\n      // You visit 2: 10 (enters window, attempts=1)\r\n      match.addVisit(10, 3, { preOpenDarts: 0, doubleWindowDarts: 1, finishedByDouble: false, visitTotal: 10 })\r\n      match.nextPlayer()\r\n      // Opponent visit: dummy 26\r\n      match.addVisit(26, 3, { preOpenDarts: 0, doubleWindowDarts: 0, finishedByDouble: false, visitTotal: 26 })\r\n      match.nextPlayer()\r\n      // You visit 3: 40 (D20) finish inside window, attempts=1, hit=1\r\n      match.addVisit(40, 1, { preOpenDarts: 0, doubleWindowDarts: 1, finishedByDouble: true, visitTotal: 40 })\r\n      match.endLeg(40)\r\n      match.endGame()\r\n      // Modal will auto-open via inProgress flip hook\r\n    } catch {}\r\n  }, [])\r\n  // Build doubles stats (double-out only) for summary modal\r\n  const doublesStats = (() => {\r\n    const out: Record<string, { dartsAtDouble?: number; doublesHit?: number }> = {}\r\n    for (const p of (match.players || [])) {\r\n      let attempts = 0\r\n      let hits = 0\r\n      for (const L of (p.legs || [])) {\r\n        for (const v of (L.visits || [])) {\r\n          attempts += Math.max(0, Number(v.doubleWindowDarts || 0))\r\n          if (v.finishedByDouble) hits += 1\r\n        }\r\n      }\r\n      out[p.id] = { dartsAtDouble: attempts, doublesHit: hits }\r\n    }\r\n    return out\r\n  })()\r\n  // Ephemeral celebration overlay (e.g., 180), tied to the current player's turn\r\n  const [celebration, setCelebration] = useState<null | { kind: '180' | 'leg'; by: string; turnIdx: number; ts: number }>(null)\r\n  const lastCelebrationRef = useRef<{ kind: '180'|'leg'; by: string; ts: number } | null>(null)\r\n  const audioCtxRef = useRef<AudioContext | null>(null)\r\n  // Auto-unpause when timer elapses\r\n  useEffect(() => {\r\n    if (!paused || !pauseEndsAt) return\r\n    const id = setInterval(() => {\r\n      if (Date.now() >= (pauseEndsAt || 0)) {\r\n        setPausedLocal(false)\r\n        setPauseRequestedBy(null)\r\n        setPauseAcceptedBy({})\r\n        setPauseEndsAt(null)\r\n        setPausedGlobal(false, null)\r\n        sendState()\r\n      }\r\n    }, 1000)\r\n    return () => clearInterval(id)\r\n  }, [paused, pauseEndsAt])\r\n  function ensureAudio() {\r\n    try {\r\n      if (!audioCtxRef.current) {\r\n        const Ctor: any = (window as any).AudioContext || (window as any).webkitAudioContext\r\n        if (Ctor) audioCtxRef.current = new Ctor()\r\n      }\r\n      audioCtxRef.current?.resume?.().catch(()=>{})\r\n    } catch {}\r\n  }\r\n  function beep(freq: number, durMs: number, whenS = 0, gain = 0.05) {\r\n    const ctx = audioCtxRef.current\r\n    if (!ctx) return\r\n    const o = ctx.createOscillator()\r\n    const g = ctx.createGain()\r\n    o.type = 'square'\r\n    o.frequency.value = freq\r\n    g.gain.value = gain\r\n    o.connect(g)\r\n    g.connect(ctx.destination)\r\n    const now = ctx.currentTime + whenS\r\n    o.start(now)\r\n    o.stop(now + durMs / 1000)\r\n  }\r\n  function playSting(kind: '180'|'leg') {\r\n    ensureAudio()\r\n    const ctx = audioCtxRef.current\r\n    if (!ctx) return\r\n    if (kind === '180') {\r\n      beep(880, 110, 0, 0.06); beep(1175, 110, 0.06, 0.06); beep(1568, 140, 0.12, 0.06)\r\n    } else {\r\n      beep(659, 140, 0, 0.07); beep(784, 140, 0.08, 0.07); beep(987, 200, 0.16, 0.07)\r\n    }\r\n  }\r\n  function triggerCelebration(kind: '180'|'leg', who: string) {\r\n    const now = Date.now()\r\n    const last = lastCelebrationRef.current\r\n    if (last && last.kind === kind && last.by === who && (now - last.ts) < 500) return\r\n    lastCelebrationRef.current = { kind, by: who, ts: now }\r\n    setCelebration({ kind, by: who, turnIdx: match.currentPlayerIdx, ts: now })\r\n    playSting(kind)\r\n  }\r\n  // Lobby & create-match state\r\n  const [showCreate, setShowCreate] = useState(false)\r\n  const [lobby, setLobby] = useState<any[]>([])\r\n  const [mode, setMode] = useState<'bestof'|'firstto'>('bestof')\r\n  const [modeValue, setModeValue] = useState<number>(5)\r\n  const [startScore, setStartScore] = useState<number>(501)\r\n  const [pendingInvite, setPendingInvite] = useState<any | null>(null)\r\n  const [errorMsg, setErrorMsg] = useState<string>('')\r\n  // Stripe checkout error handler\r\n  function handleStripeError(msg: string) {\r\n    setErrorMsg(msg || 'Failed to create Stripe checkout session. Please try again later.')\r\n    setTimeout(() => setErrorMsg(''), 4000)\r\n    try { toast(msg || 'Stripe checkout failed', { type: 'error' }) } catch {}\r\n  }\r\n  const [lastJoinIntent, setLastJoinIntent] = useState<any | null>(null)\r\n  const [offerNewRoom, setOfferNewRoom] = useState<null | { game: string; mode: 'bestof'|'firstto'; value: number; startingScore?: number }>(null)\r\n  // Game selection\r\n  const [game, setGame] = useState<GameKey>('X01')\r\n  const [currentGame, setCurrentGame] = useState<GameKey>('X01')\r\n  const [requireCalibration, setRequireCalibration] = useState<boolean>(false)\r\n  // Create-match: Treble Practice specific setting\r\n  const [createTrebleMaxDarts, setCreateTrebleMaxDarts] = useState<number>(30)\r\n  // Create-match: X01 Double-In per-match toggle (prefilled from Settings)\r\n  const [createX01DoubleIn, setCreateX01DoubleIn] = useState<boolean>(!!defaultX01DoubleIn)\r\n  const freeLeft = user?.username && !user?.fullAccess ? getFreeRemaining(user.username) : Infinity\r\n  const locked = !user?.fullAccess && (freeLeft <= 0)\r\n  // World Lobby filters\r\n  const [filterMode, setFilterMode] = useState<'all'|'bestof'|'firstto'>('all')\r\n  const [filterStart, setFilterStart] = useState<'all'|301|501|701>('all')\r\n  const [filterGame, setFilterGame] = useState<'all'|GameKey>('all')\r\n  const [nearAvg, setNearAvg] = useState(false)\r\n  const [avgTolerance, setAvgTolerance] = useState<number>(10)\r\n  const { H: calibH } = useCalibration()\r\n  const myAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n  const unread = useMessages(s => s.unread)\r\n  const filteredLobby = (lobby || []).filter((m:any) => {\r\n    if (filterMode !== 'all' && m.mode !== filterMode) return false\r\n    if (filterStart !== 'all' && Number(m.startingScore) !== Number(filterStart)) return false\r\n    if (filterGame !== 'all' && m.game !== filterGame) return false\r\n    if (nearAvg) {\r\n      if (!myAvg || !m.creatorAvg) return false\r\n      const diff = Math.abs(Number(m.creatorAvg) - Number(myAvg))\r\n      if (diff > avgTolerance) return false\r\n    }\r\n    return true\r\n  })\r\n\r\n  // Removed tournaments banner from Online; tournaments live in Tournaments tab only\r\n\r\n  // Demo: prefill Create Match modal from URL (ndn:online-demo)\r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      const d = e?.detail || {}\r\n      if (d.game) setGame(d.game)\r\n      if (d.mode === 'bestof' || d.mode === 'firstto') setMode(d.mode)\r\n      if (typeof d.value === 'number' && isFinite(d.value)) setModeValue(Math.max(1, Math.floor(d.value)))\r\n      if (typeof d.start === 'number' && isFinite(d.start)) setStartScore(Math.max(1, Math.floor(d.start)))\r\n      setShowCreate(true)\r\n    }\r\n    window.addEventListener('ndn:online-demo', handler as any)\r\n    return () => window.removeEventListener('ndn:online-demo', handler as any)\r\n  }, [])\r\n\r\n  // Load inbox on mount for the current user\r\n  useEffect(() => {\r\n    const email = String(user?.email || '').toLowerCase()\r\n    if (!email) return\r\n    apiFetch(`/api/friends/messages?email=${encodeURIComponent(email)}`).then(r=>r.json()).then(d=>{\r\n      if (d?.ok && Array.isArray(d.messages)) msgs.load(d.messages)\r\n    }).catch(()=>{})\r\n  }, [user?.email])\r\n\r\n  // Demo: open a populated Online Match view with fake data (local-only)\r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const d = e?.detail || {}\r\n        const start = Number(d.start || 501)\r\n        // Create a quick local match with two players\r\n        match.newMatch([user?.username || 'You', 'Opponent'], start, roomId)\r\n        // Seed a few visits to populate UI\r\n        match.addVisit(60, 3) // You\r\n        match.nextPlayer()\r\n        match.addVisit(85, 3) // Opponent\r\n        match.nextPlayer()\r\n        match.addVisit(100, 3) // You\r\n        setCurrentGame('X01')\r\n        setShowMatchModal(true)\r\n      } catch (err) {\r\n        console.error('Demo error:', err)\r\n      }\r\n    }\r\n    window.addEventListener('ndn:online-match-demo', handler as any)\r\n    return () => window.removeEventListener('ndn:online-match-demo', handler as any)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    // Auto-connect on mount and enable auto-reconnect\r\n    shouldReconnectRef.current = true\r\n    connect()\r\n    return () => {\r\n      shouldReconnectRef.current = false\r\n      if (reconnectTimerRef.current) { clearTimeout(reconnectTimerRef.current) }\r\n      try { wsRef.current?.close() } catch {}\r\n    }\r\n  }, [])\r\n\r\n  // Track in-game flag in messages store\r\n  useEffect(() => {\r\n    msgs.setInGame(match.inProgress)\r\n  }, [match.inProgress])\r\n\r\n  // Clear celebration as soon as turn advances to the next player\r\n  useEffect(() => {\r\n    if (celebration && match.currentPlayerIdx !== celebration.turnIdx) {\r\n      setCelebration(null)\r\n    }\r\n  }, [match.currentPlayerIdx, celebration?.turnIdx])\r\n\r\n  // If the user changes the spectate preference, push updated presence to the server\r\n  useEffect(() => {\r\n    try {\r\n      if (wsGlobal && wsGlobal.connected) {\r\n        wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n      } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        wsRef.current.send(JSON.stringify({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate }))\r\n      }\r\n    } catch {}\r\n  }, [allowSpectate, wsGlobal?.connected])\r\n\r\n  // Spectator flow: listen to spectate events from Friends and join room as readonly\r\n  useEffect(() => {\r\n    const onSpectate = (e: any) => {\r\n      const rid = e?.detail?.roomId\r\n      if (!rid) return\r\n      setRoomId(rid)\r\n      // send spectate message\r\n      if (wsGlobal) wsGlobal.send({ type: 'spectate', roomId: rid })\r\n      else wsRef.current?.send(JSON.stringify({ type: 'spectate', roomId: rid }))\r\n      setShowMatchModal(true)\r\n      setShowCreate(false)\r\n    }\r\n    window.addEventListener('ndn:spectate-room', onSpectate as any)\r\n    return () => window.removeEventListener('ndn:spectate-room', onSpectate as any)\r\n  }, [wsGlobal])\r\n\r\n  function connect() {\r\n    if (wsGlobal) {\r\n      // If global provider exists, rely on it for connection and just send initial commands\r\n      if (wsGlobal.connected) {\r\n        wsGlobal.send({ type: 'join', roomId })\r\n  wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n        wsGlobal.send({ type: 'list-matches' })\r\n        setConnected(true)\r\n      }\r\n      return\r\n    }\r\n    // Avoid duplicate sockets\r\n    try { if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) return } catch {}\r\n  const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n  const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n  const host = window.location.hostname\r\n  const fallback = `${proto}://${host}${window.location.port ? '' : ':8787'}`\r\n  const url = envUrl && typeof envUrl === 'string' && envUrl.length > 0 ? envUrl : fallback\r\n  const ws = new WebSocket(url)\r\n    wsRef.current = ws\r\n    ws.onopen = () => {\r\n      setConnected(true)\r\n      // Reset backoff\r\n      reconnectAttemptsRef.current = 0\r\n      if (!firstConnectDoneRef.current) {\r\n        toast('Connected to lobby', { type: 'success' })\r\n        firstConnectDoneRef.current = true\r\n      } else {\r\n        toast('Reconnected to lobby', { type: 'success' })\r\n      }\r\n    ws.send(JSON.stringify({ type: 'join', roomId }))\r\n    // send presence\r\n  ws.send(JSON.stringify({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate }))\r\n      // fetch current lobby\r\n      ws.send(JSON.stringify({ type: 'list-matches' }))\r\n    }\r\n    ws.onmessage = (ev) => {\r\n      const data = JSON.parse(ev.data)\r\n      if (data.type === 'state') {\r\n        match.importState(data.payload)\r\n        // Pull Double Practice progress if present\r\n        const di = Number((data.payload as any)._dpIndex)\r\n        const dh = Number((data.payload as any)._dpHits)\r\n        if (Number.isFinite(di)) setDpIndex(Math.max(0, di))\r\n        if (Number.isFinite(dh)) setDpHits(Math.max(0, dh))\r\n        // Pull Around the Clock progress if present\r\n        const ai = Number((data.payload as any)._atcIndex)\r\n        const ah = Number((data.payload as any)._atcHits)\r\n        if (Number.isFinite(ai)) setAtcIndex(Math.max(0, ai))\r\n        if (Number.isFinite(ah)) setAtcHits(Math.max(0, ah))\r\n        // Pull Treble Practice progress if present\r\n        try {\r\n          const tt = Number((data.payload as any)._trebleTarget)\r\n          const th = Number((data.payload as any)._trebleHits)\r\n          const td = Number((data.payload as any)._trebleDarts)\r\n          const tmax = Number((data.payload as any)._trebleMaxDarts)\r\n          if (Number.isFinite(tt)) setTrebleTarget(Math.max(1, Math.min(20, tt)))\r\n          if (Number.isFinite(th)) setTrebleHits(Math.max(0, th))\r\n          if (Number.isFinite(td)) setTrebleDarts(Math.max(0, td))\r\n          if (Number.isFinite(tmax)) setTrebleMaxDarts(Math.max(0, tmax))\r\n        } catch {}\r\n        // Premium per-player states\r\n        try {\r\n          const _cr = (data.payload as any)._cricketById\r\n          if (_cr && typeof _cr === 'object') setCricketById(_cr)\r\n        } catch {}\r\n        try {\r\n          const _sh = (data.payload as any)._shanghaiById\r\n          if (_sh && typeof _sh === 'object') setShanghaiById(_sh)\r\n        } catch {}\r\n        try {\r\n          const _hv = (data.payload as any)._halveById\r\n          if (_hv && typeof _hv === 'object') setHalveById(_hv)\r\n        } catch {}\r\n        try {\r\n          const _hl = (data.payload as any)._highlowById\r\n          if (_hl && typeof _hl === 'object') setHighlowById(_hl)\r\n        } catch {}\r\n        try {\r\n          const _kr = (data.payload as any)._killerById\r\n          if (_kr && typeof _kr === 'object') setKillerById(_kr)\r\n        } catch {}\r\n        try { const _am = (data.payload as any)._amCricketById; if (_am && typeof _am === 'object') setAmCricketById(_am) } catch {}\r\n        try { const _bb = (data.payload as any)._baseballById; if (_bb && typeof _bb === 'object') setBaseballById(_bb) } catch {}\r\n        try { const _gf = (data.payload as any)._golfById; if (_gf && typeof _gf === 'object') setGolfById(_gf) } catch {}\r\n        try { const _tt = (data.payload as any)._tttState; if (_tt && typeof _tt === 'object') setTTT(_tt) } catch {}\r\n        try {\r\n          const _td = Number((data.payload as any)._turnDarts)\r\n          if (Number.isFinite(_td)) setTurnDarts(Math.max(0, _td))\r\n        } catch {}\r\n        // Pull X01 Double-In per-match if present\r\n        try {\r\n          const _di = (data.payload as any)._x01DoubleIn\r\n          if (typeof _di === 'boolean') setX01DoubleInMatch(_di)\r\n        } catch {}\r\n      } else if (data.type === 'joined') {\r\n        // joined room; keep our assigned id to label messages\r\n        if (data.id) setSelfId(data.id)\r\n      } else if (data.type === 'presence' || data.type === 'peer-joined') {\r\n        // Maintain a simple list of participant ids. In a real app we would map id->username.\r\n        setParticipants(prev => {\r\n          const set = new Set(prev)\r\n          if (data.id) set.add(data.id)\r\n          return Array.from(set)\r\n        })\r\n      } else if (data.type === 'chat') {\r\n        const isSelf = !!(data.from && selfId && data.from === selfId)\r\n        const label = isSelf ? (user?.username || 'me') : (data.from || 'peer')\r\n        const idKey = String(data.from || '')\r\n        // Skip messages from blocked senders (only applies to non-self)\r\n        if (!isSelf && idKey && blocklist.isBlocked(idKey)) return\r\n        // De-dupe if this is our own recently-sent quick message already appended locally\r\n        if (isSelf && lastSentChatRef.current && String(data.message||'') === lastSentChatRef.current.text) {\r\n          // Clear marker and do not append again\r\n          lastSentChatRef.current = null\r\n          return\r\n        }\r\n        setChat(prev => [...prev, { from: label, message: data.message, fromId: idKey || undefined }])\r\n      } else if (data.type === 'matches') {\r\n        setLobby(Array.isArray(data.matches) ? data.matches : [])\r\n      } else if (data.type === 'invite') {\r\n        setPendingInvite({ matchId: data.matchId, fromId: data.fromId, fromName: data.fromName, calibrated: !!data.calibrated, boardPreview: data.boardPreview || null, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n      } else if (data.type === 'match-start') {\r\n        // Both parties received a room id to join\r\n        setRoomId(data.roomId)\r\n        // Auto-join the room\r\n        ws.send(JSON.stringify({ type: 'join', roomId: data.roomId }))\r\n        setShowMatchModal(true)\r\n        setShowCreate(false)\r\n        if (data.match?.game) setCurrentGame(data.match.game)\r\n        // Consume a free game for non-premium users\r\n        if (user?.username && !user?.fullAccess) {\r\n          incOnlineUsage(user.username)\r\n        }\r\n      } else if (data.type === 'declined') {\r\n        toast('Invite declined', { type: 'info' })\r\n      } else if (data.type === 'error') {\r\n        const msg = typeof data.message === 'string' ? data.message : 'Action not allowed'\r\n        setErrorMsg(msg)\r\n        if (data.code === 'SPECTATE_NOT_ALLOWED') {\r\n          try { toast('This player has spectating turned off.', { type: 'error' }) } catch {}\r\n        }\r\n        if (data.code === 'NOT_FOUND' && lastJoinIntent) {\r\n          setOfferNewRoom({\r\n            game: lastJoinIntent.game,\r\n            mode: lastJoinIntent.mode,\r\n            value: lastJoinIntent.value,\r\n            startingScore: lastJoinIntent.startingScore,\r\n          })\r\n        }\r\n        // auto-clear after a bit\r\n        setTimeout(()=>setErrorMsg(''), 3500)\r\n      } else if (data.type === 'friend-invite') {\r\n        const accept = confirm(`${data.fromName || data.fromEmail} invited you to play ${data.game || 'X01'} (${data.mode==='firstto'?'First To':'Best Of'} ${data.value||1}). Accept?`)\r\n        if (accept) {\r\n          ws.send(JSON.stringify({ type: 'start-friend-match', toEmail: data.fromEmail, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore }))\r\n        } else {\r\n          toast('Invite declined', { type: 'info' })\r\n        }\r\n      } else if (data.type === 'friend-message') {\r\n        msgs.add({ id: data.id || `${data.ts}-${data.from}`, from: data.from, message: data.message, ts: data.ts || Date.now() })\r\n        // Show toast only if not currently in a game\r\n        if (!match.inProgress) toast(`${data.from}: ${data.message}`, { type: 'info' })\r\n      } else if (data.type === 'celebration') {\r\n        const who = data.by || 'Player'\r\n        const kind = data.kind === 'leg' ? 'leg' : '180'\r\n        triggerCelebration(kind, who)\r\n      } else if (data.type === 'cam-code') {\r\n        console.log('Received cam-code:', data.code)\r\n        setPairingCode(data.code)\r\n        toast(`Pairing code: ${data.code}`, { type: 'info' })\r\n      } else if (data.type === 'cam-peer-joined') {\r\n        console.log('Mobile peer joined for code:', data.code)\r\n        // Mobile camera connected, start WebRTC\r\n        startMobileWebRTC(data.code)\r\n      } else if (data.type === 'cam-answer') {\r\n        console.log('Received cam-answer')\r\n        const pc = (window as any).mobilePC\r\n        if (pc) pc.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n      } else if (data.type === 'cam-ice') {\r\n        console.log('Received cam-ice')\r\n        const pc = (window as any).mobilePC\r\n        if (pc) pc.addIceCandidate(data.payload)\r\n      }\r\n    }\r\n    ws.onclose = () => {\r\n      setConnected(false)\r\n      // Auto-reconnect with exponential backoff\r\n      if (!shouldReconnectRef.current) return\r\n      const attempt = (reconnectAttemptsRef.current || 0) + 1\r\n      reconnectAttemptsRef.current = attempt\r\n      const delay = Math.min(30000, 1000 * Math.pow(2, attempt - 1))\r\n      const now = Date.now()\r\n      if (now - lastToastRef.current > 4000) {\r\n        toast(`Disconnected. Reconnecting in ${Math.round(delay/1000)}s...`, { type: 'error' })\r\n        lastToastRef.current = now\r\n      }\r\n      if (reconnectTimerRef.current) clearTimeout(reconnectTimerRef.current)\r\n      reconnectTimerRef.current = setTimeout(() => {\r\n        connect()\r\n      }, delay)\r\n    }\r\n  }\r\n  // Small helper to render the match summary card\r\n  function RenderMatchSummary() {\r\n    const players = match.players || []\r\n    const curIdx = match.currentPlayerIdx || 0\r\n    const cur = players[curIdx]\r\n    const leg = cur?.legs?.[cur?.legs?.length - 1]\r\n    const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n    // TV-style 3-dart average: sum points across all legs / total darts * 3\r\n    const totals = (() => {\r\n      let pts = 0, darts = 0\r\n      if (cur?.legs) {\r\n        for (const L of cur.legs) {\r\n          // Points: sum of scored points this leg\r\n          pts += (L.totalScoreStart - L.totalScoreRemaining)\r\n          // Darts: sum visits darts, subtract pre-open darts (Double-In) if any\r\n          const legDarts = (L.visits || []).reduce((a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0), 0)\r\n          darts += legDarts\r\n        }\r\n      }\r\n      return { pts, darts }\r\n    })()\r\n    const avg3 = totals.darts > 0 ? ((totals.pts / totals.darts) * 3) : 0\r\n    const lastScore = leg?.visits?.[leg.visits.length-1]?.score ?? 0\r\n    let matchScore = 'ÔÇö'\r\n    if (players.length === 2) {\r\n      matchScore = `${players[0]?.legsWon || 0}-${players[1]?.legsWon || 0}`\r\n    } else if (players.length > 2) {\r\n      matchScore = players.map(p => `${p.name}:${p.legsWon||0}`).join(' = ')\r\n    }\r\n    const best = match.bestLegThisMatch\r\n    const bestText = best ? `${best.darts} darts${(() => { const p = players.find(x=>x.id===best.playerId); return p?` (${p.name})`:'' })()}` : '-'\r\n    \r\n    // Text size classes\r\n    const getTextSizeClasses = (size: string) => {\r\n      switch (size) {\r\n        case 'small': return 'text-xs'\r\n        case 'large': return 'text-base'\r\n        default: return 'text-sm'\r\n      }\r\n    }\r\n    const textSizeClass = getTextSizeClasses(textSize)\r\n    \r\n    // Box size classes\r\n    const getBoxSizeClasses = (size: string) => {\r\n      switch (size) {\r\n        case 'small': return 'p-2'\r\n        case 'large': return 'p-4'\r\n        default: return 'p-3'\r\n      }\r\n    }\r\n    const boxSizeClass = getBoxSizeClasses(boxSize)\r\n    \r\n    return (\r\n      <div className={`${boxSizeClass} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSizeClass}`}>\r\n        <div className=\"font-semibold mb-2\">Match Summary</div>\r\n        <div className=\"grid grid-cols-2 gap-y-1\">\r\n          <div className=\"opacity-80\">Current score</div>\r\n          <div className=\"font-mono text-right\">{matchScore}</div>\r\n          <div className=\"opacity-80\">Current thrower</div>\r\n          <div className=\"text-right font-semibold\">{cur?.name || 'ÔÇö'}</div>\r\n          <div className=\"opacity-80\">Score remaining</div>\r\n          <div className=\"text-right font-mono font-bold text-lg\">{remaining}</div>\r\n          <div className=\"opacity-80\">3-dart avg</div>\r\n          <div className=\"text-right font-mono\">{avg3.toFixed(1)}</div>\r\n          <div className=\"opacity-80\">Last score</div>\r\n          <div className=\"text-right font-mono\">{lastScore}</div>\r\n          <div className=\"opacity-80\">Best leg</div>\r\n          <div className=\"text-right\">{bestText}</div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  \r\n\r\n  // Subscribe to global WS messages if available\r\n  useEffect(() => {\r\n    if (!wsGlobal) return\r\n    setConnected(wsGlobal.connected)\r\n    const unsub = wsGlobal.addListener((data) => {\r\n      try {\r\n        if (data.type === 'state') {\r\n          match.importState(data.payload)\r\n          // Pull synchronized premium states (when using WS provider)\r\n          try {\r\n            const di = Number((data.payload as any)._dpIndex); const dh = Number((data.payload as any)._dpHits)\r\n            if (Number.isFinite(di)) setDpIndex(Math.max(0, di))\r\n            if (Number.isFinite(dh)) setDpHits(Math.max(0, dh))\r\n          } catch {}\r\n          try {\r\n            const ai = Number((data.payload as any)._atcIndex); const ah = Number((data.payload as any)._atcHits)\r\n            if (Number.isFinite(ai)) setAtcIndex(Math.max(0, ai))\r\n            if (Number.isFinite(ah)) setAtcHits(Math.max(0, ah))\r\n          } catch {}\r\n          try { const _cr = (data.payload as any)._cricketById; if (_cr && typeof _cr === 'object') setCricketById(_cr) } catch {}\r\n          try { const _sh = (data.payload as any)._shanghaiById; if (_sh && typeof _sh === 'object') setShanghaiById(_sh) } catch {}\r\n          try { const _hv = (data.payload as any)._halveById; if (_hv && typeof _hv === 'object') setHalveById(_hv) } catch {}\r\n          try { const _hl = (data.payload as any)._highlowById; if (_hl && typeof _hl === 'object') setHighlowById(_hl) } catch {}\r\n          try { const _kr = (data.payload as any)._killerById; if (_kr && typeof _kr === 'object') setKillerById(_kr) } catch {}\r\n          // Phase 2\r\n          try { const _am = (data.payload as any)._amCricketById; if (_am && typeof _am === 'object') setAmCricketById(_am) } catch {}\r\n          try { const _bb = (data.payload as any)._baseballById; if (_bb && typeof _bb === 'object') setBaseballById(_bb) } catch {}\r\n          try { const _gf = (data.payload as any)._golfById; if (_gf && typeof _gf === 'object') setGolfById(_gf) } catch {}\r\n          try { const _tt = (data.payload as any)._tttState; if (_tt && typeof _tt === 'object') setTTT(_tt) } catch {}\r\n          try { const _td = Number((data.payload as any)._turnDarts); if (Number.isFinite(_td)) setTurnDarts(Math.max(0, _td)) } catch {}\r\n          // Pause sync\r\n          try { const _paused = !!(data.payload as any)._paused; setPausedLocal(_paused); } catch {}\r\n          try { const _pEnds = Number((data.payload as any)._pauseEndsAt); setPauseEndsAt(Number.isFinite(_pEnds) ? _pEnds : null) } catch {}\r\n          try { const _pBy = (data.payload as any)._pauseRequestedBy; setPauseRequestedBy(typeof _pBy === 'string' ? _pBy : null) } catch {}\r\n          try { const _acc = (data.payload as any)._pauseAcceptedBy; if (_acc && typeof _acc === 'object') setPauseAcceptedBy(_acc) } catch {}\r\n          try { const _dur = Number((data.payload as any)._pauseDurationSec); if (Number.isFinite(_dur)) setPauseDurationSec(Math.max(60, Math.min(600, _dur))) } catch {}\r\n      // X01 Double-In per-match\r\n      try { const _di = (data.payload as any)._x01DoubleIn; if (typeof _di === 'boolean') setX01DoubleInMatch(_di) } catch {}\r\n          // Update global pause store\r\n          setPausedGlobal(!!(data.payload as any)._paused, Number((data.payload as any)._pauseEndsAt) || null)\r\n        } else if (data.type === 'joined') {\r\n          if (data.id) setSelfId(data.id)\r\n        } else if (data.type === 'presence' || data.type === 'peer-joined') {\r\n          setParticipants(prev => Array.from(new Set([...(prev||[]), data.id].filter(Boolean))))\r\n        } else if (data.type === 'chat') {\r\n          const isSelf = !!(data.from && selfId && data.from === selfId)\r\n          const label = isSelf ? (user?.username || 'me') : (data.from || 'peer')\r\n          const idKey = String(data.from || '')\r\n          if (!isSelf && idKey && blocklist.isBlocked(idKey)) return\r\n          setChat(prev => [...prev, { from: label, message: data.message, fromId: idKey || undefined }])\r\n        } else if (data.type === 'matches') {\r\n          setLobby(Array.isArray(data.matches) ? data.matches : [])\r\n        } else if (data.type === 'invite') {\r\n          setPendingInvite({ matchId: data.matchId, fromId: data.fromId, fromName: data.fromName, calibrated: !!data.calibrated, boardPreview: data.boardPreview || null, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n        } else if (data.type === 'match-start') {\r\n          setRoomId(data.roomId)\r\n          wsGlobal.send({ type: 'join', roomId: data.roomId })\r\n          setShowMatchModal(true)\r\n          setShowCreate(false)\r\n          if (data.match?.game) setCurrentGame(data.match.game)\r\n          if (user?.username && !user?.fullAccess) {\r\n            incOnlineUsage(user.username)\r\n          }\r\n        } else if (data.type === 'declined') {\r\n          toast('Invite declined', { type: 'info' })\r\n        } else if (data.type === 'error') {\r\n          const msg = typeof data.message === 'string' ? data.message : 'Action not allowed'\r\n          setErrorMsg(msg)\r\n          if (data.code === 'SPECTATE_NOT_ALLOWED') {\r\n            try { toast('This player has spectating turned off.', { type: 'error' }) } catch {}\r\n          }\r\n          if (data.code === 'NOT_FOUND' && lastJoinIntent) {\r\n            setOfferNewRoom({\r\n              game: lastJoinIntent.game,\r\n              mode: lastJoinIntent.mode,\r\n              value: lastJoinIntent.value,\r\n              startingScore: lastJoinIntent.startingScore,\r\n            })\r\n          }\r\n          setTimeout(()=>setErrorMsg(''), 3500)\r\n        } else if (data.type === 'friend-invite') {\r\n          const accept = confirm(`${data.fromName || data.fromEmail} invited you to play ${data.game || 'X01'} (${data.mode==='firstto'?'First To':'Best Of'} ${data.value||1}). Accept?`)\r\n          if (accept) {\r\n            wsGlobal.send({ type: 'start-friend-match', toEmail: data.fromEmail, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n          } else {\r\n            toast('Invite declined', { type: 'info' })\r\n          }\r\n        } else if (data.type === 'friend-message') {\r\n          msgs.add({ id: data.id || `${data.ts}-${data.from}`, from: data.from, message: data.message, ts: data.ts || Date.now() })\r\n          if (!match.inProgress) toast(`${data.from}: ${data.message}`, { type: 'info' })\r\n        } else if (data.type === 'celebration') {\r\n          const who = data.by || 'Player'\r\n          const kind = data.kind === 'leg' ? 'leg' : '180'\r\n          triggerCelebration(kind, who)\r\n        }\r\n      } catch {}\r\n    })\r\n    // On connect, join and load lobby\r\n    if (wsGlobal.connected) {\r\n      wsGlobal.send({ type: 'join', roomId })\r\n  wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n      wsGlobal.send({ type: 'list-matches' })\r\n    }\r\n    return () => { unsub() }\r\n  }, [wsGlobal?.connected])\r\n\r\n  function sendState() {\r\n    if (wsGlobal) {\r\n  wsGlobal.send({ type: 'state', payload: { ...match, _turnIdx: turnIdx, _participants: participants, _dpIndex: dpIndex, _dpHits: dpHits, _atcIndex: atcIndex, _atcHits: atcHits, _trebleTarget: trebleTarget, _trebleHits: trebleHits, _trebleDarts: trebleDarts, _trebleMaxDarts: trebleMaxDarts, _x01DoubleIn: x01DoubleInMatch, _cricketById: cricketById, _shanghaiById: shanghaiById, _halveById: halveById, _highlowById: highlowById, _killerById: killerById, _amCricketById: amCricketById, _baseballById: baseballById, _golfById: golfById, _tttState: ttt, _turnDarts: turnDarts, _paused: paused, _pauseEndsAt: pauseEndsAt, _pauseRequestedBy: pauseRequestedBy, _pauseAcceptedBy: pauseAcceptedBy, _pauseDurationSec: pauseDurationSec } })\r\n      return\r\n    }\r\n    const ws = wsRef.current\r\n    if (!ws || ws.readyState !== WebSocket.OPEN) return\r\n  ws.send(JSON.stringify({ type: 'state', payload: { ...match, _turnIdx: turnIdx, _participants: participants, _dpIndex: dpIndex, _dpHits: dpHits, _atcIndex: atcIndex, _atcHits: atcHits, _trebleTarget: trebleTarget, _trebleHits: trebleHits, _trebleDarts: trebleDarts, _trebleMaxDarts: trebleMaxDarts, _x01DoubleIn: x01DoubleInMatch, _cricketById: cricketById, _shanghaiById: shanghaiById, _halveById: halveById, _highlowById: highlowById, _killerById: killerById, _amCricketById: amCricketById, _baseballById: baseballById, _golfById: golfById, _tttState: ttt, _turnDarts: turnDarts, _paused: paused, _pauseEndsAt: pauseEndsAt, _pauseRequestedBy: pauseRequestedBy, _pauseAcceptedBy: pauseAcceptedBy, _pauseDurationSec: pauseDurationSec } }))\r\n  }\r\n\r\n  function sendQuick(msg: string) {\r\n    const label = user?.username || 'me'\r\n    // Optimistically append locally for snappy UX\r\n    setChat(prev => [...prev, { from: label, message: msg, fromId: selfId || 'self' }])\r\n    lastSentChatRef.current = { text: msg, ts: Date.now() }\r\n    if (wsGlobal) {\r\n      wsGlobal.send({ type: 'chat', message: msg })\r\n      return\r\n    }\r\n    const ws = wsRef.current\r\n    if (!ws || ws.readyState !== WebSocket.OPEN) return\r\n    ws.send(JSON.stringify({ type: 'chat', message: msg }))\r\n  }\r\n\r\n  // Double Practice handlers\r\n  function addDpValue(dart: number) {\r\n    const hit = isDoubleHit(dart, dpIndex)\r\n    if (hit) {\r\n      const newHits = dpHits + 1\r\n      const nextIdx = dpIndex + 1\r\n      setDpHits(newHits)\r\n      setDpIndex(nextIdx)\r\n      // Celebrate completion locally\r\n      try {\r\n        if (newHits >= DOUBLE_PRACTICE_ORDER.length) {\r\n          const who = match.players[match.currentPlayerIdx]?.name || 'Player'\r\n          triggerCelebration('leg', who)\r\n          // Reset for another round\r\n          setDpHits(0)\r\n          setDpIndex(0)\r\n        }\r\n      } catch {}\r\n    }\r\n    // Sync to peers\r\n    sendState()\r\n  }\r\n  function addDpNumeric() {\r\n    const v = Math.max(0, Math.floor(visitScore|0))\r\n    addDpValue(v)\r\n    setVisitScore(0)\r\n  }\r\n  function addDpManual() {\r\n    const val = parseManualDart(dpManual)\r\n    if (val == null) return\r\n    addDpValue(val)\r\n    setDpManual('')\r\n  }\r\n\r\n  // Around the Clock handlers\r\n  function isAtcHit(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const target = ATC_ORDER[atcIndex]\r\n    if (target == null) return false\r\n    if (typeof sector === 'number' && sector >= 1 && sector <= 20) {\r\n      if (sector === target && (ring === 'SINGLE' || ring === 'DOUBLE' || ring === 'TRIPLE')) return true\r\n    }\r\n    if (target === 25) {\r\n      return ring === 'BULL' || val === 25\r\n    }\r\n    if (target === 50) {\r\n      return ring === 'INNER_BULL' || val === 50\r\n    }\r\n    return val === target || val === target * 2 || val === target * 3\r\n  }\r\n  function addAtcValue(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (isAtcHit(val, ring, sector)) {\r\n      const newHits = atcHits + 1\r\n      const nextIdx = atcIndex + 1\r\n      setAtcHits(newHits)\r\n      setAtcIndex(nextIdx)\r\n      try {\r\n        if (newHits >= ATC_ORDER.length) {\r\n          const who = match.players[match.currentPlayerIdx]?.name || 'Player'\r\n          triggerCelebration('leg', who)\r\n          setAtcHits(0)\r\n          setAtcIndex(0)\r\n        }\r\n      } catch {}\r\n    }\r\n    sendState()\r\n  }\r\n  function addAtcNumeric() {\r\n    const v = Math.max(0, Math.floor(visitScore|0))\r\n    addAtcValue(v)\r\n    setVisitScore(0)\r\n  }\r\n  function addAtcManual() {\r\n    const val = parseManualDart(atcManual)\r\n    if (val == null) return\r\n    addAtcValue(val)\r\n    setAtcManual('')\r\n  }\r\n\r\n  // Treble Practice handlers\r\n  function addTrebleValue(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    // Stop counting beyond configured throws\r\n    if (trebleMaxDarts > 0 && trebleDarts >= trebleMaxDarts) return\r\n    const hit = (ring === 'TRIPLE' && sector === trebleTarget) || (!ring && value === trebleTarget * 3)\r\n    if (hit) setTrebleHits(h => h + 1)\r\n    setTrebleDarts(d => {\r\n      const nd = d + 1\r\n      // Auto-rotate T20→T19→T18 every 3 darts\r\n      if (nd % 3 === 0 && [20,19,18].includes(trebleTarget)) {\r\n        const cycle = [20,19,18]\r\n        const idx = cycle.indexOf(trebleTarget)\r\n        const next = cycle[(idx + 1) % cycle.length]\r\n        setTrebleTarget(next)\r\n      }\r\n      return nd\r\n    })\r\n    sendState()\r\n  }\r\n  function addTrebleNumeric() {\r\n    const v = Math.max(0, Math.floor(visitScore|0))\r\n    // No ring info, rely on numeric value only\r\n    addTrebleValue(v)\r\n    setVisitScore(0)\r\n  }\r\n  function addTrebleManual() {\r\n    const val = parseManualDart(trebleManual)\r\n    if (val == null) return\r\n    addTrebleValue(val)\r\n    setTrebleManual('')\r\n  }\r\n  function resetTreble() { setTrebleHits(0); setTrebleDarts(0) }\r\n\r\n  // Helpers for premium modes\r\n  function currentPlayerId(): string {\r\n    const p = match.players[match.currentPlayerIdx]\r\n    return p?.id ?? String(match.currentPlayerIdx)\r\n  }\r\n  // Ensure state exists for a given player id\r\n  function ensureCricket(pid: string) {\r\n    if (!cricketById[pid]) setCricketById(s => ({ ...s, [pid]: createCricketState() }))\r\n  }\r\n  function ensureShanghai(pid: string) {\r\n    if (!shanghaiById[pid]) setShanghaiById(s => ({ ...s, [pid]: createShanghaiState() }))\r\n  }\r\n  function ensureHalve(pid: string) {\r\n    if (!halveById[pid]) setHalveById(s => ({ ...s, [pid]: createDefaultHalveIt() }))\r\n  }\r\n  function ensureHighLow(pid: string) {\r\n    if (!highlowById[pid]) setHighlowById(s => ({ ...s, [pid]: createHighLow() }))\r\n  }\r\n  function ensureKiller(pid: string) {\r\n    if (!killerById[pid]) {\r\n      // If any existing assignments, pick the highest density or default to pid index\r\n      const used = new Set<number>(Object.values(killerById || {}).map(s => s.number))\r\n      const pool: number[] = []\r\n      for (let i=1;i<=20;i++){ if (!used.has(i)) pool.push(i) }\r\n      const num = pool.length>0 ? pool[Math.floor(Math.random()*pool.length)] : 20\r\n      setKillerById(s => ({ ...s, [pid]: createKillerState(num, 3) }))\r\n    }\r\n  }\r\n  function ensureAmCricket(pid: string) {\r\n    if (!amCricketById[pid]) setAmCricketById(s => ({ ...s, [pid]: createAmCricketState() }))\r\n  }\r\n  function ensureBaseball(pid: string) {\r\n    if (!baseballById[pid]) setBaseballById(s => ({ ...s, [pid]: createBaseball() }))\r\n  }\r\n  function ensureGolf(pid: string) {\r\n    if (!golfById[pid]) setGolfById(s => ({ ...s, [pid]: createGolf() }))\r\n  }\r\n  // Resets darts count on player change for non-X01 games\r\n  useEffect(() => { setTurnDarts(0) }, [match.currentPlayerIdx, currentGame])\r\n\r\n  // Compute whether all opponents have closed a cricket number\r\n  function allOpponentsClosed(num: 15|16|17|18|19|20|25, selfId: string): boolean {\r\n    const opps = match.players.filter(p => p.id !== selfId)\r\n    if (opps.length === 0) return false\r\n    return opps.every(p => (cricketById[p.id]?.marks?.[num] || 0) >= 3)\r\n  }\r\n\r\n  function applyCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureCricket(pid)\r\n    setCricketById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createCricketState()) }\r\n      const pts = applyCricketDart(st, value, ring, sector, (n)=>allOpponentsClosed(n, pid))\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      // end turn\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyShanghaiAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureShanghai(pid)\r\n    setShanghaiById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createShanghaiState()) }\r\n      applyShanghaiDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setShanghaiById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createShanghaiState()) }\r\n        endShanghaiTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyHalveAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureHalve(pid)\r\n    setHalveById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createDefaultHalveIt()) }\r\n      applyHalveItDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setHalveById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createDefaultHalveIt()) }\r\n        endHalveItTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyHighLowAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureHighLow(pid)\r\n    setHighlowById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createHighLow()) }\r\n      applyHighLowDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setHighlowById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createHighLow()) }\r\n        endHighLowTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyKillerAuto(ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    // Ensure every player has an assignment before applying\r\n    match.players.forEach(p => ensureKiller(p.id))\r\n    setKillerById(prev => {\r\n      const copy: Record<string, ReturnType<typeof createKillerState>> = {}\r\n      for (const [id, st] of Object.entries(prev)) copy[id] = { ...st }\r\n      const res = applyKillerDart(pid, copy, ring, sector)\r\n      // Trigger simple winner check\r\n      const win = killerWinner(copy)\r\n      if (win) {\r\n        try { triggerCelebration('leg', match.players.find(p=>p.id===win)?.name || 'Player') } catch {}\r\n      }\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyAmCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureAmCricket(pid)\r\n    setAmCricketById(prev => {\r\n      const copy = { ...prev }\r\n      const base = (copy[pid] || createAmCricketState())\r\n      const st: ReturnType<typeof createAmCricketState> = { ...(base as any) }\r\n      const oppClosed = (n: 12|13|14|15|16|17|18|19|20|25) => match.players.filter(p=>p.id!==pid).every(p => (((amCricketById[p.id]?.marks as any)?.[n]||0) >= 3))\r\n      applyAmCricketDart(st, value, ring, sector, oppClosed)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyBaseballAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureBaseball(pid)\r\n    setBaseballById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createBaseball()) }\r\n      applyBaseballDart(st, value, ring as any, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyGolfAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureGolf(pid)\r\n    setGolfById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createGolf()) }\r\n      applyGolfDart(st, value, ring as any, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyTttAuto(cell: number, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setTTT(prev => {\r\n      const cp = { ...prev, board: [...prev.board] as any }\r\n      tryClaimCell(cp as any, (cell as any), value, ring as any, sector)\r\n      return cp as any\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  // Open/close Manual Correction dialog in CameraView\r\n  function openManual() { try { window.dispatchEvent(new Event('ndn:open-manual' as any)) } catch {} }\r\n  function closeManual() { try { window.dispatchEvent(new Event('ndn:close-manual' as any)) } catch {} }\r\n\r\n  // Helper to submit a manual visit with shared logic\r\n  function submitVisitManual(v: number) {\r\n    const score = Math.max(0, v | 0)\r\n    // Estimate double-out attempts and finish for manual numeric entry\r\n    try {\r\n      const p = match.players[match.currentPlayerIdx]\r\n      const leg = p?.legs?.[p.legs.length - 1]\r\n      const preRem = leg ? leg.totalScoreRemaining : match.startingScore\r\n      const postRem = Math.max(0, preRem - score)\r\n      const attempts = preRem <= 50 ? 3 : (postRem <= 50 ? 1 : 0)\r\n      const finished = postRem === 0\r\n      match.addVisit(score, 3, { preOpenDarts: 0, doubleWindowDarts: attempts, finishedByDouble: finished, visitTotal: score })\r\n    } catch {\r\n      match.addVisit(score, 3)\r\n    }\r\n    setVisitScore(0)\r\n    const p = match.players[match.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length - 1]\r\n    // Instant celebration locally\r\n    try {\r\n      if (score === 180) triggerCelebration('180', p?.name || 'Player')\r\n      if (leg && leg.totalScoreRemaining === 0) triggerCelebration('leg', p?.name || 'Player')\r\n    } catch {}\r\n    if (leg && leg.totalScoreRemaining === 0) { match.endLeg(score) } else { match.nextPlayer() }\r\n    if (callerEnabled) {\r\n      const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n      sayScore(user?.username || 'Player', score, Math.max(0, rem), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n    }\r\n    if (user?.username && p?.name === user.username) { addSample(user.username, 3, score) }\r\n    sendState()\r\n  }\r\n\r\n  function reportMessage(offenderId: string | null, text: string) {\r\n    const payload: any = { type: 'report', offenderId, reason: 'Inappropriate language', message: text }\r\n    try { if (wsGlobal) wsGlobal.send(payload); else wsRef.current?.send(JSON.stringify(payload)) } catch {}\r\n    try { toast('Report submitted', { type: 'info' }) } catch {}\r\n  }\r\n\r\n  function isMobileLike() {\r\n    if (typeof navigator === 'undefined') return false\r\n    const ua = navigator.userAgent || ''\r\n    return /Android|iPhone|iPad|iPod|Mobile/i.test(ua)\r\n  }\r\n\r\n  // Try to take a quick camera snapshot to show to the match creator (non-blocking)\r\n  async function getBoardPreview(): Promise<string | null> {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n      const track = stream.getVideoTracks?.()[0]\r\n      // Create a hidden video element to draw a frame\r\n      const video = document.createElement('video')\r\n      video.srcObject = stream\r\n      await video.play().catch(()=>{})\r\n      // Wait a moment for first frame\r\n      await new Promise(r => setTimeout(r, 120))\r\n      const w = Math.min(320, video.videoWidth || 320)\r\n      const h = Math.max(1, Math.floor((video.videoHeight || 180) * (w / Math.max(1, video.videoWidth || 320))))\r\n      const canvas = document.createElement('canvas')\r\n      canvas.width = w; canvas.height = h\r\n      const ctx = canvas.getContext('2d')!\r\n      ctx.drawImage(video, 0, 0, w, h)\r\n      const url = canvas.toDataURL('image/jpeg', 0.7)\r\n      // Cleanup\r\n      try { if (track) track.stop() } catch {}\r\n      try { (stream as any).getTracks?.().forEach((t:any)=>t.stop()) } catch {}\r\n      return url\r\n    } catch {\r\n      return null\r\n    }\r\n  }\r\n\r\n  // WebRTC for mobile camera\r\n  const startMobileWebRTC = async (code: string) => {\r\n    console.log('Starting WebRTC for code:', code)\r\n    try {\r\n      const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] })\r\n      pc.ontrack = (event) => {\r\n        console.log('Received track:', event.streams[0])\r\n        setMobileStream(event.streams[0])\r\n        if (mobileVideoRef.current) {\r\n          mobileVideoRef.current.srcObject = event.streams[0]\r\n          console.log('Set video srcObject')\r\n        }\r\n      }\r\n      pc.onicecandidate = (event) => {\r\n        if (event.candidate) {\r\n          console.log('Sending ICE candidate')\r\n          if (wsGlobal) {\r\n            wsGlobal.send({ type: 'cam-ice', code, payload: event.candidate })\r\n          } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n            wsRef.current.send(JSON.stringify({ type: 'cam-ice', code, payload: event.candidate }))\r\n          }\r\n        }\r\n      }\r\n      pc.onconnectionstatechange = () => console.log('Connection state:', pc.connectionState)\r\n      const offer = await pc.createOffer()\r\n      await pc.setLocalDescription(offer)\r\n      console.log('Sending offer')\r\n      // Try WebSocket first, otherwise fall back to REST POST\r\n      if (wsGlobal) {\r\n        console.log('Sending offer via wsGlobal')\r\n        wsGlobal.send({ type: 'cam-offer', code, payload: offer })\r\n      } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        console.log('Sending offer via wsRef')\r\n        wsRef.current.send(JSON.stringify({ type: 'cam-offer', code, payload: offer }))\r\n      } else {\r\n        console.log('WS not available, POSTing offer to /cam/signal')\r\n        try {\r\n          await apiFetch(`/cam/signal/${code}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ type: 'cam-offer', payload: offer, source: 'desktop' }) })\r\n        } catch (e) { console.warn('REST offer failed', e) }\r\n      }\r\n      // Store pc for later use\r\n      (window as any).mobilePC = pc\r\n    } catch (err) {\r\n      console.error('WebRTC error:', err)\r\n      toast('Failed to start mobile camera', { type: 'error' })\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"card ndn-game-shell relative overflow-hidden\">\r\n      {showStartShowcase && <MatchStartShowcase players={match.players || []} onDone={() => setShowStartShowcase(false)} />}\r\n      <h2 className=\"text-xl font-semibold mb-1\">Online Play</h2>\r\n      <div className=\"ndn-shell-body\">\r\n      {/* Pause overlay/banner */}\r\n      {paused && (\r\n        <div className=\"absolute inset-0 z-40 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center text-center p-4\">\r\n          <div className=\"text-2xl font-bold mb-2\">Game Paused</div>\r\n          <div className=\"text-sm opacity-80 mb-4\">Resumes {pauseEndsAt ? `in ${Math.max(0, Math.ceil((pauseEndsAt - Date.now())/1000))}s` : 'soon'}</div>\r\n          <div className=\"text-xs opacity-60\">Both players can see this pause screen.</div>\r\n        </div>\r\n      )}\r\n      {unread > 0 && !match.inProgress && (\r\n        <div className=\"mb-3 text-sm px-3 py-2 rounded bg-amber-600/30 border border-amber-500/40\">\r\n          You have {unread} unread message{unread>1?'s':''}. Check the Friends tab.\r\n        </div>\r\n      )}\r\n      <div className=\"relative\">\r\n        <div className=\"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <label className=\"text-xs opacity-70 shrink-0\">Room</label>\r\n            <input className=\"input w-28\" value={roomId} onChange={e => setRoomId(e.target.value)} placeholder=\"room-1\" />\r\n          </div>\r\n          {connected ? (\r\n            <span className=\"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0\">Connected</span>\r\n          ) : (\r\n            <button className=\"btn bg-rose-600 hover:bg-rose-700 shrink-0\" onClick={connect}>Connect</button>\r\n          )}\r\n          <button className=\"btn shrink-0\" onClick={sendState} disabled={!connected}>Sync</button>\r\n          {/* Demo button for previewing the Match Start Showcase (DEV only) */}\r\n          {(import.meta as any).env?.DEV ? (\r\n            <button className=\"btn btn-ghost text-xs py-1\" onClick={() => setShowStartShowcase(true)}>Demo Start Showcase</button>\r\n          ) : null}\r\n          {/* Pause controls */}\r\n          {!paused && !pauseRequestedBy && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <label className=\"text-xs opacity-70\">Pause (max 10m)</label>\r\n              <select className=\"input w-28\" value={pauseDurationSec}\r\n                onChange={e => setPauseDurationSec(Math.max(60, Math.min(600, parseInt(e.target.value)||300)))}>\r\n                <option value={120}>2 min</option>\r\n                <option value={300}>5 min</option>\r\n                <option value={600}>10 min</option>\r\n              </select>\r\n              <button className=\"btn\" disabled={!connected}\r\n                onClick={() => {\r\n                  const me = (user?.username || 'player')\r\n                  setPauseRequestedBy(me)\r\n                  setPauseAcceptedBy({ [me]: true })\r\n                  setPausedLocal(false); setPauseEndsAt(null)\r\n                  sendState()\r\n                }}\r\n              >Request Pause</button>\r\n            </div>\r\n          )}\r\n          {!paused && pauseRequestedBy && !pauseAcceptedBy[(user?.username||'')] && (\r\n            <div className=\"flex items-center gap-2 text-xs\">\r\n              <span className=\"opacity-80\">{pauseRequestedBy} requested a {Math.round((pauseDurationSec||300)/60)}m pause</span>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\"\r\n                onClick={() => {\r\n                  const me = (user?.username || '')\r\n                  const next: Record<string, boolean> = { ...pauseAcceptedBy, [me]: true }\r\n                  setPauseAcceptedBy(next)\r\n                  // If at least 2 unique acceptances (both players), start pause\r\n                  const acceptedCount = Object.keys(next).filter((k: string) => !!next[k]).length\r\n                  const required = Math.max(2, (participants?.length || 2))\r\n                  if (acceptedCount >= 2 || acceptedCount >= required) {\r\n                    const ends = Date.now() + Math.min(600, Math.max(60, pauseDurationSec||300)) * 1000\r\n                    setPausedLocal(true); setPauseEndsAt(ends)\r\n                    setPausedGlobal(true, ends)\r\n                  }\r\n                  sendState()\r\n                }}\r\n              >Accept</button>\r\n              <button className=\"btn bg-rose-600 hover:bg-rose-700\"\r\n                onClick={() => { setPauseRequestedBy(null); setPauseAcceptedBy({}); setPausedLocal(false); setPauseEndsAt(null); setPausedGlobal(false, null); sendState() }}\r\n              >Decline</button>\r\n            </div>\r\n          )}\r\n          {paused && (\r\n            <span className=\"text-[11px] px-2 py-1 rounded-full bg-yellow-500/25 text-yellow-100 border border-yellow-400/40 shrink-0\">\r\n              Paused · {Math.max(0, Math.ceil(((pauseEndsAt||Date.now()) - Date.now())/1000))}s\r\n            </span>\r\n          )}\r\n          <button\r\n            className=\"text-[11px] px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40 shrink-0\"\r\n            title=\"Open a simulated online match demo\"\r\n            onClick={() => { \r\n              try { \r\n                window.dispatchEvent(new CustomEvent('ndn:online-match-demo', { detail: { game: 'X01', start: 501 } })) \r\n              } catch (err) {\r\n                console.error('Demo click error:', err)\r\n              }\r\n            }}\r\n          >DEMO</button>\r\n          {connected && (\r\n            <button className=\"btn shrink-0\" onClick={() => setShowMatchModal(true)} disabled={locked} title={locked ? 'Weekly free games used' : ''}>Open Match</button>\r\n          )}\r\n        </div>\r\n      </div>\r\n      {/* Create Match+ box (top-right area) */}\r\n      <div\r\n        className={`mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end ${(!connected || locked) ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer'}`}\r\n        role=\"button\"\r\n        title={!connected ? 'Connect to the lobby first' : (locked ? 'Weekly free games used' : 'Create a new match')}\r\n        onClick={() => {\r\n          if (!connected || locked) return\r\n          setShowCreate(true)\r\n          if (wsGlobal) wsGlobal.send({ type: 'list-matches' })\r\n          else wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n        }}\r\n      >\r\n        <button className=\"btn\" disabled={!connected || locked}>Create Match +</button>\r\n      </div>\r\n      <p className=\"text-sm text-slate-600 mt-3\">Open this app on another device and join the same Room ID to sync scores.</p>\r\n      {!user?.fullAccess && (\r\n        <div className=\"text-xs text-slate-400 mt-1\">Weekly free online games remaining: {freeLeft === Infinity ? 'ÔÇö' : freeLeft}</div>\r\n      )}\r\n      {(!user?.fullAccess && freeLeft !== Infinity && freeLeft <= 0) && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm\">You've used your 3 free online games this week. PREMIUM required to continue.</div>\r\n      )}\r\n      {errorMsg && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm font-semibold flex items-center gap-2\">\r\n          <span className=\"material-icons text-rose-300\">error_outline</span>\r\n          {errorMsg}\r\n        </div>\r\n      )}\r\n      {offerNewRoom && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-indigo-700/30 border border-indigo-600/40 text-indigo-100 text-sm flex items-center justify-between gap-2\">\r\n          <div>That room is full or no longer available. Create a new clean room with the same settings?</div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n              const { game, mode, value, startingScore } = offerNewRoom\r\n              const creatorAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n              if (wsGlobal) {\r\n                wsGlobal.send({ type: 'create-match', game, mode, value, startingScore: startingScore || 501, creatorAvg })\r\n                wsGlobal.send({ type: 'list-matches' })\r\n              } else {\r\n                wsRef.current?.send(JSON.stringify({ type: 'create-match', game, mode, value, startingScore: startingScore || 501, creatorAvg }))\r\n                wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n              }\r\n              setOfferNewRoom(null)\r\n            }}>Create New Match</button>\r\n            <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>setOfferNewRoom(null)}>Dismiss</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Global toaster is mounted in App */}\r\n\r\n  {/* World Lobby with filters */}\r\n      {connected && (\r\n        <div className=\"mt-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10 flex-1 overflow-auto\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div className=\"font-semibold\">World Lobby</div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-xs opacity-80\">Matches: {filteredLobby.length}</div>\r\n              <button className=\"btn px-3 py-1 text-sm\" onClick={()=> (wsGlobal ? wsGlobal.send({ type: 'list-matches' }) : wsRef.current?.send(JSON.stringify({ type: 'list-matches' })))}>Refresh</button>\r\n              <button\r\n                className=\"btn px-3 py-1 text-sm\"\r\n                title={!connected ? 'Connect to the lobby first' : (locked ? 'Weekly free games used' : 'Create a new match')}\r\n                disabled={!connected || locked}\r\n                onClick={() => { if (!connected || locked) return; setShowCreate(true); (wsGlobal ? wsGlobal.send({ type: 'list-matches' }) : wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))) }}\r\n              >Create Match +</button>\r\n            </div>\r\n          </div>\r\n          {/* Filters */}\r\n          <div className=\"space-y-3 mb-3\">\r\n            <div>\r\n              <label className=\"block text-xs opacity-70 mb-1\">Mode</label>\r\n              <TabPills\r\n                tabs={[{ key: 'all', label: 'All' }, { key: 'bestof', label: 'Best of' }, { key: 'firstto', label: 'First to' }]}\r\n                active={filterMode}\r\n                onChange={(k)=> setFilterMode(k as any)}\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-2 font-semibold\">Game</label>\r\n                <select className=\"input w-full text-sm\" value={filterGame as any} onChange={e=>setFilterGame(e.target.value as any)}>\r\n                  <option value=\"all\">All</option>\r\n                  {allGames.map(g => (\r\n                    <option key={g} value={g}>{g}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-2 font-semibold\">Starting Score</label>\r\n                <select className=\"input w-full text-sm\" value={filterStart as any} onChange={e=>{\r\n                  const v = e.target.value\r\n                  if (v==='all') setFilterStart('all'); else setFilterStart(Number(v) as any)\r\n                }} disabled={filterGame !== 'all' && filterGame !== 'X01'}>\r\n                  <option value=\"all\">All</option>\r\n                  <option value=\"301\">301</option>\r\n                  <option value=\"501\">501</option>\r\n                  <option value=\"701\">701</option>\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-2 font-semibold\">Opponent Average</label>\r\n                <div className=\"flex items-center gap-2 h-10 px-3 rounded bg-slate-900/30 border border-slate-500/30\">\r\n                  <input \r\n                    id=\"nearavg\" \r\n                    type=\"checkbox\" \r\n                    className=\"w-4 h-4 cursor-pointer accent-purple-500\" \r\n                    checked={nearAvg} \r\n                    onChange={e=>setNearAvg(e.target.checked)} \r\n                    title={!myAvg || myAvg === 0 ? 'Play a game first to use this filter' : 'Filter matches near your average'}\r\n                  />\r\n                  <label htmlFor=\"nearavg\" className=\"cursor-pointer text-sm flex-1\">Near my avg</label>\r\n                  <input \r\n                    type=\"number\" \r\n                    className=\"input w-20 text-sm px-2 py-1\" \r\n                    min={5} \r\n                    max={40} \r\n                    step={1} \r\n                    value={avgTolerance} \r\n                    onChange={e=>{\r\n                      const val = parseInt(e.target.value || '10');\r\n                      if (!isNaN(val)) setAvgTolerance(Math.max(5, Math.min(40, val)));\r\n                    }}\r\n                    disabled={!nearAvg}\r\n                    title=\"Tolerance range (±)\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center justify-between gap-3 pt-2\">\r\n              <div className=\"flex-1 max-w-xs\">\r\n                <label className={`block text-xs opacity-70 mb-2 font-semibold ${!nearAvg ? 'opacity-40' : ''}`}>Avg Tolerance (±)</label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <input \r\n                    type=\"range\" \r\n                    min=\"1\" \r\n                    max=\"50\" \r\n                    value={avgTolerance} \r\n                    onChange={e=>{\r\n                      const newVal = parseInt(e.target.value, 10);\r\n                      if (!isNaN(newVal)) {\r\n                        setAvgTolerance(Math.max(1, Math.min(50, newVal)));\r\n                      }\r\n                    }}\r\n                    disabled={!nearAvg}\r\n                    title=\"Drag to set tolerance\"\r\n                    className=\"w-32 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    style={{\r\n                      background: nearAvg \r\n                        ? 'linear-gradient(to right, rgb(55, 65, 81) 0%, rgb(55, 65, 81) ' + ((avgTolerance - 1) / 49 * 100) + '%, rgb(88, 28, 135) ' + ((avgTolerance - 1) / 49 * 100) + '%, rgb(88, 28, 135) 100%)'\r\n                        : 'linear-gradient(to right, rgb(71, 85, 105) 0%, rgb(71, 85, 105) 100%)'\r\n                    }}\r\n                  />\r\n                  <div className=\"text-xs font-mono font-semibold w-8 text-right text-purple-400\">±{avgTolerance}</div>\r\n                </div>\r\n              </div>\r\n              <button \r\n                className=\"btn px-3 py-2 text-sm mt-6\" \r\n                onClick={()=>{ \r\n                  setFilterMode('all'); \r\n                  setFilterGame('all'); \r\n                  setFilterStart('all'); \r\n                  setNearAvg(false); \r\n                  setAvgTolerance(10) \r\n                }}\r\n              >Reset</button>\r\n            </div>\r\n          </div>\r\n          {filteredLobby.length === 0 ? (\r\n            <div className=\"text-sm text-slate-300\">No games waiting. Create one!</div>\r\n          ) : (\r\n            <div className=\"space-y-2\">\r\n              {filteredLobby.map((m:any)=> (\r\n                <div key={m.id} className=\"p-3 rounded-lg bg-black/20 flex items-center justify-between relative\">\r\n                  <div className=\"text-sm\">\r\n                    <div>{m.game || 'X01'} {m.game==='X01' ? ` ${m.startingScore}` : ''} - {m.mode==='bestof' ? `Best Of ${m.value}` : `First To ${m.value}`} - Created by {m.creatorName}</div>\r\n                    {m.requireCalibration && (\r\n                      <div className=\"text-[11px] inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-600/30 mt-1\">Calibration required</div>\r\n                    )}\r\n                    {m.creatorAvg ? (\r\n                      <div className=\"text-xs opacity-70\">Creator avg: {Number(m.creatorAvg).toFixed(1)}</div>\r\n                    ) : null}\r\n                    <div className=\"text-xs opacity-70\">ID: {m.id}</div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <button className=\"btn px-3 py-1 text-sm bg-green-600 hover:bg-green-700\" disabled={locked || (!user?.fullAccess && (premiumGames as readonly string[]).includes(m.game)) || (!!m.requireCalibration && !calibH)} title={\r\n                      !user?.fullAccess && (premiumGames as readonly string[]).includes(m.game)\r\n                        ? 'PREMIUM game'\r\n                        : (locked ? 'Weekly free games used' : (!!m.requireCalibration && !calibH ? 'Calibration required' : ''))\r\n                    } onClick={async ()=>{\r\n                      setLastJoinIntent({ game: m.game, mode: m.mode, value: m.value, startingScore: m.startingScore })\r\n                      const calibrated = !!calibH\r\n                      const boardPreview = await getBoardPreview()\r\n                      try {\r\n                        // Simulate Stripe checkout error for demo\r\n                        // throw new Error('Failed to create checkout session')\r\n                        if (wsGlobal) wsGlobal.send({ type: 'join-match', matchId: m.id, calibrated, boardPreview })\r\n                        else wsRef.current?.send(JSON.stringify({ type: 'join-match', matchId: m.id, calibrated, boardPreview }))\r\n                      } catch (err: any) {\r\n                        handleStripeError(err?.message || 'Failed to create Stripe checkout session. Please try again later.')\r\n                      }\r\n                    }}>Join Now!</button>\r\n                    {selfId && m.creatorId === selfId && (\r\n                      <button\r\n                        className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\r\n                        title=\"Close this match\"\r\n                        onClick={()=>{\r\n                          if (wsGlobal) wsGlobal.send({ type: 'cancel-match', matchId: m.id })\r\n                          else wsRef.current?.send(JSON.stringify({ type: 'cancel-match', matchId: m.id }))\r\n                        }}\r\n                        aria-label=\"Close match\"\r\n                      >×</button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Frosted lock overlay when non-premium user is locked */}\r\n      {(!user?.fullAccess && freeLeft !== Infinity && freeLeft <= 0) && (\r\n        <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n          <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n            <div className=\"text-3xl mb-2\">­ƒöÆ</div>\r\n            <div className=\"font-semibold\">Online play locked</div>\r\n            <div className=\"text-sm text-slate-200/80\">YouÔÇÖve used your 3 free online games this week. Upgrade to PREMIUM to play all modes.</div>\r\n            <button \r\n              onClick={async () => {\r\n                try {\r\n                  const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ email: user?.email })\r\n                  })\r\n                  const data = await res.json()\r\n                  if (data.ok && data.url) {\r\n                    window.location.href = data.url\r\n                  } else {\r\n                    alert('Failed to create payment session: ' + (data.error || 'Unknown error'))\r\n                  }\r\n                } catch (e) {\r\n                  alert('Network error')\r\n                }\r\n              }}\r\n              className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n            >\r\n              Upgrade to PREMIUM = {formatPriceInCurrency(getUserCurrency(), 5)}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showMatchModal && (\r\n        <div className=\"fixed inset-0 z-50\">\r\n          <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" />\r\n          <div className=\"absolute inset-0 flex flex-col\">\r\n            <div className=\"p-2 md:p-3 flex items-center justify-between\">\r\n              <div>\r\n                <h3 className=\"text-xl md:text-2xl font-bold\">Online Match</h3>\r\n                {/* Room id hidden in-game to reduce clutter */}\r\n              </div>\r\n              <button className=\"btn px-3 py-1\" onClick={() => setShowMatchModal(false)}>Close</button>\r\n            </div>\r\n            <div className=\"relative flex-1 overflow-hidden p-2 md:p-3\">\r\n              <div className=\"card w-full h-full overflow-hidden relative p-2.5 md:p-3\">\r\n            {/* Ephemeral celebration overlay */}\r\n            {celebration && (\r\n              <div className=\"absolute inset-0 pointer-events-none flex items-start justify-center pt-8 z-20\">\r\n                <div className={`px-4 py-2 rounded-full text-lg font-bold shadow whitespace-nowrap ${celebration.kind==='leg' ? 'bg-indigo-500/20 border border-indigo-400/40 text-indigo-100' : 'bg-emerald-500/20 border border-emerald-400/40 text-emerald-100'}`}>\r\n                  {celebration.kind==='leg' ? '­ƒÅü LEG WON ÔÇö ' : '­ƒÄ» 180! ÔÇö '}{celebration.by}\r\n                </div>\r\n                {/* Lightweight confetti for leg wins */}\r\n                {celebration.kind === 'leg' && (\r\n                  <>\r\n                    <style>{`@keyframes ndn-confetti-fall{0%{transform:translateY(-10%) rotate(0deg);opacity:1}100%{transform:translateY(120%) rotate(360deg);opacity:0}}`}</style>\r\n                    <div className=\"absolute inset-0 pointer-events-none\">\r\n                      {[...Array(24)].map((_,i)=>{\r\n                        const left = Math.random()*100\r\n                        const delay = Math.random()*0.2\r\n                        const dur = 1.2 + Math.random()*0.8\r\n                        const size = 6 + Math.random()*6\r\n                        const hue = Math.floor(Math.random()*360)\r\n                        return (\r\n                          <span key={i} style={{ position:'absolute', top:0, left: left+'%', width: size, height: size, background:`hsl(${hue} 90% 60%)`, borderRadius: 2, animation: `ndn-confetti-fall ${dur}s ease-out ${delay}s forwards` }} />\r\n                        )\r\n                      })}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            )}\r\n            <div className=\"mb-1.5 text-xs md:text-sm flex items-center justify-between gap-2\">\r\n              <span>Participants: {participants.length || 1}</span>\r\n              <button\r\n                className=\"text-[11px] px-2 py-0.5 rounded-full bg-slate-700/50 hover:bg-slate-700 border border-slate-600\"\r\n                onClick={() => setCompactView(v => !v)}\r\n                title={compactView ? 'Switch to full multi-player view' : 'Switch to compact player-by-player view'}\r\n              >{compactView ? 'Full view' : 'Compact view'}</button>\r\n            </div>\r\n            {/* Header row styled to match Offline X01 screen (sticky, glassy bar) */}\r\n            {(() => {\r\n              const a = match.players?.[0]?.legsWon || 0\r\n              const b = match.players?.[1]?.legsWon || 0\r\n              return (\r\n                <GameHeaderBar\r\n                  left={(\r\n                    <>\r\n                      <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">Game Mode</span>\r\n                      <span className=\"font-medium whitespace-nowrap\">{currentGame}{currentGame==='X01' ? ` / ${match.startingScore}` : ''}</span>\r\n                      <span className=\"opacity-80 whitespace-nowrap\">Legs {a}–{b}</span>\r\n                    </>\r\n                  )}\r\n                  right={(\r\n                    <>\r\n                      <span className=\"opacity-70 text-[10px]\">Match</span>\r\n                      <select className={`btn ${buttonSizeClass}`} value={matchType} onChange={e=>setMatchType((e.target.value as 'singles'|'doubles'))}>\r\n                        <option value=\"singles\">Singles</option>\r\n                        <option value=\"doubles\">Doubles</option>\r\n                      </select>\r\n                      <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamAName} onChange={e=>setTeamAName(e.target.value)} placeholder=\"Team A\" />\r\n                      <span className=\"opacity-50\">vs</span>\r\n                      <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamBName} onChange={e=>setTeamBName(e.target.value)} placeholder=\"Team B\" />\r\n                    </>\r\n                  )}\r\n                />\r\n              )\r\n            })()}\r\n            {/* Summary area */}\r\n            {compactView ? (\r\n              <div className=\"mb-3\">\r\n                {(() => {\r\n                  const idx = match.currentPlayerIdx\r\n                  const p = match.players[idx]\r\n                  if (!p) return null\r\n                  const leg = p.legs[p.legs.length-1]\r\n                  const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                  const isMe = (user?.username && p.name === user.username)\r\n                  const lastVisitScore = leg && leg.visits.length ? leg.visits[leg.visits.length-1].score : 0\r\n                  // TV-style match average for this player across all legs\r\n                  const totals = (() => { let pts=0, d=0; for (const L of (p?.legs||[])) { pts += (L.totalScoreStart - L.totalScoreRemaining); d += (L.visits||[]).reduce((a,v)=>a + (v.darts||0) - (v.preOpenDarts||0), 0) } return { pts, d } })()\r\n                  const avg = totals.d > 0 ? ((totals.pts / totals.d) * 3) : 0\r\n                  if (currentGame === 'X01') {\r\n                    return (\r\n                      <div className={`p-4 rounded-xl bg-brand-50 text-black ${idx===match.currentPlayerIdx?'ring-2 ring-brand-400':''}`}>\r\n                        <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                          <span className=\"font-semibold\">{p.name}</span>\r\n                          <span className={`px-2 py-0.5 rounded-full ${idx===match.currentPlayerIdx?'bg-emerald-500/20 text-emerald-300':'bg-slate-500/20 text-slate-300'} text-xs font-bold`}>\r\n                            {idx===match.currentPlayerIdx ? 'THROWING' : 'WAITING TO THROW'}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"text-4xl font-extrabold\">{rem}</div>\r\n                        <div className=\"text-sm mt-1\">Last score: <span className=\"font-semibold\">{lastVisitScore}</span></div>\r\n                        <div className=\"text-sm\">3-Dart Avg: <span className=\"font-semibold\">{avg.toFixed(1)}</span></div>\r\n                        {isMe && idx===match.currentPlayerIdx && rem <= 170 && rem > 0 && (\r\n                          <div className=\"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm\">\r\n                            Checkout suggestions (fav {favoriteDouble}): {suggestCheckouts(rem, favoriteDouble).join('  ÔÇó  ') || 'ÔÇö'}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  }\r\n                  // Non-X01 (e.g., Double Practice, Around the Clock, Treble Practice): show target and progress instead of X01 remaining\r\n                  return (\r\n                    <div className={`p-4 rounded-xl bg-brand-50 text-black ${idx===match.currentPlayerIdx?'ring-2 ring-brand-400':''}`}>\r\n                      <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                        <span className=\"font-semibold\">{p.name}</span>\r\n                        <span className={`px-2 py-0.5 rounded-full ${idx===match.currentPlayerIdx?'bg-emerald-500/20 text-emerald-300':'bg-slate-500/20 text-slate-300'} text-xs font-bold`}>\r\n                          {idx===match.currentPlayerIdx ? 'THROWING' : 'WAITING TO THROW'}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"text-sm opacity-80\">{currentGame}</div>\r\n                      {currentGame === 'Double Practice' && (\r\n                        <>\r\n                          <div className=\"mt-1 text-xs flex items-center justify-between\">\r\n                            <span>Current target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                        </>\r\n                      )}\r\n                      {currentGame === 'Around the Clock' && (\r\n                        <>\r\n                          <div className=\"mt-1 text-xs flex items-center justify-between\">\r\n                            <span>Current target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || 'ÔÇö')}</span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold\">{atcHits} / {ATC_ORDER.length}</div>\r\n                        </>\r\n                      )}\r\n                      {currentGame === 'Treble Practice' && (\r\n                        <>\r\n                          <div className=\"mt-1 text-xs flex items-center justify-between\">\r\n                            <span>Treble Target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">T{trebleTarget}</span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold\">{trebleHits} / {trebleDarts}</div>\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  )\r\n                })()}\r\n                {match.players.length > 1 && (\r\n                  <div className=\"mt-2 text-xs text-slate-400\">Next up: {match.players[(match.currentPlayerIdx+1) % match.players.length]?.name}</div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <>\r\n                {/* Full overview: slim strip with each player's remaining */}\r\n                <div className=\"mb-3 flex flex-wrap items-center gap-2\">\r\n                  {match.players.map((p, idx) => {\r\n                    const leg = p.legs[p.legs.length-1]\r\n                    const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                    return (\r\n                      <div key={`strip-${p.id}`} className={`px-2 py-1 rounded bg-black/20 border border-slate-700/40 text-xs ${idx===match.currentPlayerIdx ? 'ring-1 ring-brand-400' : ''}`}>\r\n                        <span className=\"font-semibold\">{p.name}</span>\r\n                        {currentGame === 'X01' ? (\r\n                          <>\r\n                            <span className=\"opacity-70\"> = </span>\r\n                            <span className=\"font-mono\">{rem}</span>\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <span className=\"opacity-70\"> = </span>\r\n                            <span className=\"font-mono\">\r\n                              {currentGame === 'Double Practice' ? `${dpHits}/${DOUBLE_PRACTICE_ORDER.length}`\r\n                                : currentGame === 'Around the Clock' ? `${atcHits}/${ATC_ORDER.length}`\r\n                                : currentGame === 'Treble Practice' ? `${trebleHits}/${trebleDarts}`\r\n                                : currentGame === 'Cricket' ? `${(cricketById[p.id]?.points||0)} pts`\r\n                                : currentGame === 'Shanghai' ? `${(shanghaiById[p.id]?.score||0)} pts = R${(shanghaiById[p.id]?.round||1)}`\r\n                                : currentGame === 'Halve It' ? `${(halveById[p.id]?.score||0)} pts = S${(halveById[p.id]?.stage||0)+1}`\r\n                                : currentGame === 'High-Low' ? `${(highlowById[p.id]?.score||0)} pts = ${(highlowById[p.id]?.target||'HIGH')}`\r\n                                : currentGame === 'Killer' ? (() => { const st = killerById[p.id]; return st ? `#${st.number} = ${st.lives}ÔØñ ${st.isKiller?'= K':''}` : 'ÔÇö' })()\r\n                                : currentGame === 'American Cricket' ? `${(amCricketById[p.id]?.points||0)} pts`\r\n                                : currentGame === 'Baseball' ? (() => { const st = baseballById[p.id]; return st ? `R${st.score} = I${st.inning}` : 'ÔÇö' })()\r\n                                : currentGame === 'Golf' ? (() => { const st = golfById[p.id]; return st ? `S${st.strokes} = H${st.hole}` : 'ÔÇö' })()\r\n                                : currentGame === 'Tic Tac Toe' ? (() => { const x = (ttt.board||[]).filter((c:any)=>c==='X').length; const o = (ttt.board||[]).filter((c:any)=>c==='O').length; return `X${x}-O${o}` })()\r\n                                : currentGame}\r\n                            </span>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  })}\r\n                </div>\r\n              </>\r\n            )}\r\n            {compactView ? (\r\n              <div className=\"space-y-2\">\r\n                {/* Top toolbar */}\r\n                <div className=\"flex flex-col gap-2 mb-2\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-autoscore' as any)) }catch{} }}>Autoscore</button>\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-scoring' as any)) }catch{} }}>Scoring</button>\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={openManual}>Manual Correction</button>\r\n                  {!manualScoring && (\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={() => {\r\n                      // Toggle local camera enable — prefer local camera start, fallback to cam-create pairing\r\n                      try { window.dispatchEvent(new CustomEvent('ndn:start-camera', { detail: { mode: 'local' } })) } catch (err) {\r\n                        console.warn('Enable camera event failed', err)\r\n                        if (wsGlobal) wsGlobal.send({ type: 'cam-create' })\r\n                        else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) wsRef.current.send(JSON.stringify({ type: 'cam-create' }))\r\n                        else toast('Not connected to server', { type: 'error' })\r\n                      }\r\n                    }}>Enable camera</button>\r\n                  )}\r\n                  {!manualScoring && pairingCode && (\r\n                    <div className=\"ml-2 text-sm bg-blue-900/50 p-2 rounded\">\r\n                      <div><span className=\"opacity-70\">Mobile pairing code: </span><span className=\"font-mono font-bold text-lg\">{pairingCode}</span></div>\r\n                      <div className=\"text-xs opacity-70 mt-1\">On your phone, go to: <a href={`/mobile-cam.html?code=${pairingCode}`} target=\"_blank\" className=\"underline\">{window.location.origin}/mobile-cam.html?code={pairingCode}</a></div>\r\n                    </div>\r\n                  )}\r\n                  {!manualScoring && (\r\n                    <div className=\"ml-auto flex items-center gap-1 text-[11px]\">\r\n                      <span className=\"opacity-70\">Cam size</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.max(0.5, Math.round((cameraScale-0.05)*100)/100))}>−</button>\r\n                      <span className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}>{Math.round(cameraScale*100)}%</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.min(1.25, Math.round((cameraScale+0.05)*100)/100))}>+</button>\r\n                      <span className=\"opacity-50\">|</span>\r\n                      <button className={`btn ${buttonSizeClass}`} title=\"Toggle fit/fill\" onClick={()=>setCameraFitMode(cameraFitMode==='fill'?'fit':'fill')}>{cameraFitMode==='fill'?'Fill':'Fit'}</button>\r\n                    </div>\r\n                  )}\r\n                  </div>\r\n                </div>\r\n                {/* Summary (left) + Camera (right) */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 items-start h-full\">\r\n                  <div className=\"order-1\">\r\n                    {currentGame === 'X01' ? (\r\n                      <RenderMatchSummary />\r\n                    ) : (\r\n                      <GameScoreboard\r\n                        gameMode={currentGame as any}\r\n                        players={useOnlineGameStats(currentGame as any, match, participants)}\r\n                        matchScore={match.players?.length === 2 ? `${match.players[0]?.legsWon || 0}-${match.players[1]?.legsWon || 0}` : undefined}\r\n                      />\r\n                    )}\r\n                  </div>\r\n                  <div className=\"order-2 flex-1 min-h-0\">\r\n                    {cameraEnabled ? (\r\n                      <div className=\"min-w-0 relative z-10 flex-1 min-h-0 ndn-camera-tall\">\r\n                        <ResizablePanel\r\n                          storageKey=\"ndn:camera:tile:online:top\"\r\n                          className=\"relative rounded-2xl overflow-hidden bg-black\"\r\n                          defaultWidth={520}\r\n                          defaultHeight={320}\r\n                          minWidth={280}\r\n                          minHeight={200}\r\n                          maxWidth={1600}\r\n                          maxHeight={900}\r\n                          autoFill\r\n                        >\r\n                          <CameraTile \r\n                            label=\"Your Board\" \r\n                            autoStart={user?.username && match.players[match.currentPlayerIdx]?.name === user.username} \r\n                            aspect=\"classic\"\r\n                            fill\r\n                          />\r\n                        </ResizablePanel>\r\n                        {/** Duplicate compact toolbar removed; header now contains match controls */}\r\n                      </div>\r\n                    ) : null}\r\n                  </div>\r\n                </div>\r\n                <div className=\"font-semibold\">Current: {match.players[match.currentPlayerIdx]?.name || 'ÔÇö'}</div>\r\n                {currentGame === 'X01' && cameraEnabled && user?.username && match.players[match.currentPlayerIdx]?.name === user.username ? (\r\n                  <>\r\n                    {/* Camera autoscore module; only render for current thrower */}\r\n                    <CameraView x01DoubleInOverride={x01DoubleInMatch} hideInlinePanels showToolbar={false} onVisitCommitted={(score, darts, finished) => {\r\n                      if (callerEnabled) {\r\n                        const p = match.players[match.currentPlayerIdx]\r\n                        const leg = p?.legs[p.legs.length-1]\r\n                        const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n                        sayScore(user?.username || 'Player', score, Math.max(0, remaining), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n                      }\r\n                      const current = match.players[match.currentPlayerIdx]\r\n                      if (user?.username && current?.name === user.username) {\r\n                        addSample(user.username, darts, score)\r\n                      }\r\n                      // Instant local celebration\r\n                      try { if (score === 180) triggerCelebration('180', current?.name || 'Player'); if (finished) triggerCelebration('leg', current?.name || 'Player') } catch {}\r\n                      // If an opponent is present, rotate turns; otherwise stay on the same player for solo practice\r\n                      if (!finished) {\r\n                        const hasOpponent = (participants?.length || 0) >= 2\r\n                        if (hasOpponent) { match.nextPlayer() }\r\n                      }\r\n                      sendState()\r\n\r\n                      try {\r\n                        // Auto-show highlight modal for notable events:\r\n                        // - a checkout (finished) where the visit score was > 50\r\n                        // - a big visit where score > 100\r\n                        if ((finished && score > 50) || score > 100) {\r\n                          const current = match.players[match.currentPlayerIdx]\r\n                          const remaining = (current?.legs?.[current.legs.length-1]?.totalScoreRemaining) ?? match.startingScore\r\n                          const highlight = {\r\n                            player: current?.name || user?.username || 'Player',\r\n                            score,\r\n                            darts,\r\n                            finished,\r\n                            remainingBefore: Math.max(0, (remaining + score)),\r\n                            ts: Date.now(),\r\n                          }\r\n                          setHighlightCandidate(highlight)\r\n                          setShowHighlightModal(true)\r\n                        }\r\n                      } catch {}\r\n                    }} />\r\n                    {/* Highlight modal: offers download or save to account when a notable visit occurs */}\r\n                    {showHighlightModal && highlightCandidate ? (\r\n                      <ResizableModal storageKey=\"ndn:modal:highlight\" className=\"w-[420px]\" defaultWidth={420} defaultHeight={220} minWidth={320} minHeight={160} initialFitHeight>\r\n                        <div className=\"p-4\">\r\n                          <div className=\"text-lg font-semibold mb-2\">Save highlight</div>\r\n                          <div className=\"text-sm mb-3\">Player: <strong>{highlightCandidate.player}</strong> — Score: <strong>{highlightCandidate.score}</strong> — Darts: <strong>{highlightCandidate.darts}</strong></div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button className=\"btn\" onClick={() => downloadHighlightToDevice()}>Download to device</button>\r\n                            <button className=\"btn\" onClick={() => saveHighlightToAccount()}>Save to account</button>\r\n                            <button className=\"btn btn-ghost ml-auto\" onClick={() => { setShowHighlightModal(false); setHighlightCandidate(null); }}>Close</button>\r\n                          </div>\r\n                          <div className=\"text-xs opacity-70 mt-3\">You can download this JSON to keep a copy, or save it to your account for later access.</div>\r\n                        </div>\r\n                      </ResizableModal>\r\n                    ) : null}\r\n                    <div className=\"flex items-center gap-1.5 mb-2\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn px-2 py-0.5 text-xs\" onClick={() => submitVisitManual(visitScore)}>Submit Visit</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                    </div>\r\n                      {/* Quick entry buttons */}\r\n                      <div className=\"flex flex-wrap items-center gap-1.5 mt-1.5 text-xs\">\r\n                        <span className=\"opacity-70\">Quick:</span>\r\n                        {[180,140,100,60].map(v => (\r\n                          <button key={v} className=\"btn px-2 py-0.5 text-xs\" onClick={()=>submitVisitManual(v)}>{v}</button>\r\n                        ))}\r\n                      </div>\r\n                    <div className=\"mt-2 flex items-center gap-1.5 mb-2\">\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                    </div>\r\n                  </>\r\n                ) : (currentGame === 'Double Practice' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Current target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-extrabold mb-2\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView\r\n                        showToolbar={false}\r\n                        immediateAutoCommit\r\n                        onAutoDart={(value, ring) => {\r\n                          if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                            addDpValue(value)\r\n                          }\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addDpNumeric() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addDpNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 mt-1.5\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Manual (D16, 50, 25, T20)\" value={dpManual} onChange={e=>setDpManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addDpManual() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addDpManual}>Add</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Around the Clock' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Around the Clock ÔÇö Hit 1ÔåÆ20 then 25 (outer) and 50 (inner)</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Current target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || 'ÔÇö')}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-extrabold mb-2\">{atcHits} / {ATC_ORDER.length}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView\r\n                        scoringMode=\"custom\"\r\n                        showToolbar={false}\r\n                        immediateAutoCommit\r\n                        onAutoDart={(value, ring, info) => {\r\n                          addAtcValue(value, ring, info?.sector ?? null)\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addAtcNumeric() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addAtcNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 mt-1.5\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Manual (T20, D5, 25, 50)\" value={atcManual} onChange={e=>setAtcManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addAtcManual() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addAtcManual}>Add</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Treble Practice' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Treble Practice — Aim for triples only; count hits vs total darts</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Treble target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">T{trebleTarget}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-extrabold mb-2\">{trebleHits} / {trebleMaxDarts>0?trebleMaxDarts:trebleDarts}</div>\r\n                    {(trebleMaxDarts>0 && trebleDarts >= trebleMaxDarts) && (\r\n                      <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetTreble}>Reset</button></div>\r\n                    )}\r\n                    <div className=\"flex items-center gap-1.5 mb-2\">\r\n                      <span className=\"opacity-70 text-xs\">Quick:</span>\r\n                      {[20,19,18].map(n => (\r\n                        <button key={`tquick-${n}`} className={`btn px-2 py-0.5 text-xs ${trebleTarget===n?'bg-emerald-600/30 border border-emerald-400/30':''}`} onClick={()=>setTrebleTarget(n)}>T{n}</button>\r\n                      ))}\r\n                      <span className=\"opacity-50\">|</span>\r\n                      <select className=\"input w-24 text-sm\" value={trebleTarget} onChange={e=> setTrebleTarget(parseInt(e.target.value,10))}>\r\n                        {Array.from({length:20},(_,i)=>i+1).map(n=> <option key={n} value={n}>{n}</option>)}\r\n                      </select>\r\n                      <button className=\"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800\" onClick={resetTreble}>Reset</button>\r\n                    </div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView\r\n                        scoringMode=\"custom\"\r\n                        showToolbar={false}\r\n                        immediateAutoCommit\r\n                        onAutoDart={(value, ring, info) => {\r\n                          const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL')\r\n                          addTrebleValue(value, r, info?.sector ?? null)\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addTrebleNumeric() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addTrebleNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 mt-1.5\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Manual (T20)\" value={trebleManual} onChange={e=>setTrebleManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addTrebleManual() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addTrebleManual}>Add</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Cricket ÔÇö Close 15-20 and Bull; overflow scores points</div>\r\n                    {(() => {\r\n                      const pid = currentPlayerId(); ensureCricket(pid); const st = cricketById[pid] || createCricketState()\r\n                      return (\r\n                        <div className=\"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]\">\r\n                          {CRICKET_NUMBERS.map(n => (\r\n                            <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                              <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                              <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      )\r\n                    })()}\r\n                    <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(cricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        {\r\n                          const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL')\r\n                          applyCricketAuto(value, r, info?.sector ?? null)\r\n                        }\r\n                      }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Shanghai' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureShanghai(pid); const st = shanghaiById[pid] || createShanghaiState(); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">Shanghai ÔÇö Hit only the round's number; Single/Double/Triple score</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.round}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyShanghaiAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Halve It' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureHalve(pid); const st = halveById[pid] || createDefaultHalveIt(); const t = getCurrentHalveTarget(st); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">Halve It ÔÇö Hit the target each round or your score halves</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                          <span>Stage</span>\r\n                          <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.stage+1}/{st.targets.length}</span>\r\n                        </div>\r\n                        <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const tt = t; if (!tt) return 'ÔÇö'; if (tt.kind==='ANY_NUMBER') return 'Any'; if (tt.kind==='BULL') return 'Bull'; if (tt.kind==='DOUBLE' || tt.kind==='TRIPLE' || tt.kind==='NUMBER') return `${tt.kind} ${(tt as any).num}`; return 'ÔÇö' })()}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHalveAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'High-Low' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureHighLow(pid); const st = highlowById[pid] || createHighLow(); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">High-Low ÔÇö Alternate aiming for high then low segments</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.round}</span></div>\r\n                        <div className=\"text-sm\">Target: <span className=\"font-semibold\">{st.target}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHighLowAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'American Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">American Cricket ÔÇö Close 12-20 and Bull; overflow scores</div>\r\n                    {(() => { const pid = currentPlayerId(); ensureAmCricket(pid); const st = amCricketById[pid] || createAmCricketState(); return (\r\n                      <div className=\"mb-2 grid grid-cols-5 gap-1 text-center text-[11px]\">\r\n                        {AM_CRICKET_NUMBERS.map(n => (\r\n                          <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                            <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                            <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    ) })()}\r\n                    <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(amCricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyAmCricketAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyAmCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Baseball' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureBaseball(pid); const st = baseballById[pid] || createBaseball(); return (\r\n                      <div className=\"text-xs mb-1.5\">Baseball ÔÇö Inning {st.inning} ÔÇó Runs {st.score}</div>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyBaseballAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyBaseballAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Golf' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureGolf(pid); const st = golfById[pid] || createGolf(); return (\r\n                      <div className=\"text-xs mb-1.5\">Golf ÔÇö Hole {st.hole} (target {GOLF_TARGETS[st.hole]}) ÔÇó Strokes {st.strokes}</div>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyGolfAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyGolfAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Tic Tac Toe' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Tic Tac Toe ÔÇö Tap a cell to claim by hitting its target</div>\r\n                    <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                      {Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).map(cell => (\r\n                        <button key={cell} className={`h-12 rounded-xl border ${ttt.board[cell]?'bg-emerald-500/20 border-emerald-400/30':'bg-slate-800/50 border-slate-700/50'}`} onClick={()=>{\r\n                          if (ttt.finished || ttt.board[cell]) return\r\n                          // Use the manual input value instead of prompt\r\n                          const tgt = TTT_TARGETS[cell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(cell, v, ring as any, sector as any)\r\n                          setTttManual('') // Clear input after use\r\n                        }}>{ttt.board[cell] || ''}</button>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Enter dart score (e.g. 20, 40, 60, 25, 50)\" value={tttManual} onChange={e=>setTttManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') {\r\n                        // Apply to first available cell\r\n                        const availableCell = Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).find(cell => !ttt.board[cell] && !ttt.finished)\r\n                        if (availableCell !== undefined) {\r\n                          const tgt = TTT_TARGETS[availableCell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(availableCell, v, ring as any, sector as any)\r\n                          setTttManual('')\r\n                        }\r\n                      }}} />\r\n                      <button className=\"btn\" onClick={() => {\r\n                        // Apply to first available cell\r\n                        const availableCell = Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).find(cell => !ttt.board[cell] && !ttt.finished)\r\n                        if (availableCell !== undefined) {\r\n                          const tgt = TTT_TARGETS[availableCell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(availableCell, v, ring as any, sector as any)\r\n                          setTttManual('')\r\n                        }\r\n                      }}>Claim Cell</button>\r\n                    </div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        // passive; primary interaction via tapping a cell above\r\n                      }} />\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Killer' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples.</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Your number</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{(() => { const pid = currentPlayerId(); match.players.forEach(p=>ensureKiller(p.id)); return killerById[pid]?.number || 'ÔÇö' })()}</span>\r\n                    </div>\r\n                    <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{(() => { const pid = currentPlayerId(); return killerById[pid]?.lives ?? 'ÔÇö' })()}</span> {(() => { const pid = currentPlayerId(); return killerById[pid]?.isKiller ? <span className=\"ml-2 text-emerald-300\">KILLER</span> : null })()}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyKillerAuto(r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">{currentGame} (online) ÔÇö manual turn entry</div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => {\r\n                        const v = Math.max(0, visitScore|0)\r\n                        match.addVisit(v, 3)\r\n                        setVisitScore(0)\r\n                        match.nextPlayer()\r\n                        sendState()\r\n                      }}>Submit</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold\">WAITING TO THROW</div>\r\n                )}\r\n                <div className=\"mt-2 flex items-center gap-1.5\">\r\n                  <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                  <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\r\n                {/* Left column: summary */}\r\n                <div className=\"space-y-1.5\">\r\n                  <RenderMatchSummary />\r\n                </div>\r\n                {/* Main area: toolbar + camera + controls */}\r\n                <div className={`md:col-span-${cameraColSpan} space-y-1.5 relative`}>\r\n                  {/* Toolbar row (separate) */}\r\n                  <div className=\"flex items-center gap-1.5 mt-2\">\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-autoscore' as any)) }catch{} }}>Autoscore</button>\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-scoring' as any)) }catch{} }}>Scoring</button>\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={openManual}>Manual Correction</button>\r\n                    <div className=\"ml-auto flex items-center gap-1\">\r\n                      <span className=\"text-xs opacity-70\">Cam</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.max(0.5, Math.round((cameraScale-0.05)*100)/100))}>−</button>\r\n                      <span className={`btn ${buttonSizeClass} bg-transparent border-slate-600 text-center min-w-[3rem]`}>{Math.round(cameraScale*100)}%</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.min(1.25, Math.round((cameraScale+0.05)*100)/100))}>+</button>\r\n                      <button \r\n                        className={`btn ${buttonSizeClass}`} \r\n                        onClick={() => setCameraColSpan(cameraColSpan === 2 ? 3 : 2)}\r\n                        title={cameraColSpan === 2 ? \"Expand camera\" : \"Shrink camera\"}\r\n                      >\r\n                        {cameraColSpan === 2 ? '↔' : '↙'}\r\n                      </button>\r\n                      <span className=\"opacity-50\">|</span>\r\n                      <button className={`btn ${buttonSizeClass}`} title=\"Toggle fit/fill\" onClick={()=>setCameraFitMode(cameraFitMode==='fill'?'fit':'fill')}>{cameraFitMode==='fill'?'Fill':'Fit'}</button>\r\n                    </div>\r\n                  </div>\r\n                  {/* Camera row (under toolbar, left side) */}\r\n                  <div className=\"mt-2 relative flex-1 min-h-0 ndn-camera-tall\">\r\n                    <ResizablePanel\r\n                      storageKey=\"ndn:camera:tile:online:row\"\r\n                      className=\"relative rounded-2xl overflow-hidden bg-black w-full\"\r\n                      defaultWidth={720}\r\n                      defaultHeight={400}\r\n                      minWidth={320}\r\n                      minHeight={220}\r\n                      maxWidth={1600}\r\n                      maxHeight={900}\r\n                      autoFill\r\n                    >\r\n                      <CameraTile \r\n                        label=\"Your Board\" \r\n                        autoStart={user?.username && match.players[match.currentPlayerIdx]?.name === user.username} \r\n                        aspect=\"classic\"\r\n                        fill\r\n                      />\r\n                    </ResizablePanel>\r\n                    {/* Resize handle */}\r\n                    {cameraColSpan < 3 && (\r\n                      <div \r\n                        className=\"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-slate-600/20 hover:bg-slate-600/40 transition-colors flex items-center justify-center group\"\r\n                        onMouseDown={(e) => {\r\n                          e.preventDefault()\r\n                          const startX = e.clientX\r\n                          const startSpan = cameraColSpan\r\n                          \r\n                          const handleMouseMove = (moveEvent: MouseEvent) => {\r\n                            const deltaX = moveEvent.clientX - startX\r\n                            // If dragged more than 50px to the right, expand to 3 columns\r\n                            if (deltaX > 50 && startSpan === 2) {\r\n                              setCameraColSpan(3)\r\n                            }\r\n                          }\r\n                          \r\n                          const handleMouseUp = () => {\r\n                            document.removeEventListener('mousemove', handleMouseMove)\r\n                            document.removeEventListener('mouseup', handleMouseUp)\r\n                          }\r\n                          \r\n                          document.addEventListener('mousemove', handleMouseMove)\r\n                          document.addEventListener('mouseup', handleMouseUp)\r\n                        }}\r\n                      >\r\n                        <div className=\"w-0.5 h-8 bg-slate-400 group-hover:bg-slate-300 transition-colors\"></div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"font-semibold text-sm md:text-base\">Current: {match.players[match.currentPlayerIdx]?.name || 'ÔÇö'}</div>\r\n                  {currentGame === 'X01' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username ? (\r\n                    <>\r\n                      <CameraView x01DoubleInOverride={x01DoubleInMatch} hideInlinePanels showToolbar={false} onVisitCommitted={(score, darts, finished) => {\r\n                        if (callerEnabled) {\r\n                          const p = match.players[match.currentPlayerIdx]\r\n                          const leg = p?.legs[p.legs.length-1]\r\n                          const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n                          sayScore(user?.username || 'Player', score, Math.max(0, remaining), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n                        }\r\n                        const current = match.players[match.currentPlayerIdx]\r\n                        if (user?.username && current?.name === user.username) {\r\n                          addSample(user.username, darts, score)\r\n                        }\r\n                        // Instant local celebration\r\n                        try { if (score === 180) triggerCelebration('180', current?.name || 'Player'); if (finished) triggerCelebration('leg', current?.name || 'Player') } catch {}\r\n                        // Small delay before rotating to next player to avoid dropping late autoscore events\r\n                        if (!finished) {\r\n                          const hasOpponent = (participants?.length || 0) >= 2\r\n                          if (hasOpponent) {\r\n                            setTimeout(() => { try { match.nextPlayer(); sendState() } catch {} }, 750)\r\n                          } else {\r\n                            // Solo: keep turn with current player\r\n                            sendState()\r\n                          }\r\n                        } else {\r\n                          sendState()\r\n                        }\r\n                      }} />\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => submitVisitManual(visitScore)}>Submit Visit (Manual)</button>\r\n                        <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                      </div>\r\n                      {/* Quick entry buttons */}\r\n                      <div className=\"flex flex-wrap items-center gap-2 mt-2 text-sm\">\r\n                        <span className=\"opacity-70\">Quick:</span>\r\n                        {[180,140,100,60].map(v => (\r\n                          <button key={v} className=\"btn px-3 py-1 text-sm\" onClick={()=>submitVisitManual(v)}>{v}</button>\r\n                        ))}\r\n                      </div>\r\n                      {/* Checkout suggestions (full view) */}\r\n                      {(() => {\r\n                        const p = match.players[match.currentPlayerIdx]\r\n                        const leg = p?.legs?.[p.legs?.length-1]\r\n                        const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                        return (rem > 0 && rem <= 170) ? (\r\n                          <div className=\"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm\">\r\n                            Checkout suggestions (fav {favoriteDouble}): {suggestCheckouts(rem, favoriteDouble).join('  ÔÇó  ') || 'ÔÇö'}\r\n                          </div>\r\n                        ) : null\r\n                      })()}\r\n                    </>\r\n                  ) : (currentGame === 'Double Practice' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL</div>\r\n                      <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                        <span>Current target</span>\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                      </div>\r\n                      <div className=\"text-2xl font-extrabold mb-2\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView\r\n                          scoringMode=\"custom\"\r\n                          showToolbar={false}\r\n                          immediateAutoCommit\r\n                          onAutoDart={(value, ring) => {\r\n                            if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                              addDpValue(value)\r\n                            }\r\n                          }}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addDpNumeric() }} />\r\n                        <button className=\"btn\" onClick={addDpNumeric}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 mt-1.5\">\r\n                        <input className=\"input w-44\" placeholder=\"Manual (D16, 50, 25, T20)\" value={dpManual} onChange={e=>setDpManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addDpManual() }} />\r\n                        <button className=\"btn\" onClick={addDpManual}>Add</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">Cricket ÔÇö Close 15-20 and Bull; overflow scores points</div>\r\n                      {(() => { const pid = currentPlayerId(); ensureCricket(pid); const st = cricketById[pid] || createCricketState(); return (\r\n                        <div className=\"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]\">\r\n                          {CRICKET_NUMBERS.map(n => (\r\n                            <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                              <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                              <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      ) })()}\r\n                      <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(cricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyCricketAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Shanghai' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureShanghai(pid); const st = shanghaiById[pid] || createShanghaiState(); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">Shanghai ÔÇö Round {st.round} ÔÇó Score {st.score}</div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyShanghaiAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Halve It' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureHalve(pid); const st = halveById[pid] || createDefaultHalveIt(); const t = getCurrentHalveTarget(st); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">Halve It ÔÇö Stage {st.stage+1}/{st.targets.length} ÔÇó Score {st.score}</div>\r\n                          <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const tt = t; if (!tt) return 'ÔÇö'; if (tt.kind==='ANY_NUMBER') return 'Any'; if (tt.kind==='BULL') return 'Bull'; if (tt.kind==='DOUBLE' || tt.kind==='TRIPLE' || tt.kind==='NUMBER') return `${tt.kind} ${(tt as any).num}`; return 'ÔÇö' })()}</span></div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHalveAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'High-Low' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureHighLow(pid); const st = highlowById[pid] || createHighLow(); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">High-Low ÔÇö Round {st.round} ÔÇó Target {st.target} ÔÇó Score {st.score}</div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHighLowAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Killer' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); match.players.forEach(p=>ensureKiller(p.id)); const st = killerById[pid]; return (\r\n                        <>\r\n                          <div className=\"text-xs mb-1.5\">Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples.</div>\r\n                          <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Your number</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st?.number || 'ÔÇö'}</span></div>\r\n                          <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{st?.lives ?? 'ÔÇö'}</span> {st?.isKiller ? <span className=\"ml-2 text-emerald-300\">KILLER</span> : null}</div>\r\n                          <div className=\"mt-2 grid grid-cols-2 md:grid-cols-3 gap-1 text-[11px]\">\r\n                            {match.players.map(pp => {\r\n                              const s = killerById[pp.id]\r\n                              return (\r\n                                <div key={pp.id} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50 flex items-center justify-between\">\r\n                                  <span className=\"opacity-80 truncate\">{pp.name}</span>\r\n                                  <span className=\"font-mono\">{s ? `#${s.number} = ${s.lives}ÔØñ${s.isKiller?' = K':''}` : 'ÔÇö'}</span>\r\n                                </div>\r\n                              )\r\n                            })}\r\n                          </div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 my-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyKillerAuto(r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"text-xs opacity-70\">Tip: Only doubles/triples on the opponentsÔÇÖ numbers remove lives. To become Killer, hit your own double.</div>\r\n                    </div>\r\n                  ) : (user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">{currentGame} (online) ÔÇö manual turn entry</div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => {\r\n                          const v = Math.max(0, visitScore|0)\r\n                          match.addVisit(v, 3)\r\n                          setVisitScore(0)\r\n                          match.nextPlayer()\r\n                          sendState()\r\n                        }}>Submit</button>\r\n                        <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold\">WAITING TO THROW</div>\r\n                  )}\r\n                </div>\r\n                <div className=\"md:col-span-1\">\r\n                  <div className=\"flex flex-wrap items-center gap-1.5\">\r\n                    <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                    <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                  </div>\r\n                </div>\r\n                </div>\r\n              )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Create Match modal */}\r\n      {showCreate && (\r\n        <div className=\"fixed inset-0 bg-black/70 z-50\">\r\n          <div className=\"w-full h-full flex items-stretch justify-stretch p-0\">\r\n            <ResizableModal storageKey=\"ndn:modal:create-match\" className=\"w-full h-full rounded-none !border-0 !shadow-none relative\" fullScreen>\r\n              <div className=\"flex items-center justify-between mb-3 sticky top-0 bg-slate-900/80 backdrop-blur border-b border-slate-700 z-10 px-2 py-2\">\r\n                <h3 className=\"text-xl font-bold\">Create Match</h3>\r\n              </div>\r\n              <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 overflow-auto px-2\" style={{ maxHeight: 'calc(100vh - 120px)' }}>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Game</label>\r\n                <select className=\"input w-full\" value={game} onChange={e=>setGame(e.target.value as any)}>\r\n                  {allGames.map(g => (\r\n                    <option key={g} value={g} disabled={!user?.fullAccess && (premiumGames as readonly string[]).includes(g)}>\r\n                      {g} {!user?.fullAccess && (premiumGames as readonly string[]).includes(g) ? '(PREMIUM)' : ''}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                {/* Calibration Status - displayed below game selector */}\r\n                <div className=\"mt-2\">\r\n                  <GameCalibrationStatus \r\n                    gameMode={game} \r\n                    compact={true}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Mode</label>\r\n                <select className=\"input w-full\" value={mode} onChange={e=>setMode(e.target.value as any)}>\r\n                  <option value=\"bestof\">Best Of</option>\r\n                  <option value=\"firstto\">First To</option>\r\n                </select>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Value</label>\r\n                {game === 'X01' ? (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {[101, 201, 301, 401, 501].map(val => (\r\n                        <button\r\n                          key={val}\r\n                          className={`btn px-2 py-1 text-xs ${modeValue === val ? 'bg-purple-600 hover:bg-purple-700' : ''}`}\r\n                          onClick={() => setModeValue(val)}\r\n                        >\r\n                          {val}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                    <input className=\"input w-full\" type=\"number\" min={1} value={modeValue} onChange={e=>setModeValue(parseInt(e.target.value||'1'))} placeholder=\"Or enter custom value\" />\r\n                  </div>\r\n                ) : (\r\n                  <input className=\"input w-full\" type=\"number\" min={1} value={modeValue} onChange={e=>setModeValue(parseInt(e.target.value||'1'))} />\r\n                )}\r\n                <div className=\"text-xs opacity-70 mt-1\">Example: Best Of 5 — first to 3</div>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Starting Score</label>\r\n                {game === 'X01' ? (\r\n                  <select className=\"input w-full\" value={startScore} onChange={e=>setStartScore(parseInt(e.target.value||'501'))}>\r\n                    {[301, 501, 701].map(s => <option key={s} value={s}>{s}</option>)}\r\n                  </select>\r\n                ) : (\r\n                  <div className=\"text-xs opacity-70 mt-1\">Starting score applies to X01 only</div>\r\n                )}\r\n              </div>\r\n              {game === 'X01' && (\r\n                <div className=\"col-span-1\">\r\n                  <label className=\"block text-sm text-slate-300 mb-1\">X01 Rules</label>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      id=\"create-x01di\"\r\n                      type=\"checkbox\"\r\n                      className=\"accent-purple-500\"\r\n                      checked={!!createX01DoubleIn}\r\n                      onChange={e=> setCreateX01DoubleIn(e.target.checked)}\r\n                    />\r\n                    <label htmlFor=\"create-x01di\" className=\"text-sm opacity-80\">Require Double-In</label>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {game === 'Treble Practice' && (\r\n                <div className=\"col-span-1\">\r\n                  <label className=\"block text-sm text-slate-300 mb-1\">Throws per game</label>\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {[9, 12, 18, 30, 60].map(val => (\r\n                        <button\r\n                          key={val}\r\n                          className={`btn px-2 py-1 text-xs ${createTrebleMaxDarts === val ? 'bg-purple-600 hover:bg-purple-700' : ''}`}\r\n                          onClick={() => setCreateTrebleMaxDarts(val)}\r\n                        >\r\n                          {val}\r\n                        </button>\r\n                      ))}\r\n                      <button\r\n                        className={`btn px-2 py-1 text-xs ${createTrebleMaxDarts === 0 ? 'bg-purple-600 hover:bg-purple-700' : ''}`}\r\n                        onClick={() => setCreateTrebleMaxDarts(0)}\r\n                        title=\"Unlimited\"\r\n                      >\r\n                        ∞\r\n                      </button>\r\n                    </div>\r\n                    <input\r\n                      className=\"input w-full\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      placeholder=\"0 = unlimited\"\r\n                      value={createTrebleMaxDarts}\r\n                      onChange={e=> setCreateTrebleMaxDarts(Math.max(0, parseInt(e.target.value||'0')))}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              )}\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Require Calibration</label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <input id=\"calibreq\" type=\"checkbox\" className=\"accent-purple-500\" checked={requireCalibration} onChange={e=>setRequireCalibration(e.target.checked)} />\r\n                  <label htmlFor=\"calibreq\" className=\"text-sm opacity-80\">Players must be calibrated</label>\r\n                </div>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <div className=\"p-3 rounded-lg bg-black/20 border border-slate-700/40\">\r\n                  <div className=\"text-xs text-slate-300 uppercase tracking-wide mb-1\">Summary</div>\r\n                  <div className=\"text-sm font-semibold\">{game} — {mode==='bestof' ? `Best Of ${modeValue}` : `First To ${modeValue}`} {game==='X01' ? `— ${startScore}` : ''}</div>\r\n                  {game==='X01' && (\r\n                    <div className=\"text-xs opacity-80 mt-1\">Double-In: {createX01DoubleIn ? 'On' : 'Off'}</div>\r\n                  )}\r\n                  {game==='Treble Practice' && (\r\n                    <div className=\"text-xs opacity-80 mt-1\">Throws per game: {createTrebleMaxDarts || 'Unlimited'}</div>\r\n                  )}\r\n                  {!user?.fullAccess && (premiumGames as readonly string[]).includes(game) && (\r\n                    <div className=\"text-xs text-rose-300 mt-1\">PREMIUM required</div>\r\n                  )}\r\n                </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"sticky bottom-0 bg-slate-900/80 backdrop-blur border-t border-slate-700 z-10 px-2 py-2\">\r\n                <button className=\"btn w-full\" disabled={!user?.fullAccess && (premiumGames as readonly string[]).includes(game)} title={!user?.fullAccess && (premiumGames as readonly string[]).includes(game) ? 'PREMIUM game' : ''} onClick={()=>{\r\n                  const creatorAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n                  // If Treble Practice, apply the configured max darts locally and include in payload\r\n                  if (game === 'Treble Practice') {\r\n                    setTrebleMaxDarts(Math.max(0, createTrebleMaxDarts|0))\r\n                  }\r\n                  // If X01, apply the Double-In per-match rule locally and include in payload\r\n                  if (game === 'X01') {\r\n                    setX01DoubleInMatch(!!createX01DoubleIn)\r\n                  }\r\n                  const payload: any = { type: 'create-match', game, mode, value: modeValue, startingScore: startScore, creatorAvg, requireCalibration }\r\n                  if (game === 'Treble Practice') {\r\n                    payload.trebleMaxDarts = Math.max(0, createTrebleMaxDarts|0)\r\n                  }\r\n                  if (game === 'X01') {\r\n                    payload.x01DoubleIn = !!createX01DoubleIn\r\n                  }\r\n                  if (wsGlobal) {\r\n                    wsGlobal.send(payload)\r\n                    setShowCreate(false)\r\n                    wsGlobal.send({ type: 'list-matches' })\r\n                  } else {\r\n                    wsRef.current?.send(JSON.stringify(payload))\r\n                    setShowCreate(false)\r\n                    wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n                  }\r\n                }}>START GAME!</button>\r\n                <div className=\"flex justify-center mt-2\">\r\n                  <button className=\"btn px-2 py-1\" onClick={()=>setShowCreate(false)}>Close</button>\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Invitation modal for creator */}\r\n      {pendingInvite && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <ResizableModal storageKey=\"ndn:modal:invite\" className=\"w-full relative\" defaultWidth={620} defaultHeight={420} minWidth={520} minHeight={320} maxWidth={1000} maxHeight={800} initialFitHeight>\r\n            <h3 className=\"text-xl font-bold mb-1\">Incoming Match Request</h3>\r\n            <div className=\"text-sm mb-2\">\r\n              <span className=\"font-semibold\">{pendingInvite.fromName}</span> wants to join your match.\r\n              <span className={`ml-2 text-xs px-2 py-0.5 rounded ${pendingInvite.calibrated ? 'bg-emerald-500/20 text-emerald-300 border border-emerald-600/30' : 'bg-amber-500/20 text-amber-200 border border-amber-600/30'}`}>\r\n                {pendingInvite.calibrated ? 'Calibrated' : 'Not calibrated'}\r\n              </span>\r\n            </div>\r\n            {(pendingInvite.game || pendingInvite.mode) && (\r\n              <div className=\"text-xs opacity-80 mb-3\">\r\n                {pendingInvite.game || 'X01'} ÔÇó {pendingInvite.mode==='firstto' ? `First To ${pendingInvite.value}` : `Best Of ${pendingInvite.value}`} {pendingInvite.game==='X01' && pendingInvite.startingScore ? `ÔÇó ${pendingInvite.startingScore}` : ''}\r\n              </div>\r\n            )}\r\n            {/* End-of-match modal for Online/Tournament */}\r\n            {showX01EndSummary && (\r\n              <MatchSummaryModal\r\n                open={showX01EndSummary}\r\n                onClose={() => setShowX01EndSummary(false)}\r\n                title=\"Match Summary\"\r\n                players={match.players || []}\r\n                doublesStats={doublesStats}\r\n                centerScore={(() => {\r\n                  const ps = match.players || []\r\n                  return ps.length===2 ? `${ps[0]?.legsWon||0} – ${ps[1]?.legsWon||0}` : ''\r\n                })()}\r\n              />\r\n            )}\r\n            {pendingInvite.boardPreview ? (\r\n              <div className=\"mb-3\">\r\n                <img src={pendingInvite.boardPreview} alt=\"Board preview\" className=\"rounded-lg w-full max-h-64 object-contain bg-black/40 border border-slate-700\" />\r\n              </div>\r\n            ) : (\r\n              <div className=\"mb-3 text-xs opacity-60\">No camera preview provided.</div>\r\n            )}\r\n            <div className=\"flex gap-2\">\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={()=>{\r\n                if (wsGlobal) wsGlobal.send({ type: 'invite-response', matchId: pendingInvite.matchId, accept: true, toId: pendingInvite.fromId })\r\n                else wsRef.current?.send(JSON.stringify({ type: 'invite-response', matchId: pendingInvite.matchId, accept: true, toId: pendingInvite.fromId }))\r\n                setPendingInvite(null)\r\n              }}>Accept</button>\r\n              <button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={()=>{\r\n                if (wsGlobal) wsGlobal.send({ type: 'invite-response', matchId: pendingInvite.matchId, accept: false, toId: pendingInvite.fromId })\r\n                else wsRef.current?.send(JSON.stringify({ type: 'invite-response', matchId: pendingInvite.matchId, accept: false, toId: pendingInvite.fromId }))\r\n                setPendingInvite(null)\r\n              }}>Decline</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n\r\n      {/* Quick Chat popup */}\r\n      {showQuick && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:quick-chat\"\r\n            className=\"w-full relative\"\r\n            defaultWidth={520}\r\n            defaultHeight={280}\r\n            minWidth={360}\r\n            minHeight={220}\r\n            maxWidth={900}\r\n            maxHeight={700}\r\n          >\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <h3 className=\"text-lg font-semibold\">Quick Chat</h3>\r\n              <button className=\"btn px-2 py-1 text-sm\" onClick={()=>setShowQuick(false)}>Close</button>\r\n            </div>\r\n            <div className=\"flex flex-wrap gap-1.5\">\r\n              {['Good luck!','Good game!','Nice darts!','Well played!','Ready?'].map((m) => (\r\n                <button key={m} className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ sendQuick(m); setShowQuick(false) }} disabled={!connected}>{m}</button>\r\n              ))}\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n\r\n      {/* Messages popup */}\r\n      {showMessages && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:messages\"\r\n            className=\"w-full relative\"\r\n            defaultWidth={560}\r\n            defaultHeight={360}\r\n            minWidth={380}\r\n            minHeight={260}\r\n            maxWidth={1000}\r\n            maxHeight={800}\r\n          >\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <h3 className=\"text-lg font-semibold\">Messages</h3>\r\n              <button className=\"btn px-2 py-1 text-sm\" onClick={()=>setShowMessages(false)}>Close</button>\r\n            </div>\r\n            <ChatList\r\n              items={chat\r\n                .slice(-30)\r\n                .filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                .map((m, i) => ({ key: String(i), from: m.from, id: String(m.fromId || m.from), text: m.message }))}\r\n              onDelete={(idx) => setChat(prev => prev.filter((_, i) => i !== idx))}\r\n              onReport={(idx) => {\r\n                const pool = chat.slice(-30).filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                const item = pool[idx]\r\n                if (!item) return\r\n                reportMessage(null, item.message)\r\n              }}\r\n              onBlock={(idx) => {\r\n                const pool = chat.slice(-30).filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                const item = pool[idx]\r\n                if (!item) return\r\n                try { blocklist.block(String(item.fromId || item.from)) } catch {}\r\n                setChat(prev => prev.filter(m => String(m.fromId || m.from) !== String(item.fromId || item.from)))\r\n                try { toast(`${item.from} blocked`, { type: 'info' }) } catch {}\r\n              }}\r\n            />\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Small, self-contained chat list with moderation affordances\r\nfunction ChatList({ items, onDelete, onReport, onBlock }: { items: { key: string; from: string; id?: string; text: string }[]; onDelete: (index: number) => void; onReport: (index: number) => void; onBlock?: (index: number) => void }) {\r\n  const mobile = (() => { try { const ua = navigator.userAgent || ''; return /Android|iPhone|iPad|iPod|Mobile/i.test(ua) } catch { return false } })()\r\n  const [touch, setTouch] = useState<{ x: number; y: number; i: number; t: number } | null>(null)\r\n  const [swiped, setSwiped] = useState<number | null>(null)\r\n  return (\r\n    <div className=\"h-24 overflow-auto text-sm divide-y divide-slate-700/40\">\r\n      {items.length === 0 ? (\r\n        <div className=\"opacity-60 py-1\">No messages yet.</div>\r\n      ) : items.map((m, i) => {\r\n        const text = censorProfanity(m.text)\r\n        const flagged = containsProfanity(m.text)\r\n        return (\r\n          <div\r\n            key={m.key}\r\n            className=\"relative group px-1 py-1 flex items-start gap-2\"\r\n            onTouchStart={mobile ? (e) => { const t = e.touches[0]; setTouch({ x: t.clientX, y: t.clientY, i, t: Date.now() }) } : undefined}\r\n            onTouchMove={mobile ? (e) => { if (!touch || touch.i !== i) return; const t = e.touches[0]; const dx = t.clientX - touch.x; if (dx < -40) setSwiped(i) } : undefined}\r\n            onTouchEnd={mobile ? () => { const held = touch ? (Date.now() - touch.t) : 0; if (swiped === i || held > 600) { onDelete(i); setSwiped(null) } setTouch(null) } : undefined}\r\n          >\r\n            <span className=\"text-slate-400 shrink-0\">[{m.from}]</span>\r\n            <span className=\"text-white break-words whitespace-pre-wrap flex-1\">{text}</span>\r\n            {/* Desktop delete (red X) and Report/Block */}\r\n            {!mobile && (\r\n              <div className=\"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 ml-2\">\r\n                <button\r\n                  className=\"w-5 h-5 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center\"\r\n                  title=\"Delete message\"\r\n                  aria-label=\"Delete message\"\r\n                  onClick={() => onDelete(i)}\r\n                >├ù</button>\r\n                {onBlock && (\r\n                  <button\r\n                    className=\"px-1.5 py-0.5 rounded bg-slate-700 hover:bg-slate-800 text-slate-100 text-[11px]\"\r\n                    onClick={() => onBlock(i)}\r\n                    title=\"Block sender\"\r\n                  >Block</button>\r\n                )}\r\n                <button\r\n                  className=\"px-1.5 py-0.5 rounded bg-amber-600/40 hover:bg-amber-600/60 text-amber-100 text-[11px]\"\r\n                  onClick={() => onReport(i)}\r\n                  title=\"Report message\"\r\n                >Report</button>\r\n              </div>\r\n            )}\r\n            {/* Flag badge if profanity detected */}\r\n            {flagged && <span className=\"ml-2 text-[10px] px-1 rounded bg-rose-600/30 text-rose-200 border border-rose-600/40\">Filtered</span>}\r\n          </div>\r\n        )\r\n      })}\r\n      \r\n      {/* Phone camera overlay moved to global App header for consistency */}\r\n    </div>\r\n  )\r\n}\r\n"],"names":["computeTotals","p","points","darts","bestLeg","worstLeg","oneEighties","L","legDarts","a","v","threeDA","nineDA","MatchSummaryModal","open","onClose","title","players","centerScore","doublesStats","allowRematch","onRematch","cards","t","dbl","att","hit","pct","jsx","jsxs","ResizableModal","LS","load","raw","save","map","useBlocklist","create","set","get","id","s","OnlinePlay","user","API_URL","toast","useToast","wsGlobal","useWS","blocklist","roomId","setRoomId","useState","connected","setConnected","chat","setChat","showQuick","setShowQuick","showMessages","setShowMessages","lastSentChatRef","useRef","selfId","setSelfId","wsRef","reconnectAttemptsRef","reconnectTimerRef","shouldReconnectRef","lastToastRef","firstConnectDoneRef","match","useMatch","msgs","useMessages","favoriteDouble","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","allowSpectate","cameraScale","setCameraScale","cameraFitMode","setCameraFitMode","cameraEnabled","textSize","boxSize","autoscoreProvider","matchType","setMatchType","teamAName","setTeamAName","teamBName","setTeamBName","defaultX01DoubleIn","useUserSettings","manualScoring","useEffect","buttonSizeClass","size","cameraColSpan","setCameraColSpan","showMatchModal","setShowMatchModal","participants","setParticipants","turnIdx","setTurnIdx","visitScore","setVisitScore","dpIndex","setDpIndex","dpHits","setDpHits","dpManual","setDpManual","atcIndex","setAtcIndex","atcHits","setAtcHits","atcManual","setAtcManual","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","trebleManual","setTrebleManual","trebleMaxDarts","setTrebleMaxDarts","x01DoubleInMatch","setX01DoubleInMatch","pairingCode","setPairingCode","highlightCandidate","setHighlightCandidate","showHighlightModal","setShowHighlightModal","downloadHighlightToDevice","blob","url","name","saveHighlightToAccount","token","res","apiFetch","j","mobileStream","setMobileStream","mobileVideoRef","tttManual","setTttManual","cricketById","setCricketById","shanghaiById","setShanghaiById","halveById","setHalveById","highlowById","setHighlowById","killerById","setKillerById","amCricketById","setAmCricketById","baseballById","setBaseballById","golfById","setGolfById","ttt","setTTT","createTicTacToe","turnDarts","setTurnDarts","paused","setPausedLocal","pauseRequestedBy","setPauseRequestedBy","pauseAcceptedBy","setPauseAcceptedBy","pauseEndsAt","setPauseEndsAt","pauseDurationSec","setPauseDurationSec","setPausedGlobal","useMatchControl","compactView","setCompactView","ua","showX01EndSummary","setShowX01EndSummary","endSummaryPrevRef","showStartShowcase","setShowStartShowcase","startedShowcasedRef","prev","now","out","attempts","hits","celebration","setCelebration","lastCelebrationRef","audioCtxRef","sendState","ensureAudio","Ctor","beep","freq","durMs","whenS","gain","ctx","o","g","playSting","kind","triggerCelebration","who","last","showCreate","setShowCreate","lobby","setLobby","mode","setMode","modeValue","setModeValue","startScore","setStartScore","pendingInvite","setPendingInvite","errorMsg","setErrorMsg","handleStripeError","msg","lastJoinIntent","setLastJoinIntent","offerNewRoom","setOfferNewRoom","game","setGame","currentGame","setCurrentGame","requireCalibration","setRequireCalibration","createTrebleMaxDarts","setCreateTrebleMaxDarts","createX01DoubleIn","setCreateX01DoubleIn","freeLeft","getFreeRemaining","locked","filterMode","setFilterMode","filterStart","setFilterStart","filterGame","setFilterGame","nearAvg","setNearAvg","avgTolerance","setAvgTolerance","calibH","useCalibration","myAvg","getAllTimeAvg","unread","filteredLobby","m","handler","e","d","email","r","start","err","connect","onSpectate","rid","envUrl","proto","host","fallback","ws","ev","data","di","dh","ai","ah","tt","th","td","tmax","_cr","_sh","_hv","_hl","_kr","_am","_bb","_gf","_tt","_td","_di","isSelf","label","idKey","incOnlineUsage","startMobileWebRTC","pc","attempt","delay","RenderMatchSummary","curIdx","cur","leg","remaining","totals","pts","avg3","lastScore","matchScore","best","bestText","x","textSizeClass","boxSizeClass","unsub","_paused","_pEnds","_pBy","_acc","_dur","sendQuick","addDpValue","dart","isDoubleHit","newHits","nextIdx","DOUBLE_PRACTICE_ORDER","addDpNumeric","addDpManual","val","parseManualDart","isAtcHit","ring","sector","target","ATC_ORDER","addAtcValue","addAtcNumeric","addAtcManual","addTrebleValue","value","h","nd","cycle","idx","next","addTrebleNumeric","addTrebleManual","resetTreble","currentPlayerId","ensureCricket","pid","createCricketState","ensureShanghai","createShanghaiState","ensureHalve","createDefaultHalveIt","ensureHighLow","createHighLow","ensureKiller","used","pool","i","num","createKillerState","ensureAmCricket","createAmCricketState","ensureBaseball","createBaseball","ensureGolf","createGolf","allOpponentsClosed","opps","applyCricketAuto","copy","st","applyCricketDart","n","applyShanghaiAuto","applyShanghaiDart","endShanghaiTurn","applyHalveAuto","applyHalveItDart","endHalveItTurn","applyHighLowAuto","applyHighLowDart","endHighLowTurn","applyKillerAuto","applyKillerDart","win","killerWinner","applyAmCricketAuto","applyAmCricketDart","applyBaseballAuto","applyBaseballDart","applyGolfAuto","applyGolfDart","applyTttAuto","cell","cp","tryClaimCell","openManual","submitVisitManual","score","preRem","postRem","finished","rem","sayScore","addSample","reportMessage","offenderId","text","payload","getBoardPreview","stream","track","video","w","canvas","code","event","offer","MatchStartShowcase","me","acceptedCount","k","required","ends","startingScore","creatorAvg","TabPills","allGames","newVal","premiumGames","calibrated","boardPreview","formatPriceInCurrency","getUserCurrency","Fragment","_","left","dur","hue","b","GameHeaderBar","isMe","lastVisitScore","avg","suggestCheckouts","c","GameScoreboard","useOnlineGameStats","ResizablePanel","CameraTile","CameraView","current","highlight","info","CRICKET_NUMBERS","getCurrentHalveTarget","AM_CRICKET_NUMBERS","GOLF_TARGETS","tgt","TTT_TARGETS","availableCell","startX","startSpan","handleMouseMove","moveEvent","handleMouseUp","pp","GameCalibrationStatus","ps","ChatList","item","items","onDelete","onReport","onBlock","mobile","touch","setTouch","swiped","setSwiped","censorProfanity","flagged","containsProfanity","held"],"mappings":"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"}
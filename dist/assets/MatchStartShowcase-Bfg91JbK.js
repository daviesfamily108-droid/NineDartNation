import{j as e,k as Z,Q as D,W as J,X as _,g as q,Y as z,Z as ee,o as te,H as re}from"./index-DzrsT2-D.js";import{r as l}from"./ui-gqBJRRJB.js";function se({players:h,playerCalibrations:i,calibrationSkipped:r,onSkip:a,onOpenCalibrator:d,onClose:m}){const o=h.filter(c=>r[c.id]),s=h.filter(c=>!r[c.id]),u=s.length===0;return e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/90 p-4",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"Calibration Check"}),e.jsx("p",{className:"text-sm opacity-70 mb-6 text-center",children:"Check your dartboard calibration before the match starts. Both players must skip or confirm to begin."}),o.length>0&&s.length>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[o.map(c=>c.name).join(", ")," ",o.length===1?"has":"have"," chosen to skip."," ",s.map(c=>c.name).join(", "),", would you like to skip as well?"]})}),e.jsx("div",{className:"space-y-4",children:h.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:c.name.split(" ").map(g=>g[0]).join("").toUpperCase().slice(0,2)}),e.jsx("div",{children:e.jsx("div",{className:"font-medium",children:c.name})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>d(c.id),children:"Bull Up"}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>a(c.id),disabled:!!r[c.id],children:r[c.id]?"Skipped âœ“":"Skip"})]})]},c.id))}),e.jsx("div",{className:"mt-6 flex justify-center gap-4",children:e.jsx("button",{className:`btn ${u?"btn-primary":"btn-ghost opacity-50 cursor-not-allowed"}`,disabled:!u,onClick:m,children:"Start Match"})})]})})}function k({label:h,value:i,className:r="",scale:a=1}){return e.jsxs("div",{className:`flex flex-col items-center gap-1 ${r}`,children:[e.jsx("div",{className:"text-xs opacity-70",children:h}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold transform transition-transform duration-200 ease-out",style:{transform:`scale(${a})`},children:i})]})}function ae({player:h,user:i,playerCalibrations:r}){const a=l.useRef(null),m=!!r[h.name];return l.useEffect(()=>{const o=a.current;if(!o)return;const s=o.getContext("2d");if(s){s.clearRect(0,0,o.width,o.height);try{const u=o.width/2,c=o.height/2,g=Math.min(u,c)-2;typeof s.stroke=="function"&&(s.strokeStyle="#fff",s.lineWidth=1,s.beginPath(),s.arc(u,c,g,0,2*Math.PI),s.stroke()),typeof s.fill=="function"&&(s.fillStyle="#f00",s.beginPath(),s.arc(u,c,4,0,2*Math.PI),s.fill())}catch{}if(m)try{typeof s.fill=="function"&&(s.fillStyle="#0f0"),[[centerX-radius*.5,centerY],[centerX+radius*.5,centerY],[centerX,centerY-radius*.5],[centerX,centerY+radius*.5]].forEach(([c,g])=>{try{typeof s.beginPath=="function"&&s.beginPath(),typeof s.arc=="function"&&s.arc(c,g,2,0,2*Math.PI),typeof s.fill=="function"&&s.fill()}catch{}})}catch{}}},[m]),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("canvas",{ref:a,width:40,height:40,className:"border border-white/20 rounded"}),e.jsx("span",{className:`text-xs ${m?"text-green-400":"text-gray-400"}`,children:m?"Calibrated":"Not Calibrated"})]})}function ce({player:h,limit:i=3}){const r=[];try{const a=h.legs||[];for(let d=a.length-1;d>=0&&r.length<i;d--){const o=a[d].visits||[];for(let s=o.length-1;s>=0&&r.length<i;s--){const u=o[s];r.push({score:Number(u?.score||0),darts:Number(u?.darts||3)})}}}catch{}return r.length?e.jsx("div",{className:"flex gap-2 items-center",children:r.map((a,d)=>e.jsx("div",{className:`text-xs px-2 py-0.5 rounded ${a.score>=100?"bg-emerald-600/20 text-emerald-300":a.score>=60?"bg-amber-500/10 text-amber-300":"bg-white/6 text-gray-200"}`,children:a.score},d))}):e.jsx("div",{className:"text-xs opacity-60",children:"No recent visits"})}function L({secondsLeft:h,totalSeconds:i,size:r=84,stroke:a=8,color:d="emerald"}){const m=(r-a)/2,o=2*Math.PI*m,s=Math.max(0,Math.min(1,i>0?h/i:0)),u=o*(1-s),c=d==="emerald"?"#34d399":"#f59e0b";return e.jsxs("svg",{width:r,height:r,viewBox:`0 0 ${r} ${r}`,"aria-hidden":!0,children:[e.jsx("defs",{children:e.jsx("filter",{id:"softShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"3",floodColor:"#000",floodOpacity:"0.45"})})}),e.jsx("circle",{cx:r/2,cy:r/2,r:m,fill:"transparent",stroke:"rgba(255,255,255,0.06)",strokeWidth:a}),e.jsx("circle",{cx:r/2,cy:r/2,r:m,fill:"transparent",stroke:c,strokeWidth:a,strokeLinecap:"round",strokeDasharray:o,strokeDashoffset:u,transform:`rotate(-90 ${r/2} ${r/2})`,style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.4))"}}),e.jsx("text",{x:"50%",y:"50%",fill:"white",fontSize:r*.33,fontWeight:700,dominantBaseline:"middle",textAnchor:"middle",children:h>0?h:"GO"})]})}function oe({open:h=!0,players:i,user:r,onDone:a,onRequestClose:d,initialSeconds:m=15,roomId:o,onChoice:s,choices:u={},bullActive:c=!1,onBullThrow:g,showCalibrationDefault:y=!1,disableEscClose:F=!1}){const[b,Y]=l.useState(m||15),[ne,X]=l.useState(1),j=!!h,[C,P]=l.useState(!1),[R,T]=l.useState(()=>{const t={};if(!y)for(const n of i)t[n.id]=!0;return t}),[B,W]=l.useState({}),U=l.useRef(null),M=l.useRef(null),G=l.useRef(null),S=l.useRef(null),E=l.useRef(!1);l.useEffect(()=>(E.current=!0,()=>{E.current=!1}),[]),l.useEffect(()=>{y||T(t=>{const n={...t};for(const f of i)n[f.id]||(n[f.id]=!0);return n})},[i,y]);const p=i.every(t=>R[t.id]);l.useEffect(()=>{if(!j)return;try{setTimeout(()=>{try{M.current?.focus()}catch{}},0)}catch{}try{S.current=document.activeElement}catch{}const t=document.getElementById("root");t&&t.getAttribute("aria-hidden");try{t&&t.setAttribute("aria-hidden","true")}catch{}const n=p?setInterval(()=>Y(x=>x-1),1e3):null,f=x=>{if(E.current&&!F&&(x.key==="Escape"||x.key==="Esc")){x.preventDefault();try{setTimeout(()=>{try{d?.()}catch{}},0)}catch{}try{S.current?.focus()}catch{}}};return document.addEventListener("keydown",f),()=>{try{t&&t.removeAttribute("aria-hidden")}catch{}n&&clearInterval(n),document.removeEventListener("keydown",f)}},[j,a,p]),l.useEffect(()=>{j&&(y&&b===(m||15)&&!C&&(P(!0),(async()=>{const n={};for(const f of i)if(r?.username&&f.name===r.username){const{H:x,imageSize:v,overlaySize:I,locked:w}=re.getState();x&&w&&(n[f.name]={H:x,imageSize:v,overlaySize:I,locked:w})}else try{const x=await fetch(`/api/users/${encodeURIComponent(f.name)}/calibration`);if(x.ok){const v=await x.json();v.calibration&&(n[f.name]=v.calibration)}}catch(x){console.warn("Failed to fetch calibration for",f.name,x)}W(n)})()),p&&(b<=3&&b>0&&X(t=>t+.4),b<=0&&setTimeout(()=>{try{a?.()}catch{}try{setTimeout(()=>{try{d?.()}catch{}},0)}catch{}try{S.current?.focus()}catch{}},1e3)))},[b,a,j,C,p,i,r]);const H=l.useMemo(()=>i.map(t=>{try{const n=Z(t.name),f=D(t.name),x=J(t.name),v=_(t.name),I=q(t.name),w=z(t.name);let $=0;try{for(const Q of t.legs||[])for(const V of Q.visits||[])Number(V.score||0)===180&&($+=1)}catch{}const K=`${$}/${w}`;return{id:t.id,name:t.name,avg3:n.toFixed(1),best9:f.toFixed(1),bestCheckout:x,bestLeg:v,one80s:K}}catch{return{id:t.id,name:t.name,avg3:"â€”",best9:"â€”",bestCheckout:"â€”",bestLeg:"â€”",one80s:"â€”"}}}),[i]),A=l.useRef(typeof document<"u"?document.createElement("div"):null);if(l.useLayoutEffect(()=>{if(!A.current)return;const t=A.current;t.className="ndn-match-start-portal";try{Array.from(document.querySelectorAll(".ndn-match-start-portal")).forEach(f=>{try{f.parentNode?.removeChild(f)}catch{}})}catch{}return document.body.appendChild(t),()=>{try{t&&t.parentNode&&t.parentNode.removeChild(t)}catch{}}},[]),!j)return null;const N=t=>t<=0?1.8:t===1?1.6:t===2?1.4:t===3?1.2:1,O=e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",children:e.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"match-start-heading",tabIndex:-1,children:e.jsx(ee,{returnFocus:!0,children:e.jsx("div",{ref:U,children:e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-3xl p-8 md:p-12 max-w-7xl w-full backdrop-blur-sm shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("div",{id:"match-start-heading",className:"text-2xl font-bold opacity-90",children:"Match Starting Soon"}),e.jsxs("div",{className:"flex items-center gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx(L,{secondsLeft:b,totalSeconds:m||15,size:64,stroke:6,color:b>5?"emerald":"amber"})}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(L,{secondsLeft:b,totalSeconds:m||15,size:84,stroke:8,color:b>5?"emerald":"amber"})})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx("button",{ref:M,className:"btn btn-lg bg-gradient-to-r from-emerald-400 to-indigo-500 text-white shadow-lg transform hover:scale-105 w-full sm:w-auto",onClick:()=>{try{a?.()}catch{}try{try{document.getElementById("root")?.removeAttribute("aria-hidden")}catch{}setTimeout(()=>{try{d?.()}catch{}},0)}catch{}},"aria-label":"Start match now",children:"Start Now"}),e.jsx("button",{ref:G,className:"btn btn-ghost btn-sm text-white/80 w-full sm:w-auto",onClick:()=>{try{a?.()}catch{}try{document.getElementById("root")?.removeAttribute("aria-hidden")}catch{}try{setTimeout(()=>{try{d?.()}catch{}},0)}catch{}},"aria-label":"Close match start showcase",children:"Close"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:H.map(t=>e.jsxs("div",{className:"p-6 rounded-2xl bg-gradient-to-tr from-slate-800/70 to-slate-700/60 border border-white/6 flex flex-col items-center shadow-2xl w-full",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-emerald-400 flex items-center justify-center text-2xl font-bold text-white mb-4 shadow-xl ring-1 ring-white/10",children:t.name.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2)}),e.jsx("div",{className:"text-xl font-semibold mb-2 text-center",children:t.name}),e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[r&&r.username===t.name?e.jsx("div",{className:"text-xs bg-emerald-600/20 text-emerald-300 px-2 py-0.5 rounded",children:"You"}):null,e.jsx(ae,{player:i.find(n=>n.id===t.id),user:r,playerCalibrations:B})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full",children:[e.jsx(k,{label:"3-Dart Avg",value:t.avg3,scale:N(b)}),e.jsx(k,{label:"First-9 Avg",value:t.best9,scale:N(b)}),e.jsx(k,{label:"Best Checkout",value:t.bestCheckout||"â€”",scale:N(b)}),e.jsx(k,{label:"Best Leg",value:t.bestLeg||"â€”",scale:N(b)})]}),e.jsxs("div",{className:"mt-4 opacity-70 text-sm",children:["180s (match / career): ",t.one80s]}),e.jsx("div",{className:"mt-2 w-full flex justify-center md:justify-center",children:e.jsx(ce,{player:i.find(n=>n.id===t.id),limit:3})})]},t.id))}),e.jsx("div",{className:"text-center",children:b<=1?e.jsx("div",{className:"text-3xl font-bold text-emerald-400",children:"Good luck â€” Game on! ðŸŽ¯"}):e.jsx("div",{className:"text-lg opacity-70",children:i.map(t=>t.name).join(" vs ")})})]})})})})});return te.createPortal(e.jsxs(e.Fragment,{children:[C&&e.jsx(se,{players:i,playerCalibrations:B,calibrationSkipped:R,onSkip:t=>T(n=>({...n,[t]:!0})),onOpenCalibrator:t=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:"calibrate"}}))}catch{}try{setTimeout(()=>{try{d?.()}catch{}},0)}catch{}},onClose:()=>{P(!1)}}),O]}),A.current)}export{oe as M};
//# sourceMappingURL=MatchStartShowcase-Bfg91JbK.js.map

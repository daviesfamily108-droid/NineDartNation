import{j as t,q as W,N as X,S as Y,U as Z,g as _,V as q,F as D,t as ee,l as te}from"./index-BO6zAvtV.js";import{r as s}from"./ui-Vpbk6UnN.js";function ae({players:m,playerCalibrations:l,calibrationSkipped:o,onSkip:d,onOpenCalibrator:u,onClose:x}){const b=m.filter(r=>o[r.id]),g=m.filter(r=>!o[r.id]),w=g.length===0;return t.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/90 p-4",children:t.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"Calibration Check"}),t.jsx("p",{className:"text-sm opacity-70 mb-6 text-center",children:"Check your dartboard calibration before the match starts. Both players must skip or confirm to begin."}),b.length>0&&g.length>0&&t.jsx("div",{className:"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg",children:t.jsxs("p",{className:"text-sm text-blue-200",children:[b.map(r=>r.name).join(", ")," ",b.length===1?"has":"have"," chosen to skip."," ",g.map(r=>r.name).join(", "),", would you like to skip as well?"]})}),t.jsx("div",{className:"space-y-4",children:m.map(r=>t.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:r.name.split(" ").map(A=>A[0]).join("").toUpperCase().slice(0,2)}),t.jsx("div",{children:t.jsx("div",{className:"font-medium",children:r.name})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>u(r.id),children:"Bull Up"}),t.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>d(r.id),disabled:!!o[r.id],children:o[r.id]?"Skipped âœ“":"Skip"})]})]},r.id))}),t.jsx("div",{className:"mt-6 flex justify-center gap-4",children:t.jsx("button",{className:`btn ${w?"btn-primary":"btn-ghost opacity-50 cursor-not-allowed"}`,disabled:!w,onClick:x,children:"Start Match"})})]})})}function N({label:m,value:l,className:o="",scale:d=1}){return t.jsxs("div",{className:`flex flex-col items-center gap-1 ${o}`,children:[t.jsx("div",{className:"text-xs opacity-70",children:m}),t.jsx("div",{className:"text-2xl sm:text-3xl font-bold transform transition-transform duration-200 ease-out",style:{transform:`scale(${d})`},children:l})]})}function ne({open:m=!0,players:l,user:o,onDone:d,onRequestClose:u,initialSeconds:x=15,roomId:b,onChoice:g,choices:w={},bullActive:r=!1,onBullThrow:A,showCalibrationDefault:v=!1,disableEscClose:M=!1}){const[i,P]=s.useState(x||15),[se,$]=s.useState(1),f=!!m,[k,T]=s.useState(!1),[B,F]=s.useState(()=>{const e={};if(!v)for(const a of l)e[a.id]=!0;return e}),[U,z]=s.useState({}),G=s.useRef(null),L=s.useRef(null),O=s.useRef(null),C=s.useRef(null),S=s.useRef(!1);s.useEffect(()=>(S.current=!0,()=>{S.current=!1}),[]),s.useEffect(()=>{v||F(e=>{const a={...e};for(const c of l)a[c.id]||(a[c.id]=!0);return a})},[l,v]);const j=l.every(e=>B[e.id]);s.useEffect(()=>{if(!f)return;try{setTimeout(()=>{try{L.current?.focus()}catch{}},0)}catch{}try{C.current=document.activeElement}catch{}const e=document.getElementById("root");e&&e.getAttribute("aria-hidden");try{e&&e.setAttribute("aria-hidden","true")}catch{}const a=j?setInterval(()=>P(n=>n-1),1e3):null,c=n=>{if(S.current&&!M&&(n.key==="Escape"||n.key==="Esc")){n.preventDefault();try{setTimeout(()=>{try{u?.()}catch{}},0)}catch{}try{C.current?.focus()}catch{}}};return document.addEventListener("keydown",c),()=>{try{e&&e.removeAttribute("aria-hidden")}catch{}a&&clearInterval(a),document.removeEventListener("keydown",c)}},[f,d,j]),s.useEffect(()=>{f&&(v&&i===(x||15)&&!k&&(T(!0),(async()=>{const a={};for(const c of l)if(o?.username&&c.name===o.username){const{H:n,imageSize:h,overlaySize:R,locked:y}=te.getState();n&&y&&(a[c.name]={H:n,imageSize:h,overlaySize:R,locked:y})}else try{const n=await fetch(`/api/users/${encodeURIComponent(c.name)}/calibration`);if(n.ok){const h=await n.json();h.calibration&&(a[c.name]=h.calibration)}}catch(n){console.warn("Failed to fetch calibration for",c.name,n)}z(a)})()),j&&(i<=3&&i>0&&$(e=>e+.4),i<=0&&setTimeout(()=>{try{d?.()}catch{}try{setTimeout(()=>{try{u?.()}catch{}},0)}catch{}try{C.current?.focus()}catch{}},1e3)))},[i,d,f,k,j,l,o]);const H=s.useMemo(()=>l.map(e=>{try{const a=W(e.name),c=X(e.name),n=Y(e.name),h=Z(e.name),R=_(e.name),y=q(e.name);let I=0;try{for(const J of e.legs||[])for(const Q of J.visits||[])Number(Q.score||0)===180&&(I+=1)}catch{}const V=`${I}/${y}`;return{id:e.id,name:e.name,avg3:a.toFixed(1),best9:c.toFixed(1),bestCheckout:n,bestLeg:h,one80s:V}}catch{return{id:e.id,name:e.name,avg3:"â€”",best9:"â€”",bestCheckout:"â€”",bestLeg:"â€”",one80s:"â€”"}}}),[l]),E=s.useRef(typeof document<"u"?document.createElement("div"):null);if(s.useLayoutEffect(()=>{if(!E.current)return;const e=E.current;e.className="ndn-match-start-portal";try{Array.from(document.querySelectorAll(".ndn-match-start-portal")).forEach(c=>{try{c.parentNode?.removeChild(c)}catch{}})}catch{}return document.body.appendChild(e),()=>{try{e&&e.parentNode&&e.parentNode.removeChild(e)}catch{}}},[]),!f)return null;const p=e=>e<=0?1.8:e===1?1.6:e===2?1.4:e===3?1.2:1,K=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",children:t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"match-start-heading",tabIndex:-1,children:t.jsx(D,{returnFocus:!0,children:t.jsx("div",{ref:G,children:t.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-3xl p-8 md:p-12 max-w-7xl w-full backdrop-blur-sm shadow-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsx("div",{id:"match-start-heading",className:"text-2xl font-bold opacity-90",children:"Match Starting Soon"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"text-6xl font-extrabold text-emerald-400","aria-live":"polite",children:i>0?i:"GO"}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("button",{ref:L,className:"btn btn-lg",onClick:()=>{try{d?.()}catch{}try{try{document.getElementById("root")?.removeAttribute("aria-hidden")}catch{}setTimeout(()=>{try{u?.()}catch{}},0)}catch{}},"aria-label":"Start match now",children:"Start Now"}),t.jsx("button",{ref:O,className:"btn btn-ghost btn-sm",onClick:()=>{try{d?.()}catch{}try{document.getElementById("root")?.removeAttribute("aria-hidden")}catch{}try{setTimeout(()=>{try{u?.()}catch{}},0)}catch{}},"aria-label":"Close match start showcase",children:"Close"})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:H.map(e=>t.jsxs("div",{className:"p-6 rounded-2xl bg-white/8 border border-white/12 flex flex-col items-center shadow-xl",children:[t.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-2xl font-bold text-white mb-4 shadow-lg",children:e.name.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2)}),t.jsx("div",{className:"text-xl font-semibold mb-4 text-center",children:e.name}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full",children:[t.jsx(N,{label:"3-Dart Avg",value:e.avg3,scale:p(i)}),t.jsx(N,{label:"First-9 Avg",value:e.best9,scale:p(i)}),t.jsx(N,{label:"Best Checkout",value:e.bestCheckout||"â€”",scale:p(i)}),t.jsx(N,{label:"Best Leg",value:e.bestLeg||"â€”",scale:p(i)})]}),t.jsxs("div",{className:"mt-4 opacity-70 text-sm",children:["180s (match / career): ",e.one80s]})]},e.id))}),t.jsx("div",{className:"text-center",children:i<=1?t.jsx("div",{className:"text-3xl font-bold text-emerald-400",children:"Good luck â€” Game on! ðŸŽ¯"}):t.jsx("div",{className:"text-lg opacity-70",children:l.map(e=>e.name).join(" vs ")})})]})})})})});return ee.createPortal(t.jsxs(t.Fragment,{children:[k&&t.jsx(ae,{players:l,playerCalibrations:U,calibrationSkipped:B,onSkip:e=>F(a=>({...a,[e]:!0})),onOpenCalibrator:e=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:"calibrate"}}))}catch{}try{setTimeout(()=>{try{u?.()}catch{}},0)}catch{}},onClose:()=>{T(!1)}}),K]}),E.current)}export{ne as M};
//# sourceMappingURL=MatchStartShowcase-Cpv2IgAi.js.map

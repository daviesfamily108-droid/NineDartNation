{"version":3,"file":"OpsDashboard-D5K_BYEs.js","sources":["../../src/components/OpsDashboard.tsx"],"sourcesContent":["import { useEffect, useState } from 'react'\r\nimport { useIsAdmin } from '../utils/admin'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype Ready = { ok: boolean; ws?: boolean; rooms?: number; clients?: number; mem?: { rss: number; heapUsed: number } }\r\n\r\nexport default function OpsDashboard({ user }: { user: any }) {\r\n  const isAdmin = useIsAdmin(user?.email)\r\n  const [ready, setReady] = useState<Ready|null>(null)\r\n  const [ann, setAnn] = useState<string>('')\r\n  const [msg, setMsg] = useState<string>('')\r\n\r\n  async function refresh() {\r\n    try {\r\n      const res = await apiFetch('/readyz')\r\n      setReady(await res.json())\r\n    } catch {}\r\n  }\r\n  useEffect(() => {\r\n    refresh()\r\n    const id = setInterval(refresh, 5000)\r\n    return () => clearInterval(id)\r\n  }, [])\r\n\r\n  if (!isAdmin) return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\r\n      <div>Restricted</div>\r\n    </div>\r\n  )\r\n\r\n  async function toggleMaintenance(enabled: boolean) {\r\n    setMsg('')\r\n    try {\r\n      const res = await apiFetch('/api/admin/maintenance', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ enabled, requesterEmail: user?.email }) })\r\n      const j = await res.json()\r\n      if (!res.ok || !j?.ok) setMsg(j?.error || 'Failed')\r\n      else setMsg(`Maintenance ${enabled ? 'enabled' : 'disabled'}`)\r\n    } catch { setMsg('Network error') }\r\n  }\r\n\r\n  async function announce() {\r\n    setMsg('')\r\n    const text = ann.trim()\r\n    if (!text) return\r\n    try {\r\n      const res = await apiFetch('/api/admin/announce', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: text, requesterEmail: user?.email }) })\r\n      const j = await res.json()\r\n      if (!res.ok || !j?.ok) setMsg(j?.error || 'Failed')\r\n      else setMsg('Announcement broadcasted')\r\n      setAnn('')\r\n    } catch { setMsg('Network error') }\r\n  }\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Readiness</div>\r\n          <div className=\"text-sm\">HTTP: <span className={`font-semibold ${ready?.ok ? 'text-emerald-300' : 'text-rose-300'}`}>{String(!!ready?.ok)}</span></div>\r\n          <div className=\"text-sm\">WS: <span className={`font-semibold ${ready?.ws ? 'text-emerald-300' : 'text-rose-300'}`}>{String(!!ready?.ws)}</span></div>\r\n          <div className=\"text-sm\">Clients: <span className=\"font-semibold\">{ready?.clients ?? 0}</span></div>\r\n          <div className=\"text-sm\">Rooms: <span className=\"font-semibold\">{ready?.rooms ?? 0}</span></div>\r\n          <div className=\"text-sm\">Heap Used: <span className=\"font-semibold\">{ready?.mem ? Math.round(ready.mem.heapUsed/1024/1024) : 0} MB</span></div>\r\n        </div>\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Maintenance</div>\r\n          <div className=\"flex gap-2\">\r\n            <button className=\"btn\" onClick={()=>toggleMaintenance(true)}>Enable</button>\r\n            <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={()=>toggleMaintenance(false)}>Disable</button>\r\n          </div>\r\n        </div>\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Announcement</div>\r\n          <div className=\"flex gap-2\">\r\n            <input className=\"input flex-1\" placeholder=\"Message to broadcast\" value={ann} onChange={e=>setAnn(e.target.value)} />\r\n            <button className=\"btn\" onClick={announce}>Send</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {msg && <div className=\"text-xs mt-2\">{msg}</div>}\r\n      <div className=\"text-xs opacity-70 mt-2\">âœ… Clustering enabled! For 1.5k+ concurrent users, deploy behind a reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets. Set NODE_WORKERS environment variable to control worker count.</div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":["OpsDashboard","user","isAdmin","useIsAdmin","ready","setReady","useState","ann","setAnn","msg","setMsg","refresh","res","apiFetch","useEffect","id","jsxs","jsx","toggleMaintenance","enabled","j","announce","text","e"],"mappings":"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"}
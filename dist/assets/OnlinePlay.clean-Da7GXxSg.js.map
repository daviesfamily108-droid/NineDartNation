{"version":3,"file":"OnlinePlay.clean-Da7GXxSg.js","sources":["../../src/components/ui/CreateMatchModal.tsx","../../src/components/OnlinePlay.clean.tsx"],"sourcesContent":["import React, { useLayoutEffect, useState, useRef } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport {\r\n  allGames,\r\n  type GameKey,\r\n  getStartOptionsForGame,\r\n} from \"../../utils/games\";\r\nimport { useUserSettings } from \"../../store/userSettings\";\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onCreate: (payload: any) => void;\r\n};\r\n\r\nexport default function CreateMatchModal({ open, onClose, onCreate }: Props) {\r\n  const [portalEl] = useState(() => document.createElement(\"div\"));\r\n  const [game, setGame] = useState<GameKey>(\"X01\");\r\n  const [modeType, setModeType] = useState<\"bestof\" | \"firstto\">(\"bestof\");\r\n  const [legs, setLegs] = useState<number>(3);\r\n  const legsRef = useRef<HTMLInputElement | null>(null);\r\n  const [avgChoice, setAvgChoice] = useState<number>(0);\r\n  const [startingScore, setStartingScore] = useState<number | undefined>(() => {\r\n    const opts = getStartOptionsForGame(game);\r\n    return opts?.[0];\r\n  });\r\n  const user = (useUserSettings() as any).username || \"Anonymous\";\r\n\r\n  useLayoutEffect(() => {\r\n    portalEl.className = \"ndn-create-match-portal\";\r\n    document.body.appendChild(portalEl);\r\n    return () => {\r\n      try {\r\n        portalEl && portalEl.remove();\r\n      } catch {}\r\n    };\r\n  }, [portalEl]);\r\n\r\n  // Close modal on Escape key\r\n  useLayoutEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") onClose();\r\n    }\r\n    if (open) document.addEventListener(\"keydown\", onKey);\r\n    return () => document.removeEventListener(\"keydown\", onKey);\r\n  }, [open, onClose]);\r\n\r\n  const handleCreate = () => {\r\n    const payload = {\r\n      createdBy: user,\r\n      game,\r\n      modeType,\r\n      legs,\r\n      avgChoice,\r\n      startingScore,\r\n    };\r\n    onCreate(payload);\r\n    onClose();\r\n  };\r\n\r\n  if (!open) return null;\r\n\r\n  if (!portalEl) return null;\r\n\r\n  return createPortal(\r\n  <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4\">\r\n      {/* A dedicated, accessible button covers the backdrop to capture clicks and keyboard input */}\r\n      <button\r\n        aria-label=\"Close dialog\"\r\n        className=\"absolute inset-0 w-full h-full bg-transparent\"\r\n        onClick={onClose}\r\n      />\r\n      <div\r\n        className=\"card rounded-xl p-6 max-w-lg w-full relative text-white\"\r\n        role=\"dialog\"\r\n      >\r\n        <button\r\n          aria-label=\"Close\"\r\n          className=\"absolute top-3 right-3 text-rose-400 font-bold\"\r\n          onClick={onClose}\r\n        >\r\n          ✕\r\n        </button>\r\n        <h2 className=\"text-lg font-semibold mb-3\">Create Match</h2>\r\n  <div className=\"grid grid-cols-1 gap-3\">\r\n          <div>\r\n            <div className=\"text-sm opacity-80\">Created By</div>\r\n            <div className=\"mt-1 p-2 bg-white/5 rounded text-white\">{user}</div>\r\n          </div>\r\n          <div>\r\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-game\">\r\n              Match Name (Game)\r\n            </label>\r\n            <select\r\n              id=\"match-game\"\r\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\r\n              value={game}\r\n              onChange={(e) => {\r\n                const v = e.target.value as GameKey;\r\n                setGame(v);\r\n                const opts = getStartOptionsForGame(v);\r\n                setStartingScore(opts?.[0]);\r\n              }}\r\n                    onPointerDown={(e) => { (e as any).stopPropagation(); }}\r\n                    onMouseDown={(e) => { e.stopPropagation(); }}\r\n                    onTouchStart={(e) => { (e as any).stopPropagation?.(); }}\r\n            >\r\n              {allGames.map((g) => (\r\n                <option key={g} value={g}>\r\n                  {g}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          {getStartOptionsForGame(game).length > 0 ? (\r\n            <div>\r\n              <label className=\"text-sm opacity-80\" htmlFor=\"match-start\">\r\n                {`${game} Starting Score`}\r\n              </label>\r\n              <select\r\n                id=\"match-start\"\r\n                className=\"ml-2 p-2 border border-white/10 bg-white/5 rounded text-white w-full\"\r\n                value={startingScore}\r\n                onChange={(e) => setStartingScore(Number(e.target.value))}\r\n                onPointerDown={(e) => { (e as any).stopPropagation(); }}\r\n                onMouseDown={(e) => { e.stopPropagation(); }}\r\n                  onTouchStart={(e) => { (e as any).stopPropagation?.(); }}\r\n              >\r\n                {getStartOptionsForGame(game).map((opt) => (\r\n                  <option key={opt} value={opt}>\r\n                    {opt}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          ) : null}\r\n          <div>\r\n            <div className=\"text-sm opacity-80\">Mode</div>\r\n            <div className=\"flex gap-2 mt-1 justify-center\">\r\n              <label\r\n                className={`btn ${modeType === \"bestof\" ? \"btn-primary\" : \"btn-ghost\"}`}\r\n              >\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"mode\"\r\n                  value=\"bestof\"\r\n                  checked={modeType === \"bestof\"}\r\n                  onChange={() => {\r\n                    setModeType(\"bestof\");\r\n                    setLegs((prev) => {\r\n                      const base = Math.max(1, prev || 3);\r\n                      // Ensure odd for Best Of\r\n                      return base % 2 === 1 ? base : base + 1;\r\n                    });\r\n                    setTimeout(() => legsRef.current?.focus(), 0);\r\n                  }}\r\n                  className=\"sr-only\"\r\n                />{\" \"}\r\n                Best Of\r\n              </label>\r\n              <label\r\n                className={`btn ${modeType === \"firstto\" ? \"btn-primary\" : \"btn-ghost\"}`}\r\n              >\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"mode\"\r\n                  value=\"firstto\"\r\n                  checked={modeType === \"firstto\"}\r\n                  onChange={() => {\r\n                    setModeType(\"firstto\");\r\n                    setLegs((prev) => Math.max(1, prev || 3));\r\n                    setTimeout(() => legsRef.current?.focus(), 0);\r\n                  }}\r\n                  className=\"sr-only\"\r\n                />{\" \"}\r\n                First To\r\n              </label>\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-legs\">\r\n              {modeType === \"bestof\" ? \"Best Of\" : \"First To\"}\r\n            </label>\r\n            <input\r\n              id=\"match-legs\"\r\n              type=\"number\"\r\n              min={1}\r\n              value={legs}\r\n              onChange={(e) =>\r\n                setLegs(Math.max(1, Number(e.target.value || 1)))\r\n              }\r\n              ref={legsRef}\r\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-avg\">\r\n              Average Choice (±)\r\n            </label>\r\n            <input\r\n              id=\"match-avg\"\r\n              type=\"number\"\r\n              value={avgChoice}\r\n              onChange={(e) => setAvgChoice(Number(e.target.value || 0))}\r\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"flex justify-end mt-4\">\r\n          <button className=\"btn btn-primary\" onClick={handleCreate}>\r\n            Create Match\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>,\r\n    portalEl,\r\n  );\r\n}\r\n","import React, { useState, useMemo, useEffect } from \"react\";\r\nimport CreateMatchModal from \"./ui/CreateMatchModal\";\r\nimport GameCalibrationStatus from \"./GameCalibrationStatus\";\r\nimport MatchStartShowcase from \"./ui/MatchStartShowcase\";\r\nimport { useMatch } from \"../store/match\";\r\nimport { useWS } from \"./WSProvider\";\r\n\r\nexport default function OnlinePlayClean({ user }: { user?: any }) {\r\n  const username = user?.username || \"You\";\r\n  const [currentRoomIdx, setCurrentRoomIdx] = useState(0);\r\n  const [rooms, setRooms] = useState(() => [\r\n    { id: 1, name: \"room-1\", matches: [] as any[] },\r\n  ]);\r\n  const wsGlobal = (() => {\r\n    try {\r\n      return useWS();\r\n    } catch {\r\n      return null;\r\n    }\r\n  })();\r\n  const [serverMatches, setServerMatches] = useState<any[]>([]);\r\n  const inProgress = useMatch((s) => s.inProgress);\r\n  const players = useMatch((s) => s.players);\r\n  const [showStartShowcase, setShowStartShowcase] = useState<boolean>(false);\r\n  const startedShowcasedRef = React.useRef(false);\r\n  useEffect(() => {\r\n    if (!inProgress) return;\r\n    if (startedShowcasedRef.current) return;\r\n    startedShowcasedRef.current = true;\r\n    setShowStartShowcase(true);\r\n  }, [inProgress]);\r\n\r\n  // Global quit handler (from CameraView Quit / Pause modal)\r\n  useEffect(() => {\r\n    const onQuit = () => {\r\n      try {\r\n        useMatch.getState().endGame();\r\n      } catch (e) {}\r\n    };\r\n    try {\r\n      window.addEventListener(\"ndn:match-quit\" as any, onQuit as any);\r\n    } catch {}\r\n    return () => {\r\n      try {\r\n        window.removeEventListener(\"ndn:match-quit\" as any, onQuit as any);\r\n      } catch {}\r\n    };\r\n  }, []);\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n  const [joinMatch, setJoinMatch] = useState<any | null>(null);\r\n  const joinAcceptRef = React.useRef<HTMLButtonElement | null>(null);\r\n  const [selfId, setSelfId] = useState<string | null>(null);\r\n  const [participants, setParticipants] = useState<Record<string, string>>({});\r\n  const [joinTimer, setJoinTimer] = useState(30);\r\n  const serverPrestartRef = React.useRef(false);\r\n  const [joinChoice, setJoinChoice] = useState<null | \"bull\" | \"skip\">(null);\r\n  const [remoteChoices, setRemoteChoices] = useState<\r\n    Record<string, \"bull\" | \"skip\">\r\n  >({});\r\n  const [bullActive, setBullActive] = useState(false);\r\n  const [bullThrow, setBullThrow] = useState<number | null>(null);\r\n  const [bullWinner, setBullWinner] = useState<string | null>(null);\r\n  const [bullLocalThrow, setBullLocalThrow] = useState<number | null>(null);\r\n  const [bullThrown, setBullThrown] = useState(false);\r\n\r\n  const currentRoom = rooms[currentRoomIdx];\r\n  const maxMatchesPerRoom = 12;\r\n  const worldLobby = useMemo(() => {\r\n    if (serverMatches && serverMatches.length) return serverMatches as any[];\r\n    return rooms.flatMap((r) =>\r\n      r.matches.map((m) => ({ ...m, roomName: r.name })),\r\n    );\r\n  }, [rooms, serverMatches]);\r\n\r\n  // Combined matches: current room first, then world lobby matches that are not in current room\r\n  const combinedMatches = useMemo(() => {\r\n    const local = currentRoom?.matches || [];\r\n    const ids = new Set(local.map((m: any) => m.id));\r\n    const others = (worldLobby || []).filter((m: any) => !ids.has(m.id));\r\n    return [...local, ...others];\r\n  }, [currentRoom, worldLobby]);\r\n\r\n  const handleCreateMatch = (payload: any) => {\r\n    const newMatch = {\r\n      id: `m-${Date.now()}`,\r\n      createdBy: payload.createdBy || username,\r\n      game: payload.game,\r\n      modeType: payload.modeType,\r\n      legs: payload.legs,\r\n      startingScore: payload.startingScore,\r\n      createdAt: Date.now(),\r\n    };\r\n    // Optimistically add to current room\r\n    setRooms((prev) =>\r\n      prev.map((r, idx) =>\r\n        idx === currentRoomIdx\r\n          ? { ...r, matches: [newMatch, ...r.matches] }\r\n          : r,\r\n      ),\r\n    );\r\n    // If we have a server WS connection, send a create-match message\r\n    try {\r\n      if (wsGlobal?.connected) {\r\n        wsGlobal.send({\r\n          type: \"create-match\",\r\n          game: payload.game,\r\n          mode: payload.modeType,\r\n          value: payload.legs,\r\n          startingScore: payload.startingScore,\r\n          creatorAvg: payload.avgChoice || 0,\r\n        });\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  const newRoom = () => {\r\n    setRooms((prev) => {\r\n      const id = prev.length + 1;\r\n      const newRooms = [...prev, { id, name: `room-${id}`, matches: [] }];\r\n      setCurrentRoomIdx(newRooms.length - 1);\r\n      return newRooms;\r\n    });\r\n  };\r\n\r\n  // WS: subscribe to lobby and prestart events\r\n  useEffect(() => {\r\n    if (!wsGlobal) return;\r\n    if (wsGlobal.connected) wsGlobal.send({ type: \"list-matches\" });\r\n    const unsub = wsGlobal.addListener((msg) => {\r\n      try {\r\n        if (msg?.type === \"joined\") {\r\n          if (msg.id) setSelfId(msg.id);\r\n        }\r\n        if (msg?.type === \"presence\") {\r\n          // presence carries id and username\r\n          try {\r\n            if (msg.id)\r\n              setParticipants((prev) => ({\r\n                ...prev,\r\n                [msg.id]: msg.username || msg.name || msg.id,\r\n              }));\r\n          } catch {}\r\n        }\r\n        if (msg?.type === \"matches\") {\r\n          setServerMatches(msg.matches || []);\r\n        }\r\n        if (msg?.type === \"match-prestart\") {\r\n          // Someone accepted the invite; show prestart and update join match if it matches\r\n          const m = msg.match || null;\r\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\r\n          // Ensure we know the creator's username\r\n          try {\r\n            if (m?.creatorId && m?.creatorName)\r\n              setParticipants((prev) => ({\r\n                ...prev,\r\n                [m.creatorId]: m.creatorName,\r\n              }));\r\n          } catch {}\r\n          serverPrestartRef.current = true;\r\n          setJoinMatch(m);\r\n          const endsAt = msg.prestartEndsAt || Date.now();\r\n          setJoinTimer(\r\n            Math.max(\r\n              0,\r\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\r\n            ),\r\n          );\r\n          setTimeout(() => {\r\n            serverPrestartRef.current = false;\r\n          }, 0);\r\n          // store on joinMatch as prestartEndsAt\r\n          // reset diffuse state\r\n          setJoinChoice(null);\r\n          setRemoteChoices({});\r\n          setBullActive(false);\r\n          setBullThrow(null);\r\n          setBullWinner(null);\r\n        }\r\n        if (msg?.type === \"match-start\") {\r\n          // If the started match matches our current join request, close the modal\r\n          if (joinMatch && msg.roomId === joinMatch.id) {\r\n            setJoinMatch(null);\r\n            setJoinChoice(null);\r\n            setRemoteChoices({});\r\n            // (joinPrestart ends were attached to joinMatch; no-op)\r\n          }\r\n        }\r\n        if (msg?.type === \"prestart-choice-notify\") {\r\n          const { roomId, playerId, choice } = msg;\r\n          if (!roomId || !choice) return;\r\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\r\n        }\r\n        if (msg?.type === \"prestart-bull\") {\r\n          setBullActive(true);\r\n          setBullThrown(false);\r\n          setBullLocalThrow(null);\r\n        }\r\n        if (msg?.type === \"prestart-bull-winner\") {\r\n          setBullWinner(msg.winnerId || null);\r\n          setBullActive(false);\r\n          setBullThrown(false);\r\n        }\r\n        if (msg?.type === \"prestart-bull-tie\") {\r\n          // reset to allow another round\r\n          setBullWinner(null);\r\n          setBullActive(false);\r\n          setBullThrown(false);\r\n        }\r\n      } catch (err) {}\r\n    });\r\n    return unsub;\r\n  }, [wsGlobal, joinChoice]);\r\n\r\n  // Join timer\r\n  useEffect(() => {\r\n    if (!joinMatch) return;\r\n    if (serverPrestartRef.current) return;\r\n    // If a server-supplied prestart exists, do not override joinTimer\r\n    if ((joinMatch as any).prestartEndsAt) return;\r\n    setJoinTimer(30);\r\n    setJoinChoice(null);\r\n    setRemoteChoices({});\r\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\r\n    return () => clearInterval(t);\r\n  }, [joinMatch]);\r\n\r\n  // Focus the accept button when the join modal is shown\r\n  useEffect(() => {\r\n    if (!joinMatch) return;\r\n    setTimeout(() => joinAcceptRef.current?.focus(), 0);\r\n  }, [joinMatch]);\r\n\r\n  const handleJoinAccept = () => {\r\n    // Send accept (invite-response) to server if we have a match prestart\r\n    try {\r\n      if (wsGlobal?.connected && joinMatch?.id) {\r\n        wsGlobal.send({\r\n          type: \"invite-response\",\r\n          matchId: joinMatch.id,\r\n          accept: true,\r\n          toId: joinMatch.creatorId,\r\n        });\r\n      }\r\n    } catch {}\r\n    setJoinMatch(null);\r\n  };\r\n\r\n  const requestJoin = (m: any) => {\r\n    setJoinMatch(m);\r\n    try {\r\n      if (wsGlobal?.connected) {\r\n        wsGlobal.send({ type: \"join-match\", matchId: m.id, calibrated: true });\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\r\n    setJoinChoice(choice);\r\n    try {\r\n      if (wsGlobal?.connected && joinMatch?.id) {\r\n        wsGlobal.send({\r\n          type: \"prestart-choice\",\r\n          roomId: joinMatch.id,\r\n          choice,\r\n        });\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  // No local state for the start showcase; MatchStartShowcase reads from `match.inProgress` directly\r\n\r\n  return (\r\n    <div\r\n      className=\"flex-1 min-h-0\"\r\n      style={{ position: \"relative\", marginTop: 0 }}\r\n    >\r\n      <div className=\"card ndn-game-shell relative overflow-hidden h-full flex flex-col\">\r\n        {showStartShowcase && (\r\n          <MatchStartShowcase\r\n            players={(players || []) as any}\r\n            user={user}\r\n            onDone={() => setShowStartShowcase(false)}\r\n            onRequestClose={() => setShowStartShowcase(false)}\r\n          />\r\n        )}\r\n        <h2 className=\"text-3xl font-bold text-black dark:text-white mb-4\">\r\n          Online Play\r\n        </h2>\r\n        <div className=\"ndn-shell-body flex-1 overflow-hidden p-3 pb-0\">\r\n          <div className=\"rounded-xl border border-slate-700 bg-black/10 p-3 flex-1 min-h-0 overflow-hidden flex flex-col\">\r\n            {/* Top row: Room, New Room, Create Match */}\r\n            <div className=\"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap\">\r\n              <div className=\"min-w-0\">\r\n                <div className=\"text-sm opacity-80\">Room</div>\r\n                <div className=\"px-3 py-1 bg-white/5 rounded border border-white/10\">\r\n                  Room ({currentRoom?.id})\r\n                </div>\r\n                <div style={{ width: 12 }} />\r\n                <button className=\"btn btn-ghost\" onClick={newRoom}>\r\n                  New Room\r\n                </button>\r\n              </div>\r\n              <div className=\"shrink-0 flex items-center gap-2\">\r\n                <button\r\n                  className=\"btn btn-primary\"\r\n                  onClick={() => setShowCreateModal(true)}\r\n                  disabled={\r\n                    (currentRoom?.matches?.length || 0) >= maxMatchesPerRoom\r\n                  }\r\n                >\r\n                  Create Match +\r\n                </button>\r\n                {(currentRoom?.matches?.length || 0) >= maxMatchesPerRoom && (\r\n                  <div className=\"text-xs text-rose-400 mt-1\">\r\n                    Room full — create a new room\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <p className=\"mb-2\" />\r\n            <div className=\"flex-1 overflow-auto\">\r\n              <h3 className=\"font-semibold underline mb-3\">\r\n                Matches in this Room\r\n              </h3>\r\n              <div className=\"mb-3 p-3 rounded-xl border border-slate-700 bg-black/10\">\r\n                <div className=\"mb-4\">\r\n                  {(combinedMatches.length || 0) === 0 ? (\r\n                    <div className=\"text-sm opacity-60\">\r\n                      No matches in this room yet.\r\n                    </div>\r\n                  ) : (\r\n                    <div\r\n                      className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 max-h-[28rem] overflow-auto\"\r\n                      data-testid=\"matches-grid\"\r\n                    >\r\n                      {combinedMatches.map((m: any) => (\r\n                        <div\r\n                          key={m.id}\r\n                          className=\"p-3 rounded border bg-black/10 flex items-start justify-between h-24\"\r\n                          data-testid={`match-${m.id}`}\r\n                        >\r\n                          <div>\r\n                            <div className=\"font-semibold text-sm\">\r\n                              {m.game}{\" \"}\r\n                              {m.modeType === \"bestof\"\r\n                                ? \"(Best Of)\"\r\n                                : \"(First To)\"}{\" \"}\r\n                              - {m.legs} legs\r\n                            </div>\r\n                            {m.startingScore && (\r\n                              <div className=\"text-xs opacity-80\">\r\n                                Starting:{\" \"}\r\n                                <span className=\"font-mono\">\r\n                                  {m.startingScore}\r\n                                </span>\r\n                              </div>\r\n                            )}\r\n                            <div className=\"text-xs opacity-70 flex items-center gap-2\">\r\n                              Created by: {m.createdBy}\r\n                              {m.roomName && (\r\n                                <div className=\"ml-2 inline-flex items-center gap-2 text-xs uppercase px-2 py-0.5 rounded-full bg-white/5 border border-white/10\">\r\n                                  Room: {m.roomName}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"ml-4 shrink-0\">\r\n                            <button\r\n                              className=\"btn btn-sm\"\r\n                              onClick={() => requestJoin(m)}\r\n                            >\r\n                              Join Now!\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              {/* World Lobby removed: combined matches are displayed above */}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Create Match modal */}\r\n        <CreateMatchModal\r\n          open={showCreateModal}\r\n          onClose={() => setShowCreateModal(false)}\r\n          onCreate={(p) => {\r\n            handleCreateMatch(p);\r\n            setShowCreateModal(false);\r\n          }}\r\n        />\r\n\r\n        {/* Join Modal (simplified) */}\r\n        {joinMatch && (\r\n          <div\r\n            role=\"dialog\"\r\n            aria-modal=\"true\"\r\n            aria-labelledby=\"join-heading\"\r\n            tabIndex={-1}\r\n            className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4\"\r\n          >\r\n            <div className=\"bg-slate-800 rounded-2xl p-6 max-w-md w-full\">\r\n              <div id=\"join-heading\" className=\"text-lg font-bold mb-2\">\r\n                Join Match\r\n              </div>\r\n              <div className=\"mb-3\">\r\n                {joinMatch.game} - {joinMatch.modeType} • {joinMatch.legs} legs\r\n              </div>\r\n              <div className=\"text-sm opacity-80 mb-3\">\r\n                Created by {joinMatch.createdBy}\r\n              </div>\r\n              <div className=\"mb-3\">\r\n                <GameCalibrationStatus gameMode={joinMatch.game} compact />\r\n              </div>\r\n              {joinMatch.startingScore && (\r\n                <div className=\"mb-3\">\r\n                  Starting score:{\" \"}\r\n                  <span className=\"font-mono\">{joinMatch.startingScore}</span>\r\n                </div>\r\n              )}\r\n              {/* Match start showcase overlay */}\r\n              <MatchStartShowcase\r\n                open={showStartShowcase}\r\n                players={players as any}\r\n                user={user}\r\n                onRequestClose={() => {}}\r\n                onDone={() => {}}\r\n              />\r\n              <div className=\"mb-3\">\r\n                Timer: <span className=\"font-mono\">{joinTimer}s</span>\r\n              </div>\r\n              {(joinTimer <= 15 || (joinMatch as any)?.prestartEndsAt) && (\r\n                <div className=\"mb-3\">\r\n                  Choose:{\" \"}\r\n                  <div className=\"flex gap-2\">\r\n                    <button\r\n                      className={`btn ${joinChoice === \"bull\" ? \"btn-primary\" : \"btn-ghost\"}`}\r\n                      onClick={() => sendPrestartChoice(\"bull\")}\r\n                    >\r\n                      Bull Up\r\n                    </button>\r\n                    <button\r\n                      className={`btn ${joinChoice === \"skip\" ? \"btn-primary\" : \"btn-ghost\"}`}\r\n                      onClick={() => sendPrestartChoice(\"skip\")}\r\n                    >\r\n                      Skip\r\n                    </button>\r\n                  </div>\r\n                  <div className=\"text-xs opacity-70 mt-2\">\r\n                    {joinChoice\r\n                      ? `You chose: ${joinChoice}`\r\n                      : \"Please choose Bull Up or Skip before accepting\"}\r\n                  </div>\r\n                  {Object.keys(remoteChoices).length > 0 && (\r\n                    <div\r\n                      className=\"text-xs opacity-70 mt-2\"\r\n                      role=\"status\"\r\n                      aria-live=\"polite\"\r\n                    >\r\n                      {Object.entries(remoteChoices).map(([pid, choice]) => (\r\n                        <div key={pid}>\r\n                          {participants[pid] || pid} chose: {choice}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                  {joinChoice === \"skip\" && (\r\n                    <div className=\"text-xs opacity-70 mt-2\">\r\n                      Skip requires both players to click Skip. Waiting for\r\n                      other player…\r\n                    </div>\r\n                  )}\r\n                  {joinChoice === \"skip\" &&\r\n                    Object.values(remoteChoices).some((c) => c === \"skip\") && (\r\n                      <div className=\"text-sm font-semibold mt-2\">\r\n                        Both players skipped — Left player throws first\r\n                      </div>\r\n                    )}\r\n                  {bullActive && (\r\n                    <div className=\"text-xs opacity-70 mt-2\">\r\n                      Bull Up active —\r\n                      {bullThrown\r\n                        ? ` you threw ${bullLocalThrow ?? 50}`\r\n                        : \" throw to win the bull!\"}\r\n                    </div>\r\n                  )}\r\n                  {bullActive && !bullThrown && (\r\n                    <div className=\"flex items-center gap-2 mt-2\">\r\n                      <input\r\n                        className=\"input input-sm\"\r\n                        aria-label=\"bull-throw\"\r\n                        type=\"number\"\r\n                        min={0}\r\n                        max={50}\r\n                        value={bullThrow ?? 50}\r\n                        onChange={(e) =>\r\n                          setBullThrow(\r\n                            Math.max(\r\n                              0,\r\n                              Math.min(50, Number(e.target.value || 0)),\r\n                            ),\r\n                          )\r\n                        }\r\n                      />\r\n                      <button\r\n                        className=\"btn btn-primary\"\r\n                        onClick={() => {\r\n                          try {\r\n                            if (wsGlobal?.connected && joinMatch?.id)\r\n                              wsGlobal.send({\r\n                                type: \"prestart-bull-throw\",\r\n                                roomId: joinMatch.id,\r\n                                score: bullThrow ?? 50,\r\n                              });\r\n                          } catch {}\r\n                          setBullLocalThrow(bullThrow ?? 50);\r\n                          setBullThrown(true);\r\n                        }}\r\n                      >\r\n                        Throw Bull\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                  {bullThrown && (\r\n                    <div className=\"text-sm font-semibold mt-2 animate-pulse\">\r\n                      You threw: {bullLocalThrow ?? 50}\r\n                    </div>\r\n                  )}\r\n                  {bullWinner && (\r\n                    <div className=\"text-sm font-semibold mt-2\">\r\n                      Bull winner: {bullWinner}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n              <div className=\"flex items-center gap-2\">\r\n                <button\r\n                  ref={joinAcceptRef}\r\n                  aria-label=\"Accept invitation\"\r\n                  className=\"btn btn-primary\"\r\n                  onClick={handleJoinAccept}\r\n                  disabled={joinTimer <= 15 && !joinChoice}\r\n                >\r\n                  Accept\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-ghost\"\r\n                  onClick={() => {\r\n                    setJoinMatch(null);\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["CreateMatchModal","open","onClose","onCreate","portalEl","useState","game","setGame","modeType","setModeType","legs","setLegs","legsRef","useRef","avgChoice","setAvgChoice","startingScore","setStartingScore","getStartOptionsForGame","user","useUserSettings","useLayoutEffect","onKey","e","handleCreate","createPortal","jsxs","jsx","v","opts","allGames","g","opt","prev","base","OnlinePlayClean","username","currentRoomIdx","setCurrentRoomIdx","rooms","setRooms","wsGlobal","useWS","serverMatches","setServerMatches","inProgress","useMatch","s","players","showStartShowcase","setShowStartShowcase","startedShowcasedRef","React","useEffect","onQuit","showCreateModal","setShowCreateModal","joinMatch","setJoinMatch","joinAcceptRef","selfId","setSelfId","participants","setParticipants","joinTimer","setJoinTimer","serverPrestartRef","joinChoice","setJoinChoice","remoteChoices","setRemoteChoices","bullActive","setBullActive","bullThrow","setBullThrow","bullWinner","setBullWinner","bullLocalThrow","setBullLocalThrow","bullThrown","setBullThrown","currentRoom","maxMatchesPerRoom","worldLobby","useMemo","r","m","combinedMatches","local","ids","others","handleCreateMatch","payload","newMatch","idx","newRoom","id","newRooms","msg","endsAt","roomId","playerId","choice","handleJoinAccept","requestJoin","sendPrestartChoice","MatchStartShowcase","p","GameCalibrationStatus","pid","c"],"mappings":"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"}
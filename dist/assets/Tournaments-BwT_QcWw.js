import{j as t,H as J,e as _e,F as Fe,u as qe,k as Y,M as re,t as p,J as Ue,K as ie,i as Ge,a1 as Xe,I as Ye,x as De,a as S}from"./index-ALD5k1ur.js";import{r as n}from"./ui-Cl5S-Tv0.js";import{o as Ve,l as Ke}from"./matchWindow-ByaZKbEG.js";import"./vendor-D3F3s8fL.js";function He({t:i,onJoin:h,onLeave:u,joined:L,disabled:le}){return t.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"font-semibold",children:[i.title,i.official&&t.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded bg-amber-500 text-black text-xs",children:"Official"})]}),t.jsxs("div",{className:"text-sm opacity-80",children:[i.game,i.game==="X01"?"/501":""," Â· ",J(i.mode)," ",i.value," Â·"," ",new Date(i.startAt).toLocaleString()," Â· Cap ",i.capacity," Â· Joined"," ",i.participants?.length||0]}),t.jsxs("div",{className:"text-xs opacity-60 mt-1",children:["Created by: ",i.creatorName||i.creatorEmail||"Unknown"]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{className:`btn ${L?"bg-emerald-600 hover:bg-emerald-600":""}`,disabled:le,onClick:()=>L?u&&u(i):h&&h(i),children:L?"Already Joined! âœ…":"Join Now âš”ï¸"})})]})}const Qe=i=>typeof i=="string"?i.toLowerCase().includes("integration"):typeof i=="number"?i.toString().toLowerCase().includes("integration"):!1,Ze=i=>i?[i.title,i.description,i.creatorName,i.creatorEmail].some(u=>Qe(u)):!1,P=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0);function xt({user:i}){const h=_e(),u=(()=>{try{return Fe()}catch{return null}})(),{matchType:L="singles",setMatchType:le,teamAName:et="Team A",setTeamAName:tt,teamBName:st="Team B",setTeamBName:at}=qe(),[oe,V]=n.useState([]),[T,w]=n.useState(!1),[ce,y]=n.useState(""),[nt,K]=n.useState(null),[de,me]=n.useState(null),[x,O]=n.useState(null),[H,D]=n.useState(!1),[Me,ue]=n.useState(!1),[xe,he]=n.useState(!1);n.useRef(!1);const $=Y(e=>e.inProgress),Ae=Y(e=>e.roomId);n.useEffect(()=>{if($)try{const e=Y.getState();if((e?.game||"X01")!=="X01"||!e.roomId)return;const a=`ndn:matchWindowOpened:${e.roomId}`;if(window.sessionStorage.getItem(a)==="1")return;window.sessionStorage.setItem(a,"1"),Ve()}catch{}},[$,Ae]);const[r,g]=n.useState({title:"",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date().toISOString().slice(0,16),checkinMinutes:15,capacity:16,startingScore:501,requireCalibration:!1,extras:{}}),[f,pe]=n.useState(null),[fe,Q]=n.useState(30),[M,R]=n.useState(null),[ge,B]=n.useState({}),[rt,z]=n.useState(!1),[it,W]=n.useState(!1),[lt,Pe]=n.useState(null),[ot,Z]=n.useState(null),[_,j]=n.useState({open:!1,t:null}),[F,ee]=n.useState({open:!1,t:null}),te=n.useRef(!1);n.useRef(null);const[Ie,Ee]=n.useState({});n.useEffect(()=>u?u.addListener(s=>{try{if(s?.type==="match-prestart"){const a=s.match||null;a&&(a.prestartEndsAt=s.prestartEndsAt);try{a?.creatorId&&a?.creatorName&&Ee(m=>({...m,[a.creatorId]:a.creatorName}))}catch{}te.current=!0,pe(a);const l=s.prestartEndsAt||Date.now();Q(Math.max(0,Math.ceil(((l||Date.now())-Date.now())/1e3))),setTimeout(()=>{te.current=!1},0),R(null),B({}),z(!1),W(!1),Z(null)}if(s?.type==="match-start"&&f&&s.roomId===f.id&&(pe(null),R(null),B({})),s?.type==="prestart-choice-notify"){const{roomId:a,playerId:l,choice:m}=s;if(!a||!m)return;B(b=>({...b||{},[l]:m}))}s?.type==="prestart-bull"&&(z(!0),W(!1),Pe(null)),s?.type==="prestart-bull-winner"&&(Z(s.winnerId||null),z(!1),W(!1)),s?.type==="prestart-bull-tie"&&(Z(null),z(!1),W(!1))}catch{}}):void 0,[u,M,f]),n.useEffect(()=>{if(!f||te.current||f.prestartEndsAt)return;Q(30),R(null),B({});const e=setInterval(()=>Q(s=>Math.max(0,s-1)),1e3);return()=>clearInterval(e)},[f]);const be=Y(e=>({players:e.players,currentPlayerIdx:e.currentPlayerIdx,roomId:e.roomId}));n.useEffect(()=>{$&&he(!0)},[$]);const ye=e=>{R(e);try{u?.connected&&f?.id&&u.send({type:"prestart-choice",roomId:f.id,choice:e})}catch{}};async function k(){try{if(de&&Date.now()-de<3e3)return;const s=await(await S("/api/tournaments")).json(),a=Array.isArray(s.tournaments)?s.tournaments:[];V(a);try{console.debug("[Tournaments] refresh fetched",a.length,"tournaments"),console.log("[Tournaments] fetched list:",a)}catch{}K(null),me(Date.now())}catch(e){try{typeof window<"u"&&K(String(e?.message||e))}catch{typeof window<"u"&&K("unknown")}}}n.useEffect(()=>{k()},[]),n.useEffect(()=>{try{u?.connected&&k()}catch{}},[u?.connected]),n.useEffect(()=>{if(!u)return;const e=u.addListener(s=>{try{if(s.type==="tournaments"&&(V(s.tournaments||[]),me(Date.now())),s.type==="tournaments")try{console.debug("[Tournaments] WS tournaments update, num=",(s.tournaments||[]).length)}catch{}s.type==="tournament-win"&&s.message&&h(s.message,{type:"success",timeout:1e4})}catch{}});return()=>{e()}},[u?.connected]),n.useEffect(()=>{try{if(u?.connected){try{u.send({type:"list-tournaments"})}catch{}k()}}catch{}},[u?.connected]),n.useEffect(()=>{let e=null;try{(!u||!u.connected)&&(e=window.setInterval(()=>{k()},1e4))}catch{}return()=>{e&&clearInterval(e)}},[u?.connected]);const d=String(i?.email||"").toLowerCase(),je=d==="daviesfamily108@gmail.com",Je=()=>{Ke({players:["Tournament A","Tournament B"],startingScore:501,roomId:"tournament-demo",visits:[{score:45},{score:81},{score:140}]})},c=n.useCallback(e=>!e||!d?!1:(Array.isArray(e.participants)?e.participants:[]).some(a=>String(a?.email||"").toLowerCase()===d),[d]),[N,se]=n.useState(null),[Ne,ve]=n.useState({}),[Le,we]=n.useState(()=>Date.now()),Oe=n.useCallback(e=>{const s=(e.participants||[]).map(b=>b.username||b.email||"Player"),a=Math.max(1,2**Math.ceil(Math.log2(Math.max(1,s.length)))),l=[...s];for(;l.length<a;)l.push("BYE");const m=[];for(let b=0;b<l.length;b+=2)m.push([l[b],l[b+1]??"BYE"]);return m},[]),$e=()=>t.jsxs("div",{className:"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"opacity-70",children:"Default match"}),t.jsx("span",{className:"btn py-1 px-2 bg-indigo-500/30 border border-indigo-400/50 text-indigo-100",children:"Singles"}),t.jsx("span",{className:"text-xs opacity-60 ml-2",children:"(tournaments use Singles only)"})]});n.useEffect(()=>{let e=!1;async function s(){if(!d){O(null);return}try{const l=await(await S(`/api/subscription?email=${encodeURIComponent(d)}`)).json();e||(l?.source==="tournament"&&typeof l.expiresAt=="number"&&l.expiresAt>Date.now()?O(l.expiresAt):O(null))}catch{e||O(null)}}return s(),()=>{e=!0}},[d]);async function ke(e){d&&ee({open:!0,t:e})}async function Re(){const e=F.t;if(!(!e||!d)){ee({open:!1,t:null}),w(!0);try{let s=await S("/api/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,requesterEmail:d})});if(!s.ok&&s.status===403&&String(d)==="daviesfamily108@gmail.com"&&(s=await S("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,requesterEmail:d})})),!s.ok){let a="Delete failed";try{const l=await s.json();l?.error&&(a=`Delete failed: ${String(l.error)}`)}catch{}h(a,{type:"error"});return}h("Tournament deleted",{type:"success"}),await k()}finally{w(!1)}}}async function q(e){if(d){w(!0);try{const s=await S("/api/tournaments/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,email:d,username:i?.username})});if(!s.ok){let a={};try{a=await s.json()}catch{}a?.error==="WINNER_COOLDOWN"&&typeof a.until=="number"?(y(`You're a recent NDN tournament winner. You can re-enter after ${v(a.until)}.`),setTimeout(()=>y(""),6e3),h("Join blocked: winner cooldown active",{type:"error"})):a?.error==="ALREADY_IN_TOURNAMENT"?(y(String(a.message||"You can only join one tournament at a time.")),setTimeout(()=>y(""),6e3),h("Join blocked: already in another tournament",{type:"error"})):a?.error&&(y(String(a.error)),setTimeout(()=>y(""),3500),h(`Join failed: ${String(a.error)}`,{type:"error"}));return}h("Joined tournament",{type:"success"}),await k()}finally{w(!1)}}}async function Ce(e){if(d){w(!0);try{const s=await S("/api/tournaments/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,email:d})});if(!s.ok){let a={};try{a=await s.json()}catch{}a?.error?h(`Leave failed: ${String(a.error)}`,{type:"error"}):s.status===404?h("Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.",{type:"error"}):h("Leave failed. Please try again.",{type:"error"});return}h("Left tournament",{type:"success"}),V(a=>a.map(l=>l.id===e.id?{...l,participants:(l.participants||[]).filter(m=>m.email!==d)}:l)),await k()}finally{w(!1)}}}async function Be(){w(!0);try{const e=new Date(r.startAt).getTime(),s=await S("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:r.title,game:r.game,mode:r.mode,value:Number(r.value),description:r.description,startAt:e,checkinMinutes:Number(r.checkinMinutes),capacity:Number(r.capacity),startingScore:r.game==="X01"?Number(r.startingScore||501):void 0,requireCalibration:!!r.requireCalibration,creatorEmail:i?.email,creatorName:i?.username})});if(!s.ok){let a="";try{const m=await s.json();m?.error?a=String(m.error):m?.details&&(a=String(m.details))}catch{}const l=a?`Create failed: ${a}`:"Create failed. Please try again.";y(l),h(l,{type:"error"}),setTimeout(()=>y(""),6e3);return}try{const a=await s.json();if(!a?.ok){const l=a?.error?`Create failed: ${String(a.error)}`:"Create failed. Please try again.";y(l),h(l,{type:"error"}),setTimeout(()=>y(""),6e3);return}}catch{}D(!1),h("Tournament created",{type:"success"}),await k()}finally{w(!1)}}n.useEffect(()=>{if(!H)return;const e=s=>{s.key==="Escape"&&D(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[H]);const C=n.useMemo(()=>oe.filter(e=>!Ze(e)),[oe]),U=n.useMemo(()=>C.filter(e=>e.official),[C]),ae=n.useMemo(()=>C.filter(e=>!e.official),[C]),ne=n.useMemo(()=>C.filter(e=>e.status==="scheduled"&&!e.official),[C]);n.useEffect(()=>{const e=()=>{const a=Date.now(),l=C.find(m=>{if(!c(m)||m.status!=="scheduled"||Ne[m.id])return!1;const b=m.startAt-a;return b>0&&b<=300*1e3});se(l??null)};e();const s=window.setInterval(e,15e3);return()=>window.clearInterval(s)},[Ne,c,C]),n.useEffect(()=>{if(!N)return;we(Date.now());const e=window.setInterval(()=>we(Date.now()),1e3);return()=>window.clearInterval(e)},[N]);const[I,Se]=n.useState(1),A=16,G=Math.ceil(ne.length/A),ze=ne.slice((I-1)*A,I*A),[E,Te]=n.useState(1),X=Math.ceil(ae.length/A),We=ae.slice((E-1)*A,E*A),o=n.useMemo(()=>U.filter(s=>s.status==="scheduled").sort((s,a)=>s.startAt-a.startAt)[0]||null,[U]);function v(e){return new Date(e).toLocaleString()}return t.jsxs("div",{className:"card ndn-game-shell ndn-page flex flex-col min-h-0",children:[t.jsx("div",{className:"flex items-center justify-between mb-3",children:t.jsx("h2",{className:"text-2xl font-bold ndn-section-title",children:"Tournaments ðŸŽ¯"})}),t.jsxs("div",{className:"ndn-shell-body overflow-visible flex-1 min-h-0",children:[t.jsxs("div",{className:"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap",children:[t.jsx("div",{className:"min-w-0",children:t.jsx($e,{})}),t.jsxs("div",{className:"shrink-0",children:[t.jsx("button",{className:"btn",onClick:()=>D(!0),children:"Create Tournament + ðŸŽ¯"}),je&&t.jsx("button",{className:"btn btn-ghost ml-2",onClick:()=>ue(!0),children:"Demo Start Showcase ðŸŽ¯"}),je&&t.jsx("button",{className:"btn btn-ghost ml-2",onClick:Je,children:"Demo In-Game ðŸŽ®"})]})]}),Me&&t.jsx(re,{players:[{id:"0",name:"Demo A",legsWon:0,legs:[]},{id:"1",name:"Demo B",legsWon:0,legs:[]}],user:i,onDone:()=>ue(!1)}),xe&&t.jsx(re,{players:be.players||[],user:i,onDone:()=>he(!1)}),t.jsx("div",{className:"mb-2 text-sm font-semibold text-slate-300",children:"World Lobby"}),t.jsxs("div",{className:"mb-3 p-3 rounded-xl border border-indigo-500/20 bg-indigo-500/5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-semibold",children:"Created Game Lobby"}),t.jsx("div",{className:"text-xs opacity-60",children:"All tournaments created by users and admins"})]}),t.jsxs("ul",{className:"space-y-2",children:[ne.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No created tournaments yet."}),ze.map(e=>t.jsx(He,{t:e,onJoin:s=>q(s),onLeave:s=>Ce(s),joined:c(e),disabled:T||e.status!=="scheduled"||!c(e)&&e.participants.length>=e.capacity},e.id))]}),G>1&&t.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm",children:[t.jsx("button",{className:"text-slate-300 hover:text-white transition-colors",onClick:()=>Se(e=>Math.max(e-1,1)),disabled:I===1,children:"â† Previous"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-slate-400",children:["Page ",I," of ",G]}),t.jsx("button",{className:"text-slate-300 hover:text-white transition-colors",onClick:()=>Se(e=>Math.min(e+1,G)),disabled:I===G,children:"Next â†’"})]})]})]}),o&&t.jsx("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm uppercase tracking-wide text-indigo-300 font-semibold",children:"Weekly Official Tournament ðŸŽ¯"}),t.jsx("div",{className:"font-bold",children:o.title}),t.jsxs("div",{className:"text-sm opacity-80",children:[o.game,o.game==="X01"&&o.startingScore?`/${o.startingScore}`:""," ","Â· ",J(o.mode)," ",o.value," Â· Starts ",v(o.startAt)," Â· Cap"," ",o.capacity," Â· Joined"," ",o.participants.length]}),o.prize&&t.jsx("div",{className:"text-xs mt-1",children:"Prize: 3 months PREMIUM"}),o.status!=="scheduled"&&t.jsxs("div",{className:"text-xs",children:["Status: ",o.status]}),x&&x>Date.now()&&t.jsxs("div",{className:"text-xs text-rose-300",children:["Recent winners can re-enter after ",v(x),"."]})]}),t.jsx("div",{className:"shrink-0",children:t.jsx("button",{className:`btn ${c(o)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:c(o)?"Double-click to leave this tournament":o.official&&x&&x>Date.now()?`Recent winners can re-enter after ${v(x)}`:"",disabled:T||o.status!=="scheduled"||!c(o)&&(o.participants.length>=o.capacity||!!x&&x>Date.now()),onClick:()=>{c(o)?P&&j({open:!0,t:o}):q(o)},onDoubleClick:()=>{!P&&c(o)&&j({open:!0,t:o})},"aria-label":c(o)?"Already Joined":"Join Now",children:c(o)?"Already Joined! ðŸŽ¯":"Join Now ðŸŽ¯"})})]})}),ce&&t.jsx("div",{className:"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm",children:ce}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("section",{children:[t.jsx("div",{className:"font-semibold mb-1",children:"Official ðŸŽ¯"}),t.jsx("div",{className:"text-xs opacity-70 mb-2",children:x&&x>Date.now()?t.jsxs(t.Fragment,{children:["Youâ€™re a recent NDN tournament winner â€” to keep it fair, you can re-enter after ",v(x),"."]}):t.jsx(t.Fragment,{children:"Note: Weekly winners can re-enter once their 3 months of PREMIUM ends."})}),t.jsxs("ul",{className:"space-y-2",children:[U.map(e=>t.jsxs("li",{className:"p-3 rounded-lg border flex items-center justify-between relative",style:{backgroundColor:`${p(e.game).color}10`,borderColor:`${p(e.game).color}30`},children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[t.jsxs("span",{className:"px-2 py-0.5 rounded-full text-[10px] sm:text-xs border",style:{backgroundColor:`${p(e.game).color}20`,color:p(e.game).color,borderColor:`${p(e.game).color}50`},children:[p(e.game).emoji," ",e.game]}),e.title," ",e.prize&&t.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 align-middle",children:[t.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-amber-500 text-black",children:"Prize"}),t.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help",title:"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.","aria-label":"Prize info",children:"i"})]})]}),t.jsxs("div",{className:"text-sm opacity-80",children:[e.game,e.game==="X01"&&e.startingScore?`/${e.startingScore}`:""," ","Â· ",J(e.mode)," ",e.value," Â· ",v(e.startAt)," Â· Cap ",e.capacity," Â· Joined ",e.participants.length]}),t.jsx("div",{className:"text-xs opacity-60",children:p(e.game).tagline}),e.prize&&t.jsx("div",{className:"text-xs",children:"Prize: 3 months PREMIUM"}),e.status!=="scheduled"&&t.jsxs("div",{className:"text-xs",children:["Status: ",e.status]}),c(e)&&t.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"}),e.official&&x&&x>Date.now()&&t.jsxs("div",{className:"text-xs text-rose-300",children:["Cooldown active until ",v(x),"."]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:`btn ${c(e)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:c(e)?"Double-click to leave this tournament":e.official&&x&&x>Date.now()?`Recent winners can re-enter after ${v(x)}`:"",disabled:T||e.status!=="scheduled"||!c(e)&&(e.participants.length>=e.capacity||e.official&&!!x&&x>Date.now()),onClick:()=>{c(e)?P&&j({open:!0,t:e}):q(e)},onDoubleClick:()=>{!P&&c(e)&&j({open:!0,t:e})},"aria-label":c(e)?"Already Joined":"Join Now",children:c(e)?"Already Joined! ðŸŽ¯":"Join Now ðŸŽ¯"}),e.status==="scheduled"&&d&&(e.creatorEmail&&String(e.creatorEmail).toLowerCase()===d||d==="daviesfamily108@gmail.com")&&t.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>ke(e),"aria-label":"Delete tournament",children:"Ã—"})]})]},e.id)),U.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No official tournaments yet."})]})]}),t.jsxs("section",{children:[t.jsx("div",{className:"font-semibold mb-1",children:"Community ðŸŽ¯"}),t.jsxs("ul",{className:"space-y-2",children:[We.map(e=>t.jsxs("li",{className:"p-3 rounded-lg border flex items-center justify-between relative",style:{backgroundColor:`${p(e.game).color}10`,borderColor:`${p(e.game).color}30`},children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[t.jsxs("span",{className:"px-2 py-0.5 rounded-full text-[10px] sm:text-xs border",style:{backgroundColor:`${p(e.game).color}20`,color:p(e.game).color,borderColor:`${p(e.game).color}50`},children:[p(e.game).emoji," ",e.game]}),e.title]}),t.jsxs("div",{className:"text-sm opacity-80",children:[e.game,e.game==="X01"&&e.startingScore?`/${e.startingScore}`:""," ","Â· ",J(e.mode)," ",e.value," Â· ",v(e.startAt)," Â· Cap ",e.capacity," Â· Joined ",e.participants.length]}),t.jsx("div",{className:"text-xs opacity-60",children:p(e.game).tagline}),e.description&&t.jsx("div",{className:"text-xs opacity-80",children:e.description}),c(e)&&t.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"btn",title:c(e)?"Double-click to leave this tournament":"",disabled:T||e.status!=="scheduled"||!c(e)&&e.participants.length>=e.capacity,onClick:()=>{c(e)?P&&j({open:!0,t:e}):q(e)},onDoubleClick:()=>{!P&&c(e)&&j({open:!0,t:e})},children:c(e)?"Already Joined":"Join Now"}),e.status==="scheduled"&&d&&(e.creatorEmail&&String(e.creatorEmail).toLowerCase()===d||d==="daviesfamily108@gmail.com")&&t.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>ke(e),"aria-label":"Delete tournament",children:"Ã—"})]})]},e.id)),ae.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No community tournaments yet."})]}),X>1&&t.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 pt-2 border-t border-white/10",children:[t.jsx("button",{className:"btn btn-sm btn-ghost",disabled:E===1,onClick:()=>Te(e=>Math.max(1,e-1)),children:"Previous"}),t.jsxs("span",{className:"text-sm opacity-70",children:["Page ",E," of ",X]}),t.jsx("button",{className:"btn btn-sm btn-ghost",disabled:E===X,onClick:()=>Te(e=>Math.min(X,e+1)),children:"Next"})]})]})]}),N&&t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"tournament-prestart-heading",className:"fixed inset-0 z-[80] flex items-start justify-center pt-8 bg-black/70 p-4",onClick:e=>{e.target===e.currentTarget&&(ve(s=>({...s,[N.id]:!0})),se(null))},children:t.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-2xl w-full max-h-[85vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{id:"tournament-prestart-heading",className:"text-xl font-semibold",children:"Bracket Preview"}),t.jsxs("div",{className:"text-sm opacity-70",children:[N.title," starts in"," ",Math.max(0,Math.ceil((N.startAt-Le)/1e3)),"s"]})]}),t.jsx("button",{className:"btn btn-ghost",onClick:()=>{ve(e=>({...e,[N.id]:!0})),se(null)},children:"Close"})]}),t.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400 mb-3",children:"Round 1"}),t.jsx("div",{className:"space-y-2",children:Oe(N).map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm",children:[t.jsxs("span",{className:"font-semibold",children:["Match ",s+1]}),t.jsxs("span",{className:"text-slate-200",children:[e[0]," vs ",e[1]]})]},`${N.id}-pair-${s}`))}),t.jsx("div",{className:"mt-4 text-xs text-slate-400",children:"Byes are shown so everyone can see their bracket position."})]})}),H&&t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"create-tournament-heading",tabIndex:-1,className:"fixed inset-0 z-[70] flex items-start justify-center pt-8 bg-black/80 p-2 sm:p-6",onClick:e=>{e.target===e.currentTarget&&D(!1)},children:t.jsxs("div",{className:"rounded-2xl w-full sm:max-w-2xl max-h-[82vh] flex flex-col shadow-2xl border border-indigo-500/30 overflow-hidden",style:{background:"var(--ndn-card-bg, #0f172a)"},children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20 shrink-0",style:{background:"var(--ndn-card-bg, #0f172a)"},children:[t.jsx("h3",{id:"create-tournament-heading",className:"text-sm sm:text-lg font-bold tracking-tight",children:"ðŸŽ¯ New Tournament"}),t.jsx("button",{className:"w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors",onClick:()=>D(!1),"aria-label":"Close",children:"âœ•"})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3",style:{background:"var(--ndn-card-bg, #0f172a)"},children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Title"}),t.jsx("input",{className:"input w-full text-sm",value:r.title,onChange:e=>g(s=>({...s,title:e.target.value})),placeholder:"e.g. Friday Night 501"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Game Settings"}),t.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[t.jsxs("div",{children:[t.jsx("select",{className:"input w-full text-xs",value:r.game,onChange:e=>{const s=e.target.value,a=ie[s],l=a?.modeOptions?.includes(r.mode)?r.mode:a?.modeOptions?.[0]??"bestof";g(m=>({...m,game:s,mode:l,extras:Ge(s),startingScore:a?.startOptions?.[0]??m.startingScore}))},children:Ue.map(e=>t.jsxs("option",{value:e,children:[p(e).emoji," ",e]},e))}),t.jsx("div",{className:"text-[9px] mt-0.5 px-0.5",style:{color:p(r.game).color},children:p(r.game).tagline||"Game"})]}),t.jsxs("div",{children:[t.jsx("select",{className:"input w-full text-xs",value:r.mode,onChange:e=>g(s=>({...s,mode:e.target.value})),children:Xe(r.game).filter(e=>e!=="all").map(e=>t.jsx("option",{value:String(e),children:J(String(e))},String(e)))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Mode"})]}),t.jsxs("div",{children:[t.jsx("input",{className:"input w-full text-xs",type:"number",min:1,value:r.value,onChange:e=>g(s=>({...s,value:Number(e.target.value)})),placeholder:"0"}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:Ye(r.game,r.mode)})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Description"}),t.jsx("textarea",{className:"input w-full text-xs",rows:2,value:r.description,onChange:e=>g(s=>({...s,description:e.target.value})),placeholder:"Optional detailsâ€¦"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Schedule"}),t.jsxs("div",{className:"space-y-1.5 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-2",children:[t.jsxs("div",{children:[t.jsx("input",{className:"input w-full text-xs",type:"datetime-local",value:r.startAt,onChange:e=>g(s=>({...s,startAt:e.target.value}))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Start time"})]}),t.jsxs("div",{children:[t.jsx("input",{className:"input w-full text-xs",type:"number",min:0,value:r.checkinMinutes,onChange:e=>g(s=>({...s,checkinMinutes:Number(e.target.value)}))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Check-in (min)"})]})]})]}),De(r.game).length>0&&t.jsxs("div",{children:[t.jsxs("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:[r.game," Settings"]}),t.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:De(r.game).map(e=>t.jsxs("div",{children:[e.type==="select"&&e.options?t.jsx("select",{className:"input w-full text-xs",value:r.extras[e.key]??e.defaultValue,onChange:s=>g(a=>({...a,extras:{...a.extras,[e.key]:Number(s.target.value)}})),children:e.options.map(s=>t.jsx("option",{value:s,children:s},s))}):t.jsx("input",{className:"input w-full text-xs",type:"number",min:e.min??1,max:e.max,step:e.step??1,value:r.extras[e.key]??e.defaultValue,onChange:s=>g(a=>({...a,extras:{...a.extras,[e.key]:Number(s.target.value)}}))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:e.label})]},e.key))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Players"}),t.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[(ie[r.game]?.startOptions??[]).length>0?t.jsxs("div",{children:[t.jsx("select",{className:"input w-full text-xs",value:String(r.startingScore),onChange:e=>g(s=>({...s,startingScore:Number(e.target.value)})),children:(ie[r.game]?.startOptions??[301,501,701]).map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Starting score"})]}):t.jsx("div",{}),t.jsxs("div",{children:[t.jsx("input",{className:"input w-full text-xs",type:"number",min:6,max:64,value:r.capacity,onChange:e=>g(s=>({...s,capacity:Number(e.target.value)}))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Max players"})]})]})]}),t.jsxs("div",{className:"flex items-center gap-3 rounded-lg bg-indigo-500/10 border border-indigo-500/20 px-3 py-2",children:[t.jsx("input",{type:"checkbox",className:"accent-purple-500 w-4 h-4 shrink-0",checked:!!r.requireCalibration,onChange:e=>g(s=>({...s,requireCalibration:!!e.target.checked})),id:"require-camera"}),t.jsxs("label",{htmlFor:"require-camera",className:"text-xs leading-tight",children:[t.jsx("span",{className:"font-semibold",children:"Require Camera"}),t.jsx("span",{className:"block text-[10px] text-slate-400 mt-0.5",children:"Players must have a camera to join"})]})]}),t.jsx("div",{className:"text-[10px] text-slate-500 text-center pb-1",children:"Community tournaments do not award prizes."})]}),t.jsxs("div",{className:"flex gap-2 px-4 py-3 border-t border-indigo-500/20 shrink-0",style:{background:"var(--ndn-card-bg, #0f172a)"},children:[t.jsx("button",{className:"flex-1 btn btn-ghost text-xs",onClick:()=>D(!1),children:"Cancel"}),t.jsx("button",{className:"flex-1 btn text-xs",disabled:T,onClick:Be,children:T?"Creatingâ€¦":"Create Tournament"})]})]})}),f&&t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"join-heading",tabIndex:-1,className:"fixed inset-0 z-60 flex items-start justify-center pt-8 bg-black/60 p-4",children:t.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full",children:[t.jsx("div",{id:"join-heading",className:"text-lg font-bold mb-2",children:"Match Ready"}),t.jsxs("div",{className:"mb-3",children:[f.game," - ",f.modeType," Â· ",f.legs," legs"]}),t.jsxs("div",{className:"text-sm opacity-80 mb-3",children:["Created by ",f.createdBy]}),f.startingScore&&t.jsxs("div",{className:"mb-3",children:["Starting score:"," ",t.jsx("span",{className:"font-mono",children:f.startingScore})]}),t.jsx(re,{open:xe,players:be.players,user:i,onRequestClose:()=>{},onDone:()=>{}}),t.jsxs("div",{className:"mb-3",children:["Timer: ",t.jsxs("span",{className:"font-mono",children:[fe,"s"]})]}),(fe<=15||f?.prestartEndsAt)&&t.jsxs("div",{className:"mb-3",children:["Choose:"," ",t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:`btn ${M==="bull"?"btn-primary":"btn-ghost"}`,onClick:()=>ye("bull"),children:"Bull Up"}),t.jsx("button",{className:`btn ${M==="skip"?"btn-primary":"btn-ghost"}`,onClick:()=>ye("skip"),children:"Skip"})]}),t.jsx("div",{className:"text-xs opacity-70 mt-2",children:M?`You chose: ${M}`:"Please choose Bull Up or Skip before accepting"}),Object.keys(ge).length>0&&t.jsx("div",{className:"text-xs opacity-70 mt-2",role:"status","aria-live":"polite",children:Object.entries(ge).map(([e,s])=>t.jsxs("div",{children:[Ie[e]||e," chose: ",s]},e))}),M==="skip"&&t.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Skip requires both players to click Skip. Waiting for opponent..."})]})]})}),_.open&&_.t&&t.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-8",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>j({open:!1,t:null})}),t.jsxs("div",{className:"relative card p-4 w-[360px] max-w-[90vw]",children:[t.jsx("div",{className:"text-lg font-semibold mb-2",children:"Leave tournament?"}),t.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Are you sure you want to remove yourself from â€œ",_.t.title,"â€?"]}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>j({open:!1,t:null}),children:"Decline"}),t.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const e=_.t;j({open:!1,t:null}),await Ce(e)},children:"Accept"})]})]})]}),F.open&&F.t&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center pt-8 z-50",children:t.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold mb-4 text-white",children:"Delete Tournament"}),t.jsxs("div",{className:"text-slate-300 mb-6",children:["Are you sure you want to delete"," ",t.jsxs("span",{className:"font-semibold text-white",children:['"',F.t.title,'"']}),"?",t.jsx("br",{}),t.jsx("span",{className:"text-sm text-slate-400",children:"This action cannot be undone."})]}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsx("button",{className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",onClick:()=>ee({open:!1,t:null}),children:"Decline"}),t.jsx("button",{className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",onClick:Re,children:"Continue"})]})]})})})]})]})}export{xt as default};
//# sourceMappingURL=Tournaments-BwT_QcWw.js.map

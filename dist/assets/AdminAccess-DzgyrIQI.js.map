{"version":3,"file":"AdminAccess-DzgyrIQI.js","sources":["../../src/components/AdminAccess.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useToast } from '../store/toast';\r\n\r\nexport default function AdminAccess({ user }: { user?: any }) {\r\n  const [subscription, setSubscription] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n  const toast = useToast();\r\n\r\n  useEffect(() => {\r\n    const fetchSubscription = async () => {\r\n      try {\r\n        const q = user?.email ? `?email=${encodeURIComponent(user.email)}` : '';\r\n        const res = await fetch(`${API_URL}/api/subscription` + q);\r\n        if (!res.ok) throw new Error('Failed to fetch subscription');\r\n        const data = await res.json();\r\n        setSubscription(data);\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err.message : 'Something went wrong');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchSubscription();\r\n  }, [user?.email]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"card\">\r\n        <div className=\"text-center py-8\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-4\"></div>\r\n          <p>Loading subscription...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"card\">\r\n        <h2 className=\"text-2xl font-bold text-red-300 mb-2\">Subscription Error</h2>\r\n        <p className=\"mb-4 text-red-200\">{error}</p>\r\n        <button \r\n          onClick={() => window.location.reload()} \r\n          className=\"btn bg-red-600 hover:bg-red-700\"\r\n        >\r\n          Retry\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const hasAccess = subscription?.fullAccess;\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-indigo-300 mb-2\">\r\n        {hasAccess ? 'PREMIUM Active' : 'PREMIUM'}\r\n      </h2>\r\n      \r\n      {hasAccess ? (\r\n        <div className=\"mb-4\">\r\n          <div className=\"bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4\">\r\n            <div className=\"flex items-center gap-2 text-green-300 font-semibold mb-2\">\r\n              âœ… PREMIUM Access Active\r\n            </div>\r\n            <p className=\"text-green-200 text-sm\">\r\n              You have full access to all premium features!\r\n            </p>\r\n            {subscription?.source && (\r\n              <p className=\"text-green-200 text-xs mt-1\">\r\n                Source: {subscription.source}\r\n                {subscription?.expiresAt && ` (expires: ${new Date(subscription.expiresAt).toLocaleDateString()})`}\r\n              </p>\r\n            )}\r\n          </div>\r\n          \r\n          <h3 className=\"text-lg font-semibold mb-2 text-indigo-200\">Your Benefits:</h3>\r\n        </div>\r\n      ) : (\r\n        <p className=\"mb-2 text-indigo-200\">Unlock every game mode known to darts, advanced stats, and premium features.</p>\r\n      )}\r\n      \r\n      <ul className=\"mb-4\">\r\n        <li>All game modes (including paid/advanced)</li>\r\n        <li>Online play with all rules and variations</li>\r\n        <li>Advanced analytics and leaderboards</li>\r\n        <li>Premium camera modes and autoscoring</li>\r\n      </ul>\r\n\r\n      {!hasAccess && (\r\n        <button\r\n          onClick={async () => {\r\n            try {\r\n              const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ email: user.email })\r\n              });\r\n              const data = await res.json();\r\n              if (data.ok && data.url) {\r\n                window.location.href = data.url;\r\n              } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                toast(\"Premium purchases are not available. Payment link not configured.\", { type: 'error', timeout: 4000 });\r\n              } else {\r\n                toast(\"Failed to get payment link. Please try again.\", { type: 'error', timeout: 4000 });\r\n              }\r\n            } catch (err) {\r\n              toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n            }\r\n          }}\r\n          className=\"btn bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold shadow-lg hover:scale-105 transition\"\r\n        >\r\n          Subscribe to PREMIUM\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"names":["AdminAccess","user","subscription","setSubscription","useState","loading","setLoading","error","setError","API_URL","toast","useToast","useEffect","q","res","data","err","jsxs","jsx","hasAccess"],"mappings":"iHAGA,SAAwBA,EAAY,CAAE,KAAAC,GAAwB,CAC5D,KAAM,CAACC,EAAcC,CAAe,EAAIC,EAAAA,SAAc,IAAI,EACpD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAOC,CAAQ,EAAIJ,EAAAA,SAAwB,IAAI,EAChDK,EAAW,wBACXC,EAAQC,EAAA,EAoBd,GAlBAC,EAAAA,UAAU,IAAM,EACY,SAAY,CACpC,GAAI,CACF,MAAMC,EAAIZ,GAAM,MAAQ,UAAU,mBAAmBA,EAAK,KAAK,CAAC,GAAK,GAC/Da,EAAM,MAAM,MAAM,GAAGL,CAAO,oBAAsBI,CAAC,EACzD,GAAI,CAACC,EAAI,GAAI,MAAM,IAAI,MAAM,8BAA8B,EAC3D,MAAMC,EAAO,MAAMD,EAAI,KAAA,EACvBX,EAAgBY,CAAI,CACtB,OAASC,EAAK,CACZR,EAASQ,aAAe,MAAQA,EAAI,QAAU,sBAAsB,CACtE,QAAA,CACEV,EAAW,EAAK,CAClB,CACF,GAEA,CACF,EAAG,CAACL,GAAM,KAAK,CAAC,EAEZI,EACF,aACG,MAAA,CAAI,UAAU,OACb,SAAAY,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,8EAA8E,EAC7FA,EAAAA,IAAC,KAAE,SAAA,0BAAuB,CAAA,CAAA,CAC5B,CAAA,CACF,EAIJ,GAAIX,EACF,OACEU,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,KAAA,CAAG,UAAU,uCAAuC,SAAA,qBAAkB,QACtE,IAAA,CAAE,UAAU,oBAAqB,SAAAV,EAAM,EACxCW,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,OAAO,SAAS,OAAA,EAC/B,UAAU,kCACX,SAAA,OAAA,CAAA,CAED,EACF,EAIJ,MAAMC,EAAYjB,GAAc,WAEhC,OACEe,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,0CACX,SAAAC,EAAY,iBAAmB,UAClC,EAECA,EACCF,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iEACb,SAAA,OAAC,MAAA,CAAI,UAAU,4DAA4D,SAAA,0BAE3E,QACC,IAAA,CAAE,UAAU,yBAAyB,SAAA,gDAEtC,EACCf,GAAc,QACbe,OAAC,IAAA,CAAE,UAAU,8BAA8B,SAAA,CAAA,WAChCf,EAAa,OACrBA,GAAc,WAAa,cAAc,IAAI,KAAKA,EAAa,SAAS,EAAE,mBAAA,CAAoB,GAAA,EACjG,CAAA,EAEJ,QAEC,KAAA,CAAG,UAAU,6CAA6C,SAAA,iBAAc,CAAA,EAC3E,EAEAgB,EAAAA,IAAC,IAAA,CAAE,UAAU,uBAAuB,SAAA,+EAA4E,EAGlHD,EAAAA,KAAC,KAAA,CAAG,UAAU,OACZ,SAAA,CAAAC,EAAAA,IAAC,MAAG,SAAA,2CAAwC,EAC5CA,EAAAA,IAAC,MAAG,SAAA,4CAAyC,EAC7CA,EAAAA,IAAC,MAAG,SAAA,sCAAmC,EACvCA,EAAAA,IAAC,MAAG,SAAA,uCAAoC,CAAA,EAC1C,EAEC,CAACC,GACAD,EAAAA,IAAC,SAAA,CACC,QAAS,SAAY,CACnB,GAAI,CAMF,MAAMH,EAAO,MALD,MAAM,MAAM,GAAGN,CAAO,sCAAuC,CACvE,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,MAAOR,EAAK,MAAO,CAAA,CAC3C,GACsB,KAAA,EACnBc,EAAK,IAAMA,EAAK,IAClB,OAAO,SAAS,KAAOA,EAAK,IACnBA,EAAK,QAAU,wBACxBL,EAAM,oEAAqE,CAAE,KAAM,QAAS,QAAS,IAAM,EAE3GA,EAAM,gDAAiD,CAAE,KAAM,QAAS,QAAS,IAAM,CAE3F,MAAc,CACZA,EAAM,6CAA8C,CAAE,KAAM,QAAS,QAAS,IAAM,CACtF,CACF,EACA,UAAU,gHACX,SAAA,sBAAA,CAAA,CAED,EAEJ,CAEJ"}
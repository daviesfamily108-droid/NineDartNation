{"version":3,"file":"Friends-BV10qNp_.js","sources":["../../src/store/messages.ts","../../src/utils/profanity.ts","../../src/components/Friends.tsx"],"sourcesContent":["import { create } from \"zustand\";\n\nexport type DM = {\n  id: string;\n  from: string;\n  message: string;\n  ts: number;\n  /** Populated for true threads (server /api/friends/thread). */\n  to?: string;\n  /** Legacy inbox read flag (server /api/friends/messages). */\n  read?: boolean;\n  /** True thread read tracking (server /api/friends/thread). */\n  readBy?: string[];\n};\n\nexport type DMThread = {\n  other: string;\n  messages: DM[];\n};\n\ntype MessagesState = {\n  inbox: DM[];\n  unread: number;\n  threads: Record<string, DMThread>;\n  inGame: boolean;\n  setInGame: (v: boolean) => void;\n  add: (m: DM) => void;\n  load: (arr: DM[]) => void;\n  loadThread: (other: string, arr: DM[]) => void;\n  markAllRead: () => void;\n  pushThread: (other: string, m: DM) => void;\n  remove: (id: string) => void;\n};\n\nconst LS_INBOX = \"ndn:messages:inbox\";\nconst LS_UNREAD = \"ndn:messages:unread\";\nconst LS_THREADS = \"ndn:messages:threads\";\n\nfunction loadInitial() {\n  try {\n    const raw = localStorage.getItem(LS_INBOX);\n    const arr = raw ? (JSON.parse(raw) as DM[]) : [];\n    const unread = Number(localStorage.getItem(LS_UNREAD) || \"0\") || 0;\n    const rawThreads = localStorage.getItem(LS_THREADS);\n    const parsedThreads = rawThreads\n      ? (JSON.parse(rawThreads) as Record<string, DMThread>)\n      : {};\n    // sanitize\n    const inbox = Array.isArray(arr)\n      ? arr.filter((m) => m && typeof m.id === \"string\").slice(0, 200)\n      : [];\n    const threads =\n      parsedThreads && typeof parsedThreads === \"object\" ? parsedThreads : {};\n    return { inbox, unread, threads };\n  } catch {\n    return { inbox: [], unread: 0, threads: {} };\n  }\n}\n\nfunction save(inbox: DM[], unread: number, threads?: Record<string, DMThread>) {\n  try {\n    localStorage.setItem(LS_INBOX, JSON.stringify(inbox));\n  } catch {}\n  try {\n    localStorage.setItem(LS_UNREAD, String(unread));\n  } catch {}\n  if (threads) {\n    try {\n      localStorage.setItem(LS_THREADS, JSON.stringify(threads));\n    } catch {}\n  }\n}\n\nconst initial = loadInitial();\n\nexport const useMessages = create<MessagesState>((set, get) => ({\n  inbox: initial.inbox,\n  unread: initial.unread,\n  threads: initial.threads,\n  inGame: false,\n  setInGame: (v) => set({ inGame: v }),\n  add: (m) =>\n    set((s) => {\n      const exists = s.inbox.some((x) => x.id === m.id && x.ts === m.ts);\n      const list = exists ? s.inbox : [m, ...s.inbox].slice(0, 200);\n      const unread = s.unread + (exists ? 0 : 1);\n      save(list, unread, s.threads);\n      return { inbox: list, unread };\n    }),\n  load: (arr) =>\n    set((s) => {\n      const sorted = [...arr].sort((a, b) => b.ts - a.ts).slice(0, 200);\n      save(sorted, s.unread, s.threads);\n      return { inbox: sorted, unread: s.unread };\n    }),\n  loadThread: (other, arr) =>\n    set((s) => {\n      const key = String(other || \"\").toLowerCase();\n      if (!key) return s;\n      const sorted = [...arr].sort((a, b) => a.ts - b.ts).slice(-400);\n      const threads = {\n        ...s.threads,\n        [key]: { other: key, messages: sorted },\n      };\n      save(s.inbox, s.unread, threads);\n      return { threads };\n    }),\n  markAllRead: () => {\n    const s = get();\n    save(s.inbox, 0, s.threads);\n    set({ unread: 0 });\n  },\n  pushThread: (other, m) =>\n    set((s) => {\n      const key = String(other || \"\").toLowerCase();\n      if (!key) return s;\n      const existing = s.threads[key]?.messages || [];\n      const next = [...existing, m].sort((a, b) => a.ts - b.ts).slice(-400);\n      const threads = {\n        ...s.threads,\n        [key]: { other: key, messages: next },\n      };\n      save(s.inbox, s.unread, threads);\n      return { threads };\n    }),\n  remove: (id) =>\n    set((s) => {\n      const list = s.inbox.filter((m) => m.id !== id);\n      const unread = s.unread; // keep unread count stable on deletion from history\n      save(list, unread, s.threads);\n      return { inbox: list, unread };\n    }),\n}));\n","// Simple profanity filter: replaces detected profane words with asterisks of the same length.\n// Note: This is a lightweight heuristic and not exhaustive.\n\nconst patterns: RegExp[] = [\n  /\\b(f+[\\W_]*u+[\\W_]*c+[\\W_]*k+)\\b/gi,\n  /\\b(s+[\\W_]*h+[\\W_]*i+[\\W_]*t+)\\b/gi,\n  /\\b(b+[\\W_]*i+[\\W_]*t+[\\W_]*c+[\\W_]*h+)\\b/gi,\n  /\\b(a+[\\W_]*s+[\\W_]*s+[\\W_]*h+[\\W_]*o+[\\W_]*l+[\\W_]*e+)\\b/gi,\n  /\\b(d+[\\W_]*a+[\\W_]*m+[\\W_]*n+)\\b/gi,\n  /\\b(c+[\\W_]*r+[\\W_]*a+[\\W_]*p+)\\b/gi,\n  /\\b(p+[\\W_]*i+[\\W_]*s+[\\W_]*s+)\\b/gi,\n];\n\nfunction starify(match: string) {\n  // Preserve whitespace/punct positions; just replace letters/numbers with *\n  return match.replace(/[\\p{L}\\p{N}]/gu, \"*\");\n}\n\nexport function censorProfanity(input: string): string {\n  if (!input) return input;\n  let out = input;\n  for (const re of patterns) {\n    out = out.replace(re, (m) => starify(m));\n  }\n  return out;\n}\n\nexport function containsProfanity(input: string): boolean {\n  if (!input) return false;\n  return patterns.some((re) => re.test(input));\n}\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useToast } from \"../store/toast.js\";\nimport { useMessages } from \"../store/messages.js\";\nimport { censorProfanity } from \"../utils/profanity.js\";\nimport TabPills from \"./ui/TabPills.js\";\nimport { labelForMode } from \"../utils/games.js\";\nimport { apiFetch } from \"../utils/api.js\";\nimport {\n  getAllTime,\n  getAllTimeAvg,\n  getGameModeStats,\n} from \"../store/profileStats.js\";\nimport { formatAvg } from \"../utils/stats.js\";\nimport { useWS } from \"./WSProvider.js\";\n\ntype Friend = {\n  email: string;\n  username?: string;\n  status?: \"online\" | \"offline\" | \"ingame\";\n  lastSeen?: number;\n  roomId?: string | null;\n  avatar?: string | null;\n  threeDartAvg?: number;\n  relationship?: \"none\" | \"friend\" | \"pending-outgoing\" | \"pending-incoming\";\n  match?: {\n    game: string;\n    mode: string;\n    value: number;\n    startingScore?: number;\n  } | null;\n};\n\nfunction timeAgo(ts?: number) {\n  if (!ts) return \"\";\n  const s = Math.floor((Date.now() - ts) / 1000);\n  if (s < 60) return `${s}s ago`;\n  const m = Math.floor(s / 60);\n  if (m < 60) return `${m}m ago`;\n  const h = Math.floor(m / 60);\n  if (h < 24) return `${h}h ago`;\n  const d = Math.floor(h / 24);\n  return `${d}d ago`;\n}\n\nexport default function Friends({ user }: { user?: any }) {\n  const ws = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  const toast = useToast();\n  const email = String(user?.email || \"\").toLowerCase();\n  const [friends, setFriends] = useState<Friend[]>([]);\n  const [suggested, setSuggested] = useState<Friend[]>([]);\n  const [results, setResults] = useState<Friend[]>([]);\n  const [q, setQ] = useState(\"\");\n  const [filter, setFilter] = useState<\n    \"all\" | \"online\" | \"offline\" | \"ingame\" | \"requests\"\n  >(\"all\");\n  const [loading, setLoading] = useState(false);\n  const msgs = useMessages();\n  const [activeChat, setActiveChat] = useState<{\n    email: string;\n    username?: string;\n  } | null>(null);\n  const [chatDraft, setChatDraft] = useState(\"\");\n  const chatScrollRef = useRef<HTMLDivElement | null>(null);\n  const [requests, setRequests] = useState<\n    Array<{\n      id: string;\n      fromEmail: string;\n      fromUsername: string;\n      toEmail: string;\n      toUsername: string;\n      requestedAt: number;\n    }>\n  >([]);\n  const [outgoingRequests, setOutgoingRequests] = useState<\n    Array<{\n      id: string;\n      fromEmail: string;\n      fromUsername: string;\n      toEmail: string;\n      toUsername: string;\n      requestedAt: number;\n    }>\n  >([]);\n  const [messagePopup, setMessagePopup] = useState<{\n    show: boolean;\n    toUser?: string;\n    toEmail?: string;\n    replyTo?: string;\n  }>({ show: false });\n\n  // Selected friend detail panel\n  const [selectedFriend, setSelectedFriend] = useState<Friend | null>(null);\n  const [friendStats, setFriendStats] = useState<any>(null);\n  const [friendAvatar, setFriendAvatar] = useState<string | null>(null);\n  const [detailTab, setDetailTab] = useState<\"profile\" | \"chat\" | \"compare\">(\n    \"profile\",\n  );\n\n  const loadThread = useCallback(\n    async (otherEmail: string) => {\n      const other = String(otherEmail || \"\").toLowerCase();\n      if (!email || !other || other === email) return;\n      try {\n        const res = await apiFetch(\n          `/api/friends/thread?email=${encodeURIComponent(email)}&other=${encodeURIComponent(other)}`,\n        );\n        const data = await res.json();\n        if (data?.ok && Array.isArray(data.thread)) {\n          msgs.loadThread(other, data.thread);\n        }\n      } catch {\n        // ignore\n      }\n    },\n    [email, msgs],\n  );\n\n  const activeThread = useMemo(() => {\n    if (!activeChat?.email) return [];\n    const other = activeChat.email.toLowerCase();\n    const thread = msgs.threads?.[other]?.messages;\n    if (Array.isArray(thread) && thread.length) return thread;\n    // Fallback: Backend may still only return inbound messages.\n    return msgs.inbox\n      .filter((m) => String(m.from || \"\").toLowerCase() === other)\n      .slice()\n      .sort((a, b) => a.ts - b.ts);\n  }, [activeChat?.email, msgs.inbox, msgs.threads]);\n\n  const threadPreviewByEmail = useMemo(() => {\n    const map = new Map<string, { ts: number; message: string }>();\n    for (const m of msgs.inbox) {\n      const from = String(m.from || \"\").toLowerCase();\n      const prev = map.get(from);\n      if (!prev || m.ts > prev.ts)\n        map.set(from, { ts: m.ts, message: m.message });\n    }\n    return map;\n  }, [msgs.inbox]);\n\n  const unreadCountByEmail = useMemo(() => {\n    // Message store only tracks a global unread count; approximate per-friend\n    // by counting recent messages (purely a UI hint).\n    const map = new Map<string, number>();\n    const recentMs = 1000 * 60 * 60 * 24 * 3; // last 3 days\n    const cutoff = Date.now() - recentMs;\n    for (const m of msgs.inbox) {\n      if ((m.ts || 0) < cutoff) continue;\n      const from = String(m.from || \"\").toLowerCase();\n      map.set(from, (map.get(from) || 0) + 1);\n    }\n    return map;\n  }, [msgs.inbox]);\n\n  async function refresh() {\n    if (!email) return;\n    // Clear API disable flag to ensure friends fetch isn't blocked by a prior transient failure\n    try {\n      (window as any).__ndnApiDisabled = false;\n      (window as any).__ndnApiDisabledAt = 0;\n    } catch {}\n    try {\n      const [fl, sg, rq, out] = await Promise.all([\n        apiFetch(`/api/friends/list?email=${encodeURIComponent(email)}`).then(\n          (r) => r.json(),\n        ),\n        apiFetch(\n          `/api/friends/suggested?email=${encodeURIComponent(email)}`,\n        ).then((r) => r.json()),\n        apiFetch(\n          `/api/friends/requests?email=${encodeURIComponent(email)}`,\n        ).then((r) => r.json()),\n        apiFetch(\n          `/api/friends/outgoing?email=${encodeURIComponent(email)}`,\n        ).then((r) => r.json()),\n      ]);\n      if (fl.ok !== false) setFriends(fl.friends || []);\n      if (sg.ok !== false) setSuggested(sg.suggestions || []);\n      if (rq.ok !== false) setRequests(rq.requests || []);\n      if (out.ok !== false) setOutgoingRequests(out.requests || []);\n    } catch {}\n  }\n\n  useEffect(() => {\n    if (!email) return;\n    let cancelled = false;\n    // Retry on mount to handle Render cold starts\n    async function initialLoad() {\n      await refresh();\n      // If friends are still empty after first attempt, retry a couple of times\n      // (Render cold starts can cause the first request to time out)\n      for (let attempt = 0; attempt < 2; attempt++) {\n        if (cancelled) return;\n        await new Promise((r) => setTimeout(r, 3000));\n        if (cancelled) return;\n        await refresh();\n      }\n    }\n    initialLoad();\n    return () => {\n      cancelled = true;\n    };\n  }, [email]);\n\n  // Periodic refresh to keep friends list and statuses up to date\n  useEffect(() => {\n    if (!email) return;\n    const iv = setInterval(() => {\n      refresh();\n    }, 30_000);\n    return () => clearInterval(iv);\n  }, [email]);\n\n  // Listen for WS friend events to refresh immediately\n  useEffect(() => {\n    if (!ws) return;\n    const unsub = ws.addListener((data: any) => {\n      try {\n        if (\n          data?.type === \"friend-accepted\" ||\n          data?.type === \"friend-removed\" ||\n          data?.type === \"friend-request\" ||\n          data?.type === \"friend-declined\"\n        ) {\n          refresh();\n        }\n      } catch {}\n    });\n    return () => {\n      try {\n        unsub();\n      } catch {}\n    };\n  }, [ws, email]);\n\n  // Load inbox on mount/user change.\n  useEffect(() => {\n    if (!email) return;\n    apiFetch(`/api/friends/messages?email=${encodeURIComponent(email)}`)\n      .then((r) => r.json())\n      .then((d) => {\n        if (d?.ok && Array.isArray(d.messages)) msgs.load(d.messages);\n      })\n      .catch(() => {});\n  }, [email]);\n\n  // Load real 2-way thread whenever we open/switch chats.\n  useEffect(() => {\n    if (!activeChat?.email) return;\n    void loadThread(activeChat.email);\n  }, [activeChat?.email, loadThread]);\n\n  // Keep thread scrolled to bottom when opening or receiving new messages.\n  useEffect(() => {\n    if (!activeChat) return;\n    const el = chatScrollRef.current;\n    if (!el) return;\n    el.scrollTop = el.scrollHeight;\n  }, [activeChat?.email, activeThread.length]);\n\n  async function search(term: string) {\n    setQ(term);\n    if (!term) {\n      setResults([]);\n      return;\n    }\n    try {\n      const res = await apiFetch(\n        `/api/friends/search?q=${encodeURIComponent(term)}&email=${encodeURIComponent(email)}`,\n      );\n      const data = await res.json();\n      setResults(data.results || []);\n    } catch {}\n  }\n\n  // Load friend stats + avatar when a friend is selected\n  useEffect(() => {\n    if (!selectedFriend) {\n      setFriendStats(null);\n      setFriendAvatar(null);\n      return;\n    }\n    const uname = selectedFriend.username || \"\";\n    // Load avatar\n    if (selectedFriend.avatar) {\n      setFriendAvatar(selectedFriend.avatar);\n    } else if (uname) {\n      apiFetch(`/api/user/avatar/${encodeURIComponent(uname)}`)\n        .then((r) => r.json())\n        .then((d) => setFriendAvatar(d.avatar || null))\n        .catch(() => setFriendAvatar(null));\n    }\n    // Load stats\n    if (uname) {\n      apiFetch(`/api/user/stats/public/${encodeURIComponent(uname)}`)\n        .then((r) => r.json())\n        .then((d) => setFriendStats(d.stats || null))\n        .catch(() => setFriendStats(null));\n    }\n  }, [selectedFriend?.email]);\n\n  // When selecting a friend, also open their chat thread\n  useEffect(() => {\n    if (selectedFriend && detailTab === \"chat\") {\n      setActiveChat({\n        email: selectedFriend.email,\n        username: selectedFriend.username,\n      });\n      void loadThread(selectedFriend.email);\n    }\n  }, [selectedFriend?.email, detailTab]);\n\n  async function addFriend(target: string) {\n    if (!email || !target) return;\n    setLoading(true);\n    try {\n      await apiFetch(\"/api/friends/add\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, friend: target }),\n      });\n      await refresh();\n      setQ(\"\");\n      setResults([]);\n      toast(\"Friend request sent\", { type: \"success\" });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function removeFriend(target: string) {\n    if (!email || !target) return;\n    setLoading(true);\n    try {\n      await apiFetch(\"/api/friends/remove\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, friend: target }),\n      });\n      await refresh();\n      toast(\"Friend removed\", { type: \"info\" });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function acceptFriend(requestId?: string, fromEmail?: string) {\n    try {\n      await apiFetch(\"/api/friends/accept\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, requestId, fromEmail }),\n      });\n      await refresh();\n      toast(\"Friend request accepted\", { type: \"success\" });\n    } catch {\n      toast(\"Failed to accept request\", { type: \"error\" });\n    }\n  }\n\n  async function declineFriend(requestId: string) {\n    try {\n      await apiFetch(\"/api/friends/decline\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, requestId }),\n      });\n      await refresh();\n      toast(\"Friend request declined\", { type: \"info\" });\n    } catch {}\n  }\n\n  async function cancelRequest(requestId: string) {\n    try {\n      await apiFetch(\"/api/friends/cancel\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, requestId }),\n      });\n      await refresh();\n      toast(\"Friend request cancelled\", { type: \"info\" });\n    } catch {}\n  }\n\n  async function sendMessage() {\n    const input = document.getElementById(\n      \"message-input\",\n    ) as HTMLTextAreaElement;\n    const message = input?.value;\n    if (!message || !messagePopup.toEmail) return;\n    try {\n      await apiFetch(\"/api/friends/message\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          fromEmail: email,\n          toEmail: messagePopup.toEmail,\n          message,\n        }),\n      });\n      setMessagePopup({ show: false });\n      toast(\"Message sent\", { type: \"success\" });\n    } catch {}\n  }\n\n  async function sendChatMessage() {\n    if (!email || !activeChat?.email) return;\n    const message = chatDraft.trim();\n    if (!message) return;\n    try {\n      await apiFetch(\"/api/friends/message\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          fromEmail: email,\n          toEmail: activeChat.email,\n          message,\n        }),\n      });\n\n      // Optimistically append to the active thread.\n      const now = Date.now();\n      const id = `${now}-${Math.random().toString(36).slice(2, 8)}`;\n      msgs.pushThread(activeChat.email, {\n        id,\n        from: email,\n        to: String(activeChat.email).toLowerCase(),\n        message,\n        ts: now,\n        readBy: [email],\n      });\n\n      setChatDraft(\"\");\n      toast(\"Message sent\", { type: \"success\" });\n    } catch {\n      toast(\"Failed to send message\", { type: \"error\" });\n    }\n  }\n\n  const filtered = useMemo(() => {\n    if (filter === \"all\") return friends;\n    return friends.filter((f) => (f.status || \"offline\") === filter);\n  }, [friends, filter]);\n\n  const statusSummary = useMemo(() => {\n    const summary = { online: 0, ingame: 0, offline: 0 };\n    for (const f of friends) {\n      if (f.status === \"online\") summary.online += 1;\n      else if (f.status === \"ingame\") summary.ingame += 1;\n      else summary.offline += 1;\n    }\n    return summary;\n  }, [friends]);\n\n  async function spectate(roomId?: string | null) {\n    if (!roomId) {\n      toast(\"Room unavailable\", { type: \"error\" });\n      return;\n    }\n    try {\n      const ev = new CustomEvent(\"ndn:spectate-request\", {\n        detail: { roomId },\n      });\n      window.dispatchEvent(ev);\n      toast(\"Opening spectator view...\", { type: \"info\" });\n    } catch {}\n  }\n\n  // Friend Requests pill: normalize incoming/outgoing in case backend misclassifies\n  const {\n    incomingRequests,\n    outgoingRequests: outgoingRequestsResolved,\n    requestsCount,\n  } = useMemo(() => {\n    const me = String(email || \"\").toLowerCase();\n    const all = [...requests, ...outgoingRequests];\n    const seen = new Set<string>();\n    const unique = all.filter((r) => {\n      const key = r.id || `${r.fromEmail}|${r.toEmail}`;\n      if (seen.has(key)) return false;\n      seen.add(key);\n      return true;\n    });\n    const incoming = unique.filter(\n      (r) => String(r.fromEmail || \"\").toLowerCase() !== me,\n    );\n    const outgoing = unique.filter(\n      (r) => String(r.fromEmail || \"\").toLowerCase() === me,\n    );\n    return {\n      incomingRequests: incoming,\n      outgoingRequests: outgoing,\n      requestsCount: incoming.length + outgoing.length,\n    };\n  }, [email, requests, outgoingRequests]);\n\n  // My own stats for comparison\n  const myUsername = user?.username || \"Player 1\";\n  const myAllTime = getAllTime(myUsername);\n  const myAllTimeAvg = getAllTimeAvg(myUsername);\n  const myGameModes = getGameModeStats(myUsername);\n  const myTotalGames = Object.values(myGameModes).reduce(\n    (s, g) => s + (g.played || 0),\n    0,\n  );\n  const myTotalWins = Object.values(myGameModes).reduce(\n    (s, g) => s + (g.won || 0),\n    0,\n  );\n\n  // Helper to open a friend's detail\n  function openFriendDetail(f: Friend) {\n    setSelectedFriend(f);\n    setDetailTab(\"profile\");\n  }\n\n  // Status dot color\n  function statusDot(status?: string) {\n    if (status === \"online\") return \"bg-emerald-400\";\n    if (status === \"ingame\") return \"bg-amber-400\";\n    return \"bg-slate-500\";\n  }\n  function statusLabel(status?: string) {\n    if (status === \"online\") return \"Online\";\n    if (status === \"ingame\") return \"In-Game\";\n    return \"Offline\";\n  }\n  function statusTextColor(status?: string) {\n    if (status === \"online\") return \"text-emerald-400\";\n    if (status === \"ingame\") return \"text-amber-400\";\n    return \"text-slate-500\";\n  }\n\n  return (\n    <div\n      className=\"card ndn-game-shell ndn-page\"\n      style={{ minHeight: \"calc(100% + 100px)\", paddingBottom: \"100px\" }}\n    >\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2 ndn-section-title\">\n        Friends üë•\n      </h2>\n      <p className=\"mb-2 text-brand-600\">\n        Manage your friends. See who&apos;s online, in-game, or offline; find\n        new teammates; and invite people to play.\n      </p>\n\n      {/* Status summary cards ‚Äî clickable to filter */}\n      <div className=\"grid gap-3 mb-4 grid-cols-2 sm:grid-cols-5\">\n        {[\n          {\n            key: \"all\" as const,\n            label: \"All\",\n            value: friends.length,\n            accent: \"bg-white/5 border-white/20\",\n            activeAccent:\n              \"bg-indigo-500/20 border-indigo-500/50 ring-2 ring-indigo-500/30\",\n          },\n          {\n            key: \"online\" as const,\n            label: \"Online\",\n            value: statusSummary.online,\n            accent: \"bg-emerald-500/10 border-emerald-500/40\",\n            activeAccent:\n              \"bg-emerald-500/20 border-emerald-500/60 ring-2 ring-emerald-500/30\",\n          },\n          {\n            key: \"ingame\" as const,\n            label: \"In-Game\",\n            value: statusSummary.ingame,\n            accent: \"bg-amber-500/10 border-amber-500/40\",\n            activeAccent:\n              \"bg-amber-500/20 border-amber-500/60 ring-2 ring-amber-500/30\",\n          },\n          {\n            key: \"offline\" as const,\n            label: \"Offline\",\n            value: statusSummary.offline,\n            accent: \"bg-slate-500/10 border-slate-500/40\",\n            activeAccent:\n              \"bg-slate-500/20 border-slate-500/60 ring-2 ring-slate-500/30\",\n          },\n          {\n            key: \"requests\" as const,\n            label: \"Requests\",\n            value: requestsCount,\n            accent: \"bg-indigo-500/10 border-indigo-500/40\",\n            activeAccent:\n              \"bg-indigo-500/20 border-indigo-500/60 ring-2 ring-indigo-500/30\",\n          },\n        ].map((stat) => (\n          <button\n            key={stat.key}\n            type=\"button\"\n            onClick={() => {\n              setFilter(stat.key);\n              setSelectedFriend(null);\n            }}\n            className={`rounded-2xl border px-3 py-2 text-center cursor-pointer transition-all ${filter === stat.key ? stat.activeAccent : stat.accent} hover:scale-[1.02] active:scale-[0.98]`}\n          >\n            <div className=\"text-xs uppercase tracking-[0.3em] text-slate-400\">\n              {stat.label}\n            </div>\n            <div className=\"text-2xl font-semibold text-white\">\n              {stat.value}\n            </div>\n          </button>\n        ))}\n      </div>\n\n      {/* Main content: Friends list + Detail panel */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-3 mb-4\">\n        {/* Left column: Friends list (or requests) */}\n        <div\n          className={`${selectedFriend ? \"hidden lg:block\" : \"block\"} lg:col-span-2 space-y-3`}\n        >\n          {/* Friend Requests section (shows when filter is 'requests' or 'all') */}\n          {(filter === \"requests\" || filter === \"all\") && requestsCount > 0 && (\n            <div className=\"p-4 rounded-[28px] bg-gradient-to-br from-slate-900/80 to-indigo-900/60 border border-white/10 shadow-2xl\">\n              <div className=\"font-semibold text-white/90 mb-2\">\n                Friend Requests\n              </div>\n              <ul className=\"space-y-3\">\n                {incomingRequests.map((r) => (\n                  <li\n                    key={`incoming-${r.id || r.fromEmail}`}\n                    className=\"p-3 rounded-2xl border border-white/10 bg-slate-900/40 flex flex-col gap-3\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-semibold text-lg\">\n                        {r.fromUsername || r.fromEmail || \"Unknown User\"}\n                      </span>\n                      <span className=\"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded\">\n                        Incoming\n                      </span>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <button\n                        onClick={() => acceptFriend(r.id, r.fromEmail)}\n                        className=\"px-3 py-1 rounded-lg bg-emerald-500/20 text-emerald-400 text-xs font-bold hover:bg-emerald-500/30 transition-colors\"\n                      >\n                        Accept ‚úÖ\n                      </button>\n                      <button\n                        onClick={() => declineFriend(r.id)}\n                        className=\"px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 text-xs font-bold hover:bg-rose-500/30 transition-colors\"\n                      >\n                        Decline ‚ùå\n                      </button>\n                    </div>\n                  </li>\n                ))}\n                {outgoingRequestsResolved.map((r) => (\n                  <li\n                    key={`outgoing-${r.id || r.toEmail}`}\n                    className=\"p-3 rounded-2xl border border-white/10 bg-slate-900/40 flex flex-col gap-3\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-semibold text-lg\">\n                        {r.toUsername || r.toEmail || \"Unknown User\"}\n                      </span>\n                      <div className=\"px-3 py-1 rounded-lg bg-white/5 text-white/40 text-xs font-bold\">\n                        Pending ‚è≥\n                      </div>\n                    </div>\n                    <button\n                      onClick={() => cancelRequest(r.id)}\n                      className=\"px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 text-xs font-bold hover:bg-rose-500/30 transition-colors w-fit\"\n                    >\n                      Cancel ‚úñÔ∏è\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n\n          {/* Friends list section */}\n          {filter !== \"requests\" && (\n            <div className=\"p-4 rounded-[28px] bg-gradient-to-br from-slate-900/80 to-indigo-900/60 border border-white/10 shadow-2xl\">\n              <div className=\"font-semibold text-white/90 mb-3 flex items-center justify-between\">\n                <span>\n                  {filter === \"all\"\n                    ? \"All Friends\"\n                    : filter === \"online\"\n                      ? \"Online Friends\"\n                      : filter === \"ingame\"\n                        ? \"In-Game Friends\"\n                        : \"Offline Friends\"}{\" \"}\n                  ({filtered.length})\n                </span>\n              </div>\n              {filtered.length === 0 ? (\n                <div className=\"text-sm text-slate-400 py-6 text-center\">\n                  {friends.length === 0\n                    ? \"No friends yet. Search below to add some!\"\n                    : `No ${filter === \"all\" ? \"\" : filter + \" \"}friends right now.`}\n                </div>\n              ) : (\n                <ul className=\"space-y-2 max-h-[50vh] overflow-auto\">\n                  {filtered.map((f) => {\n                    const preview = threadPreviewByEmail.get(\n                      f.email.toLowerCase(),\n                    );\n                    const unread =\n                      unreadCountByEmail.get(f.email.toLowerCase()) || 0;\n                    const isSelected = selectedFriend?.email === f.email;\n                    return (\n                      <li key={f.email}>\n                        <button\n                          type=\"button\"\n                          onClick={() => openFriendDetail(f)}\n                          className={`w-full text-left p-3 rounded-2xl border transition-all cursor-pointer ${\n                            isSelected\n                              ? \"border-indigo-500/60 bg-indigo-500/15 ring-1 ring-indigo-500/30\"\n                              : \"border-white/10 bg-slate-900/40 hover:bg-slate-800/60 hover:border-white/20\"\n                          }`}\n                        >\n                          <div className=\"flex items-center gap-3\">\n                            {/* Avatar */}\n                            <div className=\"relative shrink-0\">\n                              {f.avatar ? (\n                                <img\n                                  src={f.avatar}\n                                  alt=\"\"\n                                  className=\"w-11 h-11 rounded-full object-cover border-2 border-white/20\"\n                                />\n                              ) : (\n                                <div className=\"w-11 h-11 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20\">\n                                  {(f.username ||\n                                    f.email ||\n                                    \"?\")[0].toUpperCase()}\n                                </div>\n                              )}\n                              <span\n                                className={`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${statusDot(f.status)}`}\n                              />\n                            </div>\n                            {/* Info */}\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"font-semibold text-white truncate\">\n                                  {f.username || f.email}\n                                </span>\n                                {unread > 0 && (\n                                  <span className=\"shrink-0 bg-indigo-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center\">\n                                    {unread > 9 ? \"9+\" : unread}\n                                  </span>\n                                )}\n                              </div>\n                              <div className=\"flex items-center gap-2 text-xs\">\n                                <span className={statusTextColor(f.status)}>\n                                  {statusLabel(f.status)}\n                                </span>\n                                {f.status === \"ingame\" && f.match && (\n                                  <>\n                                    <span className=\"text-slate-600\">‚Ä¢</span>\n                                    <span className=\"text-amber-300 truncate\">\n                                      {f.match.game}{\" \"}\n                                      {labelForMode(f.match.mode)}{\" \"}\n                                      {f.match.value}\n                                    </span>\n                                  </>\n                                )}\n                                {f.threeDartAvg ? (\n                                  <>\n                                    <span className=\"text-slate-600\">‚Ä¢</span>\n                                    <span className=\"text-indigo-300\">\n                                      3DA: {f.threeDartAvg.toFixed(1)}\n                                    </span>\n                                  </>\n                                ) : null}\n                              </div>\n                              {preview && (\n                                <div className=\"text-[11px] text-slate-400 mt-0.5 truncate\">\n                                  {preview.message}\n                                </div>\n                              )}\n                            </div>\n                            {/* Arrow */}\n                            <div className=\"text-slate-500 shrink-0\">‚Ä∫</div>\n                          </div>\n                        </button>\n                      </li>\n                    );\n                  })}\n                </ul>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Right column: Friend Detail Panel OR Messages placeholder */}\n        <div\n          className={`${selectedFriend ? \"block\" : \"hidden lg:block\"} lg:col-span-3`}\n        >\n          {selectedFriend ? (\n            <div className=\"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-2xl\">\n              {/* Back button (mobile) + friend header */}\n              <div className=\"flex items-center gap-3 mb-4\">\n                <button\n                  className=\"lg:hidden px-3 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/80 text-xs font-bold\"\n                  onClick={() => setSelectedFriend(null)}\n                >\n                  ‚Üê Back\n                </button>\n                <div className=\"relative shrink-0\">\n                  {friendAvatar || selectedFriend.avatar ? (\n                    <img\n                      src={friendAvatar || selectedFriend.avatar || \"\"}\n                      alt=\"\"\n                      className=\"w-14 h-14 rounded-full object-cover border-2 border-white/20\"\n                    />\n                  ) : (\n                    <div className=\"w-14 h-14 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg border-2 border-white/20\">\n                      {(selectedFriend.username ||\n                        selectedFriend.email ||\n                        \"?\")[0].toUpperCase()}\n                    </div>\n                  )}\n                  <span\n                    className={`absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-slate-950 ${statusDot(selectedFriend.status)}`}\n                  />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"font-bold text-lg text-white truncate\">\n                    {selectedFriend.username || selectedFriend.email}\n                  </div>\n                  <div\n                    className={`text-sm ${statusTextColor(selectedFriend.status)}`}\n                  >\n                    {statusLabel(selectedFriend.status)}\n                    {selectedFriend.status === \"ingame\" &&\n                      selectedFriend.match && (\n                        <span className=\"text-amber-300 ml-2\">\n                          ‚Äî {selectedFriend.match.game}{\" \"}\n                          {labelForMode(selectedFriend.match.mode)}{\" \"}\n                          {selectedFriend.match.value}\n                        </span>\n                      )}\n                    {selectedFriend.status === \"offline\" &&\n                    selectedFriend.lastSeen ? (\n                      <span className=\"text-slate-500 ml-2\">\n                        ‚Äî last seen {timeAgo(selectedFriend.lastSeen)}\n                      </span>\n                    ) : null}\n                  </div>\n                </div>\n              </div>\n\n              {/* Detail tabs */}\n              <div className=\"flex gap-1 mb-4 rounded-xl bg-white/5 p-1\">\n                {([\"profile\", \"chat\", \"compare\"] as const).map((tab) => (\n                  <button\n                    key={tab}\n                    type=\"button\"\n                    onClick={() => setDetailTab(tab)}\n                    className={`flex-1 py-2 rounded-lg text-sm font-semibold transition-colors ${\n                      detailTab === tab\n                        ? \"bg-indigo-600 text-white\"\n                        : \"text-slate-400 hover:text-white hover:bg-white/5\"\n                    }`}\n                  >\n                    {tab === \"profile\"\n                      ? \"Profile\"\n                      : tab === \"chat\"\n                        ? \"Chat üí¨\"\n                        : \"Compare üìä\"}\n                  </button>\n                ))}\n              </div>\n\n              {/* PROFILE TAB */}\n              {detailTab === \"profile\" && (\n                <div className=\"space-y-4\">\n                  {/* Quick stats */}\n                  <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\n                    <div className=\"bg-white/5 rounded-xl p-3 text-center\">\n                      <div className=\"text-lg font-bold text-indigo-300\">\n                        {selectedFriend.threeDartAvg\n                          ? selectedFriend.threeDartAvg.toFixed(1)\n                          : friendStats?.allTime\n                            ? friendStats.allTime.darts\n                              ? (\n                                  (friendStats.allTime.scored /\n                                    friendStats.allTime.darts) *\n                                  3\n                                ).toFixed(1)\n                              : \"‚Äî\"\n                            : \"‚Äî\"}\n                      </div>\n                      <div className=\"text-[10px] text-slate-400\">\n                        3-Dart Avg\n                      </div>\n                    </div>\n                    <div className=\"bg-white/5 rounded-xl p-3 text-center\">\n                      <div className=\"text-lg font-bold text-yellow-300\">\n                        {friendStats?.allTime?.num180s ?? \"‚Äî\"}\n                      </div>\n                      <div className=\"text-[10px] text-slate-400\">180s</div>\n                    </div>\n                    <div className=\"bg-white/5 rounded-xl p-3 text-center\">\n                      <div className=\"text-lg font-bold text-orange-300\">\n                        {friendStats?.allTime?.bestCheckout ?? \"‚Äî\"}\n                      </div>\n                      <div className=\"text-[10px] text-slate-400\">\n                        High Checkout\n                      </div>\n                    </div>\n                    <div className=\"bg-white/5 rounded-xl p-3 text-center\">\n                      <div className=\"text-lg font-bold text-rose-300\">\n                        {friendStats?.allTime?.bestLegDarts ?? \"‚Äî\"}\n                      </div>\n                      <div className=\"text-[10px] text-slate-400\">Best Leg</div>\n                    </div>\n                  </div>\n\n                  {/* Action buttons */}\n                  <div className=\"flex flex-wrap gap-2\">\n                    <button\n                      onClick={() => setDetailTab(\"chat\")}\n                      className=\"px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold transition-colors\"\n                    >\n                      üí¨ Message\n                    </button>\n                    {selectedFriend.status === \"ingame\" &&\n                      selectedFriend.roomId && (\n                        <button\n                          onClick={() => spectate(selectedFriend.roomId)}\n                          className=\"px-4 py-2 rounded-xl bg-amber-600 hover:bg-amber-500 text-white text-sm font-bold transition-colors\"\n                        >\n                          üëÅÔ∏è Spectate\n                        </button>\n                      )}\n                    <button\n                      onClick={() => setDetailTab(\"compare\")}\n                      className=\"px-4 py-2 rounded-xl bg-blue-600/80 hover:bg-blue-500 text-white text-sm font-bold transition-colors\"\n                    >\n                      üìä Compare Stats\n                    </button>\n                    <button\n                      onClick={() => {\n                        if (\n                          confirm(\n                            `Remove ${selectedFriend.username || selectedFriend.email} from friends?`,\n                          )\n                        ) {\n                          removeFriend(selectedFriend.email);\n                          setSelectedFriend(null);\n                        }\n                      }}\n                      className=\"px-4 py-2 rounded-xl bg-rose-500/20 hover:bg-rose-500/30 text-rose-400 text-sm font-bold transition-colors\"\n                    >\n                      ‚úñ Remove\n                    </button>\n                  </div>\n\n                  {/* Match info if in-game */}\n                  {selectedFriend.status === \"ingame\" &&\n                    selectedFriend.match && (\n                      <div className=\"rounded-xl border border-amber-500/30 bg-amber-500/10 p-3\">\n                        <div className=\"text-sm font-semibold text-amber-300 mb-1\">\n                          Currently Playing\n                        </div>\n                        <div className=\"text-white font-bold\">\n                          {selectedFriend.match.game}{\" \"}\n                          {labelForMode(selectedFriend.match.mode)}{\" \"}\n                          {selectedFriend.match.value}\n                        </div>\n                        {selectedFriend.roomId && (\n                          <button\n                            onClick={() => spectate(selectedFriend.roomId)}\n                            className=\"mt-2 px-4 py-1.5 rounded-lg bg-amber-600 hover:bg-amber-500 text-white text-xs font-bold transition-colors\"\n                          >\n                            Watch Live üëÅÔ∏è\n                          </button>\n                        )}\n                      </div>\n                    )}\n                </div>\n              )}\n\n              {/* CHAT TAB */}\n              {detailTab === \"chat\" && (\n                <div className=\"flex flex-col\">\n                  <div\n                    ref={chatScrollRef}\n                    className=\"flex-1 min-h-[260px] max-h-[55vh] overflow-auto rounded-2xl border border-white/10 bg-black/20 p-3\"\n                  >\n                    {activeThread.length === 0 ? (\n                      <div className=\"text-sm text-slate-400 p-3\">\n                        No messages yet. Say hi üëã\n                      </div>\n                    ) : (\n                      <ul className=\"space-y-2\">\n                        {activeThread.map((m) => {\n                          const isMine =\n                            String(m.from || \"\").toLowerCase() === email;\n                          return (\n                            <li\n                              key={m.id}\n                              className={isMine ? \"flex justify-end\" : \"flex\"}\n                            >\n                              <div\n                                className={\n                                  isMine\n                                    ? \"max-w-[95%] rounded-2xl bg-indigo-600/80 border border-indigo-300/20 px-3 py-2\"\n                                    : \"max-w-[95%] rounded-2xl bg-slate-900/60 border border-white/10 px-3 py-2\"\n                                }\n                              >\n                                <div className=\"text-[10px] text-slate-300/80 mb-1 flex items-center justify-between gap-2\">\n                                  <span className=\"font-bold\">\n                                    {isMine\n                                      ? \"You\"\n                                      : selectedFriend.username ||\n                                        selectedFriend.email}\n                                  </span>\n                                  <span className=\"shrink-0\">\n                                    {new Date(m.ts).toLocaleString()}\n                                  </span>\n                                </div>\n                                <div className=\"text-sm whitespace-pre-wrap break-words text-white/90\">\n                                  {censorProfanity(m.message)}\n                                </div>\n                                {!isMine && (\n                                  <div className=\"mt-2 flex gap-2\">\n                                    <button\n                                      onClick={() => msgs.remove(m.id)}\n                                      className=\"px-3 py-1 rounded-lg bg-rose-500/15 text-rose-300 text-[11px] font-bold hover:bg-rose-500/25 transition-colors\"\n                                    >\n                                      Delete üóëÔ∏è\n                                    </button>\n                                    <button\n                                      className=\"px-3 py-1 rounded-lg bg-rose-500/15 text-rose-300 text-[11px] font-bold hover:bg-rose-500/25 transition-colors\"\n                                      onClick={async () => {\n                                        const reason = prompt(\n                                          \"Report reason (what happened)?\",\n                                        );\n                                        if (!reason) return;\n                                        try {\n                                          await apiFetch(\n                                            \"/api/friends/report\",\n                                            {\n                                              method: \"POST\",\n                                              headers: {\n                                                \"Content-Type\":\n                                                  \"application/json\",\n                                              },\n                                              body: JSON.stringify({\n                                                reporterEmail: email,\n                                                offenderEmail: m.from,\n                                                reason,\n                                                messageId: m.id,\n                                              }),\n                                            },\n                                          );\n                                          toast(\"Report sent to admin\", {\n                                            type: \"info\",\n                                          });\n                                        } catch {}\n                                      }}\n                                    >\n                                      Report\n                                    </button>\n                                  </div>\n                                )}\n                              </div>\n                            </li>\n                          );\n                        })}\n                      </ul>\n                    )}\n                  </div>\n\n                  <div className=\"mt-3 rounded-2xl border border-white/10 bg-slate-900/30 p-3\">\n                    <div className=\"flex flex-col sm:flex-row gap-2\">\n                      <textarea\n                        className=\"w-full min-h-[44px] max-h-40 bg-slate-700/60 border border-slate-600 rounded-xl px-3 py-2 text-white placeholder-slate-400 resize-y\"\n                        placeholder={`Message ${selectedFriend.username || \"friend\"}...`}\n                        value={chatDraft}\n                        onChange={(e) => setChatDraft(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === \"Enter\" && !e.shiftKey) {\n                            e.preventDefault();\n                            sendChatMessage();\n                          }\n                        }}\n                      />\n                      <button\n                        onClick={sendChatMessage}\n                        className=\"px-5 py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-colors\"\n                      >\n                        Send\n                      </button>\n                    </div>\n                    <div className=\"mt-2 text-[11px] text-slate-400\">\n                      Tip: Press Enter to send, Shift+Enter for a new line.\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* COMPARE STATS TAB */}\n              {detailTab === \"compare\" && (\n                <div className=\"space-y-4\">\n                  <div className=\"text-sm text-slate-400 mb-2\">\n                    Head-to-head comparison between you and{\" \"}\n                    {selectedFriend.username || \"friend\"}\n                  </div>\n                  {(() => {\n                    const theirAvg = friendStats?.allTime?.darts\n                      ? (friendStats.allTime.scored /\n                          friendStats.allTime.darts) *\n                        3\n                      : selectedFriend.threeDartAvg || 0;\n                    const their180s = friendStats?.allTime?.num180s ?? 0;\n                    const theirCO = friendStats?.allTime?.bestCheckout ?? 0;\n                    const theirBestLeg =\n                      friendStats?.allTime?.bestLegDarts ?? 0;\n\n                    const rows = [\n                      {\n                        label: \"3-Dart Average\",\n                        mine: myAllTimeAvg,\n                        theirs: theirAvg,\n                        format: (v: number) => (v ? v.toFixed(1) : \"‚Äî\"),\n                        higher: true,\n                      },\n                      {\n                        label: \"180s\",\n                        mine: myAllTime.num180s || 0,\n                        theirs: their180s,\n                        format: (v: number) => String(v || \"‚Äî\"),\n                        higher: true,\n                      },\n                      {\n                        label: \"Highest Checkout\",\n                        mine: myAllTime.bestCheckout || 0,\n                        theirs: theirCO,\n                        format: (v: number) => String(v || \"‚Äî\"),\n                        higher: true,\n                      },\n                      {\n                        label: \"Best Leg (darts)\",\n                        mine: myAllTime.bestLegDarts || 0,\n                        theirs: theirBestLeg,\n                        format: (v: number) => String(v || \"‚Äî\"),\n                        higher: false,\n                      },\n                      {\n                        label: \"Games Played\",\n                        mine: myTotalGames,\n                        theirs: friendStats?.gameModes\n                          ? Object.values(\n                              friendStats.gameModes as Record<\n                                string,\n                                { played?: number }\n                              >,\n                            ).reduce((s: number, g) => s + (g.played || 0), 0)\n                          : 0,\n                        format: (v: number) => String(v || \"‚Äî\"),\n                        higher: true,\n                      },\n                      {\n                        label: \"Wins\",\n                        mine: myTotalWins,\n                        theirs: friendStats?.gameModes\n                          ? Object.values(\n                              friendStats.gameModes as Record<\n                                string,\n                                { won?: number }\n                              >,\n                            ).reduce((s: number, g) => s + (g.won || 0), 0)\n                          : 0,\n                        format: (v: number) => String(v || \"‚Äî\"),\n                        higher: true,\n                      },\n                    ];\n\n                    return (\n                      <div className=\"rounded-xl border border-white/10 overflow-hidden\">\n                        {/* Header */}\n                        <div className=\"grid grid-cols-3 bg-white/5 px-4 py-2 text-xs font-bold text-slate-400 uppercase tracking-wide\">\n                          <div>You</div>\n                          <div className=\"text-center\">Stat</div>\n                          <div className=\"text-right\">\n                            {selectedFriend.username || \"Friend\"}\n                          </div>\n                        </div>\n                        {rows.map((row) => {\n                          const myVal = Number(row.mine) || 0;\n                          const thVal = Number(row.theirs) || 0;\n                          const myWin = row.higher\n                            ? myVal > thVal\n                            : myVal > 0 && myVal < thVal;\n                          const thWin = row.higher\n                            ? thVal > myVal\n                            : thVal > 0 && thVal < myVal;\n                          return (\n                            <div\n                              key={row.label}\n                              className=\"grid grid-cols-3 px-4 py-3 border-t border-white/5 items-center\"\n                            >\n                              <div\n                                className={`font-bold text-sm ${myWin ? \"text-emerald-400\" : \"text-white\"}`}\n                              >\n                                {row.format(myVal)}\n                                {myWin && (\n                                  <span className=\"ml-1 text-[10px]\">üèÜ</span>\n                                )}\n                              </div>\n                              <div className=\"text-center text-xs text-slate-400 font-medium\">\n                                {row.label}\n                              </div>\n                              <div\n                                className={`text-right font-bold text-sm ${thWin ? \"text-emerald-400\" : \"text-white\"}`}\n                              >\n                                {row.format(thVal)}\n                                {thWin && (\n                                  <span className=\"ml-1 text-[10px]\">üèÜ</span>\n                                )}\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    );\n                  })()}\n\n                  {!friendStats && (\n                    <div className=\"text-center text-sm text-slate-500 py-3\">\n                      No stats available for{\" \"}\n                      {selectedFriend.username || \"this player\"} yet.\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          ) : (\n            /* No friend selected ‚Äî show placeholder */\n            <div className=\"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-2xl hidden lg:flex flex-col items-center justify-center min-h-[400px] text-center gap-3\">\n              <div className=\"text-4xl\">üëÜ</div>\n              <div className=\"text-lg font-semibold text-white/90\">\n                Select a friend\n              </div>\n              <div className=\"text-sm text-slate-400 max-w-sm\">\n                Click on a friend from the list to view their profile, send\n                messages, compare stats, or spectate their game.\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Find friends section */}\n      <div className=\"p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-xl\">\n        <div className=\"font-semibold mb-2 text-white/90\">Find Friends</div>\n        <input\n          className=\"input w-full mb-2\"\n          placeholder=\"Search by name or email\"\n          value={q}\n          onChange={(e) => search(e.target.value)}\n        />\n        <ul className=\"space-y-2 mb-3 max-h-[320px] overflow-auto\">\n          {results.map((r) => (\n            <li\n              key={r.email}\n              className=\"flex items-center gap-3 p-3 rounded-2xl border border-white/10 bg-slate-900/40\"\n            >\n              <div className=\"relative shrink-0\">\n                {r.avatar ? (\n                  <img\n                    src={r.avatar}\n                    alt=\"\"\n                    className=\"w-10 h-10 rounded-full object-cover border-2 border-white/20\"\n                  />\n                ) : (\n                  <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20\">\n                    {(r.username || r.email || \"?\")[0].toUpperCase()}\n                  </div>\n                )}\n                <span\n                  className={`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${statusDot(r.status)}`}\n                />\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"font-semibold text-white truncate\">\n                  {r.username || r.email}\n                </div>\n                <div className=\"text-xs text-slate-400 flex items-center gap-2\">\n                  <span>\n                    3DA:{\" \"}\n                    <span className=\"text-indigo-300 font-semibold\">\n                      {r.threeDartAvg ? r.threeDartAvg.toFixed(1) : \"‚Äî\"}\n                    </span>\n                  </span>\n                  <span className=\"text-slate-600\">‚Ä¢</span>\n                  <span className={statusTextColor(r.status)}>\n                    {statusLabel(r.status)}\n                  </span>\n                </div>\n              </div>\n              <div className=\"shrink-0\">\n                {r.relationship === \"friend\" ? (\n                  <span className=\"px-3 py-1.5 rounded-xl bg-emerald-500/20 text-emerald-400 text-xs font-bold\">\n                    Friends ‚úì\n                  </span>\n                ) : r.relationship === \"pending-outgoing\" ? (\n                  <span className=\"px-3 py-1.5 rounded-xl bg-white/5 text-white/40 text-xs font-bold\">\n                    Pending ‚è≥\n                  </span>\n                ) : r.relationship === \"pending-incoming\" ? (\n                  <button\n                    onClick={() => {\n                      const req = incomingRequests.find(\n                        (rq) =>\n                          rq.fromEmail.toLowerCase() === r.email.toLowerCase(),\n                      );\n                      if (req) acceptFriend(req.id, req.fromEmail);\n                    }}\n                    className=\"px-3 py-1.5 rounded-xl bg-emerald-500/20 text-emerald-400 text-xs font-bold hover:bg-emerald-500/30 transition-colors\"\n                  >\n                    Accept ‚úÖ\n                  </button>\n                ) : (\n                  <button\n                    onClick={() => addFriend(r.email)}\n                    disabled={loading}\n                    className={`px-3 py-1.5 rounded-xl text-white text-xs font-bold transition-colors ${loading ? \"bg-indigo-900/40 cursor-not-allowed\" : \"bg-indigo-600 hover:bg-indigo-500\"}`}\n                  >\n                    {loading ? \"Working‚Ä¶\" : \"Add ‚ûï\"}\n                  </button>\n                )}\n              </div>\n            </li>\n          ))}\n          {results.length === 0 && q && (\n            <li className=\"text-sm text-slate-400 text-center py-4\">\n              No accounts found for &quot;{q}&quot;\n            </li>\n          )}\n          {results.length === 0 && !q && (\n            <li className=\"text-xs opacity-60\">Type to search...</li>\n          )}\n        </ul>\n        <div className=\"font-semibold mb-1 text-white/90\">Suggested</div>\n        <ul className=\"space-y-2 max-h-[280px] overflow-auto\">\n          {suggested.map((s) => (\n            <li\n              key={s.email}\n              className=\"flex items-center gap-3 p-3 rounded-2xl border border-white/10 bg-slate-900/40\"\n            >\n              <div className=\"relative shrink-0\">\n                {s.avatar ? (\n                  <img\n                    src={s.avatar}\n                    alt=\"\"\n                    className=\"w-10 h-10 rounded-full object-cover border-2 border-white/20\"\n                  />\n                ) : (\n                  <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm border-2 border-white/20\">\n                    {(s.username || s.email || \"?\")[0].toUpperCase()}\n                  </div>\n                )}\n                <span\n                  className={`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-slate-900 ${statusDot(s.status)}`}\n                />\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"font-semibold text-white truncate\">\n                  {s.username || s.email}\n                </div>\n                <div className=\"text-xs text-slate-400 flex items-center gap-2\">\n                  <span>\n                    3DA:{\" \"}\n                    <span className=\"text-indigo-300 font-semibold\">\n                      {s.threeDartAvg ? s.threeDartAvg.toFixed(1) : \"‚Äî\"}\n                    </span>\n                  </span>\n                  <span className=\"text-slate-600\">‚Ä¢</span>\n                  <span className={statusTextColor(s.status)}>\n                    {statusLabel(s.status)}\n                  </span>\n                </div>\n              </div>\n              <button\n                onClick={() => addFriend(s.email)}\n                disabled={loading}\n                className={`shrink-0 px-3 py-1.5 rounded-xl text-white text-xs font-bold transition-colors ${loading ? \"bg-indigo-900/40 cursor-not-allowed\" : \"bg-indigo-600 hover:bg-indigo-500\"}`}\n              >\n                {loading ? \"Working‚Ä¶\" : \"Add ‚ûï\"}\n              </button>\n            </li>\n          ))}\n          {suggested.length === 0 && (\n            <li className=\"text-xs opacity-60\">No suggestions right now.</li>\n          )}\n        </ul>\n      </div>\n\n      {/* Message Popup (legacy) */}\n      {messagePopup.show && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n          <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4\">\n            <div className=\"text-center mb-4\">\n              <h3 className=\"text-lg font-semibold text-white\">\n                Send Message ‚úâÔ∏è\n              </h3>\n            </div>\n            {/* eslint-disable jsx-a11y/no-autofocus */}\n            <textarea\n              className=\"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none\"\n              placeholder=\"Type your message here...\"\n              id=\"message-input\"\n              autoFocus\n            />\n            {/* eslint-enable jsx-a11y/no-autofocus */}\n            <div className=\"flex gap-3 mt-4\">\n              <button\n                onClick={sendMessage}\n                className=\"px-6 py-2 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-colors\"\n              >\n                Send Message üì§\n              </button>\n              <button\n                className=\"btn bg-slate-600 hover:bg-slate-700\"\n                onClick={() => setMessagePopup({ show: false })}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["LS_INBOX","LS_UNREAD","LS_THREADS","loadInitial","raw","arr","unread","rawThreads","parsedThreads","m","save","inbox","threads","initial","useMessages","create","set","get","v","s","exists","x","list","sorted","a","b","other","key","next","id","patterns","starify","match","censorProfanity","input","out","re","timeAgo","ts","h","Friends","user","ws","useWS","toast","useToast","email","friends","setFriends","useState","suggested","setSuggested","results","setResults","q","setQ","filter","setFilter","loading","setLoading","msgs","activeChat","setActiveChat","chatDraft","setChatDraft","chatScrollRef","useRef","requests","setRequests","outgoingRequests","setOutgoingRequests","messagePopup","setMessagePopup","selectedFriend","setSelectedFriend","friendStats","setFriendStats","friendAvatar","setFriendAvatar","detailTab","setDetailTab","loadThread","useCallback","otherEmail","data","apiFetch","activeThread","useMemo","thread","threadPreviewByEmail","map","from","prev","unreadCountByEmail","recentMs","cutoff","refresh","fl","sg","rq","r","useEffect","cancelled","initialLoad","attempt","iv","unsub","d","el","search","term","uname","addFriend","target","removeFriend","acceptFriend","requestId","fromEmail","declineFriend","cancelRequest","sendMessage","message","sendChatMessage","now","filtered","f","statusSummary","summary","spectate","roomId","ev","incomingRequests","outgoingRequestsResolved","requestsCount","me","all","seen","unique","incoming","outgoing","myUsername","myAllTime","getAllTime","myAllTimeAvg","getAllTimeAvg","myGameModes","getGameModeStats","myTotalGames","g","myTotalWins","openFriendDetail","statusDot","status","statusLabel","statusTextColor","jsxs","jsx","stat","preview","isSelected","Fragment","labelForMode","tab","isMine","reason","theirAvg","their180s","theirCO","theirBestLeg","rows","row","myVal","thVal","myWin","thWin","req"],"mappings":"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"}
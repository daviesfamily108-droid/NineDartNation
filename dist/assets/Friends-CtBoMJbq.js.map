{"version":3,"file":"Friends-CtBoMJbq.js","sources":["../../src/store/messages.ts","../../src/utils/profanity.ts","../../src/components/Friends.tsx"],"sourcesContent":["import { create } from \"zustand\";\n\nexport type DM = {\n  id: string;\n  from: string;\n  message: string;\n  ts: number;\n  /** Populated for true threads (server /api/friends/thread). */\n  to?: string;\n  /** Legacy inbox read flag (server /api/friends/messages). */\n  read?: boolean;\n  /** True thread read tracking (server /api/friends/thread). */\n  readBy?: string[];\n};\n\nexport type DMThread = {\n  other: string;\n  messages: DM[];\n};\n\ntype MessagesState = {\n  inbox: DM[];\n  unread: number;\n  threads: Record<string, DMThread>;\n  inGame: boolean;\n  setInGame: (v: boolean) => void;\n  add: (m: DM) => void;\n  load: (arr: DM[]) => void;\n  loadThread: (other: string, arr: DM[]) => void;\n  markAllRead: () => void;\n  pushThread: (other: string, m: DM) => void;\n  remove: (id: string) => void;\n};\n\nconst LS_INBOX = \"ndn:messages:inbox\";\nconst LS_UNREAD = \"ndn:messages:unread\";\nconst LS_THREADS = \"ndn:messages:threads\";\n\nfunction loadInitial() {\n  try {\n    const raw = localStorage.getItem(LS_INBOX);\n    const arr = raw ? (JSON.parse(raw) as DM[]) : [];\n    const unread = Number(localStorage.getItem(LS_UNREAD) || \"0\") || 0;\n    const rawThreads = localStorage.getItem(LS_THREADS);\n    const parsedThreads = rawThreads\n      ? (JSON.parse(rawThreads) as Record<string, DMThread>)\n      : {};\n    // sanitize\n    const inbox = Array.isArray(arr)\n      ? arr.filter((m) => m && typeof m.id === \"string\").slice(0, 200)\n      : [];\n    const threads =\n      parsedThreads && typeof parsedThreads === \"object\" ? parsedThreads : {};\n    return { inbox, unread, threads };\n  } catch {\n    return { inbox: [], unread: 0, threads: {} };\n  }\n}\n\nfunction save(inbox: DM[], unread: number, threads?: Record<string, DMThread>) {\n  try {\n    localStorage.setItem(LS_INBOX, JSON.stringify(inbox));\n  } catch {}\n  try {\n    localStorage.setItem(LS_UNREAD, String(unread));\n  } catch {}\n  if (threads) {\n    try {\n      localStorage.setItem(LS_THREADS, JSON.stringify(threads));\n    } catch {}\n  }\n}\n\nconst initial = loadInitial();\n\nexport const useMessages = create<MessagesState>((set, get) => ({\n  inbox: initial.inbox,\n  unread: initial.unread,\n  threads: initial.threads,\n  inGame: false,\n  setInGame: (v) => set({ inGame: v }),\n  add: (m) =>\n    set((s) => {\n      const exists = s.inbox.some((x) => x.id === m.id && x.ts === m.ts);\n      const list = exists ? s.inbox : [m, ...s.inbox].slice(0, 200);\n      const unread = s.unread + (exists ? 0 : 1);\n      save(list, unread, s.threads);\n      return { inbox: list, unread };\n    }),\n  load: (arr) =>\n    set((s) => {\n      const sorted = [...arr].sort((a, b) => b.ts - a.ts).slice(0, 200);\n      save(sorted, s.unread, s.threads);\n      return { inbox: sorted, unread: s.unread };\n    }),\n  loadThread: (other, arr) =>\n    set((s) => {\n      const key = String(other || \"\").toLowerCase();\n      if (!key) return s;\n      const sorted = [...arr].sort((a, b) => a.ts - b.ts).slice(-400);\n      const threads = {\n        ...s.threads,\n        [key]: { other: key, messages: sorted },\n      };\n      save(s.inbox, s.unread, threads);\n      return { threads };\n    }),\n  markAllRead: () => {\n    const s = get();\n    save(s.inbox, 0, s.threads);\n    set({ unread: 0 });\n  },\n  pushThread: (other, m) =>\n    set((s) => {\n      const key = String(other || \"\").toLowerCase();\n      if (!key) return s;\n      const existing = s.threads[key]?.messages || [];\n      const next = [...existing, m].sort((a, b) => a.ts - b.ts).slice(-400);\n      const threads = {\n        ...s.threads,\n        [key]: { other: key, messages: next },\n      };\n      save(s.inbox, s.unread, threads);\n      return { threads };\n    }),\n  remove: (id) =>\n    set((s) => {\n      const list = s.inbox.filter((m) => m.id !== id);\n      const unread = s.unread; // keep unread count stable on deletion from history\n      save(list, unread, s.threads);\n      return { inbox: list, unread };\n    }),\n}));\n","// Simple profanity filter: replaces detected profane words with asterisks of the same length.\n// Note: This is a lightweight heuristic and not exhaustive.\n\nconst patterns: RegExp[] = [\n  /\\b(f+[\\W_]*u+[\\W_]*c+[\\W_]*k+)\\b/gi,\n  /\\b(s+[\\W_]*h+[\\W_]*i+[\\W_]*t+)\\b/gi,\n  /\\b(b+[\\W_]*i+[\\W_]*t+[\\W_]*c+[\\W_]*h+)\\b/gi,\n  /\\b(a+[\\W_]*s+[\\W_]*s+[\\W_]*h+[\\W_]*o+[\\W_]*l+[\\W_]*e+)\\b/gi,\n  /\\b(d+[\\W_]*a+[\\W_]*m+[\\W_]*n+)\\b/gi,\n  /\\b(c+[\\W_]*r+[\\W_]*a+[\\W_]*p+)\\b/gi,\n  /\\b(p+[\\W_]*i+[\\W_]*s+[\\W_]*s+)\\b/gi,\n];\n\nfunction starify(match: string) {\n  // Preserve whitespace/punct positions; just replace letters/numbers with *\n  return match.replace(/[\\p{L}\\p{N}]/gu, \"*\");\n}\n\nexport function censorProfanity(input: string): string {\n  if (!input) return input;\n  let out = input;\n  for (const re of patterns) {\n    out = out.replace(re, (m) => starify(m));\n  }\n  return out;\n}\n\nexport function containsProfanity(input: string): boolean {\n  if (!input) return false;\n  return patterns.some((re) => re.test(input));\n}\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useToast } from \"../store/toast.js\";\nimport { useMessages } from \"../store/messages.js\";\nimport { censorProfanity } from \"../utils/profanity.js\";\nimport TabPills from \"./ui/TabPills.js\";\nimport { labelForMode } from \"../utils/games.js\";\n\ntype Friend = {\n  email: string;\n  username?: string;\n  status?: \"online\" | \"offline\" | \"ingame\";\n  lastSeen?: number;\n  roomId?: string | null;\n  match?: {\n    game: string;\n    mode: string;\n    value: number;\n    startingScore?: number;\n  } | null;\n};\n\nfunction timeAgo(ts?: number) {\n  if (!ts) return \"\";\n  const s = Math.floor((Date.now() - ts) / 1000);\n  if (s < 60) return `${s}s ago`;\n  const m = Math.floor(s / 60);\n  if (m < 60) return `${m}m ago`;\n  const h = Math.floor(m / 60);\n  if (h < 24) return `${h}h ago`;\n  const d = Math.floor(h / 24);\n  return `${d}d ago`;\n}\n\nexport default function Friends({ user }: { user?: any }) {\n  const toast = useToast();\n  const email = String(user?.email || \"\").toLowerCase();\n  const [friends, setFriends] = useState<Friend[]>([]);\n  const [suggested, setSuggested] = useState<Friend[]>([]);\n  const [results, setResults] = useState<Friend[]>([]);\n  const [q, setQ] = useState(\"\");\n  const [filter, setFilter] = useState<\n    \"all\" | \"online\" | \"offline\" | \"ingame\" | \"requests\"\n  >(\"all\");\n  const [loading, setLoading] = useState(false);\n  const msgs = useMessages();\n  const [activeChat, setActiveChat] = useState<{\n    email: string;\n    username?: string;\n  } | null>(null);\n  const [chatDraft, setChatDraft] = useState(\"\");\n  const chatScrollRef = useRef<HTMLDivElement | null>(null);\n  const [requests, setRequests] = useState<\n    Array<{\n      id: string;\n      fromEmail: string;\n      fromUsername: string;\n      toEmail: string;\n      toUsername: string;\n      requestedAt: number;\n    }>\n  >([]);\n  const [outgoingRequests, setOutgoingRequests] = useState<\n    Array<{\n      id: string;\n      fromEmail: string;\n      fromUsername: string;\n      toEmail: string;\n      toUsername: string;\n      requestedAt: number;\n    }>\n  >([]);\n  const [messagePopup, setMessagePopup] = useState<{\n    show: boolean;\n    toUser?: string;\n    toEmail?: string;\n    replyTo?: string;\n  }>({ show: false });\n\n  const [statusPopup, setStatusPopup] = useState<{\n    show: boolean;\n    filter: \"online\" | \"offline\" | \"ingame\";\n  } | null>(null);\n  const [friendActionPopup, setFriendActionPopup] = useState<{\n    show: boolean;\n    friend: Friend;\n  } | null>(null);\n\n  const loadThread = useCallback(\n    async (otherEmail: string) => {\n      const other = String(otherEmail || \"\").toLowerCase();\n      if (!email || !other || other === email) return;\n      try {\n        const res = await fetch(\n          `/api/friends/thread?email=${encodeURIComponent(email)}&other=${encodeURIComponent(other)}`,\n        );\n        const data = await res.json();\n        if (data?.ok && Array.isArray(data.thread)) {\n          msgs.loadThread(other, data.thread);\n        }\n      } catch {\n        // ignore\n      }\n    },\n    [email, msgs],\n  );\n\n  const activeThread = useMemo(() => {\n    if (!activeChat?.email) return [];\n    const other = activeChat.email.toLowerCase();\n    const thread = msgs.threads?.[other]?.messages;\n    if (Array.isArray(thread) && thread.length) return thread;\n    // Fallback: Backend may still only return inbound messages.\n    return msgs.inbox\n      .filter((m: any) => String(m.from || \"\").toLowerCase() === other)\n      .slice()\n      .sort((a: any, b: any) => a.ts - b.ts);\n  }, [activeChat?.email, msgs.inbox, msgs.threads]);\n\n  const threadPreviewByEmail = useMemo(() => {\n    const map = new Map<string, { ts: number; message: string }>();\n    for (const m of msgs.inbox) {\n      const from = String(m.from || \"\").toLowerCase();\n      const prev = map.get(from);\n      if (!prev || m.ts > prev.ts)\n        map.set(from, { ts: m.ts, message: m.message });\n    }\n    return map;\n  }, [msgs.inbox]);\n\n  const unreadCountByEmail = useMemo(() => {\n    // Message store only tracks a global unread count; approximate per-friend\n    // by counting recent messages (purely a UI hint).\n    const map = new Map<string, number>();\n    const recentMs = 1000 * 60 * 60 * 24 * 3; // last 3 days\n    const cutoff = Date.now() - recentMs;\n    for (const m of msgs.inbox) {\n      if ((m.ts || 0) < cutoff) continue;\n      const from = String(m.from || \"\").toLowerCase();\n      map.set(from, (map.get(from) || 0) + 1);\n    }\n    return map;\n  }, [msgs.inbox]);\n\n  async function refresh() {\n    if (!email) return;\n    try {\n      const [fl, sg, rq, out] = await Promise.all([\n        fetch(`/api/friends/list?email=${encodeURIComponent(email)}`).then(\n          (r) => r.json(),\n        ),\n        fetch(`/api/friends/suggested?email=${encodeURIComponent(email)}`).then(\n          (r) => r.json(),\n        ),\n        fetch(`/api/friends/requests?email=${encodeURIComponent(email)}`).then(\n          (r) => r.json(),\n        ),\n        fetch(`/api/friends/outgoing?email=${encodeURIComponent(email)}`).then(\n          (r) => r.json(),\n        ),\n      ]);\n      setFriends(fl.friends || []);\n      setSuggested(sg.suggestions || []);\n      setRequests(rq.requests || []);\n      setOutgoingRequests(out.requests || []);\n    } catch {}\n  }\n\n  useEffect(() => {\n    refresh();\n  }, [email]);\n\n  // Load inbox on mount/user change.\n  useEffect(() => {\n    if (!email) return;\n    fetch(`/api/friends/messages?email=${encodeURIComponent(email)}`)\n      .then((r) => r.json())\n      .then((d) => {\n        if (d?.ok && Array.isArray(d.messages)) msgs.load(d.messages);\n      })\n      .catch(() => {});\n  }, [email]);\n\n  // Load real 2-way thread whenever we open/switch chats.\n  useEffect(() => {\n    if (!activeChat?.email) return;\n    void loadThread(activeChat.email);\n  }, [activeChat?.email, loadThread]);\n\n  // Keep thread scrolled to bottom when opening or receiving new messages.\n  useEffect(() => {\n    if (!activeChat) return;\n    const el = chatScrollRef.current;\n    if (!el) return;\n    el.scrollTop = el.scrollHeight;\n  }, [activeChat?.email, activeThread.length]);\n\n  async function search(term: string) {\n    setQ(term);\n    if (!term) {\n      setResults([]);\n      return;\n    }\n    try {\n      const res = await fetch(\n        `/api/friends/search?q=${encodeURIComponent(term)}`,\n      );\n      const data = await res.json();\n      setResults(data.results || []);\n    } catch {}\n  }\n\n  async function addFriend(target: string) {\n    if (!email || !target) return;\n    setLoading(true);\n    try {\n      await fetch(\"/api/friends/add\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, friend: target }),\n      });\n      await refresh();\n      setQ(\"\");\n      setResults([]);\n      toast(\"Friend added\", { type: \"success\" });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function removeFriend(target: string) {\n    if (!email || !target) return;\n    setLoading(true);\n    try {\n      await fetch(\"/api/friends/remove\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, friend: target }),\n      });\n      await refresh();\n      toast(\"Friend removed\", { type: \"info\" });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function acceptFriend(requestId: string) {\n    try {\n      await fetch(\"/api/friends/accept\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, requestId }),\n      });\n      await refresh();\n      toast(\"Friend request accepted\", { type: \"success\" });\n    } catch {}\n  }\n\n  async function declineFriend(requestId: string) {\n    try {\n      await fetch(\"/api/friends/decline\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, requestId }),\n      });\n      await refresh();\n      toast(\"Friend request declined\", { type: \"info\" });\n    } catch {}\n  }\n\n  async function cancelRequest(requestId: string) {\n    try {\n      await fetch(\"/api/friends/cancel\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, requestId }),\n      });\n      await refresh();\n      toast(\"Friend request cancelled\", { type: \"info\" });\n    } catch {}\n  }\n\n  async function sendMessage() {\n    const input = document.getElementById(\n      \"message-input\",\n    ) as HTMLTextAreaElement;\n    const message = input?.value;\n    if (!message || !messagePopup.toEmail) return;\n    try {\n      await fetch(\"/api/friends/message\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          fromEmail: email,\n          toEmail: messagePopup.toEmail,\n          message,\n        }),\n      });\n      setMessagePopup({ show: false });\n      toast(\"Message sent\", { type: \"success\" });\n    } catch {}\n  }\n\n  async function sendChatMessage() {\n    if (!email || !activeChat?.email) return;\n    const message = chatDraft.trim();\n    if (!message) return;\n    try {\n      await fetch(\"/api/friends/message\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          fromEmail: email,\n          toEmail: activeChat.email,\n          message,\n        }),\n      });\n\n      // Optimistically append to the active thread.\n      const now = Date.now();\n      const id = `${now}-${Math.random().toString(36).slice(2, 8)}`;\n      msgs.pushThread(activeChat.email, {\n        id,\n        from: email,\n        to: String(activeChat.email).toLowerCase(),\n        message,\n        ts: now,\n        readBy: [email],\n      });\n\n      setChatDraft(\"\");\n      toast(\"Message sent\", { type: \"success\" });\n    } catch {\n      toast(\"Failed to send message\", { type: \"error\" });\n    }\n  }\n\n  const filtered = useMemo(() => {\n    if (filter === \"all\") return friends;\n    return friends.filter((f) => (f.status || \"offline\") === filter);\n  }, [friends, filter]);\n\n  const statusSummary = useMemo(() => {\n    const summary = { online: 0, ingame: 0, offline: 0 };\n    for (const f of friends) {\n      if (f.status === \"online\") summary.online += 1;\n      else if (f.status === \"ingame\") summary.ingame += 1;\n      else summary.offline += 1;\n    }\n    return summary;\n  }, [friends]);\n\n  const friendsByStatus = useMemo(() => {\n    const online = friends.filter((f) => (f.status || \"offline\") === \"online\");\n    const offline = friends.filter(\n      (f) => (f.status || \"offline\") === \"offline\",\n    );\n    const ingame = friends.filter((f) => (f.status || \"offline\") === \"ingame\");\n    return { online, offline, ingame };\n  }, [friends]);\n\n  async function spectate(roomId?: string | null) {\n    if (!roomId) {\n      toast(\"Room unavailable\", { type: \"error\" });\n      return;\n    }\n    try {\n      const ev = new CustomEvent(\"ndn:spectate-request\", {\n        detail: { roomId },\n      });\n      window.dispatchEvent(ev);\n      toast(\"Opening spectator view...\", { type: \"info\" });\n    } catch {}\n  }\n\n  // Friend Requests pill: use real requests data\n  const requestsCount = requests.length + outgoingRequests.length;\n  return (\n    <div className=\"card ndn-game-shell ndn-page\">\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2 ndn-section-title\">\n        Friends üë•\n      </h2>\n      <p className=\"mb-2 text-brand-600\">\n        Manage your friends. See who's online, in-game, or offline; find new\n        teammates; and invite people to play.\n      </p>\n      <div className=\"grid gap-3 mb-4 grid-cols-2 sm:grid-cols-4\">\n        {[\n          {\n            label: \"Online\",\n            value: statusSummary.online,\n            accent: \"bg-emerald-500/10 border-emerald-500/40\",\n          },\n          {\n            label: \"In-Game\",\n            value: statusSummary.ingame,\n            accent: \"bg-amber-500/10 border-amber-500/40\",\n          },\n          {\n            label: \"Offline\",\n            value: statusSummary.offline,\n            accent: \"bg-slate-500/10 border-slate-500/40\",\n          },\n          {\n            label: \"Requests\",\n            value: requestsCount,\n            accent: \"bg-indigo-500/10 border-indigo-500/40\",\n          },\n        ].map((stat) => (\n          <div\n            key={stat.label}\n            className={`rounded-2xl border px-3 py-2 text-center ${stat.accent} ${stat.label !== \"Requests\" ? \"cursor-pointer hover:brightness-110\" : \"\"}`}\n            role={stat.label !== \"Requests\" ? \"button\" : undefined}\n            tabIndex={stat.label !== \"Requests\" ? 0 : undefined}\n            onClick={() => {\n              if (stat.label === \"Online\")\n                setStatusPopup({ show: true, filter: \"online\" });\n              else if (stat.label === \"Offline\")\n                setStatusPopup({ show: true, filter: \"offline\" });\n              else if (stat.label === \"In-Game\")\n                setStatusPopup({ show: true, filter: \"ingame\" });\n            }}\n            onKeyDown={(e) => {\n              if (e.key !== \"Enter\" && e.key !== \" \") return;\n              if (stat.label === \"Online\")\n                setStatusPopup({ show: true, filter: \"online\" });\n              else if (stat.label === \"Offline\")\n                setStatusPopup({ show: true, filter: \"offline\" });\n              else if (stat.label === \"In-Game\")\n                setStatusPopup({ show: true, filter: \"ingame\" });\n            }}\n          >\n            <div className=\"text-xs uppercase tracking-[0.3em] text-slate-400\">\n              {stat.label}\n            </div>\n            <div className=\"text-2xl font-semibold text-white\">\n              {stat.value}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {statusPopup?.show && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\"\n          onMouseDown={(e) => {\n            if (e.target === e.currentTarget) setStatusPopup(null);\n          }}\n        >\n          <div className=\"w-full max-w-lg rounded-2xl border border-white/10 bg-slate-950/90 p-4 shadow-2xl\">\n            <div className=\"mb-3 flex items-start justify-between gap-3\">\n              <div>\n                <div className=\"text-xs uppercase tracking-[0.3em] text-slate-400\">\n                  {statusPopup.filter === \"online\"\n                    ? \"Online friends\"\n                    : statusPopup.filter === \"offline\"\n                      ? \"Offline friends\"\n                      : \"In-game friends\"}\n                </div>\n                <div className=\"text-sm text-white/80\">\n                  Tap a friend to see actions.\n                </div>\n              </div>\n              <button\n                className=\"btn btn--ghost px-3 py-1 text-xs\"\n                onClick={() => setStatusPopup(null)}\n              >\n                Close\n              </button>\n            </div>\n\n            <ul className=\"space-y-2 max-h-[60vh] overflow-auto pr-1\">\n              {(\n                statusPopup.filter === \"online\"\n                  ? friendsByStatus.online\n                  : statusPopup.filter === \"offline\"\n                    ? friendsByStatus.offline\n                    : friendsByStatus.ingame\n              ).map((f) => (\n                <li key={`${statusPopup.filter}-${f.email}`}>\n                  <button\n                    className=\"w-full text-left p-3 rounded-2xl border border-white/10 bg-slate-900/40 hover:bg-slate-900/60 transition\"\n                    onClick={() => setFriendActionPopup({ show: true, friend: f })}\n                  >\n                    <div className=\"flex items-center justify-between gap-3\">\n                      <div className=\"min-w-0\">\n                        <div className=\"font-semibold text-white truncate\">\n                          {f.username || f.email}\n                        </div>\n                        <div className=\"text-xs text-slate-400 truncate\">\n                          {f.email}\n                        </div>\n                      </div>\n                      <div className=\"shrink-0 text-[11px] text-slate-300/80\">\n                        {(f.status || \"offline\") === \"online\"\n                          ? \"Online\"\n                          : (f.status || \"offline\") === \"ingame\"\n                            ? \"In-Game\"\n                            : f.lastSeen\n                              ? `Last seen ${timeAgo(f.lastSeen)}`\n                              : \"Offline\"}\n                      </div>\n                    </div>\n                    {f.status === \"ingame\" && f.match && (\n                      <div className=\"mt-2 text-[11px] text-slate-300/70\">\n                        {labelForMode(f.match.mode)} ¬∑ {f.match.game} ¬∑ {f.match.value}\n                      </div>\n                    )}\n                  </button>\n                </li>\n              ))}\n              {(statusPopup.filter === \"online\" &&\n                friendsByStatus.online.length === 0) ||\n              (statusPopup.filter === \"offline\" &&\n                friendsByStatus.offline.length === 0) ||\n              (statusPopup.filter === \"ingame\" &&\n                friendsByStatus.ingame.length === 0) ? (\n                <li className=\"text-xs text-slate-400 p-3\">\n                  No friends in this category.\n                </li>\n              ) : null}\n            </ul>\n          </div>\n        </div>\n      )}\n\n      {friendActionPopup?.show && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4\"\n          onMouseDown={(e) => {\n            if (e.target === e.currentTarget) setFriendActionPopup(null);\n          }}\n        >\n          <div className=\"w-full max-w-sm rounded-2xl border border-white/10 bg-slate-950/95 p-4 shadow-2xl\">\n            <div className=\"mb-3\">\n              <div className=\"font-semibold text-white\">\n                {friendActionPopup.friend.username || friendActionPopup.friend.email}\n              </div>\n              <div className=\"text-xs text-slate-400\">\n                {friendActionPopup.friend.email}\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              {friendActionPopup.friend.status === \"ingame\" && (\n                <button\n                  className=\"w-full btn px-3 py-2 justify-start\"\n                  onClick={() => {\n                    const roomId = friendActionPopup.friend.roomId;\n                    setFriendActionPopup(null);\n                    spectate(roomId);\n                  }}\n                >\n                  Spectate game\n                </button>\n              )}\n\n              <button\n                className=\"w-full btn px-3 py-2 justify-start\"\n                onClick={() => {\n                  const friend = friendActionPopup.friend;\n                  setFriendActionPopup(null);\n                  setStatusPopup(null);\n                  setActiveChat({ email: friend.email, username: friend.username });\n                }}\n              >\n                Message\n              </button>\n\n              {friendActionPopup.friend.status !== \"ingame\" && (\n                <>\n                  <button\n                    className=\"w-full btn btn--ghost px-3 py-2 justify-start\"\n                    onClick={() => {\n                      toast(\"Compare is not wired yet\", { type: \"info\" });\n                      setFriendActionPopup(null);\n                    }}\n                  >\n                    Compare\n                  </button>\n\n                  <button\n                    className=\"w-full btn btn--ghost px-3 py-2 justify-start text-rose-300\"\n                    onClick={async () => {\n                      const friend = friendActionPopup.friend;\n                      const ok = confirm(\n                        `Remove ${friend.username || friend.email} from your friends?`,\n                      );\n                      if (!ok) return;\n                      setFriendActionPopup(null);\n                      setStatusPopup(null);\n                      await removeFriend(friend.email);\n                    }}\n                  >\n                    Delete friend\n                  </button>\n                </>\n              )}\n            </div>\n\n            <div className=\"mt-3 flex justify-end\">\n              <button\n                className=\"btn btn--ghost px-3 py-1 text-xs\"\n                onClick={() => setFriendActionPopup(null)}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-3 mb-4\">\n        {/* Friends (master list) */}\n        <div\n          className={`${activeChat ? \"hidden lg:block\" : \"block\"} lg:col-span-2 p-4 rounded-[28px] bg-gradient-to-br from-slate-900/80 to-indigo-900/60 border border-white/10 shadow-2xl`}\n        >\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"font-semibold text-white/90\">Friend Requests</div>\n          </div>\n          <ul className=\"space-y-3 mt-3\">\n            {requestsCount > 0 ? (\n              <>\n                {/* Incoming requests */}\n                {requests.length > 0 &&\n                  requests.map((r) => (\n                    <li\n                      key={`incoming-${r.id || r.fromEmail}`}\n                      className=\"p-3 rounded-2xl border border-white/10 bg-slate-900/40 flex flex-col gap-3\"\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-semibold text-lg\">\n                          {r.fromUsername || r.fromEmail || \"Unknown User\"}\n                        </span>\n                        <span className=\"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded\">\n                          Incoming\n                        </span>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={() => acceptFriend(r.id)}\n                          className=\"px-3 py-1 rounded-lg bg-emerald-500/20 text-emerald-400 text-xs font-bold hover:bg-emerald-500/30 transition-colors\"\n                        >\n                          Accept ‚úÖ\n                        </button>\n                        <button\n                          onClick={() => declineFriend(r.id)}\n                          className=\"px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 text-xs font-bold hover:bg-rose-500/30 transition-colors\"\n                        >\n                          Decline ‚ùå\n                        </button>\n                      </div>\n                    </li>\n                  ))}\n                {/* Outgoing requests */}\n                {outgoingRequests.length > 0 &&\n                  outgoingRequests.map((r) => (\n                    <li\n                      key={`outgoing-${r.id || r.toEmail}`}\n                      className=\"p-3 rounded-2xl border border-white/10 bg-slate-900/40 flex flex-col gap-3\"\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-semibold text-lg\">\n                          {r.toUsername || r.toEmail || \"Unknown User\"}\n                        </span>\n                        <div className=\"px-3 py-1 rounded-lg bg-white/5 text-white/40 text-xs font-bold\">\n                          Pending ‚è≥\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => cancelRequest(r.id)}\n                        className=\"px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 text-xs font-bold hover:bg-rose-500/30 transition-colors\"\n                      >\n                        Cancel ‚úñÔ∏è\n                      </button>\n                    </li>\n                  ))}\n              </>\n            ) : (\n              <li className=\"text-sm opacity-70\">No friend requests yet.</li>\n            )}\n          </ul>\n        </div>\n\n        {/* Messages (detail / thread) */}\n        <div\n          className={`${activeChat ? \"block\" : \"hidden lg:block\"} lg:col-span-3 p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-2xl`}\n        >\n          {!activeChat ? (\n            <div className=\"h-full min-h-[240px] flex flex-col items-center justify-center text-center gap-2\">\n              <div className=\"text-lg font-semibold text-white/90\">\n                Messages üí¨\n              </div>\n              <div className=\"text-sm text-slate-400 max-w-sm\">\n                Pick a friend to see your conversation. New messages will show\n                up here.\n              </div>\n              {msgs.inbox.length > 0 && (\n                <button\n                  onClick={() => msgs.markAllRead()}\n                  className=\"mt-2 text-xs text-indigo-400 font-bold hover:text-indigo-300 transition-colors\"\n                >\n                  Mark all read ‚úÖ\n                </button>\n              )}\n            </div>\n          ) : (\n            <div className=\"flex flex-col h-full\">\n              <div className=\"flex items-center justify-between gap-2 mb-3\">\n                <div className=\"flex items-center gap-2 min-w-0\">\n                  <button\n                    className=\"lg:hidden px-3 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/80 text-xs font-bold\"\n                    onClick={() => setActiveChat(null)}\n                  >\n                    ‚Üê Back\n                  </button>\n                  <div className=\"min-w-0\">\n                    <div className=\"font-semibold text-white truncate\">\n                      {activeChat.username || activeChat.email}\n                    </div>\n                    <div className=\"text-xs text-slate-400 truncate\">\n                      {activeChat.email}\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    onClick={() => msgs.markAllRead()}\n                    className=\"text-xs text-indigo-400 font-bold hover:text-indigo-300 transition-colors\"\n                    title=\"This clears the global unread counter\"\n                  >\n                    Mark all read ‚úÖ\n                  </button>\n                </div>\n              </div>\n\n              <div\n                ref={chatScrollRef}\n                className=\"flex-1 min-h-[260px] max-h-[55vh] overflow-auto rounded-2xl border border-white/10 bg-black/20 p-3\"\n              >\n                {activeThread.length === 0 ? (\n                  <div className=\"text-sm text-slate-400 p-3\">\n                    No messages from this friend yet. Say hi üëã\n                  </div>\n                ) : (\n                  <ul className=\"space-y-2\">\n                    {activeThread.map((m) => {\n                      const isMine =\n                        String(m.from || \"\").toLowerCase() === email;\n                      return (\n                        <li\n                          key={m.id}\n                          className={isMine ? \"flex justify-end\" : \"flex\"}\n                        >\n                          <div\n                            className={\n                              isMine\n                                ? \"max-w-[95%] rounded-2xl bg-indigo-600/80 border border-indigo-300/20 px-3 py-2\"\n                                : \"max-w-[95%] rounded-2xl bg-slate-900/60 border border-white/10 px-3 py-2\"\n                            }\n                          >\n                            <div className=\"text-[10px] text-slate-300/80 mb-1 flex items-center justify-between gap-2\">\n                              <span className=\"font-bold\">\n                                {isMine\n                                  ? \"You\"\n                                  : activeChat.username || activeChat.email}\n                              </span>\n                              <span className=\"shrink-0\">\n                                {new Date(m.ts).toLocaleString()}\n                              </span>\n                            </div>\n                            <div className=\"text-sm whitespace-pre-wrap break-words text-white/90\">\n                              {censorProfanity(m.message)}\n                            </div>\n                            {!isMine && (\n                              <div className=\"mt-2 flex gap-2\">\n                                <button\n                                  onClick={() => msgs.remove(m.id)}\n                                  className=\"px-3 py-1 rounded-lg bg-rose-500/15 text-rose-300 text-[11px] font-bold hover:bg-rose-500/25 transition-colors\"\n                                >\n                                  Delete üóëÔ∏è\n                                </button>\n                                <button\n                                  className=\"px-3 py-1 rounded-lg bg-rose-500/15 text-rose-300 text-[11px] font-bold hover:bg-rose-500/25 transition-colors\"\n                                  onClick={async () => {\n                                    const reason = prompt(\n                                      \"Report reason (what happened)?\",\n                                    );\n                                    if (!reason) return;\n                                    try {\n                                      await fetch(\"/api/friends/report\", {\n                                        method: \"POST\",\n                                        headers: {\n                                          \"Content-Type\": \"application/json\",\n                                        },\n                                        body: JSON.stringify({\n                                          reporterEmail: email,\n                                          offenderEmail: m.from,\n                                          reason,\n                                          messageId: m.id,\n                                        }),\n                                      });\n                                      toast(\"Report sent to admin\", {\n                                        type: \"info\",\n                                      });\n                                    } catch {}\n                                  }}\n                                >\n                                  Report\n                                </button>\n                              </div>\n                            )}\n                          </div>\n                        </li>\n                      );\n                    })}\n                  </ul>\n                )}\n              </div>\n\n              <div className=\"mt-3 rounded-2xl border border-white/10 bg-slate-900/30 p-3\">\n                <div className=\"flex flex-col sm:flex-row gap-2\">\n                  <textarea\n                    className=\"w-full min-h-[44px] max-h-40 bg-slate-700/60 border border-slate-600 rounded-xl px-3 py-2 text-white placeholder-slate-400 resize-y\"\n                    placeholder={`Message ${activeChat.username || \"friend\"}...`}\n                    value={chatDraft}\n                    onChange={(e) => setChatDraft(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\" && !e.shiftKey) {\n                        e.preventDefault();\n                        sendChatMessage();\n                      }\n                    }}\n                  />\n                  <button\n                    onClick={sendChatMessage}\n                    className=\"px-5 py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-colors\"\n                  >\n                    Send\n                  </button>\n                </div>\n                <div className=\"mt-2 text-[11px] text-slate-400\">\n                  Tip: Press Enter to send, Shift+Enter for a new line.\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Find friends */}\n        <div className=\"lg:col-span-2 p-4 rounded-[28px] bg-slate-950/70 border border-white/10 shadow-xl\">\n          <div className=\"font-semibold mb-2 text-white/90\">Find Friends</div>\n          <input\n            className=\"input w-full mb-2\"\n            placeholder=\"Search by name or email\"\n            value={q}\n            onChange={(e) => search(e.target.value)}\n          />\n          <ul className=\"space-y-2 mb-3 max-h-48 overflow-auto\">\n            {results.map((r) => (\n              <li\n                key={r.email}\n                className=\"flex items-center justify-between gap-2 p-3 rounded-2xl border border-white/10 bg-slate-900/40\"\n              >\n                <div className=\"flex items-center gap-2\">\n                  <span\n                    className={`inline-block w-2 h-2 rounded-full ${r.status === \"online\" ? \"bg-emerald-400\" : r.status === \"ingame\" ? \"bg-amber-400\" : \"bg-slate-400\"}`}\n                  ></span>\n                  <span>{r.username || r.email}</span>\n                </div>\n                <button\n                  onClick={() => addFriend(r.email)}\n                  disabled={loading}\n                  className={`px-4 py-2 rounded-xl text-white text-sm font-bold transition-colors ${loading ? \"bg-indigo-900/40 cursor-not-allowed\" : \"bg-indigo-600 hover:bg-indigo-500\"}`}\n                >\n                  {loading ? \"Working‚Ä¶\" : \"Add ‚ûï\"}\n                </button>\n              </li>\n            ))}\n            {results.length === 0 && (\n              <li className=\"text-xs opacity-60\">Type to search...</li>\n            )}\n          </ul>\n          <div className=\"font-semibold mb-1 text-white/90\">Suggested</div>\n          <ul className=\"space-y-2 max-h-48 overflow-auto\">\n            {suggested.map((s) => (\n              <li\n                key={s.email}\n                className=\"flex items-center justify-between gap-2 p-3 rounded-2xl border border-white/10 bg-slate-900/40\"\n              >\n                <div className=\"flex items-center gap-2\">\n                  <span\n                    className={`inline-block w-2 h-2 rounded-full ${s.status === \"online\" ? \"bg-emerald-400\" : s.status === \"ingame\" ? \"bg-amber-400\" : \"bg-slate-400\"}`}\n                  ></span>\n                  <span>{s.username || s.email}</span>\n                </div>\n                <button\n                  onClick={() => addFriend(s.email)}\n                  disabled={loading}\n                  className={`px-4 py-2 rounded-xl text-white text-sm font-bold transition-colors ${loading ? \"bg-indigo-900/40 cursor-not-allowed\" : \"bg-indigo-600 hover:bg-indigo-500\"}`}\n                >\n                  {loading ? \"Working‚Ä¶\" : \"Add ‚ûï\"}\n                </button>\n              </li>\n            ))}\n            {suggested.length === 0 && (\n              <li className=\"text-xs opacity-60\">No suggestions right now.</li>\n            )}\n          </ul>\n        </div>\n      </div>\n\n      {/* Note: legacy global inbox list replaced by per-friend thread view above */}\n\n      {/* Message Popup */}\n      {messagePopup.show && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n          <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4\">\n            <div className=\"text-center mb-4\">\n              <h3 className=\"text-lg font-semibold text-white\">\n                Send Message ‚úâÔ∏è\n              </h3>\n            </div>\n            {/* eslint-disable jsx-a11y/no-autofocus */}\n            <textarea\n              className=\"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none\"\n              placeholder=\"Type your message here...\"\n              id=\"message-input\"\n              autoFocus\n            />\n            {/* eslint-enable jsx-a11y/no-autofocus */}\n            <div className=\"flex gap-3 mt-4\">\n              <button\n                onClick={sendMessage}\n                className=\"px-6 py-2 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-colors\"\n              >\n                Send Message üì§\n              </button>\n              <button\n                className=\"btn bg-slate-600 hover:bg-slate-700\"\n                onClick={() => setMessagePopup({ show: false })}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["LS_INBOX","LS_UNREAD","LS_THREADS","loadInitial","raw","arr","unread","rawThreads","parsedThreads","m","save","inbox","threads","initial","useMessages","create","set","get","v","s","exists","x","list","sorted","a","b","other","key","next","id","patterns","starify","match","censorProfanity","input","out","re","timeAgo","ts","h","Friends","user","toast","useToast","email","friends","setFriends","useState","suggested","setSuggested","results","setResults","q","setQ","filter","setFilter","loading","setLoading","msgs","activeChat","setActiveChat","chatDraft","setChatDraft","chatScrollRef","useRef","requests","setRequests","outgoingRequests","setOutgoingRequests","messagePopup","setMessagePopup","statusPopup","setStatusPopup","friendActionPopup","setFriendActionPopup","loadThread","useCallback","otherEmail","data","activeThread","useMemo","thread","map","from","prev","recentMs","cutoff","refresh","fl","sg","rq","r","useEffect","d","el","search","term","addFriend","target","removeFriend","acceptFriend","requestId","declineFriend","cancelRequest","sendMessage","message","sendChatMessage","now","f","statusSummary","summary","friendsByStatus","online","offline","ingame","spectate","roomId","ev","requestsCount","jsxs","jsx","stat","e","labelForMode","friend","Fragment","isMine","reason"],"mappings":"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"}
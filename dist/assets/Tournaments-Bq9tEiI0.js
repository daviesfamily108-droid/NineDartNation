import{j as t,I as M,e as De,L as Me,u as Pe,k as ye,M as Z,W as Ee,a as v}from"./index-CMnZsRGy.js";import{r as n}from"./ui-DwoKAdU7.js";import{G as Ie}from"./GameCalibrationStatus-B1l38mUe.js";import"./vendor-D3F3s8fL.js";function Je({t:i,onJoin:h,onLeave:m,joined:P,disabled:ee}){return t.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"font-semibold",children:[i.title,i.official&&t.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded bg-amber-500 text-black text-xs",children:"Official"})]}),t.jsxs("div",{className:"text-sm opacity-80",children:[i.game,i.game==="X01"?"/501":""," Â· ",M(i.mode)," ",i.value," Â·"," ",new Date(i.startAt).toLocaleString()," Â· Cap ",i.capacity," Â· Joined"," ",i.participants?.length||0]}),t.jsxs("div",{className:"text-xs opacity-60 mt-1",children:["Created by: ",i.creatorName||i.creatorEmail||"Unknown"]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{className:`btn ${P?"bg-emerald-600 hover:bg-emerald-600":""}`,disabled:ee,onClick:()=>P?m&&m(i):h&&h(i),children:P?"Already Joined! âœ…":"Join Now âš”ï¸"})})]})}const Le=i=>typeof i=="string"?i.toLowerCase().includes("integration"):typeof i=="number"?i.toString().toLowerCase().includes("integration"):!1,Oe=i=>i?[i.title,i.description,i.creatorName,i.creatorEmail].some(m=>Le(m)):!1,k=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0);function He({user:i}){const h=De(),m=(()=>{try{return Me()}catch{return null}})(),{matchType:P="singles",setMatchType:ee,teamAName:Re="Team A",setTeamAName:$e,teamBName:ze="Team B",setTeamBName:Ue}=Pe(),[te,q]=n.useState([]),[T,j]=n.useState(!1),[se,f]=n.useState(""),[We,X]=n.useState(null),[ae,ne]=n.useState(null),[u,E]=n.useState(null),[F,I]=n.useState(!1),[ge,ie]=n.useState(!1),[re,le]=n.useState(!1);n.useRef(!1);const[l,b]=n.useState({title:"",game:"X01",mode:"501",value:0,description:"",startAt:new Date().toISOString().slice(0,16),checkinMinutes:15,capacity:16,startingScore:501,requireCalibration:!1}),[x,ce]=n.useState(null),[oe,G]=n.useState(30),[w,J]=n.useState(null),[de,L]=n.useState({}),[_e,O]=n.useState(!1),[Be,R]=n.useState(!1),[qe,je]=n.useState(null),[Xe,Y]=n.useState(null),[$,y]=n.useState({open:!1,t:null}),[z,K]=n.useState({open:!1,t:null}),H=n.useRef(!1);n.useRef(null);const[Ne,ve]=n.useState({});n.useEffect(()=>m?m.addListener(s=>{try{if(s?.type==="match-prestart"){const a=s.match||null;a&&(a.prestartEndsAt=s.prestartEndsAt);try{a?.creatorId&&a?.creatorName&&ve(p=>({...p,[a.creatorId]:a.creatorName}))}catch{}H.current=!0,ce(a);const d=s.prestartEndsAt||Date.now();G(Math.max(0,Math.ceil(((d||Date.now())-Date.now())/1e3))),setTimeout(()=>{H.current=!1},0),J(null),L({}),O(!1),R(!1),Y(null)}if(s?.type==="match-start"&&x&&s.roomId===x.id&&(ce(null),J(null),L({})),s?.type==="prestart-choice-notify"){const{roomId:a,playerId:d,choice:p}=s;if(!a||!p)return;L(Ae=>({...Ae||{},[d]:p}))}s?.type==="prestart-bull"&&(O(!0),R(!1),je(null)),s?.type==="prestart-bull-winner"&&(Y(s.winnerId||null),O(!1),R(!1)),s?.type==="prestart-bull-tie"&&(Y(null),O(!1),R(!1))}catch{}}):void 0,[m,w,x]),n.useEffect(()=>{if(!x||H.current||x.prestartEndsAt)return;G(30),J(null),L({});const e=setInterval(()=>G(s=>Math.max(0,s-1)),1e3);return()=>clearInterval(e)},[x]);const me=ye(e=>e.inProgress),ue=ye(e=>({players:e.players,currentPlayerIdx:e.currentPlayerIdx,roomId:e.roomId}));n.useEffect(()=>{me&&le(!0)},[me]);const he=e=>{J(e);try{m?.connected&&x?.id&&m.send({type:"prestart-choice",roomId:x.id,choice:e})}catch{}};async function N(){try{if(ae&&Date.now()-ae<3e3)return;const s=await(await v("/api/tournaments")).json(),a=Array.isArray(s.tournaments)?s.tournaments:[];q(a);try{console.debug("[Tournaments] refresh fetched",a.length,"tournaments"),console.log("[Tournaments] fetched list:",a)}catch{}X(null),ne(Date.now())}catch(e){try{typeof window<"u"&&X(String(e?.message||e))}catch{typeof window<"u"&&X("unknown")}}}n.useEffect(()=>{N()},[]),n.useEffect(()=>{try{m?.connected&&N()}catch{}},[m?.connected]),n.useEffect(()=>{if(!m)return;const e=m.addListener(s=>{try{if(s.type==="tournaments"&&(q(s.tournaments||[]),ne(Date.now())),s.type==="tournaments")try{console.debug("[Tournaments] WS tournaments update, num=",(s.tournaments||[]).length)}catch{}s.type==="tournament-win"&&s.message&&h(s.message,{type:"success",timeout:1e4})}catch{}});return()=>{e()}},[m?.connected]),n.useEffect(()=>{try{if(m?.connected){try{m.send({type:"list-tournaments"})}catch{}N()}}catch{}},[m?.connected]),n.useEffect(()=>{let e=null;try{(!m||!m.connected)&&(e=window.setInterval(()=>{N()},1e4))}catch{}return()=>{e&&clearInterval(e)}},[m?.connected]);const o=String(i?.email||"").toLowerCase(),c=e=>!e||!o?!1:(Array.isArray(e.participants)?e.participants:[]).some(a=>String(a?.email||"").toLowerCase()===o),we=()=>t.jsxs("div",{className:"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"opacity-70",children:"Default match"}),t.jsx("span",{className:"btn py-1 px-2 bg-indigo-500/30 border border-indigo-400/50 text-indigo-100",children:"Singles"}),t.jsx("span",{className:"text-xs opacity-60 ml-2",children:"(tournaments use Singles only)"})]});n.useEffect(()=>{let e=!1;async function s(){if(!o){E(null);return}try{const d=await(await v(`/api/subscription?email=${encodeURIComponent(o)}`)).json();e||(d?.source==="tournament"&&typeof d.expiresAt=="number"&&d.expiresAt>Date.now()?E(d.expiresAt):E(null))}catch{e||E(null)}}return s(),()=>{e=!0}},[o]);async function xe(e){o&&K({open:!0,t:e})}async function Se(){const e=z.t;if(!(!e||!o)){K({open:!1,t:null}),j(!0);try{let s=await v("/api/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,requesterEmail:o})});if(!s.ok&&s.status===403&&String(o)==="daviesfamily108@gmail.com"&&(s=await v("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,requesterEmail:o})})),!s.ok){let a="Delete failed";try{const d=await s.json();d?.error&&(a=`Delete failed: ${String(d.error)}`)}catch{}h(a,{type:"error"});return}h("Tournament deleted",{type:"success"}),await N()}finally{j(!1)}}}async function U(e){if(o){j(!0);try{const s=await v("/api/tournaments/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,email:o,username:i?.username})});if(!s.ok){let a={};try{a=await s.json()}catch{}a?.error==="WINNER_COOLDOWN"&&typeof a.until=="number"?(f(`You're a recent NDN tournament winner. You can re-enter after ${g(a.until)}.`),setTimeout(()=>f(""),6e3),h("Join blocked: winner cooldown active",{type:"error"})):a?.error==="ALREADY_IN_TOURNAMENT"?(f(String(a.message||"You can only join one tournament at a time.")),setTimeout(()=>f(""),6e3),h("Join blocked: already in another tournament",{type:"error"})):a?.error&&(f(String(a.error)),setTimeout(()=>f(""),3500),h(`Join failed: ${String(a.error)}`,{type:"error"}));return}h("Joined tournament",{type:"success"}),await N()}finally{j(!1)}}}async function pe(e){if(o){j(!0);try{const s=await v("/api/tournaments/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,email:o})});if(!s.ok){let a={};try{a=await s.json()}catch{}a?.error?h(`Leave failed: ${String(a.error)}`,{type:"error"}):s.status===404?h("Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.",{type:"error"}):h("Leave failed. Please try again.",{type:"error"});return}h("Left tournament",{type:"success"}),q(a=>a.map(d=>d.id===e.id?{...d,participants:(d.participants||[]).filter(p=>p.email!==o)}:d)),await N()}finally{j(!1)}}}async function Ce(){j(!0);try{const e=new Date(l.startAt).getTime(),s=await v("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:l.title,game:l.game,mode:l.mode,value:Number(l.value),description:l.description,startAt:e,checkinMinutes:Number(l.checkinMinutes),capacity:Number(l.capacity),startingScore:l.game==="X01"?Number(l.startingScore||501):void 0,requireCalibration:!!l.requireCalibration,creatorEmail:i?.email,creatorName:i?.username})});if(!s.ok){let a="";try{const p=await s.json();p?.error?a=String(p.error):p?.details&&(a=String(p.details))}catch{}const d=a?`Create failed: ${a}`:"Create failed. Please try again.";f(d),h(d,{type:"error"}),setTimeout(()=>f(""),6e3);return}try{const a=await s.json();if(!a?.ok){const d=a?.error?`Create failed: ${String(a.error)}`:"Create failed. Please try again.";f(d),h(d,{type:"error"}),setTimeout(()=>f(""),6e3);return}}catch{}I(!1),h("Tournament created",{type:"success"}),await N()}finally{j(!1)}}n.useEffect(()=>{if(!F)return;const e=s=>{s.key==="Escape"&&I(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[F]);const S=n.useMemo(()=>te.filter(e=>!Oe(e)),[te]),W=n.useMemo(()=>S.filter(e=>e.official),[S]),Q=n.useMemo(()=>S.filter(e=>!e.official),[S]),V=n.useMemo(()=>S.filter(e=>e.status==="scheduled"&&!e.official),[S]),[A,fe]=n.useState(1),C=16,_=Math.ceil(V.length/C),ke=V.slice((A-1)*C,A*C),[D,be]=n.useState(1),B=Math.ceil(Q.length/C),Te=Q.slice((D-1)*C,D*C),r=n.useMemo(()=>W.filter(s=>s.status==="scheduled").sort((s,a)=>s.startAt-a.startAt)[0]||null,[W]);function g(e){return new Date(e).toLocaleString()}return t.jsxs("div",{className:"card ndn-game-shell ndn-page",children:[t.jsx("div",{className:"flex items-center justify-between mb-3",children:t.jsx("h2",{className:"text-2xl font-bold ndn-section-title",children:"Tournaments ðŸŽ¯"})}),t.jsxs("div",{className:"ndn-shell-body",children:[t.jsxs("div",{className:"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap",children:[t.jsx("div",{className:"min-w-0",children:t.jsx(we,{})}),t.jsxs("div",{className:"shrink-0",children:[t.jsx("button",{className:"btn",onClick:()=>I(!0),children:"Create Tournament + ðŸŽ¯"}),o==="daviesfamily108@gmail.com"&&t.jsx("button",{className:"btn btn-ghost ml-2",onClick:()=>ie(!0),children:"Demo Start Showcase ðŸŽ¯"})]})]}),ge&&t.jsx(Z,{players:[{id:"0",name:"Demo A",legsWon:0,legs:[]},{id:"1",name:"Demo B",legsWon:0,legs:[]}],user:i,onDone:()=>ie(!1)}),re&&t.jsx(Z,{players:ue.players||[],user:i,onDone:()=>le(!1)}),t.jsx("div",{className:"mb-2 text-sm font-semibold text-slate-300",children:"World Lobby"}),t.jsxs("div",{className:"mb-3 p-3 rounded-xl border border-slate-700 bg-black/10",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-semibold",children:"Created Game Lobby"}),t.jsx("div",{className:"text-xs opacity-60",children:"All tournaments created by users and admins"})]}),t.jsxs("ul",{className:"space-y-2",children:[V.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No created tournaments yet."}),ke.map(e=>t.jsx(Je,{t:e,onJoin:s=>U(s),onLeave:s=>pe(s),joined:c(e),disabled:T||e.status!=="scheduled"||!c(e)&&e.participants.length>=e.capacity},e.id))]}),_>1&&t.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm",children:[t.jsx("button",{className:"text-slate-300 hover:text-white transition-colors",onClick:()=>fe(e=>Math.max(e-1,1)),disabled:A===1,children:"â† Previous"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-slate-400",children:["Page ",A," of ",_]}),t.jsx("button",{className:"text-slate-300 hover:text-white transition-colors",onClick:()=>fe(e=>Math.min(e+1,_)),disabled:A===_,children:"Next â†’"})]})]})]}),r&&t.jsx("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm uppercase tracking-wide text-indigo-300 font-semibold",children:"Weekly Official Tournament ðŸŽ¯"}),t.jsx("div",{className:"font-bold",children:r.title}),t.jsxs("div",{className:"text-sm opacity-80",children:[r.game,r.game==="X01"&&r.startingScore?`/${r.startingScore}`:""," ","Â· ",M(r.mode)," ",r.value," Â· Starts ",g(r.startAt)," Â· Cap"," ",r.capacity," Â· Joined"," ",r.participants.length]}),r.prize&&t.jsxs("div",{className:"text-xs mt-1",children:["Prize:"," ",r.prizeType==="cash"&&r.prizeAmount?`${r.currency||"USD"} ${r.prizeAmount}`:"3 months PREMIUM"]}),r.status!=="scheduled"&&t.jsxs("div",{className:"text-xs",children:["Status: ",r.status]}),u&&u>Date.now()&&t.jsxs("div",{className:"text-xs text-rose-300",children:["Recent winners can re-enter after ",g(u),"."]})]}),t.jsx("div",{className:"shrink-0",children:t.jsx("button",{className:`btn ${c(r)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:c(r)?"Double-click to leave this tournament":r.official&&u&&u>Date.now()?`Recent winners can re-enter after ${g(u)}`:"",disabled:T||r.status!=="scheduled"||!c(r)&&(r.participants.length>=r.capacity||!!u&&u>Date.now()),onClick:()=>{c(r)?k&&y({open:!0,t:r}):U(r)},onDoubleClick:()=>{!k&&c(r)&&y({open:!0,t:r})},"aria-label":c(r)?"Already Joined":"Join Now",children:c(r)?"Already Joined! ðŸŽ¯":"Join Now ðŸŽ¯"})})]})}),se&&t.jsx("div",{className:"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm",children:se}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("section",{children:[t.jsx("div",{className:"font-semibold mb-1",children:"Official ðŸŽ¯"}),t.jsx("div",{className:"text-xs opacity-70 mb-2",children:u&&u>Date.now()?t.jsxs(t.Fragment,{children:["Youâ€™re a recent NDN tournament winner â€” to keep it fair, you can re-enter after ",g(u),"."]}):t.jsx(t.Fragment,{children:"Note: Weekly winners can re-enter once their 3 months of PREMIUM ends."})}),t.jsxs("ul",{className:"space-y-2",children:[W.map(e=>t.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"font-semibold",children:[e.title," ",e.prize&&t.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 align-middle",children:[t.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-amber-500 text-black",children:"Prize"}),t.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help",title:e.prizeType==="cash"?"Official cash prize tournament â€” payout handled by admin.":"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.","aria-label":"Prize info",children:"i"})]})]}),t.jsxs("div",{className:"text-sm opacity-80",children:[e.game,e.game==="X01"&&e.startingScore?`/${e.startingScore}`:""," ","Â· ",M(e.mode)," ",e.value," Â· ",g(e.startAt)," Â· Cap ",e.capacity," Â· Joined ",e.participants.length]}),e.prize&&t.jsxs("div",{className:"text-xs",children:["Prize:"," ",e.prizeType==="cash"&&e.prizeAmount?`${e.currency||"USD"} ${e.prizeAmount}`:"3 months PREMIUM",e.status==="completed"&&e.prizeType==="cash"&&e.payoutStatus&&t.jsx("span",{className:`ml-2 px-2 py-0.5 rounded ${e.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:e.payoutStatus==="paid"?"Paid":"Pending"})]}),e.status!=="scheduled"&&t.jsxs("div",{className:"text-xs",children:["Status: ",e.status]}),c(e)&&t.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"}),e.official&&u&&u>Date.now()&&t.jsxs("div",{className:"text-xs text-rose-300",children:["Cooldown active until ",g(u),"."]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:`btn ${c(e)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:c(e)?"Double-click to leave this tournament":e.official&&u&&u>Date.now()?`Recent winners can re-enter after ${g(u)}`:"",disabled:T||e.status!=="scheduled"||!c(e)&&(e.participants.length>=e.capacity||e.official&&!!u&&u>Date.now()),onClick:()=>{c(e)?k&&y({open:!0,t:e}):U(e)},onDoubleClick:()=>{!k&&c(e)&&y({open:!0,t:e})},"aria-label":c(e)?"Already Joined":"Join Now",children:c(e)?"Already Joined! ðŸŽ¯":"Join Now ðŸŽ¯"}),e.status==="scheduled"&&o&&(e.creatorEmail&&String(e.creatorEmail).toLowerCase()===o||o==="daviesfamily108@gmail.com")&&t.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>xe(e),"aria-label":"Delete tournament",children:"Ã—"})]})]},e.id)),W.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No official tournaments yet."})]})]}),t.jsxs("section",{children:[t.jsx("div",{className:"font-semibold mb-1",children:"Community ðŸŽ¯"}),t.jsxs("ul",{className:"space-y-2",children:[Te.map(e=>t.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsx("div",{className:"font-semibold",children:e.title}),t.jsxs("div",{className:"text-sm opacity-80",children:[e.game,e.game==="X01"&&e.startingScore?`/${e.startingScore}`:""," ","Â· ",M(e.mode)," ",e.value," Â· ",g(e.startAt)," Â· Cap ",e.capacity," Â· Joined ",e.participants.length]}),e.description&&t.jsx("div",{className:"text-xs opacity-80",children:e.description}),c(e)&&t.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"btn",title:c(e)?"Double-click to leave this tournament":"",disabled:T||e.status!=="scheduled"||!c(e)&&e.participants.length>=e.capacity,onClick:()=>{c(e)?k&&y({open:!0,t:e}):U(e)},onDoubleClick:()=>{!k&&c(e)&&y({open:!0,t:e})},children:c(e)?"Already Joined":"Join Now"}),e.status==="scheduled"&&o&&(e.creatorEmail&&String(e.creatorEmail).toLowerCase()===o||o==="daviesfamily108@gmail.com")&&t.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>xe(e),"aria-label":"Delete tournament",children:"Ã—"})]})]},e.id)),Q.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No community tournaments yet."})]}),B>1&&t.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 pt-2 border-t border-white/10",children:[t.jsx("button",{className:"btn btn-sm btn-ghost",disabled:D===1,onClick:()=>be(e=>Math.max(1,e-1)),children:"Previous"}),t.jsxs("span",{className:"text-sm opacity-70",children:["Page ",D," of ",B]}),t.jsx("button",{className:"btn btn-sm btn-ghost",disabled:D===B,onClick:()=>be(e=>Math.min(B,e+1)),children:"Next"})]})]})]}),F&&t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"card relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Create Tournament ðŸŽ¯"}),t.jsx("button",{className:"btn",onClick:()=>I(!1),children:"Close ðŸŽ¯"})]}),t.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 pr-1",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Title"}),t.jsx("input",{className:"input w-full",value:l.title,onChange:e=>b(s=>({...s,title:e.target.value}))})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Game"}),t.jsx("select",{className:"input w-full",value:l.game,onChange:e=>b(s=>({...s,game:e.target.value})),children:["X01","Cricket","Killer"].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Mode"}),t.jsx("select",{className:"input w-full",value:l.mode,onChange:e=>b(s=>({...s,mode:e.target.value})),children:Ee(l.game).map(e=>t.jsx("option",{value:String(e),children:M(String(e))},String(e)))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Number"}),t.jsx("input",{className:"input w-full",type:"number",min:1,value:l.value,onChange:e=>b(s=>({...s,value:Number(e.target.value)}))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Description"}),t.jsx("textarea",{className:"input w-full",rows:5,value:l.description,onChange:e=>b(s=>({...s,description:e.target.value}))})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Start time"}),t.jsx("input",{className:"input w-full",type:"datetime-local",value:l.startAt,onChange:e=>b(s=>({...s,startAt:e.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Check-in reminder (min)"}),t.jsx("input",{className:"input w-full",type:"number",min:0,value:l.checkinMinutes,onChange:e=>b(s=>({...s,checkinMinutes:Number(e.target.value)}))})]})]}),l.game==="X01"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"X01 Starting Score"}),t.jsx("select",{className:"input w-full",value:String(l.startingScore),onChange:e=>b(s=>({...s,startingScore:Number(e.target.value)})),children:[301,501,701].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",className:"accent-purple-500",checked:!!l.requireCalibration,onChange:e=>b(s=>({...s,requireCalibration:!!e.target.checked}))}),t.jsx("span",{className:"font-semibold",children:"Require calibration"})]}),t.jsx("div",{className:"text-xs opacity-70 mt-1",children:"If checked, players must have a calibrated board to join matches spawned from this tournament."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Capacity"}),t.jsx("input",{className:"input w-full",type:"number",min:6,max:64,value:l.capacity,onChange:e=>b(s=>({...s,capacity:Number(e.target.value)}))})]}),t.jsx("div",{className:"text-xs opacity-70",children:"Note: community tournaments do not award prizes."}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{className:"btn",disabled:T,onClick:Ce,children:"Create"})})]})]})}),x&&t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"join-heading",tabIndex:-1,className:"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4",children:t.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full",children:[t.jsx("div",{id:"join-heading",className:"text-lg font-bold mb-2",children:"Match Ready"}),t.jsxs("div",{className:"mb-3",children:[x.game," - ",x.modeType," Â· ",x.legs," legs"]}),t.jsxs("div",{className:"text-sm opacity-80 mb-3",children:["Created by ",x.createdBy]}),t.jsx("div",{className:"mb-3",children:t.jsx(Ie,{gameMode:x.game,compact:!0})}),x.startingScore&&t.jsxs("div",{className:"mb-3",children:["Starting score:"," ",t.jsx("span",{className:"font-mono",children:x.startingScore})]}),t.jsx(Z,{open:re,players:ue.players,user:i,onRequestClose:()=>{},onDone:()=>{}}),t.jsxs("div",{className:"mb-3",children:["Timer: ",t.jsxs("span",{className:"font-mono",children:[oe,"s"]})]}),(oe<=15||x?.prestartEndsAt)&&t.jsxs("div",{className:"mb-3",children:["Choose:"," ",t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:`btn ${w==="bull"?"btn-primary":"btn-ghost"}`,onClick:()=>he("bull"),children:"Bull Up"}),t.jsx("button",{className:`btn ${w==="skip"?"btn-primary":"btn-ghost"}`,onClick:()=>he("skip"),children:"Skip"})]}),t.jsx("div",{className:"text-xs opacity-70 mt-2",children:w?`You chose: ${w}`:"Please choose Bull Up or Skip before accepting"}),Object.keys(de).length>0&&t.jsx("div",{className:"text-xs opacity-70 mt-2",role:"status","aria-live":"polite",children:Object.entries(de).map(([e,s])=>t.jsxs("div",{children:[Ne[e]||e," chose: ",s]},e))}),w==="skip"&&t.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Skip requires both players to click Skip. Waiting for opponent..."})]})]})}),$.open&&$.t&&t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>y({open:!1,t:null})}),t.jsxs("div",{className:"relative card p-4 w-[360px] max-w-[90vw]",children:[t.jsx("div",{className:"text-lg font-semibold mb-2",children:"Leave tournament?"}),t.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Are you sure you want to remove yourself from â€œ",$.t.title,"â€?"]}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>y({open:!1,t:null}),children:"Decline"}),t.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const e=$.t;y({open:!1,t:null}),await pe(e)},children:"Accept"})]})]})]}),z.open&&z.t&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold mb-4 text-white",children:"Delete Tournament"}),t.jsxs("div",{className:"text-slate-300 mb-6",children:["Are you sure you want to delete"," ",t.jsxs("span",{className:"font-semibold text-white",children:['"',z.t.title,'"']}),"?",t.jsx("br",{}),t.jsx("span",{className:"text-sm text-slate-400",children:"This action cannot be undone."})]}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsx("button",{className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",onClick:()=>K({open:!1,t:null}),children:"Decline"}),t.jsx("button",{className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",onClick:Se,children:"Continue"})]})]})})})]})]})}export{He as default};
//# sourceMappingURL=Tournaments-Bq9tEiI0.js.map

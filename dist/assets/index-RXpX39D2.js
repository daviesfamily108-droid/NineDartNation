import{r as yr,a as io,g as ca}from"./vendor-D3F3s8fL.js";import{r as m,S as Rn,L as Rl,M as aa,a as Ll,U as cr,T as ea,C as oo,P as Ol,R as Bl,b as Sa,c as ai,d as Ul,e as $l,G as Fl,V as _l,E as lo,f as Wl,g as co,h as mo,i as Hl,j as zl,k as ql,X as Vl}from"./ui-Dx22kTqm.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();var ka={exports:{}},An={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ri;function Gl(){if(ri)return An;ri=1;var t=yr(),a=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function l(o,d,c){var f,u={},x=null,p=null;c!==void 0&&(x=""+c),d.key!==void 0&&(x=""+d.key),d.ref!==void 0&&(p=d.ref);for(f in d)i.call(d,f)&&!r.hasOwnProperty(f)&&(u[f]=d[f]);if(o&&o.defaultProps)for(f in d=o.defaultProps,d)u[f]===void 0&&(u[f]=d[f]);return{$$typeof:a,type:o,key:x,ref:p,props:u,_owner:n.current}}return An.Fragment=s,An.jsx=l,An.jsxs=l,An}var ii;function Jl(){return ii||(ii=1,ka.exports=Gl()),ka.exports}var e=Jl(),Yn={},oi;function Kl(){if(oi)return Yn;oi=1;var t=io();return Yn.createRoot=t.createRoot,Yn.hydrateRoot=t.hydrateRoot,Yn}var Yl=Kl();const Xl=ca(Yl);var uo=io();const Ql=ca(uo),ho=t=>`ndn_online_quota_${t}`;function ta(t=new Date){const a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),s=a.getUTCDay()||7;a.setUTCDate(a.getUTCDate()+4-s);const i=new Date(Date.UTC(a.getUTCFullYear(),0,1)),n=Math.ceil(((a.getTime()-i.getTime())/864e5+1)/7),r=String(n).padStart(2,"0");return`${a.getUTCFullYear()}-${r}`}function fo(t){try{const a=localStorage.getItem(ho(t));if(!a)return{week:ta(),used:0};const s=JSON.parse(a),i=ta();return!s.week||s.week!==i?{week:i,used:0}:{week:String(s.week),used:Number(s.used)||0}}catch{return{week:ta(),used:0}}}function Zl(t,a){try{localStorage.setItem(ho(t),JSON.stringify(a))}catch{}}function li(t,a=3){const s=ta(),i=fo(t),n={week:s,used:(i.week===s?i.used:0)+1};return Zl(t,n),n}function xo(t,a=3){const s=fo(t);return Math.max(0,a-(s.used||0))}const po={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8787",VITE_WS_URL:"ws://localhost:8787"},bo="ndn:isAdmin:v1";function go(){try{const t=localStorage.getItem(bo);return t?JSON.parse(t):{}}catch{return{}}}function ec(t,a){try{const s=go();s[(t||"").toLowerCase()]={v:a,ts:Date.now()},localStorage.setItem(bo,JSON.stringify(s))}catch{}}async function tc(t){const a=String(t||"").toLowerCase();if(!a)return!1;try{const n=String(po?.VITE_OWNER_EMAIL||"").toLowerCase();if(n&&a===n)return!0}catch{}if(a==="daviesfamily108@gmail.com")return!0;try{const n=localStorage.getItem("ndn:forceAdmin");if(n==="1"||n==="true")return!0}catch{}const i=go()[a];if(i&&Date.now()-i.ts<300*1e3)return!!i.v;try{const l=!!(await(await fetch(`/api/admins/check?email=${encodeURIComponent(a)}`)).json().catch(()=>({})))?.isAdmin;return ec(a,l),l}catch{return!!i?.v}}function yo(t){const a=String(t||"").toLowerCase(),[s,i]=m.useState(!1);return m.useEffect(()=>{let n=!0;if(!a){i(!1);return}try{const r=String(po?.VITE_OWNER_EMAIL||"").toLowerCase(),l=(()=>{try{const o=localStorage.getItem("ndn:forceAdmin");return o==="1"||o==="true"}catch{return!1}})();if(r&&a===r){i(!0);return}if(l){i(!0);return}}catch{}if(a==="daviesfamily108@gmail.com"){i(!0);return}return tc(a).then(r=>{n&&i(!!r)}),()=>{n=!1}},[a]),s}const sc={},nc=5,ac={GBP:1,EUR:1.16,USD:1.26,AUD:1.92,NZD:2.08,CAD:1.73};function vo(t,a=nc){const s=(t||"GBP").toUpperCase(),i=ac[s]??1,n=a*i;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s}).format(n)}catch{return`${s} ${n.toFixed(2)}`}}function jo(){try{const t=new Intl.NumberFormat().resolvedOptions(),a=String(t.locale).toLowerCase();return a.includes("-gb")?"GBP":a.includes("-ie")||a.includes("-de")||a.includes("-fr")||a.includes("-es")||a.includes("-it")||a.includes("-nl")?"EUR":a.includes("-us")?"USD":a.includes("-au")?"AUD":a.includes("-nz")?"NZD":a.includes("-ca")?"CAD":"GBP"}catch{return"GBP"}}const rc=sc?.VITE_DISCORD_INVITE_URL||"https://discord.gg/nCfT4hJz";let Bs=null;function ic(){if(Bs)return Bs;const t="http://localhost:8787".trim();if(t)return Bs=t.replace(/\/$/,""),Bs;if(typeof window<"u"){const{protocol:a,host:s,hostname:i}=window.location,n=`${a}//${s}`;return i.endsWith("onrender.com")||i==="localhost"||i==="127.0.0.1"?Bs=n.replace(/\/$/,""):Bs="https://ninedartnation.onrender.com",Bs}return Bs="https://ninedartnation.onrender.com",Bs}function oc(t){if(/^https?:\/\//i.test(t))return t;const a=ic(),s=t.startsWith("/")?t:`/${t}`;return`${a}${s}`}function sa(t){return oc(t)}function St(t,a){const s=sa(t);return fetch(s,a)}function lc(){if(typeof window>"u"||typeof window.fetch!="function")return;const t=window;if(t.__ndnApiPatched)return;const a=window.fetch.bind(window);window.fetch=(s,i)=>{try{if(typeof s=="string")return s.startsWith("/")?a(sa(s),i):a(s,i);if(s instanceof Request){const n=s.url.startsWith("/")?sa(s.url):s.url;if(n===s.url)return a(s,i);const r=new Request(n,s);return a(r,i)}if(s instanceof URL){const n=s.href.startsWith("/")?sa(s.href):s.href;return a(n,i)}}catch(n){console.warn("[API] Interceptor failed, falling back to original fetch",n)}return a(s,i)},t.__ndnApiPatched=!0}function cc(t){const a=[{key:"score",label:"Home",icon:Ll},{key:"online",label:"Online",icon:cr},{key:"offline",label:"Offline",icon:ea},{key:"tournaments",label:"Tournaments",icon:ea},{key:"friends",label:"Friends",icon:cr},{key:"stats",label:"Stats",icon:ea},{key:"calibrate",label:"Calibrate",icon:oo},{key:"settings",label:"Settings",icon:Rn}];return t?.fullAccess||a.push({key:"fullaccess",label:"PREMIUM Â£â‚¬$",icon:Ol}),a}function No({active:t,onChange:a,user:s,className:i}){const n=cc(s),r=yo(s?.email);if(r&&!n.some(u=>u.key==="admin")){const u=n.findIndex(p=>p.key==="settings"),x={key:"admin",label:"Admin",icon:Rn};u>=0?n.splice(u,0,x):n.push(x)}const[l,o]=m.useState(!1),d=s?.username&&!s?.fullAccess?xo(s.username):1/0,[c,f]=m.useState({friendRequests:0,messages:0,tournaments:0});return m.useEffect(()=>{if(!s?.email)return;const u=async()=>{try{const[p,y]=await Promise.all([St(`/api/friends/requests?email=${encodeURIComponent(s.email)}`),St(`/api/friends/messages?email=${encodeURIComponent(s.email)}`)]),C=p.ok?await p.json():{requests:[]},T=(y.ok?await y.json():{messages:[]}).messages?.filter(N=>!N.read).length||0;f({friendRequests:C.requests?.length||0,messages:T,tournaments:0})}catch(p){console.error("Failed to fetch notifications:",p)}};u();const x=setInterval(u,3e4);return()=>clearInterval(x)},[s?.email]),m.useEffect(()=>{if(!l)return;const u=x=>{(x.key==="Escape"||x.key==="Enter")&&o(!1)};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[l]),e.jsxs("aside",{className:`${s?.fullAccess?"premium-sidebar":""} sidebar glass ${i?"":"w-60"} p-2 sm:p-4 rounded-2xl ${i??"hidden sm:flex"} flex-col gap-2 overflow-y-auto overflow-x-hidden ${i?"":"fixed top-2 bottom-2 sm:top-4 sm:bottom-4"}`,children:[n.map(({key:u,label:x,icon:p})=>u==="admin"&&!r?null:e.jsxs("button",{className:`tab whitespace-nowrap flex items-center justify-start gap-3 ${t===u?"tab--active":"tab--inactive"} `,onClick:()=>a(u),title:x,style:{fontWeight:700,fontSize:"1.1rem",color:t===u?"#fff":"#E5E7EB",letterSpacing:"0.02em"},children:[e.jsx(p,{className:"w-6 h-6"}),e.jsxs("span",{className:"flex items-center gap-2",children:[x,u==="online"&&!s?.fullAccess&&d<=0&&e.jsxs("span",{title:"Weekly free games used",className:"inline-flex items-center gap-1 text-[0.65rem] px-2 py-0.5 rounded-full bg-rose-600 text-white",children:[e.jsx(Rl,{className:"w-3 h-3"}),"Locked"]}),u==="friends"&&c.friendRequests>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:c.friendRequests>9?"9+":c.friendRequests}),u==="score"&&(c.messages>0||c.tournaments>0)&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:c.messages+c.tournaments>9?"9+":c.messages+c.tournaments})]})]},u)),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-2",onClick:()=>o(!0),title:"BullseyeDartsLeague",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(aa,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"BullseyeDartsLeague"})]}),l&&uo.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>o(!1),onTouchStart:()=>o(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>o(!1),children:"âœ•"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(aa,{className:"w-6 h-6"})," BullseyeDartsLeague"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join this fantastic Online Darts League with divisions and other cool stuff included"}),e.jsx("a",{href:rc,target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body)]})}const dc={},ci=t=>{let a;const s=new Set,i=(f,u)=>{const x=typeof f=="function"?f(a):f;if(!Object.is(x,a)){const p=a;a=u??(typeof x!="object"||x===null)?x:Object.assign({},a,x),s.forEach(y=>y(a,p))}},n=()=>a,d={setState:i,getState:n,getInitialState:()=>c,subscribe:f=>(s.add(f),()=>s.delete(f)),destroy:()=>{(dc?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},c=a=t(i,n,d);return d},mc=t=>t?ci(t):ci;var Ca={exports:{}},Ea={},Ta={exports:{}},Ia={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var di;function uc(){if(di)return Ia;di=1;var t=yr();function a(u,x){return u===x&&(u!==0||1/u===1/x)||u!==u&&x!==x}var s=typeof Object.is=="function"?Object.is:a,i=t.useState,n=t.useEffect,r=t.useLayoutEffect,l=t.useDebugValue;function o(u,x){var p=x(),y=i({inst:{value:p,getSnapshot:x}}),C=y[0].inst,D=y[1];return r(function(){C.value=p,C.getSnapshot=x,d(C)&&D({inst:C})},[u,p,x]),n(function(){return d(C)&&D({inst:C}),u(function(){d(C)&&D({inst:C})})},[u]),l(p),p}function d(u){var x=u.getSnapshot;u=u.value;try{var p=x();return!s(u,p)}catch{return!0}}function c(u,x){return x()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return Ia.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:f,Ia}var mi;function hc(){return mi||(mi=1,Ta.exports=uc()),Ta.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ui;function fc(){if(ui)return Ea;ui=1;var t=yr(),a=hc();function s(c,f){return c===f&&(c!==0||1/c===1/f)||c!==c&&f!==f}var i=typeof Object.is=="function"?Object.is:s,n=a.useSyncExternalStore,r=t.useRef,l=t.useEffect,o=t.useMemo,d=t.useDebugValue;return Ea.useSyncExternalStoreWithSelector=function(c,f,u,x,p){var y=r(null);if(y.current===null){var C={hasValue:!1,value:null};y.current=C}else C=y.current;y=o(function(){function T(k){if(!N){if(N=!0,I=k,k=x(k),p!==void 0&&C.hasValue){var b=C.value;if(p(b,k))return A=b}return A=k}if(b=A,i(I,k))return b;var g=x(k);return p!==void 0&&p(b,g)?(I=k,b):(I=k,A=g)}var N=!1,I,A,M=u===void 0?null:u;return[function(){return T(f())},M===null?void 0:function(){return T(M())}]},[f,u,x,p]);var D=n(c,y[0],y[1]);return l(function(){C.hasValue=!0,C.value=D},[D]),d(D),D},Ea}var hi;function xc(){return hi||(hi=1,Ca.exports=fc()),Ca.exports}var pc=xc();const bc=ca(pc),wo={},{useDebugValue:gc}=Bl,{useSyncExternalStoreWithSelector:yc}=bc;let fi=!1;const vc=t=>t;function jc(t,a=vc,s){(wo?"production":void 0)!=="production"&&s&&!fi&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),fi=!0);const i=yc(t.subscribe,t.getState,t.getServerState||t.getInitialState,a,s);return gc(i),i}const xi=t=>{(wo?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof t=="function"?mc(t):t,s=(i,n)=>jc(a,i,n);return Object.assign(s,a),s},on=t=>t?xi(t):xi;let Nc=1;const dr=on(t=>({toasts:[],push:(a,s)=>t(i=>{const n=Nc++,r={id:n,message:a,type:s?.type||"info",timeout:s?.timeout??3e3};return r.timeout&&r.timeout>0&&setTimeout(()=>{t(l=>({toasts:l.toasts.filter(o=>o.id!==n)}))},r.timeout),{toasts:[...i.toasts,r]}}),remove:a=>t(s=>({toasts:s.toasts.filter(i=>i.id!==a)})),clear:()=>t({toasts:[]})}));function jn(){return dr(a=>a.push)}function mt(t){return(t??0).toFixed(2)}const wc=t=>`ndn_stats_${t}`,So=t=>`ndn_stats_ts_${t}`;function os(t){try{const a=localStorage.getItem(wc(t));if(!a)return{darts:0,scored:0};const s=JSON.parse(a);return{darts:Number(s.darts)||0,scored:Number(s.scored)||0,fnDarts:Number(s.fnDarts)||0,fnScored:Number(s.fnScored)||0,best3:typeof s.best3=="number"?s.best3:0,worst3:typeof s.worst3=="number"?s.worst3:0,bestLegDarts:typeof s.bestLegDarts=="number"?s.bestLegDarts:0,bestCheckout:typeof s.bestCheckout=="number"?s.bestCheckout:0,worstLegDarts:typeof s.worstLegDarts=="number"?s.worstLegDarts:0,bestFNAvg:typeof s.bestFNAvg=="number"?s.bestFNAvg:0,worstFNAvg:typeof s.worstFNAvg=="number"?s.worstFNAvg:0}}catch{return{darts:0,scored:0}}}function Ks(t){const{darts:a,scored:s}=os(t);return a?s/a*3:0}function Ma(t){const{fnDarts:a=0,fnScored:s=0}=os(t);return a?s/a*3:0}const ko="ndn_game_mode_stats";function vr(t){let a={};try{const s=localStorage.getItem(ko);s&&(a=JSON.parse(s))}catch{}if(Array.isArray(t))for(const s of t)a[s]||(a[s]={played:0,won:0});return a}function Sc(t){try{localStorage.setItem(ko,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{gameModes:!0}}))}catch{}}function kc(t,a){const s=vr(),i=s[t]||{played:0,won:0};i.played+=1,a&&(i.won+=1),s[t]=i,Sc(s)}function da(t){try{const a=localStorage.getItem(So(t));if(!a)return[];const s=JSON.parse(a);return Array.isArray(s)?s.map(i=>({t:Number(i.t)||0,darts:Number(i.darts)||0,scored:Number(i.scored)||0,fnDarts:Number(i.fnDarts)||0,fnScored:Number(i.fnScored)||0})).filter(i=>i.t>0):[]}catch{return[]}}function Cc(t,a){try{localStorage.setItem(So(t),JSON.stringify(a)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t}}))}catch{}}function Ec(t,a){const s=Date.now();return t.filter(i=>s-i.t<=a)}function an(t,a,s,i=Date.now(),n,r){if(a<=0)return;const l=da(t),o=Ec([...l,{t:i,darts:a,scored:s,fnDarts:n,fnScored:r}],1e3*60*60*24*30);Cc(t,o)}function Tc(t,a=1e3*60*60*24){const s=da(t);if(!s.length)return 0;const i=Date.now();let n=0,r=0;for(const l of s)i-l.t<=a&&(n+=l.darts,r+=l.scored);return n<=0?0:r/n*3}function Ic(t,a=1e3*60*60*24*30){const s=da(t);if(!s.length)return 0;const i=Date.now();let n=0,r=0;for(const l of s)i-l.t<=a&&(n+=l.fnDarts||0,r+=l.fnScored||0);return n<=0?0:r/n*3}function Da(t){const s=da(t);if(!s.length)return 0;const i=Date.now(),n=s.filter(c=>i-c.t<=2592e6),r=n.filter(c=>typeof c.fnDarts=="number"),l=r.length?r:n;let o=0,d=0;for(const c of l)o+=c.darts,d+=c.scored;return o<=0?0:d/o*3}function Aa(t){return Ic(t,2592e6)}const Co="ndn_user_settings";function mr(){try{const t=localStorage.getItem(Co);if(!t)return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,cameraEnabled:!0,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",textSize:"medium",boxSize:"medium"};const a=JSON.parse(t);return{favoriteDouble:a.favoriteDouble||"D16",callerEnabled:typeof a.callerEnabled=="boolean"?a.callerEnabled:!0,callerVoice:a.callerVoice||"",callerVolume:typeof a.callerVolume=="number"?Math.max(0,Math.min(1,a.callerVolume)):1,speakCheckoutOnly:!!a.speakCheckoutOnly,avgMode:a.avgMode==="24h"?"24h":"all-time",autoStartOffline:!!a.autoStartOffline,rememberLastOffline:typeof a.rememberLastOffline=="boolean"?a.rememberLastOffline:!0,lastOffline:a.lastOffline&&typeof a.lastOffline=="object"?{mode:a.lastOffline.mode||"X01",x01Start:Number(a.lastOffline.x01Start)||501,firstTo:Number(a.lastOffline.firstTo)||1,aiLevel:a.lastOffline.aiLevel||"None"}:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!!a.reducedMotion,compactHeader:!!a.compactHeader,allowSpectate:typeof a.allowSpectate=="boolean"?a.allowSpectate:!0,cameraScale:typeof a.cameraScale=="number"&&isFinite(a.cameraScale)?Math.max(.5,Math.min(1.25,a.cameraScale)):1,cameraAspect:a.cameraAspect==="square"?"square":"wide",autoscoreProvider:a.autoscoreProvider==="external-ws"?"external-ws":a.autoscoreProvider==="manual"?"manual":"built-in",autoscoreWsUrl:typeof a.autoscoreWsUrl=="string"?a.autoscoreWsUrl:"",calibrationGuide:typeof a.calibrationGuide=="boolean"?a.calibrationGuide:!0,preferredCameraId:typeof a.preferredCameraId=="string"?a.preferredCameraId:void 0,preferredCameraLabel:typeof a.preferredCameraLabel=="string"?a.preferredCameraLabel:void 0,preferredCameraLocked:typeof a.preferredCameraLocked=="boolean"?a.preferredCameraLocked:!1,cameraEnabled:typeof a.cameraEnabled=="boolean"?a.cameraEnabled:!0,offlineLayout:a.offlineLayout==="classic"?"classic":"modern",textSize:a.textSize==="small"||a.textSize==="large"?a.textSize:"medium",boxSize:a.boxSize==="small"||a.boxSize==="large"?a.boxSize:"medium"}}catch{return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preferredCameraLocked:!1,cameraEnabled:!0,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",textSize:"medium",boxSize:"medium"}}}function wt(t){try{const a=mr();localStorage.setItem(Co,JSON.stringify({...a,...t}))}catch{}}const ls=on((t,a)=>({...mr(),setFavoriteDouble:s=>{wt({favoriteDouble:s}),t({favoriteDouble:s})},setCallerEnabled:s=>{wt({callerEnabled:s}),t({callerEnabled:s})},setCallerVoice:s=>{wt({callerVoice:s}),t({callerVoice:s})},setAvgMode:s=>{wt({avgMode:s}),t({avgMode:s})},setCallerVolume:s=>{const i=Math.max(0,Math.min(1,s));wt({callerVolume:i}),t({callerVolume:i})},setSpeakCheckoutOnly:s=>{wt({speakCheckoutOnly:s}),t({speakCheckoutOnly:s})},setAutoStartOffline:s=>{wt({autoStartOffline:s}),t({autoStartOffline:s})},setRememberLastOffline:s=>{wt({rememberLastOffline:s}),t({rememberLastOffline:s})},setLastOffline:s=>{const n={...mr().lastOffline,...s};wt({lastOffline:n}),t({lastOffline:n})},setReducedMotion:s=>{wt({reducedMotion:s}),t({reducedMotion:s})},setCompactHeader:s=>{wt({compactHeader:s}),t({compactHeader:s})},setAllowSpectate:s=>{wt({allowSpectate:s}),t({allowSpectate:s})},setCameraScale:s=>{const i=Math.max(.5,Math.min(1.25,s));wt({cameraScale:i}),t({cameraScale:i})},setCameraAspect:s=>{const i=s==="square"?"square":"wide";wt({cameraAspect:i}),t({cameraAspect:i})},setAutoscoreProvider:s=>{wt({autoscoreProvider:s}),t({autoscoreProvider:s})},setAutoscoreWsUrl:s=>{wt({autoscoreWsUrl:s}),t({autoscoreWsUrl:s})},setCalibrationGuide:s=>{wt({calibrationGuide:s}),t({calibrationGuide:s})},setPreferredCamera:(s,i,n=!1)=>{try{if(a().preferredCameraLocked&&!n)return}catch{}wt({preferredCameraId:s,preferredCameraLabel:i}),t({preferredCameraId:s,preferredCameraLabel:i})},setPreferredCameraLocked:s=>{wt({preferredCameraLocked:s}),t({preferredCameraLocked:s})},setCameraEnabled:s=>{wt({cameraEnabled:s}),t({cameraEnabled:s})},setOfflineLayout:s=>{wt({offlineLayout:s}),t({offlineLayout:s})},setTextSize:s=>{wt({textSize:s}),t({textSize:s})},setBoxSize:s=>{wt({boxSize:s}),t({boxSize:s})}}));function Xn(t){try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:t}}))}catch{}}const Mc="http://localhost:8787";function Dc({user:t}){const[a,s]=m.useState(!1),[i,n]=m.useState(!1),[r,l]=m.useState(""),{lastOffline:o}=ls(),d=jn();return m.useEffect(()=>{const c=["The fastest televised 9-darter took roughly 25 seconds!","A perfect leg (501) can be finished in nine darts.","The inner bull is worth 50; the outer bull is 25.","Standard dartboards are made from compressed sisal fibers.","Doubles and trebles are the thin outer and middle rings.","Professional oche (throw line) distance is 7 ft 9Â¼ in (2.37 m).","â€œDartitisâ€ is a real condition affecting a playerâ€™s throwing motion.","Phil Taylor holds a record number of World Championship titles.","Checkout routes often end on a doubleâ€”classic â€œdouble-outâ€.","The highest 3-dart score is 180 (triple 20, triple 20, triple 20)."],f=Math.floor(Math.random()*c.length);l(c[f])},[]),e.jsxs("div",{className:`${t?.fullAccess?"premium-main":""} relative min-h-[600px] flex flex-col items-center justify-center overflow-hidden`,children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-700 via-indigo-500 to-blue-600 opacity-60 blur-2xl"}),e.jsx("div",{className:"absolute top-20 left-1/4 w-40 h-40 bg-pink-400 rounded-full opacity-30 blur-2xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-10 right-1/4 w-32 h-32 bg-blue-400 rounded-full opacity-30 blur-2xl animate-pulse"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-6xl mx-auto bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 lg:p-10 flex flex-col items-center",children:[e.jsx("h2",{className:"text-2xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-400 to-blue-400 mb-2 sm:mb-3 md:mb-4 drop-shadow-xl text-center leading-tight",children:"Welcome to Nine Dart Nation"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl lg:text-2xl text-white/80 mb-2 font-semibold text-center px-2",children:"Your home for competitive darts, stats, and online play."}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg text-white/60 mb-3 sm:mb-4 italic text-center px-2",children:'"Where every dart counts and every player matters."'}),r&&e.jsx("div",{className:"w-full mb-4 sm:mb-6 px-2 sm:px-0",children:e.jsxs("div",{className:"mx-auto max-w-xs sm:max-w-xl rounded-full px-3 sm:px-5 py-2 text-center text-indigo-100 bg-gradient-to-r from-indigo-600/80 to-fuchsia-600/80 shadow-md",children:[e.jsx("span",{className:"font-semibold text-sm sm:text-base",children:"Did you know?"})," ",e.jsx("span",{className:"opacity-90 text-sm sm:text-base",children:r})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4 md:gap-6 justify-center mb-6 md:mb-8 w-full max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>{Xn("offline");try{window.dispatchEvent(new CustomEvent("ndn:offline-format",{detail:{formatType:"first",formatCount:Number(o?.firstTo)||1,startScore:Number(o?.x01Start)||501}}))}catch{}try{setTimeout(()=>{window.dispatchEvent(new CustomEvent("ndn:auto-start",{detail:{mode:o?.mode||"X01"}}))},50)}catch{}},className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸŽ¯"})," Start New Match"]}),e.jsxs("button",{onClick:()=>Xn("stats"),className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ“Š"})," View Stats"]}),e.jsxs("button",{onClick:()=>Xn("online"),className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-green-500 to-blue-400 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ†"})," Join Online League"]}),e.jsxs("button",{onClick:()=>{Xn("offline");try{window.dispatchEvent(new CustomEvent("ndn:auto-start",{detail:{mode:"Double Practice"}}))}catch{}},className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-pink-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ’¡"})," Practice Doubles"]})]}),(()=>{const c=t?.username||"Player 1",f=os(c),u=!!t?.fullAccess,x="grid grid-cols-[120px,1fr,1fr] sm:grid-cols-[160px,1fr,1fr]",p=({label:y,left:C,right:D,lock:T})=>e.jsxs("div",{className:`relative ${x} gap-2 items-center p-2 rounded-lg ${T?"bg-white/5 border border-white/10 overflow-hidden":"bg-indigo-500/10 border border-indigo-500/40"} mb-2`,children:[e.jsx("div",{className:"text-[12px] opacity-80 pl-2 text-left",children:y}),e.jsx("div",{className:`text-sm font-semibold text-center ${T?"opacity-50 blur-[0.5px]":""}`,children:C}),e.jsx("div",{className:`text-sm font-semibold text-center ${T?"opacity-50 blur-[0.5px]":""}`,children:D}),T&&e.jsx("button",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-slate-900/35 hover:bg-slate-900/45 transition",onClick:async()=>{try{const I=await(await fetch(`${Mc}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})})).json();I.ok&&I.url?window.location.href=I.url:I.error==="STRIPE_NOT_CONFIGURED"?d("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):d("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{d("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},title:"Unlock with PREMIUM",children:e.jsx("span",{className:"text-[12px] font-semibold",children:"Unlock PREMIUM"})})]});return e.jsxs("div",{className:"w-full mt-2 rounded-2xl p-2 sm:p-3 bg-white/5 border border-white/10 overflow-x-auto",children:[e.jsxs("div",{className:`${x} gap-2 mb-2 px-1 items-center min-w-[280px] sm:min-w-0`,children:[e.jsx("div",{className:"text-[12px] opacity-0 select-none",children:"label"}),e.jsx("div",{className:"text-[12px] font-semibold text-center",children:"BEST"}),e.jsx("div",{className:"text-[12px] font-semibold text-center",children:"WORST"})]}),e.jsx(p,{label:"3-dart avg",left:mt(f.best3||0),right:mt(f.worst3||0)}),e.jsx(p,{label:"9-dart avg",left:mt(f.bestFNAvg||0),right:mt(f.worstFNAvg||0),lock:!u}),e.jsx(p,{label:"Leg (darts)",left:String(f.bestLegDarts||0),right:String(f.worstLegDarts||0),lock:!u}),e.jsx(p,{label:"Checkout",left:String(f.bestCheckout||0),right:"â€”",lock:!u})]})})(),e.jsx("button",{className:"mt-6 sm:mt-8 md:mt-10 px-6 sm:px-8 md:px-10 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 text-base sm:text-lg md:text-xl touch-manipulation",onClick:()=>n(!0),children:"How to Play / Getting Started"})]}),e.jsx("footer",{className:"w-full py-2 md:py-2 text-center text-white/80 text-xs md:text-sm font-medium absolute bottom-0 left-0 z-20 flex items-center justify-center gap-1 md:gap-2",children:e.jsxs("button",{className:"flex items-center gap-1 md:gap-2 hover:text-white transition",onClick:()=>s(!0),children:[e.jsx("span",{children:"Â©"}),e.jsx("span",{style:{letterSpacing:"0.05em"},children:"NINEDARTNATION"})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>s(!1),children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Legal Information"}),e.jsxs("ul",{className:"list-disc pl-5 mb-2",children:[e.jsx("li",{children:"Terms & Conditions: All users must follow fair play and site rules."}),e.jsx("li",{children:"Privacy Policy: Your data is protected and never shared without consent."}),e.jsxs("li",{children:["Copyright Â© ",new Date().getFullYear()," NINEDARTNATION. All rights reserved."]}),e.jsx("li",{children:"Contact: support@ninedartnation.com"})]}),e.jsx("p",{className:"text-sm text-purple-200",children:"For full legal details, please contact us or visit our legal page."})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>n(!1),children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Getting Started"}),e.jsxs("ul",{className:"list-disc pl-5 mb-2",children:[e.jsx("li",{children:"Choose a game mode and invite friends or play solo."}),e.jsx("li",{children:"Track your stats and progress in the Stats tab."}),e.jsx("li",{children:"Join the BullseyeDartsLeague for online competition."}),e.jsx("li",{children:"Upgrade to PREMIUM for advanced features and modes."}),e.jsx("li",{children:"Need help? Visit the Settings tab for support and tips."})]}),e.jsx("p",{className:"text-sm text-purple-200",children:'Ready to play? Hit "Start New Match" and let the darts fly!'})]})})]})}function Is({children:t,className:a,style:s}){const i=m.useRef(null);return m.useEffect(()=>{let n=0;const r=()=>{const d=i.current;if(!d)return;const c=document.getElementById("ndn-header");if(!c){d.style.clipPath="";return}const f=document.getElementById("ndn-main-scroll"),u=f?f.scrollTop:window.scrollY||0,x=c.getBoundingClientRect().height,p=u>0?x:0;d.style.marginTop=p>0?`${p}px`:"0px"};r();const l=()=>{n&&cancelAnimationFrame(n),n=requestAnimationFrame(r)},o=document.getElementById("ndn-main-scroll");return o?.addEventListener("scroll",l,{passive:!0}),window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l),()=>{o?.removeEventListener("scroll",l),window.removeEventListener("scroll",l),window.removeEventListener("resize",l),n&&cancelAnimationFrame(n)}},[]),e.jsx("div",{ref:i,className:a,style:s,children:t})}const Ac=({calibrationComplete:t})=>{const[a,s]=m.useState(!1),[i,n]=m.useState(!1);return m.useEffect(()=>{t?(s(!0),setTimeout(()=>n(!0),1200)):(s(!1),n(!1))},[t]),e.jsxs("div",{className:`flex flex-col items-center justify-center w-full h-full transition-opacity duration-700 ${i?"opacity-0":"opacity-100"}`,style:{pointerEvents:"none",position:"absolute",inset:0,zIndex:10},children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("svg",{width:"80",height:"80",viewBox:"0 0 80 80",className:`animate-spin-slow ${a?"opacity-0":"opacity-100"} transition-opacity duration-500`,style:{transition:"opacity 0.5s"},children:e.jsxs("g",{children:[e.jsx("rect",{x:"36",y:"10",width:"8",height:"40",rx:"3",fill:"#a78bfa"}),e.jsx("polygon",{points:"40,10 44,22 36,22",fill:"#f472b6"}),e.jsx("rect",{x:"36",y:"50",width:"8",height:"18",rx:"2",fill:"#22d3ee"}),e.jsx("polygon",{points:"36,68 44,68 40,78",fill:"#10b981"})]})}),a&&e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",className:"absolute",style:{left:0,top:0},children:[e.jsx("circle",{cx:"40",cy:"40",r:"32",fill:"none",stroke:"#10b981",strokeWidth:"6"}),e.jsx("polyline",{points:"28,44 38,54 54,30",fill:"none",stroke:"#10b981",strokeWidth:"6",strokeLinecap:"round",strokeLinejoin:"round"})]})]}),e.jsx("div",{className:"mt-4 text-lg font-semibold text-indigo-200",children:a?"Calibration Complete!":"Initializing Camera..."})]})};var yn={},Pa,pi;function Pc(){return pi||(pi=1,Pa=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),Pa}var Ra={},Hs={},bi;function ln(){if(bi)return Hs;bi=1;let t;const a=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Hs.getSymbolSize=function(i){if(!i)throw new Error('"version" cannot be null or undefined');if(i<1||i>40)throw new Error('"version" should be in range from 1 to 40');return i*4+17},Hs.getSymbolTotalCodewords=function(i){return a[i]},Hs.getBCHDigit=function(s){let i=0;for(;s!==0;)i++,s>>>=1;return i},Hs.setToSJISFunction=function(i){if(typeof i!="function")throw new Error('"toSJISFunc" is not a valid function.');t=i},Hs.isKanjiModeEnabled=function(){return typeof t<"u"},Hs.toSJIS=function(i){return t(i)},Hs}var La={},gi;function jr(){return gi||(gi=1,(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function a(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+s)}}t.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},t.from=function(i,n){if(t.isValid(i))return i;try{return a(i)}catch{return n}}})(La)),La}var Oa,yi;function Rc(){if(yi)return Oa;yi=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(a){const s=Math.floor(a/8);return(this.buffer[s]>>>7-a%8&1)===1},put:function(a,s){for(let i=0;i<s;i++)this.putBit((a>>>s-i-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(a){const s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),a&&(this.buffer[s]|=128>>>this.length%8),this.length++}},Oa=t,Oa}var Ba,vi;function Lc(){if(vi)return Ba;vi=1;function t(a){if(!a||a<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=a,this.data=new Uint8Array(a*a),this.reservedBit=new Uint8Array(a*a)}return t.prototype.set=function(a,s,i,n){const r=a*this.size+s;this.data[r]=i,n&&(this.reservedBit[r]=!0)},t.prototype.get=function(a,s){return this.data[a*this.size+s]},t.prototype.xor=function(a,s,i){this.data[a*this.size+s]^=i},t.prototype.isReserved=function(a,s){return this.reservedBit[a*this.size+s]},Ba=t,Ba}var Ua={},ji;function Oc(){return ji||(ji=1,(function(t){const a=ln().getSymbolSize;t.getRowColCoords=function(i){if(i===1)return[];const n=Math.floor(i/7)+2,r=a(i),l=r===145?26:Math.ceil((r-13)/(2*n-2))*2,o=[r-7];for(let d=1;d<n-1;d++)o[d]=o[d-1]-l;return o.push(6),o.reverse()},t.getPositions=function(i){const n=[],r=t.getRowColCoords(i),l=r.length;for(let o=0;o<l;o++)for(let d=0;d<l;d++)o===0&&d===0||o===0&&d===l-1||o===l-1&&d===0||n.push([r[o],r[d]]);return n}})(Ua)),Ua}var $a={},Ni;function Bc(){if(Ni)return $a;Ni=1;const t=ln().getSymbolSize,a=7;return $a.getPositions=function(i){const n=t(i);return[[0,0],[n-a,0],[0,n-a]]},$a}var Fa={},wi;function Uc(){return wi||(wi=1,(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const a={N1:3,N2:3,N3:40,N4:10};t.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7},t.from=function(n){return t.isValid(n)?parseInt(n,10):void 0},t.getPenaltyN1=function(n){const r=n.size;let l=0,o=0,d=0,c=null,f=null;for(let u=0;u<r;u++){o=d=0,c=f=null;for(let x=0;x<r;x++){let p=n.get(u,x);p===c?o++:(o>=5&&(l+=a.N1+(o-5)),c=p,o=1),p=n.get(x,u),p===f?d++:(d>=5&&(l+=a.N1+(d-5)),f=p,d=1)}o>=5&&(l+=a.N1+(o-5)),d>=5&&(l+=a.N1+(d-5))}return l},t.getPenaltyN2=function(n){const r=n.size;let l=0;for(let o=0;o<r-1;o++)for(let d=0;d<r-1;d++){const c=n.get(o,d)+n.get(o,d+1)+n.get(o+1,d)+n.get(o+1,d+1);(c===4||c===0)&&l++}return l*a.N2},t.getPenaltyN3=function(n){const r=n.size;let l=0,o=0,d=0;for(let c=0;c<r;c++){o=d=0;for(let f=0;f<r;f++)o=o<<1&2047|n.get(c,f),f>=10&&(o===1488||o===93)&&l++,d=d<<1&2047|n.get(f,c),f>=10&&(d===1488||d===93)&&l++}return l*a.N3},t.getPenaltyN4=function(n){let r=0;const l=n.data.length;for(let d=0;d<l;d++)r+=n.data[d];return Math.abs(Math.ceil(r*100/l/5)-10)*a.N4};function s(i,n,r){switch(i){case t.Patterns.PATTERN000:return(n+r)%2===0;case t.Patterns.PATTERN001:return n%2===0;case t.Patterns.PATTERN010:return r%3===0;case t.Patterns.PATTERN011:return(n+r)%3===0;case t.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2===0;case t.Patterns.PATTERN101:return n*r%2+n*r%3===0;case t.Patterns.PATTERN110:return(n*r%2+n*r%3)%2===0;case t.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}t.applyMask=function(n,r){const l=r.size;for(let o=0;o<l;o++)for(let d=0;d<l;d++)r.isReserved(d,o)||r.xor(d,o,s(n,d,o))},t.getBestMask=function(n,r){const l=Object.keys(t.Patterns).length;let o=0,d=1/0;for(let c=0;c<l;c++){r(c),t.applyMask(c,n);const f=t.getPenaltyN1(n)+t.getPenaltyN2(n)+t.getPenaltyN3(n)+t.getPenaltyN4(n);t.applyMask(c,n),f<d&&(d=f,o=c)}return o}})(Fa)),Fa}var Qn={},Si;function Eo(){if(Si)return Qn;Si=1;const t=jr(),a=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return Qn.getBlocksCount=function(n,r){switch(r){case t.L:return a[(n-1)*4+0];case t.M:return a[(n-1)*4+1];case t.Q:return a[(n-1)*4+2];case t.H:return a[(n-1)*4+3];default:return}},Qn.getTotalCodewordsCount=function(n,r){switch(r){case t.L:return s[(n-1)*4+0];case t.M:return s[(n-1)*4+1];case t.Q:return s[(n-1)*4+2];case t.H:return s[(n-1)*4+3];default:return}},Qn}var _a={},Pn={},ki;function $c(){if(ki)return Pn;ki=1;const t=new Uint8Array(512),a=new Uint8Array(256);return(function(){let i=1;for(let n=0;n<255;n++)t[n]=i,a[i]=n,i<<=1,i&256&&(i^=285);for(let n=255;n<512;n++)t[n]=t[n-255]})(),Pn.log=function(i){if(i<1)throw new Error("log("+i+")");return a[i]},Pn.exp=function(i){return t[i]},Pn.mul=function(i,n){return i===0||n===0?0:t[a[i]+a[n]]},Pn}var Ci;function Fc(){return Ci||(Ci=1,(function(t){const a=$c();t.mul=function(i,n){const r=new Uint8Array(i.length+n.length-1);for(let l=0;l<i.length;l++)for(let o=0;o<n.length;o++)r[l+o]^=a.mul(i[l],n[o]);return r},t.mod=function(i,n){let r=new Uint8Array(i);for(;r.length-n.length>=0;){const l=r[0];for(let d=0;d<n.length;d++)r[d]^=a.mul(n[d],l);let o=0;for(;o<r.length&&r[o]===0;)o++;r=r.slice(o)}return r},t.generateECPolynomial=function(i){let n=new Uint8Array([1]);for(let r=0;r<i;r++)n=t.mul(n,new Uint8Array([1,a.exp(r)]));return n}})(_a)),_a}var Wa,Ei;function _c(){if(Ei)return Wa;Ei=1;const t=Fc();function a(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}return a.prototype.initialize=function(i){this.degree=i,this.genPoly=t.generateECPolynomial(this.degree)},a.prototype.encode=function(i){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(i.length+this.degree);n.set(i);const r=t.mod(n,this.genPoly),l=this.degree-r.length;if(l>0){const o=new Uint8Array(this.degree);return o.set(r,l),o}return r},Wa=a,Wa}var Ha={},za={},qa={},Ti;function To(){return Ti||(Ti=1,qa.isValid=function(a){return!isNaN(a)&&a>=1&&a<=40}),qa}var Ms={},Ii;function Io(){if(Ii)return Ms;Ii=1;const t="[0-9]+",a="[A-Z $%*+\\-./:]+";let s="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";s=s.replace(/u/g,"\\u");const i="(?:(?![A-Z0-9 $%*+\\-./:]|"+s+`)(?:.|[\r
]))+`;Ms.KANJI=new RegExp(s,"g"),Ms.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Ms.BYTE=new RegExp(i,"g"),Ms.NUMERIC=new RegExp(t,"g"),Ms.ALPHANUMERIC=new RegExp(a,"g");const n=new RegExp("^"+s+"$"),r=new RegExp("^"+t+"$"),l=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Ms.testKanji=function(d){return n.test(d)},Ms.testNumeric=function(d){return r.test(d)},Ms.testAlphanumeric=function(d){return l.test(d)},Ms}var Mi;function cn(){return Mi||(Mi=1,(function(t){const a=To(),s=Io();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(r,l){if(!r.ccBits)throw new Error("Invalid mode: "+r);if(!a.isValid(l))throw new Error("Invalid version: "+l);return l>=1&&l<10?r.ccBits[0]:l<27?r.ccBits[1]:r.ccBits[2]},t.getBestModeForData=function(r){return s.testNumeric(r)?t.NUMERIC:s.testAlphanumeric(r)?t.ALPHANUMERIC:s.testKanji(r)?t.KANJI:t.BYTE},t.toString=function(r){if(r&&r.id)return r.id;throw new Error("Invalid mode")},t.isValid=function(r){return r&&r.bit&&r.ccBits};function i(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+n)}}t.from=function(r,l){if(t.isValid(r))return r;try{return i(r)}catch{return l}}})(za)),za}var Di;function Wc(){return Di||(Di=1,(function(t){const a=ln(),s=Eo(),i=jr(),n=cn(),r=To(),l=7973,o=a.getBCHDigit(l);function d(x,p,y){for(let C=1;C<=40;C++)if(p<=t.getCapacity(C,y,x))return C}function c(x,p){return n.getCharCountIndicator(x,p)+4}function f(x,p){let y=0;return x.forEach(function(C){const D=c(C.mode,p);y+=D+C.getBitsLength()}),y}function u(x,p){for(let y=1;y<=40;y++)if(f(x,y)<=t.getCapacity(y,p,n.MIXED))return y}t.from=function(p,y){return r.isValid(p)?parseInt(p,10):y},t.getCapacity=function(p,y,C){if(!r.isValid(p))throw new Error("Invalid QR Code version");typeof C>"u"&&(C=n.BYTE);const D=a.getSymbolTotalCodewords(p),T=s.getTotalCodewordsCount(p,y),N=(D-T)*8;if(C===n.MIXED)return N;const I=N-c(C,p);switch(C){case n.NUMERIC:return Math.floor(I/10*3);case n.ALPHANUMERIC:return Math.floor(I/11*2);case n.KANJI:return Math.floor(I/13);case n.BYTE:default:return Math.floor(I/8)}},t.getBestVersionForData=function(p,y){let C;const D=i.from(y,i.M);if(Array.isArray(p)){if(p.length>1)return u(p,D);if(p.length===0)return 1;C=p[0]}else C=p;return d(C.mode,C.getLength(),D)},t.getEncodedBits=function(p){if(!r.isValid(p)||p<7)throw new Error("Invalid QR Code version");let y=p<<12;for(;a.getBCHDigit(y)-o>=0;)y^=l<<a.getBCHDigit(y)-o;return p<<12|y}})(Ha)),Ha}var Va={},Ai;function Hc(){if(Ai)return Va;Ai=1;const t=ln(),a=1335,s=21522,i=t.getBCHDigit(a);return Va.getEncodedBits=function(r,l){const o=r.bit<<3|l;let d=o<<10;for(;t.getBCHDigit(d)-i>=0;)d^=a<<t.getBCHDigit(d)-i;return(o<<10|d)^s},Va}var Ga={},Ja,Pi;function zc(){if(Pi)return Ja;Pi=1;const t=cn();function a(s){this.mode=t.NUMERIC,this.data=s.toString()}return a.getBitsLength=function(i){return 10*Math.floor(i/3)+(i%3?i%3*3+1:0)},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(i){let n,r,l;for(n=0;n+3<=this.data.length;n+=3)r=this.data.substr(n,3),l=parseInt(r,10),i.put(l,10);const o=this.data.length-n;o>0&&(r=this.data.substr(n),l=parseInt(r,10),i.put(l,o*3+1))},Ja=a,Ja}var Ka,Ri;function qc(){if(Ri)return Ka;Ri=1;const t=cn(),a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(i){this.mode=t.ALPHANUMERIC,this.data=i}return s.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(n){let r;for(r=0;r+2<=this.data.length;r+=2){let l=a.indexOf(this.data[r])*45;l+=a.indexOf(this.data[r+1]),n.put(l,11)}this.data.length%2&&n.put(a.indexOf(this.data[r]),6)},Ka=s,Ka}var Ya,Li;function Vc(){if(Li)return Ya;Li=1;const t=cn();function a(s){this.mode=t.BYTE,typeof s=="string"?this.data=new TextEncoder().encode(s):this.data=new Uint8Array(s)}return a.getBitsLength=function(i){return i*8},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(s){for(let i=0,n=this.data.length;i<n;i++)s.put(this.data[i],8)},Ya=a,Ya}var Xa,Oi;function Gc(){if(Oi)return Xa;Oi=1;const t=cn(),a=ln();function s(i){this.mode=t.KANJI,this.data=i}return s.getBitsLength=function(n){return n*13},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(i){let n;for(n=0;n<this.data.length;n++){let r=a.toSJIS(this.data[n]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);r=(r>>>8&255)*192+(r&255),i.put(r,13)}},Xa=s,Xa}var Qa={exports:{}},Bi;function Jc(){return Bi||(Bi=1,(function(t){var a={single_source_shortest_paths:function(s,i,n){var r={},l={};l[i]=0;var o=a.PriorityQueue.make();o.push(i,0);for(var d,c,f,u,x,p,y,C,D;!o.empty();){d=o.pop(),c=d.value,u=d.cost,x=s[c]||{};for(f in x)x.hasOwnProperty(f)&&(p=x[f],y=u+p,C=l[f],D=typeof l[f]>"u",(D||C>y)&&(l[f]=y,o.push(f,y),r[f]=c))}if(typeof n<"u"&&typeof l[n]>"u"){var T=["Could not find a path from ",i," to ",n,"."].join("");throw new Error(T)}return r},extract_shortest_path_from_predecessor_list:function(s,i){for(var n=[],r=i;r;)n.push(r),s[r],r=s[r];return n.reverse(),n},find_path:function(s,i,n){var r=a.single_source_shortest_paths(s,i,n);return a.extract_shortest_path_from_predecessor_list(r,n)},PriorityQueue:{make:function(s){var i=a.PriorityQueue,n={},r;s=s||{};for(r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);return n.queue=[],n.sorter=s.sorter||i.default_sorter,n},default_sorter:function(s,i){return s.cost-i.cost},push:function(s,i){var n={value:s,cost:i};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=a})(Qa)),Qa.exports}var Ui;function Kc(){return Ui||(Ui=1,(function(t){const a=cn(),s=zc(),i=qc(),n=Vc(),r=Gc(),l=Io(),o=ln(),d=Jc();function c(T){return unescape(encodeURIComponent(T)).length}function f(T,N,I){const A=[];let M;for(;(M=T.exec(I))!==null;)A.push({data:M[0],index:M.index,mode:N,length:M[0].length});return A}function u(T){const N=f(l.NUMERIC,a.NUMERIC,T),I=f(l.ALPHANUMERIC,a.ALPHANUMERIC,T);let A,M;return o.isKanjiModeEnabled()?(A=f(l.BYTE,a.BYTE,T),M=f(l.KANJI,a.KANJI,T)):(A=f(l.BYTE_KANJI,a.BYTE,T),M=[]),N.concat(I,A,M).sort(function(b,g){return b.index-g.index}).map(function(b){return{data:b.data,mode:b.mode,length:b.length}})}function x(T,N){switch(N){case a.NUMERIC:return s.getBitsLength(T);case a.ALPHANUMERIC:return i.getBitsLength(T);case a.KANJI:return r.getBitsLength(T);case a.BYTE:return n.getBitsLength(T)}}function p(T){return T.reduce(function(N,I){const A=N.length-1>=0?N[N.length-1]:null;return A&&A.mode===I.mode?(N[N.length-1].data+=I.data,N):(N.push(I),N)},[])}function y(T){const N=[];for(let I=0;I<T.length;I++){const A=T[I];switch(A.mode){case a.NUMERIC:N.push([A,{data:A.data,mode:a.ALPHANUMERIC,length:A.length},{data:A.data,mode:a.BYTE,length:A.length}]);break;case a.ALPHANUMERIC:N.push([A,{data:A.data,mode:a.BYTE,length:A.length}]);break;case a.KANJI:N.push([A,{data:A.data,mode:a.BYTE,length:c(A.data)}]);break;case a.BYTE:N.push([{data:A.data,mode:a.BYTE,length:c(A.data)}])}}return N}function C(T,N){const I={},A={start:{}};let M=["start"];for(let k=0;k<T.length;k++){const b=T[k],g=[];for(let F=0;F<b.length;F++){const J=b[F],P=""+k+F;g.push(P),I[P]={node:J,lastCount:0},A[P]={};for(let H=0;H<M.length;H++){const E=M[H];I[E]&&I[E].node.mode===J.mode?(A[E][P]=x(I[E].lastCount+J.length,J.mode)-x(I[E].lastCount,J.mode),I[E].lastCount+=J.length):(I[E]&&(I[E].lastCount=J.length),A[E][P]=x(J.length,J.mode)+4+a.getCharCountIndicator(J.mode,N))}}M=g}for(let k=0;k<M.length;k++)A[M[k]].end=0;return{map:A,table:I}}function D(T,N){let I;const A=a.getBestModeForData(T);if(I=a.from(N,A),I!==a.BYTE&&I.bit<A.bit)throw new Error('"'+T+'" cannot be encoded with mode '+a.toString(I)+`.
 Suggested mode is: `+a.toString(A));switch(I===a.KANJI&&!o.isKanjiModeEnabled()&&(I=a.BYTE),I){case a.NUMERIC:return new s(T);case a.ALPHANUMERIC:return new i(T);case a.KANJI:return new r(T);case a.BYTE:return new n(T)}}t.fromArray=function(N){return N.reduce(function(I,A){return typeof A=="string"?I.push(D(A,null)):A.data&&I.push(D(A.data,A.mode)),I},[])},t.fromString=function(N,I){const A=u(N,o.isKanjiModeEnabled()),M=y(A),k=C(M,I),b=d.find_path(k.map,"start","end"),g=[];for(let F=1;F<b.length-1;F++)g.push(k.table[b[F]].node);return t.fromArray(p(g))},t.rawSplit=function(N){return t.fromArray(u(N,o.isKanjiModeEnabled()))}})(Ga)),Ga}var $i;function Yc(){if($i)return Ra;$i=1;const t=ln(),a=jr(),s=Rc(),i=Lc(),n=Oc(),r=Bc(),l=Uc(),o=Eo(),d=_c(),c=Wc(),f=Hc(),u=cn(),x=Kc();function p(k,b){const g=k.size,F=r.getPositions(b);for(let J=0;J<F.length;J++){const P=F[J][0],H=F[J][1];for(let E=-1;E<=7;E++)if(!(P+E<=-1||g<=P+E))for(let _=-1;_<=7;_++)H+_<=-1||g<=H+_||(E>=0&&E<=6&&(_===0||_===6)||_>=0&&_<=6&&(E===0||E===6)||E>=2&&E<=4&&_>=2&&_<=4?k.set(P+E,H+_,!0,!0):k.set(P+E,H+_,!1,!0))}}function y(k){const b=k.size;for(let g=8;g<b-8;g++){const F=g%2===0;k.set(g,6,F,!0),k.set(6,g,F,!0)}}function C(k,b){const g=n.getPositions(b);for(let F=0;F<g.length;F++){const J=g[F][0],P=g[F][1];for(let H=-2;H<=2;H++)for(let E=-2;E<=2;E++)H===-2||H===2||E===-2||E===2||H===0&&E===0?k.set(J+H,P+E,!0,!0):k.set(J+H,P+E,!1,!0)}}function D(k,b){const g=k.size,F=c.getEncodedBits(b);let J,P,H;for(let E=0;E<18;E++)J=Math.floor(E/3),P=E%3+g-8-3,H=(F>>E&1)===1,k.set(J,P,H,!0),k.set(P,J,H,!0)}function T(k,b,g){const F=k.size,J=f.getEncodedBits(b,g);let P,H;for(P=0;P<15;P++)H=(J>>P&1)===1,P<6?k.set(P,8,H,!0):P<8?k.set(P+1,8,H,!0):k.set(F-15+P,8,H,!0),P<8?k.set(8,F-P-1,H,!0):P<9?k.set(8,15-P-1+1,H,!0):k.set(8,15-P-1,H,!0);k.set(F-8,8,1,!0)}function N(k,b){const g=k.size;let F=-1,J=g-1,P=7,H=0;for(let E=g-1;E>0;E-=2)for(E===6&&E--;;){for(let _=0;_<2;_++)if(!k.isReserved(J,E-_)){let ae=!1;H<b.length&&(ae=(b[H]>>>P&1)===1),k.set(J,E-_,ae),P--,P===-1&&(H++,P=7)}if(J+=F,J<0||g<=J){J-=F,F=-F;break}}}function I(k,b,g){const F=new s;g.forEach(function(_){F.put(_.mode.bit,4),F.put(_.getLength(),u.getCharCountIndicator(_.mode,k)),_.write(F)});const J=t.getSymbolTotalCodewords(k),P=o.getTotalCodewordsCount(k,b),H=(J-P)*8;for(F.getLengthInBits()+4<=H&&F.put(0,4);F.getLengthInBits()%8!==0;)F.putBit(0);const E=(H-F.getLengthInBits())/8;for(let _=0;_<E;_++)F.put(_%2?17:236,8);return A(F,k,b)}function A(k,b,g){const F=t.getSymbolTotalCodewords(b),J=o.getTotalCodewordsCount(b,g),P=F-J,H=o.getBlocksCount(b,g),E=F%H,_=H-E,ae=Math.floor(F/H),L=Math.floor(P/H),Q=L+1,ce=ae-L,me=new d(ce);let _e=0;const ze=new Array(H),We=new Array(H);let at=0;const pe=new Uint8Array(k.buffer);for(let de=0;de<H;de++){const ot=de<_?L:Q;ze[de]=pe.slice(_e,_e+ot),We[de]=me.encode(ze[de]),_e+=ot,at=Math.max(at,ot)}const Ke=new Uint8Array(F);let pt=0,Ne,Pe;for(Ne=0;Ne<at;Ne++)for(Pe=0;Pe<H;Pe++)Ne<ze[Pe].length&&(Ke[pt++]=ze[Pe][Ne]);for(Ne=0;Ne<ce;Ne++)for(Pe=0;Pe<H;Pe++)Ke[pt++]=We[Pe][Ne];return Ke}function M(k,b,g,F){let J;if(Array.isArray(k))J=x.fromArray(k);else if(typeof k=="string"){let ae=b;if(!ae){const L=x.rawSplit(k);ae=c.getBestVersionForData(L,g)}J=x.fromString(k,ae||40)}else throw new Error("Invalid data");const P=c.getBestVersionForData(J,g);if(!P)throw new Error("The amount of data is too big to be stored in a QR Code");if(!b)b=P;else if(b<P)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+P+`.
`);const H=I(b,g,J),E=t.getSymbolSize(b),_=new i(E);return p(_,b),y(_),C(_,b),T(_,g,0),b>=7&&D(_,b),N(_,H),isNaN(F)&&(F=l.getBestMask(_,T.bind(null,_,g))),l.applyMask(F,_),T(_,g,F),{modules:_,version:b,errorCorrectionLevel:g,maskPattern:F,segments:J}}return Ra.create=function(b,g){if(typeof b>"u"||b==="")throw new Error("No input text");let F=a.M,J,P;return typeof g<"u"&&(F=a.from(g.errorCorrectionLevel,a.M),J=c.from(g.version),P=l.from(g.maskPattern),g.toSJISFunc&&t.setToSJISFunction(g.toSJISFunc)),M(b,J,F,P)},Ra}var Za={},er={},Fi;function Mo(){return Fi||(Fi=1,(function(t){function a(s){if(typeof s=="number"&&(s=s.toString()),typeof s!="string")throw new Error("Color should be defined as hex string");let i=s.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+s);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(r){return[r,r]}))),i.length===6&&i.push("F","F");const n=parseInt(i.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+i.slice(0,6).join("")}}t.getOptions=function(i){i||(i={}),i.color||(i.color={});const n=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,r=i.width&&i.width>=21?i.width:void 0,l=i.scale||4;return{width:r,scale:r?4:l,margin:n,color:{dark:a(i.color.dark||"#000000ff"),light:a(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},t.getScale=function(i,n){return n.width&&n.width>=i+n.margin*2?n.width/(i+n.margin*2):n.scale},t.getImageWidth=function(i,n){const r=t.getScale(i,n);return Math.floor((i+n.margin*2)*r)},t.qrToImageData=function(i,n,r){const l=n.modules.size,o=n.modules.data,d=t.getScale(l,r),c=Math.floor((l+r.margin*2)*d),f=r.margin*d,u=[r.color.light,r.color.dark];for(let x=0;x<c;x++)for(let p=0;p<c;p++){let y=(x*c+p)*4,C=r.color.light;if(x>=f&&p>=f&&x<c-f&&p<c-f){const D=Math.floor((x-f)/d),T=Math.floor((p-f)/d);C=u[o[D*l+T]?1:0]}i[y++]=C.r,i[y++]=C.g,i[y++]=C.b,i[y]=C.a}}})(er)),er}var _i;function Xc(){return _i||(_i=1,(function(t){const a=Mo();function s(n,r,l){n.clearRect(0,0,r.width,r.height),r.style||(r.style={}),r.height=l,r.width=l,r.style.height=l+"px",r.style.width=l+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(r,l,o){let d=o,c=l;typeof d>"u"&&(!l||!l.getContext)&&(d=l,l=void 0),l||(c=i()),d=a.getOptions(d);const f=a.getImageWidth(r.modules.size,d),u=c.getContext("2d"),x=u.createImageData(f,f);return a.qrToImageData(x.data,r,d),s(u,c,f),u.putImageData(x,0,0),c},t.renderToDataURL=function(r,l,o){let d=o;typeof d>"u"&&(!l||!l.getContext)&&(d=l,l=void 0),d||(d={});const c=t.render(r,l,d),f=d.type||"image/png",u=d.rendererOpts||{};return c.toDataURL(f,u.quality)}})(Za)),Za}var tr={},Wi;function Qc(){if(Wi)return tr;Wi=1;const t=Mo();function a(n,r){const l=n.a/255,o=r+'="'+n.hex+'"';return l<1?o+" "+r+'-opacity="'+l.toFixed(2).slice(1)+'"':o}function s(n,r,l){let o=n+r;return typeof l<"u"&&(o+=" "+l),o}function i(n,r,l){let o="",d=0,c=!1,f=0;for(let u=0;u<n.length;u++){const x=Math.floor(u%r),p=Math.floor(u/r);!x&&!c&&(c=!0),n[u]?(f++,u>0&&x>0&&n[u-1]||(o+=c?s("M",x+l,.5+p+l):s("m",d,0),d=0,c=!1),x+1<r&&n[u+1]||(o+=s("h",f),f=0)):d++}return o}return tr.render=function(r,l,o){const d=t.getOptions(l),c=r.modules.size,f=r.modules.data,u=c+d.margin*2,x=d.color.light.a?"<path "+a(d.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",p="<path "+a(d.color.dark,"stroke")+' d="'+i(f,c,d.margin)+'"/>',y='viewBox="0 0 '+u+" "+u+'"',D='<svg xmlns="http://www.w3.org/2000/svg" '+(d.width?'width="'+d.width+'" height="'+d.width+'" ':"")+y+' shape-rendering="crispEdges">'+x+p+`</svg>
`;return typeof o=="function"&&o(null,D),D},tr}var Hi;function Zc(){if(Hi)return yn;Hi=1;const t=Pc(),a=Yc(),s=Xc(),i=Qc();function n(r,l,o,d,c){const f=[].slice.call(arguments,1),u=f.length,x=typeof f[u-1]=="function";if(!x&&!t())throw new Error("Callback required as last argument");if(x){if(u<2)throw new Error("Too few arguments provided");u===2?(c=o,o=l,l=d=void 0):u===3&&(l.getContext&&typeof c>"u"?(c=d,d=void 0):(c=d,d=o,o=l,l=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(o=l,l=d=void 0):u===2&&!l.getContext&&(d=o,o=l,l=void 0),new Promise(function(p,y){try{const C=a.create(o,d);p(r(C,l,d))}catch(C){y(C)}})}try{const p=a.create(o,d);c(null,r(p,l,d))}catch(p){c(p)}}return yn.create=a.create,yn.toCanvas=n.bind(null,s.render),yn.toDataURL=n.bind(null,s.renderToDataURL),yn.toString=n.bind(null,function(r,l,o){return i.render(r,o)}),yn}var ed=Zc();const Do=ca(ed),td={};function Ao(t,a){let s;try{s=t()}catch{return}return{getItem:n=>{var r;const l=d=>d===null?null:JSON.parse(d,void 0),o=(r=s.getItem(n))!=null?r:null;return o instanceof Promise?o.then(l):l(o)},setItem:(n,r)=>s.setItem(n,JSON.stringify(r,void 0)),removeItem:n=>s.removeItem(n)}}const _n=t=>a=>{try{const s=t(a);return s instanceof Promise?s:{then(i){return _n(i)(s)},catch(i){return this}}}catch(s){return{then(i){return this},catch(i){return _n(i)(s)}}}},sd=(t,a)=>(s,i,n)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:D=>D,version:0,merge:(D,T)=>({...T,...D}),...a},l=!1;const o=new Set,d=new Set;let c;try{c=r.getStorage()}catch{}if(!c)return t((...D)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...D)},i,n);const f=_n(r.serialize),u=()=>{const D=r.partialize({...i()});let T;const N=f({state:D,version:r.version}).then(I=>c.setItem(r.name,I)).catch(I=>{T=I});if(T)throw T;return N},x=n.setState;n.setState=(D,T)=>{x(D,T),u()};const p=t((...D)=>{s(...D),u()},i,n);let y;const C=()=>{var D;if(!c)return;l=!1,o.forEach(N=>N(i()));const T=((D=r.onRehydrateStorage)==null?void 0:D.call(r,i()))||void 0;return _n(c.getItem.bind(c))(r.name).then(N=>{if(N)return r.deserialize(N)}).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==r.version){if(r.migrate)return r.migrate(N.state,N.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return N.state}).then(N=>{var I;return y=r.merge(N,(I=i())!=null?I:p),s(y,!0),u()}).then(()=>{T?.(y,void 0),l=!0,d.forEach(N=>N(y))}).catch(N=>{T?.(void 0,N)})};return n.persist={setOptions:D=>{r={...r,...D},D.getStorage&&(c=D.getStorage())},clearStorage:()=>{c?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>C(),hasHydrated:()=>l,onHydrate:D=>(o.add(D),()=>{o.delete(D)}),onFinishHydration:D=>(d.add(D),()=>{d.delete(D)})},C(),y||p},nd=(t,a)=>(s,i,n)=>{let r={storage:Ao(()=>localStorage),partialize:C=>C,version:0,merge:(C,D)=>({...D,...C}),...a},l=!1;const o=new Set,d=new Set;let c=r.storage;if(!c)return t((...C)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...C)},i,n);const f=()=>{const C=r.partialize({...i()});return c.setItem(r.name,{state:C,version:r.version})},u=n.setState;n.setState=(C,D)=>{u(C,D),f()};const x=t((...C)=>{s(...C),f()},i,n);n.getInitialState=()=>x;let p;const y=()=>{var C,D;if(!c)return;l=!1,o.forEach(N=>{var I;return N((I=i())!=null?I:x)});const T=((D=r.onRehydrateStorage)==null?void 0:D.call(r,(C=i())!=null?C:x))||void 0;return _n(c.getItem.bind(c))(r.name).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==r.version){if(r.migrate)return[!0,r.migrate(N.state,N.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,N.state];return[!1,void 0]}).then(N=>{var I;const[A,M]=N;if(p=r.merge(M,(I=i())!=null?I:x),s(p,!0),A)return f()}).then(()=>{T?.(p,void 0),p=i(),l=!0,d.forEach(N=>N(p))}).catch(N=>{T?.(void 0,N)})};return n.persist={setOptions:C=>{r={...r,...C},C.storage&&(c=C.storage)},clearStorage:()=>{c?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>y(),hasHydrated:()=>l,onHydrate:C=>(o.add(C),()=>{o.delete(C)}),onFinishHydration:C=>(d.add(C),()=>{d.delete(C)})},r.skipHydration||y(),p||x},ad=(t,a)=>"getStorage"in a||"serialize"in a||"deserialize"in a?((td?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),sd(t,a)):nd(t,a),rd=ad,Nr=on()(rd((t,a)=>({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1,setCalibration:s=>t(i=>({...i,...s})),reset:()=>t({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1})}),{name:"ndn-calibration-v1",storage:Ao(()=>localStorage),onRehydrateStorage:()=>(t,a)=>{if(!a)try{if(t&&!t.H){const s=localStorage.getItem("ndn:calibration:v1");if(s){const i=JSON.parse(s);i&&(i.H||i.imageSize)&&t.setCalibration({H:i.H??null,createdAt:i.createdAt??null,errorPx:i.errorPx??null,imageSize:i.imageSize??null,anchors:i.anchors??null,locked:!!i.locked})}}}catch{}}})),Fe={bullInner:6.35,bullOuter:15.9,trebleInner:99,trebleOuter:107,doubleInner:162,doubleOuter:170},id=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];function wr(t,a){const s=a.x,i=a.y,n=t[6]*s+t[7]*i+t[8],r=(t[0]*s+t[1]*i+t[2])/n,l=(t[3]*s+t[4]*i+t[5])/n;return{x:r,y:l}}function od(t,a,s){return[a*t[0],a*t[1],a*t[2],s*t[3],s*t[4],s*t[5],t[6],t[7],t[8]]}function ld(t){const a=t,s=a[0],i=a[1],n=a[2],r=a[3],l=a[4],o=a[5],d=a[6],c=a[7],f=a[8],u=l*f-o*c,x=n*c-i*f,p=i*o-n*l,y=o*d-r*f,C=s*f-n*d,D=n*r-s*o,T=r*c-l*d,N=i*d-s*c,I=s*l-i*r,A=s*u+i*y+n*T;if(Math.abs(A)<1e-12)throw new Error("Singular homography");return[u/A,x/A,p/A,y/A,C/A,D/A,T/A,N/A,I/A]}function Po(t,a){if(t.length!==4||a.length!==4)throw new Error("Need exactly 4 correspondences");const s=[],i=[];for(let l=0;l<4;l++){const{x:o,y:d}=t[l],{x:c,y:f}=a[l];s.push([o,d,1,0,0,0,-c*o,-c*d]),i.push(c),s.push([0,0,0,o,d,1,-f*o,-f*d]),i.push(f)}const n=cd(s,i);return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],1]}function cd(t,a){const s=t.length,i=t[0].length,n=Array.from({length:i},()=>new Array(i).fill(0)),r=new Array(i).fill(0);for(let l=0;l<s;l++)for(let o=0;o<i;o++){r[o]+=t[l][o]*a[l];for(let d=0;d<i;d++)n[o][d]+=t[l][o]*t[l][d]}return dd(n,r)}function dd(t,a){const s=a.length,i=t.map((r,l)=>r.concat([a[l]]));for(let r=0;r<s;r++){let l=r;for(let o=r+1;o<s;o++)Math.abs(i[o][r])>Math.abs(i[l][r])&&(l=o);if(Math.abs(i[l][r])<1e-12)throw new Error("Singular matrix");if(l!==r){const o=i[r];i[r]=i[l],i[l]=o}for(let o=r+1;o<s;o++){const d=i[o][r]/i[r][r];for(let c=r;c<=s;c++)i[o][c]-=d*i[r][c]}}const n=new Array(s).fill(0);for(let r=s-1;r>=0;r--){let l=i[r][s];for(let o=r+1;o<s;o++)l-=i[r][o]*n[o];n[r]=l/i[r][r]}return n}function ur(){const t=Fe.doubleOuter;return[{x:0,y:-t},{x:t,y:0},{x:0,y:t},{x:-t,y:0}]}function Ro(t,a,s=256){const i=[];for(let n=0;n<s;n++){const r=n/s*Math.PI*2,l=wr(t,{x:a*Math.cos(r),y:a*Math.sin(r)});i.push(l)}return i}function Lo(t,a,s){let i=0;for(let n=0;n<a.length;n++){const r=wr(t,a[n]),l=r.x-s[n].x,o=r.y-s[n].y;i+=l*l+o*o}return Math.sqrt(i/a.length)}function md(t,a){const s=ld(t);return wr(s,a)}function ud(t){const a=Math.hypot(t.x,t.y);let i=Math.atan2(t.y,t.x)*180/Math.PI;i=(i+360+90)%360;const n=id[Math.floor((360-i)%360/18)];return a<=Fe.bullInner?{base:50,ring:"INNER_BULL",sector:25,mult:2}:a<=Fe.bullOuter?{base:25,ring:"BULL",sector:25,mult:1}:a>=Fe.doubleOuter?{base:0,ring:"MISS",sector:null,mult:0}:a>=Fe.doubleInner?{base:n*2,ring:"DOUBLE",sector:n,mult:2}:a>=Fe.trebleOuter?{base:n,ring:"SINGLE",sector:n,mult:1}:a>=Fe.trebleInner?{base:n*3,ring:"TRIPLE",sector:n,mult:3}:{base:n,ring:"SINGLE",sector:n,mult:1}}function Oo(t,a,s="#10b981",i=2){if(a.length){t.save(),t.strokeStyle=s,t.lineWidth=i,t.beginPath(),t.moveTo(a[0].x,a[0].y);for(let n=1;n<a.length;n++)t.lineTo(a[n].x,a[n].y);t.closePath(),t.stroke(),t.restore()}}function hd(t,a,s="#f59e0b"){t.save(),t.strokeStyle=s,t.lineWidth=2,t.beginPath(),t.moveTo(a.x-8,a.y),t.lineTo(a.x+8,a.y),t.moveTo(a.x,a.y-8),t.lineTo(a.x,a.y+8),t.stroke(),t.restore()}function ra(t,a,s){return Math.max(a,Math.min(s,t))}function fd(t,a,s){const{width:i,data:n}=t,r=[[-1,0,1],[-2,0,2],[-1,0,1]],l=[[-1,-2,-1],[0,0,0],[1,2,1]];let o=0,d=0;for(let c=-1;c<=1;c++)for(let f=-1;f<=1;f++){const u=ra(a+f,0,i-1),p=(ra(s+c,0,t.height-1)*i+u)*4,y=n[p],C=n[p+1],D=n[p+2],T=.299*y+.587*C+.114*D;o+=T*r[c+1][f+1],d+=T*l[c+1][f+1]}return Math.hypot(o,d)}function xd(t,a,s=6){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),r=ra(Math.round(a.x),1,t.width-2),l=ra(Math.round(a.y),1,t.height-2);let o={x:r,y:l,mag:-1};for(let d=l-s;d<=l+s;d++)for(let c=r-s;c<=r+s;c++){if(c<=0||d<=0||c>=t.width-1||d>=t.height-1)continue;const f=fd(n,c,d);f>o.mag&&(o={x:c,y:d,mag:f})}return{x:o.x,y:o.y}}function pd(t,a,s=6){return a.map(i=>xd(t,i,s))}var sr,zi;function Bo(){if(zi)return sr;zi=1;var t=t||{};return t.Image=function(a,s,i){this.width=a||0,this.height=s||0,this.data=i||[]},t.grayscale=function(a,s){for(var i=a.data,n=s.data,r=i.length,l=0,o=0;l<r;l+=4)n[o++]=i[l]*.299+i[l+1]*.587+i[l+2]*.114+.5&255;return s.width=a.width,s.height=a.height,s},t.threshold=function(a,s,i){var n=a.data,r=s.data,l=n.length,o=[],d;for(d=0;d<256;++d)o[d]=d<=i?0:255;for(d=0;d<l;++d)r[d]=o[n[d]];return s.width=a.width,s.height=a.height,s},t.adaptiveThreshold=function(a,s,i,n){var r=a.data,l=s.data,o=r.length,d=[],c;for(t.stackBoxBlur(a,s,i),c=0;c<768;++c)d[c]=c-255<=-n?255:0;for(c=0;c<o;++c)l[c]=d[r[c]-l[c]+255];return s.width=a.width,s.height=a.height,s},t.otsu=function(a){var s=a.data,i=s.length,n=[],r=0,l=0,o=0,d=0,c=0,f=0,u,x,p;for(p=0;p<256;++p)n[p]=0;for(p=0;p<i;++p)n[s[p]]++;for(p=0;p<256;++p)l+=n[p]*p;for(p=0;p<256;++p)if(d+=n[p],d!==0){if(c=i-d,c===0)break;o+=n[p]*p,u=o/d-(l-o)/c,x=d*c*u*u,x>f&&(f=x,r=p)}return r},t.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265],t.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13],t.BlurStack=function(){this.color=0,this.next=null},t.stackBoxBlur=function(a,s,i){var n=a.data,r=s.data,l=a.height,o=a.width,d=l-1,c=o-1,f=i+i+1,u=i+1,x=t.stackBoxBlurMult[i],p=t.stackBoxBlurShift[i],y,C,D,T,N,I,A,M,k,b;for(y=C=new t.BlurStack,b=1;b<f;++b)y=y.next=new t.BlurStack;for(y.next=C,N=0,k=0;k<l;++k){for(I=N,D=n[N],T=u*D,y=C,b=0;b<u;++b)y.color=D,y=y.next;for(b=1;b<u;++b)y.color=n[N+b],T+=y.color,y=y.next;for(y=C,M=0;M<o;++M)r[N++]=T*x>>>p,A=M+u,A=I+(A<c?A:c),T-=y.color-n[A],y.color=n[A],y=y.next}for(M=0;M<o;++M){for(N=M,I=N+o,D=r[N],T=u*D,y=C,b=0;b<u;++b)y.color=D,y=y.next;for(b=1;b<u;++b)y.color=r[I],T+=y.color,y=y.next,I+=o;for(y=C,k=0;k<l;++k)r[N]=T*x>>>p,A=k+u,A=M+(A<d?A:d)*o,T-=y.color-r[A],y.color=r[A],y=y.next,N+=o}return s},t.gaussianBlur=function(a,s,i,n){var r=t.gaussianKernel(n);return s.width=a.width,s.height=a.height,i.width=a.width,i.height=a.height,t.gaussianBlurFilter(a,i,r,!0),t.gaussianBlurFilter(i,s,r,!1),s},t.gaussianBlurFilter=function(a,s,i,n){var r=a.data,l=s.data,o=a.height,d=a.width,c=0,f=i.length>>1,u,x,p,y,C;for(p=0;p<o;++p)for(y=0;y<d;++y){for(x=0,C=-f;C<=f;++C)n?(u=c+C,(y+C<0||y+C>=d)&&(u=c)):(u=c+C*d,(p+C<0||p+C>=o)&&(u=c)),x+=i[f+C]*r[u];l[c++]=n?x:x+.5&255}return s},t.gaussianKernel=function(a){var s=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],i=[],n,r,l,o,d,c;if(a<=7&&a%2===1)i=s[a>>1];else{for(n=(a-1)*.5,r=.8+.3*(n-1),l=-.5/(r*r),o=0,c=0;c<a;++c)d=c-n,o+=i[c]=Math.exp(l*d*d);for(o=1/o,c=0;c<a;++c)i[c]*=o}return i},t.findContours=function(a,s){var i=a.width,n=a.height,r=[],l,o,d,c,f,u,x,p,y;for(l=t.binaryBorder(a,s),o=t.neighborhoodDeltas(i+2),d=i+3,f=1,p=0;p<n;++p,d+=2)for(y=0;y<i;++y,++d)c=l[d],c!==0&&(u=x=!1,c===1&&l[d-1]===0?u=!0:c>=1&&l[d+1]===0&&(x=!0),(u||x)&&(++f,r.push(t.borderFollowing(l,d,f,{x:y,y:p},x,o))));return r},t.borderFollowing=function(a,s,i,n,r,l){var o=[],d,c,f,u,x;o.hole=r,u=x=r?0:4;do if(u=u-1&7,d=s+l[u],a[d]!==0)break;while(u!==x);if(u===x)a[s]=-i,o.push({x:n.x,y:n.y});else for(c=s;;){x=u;do f=c+l[++u];while(a[f]===0);if(u&=7,u-1>>>0<x>>>0?a[c]=-i:a[c]===1&&(a[c]=i),o.push({x:n.x,y:n.y}),n.x+=t.neighborhood[u][0],n.y+=t.neighborhood[u][1],f===s&&c===d)break;c=f,u=u+4&7}return o},t.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],t.neighborhoodDeltas=function(a){for(var s=[],i=t.neighborhood.length,n=0;n<i;++n)s[n]=t.neighborhood[n][0]+t.neighborhood[n][1]*a;return s.concat(s)},t.approxPolyDP=function(a,s){var i={start_index:0,end_index:0},n={start_index:0,end_index:0},r=[],l=[],o=a.length,d,c,f,u,x,p,y,C,D,T,N;for(s*=s,N=0,D=0;D<3;++D)for(x=0,N=(N+n.start_index)%o,c=a[N],++N===o&&(N=0),T=1;T<o;++T)d=a[N],++N===o&&(N=0),y=d.x-c.x,C=d.y-c.y,u=y*y+C*C,u>x&&(x=u,n.start_index=T);for(x<=s?r.push({x:c.x,y:c.y}):(i.start_index=N,i.end_index=n.start_index+=i.start_index,n.start_index-=n.start_index>=o?o:0,n.end_index=i.start_index,n.end_index<n.start_index&&(n.end_index+=o),l.push({start_index:n.start_index,end_index:n.end_index}),l.push({start_index:i.start_index,end_index:i.end_index}));l.length!==0;){if(i=l.pop(),f=a[i.end_index%o],c=a[N=i.start_index%o],++N===o&&(N=0),i.end_index<=i.start_index+1)p=!0;else{for(x=0,y=f.x-c.x,C=f.y-c.y,D=i.start_index+1;D<i.end_index;++D)d=a[N],++N===o&&(N=0),u=Math.abs((d.y-c.y)*y-(d.x-c.x)*C),u>x&&(x=u,n.start_index=D);p=x*x<=s*(y*y+C*C)}p?r.push({x:c.x,y:c.y}):(n.end_index=i.end_index,i.end_index=n.start_index,l.push({start_index:n.start_index,end_index:n.end_index}),l.push({start_index:i.start_index,end_index:i.end_index}))}return r},t.warp=function(a,s,i,n){var r=a.data,l=s.data,o=a.width,d=a.height,c=0,f,u,x,p,y,C,D,T,N,I,A,M,k,b,g,F,J,P,H,E,_,ae,L;for(k=t.getPerspectiveTransform(i,n-1),b=k[8],g=k[2],F=k[5],ae=0;ae<n;++ae)for(b+=k[7],g+=k[1],F+=k[4],J=b,P=g,H=F,L=0;L<n;++L)J+=k[6],P+=k[0],H+=k[3],E=P/J,_=H/J,f=E>>>0,u=f===o-1?f:f+1,x=E-f,p=1-x,y=_>>>0,C=y===d-1?y:y+1,D=_-y,T=1-D,N=I=y*o,A=M=C*o,l[c++]=T*(p*r[N+f]+x*r[I+u])+D*(p*r[A+f]+x*r[M+u])&255;return s.width=n,s.height=n,s},t.getPerspectiveTransform=function(a,s){var i=t.square2quad(a);return i[0]/=s,i[1]/=s,i[3]/=s,i[4]/=s,i[6]/=s,i[7]/=s,i},t.square2quad=function(a){var s=[],i,n,r,l,o,d,c;return i=a[0].x-a[1].x+a[2].x-a[3].x,n=a[0].y-a[1].y+a[2].y-a[3].y,i===0&&n===0?(s[0]=a[1].x-a[0].x,s[1]=a[2].x-a[1].x,s[2]=a[0].x,s[3]=a[1].y-a[0].y,s[4]=a[2].y-a[1].y,s[5]=a[0].y,s[6]=0,s[7]=0,s[8]=1):(r=a[1].x-a[2].x,l=a[3].x-a[2].x,o=a[1].y-a[2].y,d=a[3].y-a[2].y,c=r*d-l*o,s[6]=(i*d-l*n)/c,s[7]=(r*n-i*o)/c,s[8]=1,s[0]=a[1].x-a[0].x+s[6]*a[1].x,s[1]=a[3].x-a[0].x+s[7]*a[3].x,s[2]=a[0].x,s[3]=a[1].y-a[0].y+s[6]*a[1].y,s[4]=a[3].y-a[0].y+s[7]*a[3].y,s[5]=a[0].y),s},t.isContourConvex=function(a){var s=0,i=!0,n=a.length,r=0,l=0,o,d,c,f,u,x,p,y;for(d=a[n-1],o=a[0],u=o.x-d.x,x=o.y-d.y;r<n;++r){if(++l===n&&(l=0),d=o,o=a[l],p=o.x-d.x,y=o.y-d.y,c=p*x,f=y*u,s|=f>c?1:f<c?2:3,s===3){i=!1;break}u=p,x=y}return i},t.perimeter=function(a){for(var s=a.length,i=0,n=s-1,r=0,l,o;i<s;n=i++)l=a[i].x-a[n].x,o=a[i].y-a[n].y,r+=Math.sqrt(l*l+o*o);return r},t.minEdgeLength=function(a){for(var s=a.length,i=0,n=s-1,r=1/0,l,o,d;i<s;n=i++)o=a[i].x-a[n].x,d=a[i].y-a[n].y,l=o*o+d*d,l<r&&(r=l);return Math.sqrt(r)},t.countNonZero=function(a,s){var i=a.data,n=s.height,r=s.width,l=s.x+s.y*a.width,o=a.width-r,d=0,c,f;for(c=0;c<n;++c){for(f=0;f<r;++f)i[l++]!==0&&++d;l+=o}return d},t.binaryBorder=function(a,s){var i=a.data,n=a.height,r=a.width,l=0,o=0,d,c;for(c=-2;c<r;++c)s[o++]=0;for(d=0;d<n;++d){for(s[o++]=0,c=0;c<r;++c)s[o++]=i[l++]===0?0:1;s[o++]=0}for(c=-2;c<r;++c)s[o++]=0;return s},sr=t,sr}var nr,qi;function bd(){if(qi)return nr;qi=1;var t=Bo(),a=a||{};return a.Marker=function(s,i){this.id=s,this.corners=i},a.Detector=function(){this.grey=new t.Image,this.thres=new t.Image,this.homography=new t.Image,this.binary=[],this.contours=[],this.polys=[],this.candidates=[]},a.Detector.prototype.detect=function(s){return t.grayscale(s,this.grey),t.adaptiveThreshold(this.grey,this.thres,2,7),this.contours=t.findContours(this.thres,this.binary),this.candidates=this.findCandidates(this.contours,s.width*.2,.05,10),this.candidates=this.clockwiseCorners(this.candidates),this.candidates=this.notTooNear(this.candidates,10),this.findMarkers(this.grey,this.candidates,49)},a.Detector.prototype.findCandidates=function(s,i,n,r){var l=[],o=s.length,d,c,f;for(this.polys=[],f=0;f<o;++f)d=s[f],d.length>=i&&(c=t.approxPolyDP(d,d.length*n),this.polys.push(c),c.length===4&&t.isContourConvex(c)&&t.minEdgeLength(c)>=r&&l.push(c));return l},a.Detector.prototype.clockwiseCorners=function(s){var i=s.length,n,r,l,o,d,c;for(c=0;c<i;++c)n=s[c][1].x-s[c][0].x,l=s[c][1].y-s[c][0].y,r=s[c][2].x-s[c][0].x,o=s[c][2].y-s[c][0].y,n*o-l*r<0&&(d=s[c][1],s[c][1]=s[c][3],s[c][3]=d);return s},a.Detector.prototype.notTooNear=function(s,i){var n=[],r=s.length,l,o,d,c,f,u;for(c=0;c<r;++c)for(f=c+1;f<r;++f){for(l=0,u=0;u<4;++u)o=s[c][u].x-s[f][u].x,d=s[c][u].y-s[f][u].y,l+=o*o+d*d;l/4<i*i&&(t.perimeter(s[c])<t.perimeter(s[f])?s[c].tooNear=!0:s[f].tooNear=!0)}for(c=0;c<r;++c)s[c].tooNear||n.push(s[c]);return n},a.Detector.prototype.findMarkers=function(s,i,n){var r=[],l=i.length,o,d,c;for(c=0;c<l;++c)o=i[c],t.warp(s,this.homography,o,n),t.threshold(this.homography,this.homography,t.otsu(this.homography)),d=this.getMarker(this.homography,o),d&&r.push(d);return r},a.Detector.prototype.getMarker=function(s,i){var n=s.width/7>>>0,r=n*n>>1,l=[],o=[],d=[],c,f,u,x,p;for(x=0;x<7;++x)for(u=x===0||x===6?1:6,p=0;p<7;p+=u)if(c={x:p*n,y:x*n,width:n,height:n},t.countNonZero(s,c)>r)return null;for(x=0;x<5;++x)for(l[x]=[],p=0;p<5;++p)c={x:(p+1)*n,y:(x+1)*n,width:n,height:n},l[x][p]=t.countNonZero(s,c)>r?1:0;for(o[0]=l,d[0]=this.hammingDistance(o[0]),f={first:d[0],second:0},x=1;x<4;++x)o[x]=this.rotate(o[x-1]),d[x]=this.hammingDistance(o[x]),d[x]<f.first&&(f.first=d[x],f.second=x);return f.first!==0?null:new a.Marker(this.mat2id(o[f.second]),this.rotate2(i,4-f.second))},a.Detector.prototype.hammingDistance=function(s){var i=[[1,0,0,0,0],[1,0,1,1,1],[0,1,0,0,1],[0,1,1,1,0]],n=0,r,l,o,d,c;for(o=0;o<5;++o){for(l=1/0,d=0;d<4;++d){for(r=0,c=0;c<5;++c)r+=s[o][c]===i[d][c]?0:1;r<l&&(l=r)}n+=l}return n},a.Detector.prototype.mat2id=function(s){var i=0,n;for(n=0;n<5;++n)i<<=1,i|=s[n][1],i<<=1,i|=s[n][3];return i},a.Detector.prototype.rotate=function(s){var i=[],n=s.length,r,l;for(r=0;r<n;++r)for(i[r]=[],l=0;l<s[r].length;++l)i[r][l]=s[s[r].length-l-1][r];return i},a.Detector.prototype.rotate2=function(s,i){var n=[],r=s.length,l;for(l=0;l<r;++l)n[l]=s[(i+l)%r];return n},nr=a,nr}var ar,Vi;function Sr(){if(Vi)return ar;Vi=1;var t=t||{};return t.svdcmp=function(a,s,i,n,r){var l,o,d,c,f,u,x,p,y=0,C,D,T=0,N,I,A=0,M,k,b,g=[];for(o=0;o<i;++o){if(x=o+1,g[o]=A*T,T=I=A=0,o<s){for(u=o;u<s;++u)A+=Math.abs(a[u][o]);if(A!==0){for(u=o;u<s;++u)a[u][o]/=A,I+=a[u][o]*a[u][o];for(D=a[o][o],T=-t.sign(Math.sqrt(I),D),N=D*T-I,a[o][o]=D-T,c=x;c<i;++c){for(I=0,u=o;u<s;++u)I+=a[u][o]*a[u][c];for(D=I/N,u=o;u<s;++u)a[u][c]+=D*a[u][o]}for(u=o;u<s;++u)a[u][o]*=A}}if(n[o]=A*T,T=I=A=0,o<s&&o!==i-1){for(u=x;u<i;++u)A+=Math.abs(a[o][u]);if(A!==0){for(u=x;u<i;++u)a[o][u]/=A,I+=a[o][u]*a[o][u];for(D=a[o][x],T=-t.sign(Math.sqrt(I),D),N=D*T-I,a[o][x]=D-T,u=x;u<i;++u)g[u]=a[o][u]/N;for(c=x;c<s;++c){for(I=0,u=x;u<i;++u)I+=a[c][u]*a[o][u];for(u=x;u<i;++u)a[c][u]+=I*g[u]}for(u=x;u<i;++u)a[o][u]*=A}}y=Math.max(y,Math.abs(n[o])+Math.abs(g[o]))}for(o=i-1;o>=0;--o){if(o<i-1){if(T!==0){for(c=x;c<i;++c)r[c][o]=a[o][c]/a[o][x]/T;for(c=x;c<i;++c){for(I=0,u=x;u<i;++u)I+=a[o][u]*r[u][c];for(u=x;u<i;++u)r[u][c]+=I*r[u][o]}}for(c=x;c<i;++c)r[o][c]=r[c][o]=0}r[o][o]=1,T=g[o],x=o}for(o=Math.min(i,s)-1;o>=0;--o){for(x=o+1,T=n[o],c=x;c<i;++c)a[o][c]=0;if(T!==0){for(T=1/T,c=x;c<i;++c){for(I=0,u=x;u<s;++u)I+=a[u][o]*a[u][c];for(D=I/a[o][o]*T,u=o;u<s;++u)a[u][c]+=D*a[u][o]}for(c=o;c<s;++c)a[c][o]*=T}else for(c=o;c<s;++c)a[c][o]=0;++a[o][o]}for(u=i-1;u>=0;--u)for(d=1;d<=30;++d){for(l=!0,x=u;x>=0;--x){if(p=x-1,Math.abs(g[x])+y===y){l=!1;break}if(Math.abs(n[p])+y===y)break}if(l)for(C=0,I=1,o=x;o<=u&&(D=I*g[o],Math.abs(D)+y!==y);++o)for(T=n[o],N=t.pythag(D,T),n[o]=N,N=1/N,C=T*N,I=-D*N,c=1;c<=s;++c)k=a[c][p],b=a[c][o],a[c][p]=k*C+b*I,a[c][o]=b*C-k*I;if(b=n[u],x===u){if(b<0)for(n[u]=-b,c=0;c<i;++c)r[c][u]=-r[c][u];break}if(d===30)return!1;for(M=n[x],p=u-1,k=n[p],T=g[p],N=g[u],D=((k-b)*(k+b)+(T-N)*(T+N))/(2*N*k),T=t.pythag(D,1),D=((M-b)*(M+b)+N*(k/(D+t.sign(T,D))-N))/M,C=I=1,c=x;c<=p;++c){for(o=c+1,T=g[o],k=n[o],N=I*T,T=C*T,b=t.pythag(D,N),g[c]=b,C=D/b,I=N/b,D=M*C+T*I,T=T*C-M*I,N=k*I,k*=C,f=0;f<i;++f)M=r[f][c],b=r[f][o],r[f][c]=M*C+b*I,r[f][o]=b*C-M*I;for(b=t.pythag(D,N),n[c]=b,b!==0&&(b=1/b,C=D*b,I=N*b),D=C*T+I*k,M=C*k-I*T,f=0;f<s;++f)k=a[f][c],b=a[f][o],a[f][c]=k*C+b*I,a[f][o]=b*C-k*I}g[x]=0,g[u]=D,n[u]=M}return!0},t.pythag=function(a,s){var i=Math.abs(a),n=Math.abs(s),r;return i>n?(r=n/i,i*Math.sqrt(1+r*r)):n===0?0:(r=i/n,n*Math.sqrt(1+r*r))},t.sign=function(a,s){return s>=0?Math.abs(a):-Math.abs(a)},ar=t,ar}var rr,Gi;function gd(){if(Gi)return rr;Gi=1;var t=Sr(),a=a||{};return a.Posit=function(s,i){this.objectPoints=this.buildModel(s),this.focalLength=i,this.objectVectors=[],this.objectNormal=[],this.objectMatrix=[[],[],[]],this.init()},a.Posit.prototype.buildModel=function(s){var i=s/2;return[[-i,i,0],[i,i,0],[i,-i,0],[-i,-i,0]]},a.Posit.prototype.init=function(){var s=this.objectPoints.length,i=[],n=[],r=0,l=2,o;for(o=0;o<s;++o)this.objectVectors[o]=[this.objectPoints[o][0]-this.objectPoints[0][0],this.objectPoints[o][1]-this.objectPoints[0][1],this.objectPoints[o][2]-this.objectPoints[0][2]],i[o]=[this.objectVectors[o][0],this.objectVectors[o][1],this.objectVectors[o][2]];for(;r===0;)n[0]=this.objectVectors[1][1]*this.objectVectors[l][2]-this.objectVectors[1][2]*this.objectVectors[l][1],n[1]=this.objectVectors[1][2]*this.objectVectors[l][0]-this.objectVectors[1][0]*this.objectVectors[l][2],n[2]=this.objectVectors[1][0]*this.objectVectors[l][1]-this.objectVectors[1][1]*this.objectVectors[l][0],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),++l;for(o=0;o<3;++o)this.objectNormal[o]=n[o]/r;a.pseudoInverse(i,s,this.objectMatrix)},a.Posit.prototype.pose=function(s){var i=[[],[],[]],n=[[],[],[]],r=[],l=[[],[],[]],o=[[],[],[]],d=[],c=[],f,u,x,p,y,C;for(this.pos(s,i,n,r),x=this.isValid(i,r),x?f=this.iterate(s,i,r,l,d):f={euclidean:-1,pixels:-1,maximum:-1},p=this.isValid(n,r),p?u=this.iterate(s,n,r,o,c):u={euclidean:-1,pixels:-1,maximum:-1},y=0;y<3;++y)for(C=0;C<3;++C)x&&(d[y]-=l[y][C]*this.objectPoints[0][C]),p&&(c[y]-=o[y][C]*this.objectPoints[0][C]);return f.euclidean<u.euclidean?new a.Pose(f.pixels,l,d,u.pixels,o,c):new a.Pose(u.pixels,o,c,f.pixels,l,d)},a.Posit.prototype.pos=function(s,i,n,r){var l=this.objectPoints.length,o=[],d=[],c=[],f=[],u=[],x=[],p=[],y=[],C,D,T,N,I,A,M,k,b,g;for(b=0;b<l;++b)o[b]=[s[b].x-s[0].x,s[b].y-s[0].y];for(b=0;b<3;++b)for(d[b]=0,c[b]=0,g=0;g<l;++g)d[b]+=this.objectMatrix[b][g]*o[g][0],c[b]+=this.objectMatrix[b][g]*o[g][1];for(C=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],D=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],T=d[0]*c[0]+d[1]*c[1]+d[2]*c[2],N=(D-C)*(D-C)+4*(T*T),D-C>=0?I=(D-C+Math.sqrt(N))/2:I=(D-C-Math.sqrt(N))/2,I>=0?(A=Math.sqrt(I),A===0?M=0:M=-T/A):(A=Math.sqrt(-(T*T)/I),A===0?M=Math.sqrt(C-D):M=-T/A),b=0;b<3;++b)f[b]=d[b]+A*this.objectNormal[b],u[b]=c[b]+M*this.objectNormal[b];for(k=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),b=0;b<3;++b)x[b]=f[b]/k,p[b]=u[b]/k;for(y[0]=x[1]*p[2]-x[2]*p[1],y[1]=x[2]*p[0]-x[0]*p[2],y[2]=x[0]*p[1]-x[1]*p[0],b=0;b<3;++b)i[0][b]=x[b],i[1][b]=p[b],i[2][b]=y[b];for(b=0;b<3;++b)f[b]=d[b]-A*this.objectNormal[b],u[b]=c[b]-M*this.objectNormal[b];for(b=0;b<3;++b)x[b]=f[b]/k,p[b]=u[b]/k;for(y[0]=x[1]*p[2]-x[2]*p[1],y[1]=x[2]*p[0]-x[0]*p[2],y[2]=x[0]*p[1]-x[1]*p[0],b=0;b<3;++b)n[0][b]=x[b],n[1][b]=p[b],n[2][b]=y[b];r[0]=s[0].x/k,r[1]=s[0].y/k,r[2]=this.focalLength/k},a.Posit.prototype.isValid=function(s,i){for(var n=this.objectPoints.length,r=1/0,l=0,o;l<n;++l)o=i[2]+(s[2][0]*this.objectVectors[l][0]+s[2][1]*this.objectVectors[l][1]+s[2][2]*this.objectVectors[l][2]),o<r&&(r=o);return r>=0},a.Posit.prototype.iterate=function(s,i,n,r,l){var o=this.objectPoints.length,d=[],c=[],f=[[],[],[]],u=[[],[],[]],x=[],p=[],y=!1,C=0,D,T,N,I,A,M,k,b,g;for(b=0;b<o;++b)d[b]={x:s[b].x,y:s[b].y};for(b=0;b<3;++b){for(g=0;g<3;++g)r[b][g]=i[b][g];l[b]=n[b]}for(b=0;b<o;++b){for(N=0,g=0;g<3;++g)N+=this.objectVectors[b][g]*r[2][g]/l[2];c[b]={x:(1+N)*s[b].x,y:(1+N)*s[b].y}}for(T=0,b=0;b<o;++b)T+=Math.abs(c[b].x-d[b].x),T+=Math.abs(c[b].y-d[b].y);for(b=0;b<3;++b)x[b]=l[b]-(r[b][0]*this.objectPoints[0][0]+r[b][1]*this.objectPoints[0][1]+r[b][2]*this.objectPoints[0][2]);for(I=A=this.error(s,r,x),y=A.pixels===0||T<.01;C++<100&&!y;){for(b=0;b<o;++b)d[b].x=c[b].x,d[b].y=c[b].y;for(this.pos(c,f,u,l),b=0;b<3;++b)x[b]=l[b]-(f[b][0]*this.objectPoints[0][0]+f[b][1]*this.objectPoints[0][1]+f[b][2]*this.objectPoints[0][2]),p[b]=l[b]-(u[b][0]*this.objectPoints[0][0]+u[b][1]*this.objectPoints[0][1]+u[b][2]*this.objectPoints[0][2]);if(A=this.error(s,f,x),M=this.error(s,u,p),A.euclidean>=0&&M.euclidean>=0)if(M.euclidean<A.euclidean)for(I=M,b=0;b<3;++b)for(g=0;g<3;++g)r[b][g]=u[b][g];else for(I=A,b=0;b<3;++b)for(g=0;g<3;++g)r[b][g]=f[b][g];if(A.euclidean<0&&M.euclidean>=0)for(I=M,b=0;b<3;++b)for(g=0;g<3;++g)r[b][g]=u[b][g];if(M.euclidean<0&&A.euclidean>=0)for(I=A,b=0;b<3;++b)for(g=0;g<3;++g)r[b][g]=f[b][g];for(b=0;b<o;++b){for(N=0,g=0;g<3;++g)N+=this.objectVectors[b][g]*r[2][g]/l[2];c[b].x=(1+N)*s[b].x,c[b].y=(1+N)*s[b].y}for(D=T,T=0,b=0;b<o;++b)T+=Math.abs(c[b].x-d[b].x),T+=Math.abs(c[b].y-d[b].y);k=Math.abs(T-D),y=I.pixels===0||k<.01}return I},a.Posit.prototype.error=function(s,i,n){var r=this.objectPoints.length,l=[],o=[],d=[],c=0,f=0,u=0,x,p,y;if(!this.isValid(i,n))return{euclidean:-1,pixels:-1,maximum:-1};for(x=0;x<r;++x)for(l[x]=[],p=0;p<3;++p)l[x][p]=n[p];for(x=0;x<r;++x)for(p=0;p<3;++p)for(y=0;y<3;++y)l[x][p]+=i[p][y]*this.objectPoints[x][y];for(x=0;x<r;++x)for(o[x]=[],p=0;p<2;++p)o[x][p]=this.focalLength*l[x][p]/l[x][2];for(x=0;x<r;++x)d[x]=[o[x][0]-s[x].x,o[x][1]-s[x].y];for(x=0;x<r;++x)c+=Math.sqrt(d[x][0]*d[x][0]+d[x][1]*d[x][1]),f+=Math.abs(Math.round(o[x][0])-Math.round(s[x].x))+Math.abs(Math.round(o[x][1])-Math.round(s[x].y)),Math.abs(d[x][0])>u&&(u=Math.abs(d[x][0])),Math.abs(d[x][1])>u&&(u=Math.abs(d[x][1]));return{euclidean:c/r,pixels:f,maximum:u}},a.pseudoInverse=function(s,i,n){var r=[],l=[[],[],[]],o=[[],[],[]],d=0,c=0,f,u,x;for(t.svdcmp(s,i,3,r,l),f=0;f<3;++f)r[f]>d&&(d=r[f]);for(d*=.01,f=0;f<3;++f)r[f]<d&&(r[f]=0);for(u=0;u<3;++u)if(r[u]===0)for(++c,x=u;x<2;++x){for(f=0;f<i;++f)s[f][x]=s[f][x+1];for(f=0;f<3;++f)l[f][x]=l[f][x+1]}for(u=0;u<2;++u)r[u]===0&&(r[u]=r[u+1]);for(f=0;f<3;++f)for(u=0;u<3-c;++u)o[f][u]=l[f][u]/r[u];for(f=0;f<3;++f)for(u=0;u<i;++u)for(n[f][u]=0,x=0;x<3-c;++x)n[f][u]+=o[f][x]*s[u][x]},a.Pose=function(s,i,n,r,l,o){this.bestError=s,this.bestRotation=i,this.bestTranslation=n,this.alternativeError=r,this.alternativeRotation=l,this.alternativeTranslation=o},rr=a,rr}var ir,Ji;function yd(){if(Ji)return ir;Ji=1;var t=Sr(),a=a||{};a.Posit=function(n,r){this.model=this.buildModel(n),this.focalLength=r,this.init()},a.Posit.prototype.buildModel=function(n){var r=n/2;return[new s(-r,r,0),new s(r,r,0),new s(r,-r,0),new s(-r,-r,0)]},a.Posit.prototype.init=function(){var n=new s,r=new i,l;this.modelVectors=i.fromRows(s.sub(this.model[1],this.model[0]),s.sub(this.model[2],this.model[0]),s.sub(this.model[3],this.model[0])),l=i.clone(this.modelVectors),t.svdcmp(l.m,3,3,n.v,r.m),this.modelPseudoInverse=i.mult(i.mult(r,i.fromDiagonal(s.inverse(n))),i.transpose(l)),this.modelNormal=r.column(n.minIndex())},a.Posit.prototype.pose=function(n){var r=new s(1,1,1),l=new i,o=new i,d=new s,c=new s,f,u;return this.pos(n,r,l,o,d,c),f=this.iterate(n,l,d),u=this.iterate(n,o,c),f<u?new a.Pose(f,l.m,d.v,u,o.m,c.v):new a.Pose(u,o.m,c.v,f,l.m,d.v)},a.Posit.prototype.pos=function(n,r,l,o,d,c){var f=new s(n[1].x,n[2].x,n[3].x),u=new s(n[1].y,n[2].y,n[3].y),x=s.addScalar(s.mult(f,r),-n[0].x),p=s.addScalar(s.mult(u,r),-n[0].y),y=i.multVector(this.modelPseudoInverse,x),C=i.multVector(this.modelPseudoInverse,p),D=C.square()-y.square(),T=s.dot(y,C),N=0,I=0,A,M,k,b,g,F,J,P,H;D===0?(N=Math.sqrt(Math.abs(2*T)),I=-Math.PI/2*(T<0?-1:T>0?1:0)):(N=Math.sqrt(Math.sqrt(D*D+4*T*T)),I=Math.atan(-2*T/D),D<0&&(I+=Math.PI),I/=2),P=N*Math.cos(I),H=N*Math.sin(I),A=s.add(y,s.multScalar(this.modelNormal,P)),M=s.add(C,s.multScalar(this.modelNormal,H)),b=A.normalize(),g=M.normalize(),k=s.cross(A,M),l.copy(i.fromRows(A,M,k)),F=(b+g)/2,J=i.multVector(l,this.model[0]),d.v=[n[0].x/F-J.v[0],n[0].y/F-J.v[1],this.focalLength/F],A=s.sub(y,s.multScalar(this.modelNormal,P)),M=s.sub(C,s.multScalar(this.modelNormal,H)),b=A.normalize(),g=M.normalize(),k=s.cross(A,M),o.copy(i.fromRows(A,M,k)),F=(b+g)/2,J=i.multVector(o,this.model[0]),c.v=[n[0].x/F-J.v[0],n[0].y/F-J.v[1],this.focalLength/F]},a.Posit.prototype.iterate=function(n,r,l){for(var o=1/0,d=new i,c=new i,f=new s,u=new s,x=0,p,y,C,D;x<100&&(p=s.addScalar(s.multScalar(i.multVector(this.modelVectors,r.row(2)),1/l.v[2]),1),this.pos(n,p,d,c,f,u),C=this.getError(n,d,f),D=this.getError(n,c,u),C<D?(r.copy(d),l.copy(f),y=C):(r.copy(c),l.copy(u),y=D),!(y<=2||y>o));++x)o=y;return y},a.Posit.prototype.getError=function(n,r,l){var o=s.add(i.multVector(r,this.model[0]),l),d=s.add(i.multVector(r,this.model[1]),l),c=s.add(i.multVector(r,this.model[2]),l),f=s.add(i.multVector(r,this.model[3]),l),u,x,p,y,C,D,T,N,I;return o=o.v,d=d.v,c=c.v,f=f.v,o[0]*=this.focalLength/o[2],o[1]*=this.focalLength/o[2],d[0]*=this.focalLength/d[2],d[1]*=this.focalLength/d[2],c[0]*=this.focalLength/c[2],c[1]*=this.focalLength/c[2],f[0]*=this.focalLength/f[2],f[1]*=this.focalLength/f[2],u=[{x:o[0],y:o[1]},{x:d[0],y:d[1]},{x:c[0],y:c[1]},{x:f[0],y:f[1]}],x=this.angle(n[0],n[1],n[3]),p=this.angle(n[1],n[2],n[0]),y=this.angle(n[2],n[3],n[1]),C=this.angle(n[3],n[0],n[2]),D=this.angle(u[0],u[1],u[3]),T=this.angle(u[1],u[2],u[0]),N=this.angle(u[2],u[3],u[1]),I=this.angle(u[3],u[0],u[2]),(Math.abs(x-D)+Math.abs(p-T)+Math.abs(y-N)+Math.abs(C-I))/4},a.Posit.prototype.angle=function(n,r,l){var o=r.x-n.x,d=r.y-n.y,c=l.x-n.x,f=l.y-n.y;return Math.acos((o*c+d*f)/(Math.sqrt(o*o+d*d)*Math.sqrt(c*c+f*f)))*180/Math.PI},a.Pose=function(n,r,l,o,d,c){this.bestError=n,this.bestRotation=r,this.bestTranslation=l,this.alternativeError=o,this.alternativeRotation=d,this.alternativeTranslation=c};var s=function(n,r,l){this.v=[n||0,r||0,l||0]};s.prototype.copy=function(n){var r=this.v;return n=n.v,r[0]=n[0],r[1]=n[1],r[2]=n[2],this},s.add=function(n,r){var l=new s,o=l.v;return n=n.v,r=r.v,o[0]=n[0]+r[0],o[1]=n[1]+r[1],o[2]=n[2]+r[2],l},s.sub=function(n,r){var l=new s,o=l.v;return n=n.v,r=r.v,o[0]=n[0]-r[0],o[1]=n[1]-r[1],o[2]=n[2]-r[2],l},s.mult=function(n,r){var l=new s,o=l.v;return n=n.v,r=r.v,o[0]=n[0]*r[0],o[1]=n[1]*r[1],o[2]=n[2]*r[2],l},s.addScalar=function(n,r){var l=new s,o=l.v;return n=n.v,o[0]=n[0]+r,o[1]=n[1]+r,o[2]=n[2]+r,l},s.multScalar=function(n,r){var l=new s,o=l.v;return n=n.v,o[0]=n[0]*r,o[1]=n[1]*r,o[2]=n[2]*r,l},s.dot=function(n,r){return n=n.v,r=r.v,n[0]*r[0]+n[1]*r[1]+n[2]*r[2]},s.cross=function(n,r){return n=n.v,r=r.v,new s(n[1]*r[2]-n[2]*r[1],n[2]*r[0]-n[0]*r[2],n[0]*r[1]-n[1]*r[0])},s.prototype.normalize=function(){var n=this.v,r=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return r>0&&(n[0]/=r,n[1]/=r,n[2]/=r),r},s.inverse=function(n){var r=new s,l=r.v;return n=n.v,n[0]!==0&&(l[0]=1/n[0]),n[1]!==0&&(l[1]=1/n[1]),n[2]!==0&&(l[2]=1/n[2]),r},s.prototype.square=function(){var n=this.v;return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},s.prototype.minIndex=function(){var n=this.v;return n[0]<n[1]?n[0]<n[2]?0:2:n[1]<n[2]?1:2};var i=function(){this.m=[[0,0,0],[0,0,0],[0,0,0]]};return i.clone=function(n){var r=new i,l=r.m;return n=n.m,l[0][0]=n[0][0],l[0][1]=n[0][1],l[0][2]=n[0][2],l[1][0]=n[1][0],l[1][1]=n[1][1],l[1][2]=n[1][2],l[2][0]=n[2][0],l[2][1]=n[2][1],l[2][2]=n[2][2],r},i.prototype.copy=function(n){var r=this.m;return n=n.m,r[0][0]=n[0][0],r[0][1]=n[0][1],r[0][2]=n[0][2],r[1][0]=n[1][0],r[1][1]=n[1][1],r[1][2]=n[1][2],r[2][0]=n[2][0],r[2][1]=n[2][1],r[2][2]=n[2][2],this},i.fromRows=function(n,r,l){var o=new i,d=o.m;return n=n.v,r=r.v,l=l.v,d[0][0]=n[0],d[0][1]=n[1],d[0][2]=n[2],d[1][0]=r[0],d[1][1]=r[1],d[1][2]=r[2],d[2][0]=l[0],d[2][1]=l[1],d[2][2]=l[2],o},i.fromDiagonal=function(n){var r=new i,l=r.m;return n=n.v,l[0][0]=n[0],l[1][1]=n[1],l[2][2]=n[2],r},i.transpose=function(n){var r=new i,l=r.m;return n=n.m,l[0][0]=n[0][0],l[0][1]=n[1][0],l[0][2]=n[2][0],l[1][0]=n[0][1],l[1][1]=n[1][1],l[1][2]=n[2][1],l[2][0]=n[0][2],l[2][1]=n[1][2],l[2][2]=n[2][2],r},i.mult=function(n,r){var l=new i,o=l.m;return n=n.m,r=r.m,o[0][0]=n[0][0]*r[0][0]+n[0][1]*r[1][0]+n[0][2]*r[2][0],o[0][1]=n[0][0]*r[0][1]+n[0][1]*r[1][1]+n[0][2]*r[2][1],o[0][2]=n[0][0]*r[0][2]+n[0][1]*r[1][2]+n[0][2]*r[2][2],o[1][0]=n[1][0]*r[0][0]+n[1][1]*r[1][0]+n[1][2]*r[2][0],o[1][1]=n[1][0]*r[0][1]+n[1][1]*r[1][1]+n[1][2]*r[2][1],o[1][2]=n[1][0]*r[0][2]+n[1][1]*r[1][2]+n[1][2]*r[2][2],o[2][0]=n[2][0]*r[0][0]+n[2][1]*r[1][0]+n[2][2]*r[2][0],o[2][1]=n[2][0]*r[0][1]+n[2][1]*r[1][1]+n[2][2]*r[2][1],o[2][2]=n[2][0]*r[0][2]+n[2][1]*r[1][2]+n[2][2]*r[2][2],l},i.multVector=function(n,r){return n=n.m,r=r.v,new s(n[0][0]*r[0]+n[0][1]*r[1]+n[0][2]*r[2],n[1][0]*r[0]+n[1][1]*r[1]+n[1][2]*r[2],n[2][0]*r[0]+n[2][1]*r[1]+n[2][2]*r[2])},i.prototype.column=function(n){var r=this.m;return new s(r[0][n],r[1][n],r[2][n])},i.prototype.row=function(n){var r=this.m;return new s(r[n][0],r[n][1],r[n][2])},ir=a,ir}var or,Ki;function vd(){return Ki||(Ki=1,or={CV:Bo(),AR:bd(),SVD:Sr(),POS1:gd(),POS2:yd()}),or}var jd=vd();const Yi=["top","right","bottom","left"],gs={top:0,right:1,bottom:2,left:3};let lr=null;function Nd(){return lr||(lr=new jd.AR.Detector),lr}function wd(t){const a=t.reduce((i,n)=>({x:i.x+n.x,y:i.y+n.y}),{x:0,y:0}),s=t.length||1;return{x:a.x/s,y:a.y/s}}function Sd(t){try{const s=Nd().detect(t)||[],i={},n=[];for(const f of s){const u=wd(f.corners);n.push({id:f.id,center:u});const x=Object.keys(gs).find(p=>gs[p]===f.id);x&&(i[x]={id:f.id,center:u})}const r=Object.keys(gs).filter(f=>!i[f]);if(r.length>0)return{success:!1,points:[],missing:r,markersFound:n,assignments:i,homography:null,errorPx:null,message:"Not all calibration markers were detected."};const l=[i.top.center,i.right.center,i.bottom.center,i.left.center],o=ur(),d=Po(o,l),c=Lo(d,o,l);return{success:!0,points:l,missing:[],markersFound:n,assignments:i,homography:d,errorPx:c}}catch(a){return{success:!1,points:[],missing:Object.keys(gs),markersFound:[],assignments:{},homography:null,errorPx:null,message:a instanceof Error?a.message:"Marker detection failed"}}}function kd(t){const a=t.getContext("2d");if(!a)return{success:!1,points:[],missing:Object.keys(gs),markersFound:[],assignments:{},homography:null,errorPx:null,message:"Canvas context unavailable for marker detection."};const s=a.getImageData(0,0,t.width,t.height);return Sd(s)}const Cd={"0,0":[1,0,0,0,0],"0,1":[1,0,1,1,1],"1,0":[0,1,0,0,1],"1,1":[0,1,1,1,0]};function Ed(t){const a=new Array(5);let s=t>>>0;for(let n=4;n>=0;n--){const r=s&1;s>>=1;const l=s&1;s>>=1;const o=Cd[`${l},${r}`];if(!o)throw new Error(`Unsupported marker id pattern for row ${n}`);a[n]=o.slice()}const i=Array.from({length:7},()=>new Array(7).fill(0));for(let n=0;n<5;n++)for(let r=0;r<5;r++)i[n+1][r+1]=a[n][r];return i}async function Uo(){const t=[];try{const a=await Td();for(const s of a){const i=await Md(s,[80,8080,8787,8788,3e3,5e3]);for(const n of i){const r=await Ad(n.ip,n.port);r&&t.push(r)}}}catch(a){console.error("Network discovery failed:",a)}return t}async function Td(){const t=[];try{const a=new RTCPeerConnection({iceServers:[]});a.createDataChannel("");const s=await a.createOffer();return await a.setLocalDescription(s),new Promise(i=>{const n=setTimeout(()=>{a.close(),i(t)},5e3);a.onicecandidate=r=>{if(r.candidate){const o=r.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(o&&o[1]&&!t.includes(o[1])){const d=o[1];Id(d)&&t.push(d)}}else clearTimeout(n),a.close(),i(t)}})}catch(a){return console.error("Failed to get local IPs:",a),["192.168.1.0"]}}function Id(t){const a=t.split(".").map(Number);return a[0]===10||a[0]===172&&a[1]>=16&&a[1]<=31||a[0]===192&&a[1]===168}async function Md(t,a){const s=[],i=t.split(".").slice(0,3).join("."),n=[];for(let l=1;l<=254;l++){const o=`${i}.${l}`;for(const d of a)n.push(Dd(o,d))}return(await Promise.allSettled(n)).forEach((l,o)=>{if(l.status==="fulfilled"&&l.value){const d=o%a.length,c=Math.floor(o/a.length),f=`${i}.${c+1}`;s.push({ip:f,port:a[d]})}}),s}async function Dd(t,a){try{const s=await fetch(`http://${t}:${a}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(2e3)});return!0}catch{return!1}}async function Ad(t,a){try{const s=["/","/api/info","/api/status","/camera","/stream"];for(const i of s)try{const n=await fetch(`http://${t}:${a}${i}`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(n.ok){const r=n.headers.get("content-type")||"",l=await n.text();if(l.includes("OMNI")||l.includes("omni")||i.includes("omni"))return{id:`omni-${t}-${a}`,name:`OMNI Camera (${t})`,ip:t,port:a,type:"omni",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(l.includes("VERT")||l.includes("vert")||i.includes("vert"))return{id:`vert-${t}-${a}`,name:`VERT Camera (${t})`,ip:t,port:a,type:"vert",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(r.includes("video")||l.includes("stream")||i==="/stream")return{id:`generic-${t}-${a}`,name:`Network Camera (${t})`,ip:t,port:a,type:"generic",capabilities:["video"],status:"online",connectionType:"wifi"}}}catch{}}catch(s){console.error(`Failed to probe device ${t}:${a}:`,s)}return null}async function Pd(){const t=[];try{if(!("serial"in navigator))return console.warn("Web Serial API not supported in this browser"),t;const a=await navigator.serial.getPorts();for(const s of a){const i=await $o(s);i&&t.push(i)}}catch(a){console.error("USB device discovery failed:",a)}return t}async function Rd(){try{if(!("serial"in navigator))return alert("Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge."),null;const t=await navigator.serial.requestPort();return await $o(t)}catch(t){return t.name!=="NotFoundError"&&console.error("USB device request failed:",t),null}}async function $o(t){try{await t.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none"});const a=t.readable?.getReader();if(a)try{const s=setTimeout(()=>a.cancel(),2e3),{value:i,done:n}=await a.read();if(clearTimeout(s),!n&&i){const r=new TextDecoder().decode(i);if(r.includes("OMNI")||r.includes("omni"))return a.releaseLock(),{id:`usb-omni-${Date.now()}`,name:"OMNI Camera (USB)",type:"omni",capabilities:["video","calibration"],status:"online",port:t};if(r.includes("VERT")||r.includes("vert"))return a.releaseLock(),{id:`usb-vert-${Date.now()}`,name:"VERT Camera (USB)",type:"vert",capabilities:["video","calibration"],status:"online",port:t}}}catch{}finally{try{a.releaseLock()}catch{}}return{id:`usb-generic-${Date.now()}`,name:"USB Scoring Device",type:"generic",capabilities:["video"],status:"online",port:t}}catch(a){return console.error("Failed to probe USB device:",a),null}}async function Fo(t){try{const a=`http://${t.ip}:${t.port}/stream`,s=document.createElement("video");return s.src=a,s.crossOrigin="anonymous",new Promise((i,n)=>{s.onloadeddata=()=>{const r=document.createElement("canvas"),l=r.getContext("2d");r.width=s.videoWidth,r.height=s.videoHeight;const o=r.captureStream(30),d=()=>{s.readyState>=2&&l.drawImage(s,0,0),requestAnimationFrame(d)};d(),i(o)},s.onerror=()=>n(new Error("Failed to load video stream")),s.load()})}catch(a){return console.error("Failed to connect to network device:",a),null}}async function Ld(t){try{if(!t.port)throw new Error("No serial port available");return console.log("USB device connection not fully implemented yet"),null}catch(a){return console.error("Failed to connect to USB device:",a),null}}function Od(){const t=m.useRef(null),a=m.useRef(null),s=m.useRef(null),i=m.useRef(null),[n,r]=m.useState(!1),[l,o]=m.useState(!1),[d,c]=m.useState("camera"),[f,u]=m.useState(()=>localStorage.getItem("ndn:cal:mode")||"local"),[x,p]=m.useState([]),[y,C]=m.useState(!1),[D,T]=m.useState(null),[N,I]=m.useState(1),[A,M]=m.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("ndn:cal:forceDesktop")==="1"}catch{return!1}}),[k,b]=m.useState(()=>typeof navigator>"u"?!1:/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)),{H:g,setCalibration:F,reset:J,errorPx:P,locked:H}=Nr(),{calibrationGuide:E,setCalibrationGuide:_,preferredCameraId:ae,cameraEnabled:L,setCameraEnabled:Q,preferredCameraLocked:ce,setPreferredCameraLocked:me,setPreferredCamera:_e}=ls(),[ze,We]=m.useState(null),[at,pe]=m.useState(!1),[Ke,pt]=m.useState(0),[Ne,Pe]=m.useState(null),de=m.useCallback((B,Y=480)=>{if(typeof document>"u")throw new Error("Marker rendering only available in browser context");const Z=Ed(B),V=document.createElement("canvas");V.width=Y,V.height=Y;const K=V.getContext("2d");if(!K)throw new Error("Unable to create marker canvas context");K.imageSmoothingEnabled=!1,K.fillStyle="#ffffff",K.fillRect(0,0,Y,Y);const ke=Y*.08,be=Z.length,nt=(Y-ke*2)/be,Se=ke;for(let gt=0;gt<be;gt++)for(let Pt=0;Pt<be;Pt++){const yt=Z[gt][Pt];K.fillStyle=yt===1?"#000000":"#ffffff",K.fillRect(Se+Pt*nt,Se+gt*nt,nt,nt)}return K.strokeStyle="#000000",K.lineWidth=Math.max(2,nt*.08),K.strokeRect(Se,Se,nt*be,nt*be),V.toDataURL("image/png")},[]),ot=m.useCallback(()=>{try{const B=Yi.map(V=>{const K=gs[V];return{key:V,id:K,dataUrl:de(K)}}),Y=window.open("","_blank","width=900,height=1200");if(!Y)throw new Error("Popup blocked by browser");const Z=`<!DOCTYPE html>
			<html>
			<head>
				<meta charset="utf-8" />
				<title>Nine Dart Nation â€“ Marker Sheet</title>
				<style>
					body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 24px; color: #0f172a; }
					h1 { font-size: 20px; margin-bottom: 4px; }
					p { margin-top: 0; opacity: 0.7; }
					.grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 32px; margin-top: 24px; }
					.marker { text-align: center; }
					.marker h2 { font-size: 16px; margin: 12px 0 8px; }
					.marker img { width: 100%; max-width: 360px; border: 1px solid #0f172a; }
					footer { margin-top: 24px; font-size: 12px; opacity: 0.6; }
				</style>
			</head>
			<body>
				<h1>Marker sheet</h1>
				<p>Print at 100% scale on letter/A4 paper. Cut out and tape each marker so it is flush with the outer double ring.</p>
				<div class="grid">
					${B.map(V=>`
						<div class="marker">
							<h2>${V.key.toUpperCase()} â€¢ ID ${V.id}</h2>
							<img src="${V.dataUrl}" alt="Marker ${V.key}" />
						</div>
					`).join("")}
				</div>
				<footer>Tip: Keep markers flat, smooth, and unobstructed for best detection results.</footer>
			</body>
			</html>`;Y.document.write(Z),Y.document.close()}catch(B){console.error("Marker sheet generation failed",B),alert(`Unable to open marker sheet: ${B?.message||B}`)}},[de]),[xe,Re]=m.useState(null),re=m.useRef(!1),[ee,bt]=m.useState(null),Ze=m.useRef(null),Ye=m.useCallback(B=>{Ze.current=B,bt(B)},[bt]),[te,ye]=m.useState(null),[fe,he]=m.useState(Date.now()),[Oe,it]=m.useState(!1),Te=m.useRef(null),[Et,lt]=m.useState(""),[S,ne]=m.useState(null),[ut,Xe]=m.useState(null),[Ot,Bt]=m.useState(!0),[Tt,De]=m.useState([]),[Jt,ct]=m.useState(!1),[It,kt]=m.useState(null),Mt=m.useRef(null);m.useEffect(()=>{const B=window.location.hostname;(B==="localhost"||B==="127.0.0.1")&&St("/api/hosts").then(Y=>Y.json()).then(Y=>{const Z=Array.isArray(Y?.hosts)&&Y.hosts.find(V=>V);Z&&ne(Z)}).catch(()=>{}),St("/api/https-info").then(Y=>Y.json()).then(Y=>{Y&&typeof Y.https=="boolean"&&Xe({https:!!Y.https,port:Number(Y.port)||8788})}).catch(()=>{})},[]);const Nt=m.useMemo(()=>{const B=ee||"____",Y="ws://localhost:8787";if(Y.length>0)try{const be=new URL(Y);return`${`${be.protocol==="wss:"?"https":"http"}://${be.host}${be.pathname.endsWith("/ws")?"":be.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${B}`}catch{}const Z=S||window.location.hostname,V=!!ut?.https,K=V?ut?.port||8788:8787;return`${V?"https":"http"}://${Z}:${K}/mobile-cam.html?code=${B}`},[ee,S,ut]),Zt=m.useMemo(()=>{if(!Nt)return null;try{const B=new URL(Nt);return B.searchParams.delete("code"),B.toString().replace(/\?$/,"")}catch{return typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html"}},[Nt]);m.useEffect(()=>{localStorage.setItem("ndn:cal:mode",f)},[f]),m.useEffect(()=>{if(!(typeof window>"u"))try{A?window.localStorage.setItem("ndn:cal:forceDesktop","1"):window.localStorage.removeItem("ndn:cal:forceDesktop")}catch{}},[A]),m.useEffect(()=>{if(typeof window>"u")return;const B=window.matchMedia("(pointer: coarse)"),Y=()=>{const Z=typeof navigator<"u"&&/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent),V=typeof B.matches=="boolean"?B.matches:!1,K=window.innerWidth<=820;b(Z||V||K)};Y();try{typeof B.addEventListener=="function"?B.addEventListener("change",Y):typeof B.addListener=="function"&&B.addListener(Y)}catch{}return window.addEventListener("resize",Y),()=>{try{typeof B.removeEventListener=="function"?B.removeEventListener("change",Y):typeof B.removeListener=="function"&&B.removeListener(Y)}catch{}window.removeEventListener("resize",Y)}},[]),m.useEffect(()=>{if(!ee){lt("");return}Do.toDataURL(Nt,{width:160,margin:1,color:{dark:"#000000",light:"#ffffff"}}).then(lt).catch(()=>lt(""))},[Nt,ee]),m.useEffect(()=>{if(!te)return;const B=setInterval(()=>he(Date.now()),1e3);return()=>clearInterval(B)},[te]);const $=m.useMemo(()=>te?Math.max(0,Math.ceil((te-fe)/1e3)):null,[te,fe]);m.useEffect(()=>()=>{Mt.current&&window.clearTimeout(Mt.current)},[]);const ge=m.useCallback(async(B,Y)=>{if(B)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(B);else{const Z=document.createElement("textarea");Z.value=B,Z.style.position="fixed",Z.style.opacity="0",document.body.appendChild(Z),Z.focus(),Z.select(),document.execCommand("copy"),document.body.removeChild(Z)}kt(Y),Mt.current&&window.clearTimeout(Mt.current),Mt.current=window.setTimeout(()=>kt(null),1500)}catch(Z){console.warn("[Calibrator] Copy failed:",Z),kt(null)}},[]);m.useEffect(()=>()=>Ee(),[]);function rt(){if(xe&&xe.readyState===WebSocket.OPEN)return xe;const B="ws://localhost:8787",Y=B.length>0?B.endsWith("/ws")?B:B.replace(/\/$/,"")+"/ws":void 0,V=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws`,K=window.location.hostname,be=Y||(K.endsWith("onrender.com")?V:"wss://ninedartnation.onrender.com/ws");console.log("[Calibrator] Connecting WebSocket to:",be);let st=new WebSocket(be);return Re(st),st}async function U(){u("phone"),Le();try{Q(!0)}catch{}const B=rt();B.readyState===WebSocket.OPEN?B.send(JSON.stringify({type:"cam-create"})):B.onopen=()=>B.send(JSON.stringify({type:"cam-create"})),B.onerror=Y=>{console.error("WebSocket connection error:",Y),alert("Failed to connect to camera pairing service. Please check your internet connection and try again.")},B.onclose=Y=>{if(console.log("WebSocket closed:",Y.code,Y.reason),Te.current){try{Te.current.close()}catch{}Te.current=null}Ye(null),Y.code!==1e3&&alert("Camera pairing connection lost. Please try pairing again.")},B.onmessage=async Y=>{const Z=JSON.parse(Y.data);if(Z.type==="cam-code")Ye(Z.code),Z.expiresAt&&ye(Z.expiresAt);else if(Z.type==="cam-peer-joined"){!Ze.current&&Z.code&&Ye(Z.code),it(!0);const V=Ze.current||Z.code||null;V&&(Ze.current=V);try{if(H&&V){const ke=a.current?{w:a.current.width,h:a.current.height}:null,be={H:g,imageSize:ke,errorPx:P??null,createdAt:Date.now()};B.send(JSON.stringify({type:"cam-calibration",code:V,payload:be})),console.log("[Calibrator] Sent calibration to joined phone for code",V)}}catch(ke){console.warn("[Calibrator] Failed to send calibration on peer join",ke)}const K=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceCandidatePoolSize:10});Te.current=K,K.onconnectionstatechange=()=>{console.log("WebRTC connection state:",K.connectionState),K.connectionState==="failed"||K.connectionState==="disconnected"?(console.error("WebRTC connection failed"),alert("Camera connection lost. Please try pairing again."),Ee()):K.connectionState==="connected"&&console.log("WebRTC connection established")},K.onicecandidate=ke=>{ke.candidate&&V&&B.send(JSON.stringify({type:"cam-ice",code:V,payload:ke.candidate}))},K.ontrack=ke=>{if(console.log("[Calibrator] WebRTC ontrack received:",ke.streams?.length,"streams, track kind:",ke.track?.kind),t.current){const be=ke.streams?.[0];be?(console.log("[Calibrator] Assigning video stream (tracks:",be.getTracks().length,") to video element"),C(!1),setTimeout(()=>{t.current&&(console.log("[Calibrator] Setting srcObject and attempting play"),t.current.srcObject=be,t.current.muted=!0,t.current.playsInline=!0,t.current.play().then(()=>{console.log("[Calibrator] Video playback started successfully"),r(!0),c("capture");try{_e(void 0,"Phone Camera",!0)}catch{}if(!ce)try{me(!0),re.current=!0}catch{}try{Q(!0)}catch{}o(!1)}).catch(st=>{console.error("[Calibrator] Video play failed:",st),o(!0),console.warn("[Calibrator] video play blocked â€” prompting user interaction")}))},100)):console.error("[Calibrator] No inbound stream received in ontrack")}else console.error("[Calibrator] Video element not available")};try{const ke=await K.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await K.setLocalDescription(ke),console.log("[Calibrator] Sending cam-offer for code:",V),V?B.send(JSON.stringify({type:"cam-offer",code:V,payload:ke})):console.warn("[Calibrator] Missing pairing code when sending offer")}catch(ke){console.error("Failed to create WebRTC offer:",ke),alert("Failed to establish camera connection. Please try again."),Ee()}}else if(Z.type==="cam-answer"){console.log("[Calibrator] Received cam-answer");const V=Te.current;if(V)try{await V.setRemoteDescription(new RTCSessionDescription(Z.payload)),console.log("[Calibrator] Remote description set (answer)")}catch(K){console.error("Failed to set remote description:",K),alert("Camera pairing failed. Please try again."),Ee()}else console.warn("[Calibrator] Received cam-answer but no peer connection exists")}else if(Z.type==="cam-ice"){console.log("[Calibrator] Received cam-ice");const V=Te.current;if(V)try{await V.addIceCandidate(Z.payload),console.log("[Calibrator] ICE candidate added")}catch(K){console.error("Failed to add ICE candidate:",K)}else console.warn("[Calibrator] Received ICE candidate but no peer connection exists")}else Z.type==="cam-error"&&(console.error("Camera pairing error:",Z.code),alert(Z.code==="EXPIRED"?"Code expired. Generate a new code.":`Camera error: ${Z.code||"Unknown error"}`),Ee())}}async function z(){ct(!0);try{const B=await Uo();De(B),B.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(B){console.error("Wifi device discovery failed:",B),alert("Failed to discover wifi devices. Please check your network connection.")}finally{ct(!1)}c("camera")}async function oe(B){try{De(Z=>Z.map(V=>V.id===B.id?{...V,status:"connecting"}:V));const Y=await Fo(B);if(Y&&t.current)t.current.srcObject=Y,await t.current.play(),r(!0),c("capture"),De(Z=>Z.map(V=>V.id===B.id?{...V,status:"online"}:V));else throw new Error("Failed to get video stream")}catch(Y){console.error("Failed to connect to wifi device:",Y),alert(`Failed to connect to ${B.name}. Please check the device and try again.`),De(Z=>Z.map(V=>V.id===B.id?{...V,status:"offline"}:V))}}async function ve(){if(f==="phone")return U();if(f==="wifi")return z();try{console.log("[Calibrator] Attempting camera access...");const B={video:ae?{deviceId:{exact:ae}}:{facingMode:"environment"},audio:!1};console.log("[Calibrator] Camera constraints:",B);let Y;try{Y=await navigator.mediaDevices.getUserMedia(B),console.log("[Calibrator] Camera stream obtained:",Y)}catch(Z){const V=Z&&(Z.name||Z.code)||"";if(console.warn("[Calibrator] Preferred camera not available:",Z),ae&&(V==="OverconstrainedError"||V==="NotFoundError"||V==="NotAllowedError"))Y=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),console.log("[Calibrator] Fallback camera stream obtained:",Y);else throw Z}t.current?(t.current.srcObject=Y,await t.current.play(),console.log("[Calibrator] Video playback started")):console.warn("[Calibrator] videoRef.current is null"),r(!0),c("capture")}catch(B){console.error("[Calibrator] Camera access failed:",B),alert(`Camera access failed: ${B instanceof Error?B.message:"Unknown error"}. Try refreshing the page or check camera permissions.`)}}function Ee(){if(t.current&&t.current.srcObject&&(t.current.srcObject.getTracks().forEach(Y=>Y.stop()),t.current.srcObject=null,r(!1)),Te.current){try{Te.current.close()}catch{}Te.current=null}if(Ye(null),ye(null),it(!1),Pe(null),re.current){try{me(!1)}catch{}re.current=!1}}function Ae(){xe&&xe.readyState===WebSocket.OPEN?xe.send(JSON.stringify({type:"cam-create"})):U(),Le()}function Le(){try{ce?re.current:(me(!0),re.current=!0)}catch{}}function Ie(){try{i.current?.click()}catch{}}function He(B){const Y=B.target.files?.[0];if(!Y)return;const Z=new Image;Z.onload=()=>{try{if(!a.current)return;const V=a.current;V.width=Z.naturalWidth,V.height=Z.naturalHeight,V.getContext("2d").drawImage(Z,0,0,V.width,V.height),C(!0),T({w:V.width,h:V.height}),c("select"),p([]),Pe(null),Ee()}catch{}},Z.onerror=()=>{alert("Could not load image. Please try a different photo.")},Z.src=URL.createObjectURL(Y);try{B.target.value=""}catch{}}function Dt(){if(!t.current||!a.current)return;const B=t.current,Y=a.current;Y.width=B.videoWidth,Y.height=B.videoHeight,Y.getContext("2d").drawImage(B,0,0,Y.width,Y.height),C(!0),T({w:Y.width,h:Y.height}),c("select"),p([]),Pe(null),at&&setTimeout(()=>{ys()},0)}function Be(B=x,Y=null){if(!a.current||!s.current)return;const Z=a.current,V=s.current;V.width=Z.width,V.height=Z.height;const K=V.getContext("2d");K.clearRect(0,0,V.width,V.height),B.forEach((be,st)=>{hd(K,be,"#f472b6"),K.save(),K.fillStyle="#f472b6",K.font="14px sans-serif",K.fillText(String(st+1),be.x+6,be.y-6),K.restore()});const ke=Y||g;if(ke){const be=[Fe.bullInner,Fe.bullOuter,Fe.trebleInner,Fe.trebleOuter,Fe.doubleInner,Fe.doubleOuter];for(const st of be){const nt=H?"#10b981":st===Fe.doubleOuter?"#22d3ee":"#a78bfa",Se=H||st===Fe.doubleOuter?3:2,gt=Ro(ke,st,360);Oo(K,gt,nt,Se)}}if(!ke&&ze){const be=(st,nt,Se=2)=>{K.save(),K.strokeStyle=nt,K.lineWidth=Se,K.beginPath(),K.arc(ze.cx,ze.cy,st,0,Math.PI*2),K.stroke(),K.restore()};be(ze.doubleOuter,"#22d3ee",3),be(ze.doubleInner,"#22d3ee",2),be(ze.trebleOuter,"#fde047",2),be(ze.trebleInner,"#fde047",2),be(ze.bullOuter,"#34d399",2),be(ze.bullInner,"#10b981",3)}if(E&&!H){K.save(),K.fillStyle="rgba(59,130,246,0.10)";const be=Math.round(Math.min(V.width,V.height)*.08),st=V.width-be*2,nt=V.height-be*2;K.fillRect(be,be,st,nt),K.strokeStyle="rgba(34,197,94,0.9)",K.lineWidth=2,K.beginPath(),K.moveTo(be,V.height/2),K.lineTo(V.width-be,V.height/2),K.stroke(),K.beginPath(),K.moveTo(V.width/2,be),K.lineTo(V.width/2,V.height-be),K.stroke(),K.strokeStyle="rgba(234,179,8,0.9)",K.setLineDash([6,4]);const Se=be+30,gt=be+30;K.beginPath(),K.moveTo(Se,gt+30),K.lineTo(Se+60,gt),K.stroke(),K.beginPath(),K.moveTo(V.width-Se,gt+30),K.lineTo(V.width-Se-60,gt),K.stroke(),K.restore(),K.save(),K.scale(1/N,1/N),K.fillStyle="rgba(255,255,255,0.85)",K.font="12px sans-serif",K.fillText("Tip: Frame board centered, edges parallel; slight top-down is okay. Keep bull near center.",be*N,(be+18)*N),K.restore()}}function Kt(B){if(d!=="select")return;const Y=B.target,Z=Y.getBoundingClientRect(),V=B.clientX-Z.left,K=B.clientY-Z.top,ke=Y.width>0?Y.width/Z.width:1,be=Y.height>0?Y.height/Z.height:1,st=V*ke,nt=K*be,Se=[...x,{x:st,y:nt}];Se.length<=4&&(p(Se),Be(Se))}function Us(){const B=x.slice(0,-1);p(B),Be(B)}function Xs(){if(!a.current||x.length===0)return;const B=pd(a.current,x,8);p(B),Be(B)}function Ds(){if(!a.current)return;if(x.length!==4)return alert("Please click 4 points: TOP, RIGHT, BOTTOM, LEFT corners of the double rim.");const B=ur(),Y=Po(B,x);Be(x,Y);const Z=Lo(Y,B,x);F({H:Y,createdAt:Date.now(),errorPx:Z,imageSize:{w:a.current.width,h:a.current.height},anchors:{src:B,dst:x}}),c("computed")}function dn(){p([]),C(!1),c("camera"),Be([]),Pe(null),J()}async function ys(){if(!a.current)return alert("Load a photo or capture a frame first.");Pe(null);const B=a.current,Z=Math.min(1,800/B.width),V=Math.max(1,Math.round(B.width*Z)),K=Math.max(1,Math.round(B.height*Z)),ke=document.createElement("canvas");ke.width=V,ke.height=K;const be=ke.getContext("2d");be.drawImage(B,0,0,V,K);const st=be.getImageData(0,0,V,K),nt=new Float32Array(V*K);for(let qe=0,ht=0;qe<st.data.length;qe+=4,ht++){const ue=st.data[qe],ft=st.data[qe+1],jt=st.data[qe+2];nt[ht]=.299*ue+.587*ft+.114*jt}const Se=new Float32Array(V*K),gt=new Float32Array(V*K);for(let qe=1;qe<K-1;qe++)for(let ht=1;ht<V-1;ht++){const ue=qe*V+ht,ft=nt[ue-V-1],jt=nt[ue-V],dt=nt[ue-V+1],xt=nt[ue-1],Ct=nt[ue+1],Vt=nt[ue+V-1],$s=nt[ue+V],Ps=nt[ue+V+1];Se[ue]=-ft-2*xt-Vt+(dt+2*Ct+Ps),gt[ue]=-ft-2*jt-dt+(Vt+2*$s+Ps)}const Pt=new Float32Array(V*K);let yt=1;for(let qe=0;qe<Pt.length;qe++){const ht=Math.hypot(Se[qe],gt[qe]);Pt[qe]=ht,ht>yt&&(yt=ht)}const qt=Math.floor(V/2),$t=Math.floor(K/2),Es=Math.floor(Math.min(V,K)*.35),as=Math.floor(Math.min(V,K)*.52);let Rt={score:-1,cx:qt,cy:$t,r:Math.floor((Es+as)/2)};const Ft=Math.max(2,Math.floor(Math.min(V,K)*.01)),vt=Math.max(2,Math.floor(Math.min(V,K)*.01));for(let qe=$t-Math.floor(K*.08);qe<=$t+Math.floor(K*.08);qe+=Ft)for(let ht=qt-Math.floor(V*.08);ht<=qt+Math.floor(V*.08);ht+=Ft)for(let ue=Es;ue<=as;ue+=vt){let ft=0;const jt=360;for(let dt=0;dt<jt;dt++){const xt=dt*Math.PI/180,Ct=Math.round(ht+ue*Math.cos(xt)),Vt=Math.round(qe+ue*Math.sin(xt));Ct<=0||Ct>=V-1||Vt<=0||Vt>=K-1||(ft+=Pt[Vt*V+Ct])}ft>Rt.score&&(Rt={score:ft,cx:ht,cy:qe,r:ue})}const we=1/Z,es=Rt.cx*we,cs=Rt.cy*we,vs=Rt.r*we;function ds(qe){let ht=0;const ue=qe*Z,ft=360;for(let jt=0;jt<ft;jt++){const dt=jt*Math.PI/180,xt=Math.round(Rt.cx+ue*Math.cos(dt)),Ct=Math.round(Rt.cy+ue*Math.sin(dt));xt<=0||xt>=V-1||Ct<=0||Ct>=K-1||(ht+=Pt[Ct*V+xt])}return ht}const At={bullInner:Fe.bullInner/Fe.doubleOuter,bullOuter:Fe.bullOuter/Fe.doubleOuter,trebleInner:Fe.trebleInner/Fe.doubleOuter,trebleOuter:Fe.trebleOuter/Fe.doubleOuter,doubleInner:Fe.doubleInner/Fe.doubleOuter};function ms(qe,ht=.08){const ue=Math.max(1,Math.floor(qe*(1-ht))),ft=Math.max(ue+1,Math.floor(qe*(1+ht)));let jt=ue,dt=-1;for(let xt=ue;xt<=ft;xt++){const Ct=ds(xt);Ct>dt&&(dt=Ct,jt=xt)}return jt}const et=vs,js=ms(et*At.doubleInner),us=ms(et*At.trebleOuter),Yt=ms(et*At.trebleInner),Ts=ms(et*At.bullOuter),rs=ms(et*At.bullInner);We({cx:es,cy:cs,bullInner:rs,bullOuter:Ts,trebleInner:Yt,trebleOuter:us,doubleInner:js,doubleOuter:et});const _t=qe=>{let ue=0;for(let ft=0;ft<180;ft++){const jt=ft*Math.PI/90,dt=Math.round(Rt.cx+qe*Z*Math.cos(jt)),xt=Math.round(Rt.cy+qe*Z*Math.sin(jt));dt<=0||dt>=V-1||xt<=0||xt>=K-1||(ue+=Pt[xt*V+dt])}return ue/180},Xt=(_t(Rt.r)+_t(us)+_t(Yt)+_t(js)+_t(Ts)+_t(rs))/(yt*6),hs=Math.max(0,Math.min(1,Xt)),Zs=Math.min(hs,Math.min(_t(Rt.r)/yt,_t(us)/yt,_t(Yt)/yt,_t(js)/yt,_t(Ts)/yt,_t(rs)/yt));pt(Math.round(Zs*100));const is=[{x:es,y:cs-et},{x:es+et,y:cs},{x:es,y:cs+et},{x:es-et,y:cs}];p(is),Be(is);try{Ds()}catch{}const fs=Zs>=.95;F({locked:fs})}function Qs(){if(!a.current)return alert("Capture a frame or upload a photo first.");const B=kd(a.current);if(Pe(B),!B.success||!B.homography){const K=B.missing.length?` Missing markers: ${B.missing.map(ke=>`${ke.toUpperCase()} (ID ${gs[ke]})`).join(", ")}`:"";alert(B.message?`${B.message}${K}`:`Marker detection failed.${K}`);return}We(null),p(B.points),Be(B.points,B.homography);const Y=ur(),Z={w:a.current.width,h:a.current.height},V=(B.errorPx??Number.POSITIVE_INFINITY)<=1.2;F({H:B.homography,createdAt:Date.now(),errorPx:B.errorPx??null,imageSize:Z,anchors:{src:Y,dst:B.points},locked:V?!0:H}),c("computed")}m.useEffect(()=>{Be()},[y,g]),m.useEffect(()=>{if(!at||!n)return;let B=0;const Y=()=>{try{Dt()}catch{}B=requestAnimationFrame(Y)};return B=requestAnimationFrame(Y),()=>cancelAnimationFrame(B)},[at,n]),m.useEffect(()=>{(async()=>{try{if(!H||!ee)return;const B=a.current?{w:a.current.width,h:a.current.height}:null,Y=JSON.stringify({H:g,anchors:null,imageSize:B,errorPx:P??null});try{await St(`/cam/calibration/${ee}`,{method:"POST",headers:{"Content-Type":"application/json"},body:Y}),console.log("[Calibrator] Posted calibration for code",ee)}catch(Z){console.warn("[Calibrator] Upload calibration failed",Z)}try{const Z=localStorage.getItem("authToken");Z&&(await St("/api/user/calibration",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Z}`},body:Y}),console.log("[Calibrator] Synced calibration to user account"))}catch(Z){console.warn("[Calibrator] User calibration sync failed",Z)}}catch{}})()},[H,ee]);function zt(){const{preferredCameraId:B,preferredCameraLabel:Y,setPreferredCamera:Z,cameraEnabled:V,setCameraEnabled:K,preferredCameraLocked:ke,setPreferredCameraLocked:be}=ls(),[st,nt]=m.useState([]),[Se,gt]=m.useState(""),[Pt,yt]=m.useState(!1),qt=m.useRef(null),$t=document.getElementById("dropdown-portal-root")||(()=>{const vt=document.createElement("div");return vt.id="dropdown-portal-root",document.body.appendChild(vt),vt})();async function Es(){gt("");try{try{await navigator.mediaDevices.getUserMedia({video:!0})}catch{}const we=(await navigator.mediaDevices.enumerateDevices()).filter(es=>es.kind==="videoinput");nt(we)}catch{gt("Unable to list cameras. Grant camera permission in your browser.")}}m.useEffect(()=>{Es()},[]),m.useEffect(()=>{function vt(we){qt.current&&!qt.current.contains(we.target)&&yt(!1)}return document.addEventListener("mousedown",vt),()=>document.removeEventListener("mousedown",vt)},[]);const as=st.find(vt=>vt.deviceId===B),Rt=as?`${as.label||"Camera"}`:B?"Camera (unavailable)":"Auto (browser default)",Ft=B&&!as;return e.jsxs("div",{className:"mt-3 p-3 rounded-lg border border-indigo-500/30 bg-indigo-500/5",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Select camera device"}),Se&&e.jsx("div",{className:"text-rose-400 text-sm mb-2",children:Se}),Ft&&e.jsxs("div",{className:"text-amber-400 text-sm mb-2",children:["Selected camera is no longer available.",e.jsx("button",{className:"underline ml-1",onClick:()=>Z(void 0,"",!0),disabled:n,children:"Use auto-selection"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[ke?e.jsx("div",{className:"text-xs text-emerald-400",children:"ðŸ”’ Camera selection locked"}):e.jsx("div",{className:"text-xs text-slate-400",children:"Camera selection unlocked"}),e.jsx("button",{className:"btn btn--ghost px-2 py-0.5 text-xs ml-2",onClick:()=>{re.current=!1,be(!ke)},children:ke?"Unlock":"Lock"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled-calibrator",checked:V,onChange:vt=>K(vt.target.checked),className:"w-4 h-4",disabled:n}),e.jsx("label",{htmlFor:"cameraEnabled-calibrator",className:"text-sm",children:"Enable camera for scoring"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center text-sm",children:[e.jsxs("div",{className:"col-span-2 relative",ref:qt,children:[e.jsxs("div",{className:`input w-full flex items-center justify-between cursor-pointer ${n?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!n&&yt(!Pt),children:[e.jsx("span",{className:"truncate",children:Rt}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${Pt?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),Pt&&!n&&Ql.createPortal(e.jsx("div",{className:"fixed left-0 top-0 w-full h-full z-[9999]",style:{pointerEvents:"none"},children:e.jsx("div",{className:"absolute",style:{left:qt.current?.getBoundingClientRect().left||0,top:qt.current?.getBoundingClientRect().bottom||0,width:qt.current?.offsetWidth||240,pointerEvents:"auto"},children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:[e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm",onClick:()=>{Z(void 0,"",!0)},children:"Auto (browser default)"}),st.map(vt=>{const we=`${vt.label||"Camera"}`;return e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm",onClick:()=>{Z(vt.deviceId,vt.label||"",!0)},children:we},vt.deviceId)}),e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm text-indigo-400",onClick:()=>{u("phone"),c("camera"),r(!1),C(!1)},children:"ðŸ“± Phone Camera"},"phone-camera"),e.jsx("div",{className:"px-3 py-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>yt(!1),children:"Close"})})]})})}),$t)]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn px-2 py-1",onClick:Es,disabled:n,children:"Refresh"})})]}),Y&&e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["Selected: ",Y]}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Tip: All camera technology is supported for autoscoring needsâ€”select your camera here and then open Calibrator to align."})]})}if(k&&!A){const B=Zt??(typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html");return e.jsxs("div",{className:"mx-auto flex min-h-[calc(100vh-140px)] w-full max-w-xl flex-col justify-center gap-6 p-6",children:[e.jsxs("div",{className:"space-y-5 rounded-3xl border border-indigo-400/30 bg-slate-900/70 p-6 text-slate-100 shadow-xl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-indigo-300",children:"Mobile camera"}),e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-white",children:"This device is ready to stream as your dartboard camera"}),e.jsx("p",{className:"text-sm text-slate-200/80",children:"Open the lightweight mobile camera page to stream video to your desktop calibrator. You can still come back here if you need the full desktop tools."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:B,className:"btn w-full justify-center px-4 py-2 text-base",children:"Open mobile camera"}),e.jsx("button",{type:"button",className:"btn btn--ghost w-full justify-center px-4 py-2 text-sm",onClick:()=>ge(B,"link"),children:It==="link"?"Link copied!":"Copy link"})]}),e.jsxs("p",{className:"text-xs text-slate-300/70",children:["On a desktop, open Calibrator and generate a pairing code. Then tap ",e.jsx("span",{className:"font-semibold",children:"Pair with Desktop"})," from the mobile camera page to connect this device."]})]}),e.jsx("button",{type:"button",className:"self-center text-xs font-medium text-indigo-200 underline decoration-dotted decoration-indigo-300/70 transition hover:text-indigo-100",onClick:()=>M(!0),children:"Continue to desktop calibrator"})]})}return e.jsxs("div",{className:"space-y-6",children:[k&&A&&e.jsx("div",{className:"rounded-2xl border border-indigo-400/30 bg-indigo-500/10 p-4 text-sm text-indigo-100",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"leading-relaxed",children:"Using a phone? Switch back to the streamlined mobile camera interface for an easier pairing flow."}),e.jsx("button",{type:"button",className:"btn btn--ghost px-3 py-1 text-xs",onClick:()=>M(!1),children:"Open mobile camera mode"})]})}),e.jsxs("div",{className:"card space-y-6 p-6",children:[e.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-indigo-300",children:"Marker calibration"}),e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-white",children:"Align your board with the autoscoring overlay"}),e.jsx("p",{className:"max-w-2xl text-sm opacity-80",children:"Place the printable fiducial markers around the double ring, capture a clear frame, and let the calibrator compute a precise homography."})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 text-xs font-medium",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-indigo-400/50 bg-indigo-500/10 px-3 py-1",children:[e.jsx("span",{className:"opacity-60",children:"Mode"}),e.jsx("span",{children:f==="local"?"Desktop camera":f==="phone"?"Phone camera":"Wifi device"})]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 ${n?"border-emerald-400/60 bg-emerald-500/10 text-emerald-100":"border-white/20 bg-white/5 text-slate-200"}`,children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${n?"bg-emerald-400":"bg-slate-400"}`}),n?"Live stream active":"Stream idle"]}),H?e.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-emerald-400/60 bg-emerald-500/10 px-3 py-1 text-emerald-100",children:e.jsxs("span",{children:["Locked â€¢ ",P!=null?`${P.toFixed(2)}px error`:"ready"]})}):e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-amber-400/40 bg-amber-500/10 px-3 py-1 text-amber-100",children:[e.jsx("span",{children:"Not locked"}),P!=null&&e.jsxs("span",{children:["â€¢ ",P.toFixed(2),"px"]})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-indigo-500/30 bg-indigo-500/5 p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wide text-indigo-200",children:"Marker kit"}),e.jsx("p",{className:"mt-1 text-sm opacity-80",children:"Print the fiducials, tape them flush with the outer double ring, then capture a clear frame before running detection."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn px-3 py-1.5",onClick:ot,children:"Open printable sheet"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1.5",onClick:()=>Pe(null),children:"Clear marker status"})]})]}),e.jsxs("ol",{className:"mt-3 list-decimal list-inside space-y-2 text-sm opacity-75",children:[e.jsx("li",{children:"Print and cut out the four markers. Place them on the top, right, bottom, and left edges of the double ring."}),e.jsx("li",{children:"Start your camera or upload a still frame with the full board visible and the markers unobstructed."}),e.jsxs("li",{children:["Run ",e.jsx("strong",{children:"Auto detect"})," for circle fitting or ",e.jsx("strong",{children:"Detect markers"})," for fiducials, then lock calibration when error â‰¤ 1.2px."]})]})]}),e.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(320px,1fr)]",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4 rounded-2xl border border-white/10 bg-black/40 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"uppercase tracking-wide opacity-60",children:"Video source"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:`btn px-3 py-1 ${f==="local"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{u("local"),Ee()},title:"Use local camera",children:"Local"}),e.jsx("button",{className:`btn px-3 py-1 ${f==="phone"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{u("phone"),Ee()},title:"Pair phone camera",children:"Phone"}),e.jsx("button",{className:`btn px-3 py-1 ${f==="wifi"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{u("wifi"),Ee(),z()},title:"Discover wifi/USB autoscoring devices",children:"Wifi"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-70",children:"Zoom"}),e.jsx("input",{type:"range",min:50,max:200,step:5,value:Math.round((N||1)*100),onChange:B=>I(Math.max(.5,Math.min(2,Number(B.target.value)/100)))}),e.jsxs("span",{className:"w-12 text-right",children:[Math.round((N||1)*100),"%"]})]}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>I(1),children:"Actual"})]})]}),e.jsxs("div",{className:"relative w-full overflow-hidden rounded-2xl border border-indigo-400/30 bg-black",style:{aspectRatio:D?`${D.w} / ${D.h}`:"16 / 9"},children:[(!n||!Oe)&&e.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-gradient-to-br from-black/40 to-black/10",children:e.jsx(Ac,{calibrationComplete:d==="computed"})}),e.jsxs("div",{className:"absolute inset-0",style:{transform:`scale(${N||1})`,transformOrigin:"center center"},children:[e.jsx("video",{ref:t,onLoadedMetadata:B=>{try{const Y=B.currentTarget;Y.videoWidth&&Y.videoHeight&&T({w:Y.videoWidth,h:Y.videoHeight})}catch{}},className:`absolute inset-0 h-full w-full object-cover transition-opacity duration-300 ${y?"opacity-0 -z-10":"opacity-100 z-10"}`,autoPlay:!0,playsInline:!0,muted:!0,controls:!1}),l&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur",children:e.jsx("button",{className:"rounded-lg bg-white px-4 py-2 font-semibold text-slate-900 shadow-lg",onClick:async()=>{try{await t.current?.play(),o(!1),r(!0),c("capture")}catch(B){console.warn("Tap-to-play retry failed",B),alert("Tap to enable video failed. Please check browser settings or reload the page.")}},children:"Tap to allow video"})}),e.jsx("canvas",{ref:a,className:`absolute inset-0 h-full w-full transition-opacity duration-300 ${y?"opacity-100 z-10":"opacity-0 -z-10"}`}),e.jsx("canvas",{ref:s,onClick:Kt,className:"absolute inset-0 z-30 h-full w-full cursor-crosshair"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",className:"accent-indigo-600",checked:E,onChange:B=>_(B.target.checked)}),"Show preferred-view guide overlay"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Phase"}),e.jsx("div",{className:"text-sm font-semibold capitalize",children:d})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Points selected"}),e.jsxs("div",{className:"text-sm font-semibold",children:[x.length," / 4"]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Fit error"}),e.jsx("div",{className:"text-sm font-semibold",children:P!=null?`${P.toFixed(2)} px`:"â€”"})]})]})]}),e.jsxs("aside",{className:"space-y-4",children:[e.jsx(zt,{}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 1 Â· Capture image"}),e.jsx("p",{className:"text-xs opacity-70",children:"Start your preferred camera or upload a static photo of the board."})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:Ee,children:"Stop camera"}),e.jsx("button",{className:"btn",onClick:Dt,disabled:!n,children:"Capture frame"})]}):e.jsxs(e.Fragment,{children:[f==="local"&&e.jsx("button",{className:"btn",onClick:ve,children:"Start camera"}),f==="phone"&&e.jsx("button",{className:"btn",onClick:U,children:"Pair phone camera"}),f==="wifi"&&e.jsx("button",{className:"btn",onClick:z,children:"Connect wifi camera"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("input",{ref:i,type:"file",accept:"image/*",className:"hidden",onChange:He}),e.jsx("button",{className:"btn",onClick:Ie,children:"Upload photo"})]})]}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 2 Â· Detect markers"}),e.jsx("p",{className:"text-xs opacity-70",children:"Use fiducials or auto-detect to seed the rim points."})]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] ${Ke>=85?"border-emerald-400/60 bg-emerald-500/10 text-emerald-100":"border-white/20 bg-white/5 text-slate-200"}`,children:[e.jsx("span",{className:"opacity-70",children:"Confidence"}),e.jsxs("span",{children:[Ke,"%"]})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",className:"accent-indigo-600",checked:at,onChange:B=>pe(B.target.checked)}),"Live auto-detect while streaming"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:!y,onClick:ys,children:"Auto detect"}),e.jsx("button",{className:"btn",disabled:!y,onClick:Qs,children:"Detect markers"})]}),Ne&&e.jsx("div",{className:`rounded-lg border px-3 py-2 text-xs ${Ne.success?"bg-emerald-500/10 border-emerald-500/30 text-emerald-100":"bg-rose-500/10 border-rose-500/30 text-rose-100"}`,children:Ne.success?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Detected markers â†’ board anchors:"," ",Yi.map(B=>{const Y=Ne.assignments?.[B];return`${B.toUpperCase()}â†’${Y?`ID ${Y.id}`:"â€”"}`}).join(", ")]}),Ne.errorPx!=null&&e.jsxs("div",{children:["RMS error: ",Ne.errorPx.toFixed(2)," px"]}),e.jsxs("div",{className:"opacity-80",children:["Markers correspond to IDs TOP ",gs.top,", RIGHT ",gs.right,", BOTTOM ",gs.bottom,", LEFT ",gs.left,"."]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:Ne.message||"Unable to detect all markers."}),Ne.missing.length>0&&e.jsxs("div",{children:["Missing: ",Ne.missing.map(B=>`${B.toUpperCase()} (ID ${gs[B]})`).join(", ")]})]})})]}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 3 Â· Align & lock"}),e.jsx("p",{className:"text-xs opacity-70",children:"Click points in TOP â†’ RIGHT â†’ BOTTOM â†’ LEFT order, refine edges, then lock the calibration."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:x.length!==4,onClick:Ds,children:"Compute"}),e.jsx("button",{className:`btn ${H?"bg-emerald-600 hover:bg-emerald-700":""}`,onClick:()=>F({locked:!H}),children:H?"Unlock":"Lock in"})]}),H&&e.jsxs("div",{className:"text-xs opacity-75",children:["Calibration saved ",P!=null?`Â· error ${P.toFixed(2)} px`:""]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:x.length===0,onClick:Us,children:"Undo"}),e.jsx("button",{className:"btn",disabled:x.length===0,onClick:Xs,children:"Refine points"}),e.jsx("button",{className:"btn",onClick:dn,children:"Reset"})]})]})]})]}),f==="phone"&&!n&&e.jsxs("div",{className:"space-y-2 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white",children:[e.jsx("div",{className:"font-semibold",children:"Phone pairing"}),e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>ge(Nt,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all text-[11px]",children:Nt}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:It==="link"?"Copied!":"Copy link"})]}),e.jsx("div",{className:"flex items-center gap-2 text-[11px]",children:e.jsx("a",{href:Nt,target:"_blank",rel:"noreferrer",className:"underline decoration-dotted text-indigo-200 hover:text-indigo-100 transition",children:"Open link in new tab"})}),e.jsxs("div",{className:"opacity-80",children:["WS: ",xe?xe.readyState===1?"open":xe.readyState===0?"connecting":xe.readyState===2?"closing":"closed":"not started"," Â· ",ut?.https?"HTTPS on":"HTTP only"]}),ee&&e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>ge(ee,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:ee}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:It==="code"?"Copied!":"Copy code"})]}),Et&&e.jsx("img",{className:"mt-1 h-40 w-40 rounded bg-white",alt:"Scan to open",src:Et}),e.jsxs("div",{className:"flex items-center gap-2",children:[$!==null&&e.jsxs("span",{children:["Expires in ",$,"s"]}),e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:Ae,children:"Regenerate"})]}),Ot&&e.jsxs("div",{className:"space-y-2 rounded-lg border border-slate-700/50 bg-slate-900/60 p-3 text-slate-200",children:[e.jsx("div",{className:"font-semibold",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc space-y-1 pl-4",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",ut?.https?ut.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer HTTPS when enabled)."})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>Bt(!1),children:"Hide tips"})})]})]}),f==="wifi"&&!n&&e.jsxs("div",{className:"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white",children:[e.jsx("div",{className:"font-semibold",children:"Wifi scoring devices"}),Jt?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-white"}),e.jsx("span",{children:"Scanning network for devicesâ€¦"})]}):Tt.length>0?e.jsxs("div",{className:"space-y-2",children:[Tt.map(B=>e.jsxs("div",{className:"flex items-center justify-between rounded border border-slate-700/50 bg-slate-900/60 p-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:B.name}),e.jsxs("div",{className:"opacity-70",children:[B.ip,":",B.port," Â· ",B.type.toUpperCase()]}),e.jsxs("div",{className:"opacity-70 text-xs",children:["Capabilities: ",B.capabilities.join(", ")]})]}),e.jsx("button",{className:`btn px-2 py-1 text-xs ${B.status==="connecting"?"bg-yellow-600":B.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>oe(B),disabled:B.status==="connecting",children:B.status==="connecting"?"Connectingâ€¦":"Connect"})]},B.id)),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:z,children:"Rescan network"})})]}):e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("div",{children:"No wifi scoring devices found."}),e.jsx("div",{className:"opacity-70",children:"Ensure your wifi cameras are powered on and on the same network."}),e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:z,children:"Scan again"})]})]})]})]})}const Bd=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function Ud(t){return t==="DB"?50:Number(t.slice(1))*2}function $d(t){return Bd.includes(t)?Ud(t):32}function ia(t,a="D16"){if(t>170||t<=1)return[];const s={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(s[t])return s[t];const i=$d(a),n=[];for(const r of[60,57,54,51,48])if(t-r===i){n.push(`T${r/3} ${a}`);break}if(!n.length){for(const r of[20,19,18,17,16,15])if(t-r===i){n.push(`${r} ${a}`);break}}return n}function na(t,a,s,i,n){try{const r=window.speechSynthesis;if(!r)return;const l=new SpeechSynthesisUtterance,o=s<=170&&s>0;if(n?.checkoutOnly&&!o)return;if(l.text=o?`${t}, you have ${s} remaining.`:`${a}`,i){const d=r.getVoices().find(c=>c.name===i);d&&(l.voice=d)}typeof n?.volume=="number"&&(l.volume=Math.max(0,Math.min(1,n.volume))),l.rate=1,l.pitch=1,r.speak(l)}catch{}}function oa({label:t,autoStart:a=!1,scale:s,className:i,aspect:n="inherit",style:r,fill:l=!1}){const o=m.useRef(null),[d,c]=m.useState(!1),[f,u]=m.useState(null),[x,p]=m.useState(null),[y,C]=m.useState(null),[D,T]=m.useState(()=>localStorage.getItem("ndn:camera:mode")||"local"),[N,I]=m.useState(null),[A,M]=m.useState(Date.now()),[k,b]=m.useState(!1),[g,F]=m.useState(null),[J,P]=m.useState(null),[H,E]=m.useState(!0),[_,ae]=m.useState([]),[L,Q]=m.useState(!1),[ce,me]=m.useState([]),[_e,ze]=m.useState(!1),We=ls(te=>te.autoscoreProvider),at=ls(te=>te.setPreferredCameraLocked);if(We==="manual"){const ye=[l?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",i].filter(Boolean).join(" ").trim(),fe={...r||{}};return!l&&fe.aspectRatio===void 0&&fe.height===void 0&&fe.minHeight===void 0&&(fe.aspectRatio="4 / 3"),e.jsx("div",{className:ye,style:fe,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}m.useEffect(()=>{const te=window.location.hostname;(te==="localhost"||te==="127.0.0.1")&&St("/api/hosts").then(ye=>ye.json()).then(ye=>{const fe=Array.isArray(ye?.hosts)&&ye.hosts.find(he=>he);fe&&F(fe)}).catch(()=>{}),St("/api/https-info").then(ye=>ye.json()).then(ye=>{ye&&typeof ye.https=="boolean"&&P({https:!!ye.https,port:Number(ye.port)||8788})}).catch(()=>{})},[]);const pe=m.useMemo(()=>{const te=x||"____",ye="ws://localhost:8787";if(ye.length>0)try{const Te=new URL(ye);return`${`${Te.protocol==="wss:"?"https":"http"}://${Te.host}${Te.pathname.endsWith("/ws")?"":Te.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${te}`}catch{}const fe=g||window.location.hostname,he=!!J?.https,Oe=he?J?.port||8788:8787;return`${he?"https":"http"}://${fe}:${Oe}/mobile-cam.html?code=${te}`},[x,g,J]);m.useEffect(()=>{localStorage.setItem("ndn:camera:mode",D)},[D]);const[Ke,pt]=m.useState("");m.useEffect(()=>{if(!x){pt("");return}Do.toDataURL(pe,{width:160,margin:1,color:{dark:"#000000",light:"#ffffff"}}).then(pt).catch(()=>pt(""))},[pe,x]),m.useEffect(()=>{if(!N)return;const te=setInterval(()=>M(Date.now()),1e3);return()=>clearInterval(te)},[N]);const Ne=m.useMemo(()=>N?Math.max(0,Math.ceil((N-A)/1e3)):null,[N,A]);m.useEffect(()=>{a?Pe().catch(()=>{}):de()},[a]);async function Pe(){if(D==="wifi")return ot();try{const{preferredCameraId:te,setPreferredCamera:ye}=ls.getState(),fe=te?{video:{deviceId:{exact:te}},audio:!1}:{video:!0,audio:!1};let he;try{he=await navigator.mediaDevices.getUserMedia(fe)}catch(Oe){const it=Oe&&(Oe.name||Oe.code)||"";if(te&&(it==="OverconstrainedError"||it==="NotFoundError"))he=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw Oe}o.current&&(o.current.srcObject=he,await o.current.play(),c(!0))}catch{}}function de(){o.current&&o.current.srcObject&&(o.current.srcObject.getTracks().forEach(ye=>ye.stop()),o.current.srcObject=null,c(!1))}async function ot(){Q(!0);try{const te=await Uo();ae(te),te.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(te){console.error("Wifi device discovery failed:",te),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Q(!1)}}async function xe(te){try{ae(fe=>fe.map(he=>he.id===te.id?{...he,status:"connecting"}:he));const ye=await Fo(te);if(ye&&o.current)o.current.srcObject=ye,await o.current.play(),c(!0),ae(fe=>fe.map(he=>he.id===te.id?{...he,status:"online"}:he));else throw new Error("Failed to get video stream")}catch(ye){console.error("Failed to connect to wifi device:",ye),alert(`Failed to connect to ${te.name}. Please check the device and try again.`),ae(fe=>fe.map(he=>he.id===te.id?{...he,status:"offline"}:he))}}async function Re(){ze(!0);try{const te=await Pd();me(te);const ye=await Rd();ye&&me(fe=>[...fe,ye]),te.length===0&&!ye&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(te){console.error("USB device discovery failed:",te),alert("Failed to discover USB devices. Please check device connections.")}finally{ze(!1)}}async function re(te){try{me(fe=>fe.map(he=>he.id===te.id?{...he,status:"connecting"}:he));const ye=await Ld(te);if(ye&&o.current)o.current.srcObject=ye,await o.current.play(),c(!0),T("wifi"),me(fe=>fe.map(he=>he.id===te.id?{...he,status:"online"}:he));else throw new Error("Failed to get video stream")}catch(ye){console.error("Failed to connect to USB device:",ye),alert(`Failed to connect to ${te.name}. Please check the device and try again.`),me(fe=>fe.map(he=>he.id===te.id?{...he,status:"offline"}:he))}}function ee(){if(f&&f.readyState===WebSocket.OPEN)return f;const te="ws://localhost:8787",ye=te.length>0?te.endsWith("/ws")?te:te.replace(/\/$/,"")+"/ws":void 0,fe=window.location.protocol==="https:"?"wss":"ws",he=`${fe}://${window.location.host}/ws`,Oe=window.location.hostname,it=Oe==="localhost"||Oe==="127.0.0.1",Te=Oe.endsWith("onrender.com"),Et="wss://ninedartnation.onrender.com/ws";let lt=ye;lt||(it?lt=`${fe}://${Oe}:8787/ws`:Te?lt=he:lt=Et),lt||(lt=he);const S=new WebSocket(lt);return u(S),S}async function bt(){T("phone"),b(!1);const te=ee();te.readyState===WebSocket.OPEN?te.send(JSON.stringify({type:"cam-create"})):te.onopen=()=>te.send(JSON.stringify({type:"cam-create"})),te.onmessage=async ye=>{const fe=JSON.parse(ye.data);if(fe.type==="cam-code")p(fe.code),fe.expiresAt&&I(fe.expiresAt);else if(fe.type==="cam-peer-joined"){b(!0);const he=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});C(he),he.onicecandidate=it=>{it.candidate&&x&&te.send(JSON.stringify({type:"cam-ice",code:x,payload:it.candidate}))},he.ontrack=it=>{if(o.current){const Te=it.streams?.[0];Te&&(o.current.srcObject=Te,o.current.play().catch(()=>{}),c(!0))}};const Oe=await he.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await he.setLocalDescription(Oe),x&&te.send(JSON.stringify({type:"cam-offer",code:x,payload:Oe}))}else if(fe.type==="cam-answer")y&&await y.setRemoteDescription(new RTCSessionDescription(fe.payload));else if(fe.type==="cam-ice"&&y)try{await y.addIceCandidate(fe.payload)}catch{}}}function Ze(){p(null),I(null),b(!1),f&&f.readyState===WebSocket.OPEN?f.send(JSON.stringify({type:"cam-create"})):bt();try{at(!0)}catch{}}function Ye(){if(de(),p(null),b(!1),I(null),y){try{y.close()}catch{}C(null)}}return e.jsx(Fd,{label:t,autoStart:a,start:Pe,stopAll:Ye,startPhonePairing:bt,startWifiConnection:ot,startUsbConnection:Re,connectToWifiDevice:xe,connectToUsbDevice:re,videoRef:o,streaming:d,mode:D,setMode:T,pairCode:x,mobileUrl:pe,ttl:Ne,qrDataUrl:Ke,regenerateCode:Ze,httpsInfo:J,showTips:H,setShowTips:E,wifiDevices:_,usbDevices:ce,discoveringWifi:L,discoveringUsb:_e,scaleOverride:s,className:i,aspect:n,style:r,fill:l})}function Fd(t){const{cameraScale:a,cameraAspect:s}=ls(),i=Math.max(.5,Math.min(1.25,Number(t.scaleOverride??a??1))),{label:n,start:r,stopAll:l,startPhonePairing:o,startWifiConnection:d,startUsbConnection:c,connectToWifiDevice:f,connectToUsbDevice:u,videoRef:x,streaming:p,mode:y,setMode:C,pairCode:D,mobileUrl:T,ttl:N,qrDataUrl:I,regenerateCode:A,httpsInfo:M,showTips:k,setShowTips:b,wifiDevices:g,usbDevices:F,discoveringWifi:J,discoveringUsb:P,className:H,aspect:E,style:_,fill:ae}=t,[L,Q]=m.useState(null),ce=m.useRef(null);m.useEffect(()=>()=>{ce.current&&window.clearTimeout(ce.current)},[]);const me=E&&E!=="inherit"?E:s||"wide",_e=me!=="free",ze=_e?me==="square"?"aspect-square":me==="portrait"?"aspect-[3/4]":me==="classic"?"aspect-[4/3]":"aspect-video":"",at=[ae?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto flex flex-col",H].filter(Boolean).join(" ").trim(),pe={..._||{}},Ke=ae?"relative flex-1 min-h-[220px] bg-black":"relative w-full bg-black",pt={style:{transform:`scale(${i})`,transformOrigin:"center"}},Ne=(()=>{const de="absolute inset-0 w-full h-full object-contain object-center bg-black";return ae?_e?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${ze}`,children:e.jsx("video",{ref:x,className:de,...pt})})}):e.jsx("video",{ref:x,className:de,...pt}):_e?e.jsx("div",{className:`relative w-full ${ze}`,children:e.jsx("video",{ref:x,className:de,...pt})}):e.jsx("video",{ref:x,className:"w-full h-full object-contain object-center bg-black",...pt})})();async function Pe(de,ot){if(de)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(de);else{const xe=document.createElement("textarea");xe.value=de,xe.style.position="fixed",xe.style.opacity="0",document.body.appendChild(xe),xe.focus(),xe.select(),document.execCommand("copy"),document.body.removeChild(xe)}Q(ot),ce.current&&window.clearTimeout(ce.current),ce.current=window.setTimeout(()=>Q(null),1500)}catch(xe){console.warn("Copy to clipboard failed:",xe),Q(null)}}return e.jsxs("div",{className:at,style:pe,children:[e.jsx("div",{className:Ke,children:Ne}),e.jsxs("div",{className:"p-1 flex items-center justify-between bg-black/60 text-white text-[10px] gap-1",children:[e.jsx("span",{className:"truncate",children:n||(p?y==="phone"?"PHONE LIVE":y==="wifi"?"WIFI LIVE":"LIVE":"Camera")}),e.jsxs("div",{className:"flex items-center gap-1",children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-1 py-0.5 rounded ${y==="local"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{C("local"),r()},children:"Local"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${y==="phone"?"bg-emerald-600":"bg-slate-700"}`,onClick:o,children:"Phone"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${y==="wifi"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{C("wifi"),d()},children:"Wifi"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${y==="wifi"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{C("wifi"),c()},children:"USB"})]}),p?e.jsx("button",{className:"px-1 py-0.5 rounded bg-rose-600",onClick:l,children:"Stop"}):null]})]}),y==="phone"&&D&&!p&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>Pe(T,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:T}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:L==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:T,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>Pe(D,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:D}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:L==="code"?"Copied!":"Copy"})]})]}),I&&e.jsx("img",{className:"mt-1 w-[160px] h-[160px] bg-white rounded",alt:"Scan to open",src:I}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[N!==null&&e.jsxs("span",{children:["Expires in ",N,"s"]}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:A,children:"Regenerate"})]}),k&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",M?.https?M.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>b(!1),children:"Hide tips"})})]})]}),y==="wifi"&&!p&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),J?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):g.length>0?e.jsxs("div",{className:"space-y-1",children:[g.map(de=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:de.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[de.ip,":",de.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${de.status==="connecting"?"bg-yellow-600":de.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>f(de),disabled:de.status==="connecting",children:de.status==="connecting"?"...":"Connect"})]},de.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:d,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:d,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),P?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):F.length>0?e.jsxs("div",{className:"space-y-1",children:[F.map(de=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:de.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:de.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${de.status==="connecting"?"bg-yellow-600":de.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>u(de),disabled:de.status==="connecting",children:de.status==="connecting"?"...":"Connect"})]},de.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:c,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:c,children:"Scan USB"})]})]})]})]})}function _d(t){return t.dartsThrown===0?0:(t.totalScoreStart-t.totalScoreRemaining)/t.dartsThrown*3}function Wd(t){const a=_d(t),s=t.finished;return{avg:a,isCompleted:s,darts:t.dartsThrown,checkout:t.checkoutScore??0}}function Hd(t){if(t.legs.length===0)return;const a=[];let s,i=t.bestCheckout??0;for(const n of t.legs){if(!n.finished)continue;const r=Wd(n);a.push(r.avg),(!s||r.darts<s.darts||r.darts===s.darts&&(n.endTime??0)<s.timestamp)&&(s={darts:r.darts,timestamp:n.endTime??Date.now()}),r.checkout>i&&(i=r.checkout)}a.length&&(t.bestThreeDartAvg=Math.max(...a),t.worstThreeDartAvg=Math.min(...a)),s&&(t.bestNineDart=s),t.bestCheckout=i}const Ln=on((t,a)=>({roomId:"",players:[],currentPlayerIdx:0,startingScore:501,inProgress:!1,newMatch:(s,i,n="")=>t(()=>({players:s.map((l,o)=>({id:`${o}`,name:l,legsWon:0,legs:[]})),currentPlayerIdx:0,startingScore:i,inProgress:!0,roomId:n,bestLegThisMatch:void 0})),addVisit:(s,i)=>t(n=>{if(!n.inProgress)return n;const r=n.players[n.currentPlayerIdx];let l=r.legs[r.legs.length-1];return(!l||l.finished)&&(l={visits:[],totalScoreStart:n.startingScore,totalScoreRemaining:n.startingScore,dartsThrown:0,finished:!1,checkoutScore:null,startTime:Date.now()},r.legs.push(l)),l.visits.push({darts:i,score:s}),l.dartsThrown+=i,l.totalScoreRemaining=Math.max(0,l.totalScoreRemaining-s),{...n}}),undoVisit:()=>t(s=>{const i=s.players[s.currentPlayerIdx],n=i.legs[i.legs.length-1];if(!n||n.finished||n.visits.length===0)return s;const r=n.visits.pop();return n.dartsThrown-=r.darts,n.totalScoreRemaining+=r.score,{...s}}),endLeg:s=>t(i=>{const n=i.players[i.currentPlayerIdx],r=n.legs[n.legs.length-1];if(!r||r.finished)return i;if(r.finished=!0,r.checkoutScore=s,r.endTime=Date.now(),r.totalScoreRemaining===0){n.legsWon+=1;const l=i.bestLegThisMatch;(!l||r.dartsThrown<l.darts)&&(i.bestLegThisMatch={playerId:n.id,darts:r.dartsThrown,timestamp:r.endTime})}return{...i}}),nextPlayer:()=>t(s=>({...s,currentPlayerIdx:(s.currentPlayerIdx+1)%s.players.length})),endGame:()=>t(s=>{for(const i of s.players)Hd(i);return{...s,inProgress:!1}}),importState:s=>t(()=>({...s}))}));function zd(t,a){const s=md(t,a);return ud(s)}function qd(t){try{if(!t||typeof t!="object")return null;if((t.type==="dart"||t.kind==="dart"||t.event==="dart")&&typeof t.value=="number"){const a=Xi(t.ring);return Qi(t.value,a)}if(typeof t.value=="number"&&t.ring){const a=Xi(t.ring);return Qi(t.value,a)}if(typeof t.score=="string"){const a=t.score.trim().toUpperCase();if(a==="50"||a==="DBULL"||a==="INNER_BULL")return{value:50,ring:"INNER_BULL",sector:null,mult:0};if(a==="25"||a==="BULL"||a==="OBULL")return{value:25,ring:"BULL",sector:null,mult:0};const s=a.match(/^(S|D|T)(\d{1,2})$/);if(s){const i=s[1]==="S"?1:s[1]==="D"?2:3,n=parseInt(s[2],10);if(n>=1&&n<=20)return{value:n*i,ring:i===1?"SINGLE":i===2?"DOUBLE":"TRIPLE",sector:n,mult:i}}}if(typeof t.sector=="number"&&typeof t.mult=="number"){const a=Math.max(1,Math.min(20,Math.floor(t.sector))),s=t.mult===1?1:t.mult===2?2:3;return{value:a*s,ring:s===1?"SINGLE":s===2?"DOUBLE":"TRIPLE",sector:a,mult:s}}if(t.bull){const a=String(t.bull).toLowerCase()==="inner"||t.bull===!0;return{value:a?50:25,ring:a?"INNER_BULL":"BULL",sector:null,mult:0}}}catch{}return null}function Xi(t){const a=String(t||"").toUpperCase();return a.startsWith("TR")?"TRIPLE":a.startsWith("DO")?"DOUBLE":a.startsWith("SI")?"SINGLE":a==="INNER_BULL"||a==="DBULL"||a==="50"||a==="IBULL"?"INNER_BULL":a==="BULL"||a==="25"||a==="OBULL"||a==="OUTER_BULL"?"BULL":a==="MISS"||a==="0"?"MISS":"SINGLE"}function Qi(t,a){const s=Math.max(0,Math.min(60,Math.round(Number(t)||0)));return a==="INNER_BULL"?{value:50,ring:a}:a==="BULL"?{value:25,ring:a}:{value:s,ring:a}}function Vd(t,a){let s=null,i=!0;function n(){if(i)try{s=new WebSocket(t),s.onmessage=r=>{try{const l=JSON.parse(r.data),o=qd(l);o&&a(o)}catch{}},s.onclose=()=>{s=null,setTimeout(n,1500)},s.onerror=()=>{}}catch{setTimeout(n,2e3)}}return n(),{close:()=>{i=!1;try{s?.close()}catch{}}}}function Zi({storageKey:t,children:a,className:s,defaultWidth:i=640,defaultHeight:n=360,minWidth:r=320,minHeight:l=200,maxWidth:o=1600,maxHeight:d=1200}){const[c,f]=m.useState(()=>{try{const N=localStorage.getItem(t);if(N)return JSON.parse(N)}catch{}return{width:i,height:n}}),u=m.useRef(null),x=m.useRef(null);m.useEffect(()=>{function N(){try{localStorage.removeItem(t)}catch{}f({width:i,height:n})}return window.addEventListener("ndn:layout-reset",N),window.addEventListener("ndn:camera-reset",N),()=>{window.removeEventListener("ndn:layout-reset",N),window.removeEventListener("ndn:camera-reset",N)}},[t,i,n]),m.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(c))}catch{}},[c,t]);function p(N,I,A){return Math.max(I,Math.min(A,N))}function y(N,I){N.preventDefault();const A=x.current;if(!A)return;const M=A.getBoundingClientRect();u.current={x:N.clientX,y:N.clientY,w:M.width,h:M.height,dir:I},window.addEventListener("mousemove",C),window.addEventListener("mouseup",D)}function C(N){const I=u.current;if(!I)return;const A=N.clientX-I.x,M=N.clientY-I.y;let k=I.w,b=I.h;I.dir.includes("e")&&(k=p(I.w+A,r,o)),I.dir.includes("s")&&(b=p(I.h+M,l,d)),I.dir.includes("w")&&(k=p(I.w-A,r,o)),I.dir.includes("n")&&(b=p(I.h-M,l,d)),f({width:Math.round(k),height:Math.round(b)})}function D(){window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",D),u.current=null}const T={width:c.width?`${c.width}px`:void 0,height:c.height?`${c.height}px`:void 0,maxWidth:"100%",maxHeight:"80vh",position:"relative"};return e.jsxs("div",{ref:x,className:`${s||""}`,style:T,children:[a,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:N=>y(N,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:N=>y(N,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:N=>y(N,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:N=>y(N,"se")})]})}function Ys({storageKey:t,children:a,className:s,defaultWidth:i=520,defaultHeight:n,minWidth:r=360,minHeight:l=200,maxWidth:o=1100,maxHeight:d=900,fullScreen:c=!1,initialFitHeight:f=!1}){const[u,x]=m.useState(()=>{if(!c){try{const M=localStorage.getItem(t);if(M)return JSON.parse(M)}catch{}return{width:i,height:n}}return{}}),p=m.useRef(null);m.useEffect(()=>{if(c)return;function M(){try{localStorage.removeItem(t)}catch{}if(f&&N.current?.parentElement){const k=N.current.parentElement,b=window.getComputedStyle(k),g=parseFloat(b.paddingTop||"0")||0,F=parseFloat(b.paddingBottom||"0")||0,J=Math.max(0,k.clientHeight-g-F),P=Math.max(l,Math.min(d,Math.round(J)));x({width:i,height:P});return}x({width:i,height:n})}return window.addEventListener("ndn:layout-reset",M),()=>window.removeEventListener("ndn:layout-reset",M)},[t,i,n,c]),m.useEffect(()=>{if(!c)try{localStorage.setItem(t,JSON.stringify(u))}catch{}},[u,t,c]),m.useEffect(()=>{if(c||!f)return;const M=N.current?.parentElement;if(!M)return;const k=window.getComputedStyle(M),b=parseFloat(k.paddingTop||"0")||0,g=parseFloat(k.paddingBottom||"0")||0,F=Math.max(0,M.clientHeight-b-g),J=Math.max(l,Math.min(d,Math.round(F)));try{const P=localStorage.getItem(t);if(P){const E=JSON.parse(P)?.height||0;(!E||E<J)&&x(_=>({..._,height:J}));return}}catch{}x(P=>({...P,height:J}))},[f,c,t,l,d]);function y(M,k,b){return Math.max(k,Math.min(b,M))}function C(M,k){M.preventDefault();const b=N.current;if(!b)return;const g=b.getBoundingClientRect();p.current={x:M.clientX,y:M.clientY,w:g.width,h:g.height,dir:k},window.addEventListener("mousemove",D),window.addEventListener("mouseup",T)}function D(M){const k=p.current;if(!k)return;const b=M.clientX-k.x,g=M.clientY-k.y,F=k.dir;let J=k.w,P=k.h,H=1/0;const E=N.current?.parentElement;if(E){const ae=window.getComputedStyle(E),L=parseFloat(ae.paddingTop||"0")||0,Q=parseFloat(ae.paddingBottom||"0")||0;H=Math.max(0,E.clientHeight-L-Q)}const _=Math.min(d,isFinite(H)?H:d);F.includes("e")&&(J=y(k.w+b,r,o)),F.includes("s")&&(P=y(k.h+g,l,_)),F.includes("w")&&(J=y(k.w-b,r,o)),F.includes("n")&&(P=y(k.h-g,l,_)),x({width:Math.round(J),height:Math.round(P)})}function T(){window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",T),p.current=null}const N=m.useRef(null),I=c?{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%"}:{width:u.width?`${u.width}px`:void 0,height:u.height?`${u.height}px`:void 0,maxWidth:`${o}px`,maxHeight:"100%"},A=c?"card relative ndn-modal-full":"card relative";return e.jsxs("div",{ref:N,className:`${A} ${s||""}`,style:I,children:[a,!c&&e.jsx("div",{className:"resizer resizer-nw",onMouseDown:M=>C(M,"nw")}),!c&&e.jsx("div",{className:"resizer resizer-ne",onMouseDown:M=>C(M,"ne")}),!c&&e.jsx("div",{className:"resizer resizer-sw",onMouseDown:M=>C(M,"sw")}),!c&&e.jsx("div",{className:"resizer resizer-se",onMouseDown:M=>C(M,"se")}),!c&&e.jsx("div",{className:"resizer-edge resizer-s",onMouseDown:M=>C(M,"s")})]})}const _o=on((t,a)=>({samples:[],addSample:s=>t(i=>({samples:[...i.samples,s]})),clear:()=>t({samples:[]}),export:()=>a().samples.slice()}));function Je({onVisitCommitted:t,showToolbar:a=!0,onAutoDart:s,immediateAutoCommit:i=!1,hideInlinePanels:n=!1,scoringMode:r="x01",onGenericDart:l,onGenericReplace:o}){const d=m.useRef(null),{preferredCameraId:c,setPreferredCamera:f,autoscoreProvider:u,autoscoreWsUrl:x}=ls(),p=u==="manual",[y,C]=m.useState([]),D=m.useRef(null),T=m.useRef(null),[N,I]=m.useState(!1),[A,M]=m.useState(!1),[k,b]=m.useState(null),{H:g,imageSize:F,reset:J}=Nr(),[P,H]=m.useState(""),[E,_]=m.useState(""),[ae,L]=m.useState(0),[Q,ce]=m.useState("MISS"),[me,_e]=m.useState(0),[ze,We]=m.useState(0),[at,pe]=m.useState([]),Ke=Ln(U=>U.addVisit),pt=Ln(U=>U.endLeg),Ne=Ln(U=>U),Pe=_o(U=>U.addSample),[de,ot]=m.useState(""),[xe,Re]=m.useState(""),[re,ee]=m.useState(0),[bt,Ze]=m.useState(!1),[Ye,te]=m.useState(!1),[ye,fe]=m.useState("auto"),[he,Oe]=m.useState(!1),[it,Te]=m.useState(!1),[Et,lt]=m.useState(!1),S=m.useRef(null);m.useEffect(()=>{const U=()=>{p||Te(!0)};return window.addEventListener("ndn:open-autoscore",U),()=>window.removeEventListener("ndn:open-autoscore",U)},[p]),m.useEffect(()=>{const U=()=>lt(!0);return window.addEventListener("ndn:open-scoring",U),()=>window.removeEventListener("ndn:open-scoring",U)},[]),m.useEffect(()=>{const U=()=>{fe("manual"),Oe(!0)},z=()=>{fe("auto"),Oe(!1)};return window.addEventListener("ndn:open-manual",U),window.addEventListener("ndn:close-manual",z),()=>{window.removeEventListener("ndn:open-manual",U),window.removeEventListener("ndn:close-manual",z)}},[]),m.useEffect(()=>{p&&(fe("manual"),Te(!1))},[p]),m.useEffect(()=>{if(!he)return;const U=setInterval(()=>{try{const z=d.current,oe=S.current;if(!z||!oe)return;const ve=z.videoWidth||0,Ee=z.videoHeight||0;if(!ve||!Ee)return;const Ae=oe.clientWidth||640,Le=oe.clientHeight||360;oe.width!==Ae&&(oe.width=Ae),oe.height!==Le&&(oe.height=Le);const Ie=oe.getContext("2d");if(!Ie)return;Ie.imageSmoothingEnabled=!0;const He=Math.min(Ae/ve,Le/Ee),Dt=Math.round(ve*He),Be=Math.round(Ee*He),Kt=Math.floor((Ae-Dt)/2),Us=Math.floor((Le-Be)/2);Ie.fillStyle="#000",Ie.fillRect(0,0,Ae,Le),Ie.drawImage(z,Kt,Us,Dt,Be)}catch(z){console.warn("Manual preview update error:",z)}},120);return()=>clearInterval(U)},[he]),m.useEffect(()=>()=>ut(),[]);async function ne(){if(!(A||N)){M(!0),console.log("[CAMERA] Starting camera...");try{const U=c?{video:{deviceId:{exact:c}},audio:!1}:{video:{facingMode:"environment"},audio:!1};console.log("[CAMERA] Using constraints:",U);let z;try{z=await navigator.mediaDevices.getUserMedia(U),console.log("[CAMERA] Got stream:",!!z)}catch(oe){console.warn("[CAMERA] First attempt failed:",oe);const ve=oe&&(oe.name||oe.code)||"";if(c&&(ve==="OverconstrainedError"||ve==="NotFoundError"))console.log("[CAMERA] Trying fallback without deviceId"),z=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else if(!c&&(ve==="OverconstrainedError"||ve==="NotFoundError"||ve==="NotSupportedError"))console.log("[CAMERA] Trying fallback for facingMode not supported"),z=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw oe}if(d.current){console.log("[CAMERA] Setting stream to video element"),d.current.srcObject=z,console.log("[CAMERA] Stream tracks:",z.getTracks().length,"video tracks:",z.getVideoTracks().length),d.current.addEventListener("loadeddata",()=>console.log("[CAMERA] Video loadeddata")),d.current.addEventListener("canplay",()=>console.log("[CAMERA] Video canplay")),d.current.addEventListener("play",()=>console.log("[CAMERA] Video started playing")),d.current.addEventListener("error",oe=>console.error("[CAMERA] Video error:",oe));try{d.current.play(),console.log("[CAMERA] Play called successfully")}catch(oe){console.error("[CAMERA] Video play failed:",oe),setTimeout(()=>{try{d.current?.play(),console.log("[CAMERA] Retry play called")}catch(ve){console.error("[CAMERA] Retry play failed:",ve)}},100)}}else console.error("[CAMERA] Video element not found");I(!0);try{const oe=await navigator.mediaDevices.enumerateDevices();C(oe.filter(ve=>ve.kind==="videoinput")),console.log("[CAMERA] Found cameras:",oe.filter(ve=>ve.kind==="videoinput").length)}catch(oe){console.warn("[CAMERA] Failed to enumerate devices:",oe)}}catch(U){console.error("[CAMERA] Camera start failed:",U),alert("Camera permission denied or not available.")}finally{M(!1)}}}function ut(){d.current&&d.current.srcObject&&(d.current.srcObject.getTracks().forEach(z=>z.stop()),d.current.srcObject=null,I(!1),M(!1))}function Xe(){try{if(!d.current||!D.current)return;const U=d.current,z=D.current;z.width=U.videoWidth,z.height=U.videoHeight;const oe=z.getContext("2d");if(!oe)return;oe.drawImage(U,0,0,z.width,z.height);const ve=z.toDataURL("image/png");b(ve)}catch(U){console.warn("Capture error:",U)}}function Ot(){return y.length?e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs",children:[e.jsx("span",{children:"Cam:"}),e.jsxs("select",{className:"bg-black/20 rounded px-1 py-0.5",value:c||"",onChange:async U=>{if(A)return;const z=U.target.value||void 0,oe=y.find(ve=>ve.deviceId===z)?.label;f(z,oe||"",!0),ut(),await new Promise(ve=>setTimeout(ve,100));try{await ne()}catch(ve){console.warn("Failed to start camera after device switch:",ve),setTimeout(async()=>{try{await ne()}catch(Ee){console.error("Camera switch failed after retry:",Ee),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),y.map(U=>e.jsx("option",{value:U.deviceId,children:U.label||"Camera"},U.deviceId))]})]}):null}function Bt(){try{if(!T.current||!d.current||!g||!F)return;const U=T.current,z=d.current,oe=z.clientWidth,ve=z.clientHeight;U.width=oe,U.height=ve;const Ee=U.getContext("2d");if(!Ee)return;Ee.clearRect(0,0,oe,ve);const Ae=oe/F.w,Le=ve/F.h,Ie=od(g,Ae,Le),He=[Fe.bullInner,Fe.bullOuter,Fe.trebleInner,Fe.trebleOuter,Fe.doubleInner,Fe.doubleOuter];for(const Dt of He){const Be=Ro(Ie,Dt,360);Oo(Ee,Be,Dt===Fe.doubleOuter?"#22d3ee":"#a78bfa",Dt===Fe.doubleOuter?3:2)}}catch(U){console.warn("Overlay drawing error:",U)}}m.useEffect(()=>{if(p)return;const U=setInterval(Bt,250);return()=>clearInterval(U)},[g,F,N,p]),m.useEffect(()=>{if(u!=="external-ws"||!x)return;const U=Vd(x,z=>{if(s){try{s(z.value,z.ring,{sector:z.sector??null,mult:z.mult??0})}catch{}try{Pe({playerId:Ne.players[Ne.currentPlayerIdx]?.id??null,sector:z.sector??null,mult:z.mult??0,ring:z.ring,ts:Date.now()})}catch{}}else{const oe=z.ring==="INNER_BULL"?"INNER_BULL 50":z.ring==="BULL"?"BULL 25":`${z.ring[0]}${z.value/(z.mult||1)||z.value} ${z.value}`;ct(z.value,oe,z.ring);try{Pe({playerId:Ne.players[Ne.currentPlayerIdx]?.id??null,sector:z.sector??null,mult:z.mult??0,ring:z.ring,ts:Date.now()})}catch{}}});return()=>U.close()},[u,x]);function Tt(U){if(!T.current||!g||!F)return;const z=T.current.getBoundingClientRect(),oe=U.clientX-z.left,ve=U.clientY-z.top,Ee=T.current.width/F.w,Ae=T.current.height/F.h,Le={x:oe/Ee,y:ve/Ae},Ie=zd(g,Le),He=`${Ie.ring} ${Ie.base>0?Ie.base:""}`.trim();H(He),L(Ie.base),ce(Ie.ring),te(!0);try{if(i&&s){s(Ie.base,Ie.ring,{sector:Ie.sector,mult:Ie.mult});try{Pe({playerId:Ne.players[Ne.currentPlayerIdx]?.id??null,sector:Ie.sector??null,mult:Ie.mult??0,ring:Ie.ring,ts:Date.now()})}catch{}te(!1)}}catch{}}function De(U){const z=U.trim().toUpperCase();if(!z)return null;const oe=z==="BULL"||z==="50"||z==="DBULL"||z==="IBULL",ve=z==="25"||z==="OBULL";if(oe)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(ve)return{label:"BULL 25",value:25,ring:"BULL"};const Ee=z.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!Ee)return null;const Ae=Ee[1]||"S",Le=parseInt(Ee[2],10);if(Le<1||Le>20)return null;const Ie=Ae==="S"?1:Ae==="D"?2:3,He=Ae==="S"?"SINGLE":Ae==="D"?"DOUBLE":"TRIPLE";return{label:`${Ae}${Le} ${Le*Ie}`,value:Le*Ie,ring:He}}function Jt(){const U=Ne;if(!U.players.length)return U.startingScore;const z=U.players[U.currentPlayerIdx],oe=z.legs[z.legs.length-1];return oe?oe.totalScoreRemaining:U.startingScore}function ct(U,z,oe){if(r==="custom"){if(l)try{l(U,oe,{label:z})}catch{}if(me>=3)return;const Dt=me+1;_e(Dt),We(Be=>Be+U),pe(Be=>[...Be,{label:z,value:U,ring:oe}]);return}if(me>=3)return;const ve=me+1,Ee=ze+U,Le=Jt()-Ee,Ie=Le===0&&(oe==="DOUBLE"||oe==="INNER_BULL");if(Le<0||Le===1||Le===0&&!Ie){Ke(0,ve),_e(0),We(0),pe([]),t&&t(0,ve,!1);return}if(_e(ve),We(Ee),pe(Dt=>[...Dt,{label:z,value:U,ring:oe}]),Ie){Ke(Ee,ve),pt(Ee),_e(0),We(0),pe([]),t&&t(Ee,ve,!0);return}ve>=3&&(Ke(Ee,ve),_e(0),We(0),pe([]),t&&t(Ee,ve,!1))}function It(){if(P){if(s)try{s(ae,Q,void 0)}catch{}else ct(ae,P,Q);ee(0),te(!1)}}function kt(){const U=De(E);if(!U){alert("Enter like T20, D16, 5, 25, 50");return}if(!Ye||!P||Q==="MISS"||ae===0){const z=re+1;ee(z),z>=3&&Ze(!0)}else ee(0);ct(U.value,U.label,U.ring),_(""),te(!1)}function Mt(){const U=De(E);if(!U){alert("Enter like T20, D16, 5, 25, 50");return}if(me===0||at.length===0){kt();return}if(r==="custom"){if(!Ye||!P||Q==="MISS"||ae===0){const Be=re+1;ee(Be),Be>=3&&Ze(!0)}else ee(0);if(pe(Be=>[...Be.slice(0,-1),{label:U.label,value:U.value,ring:U.ring}]),o)try{o(U.value,U.ring,{label:U.label})}catch{}_(""),te(!1);return}if(!Ye||!P||Q==="MISS"||ae===0){const Be=re+1;ee(Be),Be>=3&&Ze(!0)}else ee(0);const z=at[at.length-1],oe=me-1,ve=ze-(z?.value||0),Ee=Jt(),Ae=ve+U.value,Le=oe+1,Ie=Ee-Ae,He=Ie===0&&(U.ring==="DOUBLE"||U.ring==="INNER_BULL");if(Ie<0||Ie===1||Ie===0&&!He){Ke(0,Le);try{const Be=Ne.players[Ne.currentPlayerIdx]?.name;Be&&an(Be,Le,0)}catch{}_e(0),We(0),pe([]),t&&t(0,Le,!1),_(""),te(!1);return}if(_e(Le),We(Ae),pe(Be=>[...Be.slice(0,-1),{label:U.label,value:U.value,ring:U.ring}]),He){Ke(Ae,Le),pt(Ae);try{const Be=Ne.players[Ne.currentPlayerIdx]?.name;Be&&an(Be,Le,Ae)}catch{}_e(0),We(0),pe([]),t&&t(Ae,Le,!0),_(""),te(!1);return}if(Le>=3){Ke(Ae,Le);try{const Be=Ne.players[Ne.currentPlayerIdx]?.name;Be&&an(Be,Le,Ae)}catch{}_e(0),We(0),pe([]),t&&t(Ae,Le,!1)}_(""),te(!1)}function Nt(){Ze(!1),ee(0);try{window.dispatchEvent(new CustomEvent("ndn:request-calibrate"))}catch{}}function Zt(){J(),Ze(!1),ee(0)}function $(U,z){if(me>=3)return;const oe=U*(z==="S"?1:z==="D"?2:3),ve=z==="S"?"SINGLE":z==="D"?"DOUBLE":"TRIPLE";if(!Ye||!P||Q==="MISS"||ae===0){const Ee=re+1;ee(Ee),Ee>=3&&Ze(!0)}else ee(0);ct(oe,`${z}${U} ${oe}`,ve),te(!1)}function ge(){if(me===0)return;const U=at[at.length-1];_e(z=>z-1),We(z=>z-(U?.value||0)),pe(z=>z.slice(0,-1))}function rt(){if(me!==0){if(r==="custom"){_e(0),We(0),pe([]);return}Ke(ze,me);try{const U=Ne.players[Ne.currentPlayerIdx]?.name;U&&an(U,me,ze)}catch{}_e(0),We(0),pe([]),t&&t(ze,me,!1)}}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!p&&e.jsx("button",{className:`btn px-3 py-1 text-sm ${ye==="auto"?"tab--active":""}`,onClick:()=>{fe("auto"),Oe(!1),Te(!0)},children:"Autoscore"}),e.jsx("button",{className:`btn px-3 py-1 text-sm ${ye==="manual"?"tab--active":""}`,onClick:()=>{fe("manual"),Oe(!0)},title:"Open Manual Correction",children:"Manual Correction"}),p&&e.jsx("span",{className:"text-xs opacity-70",children:"Manual scoring mode active"})]})}),!n&&!p?e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(Zi,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:320,minHeight:240,maxWidth:1600,maxHeight:900,children:[e.jsx(Ot,{}),e.jsx("video",{ref:d,className:"w-full h-full object-cover",playsInline:!0,"webkit-playsinline":"true",muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:T,className:"absolute inset-0 w-full h-full",onClick:Tt})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[N?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:ut,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:ne,disabled:A,children:A?"Connecting Camera...":"Connect Camera"}),e.jsx("button",{className:"btn",onClick:Xe,disabled:!N,children:"Capture Still"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}):null,!n&&p&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Manual Scoring"}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:"Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{Oe(!0),fe("manual")},children:"Open Manual Correction"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Manage Pending Visit"})]})]}),e.jsx("canvas",{ref:D,className:"hidden"}),it&&!p&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(Ys,{storageKey:"ndn:autoscore:size",className:"w-full max-w-3xl",defaultWidth:720,defaultHeight:520,minWidth:420,minHeight:320,maxWidth:1400,maxHeight:900,initialFitHeight:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Autoscore"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn btn--ghost",onClick:()=>Te(!1),children:"Close"})})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Click the camera overlay to autoscore. Use Manual Correction if the last auto is off."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:P||"â€”"}),e.jsx("button",{className:"btn",onClick:It,disabled:me>=3,children:"Add Auto Dart"}),re>0&&e.jsxs("span",{className:"text-sm opacity-80",children:["No-registers: ",re,"/3"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:me>=3,onClick:()=>{if(!Ye||!P||Q==="MISS"||ae===0){const U=re+1;ee(U),U>=3&&Ze(!0)}else ee(0);ct(25,"BULL 25","BULL"),te(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:me>=3,onClick:()=>{if(!Ye||!P||Q==="MISS"||ae===0){const U=re+1;ee(U),U>=3&&Ze(!0)}else ee(0);ct(50,"INNER_BULL 50","INNER_BULL"),te(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"autoscore-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:de,onChange:U=>ot(U.target.value.toUpperCase()),onKeyDown:U=>{if(U.key==="Enter"){const z=de.match(/^(S|D|T)(\d{1,2})$/);z&&$(parseInt(z[2],10),z[1])}}}),e.jsx("datalist",{id:"autoscore-quick-list",children:["D","S","T"].map(U=>Array.from({length:20},(z,oe)=>oe+1).map(z=>e.jsx("option",{value:`${U}${z}`},`${U}${z}`)))}),e.jsx("button",{className:"btn",disabled:!de||me>=3,onClick:()=>{const U=de.match(/^(S|D|T)(\d{1,2})$/);if(!U)return;const z=U[1],oe=parseInt(U[2],10);$(oe,z)},children:"Add"})]})]})]})})}),he&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{Oe(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:S,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:P||"â€”"}),e.jsx("button",{className:"btn",onClick:It,disabled:me>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Manual (T20, D16, 5, 25, 50)",value:E,onChange:U=>_(U.target.value),onKeyDown:U=>{U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),kt()),U.key==="Enter"&&U.shiftKey&&(U.preventDefault(),Mt())}}),e.jsx("button",{className:"btn btn--ghost",onClick:Mt,disabled:me===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:kt,disabled:me>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add Â· Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:me>=3,onClick:()=>{if(!Ye||!P||Q==="MISS"||ae===0){const U=re+1;ee(U),U>=3&&Ze(!0)}else ee(0);ct(25,"BULL 25","BULL"),te(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:me>=3,onClick:()=>{if(!Ye||!P||Q==="MISS"||ae===0){const U=re+1;ee(U),U>=3&&Ze(!0)}else ee(0);ct(50,"INNER_BULL 50","INNER_BULL"),te(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:xe,onChange:U=>Re(U.target.value.toUpperCase()),onKeyDown:U=>{if(U.key==="Enter"){const z=xe.match(/^(S|D|T)(\d{1,2})$/);z&&$(parseInt(z[2],10),z[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(U=>Array.from({length:20},(z,oe)=>oe+1).map(z=>e.jsx("option",{value:`${U}${z}`},`${U}${z}`)))}),e.jsx("button",{className:"btn",disabled:!xe||me>=3,onClick:()=>{const U=xe.match(/^(S|D|T)(\d{1,2})$/);if(!U)return;const z=U[1],oe=parseInt(U[2],10);$(oe,z)},children:"Add"})]})]})]})]})})]})}),Et&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>lt(!1),children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(Zi,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:320,minHeight:240,maxWidth:1600,maxHeight:900,children:[e.jsx(Ot,{}),e.jsx("video",{ref:d,className:"w-full h-full object-cover",playsInline:!0,"webkit-playsinline":"true",muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:T,className:"absolute inset-0 w-full h-full",onClick:Tt})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[N?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:ut,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:ne,children:"Connect Camera"}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:Xe,disabled:!N,children:"Capture Still"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:at.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):at.map((U,z)=>e.jsx("li",{children:U.label},z))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",me,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",ze]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:ge,disabled:me===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:rt,disabled:me===0,children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{_e(0),We(0),pe([])},disabled:me===0,children:"Clear"})]})]})]})]})}),bt&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>{Ze(!1),ee(0)},children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-white",children:"Recalibration Recommended"}),e.jsx("div",{className:"mb-4 text-lg font-semibold text-indigo-200",children:"We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Nt,children:"Go to Calibrate"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:Zt,children:"Reset Calibration"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{Ze(!1),ee(0)},children:"Dismiss"})]})]})}),n?null:e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:at.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):at.map((U,z)=>e.jsx("li",{children:U.label},z))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",me,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",ze]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:ge,disabled:me===0,children:"Undo Dart"}),e.jsx("button",{className:"btn",onClick:rt,disabled:me===0,children:"Commit Visit"}),e.jsx("button",{className:"btn",onClick:()=>{_e(0),We(0),pe([])},disabled:me===0,children:"Clear"})]})]})]})}function eo(t,a,s,i){const n=(i-90)*Math.PI/180;return{x:t+s*Math.cos(n),y:a+s*Math.sin(n)}}function to(t){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(t)*18+9}function Gd({width:t=320,height:a=320}){const s=_o(n=>n.samples),i=m.useRef(null);return m.useEffect(()=>{const n=i.current;if(!n)return;const r=n.getContext("2d");if(!r)return;n.width=t,n.height=a,r.clearRect(0,0,t,a);const l=t/2,o=a/2,d=Math.min(t,a)/(Fe.doubleOuter*2+20),c={bullInner:Fe.bullInner*d,bullOuter:Fe.bullOuter*d,trebleInner:Fe.trebleInner*d,trebleOuter:Fe.trebleOuter*d,doubleInner:Fe.doubleInner*d,doubleOuter:Fe.doubleOuter*d};r.strokeStyle="rgba(255,255,255,0.06)",r.lineWidth=1;const f=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const p of f)r.beginPath(),r.arc(l,o,c[p],0,Math.PI*2),r.stroke();const u=[];for(const p of s){let y=Math.random()*360,C=Math.random()*c.doubleOuter;typeof p.sector=="number"&&p.sector>=1&&p.sector<=20&&(y=to(p.sector),p.ring==="DOUBLE"?C=(c.doubleInner+c.doubleOuter)/2:p.ring==="TRIPLE"?C=(c.trebleInner+c.trebleOuter)/2:p.ring==="INNER_BULL"?C=c.bullInner*.5:p.ring==="BULL"?C=c.bullOuter*.8:C=(c.trebleOuter+c.doubleInner)/2*(.6+Math.random()*.4));const D=eo(l,o,C,y);u.push({x:D.x,y:D.y,w:1})}for(const p of u){const y=r.createRadialGradient(p.x,p.y,1,p.x,p.y,60);y.addColorStop(0,"rgba(255,0,0,0.9)"),y.addColorStop(.3,"rgba(255,100,0,0.5)"),y.addColorStop(1,"rgba(255,100,0,0)"),r.fillStyle=y,r.beginPath(),r.arc(p.x,p.y,60,0,Math.PI*2),r.fill()}r.fillStyle="rgba(255,255,255,0.85)",r.font="12px ui-sans-serif";const x={};for(const p of s)p.sector&&(x[p.sector]=(x[p.sector]||0)+1);for(const p of Object.keys(x)){const y=Number(p),C=to(y),D=eo(l,o,c.trebleOuter+18,C);r.fillText(String(x[y]),D.x-6,D.y+4)}},[s,t,a]),e.jsx("canvas",{ref:i,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}const bs=[...Array.from({length:20},(t,a)=>({label:`D${a+1}`,score:(a+1)*2})),{label:"DBULL",score:50,isBull:!0}];function hr(t,a){const s=bs[a];return!!s&&t===s.score}function qs(t){const a=t.trim().toUpperCase();if(!a)return null;if(a==="50"||a==="BULL"||a==="DBULL"||a==="IBULL")return 50;if(a==="25"||a==="OBULL")return 25;const s=a.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!s)return null;const i=s[1]||"S",n=parseInt(s[2],10);return n<1||n>20?null:n*(i==="S"?1:i==="D"?2:3)}const Lt=[...Array.from({length:20},(t,a)=>a+1),25,50],Wn=[20,19,18,17,16,15,25];function rn(){const t={};return Wn.forEach(a=>{t[a]=0}),{marks:t,points:0}}function Wo(t,a,s,i,n=()=>!1){let r=null,l=0;if(s==="BULL"||s==="INNER_BULL"||a===25||a===50)r=25,l=s==="INNER_BULL"||a===50?2:1;else if(typeof i=="number"&&i>=15&&i<=20)r=i,s==="TRIPLE"?l=3:s==="DOUBLE"?l=2:l=1;else if(a){const p=[20,19,18,17,16,15];for(const y of p){if(a===y){r=y,l=1;break}if(a===y*2){r=y,l=2;break}if(a===y*3){r=y,l=3;break}}!r&&(a===25||a===50)&&(r=25,l=a===50?2:1)}if(!r)return 0;const o=t.marks[r];let d=Math.max(0,3-o);const c=Math.min(d,l),f=Math.max(0,l-c),u=o+c;t.marks[r]=u>3?3:u;let x=0;return f>0&&!n(r)&&(r===25?s==="INNER_BULL"?x+=50*f:x+=25*f:x+=r*f),t.points+=x,x}function Jd(t){return Wn.every(a=>(t.marks[a]||0)>=3)}function Vs(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function Kd(t){return t.round}function Ho(t,a,s,i){if(t.finished)return 0;const n=Kd(t);let r=0;return typeof i=="number"&&i===n?s==="TRIPLE"?(r=n*3,t.turnHits.triples++):s==="DOUBLE"?(r=n*2,t.turnHits.doubles++):s==="SINGLE"&&(r=n*1,t.turnHits.singles++):!i&&(a===n||a===n*2||a===n*3)&&(a===n*3?(r=n*3,t.turnHits.triples++):a===n*2?(r=n*2,t.turnHits.doubles++):a===n&&(r=n,t.turnHits.singles++)),t.score+=r,r}function zo(t){if(!t.finished){if(t.turnHits.singles>0&&t.turnHits.doubles>0&&t.turnHits.triples>0){t.shanghaiAchieved=!0,t.finished=!0;return}const a=t.round+1;a>20?t.finished=!0:t.round=a}t.turnHits={singles:0,doubles:0,triples:0}}function Gs(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function la(t){return t.targets[t.stage]||null}function qo(t,a,s,i){if(t.finished)return 0;const n=la(t);if(!n)return 0;let r=0;switch(n.kind){case"NUMBER":{typeof i=="number"&&i===n.num?s==="TRIPLE"?r=n.num*3:s==="DOUBLE"?r=n.num*2:s==="SINGLE"&&(r=n.num):!i&&(a===n.num||a===n.num*2||a===n.num*3)&&(r=a),r>0&&(t.hitThisRound=!0);break}case"DOUBLE":{(s==="DOUBLE"&&i===n.num||a===n.num*2)&&(r=n.num*2,t.hitThisRound=!0);break}case"TRIPLE":{(s==="TRIPLE"&&i===n.num||a===n.num*3)&&(r=n.num*3,t.hitThisRound=!0);break}case"BULL":{(s==="BULL"||s==="INNER_BULL"||a===25||a===50)&&(r=s==="INNER_BULL"||a===50?50:25,t.hitThisRound=!0);break}case"ANY_NUMBER":{a>0&&(r=a,t.hitThisRound=!0);break}}return t.score+=r,r}function Vo(t){t.finished||(t.hitThisRound||(t.score=Math.floor(t.score/2)),t.hitThisRound=!1,t.stage+=1,t.stage>=t.targets.length&&(t.finished=!0))}function Js(){return{round:1,score:0,target:"HIGH",finished:!1}}function Go(t,a,s,i){if(t.finished)return 0;let n=0;if(t.target==="HIGH")if(s==="INNER_BULL")n=50;else if(typeof i=="number"){const l=i*(s==="TRIPLE"?3:s==="DOUBLE"?2:1);i>=20&&(n=l)}else a>=40&&(n=a);else if(typeof i=="number"){const l=i*(s==="TRIPLE"?3:s==="DOUBLE"?2:1);i<=10&&(n=l)}else a>0&&a<=30&&(n=a);return t.score+=n,n}function Jo(t){if(!t.finished){if(t.round+=1,t.round>10){t.finished=!0;return}t.target=t.target==="HIGH"?"LOW":"HIGH"}}function Ko(t,a=3){return{number:t,lives:a,isKiller:!1,eliminated:!1}}function Yd(t){const a=Array.from({length:20},(i,n)=>n+1),s={};for(const i of t){const n=Math.floor(Math.random()*a.length),r=a.splice(n,1)[0];s[i]=r}return s}function fr(t,a,s,i){const n=a[t];if(!n||!i||!s)return{becameKiller:!1};if(!n.isKiller&&s==="DOUBLE"&&i===n.number)return n.isKiller=!0,{becameKiller:!0};if(n.isKiller&&(s==="DOUBLE"||s==="TRIPLE")){const r=Object.keys(a).find(l=>l!==t&&!a[l].eliminated&&a[l].number===i);if(r){const l=a[r],o=s==="TRIPLE"?2:1;return l.lives=Math.max(0,l.lives-o),l.lives===0&&(l.eliminated=!0),{becameKiller:!1,victimId:r,livesRemoved:o}}}return{becameKiller:!1}}function xr(t){const a=Object.entries(t).filter(([,s])=>!s.eliminated&&s.lives>0);return a.length===1?a[0][0]:null}function On(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function Yo(t,a,s,i){if(t.finished)return 0;let n=0;if(typeof i=="number"&&i===t.inning?s==="TRIPLE"?n=3:s==="DOUBLE"?n=2:n=1:!i&&(a===t.inning||a===t.inning*2||a===t.inning*3)&&(n=a===t.inning*3?3:a===t.inning*2?2:1),t.score+=n,t.dartsThisInning+=1,t.dartsThisInning>=3){const r=t.inning+1;r>9?t.finished=!0:(t.inning=r,t.dartsThisInning=0)}return n}const Xo={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function Bn(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function Qo(t,a,s,i){if(t.finished)return!1;const n=Xo[t.hole];if(t.dartsThisHole+=1,typeof i=="number"&&i===n&&(s==="SINGLE"||s==="DOUBLE"||s==="TRIPLE")||!i&&(a===n||a===n*2||a===n*3)){t.strokes+=t.dartsThisHole;const l=t.hole+1;return l>18?t.finished=!0:(t.hole=l,t.dartsThisHole=0),!0}if(t.dartsThisHole>=3){t.strokes+=3;const l=t.hole+1;l>18?t.finished=!0:(t.hole=l,t.dartsThisHole=0)}return!1}const Un={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function pr(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function Xd(t){const a=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[s,i,n]of a)if(t[s]&&t[s]===t[i]&&t[s]===t[n])return t[s];return t.every(s=>s)?"Draw":null}function Zo(t,a,s,i,n){if(t.finished||t.board[a])return!1;const r=Un[a];let l=!1;if(r.type==="BULL"?l=i==="BULL"||i==="INNER_BULL"||s===25||s===50:r.type==="NUM"&&typeof r.num=="number"&&(typeof n=="number"&&n===r.num||!n&&(s===r.num||s===r.num*2||s===r.num*3))&&(l=!0),!l)return!1;t.board[a]=t.turn;const o=Xd(t.board);return o?(t.finished=!0,t.winner=o,!0):(t.turn=t.turn==="X"?"O":"X",!0)}const ma=[20,19,18,17,16,15,14,13,12,25];function $n(){const t={};return ma.forEach(a=>{t[a]=0}),{marks:t,points:0}}function el(t,a,s,i,n=()=>!1){let r=null,l=0;if(s==="BULL"||s==="INNER_BULL"||a===25||a===50)r=25,l=s==="INNER_BULL"||a===50?2:1;else if(typeof i=="number"&&i>=12&&i<=20)r=i,s==="TRIPLE"?l=3:s==="DOUBLE"?l=2:l=1;else if(a){for(const p of[20,19,18,17,16,15,14,13,12]){if(a===p){r=p,l=1;break}if(a===p*2){r=p,l=2;break}if(a===p*3){r=p,l=3;break}}!r&&(a===25||a===50)&&(r=25,l=a===50?2:1)}if(!r)return 0;const o=t.marks[r],d=Math.max(0,3-o),c=Math.min(d,l),f=Math.max(0,l-c),u=o+c;t.marks[r]=u>3?3:u;let x=0;return f>0&&!n(r)&&(r===25?s==="INNER_BULL"?x+=50*f:x+=25*f:x+=r*f),t.points+=x,x}function Qd(t){return ma.every(a=>(t.marks[a]||0)>=3)}const so=["X01","Double Practice"],Zd=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice"],em=["Easy","Medium","Hardened"];function Fn(t,a,s){return Math.max(a,Math.min(s,t))}function tm(t,a){let s=0;if(a==="Easy"){const i=[22,26,41,45,60];s=i[Math.floor(Math.random()*i.length)]}else a==="Medium"?s=Math.round(Fn(60+(Math.random()*30-15),30,100)):s=Math.round(Fn(80+(Math.random()*20-10),50,120));return t<=0?0:s>t?[100,85,81,60,57,45,41,26,22,20,1].find(n=>n<=t)??0:s}function sm({onClose:t}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:t,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const nm="http://localhost:8787";function am({user:t}){const{offlineLayout:a}=ls(),[s,i]=m.useState("X01"),[n,r]=m.useState(501),[l,o]=m.useState("None"),[d,c]=m.useState(!1),[f,u]=m.useState(!1),[x,p]=m.useState(n),[y,C]=m.useState(n),[D,T]=m.useState(!1),[N,I]=m.useState(!1),[A,M]=m.useState(1),[k,b]=m.useState(0),[g,F]=m.useState(0),[J,P]=m.useState(null),[H,E]=m.useState(1),[_,ae]=m.useState(1),[L,Q]=m.useState([]),[ce,me]=m.useState(2e3),_e=jn(),[ze,We]=m.useState(!1),[at,pe]=m.useState(a==="modern"),[Ke,pt]=m.useState(a==="modern");m.useEffect(()=>{pe(a==="modern"),pt(a==="modern")},[a]);const[Ne,Pe]=m.useState(1),[de,ot]=m.useState(!0),[xe,Re]=m.useState(0),[re,ee]=m.useState(0),[bt,Ze]=m.useState(0),[Ye,te]=m.useState(0),[ye,fe]=m.useState(0),[he,Oe]=m.useState(rn()),[it,Te]=m.useState(Vs()),[Et,lt]=m.useState(Gs()),[S,ne]=m.useState(Js()),[ut,Xe]=m.useState(0),[Ot,Bt]=m.useState(1),[Tt,De]=m.useState(27),[Jt,ct]=m.useState(0),[It,kt]=m.useState(0),[Mt,Nt]=m.useState(!1),[Zt,$]=m.useState(1),[ge,rt]=m.useState(0),[U,z]=m.useState(0),oe=8,[ve,Ee]=m.useState(1),[Ae,Le]=m.useState(0),[Ie,He]=m.useState(0),Dt=10,[Be,Kt]=m.useState(1),[Us,Xs]=m.useState(0),[Ds,dn]=m.useState(0),ys=10,[Qs,zt]=m.useState(170),[Nn,B]=m.useState(0),[Y,Z]=m.useState(0),[V,K]=m.useState(0),[ke,be]=m.useState(121),[st,nt]=m.useState(0),[Se,gt]=m.useState(0),[Pt,yt]=m.useState(0),[qt,$t]=m.useState(20),[Es,as]=m.useState(0),[Rt,Ft]=m.useState(0),[vt,we]=m.useState(On()),[es,cs]=m.useState(Bn()),[vs,ds]=m.useState(pr()),[At,ms]=m.useState($n()),[et,js]=m.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[us,Yt]=m.useState({}),[Ts,rs]=m.useState({}),[_t,As]=m.useState(!1),[Xt,hs]=m.useState(0),[Zs,is]=m.useState(0),[fs,qe]=m.useState(null),[ht,ue]=m.useState(""),[ft,jt]=m.useState(0),[dt,xt]=m.useState(0),[Ct,Vt]=m.useState(0),[$s,Ps]=m.useState(n),[tt,Rs]=m.useState(0),[en,Ns]=m.useState(0),[Fs,_s]=m.useState(0);m.useRef(null);const[ws,mn]=m.useState(0),[tn,wn]=m.useState(0),[ts,xs]=m.useState(0),[Ls,Ss]=m.useState(0),[Os,Sn]=m.useState(0),[un,kn]=m.useState(0),[sn,Cn]=m.useState(0),[Ws,Hn]=m.useState(0),[hn,En]=m.useState(0),[h,j]=m.useState(0),[w,R]=m.useState(0),[X,ie]=m.useState(0),[le,W]=m.useState(0),[Ge,Wt]=m.useState(0),[ss,ns]=m.useState(0),[Ue,Tn]=m.useState(0),[Cr,In]=m.useState(0),[ks,Mn]=m.useState(0),[ol,Er]=m.useState(0),[ll,Tr]=m.useState(0),[cl,ha]=m.useState(!1),[Qt,Gt]=m.useState(""),[Ir,fa]=m.useState(""),{favoriteDouble:Mr,callerEnabled:dl,callerVoice:ml,callerVolume:ul,speakCheckoutOnly:hl,rememberLastOffline:fl,setLastOffline:xl,autoStartOffline:Dr,cameraScale:fn,setCameraScale:zn,cameraAspect:Ar="wide",setCameraAspect:pl,cameraEnabled:Ht,textSize:Dn,boxSize:qn,autoscoreProvider:bl}=ls(),gl=bl==="manual",Vn=(v=>{switch(v){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(Dn),xn=m.useRef(null),pn=m.useRef(null),xa=m.useRef(null),[bn,pa]=m.useState("first"),[Gn,Pr]=m.useState(1),yl=m.useRef(null);m.useEffect(()=>{const v=Math.max(1,Math.floor(Number(Gn)||1)),O=bn==="first"?v:Math.max(1,Math.ceil(v/2));M(O)},[bn,Gn]),m.useEffect(()=>{if(!Ke){Pe(1);return}const v=()=>{const G=xn.current,se=pn.current;if(!G||!se)return;const $e=xa.current?xa.current.getBoundingClientRect().height:0,Ve=Math.max(0,G.clientHeight-$e-6),Ce=Math.max(0,G.clientWidth-8),je=se.getBoundingClientRect(),Me=Ne||1,Qe=je.height/Me,Ut=je.width/Me,ps=Ve>0?Ve/Qe:1,nn=Ce>0?Ce/Ut:1,Cs=Math.min(1,Math.max(.5,Math.min(ps,nn)));Pe(Cs)};v();const O=window.ResizeObserver,q=O?new O(()=>v()):null;return q&&xn.current&&q.observe(xn.current),q&&pn.current&&q.observe(pn.current),window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v);try{q&&xn.current&&q.unobserve(xn.current)}catch{}try{q&&pn.current&&q.unobserve(pn.current)}catch{}}},[Ke,Ne]),m.useEffect(()=>{const v=O=>{const q=O?.detail?.mode;q&&(i(q),gn())};return window.addEventListener("ndn:auto-start",v),()=>window.removeEventListener("ndn:auto-start",v)},[]),m.useEffect(()=>{const v=O=>{const q=O?.detail?.formatType,G=O?.detail?.formatCount,se=O?.detail?.startScore;(q==="first"||q==="best")&&pa(q),typeof G=="number"&&isFinite(G)&&Pr(Math.max(1,Math.floor(G))),typeof se=="number"&&isFinite(se)&&r(Math.max(1,Math.floor(se)))};return window.addEventListener("ndn:offline-format",v),()=>window.removeEventListener("ndn:offline-format",v)},[]),m.useEffect(()=>{if(!Dr)return;const v=setTimeout(()=>gn(),50);return()=>clearTimeout(v)},[Dr]),m.useEffect(()=>{if(!ze||de||l==="None"||Fs<=0)return;let v,O=performance.now();const q=G=>{const se=G-O;O=G,_s($e=>{const Ve=$e-se;if(Ve<=0){let Ce=0,je=y;for(;Ce<3&&je>0;){const Me=tm(je,l),Qe=Fn(Me-Ce*20,0,Math.min(60,je)),Ut=je-Qe;if(wn(Qe),mn(Cs=>Cs+1),j(Cs=>Cs+1),Ut<0){je=y,xs(0),Ss(0);break}xs(Cs=>Cs+Qe),ie(Cs=>Cs+Qe);const ps=je,nn=Ut;if(ps>50&&nn<=50?Ss(1):ps<=50&&Ss(Cs=>Cs+1),je=Ut,Ce+=1,je===0)break}if(C(je),je===0){ts===180?Tn(Qe=>Qe+1):ts>=140?In(Qe=>Qe+1):ts>=100&&Mn(Qe=>Qe+1);const Me=y;Me<=170&&Tr(Qe=>Math.max(Qe,Me)),y<=50&&(Cn(Qe=>Qe+(Ls>0?Ls:1)),Hn(Qe=>Qe+1)),xs(0),Ss(0),P("ai"),I(!0)}return je>0&&Ce>=3&&(ts===180?Tn(Me=>Me+1):ts>=140?In(Me=>Me+1):ts>=100&&Mn(Me=>Me+1),xs(0),Ss(0)),ot(!0),0}return Ve}),Fs>0&&(v=requestAnimationFrame(q))};return v=requestAnimationFrame(q),()=>cancelAnimationFrame(v)},[ze,de,l,Fs,y]);function gn(){u(!0),p(n),C(n),T(!1),We(!0),ot(!0),Re(0),jt(0),xt(0),Vt(0),Ps(n),Rs(0),Ns(0),_s(0),mn(0),wn(0),xs(0),P(null),b(0),F(0),Q([]),En(0),j(0),R(0),ie(0),W(0),Wt(0),ns(0),Tn(0),In(0),Mn(0),Er(0),Tr(0),Sn(0),kn(0),Cn(0),Hn(0);const v=Math.max(1,Math.floor(Number(Gn)||1));if(M(bn==="first"?v:Math.max(1,Math.ceil(v/2))),fl)try{xl({mode:s,x01Start:n,firstTo:A,aiLevel:l})}catch{}}function vl(){p(n),C(n),T(!1),We(!0),ot(!0),Re(0),jt(0),xt(0),Vt(0),Ps(n),Rs(0),Ns(0),_s(0),mn(0),wn(0),xs(0),P(null)}function Rr(v){Vt(0),Ps(v===0?n:x),Ns(0),l!=="None"?(ot(!1),_s(ce)):ot(!1)}function Jn(v){const O=x-v,q=Ct+1;if(xt(v),jt(Ce=>Ce+1),En(Ce=>Ce+1),O<0){p($s),Rr($s),Re(0),Rs(0),Ns(0);return}p(O),dl&&na(t?.username||"Player",v,Math.max(O,0),ml,{volume:ul,checkoutOnly:hl}),Vt(q),Rs(Ce=>Ce+v),R(Ce=>Ce+v),Re(0);const G=x,se=O,$e=G>50&&se<=50,Ve=G<=50;if($e?Ns(1):Ve&&Ns(Ce=>Ce+1),O===0){tt+v===180?W(je=>je+1):tt+v>=140?Wt(je=>je+1):tt+v>=100&&ns(je=>je+1);const Ce=$s;Ce<=170&&Er(je=>Math.max(je,Ce)),G<=50&&(Sn(je=>je+(en>0?en:1)),kn(je=>je+1)),P("player"),I(!0);return}q>=3&&(tt+v===180?W(Ce=>Ce+1):tt+v>=140?Wt(Ce=>Ce+1):tt+v>=100&&ns(Ce=>Ce+1),Rr(O),Rs(0),Ns(0))}function Lr(){const v=Fn(Math.round(Number(xe)||0),0,60);Jn(v)}function Or(v){const O=Fn(Math.round(v||0),0,60);if(xt(O),jt(q=>q+1),En(q=>q+1),hr(O,re)){const q=bt+1;Ze(q),ee(G=>Math.min(20,G+1)),q>=21&&(P("player"),I(!0))}Re(0)}function Br(){Or(Number(xe))}function Ur(){const v=qs(Qt);if(v==null){alert("Enter like D16, 50, 25, T20");return}Or(v),Gt("")}function $r(v,O,q){if(Mt)return;const G=Ot,se=O==="DOUBLE"&&q===G||!O&&v===G*2;se&&kt($e=>$e+1),ct($e=>{const Ve=$e+1;if(Ve>=3){const Ce=It+(se?1:0);Ce>0?De(Me=>Me+Ce*G*2):De(Me=>Me-G*2);const je=G+1;return Bt(je),kt(0),je>20&&Nt(!0),0}return Ve})}function Fr(){$r(Math.max(0,xe|0)),Re(0)}function _r(){Bt(1),De(27),ct(0),kt(0),Nt(!1)}function ba(v){rt(O=>O+Math.max(0,v|0)),z(O=>{const q=O+1;return q>=3?($(G=>G+1),0):q})}function ga(v){Le(O=>O+Math.max(0,v|0)),He(O=>{const q=O+1;return q>=3?(Ee(G=>G+1),0):q})}function ya(v){Xs(O=>O+Math.max(0,v|0)),dn(O=>{const q=O+1;return q>=3?(Kt(G=>G+1),0):q})}function Wr(v,O,q,G,se,$e,Ve,Ce){const je=v-Ve;if(!(je<0))if(je===0){if(Ce==="DOUBLE"||Ce==="INNER_BULL"){$e(Me=>Me+1),se(Me=>Me+1),G(()=>0),O(v);return}}else O(je);G(Me=>{const Qe=Me+1;return Qe>=3?(se(Ut=>Ut+1),0):Qe})}function Hr(v,O){Wr(Qs,zt,Nn,B,Z,K,v,O),Nn+1>=3&&zt(170)}function zr(v,O){Wr(ke,be,st,nt,gt,yt,v,O),st+1>=3&&be(121)}function Kn(v){const O=qs(Qt);if(O==null){alert("Enter like T20, D16, 25, 50");return}const q=Qt.trim().toUpperCase(),G=q.startsWith("D")||q==="50"||q==="BULL"||q==="DBULL"||q==="IBULL"||q.includes("INNER");v?Hr(O,G?"DOUBLE":void 0):zr(O,G?"DOUBLE":void 0),Gt("")}function jl(){zt(170),B(0),Z(0),K(0)}function Nl(){be(121),nt(0),gt(0),yt(0)}function va(v,O,q){O==="TRIPLE"&&q===qt?as(G=>G+1):!O&&v===qt*3&&as(G=>G+1),Ft(G=>G+1)}function wl(){as(0),Ft(0)}function Sl(v,O,q){we(G=>{const se={...G};return Yo(se,v,O,q),se})}function kl(){we(On())}function Cl(v,O,q){cs(G=>{const se={...G};return Qo(se,v,O,q),se})}function El(){cs(Bn())}function Tl(v,O,q,G){ds(se=>{const $e={...se,board:[...se.board]};return Zo($e,v,O,q,G),$e})}function Il(){ds(pr())}function Ml(v,O,q){ms(G=>{const se={...G,marks:{...G.marks}};return el(se,v,O,q,()=>!1),se})}function qr(){ms($n())}function ja(v,O,q){const G=Lt[Ye];let se=!1;if(typeof q=="number"&&q===G&&(O==="SINGLE"||O==="DOUBLE"||O==="TRIPLE")&&(se=!0),G===25&&(O==="BULL"||v===25)&&(se=!0),G===50&&(O==="INNER_BULL"||v===50)&&(se=!0),se||(v===G||v===G*2||v===G*3)&&(se=!0),se){const $e=ye+1;fe($e),te(Ve=>Ve+1)}}function Vr(){ja(Math.max(0,xe|0)),Re(0)}function Gr(){const v=qs(Qt);if(v==null){alert("Enter like T20, D5, 25, 50");return}ja(v),Gt("")}function Jr(v,O,q){Oe(G=>{const se={...G,marks:{...G.marks}};return Wo(se,v,O,q,()=>!1),se}),Xe(G=>{const se=G+1;return se>=3?0:se})}function Kr(){Jr(Math.max(0,xe|0)),Re(0)}function Yr(v,O,q){Te(G=>{const se={...G,turnHits:{...G.turnHits}};return Ho(se,v,O,q),se}),Xe(G=>{const se=G+1;return se>=3?(Te($e=>{const Ve={...$e,turnHits:{...$e.turnHits}};return zo(Ve),Ve}),0):se})}function Xr(){Yr(Math.max(0,xe|0)),Re(0)}function Qr(v,O,q){lt(G=>{const se={...G,targets:[...G.targets]};return qo(se,v,O,q),se}),Xe(G=>{const se=G+1;return se>=3?(lt($e=>{const Ve={...$e,targets:[...$e.targets]};return Vo(Ve),Ve}),0):se})}function Zr(){Qr(Math.max(0,xe|0)),Re(0)}function ei(v,O,q){ne(G=>{const se={...G};return Go(se,v,O,q),se}),Xe(G=>{const se=G+1;return se>=3?(ne($e=>{const Ve={...$e};return Jo(Ve),Ve}),0):se})}function ti(){ei(Math.max(0,xe|0)),Re(0)}function si(){const v=Qt.trim().toUpperCase();if(!v)return null;if(v==="50"||v==="BULL"||v==="DBULL"||v==="IBULL")return 50;if(v==="25"||v==="OBULL")return 25;const O=v.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!O)return null;const q=O[1]||"S",G=parseInt(O[2],10);return G<1||G>20?null:G*(q==="S"?1:q==="D"?2:3)}function Na(){const v=si();if(v==null){alert("Enter like T20, D16, 5, 25, 50");return}Jn(v),Gt("")}function Dl(){const v=Ir.trim().split(`
`).map(O=>O.trim()).filter(O=>O);if(v.length!==0){for(const O of v){const q=qs(O);if(q==null){alert(`Invalid score: ${O}`);return}Jn(q)}fa("")}}function Al(){Ct!==0&&(p(v=>v+dt),Vt(v=>Math.max(0,v-1)))}function ni(){const v=si();if(v==null){alert("Enter like T20, D16, 5, 25, 50");return}if(Ct===0){Na();return}const O=dt;p(q=>q+O),Vt(q=>Math.max(0,q-1)),setTimeout(()=>Jn(v),0),Gt("")}function Pl(){const v=J??"player",O=v==="player"?en||void 0:Ls||void 0;Q([...L,{winner:v,doubleDarts:H,checkoutDarts:_,doublesAtt:O,doublesHit:1}]),I(!1);let G=k,se=g;if(J==="player"?G+=1:J==="ai"&&(se+=1),b(G),F(se),P(null),G>=A||se>=A){try{kc(s,v==="player")}catch{}We(!1),u(!1),p(n),C(n),ha(!0);return}vl()}const wa=!so.includes(s)&&!(t?.fullAccess||t?.admin);return e.jsxs("div",{className:"card relative overflow-hidden",children:[e.jsxs("h2",{className:"text-2xl font-bold text-brand-700 mb-4",children:["Offline Game Modes ",a==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsx("label",{className:"font-semibold",children:"Select game mode:"}),e.jsxs("select",{className:"input w-full",value:s,onChange:v=>i(v.target.value),children:[so.map(v=>e.jsx("option",{value:v,children:v},v)),Zd.map(v=>e.jsxs("option",{value:v,disabled:!(t?.fullAccess||t?.admin),children:[v," ",t?.fullAccess||t?.admin?"":"(Premium)"]},v))]}),!t?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),s==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:n,onChange:v=>r(Number(v.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{className:"input w-full",value:l,onChange:v=>o(v.target.value),children:[e.jsx("option",{value:"None",children:"None"}),em.map(v=>e.jsx("option",{value:v,children:v},v))]}),l!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:ce/1e3,onChange:v=>me(Math.round(Number(v.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>c(!0),children:"X01 Rules & Regulations!"})]}),s==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply."})]}),!f&&e.jsx("button",{className:"btn",disabled:wa,title:wa?"PREMIUM required for this mode":"",onClick:gn,children:"Start Match"}),ze&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${at?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(Ys,{storageKey:"ndn:modal:offline-match",className:`${at?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:at,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:Ke?"hidden":"auto"},ref:v=>{xn.current=v},children:[e.jsxs("div",{ref:v=>{xa.current=v},className:"sticky top-0 relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[s,s==="X01"?` / ${n}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",A," Â· Legs ",k,"-",g]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${a==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:a==="modern"?"Modern layout":"Classic layout"})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>zn(Math.max(.5,Math.round((fn-.05)*100)/100)),title:"Decrease camera size",children:"âˆ’"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(fn*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>zn(Math.min(1.25,Math.round((fn+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:Ke?"Actual Size":"Fit All",onClick:()=>pt(v=>!v),children:Ke?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:at?"Restore":"Maximize",onClick:()=>pe(v=>!v),children:at?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{gn()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{We(!1),u(!1)},children:"Quit"})]})]}),e.jsxs("div",{ref:v=>{pn.current=v},className:"will-change-transform",style:Ke?{transform:`scale(${Ne})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,Ne))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:s==="X01"?"X01 Match":s}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",s]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",n]}),e.jsxs("div",{ref:yl,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const v=x!==n||y!==n||Ct>0,O=`px-2 py-0.5 rounded border text-xs ${v?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${O} ${bn==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{v||pa("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${O} ${bn==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{v||pa("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${v?"opacity-50":""}`,type:"number",min:1,step:1,value:Gn,onChange:q=>Pr(Math.max(1,Math.floor(Number(q.target.value)||1))),disabled:v,title:bn==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",k,"â€“",g]})]}),s!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[s==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:bs[re]?.label||"â€”"})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[bt," / 21"]})]}),s==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Lt[Ye]===25?"25 (Outer Bull)":Lt[Ye]===50?"50 (Inner Bull)":Lt[Ye]||"â€”"})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[ye," / ",Lt.length]})]}),s==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket â€” Close 20â€“15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:Wn.map(v=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:v===25?"Bull":v}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,he.marks?.[v]||0)," / 3"]})]},v))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:he.points})]}),Jd(he)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Oe(rn()),Xe(0)},children:"Reset"})]})]}),s==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:it.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",it.score]}),it.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Te(Vs()),Xe(0)},children:"Reset"})]})]}),s==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[Et.stage+1,"/",Et.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const v=la(Et);return v?v.kind==="ANY_NUMBER"?"Any":v.kind==="BULL"?"Bull":v.kind==="DOUBLE"||v.kind==="TRIPLE"||v.kind==="NUMBER"?`${v.kind} ${v.num}`:"â€”":"â€”"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Et.score]}),Et.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{lt(Gs()),Xe(0)},children:"Reset"})]})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",S.round," Â· Target ",S.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",S.score]}),S.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ne(Js()),Xe(0)},children:"Reset"})]})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",Ot]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Tt]}),Mt&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:_r,children:"Reset"})]})]}),s==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Zt,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",ge]})]}),s==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",ve,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ae]})]}),s==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Be,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Us]})]}),s==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Qs}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",Y," Â· Successes: ",V]})]}),s==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ke}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",Se," Â· Successes: ",Pt]})]}),s==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",qt]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",Es]})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:vt.inning}),e.jsxs("div",{className:"text-sm",children:["Score: ",e.jsx("span",{className:"font-semibold",children:vt.score})]})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:es.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes: ",e.jsx("span",{className:"font-semibold",children:es.strokes})]})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:vs.turn}),vs.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",vs.winner||"â€”"]})]}),s==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20â€“12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:ma.map(v=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:v===25?"Bull":v}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,At.marks?.[v]||0)," / 3"]})]},v))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:At.points})]}),Qd(At)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:qr,children:"Reset"})]})]}),s==="Killer"&&e.jsx(e.Fragment,{children:_t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:et[Xt]?.name||"â€”"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:fs?`${et.find(v=>v.id===fs)?.name||"Winner"} Wins`:ht||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):a==="modern"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-2 items-stretch",children:[e.jsxs("div",{className:"flex flex-col gap-2 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),de?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:x}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-x/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:dt})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:ft>0?((n-x)/ft*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",ft]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(v=>e.jsx("span",{className:`w-2 h-2 rounded-full ${v<Ct?"bg-emerald-400":"bg-white/20"}`},v))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",Os," Â· Hit ",un]})]}),x<=170&&x>0&&(()=>{const O=ia(x,Mr)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:O})]})})()]}),e.jsxs("div",{className:`${qn==="small"?"p-2":qn==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${Dn==="small"?"text-xs":Dn==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const v=de?t?.username||"You":l==="None"?"â€”":`${l} AI`,O=de?x:l==="None"?0:y,q=de?dt:tn,G=de?tt:ts,se=de?ft:ws,$e=n-(de?x:l==="None"?n:y),Ve=se>0?$e/se*3:0,Ce=`${k}-${g}`,je=L.length>0?`${Math.min(...L.map(Me=>Me.doubleDarts+(Me.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:Ce}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:v}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:O}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:Ve.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:G||q}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:je})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[l==="None"?"Opponent":`${l} AI`," Remain"]}),de?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:l!=="None"?y:"N/A"}),l!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-y/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:l==="None"?0:tn})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:l!=="None"?ws>0?((n-y)/ws*3).toFixed(1):"0.0":"â€”"})]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",ws]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",sn," Â· Hit ",Ws]})]})]})]}),e.jsx("div",{className:"md:col-span-2 min-w-0 space-y-2",children:gl?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${Vn}`,onClick:()=>zn(Math.max(.5,Math.round((fn-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${Vn} min-w-[2.5rem] text-center`,children:[Math.round(fn*100),"%"]}),e.jsx("button",{className:`btn ${Vn}`,onClick:()=>zn(Math.min(1.25,Math.round((fn+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Vn}`,title:"Toggle camera aspect",onClick:()=>pl(Ar==="square"?"wide":"square"),children:Ar==="square"?"Square":"Wide"})]})}),e.jsx("div",{className:"flex items-stretch justify-end min-w-0 md:min-h-[45vh]",children:e.jsx(oa,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",style:{minHeight:"45vh"},fill:!0})})]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:1fr_1.2fr_1fr] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),de?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:x}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-x/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:dt})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:ft>0?((n-x)/ft*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",ft]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(v=>e.jsx("span",{className:`w-2 h-2 rounded-full ${v<Ct?"bg-emerald-400":"bg-white/20"}`},v))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",Os," Â· Hit ",un]})]}),x<=170&&x>0&&(()=>{const O=ia(x,Mr)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:O})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-end md:px-3 min-w-0 md:min-h-[45vh]",children:e.jsx(oa,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",style:{minHeight:"45vh"},fill:!0})}),e.jsxs("div",{className:`mt-2 ${qn==="small"?"p-2":qn==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${Dn==="small"?"text-xs":Dn==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const v=de?t?.username||"You":l==="None"?"â€”":`${l} AI`,O=de?x:l==="None"?0:y,q=de?dt:tn,G=de?tt:ts,se=de?ft:ws,$e=n-(de?x:l==="None"?n:y),Ve=se>0?$e/se*3:0,Ce=`${k}-${g}`,je=L.length>0?`${Math.min(...L.map(Me=>Me.doubleDarts+(Me.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:Ce}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:v}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:O}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:Ve.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:G||q}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:je})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[l==="None"?"Opponent":`${l} AI`," Remain"]}),de?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:l!=="None"?y:"N/A"}),l!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-y/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:l==="None"?0:tn})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:l!=="None"?ws>0?((n-y)/ws*3).toFixed(1):"0.0":"â€”"})]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",ws]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",sn," Â· Hit ",Ws]})]})]})]})}),s!=="X01"?e.jsxs("div",{className:"space-y-2",children:[s==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:bs[re]?.label||"â€”"})]}),Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,onAutoDart:(v,O)=>{if((O==="DOUBLE"||O==="INNER_BULL")&&hr(v,re)){const G=bt+1,se=re+1;Ze(G),ee(se),G>=bs.length&&setTimeout(()=>{Ze(0),ee(0)},250)}},immediateAutoCommit:!0})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Br()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Br,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:Qt,onChange:v=>Gt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&Ur()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ur,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",bt," of 21"]})]}),s==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Lt[Ye]===25?"25 (Outer Bull)":Lt[Ye]===50?"50 (Inner Bull)":Lt[Ye]||"â€”"})]}),Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{ja(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Vr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Vr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:Qt,onChange:v=>Gt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&Gr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Gr,children:"Add"})]}),ye>=Lt.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{fe(0),te(0)},children:"Reset"})]})]}),s==="Cricket"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{Jr(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Kr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Kr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Oe(rn()),Xe(0)},children:"Reset"})]})]}),s==="Shanghai"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{Yr(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Xr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Xr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Te(Vs()),Xe(0)},children:"Reset"})]})]}),s==="Halve It"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{Qr(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Zr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Zr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{lt(Gs()),Xe(0)},children:"Reset"})]})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{ei(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&ti()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ti,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ne(Js()),Xe(0)},children:"Reset"})]})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{$r(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Fr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Fr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:_r,children:"Reset"})]})]}),s==="Count-Up"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:v=>ba(v)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&(ba(xe),Re(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ba(xe),Re(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{$(1),rt(0),z(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Zt,"/",oe]})]}),s==="High Score"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:v=>ga(v)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&(ga(xe),Re(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ga(xe),Re(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ee(1),Le(0),He(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",ve,"/",Dt]})]}),s==="Low Score"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:v=>ya(v)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&(ya(xe),Re(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ya(xe),Re(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Kt(1),Xs(0),dn(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Be,"/",ys]})]}),s==="Checkout 170"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O)=>Hr(v,O==="MISS"?void 0:O)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:Qt,onChange:v=>Gt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&Kn(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Kn(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:jl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",Qs," Â· Attempts: ",Y," Â· Successes: ",V]})]}),s==="Checkout 121"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O)=>zr(v,O==="MISS"?void 0:O)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:Qt,onChange:v=>Gt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&Kn(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Kn(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Nl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",ke," Â· Attempts: ",Se," Â· Successes: ",Pt]})]}),s==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("select",{className:"input w-24",value:qt,onChange:v=>$t(parseInt(v.target.value,10)),children:Array.from({length:20},(v,O)=>O+1).map(v=>e.jsx("option",{value:v,children:v},v))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:wl,children:"Reset"})]}),Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{va(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:Qt,onChange:v=>Gt(v.target.value),onKeyDown:v=>{if(v.key==="Enter"){const O=qs(Qt);O!=null&&va(O,void 0,void 0),Gt("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const v=qs(Qt);v!=null&&va(v,void 0,void 0),Gt("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",Es," Â· Darts: ",Rt]})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{Sl(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:kl,children:"Reset"})})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{Cl(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:El,children:"Reset"})})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(v,O)=>O).map(v=>e.jsx("button",{className:`h-16 rounded-xl border ${vs.board[v]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(vs.finished||vs.board[v])return;const O=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),q=O%3===0?"TRIPLE":O%2===0?"DOUBLE":"SINGLE",G=v,se=Un[G],$e=se.type==="BULL"?null:se.num||null;Tl(G,O,q,$e)},children:vs.board[v]||""},v))}),Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Il,children:"Reset"})})]}),s==="American Cricket"&&e.jsxs(e.Fragment,{children:[Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{Ml(v,O==="MISS"?void 0:O,q?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:qr,children:"Reset"})})]}),s==="Killer"&&e.jsx(e.Fragment,{children:_t?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:et.map(v=>{const O=us[v.id],q=Ts[v.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${O?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:v.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${O?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:O?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number: ",e.jsx("span",{className:"font-semibold",children:q})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:O?.lives??0})]})]},v.id)})}),Ht&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,O,q)=>{if(fs)return;const G=O==="MISS"?void 0:O,se=q?.sector??null,$e=et[Xt];$e&&(Yt(Ve=>{const Ce={};Object.keys(Ve).forEach(Qe=>Ce[Qe]={...Ve[Qe]});const je=fr($e.id,Ce,G,se);if(je.becameKiller)ue(`${$e.name} became a Killer`);else if(je.victimId){const Qe=et.find(Ut=>Ut.id===je.victimId);ue(`${$e.name} hit ${Qe?.name}'s ${Ts[je.victimId]} (${je.livesRemoved} life${(je.livesRemoved||0)>1?"s":""})`)}else ue("No effect");const Me=xr(Ce);return Me&&qe(Me),Ce}),is(Ve=>{const Ce=Ve+1;if(Ce>=3){let je=Xt;for(let Me=1;Me<=et.length;Me++){const Qe=(Xt+Me)%et.length,Ut=et[Qe].id,ps=us[Ut];if(ps&&!ps.eliminated&&ps.lives>0){je=Qe;break}}return hs(je),0}return Ce}))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:Qt,onChange:v=>Gt(v.target.value),onKeyDown:v=>{if(v.key==="Enter"){if(fs)return;const q=Qt.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!q){Gt("");return}const G=q[1]||"S",se=parseInt(q[2],10),$e=G==="D"?"DOUBLE":G==="T"?"TRIPLE":"SINGLE",Ve=et[Xt];Yt(Ce=>{const je={};Object.keys(Ce).forEach(Ut=>je[Ut]={...Ce[Ut]});const Me=fr(Ve.id,je,$e,se);if(Me.becameKiller)ue(`${Ve.name} became a Killer`);else if(Me.victimId){const Ut=et.find(ps=>ps.id===Me.victimId);ue(`${Ve.name} hit ${Ut?.name}'s ${Ts[Me.victimId]} (${Me.livesRemoved} life${(Me.livesRemoved||0)>1?"s":""})`)}else ue("No effect");const Qe=xr(je);return Qe&&qe(Qe),je}),Gt(""),is(Ce=>{const je=Ce+1;if(je>=3){let Me=Xt;for(let Qe=1;Qe<=et.length;Qe++){const Ut=(Xt+Qe)%et.length,ps=et[Ut].id,nn=us[ps];if(nn&&!nn.eliminated&&nn.lives>0){Me=Ut;break}}return hs(Me),0}return je})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let v=Xt;for(let O=1;O<=et.length;O++){const q=(Xt+O)%et.length,G=et[q].id,se=us[G];if(se&&!se.eliminated&&se.lives>0){v=q;break}}hs(v),is(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Yt({}),rs({}),As(!1),hs(0),is(0),qe(null),ue("")},children:"Reset"})]}),fs&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner: ",et.find(v=>v.id===fs)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Yt({}),rs({}),As(!1),hs(0),is(0),qe(null),ue("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:et.map((v,O)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:v.name,onChange:q=>{const G=q.target.value;js(se=>se.map(($e,Ve)=>Ve===O?{...$e,name:G}:$e))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>js(q=>q.filter((G,se)=>se!==O)),disabled:et.length<=2,children:"Remove"})]},v.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>js(v=>{const O=`p${v.length+1}`;return[...v,{id:O,name:`Player ${v.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(et.length<2){alert("Need at least 2 players");return}const v=et.map(G=>G.id),O=Yd(v),q={};v.forEach(G=>{q[G]=Ko(O[G])}),rs(O),Yt(q),hs(0),is(0),qe(null),ue("Assigned numbers"),As(!0)},children:"Assign Numbers & Start"})]})]})})]}):de?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:xe,onChange:v=>Re(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&(v.shiftKey?Al():Lr())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Lr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:Qt,onChange:v=>Gt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&(v.shiftKey?ni():Na())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:ni,disabled:Ct===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Na,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:Ir,onChange:v=>fa(v.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Dl,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>fa(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add Â· Shift+Enter to Replace Last"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"font-semibold",children:[l==="None"?"Opponent":`${l} AI`," Turn"]}),l!=="None"?e.jsxs("div",{className:"text-sm text-slate-300",children:["Throwing in ",Math.ceil(Fs/1e3),"s..."]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>ot(!0),children:"Switch Back to You"})})]}),e.jsx("div",{className:"h-1"})]})]})})}),d&&e.jsx(sm,{onClose:()=>c(!1)}),wa&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const O=await(await fetch(`${nm}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t?.email})})).json();O.ok&&O.url?(window.location.href=O.url,O.development&&_e("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):O.error==="STRIPE_NOT_CONFIGURED"?_e("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):_e("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{_e("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â· ",vo(jo(),5)]})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(Ys,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(v=>e.jsx("button",{className:`btn ${H===v?"bg-brand-600":""}`,onClick:()=>E(v),children:v},v))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(v=>e.jsx("button",{className:`btn ${_===v?"bg-brand-600":""}`,onClick:()=>ae(v),children:v},v))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:Pl,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{I(!1),gn()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{I(!1),We(!1),u(!1)},children:"Back to Menu"})]})]})}),cl&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(Ys,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[s," Â· ",n," start Â· First to ",A]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:k}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"3-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:hn>0?(w/hn*3).toFixed(1):"0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"1-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:hn>0?(w/hn).toFixed(2):"0.00"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180s"}),e.jsx("div",{className:"font-semibold",children:le})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"140+"}),e.jsx("div",{className:"font-semibold",children:Ge})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"100+"}),e.jsx("div",{className:"font-semibold",children:ss})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"High Checkout"}),e.jsx("div",{className:"font-semibold",children:ol||"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Att"}),e.jsx("div",{className:"font-semibold",children:Os})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Hit"}),e.jsx("div",{className:"font-semibold",children:un})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[k," â€“ ",g]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:l==="None"?"Opponent":`${l} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:g}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"3-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:h>0?(X/h*3).toFixed(1):"0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"1-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:h>0?(X/h).toFixed(2):"0.00"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180s"}),e.jsx("div",{className:"font-semibold",children:Ue})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"140+"}),e.jsx("div",{className:"font-semibold",children:Cr})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"100+"}),e.jsx("div",{className:"font-semibold",children:ks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"High Checkout"}),e.jsx("div",{className:"font-semibold",children:ll||"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Att"}),e.jsx("div",{className:"font-semibold",children:sn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Hit"}),e.jsx("div",{className:"font-semibold",children:Ws})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map((v,O)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${v.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",O+1,": ",v.winner==="player"?"You":l==="None"?"Opp":"AI"," Â· Dbl ",v.doubleDarts," Â· CO ",v.checkoutDarts]},O))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(Gd,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>ha(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{ha(!1),gn()},children:"Rematch"})]})]})}),L.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:L.map((v,O)=>e.jsxs("li",{children:["Leg ",O+1,": Double darts: ",v.doubleDarts,", Checkout darts: ",v.checkoutDarts]},O))})]})]})}const tl="ndn:messages:inbox",sl="ndn:messages:unread";function rm(){try{const t=localStorage.getItem(tl),a=t?JSON.parse(t):[],s=Number(localStorage.getItem(sl)||"0")||0;return{inbox:Array.isArray(a)?a.filter(n=>n&&typeof n.id=="string").slice(0,200):[],unread:s}}catch{return{inbox:[],unread:0}}}function Zn(t,a){try{localStorage.setItem(tl,JSON.stringify(t))}catch{}try{localStorage.setItem(sl,String(a))}catch{}}const no=rm(),br=on((t,a)=>({inbox:no.inbox,unread:no.unread,inGame:!1,setInGame:s=>t({inGame:s}),add:s=>t(i=>{const n=i.inbox.some(o=>o.id===s.id&&o.ts===s.ts),r=n?i.inbox:[s,...i.inbox].slice(0,200),l=i.unread+(n?0:1);return Zn(r,l),{inbox:r,unread:l}}),load:s=>t(i=>{const n=[...s].sort((r,l)=>l.ts-r.ts).slice(0,200);return Zn(n,i.unread),{inbox:n,unread:i.unread}}),markAllRead:()=>{const s=a();Zn(s.inbox,0),t({unread:0})},remove:s=>t(i=>{const n=i.inbox.filter(l=>l.id!==s),r=i.unread;return Zn(n,r),{inbox:n,unread:r}})})),nl=[/\b(f+[\W_]*u+[\W_]*c+[\W_]*k+)\b/gi,/\b(s+[\W_]*h+[\W_]*i+[\W_]*t+)\b/gi,/\b(b+[\W_]*i+[\W_]*t+[\W_]*c+[\W_]*h+)\b/gi,/\b(a+[\W_]*s+[\W_]*s+[\W_]*h+[\W_]*o+[\W_]*l+[\W_]*e+)\b/gi,/\b(d+[\W_]*a+[\W_]*m+[\W_]*n+)\b/gi,/\b(c+[\W_]*r+[\W_]*a+[\W_]*p+)\b/gi,/\b(p+[\W_]*i+[\W_]*s+[\W_]*s+)\b/gi];function im(t){return t.replace(/[\p{L}\p{N}]/gu,"*")}function al(t){if(!t)return t;let a=t;for(const s of nl)a=a.replace(s,i=>im(i));return a}function om(t){return t?nl.some(a=>a.test(t)):!1}function ua({tabs:t,active:a,onChange:s,className:i}){return e.jsxs("div",{className:`relative ${i||""}`,children:[e.jsx("div",{className:"absolute inset-0 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 pointer-events-none"}),e.jsx("div",{className:"relative overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx("div",{className:"flex items-center gap-2 min-w-max",children:t.map(n=>{const r=n.key===a;return e.jsx("button",{type:"button",onClick:()=>s(n.key),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98]
                  ${r?"bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white shadow-indigo-500/30":"bg-white/10 text-slate-100 hover:bg-white/15"}
                `,"aria-pressed":r,children:n.label},n.key)})})}),e.jsx("style",{children:`
        /* Hide scrollbars on WebKit/Firefox for a cleaner pill row */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})}function lm(t){if(!t)return"";const a=Math.floor((Date.now()-t)/1e3);if(a<60)return`${a}s ago`;const s=Math.floor(a/60);if(s<60)return`${s}m ago`;const i=Math.floor(s/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`}function cm({user:t}){const a=jn(),s=String(t?.email||"").toLowerCase(),[i,n]=m.useState([]),[r,l]=m.useState([]),[o,d]=m.useState([]),[c,f]=m.useState(""),[u,x]=m.useState("all"),[p,y]=m.useState(!1),C=br(),[D,T]=m.useState([]),[N,I]=m.useState([]),[A,M]=m.useState({show:!1});async function k(){if(s)try{const[E,_,ae,L]=await Promise.all([fetch(`/api/friends/list?email=${encodeURIComponent(s)}`).then(Q=>Q.json()),fetch(`/api/friends/suggested?email=${encodeURIComponent(s)}`).then(Q=>Q.json()),fetch(`/api/friends/requests?email=${encodeURIComponent(s)}`).then(Q=>Q.json()),fetch(`/api/friends/outgoing?email=${encodeURIComponent(s)}`).then(Q=>Q.json())]);n(E.friends||[]),l(_.suggestions||[]),T(ae.requests||[]),I(L.requests||[])}catch{}}m.useEffect(()=>{k()},[s]);async function b(E){if(f(E),!E){d([]);return}try{const ae=await(await fetch(`/api/friends/search?q=${encodeURIComponent(E)}`)).json();d(ae.results||[])}catch{}}async function g(E){if(!(!s||!E)){y(!0);try{await fetch("/api/friends/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:E})}),await k(),f(""),d([]),a("Friend added",{type:"success"})}finally{y(!1)}}}async function F(E){if(!(!s||!E)){y(!0);try{await fetch("/api/friends/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:E})}),await k(),a("Friend removed",{type:"info"})}finally{y(!1)}}}const J=m.useMemo(()=>u==="all"?i:i.filter(E=>(E.status||"offline")===u),[i,u]);async function P(E){if(!E){a("Room unavailable",{type:"error"});return}try{const _=new CustomEvent("ndn:spectate-request",{detail:{roomId:E}});window.dispatchEvent(_),a("Opening spectator viewâ€¦",{type:"info"})}catch{}}const H=D.length+N.length;return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Friends"}),e.jsx("p",{className:"mb-2 text-brand-600",children:"Manage your friends. See whoâ€™s online, in-game, or offline; find new teammates; and invite people to play."}),e.jsxs("div",{className:"text-xs opacity-70 mb-3",children:["Online: ",i.filter(E=>E.status==="online").length," Â· In-game: ",i.filter(E=>E.status==="ingame").length," Â· Offline: ",i.filter(E=>!E.status||E.status==="offline").length]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"md:col-span-2 p-3 rounded-2xl bg-black/30 border border-white/10",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"font-semibold text-white/90",children:"Your Friends"})}),e.jsx(ua,{tabs:[{key:"all",label:"All"},{key:"online",label:"Online"},{key:"ingame",label:"In-Game"},{key:"offline",label:"Offline"},{key:"requests",label:`Requests ${H>0?"("+H+")":""}`}],active:u,onChange:E=>x(E),className:"mb-3"}),u==="requests"?e.jsx("ul",{className:"space-y-2",children:H>0?e.jsxs(e.Fragment,{children:[D.length>0&&D.map(E=>e.jsxs("li",{className:"p-3 rounded bg-black/20 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:E.fromUsername||E.fromEmail||"Unknown User"}),e.jsx("span",{className:"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded",children:"Incoming"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{y(!0);try{if((await fetch("/api/friends/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requester:E.fromEmail})})).ok){T(L=>L.filter(Q=>Q.id!==E.id));const ae={email:E.fromEmail,username:E.fromUsername,status:"offline"};n(L=>[...L,ae]),I(L=>L.filter(Q=>Q.toEmail!==E.fromEmail)),a("Friend request accepted",{type:"success"}),setTimeout(()=>k(),100)}else a("Failed to accept request",{type:"error"})}catch{a("Error accepting request",{type:"error"})}finally{y(!1)}},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:async()=>{y(!0);try{(await fetch("/api/friends/decline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requester:E.fromEmail})})).ok?(T(ae=>ae.filter(L=>L.id!==E.id)),I(ae=>ae.filter(L=>L.toEmail!==E.fromEmail)),a("Friend request declined",{type:"info"}),setTimeout(()=>k(),100)):a("Failed to decline request",{type:"error"})}finally{y(!1)}},children:"Decline"})]})]},`incoming-${E.id||E.fromEmail}`)),N.length>0&&N.map(E=>e.jsxs("li",{className:"p-3 rounded bg-black/20 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:E.toUsername||E.toEmail||"Unknown User"}),e.jsx("span",{className:"text-xs bg-amber-600/20 text-amber-400 px-2 py-1 rounded",children:"Pending"})]}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 self-start",onClick:async()=>{y(!0);try{(await fetch("/api/friends/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:E.toEmail})})).ok?(I(ae=>ae.filter(L=>L.id!==E.id)),a("Friend request cancelled",{type:"info"}),setTimeout(()=>k(),100)):a("Failed to cancel request",{type:"error"})}finally{y(!1)}},children:"Cancel"})]},`outgoing-${E.id||E.toEmail}`))]}):e.jsx("li",{className:"text-sm opacity-70",children:"No friend requests yet."})}):e.jsxs("ul",{className:"space-y-2",children:[J.map(E=>e.jsxs("li",{className:"p-2 rounded bg-black/20 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${E.status==="online"?"bg-emerald-400":E.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{className:"font-semibold",children:E.username||E.email}),e.jsxs("span",{className:"text-xs opacity-70",children:[E.status||"offline",E.status!=="online"&&E.lastSeen?` Â· ${lm(E.lastSeen)}`:""]}),E.status==="ingame"&&E.match&&e.jsxs("span",{className:"text-[10px] opacity-70 px-2 py-0.5 rounded bg-indigo-500/20 border border-indigo-600/30",children:[E.match.game," ",E.match.mode==="firstto"?"FT":"BO"," ",E.match.value,E.match.game==="X01"&&E.match.startingScore?` Â· ${E.match.startingScore}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E.status==="ingame"&&E.roomId&&e.jsx("button",{className:"btn",onClick:()=>P(E.roomId),children:"Spectate"}),e.jsx("button",{className:"btn",disabled:p||E.status!=="online"&&E.status!=="ingame",onClick:async()=>{y(!0);try{(await(await fetch("/api/friends/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:E.email,game:"X01",mode:"bestof",value:3,startingScore:501})})).json().catch(()=>({})))?.delivered?a("Invite sent",{type:"success"}):a("Friend is offline; invite queued",{type:"info"})}finally{y(!1)}},children:"Invite"}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>M({show:!0,toUser:E.username||E.email,toEmail:E.email}),children:"Message"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:p,onClick:()=>F(E.email),children:"Remove"})]})]},E.email)),J.length===0&&e.jsxs("li",{className:"text-sm opacity-70",children:["No friends ",u!=="all"?`in ${u}`:""," yet."]})]})]}),e.jsxs("div",{className:"p-3 rounded-2xl bg-black/20 border border-white/10",children:[e.jsx("div",{className:"font-semibold mb-2 text-white/90",children:"Find Friends"}),e.jsx("input",{className:"input w-full mb-2",placeholder:"Search by name or email",value:c,onChange:E=>b(E.target.value)}),e.jsxs("ul",{className:"space-y-1 mb-3 max-h-48 overflow-auto",children:[o.map(E=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${E.status==="online"?"bg-emerald-400":E.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{children:E.username||E.email})]}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>g(E.email),children:"Add"})]},E.email)),o.length===0&&e.jsx("li",{className:"text-xs opacity-60",children:"Type to searchâ€¦"})]}),e.jsx("div",{className:"font-semibold mb-1 text-white/90",children:"Suggested"}),e.jsxs("ul",{className:"space-y-1 max-h-48 overflow-auto",children:[r.map(E=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${E.status==="online"?"bg-emerald-400":E.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{children:E.username||E.email})]}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>g(E.email),children:"Add"})]},E.email)),r.length===0&&e.jsx("li",{className:"text-xs opacity-60",children:"No suggestions right now."})]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>C.markAllRead(),children:"Mark all read"})]}),C.inbox.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No messages yet."}):e.jsx("ul",{className:"space-y-2 max-h-72 overflow-auto",children:C.inbox.map(E=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:E.from})," ",e.jsxs("span",{className:"opacity-70 text-xs",children:["Â· ",new Date(E.ts).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:()=>M({show:!0,toUser:E.from,toEmail:E.from,replyTo:E.from}),children:"Reply"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-2 py-1 text-xs",title:"Delete this message",onClick:()=>C.remove(E.id),children:"Delete"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-2 py-1 text-xs",onClick:async()=>{const _=prompt("Report reason (what happened)?");if(_)try{await fetch("/api/friends/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reporterEmail:s,offenderEmail:E.from,reason:_,messageId:E.id})}),a("Report sent to admin",{type:"info"})}catch{}},children:"Report"})]})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap break-words",children:al(E.message)})]},E.id))})]}),A.show&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("div",{className:"text-center mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Type Message To ",A.toUser]})}),e.jsx("textarea",{className:"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none",placeholder:"Type your message here...",id:"message-input",autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{className:"flex-1 btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const _=document.getElementById("message-input")?.value?.trim();if(_){y(!0);try{await fetch("/api/friends/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:A.toEmail,message:_})}),a("Message sent",{type:"success"}),M({show:!1})}catch{a("Failed to send message",{type:"error"})}finally{y(!1)}}},disabled:p,children:"Send"}),e.jsx("button",{className:"flex-1 btn bg-slate-600 hover:bg-slate-700",onClick:()=>M({show:!1}),children:"Cancel"})]})]})})]})}function dm(){const t=dr(s=>s.toasts),a=dr(s=>s.remove);return t.length?e.jsxs(e.Fragment,{children:[t.filter(s=>s.type==="success").map(s=>e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50",children:e.jsx("div",{className:"p-4 rounded-lg shadow-lg border text-sm bg-emerald-700/90 border-emerald-500/60 text-white max-w-sm text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("span",{className:"flex-1 font-semibold",children:s.message})})})},s.id)),t.filter(s=>s.type!=="success").length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 sm:right-4 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 w-[calc(100%-1.5rem)] sm:w-auto max-w-sm",children:t.filter(s=>s.type!=="success").map(s=>e.jsx("div",{className:`p-3 rounded-lg shadow-lg border text-sm ${s.type==="error"?"bg-rose-700/80 border-rose-500/60 text-white":"bg-black/70 border-slate-700 text-slate-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>a(s.id),children:"Dismiss"})]})},s.id))})]}):null}function gr({data:t,height:a=220,barWidth:s=28,gap:i=6,showValues:n=!1}){const r=Math.max(1,...t.map(o=>o.value)),l=t.length*(s+i);return e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"relative",style:{height:a,width:Math.max(600,l)},children:e.jsx("div",{className:"absolute inset-0 flex items-end",children:t.map((o,d)=>{const c=Math.round(o.value/r*(a-40));return e.jsxs("div",{className:"flex flex-col items-center justify-end",style:{width:s,marginRight:i},children:[e.jsx("div",{className:"w-full rounded-t-md bg-gradient-to-b from-indigo-400 to-fuchsia-500 shadow-sm",style:{height:c},title:`${o.label}: ${o.value}`}),n&&e.jsx("div",{className:"text-[10px] mt-1 opacity-80",children:o.value}),e.jsx("div",{className:"text-[10px] mt-1 opacity-70 select-none",children:o.label})]},d)})})})})}const mm=["X01","Double Practice"],zs=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice","Baseball","Golf","Tic Tac Toe","American Cricket"],vn=[...mm,...zs],um="daviesfamily108@gmail.com";function hm({user:t}){const[a,s]=m.useState([]),[i,n]=m.useState(""),[r,l]=m.useState(null),[o,d]=m.useState(""),[c,f]=m.useState(!1),[u,x]=m.useState([]),[p,y]=m.useState([]),[C,D]=m.useState(""),[T,N]=m.useState([]),[I,A]=m.useState({title:"Official Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:30,capacity:16,prizeType:"premium",prizeAmount:3,currency:"GBP",prizeNotes:""}),[M,k]=m.useState({reset:{},reminder:{},confirmEmail:{},changed:{}}),[b,g]=m.useState({open:!1}),[F,J]=m.useState("general"),P=t?.email?.toLowerCase()===um,[H,E]=m.useState([]),[_,ae]=m.useState([]),[L,Q]=m.useState([]),[ce,me]=m.useState(null),[_e,ze]=m.useState(0);m.useEffect(()=>{const S=()=>ze(ne=>ne+1);return window.addEventListener("ndn:stats-updated",S),()=>window.removeEventListener("ndn:stats-updated",S)},[]);const We=m.useMemo(()=>vr(vn),[_e]),at=m.useMemo(()=>vn.map(S=>({label:S,value:We[S]?.played||0,won:We[S]?.won||0})),[We]);async function pe(){try{const ne=await(await fetch("/api/admins")).json();if(s(Array.isArray(ne.admins)?ne.admins:[]),P){const ut=await fetch(`/api/admin/status?requesterEmail=${encodeURIComponent(t?.email||"")}`);ut.ok&&l(await ut.json());const Xe=await fetch(`/api/admin/tournaments?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Xe.ok){const De=await Xe.json();x(Array.isArray(De.tournaments)?De.tournaments:[])}const Ot=await fetch(`/api/admin/reports?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Ot.ok){const De=await Ot.json();ae(Array.isArray(De.reports)?De.reports:[])}const Bt=await fetch(`/api/admin/premium-winners?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Bt.ok){const De=await Bt.json();E(Array.isArray(De.winners)?De.winners:[])}const Tt=await fetch(`/api/admin/wallet/withdrawals?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Tt.ok){const De=await Tt.json();y(Array.isArray(De.withdrawals)?De.withdrawals:[])}}}catch{}}m.useEffect(()=>{pe()},[]);async function Ke(){i&&(await fetch("/api/admins/grant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,requesterEmail:t?.email})}),n(""),pe())}async function pt(S){await fetch("/api/admins/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S,requesterEmail:t?.email})}),pe()}async function Ne(S,ne){S&&(await fetch("/api/admin/premium/grant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S,days:ne,requesterEmail:t?.email})}),await pe())}async function Pe(S){await fetch("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S,requesterEmail:t?.email})}),await pe()}async function de(S){f(!0);try{await fetch("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:S,requesterEmail:t?.email})}),await pe()}finally{f(!1)}}async function ot(){if(o.trim()){f(!0);try{await fetch("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o,requesterEmail:t?.email})}),d(""),await pe()}finally{f(!1)}}}async function xe(){if(C.trim())try{const S=await fetch(`/api/admin/users/search?q=${encodeURIComponent(C)}&requesterEmail=${encodeURIComponent(t?.email||"")}`);if(S.ok){const ne=await S.json();N(Array.isArray(ne.users)?ne.users:[])}}catch(S){console.error("Search failed:",S)}}async function Re(S){try{await fetch("/api/admin/users/ban",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S,requesterEmail:t?.email})}),await xe()}catch(ne){console.error("Ban failed:",ne)}}async function re(S){try{await fetch("/api/admin/users/unban",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S,requesterEmail:t?.email})}),await xe()}catch(ne){console.error("Unban failed:",ne)}}async function ee(){f(!0);try{const S=new Date(I.startAt).getTime();await fetch("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:I.title,game:I.game,mode:I.mode,value:Number(I.value),description:I.description,startAt:S,checkinMinutes:Number(I.checkinMinutes),capacity:Number(I.capacity),creatorEmail:t?.email,creatorName:t?.username,requesterEmail:t?.email,official:!0,prizeType:I.prizeType,prizeAmount:Number(I.prizeAmount||0),currency:I.currency,prizeNotes:I.prizeNotes})}),await pe()}finally{f(!1)}}async function bt(S,ne){f(!0);try{await fetch("/api/admin/tournaments/winner",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:S,winnerEmail:ne,requesterEmail:t?.email})}),await pe()}finally{f(!1)}}async function Ze(S){f(!0);try{await fetch("/api/admin/tournaments/mark-paid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:S,requesterEmail:t?.email})}),await pe()}finally{f(!1)}}async function Ye(S){f(!0);try{await fetch("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:S,requesterEmail:t?.email})}),await pe()}finally{f(!1)}}async function te(){f(!0);try{await fetch("/api/admin/tournaments/reseed-weekly",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requesterEmail:t?.email})}),await pe()}finally{f(!1)}}async function ye(S,ne){f(!0);try{await fetch("/api/admin/wallet/withdrawals/decide",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:S,approve:ne,requesterEmail:t?.email})}),await pe()}finally{f(!1)}}async function fe(S){f(!0);try{await fetch("/api/admin/matches/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matchId:S,requesterEmail:t?.email})}),await pe()}finally{f(!1)}}async function he(){try{const S=await fetch(`/api/admin/logs?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(S.ok){const ne=await S.json();ne?.ok&&Q(ne.logs||[])}}catch(S){console.error("Failed to fetch logs:",S)}}async function Oe(){try{const S=await fetch(`/api/admin/system-health?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(S.ok){const ne=await S.json();ne?.ok&&me(ne.health)}}catch(S){console.error("Failed to fetch system health:",S)}}async function it(){try{const S=await fetch(`/api/admin/email-copy?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(S.ok){const ne=await S.json();ne?.ok&&k(ne.copy||M)}}catch{}}m.useEffect(()=>{P&&it()},[P]),m.useEffect(()=>{P&&(F==="general"||F==="maintenance")&&(he(),Oe())},[P,F]);async function Te(S,ne){await fetch("/api/admin/email-copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requesterEmail:t?.email,kind:S,...ne})}),await it()}async function Et(S){try{const ut=await(await fetch(`/api/email/preview?kind=${encodeURIComponent(S)}&requesterEmail=${encodeURIComponent(t?.email||"")}`)).text();g({open:!0,kind:S,html:ut})}catch{g({open:!0,kind:S,html:'<!doctype html><html><body style="font-family:sans-serif;padding:16px">Failed to load preview.</body></html>'})}}m.useEffect(()=>{if(!b.open)return;function S(ne){ne.key==="Escape"&&g({open:!1})}return document.addEventListener("keydown",S),()=>document.removeEventListener("keydown",S)},[b.open]);function lt({kind:S,label:ne}){const Xe=M?.[S==="confirm-email"?"confirmEmail":S==="changed"?"changed":S]||{title:"",intro:"",buttonLabel:""},[Ot,Bt]=m.useState(Xe.title||""),[Tt,De]=m.useState(Xe.intro||""),[Jt,ct]=m.useState(Xe.buttonLabel||"");return m.useEffect(()=>{Bt(Xe.title||""),De(Xe.intro||""),ct(Xe.buttonLabel||"")},[Xe.title,Xe.intro,Xe.buttonLabel]),e.jsxs("div",{className:"p-2 rounded bg-black/20 space-y-2",children:[e.jsx("div",{className:"font-semibold",children:ne}),e.jsx("input",{className:"input w-full",placeholder:"Title (optional)",value:Ot,onChange:It=>Bt(It.target.value)}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Intro line (optional)",value:Tt,onChange:It=>De(It.target.value)}),e.jsx("input",{className:"input w-full",placeholder:"Button label (optional)",value:Jt,onChange:It=>ct(It.target.value)}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("a",{className:"btn",href:`/api/email/preview?kind=${encodeURIComponent(S)}&requesterEmail=${encodeURIComponent(t?.email||"")}`,target:"_blank",rel:"noreferrer",children:"Preview"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>Et(S),children:"Popup"}),e.jsx("button",{className:"btn",onClick:()=>Te(S,{title:Ot,intro:Tt,buttonLabel:Jt}),children:"Save"})]})]})}return P?e.jsxs("div",{className:"space-y-4",children:[P&&e.jsx(ua,{tabs:[{key:"general",label:"General"},{key:"maintenance",label:"Maintenance"},{key:"premium",label:"Premium"}],active:F,onChange:S=>J(S),className:"mb-4"}),F==="general"&&e.jsxs(e.Fragment,{children:[P&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Game Usage"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Bar height shows total plays per mode. Wins are listed under each label. This helps decide which modes to keep or iterate on."}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(gr,{data:at.map(S=>({label:S.label,value:S.value}))}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:at.map((S,ne)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:S.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",S.value," Â· Won ",S.won]})]},ne))})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Admin to trusted users. Only the owner can perform these actions."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:i,onChange:S=>n(S.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:Ke,children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>pt(i),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Current Admins:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:a.map(S=>e.jsx("div",{className:"px-2 py-1 rounded bg-indigo-600/20 border border-indigo-500/40 text-sm",children:S},S))}),e.jsx("hr",{className:"border-indigo-500/20 my-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Premium Access Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Premium subscription access to users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:i,onChange:S=>n(S.target.value)}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c||!i.trim(),onClick:()=>Ne(i,30),children:"Grant Premium"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>Pe(i),children:"Revoke Premium"})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Premium grants provide 30 days of unlimited access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tournament Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Users who have won premium prizes in tournaments and need access granted."}),e.jsxs("div",{className:"space-y-2",children:[u.filter(S=>S.status==="completed"&&S.winnerEmail&&S.prizeType==="premium").map(S=>{const ne=H.find(Xe=>Xe.email===S.winnerEmail),ut=ne&&!ne.expired;return e.jsxs("div",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:S.title}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(S.startAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:S.winnerEmail}),e.jsxs("div",{className:"text-xs opacity-70",children:["Prize: ",S.prizeAmount," month",S.prizeAmount>1?"s":""," PREMIUM"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:ut?e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Access Granted"}):e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-xs",disabled:c,onClick:()=>Ne(S.winnerEmail,S.prizeAmount*30*24*60*60*1e3),children:"Grant Access"})})]})]},S.id)}),u.filter(S=>S.status==="completed"&&S.winnerEmail&&S.prizeType==="premium").length===0&&e.jsx("div",{className:"text-center py-4 text-sm opacity-60",children:"No completed premium tournaments."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Announcements"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Send a message to all users. This will appear as a toast notification."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Announcement message...",value:o,onChange:S=>d(S.target.value)}),e.jsx("button",{className:"btn",disabled:c||!o.trim(),onClick:ot,children:"Send"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Search"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Search for users by email or name."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"Search users...",value:C,onChange:S=>D(S.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:xe,children:"Search"})]}),T.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),T.map(S=>e.jsx("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:S.name||"No name"}),e.jsx("div",{className:"opacity-70",children:S.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(S.createdAt).toLocaleDateString()]})]})},S.email))]})]}),P&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Tournaments Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Create Official"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"input w-full",placeholder:"Title",value:I.title,onChange:S=>A(ne=>({...ne,title:S.target.value}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("select",{className:"input",value:I.game,onChange:S=>A(ne=>({...ne,game:S.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low"].map(S=>e.jsx("option",{value:S,children:S},S))}),e.jsxs("select",{className:"input",value:I.mode,onChange:S=>A(ne=>({...ne,mode:S.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]}),e.jsx("input",{className:"input",type:"number",min:1,value:I.value,onChange:S=>A(ne=>({...ne,value:Number(S.target.value)}))})]}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Description",value:I.description,onChange:S=>A(ne=>({...ne,description:S.target.value}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"input",type:"datetime-local",value:I.startAt,onChange:S=>A(ne=>({...ne,startAt:S.target.value}))}),e.jsx("input",{className:"input",type:"number",min:0,value:I.checkinMinutes,onChange:S=>A(ne=>({...ne,checkinMinutes:Number(S.target.value)}))})]}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,value:I.capacity,onChange:S=>A(ne=>({...ne,capacity:Number(S.target.value)}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[e.jsxs("select",{className:"input",value:I.prizeType,onChange:S=>{const ne=S.target.value;A(ut=>({...ut,prizeType:ne,prizeAmount:ne==="premium"?3:0}))},children:[e.jsx("option",{value:"premium",children:"PREMIUM"}),e.jsx("option",{value:"cash",children:"Cash"})]}),I.prizeType==="premium"?e.jsxs("select",{className:"input",value:I.prizeAmount,onChange:S=>A(ne=>({...ne,prizeAmount:Number(S.target.value)})),children:[e.jsx("option",{value:1,children:"1 month"}),e.jsx("option",{value:3,children:"3 months"})]}):e.jsx("input",{className:"input",type:"number",min:0,value:I.prizeAmount,onChange:S=>A(ne=>({...ne,prizeAmount:Number(S.target.value)}))}),e.jsxs("select",{className:"input",disabled:I.prizeType!=="cash",value:I.currency,onChange:S=>A(ne=>({...ne,currency:S.target.value})),children:[e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"CAD",children:"CAD"}),e.jsx("option",{value:"AUD",children:"AUD"})]})]}),e.jsx("input",{className:"input w-full",placeholder:"Prize notes (optional)",value:I.prizeNotes,onChange:S=>A(ne=>({...ne,prizeNotes:S.target.value}))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn",disabled:c,onClick:ee,children:"Create"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Existing"}),e.jsxs("ul",{className:"space-y-2",children:[u.map(S=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:S.title}),e.jsx("div",{className:"opacity-70",children:S.status})]}),e.jsxs("div",{className:"opacity-80",children:[S.game," Â· ",S.mode==="firstto"?"FT":"BO"," ",S.value," Â· ",new Date(S.startAt).toLocaleString()," Â· ",S.capacity," cap"]}),S.prize&&e.jsxs("div",{className:"text-xs mt-1",children:["Prize: ",S.prizeType==="cash"&&S.prizeAmount?`${S.currency||"USD"} ${S.prizeAmount}`:`${S.prizeAmount||3} month${(S.prizeAmount||3)>1?"s":""} PREMIUM`," ",S.prizeType==="cash"&&S.status==="completed"&&S.payoutStatus&&e.jsx("span",{className:`ml-2 px-1.5 py-0.5 rounded ${S.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:S.payoutStatus})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:c||S.status!=="scheduled",onClick:()=>bt(S.id,prompt("Winner email?")||""),children:"Set Winner"}),S.prizeType==="cash"&&S.status==="completed"&&S.payoutStatus!=="paid"&&e.jsx("button",{className:"btn",disabled:c,onClick:()=>Ze(S.id),children:"Mark Paid"})]})]},S.id)),u.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{className:"btn",disabled:c,onClick:te,children:"Reseed Weekly Giveaway"})})]})]})]}),P&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Email Templates"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Customize titles, intro lines, and button text. Previews open in a new tab or as a popup."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(lt,{kind:"reset",label:"Password reset"}),e.jsx(lt,{kind:"reminder",label:"Password reset reminder"}),e.jsx(lt,{kind:"confirm-email",label:"Confirm new email"}),e.jsx(lt,{kind:"changed",label:"Password changed notice"})]})]})]}),F==="maintenance"&&P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Management"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Ban or unban users. Use with caution."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:C,onChange:S=>D(S.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:xe,children:"Search"})]}),T.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),T.map(S=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:S.name||"No name"}),e.jsx("div",{className:"opacity-70",children:S.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(S.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",onClick:()=>Re(S.email),children:"Ban"}),e.jsx("button",{className:"btn bg-green-600 hover:bg-green-700 text-xs",onClick:()=>re(S.email),children:"Unban"})]})]},S.email))]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Withdrawals"}),e.jsxs("ul",{className:"space-y-2",children:[p.map(S=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:S.id}),e.jsxs("div",{children:[S.email," Â· ",S.currency," ",(S.amountCents/100).toFixed(2)]}),e.jsxs("div",{className:"opacity-70",children:[S.status," Â· ",new Date(S.requestedAt).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2",children:S.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c,onClick:()=>ye(S.id,!0),children:"Approve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>ye(S.id,!1),children:"Reject"})]})})]},S.id)),p.length===0&&e.jsx("li",{className:"opacity-60",children:"No withdrawal requests."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),ce?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.database?"bg-emerald-600":"bg-red-600"}`,children:ce.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.websocket?"bg-emerald-600":"bg-red-600"}`,children:ce.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.https?"bg-emerald-600":"bg-amber-600"}`,children:ce.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.maintenance?"bg-red-600":"bg-emerald-600"}`,children:ce.maintenance?"Active":"Normal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(ce.uptime/3600),"h ",Math.floor(ce.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",Math.round(ce.memory.heapUsed/1024/1024),"MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",ce.version]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:Oe,children:"Refresh"})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:Oe,children:"Load Health Status"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"User Reports"}),e.jsxs("ul",{className:"space-y-2",children:[_.map(S=>e.jsx("li",{className:"p-2 rounded bg-black/20 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:S.id}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:S.reporter})," â†’ ",e.jsx("span",{className:"font-semibold",children:S.offender})," Â· ",new Date(S.ts).toLocaleString()]}),e.jsxs("div",{className:"opacity-80",children:["Reason: ",S.reason]}),S.messageId&&e.jsxs("div",{className:"opacity-60 text-xs",children:["Message ID: ",S.messageId]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${S.status==="open"?"bg-amber-600":"bg-emerald-600"}`,children:S.status}),S.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c,onClick:async()=>{await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:S.id,action:"resolved",requesterEmail:t?.email})}),await pe()},children:"Resolve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:async()=>{const ne=prompt("Enter notes for action taken (e.g., warning, block):")||"";await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:S.id,action:"actioned",notes:ne,requesterEmail:t?.email})}),await pe()},children:"Action"})]})]})]})},S.id)),_.length===0&&e.jsx("li",{className:"opacity-60",children:"No reports."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),ce?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.database?"bg-emerald-600":"bg-red-600"}`,children:ce.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.websocket?"bg-emerald-600":"bg-red-600"}`,children:ce.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.https?"bg-emerald-600":"bg-amber-600"}`,children:ce.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.maintenance?"bg-red-600":"bg-emerald-600"}`,children:ce.maintenance?"Active":"Normal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(ce.uptime/3600),"h ",Math.floor(ce.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",Math.round(ce.memory.heapUsed/1024/1024),"MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",ce.version]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:Oe,children:"Refresh"})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:Oe,children:"Load Health Status"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Open Matches"}),e.jsxs("ul",{className:"space-y-1",children:[(r?.matches||[]).map(S=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs",children:S.id}),e.jsx("span",{className:"opacity-80",children:S.creatorName}),e.jsxs("span",{className:"opacity-60",children:[S.game," ",S.mode==="firstto"?"FT":"BO"," ",S.value," ",S.game==="X01"?`/${S.startingScore}`:""]})]}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>fe(S.id),children:"Remove"})]},S.id)),(!r?.matches||r.matches.length===0)&&e.jsx("li",{className:"text-sm opacity-60",children:"No open matches."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Dangerous Operations"}),e.jsx("div",{className:"text-sm opacity-80 mb-3 text-red-400",children:"âš ï¸ These operations can cause data loss or service disruption. Use with extreme caution."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"Tournament Deletion"}),e.jsxs("ul",{className:"space-y-2",children:[u.map(S=>e.jsxs("li",{className:"p-2 rounded bg-red-900/20 border border-red-500/40 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:S.title}),e.jsx("div",{className:"opacity-70",children:S.status})]}),e.jsxs("div",{className:"opacity-80",children:[S.game," Â· ",S.mode==="firstto"?"FT":"BO"," ",S.value]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",disabled:c,onClick:()=>Ye(S.id),children:"Delete Tournament"})})]},S.id)),u.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"System Maintenance"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"p-3 rounded bg-red-900/20 border border-red-500/40",children:[e.jsx("div",{className:"font-semibold text-red-400 mb-2",children:"Maintenance Mode"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Put the entire site into maintenance mode. Users won't be able to access games or create matches."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${r?.maintenance?"bg-red-600":"bg-green-600"}`,children:r?.maintenance?"MAINTENANCE ACTIVE":"NORMAL OPERATION"}),e.jsx("button",{className:`btn ${r?.maintenance?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:c,onClick:()=>de(!r?.maintenance),children:r?.maintenance?"Disable":"Enable"})]})]})})]})]})]})]}),F==="premium"&&P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Subscription Grants"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke premium subscriptions for users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:i,onChange:S=>n(S.target.value)}),e.jsx("button",{className:"btn",disabled:c||!i.trim(),onClick:()=>Ne(i,30),children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>Pe(i),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Premium users get 30 days of access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Users who have won premium through tournaments."}),e.jsxs("div",{className:"space-y-2",children:[H.map(S=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:S.name||"No name"}),e.jsx("div",{className:"opacity-70",children:S.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Expires ",new Date(S.expiresAt).toLocaleDateString()]})]}),e.jsx("div",{className:"flex gap-2",children:S.expired?e.jsx("span",{className:"px-2 py-1 rounded bg-amber-600 text-xs",children:"Premium Expired"}):e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Premium Active"})})]},S.email)),H.length===0&&e.jsx("div",{className:"opacity-60",children:"No premium winners."})]})]})]}),b.open&&e.jsxs("div",{className:"fixed inset-0 z-[1000]",onClick:()=>g({open:!1}),children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsx("div",{className:"absolute inset-0 p-4 md:p-8 overflow-auto flex items-start md:items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-3xl bg-[#0b1020] rounded-2xl border border-indigo-500/40 shadow-2xl",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20",children:[e.jsxs("div",{className:"font-semibold",children:["Preview: ",b.kind]}),e.jsx("button",{className:"btn",onClick:()=>g({open:!1}),children:"Close"})]}),e.jsx("div",{className:"p-0 bg-black/30",children:e.jsx("iframe",{title:"Email Preview",style:{width:"100%",height:"70vh",border:"0",background:"transparent"},srcDoc:b.html||""})}),e.jsx("div",{className:"px-4 py-3 border-t border-indigo-500/20 text-xs opacity-70",children:"Click outside this panel or press Esc to close."})]})})]})]}):e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin"}),e.jsx("div",{className:"text-sm opacity-80",children:"You donâ€™t have permission to manage admins."})]})}function fm({user:t}){const{favoriteDouble:a,callerEnabled:s,callerVoice:i,callerVolume:n,speakCheckoutOnly:r,avgMode:l,autoStartOffline:o,rememberLastOffline:d,reducedMotion:c,compactHeader:f,allowSpectate:u,cameraScale:x,cameraAspect:p,autoscoreProvider:y,autoscoreWsUrl:C,calibrationGuide:D,preferredCameraId:T,preferredCameraLabel:N,cameraEnabled:I,offlineLayout:A,textSize:M,boxSize:k,setFavoriteDouble:b,setCallerEnabled:g,setCallerVoice:F,setCallerVolume:J,setSpeakCheckoutOnly:P,setAvgMode:H,setAutoStartOffline:E,setRememberLastOffline:_,setReducedMotion:ae,setCompactHeader:L,setAllowSpectate:Q,setCameraScale:ce,setCameraAspect:me,setAutoscoreProvider:_e,setAutoscoreWsUrl:ze,setCalibrationGuide:We,setPreferredCamera:at,setCameraEnabled:pe,setOfflineLayout:Ke,setTextSize:pt,setBoxSize:Ne}=ls(),[Pe,de]=m.useState([{key:"first180",label:"First 180",unlocked:!1,icon:"ðŸŽ¯",desc:"Score 180 in a match."},{key:"hundredGames",label:"100 Games Played",unlocked:!1,icon:"ðŸ…",desc:"Play 100 games."},{key:"tournamentWin",label:"Tournament Winner",unlocked:!1,icon:"ðŸ¥‡",desc:"Win a tournament."},{key:"bestLeg",label:"Best Leg",unlocked:!1,icon:"âš¡",desc:"Finish a leg in 12 darts or less."},{key:"comeback",label:"Comeback",unlocked:!1,icon:"ðŸ”¥",desc:"Win after trailing by 3 legs."}]);m.useEffect(()=>{const $=t?.username||"";$&&de(ge=>ge.map(rt=>({...rt,unlocked:!!localStorage.getItem(`ndn:achieve:${rt.key}:${$}`)})))},[t?.username]);const[ot,xe]=m.useState(!1),[Re,re]=m.useState(""),[ee,bt]=m.useState(""),[Ze,Ye]=m.useState(""),[te,ye]=m.useState(""),[fe,he]=m.useState(""),[Oe,it]=m.useState(!0),[Te,Et]=m.useState(null),[lt,S]=m.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[ne,ut]=m.useState("");m.useEffect(()=>{const $=t?.username||"";if($)try{re(localStorage.getItem(`ndn:bio:favPlayer:${$}`)||""),bt(localStorage.getItem(`ndn:bio:favTeam:${$}`)||""),Ye(localStorage.getItem(`ndn:bio:favDarts:${$}`)||""),ye(localStorage.getItem(`ndn:bio:bio:${$}`)||""),he(localStorage.getItem(`ndn:bio:profilePhoto:${$}`)||""),it(localStorage.getItem(`ndn:settings:allowAnalytics:${$}`)!=="false")}catch{}},[t?.username]),m.useEffect(()=>{t?.email&&St(`/api/subscription?email=${encodeURIComponent(t.email)}`).then($=>$.json()).then(Et).catch(()=>{})},[t?.email]);const Xe=()=>{const $=t?.username||"";if($)try{localStorage.setItem(`ndn:bio:favPlayer:${$}`,Re),localStorage.setItem(`ndn:bio:favTeam:${$}`,ee),localStorage.setItem(`ndn:bio:favDarts:${$}`,Ze),localStorage.setItem(`ndn:bio:bio:${$}`,te),localStorage.setItem(`ndn:bio:profilePhoto:${$}`,fe);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:$,avatar:fe}}))}catch{}localStorage.setItem(`ndn:settings:allowAnalytics:${$}`,Oe.toString()),xe(!1)}catch{}},Ot=$=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:$}}))}catch(ge){console.error("Navigation failed:",ge)}},Bt=$=>{const ge=$.toLowerCase();return ge.includes("username")||ge.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:ge.includes("premium")||ge.includes("upgrade")||ge.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:ge.includes("calibrat")||ge.includes("camera")||ge.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:ge.includes("voice")||ge.includes("caller")||ge.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:ge.includes("friend")||ge.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:ge.includes("stat")||ge.includes("score")||ge.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:ge.includes("setting")||ge.includes("customiz")||ge.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:ge.includes("tournament")||ge.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:ge.includes("help")||ge.includes("support")||ge.includes("faq")?{text:"You're already in the help section! Check the Support section above for more resources.",links:[{text:"Scroll to Support",tab:"settings"}]}:ge.includes("how to play")||ge.includes("game")||ge.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},Tt=()=>{if(!ne.trim())return;const $=ne.toLowerCase();S(rt=>[...rt,{text:ne,isUser:!0}]),ut("");const ge=Bt($);setTimeout(()=>{S(rt=>[...rt,{text:ge,isUser:!1}])},500)},[De,Jt]=m.useState(""),[ct,It]=m.useState(!1),[kt,Mt]=m.useState(""),[Nt,Zt]=m.useState([]);return m.useEffect(()=>{const $=()=>{const ge=speechSynthesis.getVoices();Zt(ge.filter(rt=>rt.lang.startsWith("en")))};$(),speechSynthesis.onvoiceschanged=$},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-black",children:[e.jsx(Sa,{className:"w-5 h-5"})," Account"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:logout")),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Logout"})}),e.jsxs("div",{className:"border-t border-red-500/20 pt-3",children:[e.jsxs("div",{className:"font-medium mb-2 text-black",children:["Change Username (",(()=>{const $=t?.usernameChangeCount||0;return $<2?`${2-$} free changes remaining`:"Â£2 per change"})(),")"]}),e.jsx("div",{className:"text-sm text-black mb-2",children:"You can change your username up to 2 times for free. Additional changes cost Â£2 each."}),t?.usernameChangeCount>=2&&!De.trim()?e.jsx("div",{className:"text-amber-400 text-sm mb-2",children:"âš ï¸ Additional username changes cost Â£2"}):null,e.jsx("input",{className:"input w-full mb-2",type:"text",placeholder:"New username",value:De,onChange:$=>Jt($.target.value),disabled:ct}),kt&&e.jsx("div",{className:"text-red-400 text-sm mb-2",children:kt}),e.jsx("button",{onClick:async()=>{if(Mt(""),!De.trim()){Mt("Username required");return}if(De.length<3||De.length>20){Mt("Username must be 3-20 characters");return}(t?.usernameChangeCount||0)<2?(localStorage.setItem("pendingUsernameChange",De.trim()),window.location.href="/?username-change=free"):window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02"},disabled:ct||!De.trim(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:ct?"Processing...":(t?.usernameChangeCount||0)<2?"Change Username (FREE)":"Change Username (Â£2)"})]})]})]})}),Te&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-black",children:[e.jsx(ai,{className:"w-5 h-5"})," Premium"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:["Status: ",Te.fullAccess?"Active":"Inactive"]}),Te.source&&e.jsxs("div",{className:"text-xs opacity-80",children:["Source: ",Te.source]}),Te.expiresAt&&e.jsxs("div",{className:"text-xs opacity-80",children:["Expires: ",new Date(Te.expiresAt).toLocaleDateString()]}),Te.renewalWarning&&e.jsxs("div",{className:"text-amber-600 text-xs mt-2 p-2 bg-amber-100 rounded",children:["âš ï¸ ",Te.renewalWarning]})]}),Te.source==="tournament"&&e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:async()=>{if(confirm("Are you sure you want to cancel your premium subscription? You will lose access to premium features."))try{await St("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,requesterEmail:t.email})});const $=await St(`/api/subscription?email=${encodeURIComponent(t.email)}`);Et(await $.json())}catch{alert("Failed to cancel premium. Please try again.")}},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Cancel Premium"})})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Sa,{className:"w-5 h-5 text-brand-400"})," Profile Bio"]}),ot?e.jsxs("button",{onClick:Xe,className:"flex items-center gap-2 px-3 py-1 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400 text-sm transition-colors",children:[e.jsx($l,{className:"w-4 h-4"})," Save"]}):e.jsxs("button",{onClick:()=>xe(!0),className:"flex items-center gap-2 px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400 text-sm transition-colors",children:[e.jsx(Ul,{className:"w-4 h-4"})," Edit"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Player:"}),ot?e.jsx("input",{className:"input w-full",type:"text",value:Re,onChange:$=>re($.target.value),placeholder:"e.g. Michael van Gerwen"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:Re||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Football Team:"}),ot?e.jsx("input",{className:"input w-full",type:"text",value:ee,onChange:$=>bt($.target.value),placeholder:"e.g. Manchester United"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:ee||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Darts:"}),ot?e.jsx("input",{className:"input w-full",type:"text",value:Ze,onChange:$=>Ye($.target.value),placeholder:"e.g. Unicorn Phase 5, 24g"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:Ze||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Short Bio / Quote:"}),ot?e.jsx("textarea",{className:"input w-full",value:te,onChange:$=>ye($.target.value),placeholder:"Write something about yourself...",rows:3}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[4rem] flex items-start",children:te||"No bio set"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Sa,{className:"w-5 h-5 text-cyan-400"})," Profile Photo"]}),e.jsxs("div",{children:[fe&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:fe,alt:"Profile",className:"w-16 h-16 rounded-full object-cover"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:$=>{const ge=$.target.files?.[0];if(ge){const rt=new FileReader;rt.onload=U=>{const z=U.target?.result;he(z);const oe=t?.username||"";oe&&localStorage.setItem(`ndn:bio:profilePhoto:${oe}`,z);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:oe,avatar:z}}))}catch{}},rt.readAsDataURL(ge)}},className:"hidden",id:"profile-photo-upload"}),e.jsx("label",{htmlFor:"profile-photo-upload",className:"btn bg-cyan-600 hover:bg-cyan-700 cursor-pointer",children:fe?"Change Photo":"Upload Photo"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Fl,{className:"w-5 h-5 text-green-400"})," Game Preferences"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Favourite Double:"}),e.jsxs("select",{className:"input w-full",value:a,onChange:$=>b($.target.value),children:[e.jsx("option",{value:"any",children:"Any Double"}),e.jsx("option",{value:"D20",children:"Double 20"}),e.jsx("option",{value:"D19",children:"Double 19"}),e.jsx("option",{value:"D18",children:"Double 18"}),e.jsx("option",{value:"D17",children:"Double 17"}),e.jsx("option",{value:"D16",children:"Double 16"}),e.jsx("option",{value:"D15",children:"Double 15"}),e.jsx("option",{value:"D14",children:"Double 14"}),e.jsx("option",{value:"D13",children:"Double 13"}),e.jsx("option",{value:"D12",children:"Double 12"}),e.jsx("option",{value:"D11",children:"Double 11"}),e.jsx("option",{value:"D10",children:"Double 10"}),e.jsx("option",{value:"D9",children:"Double 9"}),e.jsx("option",{value:"D8",children:"Double 8"}),e.jsx("option",{value:"D7",children:"Double 7"}),e.jsx("option",{value:"D6",children:"Double 6"}),e.jsx("option",{value:"D5",children:"Double 5"}),e.jsx("option",{value:"D4",children:"Double 4"}),e.jsx("option",{value:"D3",children:"Double 3"}),e.jsx("option",{value:"D2",children:"Double 2"}),e.jsx("option",{value:"D1",children:"Double 1"}),e.jsx("option",{value:"DB",children:"Bullseye"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Average Display Mode:"}),e.jsxs("select",{className:"input w-full",value:l,onChange:$=>H($.target.value),children:[e.jsx("option",{value:"all-time",children:"All Time Average"}),e.jsx("option",{value:"24h",children:"24 Hour Average"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"autoStartOffline",checked:o,onChange:$=>E($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoStartOffline",className:"text-sm",children:"Auto-start offline games"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"rememberLastOffline",checked:d,onChange:$=>_($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"rememberLastOffline",className:"text-sm",children:"Remember last offline game settings"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Offline Game Layout:"}),e.jsxs("select",{className:"input w-full",value:A||"classic",onChange:$=>Ke($.target.value),children:[e.jsx("option",{value:"classic",children:"Classic Layout"}),e.jsx("option",{value:"modern",children:"Modern Layout"})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(_l,{className:"w-5 h-5 text-purple-400"})," Audio & Voice"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"callerEnabled",checked:s,onChange:$=>g($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"callerEnabled",className:"text-sm font-medium",children:"Enable Voice Caller"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Voice:"}),e.jsx("select",{className:"input w-full",value:i,onChange:$=>F($.target.value),children:Nt.map($=>e.jsxs("option",{value:$.name,children:[$.name," (",$.lang,")"]},$.name))}),e.jsx("button",{onClick:()=>{const $=new SpeechSynthesisUtterance("Test voice: 180 scored!");$.voice=Nt.find(ge=>ge.name===i)||null,$.volume=n,speechSynthesis.speak($)},className:"btn bg-blue-600 hover:bg-blue-700 mt-2",children:"Test Voice"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Volume: ",Math.round(n*100),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:n,onChange:$=>J(parseFloat($.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"speakCheckoutOnly",checked:r,onChange:$=>P($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"speakCheckoutOnly",className:"text-sm",children:"Only announce checkouts"})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(oo,{className:"w-5 h-5 text-blue-400"})," Camera & Vision"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled",checked:I,onChange:$=>pe($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraEnabled",className:"text-sm",children:"Enable camera for scoring"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Camera Scale: ",x.toFixed(2),"x"]}),e.jsx("input",{type:"range",min:"0.5",max:"1.25",step:"0.05",value:x,onChange:$=>ce(parseFloat($.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Camera Aspect Ratio:"}),e.jsxs("select",{className:"input w-full",value:p||"wide",onChange:$=>me($.target.value),children:[e.jsx("option",{value:"wide",children:"Wide (16:9)"}),e.jsx("option",{value:"square",children:"Square (1:1)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Text Size:"}),e.jsxs("select",{className:"input w-full",value:M,onChange:$=>pt($.target.value),children:[e.jsx("option",{value:"small",children:"Small"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"large",children:"Large"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Box Size:"}),e.jsxs("select",{className:"input w-full",value:k,onChange:$=>Ne($.target.value),children:[e.jsx("option",{value:"small",children:"Small"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"large",children:"Large"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"calibrationGuide",checked:D,onChange:$=>We($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"calibrationGuide",className:"text-sm",children:"Show calibration guide"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Autoscore Provider:"}),e.jsxs("select",{className:"input w-full",value:y||"built-in",onChange:$=>_e($.target.value),children:[e.jsx("option",{value:"built-in",children:"Built-in Vision"}),e.jsx("option",{value:"manual",children:"Manual scoring only"}),e.jsx("option",{value:"external-ws",children:"External WebSocket"})]})]}),y==="manual"&&e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews and autoscore overlays are hidden while manual scoring is selected. Use the score inputs or keyboard shortcuts to record each visit."}),y==="external-ws"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"External WebSocket URL:"}),e.jsx("input",{className:"input w-full",type:"url",value:C||"",onChange:$=>ze($.target.value),placeholder:"ws://localhost:8080"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-orange-500/40 bg-orange-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(lo,{className:"w-5 h-5 text-orange-400"})," UI & Accessibility"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"reducedMotion",checked:c,onChange:$=>ae($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"reducedMotion",className:"text-sm",children:"Reduce motion/animations"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"compactHeader",checked:f,onChange:$=>L($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"compactHeader",className:"text-sm",children:"Compact header layout"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-pink-500/40 bg-pink-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Wl,{className:"w-5 h-5 text-pink-400"})," Online & Social"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowSpectate",checked:u,onChange:$=>Q($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowSpectate",className:"text-sm",children:"Allow others to spectate my games"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-yellow-700",children:[e.jsx(Rn,{className:"w-5 h-5"})," Achievements & Badges"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Pe.map($=>e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-xl border ${$.unlocked?"border-emerald-400 bg-emerald-500/10":"border-slate-400 bg-slate-700/10"}`,children:[e.jsx("div",{className:"text-3xl mb-2",children:$.icon}),e.jsx("div",{className:`font-bold mb-1 text-center ${$.unlocked?"text-emerald-400":"text-slate-400"}`,children:$.label}),e.jsx("div",{className:"text-xs text-slate-300 text-center mb-2",children:$.desc}),!$.unlocked&&e.jsx("div",{className:"text-xs text-amber-400 font-medium",children:"ðŸ”’ Locked"}),$.unlocked&&e.jsx("div",{className:"text-xs text-emerald-400 font-medium",children:"âœ… Unlocked!"})]},$.key))})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-gray-500/40 bg-gray-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Rn,{className:"w-5 h-5 text-gray-400"})," Data & Privacy"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowAnalytics",checked:Oe,onChange:$=>it($.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowAnalytics",className:"text-sm",children:"Allow anonymous usage analytics"})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{const $={username:t?.username,email:t?.email,favPlayer:Re,favTeam:ee,favDarts:Ze,bio:te,profilePhoto:fe,settings:{favoriteDouble:a,avgMode:l,autoStartOffline:o,rememberLastOffline:d,reducedMotion:c,compactHeader:f,allowSpectate:u,cameraScale:x,cameraAspect:p,autoscoreProvider:y,autoscoreWsUrl:C,calibrationGuide:D,callerEnabled:s,callerVoice:i,callerVolume:n,speakCheckoutOnly:r,textSize:M}},ge=new Blob([JSON.stringify($,null,2)],{type:"application/json"}),rt=URL.createObjectURL(ge),U=document.createElement("a");U.href=rt,U.download="ninedartnation-data.json",U.click(),URL.revokeObjectURL(rt)},className:"btn bg-blue-600 hover:bg-blue-700",children:"Export My Data"})}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete your account? This action cannot be undone.")&&alert("Account deletion not yet implemented. Please contact support.")},className:"btn bg-red-600 hover:bg-red-700",children:"Delete Account"})})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ai,{className:"w-5 h-5 text-red-400"})," Privacy & Copyright Notice"]}),e.jsx("div",{className:"space-y-3 text-sm text-slate-300",children:e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-red-300 mb-2",children:"âš ï¸ IMPORTANT LEGAL NOTICE"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Copyright Protection:"})," All code, assets, and intellectual property in Nine Dart Nation are protected by copyright law. Unauthorized copying, modification, or distribution of this software is strictly prohibited."]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Legal Consequences:"})," Any attempt to edit, reverse-engineer, or redistribute this code will result in immediate legal action, including but not limited to copyright infringement lawsuits and potential criminal charges."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Privacy:"})," Your personal data and gameplay information are protected. Any unauthorized access or data collection violates privacy laws and will be prosecuted to the full extent of the law."]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-teal-500/40 bg-teal-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Rn,{className:"w-5 h-5 text-teal-400"})," Support & Help"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-300 mb-2",children:"Need help? Contact us:"}),e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"btn bg-teal-600 hover:bg-teal-700",children:"Email Support"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(co,{className:"w-5 h-5 text-blue-400"})," Help Assistant"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-slate-800 rounded-lg p-4 max-h-96 overflow-y-auto space-y-3",children:lt.map(($,ge)=>e.jsx("div",{className:`flex ${$.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${$.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof $.text=="string"?$.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:$.text.text}),$.text.links&&e.jsx("div",{className:"space-y-1",children:$.text.links.map((rt,U)=>e.jsx("button",{onClick:()=>Ot(rt.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:rt.text},U))})]})})},ge))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:ne,onChange:$=>ut($.target.value),onKeyPress:$=>$.key==="Enter"&&Tt(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:Tt,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(mo,{className:"w-4 h-4"})})]})]})]})})]})}const xm={};function pm({onAuth:t}){const[a,s]=m.useState("signin"),[i,n]=m.useState(""),[r,l]=m.useState(""),[o,d]=m.useState(""),[c,f]=m.useState(""),[u,x]=m.useState(""),[p,y]=m.useState(!1),[C,D]=m.useState(!1),T="http://localhost:8787";async function N(k){if(k.preventDefault(),x(""),D(!0),!r||!o){x("Username and password required."),D(!1);return}try{const b=await fetch(`${T}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:o})}),g=await b.json();b.ok&&g?.user&&g?.token?(localStorage.setItem("authToken",g.token),t(g.user)):x(g?.error||"Invalid username or password.")}catch{x("Network error.")}finally{D(!1)}}async function I(k){if(k.preventDefault(),x(""),D(!0),!i||!r||!o){x("Email, username, and password required."),D(!1);return}try{const b=await fetch(`${T}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,username:r,password:o})}),g=await b.json();b.ok&&g?.user&&g?.token?(localStorage.setItem("authToken",g.token),t(g.user)):x(g?.error||"Signup failed.")}catch{x("Network error.")}finally{D(!1)}}async function A(k){if(k.preventDefault(),x(""),D(!0),!i||!i.includes("@")){x("Enter your email address."),D(!1);return}try{const g=await(await fetch(`${T}/api/auth/send-reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i})})).json();if(!g?.ok)throw new Error(g?.error||"Failed to send reset email");x("Password reset link sent to your email.")}catch(b){x(b?.message||"Failed to send reset email")}finally{D(!1)}}async function M(k){if(k.preventDefault(),x(""),D(!0),!i||!i.includes("@")){x("Enter your email address."),D(!1);return}try{const g=await(await fetch(`${T}/api/auth/send-username`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i})})).json();if(!g?.ok)throw new Error(g?.error||"Failed to send username email");x("Your username has been emailed to you.")}catch(b){x(b?.message||"Failed to send username email")}finally{D(!1)}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsxs("div",{className:"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsxs("form",{className:"card w-full space-y-4",onSubmit:a==="signin"?N:a==="signup"?I:A,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:[e.jsx("h1",{className:"logo text-center",children:"NINE-DART-NATION ðŸŽ¯"}),e.jsx("span",{className:"badge",children:"Welcome"})]}),e.jsx("h2",{className:"text-2xl font-bold",children:a==="signin"?"Sign In":a==="signup"?"Create Account":"Reset Password"}),(a==="signup"||a==="reset")&&e.jsx("input",{className:"input w-full",type:"email",placeholder:"Email",value:i,onChange:k=>n(k.target.value),required:!0}),a!=="reset"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Username",value:r,onChange:k=>l(k.target.value),required:!0}),a!=="reset"&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input w-full pr-10",type:p?"text":"password",placeholder:"Password",value:o,onChange:k=>d(k.target.value),autoComplete:"current-password",required:!0,onFocus:()=>y(!1),onBlur:()=>y(!1)}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white",tabIndex:-1,onMouseDown:k=>{k.preventDefault(),y(!0)},onMouseUp:k=>{k.preventDefault(),y(!1)},onMouseLeave:()=>y(!1),onTouchStart:k=>{k.preventDefault(),y(!0)},onTouchEnd:k=>{k.preventDefault(),y(!1)},"aria-label":"Toggle password visibility",children:p?e.jsx(Hl,{className:"w-5 h-5"}):e.jsx(lo,{className:"w-5 h-5"})})]}),a==="signup"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Password Reminder (optional)",value:c,onChange:k=>f(k.target.value)}),u&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:u}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:C,children:C?"Signing In...":a==="signin"?"Sign In":a==="signup"?"Sign Up":"Send Reset Link"}),a==="reset"&&e.jsx("button",{className:"btn w-full mt-2 bg-white/10 hover:bg-white/20",type:"button",onClick:M,disabled:C,children:"Email me my username"}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("button",{type:"button",className:"underline",onClick:()=>s(a==="signin"?"signup":"signin"),disabled:C,children:a==="signin"?"Need an account? Sign Up":"Already have an account? Sign In"}),e.jsx("button",{type:"button",className:"underline",onClick:()=>s("reset"),disabled:C,children:"Forgot password?"})]}),e.jsx("div",{className:"text-xs text-slate-200/80",children:"Tip: Use the admin demo credentials to explore admin features."})]}),e.jsxs("aside",{className:"card w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Whatâ€™s inside"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(cr,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Online & Friends"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Challenge friends, chat, and join leagues."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(zl,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Deep Stats"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Track 3-dart averages, best legs, and more."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(ea,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Game Modes"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Start with 3 free online games upon signup. After that, PREMIUM is required to play all games."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(ql,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Premium Perks"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Polished UI, upcoming features, and early access."})]})]})]}),e.jsxs("a",{href:xm?.VITE_DISCORD_INVITE_URL||"https://discord.gg/8GtbZ6RU",target:"_blank",rel:"noopener noreferrer",className:"btn mt-4 flex items-center justify-center gap-2",children:[e.jsx(aa,{className:"w-5 h-5"})," Join BullseyeDartsLeague"]})]})]})]})}const bm=m.createContext({theme:"default",setTheme:t=>{}}),ao="ndn_theme";function gm({children:t}){const[a,s]=m.useState("default");return m.useEffect(()=>{try{const i=localStorage.getItem(ao);i&&s(i)}catch{}},[]),m.useEffect(()=>{try{localStorage.setItem(ao,a)}catch{}},[a]),e.jsx(bm.Provider,{value:{theme:a,setTheme:s},children:e.jsx("div",{className:`theme-${a}`,children:t})})}const rl=m.createContext(null);function ym({children:t}){const[a,s]=m.useState(!1),[i,n]=m.useState("connecting"),r=m.useRef(null),l=m.useRef(new Set),o=m.useRef(!0),d=m.useRef(0),c=m.useRef(null),f=m.useRef(null),u=m.useRef(null),x=m.useRef(0),p=()=>{if(u.current)return u.current;const A="ws://localhost:8787";if(A.length>0){const F=A.endsWith("/ws")?A:A.replace(/\/$/,"")+"/ws";return u.current=[F],u.current}const M=window.location.protocol==="https:"?"wss":"ws",k=window.location.hostname,g=[`${M}://${window.location.host}`+"/ws",`${M}://${k}/ws`,`${M}://${k}:8787/ws`,`${M}://${k}:3000/ws`];return u.current=Array.from(new Set(g)),u.current},y=()=>{const A=p();return x.current=(x.current+1)%A.length,A[x.current]},C=()=>{const A=p();return A[x.current]||A[0]},D=m.useCallback(()=>{if(r.current&&(r.current.readyState===WebSocket.OPEN||r.current.readyState===WebSocket.CONNECTING))return;n("connecting");const M=`${C()}`,k=new WebSocket(M);r.current=k,k.onopen=()=>{s(!0),n("connected"),d.current=0,f.current&&clearInterval(f.current),f.current=setInterval(()=>{try{r.current?.readyState===WebSocket.OPEN&&r.current?.send(JSON.stringify({type:"ping",t:Date.now()}))}catch{}},2e4)},k.onmessage=b=>{try{const g=JSON.parse(b.data);l.current.forEach(F=>{try{F(g)}catch{}})}catch{}},k.onerror=()=>{},k.onclose=()=>{if(s(!1),n("disconnected"),f.current&&(clearInterval(f.current),f.current=null),!o.current)return;const b=(d.current||0)+1;d.current=b,b%2===0&&y();const g=1e3*Math.pow(2,b-1),F=Math.floor(Math.random()*1e3);let J=Math.min(3e4,g+F);b===1&&(J=0),c.current&&clearTimeout(c.current),J===0?D():c.current=setTimeout(D,J)}},[]);m.useEffect(()=>{o.current=!0,D();const A=()=>{o.current=!1;try{r.current?.close()}catch{}};window.addEventListener("beforeunload",A);const M=()=>{document.visibilityState==="visible"&&(a||D())};return document.addEventListener("visibilitychange",M),window.addEventListener("online",D),()=>{o.current=!1,c.current&&clearTimeout(c.current),f.current&&clearInterval(f.current);try{r.current?.close()}catch{}document.removeEventListener("visibilitychange",M),window.removeEventListener("online",D),window.removeEventListener("beforeunload",A)}},[D]);const T=m.useCallback(A=>{try{r.current&&r.current.readyState===WebSocket.OPEN&&r.current.send(typeof A=="string"?A:JSON.stringify(A))}catch{}},[]),N=m.useCallback(A=>(l.current.add(A),()=>{l.current.delete(A)}),[]),I=m.useMemo(()=>({connected:a,status:i,send:T,addListener:N}),[a,i,T,N]);return e.jsx(rl.Provider,{value:I,children:t})}function kr(){const t=m.useContext(rl);if(!t)throw new Error("useWS must be used within WSProvider");return t}function vm({status:t,title:a,size:s=12}){const i=s;return t==="connecting"?e.jsx("span",{role:"img","aria-label":"Connecting",title:a||"Connectingâ€¦",className:"inline-flex items-center justify-center",style:{width:i,height:i},children:e.jsxs("svg",{width:i,height:i,viewBox:"0 0 24 24",className:"animate-spin","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#A7F3D0",strokeWidth:"3",fill:"none",opacity:"0.35"}),e.jsx("path",{d:"M22 12a10 10 0 0 0-10-10",stroke:"#34D399",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]})}):t==="connected"?e.jsx("span",{role:"img","aria-label":"Connected",title:a||"Connected",className:"inline-flex items-center justify-center",style:{width:i,height:i},children:e.jsx("svg",{width:i,height:i,viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#34D399"})})}):e.jsx("span",{role:"img","aria-label":"Disconnected",title:a||"Not connected",className:"inline-flex items-center justify-center",style:{width:i,height:i},children:e.jsxs("svg",{width:i,height:i,viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#F87171",opacity:"0.15"}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"#F87171",strokeWidth:"2",fill:"none"}),e.jsx("rect",{x:"6",y:"11",width:"12",height:"2",rx:"1",fill:"#F87171"})]})})}const il="ndn:blocked:v1";function jm(){try{const t=localStorage.getItem(il);return t?JSON.parse(t):{}}catch{return{}}}function ro(t){try{localStorage.setItem(il,JSON.stringify(t))}catch{}}const Nm=on((t,a)=>({blocked:jm(),isBlocked:s=>!!a().blocked[(s||"").toLowerCase()],block:s=>t(i=>{const n={...i.blocked};return n[(s||"").toLowerCase()]=Date.now(),ro(n),{blocked:n}}),unblock:s=>t(i=>{const n={...i.blocked};return delete n[(s||"").toLowerCase()],ro(n),{blocked:n}}),all:()=>Object.keys(a().blocked)}));function wm({user:t}){const a="http://localhost:8787",s=jn(),i=(()=>{try{return kr()}catch{return null}})(),n=Nm(),[r,l]=m.useState("room-1"),[o,d]=m.useState(!1),[c,f]=m.useState([]),[u,x]=m.useState(!1),[p,y]=m.useState(!1),C=m.useRef(null),[D,T]=m.useState(null),N=m.useRef(null),I=m.useRef(0),A=m.useRef(null),M=m.useRef(!0),k=m.useRef(0),b=m.useRef(!1),g=Ln(),F=br(),{favoriteDouble:J,callerEnabled:P,callerVoice:H,callerVolume:E,speakCheckoutOnly:_,allowSpectate:ae,cameraScale:L,setCameraScale:Q,cameraEnabled:ce,textSize:me,boxSize:_e,autoscoreProvider:ze}=ls(),We=ze==="manual",pe=(h=>{switch(h){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(me),[Ke,pt]=m.useState(2),[Ne,Pe]=m.useState(!1),[de,ot]=m.useState([]),[xe,Re]=m.useState(0),[re,ee]=m.useState(0),[bt,Ze]=m.useState(0),[Ye,te]=m.useState(0),[ye,fe]=m.useState(""),[he,Oe]=m.useState(0),[it,Te]=m.useState(0),[Et,lt]=m.useState(""),[S,ne]=m.useState(null),[ut,Xe]=m.useState(null),Ot=m.useRef(null),[Bt,Tt]=m.useState(""),[De,Jt]=m.useState({}),[ct,It]=m.useState({}),[kt,Mt]=m.useState({}),[Nt,Zt]=m.useState({}),[$,ge]=m.useState({}),[rt,U]=m.useState({}),[z,oe]=m.useState({}),[ve,Ee]=m.useState({}),[Ae,Le]=m.useState(()=>pr()),[Ie,He]=m.useState(0),[Dt,Be]=m.useState(()=>{try{const h=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(h)}catch{return!1}}),[Kt,Us]=m.useState(null),Xs=m.useRef(null),Ds=m.useRef(null);function dn(){try{if(!Ds.current){const h=window.AudioContext||window.webkitAudioContext;h&&(Ds.current=new h)}Ds.current?.resume?.().catch(()=>{})}catch{}}function ys(h,j,w=0,R=.05){const X=Ds.current;if(!X)return;const ie=X.createOscillator(),le=X.createGain();ie.type="square",ie.frequency.value=h,le.gain.value=R,ie.connect(le),le.connect(X.destination);const W=X.currentTime+w;ie.start(W),ie.stop(W+j/1e3)}function Qs(h){dn(),Ds.current&&(h==="180"?(ys(880,110,0,.06),ys(1175,110,.06,.06),ys(1568,140,.12,.06)):(ys(659,140,0,.07),ys(784,140,.08,.07),ys(987,200,.16,.07)))}function zt(h,j){const w=Date.now(),R=Xs.current;R&&R.kind===h&&R.by===j&&w-R.ts<500||(Xs.current={kind:h,by:j,ts:w},Us({kind:h,by:j,turnIdx:g.currentPlayerIdx,ts:w}),Qs(h))}const[Nn,B]=m.useState(!1),[Y,Z]=m.useState([]),[V,K]=m.useState("bestof"),[ke,be]=m.useState(5),[st,nt]=m.useState(501),[Se,gt]=m.useState(null),[Pt,yt]=m.useState("");function qt(h){yt(h),setTimeout(()=>yt(""),4e3);try{s(h||"Stripe checkout failed",{type:"error"})}catch{}}const[$t,Es]=m.useState(null),[as,Rt]=m.useState(null),[Ft,vt]=m.useState("X01"),[we,es]=m.useState("X01"),[cs,vs]=m.useState(!1),ds=t?.username&&!t?.fullAccess?xo(t.username):1/0,At=!t?.fullAccess&&ds<=0,[ms,et]=m.useState("all"),[js,us]=m.useState("all"),[Yt,Ts]=m.useState("all"),[rs,_t]=m.useState(!1),[As,Xt]=m.useState(10),{H:hs}=Nr(),Zs=t?.username?Ks(t.username):0,is=br(h=>h.unread),fs=(Y||[]).filter(h=>!(ms!=="all"&&h.mode!==ms||js!=="all"&&Number(h.startingScore)!==Number(js)||Yt!=="all"&&h.game!==Yt||rs&&(!Zs||!h.creatorAvg||Math.abs(Number(h.creatorAvg)-Number(Zs))>As)));m.useEffect(()=>{const h=j=>{const w=j?.detail||{};w.game&&vt(w.game),(w.mode==="bestof"||w.mode==="firstto")&&K(w.mode),typeof w.value=="number"&&isFinite(w.value)&&be(Math.max(1,Math.floor(w.value))),typeof w.start=="number"&&isFinite(w.start)&&nt(Math.max(1,Math.floor(w.start))),B(!0)};return window.addEventListener("ndn:online-demo",h),()=>window.removeEventListener("ndn:online-demo",h)},[]),m.useEffect(()=>{const h=String(t?.email||"").toLowerCase();h&&St(`/api/friends/messages?email=${encodeURIComponent(h)}`).then(j=>j.json()).then(j=>{j?.ok&&Array.isArray(j.messages)&&F.load(j.messages)}).catch(()=>{})},[t?.email]),m.useEffect(()=>{const h=j=>{try{const w=j?.detail||{},R=Number(w.start||501);g.newMatch([t?.username||"You","Opponent"],R,r),g.addVisit(60,3),g.nextPlayer(),g.addVisit(85,3),g.nextPlayer(),g.addVisit(100,3),es("X01"),Pe(!0)}catch{}};return window.addEventListener("ndn:online-match-demo",h),()=>window.removeEventListener("ndn:online-match-demo",h)},[]),m.useEffect(()=>(M.current=!0,qe(),()=>{M.current=!1,A.current&&clearTimeout(A.current);try{N.current?.close()}catch{}}),[]),m.useEffect(()=>{F.setInGame(g.inProgress)},[g.inProgress]),m.useEffect(()=>{Kt&&g.currentPlayerIdx!==Kt.turnIdx&&Us(null)},[g.currentPlayerIdx,Kt?.turnIdx]),m.useEffect(()=>{try{i&&i.connected?i.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae}):N.current&&N.current.readyState===WebSocket.OPEN&&N.current.send(JSON.stringify({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae}))}catch{}},[ae,i?.connected]),m.useEffect(()=>{const h=j=>{const w=j?.detail?.roomId;w&&(l(w),i?i.send({type:"spectate",roomId:w}):N.current?.send(JSON.stringify({type:"spectate",roomId:w})),Pe(!0),B(!1))};return window.addEventListener("ndn:spectate-room",h),()=>window.removeEventListener("ndn:spectate-room",h)},[i]);function qe(){if(i){i.connected&&(i.send({type:"join",roomId:r}),i.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae}),i.send({type:"list-matches"}),d(!0));return}try{if(N.current&&(N.current.readyState===WebSocket.OPEN||N.current.readyState===WebSocket.CONNECTING))return}catch{}const h="ws://localhost:8787",j=window.location.protocol==="https:"?"wss":"ws",w=window.location.hostname,R=`${j}://${w}${window.location.port?"":":8787"}`,X=h.length>0?h:R,ie=new WebSocket(X);N.current=ie,ie.onopen=()=>{d(!0),I.current=0,b.current?s("Reconnected to lobby",{type:"success"}):(s("Connected to lobby",{type:"success"}),b.current=!0),ie.send(JSON.stringify({type:"join",roomId:r})),ie.send(JSON.stringify({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae})),ie.send(JSON.stringify({type:"list-matches"}))},ie.onmessage=le=>{const W=JSON.parse(le.data);if(W.type==="state"){g.importState(W.payload);const Ge=Number(W.payload._dpIndex),Wt=Number(W.payload._dpHits);Number.isFinite(Ge)&&Ze(Math.max(0,Ge)),Number.isFinite(Wt)&&te(Math.max(0,Wt));const ss=Number(W.payload._atcIndex),ns=Number(W.payload._atcHits);Number.isFinite(ss)&&Oe(Math.max(0,ss)),Number.isFinite(ns)&&Te(Math.max(0,ns));try{const Ue=W.payload._cricketById;Ue&&typeof Ue=="object"&&Jt(Ue)}catch{}try{const Ue=W.payload._shanghaiById;Ue&&typeof Ue=="object"&&It(Ue)}catch{}try{const Ue=W.payload._halveById;Ue&&typeof Ue=="object"&&Mt(Ue)}catch{}try{const Ue=W.payload._highlowById;Ue&&typeof Ue=="object"&&Zt(Ue)}catch{}try{const Ue=W.payload._killerById;Ue&&typeof Ue=="object"&&ge(Ue)}catch{}try{const Ue=W.payload._amCricketById;Ue&&typeof Ue=="object"&&U(Ue)}catch{}try{const Ue=W.payload._baseballById;Ue&&typeof Ue=="object"&&oe(Ue)}catch{}try{const Ue=W.payload._golfById;Ue&&typeof Ue=="object"&&Ee(Ue)}catch{}try{const Ue=W.payload._tttState;Ue&&typeof Ue=="object"&&Le(Ue)}catch{}try{const Ue=Number(W.payload._turnDarts);Number.isFinite(Ue)&&He(Math.max(0,Ue))}catch{}}else if(W.type==="joined")W.id&&T(W.id);else if(W.type==="presence"||W.type==="peer-joined")ot(Ge=>{const Wt=new Set(Ge);return W.id&&Wt.add(W.id),Array.from(Wt)});else if(W.type==="chat"){const Ge=!!(W.from&&D&&W.from===D),Wt=Ge?t?.username||"me":W.from||"peer",ss=String(W.from||"");if(!Ge&&ss&&n.isBlocked(ss))return;if(Ge&&C.current&&String(W.message||"")===C.current.text){C.current=null;return}f(ns=>[...ns,{from:Wt,message:W.message,fromId:ss||void 0}])}else if(W.type==="matches")Z(Array.isArray(W.matches)?W.matches:[]);else if(W.type==="invite")gt({matchId:W.matchId,fromId:W.fromId,fromName:W.fromName,calibrated:!!W.calibrated,boardPreview:W.boardPreview||null,game:W.game,mode:W.mode,value:W.value,startingScore:W.startingScore});else if(W.type==="match-start")l(W.roomId),ie.send(JSON.stringify({type:"join",roomId:W.roomId})),Pe(!0),B(!1),W.match?.game&&es(W.match.game),t?.username&&!t?.fullAccess&&li(t.username);else if(W.type==="declined")s("Invite declined",{type:"info"});else if(W.type==="error"){const Ge=typeof W.message=="string"?W.message:"Action not allowed";if(yt(Ge),W.code==="SPECTATE_NOT_ALLOWED")try{s("This player has spectating turned off.",{type:"error"})}catch{}W.code==="NOT_FOUND"&&$t&&Rt({game:$t.game,mode:$t.mode,value:$t.value,startingScore:$t.startingScore}),setTimeout(()=>yt(""),3500)}else if(W.type==="friend-invite")confirm(`${W.fromName||W.fromEmail} invited you to play ${W.game||"X01"} (${W.mode==="firstto"?"First To":"Best Of"} ${W.value||1}). Accept?`)?ie.send(JSON.stringify({type:"start-friend-match",toEmail:W.fromEmail,game:W.game,mode:W.mode,value:W.value,startingScore:W.startingScore})):s("Invite declined",{type:"info"});else if(W.type==="friend-message")F.add({id:W.id||`${W.ts}-${W.from}`,from:W.from,message:W.message,ts:W.ts||Date.now()}),g.inProgress||s(`${W.from}: ${W.message}`,{type:"info"});else if(W.type==="celebration"){const Ge=W.by||"Player",Wt=W.kind==="leg"?"leg":"180";zt(Wt,Ge)}else if(W.type==="cam-code")console.log("Received cam-code:",W.code),ne(W.code),s(`Pairing code: ${W.code}`,{type:"info"});else if(W.type==="cam-peer-joined")console.log("Mobile peer joined for code:",W.code),En(W.code);else if(W.type==="cam-answer"){console.log("Received cam-answer");const Ge=window.mobilePC;Ge&&Ge.setRemoteDescription(new RTCSessionDescription(W.payload))}else if(W.type==="cam-ice"){console.log("Received cam-ice");const Ge=window.mobilePC;Ge&&Ge.addIceCandidate(W.payload)}},ie.onclose=()=>{if(d(!1),!M.current)return;const le=(I.current||0)+1;I.current=le;const W=Math.min(3e4,1e3*Math.pow(2,le-1)),Ge=Date.now();Ge-k.current>4e3&&(s(`Disconnected. Reconnecting in ${Math.round(W/1e3)}s...`,{type:"error"}),k.current=Ge),A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{qe()},W)}}function ht(){const h=g.players||[],j=g.currentPlayerIdx||0,w=h[j],R=w?.legs?.[w?.legs?.length-1],X=R?R.totalScoreRemaining:g.startingScore,ie=R?.dartsThrown||0,le=R?R.totalScoreStart-R.totalScoreRemaining:0,W=ie>0?le/ie*3:0,Ge=R?.visits?.[R.visits.length-1]?.score??0;let Wt="Ã”Ã‡Ã¶";h.length===2?Wt=`${h[0]?.legsWon||0}-${h[1]?.legsWon||0}`:h.length>2&&(Wt=h.map(ks=>`${ks.name}:${ks.legsWon||0}`).join(" = "));const ss=g.bestLegThisMatch,ns=ss?`${ss.darts} darts${(()=>{const ks=h.find(Mn=>Mn.id===ss.playerId);return ks?` (${ks.name})`:""})()}`:"-",Tn=(ks=>{switch(ks){case"small":return"text-xs";case"large":return"text-base";default:return"text-sm"}})(me),In=(ks=>{switch(ks){case"small":return"p-2";case"large":return"p-4";default:return"p-3"}})(_e);return e.jsxs("div",{className:`${In} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${Tn}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:Wt}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold",children:w?.name||"Ã”Ã‡Ã¶"}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-lg",children:X}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:W.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:Ge}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:ns})]})]})}m.useEffect(()=>{if(!i)return;d(i.connected);const h=i.addListener(j=>{try{if(j.type==="state"){g.importState(j.payload);try{const w=Number(j.payload._dpIndex),R=Number(j.payload._dpHits);Number.isFinite(w)&&Ze(Math.max(0,w)),Number.isFinite(R)&&te(Math.max(0,R))}catch{}try{const w=Number(j.payload._atcIndex),R=Number(j.payload._atcHits);Number.isFinite(w)&&Oe(Math.max(0,w)),Number.isFinite(R)&&Te(Math.max(0,R))}catch{}try{const w=j.payload._cricketById;w&&typeof w=="object"&&Jt(w)}catch{}try{const w=j.payload._shanghaiById;w&&typeof w=="object"&&It(w)}catch{}try{const w=j.payload._halveById;w&&typeof w=="object"&&Mt(w)}catch{}try{const w=j.payload._highlowById;w&&typeof w=="object"&&Zt(w)}catch{}try{const w=j.payload._killerById;w&&typeof w=="object"&&ge(w)}catch{}try{const w=j.payload._amCricketById;w&&typeof w=="object"&&U(w)}catch{}try{const w=j.payload._baseballById;w&&typeof w=="object"&&oe(w)}catch{}try{const w=j.payload._golfById;w&&typeof w=="object"&&Ee(w)}catch{}try{const w=j.payload._tttState;w&&typeof w=="object"&&Le(w)}catch{}try{const w=Number(j.payload._turnDarts);Number.isFinite(w)&&He(Math.max(0,w))}catch{}}else if(j.type==="joined")j.id&&T(j.id);else if(j.type==="presence"||j.type==="peer-joined")ot(w=>Array.from(new Set([...w||[],j.id].filter(Boolean))));else if(j.type==="chat"){const w=!!(j.from&&D&&j.from===D),R=w?t?.username||"me":j.from||"peer",X=String(j.from||"");if(!w&&X&&n.isBlocked(X))return;f(ie=>[...ie,{from:R,message:j.message,fromId:X||void 0}])}else if(j.type==="matches")Z(Array.isArray(j.matches)?j.matches:[]);else if(j.type==="invite")gt({matchId:j.matchId,fromId:j.fromId,fromName:j.fromName,calibrated:!!j.calibrated,boardPreview:j.boardPreview||null,game:j.game,mode:j.mode,value:j.value,startingScore:j.startingScore});else if(j.type==="match-start")l(j.roomId),i.send({type:"join",roomId:j.roomId}),Pe(!0),B(!1),j.match?.game&&es(j.match.game),t?.username&&!t?.fullAccess&&li(t.username);else if(j.type==="declined")s("Invite declined",{type:"info"});else if(j.type==="error"){const w=typeof j.message=="string"?j.message:"Action not allowed";if(yt(w),j.code==="SPECTATE_NOT_ALLOWED")try{s("This player has spectating turned off.",{type:"error"})}catch{}j.code==="NOT_FOUND"&&$t&&Rt({game:$t.game,mode:$t.mode,value:$t.value,startingScore:$t.startingScore}),setTimeout(()=>yt(""),3500)}else if(j.type==="friend-invite")confirm(`${j.fromName||j.fromEmail} invited you to play ${j.game||"X01"} (${j.mode==="firstto"?"First To":"Best Of"} ${j.value||1}). Accept?`)?i.send({type:"start-friend-match",toEmail:j.fromEmail,game:j.game,mode:j.mode,value:j.value,startingScore:j.startingScore}):s("Invite declined",{type:"info"});else if(j.type==="friend-message")F.add({id:j.id||`${j.ts}-${j.from}`,from:j.from,message:j.message,ts:j.ts||Date.now()}),g.inProgress||s(`${j.from}: ${j.message}`,{type:"info"});else if(j.type==="celebration"){const w=j.by||"Player",R=j.kind==="leg"?"leg":"180";zt(R,w)}}catch{}});return i.connected&&(i.send({type:"join",roomId:r}),i.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae}),i.send({type:"list-matches"})),()=>{h()}},[i?.connected]);function ue(){if(i){i.send({type:"state",payload:{...g,_turnIdx:xe,_participants:de,_dpIndex:bt,_dpHits:Ye,_atcIndex:he,_atcHits:it,_cricketById:De,_shanghaiById:ct,_halveById:kt,_highlowById:Nt,_killerById:$,_amCricketById:rt,_baseballById:z,_golfById:ve,_tttState:Ae,_turnDarts:Ie}});return}const h=N.current;!h||h.readyState!==WebSocket.OPEN||h.send(JSON.stringify({type:"state",payload:{...g,_turnIdx:xe,_participants:de,_dpIndex:bt,_dpHits:Ye,_atcIndex:he,_atcHits:it,_cricketById:De,_shanghaiById:ct,_halveById:kt,_highlowById:Nt,_killerById:$,_amCricketById:rt,_baseballById:z,_golfById:ve,_tttState:Ae,_turnDarts:Ie}}))}function ft(h){const j=t?.username||"me";if(f(R=>[...R,{from:j,message:h,fromId:D||"self"}]),C.current={text:h,ts:Date.now()},i){i.send({type:"chat",message:h});return}const w=N.current;!w||w.readyState!==WebSocket.OPEN||w.send(JSON.stringify({type:"chat",message:h}))}function jt(h){if(hr(h,bt)){const w=Ye+1,R=bt+1;te(w),Ze(R);try{if(w>=bs.length){const X=g.players[g.currentPlayerIdx]?.name||"Player";zt("leg",X),te(0),Ze(0)}}catch{}}ue()}function dt(){const h=Math.max(0,Math.floor(re|0));jt(h),ee(0)}function xt(){const h=qs(ye);h!=null&&(jt(h),fe(""))}function Ct(h,j,w){const R=Lt[he];return R==null?!1:typeof w=="number"&&w>=1&&w<=20&&w===R&&(j==="SINGLE"||j==="DOUBLE"||j==="TRIPLE")?!0:R===25?j==="BULL"||h===25:R===50?j==="INNER_BULL"||h===50:h===R||h===R*2||h===R*3}function Vt(h,j,w){if(Ct(h,j,w)){const R=it+1,X=he+1;Te(R),Oe(X);try{if(R>=Lt.length){const ie=g.players[g.currentPlayerIdx]?.name||"Player";zt("leg",ie),Te(0),Oe(0)}}catch{}}ue()}function $s(){const h=Math.max(0,Math.floor(re|0));Vt(h),ee(0)}function Ps(){const h=qs(Et);h!=null&&(Vt(h),lt(""))}function tt(){return g.players[g.currentPlayerIdx]?.id??String(g.currentPlayerIdx)}function Rs(h){De[h]||Jt(j=>({...j,[h]:rn()}))}function en(h){ct[h]||It(j=>({...j,[h]:Vs()}))}function Ns(h){kt[h]||Mt(j=>({...j,[h]:Gs()}))}function Fs(h){Nt[h]||Zt(j=>({...j,[h]:Js()}))}function _s(h){if(!$[h]){const j=new Set(Object.values($||{}).map(X=>X.number)),w=[];for(let X=1;X<=20;X++)j.has(X)||w.push(X);const R=w.length>0?w[Math.floor(Math.random()*w.length)]:20;ge(X=>({...X,[h]:Ko(R,3)}))}}function ws(h){rt[h]||U(j=>({...j,[h]:$n()}))}function mn(h){z[h]||oe(j=>({...j,[h]:On()}))}function tn(h){ve[h]||Ee(j=>({...j,[h]:Bn()}))}m.useEffect(()=>{He(0)},[g.currentPlayerIdx,we]);function wn(h,j){const w=g.players.filter(R=>R.id!==j);return w.length===0?!1:w.every(R=>(De[R.id]?.marks?.[h]||0)>=3)}function ts(h,j,w){const R=tt();Rs(R),Jt(ie=>{const le={...ie},W={...le[R]||rn()};return Wo(W,h,j,w,Ge=>wn(Ge,R)),le[R]=W,le});const X=Ie+1;He(X),X>=3&&(He(0),g.nextPlayer()),ue()}function xs(h,j,w){const R=tt();en(R),It(ie=>{const le={...ie},W={...le[R]||Vs()};return Ho(W,h,j,w),le[R]=W,le});const X=Ie+1;He(X),X>=3&&(It(ie=>{const le={...ie},W={...le[R]||Vs()};return zo(W),le[R]=W,le}),He(0),g.nextPlayer()),ue()}function Ls(h,j,w){const R=tt();Ns(R),Mt(ie=>{const le={...ie},W={...le[R]||Gs()};return qo(W,h,j,w),le[R]=W,le});const X=Ie+1;He(X),X>=3&&(Mt(ie=>{const le={...ie},W={...le[R]||Gs()};return Vo(W),le[R]=W,le}),He(0),g.nextPlayer()),ue()}function Ss(h,j,w){const R=tt();Fs(R),Zt(ie=>{const le={...ie},W={...le[R]||Js()};return Go(W,h,j,w),le[R]=W,le});const X=Ie+1;He(X),X>=3&&(Zt(ie=>{const le={...ie},W={...le[R]||Js()};return Jo(W),le[R]=W,le}),He(0),g.nextPlayer()),ue()}function Os(h,j){const w=tt();g.players.forEach(X=>_s(X.id)),ge(X=>{const ie={};for(const[W,Ge]of Object.entries(X))ie[W]={...Ge};fr(w,ie,h,j);const le=xr(ie);if(le)try{zt("leg",g.players.find(W=>W.id===le)?.name||"Player")}catch{}return ie});const R=Ie+1;He(R),R>=3&&(He(0),g.nextPlayer()),ue()}function Sn(h,j,w){const R=tt();ws(R),U(ie=>{const le={...ie},Ge={...le[R]||$n()};return el(Ge,h,j,w,ss=>g.players.filter(ns=>ns.id!==R).every(ns=>(rt[ns.id]?.marks?.[ss]||0)>=3)),le[R]=Ge,le});const X=Ie+1;He(X),X>=3&&(He(0),g.nextPlayer()),ue()}function un(h,j,w){const R=tt();mn(R),oe(ie=>{const le={...ie},W={...le[R]||On()};return Yo(W,h,j,w),le[R]=W,le});const X=Ie+1;He(X),X>=3&&(He(0),g.nextPlayer()),ue()}function kn(h,j,w){const R=tt();tn(R),Ee(ie=>{const le={...ie},W={...le[R]||Bn()};return Qo(W,h,j,w),le[R]=W,le});const X=Ie+1;He(X),X>=3&&(He(0),g.nextPlayer()),ue()}function sn(h,j,w,R){Le(ie=>{const le={...ie,board:[...ie.board]};return Zo(le,h,j,w,R),le});const X=Ie+1;He(X),X>=3&&(He(0),g.nextPlayer()),ue()}function Cn(){try{window.dispatchEvent(new Event("ndn:open-manual"))}catch{}}function Ws(h){const j=Math.max(0,h|0);g.addVisit(j,3),ee(0);const w=g.players[g.currentPlayerIdx],R=w.legs[w.legs.length-1];try{j===180&&zt("180",w?.name||"Player"),R&&R.totalScoreRemaining===0&&zt("leg",w?.name||"Player")}catch{}if(R&&R.totalScoreRemaining===0?g.endLeg(j):g.nextPlayer(),P){const X=R?R.totalScoreRemaining:g.startingScore;na(t?.username||"Player",j,Math.max(0,X),H,{volume:E,checkoutOnly:_})}t?.username&&w?.name===t.username&&an(t.username,3,j),ue()}function Hn(h,j){const w={type:"report",offenderId:h,reason:"Inappropriate language",message:j};try{i?i.send(w):N.current?.send(JSON.stringify(w))}catch{}try{s("Report submitted",{type:"info"})}catch{}}async function hn(){try{const h=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),j=h.getVideoTracks?.()[0],w=document.createElement("video");w.srcObject=h,await w.play().catch(()=>{}),await new Promise(Ge=>setTimeout(Ge,120));const R=Math.min(320,w.videoWidth||320),X=Math.max(1,Math.floor((w.videoHeight||180)*(R/Math.max(1,w.videoWidth||320)))),ie=document.createElement("canvas");ie.width=R,ie.height=X,ie.getContext("2d").drawImage(w,0,0,R,X);const W=ie.toDataURL("image/jpeg",.7);try{j&&j.stop()}catch{}try{h.getTracks?.().forEach(Ge=>Ge.stop())}catch{}return W}catch{return null}}const En=async h=>{console.log("Starting WebRTC for code:",h);try{const j=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});j.ontrack=R=>{console.log("Received track:",R.streams[0]),Xe(R.streams[0]),Ot.current&&(Ot.current.srcObject=R.streams[0],console.log("Set video srcObject"))},j.onicecandidate=R=>{R.candidate&&(console.log("Sending ICE candidate"),i?i.send({type:"cam-ice",code:h,payload:R.candidate}):N.current&&N.current.readyState===WebSocket.OPEN&&N.current.send(JSON.stringify({type:"cam-ice",code:h,payload:R.candidate})))},j.onconnectionstatechange=()=>console.log("Connection state:",j.connectionState);const w=await j.createOffer();if(await j.setLocalDescription(w),console.log("Sending offer"),i)console.log("Sending offer via wsGlobal"),i.send({type:"cam-offer",code:h,payload:w});else if(N.current&&N.current.readyState===WebSocket.OPEN)console.log("Sending offer via wsRef"),N.current.send(JSON.stringify({type:"cam-offer",code:h,payload:w}));else{console.log("WS not available, POSTing offer to /cam/signal");try{await St(`/cam/signal/${h}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"cam-offer",payload:w,source:"desktop"})})}catch(R){console.warn("REST offer failed",R)}}window.mobilePC=j}catch(j){console.error("WebRTC error:",j),s("Failed to start mobile camera",{type:"error"})}};return e.jsxs("div",{className:"card flex flex-col min-h-[85vh] relative overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Online Play"}),is>0&&!g.inProgress&&e.jsxs("div",{className:"mb-3 text-sm px-3 py-2 rounded bg-amber-600/30 border border-amber-500/40",children:["You have ",is," unread message",is>1?"s":"",". Check the Friends tab."]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs opacity-70 shrink-0",children:"Room"}),e.jsx("input",{className:"input w-28",value:r,onChange:h=>l(h.target.value),placeholder:"room-1"})]}),o?e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0",children:"Connected"}):e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 shrink-0",onClick:qe,children:"Connect"}),e.jsx("button",{className:"btn shrink-0",onClick:ue,disabled:!o,children:"Sync"}),e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40 shrink-0",title:"Open a simulated online match demo",onClick:()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch{}},children:"DEMO"}),o&&e.jsx("button",{className:"btn shrink-0",onClick:()=>Pe(!0),disabled:At,title:At?"Weekly free games used":"",children:"Open Match"})]})}),e.jsx("div",{className:`mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end ${!o||At?"opacity-60 cursor-not-allowed":"cursor-pointer"}`,role:"button",title:o?At?"Weekly free games used":"Create a new match":"Connect to the lobby first",onClick:()=>{!o||At||(B(!0),i?i.send({type:"list-matches"}):N.current?.send(JSON.stringify({type:"list-matches"})))},children:e.jsx("button",{className:"btn",disabled:!o||At,children:"Create Match +"})}),e.jsx("p",{className:"text-sm text-slate-600 mt-3",children:"Open this app on another device and join the same Room ID to sync scores."}),!t?.fullAccess&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Weekly free online games remaining: ",ds===1/0?"Ã”Ã‡Ã¶":ds]}),!t?.fullAccess&&ds!==1/0&&ds<=0&&e.jsx("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm",children:"You've used your 3 free online games this week. PREMIUM required to continue."}),Pt&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"material-icons text-rose-300",children:"error_outline"}),Pt]}),as&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-700/30 border border-indigo-600/40 text-indigo-100 text-sm flex items-center justify-between gap-2",children:[e.jsx("div",{children:"That room is full or no longer available. Create a new clean room with the same settings?"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const{game:h,mode:j,value:w,startingScore:R}=as,X=t?.username?Ks(t.username):0;i?(i.send({type:"create-match",game:h,mode:j,value:w,startingScore:R||501,creatorAvg:X}),i.send({type:"list-matches"})):(N.current?.send(JSON.stringify({type:"create-match",game:h,mode:j,value:w,startingScore:R||501,creatorAvg:X})),N.current?.send(JSON.stringify({type:"list-matches"}))),Rt(null)},children:"Create New Match"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>Rt(null),children:"Dismiss"})]})]}),o&&e.jsxs("div",{className:"mt-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10 flex-1 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"World Lobby"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs opacity-80",children:["Matches: ",fs.length]}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>i?i.send({type:"list-matches"}):N.current?.send(JSON.stringify({type:"list-matches"})),children:"Refresh"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",title:o?At?"Weekly free games used":"Create a new match":"Connect to the lobby first",disabled:!o||At,onClick:()=>{!o||At||(B(!0),i?i.send({type:"list-matches"}):N.current?.send(JSON.stringify({type:"list-matches"})))},children:"Create Match +"})]})]}),e.jsxs("div",{className:"space-y-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Mode"}),e.jsx(ua,{tabs:[{key:"all",label:"All"},{key:"bestof",label:"Best of"},{key:"firstto",label:"First to"}],active:ms,onChange:h=>et(h)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Game"}),e.jsxs("select",{className:"input w-full",value:Yt,onChange:h=>Ts(h.target.value),children:[e.jsx("option",{value:"all",children:"All"}),vn.map(h=>e.jsx("option",{value:h,children:h},h))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Starting Score"}),e.jsxs("select",{className:"input w-full",value:js,onChange:h=>{const j=h.target.value;us(j==="all"?"all":Number(j))},disabled:Yt!=="all"&&Yt!=="X01",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"301",children:"301"}),e.jsx("option",{value:"501",children:"501"}),e.jsx("option",{value:"701",children:"701"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Opponent near my avg"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"nearavg",type:"checkbox",className:"accent-purple-500",checked:rs,onChange:h=>_t(h.target.checked),disabled:!Zs}),e.jsx("label",{htmlFor:"nearavg",className:"cursor-pointer text-sm",children:"Near my average"}),e.jsx("input",{className:"input w-24",type:"number",min:5,max:40,step:1,value:As,onChange:h=>Xt(parseInt(h.target.value||"10")),disabled:!rs})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 max-w-sm",children:[e.jsx("label",{className:`block text-xs opacity-70 mb-1 ${rs?"":"opacity-40"}`,children:"Avg tolerance (Â±)"}),e.jsx("input",{className:"w-full",type:"range",min:1,max:50,value:As,onChange:h=>Xt(parseInt(h.target.value||"10")),disabled:!rs}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["Â± ",As]})]}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{et("all"),Ts("all"),us("all"),_t(!1),Xt(10)},children:"Reset"})]})]}),fs.length===0?e.jsx("div",{className:"text-sm text-slate-300",children:"No games waiting. Create one!"}):e.jsx("div",{className:"space-y-2",children:fs.map(h=>e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 flex items-center justify-between relative",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[h.game||"X01"," ",h.game==="X01"?` ${h.startingScore}`:""," - ",h.mode==="bestof"?`Best Of ${h.value}`:`First To ${h.value}`," - Created by ",h.creatorName]}),h.requireCalibration&&e.jsx("div",{className:"text-[11px] inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-600/30 mt-1",children:"Calibration required"}),h.creatorAvg?e.jsxs("div",{className:"text-xs opacity-70",children:["Creator avg: ",Number(h.creatorAvg).toFixed(1)]}):null,e.jsxs("div",{className:"text-xs opacity-70",children:["ID: ",h.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm bg-green-600 hover:bg-green-700",disabled:At||!t?.fullAccess&&zs.includes(h.game)||!!h.requireCalibration&&!hs,title:!t?.fullAccess&&zs.includes(h.game)?"PREMIUM game":At?"Weekly free games used":h.requireCalibration&&!hs?"Calibration required":"",onClick:async()=>{Es({game:h.game,mode:h.mode,value:h.value,startingScore:h.startingScore});const j=!!hs,w=await hn();try{i?i.send({type:"join-match",matchId:h.id,calibrated:j,boardPreview:w}):N.current?.send(JSON.stringify({type:"join-match",matchId:h.id,calibrated:j,boardPreview:w}))}catch(R){qt(R?.message||"Failed to create Stripe checkout session. Please try again later.")}},children:"Join Now!"}),D&&h.creatorId===D&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Close this match",onClick:()=>{i?i.send({type:"cancel-match",matchId:h.id}):N.current?.send(JSON.stringify({type:"cancel-match",matchId:h.id}))},"aria-label":"Close match",children:"Ã—"})]})]},h.id))})]}),!t?.fullAccess&&ds!==1/0&&ds<=0&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"Â­Æ’Ã¶Ã†"}),e.jsx("div",{className:"font-semibold",children:"Online play locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"YouÃ”Ã‡Ã–ve used your 3 free online games this week. Upgrade to PREMIUM to play all modes."}),e.jsxs("button",{onClick:async()=>{try{const j=await(await fetch(`${a}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t?.email})})).json();j.ok&&j.url?window.location.href=j.url:alert("Failed to create payment session: "+(j.error||"Unknown error"))}catch{alert("Network error")}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM = ",vo(jo(),5)]})]})]}),Ne&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-2 md:p-3 flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:"Online Match"})}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>Pe(!1),children:"Close"})]}),e.jsx("div",{className:"relative flex-1 overflow-hidden p-2 md:p-3",children:e.jsxs("div",{className:"card w-full h-full overflow-hidden relative p-2.5 md:p-3",children:[Kt&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-start justify-center pt-8 z-20",children:[e.jsxs("div",{className:`px-4 py-2 rounded-full text-lg font-bold shadow ${Kt.kind==="leg"?"bg-indigo-500/20 border border-indigo-400/40 text-indigo-100":"bg-emerald-500/20 border border-emerald-400/40 text-emerald-100"}`,children:[Kt.kind==="leg"?"Â­Æ’Ã…Ã¼ LEG WON Ã”Ã‡Ã¶ ":"Â­Æ’Ã„Â» ONE HUNDRED AND EIGHTY! Ã”Ã‡Ã¶ ",Kt.by]}),Kt.kind==="leg"&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:"@keyframes ndn-confetti-fall{0%{transform:translateY(-10%) rotate(0deg);opacity:1}100%{transform:translateY(120%) rotate(360deg);opacity:0}}"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(24)].map((h,j)=>{const w=Math.random()*100,R=Math.random()*.2,X=1.2+Math.random()*.8,ie=6+Math.random()*6,le=Math.floor(Math.random()*360);return e.jsx("span",{style:{position:"absolute",top:0,left:w+"%",width:ie,height:ie,background:`hsl(${le} 90% 60%)`,borderRadius:2,animation:`ndn-confetti-fall ${X}s ease-out ${R}s forwards`}},j)})})]})]}),e.jsxs("div",{className:"mb-1.5 text-xs md:text-sm flex items-center justify-between gap-2",children:[e.jsxs("span",{children:["Participants: ",de.length||1]}),e.jsx("button",{className:"text-[11px] px-2 py-0.5 rounded-full bg-slate-700/50 hover:bg-slate-700 border border-slate-600",onClick:()=>Be(h=>!h),title:Dt?"Switch to full multi-player view":"Switch to compact player-by-player view",children:Dt?"Full view":"Compact view"})]}),Dt?e.jsxs("div",{className:"mb-3",children:[(()=>{const h=g.currentPlayerIdx,j=g.players[h];if(!j)return null;const w=j.legs[j.legs.length-1],R=w?w.totalScoreRemaining:g.startingScore,X=t?.username&&j.name===t.username,ie=w&&w.visits.length?w.visits[w.visits.length-1].score:0,le=w?w.dartsThrown:0,W=le>0?((w?.totalScoreStart??g.startingScore)-R)/le*3:0;return we==="X01"?e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${h===g.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${h===g.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:h===g.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-4xl font-extrabold",children:R}),e.jsxs("div",{className:"text-sm mt-1",children:["Last score: ",e.jsx("span",{className:"font-semibold",children:ie})]}),e.jsxs("div",{className:"text-sm",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:W.toFixed(1)})]}),X&&h===g.currentPlayerIdx&&R<=170&&R>0&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",J,"): ",ia(R,J).join("  Ã”Ã‡Ã³  ")||"Ã”Ã‡Ã¶"]})]}):e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${h===g.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${h===g.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:h===g.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-sm opacity-80",children:we}),we==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:bs[bt]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[Ye," / ",bs.length]})]}),we==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Lt[he]===25?"25 (Outer Bull)":Lt[he]===50?"50 (Inner Bull)":Lt[he]||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[it," / ",Lt.length]})]})]})})(),g.players.length>1&&e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Next up: ",g.players[(g.currentPlayerIdx+1)%g.players.length]?.name]})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-3 flex flex-wrap items-center gap-2",children:g.players.map((h,j)=>{const w=h.legs[h.legs.length-1],R=w?w.totalScoreRemaining:g.startingScore;return e.jsxs("div",{className:`px-2 py-1 rounded bg-black/20 border border-slate-700/40 text-xs ${j===g.currentPlayerIdx?"ring-1 ring-brand-400":""}`,children:[e.jsx("span",{className:"font-semibold",children:h.name}),we==="X01"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:R})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:we==="Double Practice"?`${Ye}/${bs.length}`:we==="Around the Clock"?`${it}/${Lt.length}`:we==="Cricket"?`${De[h.id]?.points||0} pts`:we==="Shanghai"?`${ct[h.id]?.score||0} pts = R${ct[h.id]?.round||1}`:we==="Halve It"?`${kt[h.id]?.score||0} pts = S${(kt[h.id]?.stage||0)+1}`:we==="High-Low"?`${Nt[h.id]?.score||0} pts = ${Nt[h.id]?.target||"HIGH"}`:we==="Killer"?(()=>{const X=$[h.id];return X?`#${X.number} = ${X.lives}Ã”Ã˜Ã± ${X.isKiller?"= K":""}`:"Ã”Ã‡Ã¶"})():we==="American Cricket"?`${rt[h.id]?.points||0} pts`:we==="Baseball"?(()=>{const X=z[h.id];return X?`R${X.score} = I${X.inning}`:"Ã”Ã‡Ã¶"})():we==="Golf"?(()=>{const X=ve[h.id];return X?`S${X.strokes} = H${X.hole}`:"Ã”Ã‡Ã¶"})():we==="Tic Tac Toe"?(()=>{const X=(Ae.board||[]).filter(le=>le==="X").length,ie=(Ae.board||[]).filter(le=>le==="O").length;return`X${X}-O${ie}`})():we})]})]},`strip-${h.id}`)})})}),Dt?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("button",{className:`btn ${pe}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${pe}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${pe}`,onClick:Cn,children:"Manual Correction"}),!We&&e.jsx("button",{className:`btn ${pe}`,onClick:()=>{console.log("Sending cam-create"),i?i.send({type:"cam-create"}):N.current&&N.current.readyState===WebSocket.OPEN?N.current.send(JSON.stringify({type:"cam-create"})):s("Not connected to server",{type:"error"})},children:"Pair Phone"}),!We&&S&&e.jsxs("div",{className:"ml-2 text-sm bg-blue-900/50 p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Mobile pairing code: "}),e.jsx("span",{className:"font-mono font-bold text-lg",children:S})]}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["On your phone, go to: ",e.jsxs("a",{href:`/mobile-cam.html?code=${S}`,target:"_blank",className:"underline",children:[window.location.origin,"/mobile-cam.html?code=",S]})]})]}),!We&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[11px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam size"}),e.jsx("button",{className:`btn ${pe}`,onClick:()=>Q(Math.max(.5,Math.round((L-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${pe} min-w-[2.5rem] text-center`,children:[Math.round(L*100),"%"]}),e.jsx("button",{className:`btn ${pe}`,onClick:()=>Q(Math.min(1.25,Math.round((L+.05)*100)/100)),children:"+"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 items-start",children:[e.jsx("div",{className:"order-1",children:e.jsx(ht,{})}),e.jsx("div",{className:"order-2",children:ce?e.jsxs("div",{className:"min-w-[260px] relative z-10 overflow-hidden",style:{maxHeight:"min(50vh, 400px)"},children:[e.jsx(oa,{label:"Your Board",autoStart:t?.username&&g.players[g.currentPlayerIdx]?.name===t.username}),ut&&e.jsxs("div",{className:"mt-2",children:[e.jsx("video",{ref:Ot,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto max-h-32 object-cover rounded border"}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Mobile Camera"})]})]}):e.jsx("div",{className:"text-xs opacity-60",children:"Camera disabled in settings"})})]}),e.jsxs("div",{className:"font-semibold",children:["Current: ",g.players[g.currentPlayerIdx]?.name||"Ã”Ã‡Ã¶"]}),we==="X01"&&ce&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs(e.Fragment,{children:[e.jsx(Je,{hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(h,j,w)=>{if(P){const X=g.players[g.currentPlayerIdx],ie=X?.legs[X.legs.length-1],le=ie?ie.totalScoreRemaining:g.startingScore;na(t?.username||"Player",h,Math.max(0,le),H,{volume:E,checkoutOnly:_})}const R=g.players[g.currentPlayerIdx];t?.username&&R?.name===t.username&&an(t.username,j,h);try{h===180&&zt("180",R?.name||"Player"),w&&zt("leg",R?.name||"Player")}catch{}w||g.nextPlayer(),ue()}}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>Ws(re),children:"Submit Visit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{g.undoVisit(),ue()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-1.5 text-xs",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(h=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>Ws(h),children:h},h))]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 mb-2",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>y(!0),children:"Messages"})]})]}):we==="Double Practice"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Double Practice Ã”Ã‡Ã¶ Hit doubles D1Ã”Ã¥Ã†D20Ã”Ã¥Ã†DBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:bs[bt]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Ye," / ",bs.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j)=>{(j==="DOUBLE"||j==="INNER_BULL")&&jt(h)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&dt()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:dt,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (D16, 50, 25, T20)",value:ye,onChange:h=>fe(h.target.value),onKeyDown:h=>{h.key==="Enter"&&xt()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:xt,children:"Add"})]})]}):we==="Around the Clock"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Around the Clock Ã”Ã‡Ã¶ Hit 1Ã”Ã¥Ã†20 then 25 (outer) and 50 (inner)"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Lt[he]===25?"25 (Outer Bull)":Lt[he]===50?"50 (Inner Bull)":Lt[he]||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[it," / ",Lt.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Vt(h,j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&$s()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:$s,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (T20, D5, 25, 50)",value:Et,onChange:h=>lt(h.target.value),onKeyDown:h=>{h.key==="Enter"&&Ps()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Ps,children:"Add"})]})]}):we==="Cricket"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Cricket Ã”Ã‡Ã¶ Close 15-20 and Bull; overflow scores points"}),(()=>{const h=tt();Rs(h);const j=De[h]||rn();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:Wn.map(w=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:w===25?"Bull":w}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[w]||0)," / 3"]})]},w))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:De[tt()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{ts(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(ts(Math.max(0,re|0)),ee(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{ts(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="Shanghai"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();en(h);const j=ct[h]||Vs();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Shanghai Ã”Ã‡Ã¶ Hit only the round's number; Single/Double/Triple score"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j.round})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{xs(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(xs(Math.max(0,re|0)),ee(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{xs(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="Halve It"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();Ns(h);const j=kt[h]||Gs(),w=la(j);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Halve It Ã”Ã‡Ã¶ Hit the target each round or your score halves"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[j.stage+1,"/",j.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const R=w;return R?R.kind==="ANY_NUMBER"?"Any":R.kind==="BULL"?"Bull":R.kind==="DOUBLE"||R.kind==="TRIPLE"||R.kind==="NUMBER"?`${R.kind} ${R.num}`:"Ã”Ã‡Ã¶":"Ã”Ã‡Ã¶"})()})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Ls(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Ls(Math.max(0,re|0)),ee(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Ls(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="High-Low"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();Fs(h);const j=Nt[h]||Js();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"High-Low Ã”Ã‡Ã¶ Alternate aiming for high then low segments"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j.round})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:j.target})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Ss(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Ss(Math.max(0,re|0)),ee(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Ss(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="American Cricket"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"American Cricket Ã”Ã‡Ã¶ Close 12-20 and Bull; overflow scores"}),(()=>{const h=tt();ws(h);const j=rt[h]||$n();return e.jsx("div",{className:"mb-2 grid grid-cols-5 gap-1 text-center text-[11px]",children:ma.map(w=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:w===25?"Bull":w}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[w]||0)," / 3"]})]},w))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:rt[tt()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Sn(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Sn(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="Baseball"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();mn(h);const j=z[h]||On();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Baseball Ã”Ã‡Ã¶ Inning ",j.inning," Ã”Ã‡Ã³ Runs ",j.score]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{un(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{un(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="Golf"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();tn(h);const j=ve[h]||Bn();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Golf Ã”Ã‡Ã¶ Hole ",j.hole," (target ",Xo[j.hole],") Ã”Ã‡Ã³ Strokes ",j.strokes]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{kn(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{kn(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="Tic Tac Toe"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Tic Tac Toe Ã”Ã‡Ã¶ Tap a cell to claim by hitting its target"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(h,j)=>j).map(h=>e.jsx("button",{className:`h-12 rounded-xl border ${Ae.board[h]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(Ae.finished||Ae.board[h])return;const j=Un[h],w=Number(Bt||0),R=w%3===0?"TRIPLE":w%2===0?"DOUBLE":"SINGLE",X=j.type==="BULL"?null:j.num||null;sn(h,w,R,X),Tt("")},children:Ae.board[h]||""},h))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Enter dart score (e.g. 20, 40, 60, 25, 50)",value:Bt,onChange:h=>Tt(h.target.value),onKeyDown:h=>{if(h.key==="Enter"){const j=Array.from({length:9},(w,R)=>R).find(w=>!Ae.board[w]&&!Ae.finished);if(j!==void 0){const w=Un[j],R=Number(Bt||0),X=R%3===0?"TRIPLE":R%2===0?"DOUBLE":"SINGLE",ie=w.type==="BULL"?null:w.num||null;sn(j,R,X,ie),Tt("")}}}}),e.jsx("button",{className:"btn",onClick:()=>{const h=Array.from({length:9},(j,w)=>w).find(j=>!Ae.board[j]&&!Ae.finished);if(h!==void 0){const j=Un[h],w=Number(Bt||0),R=w%3===0?"TRIPLE":w%2===0?"DOUBLE":"SINGLE",X=j.type==="BULL"?null:j.num||null;sn(h,w,R,X),Tt("")}},children:"Claim Cell"})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{}})})]}):we==="Killer"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer Ã”Ã‡Ã¶ Hit your own double to become Killer; then remove othersÃ”Ã‡Ã– lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:(()=>{const h=tt();return g.players.forEach(j=>_s(j.id)),$[h]?.number||"Ã”Ã‡Ã¶"})()})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:(()=>{const h=tt();return $[h]?.lives??"Ã”Ã‡Ã¶"})()})," ",(()=>{const h=tt();return $[h]?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null})()]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Os(j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Os("SINGLE",Math.max(0,re|0)),ee(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Os("SINGLE",Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-xs mb-1.5",children:[we," (online) Ã”Ã‡Ã¶ manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const h=Math.max(0,re|0);g.addVisit(h,3),ee(0),g.nextPlayer(),ue()},children:"Submit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{g.undoVisit(),ue()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>y(!0),children:"Messages"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsx(ht,{})}),e.jsxs("div",{className:`md:col-span-${Ke} space-y-1.5 relative`,children:[e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("button",{className:`btn ${pe}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${pe}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${pe}`,onClick:Cn,children:"Manual Correction"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[e.jsx("span",{className:"text-xs opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${pe}`,onClick:()=>Q(Math.max(.5,Math.round((L-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${pe} bg-transparent border-slate-600 text-center min-w-[3rem]`,children:[Math.round(L*100),"%"]}),e.jsx("button",{className:`btn ${pe}`,onClick:()=>Q(Math.min(1.25,Math.round((L+.05)*100)/100)),children:"+"}),e.jsx("button",{className:`btn ${pe}`,onClick:()=>pt(Ke===2?3:2),title:Ke===2?"Expand camera":"Shrink camera",children:Ke===2?"â†”":"â†™"})]})]}),e.jsxs("div",{className:"mt-2 relative",children:[e.jsx("div",{className:"w-full max-w-full",children:e.jsx(oa,{label:"Your Board",autoStart:t?.username&&g.players[g.currentPlayerIdx]?.name===t.username})}),Ke<3&&e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-slate-600/20 hover:bg-slate-600/40 transition-colors flex items-center justify-center group",onMouseDown:h=>{h.preventDefault();const j=h.clientX,w=Ke,R=ie=>{ie.clientX-j>50&&w===2&&pt(3)},X=()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",X)};document.addEventListener("mousemove",R),document.addEventListener("mouseup",X)},children:e.jsx("div",{className:"w-0.5 h-8 bg-slate-400 group-hover:bg-slate-300 transition-colors"})})]}),e.jsxs("div",{className:"font-semibold text-sm md:text-base",children:["Current: ",g.players[g.currentPlayerIdx]?.name||"Ã”Ã‡Ã¶"]}),we==="X01"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs(e.Fragment,{children:[e.jsx(Je,{hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(h,j,w)=>{if(P){const X=g.players[g.currentPlayerIdx],ie=X?.legs[X.legs.length-1],le=ie?ie.totalScoreRemaining:g.startingScore;na(t?.username||"Player",h,Math.max(0,le),H,{volume:E,checkoutOnly:_})}const R=g.players[g.currentPlayerIdx];t?.username&&R?.name===t.username&&an(t.username,j,h);try{h===180&&zt("180",R?.name||"Player"),w&&zt("leg",R?.name||"Player")}catch{}w||g.nextPlayer(),ue()}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>Ws(re),children:"Submit Visit (Manual)"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{g.undoVisit(),ue()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(h=>e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Ws(h),children:h},h))]}),(()=>{const h=g.players[g.currentPlayerIdx],j=h?.legs?.[h.legs?.length-1],w=j?j.totalScoreRemaining:g.startingScore;return w>0&&w<=170?e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",J,"): ",ia(w,J).join("  Ã”Ã‡Ã³  ")||"Ã”Ã‡Ã¶"]}):null})()]}):we==="Double Practice"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Double Practice Ã”Ã‡Ã¶ Hit doubles D1Ã”Ã¥Ã†D20Ã”Ã¥Ã†DBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:bs[bt]?.label||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Ye," / ",bs.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j)=>{(j==="DOUBLE"||j==="INNER_BULL")&&jt(h)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&dt()}}),e.jsx("button",{className:"btn",onClick:dt,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:ye,onChange:h=>fe(h.target.value),onKeyDown:h=>{h.key==="Enter"&&xt()}}),e.jsx("button",{className:"btn",onClick:xt,children:"Add"})]})]}):we==="Cricket"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Cricket Ã”Ã‡Ã¶ Close 15-20 and Bull; overflow scores points"}),(()=>{const h=tt();Rs(h);const j=De[h]||rn();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:Wn.map(w=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:w===25?"Bull":w}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[w]||0)," / 3"]})]},w))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:De[tt()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{ts(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{ts(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="Shanghai"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();en(h);const j=ct[h]||Vs();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["Shanghai Ã”Ã‡Ã¶ Round ",j.round," Ã”Ã‡Ã³ Score ",j.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{xs(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{xs(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="Halve It"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();Ns(h);const j=kt[h]||Gs(),w=la(j);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm mb-2",children:["Halve It Ã”Ã‡Ã¶ Stage ",j.stage+1,"/",j.targets.length," Ã”Ã‡Ã³ Score ",j.score]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const R=w;return R?R.kind==="ANY_NUMBER"?"Any":R.kind==="BULL"?"Bull":R.kind==="DOUBLE"||R.kind==="TRIPLE"||R.kind==="NUMBER"?`${R.kind} ${R.num}`:"Ã”Ã‡Ã¶":"Ã”Ã‡Ã¶"})()})]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Ls(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Ls(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="High-Low"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();Fs(h);const j=Nt[h]||Js();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["High-Low Ã”Ã‡Ã¶ Round ",j.round," Ã”Ã‡Ã³ Target ",j.target," Ã”Ã‡Ã³ Score ",j.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Ss(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Ss(Math.max(0,re|0)),ee(0)},children:"Add Dart"})]})]}):we==="Killer"&&t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=tt();g.players.forEach(w=>_s(w.id));const j=$[h];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer Ã”Ã‡Ã¶ Hit your own double to become Killer; then remove othersÃ”Ã‡Ã– lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j?.number||"Ã”Ã‡Ã¶"})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:j?.lives??"Ã”Ã‡Ã¶"})," ",j?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 gap-1 text-[11px]",children:g.players.map(w=>{const R=$[w.id];return e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80 truncate",children:w.name}),e.jsx("span",{className:"font-mono",children:R?`#${R.number} = ${R.lives}Ã”Ã˜Ã±${R.isKiller?" = K":""}`:"Ã”Ã‡Ã¶"})]},w.id)})})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 my-2",children:e.jsx(Je,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Os(j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Os("SINGLE",Math.max(0,re|0)),ee(0)},children:"Add Dart"})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Tip: Only doubles/triples on the opponentsÃ”Ã‡Ã– numbers remove lives. To become Killer, hit your own double."})]}):t?.username&&g.players[g.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-sm mb-2",children:[we," (online) Ã”Ã‡Ã¶ manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:re,onChange:h=>ee(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const h=Math.max(0,re|0);g.addVisit(h,3),ee(0),g.nextPlayer(),ue()},children:"Submit"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{g.undoVisit(),ue()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>y(!0),children:"Messages"})]})})]})]})})]})]}),Nn&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50",children:e.jsx("div",{className:"w-full h-full flex items-stretch justify-stretch p-0",children:e.jsxs(Ys,{storageKey:"ndn:modal:create-match",className:"w-full h-full rounded-none !border-0 !shadow-none relative",fullScreen:!0,children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-slate-900/80 backdrop-blur border-b border-slate-700 z-10 px-2 py-2",children:e.jsx("h3",{className:"text-xl font-bold",children:"Create Match"})}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 overflow-auto px-2",style:{maxHeight:"calc(100vh - 120px)"},children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:Ft,onChange:h=>vt(h.target.value),children:vn.map(h=>e.jsxs("option",{value:h,disabled:!t?.fullAccess&&zs.includes(h),children:[h," ",!t?.fullAccess&&zs.includes(h)?"(PREMIUM)":""]},h))})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:V,onChange:h=>K(h.target.value),children:[e.jsx("option",{value:"bestof",children:"Best Of"}),e.jsx("option",{value:"firstto",children:"First To"})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Value"}),Ft==="X01"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:[101,201,301,401,501].map(h=>e.jsx("button",{className:`btn px-2 py-1 text-xs ${ke===h?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>be(h),children:h},h))}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:ke,onChange:h=>be(parseInt(h.target.value||"1")),placeholder:"Or enter custom value"})]}):e.jsx("input",{className:"input w-full",type:"number",min:1,value:ke,onChange:h=>be(parseInt(h.target.value||"1"))}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Example: Best Of 5 â€” first to 3"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Starting Score"}),Ft==="X01"?e.jsx("select",{className:"input w-full",value:st,onChange:h=>nt(parseInt(h.target.value||"501")),children:[301,501,701].map(h=>e.jsx("option",{value:h,children:h},h))}):e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Starting score applies to X01 only"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Require Calibration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"calibreq",type:"checkbox",className:"accent-purple-500",checked:cs,onChange:h=>vs(h.target.checked)}),e.jsx("label",{htmlFor:"calibreq",className:"text-sm opacity-80",children:"Players must be calibrated"})]})]}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 border border-slate-700/40",children:[e.jsx("div",{className:"text-xs text-slate-300 uppercase tracking-wide mb-1",children:"Summary"}),e.jsxs("div",{className:"text-sm font-semibold",children:[Ft," â€” ",V==="bestof"?`Best Of ${ke}`:`First To ${ke}`," ",Ft==="X01"?`â€” ${st}`:""]}),!t?.fullAccess&&zs.includes(Ft)&&e.jsx("div",{className:"text-xs text-rose-300 mt-1",children:"PREMIUM required"})]})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-900/80 backdrop-blur border-t border-slate-700 z-10 px-2 py-2",children:[e.jsx("button",{className:"btn w-full",disabled:!t?.fullAccess&&zs.includes(Ft),title:!t?.fullAccess&&zs.includes(Ft)?"PREMIUM game":"",onClick:()=>{const h=t?.username?Ks(t.username):0;i?(i.send({type:"create-match",game:Ft,mode:V,value:ke,startingScore:st,creatorAvg:h,requireCalibration:cs}),B(!1),i.send({type:"list-matches"})):(N.current?.send(JSON.stringify({type:"create-match",game:Ft,mode:V,value:ke,startingScore:st,creatorAvg:h,requireCalibration:cs})),B(!1),N.current?.send(JSON.stringify({type:"list-matches"})))},children:"START GAME!"}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx("button",{className:"btn px-2 py-1",onClick:()=>B(!1),children:"Close"})})]})]})})}),Se&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(Ys,{storageKey:"ndn:modal:invite",className:"w-full relative",defaultWidth:620,defaultHeight:420,minWidth:520,minHeight:320,maxWidth:1e3,maxHeight:800,children:[e.jsx("h3",{className:"text-xl font-bold mb-1",children:"Incoming Match Request"}),e.jsxs("div",{className:"text-sm mb-2",children:[e.jsx("span",{className:"font-semibold",children:Se.fromName})," wants to join your match.",e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${Se.calibrated?"bg-emerald-500/20 text-emerald-300 border border-emerald-600/30":"bg-amber-500/20 text-amber-200 border border-amber-600/30"}`,children:Se.calibrated?"Calibrated":"Not calibrated"})]}),(Se.game||Se.mode)&&e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[Se.game||"X01"," Ã”Ã‡Ã³ ",Se.mode==="firstto"?`First To ${Se.value}`:`Best Of ${Se.value}`," ",Se.game==="X01"&&Se.startingScore?`Ã”Ã‡Ã³ ${Se.startingScore}`:""]}),Se.boardPreview?e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:Se.boardPreview,alt:"Board preview",className:"rounded-lg w-full max-h-64 object-contain bg-black/40 border border-slate-700"})}):e.jsx("div",{className:"mb-3 text-xs opacity-60",children:"No camera preview provided."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{i?i.send({type:"invite-response",matchId:Se.matchId,accept:!0,toId:Se.fromId}):N.current?.send(JSON.stringify({type:"invite-response",matchId:Se.matchId,accept:!0,toId:Se.fromId})),gt(null)},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>{i?i.send({type:"invite-response",matchId:Se.matchId,accept:!1,toId:Se.fromId}):N.current?.send(JSON.stringify({type:"invite-response",matchId:Se.matchId,accept:!1,toId:Se.fromId})),gt(null)},children:"Decline"})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(Ys,{storageKey:"ndn:modal:quick-chat",className:"w-full relative",defaultWidth:520,defaultHeight:280,minWidth:360,minHeight:220,maxWidth:900,maxHeight:700,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>x(!1),children:"Close"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["Good luck!","Good game!","Nice darts!","Well played!","Ready?"].map(h=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{ft(h),x(!1)},disabled:!o,children:h},h))})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(Ys,{storageKey:"ndn:modal:messages",className:"w-full relative",defaultWidth:560,defaultHeight:360,minWidth:380,minHeight:260,maxWidth:1e3,maxHeight:800,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>y(!1),children:"Close"})]}),e.jsx(Sm,{items:c.slice(-30).filter(h=>!n.isBlocked(String(h.fromId||""))).map((h,j)=>({key:String(j),from:h.from,id:String(h.fromId||h.from),text:h.message})),onDelete:h=>f(j=>j.filter((w,R)=>R!==h)),onReport:h=>{const w=c.slice(-30).filter(R=>!n.isBlocked(String(R.fromId||"")))[h];w&&Hn(null,w.message)},onBlock:h=>{const w=c.slice(-30).filter(R=>!n.isBlocked(String(R.fromId||"")))[h];if(w){try{n.block(String(w.fromId||w.from))}catch{}f(R=>R.filter(X=>String(X.fromId||X.from)!==String(w.fromId||w.from)));try{s(`${w.from} blocked`,{type:"info"})}catch{}}}})]})})]})}function Sm({items:t,onDelete:a,onReport:s,onBlock:i}){const n=(()=>{try{const c=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(c)}catch{return!1}})(),[r,l]=m.useState(null),[o,d]=m.useState(null);return e.jsx("div",{className:"h-24 overflow-auto text-sm divide-y divide-slate-700/40",children:t.length===0?e.jsx("div",{className:"opacity-60 py-1",children:"No messages yet."}):t.map((c,f)=>{const u=al(c.text),x=om(c.text);return e.jsxs("div",{className:"relative group px-1 py-1 flex items-start gap-2",onTouchStart:n?p=>{const y=p.touches[0];l({x:y.clientX,y:y.clientY,i:f,t:Date.now()})}:void 0,onTouchMove:n?p=>{if(!r||r.i!==f)return;p.touches[0].clientX-r.x<-40&&d(f)}:void 0,onTouchEnd:n?()=>{const p=r?Date.now()-r.t:0;(o===f||p>600)&&(a(f),d(null)),l(null)}:void 0,children:[e.jsxs("span",{className:"text-slate-400 shrink-0",children:["[",c.from,"]"]}),e.jsx("span",{className:"text-white break-words whitespace-pre-wrap flex-1",children:u}),!n&&e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 ml-2",children:[e.jsx("button",{className:"w-5 h-5 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center",title:"Delete message","aria-label":"Delete message",onClick:()=>a(f),children:"â”œÃ¹"}),i&&e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-slate-700 hover:bg-slate-800 text-slate-100 text-[11px]",onClick:()=>i(f),title:"Block sender",children:"Block"}),e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-amber-600/40 hover:bg-amber-600/60 text-amber-100 text-[11px]",onClick:()=>s(f),title:"Report message",children:"Report"})]}),x&&e.jsx("span",{className:"ml-2 text-[10px] px-1 rounded bg-rose-600/30 text-rose-200 border border-rose-600/40",children:"Filtered"})]},c.key)})})}function km({user:t}){const{players:a,inProgress:s,startingScore:i,newMatch:n}=Ln(),[r,l]=m.useState("x01"),[o,d]=m.useState("Player 1, Player 2"),[c,f]=m.useState(501),[u,x]=m.useState([]),[p,y]=m.useState(""),[C,D]=m.useState(!1),[T,N]=m.useState(""),[I,A]=m.useState([]),[M,k]=m.useState(!1),b=String(t?.email||"").toLowerCase();m.useEffect(()=>{let P=!1;async function H(){try{if(!b)return;const ae=await(await fetch(`/api/friends/list?email=${encodeURIComponent(b)}`)).json().catch(()=>({friends:[]}));P||x(ae.friends||[])}catch{}}H();const E=setInterval(H,2e4);return()=>{P=!0,clearInterval(E)}},[b]),m.useEffect(()=>{try{const P=b?`ndn:stats:opponent:${b}`:"ndn:stats:opponent",H=localStorage.getItem(P);H&&y(H)}catch{}},[b]),m.useEffect(()=>{try{const P=b?`ndn:stats:opponent:${b}`:"ndn:stats:opponent";p?localStorage.setItem(P,p):localStorage.removeItem(P)}catch{}},[p,b]);async function g(P){if(N(P),!P.trim()){A([]);return}k(!0);try{const E=await(await fetch(`/api/friends/search?q=${encodeURIComponent(P)}`)).json().catch(()=>({results:[]}));A(E.results||[])}finally{k(!1)}}const F=m.useMemo(()=>{const P=new Map;if(r==="x01")for(const E of a)for(const _ of E.legs)for(const ae of _.visits){const L=Math.max(0,Math.min(180,ae.score));P.set(L,(P.get(L)??0)+1)}const H=Array.from(P.entries()).sort((E,_)=>E[0]-_[0]);return H.length===0&&r==="x01"?([0,26,41,60,81,100,120,140,160,180].forEach(E=>P.set(E,0)),Array.from(P.entries()).sort((E,_)=>E[0]-_[0]).map(([E,_])=>({label:E,value:_}))):H.map(([E,_])=>({label:E,value:_}))},[a,r]),J=m.useMemo(()=>{const P=vr(vn);return vn.map(H=>{const E=P[H]||{played:0,won:0};return{label:H,value:E.played,extra:E.won}})},[r]);return m.useEffect(()=>{const P=()=>l(H=>H);return window.addEventListener("ndn:stats-updated",P),()=>window.removeEventListener("ndn:stats-updated",P)},[]),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Match Stats"}),e.jsx("span",{className:"text-xs opacity-70",children:"View"})]}),e.jsx(ua,{tabs:[{key:"x01",label:"X01"},{key:"other",label:"Other Modes"}],active:r,onChange:P=>l(P)})]}),a.length===0&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-2",children:"No match data yet"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Start a quick X01 match to generate stats. Stats like Best/Worst 3-dart are finalized when you end the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-300 mb-1",children:"Players (comma separated)"}),e.jsx("input",{className:"input w-full",value:o,onChange:P=>d(P.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-300 mb-1",children:"Starting Score"}),e.jsx("input",{className:"input w-full",type:"number",value:c,onChange:P=>f(parseInt(P.target.value||"501"))})]}),e.jsx("div",{children:e.jsx("button",{className:"btn w-full",onClick:()=>{const P=o.split(",").map(H=>H.trim()).filter(Boolean);if(!P.length)return alert("Enter at least one player");n(P,c)},children:"Start Match"})})]})]}),s&&e.jsx("div",{className:"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200",children:"Note: Detailed leg stats are finalized at the end of the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.map((P,H)=>e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:H===1&&!p?P.name||"Opponent":H===1&&p?p:P.name}),H===1&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10",onClick:()=>D(E=>!E),title:"Search user to compare",children:"Select Friend"}),u.slice(0,6).map(E=>{const _=E.username||E.email,ae=p===_;return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${ae?"bg-indigo-500/30 border-indigo-400/50":"bg-white/5 border-white/10 hover:bg-white/10"}`,onClick:()=>y(_),title:`Compare vs ${_}`,children:_},E.email)}),u.length===0&&e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10",disabled:!0,children:"Find friends to compare"})]})]}),H===1&&C&&e.jsxs("div",{className:"mb-2 p-2 rounded-lg bg-black/20 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1 py-1",placeholder:"Search by name or email",value:T,onChange:E=>g(E.target.value)}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>g(T),disabled:M,children:"Search"})]}),e.jsxs("ul",{className:"max-h-40 overflow-auto space-y-1",children:[I.map(E=>{const _=E.username||E.email;return e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm",onClick:()=>{y(_),D(!1)},children:_})},E.email)}),!I.length&&e.jsx("li",{className:"text-xs opacity-70",children:T.trim()?"No results":"Type to searchâ€¦"})]})]}),H===1&&p?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:mt(os(p).best3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:mt(os(p).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const E=os(p);return E.bestLegDarts?`${E.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:os(p).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",mt(Ks(p))," Â· ",mt(Da(p))]}),e.jsxs("span",{children:["First 9: ",mt(Ma(p))," Â· ",mt(Aa(p))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const E=os(p);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",mt(E.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",mt(E.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",E.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",E.bestCheckout||0]})]})})()]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:mt(P.bestThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:mt(P.worstThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:P.bestNineDart?`${P.bestNineDart.darts} darts`:"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:P.bestCheckout??"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",mt(Ks(P.name))," Â· ",mt(Da(P.name))]}),e.jsxs("span",{children:["First 9: ",mt(Ma(P.name))," Â· ",mt(Aa(P.name))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const E=os(P.name);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",mt(E.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",mt(E.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",E.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",E.bestCheckout||0]})]})})()]})]})]},P.id)),a.length<=1&&e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Opponent"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[u.slice(0,6).map(P=>{const H=P.username||P.email,E=p===(P.username||P.email);return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${E?"bg-indigo-500/30 border-indigo-400/50":"bg-white/5 border-white/10 hover:bg-white/10"}`,onClick:()=>y(H),title:`Compare vs ${H}`,children:H},P.email)}),u.length===0&&e.jsx("span",{className:"text-xs opacity-70",children:"Add friends to compare stats."})]})]}),p?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Comparing to"}),e.jsx("div",{className:"font-semibold",children:p})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:mt(Ks(p))})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:mt(os(p).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const P=os(p);return P.bestLegDarts?`${P.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:os(p).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",mt(Ks(p))," Â· ",mt(Da(p))]}),e.jsxs("span",{children:["First 9: ",mt(Ma(p))," Â· ",mt(Aa(p))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const P=os(p);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",mt(P.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",mt(P.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",P.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",P.bestCheckout||0]})]})})()]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Select a friend above to compare."})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Score Distribution (",r.toUpperCase(),"): Visits by scored points"]}),e.jsx("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:e.jsx(gr,{data:F,showValues:!1})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-2 text-sm opacity-80",children:"Other Modes: games played (bar height) with wins shown beneath each label"}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(gr,{data:J.map(P=>({label:P.label,value:P.value})),showValues:!1}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:J.map((P,H)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:P.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",P.value," Â· Won ",P.extra]})]},H))})]})]})]})}function Cm({user:t}){const a=jn(),s=(()=>{try{return kr()}catch{return null}})(),[i,n]=m.useState([]),[r,l]=m.useState(!1),[o,d]=m.useState(""),[c,f]=m.useState(null),[u,x]=m.useState(!1),[p,y]=m.useState({open:!1,t:null}),[C,D]=m.useState({open:!1,t:null}),[T,N]=m.useState({title:"Community X01 Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:15,capacity:8,startingScore:501}),I=(()=>{try{return"ontouchstart"in window||(navigator.maxTouchPoints||0)>0}catch{return!1}})();async function A(){try{const Q=await(await St("/api/tournaments")).json();n(Array.isArray(Q.tournaments)?Q.tournaments:[])}catch{}}m.useEffect(()=>{A()},[]),m.useEffect(()=>{if(!s)return;const L=s.addListener(Q=>{try{Q.type==="tournaments"&&n(Q.tournaments||[]),Q.type==="tournament-win"&&Q.message&&a(Q.message,{type:"success",timeout:1e4})}catch{}});return()=>{L()}},[s?.connected]);const M=String(t?.email||"").toLowerCase();m.useEffect(()=>{let L=!1;async function Q(){if(!M){f(null);return}try{const me=await(await St(`/api/subscription?email=${encodeURIComponent(M)}`)).json();L||(me?.source==="tournament"&&typeof me.expiresAt=="number"&&me.expiresAt>Date.now()?f(me.expiresAt):f(null))}catch{L||f(null)}}return Q(),()=>{L=!0}},[M]);function k(L){return!!L.participants?.some(Q=>Q.email===M)}async function b(L){M&&D({open:!0,t:L})}async function g(){const L=C.t;if(!(!L||!M)){D({open:!1,t:null}),l(!0);try{let Q=await St("/api/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:L.id,requesterEmail:M})});if(!Q.ok&&Q.status===403&&String(M)==="daviesfamily108@gmail.com"&&(Q=await St("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:L.id,requesterEmail:M})})),!Q.ok){let ce="Delete failed";try{const me=await Q.json();me?.error&&(ce=`Delete failed: ${String(me.error)}`)}catch{}a(ce,{type:"error"});return}a("Tournament deleted",{type:"success"}),await A()}finally{l(!1)}}}async function F(L){if(M){l(!0);try{const Q=await St("/api/tournaments/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:L.id,email:M,username:t?.username})});if(!Q.ok){let ce={};try{ce=await Q.json()}catch{}ce?.error==="WINNER_COOLDOWN"&&typeof ce.until=="number"?(d(`You're a recent NDN tournament winner. You can re-enter after ${ae(ce.until)}.`),setTimeout(()=>d(""),6e3),a("Join blocked: winner cooldown active",{type:"error"})):ce?.error==="ALREADY_IN_TOURNAMENT"?(d(String(ce.message||"You can only join one tournament at a time.")),setTimeout(()=>d(""),6e3),a("Join blocked: already in another tournament",{type:"error"})):ce?.error&&(d(String(ce.error)),setTimeout(()=>d(""),3500),a(`Join failed: ${String(ce.error)}`,{type:"error"}));return}a("Joined tournament",{type:"success"}),await A()}finally{l(!1)}}}async function J(L){if(M){l(!0);try{const Q=await St("/api/tournaments/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:L.id,email:M})});if(!Q.ok){let ce={};try{ce=await Q.json()}catch{}ce?.error?a(`Leave failed: ${String(ce.error)}`,{type:"error"}):Q.status===404?a("Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.",{type:"error"}):a("Leave failed. Please try again.",{type:"error"});return}a("Left tournament",{type:"success"}),n(ce=>ce.map(me=>me.id===L.id?{...me,participants:(me.participants||[]).filter(_e=>_e.email!==M)}:me)),await A()}finally{l(!1)}}}async function P(){l(!0);try{const L=new Date(T.startAt).getTime();await St("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:T.title,game:T.game,mode:T.mode,value:Number(T.value),description:T.description,startAt:L,checkinMinutes:Number(T.checkinMinutes),capacity:Number(T.capacity),startingScore:T.game==="X01"?Number(T.startingScore||501):void 0,creatorEmail:t?.email,creatorName:t?.username})}),x(!1),a("Tournament created",{type:"success"}),await A()}finally{l(!1)}}m.useEffect(()=>{if(!u)return;const L=Q=>{Q.key==="Escape"&&x(!1)};return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[u]);const H=m.useMemo(()=>i.filter(L=>L.official),[i]),E=m.useMemo(()=>i.filter(L=>!L.official),[i]),_=m.useMemo(()=>H.filter(Q=>Q.status==="scheduled").sort((Q,ce)=>Q.startAt-ce.startAt)[0]||null,[H]);function ae(L){return new Date(L).toLocaleString()}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Tournaments"})}),e.jsx("div",{className:"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end",children:e.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Create Tournament +"})}),e.jsx("div",{className:"mb-2 text-sm font-semibold text-slate-300",children:"World Lobby"}),_&&e.jsx("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm uppercase tracking-wide text-indigo-300 font-semibold",children:"Weekly Official Tournament"}),e.jsx("div",{className:"font-bold",children:_.title}),e.jsxs("div",{className:"text-sm opacity-80",children:[_.game,_.game==="X01"&&_.startingScore?`/${_.startingScore}`:""," Â· ",_.mode==="firstto"?"First to":"Best of"," ",_.value," Â· Starts ",ae(_.startAt)," Â· Cap ",_.capacity," Â· Joined ",_.participants.length]}),_.prize&&e.jsxs("div",{className:"text-xs mt-1",children:["Prize: ",_.prizeType==="cash"&&_.prizeAmount?`${_.currency||"USD"} ${_.prizeAmount}`:"3 months PREMIUM"]}),_.status!=="scheduled"&&e.jsxs("div",{className:"text-xs",children:["Status: ",_.status]}),c&&c>Date.now()&&e.jsxs("div",{className:"text-xs text-rose-300",children:["Recent winners can re-enter after ",ae(c),"."]})]}),e.jsx("div",{className:"shrink-0",children:e.jsx("button",{className:`btn ${k(_)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:k(_)?"Double-click to leave this tournament":_.official&&c&&c>Date.now()?`Recent winners can re-enter after ${ae(c)}`:"",disabled:r||_.status!=="scheduled"||!k(_)&&(_.participants.length>=_.capacity||!!c&&c>Date.now()),onClick:()=>{k(_)?I&&y({open:!0,t:_}):F(_)},onDoubleClick:()=>{!I&&k(_)&&y({open:!0,t:_})},"aria-label":k(_)?"Already Joined":"Join Now",children:k(_)?"Already Joined!":"Join Now"})})]})}),o&&e.jsx("div",{className:"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm",children:o}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("section",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Official"}),e.jsx("div",{className:"text-xs opacity-70 mb-2",children:c&&c>Date.now()?e.jsxs(e.Fragment,{children:["Youâ€™re a recent NDN tournament winner â€” to keep it fair, you can re-enter after ",ae(c),"."]}):e.jsx(e.Fragment,{children:"Note: Weekly winners can re-enter once their 3 months of PREMIUM ends."})}),e.jsxs("ul",{className:"space-y-2",children:[H.map(L=>e.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"font-semibold",children:[L.title," ",L.prize&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 align-middle",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-amber-500 text-black",children:"Prize"}),e.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help",title:L.prizeType==="cash"?"Official cash prize tournament â€” payout handled by admin.":"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.","aria-label":"Prize info",children:"i"})]})]}),e.jsxs("div",{className:"text-sm opacity-80",children:[L.game,L.game==="X01"&&L.startingScore?`/${L.startingScore}`:""," Â· ",L.mode==="firstto"?"First to":"Best of"," ",L.value," Â· ",ae(L.startAt)," Â· Cap ",L.capacity," Â· Joined ",L.participants.length]}),L.prize&&e.jsxs("div",{className:"text-xs",children:["Prize: ",L.prizeType==="cash"&&L.prizeAmount?`${L.currency||"USD"} ${L.prizeAmount}`:"3 months PREMIUM",L.status==="completed"&&L.prizeType==="cash"&&L.payoutStatus&&e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded ${L.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:L.payoutStatus==="paid"?"Paid":"Pending"})]}),L.status!=="scheduled"&&e.jsxs("div",{className:"text-xs",children:["Status: ",L.status]}),k(L)&&e.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"}),L.official&&c&&c>Date.now()&&e.jsxs("div",{className:"text-xs text-rose-300",children:["Cooldown active until ",ae(c),"."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`btn ${k(L)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:k(L)?"Double-click to leave this tournament":L.official&&c&&c>Date.now()?`Recent winners can re-enter after ${ae(c)}`:"",disabled:r||L.status!=="scheduled"||!k(L)&&(L.participants.length>=L.capacity||L.official&&!!c&&c>Date.now()),onClick:()=>{k(L)?I&&y({open:!0,t:L}):F(L)},onDoubleClick:()=>{!I&&k(L)&&y({open:!0,t:L})},"aria-label":k(L)?"Already Joined":"Join Now",children:k(L)?"Already Joined!":"Join Now"}),L.status==="scheduled"&&M&&L.creatorEmail&&String(L.creatorEmail).toLowerCase()===M&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>b(L),"aria-label":"Delete tournament",children:"Ã—"})]})]},L.id)),H.length===0&&e.jsx("li",{className:"text-sm opacity-60",children:"No official tournaments yet."})]})]}),e.jsxs("section",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Community"}),e.jsxs("ul",{className:"space-y-2",children:[E.map(L=>e.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-semibold",children:L.title}),e.jsxs("div",{className:"text-sm opacity-80",children:[L.game,L.game==="X01"&&L.startingScore?`/${L.startingScore}`:""," Â· ",L.mode==="firstto"?"First to":"Best of"," ",L.value," Â· ",ae(L.startAt)," Â· Cap ",L.capacity," Â· Joined ",L.participants.length]}),L.description&&e.jsx("div",{className:"text-xs opacity-80",children:L.description}),k(L)&&e.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",title:k(L)?"Double-click to leave this tournament":"",disabled:r||L.status!=="scheduled"||!k(L)&&L.participants.length>=L.capacity,onClick:()=>{k(L)?I&&y({open:!0,t:L}):F(L)},onDoubleClick:()=>{!I&&k(L)&&y({open:!0,t:L})},children:k(L)?"Already Joined":"Join Now"}),L.status==="scheduled"&&M&&L.creatorEmail&&String(L.creatorEmail).toLowerCase()===M&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>b(L),"aria-label":"Delete tournament",children:"Ã—"})]})]},L.id)),E.length===0&&e.jsx("li",{className:"text-sm opacity-60",children:"No community tournaments yet."})]})]})]}),u&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"card relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Create Tournament"}),e.jsx("button",{className:"btn",onClick:()=>x(!1),children:"Close"})]}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 pr-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Title"}),e.jsx("input",{className:"input w-full",value:T.title,onChange:L=>N(Q=>({...Q,title:L.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:T.game,onChange:L=>N(Q=>({...Q,game:L.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer"].map(L=>e.jsx("option",{value:L,children:L},L))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:T.mode,onChange:L=>N(Q=>({...Q,mode:L.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Number"}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:T.value,onChange:L=>N(Q=>({...Q,value:Number(L.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Description"}),e.jsx("textarea",{className:"input w-full",rows:5,value:T.description,onChange:L=>N(Q=>({...Q,description:L.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Start time"}),e.jsx("input",{className:"input w-full",type:"datetime-local",value:T.startAt,onChange:L=>N(Q=>({...Q,startAt:L.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Check-in reminder (min)"}),e.jsx("input",{className:"input w-full",type:"number",min:0,value:T.checkinMinutes,onChange:L=>N(Q=>({...Q,checkinMinutes:Number(L.target.value)}))})]})]}),T.game==="X01"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"X01 Starting Score"}),e.jsx("select",{className:"input w-full",value:String(T.startingScore),onChange:L=>N(Q=>({...Q,startingScore:Number(L.target.value)})),children:[301,501,701].map(L=>e.jsx("option",{value:L,children:L},L))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Capacity"}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,value:T.capacity,onChange:L=>N(Q=>({...Q,capacity:Number(L.target.value)}))})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Note: community tournaments do not award prizes."}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn",disabled:r,onClick:P,children:"Create"})})]})]})}),p.open&&p.t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>y({open:!1,t:null})}),e.jsxs("div",{className:"relative card p-4 w-[360px] max-w-[90vw]",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Leave tournament?"}),e.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Are you sure you want to remove yourself from â€œ",p.t.title,"â€?"]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>y({open:!1,t:null}),children:"Decline"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const L=p.t;y({open:!1,t:null}),await J(L)},children:"Accept"})]})]})]}),C.open&&C.t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold mb-4 text-white",children:"Delete Tournament"}),e.jsxs("div",{className:"text-slate-300 mb-6",children:["Are you sure you want to delete ",e.jsxs("span",{className:"font-semibold text-white",children:['"',C.t.title,'"']}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-sm text-slate-400",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",onClick:()=>D({open:!1,t:null}),children:"Decline"}),e.jsx("button",{className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",onClick:g,children:"Continue"})]})]})})})]})}function Em({user:t}){const[a,s]=m.useState(null),[i,n]=m.useState(!0),[r,l]=m.useState(null),o="http://localhost:8787",d=jn();if(m.useEffect(()=>{(async()=>{try{const u=t?.email?`?email=${encodeURIComponent(t.email)}`:"",x=await fetch(`${o}/api/subscription`+u);if(!x.ok)throw new Error("Failed to fetch subscription");const p=await x.json();s(p)}catch(u){l(u instanceof Error?u.message:"Something went wrong")}finally{n(!1)}})()},[t?.email]),i)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-4"}),e.jsx("p",{children:"Loading subscription..."})]})});if(r)return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-300 mb-2",children:"Subscription Error"}),e.jsx("p",{className:"mb-4 text-red-200",children:r}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn bg-red-600 hover:bg-red-700",children:"Retry"})]});const c=a?.fullAccess;return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-300 mb-2",children:c?"PREMIUM Active":"PREMIUM"}),c?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 text-green-300 font-semibold mb-2",children:"âœ… PREMIUM Access Active"}),e.jsx("p",{className:"text-green-200 text-sm",children:"You have full access to all premium features!"}),a?.source&&e.jsxs("p",{className:"text-green-200 text-xs mt-1",children:["Source: ",a.source,a?.expiresAt&&` (expires: ${new Date(a.expiresAt).toLocaleDateString()})`]})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-indigo-200",children:"Your Benefits:"})]}):e.jsx("p",{className:"mb-2 text-indigo-200",children:"Unlock every game mode known to darts, advanced stats, and premium features."}),e.jsxs("ul",{className:"mb-4",children:[e.jsx("li",{children:"All game modes (including paid/advanced)"}),e.jsx("li",{children:"Online play with all rules and variations"}),e.jsx("li",{children:"Advanced analytics and leaderboards"}),e.jsx("li",{children:"Premium camera modes and autoscoring"})]}),!c&&e.jsx("button",{onClick:async()=>{try{const u=await(await fetch(`${o}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})})).json();u.ok&&u.url?window.location.href=u.url:u.error==="STRIPE_NOT_CONFIGURED"?d("Premium purchases are not available. Payment link not configured.",{type:"error",timeout:4e3}):d("Failed to get payment link. Please try again.",{type:"error",timeout:4e3})}catch{d("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold shadow-lg hover:scale-105 transition",children:"Subscribe to PREMIUM"})]})}function Tm({open:t,onClose:a,width:s=700,title:i,footer:n,children:r,side:l="right"}){return m.useEffect(()=>{function o(d){d.key==="Escape"&&a()}return t&&document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t,a]),e.jsxs("div",{className:`fixed inset-0 z-50 ${t?"":"pointer-events-none"}`,"aria-hidden":!t,children:[e.jsx("div",{className:`absolute inset-0 bg-black/60 transition-opacity ${t?"opacity-100":"opacity-0"}`,onClick:a}),e.jsxs("div",{className:`absolute top-0 ${l==="right"?"right-0 border-l":"left-0 border-r"} h-full bg-slate-900 border-slate-700 shadow-2xl w-full sm:w-auto flex flex-col transition-transform duration-200 ${t?"translate-x-0":l==="right"?"translate-x-full":"-translate-x-full"}`,style:{width:typeof s=="number"?`${s}px`:s},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-700 sticky top-0 bg-slate-900 z-10",children:[e.jsx("div",{className:"text-lg font-semibold",children:i}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:a,children:"Close"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:r}),n&&e.jsx("div",{className:"px-4 py-3 border-t border-slate-700 sticky bottom-0 bg-slate-900 z-10",children:n})]})]})}function Im({user:t}){const a=yo(t?.email),[s,i]=m.useState(null),[n,r]=m.useState(""),[l,o]=m.useState("");async function d(){try{const u=await St("/readyz");i(await u.json())}catch{}}if(m.useEffect(()=>{d();const u=setInterval(d,5e3);return()=>clearInterval(u)},[]),!a)return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Ops"}),e.jsx("div",{children:"Restricted"})]});async function c(u){o("");try{const x=await St("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:u,requesterEmail:t?.email})}),p=await x.json();!x.ok||!p?.ok?o(p?.error||"Failed"):o(`Maintenance ${u?"enabled":"disabled"}`)}catch{o("Network error")}}async function f(){o("");const u=n.trim();if(u)try{const x=await St("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:u,requesterEmail:t?.email})}),p=await x.json();!x.ok||!p?.ok?o(p?.error||"Failed"):o("Announcement broadcasted"),r("")}catch{o("Network error")}}return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Ops"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Readiness"}),e.jsxs("div",{className:"text-sm",children:["HTTP: ",e.jsx("span",{className:`font-semibold ${s?.ok?"text-emerald-300":"text-rose-300"}`,children:String(!!s?.ok)})]}),e.jsxs("div",{className:"text-sm",children:["WS: ",e.jsx("span",{className:`font-semibold ${s?.ws?"text-emerald-300":"text-rose-300"}`,children:String(!!s?.ws)})]}),e.jsxs("div",{className:"text-sm",children:["Clients: ",e.jsx("span",{className:"font-semibold",children:s?.clients??0})]}),e.jsxs("div",{className:"text-sm",children:["Rooms: ",e.jsx("span",{className:"font-semibold",children:s?.rooms??0})]}),e.jsxs("div",{className:"text-sm",children:["Heap Used: ",e.jsxs("span",{className:"font-semibold",children:[s?.mem?Math.round(s.mem.heapUsed/1024/1024):0," MB"]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Maintenance"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>c(!0),children:"Enable"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>c(!1),children:"Disable"})]})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Announcement"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Message to broadcast",value:n,onChange:u=>r(u.target.value)}),e.jsx("button",{className:"btn",onClick:f,children:"Send"})]})]})]}),l&&e.jsx("div",{className:"text-xs mt-2",children:l}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"âœ… Clustering enabled! For 1.5k+ concurrent users, deploy behind a reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets. Set NODE_WORKERS environment variable to control worker count."})]})}function Mm({}){const[t,a]=m.useState(!1),[s,i]=m.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[n,r]=m.useState(""),l=c=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:c}})),a(!1)}catch(f){console.error("Navigation failed:",f)}},o=c=>{const f=c.toLowerCase();return f.includes("username")||f.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:f.includes("premium")||f.includes("upgrade")||f.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:f.includes("calibrat")||f.includes("camera")||f.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:f.includes("voice")||f.includes("caller")||f.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:f.includes("friend")||f.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:f.includes("stat")||f.includes("score")||f.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:f.includes("setting")||f.includes("customiz")||f.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:f.includes("tournament")||f.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:f.includes("help")||f.includes("support")||f.includes("faq")?{text:"You're already in the help section! Check Settings for more resources.",links:[{text:"Go to Settings > Support",tab:"settings"}]}:f.includes("how to play")||f.includes("game")||f.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},d=()=>{if(!n.trim())return;const c=n.toLowerCase();i(u=>[...u,{text:n,isUser:!0}]),r("");const f=o(c);setTimeout(()=>{i(u=>[...u,{text:f,isUser:!1}])},500)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-colors",title:"Help Assistant",children:e.jsx(co,{className:"w-6 h-6"})}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-end p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsxs("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-md h-96 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(aa,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"font-semibold",children:"Help Assistant"})]}),e.jsx("button",{onClick:()=>a(!1),className:"text-slate-400 hover:text-white",children:e.jsx(Vl,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:s.map((c,f)=>e.jsx("div",{className:`flex ${c.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${c.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof c.text=="string"?c.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:c.text.text}),c.text.links&&e.jsx("div",{className:"space-y-1",children:c.text.links.map((u,x)=>e.jsx("button",{onClick:()=>l(u.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:u.text},x))})]})})},f))}),e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:c=>r(c.target.value),onKeyPress:c=>c.key==="Enter"&&d(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:d,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(mo,{className:"w-4 h-4"})})]})})]})]})]})}function Dm(){const t=m.useRef(null),[a,s]=m.useState(""),[i,n]=m.useState(!1),[r,l]=m.useState(null),o=(()=>{try{return kr()}catch{return null}})(),[d,c]=m.useState("score"),[f,u]=m.useState(!1),[x,p]=m.useState(!1),[y,C]=m.useState(null),[D,T]=m.useState(0),{avgMode:N}=ls();m.useEffect(()=>{const M=localStorage.getItem("authToken");M&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${M}`}}).then(b=>b.json()).then(b=>{b?.user?(C(b.user),I(b.user)):localStorage.removeItem("authToken")}).catch(()=>{})},[]),m.useEffect(()=>{const M=()=>{try{localStorage.removeItem("mockUser"),localStorage.removeItem("authToken")}catch{}C(null),c("score")};return window.addEventListener("ndn:logout",M),()=>window.removeEventListener("ndn:logout",M)},[]),m.useEffect(()=>{if(!y?.username)return;const M=()=>T(N==="24h"?Tc(y.username):Ks(y.username));M();const k=()=>M();return window.addEventListener("ndn:stats-updated",k),()=>window.removeEventListener("ndn:stats-updated",k)},[y?.username,N]),m.useEffect(()=>{if(!y?.username){s("");return}const M=localStorage.getItem(`ndn:bio:profilePhoto:${y.username}`);s(M||"")},[y?.username]),m.useEffect(()=>{const M=F=>{F.key?.startsWith("ndn:bio:profilePhoto:")&&y?.username&&F.key.endsWith(y.username)&&s(F.newValue||"")},k=F=>{if(F.detail?.username===y?.username&&s(F.detail?.avatar||""),y?.username){const J=localStorage.getItem(`ndn:bio:profilePhoto:${y.username}`);s(J||"")}},b=()=>{if(!document.hidden&&y?.username){const F=localStorage.getItem(`ndn:bio:profilePhoto:${y.username}`);s(F||"")}},g=setInterval(()=>{if(y?.username){const F=localStorage.getItem(`ndn:bio:profilePhoto:${y.username}`);F&&F!==a&&s(F)}},2e3);return window.addEventListener("storage",M),window.addEventListener("ndn:avatar-updated",k),document.addEventListener("visibilitychange",b),()=>{window.removeEventListener("storage",M),window.removeEventListener("ndn:avatar-updated",k),document.removeEventListener("visibilitychange",b),clearInterval(g)}},[y?.username,a]),m.useEffect(()=>{const M=new URLSearchParams(window.location.search),k=M.get("paid"),b=M.get("username-change");if(k==="1"||k==="username-change"||b==="free"){const g=localStorage.getItem("pendingUsernameChange");g&&y?.email&&fetch("http://localhost:8787/api/change-username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:y.email,newUsername:g})}).then(J=>J.json()).then(J=>{J.ok?(alert("Username changed successfully!"),localStorage.removeItem("pendingUsernameChange"),J.token&&localStorage.setItem("authToken",J.token),J.user&&C(J.user),window.history.replaceState({},document.title,window.location.pathname)):alert("Failed to change username: "+(J.error||"Unknown error"))}).catch(()=>{alert("Network error while changing username")})}},[y?.email]),m.useEffect(()=>{new URLSearchParams(window.location.search).get("subscription")==="success"&&y?.email&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}).then(g=>g.json()).then(g=>{g?.user&&(C(g.user),alert("Premium subscription activated successfully!"),window.history.replaceState({},document.title,window.location.pathname))}).catch(()=>{alert("Subscription activated, but failed to refresh user data. Please refresh the page.")})},[y?.email]),m.useEffect(()=>{const M=()=>{const g=window.innerWidth,F=window.matchMedia("(max-width: 768px)").matches,J=window.matchMedia("(max-width: 1024px) and (min-width: 769px)").matches,P=/Mobi|Android|iPhone|iPad|iPod|Mobile|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent||""),H=/iPad|Android(?=.*\bMobile\b)|Tablet|PlayBook|Silk/i.test(navigator.userAgent||""),E="ontouchstart"in window||navigator.maxTouchPoints>0,_=g<769,ae=J&&E||H||g>=769&&g<=1024&&E,Q=F||P||_||g<769&&E||ae;u(Q)};M(),window.addEventListener("resize",M),window.addEventListener("orientationchange",M);const k=window.matchMedia("(max-width: 768px)"),b=window.matchMedia("(max-width: 1024px) and (min-width: 769px)");try{k.addEventListener("change",M),b.addEventListener("change",M)}catch{}return()=>{window.removeEventListener("resize",M),window.removeEventListener("orientationchange",M);try{k.removeEventListener("change",M),b.removeEventListener("change",M)}catch{}}},[]),m.useEffect(()=>{const M=()=>{try{localStorage.removeItem("ndn:avatar")}catch{}C(null),c("score")};return window.addEventListener("ndn:logout",M),()=>window.removeEventListener("ndn:logout",M)},[]),m.useEffect(()=>{const M=k=>{try{const b=String(k?.detail?.username||"").trim();if(!b)return;C(g=>g&&{...g,username:b});try{const g=(y?.email||"").toLowerCase();o&&b&&g&&o.send({type:"presence",username:b,email:g})}catch{}}catch{}};return window.addEventListener("ndn:username-changed",M),()=>window.removeEventListener("ndn:username-changed",M)},[o,y?.email]),m.useEffect(()=>{const M=k=>{try{const b=String(k?.detail?.tab||"").trim();b&&["score","offline","online","stats","settings","admin","tournaments","friends"].includes(b)&&c(b)}catch{}};return window.addEventListener("ndn:change-tab",M),()=>window.removeEventListener("ndn:change-tab",M)},[]);async function I(M){try{const k=M?.email?`?email=${encodeURIComponent(M.email)}`:"",b=await fetch("/api/subscription"+k);if(!b.ok)return;const g=await b.json();C({...M,fullAccess:!!g?.fullAccess})}catch{}}if(!y)return e.jsx(pm,{onAuth:M=>{C(M),I(M)}});const A=`https://ui-avatars.com/api/?name=${encodeURIComponent(y.username||"NDN")}&background=8F43EE&color=fff&bold=true&rounded=true&size=64`;return e.jsxs(gm,{children:[e.jsxs("div",{ref:t,className:`${y?.fullAccess?"premium-body":""} h-screen overflow-hidden p-1 xs:p-2 sm:p-3 md:p-4`,children:[e.jsx(dm,{}),e.jsxs("div",{className:"max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-[auto,1fr] gap-2 xs:gap-3 sm:gap-4 h-full overflow-hidden",children:[!f&&e.jsx("div",{className:"relative hidden lg:block",style:{width:240},children:e.jsx(No,{active:d,onChange:M=>{c(M)},user:y})}),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"pt-1 xs:pt-2",children:e.jsxs("header",{id:"ndn-header",className:"header glass flex-col xs:flex-col sm:flex-row gap-2 xs:gap-2 sm:gap-3",children:[e.jsx("div",{className:"flex items-center gap-2 order-1",children:e.jsx("h1",{className:"text-lg xs:text-xl sm:text-xl md:text-2xl font-bold text-brand-700 whitespace-nowrap cursor-pointer select-none",onClick:()=>{f&&c("score")},title:f?"Go Home":void 0,children:"NINE-DART-NATION ðŸŽ¯"})}),e.jsxs("div",{className:"order-3 xs:order-3 sm:order-2 w-full sm:w-auto flex-1 flex flex-col items-center justify-center text-center sm:text-left !text-black",children:[e.jsxs("span",{className:"text-sm xs:text-base sm:text-base md:text-lg font-semibold flex items-center gap-2 max-w-full truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[e.jsx("span",{className:"hidden xs:inline !text-black",children:"Welcome"}),e.jsx("img",{src:a||A,alt:"avatar",className:"w-5 h-5 xs:w-6 xs:h-6 sm:w-6 sm:h-6 md:w-7 md:h-7 rounded-full ring-2 ring-white/20"}),e.jsxs("span",{className:"truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[y.username,"ðŸŽ¯"]})]}),e.jsxs("span",{className:"hidden xs:inline text-xs xs:text-xs sm:text-xs md:text-sm !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:["All-time 3-dart avg: ",e.jsx("span",{className:"font-semibold !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:D.toFixed(2)})]}),f&&e.jsx("button",{className:"btn px-3 py-1 xs:px-3 xs:py-1 sm:px-3 sm:py-1 mt-1 text-sm xs:text-sm","aria-label":"Open navigation",onClick:()=>p(!0),children:"â˜° Menu"})]}),e.jsxs("div",{className:"order-2 md:order-3 ml-0 md:ml-auto flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"px-3 py-1 text-sm rounded-full bg-white/5 hover:bg-white/10 border border-white/10",onClick:()=>{const M=t.current;M&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):M.requestFullscreen().catch(()=>{}))},title:i?"Exit Full Screen":"Enter Full Screen",children:i?"Exit Full Screen":"Full Screen"}),d==="online"&&e.jsx("button",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40",title:"Open a simulated online match",onClick:()=>{setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch{}},40)},children:"ONLINE DEMO"}),o?e.jsx("span",{className:"ml-0 md:ml-2",children:e.jsx(vm,{status:o.status})}):null,r?.https?e.jsx("span",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/40",title:`Phone HTTPS active on :${r.port}`,children:"HTTPS READY"}):e.jsx("span",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-slate-600/30 text-slate-300 border border-slate-400/30",title:"Enable HTTPS for iPhone camera pairing",children:"HTTP ONLY"})]})]})}),f&&e.jsx(Am,{open:x,onClose:()=>p(!1),active:d,onChange:M=>{c(M),p(!1)},user:y}),e.jsxs("main",{id:"ndn-main-scroll",className:"space-y-4 flex-1 overflow-y-auto pr-1",children:[d==="settings"&&e.jsx(Is,{children:e.jsx(fm,{user:y})}),d==="score"&&e.jsx(Is,{children:e.jsx(Dc,{user:y})}),d==="online"&&e.jsx(Is,{children:e.jsx(wm,{user:y})}),d==="offline"&&e.jsx(Is,{children:e.jsx(am,{user:y})}),d==="calibrate"&&e.jsx(Is,{children:e.jsx(Od,{})}),d==="friends"&&e.jsx(Is,{children:e.jsx(cm,{user:y})}),d==="stats"&&e.jsx(Is,{children:e.jsx(km,{user:y})}),d==="tournaments"&&e.jsx(Is,{children:e.jsx(Cm,{user:y})}),d==="admin"&&e.jsx(Is,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(hm,{user:y}),e.jsx(Im,{user:y})]})}),d==="fullaccess"&&e.jsx(Is,{children:e.jsx(Em,{user:y})})]})]})]})]}),e.jsx(Mm,{})]})}function Am({open:t,onClose:a,active:s,onChange:i,user:n}){return e.jsx(Tm,{open:t,onClose:a,width:320,side:"left",title:"Navigate",children:e.jsx("div",{className:"mt-2",children:e.jsx(No,{active:s,onChange:i,user:n,className:"flex relative static max-h-[80vh] w-full"})})})}function Pm(t){return t.length>=10&&/\d/.test(t)&&/[^A-Za-z0-9]/.test(t)}function Rm(){const[t,a]=m.useState(""),[s,i]=m.useState(""),[n,r]=m.useState(""),[l,o]=m.useState(""),[d,c]=m.useState("");m.useEffect(()=>{try{const x=new URLSearchParams(window.location.search).get("token")||"";a(x)}catch{}},[]);async function f(u){if(u.preventDefault(),o(""),c(""),!t){o("Missing or invalid reset token.");return}if(!s||s!==n){o("Passwords do not match.");return}if(!Pm(s)){o("Password must be at least 10 chars and include a number and symbol.");return}try{const p=await(await fetch("/api/auth/confirm-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,newPassword:s})})).json();if(!p?.ok)throw new Error(p?.error||"Reset failed");c("Password changed. You can now sign in.")}catch(x){o(x?.message||"Reset failed")}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsx("div",{className:"relative z-10 w-full max-w-lg mx-auto p-4",children:e.jsxs("form",{className:"card w-full space-y-4",onSubmit:f,children:[e.jsx("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:e.jsx("h1",{className:"logo text-center",children:"Reset your password"})}),!t&&e.jsx("div",{className:"text-red-400",children:"This reset link is missing a token. Please use the link from your email."}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"New password",value:s,onChange:u=>i(u.target.value),required:!0}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"Confirm password",value:n,onChange:u=>r(u.target.value),required:!0}),l&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:l}),d&&e.jsx("div",{className:"text-emerald-400 font-semibold text-sm",children:d}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:!t,children:"Change Password"}),e.jsx("a",{className:"underline text-sm text-center",href:"/",children:"Back to sign in"})]})})]})}class Lm extends m.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,message:String(a?.message||a)}}componentDidCatch(a,s){console.error("[ErrorBoundary]",a,s)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"card max-w-lg w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"opacity-80 mb-4",children:"Please refresh the page. If this persists, let us know."}),this.state.message&&e.jsx("pre",{className:"text-xs bg-black/40 rounded p-2 overflow-auto text-left",children:this.state.message}),e.jsx("button",{className:"btn mt-4",onClick:()=>window.location.reload(),children:"Reload"})]})}):this.props.children}}try{window.React=window.React||{}}catch{}lc();Xl.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(Lm,{children:e.jsx(ym,{children:e.jsx(Om,{})})})}));function Om(){return window.location.pathname==="/reset"?e.jsx(Rm,{}):e.jsx(Dm,{})}
//# sourceMappingURL=index-RXpX39D2.js.map

{"version":3,"file":"OfflinePlay-COzAwYbj.js","sources":["../../src/utils/checkout.ts","../../src/components/GameCalibrationStatus.tsx","../../src/components/CameraTile.tsx","../../src/components/HeatMap.tsx","../../src/game/types.ts","../../src/game/aroundTheClock.ts","../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/game/ticTacToe.ts","../../src/game/scamFivesSevens.ts","../../src/game/americanCricket.ts","../../src/components/ui/GameHeaderBar.tsx","../../src/components/scoreboards/GameScoreboard.tsx","../../src/components/matchControlAdapters.ts","../../src/logic/matchActions.ts","../../src/components/scoreboards/useGameStats.ts","../../src/components/OfflinePlay.tsx"],"sourcesContent":["// Very lightweight checkout suggestions. For proper coverage consider a full table.\r\n// Returns up to a few route strings like \"T20 T20 D20\" for a given remaining.\r\n\r\nconst doubles = [\r\n  'D1','D2','D3','D4','D5','D6','D7','D8','D9','D10','D11','D12','D13','D14','D15','D16','D17','D18','D19','D20','DB'\r\n]\r\n\r\nfunction dVal(tag: string): number { if (tag === 'DB') return 50; const n = Number(tag.slice(1)); return n*2 }\r\n\r\nfunction prefsDoubleScore(fav: string): number {\r\n  if (!doubles.includes(fav)) return 32 // default D16\r\n  return dVal(fav)\r\n}\r\n\r\nexport function suggestCheckouts(remaining: number, favoriteDouble: string = 'D16'): string[] {\r\n  if (remaining > 170 || remaining <= 1) return []\r\n  // Simple known highest routes for popular numbers, then fall back to greedy towards favourite double\r\n  const hardcoded: Record<number, string[]> = {\r\n    170: ['T20 T20 DB'], 167: ['T20 T19 DB'], 164: ['T20 T18 DB'], 161: ['T20 T17 DB'], 160: ['T20 T20 D20'],\r\n    158: ['T20 T20 D19'], 157: ['T20 T19 D20'], 156: ['T20 T20 D18'], 155: ['T20 T19 D19'], 154: ['T20 T18 D20'],\r\n    153: ['T20 T19 D18'], 152: ['T20 T20 D16'], 151: ['T20 T17 D20'], 150: ['T20 T18 D18'], 149: ['T20 T19 D16'],\r\n    148: ['T20 T16 D20'], 147: ['T20 T17 D18'], 146: ['T20 T18 D16'], 145: ['T20 T15 D20'], 144: ['T20 T20 D12'],\r\n    141: ['T20 T19 D12'], 140: ['T20 T20 D10'], 137: ['T20 T19 D10'], 136: ['T20 T20 D8'], 132: ['BULL T14 D20','T20 T12 D8'],\r\n    130: ['T20 T20 D5','T20 T18 D8'], 129: ['T19 T16 D12'], 128: ['T18 T14 D16'], 127: ['T20 T17 D8'], 126: ['T19 T19 D6'],\r\n    121: ['T20 11 D20','T20 T15 D8'], 120: ['T20 20 D20','T20 S20 D20'], 110: ['T20 10 D20'], 100: ['T20 D20'], 99: ['T19 10 D16','T19 S10 D16'], 97: ['T19 D20'],\r\n    96: ['T20 D18'], 95: ['T19 D19'], 94: ['T18 D20'], 92: ['T20 D16'], 90: ['T18 D18','T20 D15'], 86: ['T18 D16'], 84: ['T20 D12','T16 D18'],\r\n    82: ['BULL D16','T14 D20'], 81: ['T19 D12'], 80: ['T20 D10','D20 D20'], 78: ['T18 D12'], 76: ['T20 D8','T16 D14'], 74: ['T14 D16','T18 D10'],\r\n    72: ['T16 D12','T20 D6'], 70: ['T18 D8','S20 BULL'], 68: ['T20 D4','T16 D10'], 66: ['T10 D18','T14 D12'], 64: ['T16 D8','D16 D16'],\r\n    62: ['T10 D16','T12 D13'], 60: ['20 D20','S20 D20'], 58: ['18 D20','S18 D20'], 56: ['16 D20','S16 D20'], 54: ['14 D20','S14 D20'],\r\n    52: ['20 D16','S20 D16'], 50: ['BULL','10 D20'], 48: ['16 D16','S16 D16'], 46: ['14 D16'], 44: ['12 D16'], 42: ['10 D16'],\r\n    40: ['D20'], 38: ['D19'], 36: ['D18'], 34: ['D17'], 32: ['D16'], 30: ['D15'], 28: ['D14'], 26: ['D13'], 24: ['D12'], 22: ['D11'], 20: ['D10'], 18: ['D9'], 16: ['D8'], 14: ['D7'], 12: ['D6'], 10: ['D5'], 8: ['D4'], 6: ['D3'], 4: ['D2'], 2: ['D1']\r\n  }\r\n  if (hardcoded[remaining]) return hardcoded[remaining]\r\n  // Greedy fallback: aim to leave favourite double if possible in two darts\r\n  const target = prefsDoubleScore(favoriteDouble)\r\n  const routes: string[] = []\r\n  // Try to hit a treble/big single that leaves the fav double\r\n  for (const t of [60, 57, 54, 51, 48]) { // T20..T16\r\n    const left = remaining - t\r\n    if (left === target) { routes.push(`T${t/3} ${favoriteDouble}`); break }\r\n  }\r\n  if (!routes.length) {\r\n    for (const s of [20, 19, 18, 17, 16, 15]) {\r\n      const left = remaining - s\r\n      if (left === target) { routes.push(`${s} ${favoriteDouble}`); break }\r\n    }\r\n  }\r\n  return routes\r\n}\r\n\r\nexport function sayScore(name: string, scored: number, remaining: number, voiceName?: string, opts?: { volume?: number; checkoutOnly?: boolean }) {\r\n  try {\r\n    const synth = window.speechSynthesis\r\n    if (!synth) return\r\n    const msg = new SpeechSynthesisUtterance()\r\n    const isCheckout = remaining <= 170 && remaining > 0\r\n    const isOneEighty = scored === 180\r\n    const shouldAnnounce = !opts?.checkoutOnly || isCheckout || isOneEighty\r\n    if (!shouldAnnounce) return\r\n\r\n    if (isOneEighty) {\r\n      msg.text = `${name}! One eighty!`\r\n      msg.rate = 1.04\r\n      msg.pitch = 1.15\r\n    } else if (isCheckout) {\r\n      msg.text = `${name}, ${remaining} remaining.`\r\n      msg.rate = 1.0\r\n      msg.pitch = 1.0\r\n    } else if (scored === 0) {\r\n      msg.text = `${name}, no score.`\r\n      msg.rate = 1.0\r\n      msg.pitch = 1.0\r\n    } else {\r\n      msg.text = `${name}, ${scored}.`\r\n      msg.rate = 1.0\r\n      msg.pitch = 1.0\r\n    }\r\n    if (voiceName) {\r\n      const v = synth.getVoices().find(v => v.name === voiceName)\r\n      if (v) msg.voice = v\r\n    }\r\n    if (typeof opts?.volume === 'number') msg.volume = Math.max(0, Math.min(1, opts.volume))\r\n    else msg.volume = 1\r\n    try { synth.cancel() } catch {}\r\n    synth.speak(msg)\r\n  } catch {}\r\n}\r\n","import React from 'react'\r\nimport { AlertTriangle, CheckCircle, AlertCircle, Zap } from 'lucide-react'\r\nimport { useCalibration } from '../store/calibration'\r\nimport {\r\n  getCalibrationConfidenceForGame,\r\n  isCalibrationSuitableForGame,\r\n  getCalibrationQualityText,\r\n  getRecalibrationRecommendation,\r\n  GAME_CALIBRATION_REQUIREMENTS\r\n} from '../utils/gameCalibrationRequirements'\r\n\r\ninterface GameCalibrationStatusProps {\r\n  gameMode: string\r\n  compact?: boolean // Show minimal version\r\n  onRecalibrate?: () => void // Optional callback for recalibrate button\r\n}\r\n\r\nexport default function GameCalibrationStatus({\r\n  gameMode,\r\n  compact = false,\r\n  onRecalibrate\r\n}: GameCalibrationStatusProps) {\r\n  const { H, errorPx } = useCalibration()\r\n\r\n  const confidence = getCalibrationConfidenceForGame(gameMode, errorPx)\r\n  const suitable = isCalibrationSuitableForGame(gameMode, errorPx)\r\n  const { quality, text } = getCalibrationQualityText(gameMode, errorPx)\r\n  const recommendation = getRecalibrationRecommendation(gameMode)\r\n  const requirement = GAME_CALIBRATION_REQUIREMENTS[gameMode]\r\n\r\n  // Not calibrated\r\n  if (!H || !errorPx) {\r\n    if (compact) {\r\n      return (\r\n        <div className=\"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30\">\r\n          <AlertTriangle className=\"w-3 h-3\" />\r\n          Not calibrated\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className=\"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2\">\r\n        <AlertTriangle className=\"w-4 h-4 text-red-400 flex-shrink-0\" />\r\n        <div className=\"flex-1\">\r\n          <div className=\"font-medium text-red-300\">Calibration Required</div>\r\n          <div className=\"text-xs opacity-80\">Please calibrate before playing {gameMode}</div>\r\n        </div>\r\n        {onRecalibrate && (\r\n          <button\r\n            className=\"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700\"\r\n            onClick={onRecalibrate}\r\n          >\r\n            Calibrate\r\n          </button>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Determine colors based on suitability\r\n  const bgColor = suitable\r\n    ? 'bg-emerald-500/20 border-emerald-600/30'\r\n    : 'bg-amber-500/20 border-amber-600/30'\r\n\r\n  const textColor = suitable ? 'text-emerald-300' : 'text-amber-300'\r\n  const icon = suitable ? CheckCircle : AlertTriangle\r\n\r\n  if (compact) {\r\n    return (\r\n      <div className={`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${bgColor} ${textColor}`}>\r\n        {React.createElement(icon, { className: 'w-3 h-3' })}\r\n        <span>{text}</span>\r\n        {!suitable && recommendation && (\r\n          <span className=\"w-3 h-3 cursor-help\" title={recommendation}>\r\n            <AlertCircle className=\"w-3 h-3 inline\" />\r\n          </span>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Full version\r\n  return (\r\n    <div className={`px-3 py-2 rounded border ${bgColor} space-y-1`}>\r\n      <div className=\"flex items-center gap-2\">\r\n        {React.createElement(icon, {\r\n          className: `w-4 h-4 ${suitable ? 'text-emerald-400' : 'text-amber-400'} flex-shrink-0`\r\n        })}\r\n        <div className=\"flex-1\">\r\n          <div className={`font-medium ${suitable ? 'text-emerald-300' : 'text-amber-300'}`}>\r\n            Calibration for {gameMode}\r\n          </div>\r\n          <div className=\"text-xs opacity-80\">Error: {Math.round(errorPx)}px | {text}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Confidence bar */}\r\n      <div className=\"flex items-center gap-2\">\r\n        <div className=\"flex-1 h-1.5 rounded bg-black/30 overflow-hidden\">\r\n          <div\r\n            className={`h-full transition-all ${\r\n              suitable ? 'bg-emerald-500' : 'bg-amber-500'\r\n            }`}\r\n            style={{ width: `${Math.min(100, confidence)}%` }}\r\n          />\r\n        </div>\r\n        <span className=\"text-xs font-mono\">{Math.round(confidence)}%</span>\r\n      </div>\r\n\r\n      {/* Requirements */}\r\n      {requirement && (\r\n        <div className=\"text-xs opacity-75\">\r\n          <div>Tolerance: Â±{requirement.tolerancePx}px | Min: {requirement.minConfidence}%</div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Warning and recommendation */}\r\n      <div className=\"space-y-1\">\r\n        {!suitable && (\r\n          <div className=\"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1\">\r\n            <AlertTriangle className=\"w-3 h-3 flex-shrink-0\" />\r\n            Calibration quality is below minimum for {gameMode}\r\n          </div>\r\n        )}\r\n\r\n        {recommendation && (\r\n          <div className=\"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1\">\r\n            <Zap className=\"w-3 h-3 flex-shrink-0\" />\r\n            {recommendation}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {!suitable && onRecalibrate && (\r\n        <button\r\n          className=\"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700\"\r\n          onClick={onRecalibrate}\r\n        >\r\n          Recalibrate for {gameMode}\r\n        </button>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","import { useCallback, useEffect, useMemo, useRef, useState, type CSSProperties } from 'react'\r\nimport { dlog } from '../utils/logger'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCameraSession, type CameraStreamMode } from '../store/cameraSession'\r\nimport { discoverNetworkDevices, connectToNetworkDevice, type NetworkDevice, discoverUSBDevices, requestUSBDevice, connectToUSBDevice, type USBDevice } from '../utils/networkDevices'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype CameraTileProps = {\r\n  label?: string\r\n  autoStart?: boolean\r\n  scale?: number\r\n  className?: string\r\n  aspect?: 'inherit' | 'wide' | 'square' | 'portrait' | 'classic' | 'free'\r\n  style?: CSSProperties\r\n  fill?: boolean\r\n  // Offline mode props\r\n  user?: any\r\n  playerScore?: number\r\n  aiScore?: number\r\n  x01Score?: number\r\n  inMatch?: boolean\r\n  showWinPopup?: boolean\r\n  pendingLegWinner?: \"player\" | \"ai\" | null\r\n  playerDartsThrown?: number\r\n  aiDartsThrown?: number\r\n  totalPlayerDarts?: number\r\n  totalAiDarts?: number\r\n  totalPlayerPoints?: number\r\n  totalAiPoints?: number\r\n  player180s?: number\r\n  player140s?: number\r\n  player100s?: number\r\n  ai180s?: number\r\n  ai140s?: number\r\n  ai100s?: number\r\n  playerHighestCheckout?: number\r\n  aiHighestCheckout?: number\r\n  onClose?: () => void\r\n  onOpen?: () => void\r\n  layout?: \"classic\" | \"modern\"\r\n}\r\n\r\nexport default function CameraTile({\r\n  label,\r\n  autoStart,\r\n  scale: scaleOverride,\r\n  className,\r\n  aspect = 'inherit',\r\n  style,\r\n  fill = false,\r\n}: CameraTileProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null)\r\n  const cameraSession = useCameraSession()\r\n  const [streaming, setStreaming] = useState(false)\r\n  const [ws, setWs] = useState<WebSocket | null>(null)\r\n  const [pairCode, setPairCode] = useState<string | null>(null)\r\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null)\r\n  const lastRegisteredModeRef = useRef<CameraStreamMode | null>(null)\r\n  const registerStream = useCallback((stream: MediaStream | null, modeOverride: CameraStreamMode = 'local') => {\r\n    try {\r\n      if (stream) {\r\n        cameraSession.setMediaStream(stream)\r\n        if (videoRef.current) {\r\n          cameraSession.setVideoElementRef(videoRef.current)\r\n        }\r\n        cameraSession.setMode(modeOverride)\r\n        cameraSession.setStreaming(true)\r\n        lastRegisteredModeRef.current = modeOverride\r\n      } else if (lastRegisteredModeRef.current && lastRegisteredModeRef.current !== 'phone') {\r\n        cameraSession.setStreaming(false)\r\n        cameraSession.setMediaStream(null)\r\n        lastRegisteredModeRef.current = null\r\n      }\r\n    } catch (err) {\r\n      console.warn('[CameraTile] Failed to register stream with camera session:', err)\r\n    }\r\n  }, [cameraSession])\r\n  \r\n  // Initialize mode: prioritize phone camera if preferred, otherwise use localStorage\r\n  const preferredCameraLabel = useUserSettings(s => s.preferredCameraLabel)\r\n  const [mode, setMode] = useState<'local'|'phone'|'wifi'>(() => {\r\n    // If phone camera is selected, start in phone mode\r\n    if (preferredCameraLabel === 'Phone Camera') {\r\n    dlog('[CAMERATILE] Initializing mode to phone (from preferred camera selection)')\r\n      return 'phone'\r\n    }\r\n    // Otherwise use saved mode or default to local\r\n    const saved = localStorage.getItem('ndn:camera:mode') as any\r\n  dlog('[CAMERATILE] Initializing mode to', saved || 'local', '(from localStorage)')\r\n    return saved || 'local'\r\n  })\r\n  \r\n  const [expiresAt, setExpiresAt] = useState<number | null>(null)\r\n  const [paired, setPaired] = useState<boolean>(false)\r\n  const [lanHost, setLanHost] = useState<string | null>(null)\r\n  const [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null)\r\n  const [showTips, setShowTips] = useState<boolean>(true)\r\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([])\r\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false)\r\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([])\r\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false)\r\n  const autoscoreProvider = useUserSettings(s => s.autoscoreProvider)\r\n  const cameraEnabledSetting = useUserSettings(s => s.cameraEnabled)\r\n  const setPreferredCameraLocked = useUserSettings(s => s.setPreferredCameraLocked)\r\n  const preferredCameraLocked = useUserSettings(s => s.preferredCameraLocked)\r\n  const setPreferredCamera = useUserSettings(s => s.setPreferredCamera)\r\n  const preferredCameraId = useUserSettings(s => s.preferredCameraId)\r\n\r\n  if (autoscoreProvider === 'manual') {\r\n    const fallbackBase = fill ? 'rounded-2xl overflow-hidden bg-black w-full flex flex-col' : 'rounded-2xl overflow-hidden bg-black w-full mx-auto'\r\n    const fallbackClass = [fallbackBase, className].filter(Boolean).join(' ').trim()\r\n    const fallbackStyle: CSSProperties = { ...(style || {}) }\r\n    if (!fill && fallbackStyle.aspectRatio === undefined && fallbackStyle.height === undefined && fallbackStyle.minHeight === undefined) {\r\n      fallbackStyle.aspectRatio = '4 / 3'\r\n    }\r\n    return (\r\n      <div className={fallbackClass} style={fallbackStyle}>\r\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\r\n          Manual scoring mode active â€” camera feeds are disabled.\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n  useEffect(() => {\r\n    const h = window.location.hostname\r\n    if (h === 'localhost' || h === '127.0.0.1') {\r\n      apiFetch(`/api/hosts`).then(r => r.json()).then(j => {\r\n        const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x)\r\n        if (ip) setLanHost(ip)\r\n      }).catch(()=>{})\r\n    }\r\n    // Detect HTTPS support for the phone link\r\n    apiFetch(`/api/https-info`).then(r=>r.json()).then(j=>{\r\n      if (j && typeof j.https === 'boolean') setHttpsInfo({ https: !!j.https, port: Number(j.port)||8788 })\r\n    }).catch(()=>{})\r\n  }, [])\r\n  const mobileUrl = useMemo(() => {\r\n    const code = pairCode || '____'\r\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    if (envUrl && envUrl.length > 0) {\r\n      try {\r\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\r\n        const u = new URL(envUrl)\r\n        const isSecure = u.protocol === 'wss:'\r\n        const origin = `${isSecure ? 'https' : 'http'}://${u.host}${u.pathname.endsWith('/ws') ? '' : u.pathname}`\r\n        const base = origin.replace(/\\/?ws$/i, '')\r\n        return `${base}/mobile-cam.html?code=${code}`\r\n      } catch {}\r\n    }\r\n    // Fallback to local development: prefer LAN host if detected\r\n    const host = (lanHost || window.location.hostname)\r\n    const useHttps = !!httpsInfo?.https\r\n    const port = useHttps ? (httpsInfo?.port || 8788) : 8787\r\n    const proto = useHttps ? 'https' : 'http'\r\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`\r\n  }, [pairCode, lanHost, httpsInfo])\r\n  useEffect(() => { \r\n  dlog('[CAMERATILE] Mode changed to:', mode, '- persisting to localStorage')\r\n    localStorage.setItem('ndn:camera:mode', mode) \r\n  }, [mode])\r\n  \r\n  const [manualModeSetAt, setManualModeSetAt] = useState<number | null>(null)\r\n  \r\n  // Sync phone camera selection from Calibrator into CameraTile mode state\r\n  // When user locks in phone camera in Calibrator, it updates preferredCameraLabel\r\n  // This effect ensures CameraTile's UI reflects that selection\r\n  useEffect(() => {\r\n    const ignore = useUserSettings.getState().ignorePreferredCameraSync\r\n  dlog('[CAMERATILE] Checking camera selection sync: preferredCameraLabel=', preferredCameraLabel, 'mode=', mode, 'ignoreSync=', ignore, 'manualModeSetAt=', manualModeSetAt)\r\n    if (ignore) return\r\n    // If user manually changed mode recently, avoid auto-syncing preferred camera\r\n    if (manualModeSetAt && Date.now() - manualModeSetAt < 30_000) return\r\n    if (preferredCameraLabel === 'Phone Camera' && mode !== 'phone') {\r\n  dlog('[CAMERATILE] Syncing mode to phone from Calibrator selection')\r\n      setMode('phone')\r\n    }\r\n  }, [preferredCameraLabel, mode, manualModeSetAt])\r\n  \r\n  // Intentionally disabled automatic regeneration of phone pairing codes.\r\n  // Codes will only be created when the user explicitly requests it (button click).\r\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\r\n\r\n  useEffect(() => {\r\n    if (!cameraEnabledSetting || (autoscoreProvider && autoscoreProvider !== 'built-in' && autoscoreProvider !== 'external-ws')) return\r\n    if (autoStart === undefined) return\r\n    if (autoStart) {\r\n      let cancelled = false\r\n      const desiredLabel = preferredCameraLabel || 'default'\r\n      const timer = window.setTimeout(() => {\r\n        if (cancelled || streaming) return\r\n        start().catch(err => console.warn(`[CameraTile] Auto-start failed for ${desiredLabel}:`, err))\r\n      }, 200)\r\n      return () => {\r\n        cancelled = true\r\n        window.clearTimeout(timer)\r\n      }\r\n    }\r\n    stop()\r\n  }, [autoStart, streaming, cameraEnabledSetting, autoscoreProvider, preferredCameraLabel, start, stop])\r\n\r\n  // If the user selected Phone Camera, bind the global stream into this tile\r\n  useEffect(() => {\r\n    const apply = async () => {\r\n      try {\r\n        const allowPhoneAttach = (preferredCameraLabel === 'Phone Camera' && (!manualModeSetAt || Date.now() - manualModeSetAt >= 30_000)) || mode === 'phone'\r\n        if (!allowPhoneAttach) return\r\n        const s = cameraSession.getMediaStream()\r\n        const v = videoRef.current\r\n        if (!v || !s) return\r\n        if (v.srcObject !== s) {\r\n          v.srcObject = s\r\n        }\r\n        v.muted = true\r\n        ;(v as any).playsInline = true\r\n        try { await v.play() } catch {}\r\n        setStreaming(true)\r\n      } catch {}\r\n    }\r\n    // Try immediately and poll briefly to catch late-arriving stream\r\n    apply()\r\n    const t = setInterval(apply, 800)\r\n    return () => clearInterval(t)\r\n  }, [preferredCameraLabel, mode, cameraSession, cameraSession.isStreaming])\r\n\r\n  async function start() {\r\n    dlog('[CameraTile] start() invoked with mode=', mode)\r\n    if (mode === 'wifi') {\r\n      return startWifiConnection()\r\n    }\r\n  dlog('[CameraTile] Attempting to attach global stream for phone mode...')\r\n\r\n    // If phone camera is selected and paired, don't try to start local camera\r\n    if (preferredCameraLabel === 'Phone Camera' || mode === 'phone') {\r\n      const s = cameraSession.getMediaStream()\r\n      if (s && videoRef.current) {\r\n        try {\r\n          videoRef.current.srcObject = s\r\n          await videoRef.current.play()\r\n          setStreaming(true)\r\n          return\r\n        } catch {}\r\n      }\r\n      // If no global stream yet, for phone mode we should attempt pairing\r\n      if (mode === 'phone') {\r\n        try { await startPhonePairing(); return } catch {}\r\n      }\r\n    }\r\n\r\n    try {\r\n      // Prefer saved camera if available\r\n      const { preferredCameraId, setPreferredCamera } = useUserSettings.getState()\r\n      const constraints: MediaStreamConstraints = preferredCameraId ? { video: { deviceId: { exact: preferredCameraId } }, audio: false } : { video: true, audio: false }\r\n      let stream: MediaStream\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints)\r\n      } catch (err: any) {\r\n        const name = (err && (err.name || err.code)) || ''\r\n        if (preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError')) {\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else {\r\n          throw err\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        registerStream(stream, 'local')\r\n      }\r\n      // Camera started successfully - no automatic preference updates\r\n    } catch {}\r\n  }\r\n  function stop() {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n      tracks.forEach(t => t.stop())\r\n      videoRef.current.srcObject = null\r\n      setStreaming(false)\r\n      registerStream(null)\r\n    }\r\n  }\r\n\r\n  async function startWifiConnection() {\r\n    setDiscoveringWifi(true)\r\n    try {\r\n      const devices = await discoverNetworkDevices()\r\n      setWifiDevices(devices)\r\n      if (devices.length === 0) {\r\n        alert('No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.')\r\n      }\r\n    } catch (error) {\r\n      console.error('Wifi device discovery failed:', error)\r\n      alert('Failed to discover wifi devices. Please check your network connection.')\r\n    } finally {\r\n      setDiscoveringWifi(false)\r\n    }\r\n  }\r\n\r\n  async function connectToWifiDevice(device: NetworkDevice) {\r\n    try {\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n\r\n      const stream = await connectToNetworkDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        registerStream(stream, 'wifi')\r\n        setWifiDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to wifi device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  async function startUsbConnection() {\r\n    setDiscoveringUsb(true)\r\n    try {\r\n      // First try to get already paired devices\r\n      const devices = await discoverUSBDevices()\r\n      setUsbDevices(devices)\r\n\r\n      // Then request user to select a new device\r\n      const newDevice = await requestUSBDevice()\r\n      if (newDevice) {\r\n        setUsbDevices(prev => [...prev, newDevice])\r\n      }\r\n\r\n      if (devices.length === 0 && !newDevice) {\r\n        alert('No USB scoring devices found. Please connect a device and try again.')\r\n      }\r\n    } catch (error) {\r\n      console.error('USB device discovery failed:', error)\r\n      alert('Failed to discover USB devices. Please check device connections.')\r\n    } finally {\r\n      setDiscoveringUsb(false)\r\n    }\r\n  }\r\n\r\n  async function connectToUsbDevice(device: USBDevice) {\r\n    try {\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n      const stream = await connectToUSBDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        setMode('wifi') // Using wifi mode for USB devices too\r\n        registerStream(stream, 'wifi')\r\n        setUsbDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to USB device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  // Listen for global event to start local camera from other UI components\r\n  const handleModeSelect = useCallback((newMode: 'local'|'phone'|'wifi'|'usb') => {\r\n    try {\r\n      setMode(newMode === 'usb' ? 'wifi' : newMode)\r\n      setManualModeSetAt(Date.now())\r\n      // Persist the user's selection and lock it to avoid auto-switching\r\n      try {\r\n        if (newMode === 'local') {\r\n          try { setPreferredCamera(preferredCameraId, 'Local', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        } else if (newMode === 'phone') {\r\n          try { setPreferredCamera(undefined, 'Phone Camera', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        } else if (newMode === 'wifi' || newMode === 'usb') {\r\n          try { setPreferredCamera(undefined, 'WiFi/USB', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        }\r\n      } catch {}\r\n      if (newMode === 'local') {\r\n        start().catch(() => {})\r\n      } else if (newMode === 'phone') {\r\n        startPhonePairing()\r\n      } else if (newMode === 'wifi') {\r\n        startWifiConnection()\r\n      } else if (newMode === 'usb') {\r\n        startUsbConnection()\r\n      }\r\n    } catch (err) { console.warn('[CameraTile] handleModeSelect failed', err) }\r\n  }, [start, startPhonePairing, startWifiConnection, startUsbConnection, setPreferredCamera, setPreferredCameraLocked, preferredCameraId])\r\n\r\n  useEffect(() => {\r\n    const onStart = (ev: any) => {\r\n      try {\r\n        const modeFromEvent = ev && ev.detail && ev.detail.mode\r\n        if (modeFromEvent && ['local', 'phone', 'wifi', 'usb'].includes(modeFromEvent)) {\r\n          // Respect explicit mode requests and treat as manual selection\r\n          handleModeSelect(modeFromEvent)\r\n          // Ensure start is invoked after selection is applied\r\n          start().catch(() => {})\r\n        } else {\r\n          // No explicit mode provided â€” just try to start current mode\r\n          start().catch(() => {})\r\n        }\r\n      } catch {}\r\n    }\r\n    window.addEventListener('ndn:start-camera' as any, onStart as any)\r\n    return () => { window.removeEventListener('ndn:start-camera' as any, onStart as any) }\r\n  }, [start, handleModeSelect])\r\n\r\n  // Phone pairing via WebRTC\r\n  function ensureWS() {\r\n    if (ws && ws.readyState === WebSocket.OPEN) return ws\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    const normalizedEnv = envUrl && envUrl.length > 0\r\n      ? (envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws')\r\n      : undefined\r\n    const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n    const sameOrigin = `${proto}://${window.location.host}/ws`\r\n    const host = window.location.hostname\r\n    const isLocalhost = host === 'localhost' || host === '127.0.0.1'\r\n    const isRenderHost = host.endsWith('onrender.com')\r\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\r\n    const renderWS = `wss://ninedartnation.onrender.com/ws`\r\n    let url = normalizedEnv\r\n    if (!url) {\r\n      if (isLocalhost) {\r\n        url = `${proto}://${host}:8787/ws`\r\n      } else if (isRenderHost) {\r\n        url = sameOrigin\r\n      } else {\r\n        url = renderWS\r\n      }\r\n    }\r\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\r\n    if (!url) url = sameOrigin\r\n    const socket = new WebSocket(url)\r\n    setWs(socket)\r\n    return socket\r\n  }\r\n  async function startPhonePairing() {\r\n    setMode('phone')\r\n    setPaired(false)\r\n    const socket = ensureWS()\r\n    if (socket.readyState === WebSocket.OPEN) {\r\n      socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      socket.onopen = () => socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    }\r\n    socket.onmessage = async (ev) => {\r\n      const data = JSON.parse(ev.data)\r\n      if (data.type === 'cam-code') {\r\n        setPairCode(data.code)\r\n        if (data.expiresAt) setExpiresAt(data.expiresAt)\r\n      } else if (data.type === 'cam-peer-joined') {\r\n        setPaired(true)\r\n        // Create offer to the phone\r\n        const peer = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] })\r\n        setPc(peer)\r\n        peer.onicecandidate = (e) => {\r\n          if (e.candidate && pairCode) socket.send(JSON.stringify({ type: 'cam-ice', code: pairCode, payload: e.candidate }))\r\n        }\r\n        peer.ontrack = (ev) => {\r\n          if (videoRef.current) {\r\n            const inbound = ev.streams?.[0]\r\n            if (inbound) {\r\n              videoRef.current.srcObject = inbound\r\n              videoRef.current.play().catch(()=>{})\r\n              setStreaming(true)\r\n            }\r\n          }\r\n        }\r\n        const offer = await peer.createOffer({ offerToReceiveAudio: false, offerToReceiveVideo: true })\r\n        await peer.setLocalDescription(offer)\r\n        if (pairCode) socket.send(JSON.stringify({ type: 'cam-offer', code: pairCode, payload: offer }))\r\n      } else if (data.type === 'cam-answer') {\r\n        if (pc) await pc.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n      } else if (data.type === 'cam-ice') {\r\n        if (pc) try { await pc.addIceCandidate(data.payload) } catch {}\r\n      }\r\n    }\r\n  }\r\n  function regenerateCode() {\r\n    setPairCode(null)\r\n    setExpiresAt(null)\r\n    setPaired(false)\r\n    if (ws && ws.readyState === WebSocket.OPEN) {\r\n      ws.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      startPhonePairing()\r\n    }\r\n    try { setPreferredCameraLocked(true) } catch {}\r\n  }\r\n\r\n  function stopAll() {\r\n    stop()\r\n    setPairCode(null)\r\n    setPaired(false)\r\n    setExpiresAt(null)\r\n    if (pc) { try { pc.close() } catch {}; setPc(null) }\r\n  }\r\n  return (\r\n  <CameraFrame \r\n      label={label} \r\n      autoStart={autoStart} \r\n      start={start} \r\n      stopAll={stopAll} \r\n      startPhonePairing={startPhonePairing} \r\n      startWifiConnection={startWifiConnection}\r\n      startUsbConnection={startUsbConnection}\r\n      connectToWifiDevice={connectToWifiDevice}\r\n      connectToUsbDevice={connectToUsbDevice}\r\n      videoRef={videoRef} \r\n      streaming={streaming} \r\n      mode={mode} \r\n      setMode={setMode} \r\n      pairCode={pairCode} \r\n      mobileUrl={mobileUrl} \r\n      regenerateCode={regenerateCode} \r\n      httpsInfo={httpsInfo} \r\n      showTips={showTips} \r\n      setShowTips={setShowTips} \r\n      wifiDevices={wifiDevices}\r\n      usbDevices={usbDevices}\r\n      discoveringWifi={discoveringWifi}\r\n      discoveringUsb={discoveringUsb}\r\n      scaleOverride={scaleOverride} \r\n      className={className}\r\n      aspect={aspect}\r\n      style={style}\r\n      fill={fill}\r\n        onModeSelect={handleModeSelect}\r\n      preferredCameraLocked={preferredCameraLocked}\r\n      />\r\n  )\r\n}\r\n\r\nfunction CameraFrame(props: any) {\r\n  const cameraSession = useCameraSession()\r\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings()\r\n  const {\r\n    label,\r\n    start,\r\n    stopAll,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n  startUsbConnection,\r\n    connectToWifiDevice,\r\n    connectToUsbDevice,\r\n    videoRef,\r\n    streaming,\r\n  mode,\r\n    setMode,\r\n  onModeSelect,\r\n    pairCode,\r\n    mobileUrl,\r\n    regenerateCode,\r\n    httpsInfo,\r\n    showTips,\r\n    setShowTips,\r\n    wifiDevices,\r\n    usbDevices,\r\n    discoveringWifi,\r\n    discoveringUsb,\r\n    className,\r\n    aspect,\r\n    style,\r\n    fill,\r\n  preferredCameraLocked,\r\n  } = props\r\n\r\n  const modeDisplayName: Record<string, string> = {\r\n    local: 'Local',\r\n    phone: 'PhoneCam',\r\n    wifi: 'Wi-Fi/USB',\r\n  }\r\n\r\n  const reconnectOptions = useMemo(() => {\r\n    return [\r\n      {\r\n        id: 'local',\r\n        title: 'Local camera',\r\n        description: 'Use the desktop webcam or capture card.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('local')\r\n          },\r\n      },\r\n      {\r\n        id: 'phone',\r\n        title: 'PhoneCam',\r\n        description: 'Stream from your phone via the mobile link.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('phone')\r\n          },\r\n      },\r\n      {\r\n        id: 'wifi',\r\n        title: 'Wi-Fi/USB',\r\n        description: 'Connect to scoring devices on your local network.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('wifi')\r\n          },\r\n      },\r\n      {\r\n        id: 'usb',\r\n        title: 'USB',\r\n        description: 'Connect a USB capture device (treated like WiFi mode).',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('usb')\r\n          },\r\n      },\r\n    ]\r\n  }, [setMode, start, startPhonePairing, startWifiConnection, startUsbConnection])\r\n\r\n  const [copyFeedback, setCopyFeedback] = useState<'link' | 'code' | null>(null)\r\n  const copyTimeoutRef = useRef<number | null>(null)\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n    }\r\n  }, [])\r\n\r\n  // Respect stored aspect unless we're explicitly in full-bleed fill mode,\r\n  // in which case drop the aspect box so the video can truly cover the area.\r\n  const { cameraFitMode: globalFitMode } = useUserSettings()\r\n  const effectiveFitMode: 'fit' | 'fill' = fill ? 'fill' : (globalFitMode || 'fill')\r\n  // In fill mode we guarantee no black bars: never allow downscaling below 1.0\r\n  const scale = (() => {\r\n    const raw = Number(props.scaleOverride ?? cameraScale ?? 1)\r\n    const clamped = Math.max(0.5, Math.min(1.25, raw))\r\n    return effectiveFitMode === 'fill' ? Math.max(1, clamped) : clamped\r\n  })()\r\n  const aspectChoice: 'wide' | 'square' | 'portrait' | 'classic' | 'free' = (fill && effectiveFitMode === 'fill')\r\n    ? 'free'\r\n    : (aspect && aspect !== 'inherit')\r\n      ? aspect\r\n      : ((storedAspect as any) || 'wide')\r\n\r\n  const shouldMaintainAspect = aspectChoice !== 'free'\r\n  const aspectClass = shouldMaintainAspect\r\n    ? aspectChoice === 'square'\r\n      ? 'aspect-square'\r\n      : aspectChoice === 'portrait'\r\n        ? 'aspect-[3/4]'\r\n        : aspectChoice === 'classic'\r\n          ? 'aspect-[4/3]'\r\n          : 'aspect-video'\r\n    : ''\r\n\r\n  const containerBase = fill\r\n    ? 'rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30'\r\n    : 'rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30'\r\n  const containerClass = [containerBase, className].filter(Boolean).join(' ').trim()\r\n  const containerStyle: CSSProperties = { ...(style || {}) }\r\n\r\n  const viewportClass = fill ? 'relative flex-1 min-h-[420px] bg-black' : 'relative w-full bg-black'\r\n\r\n  const commonVideoProps = {\r\n    style: { transform: `scale(${scale})`, transformOrigin: 'center' as const },\r\n  }\r\n\r\n  const usbActive = mode === 'wifi' && usbDevices.some((d: USBDevice) => d.status === 'online')\r\n\r\n  const videoElement = (() => {\r\n    // Apply Fit/Fill preference (fill prop hard-overrides to full-bleed)\r\n    const isFit = effectiveFitMode === 'fit'\r\n    const baseVideoClass = isFit\r\n      // Fit: preserve entire frame (may letterbox)\r\n      ? 'absolute inset-0 w-full h-full object-contain object-center bg-transparent'\r\n      // Fill: guarantee full coverage with object-cover so there are no black bars\r\n      : 'absolute inset-0 w-full h-full object-cover object-center bg-transparent'\r\n    if (fill) {\r\n      if (shouldMaintainAspect) {\r\n        return (\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div className={`relative w-full max-w-full max-h-full ${aspectClass}`}>\r\n              <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n      return <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n    }\r\n    if (shouldMaintainAspect) {\r\n      return (\r\n        <div className={`relative w-full ${aspectClass}`}>\r\n          <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n        </div>\r\n      )\r\n    }\r\n    return <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n  })()\r\n\r\n  async function copyValue(value: string | null | undefined, type: 'link' | 'code') {\r\n    if (!value) return\r\n    try {\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        await navigator.clipboard.writeText(value)\r\n      } else {\r\n        const textarea = document.createElement('textarea')\r\n        textarea.value = value\r\n        textarea.style.position = 'fixed'\r\n        textarea.style.opacity = '0'\r\n        document.body.appendChild(textarea)\r\n        textarea.focus()\r\n        textarea.select()\r\n        document.execCommand('copy')\r\n        document.body.removeChild(textarea)\r\n      }\r\n      setCopyFeedback(type)\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n      copyTimeoutRef.current = window.setTimeout(() => setCopyFeedback(null), 1500)\r\n    } catch (err) {\r\n      console.warn('Copy to clipboard failed:', err)\r\n      setCopyFeedback(null)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={containerClass} style={containerStyle}>\r\n      <div className={viewportClass}>\r\n        {videoElement}\r\n        {(cameraSession.isStreaming && (mode==='phone')) && (\r\n          <div className=\"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg\">\r\n            <span className=\"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse\" />\r\n            <span>REC</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n  <div className=\"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50\">\r\n  <span className=\"truncate font-medium\">{label || (streaming ? (mode==='phone' ? 'PHONE LIVE' : mode==='wifi' ? 'WIFI LIVE' : 'LIVE') : 'Camera')}{preferredCameraLocked && <span className=\"ml-2 text-xs opacity-80\">ðŸ”’</span>}</span>\r\n        <div className=\"flex items-center gap-2\">\r\n          {!streaming && (\r\n            <>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='local'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => onModeSelect('local')}>Local</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='phone'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => onModeSelect('phone')}>Phone</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='wifi'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => onModeSelect('wifi')}>WiFi</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='wifi'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => onModeSelect('usb')}>USB</button>\r\n            </>\r\n          )}\r\n          {streaming ? (\r\n            <button className=\"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all\" onClick={stopAll}>Stop</button>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n      {mode==='phone' && pairCode && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\r\n          <button\r\n            type=\"button\"\r\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\r\n            onClick={() => copyValue(mobileUrl, 'link')}\r\n            title=\"Copy mobile camera link\"\r\n          >\r\n            <span className=\"flex-1 min-w-0 font-mono break-all\">{mobileUrl}</span>\r\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'link' ? 'Copied!' : 'Copy'}</span>\r\n          </button>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <a\r\n              href={mobileUrl}\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\r\n            >\r\n              Open link\r\n            </a>\r\n            <button\r\n              type=\"button\"\r\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n              onClick={() => copyValue(pairCode, 'code')}\r\n              title=\"Copy pairing code\"\r\n            >\r\n              <span className=\"font-mono tracking-[0.3em] text-sm\">{pairCode}</span>\r\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'code' ? 'Copied!' : 'Copy'}</span>\r\n            </button>\r\n          </div>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <button className=\"px-1 py-0.5 rounded bg-slate-700\" onClick={regenerateCode}>Regenerate</button>\r\n          </div>\r\n          {showTips && (\r\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\r\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\r\n              <ul className=\"list-disc pl-4 space-y-1\">\r\n                <li>Phone and desktop must be on the same Wiâ€‘Fi network.</li>\r\n                <li>Allow the server through your firewall (ports 8787 and {httpsInfo?.https ? httpsInfo.port : 8788}).</li>\r\n                <li>On iPhone, use HTTPS links (QR will prefer https when enabled).</li>\r\n              </ul>\r\n              <div className=\"mt-2 text-right\"><button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={()=>setShowTips(false)}>Hide tips</button></div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      {mode==='wifi' && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\r\n          \r\n          {/* WiFi Devices */}\r\n          <div className=\"mb-3\">\r\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\r\n            {discoveringWifi ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning network...</span>\r\n              </div>\r\n            ) : wifiDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {wifiDevices.map((device: NetworkDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.ip}:{device.port}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToWifiDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Rescan WiFi</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Scan WiFi</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n\r\n          {/* USB Devices */}\r\n          <div>\r\n            <div className=\"font-medium mb-1\">USB Devices</div>\r\n            {discoveringUsb ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning USB...</span>\r\n              </div>\r\n            ) : usbDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {usbDevices.map((device: USBDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.type.toUpperCase()}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToUsbDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Rescan USB</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Scan USB</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {!streaming && (\r\n        <div className=\"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div>\r\n              <div className=\"text-[10px] uppercase tracking-wide text-slate-500\">Camera modes</div>\r\n              <div className=\"text-sm font-semibold text-slate-900\">Reconnect camera</div>\r\n            </div>\r\n            <span className=\"text-xs text-slate-500\">Current: {modeDisplayName[mode] || 'Local'}</span>\r\n          </div>\r\n          <p className=\"text-xs text-slate-500 mb-2\">Tap a mode to restart the feed or switch inputs.</p>\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {reconnectOptions.map(option => {\r\n              const isActive = option.id === 'usb'\r\n                ? usbActive\r\n                : option.id === mode\r\n              return (\r\n                <button\r\n                  key={option.id}\r\n                  type=\"button\"\r\n                  onClick={option.action}\r\n                  className={`text-left p-3 rounded-2xl border ${isActive ? 'border-emerald-500 bg-emerald-50 shadow' : 'border-slate-200 bg-white/80 hover:bg-slate-50'} transition`}\r\n                >\r\n                  <div className=\"text-xs font-semibold uppercase tracking-wide text-slate-500\">{option.title}</div>\r\n                  <div className=\"text-[11px] text-slate-600 mt-1\">{option.description}</div>\r\n                  {isActive && <div className=\"text-[10px] text-emerald-500 mt-2\">Active</div>}\r\n                </button>\r\n              )\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}","import React, { useEffect, useRef } from 'react'\r\nimport useHeatmapStore from '../store/heatmap'\r\nimport { BoardRadii } from '../utils/vision'\r\n\r\nfunction polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {\r\n  const a = (angleDeg - 90) * Math.PI / 180.0\r\n  return { x: cx + (r * Math.cos(a)), y: cy + (r * Math.sin(a)) }\r\n}\r\n\r\nfunction sectorAngle(sector: number) {\r\n  // SectorOrder puts 20 at top; 360/20 = 18deg per sector\r\n  const SectorOrder = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5]\r\n  const idx = SectorOrder.indexOf(sector)\r\n  const mid = (idx * 18) + 9 // middle of sector\r\n  return mid\r\n}\r\n\r\nexport default function HeatMap({ width = 320, height = 320 }: { width?: number; height?: number }) {\r\n  const samples = useHeatmapStore(s => s.samples)\r\n  const ref = useRef<HTMLCanvasElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    const c = ref.current\r\n    if (!c) return\r\n    const ctx = c.getContext('2d')\r\n    if (!ctx) return\r\n    c.width = width; c.height = height\r\n    ctx.clearRect(0,0,width,height)\r\n    // Draw a faint dartboard backdrop (rings)\r\n    const cx = width / 2\r\n    const cy = height / 2\r\n    const scale = Math.min(width, height) / (BoardRadii.doubleOuter * 2 + 20)\r\n    const radii = {\r\n      bullInner: BoardRadii.bullInner * scale,\r\n      bullOuter: BoardRadii.bullOuter * scale,\r\n      trebleInner: BoardRadii.trebleInner * scale,\r\n      trebleOuter: BoardRadii.trebleOuter * scale,\r\n      doubleInner: BoardRadii.doubleInner * scale,\r\n      doubleOuter: BoardRadii.doubleOuter * scale,\r\n    }\r\n    // rings\r\n    ctx.strokeStyle = 'rgba(255,255,255,0.06)'\r\n    ctx.lineWidth = 1\r\n    const ringOrder = ['doubleOuter','doubleInner','trebleOuter','trebleInner','bullOuter','bullInner'] as const\r\n    for (const k of ringOrder) {\r\n      ctx.beginPath(); ctx.arc(cx, cy, (radii as any)[k], 0, Math.PI*2); ctx.stroke();\r\n    }\r\n\r\n    // Aggregate sample weights by approximate xy\r\n    const points: { x:number;y:number;w:number }[] = []\r\n    for (const s of samples) {\r\n      // if sector unknown, scatter in board\r\n      let angle = Math.random() * 360\r\n      let r = Math.random() * radii.doubleOuter\r\n      if (typeof s.sector === 'number' && s.sector >= 1 && s.sector <= 20) {\r\n        angle = sectorAngle(s.sector)\r\n        // choose radius by mult/ring\r\n        if (s.ring === 'DOUBLE') r = (radii.doubleInner + radii.doubleOuter)/2\r\n        else if (s.ring === 'TRIPLE') r = (radii.trebleInner + radii.trebleOuter)/2\r\n        else if (s.ring === 'INNER_BULL') r = radii.bullInner * 0.5\r\n        else if (s.ring === 'BULL') r = radii.bullOuter * 0.8\r\n        else r = (radii.trebleOuter + radii.doubleInner)/2 * (0.6 + Math.random()*0.4)\r\n      }\r\n      const p = polarToCartesian(cx, cy, r, angle)\r\n      points.push({ x: p.x, y: p.y, w: 1 })\r\n    }\r\n\r\n    // Draw heat circles additive\r\n    for (const p of points) {\r\n      const grd = ctx.createRadialGradient(p.x, p.y, 1, p.x, p.y, 60)\r\n      grd.addColorStop(0, 'rgba(255,0,0,0.9)')\r\n      grd.addColorStop(0.3, 'rgba(255,100,0,0.5)')\r\n      grd.addColorStop(1, 'rgba(255,100,0,0)')\r\n      ctx.fillStyle = grd\r\n      ctx.beginPath(); ctx.arc(p.x, p.y, 60, 0, Math.PI*2); ctx.fill()\r\n    }\r\n\r\n    // Optionally overlay counts per sector\r\n    ctx.fillStyle = 'rgba(255,255,255,0.85)'\r\n    ctx.font = '12px ui-sans-serif'\r\n    // compute counts per sector\r\n    const sectorCounts: Record<number, number> = {}\r\n    for (const s of samples) if (s.sector) sectorCounts[s.sector] = (sectorCounts[s.sector] || 0) + 1\r\n    for (const secStr of Object.keys(sectorCounts)) {\r\n      const sec = Number(secStr)\r\n      const a = sectorAngle(sec)\r\n      const pos = polarToCartesian(cx, cy, radii.trebleOuter + 18, a)\r\n      ctx.fillText(String(sectorCounts[sec]), pos.x-6, pos.y+4)\r\n    }\r\n  }, [samples, width, height])\r\n\r\n  return <canvas ref={ref} style={{ width: '100%', height: 'auto', borderRadius: 8, background: '#081018' }} />\r\n}\r\n","export type DartMult = 'S' | 'D' | 'T'\r\nexport type Dart = { mult: DartMult; num: number } | { bull: 25 | 50 }\r\n\r\nexport type DoublePracticeState = {\r\n\ttargetIndex: number // 0..20 for D1..D20 then 21 for DBULL\r\n\tcompleted: boolean\r\n}\r\n\r\nexport const DOUBLE_PRACTICE_TARGETS: Array<{ label: string; score: number; isBull?: boolean }>[] = [] as any\r\n\r\nexport const DOUBLE_PRACTICE_ORDER: { label: string; score: number; isBull?: boolean }[] = [\r\n\t...Array.from({ length: 20 }, (_, i) => ({ label: `D${i + 1}` , score: (i + 1) * 2 })),\r\n\t{ label: 'DBULL', score: 50, isBull: true },\r\n]\r\n\r\nexport function isDoubleHit(value: number, targetIdx: number): boolean {\r\n\tconst t = DOUBLE_PRACTICE_ORDER[targetIdx]\r\n\treturn !!t && value === t.score\r\n}\r\n\r\nexport function parseManualDart(input: string): number | null {\r\n\tconst t = input.trim().toUpperCase()\r\n\tif (!t) return null\r\n\tif (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL') return 50\r\n\tif (t === '25' || t === 'OBULL') return 25\r\n\tconst m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n\tif (!m) return null\r\n\tconst mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n\tconst num = parseInt(m[2],10)\r\n\tif (num < 1 || num > 20) return null\r\n\tconst multVal = mult==='S'?1:mult==='D'?2:3\r\n\treturn num * multVal\r\n}\r\n\r\n// Parse a detailed dart string like \"T20\", \"D16\", \"S5\", \"25\", \"50\", \"BULL\", returning a structured Dart.\r\nexport function parseDartDetailed(input: string): Dart | null {\r\n\tconst t = input.trim().toUpperCase()\r\n\tif (!t) return null\r\n\tif (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL' || t === 'INNER BULL' || t === 'INNER_BULL') return { bull: 50 }\r\n\tif (t === '25' || t === 'OBULL' || t === 'OUTER BULL' || t === 'BULL25') return { bull: 25 }\r\n\tconst m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n\tif (!m) return null\r\n\tconst mult = (m[1] || 'S') as DartMult\r\n\tconst num = parseInt(m[2], 10)\r\n\tif (num < 1 || num > 20) return null\r\n\treturn { mult, num }\r\n}\r\n\r\n// Convert autoscore ring+sector data into a structured Dart\r\n// ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n// sector: 1..20 for numbered segments; null/undefined for bull/miss\r\nexport function ringSectorToDart(ring?: string, sector?: number | null): Dart | null {\r\n\tif (!ring || ring === 'MISS') return null\r\n\tif (ring === 'BULL') return { bull: 25 }\r\n\tif (ring === 'INNER_BULL') return { bull: 50 }\r\n\tif (typeof sector === 'number' && sector >= 1 && sector <= 20) {\r\n\t\tconst mult: DartMult = ring === 'DOUBLE' ? 'D' : ring === 'TRIPLE' ? 'T' : 'S'\r\n\t\treturn { mult, num: sector }\r\n\t}\r\n\treturn null\r\n}\r\n","export type ATCState = {\r\n\ttarget: number // 1..20 then 25 (outer bull) then 50 (inner)\r\n\tfinished: boolean\r\n}\r\n\r\nexport const ATC_ORDER: number[] = [\r\n\t...Array.from({ length: 20 }, (_, i) => i + 1),\r\n\t25,\r\n\t50,\r\n]\r\n\r\nexport function nextTarget(current: number): number | null {\r\n\tconst idx = ATC_ORDER.indexOf(current)\r\n\tif (idx < 0) return ATC_ORDER[0]\r\n\tif (idx >= ATC_ORDER.length - 1) return null\r\n\treturn ATC_ORDER[idx + 1]\r\n}\r\n\r\nexport function isCorrectHit(value: number, target: number): boolean {\r\n\treturn value === target\r\n}\r\n\r\n","export type CricketMark = 0 | 1 | 2 | 3\r\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25 // 25 is bull (outer+inner)\r\n\r\nexport type CricketState = {\r\n\t// marks per number\r\n\tmarks: Record<CricketNumber, CricketMark>\r\n\t// accumulated points when opponent hasn't closed a number\r\n\tpoints: number\r\n}\r\n\r\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25]\r\n\r\nexport function createCricketState(): CricketState {\r\n\tconst marks: any = {}\r\n\tCRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n\treturn { marks, points: 0 }\r\n}\r\n\r\n// Apply a single dart to a player's cricket state\r\n// Returns deltaPoints scored on this dart\r\nexport function applyCricketDart(state: CricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: CricketNumber) => boolean = () => false): number {\r\n\t// Map autoscore terms to logical hits\r\n\tlet num: CricketNumber | null = null\r\n\tlet hits = 0\r\n\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n\t\tnum = 25\r\n\t\thits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n\t} else if (typeof sector === 'number' && (sector as number) >= 15 && (sector as number) <= 20) {\r\n\t\tnum = sector as CricketNumber\r\n\t\tif (ring === 'TRIPLE') hits = 3\r\n\t\telse if (ring === 'DOUBLE') hits = 2\r\n\t\telse hits = 1\r\n\t} else if (value) {\r\n\t\t// Fallback when only numeric score provided (manual): infer by divisibility\r\n\t\tconst cand: CricketNumber[] = [20,19,18,17,16,15]\r\n\t\tfor (const c of cand) {\r\n\t\t\tif (value === c) { num = c; hits = 1; break }\r\n\t\t\tif (value === c*2) { num = c; hits = 2; break }\r\n\t\t\tif (value === c*3) { num = c; hits = 3; break }\r\n\t\t}\r\n\t\tif (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n\t}\r\n\tif (!num) return 0\r\n\r\n\tconst before = state.marks[num]\r\n\tlet remainToClose = Math.max(0, 3 - before)\r\n\tconst toApply = Math.min(remainToClose, hits)\r\n\tconst overflow = Math.max(0, hits - toApply)\r\n\t// Increase marks up to 3\r\n\tconst after = (before + toApply) as CricketMark\r\n\tstate.marks[num] = after > 3 ? 3 : after\r\n\r\n\t// Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\r\n\tlet points = 0\r\n\tif (overflow > 0 && !opponentClosed(num)) {\r\n\t\tif (num === 25) {\r\n\t\t\t// Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\r\n\t\t\tif (ring === 'INNER_BULL') points += 50 * overflow\r\n\t\t\telse points += 25 * overflow\r\n\t\t} else {\r\n\t\t\tpoints += num * overflow\r\n\t\t}\r\n\t}\r\n\r\n\tstate.points += points\r\n\treturn points\r\n}\r\n\r\nexport function hasClosedAll(state: CricketState): boolean {\r\n\treturn CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n\r\nexport function cricketWinner(self: CricketState, opponents: CricketState[]): boolean {\r\n\t// Win when all closed and you have >= opponents' points\r\n\tif (!hasClosedAll(self)) return false\r\n\tconst maxOppPoints = Math.max(0, ...opponents.map(o => o.points))\r\n\treturn self.points >= maxOppPoints\r\n}\r\n","export type ShanghaiRound = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20\r\n\r\nexport type ShanghaiState = {\r\n\tround: ShanghaiRound\r\n\tscore: number\r\n\tfinished: boolean\r\n\tshanghaiAchieved: boolean // single+double+triple of target in same 3-dart turn\r\n\tturnHits: { singles: number; doubles: number; triples: number }\r\n}\r\n\r\nexport function createShanghaiState(): ShanghaiState {\r\n\treturn { round: 1, score: 0, finished: false, shanghaiAchieved: false, turnHits: { singles: 0, doubles: 0, triples: 0 } }\r\n}\r\n\r\nexport function getRoundTarget(state: ShanghaiState): number { return state.round }\r\n\r\n// Apply one dart; returns points scored on this dart\r\nexport function applyShanghaiDart(state: ShanghaiState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst target = getRoundTarget(state)\r\n\tlet points = 0\r\n\tif (typeof sector === 'number' && sector === target) {\r\n\t\tif (ring === 'TRIPLE') { points = target * 3; state.turnHits.triples++ }\r\n\t\telse if (ring === 'DOUBLE') { points = target * 2; state.turnHits.doubles++ }\r\n\t\telse if (ring === 'SINGLE') { points = target * 1; state.turnHits.singles++ }\r\n\t} else if (!sector && (value === target || value === target*2 || value === target*3)) {\r\n\t\t// manual numeric entry fallback\r\n\t\tif (value === target*3) { points = target*3; state.turnHits.triples++ }\r\n\t\telse if (value === target*2) { points = target*2; state.turnHits.doubles++ }\r\n\t\telse if (value === target) { points = target; state.turnHits.singles++ }\r\n\t}\r\n\tstate.score += points\r\n\treturn points\r\n}\r\n\r\n// Call at end of 3-dart turn; advances round and checks Shanghai\r\nexport function endShanghaiTurn(state: ShanghaiState) {\r\n\tif (!state.finished) {\r\n\t\tif (state.turnHits.singles>0 && state.turnHits.doubles>0 && state.turnHits.triples>0) {\r\n\t\t\tstate.shanghaiAchieved = true\r\n\t\t\tstate.finished = true\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst next = (state.round + 1) as ShanghaiRound\r\n\t\tif (next > 20) { state.finished = true } else { state.round = next }\r\n\t}\r\n\t// reset per-turn hits\r\n\tstate.turnHits = { singles: 0, doubles: 0, triples: 0 }\r\n}\r\n","export type HalveItTarget =\r\n\t| { kind: 'ANY_NUMBER' }\r\n\t| { kind: 'DOUBLE'; num: number }\r\n\t| { kind: 'TRIPLE'; num: number }\r\n\t| { kind: 'BULL' }\r\n\t| { kind: 'NUMBER'; num: number }\r\n\r\nexport type HalveItState = {\r\n\tstage: number\r\n\ttargets: HalveItTarget[]\r\n\tscore: number\r\n\tfinished: boolean\r\n\thitThisRound: boolean\r\n}\r\n\r\nexport function createDefaultHalveIt(): HalveItState {\r\n\tconst targets: HalveItTarget[] = [\r\n\t\t{ kind: 'NUMBER', num: 20 },\r\n\t\t{ kind: 'DOUBLE', num: 16 },\r\n\t\t{ kind: 'TRIPLE', num: 14 },\r\n\t\t{ kind: 'NUMBER', num: 19 },\r\n\t\t{ kind: 'BULL' },\r\n\t\t{ kind: 'ANY_NUMBER' },\r\n\t]\r\n\treturn { stage: 0, targets, score: 0, finished: false, hitThisRound: false }\r\n}\r\n\r\nexport function getCurrentHalveTarget(state: HalveItState): HalveItTarget | null {\r\n\treturn state.targets[state.stage] || null\r\n}\r\n\r\nexport function applyHalveItDart(state: HalveItState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst t = getCurrentHalveTarget(state)\r\n\tif (!t) return 0\r\n\tlet scored = 0\r\n\tswitch (t.kind) {\r\n\t\tcase 'NUMBER': {\r\n\t\t\tif (typeof sector === 'number' && sector === t.num) {\r\n\t\t\t\tif (ring === 'TRIPLE') scored = t.num * 3\r\n\t\t\t\telse if (ring === 'DOUBLE') scored = t.num * 2\r\n\t\t\t\telse if (ring === 'SINGLE') scored = t.num\r\n\t\t\t} else if (!sector && (value === t.num || value === t.num*2 || value === t.num*3)) {\r\n\t\t\t\tscored = value\r\n\t\t\t}\r\n\t\t\tif (scored > 0) state.hitThisRound = true\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'DOUBLE': {\r\n\t\t\tif ((ring === 'DOUBLE' && sector === t.num) || value === t.num*2) { scored = t.num*2; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'TRIPLE': {\r\n\t\t\tif ((ring === 'TRIPLE' && sector === t.num) || value === t.num*3) { scored = t.num*3; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'BULL': {\r\n\t\t\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) { scored = (ring === 'INNER_BULL' || value === 50) ? 50 : 25; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'ANY_NUMBER': {\r\n\t\t\t// any valid score counts\r\n\t\t\tif (value > 0) { scored = value; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHalveItTurn(state: HalveItState) {\r\n\tif (state.finished) return\r\n\tif (!state.hitThisRound) {\r\n\t\tstate.score = Math.floor(state.score / 2)\r\n\t}\r\n\tstate.hitThisRound = false\r\n\tstate.stage += 1\r\n\tif (state.stage >= state.targets.length) state.finished = true\r\n}\r\n","export type HighLowState = {\r\n\tround: number\r\n\tscore: number\r\n\ttarget: 'HIGH' | 'LOW'\r\n\tfinished: boolean\r\n}\r\n\r\nexport function createHighLow(): HighLowState {\r\n\treturn { round: 1, score: 0, target: 'HIGH', finished: false }\r\n}\r\n\r\nexport function applyHighLowDart(state: HighLowState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\t// For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\r\n\t// When LOW, count only scores <= 10 (any ring) and bull does not count\r\n\tlet scored = 0\r\n\tif (state.target === 'HIGH') {\r\n\t\tif (ring === 'INNER_BULL') scored = 50\r\n\t\telse if (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector >= 20) scored = v\r\n\t\t} else {\r\n\t\t\t// manual numeric fallback\r\n\t\t\tif (value >= 40) scored = value\r\n\t\t}\r\n\t} else {\r\n\t\tif (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector <= 10) scored = v\r\n\t\t} else {\r\n\t\t\tif (value > 0 && value <= 30) scored = value\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHighLowTurn(state: HighLowState) {\r\n\tif (state.finished) return\r\n\tstate.round += 1\r\n\tif (state.round > 10) { state.finished = true; return }\r\n\tstate.target = state.target === 'HIGH' ? 'LOW' : 'HIGH'\r\n}\r\n","export type KillerState = {\r\n  number: number // assigned sector 1..20\r\n  lives: number // start with 3\r\n  isKiller: boolean // became killer by hitting own double\r\n  eliminated: boolean\r\n}\r\n\r\nexport function createKillerState(assigned: number, lives = 3): KillerState {\r\n  return { number: assigned, lives, isKiller: false, eliminated: false }\r\n}\r\n\r\n// Assign unique random numbers (1..20) to each player id\r\nexport function assignKillerNumbers<T extends string>(playerIds: T[]): Record<T, number> {\r\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1)\r\n  const res: any = {}\r\n  for (const id of playerIds) {\r\n    // pick a random remaining number\r\n    const idx = Math.floor(Math.random() * pool.length)\r\n    const num = pool.splice(idx, 1)[0]\r\n    res[id] = num\r\n  }\r\n  return res\r\n}\r\n\r\n// Apply a single dart in Killer context.\r\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\r\nexport function applyKillerDart(\r\n  selfId: string,\r\n  states: Record<string, KillerState>,\r\n  ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL',\r\n  sector?: number | null\r\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\r\n  const me = states[selfId]\r\n  if (!me || !sector || !ring) return { becameKiller: false }\r\n  // Becoming killer: hit your own DOUBLE only\r\n  if (!me.isKiller && ring === 'DOUBLE' && sector === me.number) {\r\n    me.isKiller = true\r\n    return { becameKiller: true }\r\n  }\r\n  // If already killer, hitting opponents' doubles/triples removes lives\r\n  if (me.isKiller && (ring === 'DOUBLE' || ring === 'TRIPLE')) {\r\n    const victimId = Object.keys(states).find(pid => pid !== selfId && !states[pid].eliminated && states[pid].number === sector)\r\n    if (victimId) {\r\n      const victim = states[victimId]\r\n      const delta = ring === 'TRIPLE' ? 2 : 1\r\n      victim.lives = Math.max(0, victim.lives - delta)\r\n      if (victim.lives === 0) victim.eliminated = true\r\n      return { becameKiller: false, victimId, livesRemoved: delta }\r\n    }\r\n  }\r\n  return { becameKiller: false }\r\n}\r\n\r\nexport function killerWinner(states: Record<string, KillerState>): string | null {\r\n  const alive = Object.entries(states).filter(([,st]) => !st.eliminated && st.lives > 0)\r\n  if (alive.length === 1) return alive[0][0]\r\n  return null\r\n}\r\n","export type BaseballInning = 1|2|3|4|5|6|7|8|9\r\n\r\nexport type BaseballState = {\r\n  inning: BaseballInning\r\n  score: number\r\n  dartsThisInning: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createBaseball(): BaseballState {\r\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false }\r\n}\r\n\r\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\r\nexport function applyBaseballDart(state: BaseballState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): number {\r\n  if (state.finished) return 0\r\n  let runs = 0\r\n  if (typeof sector === 'number' && sector === state.inning) {\r\n    if (ring === 'TRIPLE') runs = 3\r\n    else if (ring === 'DOUBLE') runs = 2\r\n    else runs = 1\r\n  } else if (!sector && (value === state.inning || value === state.inning*2 || value === state.inning*3)) {\r\n    runs = value === state.inning*3 ? 3 : value === state.inning*2 ? 2 : 1\r\n  }\r\n  state.score += runs\r\n  state.dartsThisInning += 1\r\n  if (state.dartsThisInning >= 3) {\r\n    const next = (state.inning + 1) as BaseballInning\r\n    if (next > 9) state.finished = true\r\n    else { state.inning = next; state.dartsThisInning = 0 }\r\n  }\r\n  return runs\r\n}\r\n","export type GolfHole = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18\r\n\r\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\r\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\r\n\r\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\r\n  1: 5, 2: 20, 3: 1, 4: 18, 5: 4, 6: 13, 7: 6, 8: 10, 9: 15,\r\n  10: 2, 11: 17, 12: 3, 13: 19, 14: 7, 15: 16, 16: 8, 17: 11, 18: 14,\r\n}\r\n\r\nexport type GolfState = {\r\n  hole: GolfHole\r\n  strokes: number\r\n  dartsThisHole: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createGolf(): GolfState {\r\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false }\r\n}\r\n\r\nexport function applyGolfDart(state: GolfState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): boolean {\r\n  if (state.finished) return false\r\n  const target = GOLF_TARGETS[state.hole]\r\n  state.dartsThisHole += 1\r\n  const hit = (typeof sector === 'number' && sector === target && (ring==='SINGLE'||ring==='DOUBLE'||ring==='TRIPLE')) || (!sector && (value===target || value===target*2 || value===target*3))\r\n  if (hit) {\r\n    state.strokes += state.dartsThisHole\r\n    // advance to next hole\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n    return true\r\n  }\r\n  // If not finished and took 3 darts, score 3 and advance hole\r\n  if (state.dartsThisHole >= 3) {\r\n    state.strokes += 3\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n  }\r\n  return false\r\n}\r\n","export type TicCell = 0|1|2|3|4|5|6|7|8\r\n\r\n// Map grid cells to targets: center uses Bull; edges/corners use numbers.\r\nexport const TTT_TARGETS: Record<TicCell, { type: 'NUM'|'BULL'; num?: number }> = {\r\n  0: { type: 'NUM', num: 20 }, 1: { type: 'NUM', num: 19 }, 2: { type: 'NUM', num: 18 },\r\n  3: { type: 'NUM', num: 17 }, 4: { type: 'BULL' }, 5: { type: 'NUM', num: 16 },\r\n  6: { type: 'NUM', num: 15 }, 7: { type: 'NUM', num: 14 }, 8: { type: 'NUM', num: 13 },\r\n}\r\n\r\nexport type TicTacToeState = {\r\n  board: Array<'X'|'O'|null>\r\n  turn: 'X'|'O'\r\n  finished: boolean\r\n  winner: 'X'|'O'|'Draw'|null\r\n}\r\n\r\nexport function createTicTacToe(): TicTacToeState {\r\n  return { board: Array(9).fill(null), turn: 'X', finished: false, winner: null }\r\n}\r\n\r\nfunction checkWin(board: Array<'X'|'O'|null>): 'X'|'O'|'Draw'|null {\r\n  const lines = [ [0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6] ]\r\n  for (const [a,b,c] of lines) { if (board[a] && board[a]===board[b] && board[a]===board[c]) return board[a] as 'X'|'O' }\r\n  if (board.every(c => c)) return 'Draw'\r\n  return null\r\n}\r\n\r\nexport function tryClaimCell(state: TicTacToeState, cell: TicCell, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): boolean {\r\n  if (state.finished || state.board[cell]) return false\r\n  const tgt = TTT_TARGETS[cell]\r\n  let ok = false\r\n  if (tgt.type === 'BULL') ok = (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50)\r\n  else if (tgt.type === 'NUM' && typeof tgt.num === 'number') {\r\n    if (typeof sector === 'number' && sector === tgt.num) ok = true\r\n    else if (!sector && (value===tgt.num || value===tgt.num*2 || value===tgt.num*3)) ok = true\r\n  }\r\n  if (!ok) return false\r\n  state.board[cell] = state.turn\r\n  const w = checkWin(state.board)\r\n  if (w) { state.finished = true; state.winner = w; return true }\r\n  state.turn = state.turn === 'X' ? 'O' : 'X'\r\n  return true\r\n}\r\n","/**\r\n * Scam, Fives, and Sevens game logic\r\n * All three follow a similar score-race pattern:\r\n * - Players accumulate scores\r\n * - Only certain numbers count\r\n * - First to reach target wins\r\n */\r\n\r\n// SCAM/SCUM - Hit targets 1â†’20â†’Bull in sequence\r\nexport interface ScamState {\r\n  targetIndex: number // 0-20 for numbers 1-20, 21 for bull (25/50)\r\n  darts: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createScamState(): ScamState {\r\n  return {\r\n    targetIndex: 0,\r\n    darts: 0,\r\n    finished: false,\r\n  }\r\n}\r\n\r\nexport const SCAM_TARGETS = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25]\r\nexport const SCAM_TARGET_NAMES = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', 'Bull']\r\n\r\nexport function getScamTarget(state: ScamState): number {\r\n  return SCAM_TARGETS[state.targetIndex]\r\n}\r\n\r\nexport function addScamAuto(state: ScamState, value: number, ring?: string): ScamState {\r\n  if (state.finished) return state\r\n\r\n  const target = getScamTarget(state)\r\n  const targetHit = (ring === 'SINGLE' && value === target) || (ring === 'DOUBLE' && value === target) || (ring === 'TRIPLE' && value === target) || (ring === 'INNER_BULL' && target === 25)\r\n\r\n  if (!targetHit) return state\r\n\r\n  // Hit! Move to next target\r\n  const newIndex = state.targetIndex + 1\r\n  const finished = newIndex >= SCAM_TARGETS.length\r\n\r\n  return {\r\n    targetIndex: newIndex,\r\n    darts: state.darts + 1,\r\n    finished,\r\n  }\r\n}\r\n\r\nexport function addScamNumeric(state: ScamState, value: number): ScamState {\r\n  // For manual input, assume single ring hit\r\n  return addScamAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetScam(): ScamState {\r\n  return createScamState()\r\n}\r\n\r\n// FIVES - Only multiples of 5 count (5,10,15,20,25,50)\r\nexport interface FivesState {\r\n  score: number\r\n  darts: number\r\n  finished: boolean\r\n  target: number // default 50\r\n}\r\n\r\nexport function createFivesState(target: number = 50): FivesState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  }\r\n}\r\n\r\nexport const FIVES_VALID_NUMBERS = [5, 10, 15, 20, 25, 50]\r\n\r\nexport function isFivesValid(value: number): boolean {\r\n  return FIVES_VALID_NUMBERS.includes(value)\r\n}\r\n\r\nexport function addFivesAuto(state: FivesState, value: number, ring?: string): FivesState {\r\n  if (state.finished) return state\r\n\r\n  // Only multiples of 5 count\r\n  if (!isFivesValid(value)) {\r\n    return { ...state, darts: state.darts + 1 }\r\n  }\r\n\r\n  const newScore = state.score + value\r\n  const finished = newScore >= state.target\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  }\r\n}\r\n\r\nexport function addFivesNumeric(state: FivesState, value: number): FivesState {\r\n  return addFivesAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetFives(target: number = 50): FivesState {\r\n  return createFivesState(target)\r\n}\r\n\r\n// SEVENS - Only multiples of 7 count (7,14,21)\r\nexport interface SevensState {\r\n  score: number\r\n  darts: number\r\n  finished: boolean\r\n  target: number // default 70\r\n}\r\n\r\nexport function createSevensState(target: number = 70): SevensState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  }\r\n}\r\n\r\nexport const SEVENS_VALID_NUMBERS = [7, 14, 21]\r\n\r\nexport function isSevensValid(value: number): boolean {\r\n  return SEVENS_VALID_NUMBERS.includes(value)\r\n}\r\n\r\nexport function addSevensAuto(state: SevensState, value: number, ring?: string): SevensState {\r\n  if (state.finished) return state\r\n\r\n  // Only multiples of 7 count\r\n  if (!isSevensValid(value)) {\r\n    return { ...state, darts: state.darts + 1 }\r\n  }\r\n\r\n  const newScore = state.score + value\r\n  const finished = newScore >= state.target\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  }\r\n}\r\n\r\nexport function addSevensNumeric(state: SevensState, value: number): SevensState {\r\n  return addSevensAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetSevens(target: number = 70): SevensState {\r\n  return createSevensState(target)\r\n}\r\n","export type AmCricketMark = 0 | 1 | 2 | 3\r\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25\r\n\r\nexport type AmCricketState = {\r\n  marks: Record<AmCricketNumber, AmCricketMark>\r\n  points: number\r\n}\r\n\r\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [20, 19, 18, 17, 16, 15, 14, 13, 12, 25]\r\n\r\nexport function createAmCricketState(): AmCricketState {\r\n  const marks: any = {}\r\n  AM_CRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n  return { marks, points: 0 }\r\n}\r\n\r\nexport function applyAmCricketDart(state: AmCricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: AmCricketNumber) => boolean = () => false): number {\r\n  let num: AmCricketNumber | null = null\r\n  let hits = 0\r\n  if (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n    num = 25\r\n    hits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n  } else if (typeof sector === 'number' && sector >= 12 && sector <= 20) {\r\n    num = sector as AmCricketNumber\r\n    if (ring === 'TRIPLE') hits = 3\r\n    else if (ring === 'DOUBLE') hits = 2\r\n    else hits = 1\r\n  } else if (value) {\r\n    for (const c of [20,19,18,17,16,15,14,13,12] as AmCricketNumber[]) {\r\n      if (value === c) { num = c; hits = 1; break }\r\n      if (value === c*2) { num = c; hits = 2; break }\r\n      if (value === c*3) { num = c; hits = 3; break }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n  }\r\n  if (!num) return 0\r\n\r\n  const before = state.marks[num]\r\n  const toClose = Math.max(0, 3 - before)\r\n  const toApply = Math.min(toClose, hits)\r\n  const overflow = Math.max(0, hits - toApply)\r\n  const after = (before + toApply) as AmCricketMark\r\n  state.marks[num] = after > 3 ? 3 : after\r\n\r\n  let points = 0\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      if (ring === 'INNER_BULL') points += 50 * overflow\r\n      else points += 25 * overflow\r\n    } else {\r\n      points += (num as number) * overflow\r\n    }\r\n  }\r\n  state.points += points\r\n  return points\r\n}\r\n\r\nexport function hasClosedAllAm(state: AmCricketState): boolean {\r\n  return AM_CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n","import type { ReactNode } from 'react'\r\n\r\n// Glassy sticky header bar used across Offline and Online match UIs for visual parity\r\nexport default function GameHeaderBar({\r\n  left,\r\n  right,\r\n  className = '',\r\n  sticky = true,\r\n}: {\r\n  left: ReactNode\r\n  right?: ReactNode\r\n  className?: string\r\n  sticky?: boolean\r\n}) {\r\n  return (\r\n    <div className={`${sticky ? 'sticky top-0' : ''} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${className}`}>\r\n      <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent\" />\r\n      <div className=\"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap\">\r\n        {left}\r\n      </div>\r\n      <div className=\"flex items-center gap-1 flex-wrap justify-end\">\r\n        {right}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","/**\r\n * Universal Game Scoreboard Component\r\n * Displays game-specific stats based on the game mode and current game state\r\n * Works for Online, Offline, and Tournament modes\r\n */\r\n\r\nimport React from 'react';\r\n\r\nexport type GameMode = 'X01' | 'Cricket' | 'Shanghai' | 'Killer' | 'High-Low' | 'Halve It' | \r\n                       'Around the Clock' | 'Double Practice' | 'Treble Practice' | \r\n                       'Count-Up' | 'High Score' | 'Low Score' | 'Checkout 170' | 'Checkout 121' |\r\n                       'American Cricket' | 'Baseball' | 'Golf' | 'Tic Tac Toe' | \"Bob's 27\" |\r\n                       'Scam' | 'Fives' | 'Sevens';\r\n\r\nexport interface PlayerStats {\r\n  name: string;\r\n  isCurrentTurn: boolean;\r\n  legsWon?: number;\r\n  score?: number;\r\n  lastScore?: number;\r\n  checkoutRate?: number; // 0-100\r\n  bestLeg?: number | string;\r\n  // Cricket-specific\r\n  closed?: Record<number, number>; // { 20: 3, 19: 2, etc }\r\n  points?: number;\r\n  // Shanghai-specific\r\n  round?: number;\r\n  target?: number;\r\n  // Killer-specific\r\n  number?: number;\r\n  lives?: number;\r\n  eliminated?: boolean;\r\n  // Match statistics\r\n  matchAvg?: number; // Current match 3-dart average\r\n  allTimeAvg?: number; // Player's all-time 3-dart average\r\n  // Other generics\r\n  [key: string]: any;\r\n}\r\n\r\ninterface GameScoreboardProps {\r\n  gameMode: GameMode;\r\n  players: PlayerStats[];\r\n  matchScore?: string; // e.g., \"3-1\"\r\n  gameRules?: any; // Additional rules/config for the game\r\n}\r\n\r\nexport default function GameScoreboard({ gameMode, players, matchScore, gameRules }: GameScoreboardProps) {\r\n  if (!players || players.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3\">\r\n      {players.map((player, idx) => (\r\n        <div\r\n          key={idx}\r\n          className={`rounded-lg border p-3 ${\r\n            player.isCurrentTurn\r\n              ? 'border-emerald-500/40 bg-emerald-500/10'\r\n              : 'border-slate-500/40 bg-slate-500/10'\r\n          }`}\r\n        >\r\n          <div className={`text-sm font-semibold mb-2 uppercase tracking-wide ${\r\n            player.isCurrentTurn ? 'text-emerald-300' : 'text-slate-300'\r\n          }`}>\r\n            {player.name}\r\n          </div>\r\n\r\n          <div className=\"space-y-1 text-sm\">\r\n            {/* X01 specific */}\r\n            {gameMode === 'X01' && (\r\n              <>\r\n                <ScoreRow label=\"Legs Won\" value={`â— ${player.legsWon || 0}`} highlight />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n                <ScoreRow label=\"Last Score\" value={player.lastScore || '0'} mono />\r\n                <ScoreRow label=\"C/Out Rate\" value={`${player.checkoutRate || 0}%`} mono />\r\n                <ScoreRow label=\"Best Leg\" value={player.bestLeg || 'â€”'} mono />\r\n                {/* AVG +/- feature */}\r\n                {player.matchAvg !== undefined && player.allTimeAvg !== undefined && (\r\n                  <>\r\n                    <div className=\"border-t border-white/20 pt-1 mt-1\">\r\n                      <ScoreRow label=\"Match Avg\" value={player.matchAvg.toFixed(2)} mono bold highlight={player.matchAvg > 0} />\r\n                      <AvgDifferenceRow matchAvg={player.matchAvg} allTimeAvg={player.allTimeAvg} />\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Cricket & American Cricket specific */}\r\n            {(gameMode === 'Cricket' || gameMode === 'American Cricket') && (\r\n              <>\r\n                <ScoreRow label=\"Closed\" value={formatCricketClosed(player.closed)} mono />\r\n                <ScoreRow label=\"Points\" value={player.points || 0} mono bold />\r\n                <ScoreRow label=\"Status\" value={getCricketStatus(player)} highlight={player.isCurrentTurn} />\r\n              </>\r\n            )}\r\n\r\n            {/* Shanghai & Halve It - Round-based */}\r\n            {(gameMode === 'Shanghai' || gameMode === 'Halve It') && (\r\n              <>\r\n                <ScoreRow label={gameMode === 'Shanghai' ? 'Round' : 'Stage'} value={player.round || 1} mono />\r\n                <ScoreRow label=\"Target\" value={player.target || 'â€”'} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Killer specific */}\r\n            {gameMode === 'Killer' && (\r\n              <>\r\n                <ScoreRow label=\"Target #\" value={player.number || 'â€”'} mono bold />\r\n                <ScoreRow label=\"Lives\" value={player.lives || 0} mono bold />\r\n                {player.eliminated && (\r\n                  <ScoreRow label=\"Status\" value=\"ELIMINATED\" highlight={false} />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* High-Low specific */}\r\n            {gameMode === 'High-Low' && (\r\n              <>\r\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\r\n                <ScoreRow label=\"Target\" value={player.target || 'High'} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Practice games */}\r\n            {(gameMode === 'Double Practice' || gameMode === 'Treble Practice' || gameMode === 'Around the Clock') && (\r\n              <>\r\n                <ScoreRow label=\"Target\" value={player.target || 'â€”'} mono bold />\r\n                <ScoreRow label=\"Hits\" value={player.hits || 0} mono bold />\r\n                {player.totalNeeded && (\r\n                  <ScoreRow label=\"Progress\" value={`${player.hits || 0} / ${player.totalNeeded}`} mono />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Count-Up, High Score, Low Score */}\r\n            {(gameMode === 'Count-Up' || gameMode === 'High Score' || gameMode === 'Low Score') && (\r\n              <>\r\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n                {gameMode === 'High Score' && (\r\n                  <ScoreRow label=\"Best\" value={player.bestScore || 0} mono />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Checkout challenges */}\r\n            {(gameMode === 'Checkout 170' || gameMode === 'Checkout 121') && (\r\n              <>\r\n                <ScoreRow label=\"Remaining\" value={player.remaining || 0} mono bold />\r\n                <ScoreRow label=\"Attempts\" value={player.attempts || 0} mono />\r\n                <ScoreRow label=\"Successes\" value={player.successes || 0} mono />\r\n              </>\r\n            )}\r\n\r\n            {/* Bob's 27 */}\r\n            {gameMode === \"Bob's 27\" && (\r\n              <>\r\n                <ScoreRow label=\"Target\" value={`D${player.target || 1}`} mono bold />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Baseball & Golf */}\r\n            {gameMode === 'Baseball' && (\r\n              <>\r\n                <ScoreRow label=\"Inning\" value={player.inning || 1} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {gameMode === 'Golf' && (\r\n              <>\r\n                <ScoreRow label=\"Hole\" value={player.hole || 1} mono />\r\n                <ScoreRow label=\"Strokes\" value={player.strokes || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Tic Tac Toe */}\r\n            {gameMode === 'Tic Tac Toe' && (\r\n              <>\r\n                <ScoreRow label=\"Turn\" value={player.turn || 1} mono />\r\n                {player.winner && (\r\n                  <ScoreRow label=\"Result\" value=\"WINNER!\" highlight />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Match score display for competitive games */}\r\n            {matchScore && (gameMode === 'X01' || gameMode === 'Cricket' || gameMode === 'American Cricket') && idx === 1 && (\r\n              <div className=\"border-t border-white/10 pt-1 mt-1\">\r\n                <ScoreRow label=\"Match\" value={matchScore} mono bold highlight />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Helper component for consistent score row display\r\nfunction ScoreRow({ \r\n  label, \r\n  value, \r\n  mono = false, \r\n  bold = false, \r\n  highlight = false \r\n}: { \r\n  label: string; \r\n  value: string | number; \r\n  mono?: boolean;\r\n  bold?: boolean;\r\n  highlight?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"flex justify-between\">\r\n      <span className=\"opacity-70\">{label}:</span>\r\n      <span className={`${mono ? 'font-mono' : ''} ${bold ? 'font-semibold' : ''} ${\r\n        highlight ? 'text-emerald-300' : ''\r\n      }`}>\r\n        {value}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// AVG +/- component showing difference from all-time average\r\nfunction AvgDifferenceRow({ matchAvg, allTimeAvg }: { matchAvg: number; allTimeAvg: number }) {\r\n  const diff = matchAvg - allTimeAvg;\r\n  const isPositive = diff > 0;\r\n  const isNeutral = Math.abs(diff) < 0.01;\r\n  \r\n  let diffText = '';\r\n  let diffColor = 'text-slate-300';\r\n  \r\n  if (isNeutral) {\r\n    diffText = '= All-time';\r\n    diffColor = 'text-slate-300';\r\n  } else if (isPositive) {\r\n    diffText = `+${diff.toFixed(2)} vs avg`;\r\n    diffColor = 'text-emerald-400';\r\n  } else {\r\n    diffText = `${diff.toFixed(2)} vs avg`;\r\n    diffColor = 'text-orange-400';\r\n  }\r\n  \r\n  return (\r\n    <div className=\"flex justify-between\">\r\n      <span className=\"opacity-70\">AVG vs Avg:</span>\r\n      <span className={`font-mono font-semibold ${diffColor}`}>\r\n        {diffText}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Cricket helpers\r\nfunction formatCricketClosed(closed?: Record<number, number>): string {\r\n  if (!closed || Object.keys(closed).length === 0) return 'â€”';\r\n  const closedNumbers = Object.entries(closed)\r\n    .filter(([_, count]) => count === 3)\r\n    .map(([num]) => num === '25' ? 'B' : num)\r\n    .join(',');\r\n  return closedNumbers || 'â€”';\r\n}\r\n\r\nfunction getCricketStatus(player: PlayerStats): string {\r\n  if (!player.closed) return 'Starting';\r\n  const closedCount = Object.values(player.closed).filter(c => c === 3).length;\r\n  if (closedCount === 0) return 'No marks';\r\n  if (closedCount < 7) return `${closedCount}/7`;\r\n  return 'Closing in';\r\n}\r\n","// Small adapter helpers to convert generic MatchControls onAddVisit callbacks to the local handlers\r\nexport function makeOnlineAddVisitAdapter(submitVisitManual: (v: number) => void) {\r\n  return (score: number, darts: number) => { submitVisitManual(score) }\r\n}\r\n\r\nexport function makeOfflineAddVisitAdapter(commitManualVisitTotal: (v: number) => boolean) {\r\n  return (score: number, darts: number) => { commitManualVisitTotal(score) }\r\n}\r\n","import type { Actions as MatchActions } from '../store/match'\r\n\r\nexport type UnifiedMatchActions = {\r\n  addVisit: (score: number, darts?: number, meta?: any) => void\r\n  undoVisit: () => void\r\n  nextPlayer: () => void\r\n  endLeg: (score?: number) => void\r\n  endGame: () => void\r\n}\r\n\r\nexport function createOnlineMatchActions(args: { match: MatchActions; sendState: () => void; submitVisitManual?: (v:number)=>void }) : UnifiedMatchActions {\r\n  const { match, sendState, submitVisitManual } = args\r\n  return {\r\n    addVisit: (score: number, darts = 3, meta?: any) => {\r\n      // Prefer the manual submit helper when available as it computes double/finish meta\r\n      if (submitVisitManual) { submitVisitManual(score); return }\r\n      try { match.addVisit(score, darts, meta) } catch { match.addVisit(score, darts) }\r\n      try { sendState() } catch {}\r\n    },\r\n    undoVisit: () => { match.undoVisit(); try { sendState() } catch {} },\r\n    nextPlayer: () => { match.nextPlayer(); try { sendState() } catch {} },\r\n    endLeg: (score?: number) => { if (typeof score === 'number') match.endLeg(score); else match.endLeg(0); try { sendState() } catch {} },\r\n    endGame: () => { match.endGame(); try { sendState() } catch {} },\r\n  }\r\n}\r\n\r\nexport function createOfflineMatchActions(args: { match: MatchActions; commitManualVisitTotal?: (v:number)=>boolean; endTurn?: (nextRemaining:number)=>void }) : UnifiedMatchActions {\r\n  const { match, commitManualVisitTotal, endTurn } = args\r\n  return {\r\n    addVisit: (score: number, darts = 3, meta?: any) => {\r\n      if (commitManualVisitTotal) { commitManualVisitTotal(score); return }\r\n      try { match.addVisit(score, darts, meta) } catch { match.addVisit(score, darts) }\r\n    },\r\n    undoVisit: () => { match.undoVisit() },\r\n    nextPlayer: () => { if (endTurn) { try { endTurn(0) } catch { match.nextPlayer() } } else { match.nextPlayer() } },\r\n    endLeg: (score?: number) => { if (typeof score === 'number') match.endLeg(score); else match.endLeg(0) },\r\n    endGame: () => { match.endGame() },\r\n  }\r\n}\r\n","/**\r\n * Hook to convert OfflinePlay game state to GameScoreboard format\r\n */\r\n\r\nimport { useMemo } from 'react';\r\nimport type { PlayerStats } from './GameScoreboard';\r\nimport type { GameMode } from './GameScoreboard';\r\nimport { getAllTimeAvg } from '../../store/profileStats';\r\n\r\nexport function useOfflineGameStats(\r\n  gameMode: GameMode,\r\n  // X01 state\r\n  playerScore?: number,\r\n  aiScore?: number,\r\n  playerLegs?: number,\r\n  aiLegs?: number,\r\n  playerLastDart?: number,\r\n  aiLastDart?: number,\r\n  playerVisitSum?: number,\r\n  aiVisitSum?: number,\r\n  playerLastVisitScore?: number | null,\r\n  aiLastVisitScore?: number | null,\r\n  playerVisitDartCount?: number,\r\n  aiVisitDartCount?: number,\r\n  playerDoublesHit?: number,\r\n  playerDoublesAtt?: number,\r\n  aiDoublesHit?: number,\r\n  aiDoublesAtt?: number,\r\n  legStats?: Array<any>,\r\n  isPlayerTurn?: boolean,\r\n  ai?: string,\r\n  x01Score?: number,\r\n  // Cricket state\r\n  cricket?: any,\r\n  // Shanghai state\r\n  shanghai?: any,\r\n  // Killer state\r\n  killerPlayers?: Array<any>,\r\n  killerStates?: Record<string, any>,\r\n  killerAssigned?: Record<string, number>,\r\n  killerTurnIdx?: number\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (gameMode === 'X01') {\r\n      // Calculate player match average\r\n      let playerMatchAvg = 0;\r\n      let playerDarts = 0;\r\n      let playerScored = 0;\r\n      if (legStats && legStats.length > 0) {\r\n        for (const leg of legStats) {\r\n          if (leg.dartsThrown && leg.totalScored) {\r\n            playerDarts += leg.dartsThrown;\r\n            playerScored += leg.totalScored;\r\n          }\r\n        }\r\n        if (playerDarts > 0) {\r\n          playerMatchAvg = (playerScored / playerDarts) * 3;\r\n        }\r\n      }\r\n\r\n      // Player card\r\n      const playerVisitDarts = playerVisitDartCount ?? 0\r\n      const playerCurrentVisitActive = playerVisitDarts > 0\r\n      const playerCurrentVisitSum = playerVisitSum ?? 0\r\n      const playerLastVisitTotal = playerLastVisitScore ?? null\r\n      const playerLastDartValue = playerLastDart ?? 0\r\n      const resolvedPlayerLastScore = playerCurrentVisitActive\r\n        ? playerCurrentVisitSum\r\n        : (playerLastVisitTotal ?? playerLastDartValue)\r\n\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        legsWon: playerLegs || 0,\r\n        score: playerScore || 0,\r\n        lastScore: resolvedPlayerLastScore,\r\n        checkoutRate: playerDoublesAtt && playerDoublesAtt > 0 \r\n          ? Math.round((playerDoublesHit || 0) / playerDoublesAtt * 100)\r\n          : 0,\r\n        bestLeg: legStats && legStats.length > 0 \r\n          ? `${Math.min(...legStats.map(l => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\r\n          : 'â€”',\r\n        matchAvg: playerMatchAvg,\r\n        allTimeAvg: getAllTimeAvg('You') || 0\r\n      });\r\n\r\n      // AI card (if playing against AI)\r\n      if (ai && ai !== 'None') {\r\n        const aiVisitDarts = aiVisitDartCount ?? 0\r\n        const aiCurrentVisitActive = aiVisitDarts > 0\r\n        const aiCurrentVisitSum = aiVisitSum ?? 0\r\n        const aiLastVisitTotal = aiLastVisitScore ?? null\r\n        const aiLastDartValue = aiLastDart ?? 0\r\n        const resolvedAiLastScore = aiCurrentVisitActive\r\n          ? aiCurrentVisitSum\r\n          : (aiLastVisitTotal ?? aiLastDartValue)\r\n\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          legsWon: aiLegs || 0,\r\n          score: aiScore || 0,\r\n          lastScore: resolvedAiLastScore,\r\n          checkoutRate: aiDoublesAtt && aiDoublesAtt > 0 \r\n            ? Math.round((aiDoublesHit || 0) / aiDoublesAtt * 100)\r\n            : 0,\r\n          bestLeg: 'â€”'\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Cricket') {\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        closed: cricket?.marks || {},\r\n        points: cricket?.points || 0\r\n      });\r\n\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          closed: {},\r\n          points: 0\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Shanghai') {\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        round: shanghai?.round || 1,\r\n        target: shanghai?.target || 1,\r\n        score: shanghai?.score || 0\r\n      });\r\n\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          round: shanghai?.round || 1,\r\n          target: shanghai?.target || 1,\r\n          score: 0\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Killer' && killerPlayers && killerPlayers.length > 0) {\r\n      killerPlayers.forEach((p, idx) => {\r\n        const state = killerStates?.[p.id];\r\n        players.push({\r\n          name: p.name,\r\n          isCurrentTurn: idx === killerTurnIdx,\r\n          number: killerAssigned?.[p.id],\r\n          lives: state?.lives || 0,\r\n          eliminated: state?.eliminated || false\r\n        });\r\n      });\r\n    }\r\n\r\n    return players;\r\n  }, [\r\n    gameMode,\r\n    playerScore, aiScore,\r\n    playerLegs, aiLegs,\r\n    playerLastDart, aiLastDart,\r\n  playerVisitSum, aiVisitSum,\r\n  playerLastVisitScore, aiLastVisitScore,\r\n  playerVisitDartCount, aiVisitDartCount,\r\n    playerDoublesHit, playerDoublesAtt,\r\n    aiDoublesHit, aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn, ai,\r\n    cricket,\r\n    shanghai,\r\n    killerPlayers, killerStates, killerAssigned, killerTurnIdx\r\n  ]);\r\n}\r\n\r\nexport function useOnlineGameStats(\r\n  gameMode: GameMode,\r\n  matchState?: any, // From useMatch() store\r\n  participants?: string[]\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (!matchState || !matchState.players || matchState.players.length === 0) {\r\n      return players;\r\n    }\r\n\r\n    matchState.players.forEach((player: any, idx: number) => {\r\n      const isCurrentTurn = idx === matchState.currentPlayerIdx;\r\n      \r\n      if (gameMode === 'X01') {\r\n        // Calculate match average for this player\r\n        let matchAvg = 0;\r\n        let totalDarts = 0;\r\n        let totalScored = 0;\r\n\r\n        if (player.legs && player.legs.length > 0) {\r\n          for (const leg of player.legs) {\r\n            if (leg.finished) {\r\n              const legDarts = leg.dartsThrown || 0;\r\n              const legScored = Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining) || 0;\r\n              totalDarts += legDarts;\r\n              totalScored += legScored;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (totalDarts > 0) {\r\n          matchAvg = (totalScored / totalDarts) * 3;\r\n        }\r\n\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          legsWon: player.legsWon || 0,\r\n          score: player.score || 0,\r\n          lastScore: player.lastVisitScore || 0,\r\n          checkoutRate: player.doublesAttempted > 0 \r\n            ? Math.round((player.doublesHit / player.doublesAttempted) * 100)\r\n            : 0,\r\n          bestLeg: player.bestLegDarts ? `${player.bestLegDarts} darts` : 'â€”',\r\n          matchAvg: matchAvg,\r\n          allTimeAvg: player.name ? getAllTimeAvg(player.name) : 0\r\n        });\r\n      }\r\n\r\n      if (gameMode === 'Cricket') {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          closed: player.cricket?.marks || {},\r\n          points: player.cricket?.points || 0\r\n        });\r\n      }\r\n\r\n      if (gameMode === 'Killer') {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          number: player.killerNumber || null,\r\n          lives: player.killerLives || 3,\r\n          eliminated: player.killerEliminated || false\r\n        });\r\n      }\r\n    });\r\n\r\n    return players;\r\n  }, [gameMode, matchState, participants]);\r\n}\r\n","\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { suggestCheckouts, sayScore } from '../utils/checkout';\r\nimport { useUserSettings } from '../store/userSettings';\r\nimport { useToast } from '../store/toast';\r\nimport { useCalibration } from '../store/calibration';\r\nimport GameCalibrationStatus from './GameCalibrationStatus';\r\nimport CameraTile from './CameraTile';\r\nimport CameraView from './CameraView';\r\nimport HeatMap from './HeatMap';\r\nimport { getUserCurrency, formatPriceInCurrency } from '../utils/config';\r\nimport { bumpGameMode } from '../store/profileStats';\r\nimport { DOUBLE_PRACTICE_ORDER, isDoubleHit, parseManualDart } from '../game/types';\r\nimport { ATC_ORDER } from '../game/aroundTheClock';\r\nimport { createCricketState, applyCricketDart, CRICKET_NUMBERS, hasClosedAll as cricketClosedAll } from '../game/cricket';\r\nimport { createShanghaiState, applyShanghaiDart, endShanghaiTurn } from '../game/shanghai';\r\nimport { createDefaultHalveIt, getCurrentHalveTarget, applyHalveItDart, endHalveItTurn } from '../game/halveIt';\r\nimport { createHighLow, applyHighLowDart, endHighLowTurn } from '../game/highLow';\r\nimport { createKillerState, assignKillerNumbers, applyKillerDart, killerWinner, KillerState } from '../game/killer';\r\nimport { createBaseball, applyBaseballDart } from '../game/baseball';\r\nimport { createGolf, applyGolfDart } from '../game/golf';\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from '../game/ticTacToe';\r\nimport { createScamState, addScamAuto, addScamNumeric, resetScam, getScamTarget, SCAM_TARGET_NAMES, ScamState, createFivesState, addFivesAuto, addFivesNumeric, resetFives, FivesState, createSevensState, addSevensAuto, addSevensNumeric, resetSevens, SevensState } from '../game/scamFivesSevens';\r\nimport { createAmCricketState, applyAmCricketDart, AM_CRICKET_NUMBERS, hasClosedAllAm } from '../game/americanCricket';\r\nimport ResizableModal from './ui/ResizableModal';\r\nimport MatchStartShowcase from './ui/MatchStartShowcase'\r\nimport { useAudit } from '../store/audit';\r\nimport ResizablePanel from './ui/ResizablePanel';\r\nimport GameHeaderBar from './ui/GameHeaderBar';\r\nimport GameScoreboard, { type PlayerStats } from './scoreboards/GameScoreboard';\r\nimport MatchControls from './MatchControls'\r\nimport { makeOfflineAddVisitAdapter } from './matchControlAdapters'\r\nimport { createOfflineMatchActions, UnifiedMatchActions } from '../logic/matchActions'\r\nimport { useMatch } from '../store/match'\r\nimport { useOfflineGameStats } from './scoreboards/useGameStats';\r\nimport { freeGames, premiumGames, allGames } from '../utils/games';\r\n\r\nconst aiLevels = ['Easy', 'Medium', 'Hardened'];\r\n\r\nfunction clamp(n: number, min: number, max: number) {\r\n  return Math.max(min, Math.min(max, n));\r\n}\r\n\r\ntype PendingAutoVisit = {\r\n  visitTotal: number\r\n  darts: number\r\n  preRemaining: number\r\n  remaining: number\r\n  doubleAttempts: number\r\n  finished: boolean\r\n  doubleWindow: boolean\r\n  highestCheckout?: number | null\r\n  announced?: boolean\r\n}\r\n\r\nconst BOARD_CLEAR_GRACE_MS = 6500;\r\n\r\nfunction aiVisitScore(remaining: number, level: string): number {\r\n  let target = 0;\r\n  if (level === 'Easy') {\r\n    const candidates = [22, 26, 41, 45, 60];\r\n    target = candidates[Math.floor(Math.random() * candidates.length)];\r\n  } else if (level === 'Medium') {\r\n    target = Math.round(clamp(60 + (Math.random() * 30 - 15), 30, 100));\r\n  } else {\r\n    target = Math.round(clamp(80 + (Math.random() * 20 - 10), 50, 120));\r\n  }\r\n  if (remaining <= 0) return 0;\r\n  if (target > remaining) {\r\n    const safe = [100, 85, 81, 60, 57, 45, 41, 26, 22, 20, 1].find(v => v <= remaining);\r\n    return safe ?? 0;\r\n  }\r\n  return target;\r\n}\r\n\r\nfunction X01RulesPopup({ onClose }: { onClose: () => void }) {\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n      <div className=\"card max-w-lg w-full relative\">\r\n        <button className=\"absolute top-2 right-2 btn px-2 py-1\" onClick={onClose}>Close</button>\r\n        <h3 className=\"text-xl font-bold mb-2\">X01 Rules & Regulations</h3>\r\n        <ul className=\"list-disc pl-5 text-left mb-2\">\r\n          <li>Double In: Start scoring only after hitting a double.</li>\r\n          <li>Double Out: Finish the game by hitting a double to reach exactly zero.</li>\r\n          <li>Best Of: Play a set number of legs, winner is first to reach majority.</li>\r\n          <li>First To: Play until a player reaches a set number of legs.</li>\r\n          <li>No Cheating: All scores must be valid, no manual score changes mid-leg.</li>\r\n          <li>Competitive Standard: Follow latest WDF/PDC rules for match play.</li>\r\n        </ul>\r\n        <p className=\"text-sm text-slate-600\">For full details, see official darts governing body rules.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n\r\nexport default function OfflinePlay({ user }: { user: any }) {\r\n  const {\r\n    offlineLayout,\r\n    favoriteDouble,\r\n    callerEnabled,\r\n    callerVoice,\r\n    callerVolume,\r\n    speakCheckoutOnly,\r\n    rememberLastOffline,\r\n    setLastOffline,\r\n    autoStartOffline,\r\n    cameraScale,\r\n    setCameraScale,\r\n    cameraAspect = 'wide',\r\n    setCameraAspect,\r\n    cameraFitMode = 'fill',\r\n    setCameraFitMode,\r\n    cameraEnabled,\r\n    textSize,\r\n    boxSize,\r\n    autoscoreProvider,\r\n    autoCommitMode = 'wait-for-clear',\r\n    matchType = 'singles',\r\n    setMatchType,\r\n    teamAName = 'Team A',\r\n    setTeamAName,\r\n    teamBName = 'Team B',\r\n    setTeamBName,\r\n  } = useUserSettings()\r\n  const manualScoring = autoscoreProvider === 'manual'\r\n  const cameraToolbarVisible = cameraEnabled && !manualScoring\r\n  const waitForBoardClear = cameraEnabled && !manualScoring && autoCommitMode !== 'immediate'\r\n  const [selectedMode, setSelectedMode] = useState<string>('X01');\r\n  const [x01Score, setX01Score] = useState(501);\r\n  const [ai, setAI] = useState('None');\r\n  const [showRules, setShowRules] = useState(false);\r\n  const [inMatch, setInMatch] = useState(false);\r\n  const [playerScore, setPlayerScore] = useState(x01Score);\r\n  const [aiScore, setAiScore] = useState(x01Score);\r\n  const [onDouble, setOnDouble] = useState(false);\r\n  const [showWinPopup, setShowWinPopup] = useState(false);\r\n  // Match format: First-to selector and leg counters\r\n  const [firstTo, setFirstTo] = useState<number>(1)\r\n  const [playerLegs, setPlayerLegs] = useState<number>(0)\r\n  const match = useMatch()\r\n  const [showStartShowcase, setShowStartShowcase] = useState(false)\r\n  const startedShowcasedRef = useRef(false)\r\n  const [aiLegs, setAiLegs] = useState<number>(0)\r\n  // Placeholder for unified offline actions; once commitManualVisitTotal/endTurn defined, we'll assign\r\n  \r\n  const [pendingLegWinner, setPendingLegWinner] = useState<'player'|'ai'|null>(null)\r\n  const [doubleDarts, setDoubleDarts] = useState(1);\r\n  const [checkoutDarts, setCheckoutDarts] = useState(1);\r\n  const [legStats, setLegStats] = useState<{ winner: 'player'|'ai'; doubleDarts: number; checkoutDarts: number; winnerDarts: number; doublesAtt?: number; doublesHit?: number }[]>([]);\r\n  // New: pre-game adjustable AI delay (ms)\r\n  const [aiDelayMs, setAiDelayMs] = useState<number>(2000)\r\n  const toast = useToast();\r\n  // New: match popup state\r\n  const [showMatchModal, setShowMatchModal] = useState(false)\r\n  // Mirror Online layout defaults when in modern layout, otherwise keep classic feel\r\n  const [maximized, setMaximized] = useState(offlineLayout === 'modern')\r\n  const [fitAll, setFitAll] = useState(offlineLayout === 'modern')\r\n  // React to layout changes at runtime\r\n  useEffect(() => {\r\n    setMaximized(offlineLayout === 'modern')\r\n    setFitAll(offlineLayout === 'modern')\r\n  }, [offlineLayout])\r\n  useEffect(() => {\r\n    if (cameraFitMode !== 'fit') {\r\n      setCameraFitMode('fit')\r\n    }\r\n  }, [cameraFitMode, setCameraFitMode])\r\n  const [fitScale, setFitScale] = useState(1)\r\n  const [fitOverflowing, setFitOverflowing] = useState(false)\r\n  const [isPlayerTurn, setIsPlayerTurn] = useState(true)\r\n  useEffect(() => {\r\n    const handleOpenManager = () => setShowCameraManager(true)\r\n    window.addEventListener('ndn:open-camera-manager', handleOpenManager)\r\n    return () => window.removeEventListener('ndn:open-camera-manager', handleOpenManager)\r\n  }, [])\r\n  // Per-dart input and stats\r\n  const [playerDartPoints, setPlayerDartPoints] = useState<number>(0)\r\n  const [dpIndex, setDpIndex] = useState<number>(0) // 0..20 (DBULL at 20)\r\n  const [dpHits, setDpHits] = useState<number>(0)\r\n  // Around the Clock (offline practice)\r\n  const [atcIndex, setAtcIndex] = useState<number>(0)\r\n  const [atcHits, setAtcHits] = useState<number>(0)\r\n  // Practice mode states\r\n  const [cricket, setCricket] = useState(createCricketState())\r\n  const [shanghai, setShanghai] = useState(createShanghaiState())\r\n  const [halve, setHalve] = useState(createDefaultHalveIt())\r\n  const [highlow, setHighlow] = useState(createHighLow())\r\n  const [practiceTurnDarts, setPracticeTurnDarts] = useState<number>(0)\r\n  // Phase 1 practice modes\r\n  const [b27Stage, setB27Stage] = useState<number>(1)\r\n  const [b27Score, setB27Score] = useState<number>(27)\r\n  const [b27Darts, setB27Darts] = useState<number>(0)\r\n  const [b27Hits, setB27Hits] = useState<number>(0)\r\n  const [b27Finished, setB27Finished] = useState<boolean>(false)\r\n  const [cuRound, setCuRound] = useState<number>(1)\r\n  const [cuScore, setCuScore] = useState<number>(0)\r\n  const [cuDarts, setCuDarts] = useState<number>(0)\r\n  const cuMaxRounds = 8\r\n  const [hsRound, setHsRound] = useState<number>(1)\r\n  const [hsScore, setHsScore] = useState<number>(0)\r\n  const [hsDarts, setHsDarts] = useState<number>(0)\r\n  const hsMaxRounds = 10\r\n  const [lsRound, setLsRound] = useState<number>(1)\r\n  const [lsScore, setLsScore] = useState<number>(0)\r\n  const [lsDarts, setLsDarts] = useState<number>(0)\r\n  const lsMaxRounds = 10\r\n  const [co170Rem, setCo170Rem] = useState<number>(170)\r\n  const [co170Darts, setCo170Darts] = useState<number>(0)\r\n  const [co170Attempts, setCo170Attempts] = useState<number>(0)\r\n  const [co170Successes, setCo170Successes] = useState<number>(0)\r\n  const [co121Rem, setCo121Rem] = useState<number>(121)\r\n  const [co121Darts, setCo121Darts] = useState<number>(0)\r\n  const [co121Attempts, setCo121Attempts] = useState<number>(0)\r\n  const [co121Successes, setCo121Successes] = useState<number>(0)\r\n  const [trebleTarget, setTrebleTarget] = useState<number>(20)\r\n  const [trebleHits, setTrebleHits] = useState<number>(0)\r\n  const [trebleDarts, setTrebleDarts] = useState<number>(0)\r\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30)\r\n  const [trebleFinished, setTrebleFinished] = useState<boolean>(false)\r\n  // Phase 2 states\r\n  const [baseball, setBaseball] = useState(createBaseball())\r\n  const [golf, setGolf] = useState(createGolf())\r\n  const [ttt, setTTT] = useState(createTicTacToe())\r\n  const [amCricket, setAmCricket] = useState(createAmCricketState())\r\n  // Killer (hotseat) state\r\n  const [killerPlayers, setKillerPlayers] = useState<Array<{ id: string; name: string }>>([\r\n    { id: 'p1', name: 'Player 1' },\r\n    { id: 'p2', name: 'Player 2' },\r\n  ])\r\n  const [killerStates, setKillerStates] = useState<Record<string, KillerState>>({})\r\n  const [killerAssigned, setKillerAssigned] = useState<Record<string, number>>({})\r\n  const [killerSetupDone, setKillerSetupDone] = useState<boolean>(false)\r\n  const [killerTurnIdx, setKillerTurnIdx] = useState<number>(0)\r\n  const [killerDarts, setKillerDarts] = useState<number>(0)\r\n  const [killerWinnerId, setKillerWinnerId] = useState<string | null>(null)\r\n  const [killerLastEvent, setKillerLastEvent] = useState<string>('')\r\n  // Scam/Scum state\r\n  const [scam, setScam] = useState(createScamState())\r\n  const [scamPlayer, setScamPlayer] = useState(createScamState())\r\n  // Fives state\r\n  const [fives, setFives] = useState(createFivesState(50))\r\n  const [fivesPlayer, setFivesPlayer] = useState(createFivesState(50))\r\n  // Sevens state\r\n  const [sevens, setSevens] = useState(createSevensState(70))\r\n  const [sevensPlayer, setSevensPlayer] = useState(createSevensState(70))\r\n  const [playerDartsThrown, setPlayerDartsThrown] = useState<number>(0)\r\n  const [playerLastDart, setPlayerLastDart] = useState<number>(0)\r\n  const [playerVisitDarts, setPlayerVisitDarts] = useState<number>(0)\r\n  const [playerVisitStart, setPlayerVisitStart] = useState<number>(x01Score)\r\n  const [playerVisitSum, setPlayerVisitSum] = useState<number>(0)\r\n  const [playerLastVisitScore, setPlayerLastVisitScore] = useState<number | null>(null)\r\n  const [playerVisitDartsAtDouble, setPlayerVisitDartsAtDouble] = useState<number>(0)\r\n  const lastBounceMissTsRef = useRef<number>(0)\r\n  const lastVisitDartsRef = useRef<number>(0)\r\n  const playerScoreRef = useRef<number>(playerScore)\r\n  const playerVisitDartsRef = useRef<number>(playerVisitDarts)\r\n  const playerVisitSumRef = useRef<number>(playerVisitSum)\r\n  const playerVisitStartRef = useRef<number>(playerVisitStart)\r\n  const playerVisitDartsAtDoubleRef = useRef<number>(playerVisitDartsAtDouble)\r\n\r\n  useEffect(() => { playerScoreRef.current = playerScore }, [playerScore])\r\n  useEffect(() => { playerVisitDartsRef.current = playerVisitDarts }, [playerVisitDarts])\r\n  useEffect(() => { playerVisitSumRef.current = playerVisitSum }, [playerVisitSum])\r\n  useEffect(() => { playerVisitStartRef.current = playerVisitStart }, [playerVisitStart])\r\n  useEffect(() => { playerVisitDartsAtDoubleRef.current = playerVisitDartsAtDouble }, [playerVisitDartsAtDouble])\r\n  const [aiCountdownMs, setAiCountdownMs] = useState<number>(0)\r\n  const aiTimerRef = useRef<number | null>(null)\r\n  const [aiDartsThrown, setAiDartsThrown] = useState<number>(0)\r\n  const [aiLastDart, setAiLastDart] = useState<number>(0)\r\n  const [aiVisitSum, setAiVisitSum] = useState<number>(0)\r\n  const [aiVisitDarts, setAiVisitDarts] = useState<number>(0)\r\n  const [aiLastVisitScore, setAiLastVisitScore] = useState<number | null>(null)\r\n  const [aiVisitDartsAtDouble, setAiVisitDartsAtDouble] = useState<number>(0)\r\n  // Doubles attempts/hits\r\n  const [playerDoublesAtt, setPlayerDoublesAtt] = useState<number>(0)\r\n  const [playerDoublesHit, setPlayerDoublesHit] = useState<number>(0)\r\n  const [aiDoublesAtt, setAiDoublesAtt] = useState<number>(0)\r\n  const [aiDoublesHit, setAiDoublesHit] = useState<number>(0)\r\n  // Match-long totals for averages\r\n  const [totalPlayerDarts, setTotalPlayerDarts] = useState<number>(0)\r\n  const [totalAiDarts, setTotalAiDarts] = useState<number>(0)\r\n  const [totalPlayerPoints, setTotalPlayerPoints] = useState<number>(0)\r\n  const [totalAiPoints, setTotalAiPoints] = useState<number>(0)\r\n  // Power scoring and checkout highs\r\n  const [player180s, setPlayer180s] = useState<number>(0)\r\n  const [player140s, setPlayer140s] = useState<number>(0)\r\n  const [player100s, setPlayer100s] = useState<number>(0)\r\n  const [ai180s, setAi180s] = useState<number>(0)\r\n  const [ai140s, setAi140s] = useState<number>(0)\r\n  const [ai100s, setAi100s] = useState<number>(0)\r\n  const [playerHighestCheckout, setPlayerHighestCheckout] = useState<number>(0)\r\n  const [aiHighestCheckout, setAiHighestCheckout] = useState<number>(0)\r\n  // End-of-match summary modal\r\n  const [showMatchSummary, setShowMatchSummary] = useState<boolean>(false)\r\n  // Manual correction input for offline (matches CameraView UX)\r\n  const [manualBox, setManualBox] = useState<string>('')\r\n  const [manualTextarea, setManualTextarea] = useState<string>('')\r\n  const [manualPlayerScoreInput, setManualPlayerScoreInput] = useState<string>('')\r\n  const [manualOpponentScoreInput, setManualOpponentScoreInput] = useState<string>('')\r\n  const [manualPlayerLegsInput, setManualPlayerLegsInput] = useState<string>('')\r\n  const [manualOpponentLegsInput, setManualOpponentLegsInput] = useState<string>('')\r\n  const [legOverrideConfirm, setLegOverrideConfirm] = useState<{ target: 'player' | 'ai'; value: number; stage: 1 | 2 } | null>(null)\r\n  const [showCameraManager, setShowCameraManager] = useState<boolean>(false)\r\n  const [dartCounts, setDartCounts] = useState<Record<string, number>>({})\r\n  const [awaitingBoardClear, setAwaitingBoardClear] = useState<boolean>(false)\r\n  const pendingVisitRef = useRef<PendingAutoVisit | null>(null)\r\n  const pendingVisitTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\r\n\r\n  const clearPendingVisitTimer = useCallback(() => {\r\n    const timer = pendingVisitTimerRef.current\r\n    if (timer) {\r\n      clearTimeout(timer)\r\n      pendingVisitTimerRef.current = null\r\n    }\r\n  }, [])\r\n\r\n  const speakAutoVisit = useCallback((pending: PendingAutoVisit) => {\r\n    if (!callerEnabled) return\r\n    const speaker = user?.username || 'Player'\r\n    try {\r\n      sayScore(speaker, pending.visitTotal, Math.max(pending.remaining, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n    } catch {}\r\n  }, [callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, user?.username])\r\n\r\n  const commitPendingVisit = useCallback((pending: PendingAutoVisit, _trigger: 'immediate' | 'event' | 'timeout') => {\r\n    setAwaitingBoardClear(false)\r\n  const { visitTotal, darts, preRemaining, remaining, doubleAttempts, finished, doubleWindow, highestCheckout } = pending\r\n\r\n    if (!finished) {\r\n      setPlayerScore(remaining)\r\n      playerScoreRef.current = remaining\r\n    } else {\r\n      setPlayerScore(0)\r\n      playerScoreRef.current = 0\r\n      if (typeof highestCheckout === 'number' && highestCheckout > 0) {\r\n        setPlayerHighestCheckout(h => Math.max(h, highestCheckout))\r\n      }\r\n    }\r\n\r\n    setPlayerLastVisitScore(visitTotal)\r\n\r\n    if (visitTotal === 180) setPlayer180s(n => n + 1)\r\n    else if (visitTotal >= 140) setPlayer140s(n => n + 1)\r\n    else if (visitTotal >= 100) setPlayer100s(n => n + 1)\r\n\r\n    if (doubleWindow && doubleAttempts > 0) {\r\n      setPlayerDoublesAtt(a => a + doubleAttempts)\r\n      if (finished) setPlayerDoublesHit(h => h + 1)\r\n    }\r\n\r\n    if (!pending.announced) speakAutoVisit(pending)\r\n\r\n    try {\r\n      useAudit.getState().recordVisit('offline-x01', darts, visitTotal, { preRemaining, postRemaining: finished ? 0 : remaining, finish: finished, bust: false })\r\n    } catch {}\r\n\r\n    if (finished) {\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n    }\r\n\r\n    endTurn(finished ? 0 : remaining)\r\n\r\n    setPlayerVisitSum(0)\r\n    playerVisitSumRef.current = 0\r\n    setPlayerVisitDarts(0)\r\n    playerVisitDartsRef.current = 0\r\n    setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n  }, [endTurn, setPlayerHighestCheckout, setPendingLegWinner, setPlayerScore, setPlayerLastVisitScore, setPlayerVisitSum, setPlayerVisitDarts, setPlayerVisitDartsAtDouble, setShowWinPopup, setPlayer180s, setPlayer140s, setPlayer100s, setPlayerDoublesAtt, setPlayerDoublesHit, speakAutoVisit])\r\n\r\n  const finalizePendingVisit = useCallback((trigger: 'event' | 'timeout') => {\r\n    const pending = pendingVisitRef.current\r\n    if (!pending) return\r\n    pendingVisitRef.current = null\r\n    clearPendingVisitTimer()\r\n    commitPendingVisit(pending, trigger)\r\n  }, [clearPendingVisitTimer, commitPendingVisit])\r\n\r\n  const queuePendingVisit = useCallback((pending: PendingAutoVisit) => {\r\n    speakAutoVisit(pending)\r\n    pendingVisitRef.current = { ...pending, announced: true }\r\n    setAwaitingBoardClear(true)\r\n    clearPendingVisitTimer()\r\n    pendingVisitTimerRef.current = setTimeout(() => finalizePendingVisit('timeout'), BOARD_CLEAR_GRACE_MS)\r\n  }, [clearPendingVisitTimer, finalizePendingVisit, speakAutoVisit])\r\n\r\n  useEffect(() => {\r\n    if (!waitForBoardClear) return\r\n    const handler = () => finalizePendingVisit('event')\r\n    window.addEventListener('ndn:darts-cleared', handler as EventListener)\r\n    return () => window.removeEventListener('ndn:darts-cleared', handler as EventListener)\r\n  }, [waitForBoardClear, finalizePendingVisit])\r\n\r\n  useEffect(() => {\r\n    if (!waitForBoardClear) finalizePendingVisit('timeout')\r\n  }, [waitForBoardClear, finalizePendingVisit])\r\n\r\n  useEffect(() => () => clearPendingVisitTimer(), [clearPendingVisitTimer])\r\n\r\n  useEffect(() => {\r\n    if (playerVisitDarts === 0) {\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('ndn:darts-cleared', { detail: { source: 'offline-play', ts: Date.now() } }))\r\n      } catch {}\r\n      lastBounceMissTsRef.current = 0\r\n    }\r\n    lastVisitDartsRef.current = playerVisitDarts\r\n  }, [playerVisitDarts])\r\n\r\n\r\n  const humanName = user?.username || 'Player 1'\r\n  const aiDisplayName = ai === 'None' ? 'Player 2' : ai\r\n\r\n  // Call all game stat hooks unconditionally at component level (React hooks rules)\r\n  const statsX01 = useOfflineGameStats(\r\n    'X01' as any,\r\n    playerScore, aiScore,\r\n    playerLegs, aiLegs,\r\n    playerLastDart, aiLastDart,\r\n    playerVisitSum, aiVisitSum,\r\n    playerLastVisitScore, aiLastVisitScore,\r\n    playerVisitDarts, aiVisitDarts,\r\n    playerDoublesHit, playerDoublesAtt,\r\n    aiDoublesHit, aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn,\r\n    ai,\r\n    x01Score\r\n  )\r\n  const statsCricket = useOfflineGameStats(\r\n    'Cricket' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    cricket\r\n  )\r\n  const statsShanghai = useOfflineGameStats(\r\n    'Shanghai' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    isPlayerTurn, ai, undefined,\r\n    cricket, shanghai\r\n  )\r\n  const statsKiller = useOfflineGameStats(\r\n    'Killer' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    undefined, undefined,\r\n    killerPlayers, killerStates, killerAssigned, killerTurnIdx\r\n  )\r\n  const statsScam = useOfflineGameStats('Scam' as any)\r\n  const statsFives = useOfflineGameStats('Fives' as any)\r\n  const statsSevens = useOfflineGameStats('Sevens' as any)\r\n\r\n  const activeScoreboardStats = useMemo(() => {\r\n    const list = statsX01 || []\r\n    const playerResolvedLastScore = playerVisitDarts > 0\r\n      ? playerVisitSum\r\n      : (playerLastVisitScore ?? playerLastDart)\r\n    const aiResolvedLastScore = aiVisitDarts > 0\r\n      ? aiVisitSum\r\n      : (aiLastVisitScore ?? aiLastDart)\r\n    if (list.length === 0) {\r\n      return {\r\n        name: isPlayerTurn ? humanName : aiDisplayName,\r\n        isCurrentTurn: true,\r\n        legsWon: isPlayerTurn ? playerLegs : aiLegs,\r\n        score: isPlayerTurn ? playerScore : aiScore,\r\n        lastScore: isPlayerTurn ? playerResolvedLastScore : aiResolvedLastScore,\r\n      } as PlayerStats\r\n    }\r\n    return list.find(player => player.isCurrentTurn) ?? list[0]\r\n  }, [\r\n    statsX01,\r\n    isPlayerTurn,\r\n    humanName,\r\n    aiDisplayName,\r\n    playerLegs,\r\n    aiLegs,\r\n    playerScore,\r\n    aiScore,\r\n    playerVisitDarts,\r\n    playerVisitSum,\r\n    playerLastVisitScore,\r\n    playerLastDart,\r\n    aiVisitSum,\r\n    aiLastVisitScore,\r\n    aiLastDart,\r\n    aiVisitDarts,\r\n  ])\r\n\r\n  const singlePlayerScoreboard: PlayerStats[] = useMemo(() => {\r\n    if (!activeScoreboardStats) return []\r\n    const { matchAvg, allTimeAvg, ...rest } = activeScoreboardStats\r\n    return [{ ...rest, matchAvg: undefined, allTimeAvg: undefined } as PlayerStats]\r\n  }, [activeScoreboardStats])\r\n\r\n  const inactivePlayerName = isPlayerTurn ? aiDisplayName : humanName\r\n  const activePlayerName = activeScoreboardStats?.name ?? (isPlayerTurn ? humanName : aiDisplayName)\r\n  const activeRemaining = isPlayerTurn ? playerScore : aiScore\r\n  const activeLastScore = isPlayerTurn\r\n    ? (playerVisitDarts > 0 ? playerVisitSum : (playerLastVisitScore ?? playerLastDart))\r\n    : (aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart))\r\n\r\n  const recordDart = useCallback((mode: string, count = 1) => {\r\n    if (!mode || count <= 0) return\r\n    setDartCounts(prev => ({\r\n      ...prev,\r\n      [mode]: (prev[mode] || 0) + count\r\n    }))\r\n  }, [])\r\n\r\n  const resetDartCount = useCallback((mode: string) => {\r\n    if (!mode) return\r\n    setDartCounts(prev => {\r\n      if (prev[mode] === undefined) return prev\r\n      return { ...prev, [mode]: 0 }\r\n    })\r\n  }, [])\r\n\r\n  const activeModeDarts = dartCounts[selectedMode] || 0\r\n\r\n  const parseManualScoreOverride = (value: string): number | null => {\r\n    if (!value.trim()) return null\r\n    const parsed = Number(value)\r\n    if (!Number.isFinite(parsed)) return null\r\n    return clamp(Math.round(parsed), 0, x01Score)\r\n  }\r\n\r\n  const parseManualLegsOverride = (value: string): number | null => {\r\n    if (!value.trim()) return null\r\n    const parsed = Number(value)\r\n    if (!Number.isFinite(parsed)) return null\r\n    return Math.max(0, Math.round(parsed))\r\n  }\r\n\r\n  const cancelPendingAutoVisit = useCallback(() => {\r\n    if (pendingVisitRef.current) {\r\n      pendingVisitRef.current = null\r\n    }\r\n    clearPendingVisitTimer()\r\n    setAwaitingBoardClear(false)\r\n  }, [clearPendingVisitTimer])\r\n\r\n  const applyPlayerScoreOverride = useCallback((nextScore: number) => {\r\n    const safeScore = clamp(nextScore, 0, x01Score)\r\n    cancelPendingAutoVisit()\r\n    setPlayerScore(safeScore)\r\n    playerScoreRef.current = safeScore\r\n\r\n    const nextVisitStart = safeScore === 0 ? x01Score : safeScore\r\n    setPlayerVisitStart(nextVisitStart)\r\n    playerVisitStartRef.current = nextVisitStart\r\n\r\n    setPlayerVisitSum(0)\r\n    playerVisitSumRef.current = 0\r\n    setPlayerVisitDarts(0)\r\n    playerVisitDartsRef.current = 0\r\n    setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n\r\n    setPlayerLastVisitScore(null)\r\n    setPlayerLastDart(0)\r\n    setPlayerDartPoints(0)\r\n    lastBounceMissTsRef.current = 0\r\n\r\n    if (safeScore === 0) {\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n    } else {\r\n      setPendingLegWinner(null)\r\n      setShowWinPopup(false)\r\n    }\r\n  }, [cancelPendingAutoVisit, setPlayerScore, x01Score, setPlayerVisitStart, setPlayerVisitSum, setPlayerVisitDarts, setPlayerVisitDartsAtDouble, setPlayerLastVisitScore, setPlayerLastDart, setPlayerDartPoints, setPendingLegWinner, setShowWinPopup])\r\n\r\n  const handleManualScoreOverride = (target: 'player' | 'ai') => {\r\n    const source = target === 'player' ? manualPlayerScoreInput : manualOpponentScoreInput\r\n    const parsed = parseManualScoreOverride(source)\r\n    if (parsed === null) {\r\n      toast(`Enter a number between 0 and ${x01Score}`, { type: 'error', timeout: 2500 })\r\n      return\r\n    }\r\n    if (target === 'player') {\r\n      applyPlayerScoreOverride(parsed)\r\n      setManualPlayerScoreInput('')\r\n      return\r\n    } else {\r\n      setAiScore(parsed)\r\n      setAiVisitSum(0)\r\n      setAiVisitDarts(0)\r\n      setAiLastVisitScore(null)\r\n      setAiVisitDartsAtDouble(0)\r\n      setAiLastDart(0)\r\n      setManualOpponentScoreInput('')\r\n    }\r\n    setPendingLegWinner(null)\r\n    setShowWinPopup(false)\r\n  }\r\n\r\n  const applyManualLegOverride = useCallback((target: 'player' | 'ai', value: number) => {\r\n    if (target === 'player') {\r\n      setPlayerLegs(value)\r\n      setManualPlayerLegsInput('')\r\n    } else {\r\n      setAiLegs(value)\r\n      setManualOpponentLegsInput('')\r\n    }\r\n    setPendingLegWinner(null)\r\n    setShowWinPopup(false)\r\n  }, [setAiLegs, setManualOpponentLegsInput, setManualPlayerLegsInput, setPendingLegWinner, setPlayerLegs, setShowWinPopup])\r\n\r\n  const handleManualLegsOverride = (target: 'player' | 'ai') => {\r\n    const source = target === 'player' ? manualPlayerLegsInput : manualOpponentLegsInput\r\n    const parsed = parseManualLegsOverride(source)\r\n    if (parsed === null) {\r\n      toast('Enter a non-negative whole number for legs', { type: 'error', timeout: 2500 })\r\n      return\r\n    }\r\n    setLegOverrideConfirm({ target, value: parsed, stage: 1 })\r\n  }\r\n\r\n  const handleLegOverrideYes = useCallback(() => {\r\n    setLegOverrideConfirm(prev => {\r\n      if (!prev) return prev\r\n      if (prev.stage === 1) return { ...prev, stage: 2 }\r\n      applyManualLegOverride(prev.target, prev.value)\r\n      return null\r\n    })\r\n  }, [applyManualLegOverride])\r\n\r\n  const handleLegOverrideNo = useCallback(() => {\r\n    setLegOverrideConfirm(null)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (!legOverrideConfirm) return\r\n    const handleKey = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        event.preventDefault()\r\n        handleLegOverrideNo()\r\n      }\r\n    }\r\n    window.addEventListener('keydown', handleKey)\r\n    return () => window.removeEventListener('keydown', handleKey)\r\n  }, [handleLegOverrideNo, legOverrideConfirm])\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case 'small': return 'px-1.5 py-0.5 text-xs'\r\n      case 'large': return 'px-3 py-1 text-sm'\r\n      default: return 'px-2 py-0.5 text-sm'\r\n    }\r\n  }\r\n  const buttonSizeClass = getButtonSizeClasses(textSize)\r\n  // Fit-all scaling measurement\r\n  const scrollerRef = useRef<HTMLDivElement | null>(null)\r\n  const contentRef = useRef<HTMLDivElement | null>(null)\r\n  const headerBarRef = useRef<HTMLDivElement | null>(null)\r\n  // Match format controls (offline only): First to N or Best of N with editable count\r\n  const [formatType, setFormatType] = useState<'first'|'best'>('first')\r\n  const [formatCount, setFormatCount] = useState<number>(1)\r\n  const formatRef = useRef<HTMLDivElement | null>(null)\r\n  // Keep internal required wins (firstTo) in sync with format selection\r\n  useEffect(() => {\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1))\r\n    const wins = formatType === 'first' ? n : Math.max(1, Math.ceil(n / 2))\r\n    setFirstTo(wins)\r\n  }, [formatType, formatCount])\r\n  useEffect(() => {\r\n    if (!fitAll) {\r\n      setFitScale(1)\r\n      setFitOverflowing(false)\r\n      return\r\n    }\r\n    const measure = () => {\r\n      const scroller = scrollerRef.current\r\n      const content = contentRef.current\r\n      if (!scroller || !content) return\r\n      // Available size excludes the sticky header inside the scroller\r\n      const headerH = headerBarRef.current ? headerBarRef.current.getBoundingClientRect().height : 0\r\n      const availH = Math.max(0, scroller.clientHeight - headerH - 6) // small breathing room\r\n      const availW = Math.max(0, scroller.clientWidth - 8)\r\n      // Measure the content size without scale\r\n      const rect = content.getBoundingClientRect()\r\n      const currentScale = fitScale || 1\r\n      const naturalHeight = rect.height / currentScale\r\n      const naturalWidth = rect.width / currentScale\r\n      // Compute scale to fit both height and width\r\n      const scaleH = availH > 0 ? (availH / naturalHeight) : 1\r\n      const scaleW = availW > 0 ? (availW / naturalWidth) : 1\r\n  const next = Math.min(1, Math.max(0.5, Math.min(scaleH, scaleW)))\r\n  const scaledHeight = naturalHeight * next\r\n  const overflowing = availH > 0 && (scaledHeight - availH) > 1\r\n  setFitOverflowing(overflowing)\r\n  setFitScale(next)\r\n    }\r\n    measure()\r\n  const RO: any = (window as any).ResizeObserver\r\n  const ro = RO ? new RO(() => measure()) : null\r\n  ro && scrollerRef.current && ro.observe(scrollerRef.current as any)\r\n  ro && contentRef.current && ro.observe(contentRef.current as any)\r\n    window.addEventListener('resize', measure)\r\n    return () => {\r\n      window.removeEventListener('resize', measure)\r\n      try { ro && scrollerRef.current && ro.unobserve(scrollerRef.current as any) } catch {}\r\n      try { ro && contentRef.current && ro.unobserve(contentRef.current as any) } catch {}\r\n    }\r\n  }, [fitAll, fitScale])\r\n\r\n\r\n  // Auto-start handler (from Home or other tabs)\r\n  useEffect(() => {\r\n    const onAuto = (e: any) => {\r\n      const m = e?.detail?.mode as string | undefined\r\n      if (!m) return\r\n      setSelectedMode(m)\r\n      // For Double Practice we could load a specific flow. For now, we just open the X01-like modal with immediate start.\r\n      startMatch()\r\n    }\r\n    window.addEventListener('ndn:auto-start', onAuto as any)\r\n    return () => window.removeEventListener('ndn:auto-start', onAuto as any)\r\n  }, [])\r\n\r\n  // Accept demo parameters to preconfigure format and starting score before auto-start\r\n  useEffect(() => {\r\n    const onFmt = (e: any) => {\r\n      const t = e?.detail?.formatType\r\n      const c = e?.detail?.formatCount\r\n      const s = e?.detail?.startScore\r\n      if (t === 'first' || t === 'best') setFormatType(t)\r\n      if (typeof c === 'number' && isFinite(c)) setFormatCount(Math.max(1, Math.floor(c)))\r\n      if (typeof s === 'number' && isFinite(s)) setX01Score(Math.max(1, Math.floor(s)))\r\n    }\r\n    window.addEventListener('ndn:offline-format', onFmt as any)\r\n    return () => window.removeEventListener('ndn:offline-format', onFmt as any)\r\n  }, [])\r\n\r\n  // Auto-start last offline match when opening this tab, if enabled\r\n  useEffect(() => {\r\n    if (!autoStartOffline) return\r\n    // Kick off a match after initial render for a smooth modal open\r\n    const id = setTimeout(() => startMatch(), 50)\r\n    return () => clearTimeout(id)\r\n  }, [autoStartOffline])\r\n\r\n  // Drive AI countdown and perform AI visit when countdown elapses\r\n  useEffect(() => {\r\n    if (!showMatchModal || isPlayerTurn || ai === 'None' || aiCountdownMs <= 0) return\r\n    let raf: number\r\n    let last = performance.now()\r\n    const tick = (now: number) => {\r\n      const dt = now - last\r\n      last = now\r\n      setAiCountdownMs(prev => {\r\n        const next = prev - dt\r\n        if (next <= 0) {\r\n          // Execute AI visit per dart (up to 3 darts or until finish/bust)\r\n          let visitDarts = 0\r\n          let visitTotal = 0\r\n          let remaining = aiScore\r\n          setAiVisitDarts(0)\r\n          while (visitDarts < 3 && remaining > 0) {\r\n            const targetVisit = aiVisitScore(remaining, ai)\r\n            // break target into up to 3 darts (roughly 20 per dart for easy split)\r\n            const dart = clamp(targetVisit - visitDarts*20, 0, Math.min(60, remaining))\r\n            const after = remaining - dart\r\n            setAiLastDart(dart)\r\n            setAiDartsThrown(d => d + 1)\r\n            setTotalAiDarts(d => d + 1)\r\n            if (after < 0) {\r\n              // bust: revert to remaining before visit\r\n              remaining = aiScore\r\n              setAiVisitSum(0)\r\n              setAiVisitDartsAtDouble(0)\r\n              visitTotal = 0\r\n              setAiLastVisitScore(0)\r\n              setAiVisitDarts(0)\r\n              break\r\n            }\r\n            // Only add points after confirming not a bust\r\n            visitTotal += dart\r\n            setAiVisitSum(s => s + dart)\r\n            setTotalAiPoints(p => p + dart)\r\n            // Track darts at double window\r\n            const preRem = remaining\r\n            const postRem = after\r\n            if (preRem > 50 && postRem <= 50) setAiVisitDartsAtDouble(1)\r\n            else if (preRem <= 50) setAiVisitDartsAtDouble(c => c + 1)\r\n            remaining = after\r\n            visitDarts += 1\r\n            setAiVisitDarts(visitDarts)\r\n            if (remaining === 0) break\r\n          }\r\n          setAiScore(remaining)\r\n          if (remaining === 0) {\r\n            // Power score classification\r\n            if (visitTotal === 180) setAi180s(n => n + 1)\r\n            else if (visitTotal >= 140) setAi140s(n => n + 1)\r\n            else if (visitTotal >= 100) setAi100s(n => n + 1)\r\n            // Highest checkout\r\n            const checkout = aiScore\r\n            if (checkout <= 170) setAiHighestCheckout(h => Math.max(h, checkout))\r\n            // Doubles attempts/hit if finished from <= 50\r\n            if (aiScore <= 50) {\r\n              setAiDoublesAtt(a => a + (aiVisitDartsAtDouble > 0 ? aiVisitDartsAtDouble : 1))\r\n              setAiDoublesHit(h => h + 1)\r\n            }\r\n            setAiLastVisitScore(visitTotal)\r\n            setAiVisitSum(0)\r\n            setAiVisitDartsAtDouble(0)\r\n            setAiVisitDarts(0)\r\n            // AI won the leg\r\n            setPendingLegWinner('ai')\r\n            setShowWinPopup(true)\r\n          }\r\n          // If AI did not finish, but threw 3 darts this visit, classify power score and reset visit sum\r\n          if (remaining > 0 && visitDarts >= 3) {\r\n            if (visitTotal === 180) setAi180s(n => n + 1)\r\n            else if (visitTotal >= 140) setAi140s(n => n + 1)\r\n            else if (visitTotal >= 100) setAi100s(n => n + 1)\r\n            setAiLastVisitScore(visitTotal)\r\n            setAiVisitSum(0)\r\n            setAiVisitDartsAtDouble(0)\r\n            setAiVisitDarts(0)\r\n          }\r\n          // Hand turn back to player\r\n          setAiVisitDarts(0)\r\n          setIsPlayerTurn(true)\r\n          return 0\r\n        }\r\n        return next\r\n      })\r\n      raf = requestAnimationFrame(tick)\r\n    }\r\n    raf = requestAnimationFrame(tick)\r\n    return () => cancelAnimationFrame(raf)\r\n  }, [showMatchModal, isPlayerTurn, ai, aiScore])\r\n\r\n  useEffect(() => {\r\n    if (!match.inProgress) return\r\n    if (startedShowcasedRef.current) return\r\n    setShowStartShowcase(true)\r\n    startedShowcasedRef.current = true\r\n  }, [match.inProgress])\r\n\r\n  function startMatch() {\r\n    setInMatch(true);\r\n    setPlayerScore(x01Score);\r\n  playerScoreRef.current = x01Score\r\n    setAiScore(x01Score);\r\n    setOnDouble(false);\r\n    setShowMatchModal(true);\r\n    setIsPlayerTurn(true);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown(0);\r\n    setPlayerLastDart(0);\r\n    setPlayerVisitDarts(0);\r\n  playerVisitDartsRef.current = 0\r\n    setPlayerVisitStart(x01Score);\r\n    setPlayerVisitSum(0)\r\n    setPlayerLastVisitScore(null)\r\n  setPlayerVisitDartsAtDouble(0)\r\n    setAiCountdownMs(0);\r\n    setAiDartsThrown(0);\r\n    setAiLastDart(0);\r\n  setAiVisitSum(0)\r\n  setAiVisitDarts(0)\r\n    setAiLastVisitScore(null)\r\n    setPendingLegWinner(null)\r\n    // When starting a brand-new match from menu, reset legs\r\n  setPlayerLegs(0)\r\n  setAiLegs(0)\r\n    setLegStats([])\r\n  // Reset Treble Practice session state when starting a new match\r\n  setTrebleHits(0); setTrebleDarts(0); setTrebleFinished(false)\r\n    // Reset match-long totals\r\n    setTotalPlayerDarts(0); setTotalAiDarts(0)\r\n    setTotalPlayerPoints(0); setTotalAiPoints(0)\r\n    setPlayer180s(0); setPlayer140s(0); setPlayer100s(0)\r\n    setAi180s(0); setAi140s(0); setAi100s(0)\r\n    setPlayerHighestCheckout(0); setAiHighestCheckout(0)\r\n    setPlayerDoublesAtt(0); setPlayerDoublesHit(0)\r\n    setAiDoublesAtt(0); setAiDoublesHit(0)\r\n  resetDartCount('X01')\r\n    // Sync required wins from current format selection\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1))\r\n    setFirstTo(formatType === 'first' ? n : Math.max(1, Math.ceil(n/2)))\r\n    if (rememberLastOffline) {\r\n      try { setLastOffline({ mode: selectedMode, x01Start: x01Score, firstTo, aiLevel: ai }) } catch {}\r\n    }\r\n  }\r\n\r\n  function startNextLeg() {\r\n    setPlayerScore(x01Score)\r\n  playerScoreRef.current = x01Score\r\n    setAiScore(x01Score)\r\n    setOnDouble(false)\r\n    setShowMatchModal(true)\r\n    setIsPlayerTurn(true)\r\n    setPlayerDartPoints(0)\r\n    setPlayerDartsThrown(0)\r\n    setPlayerLastDart(0)\r\n    setPlayerVisitDarts(0)\r\n  playerVisitDartsRef.current = 0\r\n    setPlayerVisitStart(x01Score)\r\n    setPlayerVisitSum(0)\r\n    playerVisitStartRef.current = x01Score\r\n    playerVisitSumRef.current = 0\r\n    setPlayerLastVisitScore(null)\r\n  setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n    setAiCountdownMs(0)\r\n    setAiDartsThrown(0)\r\n    setAiLastDart(0)\r\n    setAiVisitSum(0)\r\n    setAiVisitDarts(0)\r\n    setAiLastVisitScore(null)\r\n    setPendingLegWinner(null)\r\n  }\r\n\r\n  // --- Offline per-dart helpers ---\r\n  function endTurn(nextRemaining: number) {\r\n    setPlayerVisitDarts(0)\r\n    playerVisitDartsRef.current = 0\r\n    setPlayerVisitStart(nextRemaining === 0 ? x01Score : nextRemaining)\r\n    playerVisitStartRef.current = (nextRemaining === 0 ? x01Score : nextRemaining)\r\n    setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n    if (ai !== 'None') {\r\n      setIsPlayerTurn(false)\r\n      setAiCountdownMs(aiDelayMs)\r\n    } else {\r\n      setAiCountdownMs(0)\r\n      setIsPlayerTurn(true)\r\n    }\r\n  }\r\n\r\n  function applyDartValue(dart: number) {\r\n    if (waitForBoardClear && pendingVisitRef.current) {\r\n      if (!awaitingBoardClear) setAwaitingBoardClear(true)\r\n      toast('Remove your darts before starting the next throw', { type: 'info', timeout: 1800 })\r\n      return\r\n    }\r\n    recordDart('X01')\r\n    const currentScore = playerScoreRef.current\r\n    const currentVisitDarts = playerVisitDartsRef.current\r\n    const currentVisitSum = playerVisitSumRef.current\r\n    const currentVisitStart = playerVisitStartRef.current\r\n    const currentVisitDartsAtDouble = playerVisitDartsAtDoubleRef.current\r\n    const remaining = currentScore - dart\r\n    const newVisitDarts = currentVisitDarts + 1\r\n\r\n    setPlayerLastDart(dart)\r\n    setPlayerDartsThrown(d => d + 1)\r\n    setTotalPlayerDarts(d => d + 1)\r\n\r\n    if (remaining < 0) {\r\n      try {\r\n        const preRemaining = currentScore\r\n        const postRemaining = currentVisitStart\r\n        useAudit.getState().recordVisit('offline-x01', newVisitDarts, 0, { preRemaining, postRemaining, bust: true, finish: false })\r\n      } catch {}\r\n      setPlayerScore(currentVisitStart)\r\n      playerScoreRef.current = currentVisitStart\r\n\r\n      if (currentScore <= 50) {\r\n        const attemptsThisVisit = (currentVisitDartsAtDouble || 0) + 1\r\n        setPlayerDoublesAtt(a => a + attemptsThisVisit)\r\n      }\r\n\r\n      if (callerEnabled) {\r\n        try { sayScore(user?.username || 'Player', 0, Math.max(currentVisitStart, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n      }\r\n\r\n      setPlayerLastVisitScore(0)\r\n      setPlayerDartPoints(0)\r\n      setPlayerVisitSum(0)\r\n      playerVisitSumRef.current = 0\r\n      setPlayerVisitDartsAtDouble(0)\r\n      playerVisitDartsAtDoubleRef.current = 0\r\n      endTurn(currentVisitStart)\r\n      return\r\n    }\r\n\r\n    setPlayerScore(remaining)\r\n    playerScoreRef.current = remaining\r\n\r\n    setPlayerVisitDarts(newVisitDarts)\r\n    playerVisitDartsRef.current = newVisitDarts\r\n    const newVisitSum = currentVisitSum + dart\r\n    setPlayerVisitSum(newVisitSum)\r\n    playerVisitSumRef.current = newVisitSum\r\n\r\n    setTotalPlayerPoints(p => p + dart)\r\n    setPlayerDartPoints(0)\r\n\r\n    const preRemaining = currentScore\r\n    const postRemaining = remaining\r\n    const startedDoubleWindow = preRemaining > 50 && postRemaining <= 50\r\n    const stillInDoubleWindow = preRemaining <= 50\r\n    if (startedDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(1)\r\n      playerVisitDartsAtDoubleRef.current = 1\r\n    } else if (stillInDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(c => c + 1)\r\n      playerVisitDartsAtDoubleRef.current = (currentVisitDartsAtDouble || 0) + 1\r\n    }\r\n\r\n    const doubleAttemptsNow = playerVisitDartsAtDoubleRef.current || 0\r\n    const inDoubleWindow = preRemaining <= 50\r\n    const attemptsForVisit = inDoubleWindow ? Math.max(doubleAttemptsNow, Math.min(newVisitDarts, 3)) : 0\r\n\r\n    if (remaining === 0) {\r\n      const pending: PendingAutoVisit = {\r\n        visitTotal: newVisitSum,\r\n        darts: newVisitDarts,\r\n        preRemaining: currentScore,\r\n        remaining: 0,\r\n        doubleAttempts: attemptsForVisit,\r\n        finished: true,\r\n        doubleWindow: inDoubleWindow,\r\n        highestCheckout: currentVisitStart <= 170 ? currentVisitStart : null,\r\n      }\r\n      if (waitForBoardClear) {\r\n        queuePendingVisit(pending)\r\n      } else {\r\n        commitPendingVisit(pending, 'immediate')\r\n      }\r\n      return\r\n    }\r\n\r\n    if (newVisitDarts >= 3) {\r\n      const pending: PendingAutoVisit = {\r\n        visitTotal: newVisitSum,\r\n        darts: newVisitDarts,\r\n        preRemaining: currentScore,\r\n        remaining,\r\n        doubleAttempts: attemptsForVisit,\r\n        finished: false,\r\n        doubleWindow: inDoubleWindow,\r\n        highestCheckout: null,\r\n      }\r\n      if (waitForBoardClear) {\r\n        queuePendingVisit(pending)\r\n      } else {\r\n        commitPendingVisit(pending, 'immediate')\r\n      }\r\n      return\r\n    }\r\n  }\r\n\r\n  function addDartNumeric() {\r\n    const dart = clamp(Math.round(Number(playerDartPoints) || 0), 0, 60)\r\n    applyDartValue(dart)\r\n  }\r\n\r\n  function commitManualVisitTotal(rawTotal: number): boolean {\r\n    if (!Number.isFinite(rawTotal)) return false\r\n\r\n    const visitStart = playerVisitStartRef.current\r\n    const liveScore = playerScoreRef.current\r\n    const existingDarts = playerVisitDartsRef.current\r\n    const existingSum = playerVisitSumRef.current\r\n    const hadPartialVisit = existingDarts > 0 || existingSum > 0\r\n\r\n    if (hadPartialVisit) {\r\n      setPlayerScore(visitStart)\r\n      playerScoreRef.current = visitStart\r\n      setPlayerVisitDarts(0)\r\n      playerVisitDartsRef.current = 0\r\n      setPlayerVisitSum(0)\r\n      playerVisitSumRef.current = 0\r\n      setPlayerVisitDartsAtDouble(0)\r\n      playerVisitDartsAtDoubleRef.current = 0\r\n      setPlayerLastDart(0)\r\n      setPlayerDartPoints(0)\r\n      setPlayerDartsThrown(d => Math.max(0, d - existingDarts))\r\n      setTotalPlayerDarts(d => Math.max(0, d - existingDarts))\r\n      setTotalPlayerPoints(p => Math.max(0, p - existingSum))\r\n      lastBounceMissTsRef.current = 0\r\n    }\r\n\r\n    const preRemaining = hadPartialVisit ? visitStart : liveScore\r\n    const checkoutCap = preRemaining <= 170 ? 170 : 180\r\n    const total = clamp(Math.round(rawTotal), 0, checkoutCap)\r\n\r\n    recordDart('X01', 3)\r\n    setPlayerDartsThrown(d => d + 3)\r\n    setTotalPlayerDarts(d => d + 3)\r\n    setPlayerVisitDarts(3)\r\n    playerVisitDartsRef.current = 3\r\n    setPlayerVisitSum(total)\r\n    playerVisitSumRef.current = total\r\n    setPlayerLastVisitScore(total)\r\n\r\n    if (total === 180) setPlayer180s(n => n + 1)\r\n    else if (total >= 140) setPlayer140s(n => n + 1)\r\n    else if (total >= 100) setPlayer100s(n => n + 1)\r\n\r\n    const remaining = preRemaining - total\r\n\r\n    if (remaining < 0) {\r\n      if (callerEnabled) {\r\n        try { sayScore(humanName, 0, Math.max(visitStart, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n      }\r\n      try {\r\n        useAudit.getState().recordVisit('offline-x01', 3, 0, { preRemaining, postRemaining: visitStart, bust: true, finish: false })\r\n      } catch {}\r\n      setPlayerScore(visitStart)\r\n      playerScoreRef.current = visitStart\r\n      setPlayerLastVisitScore(0)\r\n      setPlayerVisitSum(0)\r\n      playerVisitSumRef.current = 0\r\n      setPlayerVisitDarts(0)\r\n      playerVisitDartsRef.current = 0\r\n      setPlayerVisitDartsAtDouble(0)\r\n      playerVisitDartsAtDoubleRef.current = 0\r\n      endTurn(visitStart)\r\n      return true\r\n    }\r\n\r\n    setPlayerScore(remaining)\r\n    playerScoreRef.current = remaining\r\n    setTotalPlayerPoints(p => p + total)\r\n\r\n    if (callerEnabled) {\r\n      try { sayScore(humanName, total, Math.max(remaining, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n    }\r\n\r\n    if (preRemaining <= 50) {\r\n      setPlayerDoublesAtt(a => a + 3)\r\n      if (remaining === 0) setPlayerDoublesHit(h => h + 1)\r\n    }\r\n\r\n    if (remaining === 0) {\r\n      if (preRemaining <= 170) setPlayerHighestCheckout(h => Math.max(h, preRemaining))\r\n      try {\r\n        useAudit.getState().recordVisit('offline-x01', 3, total, { preRemaining, postRemaining: 0, finish: true, bust: false })\r\n      } catch {}\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n      setPlayerVisitDarts(0)\r\n      playerVisitDartsRef.current = 0\r\n      setPlayerVisitSum(0)\r\n      playerVisitSumRef.current = 0\r\n      setPlayerVisitDartsAtDouble(0)\r\n      playerVisitDartsAtDoubleRef.current = 0\r\n      return true\r\n    }\r\n\r\n    try {\r\n      useAudit.getState().recordVisit('offline-x01', 3, total, { preRemaining, postRemaining: remaining, finish: false, bust: false })\r\n    } catch {}\r\n    endTurn(remaining)\r\n    setPlayerVisitSum(0)\r\n    playerVisitSumRef.current = 0\r\n    setPlayerVisitDarts(0)\r\n    playerVisitDartsRef.current = 0\r\n    setPlayerVisitDartsAtDouble(0)\r\n    playerVisitDartsAtDoubleRef.current = 0\r\n    return true\r\n  }\r\n\r\n  // Once local commit and endTurn functions are defined, create the unified offline actions wrapper\r\n  const matchActions: UnifiedMatchActions = createOfflineMatchActions({ match, commitManualVisitTotal, endTurn })\r\n\r\n  // Optional: Add a full-visit total (0â€“180) input for quick entry like \"93\"\r\n  const [visitTotalInput, setVisitTotalInput] = useState<string>(\"\")\r\n  const handleVisitTotalChange = (raw: string) => {\r\n    if (!raw) {\r\n      setVisitTotalInput('')\r\n      return\r\n    }\r\n    const numericOnly = raw.replace(/[^0-9]/g, '')\r\n    if (!numericOnly) {\r\n      setVisitTotalInput('')\r\n      return\r\n    }\r\n    const parsed = Number(numericOnly)\r\n    if (!Number.isFinite(parsed)) return\r\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180\r\n    const safe = clamp(Math.round(parsed), 0, maxAllowed)\r\n    setVisitTotalInput(String(safe))\r\n  }\r\n  function addVisitTotal() {\r\n    if (!visitTotalInput) { alert('Enter a number 0â€“180 for visit total'); return }\r\n    const parsed = Number(visitTotalInput)\r\n    if (!Number.isFinite(parsed)) { alert('Enter a number 0â€“180 for visit total'); return }\r\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180\r\n    const bounded = clamp(Math.round(parsed), 0, maxAllowed)\r\n    if (parsed > maxAllowed) {\r\n      toast(`Visit totals cannot exceed ${maxAllowed}.`, { type: 'info', timeout: 2200 })\r\n    }\r\n    if (commitManualVisitTotal(bounded)) {\r\n      setVisitTotalInput(\"\")\r\n    }\r\n  }\r\n\r\n  const clearCurrentVisit = useCallback(() => {\r\n    if (pendingVisitRef.current) {\r\n      pendingVisitRef.current = null\r\n      clearPendingVisitTimer()\r\n      setAwaitingBoardClear(false)\r\n    }\r\n    const visitDarts = playerVisitDartsRef.current\r\n    const visitTotal = playerVisitSumRef.current\r\n    const visitStart = playerVisitStartRef.current\r\n    if (visitDarts === 0 && visitTotal === 0) return\r\n    setPlayerScore(visitStart)\r\n  playerScoreRef.current = visitStart\r\n    setPlayerVisitDarts(0)\r\n  playerVisitDartsRef.current = 0\r\n    setPlayerVisitSum(0)\r\n  playerVisitSumRef.current = 0\r\n    setPlayerVisitDartsAtDouble(0)\r\n  playerVisitDartsAtDoubleRef.current = 0\r\n    setPlayerLastDart(0)\r\n    setPlayerDartPoints(0)\r\n    setPlayerDartsThrown(d => Math.max(0, d - visitDarts))\r\n    setTotalPlayerDarts(d => Math.max(0, d - visitDarts))\r\n    setTotalPlayerPoints(p => Math.max(0, p - visitTotal))\r\n    lastBounceMissTsRef.current = 0\r\n  }, [clearPendingVisitTimer])\r\n\r\n  useEffect(() => {\r\n    const onClearRequest = (evt: Event) => {\r\n      const detail = (evt as CustomEvent)?.detail\r\n      if (!detail || detail?.source === 'offline-play') return\r\n      clearCurrentVisit()\r\n    }\r\n    window.addEventListener('ndn:clear-visit-request', onClearRequest as EventListener)\r\n    return () => window.removeEventListener('ndn:clear-visit-request', onClearRequest as EventListener)\r\n  }, [clearCurrentVisit])\r\n\r\n  // --- Double Practice helpers ---\r\n  function addDpValue(val: number) {\r\n    recordDart('Double Practice')\r\n    const dart = clamp(Math.round(val || 0), 0, 60)\r\n    setPlayerLastDart(dart)\r\n    setPlayerDartsThrown(d => d + 1)\r\n    setTotalPlayerDarts(d => d + 1)\r\n    if (isDoubleHit(dart, dpIndex)) {\r\n      const nextHits = dpHits + 1\r\n      setDpHits(nextHits)\r\n      setDpIndex(i => Math.min(20, i + 1))\r\n      // End when DBULL (index 20) is hit\r\n      if (nextHits >= 21) {\r\n        setPendingLegWinner('player')\r\n        setShowWinPopup(true)\r\n      }\r\n    }\r\n    setPlayerDartPoints(0)\r\n  }\r\n  function addDpNumeric() { addDpValue(Number(playerDartPoints)) }\r\n  function addDpManual() {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like D16, 50, 25, T20'); return }\r\n    addDpValue(v)\r\n    setManualBox('')\r\n  }\r\n\r\n  // Bob's 27\r\n  function addB27Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (b27Finished) return\r\n    recordDart(\"Bob's 27\")\r\n    const target = b27Stage\r\n    const hit = (ring === 'DOUBLE' && sector === target) || (!ring && value === target * 2)\r\n    if (hit) setB27Hits(h => h + 1)\r\n    setB27Darts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        const totalHits = b27Hits + (hit ? 1 : 0)\r\n        if (totalHits > 0) setB27Score(s => s + totalHits * target * 2)\r\n        else setB27Score(s => s - target * 2)\r\n        const next = target + 1\r\n        setB27Stage(next)\r\n        setB27Hits(0)\r\n        if (next > 20) setB27Finished(true)\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addB27Numeric() { addB27Auto(Math.max(0, playerDartPoints | 0)); setPlayerDartPoints(0) }\r\n  function resetB27() { setB27Stage(1); setB27Score(27); setB27Darts(0); setB27Hits(0); setB27Finished(false); resetDartCount(\"Bob's 27\") }\r\n\r\n  // Count-Up / High Score / Low Score\r\n  function addCountUpAuto(value: number) {\r\n    recordDart('Count-Up')\r\n    setCuScore(s => s + Math.max(0, value | 0))\r\n    setCuDarts(d => { const nd = d + 1; if (nd >= 3) { setCuRound(r => r + 1); return 0 } return nd })\r\n  }\r\n  function addHighScoreAuto(value: number) {\r\n    recordDart('High Score')\r\n    setHsScore(s => s + Math.max(0, value | 0))\r\n    setHsDarts(d => { const nd = d + 1; if (nd >= 3) { setHsRound(r => r + 1); return 0 } return nd })\r\n  }\r\n  function addLowScoreAuto(value: number) {\r\n    recordDart('Low Score')\r\n    setLsScore(s => s + Math.max(0, value | 0))\r\n    setLsDarts(d => { const nd = d + 1; if (nd >= 3) { setLsRound(r => r + 1); return 0 } return nd })\r\n  }\r\n\r\n  // Checkout routines (double out)\r\n  function applyCheckout(rem: number, setRem: (n:number)=>void, darts: number, setDarts: (f:(n:number)=>number)=>void, setAttempts: (f:(n:number)=>number)=>void, setSuccesses: (f:(n:number)=>number)=>void, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') {\r\n    const next = rem - value\r\n    if (next < 0) {\r\n      // bust: ignore progress during attempt\r\n    } else if (next === 0) {\r\n      if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n        setSuccesses(s => s + 1)\r\n        setAttempts(a => a + 1)\r\n        setDarts(() => 0)\r\n        setRem(rem) // caller will reset to initial value right after\r\n        return\r\n      }\r\n      setRem(next)\r\n    } else {\r\n      setRem(next)\r\n    }\r\n    setDarts(d => { const nd = d + 1; if (nd >= 3) { setAttempts(a => a + 1); return 0 } return nd })\r\n  }\r\n  function addCo170Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') {\r\n    recordDart('Checkout 170')\r\n    applyCheckout(co170Rem, setCo170Rem, co170Darts, setCo170Darts, setCo170Attempts, setCo170Successes, value, ring)\r\n    if (co170Darts + 1 >= 3) setCo170Rem(170)\r\n  }\r\n  function addCo121Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') {\r\n    recordDart('Checkout 121')\r\n    applyCheckout(co121Rem, setCo121Rem, co121Darts, setCo121Darts, setCo121Attempts, setCo121Successes, value, ring)\r\n    if (co121Darts + 1 >= 3) setCo121Rem(121)\r\n  }\r\n  function addCoManual(is170: boolean) {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like T20, D16, 25, 50'); return }\r\n    const t = manualBox.trim().toUpperCase()\r\n    const isDouble = t.startsWith('D') || t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL' || t.includes('INNER')\r\n    if (is170) addCo170Auto(v, isDouble ? 'DOUBLE' : undefined); else addCo121Auto(v, isDouble ? 'DOUBLE' : undefined)\r\n    setManualBox('')\r\n  }\r\n  function resetCo170() { setCo170Rem(170); setCo170Darts(0); setCo170Attempts(0); setCo170Successes(0); resetDartCount('Checkout 170') }\r\n  function resetCo121() { setCo121Rem(121); setCo121Darts(0); setCo121Attempts(0); setCo121Successes(0); resetDartCount('Checkout 121') }\r\n\r\n  // Treble practice\r\n  function addTrebleAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (trebleFinished) return\r\n    recordDart('Treble Practice')\r\n    const isHit = (ring === 'TRIPLE' && sector === trebleTarget) || (!ring && value === trebleTarget * 3)\r\n    if (isHit) setTrebleHits(h => h + 1)\r\n    setTrebleDarts(d => {\r\n      const nd = d + 1\r\n      // Auto-rotate target every 3 darts among T20â†’T19â†’T18\r\n      if (nd % 3 === 0 && [20, 19, 18].includes(trebleTarget)) {\r\n        const cycle = [20, 19, 18]\r\n        const idx = cycle.indexOf(trebleTarget)\r\n        const next = cycle[(idx + 1) % cycle.length]\r\n        setTrebleTarget(next)\r\n      }\r\n      // End session at configured throws\r\n      if (trebleMaxDarts > 0 && nd >= trebleMaxDarts) setTrebleFinished(true)\r\n      return nd\r\n    })\r\n  }\r\n  function resetTreble() { setTrebleHits(0); setTrebleDarts(0); setTrebleFinished(false); resetDartCount('Treble Practice') }\r\n\r\n  // Baseball\r\n  function addBaseballAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    recordDart('Baseball')\r\n    setBaseball(prev => { const cp = { ...prev }; applyBaseballDart(cp as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetBaseball() { setBaseball(createBaseball()); resetDartCount('Baseball') }\r\n\r\n  // Golf\r\n  function addGolfAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    recordDart('Golf')\r\n    setGolf(prev => { const cp = { ...prev }; applyGolfDart(cp as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetGolf() { setGolf(createGolf()); resetDartCount('Golf') }\r\n\r\n  // Tic Tac Toe\r\n  function addTttAuto(cell: number, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Tic Tac Toe')\r\n    setTTT(prev => { const cp = { ...prev, board: [...prev.board] as any }; tryClaimCell(cp as any, cell as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetTtt() { setTTT(createTicTacToe()); resetDartCount('Tic Tac Toe') }\r\n\r\n  // American Cricket\r\n  function addAmCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('American Cricket')\r\n    setAmCricket(prev => { const cp = { ...prev, marks: { ...prev.marks } }; applyAmCricketDart(cp as any, value, ring as any, sector, () => false); return cp })\r\n  }\r\n  function resetAmCricket() { setAmCricket(createAmCricketState()); resetDartCount('American Cricket') }\r\n\r\n  // --- Around the Clock helpers ---\r\n  function addAtcValue(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Around the Clock')\r\n    const target = ATC_ORDER[atcIndex]\r\n    let hit = false\r\n    if (typeof sector === 'number' && sector === target && (ring === 'SINGLE' || ring === 'DOUBLE' || ring === 'TRIPLE')) hit = true\r\n    if (target === 25 && (ring === 'BULL' || val === 25)) hit = true\r\n    if (target === 50 && (ring === 'INNER_BULL' || val === 50)) hit = true\r\n    if (!hit) {\r\n      // Fallback by value only\r\n      if (val === target || val === target * 2 || val === target * 3) hit = true\r\n    }\r\n    if (hit) {\r\n      const newHits = atcHits + 1\r\n      setAtcHits(newHits)\r\n      setAtcIndex(i => i + 1)\r\n    }\r\n  }\r\n  function addAtcNumeric() { addAtcValue(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n  function addAtcManual() {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like T20, D5, 25, 50'); return }\r\n    addAtcValue(v)\r\n    setManualBox('')\r\n  }\r\n\r\n  // --- Cricket helpers (solo practice) ---\r\n  function addCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Cricket')\r\n    setCricket(prev => {\r\n      const copy = { ...prev, marks: { ...prev.marks } }\r\n      applyCricketDart(copy as any, value, ring, sector, () => false)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1; if (nd >= 3) return 0; return nd\r\n    })\r\n  }\r\n  function addCricketNumeric() { addCricketAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- Shanghai helpers ---\r\n  function addShanghaiAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Shanghai')\r\n    setShanghai(prev => {\r\n      const copy = { ...prev, turnHits: { ...prev.turnHits } }\r\n      applyShanghaiDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setShanghai(prev => { const cp = { ...prev, turnHits: { ...prev.turnHits } }; endShanghaiTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addShanghaiNumeric() { addShanghaiAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- Halve It helpers ---\r\n  function addHalveAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('Halve It')\r\n    setHalve(prev => {\r\n      const copy = { ...prev, targets: [...prev.targets] }\r\n      applyHalveItDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setHalve(prev => { const cp = { ...prev, targets: [...prev.targets] }; endHalveItTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addHalveNumeric() { addHalveAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- High-Low helpers ---\r\n  function addHighLowAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    recordDart('High-Low')\r\n    setHighlow(prev => {\r\n      const copy = { ...prev }\r\n      applyHighLowDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setHighlow(prev => { const cp = { ...prev }; endHighLowTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addHighLowNumeric() { addHighLowAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  function parseManualBox(): number | null {\r\n    const t = manualBox.trim().toUpperCase()\r\n    if (!t) return null\r\n    if (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL') return 50\r\n    if (t === '25' || t === 'OBULL') return 25\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n    if (!m) return null\r\n    const mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n    const num = parseInt(m[2],10)\r\n    if (num < 1 || num > 20) return null\r\n    const multVal = mult==='S'?1:mult==='D'?2:3\r\n    return num * multVal\r\n  }\r\n\r\n  function addManual() {\r\n    const val = parseManualBox()\r\n    if (val == null) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    applyDartValue(val)\r\n    setManualBox('')\r\n  }\r\n\r\n  function addManualTextarea() {\r\n    const lines = manualTextarea.trim().split('\\n').map(l => l.trim()).filter(l => l)\r\n    if (lines.length === 0) return\r\n    for (const line of lines) {\r\n      const val = parseManualDart(line)\r\n      if (val == null) { alert(`Invalid score: ${line}`); return }\r\n      applyDartValue(val)\r\n    }\r\n    setManualTextarea('')\r\n  }\r\n\r\n  function replaceLast() {\r\n    if (playerVisitDarts === 0) return\r\n    // Rewind one dart: approximate by adding back last dart into score\r\n    setPlayerScore(s => s + playerLastDart)\r\n    setPlayerVisitDarts(d => Math.max(0, d - 1))\r\n  }\r\n\r\n  function replaceLastManual() {\r\n    const val = parseManualBox()\r\n    if (val == null) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    if (playerVisitDarts === 0) { addManual(); return }\r\n    // Rewind last then apply\r\n    const rewind = playerLastDart\r\n    setPlayerScore(s => s + rewind)\r\n    setPlayerVisitDarts(d => Math.max(0, d - 1))\r\n    // Apply new value in next microtask to ensure state has updated\r\n    setTimeout(() => applyDartValue(val), 0)\r\n    setManualBox('')\r\n  }\r\n\r\n  function playerThrow(points: number) {\r\n    let newScore = playerScore - points;\r\n    if (newScore < 0) {\r\n      setPlayerScore(playerScore); // bust\r\n      return;\r\n    }\r\n    setPlayerScore(newScore);\r\n    if (newScore === 0) {\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n    }\r\n    setOnDouble(newScore <= 40 && newScore % 2 === 0)\r\n  }\r\n\r\n  function aiTurn() {\r\n    // This is now automated inside the modal turn loop\r\n  }\r\n\r\n  function handleBust() {\r\n    setPlayerScore(playerScore); // bust, score unchanged\r\n    setOnDouble(false);\r\n  }\r\n\r\n  function handleWinPopupSubmit() {\r\n    const winner = pendingLegWinner ?? 'player'\r\n    // Approximate per-leg doubles attempts: if winner is player and they finished from <=50, attempts were counted in playerVisitDartsAtDouble; otherwise leave undefined\r\n    const legDoublesAtt = winner==='player' ? (playerVisitDartsAtDouble || undefined) : (aiVisitDartsAtDouble || undefined)\r\n    const legDoublesHit = 1\r\n    const winnerDarts = winner==='player' ? playerDartsThrown : aiDartsThrown\r\n    setLegStats([...legStats, { winner, doubleDarts, checkoutDarts, winnerDarts, doublesAtt: legDoublesAtt, doublesHit: legDoublesHit }]);\r\n    setShowWinPopup(false);\r\n    // Increment legs for the winner\r\n    let p = playerLegs\r\n    let a = aiLegs\r\n    if (pendingLegWinner === 'player') p += 1\r\n    else if (pendingLegWinner === 'ai') a += 1\r\n    setPlayerLegs(p)\r\n    setAiLegs(a)\r\n    setPendingLegWinner(null)\r\n    // Check if match is over\r\n    if (p >= firstTo || a >= firstTo) {\r\n      // End of match: close modal back to menu state\r\n      // Record per-game-mode result (local-only demo)\r\n      try { bumpGameMode(selectedMode, winner === 'player') } catch {}\r\n      setShowMatchModal(false)\r\n      setInMatch(false)\r\n      // Reset leg-specific stats for next match but keep the summary list visible\r\n      setPlayerScore(x01Score)\r\n      setAiScore(x01Score)\r\n      setShowMatchSummary(true)\r\n      return\r\n    }\r\n    // Otherwise, start the next leg immediately\r\n    startNextLeg()\r\n  }\r\n\r\n  const isFreeSelected = freeGames.includes(selectedMode as any)\r\n  const lockedPremium = !isFreeSelected && !(user?.fullAccess || user?.admin)\r\n\r\n  // no external overlay: we render the match modal as absolute inset-0 inside this card\r\n\r\n  return (\r\n  <div className=\"card ndn-game-shell relative overflow-hidden\">\r\n  {showStartShowcase && <MatchStartShowcase players={(match.players || []) as any} onDone={() => setShowStartShowcase(false)} />}\r\n  <h2 className=\"text-3xl font-bold text-brand-700 mb-4\">Offline Mode {offlineLayout==='classic' ? <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle\">Classic layout</span> : <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle\">Modern layout</span>}</h2>\r\n      <div className=\"ndn-shell-body\">\r\n      <div className=\"mb-4 flex flex-col gap-3\">\r\n        <select className=\"input w-full\" value={selectedMode} onChange={e => setSelectedMode(e.target.value)}>\r\n          {freeGames.map(mode => <option key={mode} value={mode}>{mode}</option>)}\r\n          {premiumGames.map(mode => (\r\n            <option key={mode} value={mode} disabled={!(user?.fullAccess || user?.admin)}>{mode} {(user?.fullAccess || user?.admin) ? '' : '(Premium)'}</option>\r\n          ))}\r\n        </select>\r\n\r\n        {/* Calibration Status - displayed below game mode selector */}\r\n        <GameCalibrationStatus \r\n          gameMode={selectedMode} \r\n          compact={true}\r\n        />\r\n\r\n        {selectedMode === 'Treble Practice' && (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end\">\r\n            <div className=\"sm:col-span-1\">\r\n              <label className=\"font-semibold\">Throws per game</label>\r\n              <input className=\"input w-full\" type=\"number\" min={3} step={3} value={trebleMaxDarts} onChange={e=>setTrebleMaxDarts(Math.max(3, Math.floor(Number(e.target.value)||30)))} />\r\n            </div>\r\n            <div className=\"sm:col-span-2 text-xs text-slate-300\">Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws.</div>\r\n          </div>\r\n        )}\r\n        {!user?.fullAccess && (\r\n          <div className=\"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2\">\r\n            <span>ðŸ”’</span>\r\n            <span>Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM.</span>\r\n          </div>\r\n        )}\r\n        {selectedMode === 'X01' && (\r\n          <>\r\n            <label className=\"font-semibold mt-2\">Enter starting score (1-1001):</label>\r\n            <input\r\n              className=\"input w-full\"\r\n              type=\"number\"\r\n              min={1}\r\n              max={1001}\r\n              value={x01Score}\r\n              onChange={e => setX01Score(Number(e.target.value))}\r\n            />\r\n            <label className=\"font-semibold mt-2\">Play against AI bot?</label>\r\n            <select className=\"input w-full\" value={ai} onChange={e => setAI(e.target.value)}>\r\n              <option value=\"None\">None</option>\r\n              {aiLevels.map(level => <option key={level} value={level}>{level}</option>)}\r\n            </select>\r\n            {ai !== 'None' && (\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2\">\r\n                <div className=\"sm:col-span-2\">\r\n                  <label className=\"font-semibold\">AI throw delay (seconds)</label>\r\n                  <input\r\n                    className=\"input w-full\"\r\n                    type=\"number\"\r\n                    min={0.5}\r\n                    max={10}\r\n                    step={0.5}\r\n                    value={aiDelayMs / 1000}\r\n                    onChange={e => setAiDelayMs(Math.round(Number(e.target.value) * 1000))}\r\n                  />\r\n                </div>\r\n                <div className=\"text-sm text-slate-300\">Controls how long the AI waits before its visit.</div>\r\n              </div>\r\n            )}\r\n            <button className=\"btn mt-2\" onClick={() => setShowRules(true)}>X01 Rules & Regulations!</button>\r\n          </>\r\n        )}\r\n        {selectedMode === 'Double Practice' && (\r\n          <div className=\"mt-2 text-brand-600\">Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply.</div>\r\n        )}\r\n      </div>\r\n  {!inMatch && <button className=\"btn\" disabled={lockedPremium} title={lockedPremium ? 'PREMIUM required for this mode' : ''} onClick={startMatch}>Start Match</button>}\r\n      {/* Match Modal with turn-by-turn flow */}\r\n      {showMatchModal && (\r\n  <div className={`absolute inset-0 z-[1000] ${maximized ? '' : 'flex items-center justify-center p-3 sm:p-4'}` }>\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:offline-match\"\r\n            className={`${maximized ? 'w-full h-full ndn-modal-tight' : ''} relative flex flex-col overflow-hidden`}\r\n            fullScreen={maximized}\r\n            defaultWidth={1100}\r\n            defaultHeight={720}\r\n            minWidth={720}\r\n            minHeight={480}\r\n            maxWidth={1600}\r\n            maxHeight={1200}\r\n            initialFitHeight\r\n          >\r\n            {/* Header bar with visible mode and actions; sheen is clipped to this area */}\r\n            <div\r\n              className=\"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2\"\r\n              style={{ overflowY: 'scroll' }}\r\n              ref={(el) => { (scrollerRef as any).current = el }}\r\n            >\r\n              <div ref={(el)=>{ (headerBarRef as any).current = el }}>\r\n                <GameHeaderBar\r\n                  left={(\r\n                    <>\r\n                      <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">Game Mode</span>\r\n                      <span className=\"font-medium whitespace-nowrap\">{selectedMode}{selectedMode==='X01' ? ` / ${x01Score}` : ''}</span>\r\n                      <span className=\"opacity-80 whitespace-nowrap\">First to {firstTo} Â· Legs {playerLegs}-{aiLegs}</span>\r\n                      <span className={`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${offlineLayout==='modern' ? 'bg-emerald-500/15 text-emerald-200 border-emerald-400/30' : 'bg-white/10 text-white/70 border-white/20'}`}>{offlineLayout==='modern' ? 'Modern layout' : 'Classic layout'}</span>\r\n                    </>\r\n                  )}\r\n                  right={(\r\n                    <>\r\n                      {/* Camera scale controls (match Online UI) */}\r\n                      <div className=\"hidden items-center gap-2 mr-2 text-xs\">\r\n                        <span className=\"opacity-80\">Cam</span>\r\n                        <button\r\n                          className=\"btn btn--ghost px-2 py-1\"\r\n                          onClick={() => setCameraScale(Math.max(0.5, Math.round((cameraScale - 0.05) * 100) / 100))}\r\n                          title=\"Decrease camera size\"\r\n                        >âˆ’</button>\r\n                        <span className=\"w-9 text-center\">{Math.round(cameraScale * 100)}%</span>\r\n                        <button\r\n                          className=\"btn btn--ghost px-2 py-1\"\r\n                          onClick={() => setCameraScale(Math.min(1.25, Math.round((cameraScale + 0.05) * 100) / 100))}\r\n                          title=\"Increase camera size\"\r\n                        >+</button>\r\n                      </div>\r\n                      <button\r\n                        className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                        title={fitAll ? 'Actual Size' : 'Fit All'}\r\n                        onClick={() => setFitAll(v => !v)}\r\n                      >{fitAll ? 'Actual Size' : 'Fit All'}</button>\r\n                      <button\r\n                        className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                        title={maximized ? 'Restore' : 'Maximize'}\r\n                        onClick={() => setMaximized(m => !m)}\r\n                      >{maximized ? 'Restore' : 'Maximize'}</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={() => { startMatch() }}>Restart</button>\r\n                      <button className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\" onClick={() => { setShowMatchModal(false); setInMatch(false); }}>Quit</button>\r\n                    </>\r\n                  )}\r\n                />\r\n              </div>\r\n              <div\r\n                ref={(el) => { (contentRef as any).current = el }}\r\n                className=\"will-change-transform\"\r\n                style={fitAll ? { transform: `scale(${fitScale})`, transformOrigin: 'top left', width: '100%', fontSize: `${Math.max(0.8, Math.min(1, fitScale))}em` } : undefined}\r\n              >\r\n            <h3 className=\"text-xl font-bold mb-2 mt-1 leading-tight\">{selectedMode === 'X01' ? 'X01 Match' : selectedMode}</h3>\r\n            <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Mode: {selectedMode}</span>\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Start: {x01Score}</span>\r\n              <div ref={formatRef} className=\"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                <span>Format:</span>\r\n                {(() => {\r\n                  const disabled = (playerScore !== x01Score || aiScore !== x01Score || playerVisitDarts > 0)\r\n                  const pillCls = `px-2 py-0.5 rounded border text-xs ${disabled? 'opacity-50 cursor-not-allowed': 'cursor-pointer'} `\r\n                  return (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <button\r\n                          type=\"button\"\r\n                          className={`${pillCls} ${formatType==='first' ? 'bg-indigo-500/20 text-indigo-100 border-indigo-400/30' : 'bg-white/10 text-white/80 border-white/20'}`}\r\n                          onClick={() => { if (!disabled) setFormatType('first') }}\r\n                          title=\"First to N\"\r\n                        >First to</button>\r\n                        <button\r\n                          type=\"button\"\r\n                          className={`${pillCls} ${formatType==='best' ? 'bg-indigo-500/20 text-indigo-100 border-indigo-400/30' : 'bg-white/10 text-white/80 border-white/20'}`}\r\n                          onClick={() => { if (!disabled) setFormatType('best') }}\r\n                          title=\"Best of N (wins = ceil(N/2)\"\r\n                        >Best of</button>\r\n                      </div>\r\n                      <input\r\n                        className={`input w-16 text-center ${disabled ? 'opacity-50' : ''}`}\r\n                        type=\"number\"\r\n                        min={1}\r\n                        step={1}\r\n                        value={formatCount}\r\n                        onChange={e => setFormatCount(Math.max(1, Math.floor(Number(e.target.value)||1)))}\r\n                        disabled={disabled}\r\n                        title={formatType==='first' ? 'First to N' : 'Best of N (wins = ceil(N/2))'}\r\n                      />\r\n                    </div>\r\n                  )\r\n                })()}\r\n              </div>\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Legs: {playerLegs}â€“{aiLegs}</span>\r\n              {/* Move match type and team names to the right of Legs for a single-row header */}\r\n              <div className=\"ml-auto flex items-center gap-1 text-[10px] flex-wrap\">\r\n                <span className=\"opacity-70\">Match</span>\r\n                <select className={`btn ${buttonSizeClass}`} value={matchType} onChange={e=>setMatchType((e.target.value as 'singles'|'doubles'))}>\r\n                  <option value=\"singles\">Singles</option>\r\n                  <option value=\"doubles\">Doubles</option>\r\n                </select>\r\n                <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamAName} onChange={e=>setTeamAName(e.target.value)} placeholder=\"Team A\" />\r\n                <span className=\"opacity-50\">vs</span>\r\n                <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamBName} onChange={e=>setTeamBName(e.target.value)} placeholder=\"Team B\" />\r\n              </div>\r\n            </div>\r\n            {selectedMode !== 'X01' ? (\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2\">\r\n                {selectedMode === 'Double Practice' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">Current Target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'â€”'}</span>\r\n                    </div>\r\n                    {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Around the Clock' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">Current Target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || 'â€”')}</span>\r\n                    </div>\r\n                    {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Cricket' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 mb-1\">Cricket â€” Close 20â€“15 and Bull; overflow scores points</div>\r\n                    <div className=\"grid grid-cols-7 gap-1 text-center text-[11px] mb-2\">\r\n                      {CRICKET_NUMBERS.map(n => (\r\n                        <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                          <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                          <div className=\"font-semibold\">{Math.min(3, cricket.marks?.[n]||0)} / 3</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm\">Points: <span className=\"font-semibold\">{cricket.points}</span></div>\r\n                    {cricketClosedAll(cricket) && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setCricket(createCricketState())\r\n                        setPracticeTurnDarts(0)\r\n                        resetDartCount('Cricket')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Shanghai' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{shanghai.round}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {shanghai.score}</div>\r\n                    {shanghai.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setShanghai(createShanghaiState())\r\n                        setPracticeTurnDarts(0)\r\n                        resetDartCount('Shanghai')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Halve It' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Stage</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{halve.stage+1}/{halve.targets.length}</span></div>\r\n                    <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const t = getCurrentHalveTarget(halve); if (!t) return 'â€”'; if (t.kind==='ANY_NUMBER') return 'Any'; if (t.kind==='BULL') return 'Bull'; if (t.kind==='DOUBLE' || t.kind==='TRIPLE' || t.kind==='NUMBER') return `${t.kind} ${(t as any).num}`; return 'â€”' })()}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {halve.score}</div>\r\n                    {halve.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setHalve(createDefaultHalveIt())\r\n                        setPracticeTurnDarts(0)\r\n                        resetDartCount('Halve It')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High-Low' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {highlow.round} Â· Target {highlow.target}</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {highlow.score}</div>\r\n                    {highlow.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setHighlow(createHighLow())\r\n                        setPracticeTurnDarts(0)\r\n                        resetDartCount('High-Low')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === \"Bob's 27\" && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Target</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold\">D{b27Stage}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {b27Score}</div>\r\n                    {b27Finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetB27}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Count-Up' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {cuRound}/8</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {cuScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High Score' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {hsRound}/10</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {hsScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Low Score' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {lsRound}/10</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {lsScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 170' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Remaining</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{co170Rem}</div>\r\n                    <div className=\"text-xs text-slate-400 mt-1\">Attempts: {co170Attempts} Â· Successes: {co170Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 121' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Remaining</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{co121Rem}</div>\r\n                    <div className=\"text-xs text-slate-400 mt-1\">Attempts: {co121Attempts} Â· Successes: {co121Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Treble Practice' && (\r\n                  <>\r\n                    <div className=\"flex items-center justify-between gap-4\">\r\n                      <div>\r\n                        <div className=\"text-xs text-slate-600\">Treble Target: T{trebleTarget}</div>\r\n                        <div className=\"text-3xl font-extrabold tracking-tight\">Hits: {trebleHits}</div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 flex-wrap\">\r\n                        <label className=\"text-sm\">Target</label>\r\n                        <div className=\"inline-flex items-center gap-1\">\r\n                          {[20,19,18].map(n => (\r\n                            <button key={`tpick-header-${n}`} className={`btn px-2 py-0.5 text-xs ${trebleTarget===n?'bg-emerald-600/30 border border-emerald-400/30':''}`} onClick={()=>setTrebleTarget(n)}>T{n}</button>\r\n                          ))}\r\n                        </div>\r\n                        <span className=\"opacity-60 text-xs\">or</span>\r\n                        <select className=\"input w-24\" value={trebleTarget} onChange={e=> setTrebleTarget(parseInt(e.target.value,10))}>\r\n                          {Array.from({length:20},(_,i)=>i+1).map(n=> <option key={n} value={n}>{n}</option>)}\r\n                        </select>\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={resetTreble}>Reset</button>\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Baseball' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Inning</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{baseball.inning}</div>\r\n                    <div className=\"text-sm\">Score: <span className=\"font-semibold\">{baseball.score}</span></div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Golf' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Hole</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{golf.hole}</div>\r\n                    <div className=\"text-sm\">Strokes: <span className=\"font-semibold\">{golf.strokes}</span></div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Tic Tac Toe' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Turn</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{ttt.turn}</div>\r\n                    {ttt.finished && <div className=\"mt-1 text-xs\">Winner: {ttt.winner || 'â€”'}</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Scam' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Target</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{SCAM_TARGET_NAMES[scam.targetIndex]}</div>\r\n                    <div className=\"text-sm\">Progress: <span className=\"font-semibold\">{scam.targetIndex + 1}/{SCAM_TARGET_NAMES.length}</span></div>\r\n                    {scam.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">ðŸŽ‰ Finished in {scam.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Fives' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Score</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{fives.score}/{fives.target}</div>\r\n                    <div className=\"text-sm\">Darts: <span className=\"font-semibold\">{fives.darts}</span></div>\r\n                    {fives.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">âœ“ Reached {fives.target}!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Sevens' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Score</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{sevens.score}/{sevens.target}</div>\r\n                    <div className=\"text-sm\">Darts: <span className=\"font-semibold\">{sevens.darts}</span></div>\r\n                    {sevens.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">âœ“ Reached {sevens.target}!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'American Cricket' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 mb-1\">Close 20â€“12 and Bull; overflow scores points</div>\r\n                    <div className=\"grid grid-cols-10 gap-1 text-center text-[11px] mb-2\">\r\n                      {AM_CRICKET_NUMBERS.map(n => (\r\n                        <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                          <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                          <div className=\"font-semibold\">{Math.min(3, amCricket.marks?.[n]||0)} / 3</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm\">Points: <span className=\"font-semibold\">{amCricket.points}</span></div>\r\n                    {hasClosedAllAm(amCricket) && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetAmCricket}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Killer' && (\r\n                  <>\r\n                    {!killerSetupDone ? (\r\n                      <div className=\"text-xs text-slate-600\">Setup players and assign numbers</div>\r\n                    ) : (\r\n                      <>\r\n                        <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                          <span>Turn</span>\r\n                          <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{killerPlayers[killerTurnIdx]?.name || 'â€”'}</span>\r\n                        </div>\r\n                        <div className=\"text-3xl font-extrabold tracking-tight\">{killerWinnerId ? `${killerPlayers.find(p=>p.id===killerWinnerId)?.name || 'Winner'} Wins` : (killerLastEvent || 'Ready')}</div>\r\n                      </>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            ) : offlineLayout === 'modern' ? (\r\n              <div className=\"space-y-3 mb-2\">\r\n                {!manualScoring ? (\r\n                  <>\r\n                    <div className=\"flex items-center flex-wrap gap-1.5 mt-1\">\r\n                      <div className=\"ml-auto flex items-center gap-1 text-[10px]\">\r\n                        <span className=\"opacity-70\">Cam</span>\r\n                        <button className={`btn ${buttonSizeClass}`} onClick={() => setCameraScale(Math.max(0.5, Math.round((cameraScale - 0.05) * 100) / 100))}>âˆ’</button>\r\n                        <span className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}>{Math.round(cameraScale * 100)}%</span>\r\n                        <button className={`btn ${buttonSizeClass}`} onClick={() => setCameraScale(Math.min(1.25, Math.round((cameraScale + 0.05) * 100) / 100))}>+</button>\r\n                        <span className=\"opacity-50\">|</span>\r\n                        <button className={`btn ${buttonSizeClass}`} title=\"Toggle fit/fill\" onClick={() => setCameraFitMode(cameraFitMode === 'fill' ? 'fit' : 'fill')}>{cameraFitMode === 'fill' ? 'Fill' : 'Fit'}</button>\r\n                        <span className=\"opacity-50\">|</span>\r\n                        <button className={`btn ${buttonSizeClass}`} title=\"Toggle camera aspect\" onClick={() => setCameraAspect(cameraAspect === 'square' ? 'wide' : 'square')}>{cameraAspect === 'square' ? 'Square' : 'Wide'}</button>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"relative\">\r\n                      <div className=\"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6\">\r\n                        <div className=\"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]\">\r\n                            <CameraView \r\n                              scoringMode=\"x01\"\r\n                              showToolbar={cameraToolbarVisible}\r\n                              immediateAutoCommit\r\n                              onAutoDart={(value, ring, info) => {\r\n                                applyDartValue(value)\r\n                              }}\r\n                            />\r\n                          </div>\r\n\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4\">\r\n                            <div className=\"space-y-4\">\r\n                              <div className=\"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\r\n                                <div className=\"text-xs uppercase tracking-wide text-white/50\">Current Shooter</div>\r\n                                <div className=\"mt-1 text-xl font-semibold text-white\">{activePlayerName}</div>\r\n                                <div className=\"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80\">\r\n                                  <div>\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/40\">Remaining</div>\r\n                                    <div className=\"font-mono text-lg text-white\">{activeRemaining}</div>\r\n                                  </div>\r\n                                  <div>\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/40\">Last Dart</div>\r\n                                    <div className=\"font-mono text-lg text-white\">{activeLastScore || 0}</div>\r\n                                  </div>\r\n                                  <div>\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/40\">Match Legs</div>\r\n                                    <div className=\"font-semibold text-white\">{playerLegs}-{aiLegs}</div>\r\n                                  </div>\r\n                                  <div>\r\n                                    <div className=\"text-xs uppercase tracking-wide text-white/40\">Next Up</div>\r\n                                    <div className=\"font-medium text-white\">{inactivePlayerName}</div>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n\r\n                            <div className=\"hidden md:block\">\r\n                              <GameScoreboard\r\n                                gameMode={selectedMode as any}\r\n                                players={singlePlayerScoreboard}\r\n                                matchScore={`${playerLegs}-${aiLegs}`}\r\n                              />\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"md:hidden\">\r\n                            <GameScoreboard\r\n                              gameMode={selectedMode as any}\r\n                              players={singlePlayerScoreboard}\r\n                              matchScore={`${playerLegs}-${aiLegs}`}\r\n                            />\r\n                          </div>\r\n\r\n                          {(selectedMode as any) === 'X01' && (\r\n                            <div className=\"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\r\n                              <div className=\"text-xs uppercase tracking-wide text-white/50\">Manual Scoreboard Override</div>\r\n                              <p className=\"mt-1 text-xs text-white/40\">Adjust the live totals if a dart was misread. Values are clamped between 0 and {x01Score}.</p>\r\n                              <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm\">\r\n                                <div className=\"space-y-3\">\r\n                                  <div className=\"text-sm font-semibold text-white\">{humanName}</div>\r\n                                  <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs uppercase tracking-wide text-white/50\">Commit Visit</label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                                      <MatchControls\r\n                                        inProgress={true}\r\n                                        startingScore={x01Score}\r\n                                        onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)}\r\n                                        quickButtons={[180,140,100,60]}\r\n                                        onNextPlayer={() => matchActions?.nextPlayer()}\r\n                                        onEndLeg={() => { /* End leg handled via commitManualVisitTotal / addVisitTotal */ }}\r\n                                        onUndo={() => { /* offline undo not implemented here; optionally reset pending visit */ }}\r\n                                        showDartsSelect={true}\r\n                                      />\r\n                                    </div>\r\n                                  </div>\r\n                                  <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs uppercase tracking-wide text-white/50\">Legs Override</label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                                      <input\r\n                                        className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                        type=\"number\"\r\n                                        min={0}\r\n                                        value={manualPlayerLegsInput}\r\n                                        onChange={e => setManualPlayerLegsInput(e.target.value)}\r\n                                        onKeyDown={e => { if (e.key === 'Enter') handleManualLegsOverride('player') }}\r\n                                        placeholder={`${playerLegs}`}\r\n                                      />\r\n                                      <button className=\"btn px-3 py-1 text-sm\" onClick={() => handleManualLegsOverride('player')}>Set</button>\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n                                <div className=\"space-y-3\">\r\n                                  <div className=\"text-sm font-semibold text-white\">{aiDisplayName}</div>\r\n                                  <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs uppercase tracking-wide text-white/50\">Three Dart Edit</label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                                      <input\r\n                                        className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                        type=\"number\"\r\n                                        min={0}\r\n                                        max={x01Score}\r\n                                        value={manualOpponentScoreInput}\r\n                                        onChange={e => setManualOpponentScoreInput(e.target.value)}\r\n                                        onKeyDown={e => { if (e.key === 'Enter') handleManualScoreOverride('ai') }}\r\n                                        placeholder={`${aiScore}`}\r\n                                      />\r\n                                      <button className=\"btn px-3 py-1 text-sm\" onClick={() => handleManualScoreOverride('ai')}>Set</button>\r\n                                    </div>\r\n                                  </div>\r\n                                  <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs uppercase tracking-wide text-white/50\">Legs Override</label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                                      <input\r\n                                        className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                        type=\"number\"\r\n                                        min={0}\r\n                                        value={manualOpponentLegsInput}\r\n                                        onChange={e => setManualOpponentLegsInput(e.target.value)}\r\n                                        onKeyDown={e => { if (e.key === 'Enter') handleManualLegsOverride('ai') }}\r\n                                        placeholder={`${aiLegs}`}\r\n                                      />\r\n                                      <button className=\"btn px-3 py-1 text-sm\" onClick={() => handleManualLegsOverride('ai')}>Set</button>\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <div className=\"card\">\r\n                    <div className=\"text-sm font-semibold mb-1\">Manual scoring active</div>\r\n                    <div className=\"text-xs opacity-70\">Camera previews are disabled. Use the manual entry controls below to record your turn.</div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0\">\r\n                <div className=\"flex items-stretch justify-center md:px-3 min-w-0\">\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                  <span className=\"opacity-80\">You Remain</span>\r\n                  {isPlayerTurn ? (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl font-extrabold tracking-tight\">{playerScore}</div>\r\n                <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                  <div className=\"h-full bg-emerald-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (playerScore / x01Score)) * 100))}%` }} />\r\n                </div>\r\n                <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{playerLastDart}</span></div>\r\n                <div className=\"text-sm opacity-90\">Last score: <span className=\"font-semibold\">{playerVisitDarts > 0 ? playerVisitSum : (playerLastVisitScore ?? playerLastDart)}</span></div>\r\n                <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{totalPlayerDarts>0 ? ((totalPlayerPoints/totalPlayerDarts)*3).toFixed(1) : '0.0'}</span></div>\r\n                <div className=\"text-xs opacity-70 flex items-center gap-2\">\r\n                  <span>Darts thrown: {playerDartsThrown}</span>\r\n                  <span className=\"inline-flex items-center gap-1\" aria-label=\"Visit darts\">\r\n                    {[0,1,2].map(i => (\r\n                      <span key={i} className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? 'bg-emerald-400' : 'bg-white/20'}`}></span>\r\n                    ))}\r\n                  </span>\r\n                </div>\r\n                <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {playerDoublesAtt} Â· Hit {playerDoublesHit}</span></div>\r\n                {playerScore <= 170 && playerScore > 0 && (\r\n                  (() => {\r\n                    const sugs = suggestCheckouts(playerScore, favoriteDouble)\r\n                    const first = sugs[0] || 'â€”'\r\n                    return (\r\n                      <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\r\n                        <span className=\"opacity-70\">Checkout</span>\r\n                        <span className=\"font-semibold\">{first}</span>\r\n                      </div>\r\n                    )\r\n                  })()\r\n                )}\r\n              </div>\r\n              {/* Center camera preview: right-aligned and square when selected */}\r\n              <div className=\"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall\">\r\n                <ResizablePanel\r\n                  storageKey=\"ndn:camera:tile:offline:center:v4\"\r\n                  className=\"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card\"\r\n                  defaultWidth={0}\r\n                  defaultHeight={0}\r\n                  minWidth={300}\r\n                  minHeight={300}\r\n                  maxWidth={2000}\r\n                  maxHeight={1200}\r\n                  autoFill\r\n                >\r\n                  <CameraTile\r\n                    label=\"Your Board\"\r\n                    autoStart={true}\r\n                    className=\"min-w-0 h-full\"\r\n                    aspect=\"classic\"\r\n                    fill\r\n                  />\r\n                </ResizablePanel>\r\n              </div>\r\n              {/* Match summary (offline) */}\r\n              <div className={`mt-2 ${boxSize === 'small' ? 'p-2' : boxSize === 'large' ? 'p-4' : 'p-3'} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === 'small' ? 'text-xs' : textSize === 'large' ? 'text-base' : 'text-sm'}`}>\r\n                <div className=\"font-semibold mb-2\">Match Summary</div>\r\n                {(() => {\r\n                  // In offline X01, player is vs AI or practice\r\n                  const currentThrower = isPlayerTurn ? (user?.username || 'You') : (ai === 'None' ? 'â€”' : `${ai} AI`)\r\n                  const currentRemaining = isPlayerTurn ? playerScore : (ai === 'None' ? 0 : aiScore)\r\n                  const lastScoreDisplay = isPlayerTurn\r\n                    ? (playerVisitDarts > 0 ? playerVisitSum : (playerLastVisitScore ?? playerLastDart))\r\n                    : (aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart))\r\n                  const dartsThrown = isPlayerTurn ? playerDartsThrown : aiDartsThrown\r\n                  const scored = (x01Score - (isPlayerTurn ? playerScore : (ai === 'None' ? x01Score : aiScore)))\r\n                  const avg3 = dartsThrown > 0 ? ((scored / dartsThrown) * 3) : 0\r\n                  const matchScore = `${playerLegs}-${aiLegs}`\r\n                  const bestLegText = legStats.length > 0 ? `${Math.min(...legStats.map(l=>l.doubleDarts + (l.checkoutDarts||0))) || 0} darts` : 'â€”'\r\n                  return (\r\n                    <div className=\"grid grid-cols-2 gap-y-1\">\r\n                      <div className=\"opacity-80\">Current score</div>\r\n                      <div className=\"font-mono text-right\">{matchScore}</div>\r\n                      <div className=\"opacity-80\">Current thrower</div>\r\n                      <div className=\"text-right font-semibold text-lg\">{currentThrower}</div>\r\n                      <div className=\"opacity-80\">Score remaining</div>\r\n                      <div className=\"text-right font-mono font-bold text-xl\">{currentRemaining}</div>\r\n                      <div className=\"opacity-80\">3-dart avg</div>\r\n                      <div className=\"text-right font-mono\">{avg3.toFixed(1)}</div>\r\n                      <div className=\"opacity-80\">Last score</div>\r\n                      <div className=\"text-right font-mono\">{lastScoreDisplay}</div>\r\n                      <div className=\"opacity-80\">Best leg</div>\r\n                      <div className=\"text-right\">{bestLegText}</div>\r\n                    </div>\r\n                  )\r\n                })()}\r\n              </div>\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                <div className=\"text-xs flex items-center justify-between opacity-80\">\r\n                  <span>{ai === 'None' ? 'Opponent' : `${ai} AI`} Remain</span>\r\n                  {!isPlayerTurn ? (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl font-extrabold tracking-tight\">{ai !== 'None' ? aiScore : 'N/A'}</div>\r\n                {ai !== 'None' && (\r\n                  <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                    <div className=\"h-full bg-fuchsia-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (aiScore / x01Score)) * 100))}%` }} />\r\n                  </div>\r\n                )}\r\n                <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{ai === 'None' ? 0 : aiLastDart}</span></div>\r\n                <div className=\"text-sm opacity-90\">Last score: <span className=\"font-semibold\">{ai === 'None' ? 'â€”' : (aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart))}</span></div>\r\n                <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{ai !== 'None' ? (totalAiDarts>0 ? ((totalAiPoints/totalAiDarts)*3).toFixed(1) : '0.0') : 'â€”'}</span></div>\r\n                {ai !== 'None' && (\r\n                  <div className=\"text-xs opacity-70\">Darts thrown: {aiDartsThrown}</div>\r\n                )}\r\n                {ai !== 'None' && (\r\n                  <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {aiDoublesAtt} Â· Hit {aiDoublesHit}</span></div>\r\n                )}\r\n              </div>\r\n                </div>\r\n            </div>\r\n            )}\r\n            {/* Turn area */}\r\n            {selectedMode !== 'X01' ? (\r\n              <div className=\"space-y-2\">\r\n                {selectedMode === 'Double Practice' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'â€”'}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} onAutoDart={(value, ring) => {\r\n                        if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                          const hit = isDoubleHit(value, dpIndex)\r\n                          if (hit) { const nh = dpHits + 1; const ni = dpIndex + 1; setDpHits(nh); setDpIndex(ni); if (nh >= DOUBLE_PRACTICE_ORDER.length) setTimeout(()=>{ setDpHits(0); setDpIndex(0) }, 250) }\r\n                        }\r\n                      }} immediateAutoCommit onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-24\" type=\"number\" min={0} max={60} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e => { if (e.key==='Enter') addDpNumeric() }} />\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={addDpNumeric}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-44\" placeholder=\"Manual (D16, 50, 25, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e => { if (e.key==='Enter') addDpManual() }} />\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={addDpManual}>Add</button>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-300\">Progress: {dpHits} of 21</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Around the Clock' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || 'â€”')}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addAtcValue(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addAtcNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addAtcNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-44\" placeholder=\"Manual (T20, D5, 25, 50)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addAtcManual() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addAtcManual}>Add</button>\r\n                    </div>\r\n                    {atcHits >= ATC_ORDER.length && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={() => {\r\n                        setAtcHits(0)\r\n                        setAtcIndex(0)\r\n                        resetDartCount('Around the Clock')\r\n                      }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Cricket' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addCricketAuto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addCricketNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addCricketNumeric}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setCricket(createCricketState())\r\n                          setPracticeTurnDarts(0)\r\n                          resetDartCount('Cricket')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Shanghai' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addShanghaiAuto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addShanghaiNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addShanghaiNumeric}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setShanghai(createShanghaiState())\r\n                          setPracticeTurnDarts(0)\r\n                          resetDartCount('Shanghai')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Halve It' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addHalveAuto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addHalveNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addHalveNumeric}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setHalve(createDefaultHalveIt())\r\n                          setPracticeTurnDarts(0)\r\n                          resetDartCount('Halve It')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High-Low' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addHighLowAuto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addHighLowNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addHighLowNumeric}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setHighlow(createHighLow())\r\n                          setPracticeTurnDarts(0)\r\n                          resetDartCount('High-Low')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === \"Bob's 27\" && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addB27Auto(value, r as any, info?.sector ?? null) }} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addB27Numeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addB27Numeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetB27}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Count-Up' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value) => addCountUpAuto(value)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addCountUpAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addCountUpAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setCuRound(1)\r\n                          setCuScore(0)\r\n                          setCuDarts(0)\r\n                          resetDartCount('Count-Up')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {cuRound}/{cuMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High Score' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value) => addHighScoreAuto(value)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addHighScoreAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addHighScoreAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setHsRound(1)\r\n                          setHsScore(0)\r\n                          setHsDarts(0)\r\n                          resetDartCount('High Score')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {hsRound}/{hsMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Low Score' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value) => addLowScoreAuto(value)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addLowScoreAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addLowScoreAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button\r\n                        className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\r\n                        onClick={() => {\r\n                          setLsRound(1)\r\n                          setLsScore(0)\r\n                          setLsDarts(0)\r\n                          resetDartCount('Low Score')\r\n                        }}\r\n                      >Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {lsRound}/{lsMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 170' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring) => addCo170Auto(value, ring === 'MISS' ? undefined : ring)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (D16, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addCoManual(true) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>addCoManual(true)}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetCo170}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Remaining: {co170Rem} Â· Attempts: {co170Attempts} Â· Successes: {co170Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 121' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring) => addCo121Auto(value, ring === 'MISS' ? undefined : ring)} onAddVisit={makeOfflineAddVisitAdapter(commitManualVisitTotal)} onEndLeg={(s?: number) => matchActions.endLeg(s)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (D16, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addCoManual(false) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>addCoManual(false)}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetCo121}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Remaining: {co121Rem} Â· Attempts: {co121Attempts} Â· Successes: {co121Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Treble Practice' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addTrebleAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') { const v = parseManualDart(manualBox); if (v!=null) addTrebleAuto(v, undefined, undefined); setManualBox('') } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ const v = parseManualDart(manualBox); if (v!=null) addTrebleAuto(v, undefined, undefined); setManualBox('') }}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Hits: {trebleHits} Â· Misses: {Math.max(0, trebleDarts - trebleHits)} Â· Darts: {trebleDarts}{trebleMaxDarts>0?`/${trebleMaxDarts}`:''}</div>\r\n                    {trebleFinished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetTreble}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Baseball' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addBaseballAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetBaseball}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Golf' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addGolfAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetGolf}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Tic Tac Toe' && (\r\n                  <>\r\n                    <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                      {Array.from({length:9},(_,i)=>i).map(cell => (\r\n                        <button key={cell} className={`h-16 rounded-xl border ${ttt.board[cell]?'bg-emerald-500/20 border-emerald-400/30':'bg-slate-800/50 border-slate-700/50'}`} onClick={()=>{\r\n                          if (ttt.finished || ttt.board[cell]) return\r\n                          // One-tap claim attempt using autoscore last dart; fallback: prompt numeric\r\n                          // For simplicity here, we use a no-op value and rely on next autoscore dart; as a usable fallback, open a numeric prompt\r\n                          const promptVal = Number(prompt('Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)')||0)\r\n                          const ring = promptVal%3===0?'TRIPLE': promptVal%2===0?'DOUBLE':'SINGLE'\r\n                          const tcell = cell as unknown as 0|1|2|3|4|5|6|7|8\r\n                          const tgt = TTT_TARGETS[tcell]\r\n                          const num = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          addTttAuto(tcell, promptVal, ring as any, num as any)\r\n                        }}>{ttt.board[cell] || ''}</button>\r\n                      ))}\r\n                    </div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        // Attempt to claim the currently tapped-looking cell not tracked; as a simple flow, map by round-robin preference or let user click a cell button above.\r\n                        // No-op here; primary interaction is via buttons with prompt for now.\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetTtt}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'American Cricket' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addAmCricketAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetAmCricket}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Scam' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{SCAM_TARGET_NAMES[scamPlayer.targetIndex]}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        const r = ring === 'MISS' ? undefined : ring\r\n                        recordDart('Scam')\r\n                        setScamPlayer(addScamAuto(scamPlayer, value, r as any))\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        className=\"input w-24\"\r\n                        type=\"number\"\r\n                        min={1}\r\n                        max={25}\r\n                        value={playerDartPoints}\r\n                        onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                        onKeyDown={e=>{\r\n                          if(e.key==='Enter') {\r\n                            recordDart('Scam')\r\n                            setScamPlayer(addScamNumeric(scamPlayer, playerDartPoints))\r\n                            setPlayerDartPoints(0)\r\n                          }\r\n                        }}\r\n                      />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                        recordDart('Scam')\r\n                        setScamPlayer(addScamNumeric(scamPlayer, playerDartPoints))\r\n                        setPlayerDartPoints(0)\r\n                      }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                        setScamPlayer(resetScam())\r\n                        resetDartCount('Scam')\r\n                      }}>Reset</button>\r\n                    </div>\r\n                    {scamPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">ðŸŽ‰ Finished in {scamPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Fives' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Score: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{fivesPlayer.score}/{fivesPlayer.target}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        recordDart('Fives')\r\n                        setFivesPlayer(addFivesAuto(fivesPlayer, value, ring as any))\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        className=\"input w-24\"\r\n                        type=\"number\"\r\n                        min={5}\r\n                        max={50}\r\n                        value={playerDartPoints}\r\n                        onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                        onKeyDown={e=>{\r\n                          if(e.key==='Enter') {\r\n                            recordDart('Fives')\r\n                            setFivesPlayer(addFivesNumeric(fivesPlayer, playerDartPoints))\r\n                            setPlayerDartPoints(0)\r\n                          }\r\n                        }}\r\n                      />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                        recordDart('Fives')\r\n                        setFivesPlayer(addFivesNumeric(fivesPlayer, playerDartPoints))\r\n                        setPlayerDartPoints(0)\r\n                      }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                        setFivesPlayer(resetFives(fivesPlayer.target))\r\n                        resetDartCount('Fives')\r\n                      }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts: {fivesPlayer.darts}</div>\r\n                    {fivesPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">âœ“ Reached {fivesPlayer.target} in {fivesPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Sevens' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Score: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{sevensPlayer.score}/{sevensPlayer.target}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        recordDart('Sevens')\r\n                        setSevensPlayer(addSevensAuto(sevensPlayer, value, ring as any))\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        className=\"input w-24\"\r\n                        type=\"number\"\r\n                        min={7}\r\n                        max={21}\r\n                        value={playerDartPoints}\r\n                        onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                        onKeyDown={e=>{\r\n                          if(e.key==='Enter') {\r\n                            recordDart('Sevens')\r\n                            setSevensPlayer(addSevensNumeric(sevensPlayer, playerDartPoints))\r\n                            setPlayerDartPoints(0)\r\n                          }\r\n                        }}\r\n                      />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                        recordDart('Sevens')\r\n                        setSevensPlayer(addSevensNumeric(sevensPlayer, playerDartPoints))\r\n                        setPlayerDartPoints(0)\r\n                      }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                        setSevensPlayer(resetSevens(sevensPlayer.target))\r\n                        resetDartCount('Sevens')\r\n                      }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Valid scores: 7, 14, 21 Â· Darts: {sevensPlayer.darts}</div>\r\n                    {sevensPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">âœ“ Reached {sevensPlayer.target} in {sevensPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Killer' && (\r\n                  <>\r\n                    {!killerSetupDone ? (\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"font-semibold\">Players</div>\r\n                        <div className=\"space-y-1\">\r\n                          {killerPlayers.map((p, idx) => (\r\n                            <div key={p.id} className=\"flex items-center gap-2\">\r\n                              <input className=\"input\" value={p.name} onChange={e=>{\r\n                                const name = e.target.value\r\n                                setKillerPlayers(list => list.map((it,i)=> i===idx?{...it,name}:it))\r\n                              }} />\r\n                              <button className=\"btn px-2 py-1\" onClick={()=> setKillerPlayers(list => list.filter((_,i)=>i!==idx))} disabled={killerPlayers.length<=2}>Remove</button>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <button className=\"btn px-2 py-1\" onClick={()=> setKillerPlayers(list => {\r\n                            const id = `p${list.length+1}`; return [...list, { id, name: `Player ${list.length+1}` }]\r\n                          })}>Add Player</button>\r\n                          <button className=\"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1\" onClick={()=>{\r\n                            if (killerPlayers.length < 2) { alert('Need at least 2 players'); return }\r\n                            const ids = killerPlayers.map(p=>p.id)\r\n                            const assigned = assignKillerNumbers(ids)\r\n                            const initStates: Record<string,KillerState> = {}\r\n                            ids.forEach(id => { initStates[id] = createKillerState(assigned[id]) })\r\n                            setKillerAssigned(assigned)\r\n                            setKillerStates(initStates)\r\n                            setKillerTurnIdx(0)\r\n                            setKillerDarts(0)\r\n                            setKillerWinnerId(null)\r\n                            setKillerLastEvent('Assigned numbers')\r\n                            setKillerSetupDone(true)\r\n                          }}>Assign Numbers & Start</button>\r\n                        </div>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"space-y-3\">\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                          {killerPlayers.map(p => {\r\n                            const st = killerStates[p.id]\r\n                            const num = killerAssigned[p.id]\r\n                            return (\r\n                              <div key={p.id} className={`p-2 rounded-xl border ${st?.eliminated? 'opacity-50 border-red-500/40 bg-red-500/10' : 'border-slate-700/50 bg-slate-800/50'}`}>\r\n                                <div className=\"flex items-center justify-between text-xs\">\r\n                                  <div className=\"font-semibold\">{p.name}</div>\r\n                                  <div className={`text-[10px] px-1.5 py-0.5 rounded ${st?.isKiller?'bg-purple-500/20 text-purple-200 border border-purple-400/30':'bg-slate-600/30 text-slate-300'}`}>{st?.isKiller? 'Killer' : 'Not Killer'}</div>\r\n                                </div>\r\n                                <div className=\"mt-1 text-sm\">Number: <span className=\"font-semibold\">{num}</span></div>\r\n                                <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{st?.lives ?? 0}</span></div>\r\n                              </div>\r\n                            )\r\n                          })}\r\n                        </div>\r\n                        {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView scoringMode=\"custom\" showToolbar={cameraToolbarVisible} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                            if (killerWinnerId) return\r\n                            const r = ring === 'MISS' ? undefined : ring\r\n                            const sector = info?.sector ?? null\r\n                            const cur = killerPlayers[killerTurnIdx]\r\n                            if (!cur) return\r\n                            setKillerStates(prev => {\r\n                              const copy: Record<string,KillerState> = {}\r\n                              Object.keys(prev).forEach(k => copy[k] = { ...prev[k] })\r\n                              const res = applyKillerDart(cur.id, copy, r as any, sector)\r\n                              if (res.becameKiller) setKillerLastEvent(`${cur.name} became a Killer`)\r\n                              else if (res.victimId) {\r\n                                const v = killerPlayers.find(p=>p.id===res.victimId)\r\n                                setKillerLastEvent(`${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved||0)>1?'s':''})`)\r\n                              } else setKillerLastEvent('No effect')\r\n                              // Check winner\r\n                              const win = killerWinner(copy)\r\n                              if (win) setKillerWinnerId(win)\r\n                              return copy\r\n                            })\r\n                            setKillerDarts(d => {\r\n                              const nd = d + 1\r\n                              if (nd >= 3) {\r\n                                // advance to next alive\r\n                                let next = killerTurnIdx\r\n                                for (let i=1;i<=killerPlayers.length;i++) {\r\n                                  const idx = (killerTurnIdx + i) % killerPlayers.length\r\n                                  const pid = killerPlayers[idx].id\r\n                                  const st = killerStates[pid]\r\n                                  if (st && !st.eliminated && st.lives > 0) { next = idx; break }\r\n                                }\r\n                                setKillerTurnIdx(next)\r\n                                return 0\r\n                              }\r\n                              return nd\r\n                            })\r\n                          }} />\r\n                        </div>}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input className=\"input w-40\" placeholder=\"Manual (D16, T5)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') {\r\n                            if (killerWinnerId) return\r\n                            const t = manualBox.trim().toUpperCase()\r\n                            const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n                            if (!m) { setManualBox(''); return }\r\n                            const mult = (m[1]||'S') as 'S'|'D'|'T'\r\n                            const num = parseInt(m[2],10)\r\n                            const ring = mult==='D'?'DOUBLE': mult==='T'?'TRIPLE':'SINGLE'\r\n                            const cur = killerPlayers[killerTurnIdx]\r\n                            setKillerStates(prev => {\r\n                              const copy: Record<string,KillerState> = {}\r\n                              Object.keys(prev).forEach(k => copy[k] = { ...prev[k] })\r\n                              const res = applyKillerDart(cur.id, copy, ring as any, num)\r\n                              if (res.becameKiller) setKillerLastEvent(`${cur.name} became a Killer`)\r\n                              else if (res.victimId) {\r\n                                const v = killerPlayers.find(p=>p.id===res.victimId)\r\n                                setKillerLastEvent(`${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved||0)>1?'s':''})`)\r\n                              } else setKillerLastEvent('No effect')\r\n                              const win = killerWinner(copy); if (win) setKillerWinnerId(win)\r\n                              return copy\r\n                            })\r\n                            setManualBox('')\r\n                            setKillerDarts(d => {\r\n                              const nd = d + 1\r\n                              if (nd >= 3) { let next = killerTurnIdx; for (let i=1;i<=killerPlayers.length;i++){ const idx=(killerTurnIdx+i)%killerPlayers.length; const pid=killerPlayers[idx].id; const st=killerStates[pid]; if (st && !st.eliminated && st.lives>0) { next=idx; break } } setKillerTurnIdx(next); return 0 } return nd\r\n                            })\r\n                          } }} />\r\n                          <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                            // Skip to next alive player\r\n                            let next = killerTurnIdx\r\n                            for (let i=1;i<=killerPlayers.length;i++) {\r\n                              const idx = (killerTurnIdx + i) % killerPlayers.length\r\n                              const pid = killerPlayers[idx].id\r\n                              const st = killerStates[pid]\r\n                              if (st && !st.eliminated && st.lives > 0) { next = idx; break }\r\n                            }\r\n                            setKillerTurnIdx(next); setKillerDarts(0)\r\n                          }}>Next Player</button>\r\n                          <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                            // Reset Killer\r\n                            setKillerStates({}); setKillerAssigned({}); setKillerSetupDone(false); setKillerTurnIdx(0); setKillerDarts(0); setKillerWinnerId(null); setKillerLastEvent('')\r\n                          }}>Reset</button>\r\n                        </div>\r\n                        {killerWinnerId && (\r\n                          <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Winner: {killerPlayers.find(p=>p.id===killerWinnerId)?.name} <button className=\"ml-2 underline\" onClick={()=>{\r\n                            setKillerStates({}); setKillerAssigned({}); setKillerSetupDone(false); setKillerTurnIdx(0); setKillerDarts(0); setKillerWinnerId(null); setKillerLastEvent('')\r\n                          }}>Play Again</button></div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-2\">\r\n                {/* Scorecard + Camera split (Option A): Scoreboard LEFT, Camera RIGHT */}\r\n                <div className=\"flex gap-3 min-h-0 flex-1 text-[14px]\">\r\n                      {/* Left column: Scoreboard + Manual Scoring (50% width) */}\r\n                      <div className=\"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm\">\r\n                        <div className=\"text-sm font-semibold opacity-80\">Scoreboard</div>\r\n                        {/* Scoreboard */}\r\n                        <div className=\"flex-shrink-0\">\r\n                          <GameScoreboard\r\n                            gameMode={selectedMode as any}\r\n                            players={statsX01}\r\n                            matchScore={`${playerLegs}-${aiLegs}`}\r\n                          />\r\n                        </div>\r\n\r\n                        {/* Manual Scoring Section */}\r\n                        {isPlayerTurn && (\r\n                          <div className=\"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0\">\r\n                            <div className=\"flex flex-wrap items-center justify-between gap-3\">\r\n                              <h4 className=\"text-sm font-semibold tracking-wide uppercase text-indigo-200\">Manual Scoring</h4>\r\n                              <span className=\"text-xs text-white/60\">Override a visit or enter dart-by-dart scores.</span>\r\n                            </div>\r\n                            <div className=\"mt-3 space-y-3\">\r\n                              <div className=\"flex flex-wrap items-center gap-2\">\r\n                                <label className=\"text-xs uppercase tracking-wide text-white/60\">Single Dart</label>\r\n                                <input\r\n                                  className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                  type=\"number\"\r\n                                  min={0}\r\n                                  max={60}\r\n                                  value={playerDartPoints}\r\n                                  onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                                  onKeyDown={e => { if (e.key === 'Enter') (e.shiftKey ? replaceLast() : addDartNumeric()) }}\r\n                                  placeholder=\"60\"\r\n                                />\r\n                                <button className=\"btn px-3 py-1 text-sm\" onClick={addDartNumeric}>Add Dart</button>\r\n                              </div>\r\n\r\n                              <div className=\"flex flex-wrap items-center gap-2\">\r\n                                <label className=\"text-xs uppercase tracking-wide text-white/60\">Three Dart Edit</label>\r\n                                <input\r\n                                  className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                  type=\"number\"\r\n                                  min={0}\r\n                                  max={playerScore <= 170 ? 170 : 180}\r\n                                  value={visitTotalInput}\r\n                                  onChange={e=>handleVisitTotalChange(e.target.value)}\r\n                                  onKeyDown={e => { if (e.key==='Enter') addVisitTotal() }}\r\n                                  placeholder=\"100\"\r\n                                />\r\n                                <button className=\"btn px-3 py-1 text-sm\" onClick={addVisitTotal}>Commit Visit</button>\r\n                                <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={replaceLast}>Undo Visit</button>\r\n                              </div>\r\n\r\n                              <div className=\"flex flex-wrap items-center gap-2\">\r\n                                <label className=\"text-xs uppercase tracking-wide text-white/60\">Manual</label>\r\n                                <input\r\n                                  className=\"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\r\n                                  value={manualBox}\r\n                                  onChange={e=>setManualBox(e.target.value)}\r\n                                  onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLastManual() : addManual()) }}\r\n                                  placeholder=\"T20\"\r\n                                />\r\n                                <button className=\"btn px-3 py-1 text-sm\" onClick={addManual}>Apply</button>\r\n                                <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={replaceLastManual} disabled={playerVisitDarts===0}>Replace Last</button>\r\n                              </div>\r\n\r\n                              <div>\r\n                                <label className=\"text-xs uppercase tracking-wide text-white/60\">Multi-entry (one per line)</label>\r\n                                <textarea\r\n                                  className=\"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30\"\r\n                                  rows={3}\r\n                                  value={manualTextarea}\r\n                                  onChange={e=>setManualTextarea(e.target.value)}\r\n                                  placeholder={'T20\\nD16\\n25'}\r\n                                />\r\n                                <div className=\"mt-2 flex flex-wrap gap-2\">\r\n                                  <button className=\"btn px-3 py-1 text-sm\" onClick={addManualTextarea}>Apply All</button>\r\n                                  <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={() => setManualTextarea('')}>Clear</button>\r\n                                </div>\r\n                              </div>\r\n\r\n                              <div className=\"pt-2 border-t border-white/10 mt-3\">\r\n                                <button\r\n                                  className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\r\n                                  onClick={clearCurrentVisit}\r\n                                  disabled={playerVisitDarts === 0 && playerVisitSum === 0}\r\n                                >Clear Current Visit</button>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Right column: Main Camera Feed (50% width) */}\r\n                      {cameraEnabled && (\r\n                        <div className=\"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView\r\n                            scoringMode=\"custom\"\r\n                            showToolbar={cameraToolbarVisible}\r\n                            immediateAutoCommit\r\n                            onAutoDart={(value, ring) => {\r\n                              const ringLabel = ring ?? 'MISS'\r\n                              const safeValue = Number.isFinite(value) ? Math.max(0, value) : 0\r\n                              const now = Date.now()\r\n                              if (safeValue <= 0) {\r\n                                if (ringLabel !== 'MISS') return\r\n                                if (now - (lastBounceMissTsRef.current || 0) < 1200) {\r\n                                  return\r\n                                }\r\n                                lastBounceMissTsRef.current = now\r\n                              } else {\r\n                                lastBounceMissTsRef.current = 0\r\n                              }\r\n                              applyDartValue(safeValue)\r\n                            }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                </div>\r\n                {/* Remove the separate camera view below scoreboard */}\r\n                {(selectedMode as any) === 'X01' && !cameraEnabled && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode={selectedMode as any}\r\n                      players={statsX01}\r\n                      matchScore={`${playerLegs}-${aiLegs}`}\r\n                    />\r\n                  </>\r\n                )}\r\n                {(selectedMode as any) === 'Cricket' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Cricket\"\r\n                      players={statsCricket}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Cricket auto-scoring */}\r\n                {(selectedMode as any) === 'Cricket' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          const r = ring === 'MISS' ? undefined : ring\r\n                          addCricketAuto(value, r as any, info?.sector ?? null)\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Shanghai' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Shanghai\"\r\n                      players={statsShanghai}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Shanghai auto-scoring */}\r\n                {(selectedMode as any) === 'Shanghai' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          const r = ring === 'MISS' ? undefined : ring\r\n                          addShanghaiAuto(value, r as any, info?.sector ?? null)\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Killer' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Killer\"\r\n                      players={statsKiller}\r\n                    />\r\n                  </>\r\n                )}\r\n                {(selectedMode as any) === 'Scam' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Scam\"\r\n                      players={statsScam}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Scam auto-scoring */}\r\n                {(selectedMode as any) === 'Scam' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setScamPlayer(addScamAuto(scamPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Fives' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Fives\"\r\n                      players={statsFives}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Fives auto-scoring */}\r\n                {(selectedMode as any) === 'Fives' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setFivesPlayer(addFivesAuto(fivesPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Sevens' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Sevens\"\r\n                      players={statsSevens}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Sevens auto-scoring */}\r\n                {(selectedMode as any) === 'Sevens' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={cameraToolbarVisible}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setSevensPlayer(addSevensAuto(sevensPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                <div className=\"font-semibold\">Your Turn</div>\r\n                <div className=\"flex flex-col gap-2\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-24\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      max={60}\r\n                      value={playerDartPoints}\r\n                      onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                      onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLast() : addDartNumeric()) }}\r\n                    />\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addDartNumeric} title=\"Add a single dart (0â€“60)\">Add Dart</button>\r\n                  </div>\r\n                  {/* Visit total entry */}\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-28\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      max={playerScore <= 170 ? 170 : 180}\r\n                      placeholder=\"Visit total (0â€“180)\"\r\n                      value={visitTotalInput}\r\n                      onChange={e=>handleVisitTotalChange(e.target.value)}\r\n                      onKeyDown={e => { if (e.key==='Enter') addVisitTotal() }}\r\n                    />\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addVisitTotal} title=\"Commit a full 3-dart total like 93\">Commit Visit</button>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-44\"\r\n                      placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                      value={manualBox}\r\n                      onChange={e=>setManualBox(e.target.value)}\r\n                      onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLastManual() : addManual()) }}\r\n                    />\r\n                    <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={replaceLastManual} disabled={playerVisitDarts===0}>Replace Last</button>\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addManual}>Add</button>\r\n                  </div>\r\n                  <div>\r\n                    <textarea\r\n                      className=\"input w-full h-24 resize-none\"\r\n                      placeholder=\"Type scores manually (one per line, e.g. T20&#10;D16&#10;5&#10;25&#10;50) - No camera needed!\"\r\n                      value={manualTextarea}\r\n                      onChange={e=>setManualTextarea(e.target.value)}\r\n                    />\r\n                    <div className=\"flex gap-2 mt-1\">\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addManualTextarea}>Add All Scores</button>\r\n                      <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={() => setManualTextarea('')}>Clear</button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-xs text-slate-300\">Tip: Enter to Add Â· Shift+Enter to Replace Last</div>\r\n              </div>\r\n            )}\r\n            <div className=\"h-1\" />\r\n              </div>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {showRules && <X01RulesPopup onClose={() => setShowRules(false)} />}\r\n      {/* Frosted overlay when selecting premium mode without access */}\r\n      {lockedPremium && (\r\n        <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n          <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n            <div className=\"text-3xl mb-2\">ðŸ”’</div>\r\n            <div className=\"font-semibold\">Premium mode locked</div>\r\n            <div className=\"text-sm text-slate-200/80\">Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more.</div>\r\n            <button\r\n              onClick={async () => {\r\n                try {\r\n                  const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ email: user?.email })\r\n                  });\r\n                  const data = await res.json();\r\n                  if (data.ok && data.url) {\r\n                    window.location.href = data.url;\r\n                    if (data.development) {\r\n                      toast(\"Opened Stripe test checkout (development mode)\", { type: 'info', timeout: 3000 });\r\n                    }\r\n                  } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                    toast(\"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\", { type: 'error', timeout: 4000 });\r\n                  } else {\r\n                    toast(\"Failed to create checkout session. Please try again.\", { type: 'error', timeout: 4000 });\r\n                  }\r\n                } catch (err) {\r\n                  toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n                }\r\n              }}\r\n              className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n            >\r\n              Upgrade to PREMIUM Â· {formatPriceInCurrency(getUserCurrency(), 5)}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showCameraManager && typeof document !== 'undefined' ? createPortal(\r\n        <div className=\"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4\" onClick={() => setShowCameraManager(false)}>\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:offline-camera-manager\"\r\n            className=\"relative\"\r\n            defaultWidth={640}\r\n            defaultHeight={520}\r\n            minWidth={480}\r\n            minHeight={420}\r\n            maxWidth={1200}\r\n            maxHeight={900}\r\n            initialFitHeight\r\n            onClose={() => setShowCameraManager(false)}\r\n          >\r\n            <div className=\"space-y-3\" onClick={e => e.stopPropagation()}>\r\n              <div className=\"flex items-center justify-between gap-3\">\r\n                <div>\r\n                  <div className=\"text-xs uppercase tracking-wide text-white/50\">Camera Devices</div>\r\n                  <div className=\"text-xl font-semibold text-white mt-1\">Manage Offline Camera Feeds</div>\r\n                </div>\r\n                <button className=\"btn bg-slate-800 hover:bg-slate-700 text-white\" onClick={() => setShowCameraManager(false)}>Close</button>\r\n              </div>\r\n              <CameraTile\r\n                fill\r\n                user={user}\r\n                playerScore={playerScore}\r\n                aiScore={aiScore}\r\n                x01Score={x01Score}\r\n                inMatch={inMatch}\r\n                showWinPopup={showWinPopup}\r\n                pendingLegWinner={pendingLegWinner}\r\n                playerDartsThrown={playerDartsThrown}\r\n                aiDartsThrown={aiDartsThrown}\r\n                totalPlayerDarts={totalPlayerDarts}\r\n                totalAiDarts={totalAiDarts}\r\n                totalPlayerPoints={totalPlayerPoints}\r\n                totalAiPoints={totalAiPoints}\r\n                player180s={player180s}\r\n                player140s={player140s}\r\n                player100s={player100s}\r\n                ai180s={ai180s}\r\n                ai140s={ai140s}\r\n                ai100s={ai100s}\r\n                playerHighestCheckout={playerHighestCheckout}\r\n                aiHighestCheckout={aiHighestCheckout}\r\n                onClose={() => setShowCameraManager(false)}\r\n                onOpen={() => setShowCameraManager(true)}\r\n                layout={offlineLayout}\r\n              />\r\n            </div>\r\n          </ResizableModal>\r\n        </div>,\r\n        document.body\r\n      ) : null}\r\n      {legOverrideConfirm && typeof document !== 'undefined' ? createPortal((() => {\r\n        const { target, value, stage } = legOverrideConfirm\r\n        const targetName = target === 'player' ? humanName : aiDisplayName\r\n        const currentLegs = target === 'player' ? playerLegs : aiLegs\r\n        return (\r\n          <div className=\"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4\" onClick={handleLegOverrideNo}>\r\n            <ResizableModal\r\n              storageKey=\"ndn:modal:offline-leg-override\"\r\n              className=\"relative\"\r\n              defaultWidth={360}\r\n              defaultHeight={240}\r\n              minWidth={280}\r\n              minHeight={200}\r\n              maxWidth={420}\r\n              maxHeight={360}\r\n              initialFitHeight\r\n              onClose={handleLegOverrideNo}\r\n            >\r\n              <div className=\"space-y-3 max-w-[18rem] mx-auto\" onClick={e => e.stopPropagation()}>\r\n                <div>\r\n                  <div className=\"text-xs uppercase tracking-wide text-white/50\">Step {stage} of 2</div>\r\n                  <div className=\"text-xl font-semibold text-white mt-1\">Override legs?</div>\r\n                </div>\r\n                <div className=\"text-sm text-slate-200 leading-relaxed\">\r\n                  {stage === 1 ? (\r\n                    <>Set {targetName}&apos;s legs to <span className=\"font-semibold text-white\">{value}</span>? Confirm to continue.</>\r\n                  ) : (\r\n                    <>Final confirmation: set {targetName}&apos;s legs to <span className=\"font-semibold text-white\">{value}</span>. Select <span className=\"font-semibold text-emerald-200\">Yes</span> to apply immediately.</>\r\n                  )}\r\n                </div>\r\n                <div className=\"rounded-xl bg-black/40 border border-white/10 p-3 text-sm\">\r\n                  <div className=\"text-xs uppercase tracking-wide text-white/50 mb-1\">Current legs</div>\r\n                  <div className=\"text-base font-semibold text-white\">{currentLegs}</div>\r\n                </div>\r\n                <div className=\"flex items-center justify-end gap-2 pt-2\">\r\n                  <button className=\"btn bg-rose-600 hover:bg-rose-700 text-white\" onClick={handleLegOverrideNo}>No</button>\r\n                  <button className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={handleLegOverrideYes}>Yes</button>\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        )\r\n      })(), document.body) : null}\r\n        {showWinPopup && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <ResizableModal storageKey=\"ndn:modal:offline-win\" className=\"w-full relative\" defaultWidth={420} defaultHeight={360} minWidth={360} minHeight={300} maxWidth={800} maxHeight={700} initialFitHeight>\r\n            <h3 className=\"text-lg font-bold mb-2\">Leg Won!</h3>\r\n            <label className=\"block mb-1\">Darts to hit double:</label>\r\n            <div className=\"flex gap-2 mb-2\">\r\n              {[1,2,3].map(n => (\r\n                <button key={n} className={`btn ${doubleDarts===n?'bg-brand-600':''}`} onClick={()=>setDoubleDarts(n)}>{n}</button>\r\n              ))}\r\n            </div>\r\n            <label className=\"block mb-1\">Darts for checkout:</label>\r\n            <div className=\"flex gap-2 mb-2\">\r\n              {[1,2,3].map(n => (\r\n                <button key={n} className={`btn ${checkoutDarts===n?'bg-brand-600':''}`} onClick={()=>setCheckoutDarts(n)}>{n}</button>\r\n              ))}\r\n            </div>\r\n            <div className=\"grid grid-cols-1 gap-2 mt-2\">\r\n              <button className=\"btn w-full\" onClick={handleWinPopupSubmit}>Submit</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700 w-full\" onClick={() => { setShowWinPopup(false); startMatch(); }}>Rematch</button>\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800 w-full\" onClick={() => { setShowWinPopup(false); setShowMatchModal(false); setInMatch(false); }}>Back to Menu</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {showMatchSummary && (\r\n        <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]\">\r\n          <ResizableModal storageKey=\"ndn:modal:offline-summary\" className=\"w-full relative\" defaultWidth={820} defaultHeight={520} minWidth={600} minHeight={400} maxWidth={1400} maxHeight={1000} initialFitHeight>\r\n            <h3 className=\"text-xl font-extrabold mb-2\">Match Summary</h3>\r\n            <div className=\"text-xs opacity-80 mb-3\">{selectedMode} Â· {x01Score} start Â· First to {firstTo}</div>\r\n            {(() => {\r\n              const player3da = totalPlayerDarts>0 ? ((totalPlayerPoints/totalPlayerDarts)*3) : 0\r\n              const player9da = player3da * 3\r\n              const playerBest = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='player' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return 'â€”'\r\n                return `${Math.min(...darts)} darts`\r\n              })()\r\n              const playerWorst = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='player' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return 'â€”'\r\n                return `${Math.max(...darts)} darts`\r\n              })()\r\n              const playerPct = playerDoublesAtt>0 ? Math.round((playerDoublesHit/playerDoublesAtt)*100) : 0\r\n\r\n              const ai3da = totalAiDarts>0 ? ((totalAiPoints/totalAiDarts)*3) : 0\r\n              const ai9da = ai3da * 3\r\n              const aiBest = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='ai' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return 'â€”'\r\n                return `${Math.min(...darts)} darts`\r\n              })()\r\n              const aiWorst = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='ai' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return 'â€”'\r\n                return `${Math.max(...darts)} darts`\r\n              })()\r\n              const aiPct = aiDoublesAtt>0 ? Math.round((aiDoublesHit/aiDoublesAtt)*100) : 0\r\n\r\n              return (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                  <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                    <div className=\"text-sm font-semibold mb-1\">{user?.username || 'You'}</div>\r\n                    <div className=\"text-3xl font-extrabold\">{playerLegs}</div>\r\n                    <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                    <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                      <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{player3da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{player9da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{playerDoublesAtt}</div></div>\r\n                      <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{playerPct}%</div></div>\r\n                      <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{playerBest}</div></div>\r\n                      <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{playerWorst}</div></div>\r\n                      <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{player180s}</div></div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"hidden md:flex items-center justify-center\">\r\n                    <div className=\"text-4xl font-black\">{playerLegs} â€“ {aiLegs}</div>\r\n                  </div>\r\n                  <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                    <div className=\"text-sm font-semibold mb-1\">{ai==='None' ? 'Opponent' : `${ai} AI`}</div>\r\n                    <div className=\"text-3xl font-extrabold\">{aiLegs}</div>\r\n                    <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                    <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                      <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{ai3da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{ai9da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{aiDoublesAtt}</div></div>\r\n                      <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{aiPct}%</div></div>\r\n                      <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{aiBest}</div></div>\r\n                      <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{aiWorst}</div></div>\r\n                      <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{ai180s}</div></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            })()}\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm font-semibold mb-2\">Legs Timeline</div>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {legStats.map((leg, i) => (\r\n                  <div key={i} className={`px-3 py-1 rounded-full border text-xs ${leg.winner==='player' ? 'bg-emerald-500/15 border-emerald-400/30' : 'bg-fuchsia-500/15 border-fuchsia-400/30'}`}>\r\n                    Leg {i+1}: {leg.winner==='player' ? 'You' : (ai==='None'?'Opp':'AI')} Â· Dbl {leg.doubleDarts} Â· CO {leg.checkoutDarts}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm font-semibold mb-2\">Shot Heat Map</div>\r\n              <div className=\"rounded-2xl overflow-hidden bg-black p-3\">\r\n                {/* Lazy-load HeatMap component to avoid increasing initial bundle too much */}\r\n                <HeatMap />\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => setShowMatchSummary(false)}>Close</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={() => { setShowMatchSummary(false); startMatch(); }}>Rematch</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {legStats.length > 0 && (\r\n        <div className=\"mt-4\">\r\n          <h4 className=\"font-semibold mb-2\">Leg Stats</h4>\r\n          <ul>\r\n            {legStats.map((leg, i) => (\r\n              <li key={i}>Leg {i+1}: Double darts: {leg.doubleDarts}, Checkout darts: {leg.checkoutDarts}</li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n      \r\n  {/* Phone camera overlay removed per UX preference; use header badge preview only */}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":["doubles","dVal","tag","prefsDoubleScore","fav","suggestCheckouts","remaining","favoriteDouble","hardcoded","target","routes","t","s","sayScore","name","scored","voiceName","opts","synth","msg","isCheckout","isOneEighty","v","GameCalibrationStatus","gameMode","compact","onRecalibrate","H","errorPx","useCalibration","confidence","getCalibrationConfidenceForGame","suitable","isCalibrationSuitableForGame","quality","text","getCalibrationQualityText","recommendation","getRecalibrationRecommendation","requirement","GAME_CALIBRATION_REQUIREMENTS","jsxs","jsx","AlertTriangle","bgColor","textColor","icon","CheckCircle","React","AlertCircle","Zap","CameraTile","label","autoStart","scaleOverride","className","aspect","style","fill","videoRef","useRef","cameraSession","useCameraSession","streaming","setStreaming","useState","ws","setWs","pairCode","setPairCode","pc","setPc","lastRegisteredModeRef","registerStream","useCallback","stream","modeOverride","err","preferredCameraLabel","useUserSettings","mode","setMode","expiresAt","setExpiresAt","paired","setPaired","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","cameraEnabledSetting","setPreferredCameraLocked","preferredCameraLocked","setPreferredCamera","preferredCameraId","fallbackClass","fallbackStyle","useEffect","apiFetch","r","j","ip","x","mobileUrl","useMemo","code","envUrl","u","host","useHttps","port","manualModeSetAt","setManualModeSetAt","cancelled","desiredLabel","timer","start","stop","apply","startWifiConnection","startPhonePairing","constraints","devices","discoverNetworkDevices","error","connectToWifiDevice","device","d","connectToNetworkDevice","startUsbConnection","discoverUSBDevices","newDevice","requestUSBDevice","prev","connectToUsbDevice","connectToUSBDevice","handleModeSelect","newMode","onStart","ev","modeFromEvent","ensureWS","normalizedEnv","proto","sameOrigin","isLocalhost","isRenderHost","renderWS","url","socket","data","peer","e","inbound","offer","regenerateCode","stopAll","CameraFrame","props","cameraScale","storedAspect","onModeSelect","modeDisplayName","reconnectOptions","copyFeedback","setCopyFeedback","copyTimeoutRef","globalFitMode","effectiveFitMode","scale","raw","clamped","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","usbActive","videoElement","baseVideoClass","copyValue","value","type","textarea","Fragment","option","isActive","polarToCartesian","cx","cy","angleDeg","a","sectorAngle","sector","HeatMap","width","height","samples","useHeatmapStore","ref","c","ctx","BoardRadii","radii","ringOrder","k","points","angle","p","grd","sectorCounts","secStr","sec","pos","DOUBLE_PRACTICE_ORDER","_","i","isDoubleHit","targetIdx","parseManualDart","input","m","mult","num","ATC_ORDER","CRICKET_NUMBERS","createCricketState","marks","n","applyCricketDart","state","ring","opponentClosed","hits","cand","before","remainToClose","toApply","overflow","after","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","endShanghaiTurn","next","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","endHalveItTurn","createHighLow","applyHighLowDart","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","res","id","idx","applyKillerDart","selfId","states","me","victimId","pid","victim","delta","killerWinner","alive","st","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","TTT_TARGETS","createTicTacToe","checkWin","board","lines","b","tryClaimCell","cell","tgt","ok","w","createScamState","SCAM_TARGETS","SCAM_TARGET_NAMES","getScamTarget","addScamAuto","newIndex","finished","addScamNumeric","resetScam","createFivesState","FIVES_VALID_NUMBERS","isFivesValid","addFivesAuto","newScore","addFivesNumeric","resetFives","createSevensState","SEVENS_VALID_NUMBERS","isSevensValid","addSevensAuto","addSevensNumeric","resetSevens","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","GameHeaderBar","left","right","sticky","GameScoreboard","players","matchScore","gameRules","player","ScoreRow","AvgDifferenceRow","formatCricketClosed","getCricketStatus","mono","bold","highlight","matchAvg","allTimeAvg","diff","isPositive","isNeutral","diffText","diffColor","closed","count","closedCount","makeOfflineAddVisitAdapter","commitManualVisitTotal","score","darts","createOfflineMatchActions","args","match","endTurn","meta","useOfflineGameStats","playerScore","aiScore","playerLegs","aiLegs","playerLastDart","aiLastDart","playerVisitSum","aiVisitSum","playerLastVisitScore","aiLastVisitScore","playerVisitDartCount","aiVisitDartCount","playerDoublesHit","playerDoublesAtt","aiDoublesHit","aiDoublesAtt","legStats","isPlayerTurn","ai","x01Score","cricket","shanghai","killerPlayers","killerStates","killerAssigned","killerTurnIdx","playerMatchAvg","playerDarts","playerScored","leg","resolvedPlayerLastScore","l","getAllTimeAvg","resolvedAiLastScore","aiLevels","clamp","min","max","BOARD_CLEAR_GRACE_MS","aiVisitScore","level","candidates","X01RulesPopup","onClose","API_URL","OfflinePlay","user","offlineLayout","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","rememberLastOffline","setLastOffline","autoStartOffline","setCameraScale","cameraAspect","setCameraAspect","cameraFitMode","setCameraFitMode","cameraEnabled","textSize","boxSize","autoCommitMode","matchType","setMatchType","teamAName","setTeamAName","teamBName","setTeamBName","manualScoring","cameraToolbarVisible","waitForBoardClear","selectedMode","setSelectedMode","setX01Score","setAI","showRules","setShowRules","inMatch","setInMatch","setPlayerScore","setAiScore","onDouble","setOnDouble","showWinPopup","setShowWinPopup","firstTo","setFirstTo","setPlayerLegs","useMatch","showStartShowcase","setShowStartShowcase","startedShowcasedRef","setAiLegs","pendingLegWinner","setPendingLegWinner","doubleDarts","setDoubleDarts","checkoutDarts","setCheckoutDarts","setLegStats","aiDelayMs","setAiDelayMs","toast","useToast","showMatchModal","setShowMatchModal","maximized","setMaximized","fitAll","setFitAll","fitScale","setFitScale","fitOverflowing","setFitOverflowing","setIsPlayerTurn","handleOpenManager","setShowCameraManager","playerDartPoints","setPlayerDartPoints","dpIndex","setDpIndex","dpHits","setDpHits","atcIndex","setAtcIndex","atcHits","setAtcHits","setCricket","setShanghai","halve","setHalve","highlow","setHighlow","practiceTurnDarts","setPracticeTurnDarts","b27Stage","setB27Stage","b27Score","setB27Score","b27Darts","setB27Darts","b27Hits","setB27Hits","b27Finished","setB27Finished","cuRound","setCuRound","cuScore","setCuScore","cuDarts","setCuDarts","cuMaxRounds","hsRound","setHsRound","hsScore","setHsScore","hsDarts","setHsDarts","hsMaxRounds","lsRound","setLsRound","lsScore","setLsScore","lsDarts","setLsDarts","lsMaxRounds","co170Rem","setCo170Rem","co170Darts","setCo170Darts","co170Attempts","setCo170Attempts","co170Successes","setCo170Successes","co121Rem","setCo121Rem","co121Darts","setCo121Darts","co121Attempts","setCo121Attempts","co121Successes","setCo121Successes","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","trebleMaxDarts","setTrebleMaxDarts","trebleFinished","setTrebleFinished","baseball","setBaseball","golf","setGolf","ttt","setTTT","amCricket","setAmCricket","setKillerPlayers","setKillerStates","setKillerAssigned","killerSetupDone","setKillerSetupDone","setKillerTurnIdx","killerDarts","setKillerDarts","killerWinnerId","setKillerWinnerId","killerLastEvent","setKillerLastEvent","scam","setScam","scamPlayer","setScamPlayer","fives","setFives","fivesPlayer","setFivesPlayer","sevens","setSevens","sevensPlayer","setSevensPlayer","playerDartsThrown","setPlayerDartsThrown","setPlayerLastDart","playerVisitDarts","setPlayerVisitDarts","playerVisitStart","setPlayerVisitStart","setPlayerVisitSum","setPlayerLastVisitScore","playerVisitDartsAtDouble","setPlayerVisitDartsAtDouble","lastBounceMissTsRef","lastVisitDartsRef","playerScoreRef","playerVisitDartsRef","playerVisitSumRef","playerVisitStartRef","playerVisitDartsAtDoubleRef","aiCountdownMs","setAiCountdownMs","aiDartsThrown","setAiDartsThrown","setAiLastDart","setAiVisitSum","aiVisitDarts","setAiVisitDarts","setAiLastVisitScore","aiVisitDartsAtDouble","setAiVisitDartsAtDouble","setPlayerDoublesAtt","setPlayerDoublesHit","setAiDoublesAtt","setAiDoublesHit","totalPlayerDarts","setTotalPlayerDarts","totalAiDarts","setTotalAiDarts","totalPlayerPoints","setTotalPlayerPoints","totalAiPoints","setTotalAiPoints","player180s","setPlayer180s","player140s","setPlayer140s","player100s","setPlayer100s","ai180s","setAi180s","ai140s","setAi140s","ai100s","setAi100s","playerHighestCheckout","setPlayerHighestCheckout","aiHighestCheckout","setAiHighestCheckout","showMatchSummary","setShowMatchSummary","manualBox","setManualBox","manualTextarea","setManualTextarea","manualPlayerScoreInput","setManualPlayerScoreInput","manualOpponentScoreInput","setManualOpponentScoreInput","manualPlayerLegsInput","setManualPlayerLegsInput","manualOpponentLegsInput","setManualOpponentLegsInput","legOverrideConfirm","setLegOverrideConfirm","showCameraManager","dartCounts","setDartCounts","awaitingBoardClear","setAwaitingBoardClear","pendingVisitRef","pendingVisitTimerRef","clearPendingVisitTimer","speakAutoVisit","pending","speaker","commitPendingVisit","_trigger","visitTotal","preRemaining","doubleAttempts","doubleWindow","highestCheckout","h","useAudit","finalizePendingVisit","trigger","queuePendingVisit","handler","humanName","aiDisplayName","statsX01","statsCricket","statsShanghai","statsKiller","statsScam","statsFives","statsSevens","activeScoreboardStats","list","playerResolvedLastScore","aiResolvedLastScore","singlePlayerScoreboard","rest","inactivePlayerName","activePlayerName","activeRemaining","activeLastScore","recordDart","resetDartCount","parseManualScoreOverride","parsed","parseManualLegsOverride","cancelPendingAutoVisit","nextScore","safeScore","nextVisitStart","handleManualScoreOverride","applyManualLegOverride","handleManualLegsOverride","handleLegOverrideYes","handleLegOverrideNo","handleKey","event","buttonSizeClass","size","scrollerRef","contentRef","headerBarRef","formatType","setFormatType","formatCount","setFormatCount","formatRef","wins","measure","scroller","content","headerH","availH","availW","rect","currentScale","naturalHeight","naturalWidth","scaleH","scaleW","scaledHeight","overflowing","RO","ro","onAuto","startMatch","onFmt","raf","last","tick","now","dt","visitDarts","targetVisit","dart","preRem","postRem","checkout","startNextLeg","nextRemaining","applyDartValue","currentScore","currentVisitDarts","currentVisitSum","currentVisitStart","currentVisitDartsAtDouble","newVisitDarts","postRemaining","attemptsThisVisit","newVisitSum","startedDoubleWindow","stillInDoubleWindow","doubleAttemptsNow","inDoubleWindow","attemptsForVisit","addDartNumeric","rawTotal","visitStart","liveScore","existingDarts","existingSum","hadPartialVisit","checkoutCap","total","matchActions","visitTotalInput","setVisitTotalInput","handleVisitTotalChange","numericOnly","maxAllowed","safe","addVisitTotal","bounded","clearCurrentVisit","onClearRequest","evt","detail","addDpValue","val","nextHits","addDpNumeric","addDpManual","addB27Auto","hit","nd","totalHits","addB27Numeric","resetB27","addCountUpAuto","addHighScoreAuto","addLowScoreAuto","applyCheckout","rem","setRem","setDarts","setAttempts","setSuccesses","addCo170Auto","addCo121Auto","addCoManual","is170","isDouble","resetCo170","resetCo121","addTrebleAuto","cycle","resetTreble","addBaseballAuto","cp","resetBaseball","addGolfAuto","resetGolf","addTttAuto","resetTtt","addAmCricketAuto","resetAmCricket","addAtcValue","newHits","addAtcNumeric","addAtcManual","addCricketAuto","copy","addCricketNumeric","addShanghaiAuto","addShanghaiNumeric","addHalveAuto","addHalveNumeric","addHighLowAuto","addHighLowNumeric","parseManualBox","addManual","addManualTextarea","line","replaceLast","replaceLastManual","rewind","handleWinPopupSubmit","winner","legDoublesAtt","legDoublesHit","winnerDarts","bumpGameMode","lockedPremium","freeGames","MatchStartShowcase","premiumGames","ResizableModal","el","disabled","pillCls","cricketClosedAll","CameraView","info","MatchControls","first","ResizablePanel","currentThrower","currentRemaining","lastScoreDisplay","dartsThrown","avg3","bestLegText","nh","ni","promptVal","tcell","cur","win","it","ids","initStates","ringLabel","safeValue","formatPriceInCurrency","getUserCurrency","createPortal","stage","targetName","currentLegs","player3da","player9da","playerBest","playerWorst","playerPct","ai3da","ai9da","aiBest","aiWorst","aiPct"],"mappings":"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"}
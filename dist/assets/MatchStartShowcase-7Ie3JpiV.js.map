{"version":3,"file":"MatchStartShowcase-7Ie3JpiV.js","sources":["../../src/components/ui/CalibrationPopup.tsx","../../src/components/ui/MatchStartShowcase.tsx"],"sourcesContent":["import React from \"react\";\r\nimport type { Player } from \"../../store/match\";\r\n\r\nexport default function CalibrationPopup({\r\n  players,\r\n  playerCalibrations,\r\n  calibrationSkipped,\r\n  onSkip,\r\n  onOpenCalibrator,\r\n  onClose,\r\n}: {\r\n  players: Player[];\r\n  playerCalibrations: { [k: string]: any };\r\n  calibrationSkipped: Record<string, boolean>;\r\n  onSkip: (id: string) => void;\r\n  onOpenCalibrator: (id: string) => void;\r\n  onClose: () => void;\r\n}) {\r\n  const skippedPlayers = players.filter((p) => calibrationSkipped[p.id]);\r\n  const remainingPlayers = players.filter((p) => !calibrationSkipped[p.id]);\r\n  const canStartMatch = remainingPlayers.length === 0;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/90 p-4\">\r\n      <div className=\"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full\">\r\n        <h3 className=\"text-xl font-bold mb-4 text-center\">\r\n          Calibration Check\r\n        </h3>\r\n        <p className=\"text-sm opacity-70 mb-6 text-center\">\r\n          Check your dartboard calibration before the match starts. Both players\r\n          must skip or confirm to begin.\r\n        </p>\r\n        {skippedPlayers.length > 0 && remainingPlayers.length > 0 && (\r\n          <div className=\"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg\">\r\n            <p className=\"text-sm text-blue-200\">\r\n              {skippedPlayers.map((p) => p.name).join(\", \")}{\" \"}\r\n              {skippedPlayers.length === 1 ? \"has\" : \"have\"} chosen to skip.{\" \"}\r\n              {remainingPlayers.map((p) => p.name).join(\", \")}, would you like\r\n              to skip as well?\r\n            </p>\r\n          </div>\r\n        )}\r\n        <div className=\"space-y-4\">\r\n          {players.map((player) => (\r\n            <div\r\n              key={player.id}\r\n              className=\"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg\"\r\n            >\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white\">\r\n                  {player.name\r\n                    .split(\" \")\r\n                    .map((n) => n[0])\r\n                    .join(\"\")\r\n                    .toUpperCase()\r\n                    .slice(0, 2)}\r\n                </div>\r\n                <div>\r\n                  <div className=\"font-medium\">{player.name}</div>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  className=\"btn btn-sm btn-ghost\"\r\n                  onClick={() => onOpenCalibrator(player.id)}\r\n                >\r\n                  Bull Up\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-sm btn-primary\"\r\n                  onClick={() => onSkip(player.id)}\r\n                  disabled={!!calibrationSkipped[player.id]}\r\n                >\r\n                  {calibrationSkipped[player.id] ? \"Skipped âœ“\" : \"Skip\"}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"mt-6 flex justify-center gap-4\">\r\n          <button\r\n            className={`btn ${canStartMatch ? \"btn-primary\" : \"btn-ghost opacity-50 cursor-not-allowed\"}`}\r\n            disabled={!canStartMatch}\r\n            onClick={onClose}\r\n          >\r\n            Start Match\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useMemo, useState, useRef, useLayoutEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport {\r\n  getAllTimeAvg,\r\n  getAllTimeFirstNineAvg,\r\n  getAllTimeBestCheckout,\r\n  getAllTimeBestLeg,\r\n  getAllTime,\r\n  getAllTime180s,\r\n} from \"../../store/profileStats\";\r\nimport type { Player } from \"../../store/match\";\r\nimport { useCalibration } from \"../../store/calibration\";\r\n\r\nfunction StatBlock({\r\n  label,\r\n  value,\r\n  className = \"\",\r\n  scale = 1,\r\n}: {\r\n  label: string;\r\n  value: string | number;\r\n  className?: string;\r\n  scale?: number;\r\n}) {\r\n  return (\r\n    <div className={`flex flex-col items-center gap-1 ${className}`}>\r\n      <div className=\"text-xs opacity-70\">{label}</div>\r\n      <div\r\n        className=\"text-2xl sm:text-3xl font-bold transform transition-transform duration-200 ease-out\"\r\n        style={{ transform: `scale(${scale})` }}\r\n      >\r\n        {value}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PlayerCalibrationPreview({\r\n  player,\r\n  user,\r\n  playerCalibrations,\r\n}: {\r\n  player: Player;\r\n  user?: any;\r\n  playerCalibrations: { [playerName: string]: any };\r\n}) {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const calib = playerCalibrations[player.name];\r\n  const isCalibrated = !!calib;\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) return;\r\n\r\n    // Clear canvas\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    try {\r\n      // Draw a simple dartboard circle\r\n      const centerX = canvas.width / 2;\r\n      const centerY = canvas.height / 2;\r\n      const radius = Math.min(centerX, centerY) - 2;\r\n\r\n      // Outer circle\r\n      if (typeof ctx.stroke === 'function') {\r\n        ctx.strokeStyle = \"#fff\";\r\n        ctx.lineWidth = 1;\r\n        ctx.beginPath();\r\n        ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\r\n        ctx.stroke();\r\n      }\r\n\r\n      // Bullseye\r\n      if (typeof ctx.fill === 'function') {\r\n        ctx.fillStyle = \"#f00\";\r\n        ctx.beginPath();\r\n        ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI);\r\n        ctx.fill();\r\n      }\r\n    } catch (e) {\r\n      // Canvas not supported by test environment; ignore and do nothing\r\n    }\r\n\r\n    // If calibrated, draw calibration points\r\n    if (isCalibrated) {\r\n      try {\r\n        if (typeof ctx.fill === 'function') ctx.fillStyle = \"#0f0\";\r\n      // Draw some sample points (simplified)\r\n      const points = [\r\n        [centerX - radius * 0.5, centerY],\r\n        [centerX + radius * 0.5, centerY],\r\n        [centerX, centerY - radius * 0.5],\r\n        [centerX, centerY + radius * 0.5],\r\n      ];\r\n      points.forEach(([x, y]) => {\r\n        try {\r\n          if (typeof ctx.beginPath === 'function') ctx.beginPath();\r\n          if (typeof ctx.arc === 'function') ctx.arc(x, y, 2, 0, 2 * Math.PI);\r\n          if (typeof ctx.fill === 'function') ctx.fill();\r\n        } catch {}\r\n      });\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    }\r\n  }, [isCalibrated]);\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 mt-1\">\r\n      <canvas\r\n        ref={canvasRef}\r\n        width={40}\r\n        height={40}\r\n        className=\"border border-white/20 rounded\"\r\n      />\r\n      <span\r\n        className={`text-xs ${isCalibrated ? \"text-green-400\" : \"text-gray-400\"}`}\r\n      >\r\n        {isCalibrated ? \"Calibrated\" : \"Not Calibrated\"}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction RecentForm({ player, limit = 3 }: { player: Player; limit?: number }) {\r\n  // Compute recent visit scores from player's legs, flatten last visits\r\n  const visits: { score: number; darts: number }[] = [];\r\n  try {\r\n    const legs = (player.legs || []) as any[];\r\n    for (let i = legs.length - 1; i >= 0 && visits.length < limit; i--) {\r\n      const leg = legs[i];\r\n      const legVisits = (leg.visits || []) as any[];\r\n      for (let j = legVisits.length - 1; j >= 0 && visits.length < limit; j--) {\r\n        const v = legVisits[j];\r\n        visits.push({ score: Number(v?.score || 0), darts: Number(v?.darts || 3) });\r\n      }\r\n    }\r\n  } catch (e) {}\r\n  if (!visits.length) return <div className=\"text-xs opacity-60\">No recent visits</div>;\r\n  return (\r\n    <div className=\"flex gap-2 items-center\">\r\n      {visits.map((v, idx) => (\r\n        <div key={idx} className={`text-xs px-2 py-0.5 rounded ${v.score >= 100 ? 'bg-emerald-600/20 text-emerald-300' : v.score >= 60 ? 'bg-amber-500/10 text-amber-300' : 'bg-white/6 text-gray-200'}`}>\r\n          {v.score}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nimport FocusLock from \"react-focus-lock\";\r\nimport CalibrationPopup from \"./CalibrationPopup\";\r\nfunction ProgressRing({ secondsLeft, totalSeconds, size = 84, stroke = 8, color = 'emerald' }: { secondsLeft: number; totalSeconds: number; size?: number; stroke?: number; color?: 'emerald' | 'amber' }) {\r\n  const radius = (size - stroke) / 2;\r\n  const circumference = 2 * Math.PI * radius;\r\n  const percent = Math.max(0, Math.min(1, totalSeconds > 0 ? secondsLeft / totalSeconds : 0));\r\n  const dash = circumference * (1 - percent);\r\n  const colorHex = color === 'emerald' ? '#34d399' : '#f59e0b';\r\n  return (\r\n    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} aria-hidden>\r\n      <defs>\r\n        <filter id=\"softShadow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\r\n          <feDropShadow dx=\"0\" dy=\"1\" stdDeviation=\"3\" floodColor=\"#000\" floodOpacity=\"0.45\" />\r\n        </filter>\r\n      </defs>\r\n      <circle cx={size/2} cy={size/2} r={radius} fill=\"transparent\" stroke=\"rgba(255,255,255,0.06)\" strokeWidth={stroke} />\r\n      <circle cx={size/2} cy={size/2} r={radius} fill=\"transparent\" stroke={colorHex} strokeWidth={stroke} strokeLinecap=\"round\" strokeDasharray={circumference} strokeDashoffset={dash} transform={`rotate(-90 ${size/2} ${size/2})`} style={{ filter: 'drop-shadow(0 1px 2px rgba(0,0,0,0.4))' }} />\r\n      <text x=\"50%\" y=\"50%\" fill=\"white\" fontSize={size * 0.33} fontWeight={700} dominantBaseline=\"middle\" textAnchor=\"middle\">\r\n        {secondsLeft > 0 ? secondsLeft : 'GO'}\r\n      </text>\r\n    </svg>\r\n  );\r\n}\r\nexport default function MatchStartShowcase({\r\n  open = true,\r\n  players,\r\n  user,\r\n  onDone,\r\n  onRequestClose,\r\n  initialSeconds = 15,\r\n  roomId,\r\n  onChoice,\r\n  choices = {},\r\n  bullActive = false,\r\n  onBullThrow,\r\n  showCalibrationDefault = false,\r\n  disableEscClose = false,\r\n}: {\r\n  open?: boolean;\r\n  players: Player[];\r\n  user?: any;\r\n  onDone?: () => void;\r\n  onRequestClose?: () => void;\r\n  initialSeconds?: number;\r\n  roomId?: string;\r\n  onChoice?: (choice: \"bull\" | \"skip\") => void;\r\n  choices?: Record<string, string>;\r\n  bullActive?: boolean;\r\n  onBullThrow?: (score: number) => void;\r\n  showCalibrationDefault?: boolean;\r\n  disableEscClose?: boolean;\r\n}) {\r\n  // Debug logs removed\r\n  const [seconds, setSeconds] = useState(initialSeconds || 15);\r\n  const [scaleState, setScaleState] = useState(1);\r\n  // Overlay visibility is controlled by parent; the component should be controlled using `open` and `onRequestClose`.\r\n  const visible = !!open;\r\n  const [showCalibration, setShowCalibration] = useState(false);\r\n  const [calibrationSkipped, setCalibrationSkipped] = useState<{\r\n    [playerId: string]: boolean;\r\n  }>(() => {\r\n    const map: { [k: string]: boolean } = {};\r\n    if (!showCalibrationDefault) {\r\n      for (const p of players) map[p.id] = true;\r\n    }\r\n    return map;\r\n  });\r\n  const [playerCalibrations, setPlayerCalibrations] = useState<{\r\n    [playerName: string]: any;\r\n  }>({});\r\n  const hostRef = useRef<HTMLDivElement | null>(null);\r\n  const startNowRef = useRef<HTMLButtonElement | null>(null);\r\n  const closeRef = useRef<HTMLButtonElement | null>(null);\r\n  const prevActiveElement = useRef<HTMLElement | null>(null);\r\n  // mountedRef ensures keyboard events that fire during render/mount don't prematurely close the overlay\r\n  const mountedRef = useRef(false);\r\n\r\n  useEffect(() => {\r\n    // mark mounted after first paint to ensure early key events don't trigger a close mid-render\r\n    mountedRef.current = true;\r\n    return () => {\r\n      mountedRef.current = false;\r\n    };\r\n  }, []);\r\n\r\n  // If players list widens after mount, ensure new players inherit the skip state\r\n  useEffect(() => {\r\n    if (!showCalibrationDefault) {\r\n      setCalibrationSkipped((prev) => {\r\n        const next = { ...prev };\r\n        for (const p of players) if (!next[p.id]) next[p.id] = true;\r\n        return next;\r\n      });\r\n    }\r\n  }, [players, showCalibrationDefault]);\r\n\r\n  const allPlayersSkipped = players.every((p) => calibrationSkipped[p.id]);\r\n  const canStartMatch = allPlayersSkipped;\r\n\r\n  // visibility is controlled by parent via `open` prop\r\n\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n    // useEffect(visible) entered\r\n    // Ensure initial focus is on the Start Now button for convenience\r\n    try {\r\n      setTimeout(() => {\r\n        try {\r\n          startNowRef.current?.focus();\r\n        } catch {}\r\n      }, 0);\r\n    } catch {}\r\n    // remember previous active element so we can restore on close\r\n    try {\r\n      prevActiveElement.current = document.activeElement as HTMLElement;\r\n    } catch {}\r\n    // Hide app content from screen readers while overlay is open\r\n    const appRoot = document.getElementById(\"root\");\r\n    const prevAria: string | null = appRoot\r\n      ? appRoot.getAttribute(\"aria-hidden\")\r\n      : null;\r\n    try {\r\n      if (appRoot) appRoot.setAttribute(\"aria-hidden\", \"true\");\r\n    } catch {}\r\n    const t = allPlayersSkipped\r\n      ? setInterval(() => setSeconds((s) => s - 1), 1000)\r\n      : null;\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if (!mountedRef.current) return;\r\n      if (!disableEscClose && (e.key === \"Escape\" || e.key === \"Esc\")) {\r\n        e.preventDefault();\r\n        // Ensure parent handlers are invoked asynchronously so we don't unmount during render\r\n        try {\r\n          setTimeout(() => {\r\n            try {\r\n              onRequestClose?.();\r\n            } catch {}\r\n          }, 0);\r\n        } catch {}\r\n        try {\r\n          prevActiveElement.current?.focus();\r\n        } catch {}\r\n      }\r\n    };\r\n    document.addEventListener(\"keydown\", onKey);\r\n    // Cleanup and restore aria-hidden\r\n    return () => {\r\n      // useEffect(visible) cleanup\r\n      try {\r\n        if (appRoot) {\r\n          appRoot.removeAttribute(\"aria-hidden\");\r\n        }\r\n      } catch {}\r\n      if (t) clearInterval(t);\r\n      document.removeEventListener(\"keydown\", onKey);\r\n    };\r\n  }, [visible, onDone, allPlayersSkipped]);\r\n\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n    // Show calibration popup immediately when countdown starts\r\n    if (\r\n      showCalibrationDefault &&\r\n      seconds === (initialSeconds || 15) &&\r\n      !showCalibration\r\n    ) {\r\n      setShowCalibration(true);\r\n      // Fetch calibrations for all players\r\n      const fetchCalibrations = async () => {\r\n        const calibs: { [playerName: string]: any } = {};\r\n        for (const player of players) {\r\n          if (user?.username && player.name === user.username) {\r\n            // Local user: use store\r\n            const { H, imageSize, overlaySize, locked } = useCalibration.getState();\r\n            if (H && locked) calibs[player.name] = { H, imageSize, overlaySize, locked };\r\n          } else {\r\n            // Remote user: fetch from server\r\n            try {\r\n              const res = await fetch(\r\n                `/api/users/${encodeURIComponent(player.name)}/calibration`,\r\n              );\r\n              if (res.ok) {\r\n                const data = await res.json();\r\n                if (data.calibration) calibs[player.name] = data.calibration;\r\n              }\r\n            } catch (err) {\r\n              console.warn(\"Failed to fetch calibration for\", player.name, err);\r\n            }\r\n          }\r\n        }\r\n        setPlayerCalibrations(calibs);\r\n      };\r\n      fetchCalibrations();\r\n    }\r\n    // Only start countdown when all players have skipped calibration\r\n    if (allPlayersSkipped) {\r\n      if (seconds <= 3 && seconds > 0) {\r\n        setScaleState((s) => s + 0.4);\r\n      }\r\n      if (seconds <= 0) {\r\n        // countdown reached 0, scheduling close\r\n        // Done; small delay to let the \"Game On\" message show\r\n        setTimeout(() => {\r\n          // Do not set local visible state here when controlled; delegate close to parent via onRequestClose/onDone\r\n          // calling onDone/onRequestClose\r\n          try {\r\n            onDone?.();\r\n          } catch {}\r\n          try {\r\n            setTimeout(() => {\r\n              try {\r\n                onRequestClose?.();\r\n              } catch {}\r\n            }, 0);\r\n          } catch {}\r\n          // Return focus to previous element\r\n          try {\r\n            prevActiveElement.current?.focus();\r\n          } catch {}\r\n        }, 1000);\r\n      }\r\n    }\r\n  }, [\r\n    seconds,\r\n    onDone,\r\n    visible,\r\n    showCalibration,\r\n    allPlayersSkipped,\r\n    players,\r\n    user,\r\n  ]);\r\n\r\n  const stats = useMemo(\r\n    () =>\r\n      players.map((p) => {\r\n        try {\r\n          const avg3 = getAllTimeAvg(p.name);\r\n          const best9 = getAllTimeFirstNineAvg(p.name);\r\n          const bestCheckout = getAllTimeBestCheckout(p.name);\r\n          const bestLeg = getAllTimeBestLeg(p.name);\r\n          const all = getAllTime(p.name);\r\n          const career180s = getAllTime180s(p.name);\r\n          // Count match 180s for the provided player\r\n          let match180s = 0;\r\n          try {\r\n            for (const L of p.legs || []) {\r\n              for (const v of L.visits || []) {\r\n                if (Number(v.score || 0) === 180) match180s += 1;\r\n              }\r\n            }\r\n          } catch {}\r\n          const one80s = `${match180s}/${career180s}`;\r\n          return {\r\n            id: p.id,\r\n            name: p.name,\r\n            avg3: avg3.toFixed(1),\r\n            best9: best9.toFixed(1),\r\n            bestCheckout,\r\n            bestLeg,\r\n            one80s,\r\n          };\r\n        } catch (err) {\r\n          // Swallow errors computing stats to avoid breaking render in tests\r\n          return {\r\n            id: p.id,\r\n            name: p.name,\r\n            avg3: \"â€”\",\r\n            best9: \"â€”\",\r\n            bestCheckout: \"â€”\",\r\n            bestLeg: \"â€”\",\r\n            one80s: \"â€”\",\r\n          };\r\n        }\r\n      }),\r\n    [players],\r\n  );\r\n  // Create and manage a portal container so overlays appended to body are cleaned up and avoid duplicates in tests\r\n  const portalElRef = useRef<HTMLDivElement | null>(\r\n    typeof document !== \"undefined\" ? document.createElement(\"div\") : null,\r\n  );\r\n  useLayoutEffect(() => {\r\n    if (!portalElRef.current) return;\r\n    const el = portalElRef.current;\r\n    el.className = \"ndn-match-start-portal\";\r\n    try {\r\n      const old = Array.from(\r\n        document.querySelectorAll(\".ndn-match-start-portal\"),\r\n      );\r\n      old.forEach((o) => {\r\n        try {\r\n          o.parentNode?.removeChild(o);\r\n        } catch {}\r\n      });\r\n    } catch {}\r\n    document.body.appendChild(el);\r\n    return () => {\r\n      try {\r\n        if (el && el.parentNode) el.parentNode.removeChild(el);\r\n      } catch {}\r\n    };\r\n  }, []);\r\n\r\n  if (!visible) return null;\r\n\r\n  // Render the extracted CalibrationPopup component, passing required handlers\r\n\r\n  const getScaleFor = (s: number) => {\r\n    if (s <= 0) return 1.8;\r\n    if (s === 1) return 1.6;\r\n    if (s === 2) return 1.4;\r\n    if (s === 3) return 1.2;\r\n    return 1;\r\n  };\r\n\r\n  const overlay = (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4\">\r\n      <div\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n        aria-labelledby=\"match-start-heading\"\r\n        tabIndex={-1}\r\n      >\r\n        <FocusLock returnFocus={true}>\r\n          <div ref={hostRef}>\r\n            <div className=\"bg-white/5 border border-white/10 rounded-3xl p-8 md:p-12 max-w-7xl w-full backdrop-blur-sm shadow-2xl\">\r\n              <div className=\"flex items-center justify-between mb-8\">\r\n                <div\r\n                  id=\"match-start-heading\"\r\n                  className=\"text-2xl font-bold opacity-90\"\r\n                >\r\n                  Match Starting Soon\r\n                </div>\r\n                <div className=\"flex items-center gap-4 flex-col sm:flex-row\">\r\n                  {/* show smaller ring on small screens */}\r\n                  <div className=\"flex items-center justify-center\">\r\n                    <div className=\"block sm:hidden\">\r\n                      <ProgressRing secondsLeft={seconds} totalSeconds={initialSeconds || 15} size={64} stroke={6} color={seconds > 5 ? \"emerald\" : \"amber\"} />\r\n                    </div>\r\n                    <div className=\"hidden sm:block\">\r\n                      <ProgressRing secondsLeft={seconds} totalSeconds={initialSeconds || 15} size={84} stroke={8} color={seconds > 5 ? \"emerald\" : \"amber\"} />\r\n                    </div>\r\n                  </div>\r\n                    <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center\">\r\n                    <button\r\n                      ref={startNowRef}\r\n                      className=\"btn btn-lg bg-gradient-to-r from-emerald-400 to-indigo-500 text-white shadow-lg transform hover:scale-105 w-full sm:w-auto\"\r\n                      onClick={() => {\r\n                        try {\r\n                          onDone?.();\r\n                        } catch {}\r\n                        try {\r\n                          try {\r\n                            document\r\n                              .getElementById(\"root\")\r\n                              ?.removeAttribute(\"aria-hidden\");\r\n                          } catch {}\r\n                          setTimeout(() => {\r\n                            try {\r\n                              onRequestClose?.();\r\n                            } catch {}\r\n                          }, 0);\r\n                        } catch {}\r\n                      }}\r\n                      aria-label=\"Start match now\"\r\n                    >\r\n                      Start Now\r\n                    </button>\r\n                    <button\r\n                      ref={closeRef}\r\n                      className=\"btn btn-ghost btn-sm text-white/80 w-full sm:w-auto\"\r\n                      onClick={() => {\r\n                        try {\r\n                          onDone?.();\r\n                        } catch {}\r\n                        try {\r\n                          document\r\n                            .getElementById(\"root\")\r\n                            ?.removeAttribute(\"aria-hidden\");\r\n                        } catch {}\r\n                        try {\r\n                          setTimeout(() => {\r\n                            try {\r\n                              onRequestClose?.();\r\n                            } catch {}\r\n                          }, 0);\r\n                        } catch {}\r\n                      }}\r\n                      aria-label=\"Close match start showcase\"\r\n                    >\r\n                      Close\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8\">\r\n                {stats.map((st) => (\r\n                  <div\r\n                    key={st.id}\r\n                    className=\"p-6 rounded-2xl bg-gradient-to-tr from-slate-800/70 to-slate-700/60 border border-white/6 flex flex-col items-center shadow-2xl w-full\"\r\n                  >\r\n                    <div className=\"w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-emerald-400 flex items-center justify-center text-2xl font-bold text-white mb-4 shadow-xl ring-1 ring-white/10\">\r\n                      {st.name\r\n                        .split(\" \")\r\n                        .map((n) => n[0])\r\n                        .join(\"\")\r\n                        .toUpperCase()\r\n                        .slice(0, 2)}\r\n                    </div>\r\n                    <div className=\"text-xl font-semibold mb-2 text-center\">\r\n                      {st.name}\r\n                    </div>\r\n                    <div className=\"mb-2 flex items-center gap-2\">\r\n                      {user && user.username === st.name ? (\r\n                        <div className=\"text-xs bg-emerald-600/20 text-emerald-300 px-2 py-0.5 rounded\">You</div>\r\n                      ) : null}\r\n                      <PlayerCalibrationPreview player={players.find((p) => p.id === st.id) as any} user={user} playerCalibrations={playerCalibrations} />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-4 w-full\">\r\n                      <StatBlock\r\n                        label=\"3-Dart Avg\"\r\n                        value={st.avg3}\r\n                        scale={getScaleFor(seconds)}\r\n                      />\r\n                      <StatBlock\r\n                        label=\"First-9 Avg\"\r\n                        value={st.best9}\r\n                        scale={getScaleFor(seconds)}\r\n                      />\r\n                      <StatBlock\r\n                        label=\"Best Checkout\"\r\n                        value={st.bestCheckout || \"â€”\"}\r\n                        scale={getScaleFor(seconds)}\r\n                      />\r\n                      <StatBlock\r\n                        label=\"Best Leg\"\r\n                        value={st.bestLeg || \"â€”\"}\r\n                        scale={getScaleFor(seconds)}\r\n                      />\r\n                    </div>\r\n                    <div className=\"mt-4 opacity-70 text-sm\">\r\n                      180s (match / career): {st.one80s}\r\n                    </div>\r\n                    <div className=\"mt-2 w-full flex justify-center md:justify-center\">\r\n                      <RecentForm player={players.find((p) => p.id === st.id) as Player} limit={3} />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n              <div className=\"text-center\">\r\n                {seconds <= 1 ? (\r\n                  <div className=\"text-3xl font-bold text-emerald-400\">\r\n                    Good luck â€” Game on! ðŸŽ¯\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"text-lg opacity-70\">\r\n                    {players.map((p) => p.name).join(\" vs \")}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </FocusLock>\r\n      </div>\r\n    </div>\r\n  );\r\n  return createPortal(\r\n    <>\r\n      {showCalibration && (\r\n        <CalibrationPopup\r\n          players={players}\r\n          playerCalibrations={playerCalibrations}\r\n          calibrationSkipped={calibrationSkipped}\r\n          onSkip={(id: string) =>\r\n            setCalibrationSkipped((prev) => ({ ...prev, [id]: true }))\r\n          }\r\n          onOpenCalibrator={(id: string) => {\r\n            try {\r\n              window.dispatchEvent(\r\n                new CustomEvent(\"ndn:change-tab\", {\r\n                  detail: { tab: \"calibrate\" },\r\n                }),\r\n              );\r\n            } catch {}\r\n            // Tell parent to close the overlay so the user can calibrate\r\n            try {\r\n              setTimeout(() => {\r\n                try {\r\n                  onRequestClose?.();\r\n                } catch {}\r\n              }, 0);\r\n            } catch {}\r\n          }}\r\n          onClose={() => {\r\n            setShowCalibration(false);\r\n          }}\r\n        />\r\n      )}\r\n      {overlay}\r\n    </>,\r\n    portalElRef.current as HTMLDivElement,\r\n  );\r\n}\r\n"],"names":["CalibrationPopup","players","playerCalibrations","calibrationSkipped","onSkip","onOpenCalibrator","onClose","skippedPlayers","p","remainingPlayers","canStartMatch","jsxs","jsx","player","n","StatBlock","label","value","className","scale","PlayerCalibrationPreview","user","canvasRef","useRef","isCalibrated","useEffect","canvas","ctx","centerX","centerY","radius","x","y","RecentForm","limit","visits","legs","i","legVisits","j","v","idx","ProgressRing","secondsLeft","totalSeconds","size","stroke","color","circumference","percent","dash","colorHex","MatchStartShowcase","open","onDone","onRequestClose","initialSeconds","roomId","onChoice","choices","bullActive","onBullThrow","showCalibrationDefault","disableEscClose","seconds","setSeconds","useState","scaleState","setScaleState","visible","showCalibration","setShowCalibration","setCalibrationSkipped","map","setPlayerCalibrations","hostRef","startNowRef","closeRef","prevActiveElement","mountedRef","prev","next","allPlayersSkipped","appRoot","t","s","onKey","e","calibs","H","imageSize","overlaySize","locked","useCalibration","res","data","err","stats","useMemo","avg3","getAllTimeAvg","best9","getAllTimeFirstNineAvg","bestCheckout","getAllTimeBestCheckout","bestLeg","getAllTimeBestLeg","all","getAllTime","career180s","getAllTime180s","match180s","L","one80s","portalElRef","useLayoutEffect","el","o","getScaleFor","overlay","FocusLock","st","createPortal","Fragment","id"],"mappings":"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"}
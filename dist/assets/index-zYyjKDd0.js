const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-1HNIjq6Y.js","assets/ui-HJtpxRqe.js","assets/vendor-D3F3s8fL.js","assets/stats-X3jz_E9o.js","assets/OnlinePlay.clean-Bt3pIMup.js","assets/matchWindow-_tMJLG5T.js","assets/aroundTheClock-BzZ4LFMk.js","assets/OfflinePlay-CsXnCxeq.js","assets/ScoreNumberPad-LPiXF1e9.js","assets/Scoreboard-BpclTmte.js","assets/StatsPanel-Dgq91YTp.js","assets/Friends-DqsHSfcd.js","assets/Tournaments-Cf9PfzqD.js","assets/AdminAccess-BhNSupEu.js","assets/CameraSetup-70EcP5JK.js","assets/OpsDashboard-WjjqhZ1q.js"])))=>i.map(i=>d[i]);
import{r as to,a as Zi,g as el}from"./vendor-D3F3s8fL.js";import{r as i,R as wt,S as ra,M as hn,L as od,C as oa,U as Ja,T as ks,a as id,P as ld,Z as mi,X as no,b as Ga,c as so,d as Xs,E as Ur,V as cd,e as dd,f as ud,G as md,g as Br,h as hd,i as fd,j as pd,k as gd,l as bd,A as xd,m as vd,B as hi,n as yd,H as wd}from"./ui-HJtpxRqe.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();var vr={exports:{}},Qs={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fi;function Nd(){if(fi)return Qs;fi=1;var t=to(),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(m,d,u){var h,x={},f=null,S=null;u!==void 0&&(f=""+u),d.key!==void 0&&(f=""+d.key),d.ref!==void 0&&(S=d.ref);for(h in d)a.call(d,h)&&!o.hasOwnProperty(h)&&(x[h]=d[h]);if(m&&m.defaultProps)for(h in d=m.defaultProps,d)x[h]===void 0&&(x[h]=d[h]);return{$$typeof:n,type:m,key:f,ref:S,props:x,_owner:r.current}}return Qs.Fragment=s,Qs.jsx=l,Qs.jsxs=l,Qs}var pi;function Sd(){return pi||(pi=1,vr.exports=Nd()),vr.exports}var e=Sd(),_a={},gi;function jd(){if(gi)return _a;gi=1;var t=Zi();return _a.createRoot=t.createRoot,_a.hydrateRoot=t.hydrateRoot,_a}var Cd=jd();const kd=el(Cd),Ed="modulepreload",Td=function(t){return"/"+t},bi={},Et=function(n,s,a){let r=Promise.resolve();if(s&&s.length>0){let d=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),m=l?.nonce||l?.getAttribute("nonce");r=d(s.map(u=>{if(u=Td(u),u in bi)return;bi[u]=!0;const h=u.endsWith(".css"),x=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${x}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":Ed,h||(f.as="script"),f.crossOrigin="",f.href=u,m&&f.setAttribute("nonce",m),document.head.appendChild(f),h)return new Promise((S,k)=>{f.addEventListener("load",S),f.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(l){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=l,window.dispatchEvent(m),!m.defaultPrevented)throw l}return r.then(l=>{for(const m of l||[])m.status==="rejected"&&o(m.reason);return n().catch(o)})};function Ad(t,n){if(t==null)return{};var s={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(n.indexOf(a)!==-1)continue;s[a]=t[a]}return s}function ia(){return ia=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)({}).hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},ia.apply(null,arguments)}var Vr="data-focus-lock",tl="data-focus-lock-disabled",Dd="data-no-focus-lock",Md="data-autofocus-inside",Id="data-no-autofocus";function yr(t,n){return typeof t=="function"?t(n):t&&(t.current=n),t}function Rd(t,n){var s=i.useState(function(){return{value:t,callback:n,facade:{get current(){return s.value},set current(a){var r=s.value;r!==a&&(s.value=a,s.callback(a,r))}}}})[0];return s.callback=n,s.facade}var Od=typeof window<"u"?i.useLayoutEffect:i.useEffect,xi=new WeakMap;function Ld(t,n){var s=Rd(null,function(a){return t.forEach(function(r){return yr(r,a)})});return Od(function(){var a=xi.get(s);if(a){var r=new Set(a),o=new Set(t),l=s.current;r.forEach(function(m){o.has(m)||yr(m,null)}),o.forEach(function(m){r.has(m)||yr(m,l)})}xi.set(s,t)},[t]),s}var wr={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Hr=function(){return Hr=Object.assign||function(n){for(var s,a=1,r=arguments.length;a<r;a++){s=arguments[a];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])}return n},Hr.apply(this,arguments)};function nl(t){return t}function sl(t,n){n===void 0&&(n=nl);var s=[],a=!1,r={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:t},useMedium:function(o){var l=n(o,a);return s.push(l),function(){s=s.filter(function(m){return m!==l})}},assignSyncMedium:function(o){for(a=!0;s.length;){var l=s;s=[],l.forEach(o)}s={push:function(m){return o(m)},filter:function(){return s}}},assignMedium:function(o){a=!0;var l=[];if(s.length){var m=s;s=[],m.forEach(o),l=s}var d=function(){var h=l;l=[],h.forEach(o)},u=function(){return Promise.resolve().then(d)};u(),s={push:function(h){l.push(h),u()},filter:function(h){return l=l.filter(h),s}}}};return r}function ao(t,n){return n===void 0&&(n=nl),sl(t,n)}function Pd(t){t===void 0&&(t={});var n=sl(null);return n.options=Hr({async:!0,ssr:!1},t),n}var al=ao({},function(t){var n=t.target,s=t.currentTarget;return{target:n,currentTarget:s}}),rl=ao(),_d=ao(),Fd=Pd({async:!0,ssr:typeof document<"u"}),$d=i.createContext(void 0),Ud=[],ro=i.forwardRef(function(n,s){var a,r=i.useState(),o=r[0],l=r[1],m=i.useRef(),d=i.useRef(!1),u=i.useRef(null),h=i.useState({}),x=h[1],f=n.children,S=n.disabled,k=S===void 0?!1:S,p=n.noFocusGuards,w=p===void 0?!1:p,v=n.persistentFocus,g=v===void 0?!1:v,O=n.crossFrame,E=O===void 0?!0:O,L=n.autoFocus,A=L===void 0?!0:L;n.allowTextSelection;var P=n.group,D=n.className,j=n.whiteList,R=n.hasPositiveIndices,M=n.shards,$=M===void 0?Ud:M,W=n.as,Y=W===void 0?"div":W,ne=n.lockProps,xe=ne===void 0?{}:ne,ie=n.sideCar,je=n.returnFocus,Ne=je===void 0?!1:je,he=n.focusOptions,ke=n.onActivation,ae=n.onDeactivation,ve=i.useState({}),ye=ve[0],Te=i.useCallback(function(Ce){var se=Ce.captureFocusRestore;if(!u.current){var ee,be=(ee=document)==null?void 0:ee.activeElement;u.current=be,be!==document.body&&(u.current=se(be))}m.current&&ke&&ke(m.current),d.current=!0,x()},[ke]),Ie=i.useCallback(function(){d.current=!1,ae&&ae(m.current),x()},[ae]),Ge=i.useCallback(function(Ce){var se=u.current;if(se){var ee=(typeof se=="function"?se():se)||document.body,be=typeof Ne=="function"?Ne(ee):Ne;if(be){var ht=typeof be=="object"?be:void 0;u.current=null,Ce?Promise.resolve().then(function(){return ee.focus(ht)}):ee.focus(ht)}}},[Ne]),Xe=i.useCallback(function(Ce){d.current&&al.useMedium(Ce)},[]),Qe=rl.useMedium,tt=i.useCallback(function(Ce){m.current!==Ce&&(m.current=Ce,l(Ce))},[]),dt=ia((a={},a[tl]=k&&"disabled",a[Vr]=P,a),xe),Oe=w!==!0,$e=Oe&&w!=="tail",B=Ld([s,tt]),z=i.useMemo(function(){return{observed:m,shards:$,enabled:!k,active:d.current}},[k,d.current,$,o]);return wt.createElement(i.Fragment,null,Oe&&[wt.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:k?-1:0,style:wr}),R?wt.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:k?-1:1,style:wr}):null],!k&&wt.createElement(ie,{id:ye,sideCar:Fd,observed:o,disabled:k,persistentFocus:g,crossFrame:E,autoFocus:A,whiteList:j,shards:$,onActivation:Te,onDeactivation:Ie,returnFocus:Ge,focusOptions:he,noFocusGuards:w}),wt.createElement(Y,ia({ref:B},dt,{className:D,onBlur:Qe,onFocus:Xe}),wt.createElement($d.Provider,{value:z},f)),$e&&wt.createElement("div",{"data-focus-guard":!0,tabIndex:k?-1:0,style:wr}))});ro.propTypes={};function Wr(t,n){return Wr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},Wr(t,n)}function Bd(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,Wr(t,n)}function la(t){"@babel/helpers - typeof";return la=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},la(t)}function Vd(t,n){if(la(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,n);if(la(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(t)}function Hd(t){var n=Vd(t,"string");return la(n)=="symbol"?n:n+""}function Wd(t,n,s){return(n=Hd(n))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,t}function zd(t,n){function s(a){return a.displayName||a.name||"Component"}return function(r){var o=[],l;function m(){l=t(o.map(function(u){return u.props})),n(l)}var d=(function(u){Bd(h,u);function h(){return u.apply(this,arguments)||this}h.peek=function(){return l};var x=h.prototype;return x.componentDidMount=function(){o.push(this),m()},x.componentDidUpdate=function(){m()},x.componentWillUnmount=function(){var S=o.indexOf(this);o.splice(S,1),m()},x.render=function(){return wt.createElement(r,this.props)},h})(i.PureComponent);return Wd(d,"displayName","SideEffect("+s(r)+")"),d}}var fn=function(t){for(var n=Array(t.length),s=0;s<t.length;++s)n[s]=t[s];return n},ts=function(t){return Array.isArray(t)?t:[t]},ol=function(t){return Array.isArray(t)?t[0]:t},Gd=function(t){if(t.nodeType!==Node.ELEMENT_NODE)return!1;var n=window.getComputedStyle(t,null);return!n||!n.getPropertyValue?!1:n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"},il=function(t){return t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?t.parentNode.host:t.parentNode},ll=function(t){return t===document||t&&t.nodeType===Node.DOCUMENT_NODE},qd=function(t){return t.hasAttribute("inert")},Jd=function(t,n){return!t||ll(t)||!Gd(t)&&!qd(t)&&n(il(t))},cl=function(t,n){var s=t.get(n);if(s!==void 0)return s;var a=Jd(n,cl.bind(void 0,t));return t.set(n,a),a},Yd=function(t,n){return t&&!ll(t)?Qd(t)?n(il(t)):!1:!0},dl=function(t,n){var s=t.get(n);if(s!==void 0)return s;var a=Yd(n,dl.bind(void 0,t));return t.set(n,a),a},ul=function(t){return t.dataset},Kd=function(t){return t.tagName==="BUTTON"},ml=function(t){return t.tagName==="INPUT"},hl=function(t){return ml(t)&&t.type==="radio"},Xd=function(t){return!((ml(t)||Kd(t))&&(t.type==="hidden"||t.disabled))},Qd=function(t){var n=t.getAttribute(Id);return![!0,"true",""].includes(n)},oo=function(t){var n;return!!(t&&(!((n=ul(t))===null||n===void 0)&&n.focusGuard))},zr=function(t){return!oo(t)},Zd=function(t){return!!t},eu=function(t,n){var s=Math.max(0,t.tabIndex),a=Math.max(0,n.tabIndex),r=s-a,o=t.index-n.index;if(r){if(!s)return 1;if(!a)return-1}return r||o},tu=function(t){return t.tabIndex<0&&!t.hasAttribute("tabindex")?0:t.tabIndex},io=function(t,n,s){return fn(t).map(function(a,r){var o=tu(a);return{node:a,index:r,tabIndex:s&&o===-1?(a.dataset||{}).focusGuard?0:-1:o}}).filter(function(a){return!n||a.tabIndex>=0}).sort(eu)},nu=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],lo=nu.join(","),su="".concat(lo,", [data-focus-guard]"),fl=function(t,n){return fn((t.shadowRoot||t).children).reduce(function(s,a){return s.concat(a.matches(n?su:lo)?[a]:[],fl(a))},[])},au=function(t,n){var s;return t instanceof HTMLIFrameElement&&(!((s=t.contentDocument)===null||s===void 0)&&s.body)?Ms([t.contentDocument.body],n):[t]},Ms=function(t,n){return t.reduce(function(s,a){var r,o=fl(a,n),l=(r=[]).concat.apply(r,o.map(function(m){return au(m,n)}));return s.concat(l,a.parentNode?fn(a.parentNode.querySelectorAll(lo)).filter(function(m){return m===a}):[])},[])},ru=function(t){var n=t.querySelectorAll("[".concat(Md,"]"));return fn(n).map(function(s){return Ms([s])}).reduce(function(s,a){return s.concat(a)},[])},co=function(t,n){return fn(t).filter(function(s){return cl(n,s)}).filter(function(s){return Xd(s)})},vi=function(t,n){return n===void 0&&(n=new Map),fn(t).filter(function(s){return dl(n,s)})},uo=function(t,n,s){return io(co(Ms(t,s),n),!0,s)},ca=function(t,n){return io(co(Ms(t),n),!1)},ou=function(t,n){return co(ru(t),n)},es=function(t,n){return t.shadowRoot?es(t.shadowRoot,n):Object.getPrototypeOf(t).contains!==void 0&&Object.getPrototypeOf(t).contains.call(t,n)?!0:fn(t.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var r=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return r?es(r,n):!1}return es(s,n)})},iu=function(t){for(var n=new Set,s=t.length,a=0;a<s;a+=1)for(var r=a+1;r<s;r+=1){var o=t[a].compareDocumentPosition(t[r]);(o&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&n.add(r),(o&Node.DOCUMENT_POSITION_CONTAINS)>0&&n.add(a)}return t.filter(function(l,m){return!n.has(m)})},pl=function(t){return t.parentNode?pl(t.parentNode):t},mo=function(t){var n=ts(t);return n.filter(Boolean).reduce(function(s,a){var r=a.getAttribute(Vr);return s.push.apply(s,r?iu(fn(pl(a).querySelectorAll("[".concat(Vr,'="').concat(r,'"]:not([').concat(tl,'="disabled"])')))):[a]),s},[])},lu=function(t){try{return t()}catch{return}},da=function(t){if(t===void 0&&(t=document),!(!t||!t.activeElement)){var n=t.activeElement;return n.shadowRoot?da(n.shadowRoot):n instanceof HTMLIFrameElement&&lu(function(){return n.contentWindow.document})?da(n.contentWindow.document):n}},cu=function(t,n){return t===n},du=function(t,n){return!!fn(t.querySelectorAll("iframe")).some(function(s){return cu(s,n)})},gl=function(t,n){return n===void 0&&(n=da(ol(t).ownerDocument)),!n||n.dataset&&n.dataset.focusGuard?!1:mo(t).some(function(s){return es(s,n)||du(s,n)})},uu=function(t){t===void 0&&(t=document);var n=da(t);return n?fn(t.querySelectorAll("[".concat(Dd,"]"))).some(function(s){return es(s,n)}):!1},mu=function(t,n){return n.filter(hl).filter(function(s){return s.name===t.name}).filter(function(s){return s.checked})[0]||t},ho=function(t,n){return hl(t)&&t.name?mu(t,n):t},hu=function(t){var n=new Set;return t.forEach(function(s){return n.add(ho(s,t))}),t.filter(function(s){return n.has(s)})},yi=function(t){return t[0]&&t.length>1?ho(t[0],t):t[0]},wi=function(t,n){return t.indexOf(ho(n,t))},Gr="NEW_FOCUS",fu=function(t,n,s,a,r){var o=t.length,l=t[0],m=t[o-1],d=oo(a);if(!(a&&t.indexOf(a)>=0)){var u=a!==void 0?s.indexOf(a):-1,h=r?s.indexOf(r):u,x=r?t.indexOf(r):-1;if(u===-1)return x!==-1?x:Gr;if(x===-1)return Gr;var f=u-h,S=s.indexOf(l),k=s.indexOf(m),p=hu(s),w=a!==void 0?p.indexOf(a):-1,v=r?p.indexOf(r):w,g=p.filter(function(D){return D.tabIndex>=0}),O=a!==void 0?g.indexOf(a):-1,E=r?g.indexOf(r):O,L=O>=0&&E>=0?E-O:v-w;if(!f&&x>=0||n.length===0)return x;var A=wi(t,n[0]),P=wi(t,n[n.length-1]);if(u<=S&&d&&Math.abs(f)>1)return P;if(u>=k&&d&&Math.abs(f)>1)return A;if(f&&Math.abs(L)>1)return x;if(u<=S)return P;if(u>k)return A;if(f)return Math.abs(f)>1?x:(o+x+f)%o}},pu=function(t){return function(n){var s,a=(s=ul(n))===null||s===void 0?void 0:s.autofocus;return n.autofocus||a!==void 0&&a!=="false"||t.indexOf(n)>=0}},Ni=function(t,n,s){var a=t.map(function(o){var l=o.node;return l}),r=vi(a.filter(pu(s)));return r&&r.length?yi(r):yi(vi(n))},qr=function(t,n){return n===void 0&&(n=[]),n.push(t),t.parentNode&&qr(t.parentNode.host||t.parentNode,n),n},Nr=function(t,n){for(var s=qr(t),a=qr(n),r=0;r<s.length;r+=1){var o=s[r];if(a.indexOf(o)>=0)return o}return!1},bl=function(t,n,s){var a=ts(t),r=ts(n),o=a[0],l=!1;return r.filter(Boolean).forEach(function(m){l=Nr(l||m,m)||l,s.filter(Boolean).forEach(function(d){var u=Nr(o,d);u&&(!l||es(u,l)?l=u:l=Nr(u,l))})}),l},Si=function(t,n){return t.reduce(function(s,a){return s.concat(ou(a,n))},[])},gu=function(t,n){var s=new Map;return n.forEach(function(a){return s.set(a.node,a)}),t.map(function(a){return s.get(a)}).filter(Zd)},bu=function(t,n){var s=da(ts(t).length>0?document:ol(t).ownerDocument),a=mo(t).filter(zr),r=bl(s||t,t,a),o=new Map,l=ca(a,o),m=l.filter(function(k){var p=k.node;return zr(p)});if(m[0]){var d=ca([r],o).map(function(k){var p=k.node;return p}),u=gu(d,m),h=u.map(function(k){var p=k.node;return p}),x=u.filter(function(k){var p=k.tabIndex;return p>=0}).map(function(k){var p=k.node;return p}),f=fu(h,x,d,s,n);if(f===Gr){var S=Ni(l,x,Si(a,o))||Ni(l,h,Si(a,o));if(S)return{node:S};console.warn("focus-lock: cannot find any node to move focus into");return}return f===void 0?f:u[f]}},xu=function(t){var n=mo(t).filter(zr),s=bl(t,t,n),a=io(Ms([s],!0),!0,!0),r=Ms(n,!1);return a.map(function(o){var l=o.node,m=o.index;return{node:l,index:m,lockItem:r.indexOf(l)>=0,guard:oo(l)}})},fo=function(t,n){t&&("focus"in t&&t.focus(n),"contentWindow"in t&&t.contentWindow&&t.contentWindow.focus())},Sr=0,jr=!1,xl=function(t,n,s){s===void 0&&(s={});var a=bu(t,n);if(!jr&&a){if(Sr>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),jr=!0,setTimeout(function(){jr=!1},1);return}Sr++,fo(a.node,s.focusOptions),Sr--}};function Zs(t){if(!t)return null;if(typeof WeakRef>"u")return function(){return t||null};var n=t?new WeakRef(t):null;return function(){return n?.deref()||null}}var vu=function(t){if(!t)return null;for(var n=[],s=t;s&&s!==document.body;)n.push({current:Zs(s),parent:Zs(s.parentElement),left:Zs(s.previousElementSibling),right:Zs(s.nextElementSibling)}),s=s.parentElement;return{element:Zs(t),stack:n,ownerDocument:t.ownerDocument}},yu=function(t){var n,s,a,r,o;if(t)for(var l=t.stack,m=t.ownerDocument,d=new Map,u=0,h=l;u<h.length;u++){var x=h[u],f=(n=x.parent)===null||n===void 0?void 0:n.call(x);if(f&&m.contains(f)){for(var S=(s=x.left)===null||s===void 0?void 0:s.call(x),k=x.current(),p=f.contains(k)?k:void 0,w=(a=x.right)===null||a===void 0?void 0:a.call(x),v=uo([f],d),g=(o=(r=p??S?.nextElementSibling)!==null&&r!==void 0?r:w)!==null&&o!==void 0?o:S;g;){for(var O=0,E=v;O<E.length;O++){var L=E[O];if(g?.contains(L.node))return L.node}g=g.nextElementSibling}if(v.length)return v[0].node}}},vl=function(t){var n=vu(t);return function(){return yu(n)}},wu=function(t,n,s){if(!t||!n)return console.error("no element or scope given"),{};var a=ts(n);if(a.every(function(l){return!es(l,t)}))return console.error("Active element is not contained in the scope"),{};var r=s?uo(a,new Map):ca(a,new Map),o=r.findIndex(function(l){var m=l.node;return m===t});if(o!==-1)return{prev:r[o-1],next:r[o+1],first:r[0],last:r[r.length-1]}},Nu=function(t,n){var s=n?uo(ts(t),new Map):ca(ts(t),new Map);return{first:s[0],last:s[s.length-1]}},Su=function(t){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},t)},yl=function(t,n,s){n===void 0&&(n={});var a=Su(n),r=wu(t,a.scope,a.onlyTabbable);if(r){var o=s(r,a.cycle);o&&fo(o.node,a.focusOptions)}},ju=function(t,n){n===void 0&&(n={}),yl(t,n,function(s,a){var r=s.next,o=s.first;return r||a&&o})},Cu=function(t,n){n===void 0&&(n={}),yl(t,n,function(s,a){var r=s.prev,o=s.last;return r||a&&o})},wl=function(t,n,s){var a,r=Nu(t,(a=n.onlyTabbable)!==null&&a!==void 0?a:!0),o=r[s];o&&fo(o.node,n.focusOptions)},ku=function(t,n){n===void 0&&(n={}),wl(t,n,"first")},Eu=function(t,n){n===void 0&&(n={}),wl(t,n,"last")};function po(t){setTimeout(t,1)}var Tu=function(n){return n&&"current"in n?n.current:n},Nl=function(){return document&&document.activeElement===document.body},Au=function(){return Nl()||uu()},Es=null,Lt=null,ji=function(){return null},Ts=null,ua=!1,go=!1,Du=function(){return!0},Mu=function(n){return(Es.whiteList||Du)(n)},Iu=function(n,s){Ts={observerNode:n,portaledElement:s}},Ru=function(n){return Ts&&Ts.portaledElement===n};function Ci(t,n,s,a){var r=null,o=t;do{var l=a[o];if(l.guard)l.node.dataset.focusAutoGuard&&(r=l);else if(l.lockItem){if(o!==t)return;r=null}else break}while((o+=s)!==n);r&&(r.node.tabIndex=0)}var Ou=function(n){return n?!!ua:ua==="meanwhile"},Lu=function t(n,s,a){return s&&(s.host===n&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&t(n,s.parentNode,a))},Pu=function(n,s){return s.some(function(a){return Lu(n,a,a)})},Sl=function(n){return ca(n,new Map)},_u=function(n){return!Sl([n.parentNode]).some(function(s){return s.node===n})},Ya=function(){var n=!1;if(Es){var s=Es,a=s.observed,r=s.persistentFocus,o=s.autoFocus,l=s.shards,m=s.crossFrame,d=s.focusOptions,u=s.noFocusGuards,h=a||Ts&&Ts.portaledElement;if(Nl()&&Lt&&Lt!==document.body&&(!document.body.contains(Lt)||_u(Lt))){var x=ji();x&&x.focus()}var f=document&&document.activeElement;if(h){var S=[h].concat(l.map(Tu).filter(Boolean)),k=function(){if(!Ou(m)||!u||!Lt||go)return!1;var O=Sl(S),E=O.findIndex(function(L){var A=L.node;return A===Lt});return E===0||E===O.length-1};if((!f||Mu(f))&&(r||k()||!Au()||!Lt&&o)&&(h&&!(gl(S)||f&&Pu(f,S)||Ru(f))&&(document&&!Lt&&f&&!o?(f.blur&&f.blur(),document.body.focus()):(n=xl(S,Lt,{focusOptions:d}),Ts={})),Lt=document&&document.activeElement,Lt!==document.body&&(ji=vl(Lt)),ua=!1),document&&f!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var p=document&&document.activeElement,w=xu(S),v=w.map(function(g){var O=g.node;return O}).indexOf(p);v>-1&&(w.filter(function(g){var O=g.guard,E=g.node;return O&&E.dataset.focusAutoGuard}).forEach(function(g){var O=g.node;return O.removeAttribute("tabIndex")}),Ci(v,w.length,1,w),Ci(v,-1,-1,w))}}}return n},jl=function(n){Ya()&&n&&(n.stopPropagation(),n.preventDefault())},bo=function(){return po(Ya)},Fu=function(n){var s=n.target,a=n.currentTarget;a.contains(s)||Iu(a,s)},$u=function(){return null},Cl=function(){go=!0},kl=function(){go=!1,ua="just",po(function(){ua="meanwhile"})},Uu=function(){document.addEventListener("focusin",jl),document.addEventListener("focusout",bo),window.addEventListener("focus",Cl),window.addEventListener("blur",kl)},Bu=function(){document.removeEventListener("focusin",jl),document.removeEventListener("focusout",bo),window.removeEventListener("focus",Cl),window.removeEventListener("blur",kl)};function Vu(t){return t.filter(function(n){var s=n.disabled;return!s})}var El={moveFocusInside:xl,focusInside:gl,focusNextElement:ju,focusPrevElement:Cu,focusFirstElement:ku,focusLastElement:Eu,captureFocusRestore:vl};function Hu(t){var n=t.slice(-1)[0];n&&!Es&&Uu();var s=Es,a=s&&n&&n.id===s.id;Es=n,s&&!a&&(s.onDeactivation(),t.filter(function(r){var o=r.id;return o===s.id}).length||s.returnFocus(!n)),n?(Lt=null,(!a||s.observed!==n.observed)&&n.onActivation(El),Ya(),po(Ya)):(Bu(),Lt=null)}al.assignSyncMedium(Fu);rl.assignMedium(bo);_d.assignMedium(function(t){return t(El)});const Wu=zd(Vu,Hu)($u);var Fn=i.forwardRef(function(n,s){return wt.createElement(ro,ia({sideCar:Wu,ref:s},n))}),Tl=ro.propTypes||{};Tl.sideCar;Ad(Tl,["sideCar"]);Fn.propTypes={};var Jr=Zi();const zu=t=>`ndn_online_quota_${t}`;function Cr(t=new Date){const n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),s=n.getUTCDay()||7;n.setUTCDate(n.getUTCDate()+4-s);const a=new Date(Date.UTC(n.getUTCFullYear(),0,1)),r=Math.ceil(((n.getTime()-a.getTime())/864e5+1)/7),o=String(r).padStart(2,"0");return`${n.getUTCFullYear()}-${o}`}function Gu(t){try{const n=localStorage.getItem(zu(t));if(!n)return{week:Cr(),used:0};const s=JSON.parse(n),a=Cr();return!s.week||s.week!==a?{week:a,used:0}:{week:String(s.week),used:Number(s.used)||0}}catch{return{week:Cr(),used:0}}}function qu(t,n=3){const s=Gu(t);return Math.max(0,n-(s.used||0))}const Al={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8787",VITE_WS_URL:"ws://localhost:8787"},Ka="ndn:isAdmin:v1";function xo(){try{const t=localStorage.getItem(Ka);return t?JSON.parse(t):{}}catch{return{}}}function Ju(t,n){try{const s=xo();s[(t||"").toLowerCase()]={v:n,ts:Date.now()},localStorage.setItem(Ka,JSON.stringify(s))}catch{}}function Yu(t){try{if(t){const n=xo();delete n[(t||"").toLowerCase()],localStorage.setItem(Ka,JSON.stringify(n))}else localStorage.removeItem(Ka)}catch{}}async function Ku(t){const n=String(t||"").toLowerCase();if(!n)return!1;try{const r=String(Al?.VITE_OWNER_EMAIL||"").toLowerCase();if(r&&n===r)return!0}catch{}if(n==="daviesfamily108@gmail.com")return!0;try{const r=localStorage.getItem("ndn:forceAdmin");if(r==="1"||r==="true")return!0}catch{}const a=xo()[n];if(a&&Date.now()-a.ts<60*1e3)return!!a.v;try{const l=!!(await(await fetch(`/api/admins/check?email=${encodeURIComponent(n)}`)).json().catch(()=>({})))?.isAdmin;return Ju(n,l),l}catch{return!!a?.v}}function vo(t){const n=String(t||"").toLowerCase(),[s,a]=i.useState(!1);return i.useEffect(()=>{let r=!0;if(!n){a(!1);return}try{const m=String(Al?.VITE_OWNER_EMAIL||"").toLowerCase(),d=(()=>{try{const u=localStorage.getItem("ndn:forceAdmin");return u==="1"||u==="true"}catch{return!1}})();if(m&&n===m){a(!0);return}if(d){a(!0);return}}catch{}if(n==="daviesfamily108@gmail.com"){a(!0);return}const o=()=>{Ku(n).then(m=>{r&&a(!!m)})};o();const l=setInterval(o,60*1e3);return()=>{r=!1,clearInterval(l)}},[n]),s}const Xu={},Qu=5,Zu={GBP:1,EUR:1.16,USD:1.26,AUD:1.92,NZD:2.08,CAD:1.73};function sp(t,n=Qu){const s=(t||"GBP").toUpperCase(),a=Zu[s]??1,r=n*a;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s}).format(r)}catch{return`${s} ${r.toFixed(2)}`}}function ap(){try{const t=new Intl.NumberFormat().resolvedOptions(),n=String(t.locale).toLowerCase();return n.includes("-gb")?"GBP":n.includes("-ie")||n.includes("-de")||n.includes("-fr")||n.includes("-es")||n.includes("-it")||n.includes("-nl")?"EUR":n.includes("-us")?"USD":n.includes("-au")?"AUD":n.includes("-nz")?"NZD":n.includes("-ca")?"CAD":"GBP"}catch{return"GBP"}}const em=Xu?.VITE_DISCORD_INVITE_URL||"https://discord.gg/nCfT4hJz",tm={};let Kt=null;const nm=tm?.VITE_REMOTE_API_FALLBACK||"",kr=(nm.trim()||"https://ninedartnation-1.onrender.com").replace(/\/$/,""),sm=new Set(["localhost","127.0.0.1"]);function Dl(){if(Kt)return Kt;const t="http://localhost:8787".trim();if(t){const n=t.replace(/\/$/,"");return typeof window<"u"&&/https?:\/\/(localhost|127\.0\.0\.1)(:\\d+)?/i.test(n)&&!sm.has(window.location.hostname)?(Kt=kr,Kt):(Kt=n,Kt)}if(typeof window<"u"){const{protocol:n,host:s,hostname:a}=window.location,r=`${n}//${s}`;return a.endsWith("onrender.com")||a==="localhost"||a==="127.0.0.1"?Kt=r.replace(/\/$/,""):Kt=kr,Kt}return Kt=kr,Kt}function am(t){if(/^https?:\/\//i.test(t))return t;const n=Dl(),s=t.startsWith("/")?t:`/${t}`;return`${n}${s}`}function As(t){return am(t)}function Ml(){return Dl()}function De(t,n){const s=As(t),a={...n};try{const o=typeof localStorage<"u"?localStorage.getItem("authToken"):null;if(o){const l=a.headers;!l?.Authorization&&!l?.authorization&&(a.headers={...l,Authorization:`Bearer ${o}`})}}catch{}const r=typeof t=="string"&&(/^\/api\/admin\b/i.test(t)||/^\/api\/auth\b/i.test(t));try{const o=window;if(o.__ndnApiDisabled&&!r){const l=Number(o.__ndnApiDisabledAt)||0;if(l&&Date.now()-l>6e4)o.__ndnApiDisabled=!1,o.__ndnApiDisabledAt=0;else return Promise.resolve({ok:!1,status:503,json:async()=>({})})}}catch{}return fetch(s,a).catch(o=>{if(!r)try{window.__ndnApiDisabled=!0,window.__ndnApiDisabledAt=Date.now()}catch{}return{ok:!1,status:503,json:async()=>({})}}).then(o=>{if(!r)try{const l=new URL(String(s)).hostname;o&&o.status===404&&l!==window.location.hostname&&(window.__ndnApiDisabled=!0,window.__ndnApiDisabledAt=Date.now())}catch{}if(r&&o&&o.ok)try{window.__ndnApiDisabled=!1,window.__ndnApiDisabledAt=0}catch{}return o})}function rm(){if(typeof window>"u"||typeof window.fetch!="function")return;const t=window;if(t.__ndnApiPatched)return;const n=window.fetch.bind(window);window.fetch=(s,a)=>{try{if(typeof s=="string")return s.startsWith("/")?n(As(s),a):n(s,a);if(s instanceof Request){const r=s.url.startsWith("/")?As(s.url):s.url;if(r===s.url)return n(s,a);const o=new Request(r,s);return n(o,a)}if(s instanceof URL){const r=s.href.startsWith("/")?As(s.href):s.href;return n(r,a)}}catch(r){console.warn("[API] Interceptor failed, falling back to original fetch",r)}return n(s,a)},t.__ndnApiPatched=!0}const om={},ki=t=>{let n;const s=new Set,a=(h,x)=>{const f=typeof h=="function"?h(n):h;if(!Object.is(f,n)){const S=n;n=x??(typeof f!="object"||f===null)?f:Object.assign({},n,f),s.forEach(k=>k(n,S))}},r=()=>n,d={setState:a,getState:r,getInitialState:()=>u,subscribe:h=>(s.add(h),()=>s.delete(h)),destroy:()=>{(om?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},u=n=t(a,r,d);return d},im=t=>t?ki(t):ki;var Er={exports:{}},Tr={},Ar={exports:{}},Dr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ei;function lm(){if(Ei)return Dr;Ei=1;var t=to();function n(x,f){return x===f&&(x!==0||1/x===1/f)||x!==x&&f!==f}var s=typeof Object.is=="function"?Object.is:n,a=t.useState,r=t.useEffect,o=t.useLayoutEffect,l=t.useDebugValue;function m(x,f){var S=f(),k=a({inst:{value:S,getSnapshot:f}}),p=k[0].inst,w=k[1];return o(function(){p.value=S,p.getSnapshot=f,d(p)&&w({inst:p})},[x,S,f]),r(function(){return d(p)&&w({inst:p}),x(function(){d(p)&&w({inst:p})})},[x]),l(S),S}function d(x){var f=x.getSnapshot;x=x.value;try{var S=f();return!s(x,S)}catch{return!0}}function u(x,f){return f()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:m;return Dr.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:h,Dr}var Ti;function cm(){return Ti||(Ti=1,Ar.exports=lm()),Ar.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ai;function dm(){if(Ai)return Tr;Ai=1;var t=to(),n=cm();function s(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var a=typeof Object.is=="function"?Object.is:s,r=n.useSyncExternalStore,o=t.useRef,l=t.useEffect,m=t.useMemo,d=t.useDebugValue;return Tr.useSyncExternalStoreWithSelector=function(u,h,x,f,S){var k=o(null);if(k.current===null){var p={hasValue:!1,value:null};k.current=p}else p=k.current;k=m(function(){function v(A){if(!g){if(g=!0,O=A,A=f(A),S!==void 0&&p.hasValue){var P=p.value;if(S(P,A))return E=P}return E=A}if(P=E,a(O,A))return P;var D=f(A);return S!==void 0&&S(P,D)?(O=A,P):(O=A,E=D)}var g=!1,O,E,L=x===void 0?null:x;return[function(){return v(h())},L===null?void 0:function(){return v(L())}]},[h,x,f,S]);var w=r(u,k[0],k[1]);return l(function(){p.hasValue=!0,p.value=w},[w]),d(w),w},Tr}var Di;function um(){return Di||(Di=1,Er.exports=dm()),Er.exports}var mm=um();const hm=el(mm),Il={},{useDebugValue:fm}=wt,{useSyncExternalStoreWithSelector:pm}=hm;let Mi=!1;const gm=t=>t;function bm(t,n=gm,s){(Il?"production":void 0)!=="production"&&s&&!Mi&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Mi=!0);const a=pm(t.subscribe,t.getState,t.getServerState||t.getInitialState,n,s);return fm(a),a}const Ii=t=>{(Il?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof t=="function"?im(t):t,s=(a,r)=>bm(n,a,r);return Object.assign(s,n),s},Bn=t=>t?Ii(t):Ii;function me(...t){}function Xa(...t){}const Cs="ndn_user_settings";function Yr(){try{const t=localStorage.getItem(Cs);if(!t)return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,callerStyle:"professional",speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",cameraRecordDarts:!0,cameraShowLabels:!1,cameraLowLatency:!1,cameraProcessingFps:15,calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preserveCalibrationOverlay:!0,preserveCalibrationOnCameraChange:!0,cameraEnabled:!0,hideCameraOverlay:!1,offlineLayout:"modern",hideInGameSidebar:!0,hiddenSections:[],autoscoreProvider:"built-in",autoscoreWsUrl:"",autoCommitMode:"immediate",confirmUncertainDarts:!1,autoScoreConfidenceThreshold:.82,autoscoreDetectorMinArea:30,autoscoreDetectorThresh:15,autoscoreDetectorRequireStableN:2,harshLightingMode:!1,enhanceBigTrebles:!1,allowAutocommitInOnline:!1,textSize:"medium",boxSize:"medium",statsCardMinHeight:220,cardPaddingBottom:810,matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1};const n=JSON.parse(t),s=Number(n?.__version||0);if(s<2){const a={...n,autoCommitMode:"immediate",confirmUncertainDarts:!1,cameraRecordDarts:!0,autoScoreConfidenceThreshold:.82,__version:2};try{localStorage.setItem(Cs,JSON.stringify(a))}catch{}}if(s<3){const a={...n,cardPaddingBottom:900,__version:3};try{localStorage.setItem(Cs,JSON.stringify(a))}catch{}}if(s<4){const a={...n,cardPaddingBottom:900,__version:4};try{localStorage.setItem(Cs,JSON.stringify(a))}catch{}}if(s<5){const a={...n,cardPaddingBottom:810,__version:5};try{localStorage.setItem(Cs,JSON.stringify(a))}catch{}}return{favoriteDouble:n.favoriteDouble||"D16",callerEnabled:typeof n.callerEnabled=="boolean"?n.callerEnabled:!0,callerVoice:n.callerVoice||"",callerVolume:typeof n.callerVolume=="number"?Math.max(0,Math.min(1,n.callerVolume)):1,callerStyle:n.callerStyle==="energetic"||n.callerStyle==="classic"?n.callerStyle:"professional",speakCheckoutOnly:!!n.speakCheckoutOnly,avgMode:n.avgMode==="24h"?"24h":"all-time",autoStartOffline:!!n.autoStartOffline,rememberLastOffline:typeof n.rememberLastOffline=="boolean"?n.rememberLastOffline:!0,lastOffline:n.lastOffline&&typeof n.lastOffline=="object"?{mode:n.lastOffline.mode||"X01",x01Start:Number(n.lastOffline.x01Start)||501,firstTo:Number(n.lastOffline.firstTo)||1,aiLevel:n.lastOffline.aiLevel||"None"}:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!!n.reducedMotion,compactHeader:!!n.compactHeader,allowSpectate:typeof n.allowSpectate=="boolean"?n.allowSpectate:!0,cameraScale:typeof n.cameraScale=="number"&&isFinite(n.cameraScale)?Math.max(.5,Math.min(1.25,n.cameraScale)):1,cameraAspect:n.cameraAspect==="square"?"square":"wide",cameraFitMode:n.cameraFitMode==="fit"||n.cameraFitMode==="fill"?n.cameraFitMode:"fit",calibrationUseRansac:typeof n.calibrationUseRansac=="boolean"?n.calibrationUseRansac:!0,autoscoreProvider:(()=>{let a=n.autoscoreProvider;return a!=="external-ws"&&a!=="manual"&&a!=="built-in"&&a!=="built-in-v2"&&(a="built-in"),a})(),autoscoreWsUrl:typeof n.autoscoreWsUrl=="string"?n.autoscoreWsUrl:"",autoCommitMode:n.autoCommitMode==="immediate"?"immediate":"wait-for-clear",confirmUncertainDarts:typeof n.confirmUncertainDarts=="boolean"?n.confirmUncertainDarts:!1,autoScoreConfidenceThreshold:typeof n.autoScoreConfidenceThreshold=="number"&&isFinite(n.autoScoreConfidenceThreshold)?Math.max(.5,Math.min(.99,n.autoScoreConfidenceThreshold)):.82,autoscoreDetectorMinArea:typeof n.autoscoreDetectorMinArea=="number"&&isFinite(n.autoscoreDetectorMinArea)?Math.max(5,Math.min(500,Math.round(n.autoscoreDetectorMinArea))):30,autoscoreDetectorThresh:typeof n.autoscoreDetectorThresh=="number"&&isFinite(n.autoscoreDetectorThresh)?Math.max(5,Math.min(60,Math.round(n.autoscoreDetectorThresh))):15,autoscoreDetectorRequireStableN:typeof n.autoscoreDetectorRequireStableN=="number"&&isFinite(n.autoscoreDetectorRequireStableN)?Math.max(1,Math.min(10,Math.round(n.autoscoreDetectorRequireStableN))):2,harshLightingMode:typeof n.harshLightingMode=="boolean"?n.harshLightingMode:!1,enhanceBigTrebles:typeof n.enhanceBigTrebles=="boolean"?n.enhanceBigTrebles:!1,allowAutocommitInOnline:!!n.allowAutocommitInOnline,calibrationGuide:typeof n.calibrationGuide=="boolean"?n.calibrationGuide:!0,preferredCameraId:typeof n.preferredCameraId=="string"?n.preferredCameraId:void 0,preserveCalibrationOverlay:typeof n.preserveCalibrationOverlay=="boolean"?n.preserveCalibrationOverlay:!0,preserveCalibrationOnCameraChange:typeof n.preserveCalibrationOnCameraChange=="boolean"?n.preserveCalibrationOnCameraChange:!0,preferredCameraLabel:typeof n.preferredCameraLabel=="string"?n.preferredCameraLabel:void 0,preferredCameraLocked:typeof n.preferredCameraLocked=="boolean"?n.preferredCameraLocked:!1,cameraEnabled:typeof n.cameraEnabled=="boolean"?n.cameraEnabled:!0,hideCameraOverlay:typeof n.hideCameraOverlay=="boolean"?n.hideCameraOverlay:!1,offlineLayout:n.offlineLayout==="classic"?"classic":"modern",hideInGameSidebar:typeof n.hideInGameSidebar=="boolean"?n.hideInGameSidebar:!0,hiddenSections:Array.isArray(n.hiddenSections)?n.hiddenSections.filter(a=>typeof a=="string"):[],textSize:n.textSize==="small"||n.textSize==="large"?n.textSize:"medium",boxSize:n.boxSize==="small"||n.boxSize==="large"?n.boxSize:"medium",statsCardMinHeight:typeof n.statsCardMinHeight=="number"&&isFinite(n.statsCardMinHeight)?Math.max(160,Math.min(520,Math.round(n.statsCardMinHeight))):220,cardPaddingBottom:typeof n.cardPaddingBottom=="number"&&isFinite(n.cardPaddingBottom)?Math.max(0,Math.min(1200,Math.round(n.cardPaddingBottom))):810,matchType:n.matchType==="doubles"?"doubles":"singles",teamAName:typeof n.teamAName=="string"?n.teamAName:"Team A",teamBName:typeof n.teamBName=="string"?n.teamBName:"Team B",dartTimerEnabled:typeof n.dartTimerEnabled=="boolean"?n.dartTimerEnabled:!1,dartTimerSeconds:typeof n.dartTimerSeconds=="number"&&isFinite(n.dartTimerSeconds)?Math.max(3,Math.min(60,n.dartTimerSeconds)):10,x01DoubleIn:typeof n.x01DoubleIn=="boolean"?n.x01DoubleIn:!1,cameraRecordDarts:typeof n.cameraRecordDarts=="boolean"?n.cameraRecordDarts:!0,cameraShowLabels:typeof n.cameraShowLabels=="boolean"?n.cameraShowLabels:!1}}catch{return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,callerStyle:"professional",speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",calibrationGuide:!0,calibrationUseRansac:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preferredCameraLocked:!1,preserveCalibrationOverlay:!0,preserveCalibrationOnCameraChange:!0,cameraEnabled:!0,hideCameraOverlay:!1,offlineLayout:"modern",hideInGameSidebar:!0,hiddenSections:[],autoscoreProvider:"built-in",autoscoreWsUrl:"",autoCommitMode:"immediate",confirmUncertainDarts:!1,autoScoreConfidenceThreshold:.82,harshLightingMode:!1,enhanceBigTrebles:!1,textSize:"medium",boxSize:"medium",statsCardMinHeight:220,cardPaddingBottom:810,matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1}}}function ue(t){try{const n=Yr();localStorage.setItem(Cs,JSON.stringify({...n,...t}))}catch{}}const J=Bn((t,n)=>({...Yr(),setFavoriteDouble:s=>{ue({favoriteDouble:s}),t({favoriteDouble:s})},setCallerEnabled:s=>{ue({callerEnabled:s}),t({callerEnabled:s})},setCallerVoice:s=>{ue({callerVoice:s}),t({callerVoice:s})},setCallerStyle:s=>{const a=s==="energetic"||s==="classic"?s:"professional";ue({callerStyle:a}),t({callerStyle:a})},setAvgMode:s=>{ue({avgMode:s}),t({avgMode:s})},setCallerVolume:s=>{const a=Math.max(0,Math.min(1,s));ue({callerVolume:a}),t({callerVolume:a})},setSpeakCheckoutOnly:s=>{ue({speakCheckoutOnly:s}),t({speakCheckoutOnly:s})},setAutoStartOffline:s=>{ue({autoStartOffline:s}),t({autoStartOffline:s})},setRememberLastOffline:s=>{ue({rememberLastOffline:s}),t({rememberLastOffline:s})},setLastOffline:s=>{const r={...Yr().lastOffline,...s};ue({lastOffline:r}),t({lastOffline:r})},setReducedMotion:s=>{ue({reducedMotion:s}),t({reducedMotion:s})},setCompactHeader:s=>{ue({compactHeader:s}),t({compactHeader:s})},setAllowSpectate:s=>{ue({allowSpectate:s}),t({allowSpectate:s})},ignorePreferredCameraSync:!1,setIgnorePreferredCameraSync:s=>{ue({}),t({ignorePreferredCameraSync:s})},setCameraScale:s=>{const a=Math.max(.5,Math.min(2,s));ue({cameraScale:a}),t({cameraScale:a})},setCameraAspect:s=>{const a=s==="square"?"square":"wide";ue({cameraAspect:a}),t({cameraAspect:a})},setCameraFitMode:s=>{const a=s==="fit"?"fit":"fill";ue({cameraFitMode:a}),t({cameraFitMode:a})},setAutoscoreProvider:s=>{const a=s;ue({autoscoreProvider:a}),t({autoscoreProvider:a})},setAutoscoreWsUrl:s=>{ue({autoscoreWsUrl:s}),t({autoscoreWsUrl:s})},setAutoCommitMode:s=>{const a=s==="immediate"?"immediate":"wait-for-clear";ue({autoCommitMode:a}),t({autoCommitMode:a})},setConfirmUncertainDarts:s=>{const a=!!s;ue({confirmUncertainDarts:a}),t({confirmUncertainDarts:a})},setAutoScoreConfidenceThreshold:s=>{const a=typeof s=="number"&&isFinite(s)?Math.max(.5,Math.min(.99,s)):.85;ue({autoScoreConfidenceThreshold:a}),t({autoScoreConfidenceThreshold:a})},setAutoscoreDetectorMinArea:s=>{const a=typeof s=="number"&&isFinite(s)?Math.max(5,Math.min(500,Math.round(s))):30;ue({autoscoreDetectorMinArea:a}),t({autoscoreDetectorMinArea:a})},setAutoscoreDetectorThresh:s=>{const a=typeof s=="number"&&isFinite(s)?Math.max(5,Math.min(60,Math.round(s))):15;ue({autoscoreDetectorThresh:a}),t({autoscoreDetectorThresh:a})},setAutoscoreDetectorRequireStableN:s=>{const a=typeof s=="number"&&isFinite(s)?Math.max(1,Math.min(10,Math.round(s))):2;ue({autoscoreDetectorRequireStableN:a}),t({autoscoreDetectorRequireStableN:a})},setHarshLightingMode:s=>{const a=!!s;ue({harshLightingMode:a}),t({harshLightingMode:a})},setEnhanceBigTrebles:s=>{const a=!!s;ue({enhanceBigTrebles:a}),t({enhanceBigTrebles:a})},setAllowAutocommitInOnline:s=>{ue({allowAutocommitInOnline:s}),t({allowAutocommitInOnline:s})},setCalibrationGuide:s=>{ue({calibrationGuide:s}),t({calibrationGuide:s})},setCalibrationUseRansac:s=>{ue({calibrationUseRansac:s}),t({calibrationUseRansac:s})},setPreserveCalibrationOverlay:s=>{ue({preserveCalibrationOverlay:s}),t({preserveCalibrationOverlay:s})},setPreserveCalibrationOnCameraChange:s=>{ue({preserveCalibrationOnCameraChange:s}),t({preserveCalibrationOnCameraChange:!!s})},setPreferredCamera:(s,a,r=!1)=>{try{if(n().preferredCameraLocked&&!r){console.log("[USERSETTINGS] Camera selection locked and force=false, ignoring update");return}}catch{}try{const o=n();if(o.preferredCameraId===s&&o.preferredCameraLabel===a)return}catch{}ue({preferredCameraId:s,preferredCameraLabel:a}),t({preferredCameraId:s,preferredCameraLabel:a})},setPreferredCameraLocked:s=>{try{if(n().ignorePreferredCameraSync&&s===!0){console.debug("[USERSETTINGS] Ignoring auto-lock due to ignorePreferredCameraSync");return}}catch{}ue({preferredCameraLocked:s}),t({preferredCameraLocked:s})},setCameraEnabled:s=>{ue({cameraEnabled:s}),t({cameraEnabled:s})},setHideCameraOverlay:s=>{ue({hideCameraOverlay:s}),t({hideCameraOverlay:s})},setCameraShowLabels:s=>{ue({cameraShowLabels:s}),t({cameraShowLabels:!!s})},setCameraRecordDarts:s=>{const a=!!s;ue({cameraRecordDarts:a}),t({cameraRecordDarts:a})},setCameraLowLatency:s=>{const a=!!s;ue({cameraLowLatency:a}),t({cameraLowLatency:a})},setCameraProcessingFps:s=>{const a=Math.max(5,Math.min(30,Math.round(s)));ue({cameraProcessingFps:a}),t({cameraProcessingFps:a})},setOfflineLayout:s=>{ue({offlineLayout:s}),t({offlineLayout:s})},setHideInGameSidebar:s=>{ue({hideInGameSidebar:s}),t({hideInGameSidebar:s})},setHiddenSections:s=>{const a=Array.isArray(s)?s.filter(r=>typeof r=="string"):[];ue({hiddenSections:a}),t({hiddenSections:a})},setTextSize:s=>{ue({textSize:s}),t({textSize:s})},setBoxSize:s=>{ue({boxSize:s}),t({boxSize:s})},setStatsCardMinHeight:s=>{const a=Math.max(160,Math.min(520,Math.round(s)));ue({statsCardMinHeight:a}),t({statsCardMinHeight:a})},setCardPaddingBottom:s=>{const a=Math.max(0,Math.min(1200,Math.round(s)));ue({cardPaddingBottom:a}),t({cardPaddingBottom:a})},setMatchType:s=>{const a=s==="doubles"?"doubles":"singles";ue({matchType:a}),t({matchType:a})},setTeamAName:s=>{const a=s?.trim()||"Team A";ue({teamAName:a}),t({teamAName:a})},setTeamBName:s=>{const a=s?.trim()||"Team B";ue({teamBName:a}),t({teamBName:a})},setDartTimerEnabled:s=>{ue({dartTimerEnabled:s}),t({dartTimerEnabled:s})},setDartTimerSeconds:s=>{const a=Math.max(3,Math.min(60,Math.round(s)));ue({dartTimerSeconds:a}),t({dartTimerSeconds:a})},setX01DoubleIn:s=>{ue({x01DoubleIn:s}),t({x01DoubleIn:s})}}));function xm(t){const n=[{key:"score",label:"Home ðŸ ",icon:od},{key:"camera",label:"Camera ðŸŽ¥",icon:oa},{key:"online",label:"Online Play ðŸŒ",icon:Ja},{key:"offline",label:"Offline ðŸ†",icon:ks},{key:"tournaments",label:"Tournaments ðŸŸï¸",icon:ks},{key:"friends",label:"Friends ðŸ‘¥",icon:Ja},{key:"stats",label:"Stats ðŸ“Š",icon:ks},{key:"settings",label:"Settings âš™ï¸",icon:ra}];function s(a){if(!a)return!1;const r=a.subscription;if(!r)return!!a.fullAccess;if(r.fullAccess){if(r.expiresAt){const o=typeof r.expiresAt=="string"?Date.parse(r.expiresAt):Number(r.expiresAt);if(!isNaN(o))return o>Date.now()}return r.status?r.status==="active":!0}return!1}return s(t)||n.push({key:"fullaccess",label:"PREMIUM Â£â‚¬$ âœ¨",icon:ld}),n}function vm(t){let n=t;if(!t?.subscription&&t?.email)try{const s=localStorage?.getItem;if(typeof s=="function"){const a=s.call(localStorage,`ndn:subscription:${t.email}`);if(a){const r=JSON.parse(a);n={...t,subscription:r,fullAccess:r.fullAccess||t.fullAccess}}}}catch{}return n}function Rl(t,n){const s=[...xm(t)];if(n&&!s.some(a=>a.key==="admin")){const a={key:"admin",label:"Admin ðŸ›¡ï¸",icon:ra},r=s.findIndex(o=>o.key==="settings");r>=0?s.splice(r,0,a):s.push(a)}return s}function Ri({active:t,onChange:n,user:s,className:a}){const r=wt.useRef(null),o=wt.useRef(!1),l=wt.useRef(0),m=wt.useRef(0),d=$=>{o.current=!0,r.current&&(l.current=$.pageY-r.current.offsetTop,m.current=r.current.scrollTop,r.current.style.cursor="grabbing")},u=()=>{o.current=!1,r.current&&(r.current.style.cursor="grab")},h=()=>{o.current=!1,r.current&&(r.current.style.cursor="grab")},x=$=>{if(!o.current||!r.current)return;$.preventDefault();const Y=($.pageY-r.current.offsetTop-l.current)*2;r.current.scrollTop=m.current-Y},f=vo(s?.email),S=vm(s),k=J($=>$.hiddenSections||[]),p=wt.useMemo(()=>new Set(k),[k]),w=Rl(S,f).filter($=>!p.has(`tab:${$.key}`)),[v,g]=i.useState(!1),[O,E]=i.useState(!1),L=s?.username&&!s?.fullAccess?qu(s.username):1/0,[A,P]=i.useState({friendRequests:0,messages:0,tournaments:0});i.useEffect(()=>{if(!s?.email)return;let $=!0;const W={count:0};let Y=null;const ne=async()=>{try{if(!$||window.__ndnApiDisabled||Y&&Date.now()<Y)return;const[je,Ne]=await Promise.all([De(`/api/friends/requests?email=${encodeURIComponent(s.email)}`),De(`/api/friends/messages?email=${encodeURIComponent(s.email)}`)]),he=je&&je.ok?await je.json():{requests:[]},ae=(Ne&&Ne.ok?await Ne.json():{messages:[]}).messages?.filter(ve=>!ve.read).length||0;P({friendRequests:he.requests?.length||0,messages:ae,tournaments:0}),W.count=0,Y=null}catch(ie){console.error("Failed to fetch notifications:",ie),W.count+=1,W.count>=3&&(Y=Date.now()+300*1e3,console.warn("Sidebar notifications polling paused for 5m due to repeated failures"))}};ne();const xe=setInterval(ne,3e4);return()=>{$=!1,clearInterval(xe)}},[s?.email]),i.useEffect(()=>{if(!v)return;const $=W=>{(W.key==="Escape"||W.key==="Enter")&&g(!1)};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[v]);const D=w.filter($=>["score","online","offline","tournaments"].includes($.key)),j=w.filter($=>["friends"].includes($.key)),R=w.filter($=>["camera","stats","settings","admin","fullaccess"].includes($.key)),M=$=>{const{key:W,label:Y,icon:ne}=$,xe=t===W;let ie=0;return W==="friends"&&(ie=A.friendRequests),W==="score"&&(ie=A.messages+A.tournaments),e.jsxs("button",{className:`tab whitespace-nowrap flex items-center justify-between gap-3 ${xe?"tab--active":"tab--inactive"} ${W==="fullaccess"?"tab--premium":""}`,onClick:()=>n(W),title:Y,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:`w-5 h-5 ${xe?"text-white":"text-slate-400"}`}),e.jsx("span",{className:`font-semibold text-[1rem] ${xe?"text-white":"text-slate-300"}`,children:Y})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[W==="online"&&!s?.fullAccess&&L<=0&&e.jsx(id,{className:"w-3 h-3 text-rose-500"}),ie>0&&e.jsx("span",{className:"notification-badge animate-pulse",children:ie>9?"9+":ie})]})]},W)};return e.jsxs("aside",{ref:r,onMouseDown:d,onMouseLeave:u,onMouseUp:h,onMouseMove:x,className:`${s?.fullAccess?"premium-sidebar":""} sidebar glass ${a?"":"w-72"} p-5 rounded-2xl ${a??"hidden sm:flex"} flex-col gap-8 overflow-y-auto overflow-x-hidden ${a?"":"fixed top-4 bottom-4 left-4"}`,children:[e.jsx("div",{className:"px-2 mb-2",children:e.jsxs("h1",{className:"text-2xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400 tracking-tight",children:["NINE DART",e.jsx("br",{}),"NATION"]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider px-3 mb-2",children:"Play"}),D.map(M)]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider px-3 mb-2",children:"Social"}),j.map(M)]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider px-3 mb-2",children:"System"}),R.map($=>{const W=M($);return $.key==="settings"?e.jsxs(wt.Fragment,{children:[W,e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2]/10 hover:bg-[#5865F2]/20 text-[#5865F2] transition-colors ml-4 border-l-2 border-[#5865F2]/30",onClick:()=>g(!0),title:"BullseyeDartsLeague",children:[e.jsx(hn,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate text-sm font-semibold",children:"Bullseye Darts League"})]}),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2]/10 hover:bg-[#5865F2]/20 text-[#5865F2] transition-colors ml-4 border-l-2 border-[#5865F2]/30",onClick:()=>E(!0),title:"NineDartNation",children:[e.jsx(hn,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate text-sm font-semibold",children:"NDN Community"})]})]},$.key):W})]}),v&&Jr.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:()=>g(!1),onTouchStart:()=>g(!1),"aria-label":"Close Discord dialog"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsx(Fn,{returnFocus:!0,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>g(!1),children:"âœ•"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(hn,{className:"w-6 h-6"})," Bullseye Darts League ðŸŽ¯"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join this fantastic Online Darts League with divisions and other cool stuff included"}),e.jsx("a",{href:em,target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord ðŸ’¬"})]})})})]}),document.body),O&&Jr.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:()=>E(!1),onTouchStart:()=>E(!1),"aria-label":"Close NineDartNation dialog"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsx(Fn,{returnFocus:!0,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>E(!1),children:"âœ•"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(hn,{className:"w-6 h-6"})," NineDartNation ðŸŽ¯"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join the NineDartNation ðŸŽ¯ Discord community"}),e.jsx("a",{href:"https://discord.gg/Q33J5FTVve",target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord ðŸ’¬"})]})})})]}),document.body)]})}function pn(t){return wt.lazy(()=>t().catch(n=>t().catch(()=>{const s="ndn_chunk_reload";throw sessionStorage.getItem(s)||(sessionStorage.setItem(s,"1"),window.location.reload()),n})))}function mn({children:t,className:n,style:s}){const a=i.useRef(null),[r,o]=i.useState(0);return i.useEffect(()=>{let l=0,m=0;const d=()=>{const x=document.getElementById("ndn-header");if(!x){m!==0&&(m=0,o(0));return}const f=document.getElementById("ndn-main-scroll"),S=f?f.scrollTop:window.scrollY||0,k=x.getBoundingClientRect().height,p=S>0?k:0;Math.abs(p-m)>1&&(m=p,o(p))};d();const u=()=>{l&&cancelAnimationFrame(l),l=requestAnimationFrame(d)},h=document.getElementById("ndn-main-scroll");return h?.addEventListener("scroll",u,{passive:!0}),window.addEventListener("scroll",u,{passive:!0}),window.addEventListener("resize",u,{passive:!0}),()=>{h?.removeEventListener("scroll",u),window.removeEventListener("scroll",u),window.removeEventListener("resize",u),l&&cancelAnimationFrame(l)}},[]),e.jsxs("div",{ref:a,className:n,style:{...s,position:"relative",willChange:"transform",transform:"translateZ(0)"},children:[r>0&&e.jsx("div",{style:{position:"absolute",left:0,right:0,top:0,height:r,pointerEvents:"none",zIndex:20,background:"linear-gradient(to bottom, rgba(17,24,39,1), rgba(17,24,39,0))",willChange:"height",transform:"translateZ(0)"}}),t]})}let ym=1;const Kr=Bn(t=>({toasts:[],push:(n,s)=>t(a=>{const r=ym++,o={id:r,message:n,type:s?.type||"info",timeout:s?.timeout??3e3,actionLabel:s?.actionLabel,onAction:s?.onAction};return o.timeout&&o.timeout>0&&setTimeout(()=>{t(l=>({toasts:l.toasts.filter(m=>m.id!==r)}))},o.timeout),{toasts:[...a.toasts,o]}}),remove:n=>t(s=>({toasts:s.toasts.filter(a=>a.id!==n)})),clear:()=>t({toasts:[]})}));function yo(){return Kr(n=>n.push)}function wm(){const t=Kr(s=>s.toasts),n=Kr(s=>s.remove);return t.length?e.jsxs(e.Fragment,{children:[t.filter(s=>s.type==="success").map(s=>e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50",children:e.jsx("div",{className:"p-4 rounded-lg shadow-lg border text-sm bg-emerald-700/90 border-emerald-500/60 text-white max-w-sm text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("span",{className:"flex-1 font-semibold",children:s.message})})})},s.id)),t.filter(s=>s.type!=="success").length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 sm:right-4 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 w-[calc(100%-1.5rem)] sm:w-auto max-w-sm",children:t.filter(s=>s.type!=="success").map(s=>e.jsx("div",{className:`p-3 rounded-lg shadow-lg border text-sm ${s.type==="error"?"bg-rose-700/80 border-rose-500/60 text-white":"bg-black/70 border-slate-700 text-slate-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex-1",children:s.message}),s.actionLabel&&typeof s.onAction=="function"?e.jsx("button",{className:"btn px-2 py-1 text-xs bg-slate-200/10 hover:bg-slate-200/20",onClick:()=>{try{s.onAction?.()}catch{}n(s.id)},children:s.actionLabel}):null,e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>n(s.id),children:"Dismiss"})]})},s.id))})]}):null}function Nm({data:t,height:n=220,barWidth:s=28,gap:a=6,showValues:r=!1}){const o=Math.max(1,...t.map(d=>d.value)),l=s+a+8,m=t.length*l;return e.jsx("div",{className:"w-full overflow-x-auto",style:{height:n+20,WebkitOverflowScrolling:"touch"},children:e.jsx("div",{className:"h-full flex items-end justify-evenly",style:{minWidth:m},children:t.map((d,u)=>{const h=Math.round(d.value/o*(n-54));return e.jsxs("div",{className:"flex flex-col items-center justify-end",style:{flex:"1 1 0%",minWidth:0},children:[r&&d.value>0&&e.jsx("div",{className:"text-[9px] sm:text-xs mb-0.5 text-indigo-200 font-semibold",children:d.value}),e.jsx("div",{className:"rounded-t-md bg-gradient-to-b from-indigo-400 to-fuchsia-500 shadow-sm w-full max-w-[28px] sm:max-w-[32px]",style:{height:h,minWidth:8},title:`${d.label}: ${d.value}`}),e.jsx("div",{className:"text-[7px] sm:text-[10px] leading-tight mt-1 text-slate-200 font-medium select-none text-center",style:{maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:d.label})]},u)})})})}function Sm({tabs:t,active:n,onChange:s,className:a}){return e.jsxs("div",{className:`relative ${a||""}`,children:[e.jsx("div",{className:"absolute inset-0 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 pointer-events-none"}),e.jsx("div",{className:"relative overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx("div",{className:"flex items-center gap-2 min-w-max",children:t.map(r=>{const o=r.key===n;return e.jsx("button",{type:"button",onPointerDown:l=>{l.stopPropagation()},onMouseDown:l=>{l.stopPropagation()},onTouchStart:l=>{l.stopPropagation?.()},onClick:()=>s(r.key),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98]
                  ${o?"bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white shadow-indigo-500/30":"bg-white/10 text-slate-100 hover:bg-white/15"}
                `,"aria-pressed":o,children:r.label.includes("ðŸŽ¯")?r.label:`${r.label} ðŸŽ¯`},r.key)})})}),e.jsx("style",{children:`
        /* Hide scrollbars on WebKit/Firefox for a cleaner pill row */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})}const qa="ndn:match-sync",Ol="ndn-match-sync";function Ht(t){try{const n=typeof window<"u"&&window.BroadcastChannel?window.BroadcastChannel:null;let s=!1;if(n&&typeof n=="function"&&(s=!0),s){const a=n;try{const r=new a(Ol);try{r.postMessage(t)}finally{try{r.close()}catch{}}return}catch{}}}catch{try{localStorage.setItem(`${qa}:lastmsg`,JSON.stringify({msg:t,ts:Date.now()}));try{const n=new StorageEvent("storage",{key:`${qa}:lastmsg`,newValue:localStorage.getItem(`${qa}:lastmsg`)});window.dispatchEvent(n)}catch{try{window.dispatchEvent(new Event("storage"))}catch{}}try{window.dispatchEvent(new CustomEvent("ndn:match-sync",{detail:{msg:t}}))}catch{}}catch{}}}function jm(t){let n=null;try{const s=typeof window<"u"&&window.BroadcastChannel?window.BroadcastChannel:null;let a=!1;if(s&&typeof s=="function"&&(a=!0),a)try{const r=s;n=new r(Ol)}catch{throw new Error("no-bc")}else throw new Error("no-bc");n&&(n.onmessage=r=>{try{t(r.data)}catch{}})}catch{const s=()=>{try{const r=localStorage.getItem(`${qa}:lastmsg`);if(!r)return;const o=JSON.parse(r);t(o.msg)}catch{}},a=r=>{try{if(!r?.detail)return;t(r.detail.msg)}catch{}};return window.addEventListener("storage",s),window.addEventListener("ndn:match-sync",a),()=>{window.removeEventListener("storage",s),window.removeEventListener("ndn:match-sync",a)}}return()=>{try{n&&n.close()}catch{}}}const wo=t=>`ndn_stats_${t}`,No=t=>`ndn_stats_ts_${t}`,So=t=>`ndn_stats_daily_${t}`,Ll=t=>`ndn_stats_meta_${t}`,Pl=t=>`ndn_stats_dist_${t}`,Mr=new Map,Ir=new Set;function ns(t){const n=(t||"").trim();if(!n||n.toLowerCase()==="you")try{const s=localStorage.getItem("ndn:currentUser");if(s)return s.toLowerCase();const a=window?.ndnCurrentUser;if(typeof a=="string"&&a.length)return a.toLowerCase()}catch{}return n.toLowerCase()}function _l(){try{const t=localStorage.getItem(headToHeadKey),n=t?JSON.parse(t):{};return n&&typeof n=="object"?n:{}}catch{return{}}}function Cm(t){try{localStorage.setItem(headToHeadKey,JSON.stringify(t))}catch{}}function km(t){if(!Array.isArray(t)||t.length!==2)return;const[n,s]=t,a=ns(n?.name||""),r=ns(s?.name||"");if(!a||!r||a===r)return;const o=Math.max(0,Number(n?.legsWon||0)),l=Math.max(0,Number(s?.legsWon||0));if(o===0&&l===0)return;const m=[a,r].sort(),d=`${m[0]}|${m[1]}`,u=m[0]===a,h=_l(),x=h[d]||{a:m[0],b:m[1],legsA:0,legsB:0,updatedAt:0};u?(x.legsA+=o,x.legsB+=l):(x.legsA+=l,x.legsB+=o),x.updatedAt=Date.now(),h[d]=x,Cm(h)}function Fl(t,n){const s=ns(t||""),a=ns(n||"");if(!s||!a||s===a)return{played:!1,legsA:0,legsB:0,diffA:0,diffB:0};const r=[s,a].sort(),o=`${r[0]}|${r[1]}`,l=_l()[o];if(!l)return{played:!1,legsA:0,legsB:0,diffA:0,diffB:0};const m=r[0]===s,d=m?l.legsA:l.legsB,u=m?l.legsB:l.legsA;return{played:Math.max(0,d+u)>0,legsA:d,legsB:u,diffA:d-u,diffB:u-d}}function $l(){try{return localStorage.getItem("authToken")}catch{return null}}function Ul(t){try{const n=localStorage.getItem(Ll(t));if(!n)return{updatedAt:0};const s=JSON.parse(n||"{}");return{updatedAt:Number(s.updatedAt)||0}}catch{return{updatedAt:0}}}function ss(t,n){try{localStorage.setItem(Ll(t),JSON.stringify(n))}catch{}}function Em(t){return{updatedAt:Ul(t).updatedAt||Date.now(),allTime:Qt(t),series:Jl(t),daily:Xl(t),gameModes:er()}}async function Bl(t){const n=$l();if(!(!n||!t)&&!Ir.has(t)){Ir.add(t);try{const s=Em(t),a=As("/api/user/stats");await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({stats:s})})}catch{}Ir.delete(t)}}function Is(t){if(!t)return;const n=Mr.get(t);n&&window.clearTimeout(n);const s=window.setTimeout(()=>{Mr.delete(t),Bl(t)},2500);Mr.set(t,s)}async function sa(t){const n=$l();if(!n||!t)return;const s=3;let a=null;for(let r=0;r<s;r++){try{const o=As("/api/user/stats");if(a=await fetch(o,{headers:{Authorization:`Bearer ${n}`}}),a?.ok)break;a=null}catch{a=null}r<s-1&&await new Promise(o=>setTimeout(o,1e3*Math.pow(2,r)))}if(!(!a||!a.ok))try{const o=(await a.json().catch(()=>({})))?.stats;if(!o||!o.updatedAt){const m=Qt(t);m&&(m.darts>0||m.scored>0)&&(ss(t,{updatedAt:Date.now()}),Bl(t));return}const l=Ul(t);o.updatedAt>(l.updatedAt||0)?(jo(t,o.allTime||{darts:0,scored:0},{skipSync:!0}),ql(t,o.series||[],{skipSync:!0}),o.daily&&Ql(t,o.daily,{skipSync:!0}),o.gameModes&&ko(o.gameModes,{skipSync:!0}),ss(t,{updatedAt:o.updatedAt})):l.updatedAt>o.updatedAt&&Is(t)}catch{}}function Qt(t){try{const n=localStorage.getItem(wo(t));if(!n)return{darts:0,scored:0};const s=JSON.parse(n);return{darts:Number(s.darts)||0,scored:Number(s.scored)||0,fnDarts:Number(s.fnDarts)||0,fnScored:Number(s.fnScored)||0,best3:typeof s.best3=="number"?s.best3:0,worst3:typeof s.worst3=="number"?s.worst3:0,bestLegDarts:typeof s.bestLegDarts=="number"?s.bestLegDarts:0,bestCheckout:typeof s.bestCheckout=="number"?s.bestCheckout:0,worstLegDarts:typeof s.worstLegDarts=="number"?s.worstLegDarts:0,bestFNAvg:typeof s.bestFNAvg=="number"?s.bestFNAvg:0,worstFNAvg:typeof s.worstFNAvg=="number"?s.worstFNAvg:0,num180s:typeof s.num180s=="number"?s.num180s:0}}catch{return{darts:0,scored:0}}}function jo(t,n,s){try{localStorage.setItem(wo(t),JSON.stringify(n)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t,totals:n}}));try{Ht({type:"statsUpdated",name:t,totals:n})}catch{}}catch{}s?.skipSync||(ss(t,{updatedAt:Date.now()}),Is(t))}function Tm(t){try{localStorage.removeItem(wo(t)),localStorage.removeItem(No(t)),localStorage.removeItem(So(t))}catch{}try{window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t,cleared:!0}}))}catch{}}function Co(t){const{darts:n,scored:s}=Qt(t);return n?s/n*3:0}function Vl(t){const{fnDarts:n=0,fnScored:s=0}=Qt(t);return n?s/n*3:0}function Am(t){const{best3:n=0,worst3:s=0}=Qt(t);return{best3:n,worst3:s}}function Hl(t){const{bestLegDarts:n=0}=Qt(t);return n||0}function Wl(t){const{bestCheckout:n=0}=Qt(t);return n||0}function zl(t){const{num180s:n=0}=Qt(t);return Number(n||0)}const Gl="ndn_game_mode_stats";function er(t){let n={};try{const s=localStorage.getItem(Gl);s&&(n=JSON.parse(s))}catch{}if(Array.isArray(t))for(const s of t)n[s]||(n[s]={played:0,won:0});return n}function ko(t,n){try{localStorage.setItem(Gl,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{gameModes:!0}}))}catch{}if(!n?.skipSync){const s=localStorage.getItem("ndn:currentUser")||"";s&&(ss(s,{updatedAt:Date.now()}),Is(s))}}function Dm(t,n){const s=er(),a=s[t]||{played:0,won:0};a.played+=1,n&&(a.won+=1),s[t]=a,ko(s)}function Rs(t){try{const n=localStorage.getItem(No(t));if(!n)return[];const s=JSON.parse(n);return Array.isArray(s)?s.map(a=>({t:Number(a.t)||0,darts:Number(a.darts)||0,scored:Number(a.scored)||0,fnDarts:Number(a.fnDarts)||0,fnScored:Number(a.fnScored)||0})).filter(a=>a.t>0):[]}catch{return[]}}function ql(t,n,s){try{localStorage.setItem(No(t),JSON.stringify(n)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t}}))}catch{}s?.skipSync||(ss(t,{updatedAt:Date.now()}),Is(t))}function Jl(t){return Rs(t)}function Mm(t,n){const s=Date.now();return t.filter(a=>s-a.t<=n)}function Zn(t,n,s,a=Date.now(),r,o){if(n<=0)return;const l=Rs(t),m=Mm([...l,{t:a,darts:n,scored:s,fnDarts:r,fnScored:o}],1e3*60*60*24*30);ql(t,m)}function Yl(t,n=1e3*60*60*24){const s=Rs(t);if(!s.length)return 0;const a=Date.now();let r=0,o=0;for(const l of s)a-l.t<=n&&(r+=l.darts,o+=l.scored);return r<=0?0:o/r*3}function Kl(t,n=1e3*60*60*24*30){const s=Rs(t);if(!s.length)return 0;const a=Date.now();let r=0,o=0;for(const l of s)a-l.t<=n&&(r+=l.fnDarts||0,o+=l.fnScored||0);return r<=0?0:o/r*3}function Xl(t){try{const n=localStorage.getItem(So(t));if(!n)return null;const s=JSON.parse(n);return{avg:Number(s.avg)||0,ts:Number(s.ts)||0}}catch{return null}}function Ql(t,n,s){try{localStorage.setItem(So(t),JSON.stringify(n)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t}}))}catch{}s?.skipSync||(ss(t,{updatedAt:Date.now()}),Is(t))}function Im(t){const n=Xl(t),s=Date.now(),a=1e3*60*60*24;if(n&&s-n.ts<a)return n.avg;const r=Yl(t,a);return Ql(t,{avg:r,ts:s}),r}function Zl(t){const s=Rs(t);if(!s.length)return 0;const a=Date.now(),r=s.filter(u=>a-u.t<=2592e6),o=r.filter(u=>typeof u.fnDarts=="number"),l=o.length?o:r;let m=0,d=0;for(const u of l)m+=u.darts,d+=u.scored;return m<=0?0:d/m*3}function Rm(t){return Kl(t,2592e6)}function Om(t,n){const s=n?.recordSeries!==!1;let a=null;try{const r=localStorage.getItem("ndn:currentUser");r?a=r:typeof window?.ndnCurrentUser=="string"&&(a=window.ndnCurrentUser)}catch{}for(const r of t){const o={...r};if(a){const E=(o.name||"").trim();(!E||E.toLowerCase()==="you")&&(o.name=a)}let l=0,m=0,d=0,u=0,h=Number.POSITIVE_INFINITY,x=0,f=0,S=0,k=0,p=0,w=0,v=0,g=0,O=0;for(const E of o.legs){if(!E.finished)continue;l+=E.dartsThrown,m+=Math.max(0,E.totalScoreStart-E.totalScoreRemaining);const{d:L,s:A}=Lm(E);d+=L,u+=A;const P=Math.max(0,E.dartsThrown),D=Math.max(0,E.totalScoreStart-E.totalScoreRemaining),j=P>0?D/P*3:0,R=L>0?A/L*3:0;if(j>0&&(f=Math.max(f,j),S=S===0?j:Math.min(S,j)),R>0&&(v=Math.max(v,R),g=g===0?R:Math.min(g,R)),E.totalScoreRemaining===0){(k===0||P<k)&&(k=P),(w===0||P>w)&&(w=P);const Y=typeof E.checkoutScore=="number"?E.checkoutScore:0;Y>p&&(p=Y)}const $=Number(E.startTime||0),W=Number(E.endTime||0)||$||Date.now();$>0&&(h=Math.min(h,$)),W>0&&(x=Math.max(x,W));try{for(const Y of E.visits||[])Number(Y.score||0)===180&&(O+=1)}catch{}}if(l>0){const E=Qt(o.name),L={darts:E.darts+l,scored:E.scored+m,fnDarts:(E.fnDarts||0)+d,fnScored:(E.fnScored||0)+u,best3:Math.max(E.best3||0,f||0),worst3:(()=>{const A=E.worst3||0;return A===0?S||0:S===0?A:Math.min(A,S)})(),bestLegDarts:(()=>{const A=E.bestLegDarts||0;return A===0?k||0:k===0?A:Math.min(A,k)})(),bestCheckout:Math.max(E.bestCheckout||0,p||0),worstLegDarts:(()=>{const A=E.worstLegDarts||0;return A===0?w||0:w===0?A:Math.max(A,w)})(),bestFNAvg:Math.max(E.bestFNAvg||0,v||0),worstFNAvg:(()=>{const A=E.worstFNAvg||0;return A===0?g||0:g===0?A:Math.min(A,g)})(),num180s:(E.num180s||0)+(O||0)};if(jo(o.name,L),s){const A=Rs(o.name),P=Number.isFinite(h)?h:Date.now(),D=x>0?x:P,j=5e3;A.some(M=>M.t>=P-j&&M.t<=D+j)||Zn(o.name,l,m,D,d,u)}}}}function Lm(t){let n=Math.min(9,t.dartsThrown);if(n<=0)return{d:0,s:0};let s=0;for(const r of t.visits){if(n<=0)break;const o=Math.min(n,r.darts);o===r.darts?s+=r.score:s+=Math.round(r.score/r.darts*o),n-=o}return{d:Math.min(9,t.dartsThrown),s}}const _n=[{min:0,max:25,label:"0-25"},{min:26,max:40,label:"26-40"},{min:41,max:45,label:"41-45"},{min:46,max:55,label:"46-55"},{min:56,max:60,label:"56-60"},{min:61,max:80,label:"61-80"},{min:81,max:99,label:"81-99"},{min:100,max:119,label:"100-119"},{min:120,max:139,label:"120-139"},{min:140,max:159,label:"140-159"},{min:160,max:179,label:"160-179"},{min:180,max:180,label:"180"}];function ec(t){try{const n=localStorage.getItem(Pl(ns(t)));if(!n)return _n.map(()=>0);const s=JSON.parse(n);return Array.isArray(s)?_n.map((r,o)=>Math.max(0,Number(s[o])||0)):_n.map(()=>0)}catch{return _n.map(()=>0)}}function tc(t,n,s){try{localStorage.setItem(Pl(ns(t)),JSON.stringify(n)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t,dist:!0}}))}catch{}if(!s?.skipSync){const a=ns(t);ss(a,{updatedAt:Date.now()}),Is(a)}}function Pm(t){const n=Math.max(0,Math.min(180,t));for(let s=0;s<_n.length;s++)if(n>=_n[s].min&&n<=_n[s].max)return s;return 0}function nc(t,n){const s=ec(t);for(const a of n)s[Pm(a.score)]++;tc(t,s)}function _m(t){let n=null;try{const s=localStorage.getItem("ndn:currentUser");s?n=s:typeof window?.ndnCurrentUser=="string"&&(n=window.ndnCurrentUser)}catch{}for(const s of t){const a={...s};if(n){const o=(a.name||"").trim();(!o||o.toLowerCase()==="you")&&(a.name=n)}const r=[];for(const o of a.legs)if(o.finished)for(const l of o.visits)r.push({score:Math.max(0,Math.min(180,l.score))});r.length>0&&nc(a.name,r)}}const Oi=Object.freeze(Object.defineProperty({__proto__:null,SCORE_BUCKETS:_n,addMatchToAllTime:Om,addMatchToDistribution:_m,addSample:Zn,addVisitsToDistribution:nc,bumpGameMode:Dm,clearAllStats:Tm,getAllTime:Qt,getAllTime180s:zl,getAllTimeAvg:Co,getAllTimeBestCheckout:Wl,getAllTimeBestLeg:Hl,getAllTimeBestWorst:Am,getAllTimeFirstNineAvg:Vl,getDailyAdjustedAvg:Im,getGameModeStats:er,getHeadToHeadLegDiff:Fl,getMonthlyAvg3:Zl,getMonthlyFirstNineAvg:Rm,getRollingAvg:Yl,getRollingFirstNineAvg:Kl,getScoreDistribution:ec,getStatSeries:Jl,setAllTime:jo,setGameModeStats:ko,setScoreDistribution:tc,syncStatsFromServer:sa,updateHeadToHeadLegs:km},Symbol.toStringTag,{value:"Module"})),Fm=["X01","Double Practice"],$m=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice","Baseball","Golf","Tic Tac Toe","American Cricket","Scam","Fives","Sevens"],Um=[...Fm,...$m],fa={X01:{startOptions:[301,501,701],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5,7],firstto:[1,2,3,4,5,6]}},"Double Practice":{startOptions:[],modeOptions:["practice"],modeValueOptions:{practice:[30,60,120]},extraFields:[{key:"dartLimit",label:"Max darts",type:"select",options:[30,60,120],defaultValue:60,hint:"Stop after this many throws"}]},"Around the Clock":{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}},Cricket:{startOptions:[],modeOptions:["bestof","firstto","rounds"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4],rounds:[1,3,5]},valueLabel:"Legs"},"Halve It":{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}},Shanghai:{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]},extraFields:[{key:"rounds",label:"Rounds",type:"select",options:[7,10,20],defaultValue:20,hint:"Rounds 1â€“N"}]},"High-Low":{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}},Killer:{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]},extraFields:[{key:"lives",label:"Lives",type:"select",options:[3,5,7],defaultValue:3,hint:"Lives per player"}]},"Bob's 27":{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}},"Count-Up":{startOptions:[],modeOptions:["rounds","bestof","firstto"],modeValueOptions:{rounds:[5,8,10],bestof:[1,3,5],firstto:[1,2,3,4]},extraFields:[{key:"rounds",label:"Rounds",type:"select",options:[5,8,10,15],defaultValue:8,hint:"Number of rounds per game"}],valueLabel:"Rounds"},"High Score":{startOptions:[],modeOptions:["rounds","bestof","firstto"],modeValueOptions:{rounds:[5,8,10],bestof:[1,3,5],firstto:[1,2,3,4]},extraFields:[{key:"rounds",label:"Rounds",type:"select",options:[5,8,10,15],defaultValue:8,hint:"Number of rounds"}],valueLabel:"Rounds"},"Low Score":{startOptions:[],modeOptions:["rounds","bestof","firstto"],modeValueOptions:{rounds:[5,8,10],bestof:[1,3,5],firstto:[1,2,3,4]},extraFields:[{key:"rounds",label:"Rounds",type:"select",options:[5,8,10,15],defaultValue:8,hint:"Number of rounds"}],valueLabel:"Rounds"},"Checkout 170":{startOptions:[170],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]},extraFields:[{key:"dartCount",label:"Darts per attempt",type:"select",options:[3,6,9],defaultValue:3,hint:"Darts to check out"}]},"Checkout 121":{startOptions:[121],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]},extraFields:[{key:"dartCount",label:"Darts per attempt",type:"select",options:[3,6,9],defaultValue:3,hint:"Darts to check out"}]},"Treble Practice":{startOptions:[],modeOptions:["practice"],modeValueOptions:{practice:[30,60,120]},extraFields:[{key:"maxDarts",label:"Throws per game",type:"select",options:[15,30,45,60,90],defaultValue:30,hint:"Target cycles T20â†’T19â†’T18 every 3 darts"}]},Baseball:{startOptions:[],modeOptions:["bestof","innings"],modeValueOptions:{bestof:[1,3,5],innings:[1,3,5,9]},extraFields:[{key:"innings",label:"Innings",type:"select",options:[3,5,7,9],defaultValue:9,hint:"Number of innings"}],valueLabel:"Innings"},Golf:{startOptions:[],modeOptions:["holes","bestof"],modeValueOptions:{holes:[9,18],bestof:[1,3,5]},extraFields:[{key:"holes",label:"Holes",type:"select",options:[9,18],defaultValue:18,hint:"Number of holes per round"}],valueLabel:"Holes"},"Tic Tac Toe":{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}},"American Cricket":{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}},Scam:{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}},Fives:{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}},Sevens:{startOptions:[],modeOptions:["bestof","firstto"],modeValueOptions:{bestof:[1,3,5],firstto:[1,2,3,4]}}};function rp(t){return t==="all"?[301,501,701]:fa[t]?.startOptions??[]}function Bm(t){if(t==="all")return["all","bestof","firstto"];const n=fa[t];return n?["all",...n.modeOptions]:["all","bestof","firstto"]}function Vm(t,n){return t==="all"||n==="all"?[]:fa[t]?.modeValueOptions?.[n]??[]}function Hm(t){return t==="all"?[]:fa[t]?.extraFields??[]}function op(t,n){if(t==="all")return"Legs";const s=fa[t];if(s?.valueLabel)return s.valueLabel;switch(n){case"innings":return"Innings";case"holes":return"Holes";case"rounds":return"Rounds";case"practice":return"Throws";default:return"Legs"}}function ip(t){const n=Hm(t),s={};for(const a of n)s[a.key]=a.defaultValue;return s}const Wm={X01:{emoji:"ðŸŽ¯",tagline:"Count down to zero",color:"#818cf8"},"Double Practice":{emoji:"ðŸ”´",tagline:"Hit every double",color:"#fb7185"},"Around the Clock":{emoji:"ðŸ•",tagline:"1 through 20 and Bull",color:"#38bdf8"},Cricket:{emoji:"ðŸ",tagline:"Close 20â€“15 and Bull",color:"#34d399"},"Halve It":{emoji:"âœ‚ï¸",tagline:"Hit targets or lose half",color:"#fbbf24"},Shanghai:{emoji:"ðŸ€„",tagline:"Single, Double, Triple in round",color:"#f87171"},"High-Low":{emoji:"ðŸ“Š",tagline:"Alternate high and low",color:"#a78bfa"},Killer:{emoji:"ðŸ’€",tagline:"Eliminate your opponents",color:"#c084fc"},"Bob's 27":{emoji:"ðŸŽ²",tagline:"Hit doubles or lose points",color:"#fb923c"},"Count-Up":{emoji:"ðŸ“ˆ",tagline:"Score as high as you can",color:"#2dd4bf"},"High Score":{emoji:"ðŸ†",tagline:"Highest total wins",color:"#facc15"},"Low Score":{emoji:"â¬‡ï¸",tagline:"Lowest total wins",color:"#22d3ee"},"Checkout 170":{emoji:"ðŸ”¥",tagline:"Check out from 170",color:"#f87171"},"Checkout 121":{emoji:"âš¡",tagline:"Check out from 121",color:"#fbbf24"},"Treble Practice":{emoji:"ðŸŸ¢",tagline:"Hit trebles consistently",color:"#a3e635"},Baseball:{emoji:"âš¾",tagline:"Score runs each inning",color:"#60a5fa"},Golf:{emoji:"â›³",tagline:"Lowest strokes per hole",color:"#4ade80"},"Tic Tac Toe":{emoji:"âŒ",tagline:"Three in a row wins",color:"#e879f9"},"American Cricket":{emoji:"ðŸ¦…",tagline:"Close 20â€“12 and Bull",color:"#94a3b8"},Scam:{emoji:"ðŸƒ",tagline:"Hit each target in order",color:"#f472b6"},Fives:{emoji:"5ï¸âƒ£",tagline:"Score multiples of five",color:"#818cf8"},Sevens:{emoji:"7ï¸âƒ£",tagline:"Score multiples of seven",color:"#a78bfa"}};function lp(t){return Wm[t]??{emoji:"ðŸŽ¯",tagline:"",color:"#818cf8"}}function Fa(t){if(!t)return"";switch(t){case"all":return"All Modes";case"bestof":return"Best of";case"firstto":return"First to";case"innings":return"Innings";case"holes":return"Holes";case"rounds":return"Rounds";case"practice":return"Practice";case"none":return"Mode";default:return String(t).replace(/[-_]/g," ").replace(/\b\w/g,n=>n.toUpperCase())}}const zm={},Gm=zm?.VITE_REMOTE_WS_FALLBACK||"",qm="wss://ninedartnation-1.onrender.com/ws",aa=ac(Gm.trim()||qm),Jm=new Set(["localhost","127.0.0.1"]),sc=8787,Ym=3e3;function ac(t){const n=t.trim();return n?/\/ws$/i.test(n)?n:`${n.replace(/\/$/,"")}/ws`:""}function Km(t){if(!t)return null;try{return new URL(t).hostname.toLowerCase()}catch{return null}}function Rr(t){return!!t&&Jm.has(t)}let Bt=null;function Xm(){if(Bt)return Bt;const t="ws://localhost:8787".trim();if(t){const n=ac(t);if(typeof window<"u"){const s=Km(n),a=window.location.hostname;if(Rr(s)&&!Rr(a))return Bt=aa,Bt}return Bt=n,Bt}if(typeof window<"u"){const n=window.location.protocol==="https:"?"wss":"ws",s=window.location.hostname,a=`${n}://${window.location.host}/ws`;return Rr(s)?Bt=`${n}://${s}:${sc}/ws`:s.endsWith("onrender.com")?Bt=a:(s.endsWith("netlify.app"),Bt=aa),Bt}return Bt=aa,Bt}function Xr(){return Xm()}function Qm(){if(typeof window>"u")return[Xr()];const t=window.location.protocol==="https:"?"wss":"ws",n=window.location.hostname,s=window.location.host,a=Xr(),r=new Set([a,`${t}://${s}/ws`,`${t}://${n}/ws`,`${t}://${n}:${sc}/ws`,`${t}://${n}:${Ym}/ws`,aa]);return Array.from(r).filter(Boolean)}const rc=i.createContext(null);function Zm({children:t}){const[n,s]=i.useState(!1),[a,r]=i.useState("connecting"),o=i.useRef(null),l=i.useRef(new Set),m=i.useRef(!0),d=i.useRef(0),u=i.useRef(null),h=i.useRef(null),x=i.useRef(null),f=i.useRef(0),S=()=>(x.current||(x.current=Qm()),x.current),k=()=>{const L=S();return f.current=(f.current+1)%L.length,L[f.current]},p=()=>{const L=S();return L[f.current]||L[0]},w=i.useCallback(()=>{if(o.current&&(o.current.readyState===WebSocket.OPEN||o.current.readyState===WebSocket.CONNECTING))return;r("connecting");const A=`${p()}`,P=new WebSocket(A);o.current=P,P.onopen=()=>{s(!0),r("connected"),d.current=0;try{const D=localStorage.getItem("ndn:ws-identity");if(D){const j=JSON.parse(D);(j?.username||j?.email)&&P.send(JSON.stringify({type:"presence",username:j.username||j.email||"",email:(j.email||"").toLowerCase()}))}}catch{}h.current&&clearInterval(h.current),h.current=setInterval(()=>{try{o.current?.readyState===WebSocket.OPEN&&o.current?.send(JSON.stringify({type:"ping",t:Date.now()}))}catch{}},2e4)},P.onmessage=D=>{try{const j=JSON.parse(D.data);l.current.forEach(R=>{try{R(j)}catch{}})}catch{}},P.onerror=()=>{},P.onclose=()=>{if(s(!1),r("disconnected"),h.current&&(clearInterval(h.current),h.current=null),!m.current)return;const D=(d.current||0)+1;if(d.current=D,D>15)return;D%2===0&&k();const j=1e3*Math.pow(2,D),R=Math.floor(Math.random()*1e3),M=Math.min(6e4,Math.max(2e3,j+R));u.current&&clearTimeout(u.current),u.current=setTimeout(w,M)}},[]),v=i.useCallback(()=>{try{m.current=!1,u.current&&(clearTimeout(u.current),u.current=null),h.current&&(clearInterval(h.current),h.current=null);try{o.current?.close()}catch{}o.current=null}catch{}d.current=0,m.current=!0,r("connecting"),s(!1),w()},[w]);i.useEffect(()=>{m.current=!0,w();const L=()=>{m.current=!1;try{o.current?.close()}catch{}};window.addEventListener("beforeunload",L);const A=()=>{document.visibilityState==="visible"&&(n||w())};return document.addEventListener("visibilitychange",A),window.addEventListener("online",w),()=>{m.current=!1,u.current&&clearTimeout(u.current),h.current&&clearInterval(h.current);try{o.current?.close()}catch{}document.removeEventListener("visibilitychange",A),window.removeEventListener("online",w),window.removeEventListener("beforeunload",L)}},[w]);const g=i.useCallback(L=>{try{o.current&&o.current.readyState===WebSocket.OPEN&&o.current.send(typeof L=="string"?L:JSON.stringify(L))}catch{}},[]),O=i.useCallback(L=>(l.current.add(L),()=>{l.current.delete(L)}),[]),E=i.useMemo(()=>({connected:n,status:a,send:g,addListener:O,reconnect:v}),[n,a,g,O,v]);return e.jsx(rc.Provider,{value:E,children:t})}function Os(){const t=i.useContext(rc);if(!t)throw new Error("useWS must be used within WSProvider");return t}function oc({className:t,title:n}){let s=!1;try{s=Os().connected}catch{s=!1}const a=s?"Connected":"Disconnected";return e.jsx("span",{"aria-label":`Server connection: ${a}`,title:n||a,className:["inline-flex items-center justify-center","w-3 h-3 rounded-full",s?"bg-emerald-400":"bg-red-500","ring-2 ring-black/20",t||""].join(" ")})}const Li={calibration:{keywords:["calibration","calibrate","camera","score","accuracy","aim","setup"],title:"How Calibration Works",explanation:`Calibration helps our AI precisely detect where your darts land on the board. Here's how it works:

1. **D20**: Click on the 20 segment to calibrate that area
2. **D6**: Click on the 6 segment to calibrate that area
3. **D3**: Click on the 3 segment to calibrate that area
4. **D11**: Click on the 11 segment to calibrate that area
5. **Bullseye**: Click on the bullseye to calibrate the center

Each click teaches the system about your board's position and angle. After calibrating all areas, your scoring will be much more accurate!`,actions:[{id:"D20",label:"ðŸ“ Click D20",color:"bg-blue-600"},{id:"D6",label:"ðŸ“ Click D6",color:"bg-purple-600"},{id:"D3",label:"ðŸ“ Click D3",color:"bg-pink-600"},{id:"D11",label:"ðŸ“ Click D11",color:"bg-cyan-600"},{id:"Bullseye",label:"ðŸŽ¯ Click Bullseye",color:"bg-yellow-600"}]},scoring:{keywords:["score","points","counting","how do i score","scoring system"],title:"Dart Scoring",explanation:`In darts, each segment on the board has a value:
- Single areas: Face value (1-20)
- Double ring (outer): 2Ã— the segment number
- Triple ring (inner): 3Ã— the segment number
- Bullseye: 50 points
- Bull (outer bull): 25 points

For example: hitting Triple 20 = 60 points, Double 10 = 20 points`},gameplay:{keywords:["game","how to play","rules","x01","cricket","match","round"],title:"How to Play",explanation:`Nine Dart Nation supports multiple game modes:

**X01** (501, 301, 701): Start from the set score and count down to exactly 0. Final dart must be on a double.

**Cricket**: Players try to "close" numbers 15-20 and bullseye by hitting them. First to close all and have the highest score wins.

**Killer**: Players mark their "number" and try to knock out other players' lives.

Select your game mode when creating a match, and follow the on-screen instructions!`},premium:{keywords:["premium","subscription","features","upgrade","cost","paid"],title:"Premium Features",explanation:`Our Premium subscription gives you:
- Tournament creation and entry
- Advanced statistics and replays
- Priority matchmaking
- Custom profiles and themes
- Ad-free experience

Premium grants are often awarded as tournament prizes!`},connection:{keywords:["connection","disconnect","lag","latency","websocket","error","offline"],title:"Connection Issues",explanation:`If you're experiencing connection issues:
1. Check your internet connection
2. Refresh the page (Ctrl+R or Cmd+R)
3. Clear browser cache
4. Try a different browser
5. Check if the site status page shows any issues

Most connection issues resolve in seconds. Contact admin if problems persist.`},camera:{keywords:["camera","phone camera","mobile","video","pairing","connect"],title:"Camera Setup",explanation:`To use our phone camera feature:
1. Open Nine Dart Nation on your phone
2. Go to Settings > Camera Pairing
3. Scan the QR code or enter the pairing code
4. Position your phone to capture the dartboard
5. Run calibration (see calibration help for details)

Your phone will now act as a live dartboard camera!`},tournament:{keywords:["tournament","compete","bracket","prize","winner","playoffs"],title:"Tournaments",explanation:`Tournaments are competitive events where you can:
- Play against other skilled players
- Win prizes (Premium subscriptions)
- Climb leaderboards
- Compete in structured brackets

Check the Tournaments tab to see upcoming events. Registration typically opens 30 minutes before start time.`}};function eh(t){const n=t.toLowerCase();for(const[,s]of Object.entries(Li))for(const a of s.keywords)if(n.includes(a))return{type:"explanation",title:s.title,message:s.explanation,actions:s.actions,followUp:"Do you need further assistance? I can connect you with an admin if needed."};return{type:"suggestion",title:"Need More Help?",message:`I couldn't find a specific answer to your question. Common topics I can help with:

${Object.values(Li).map(s=>`Â· ${s.title}`).join(`
`)}

Or I can connect you with an admin who can help further.`,followUp:"Would you like to speak with an admin?"}}function th(){const t=new Date().getHours();return t>=20||t<7?"20-30 minutes (off-peak hours)":t>=12&&t<14?"10-15 minutes (moderate traffic)":t>=18&&t<20?"15-20 minutes (peak hours)":"5-10 minutes"}function ic({request:t,user:n,onClose:s}){const a=(()=>{try{return Os()}catch{return null}})(),[r,o]=i.useState(()=>{const A=t?.messages||[];return A.length===0&&t?.message?[{fromName:t.username||"User",message:t.message,ts:t.ts||Date.now(),admin:!1}]:A}),[l,m]=i.useState(""),[d,u]=i.useState({}),[h,x]=i.useState(!1),[f,S]=i.useState(()=>t?.status==="resolved"),[k,p]=i.useState(""),w=i.useRef(null),v=i.useRef(null),g=i.useRef([]);i.useEffect(()=>{t?.messages&&t.messages.length>0?o(t.messages):t?.message&&o([{fromName:t.username||"User",message:t.message,ts:t.ts||Date.now(),admin:!1}]),t?.claimedBy&&x(!0),t?.status==="resolved"&&S(!0)},[t?.id,t?.messages?.length,t?.claimedBy,t?.status]),i.useEffect(()=>{if(!f||n?.isAdmin)return;const A=window.setTimeout(()=>{s?.()},5e3);return()=>clearTimeout(A)},[f,n?.isAdmin,s]),i.useEffect(()=>{if(!a)return;const A=a.addListener(P=>{try{if(P?.type==="help-message"&&String(P.requestId)===String(t.id)){const D=P.message;o(j=>j.some(M=>M.message===D.message&&Math.abs((M.ts||0)-(D.ts||0))<1e4)?j:[...j,D])}if(P?.type==="help-request-updated"&&P.request?.id===t.id&&(o(P.request.messages||[]),x(!!P.request.claimedBy),P.request.status==="resolved"&&S(!0)),P?.type==="help-typing"&&String(P.requestId)===String(t.id)){const D=P.fromName||P.fromEmail||(P.admin?"admin":"user");u(j=>({...j,[D]:Date.now()}))}}catch{}});return()=>{A()}},[a,t?.id]);const O=()=>{if(!l.trim())return;const A=l,P={fromEmail:n?.email||null,fromName:n?.username||null,message:A,ts:Date.now(),admin:!!n?.isAdmin};o(D=>[...D,P]),m("");try{const D={"Content-Type":"application/json"},j=localStorage.getItem("authToken");j&&(D.Authorization=`Bearer ${j}`),De(`/api/help/requests/${t.id}/messages`,{method:"POST",headers:D,body:JSON.stringify({message:A})}).catch(()=>{try{a?.send({type:"help-message",requestId:t.id,message:A})}catch{}})}catch{try{a?.send({type:"help-message",requestId:t.id,message:A})}catch{}}if(!h){const D=window.setTimeout(()=>{const j=eh(A);if(j){const R={fromName:"AI Assistant",message:`${j.title}

${j.message}`,ts:Date.now(),admin:!0,actions:j.actions,followUp:j.followUp};o(M=>[...M,R])}},500);g.current.push(D)}},E=A=>{if(!A){const j={fromName:"You",message:"No, I think I have it now. Thanks!",ts:Date.now(),admin:!1};o(M=>[...M,j]);const R=window.setTimeout(()=>{const M={fromName:"AI Assistant",message:"âœ“ Great! Glad I could help. Feel free to reach out anytime you need assistance.",ts:Date.now(),admin:!0};o($=>[...$,M])},300);g.current.push(R);return}const P={fromName:"You",message:"Yes, I need to speak with an admin",ts:Date.now(),admin:!1};o(j=>[...j,P]);try{a?.send({type:"help-escalate",requestId:t.id})}catch{}p(th());const D=window.setTimeout(()=>{const j={fromName:"System",message:`â³ Connecting you with an admin...

ðŸ“Š Estimated wait time: ${k}

An admin will be with you shortly. Please stay on this chat.`,ts:Date.now(),admin:!0};o(R=>[...R,j])},500);g.current.push(D)};i.useEffect(()=>{if(!t?.id)return;let A=!0;const P=async()=>{try{const j={},R=localStorage.getItem("authToken");R&&(j.Authorization=`Bearer ${R}`);const M=await De(`/api/help/requests/${t.id}`,{headers:j});if(!A)return;const $=await M.json().catch(()=>null);$?.ok&&$.request?.messages&&$.request.messages.length>0&&(o(W=>{const Y=$.request.messages;return Y.length>W.length?Y:W}),$.request.claimedBy&&x(!0),$.request.status==="resolved"&&S(!0))}catch{}},D=setInterval(P,4e3);return P(),()=>{A=!1,clearInterval(D)}},[t?.id]),i.useEffect(()=>{if(w.current)try{w.current.scrollTop=w.current.scrollHeight}catch{}},[r]);const L=i.useCallback(()=>{try{a?.send({type:"help-typing",requestId:t.id,fromName:n?.username,fromEmail:n?.email,admin:!!n?.isAdmin})}catch{}v.current&&clearTimeout(v.current),v.current=window.setTimeout(()=>{u(A=>{const P={...A};return delete P[n?.username||n?.email||"me"],P})},3e3)},[a,t.id,n]);return i.useEffect(()=>()=>{v.current&&clearTimeout(v.current);for(const A of g.current)clearTimeout(A);g.current=[]},[]),e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-2xl bg-slate-900 rounded-lg shadow-xl overflow-hidden flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-slate-700 bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(mi,{className:"w-4 h-4 text-yellow-400"}),"Help Desk â€” ",t.username||"Anonymous"]}),h&&!f&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-emerald-600",children:"Admin Connected"}),f&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-slate-500",children:"Chat Ended"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n?.isAdmin&&!f&&e.jsx("button",{className:"px-3 py-1 rounded bg-red-600 hover:bg-red-500 text-white text-xs font-semibold",onClick:async()=>{try{const A={"Content-Type":"application/json"},P=localStorage.getItem("authToken");P&&(A.Authorization=`Bearer ${P}`),await De(`/api/admin/help-requests/${t.id}/resolve`,{method:"POST",headers:A})}catch{}},children:"Goodbye"}),e.jsx("button",{"aria-label":"Close",className:"px-2 py-1 rounded bg-neutral-700 hover:bg-neutral-600 text-sm",onClick:s,children:e.jsx(no,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{ref:w,className:"flex-1 overflow-y-auto p-3 space-y-3 bg-black/20",children:[r.map((A,P)=>e.jsx("div",{children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded ${A.admin?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-100 ml-auto":"bg-slate-700 text-slate-100"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs opacity-70 font-semibold flex items-center gap-1",children:[A.admin?e.jsx(mi,{className:"w-3 h-3"}):e.jsx(Ga,{className:"w-3 h-3"}),A.fromName||A.fromEmail||(A.admin?"AI Assistant":"You")]}),e.jsx("div",{className:"text-xs opacity-50 ml-2",children:A.ts?new Date(A.ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("div",{className:"whitespace-pre-wrap break-words text-sm",children:A.message}),A.actions&&A.actions.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold opacity-80",children:"ðŸ“ Try these calibration points:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:A.actions.map(D=>e.jsx("button",{className:`${D.color} text-white text-xs py-2 px-2 rounded font-medium hover:opacity-90 transition-opacity`,onClick:()=>{const j={fromName:"You",message:`Clicked: ${D.label}`,ts:Date.now(),admin:!1};o(R=>[...R,j]);try{a?.send({type:"help-message",requestId:t.id,message:`User clicked: ${D.id}`})}catch{}},children:D.label},D.id))})]}),A.followUp&&!h&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs opacity-80",children:A.followUp}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white text-xs py-2 px-3 rounded font-medium transition-colors",onClick:()=>E(!0),children:"âœ… Yes, connect me"}),e.jsx("button",{className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white text-xs py-2 px-3 rounded font-medium transition-colors",onClick:()=>E(!1),children:"âŒ No thanks"})]})]})]})},P)),Object.keys(d).length>0&&e.jsxs("div",{className:"text-xs text-slate-300 opacity-80 flex items-center gap-2",children:[e.jsxs("span",{children:[Object.keys(d).join(", ")," typing"]}),e.jsxs("span",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce"}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce delay-100"}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full animate-bounce delay-200"})]})]})]}),f?e.jsxs("div",{className:"p-3 border-t border-slate-700 bg-slate-800 text-center",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"This chat has been closed. Thank you!"}),!n?.isAdmin&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Closing automatically in a few secondsâ€¦"}),e.jsx("button",{className:"mt-2 btn bg-slate-600 hover:bg-slate-500 text-white text-sm px-4 py-1",onClick:s,children:"Close"})]}):e.jsxs("div",{className:"p-3 border-t border-slate-700 bg-slate-800 flex gap-2",children:[e.jsx("input",{className:"input flex-1 text-sm",value:l,onChange:A=>{m(A.target.value),L()},onKeyDown:A=>{A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),O())},placeholder:"Ask a question (e.g., 'How does calibration work?')..."}),e.jsx("button",{"aria-label":"Send message",className:"btn bg-blue-600 hover:bg-blue-700 text-white",onClick:O,children:e.jsx(so,{className:"w-4 h-4"})})]})]})]})}const nh="daviesfamily108@gmail.com";function sh({user:t}){const{hiddenSections:n,setHiddenSections:s,cardPaddingBottom:a,setCardPaddingBottom:r}=J(),o=n||[],l=i.useMemo(()=>[{key:"tab:score",label:"Home tab",group:"Tabs"},{key:"tab:camera",label:"Camera tab",group:"Tabs"},{key:"tab:online",label:"Online Play tab",group:"Tabs"},{key:"tab:offline",label:"Offline tab",group:"Tabs"},{key:"tab:tournaments",label:"Tournaments tab",group:"Tabs"},{key:"tab:friends",label:"Friends tab",group:"Tabs"},{key:"tab:stats",label:"Stats tab",group:"Tabs"},{key:"tab:settings",label:"Settings tab",group:"Tabs"},{key:"tab:fullaccess",label:"Premium tab",group:"Tabs"},{key:"tab:admin",label:"Admin tab",group:"Tabs"},{key:"stats:player-cards",label:"Stats: player cards",group:"Stats"},{key:"stats:opponent-compare",label:"Stats: opponent compare",group:"Stats"},{key:"stats:score-distribution",label:"Stats: score distribution",group:"Stats"},{key:"stats:other-modes",label:"Stats: other modes",group:"Stats"},{key:"global:helpassistant",label:"Help assistant",group:"Global"},{key:"global:footer",label:"Footer",group:"Global"},{key:"global:camera-logger",label:"Camera logger",group:"Global"},{key:"global:camera-watchdog",label:"Camera watchdog",group:"Global"},{key:"global:camera-recovery",label:"Camera recovery toasts",group:"Global"}],[]),m=i.useMemo(()=>{const b={};for(const F of l)b[F.group]||(b[F.group]=[]),b[F.group].push(F);return b},[l]),d=i.useCallback(b=>{const F=o.includes(b)?o.filter(K=>K!==b):[...o,b];s(F)},[o,s]),u=(()=>{try{return Os()}catch{return null}})(),[h,x]=i.useState([]),[f,S]=i.useState(""),[k]=i.useState(null),[p,w]=i.useState(""),[v,g]=i.useState(!1),[O,E]=i.useState([]),[L,A]=i.useState(""),[P,D]=i.useState([]),[j,R]=i.useState({title:"Official Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:30,capacity:16,prizeType:"premium",prizeAmount:3,prizeNotes:""}),[M,$]=i.useState("general"),W=t?.email?.toLowerCase()===nh,Y=vo(t?.email),[ne]=i.useState([]),[xe]=i.useState([]),[ie,je]=i.useState([]),[Ne,he]=i.useState({}),[ke,ae]=i.useState(null),[,ve]=i.useState([]),[ye,Te]=i.useState(null),[Ie,Ge]=i.useState(!1),[Xe,Qe]=i.useState(1500),[,tt]=i.useState(!1),[dt,Oe]=i.useState([]),[$e,B]=i.useState(!1),z=async()=>{g(!0);try{const b={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`};(await De("/api/admin/tournaments/broadcast",{method:"POST",headers:b})).ok?be("Tournaments broadcast triggered",{type:"success"}):be("Broadcast failed",{type:"error"})}catch{be("Broadcast request failed",{type:"error"})}finally{g(!1)}},[Ce,se]=i.useState(0);i.useEffect(()=>{const b=()=>se(F=>F+1);return window.addEventListener("ndn:stats-updated",b),()=>window.removeEventListener("ndn:stats-updated",b)},[]);const ee=i.useMemo(()=>er(Um),[Ce]),be=yo();i.useEffect(()=>{Re(),C()},[]);const ht=i.useMemo(()=>{const b=[];if(ee&&typeof ee=="object")for(const[F,K]of Object.entries(ee)){const Ye=K;b.push({label:F,value:Ye?.played||0,won:Ye?.won||0})}return b},[ee]);async function Re(){try{const b={Authorization:`Bearer ${localStorage.getItem("authToken")}`},[F,K,Ye]=await Promise.all([De("/api/admin/help-requests",{headers:b}),De("/api/admins",{headers:b}),De("/api/tournaments",{headers:b})]);if(F.ok){const rt=await F.json();je(Array.isArray(rt)?rt:rt.requests||[])}if(K.ok){const rt=await K.json();x(Array.isArray(rt)?rt:rt.admins||[])}if(Ye.ok){const rt=await Ye.json();E(Array.isArray(rt)?rt:rt.tournaments||rt)}}catch(b){console.error("refresh failed",b)}}async function C(){B(!0);try{const b={Authorization:`Bearer ${localStorage.getItem("authToken")}`},F=await De("/api/admin/members?limit=50",{headers:b});if(F.ok){const K=await F.json();Oe(Array.isArray(K.members)?K.members:[])}}catch(b){console.error("fetchNewMembers failed",b)}finally{B(!1)}}async function _(b){try{await De("/api/admins/revoke",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:b})}),await Re()}catch{}}async function V(b,F){if(b)try{await De("/api/admin/premium/grant",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:b,days:F})}),await Re()}catch{}}async function te(b){try{await De("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:b})}),await Re()}catch{}}async function de(){if(p.trim())try{await De("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({message:p})}),w(""),await Re()}catch{}}async function ut(b){try{await De("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({maintenance:b})}),await Re()}catch{}}i.useEffect(()=>{if(!u)return;const b=u.addListener(K=>{try{if(K?.type==="help-typing"){const Ye=String(K.requestId||"");if(!Ye)return;he(rt=>({...rt,[Ye]:{who:K.fromName||"someone",ts:Date.now()}}));return}if(K?.type==="help-request"){const Ye=K.request;if(!Ye||!Ye.id)return;je(rt=>{const It=(rt||[]).filter(en=>String(en.id)!==String(Ye.id));return[Ye,...It]});return}K?.type==="help-request-updated"&&Re()}catch{}}),F=setInterval(()=>{const K=Date.now();he(Ye=>{let rt=!1;const It={...Ye};for(const en of Object.keys(It))K-It[en].ts>3500&&(delete It[en],rt=!0);return rt?It:Ye})},1500);return()=>{try{b()}catch{}clearInterval(F)}},[u]);async function Nt(b){try{const F={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`};(await De(`/api/admin/help-requests/${encodeURIComponent(b)}/claim`,{method:"POST",headers:F,body:JSON.stringify({})})).ok&&await Re()}catch{}}async function X(b){try{const F={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`};(await De(`/api/admin/help-requests/${encodeURIComponent(b)}/resolve`,{method:"POST",headers:F,body:JSON.stringify({})})).ok&&await Re()}catch{}}async function fe(b){try{const F={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},K=await De(`/api/admin/help-requests/${encodeURIComponent(b)}/delete`,{method:"POST",headers:F,body:JSON.stringify({})});K.ok?(be("Help request deleted",{type:"success"}),await Re()):be(`Delete failed: ${K.status}`,{type:"error"})}catch{be("Delete request failed",{type:"error"})}}async function pe(){try{const b={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},F=await De("/api/admin/help-requests/clear",{method:"POST",headers:b,body:JSON.stringify({})});F.ok?(be("All help requests cleared",{type:"success"}),await Re()):be(`Clear failed: ${F.status}`,{type:"error"})}catch{be("Clear request failed",{type:"error"})}}async function Ue(){f&&(await De("/api/admins/grant",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:f})}),Yu(f),S(""),await Re())}async function qe(){if(L.trim())try{const b={Authorization:`Bearer ${localStorage.getItem("authToken")}`},F=await De(`/api/admin/users/search?q=${encodeURIComponent(L)}`,{headers:b});if(F.ok){const K=await F.json();D(Array.isArray(K.users)?K.users:[])}}catch(b){console.error("Search failed:",b)}}async function Je(b){try{await De("/api/admin/users/ban",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:b})}),await qe()}catch(F){console.error("Ban failed:",F)}}async function it(b){try{await De("/api/admin/users/unban",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({email:b})}),await qe()}catch(F){console.error("Unban failed:",F)}}async function at(){g(!0);try{const b=new Date(j.startAt).getTime(),F=await De("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j.title,game:j.game,mode:j.mode,value:Number(j.value),description:j.description,startAt:b,checkinMinutes:Number(j.checkinMinutes),capacity:Number(j.capacity),requireCalibration:!!j.requireCalibration,creatorEmail:t?.email,creatorName:t?.username,requesterEmail:t?.email,official:!0,prizeType:"premium",prizeAmount:Number(j.prizeAmount||0),prizeNotes:j.prizeNotes})});await Re();try{const K=await F.json();K&&K.tournament&&K.tournament.id&&window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:"tournaments"}}))}catch{}}finally{g(!1)}}async function Pt(b,F){g(!0);try{await De("/api/admin/tournaments/winner",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({tournamentId:b,winnerEmail:F})}),await Re()}finally{g(!1)}}async function mt(b){g(!0);try{await De("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({tournamentId:b,requesterEmail:t?.email})}),await Re()}finally{g(!1)}}async function gn(){g(!0);try{await De("/api/admin/tournaments/reseed-weekly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({})}),await Re()}finally{g(!1)}}async function Zt(b){g(!0);try{await De("/api/admin/matches/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({matchId:b})}),await Re()}finally{g(!1)}}async function bn(){try{const b={Authorization:`Bearer ${localStorage.getItem("authToken")}`},F=await De("/api/admin/logs",{headers:b});if(F.ok){const K=await F.json();K?.ok&&ve(K.logs||[])}}catch(b){console.error("Failed to fetch logs:",b)}}async function Tt(){try{const b={Authorization:`Bearer ${localStorage.getItem("authToken")}`},F=await De("/api/admin/system-health",{headers:b});if(F.ok){const K=await F.json();if(K?.ok&&K?.health){const Ye=typeof window<"u"&&window.location.protocol==="https:";Te({database:K.health.database||!1,websocket:K.health.websocket||!1,https:K.health.https||Ye,maintenance:K.health.maintenance||!1,clustering:K.health.clustering||!1,uptime:K.health.uptime||0,memory:K.health.memory||{heapUsed:0},version:K.health.version||"unknown"}),Ge(K.health?.clustering||!1)}}}catch(b){console.error("Failed to fetch system health:",b)}}async function Ze(b){g(!0);try{const F=await De("/api/admin/clustering",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({enabled:b,capacity:Xe})});if(!F.ok){const Ye=await F.json().catch(()=>({})),rt=Ye?.error||`Server returned ${F.status}`;console.error("Clustering toggle server error:",F.status,Ye),alert(`Clustering toggle failed: ${rt}`);return}const K=await F.json().catch(()=>null);console.log("Clustering response:",K),K?.ok?(Ge(!!K.enabled),alert(`Clustering ${K.enabled?"enabled":"disabled"} successfully. Max capacity: ${(K.capacity||Xe).toLocaleString()} concurrent users.`),Tt().catch(()=>{})):alert(`Failed: ${K?.error||K?.message||"Unknown error â€” server may be restarting"}`)}catch(F){console.error("Clustering toggle failed:",F),alert(`Clustering toggle failed â€” server may be waking up. Try again in a few seconds.
`+(F instanceof Error?F.message:String(F)))}finally{g(!1)}}async function we(b){Qe(b)}return i.useEffect(()=>{W&&(M==="general"||M==="maintenance")&&(bn(),Tt())},[W,M]),!W&&!Y?e.jsxs("div",{className:"card ndn-page",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 ndn-section-title",children:"Admin ðŸ›¡ï¸"}),e.jsx("div",{className:"text-sm opacity-80",children:"You don't have permission to access the admin dashboard."})]}):e.jsxs("div",{className:"p-4 md:p-8 max-w-7xl mx-auto ndn-page",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-white tracking-tight ndn-section-title",children:"Admin ðŸ›¡ï¸"}),e.jsx("p",{className:"text-white/40 font-medium",children:"System management and oversight"})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-lg border border-white/15 bg-white/5 px-3 py-1 text-xs",children:[e.jsx(oc,{}),e.jsx("span",{className:"text-slate-100 select-none",children:"Server"})]}),u&&u.reconnect&&e.jsx("button",{onClick:()=>u.reconnect(),className:"ml-1 rounded-md bg-neutral-700/60 hover:bg-neutral-600/70 px-2.5 py-1 text-xs border border-white/10",title:"Force close and recreate the WebSocket connection",children:"Recreate WS"})]})]}),ie.filter(b=>b.status!=="resolved").length>0&&e.jsxs("div",{className:"p-2 rounded-xl bg-amber-900/10 border border-amber-500/20 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold",children:"Open Help Requests ðŸ†˜"}),e.jsxs("span",{className:"text-sm opacity-80",children:[ie.filter(b=>b.status!=="resolved").length," ","open"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>ae(ie.filter(b=>b.status!=="resolved")[0]),children:"Open Latest"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>Re(),children:"Refresh"}),e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-white",onClick:()=>pe(),children:"Clear All"})]})]}),e.jsx("div",{className:"mt-2 flex gap-2 overflow-x-auto",children:ie.filter(b=>b.status!=="resolved").slice(0,6).map(b=>e.jsxs("div",{className:"p-2 rounded bg-black/10 border border-white/10 min-w-[220px]",children:[e.jsx("div",{className:"font-medium",children:b.username||"Anonymous"}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(b.ts||0).toLocaleTimeString()}),e.jsx("div",{className:"text-sm truncate mt-1",children:b.message}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[b.status==="open"?e.jsx("button",{className:"btn",onClick:()=>Nt(b.id),children:"Claim"}):e.jsxs("span",{className:"text-xs opacity-70",children:[b.status," by ",b.claimedBy||"â€”"]}),e.jsx("button",{className:"btn",onClick:()=>ae(b),children:"Chat"}),e.jsx("button",{className:"btn bg-red-600/80 hover:bg-red-700 text-white text-xs",onClick:()=>fe(b.id),children:"âœ•"})]})]},b.id))})]}),W&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Site Sections"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Hide sections across the site. Owner only."}),e.jsx("div",{className:"grid gap-4",children:Object.entries(m).map(([b,F])=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[e.jsx("div",{className:"font-semibold mb-2",children:b}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:F.map(K=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!o.includes(K.key),onChange:()=>d(K.key)}),e.jsx("span",{children:K.label})]},K.key))})]},b))})]}),e.jsx(Sm,{tabs:[{key:"general",label:"General"},{key:"maintenance",label:"Maintenance"},{key:"premium",label:"Premium"},{key:"tourneys",label:"Tourneys"},{key:"helpdesk",label:"Help Desk"}],active:M,onChange:b=>$(b),className:"mb-4"}),M==="general"&&e.jsxs(e.Fragment,{children:[W&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Game Usage"}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(Nm,{data:ht.map(b=>({label:"",value:b.value}))}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:ht.map((b,F)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:b.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",b.value," Â· Won ",b.won]})]},F))})]})]}),W&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Card Depth (Stats Page)"}),e.jsxs("div",{className:"text-sm opacity-80 mb-3",children:["Controls the ",e.jsx("code",{children:"padding-bottom"})," on the stats page card. Change this value if content is cut off on mobile or desktop."]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",className:"input w-32",min:0,max:1200,value:a??810,onChange:b=>{const F=parseInt(b.target.value,10);isNaN(F)||r(F)}}),e.jsx("span",{className:"text-xs opacity-70",children:"px (default 810)"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin Control âš™ï¸"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Admin to trusted users. Only the owner can perform these actions."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:f,onChange:b=>S(b.target.value)}),e.jsx("button",{className:"btn",disabled:v,onClick:Ue,children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:v,onClick:()=>_(f),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Current Admins:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:h.map(b=>e.jsx("div",{className:"px-2 py-1 rounded bg-indigo-600/20 border border-indigo-500/40 text-sm",children:b},b))}),e.jsx("hr",{className:"border-indigo-500/20 my-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Premium Access Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Premium subscription access to users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:f,onChange:b=>S(b.target.value)}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:v||!f.trim(),onClick:()=>V(f,30),children:"Grant Premium"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:v,onClick:()=>te(f),children:"Revoke Premium"})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Premium grants provide 30 days of unlimited access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white/90",children:"Announcements ðŸ“¢"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Send a message to all users. This will appear as a toast notification."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Announcement message...",value:p,onChange:b=>w(b.target.value)}),e.jsx("button",{className:"btn",disabled:v||!p.trim(),onClick:de,children:"Send"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Search"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Search for users by email or name."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"Search users...",value:L,onChange:b=>A(b.target.value)}),e.jsx("button",{className:"btn",disabled:v,onClick:qe,children:"Search"})]}),P.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),P.map(b=>e.jsx("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:b.name||"No name"}),e.jsx("div",{className:"opacity-70",children:b.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(b.createdAt).toLocaleDateString()]})]})},b.email))]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"New Members"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",disabled:$e,onClick:C,children:$e?"Loadingâ€¦":"Refresh"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Most recent sign-ups (newest first)."}),dt.length===0&&!$e&&e.jsx("div",{className:"text-sm opacity-60",children:"No members found."}),dt.length>0&&e.jsx("div",{className:"max-h-80 overflow-y-auto space-y-2",children:dt.map(b=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:b.username}),e.jsx("div",{className:"opacity-70 text-xs",children:b.email})]}),e.jsx("div",{className:"text-xs opacity-60 text-right whitespace-nowrap",children:b.createdAt?new Date(b.createdAt).toLocaleString():"Unknown"})]},b.email))})]})]}),M==="maintenance"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Management"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Ban or unban users. Use with caution."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:L,onChange:b=>A(b.target.value)}),e.jsx("button",{className:"btn",disabled:v,onClick:qe,children:"Search"})]}),P.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),P.map(b=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:b.name||"No name"}),e.jsx("div",{className:"opacity-70",children:b.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(b.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",onClick:()=>Je(b.email),children:"Ban"}),e.jsx("button",{className:"btn bg-green-600 hover:bg-green-700 text-xs",onClick:()=>it(b.email),children:"Unban"})]})]},b.email))]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),ye?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ye.database?"bg-emerald-600":"bg-red-600"}`,children:ye.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ye.websocket?"bg-emerald-600":"bg-red-600"}`,children:ye.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ye.https?"bg-emerald-600":"bg-amber-600"}`,children:ye.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${ye.maintenance?"bg-red-600":"bg-emerald-600"}`,children:ye.maintenance?"Active":"Normal"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Clustering (Auto-Scaling)"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${Ie?"bg-emerald-600":"bg-amber-600"}`,children:Ie?"Enabled":"Disabled"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(ye.uptime/3600),"h"," ",Math.floor(ye.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",ye.memory?Math.round(ye.memory.heapUsed/1024/1024):"?","MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",ye.version]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{className:"btn",onClick:Tt,children:"Refresh"}),e.jsxs("button",{className:`btn ${Ie?"bg-amber-600 hover:bg-amber-700":"bg-emerald-600 hover:bg-emerald-700"}`,disabled:v,onClick:()=>Ze(!Ie),children:[Ie?"Disable":"Enable"," Clustering"]})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:Tt,children:"Load Health Status"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Clustering Capacity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"font-semibold",children:"Max Concurrent Users"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>tt(!1),children:"Close"}),e.jsx("button",{className:"btn",onClick:z,disabled:!W||v,children:"Force broadcast"})]})]}),e.jsx("input",{type:"range",min:"1500",max:"50000",step:"500",value:Xe,onChange:b=>we(Number(b.target.value)),disabled:v,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",style:{background:Ie?`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(Xe-1500)/48500*100}%, #374151 ${(Xe-1500)/48500*100}%, #374151 100%)`:"#374151"}}),e.jsxs("div",{className:"flex justify-between text-xs opacity-60 mt-1",children:[e.jsx("span",{children:"1.5k"}),e.jsx("span",{children:"50k"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("button",{className:`btn ${Ie?"bg-amber-600 hover:bg-amber-700":"bg-emerald-600 hover:bg-emerald-700"}`,disabled:v,onClick:()=>Ze(!Ie),children:[Ie?"Disable":"Enable"," Clustering"]})})]}),e.jsxs("div",{className:"text-xs opacity-70 mt-2 p-2 bg-white/5 rounded",children:["ðŸ’¡ Clustering enables auto-scaling with capacity up to"," ",Xe.toLocaleString()," concurrent users. Adjust the slider to set maximum capacity. NODE_WORKERS environment variable is set to handle the configured load behind a reverse proxy."]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"User Reports"}),e.jsxs("ul",{className:"space-y-2",children:[xe.map(b=>e.jsx("li",{className:"p-2 rounded bg-black/20 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:b.id}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:b.reporter})," â†’"," ",e.jsx("span",{className:"font-semibold",children:b.offender})," Â·"," ",new Date(b.ts).toLocaleString()]}),e.jsxs("div",{className:"opacity-80",children:["Reason: ",b.reason]}),b.messageId&&e.jsxs("div",{className:"opacity-60 text-xs",children:["Message ID: ",b.messageId]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${b.status==="open"?"bg-amber-600":"bg-emerald-600"}`,children:b.status}),b.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:v,onClick:async()=>{await De("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({id:b.id,action:"resolved"})}),await Re()},children:"Resolve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:v,onClick:async()=>{const F=prompt("Enter notes for action taken (e.g., warning, block):")||"";await De("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({id:b.id,action:"actioned",notes:F})}),await Re()},children:"Action"})]})]})]})},b.id)),xe.length===0&&e.jsx("li",{className:"opacity-60",children:"No reports."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Open Matches"}),e.jsxs("ul",{className:"space-y-1",children:[(k?.matches||[]).map(b=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs",children:b.id}),e.jsx("span",{className:"opacity-80",children:b.creatorName}),e.jsxs("span",{className:"opacity-60",children:[b.game," Â· ",Fa(b.mode)," ",b.value," ",b.game==="X01"?`/${b.startingScore}`:""]})]}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:v,onClick:()=>Zt(b.id),children:"Remove"})]},b.id)),(!k?.matches||k.matches.length===0)&&e.jsx("li",{className:"text-sm opacity-60",children:"No open matches."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Dangerous Operations"}),e.jsx("div",{className:"text-sm opacity-80 mb-3 text-red-400",children:"âš ï¸ These operations can cause data loss or service disruption. Use with extreme caution."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"Tournament Deletion"}),e.jsxs("ul",{className:"space-y-2",children:[O.map(b=>e.jsxs("li",{className:"p-2 rounded bg-red-900/20 border border-red-500/40 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:b.title}),e.jsx("div",{className:"opacity-70",children:b.status})]}),e.jsxs("div",{className:"opacity-80",children:[b.game," Â· ",Fa(b.mode)," ",b.value]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",disabled:v,onClick:()=>mt(b.id),children:"Delete Tournament"})})]},b.id)),O.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"System Maintenance"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"p-3 rounded bg-red-900/20 border border-red-500/40",children:[e.jsx("div",{className:"font-semibold text-red-400 mb-2",children:"Maintenance Mode"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Put the entire site into maintenance mode. Users won't be able to access games or create matches."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${k?.maintenance?"bg-red-600":"bg-green-600"}`,children:k?.maintenance?"MAINTENANCE ACTIVE":"NORMAL OPERATION"}),e.jsx("button",{className:`btn ${k?.maintenance?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:v,onClick:()=>ut(!k?.maintenance),children:k?.maintenance?"Disable":"Enable"})]})]})})]})]})]})]}),M==="premium"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Subscription Grants"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke premium subscriptions for users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:f,onChange:b=>S(b.target.value)}),e.jsx("button",{className:"btn",disabled:v||!f.trim(),onClick:()=>V(f,30),children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:v,onClick:()=>te(f),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Premium users get 30 days of access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Users who have won premium through tournaments."}),e.jsxs("div",{className:"space-y-2",children:[ne.map(b=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:b.name||"No name"}),e.jsx("div",{className:"opacity-70",children:b.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Expires ",new Date(b.expiresAt).toLocaleDateString()]})]}),e.jsx("div",{className:"flex gap-2",children:b.expired?e.jsx("span",{className:"px-2 py-1 rounded bg-amber-600 text-xs",children:"Premium Expired"}):e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Premium Active"})})]},b.email)),ne.length===0&&e.jsx("div",{className:"opacity-60",children:"No premium winners."})]})]})]}),M==="tourneys"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Create Official Tournament"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Set up a new official tournament with custom rules, timing, and prizes."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"input w-full",placeholder:"Tournament Title",value:j.title,onChange:b=>R(F=>({...F,title:b.target.value}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("select",{className:"input",value:j.game,onChange:b=>R(F=>({...F,game:b.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low"].map(b=>e.jsx("option",{value:b,children:b},b))}),e.jsx("select",{className:"input",value:j.mode,onChange:b=>R(F=>({...F,mode:b.target.value})),children:Bm(j.game).map(b=>e.jsx("option",{value:String(b),children:Fa(String(b))},String(b)))}),(()=>{const b=Vm(j.game,j.mode);return b&&b.length>0?e.jsx("select",{className:"input",value:String(j.value),onChange:F=>R(K=>({...K,value:Number(F.target.value)})),children:b.map(F=>e.jsx("option",{value:String(F),children:F},F))}):e.jsx("input",{className:"input",type:"number",min:1,value:j.value,onChange:F=>R(K=>({...K,value:Number(F.target.value)}))})})()]}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Description",value:j.description,onChange:b=>R(F=>({...F,description:b.target.value}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"input",type:"datetime-local",value:j.startAt,onChange:b=>R(F=>({...F,startAt:b.target.value}))}),e.jsx("input",{className:"input",type:"number",min:0,placeholder:"Checkin minutes",value:j.checkinMinutes,onChange:b=>R(F=>({...F,checkinMinutes:Number(b.target.value)}))})]}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,placeholder:"Capacity",value:j.capacity,onChange:b=>R(F=>({...F,capacity:Number(b.target.value)}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-center",children:[e.jsx("select",{className:"input",value:"premium",disabled:!0,children:e.jsx("option",{value:"premium",children:"PREMIUM"})}),e.jsxs("select",{className:"input",value:j.prizeAmount,onChange:b=>R(F=>({...F,prizeType:"premium",prizeAmount:Number(b.target.value)})),children:[e.jsx("option",{value:1,children:"1 month"}),e.jsx("option",{value:3,children:"3 months"})]})]}),e.jsx("input",{className:"input w-full",placeholder:"Prize notes (optional)",value:j.prizeNotes,onChange:b=>R(F=>({...F,prizeNotes:b.target.value}))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:v,onClick:at,children:"Create Tournament"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Tournament Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Users who have won premium prizes in tournaments. Grant them access here."}),e.jsxs("div",{className:"space-y-2",children:[O.filter(b=>b.status==="completed"&&b.winnerEmail&&b.prizeType==="premium").map(b=>{const F=ne.find(Ye=>Ye.email===b.winnerEmail),K=F&&!F.expired;return e.jsxs("div",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:b.title}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(b.startAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:b.winnerEmail}),e.jsxs("div",{className:"text-xs opacity-70",children:["Prize: ",b.prizeAmount," month",b.prizeAmount>1?"s":""," PREMIUM"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:K?e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"âœ“ Access Granted"}):e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-xs",disabled:v,onClick:()=>V(b.winnerEmail,b.prizeAmount*30),children:"Grant Access"})})]})]},b.id)}),O.filter(b=>b.status==="completed"&&b.winnerEmail&&b.prizeType==="premium").length===0&&e.jsx("div",{className:"text-center py-4 text-sm opacity-60",children:"No completed premium tournaments."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Manage Tournaments"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"View and manage all tournaments. Set winners and manage brackets."}),e.jsxs("ul",{className:"space-y-2",children:[O.map(b=>e.jsxs("li",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:b.title}),e.jsxs("div",{className:"opacity-80",children:[b.game," Â· ",Fa(b.mode)," ",b.value]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-semibold ${b.status==="scheduled"?"bg-blue-600":b.status==="running"?"bg-green-600":b.status==="completed"?"bg-purple-600":"bg-gray-600"}`,children:b.status})]}),e.jsxs("div",{className:"text-xs opacity-70 mb-2",children:["Start: ",new Date(b.startAt).toLocaleString()," Â· Capacity:"," ",b.capacity]}),b.prize&&e.jsxs("div",{className:"text-xs mb-2",children:["Prize: ",b.prizeAmount||3," month",(b.prizeAmount||3)>1?"s":""," PREMIUM"]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn text-xs",disabled:v||b.status!=="scheduled",onClick:()=>Pt(b.id,prompt("Winner email?")||""),children:"Set Winner"}),e.jsx("button",{className:"btn text-xs",disabled:v,onClick:()=>gn(),children:"Reseed"})]})]},b.id)),O.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]})]}),M==="helpdesk"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Helpdesk Requests"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"All help requests from users who asked to speak with an admin. Status is shown for each request."}),ie.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No help requests."}):e.jsx("div",{className:"space-y-2",children:ie.map(b=>e.jsxs("div",{className:"p-2 rounded bg-black/10 border border-white/10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:b.username||"Anonymous"}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(b.ts||0).toLocaleString()}),e.jsx("div",{className:"text-sm mt-1",children:b.message}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full mr-2 ${b.status==="open"?"bg-emerald-700/30 text-emerald-200":b.status==="claimed"?"bg-amber-700/30 text-amber-200":"bg-slate-700/30 text-slate-200"}`,children:b.status||"unknown"}),b.claimedBy&&e.jsxs("span",{className:"text-xs opacity-70",children:["by ",b.claimedBy]})]}),Ne[b.id]&&e.jsxs("div",{className:"text-xs text-amber-300 mt-1",children:[Ne[b.id].who," typing..."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b.status==="open"&&e.jsx("button",{className:"btn",onClick:()=>Nt(b.id),children:"Claim"}),b.status!=="resolved"&&e.jsx("button",{className:"btn btn-ghost",onClick:()=>X(b.id),children:"Resolve"}),e.jsx("button",{className:"btn",onClick:()=>ae(b),children:"Chat"}),e.jsx("button",{className:"btn bg-red-600/80 hover:bg-red-700 text-white text-xs",onClick:()=>fe(b.id),children:"Delete"})]})]},b.id))})]})}),ke&&e.jsx(ic,{request:ke,user:{email:t?.email,username:t?.username,isAdmin:!0},onClose:()=>ae(null)})]})}const lc=i.createContext(null),$a="ndn:theme",Or="ndn:colorMode";function Pi(t=new Date){const n=t.getMonth(),s=t.getDate();return n===9||n===10&&s<=5?"halloween":n===11||n===0||n===1&&s<=14?"christmas":n===2||n===3?"easter":n>=5&&n<=7?"summer":"default"}function ah({children:t}){const[n,s]=i.useState(()=>{try{const h=localStorage.getItem(`${$a}:auto`);return h?JSON.parse(h):!0}catch{return!0}}),[a,r]=i.useState(()=>{try{const h=localStorage.getItem($a);if(h)return h}catch{}return Pi()}),[o,l]=i.useState(()=>{try{const h=localStorage.getItem(Or);if(h==="dark"||h==="light"||h==="system")return h}catch{}return"system"});i.useEffect(()=>{try{localStorage.setItem(Or,o)}catch{}},[o]),i.useEffect(()=>{const h=S=>{try{document.documentElement.setAttribute("data-color-mode",S)}catch{}};if(o==="dark"){h("dark");return}if(o==="light"){h("light");return}const x=typeof window<"u"?window.matchMedia?.("(prefers-color-scheme: dark)"):null,f=()=>h(x?.matches?"dark":"light");f();try{x?.addEventListener?.("change",f)}catch{}return()=>{try{x?.removeEventListener?.("change",f)}catch{}}},[o]),i.useEffect(()=>{try{localStorage.setItem(`${$a}:auto`,JSON.stringify(n))}catch{}},[n]),i.useEffect(()=>{const h=n?Pi():a;try{h==="default"?document.documentElement.removeAttribute("data-theme"):document.documentElement.setAttribute("data-theme",h)}catch{}},[a,n]);const m=h=>{try{localStorage.setItem($a,h)}catch{}r(h)},d=h=>{try{localStorage.setItem(Or,h)}catch{}l(h)},u=i.useMemo(()=>({theme:a,setTheme:m,auto:n,setAuto:s,colorMode:o,setColorMode:d}),[a,n,o]);return e.jsx(lc.Provider,{value:u,children:t})}function rh(){const t=i.useContext(lc);if(!t)throw new Error("useTheme must be used inside ThemeProvider");return t}const oh=["default","halloween","easter","summer","christmas"],ih={default:{icon:"ðŸŽ¯",label:"Default",gradient:"from-slate-600 to-slate-800",ring:"ring-slate-400"},christmas:{icon:"ðŸŽ„",label:"Christmas",gradient:"from-red-600 to-green-700",ring:"ring-red-400"},easter:{icon:"ðŸ£",label:"Easter",gradient:"from-pink-400 to-purple-400",ring:"ring-pink-300"},halloween:{icon:"ðŸŽƒ",label:"Halloween",gradient:"from-orange-500 to-purple-800",ring:"ring-orange-400"},summer:{icon:"â˜€ï¸",label:"Summer",gradient:"from-yellow-400 to-sky-400",ring:"ring-yellow-300"}};function _i(){const{theme:t,setTheme:n,auto:s,setAuto:a,colorMode:r,setColorMode:o}=rh();return e.jsxs("div",{className:"theme-toggle space-y-4",role:"group","aria-label":"Theme selector",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Color mode"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"system",label:"System"},{key:"dark",label:"Dark"},{key:"light",label:"Light"}].map(l=>e.jsx("button",{type:"button","aria-pressed":r===l.key,onClick:()=>o(l.key),className:`btn btn--ghost px-3 py-1 text-sm ${r===l.key?"ring-2 ring-indigo-400/70 bg-white/10":"bg-white/5"}`,children:l.label},l.key))})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer select-none",children:[e.jsx("div",{onClick:()=>a(!s),className:`relative w-11 h-6 rounded-full transition-colors ${s?"bg-gradient-to-r from-cyan-500 to-blue-500":"bg-white/20"}`,children:e.jsx("span",{className:`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform ${s?"translate-x-5":""}`})}),e.jsx("span",{className:"text-sm font-medium",children:"Auto seasonal theme ðŸŽ¯"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:oh.map(l=>{const m=ih[l],d=t===l;return e.jsxs("button",{onClick:()=>n(l),disabled:s,"aria-pressed":d,title:`Set ${m.label} theme`,className:`
                relative flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold
                transition-all duration-200 shadow-md
                ${s?"opacity-50 cursor-not-allowed":"hover:scale-105 active:scale-95"}
                ${d?`bg-gradient-to-r ${m.gradient} text-white ring-2 ${m.ring} ring-offset-2 ring-offset-black/50`:"bg-white/10 text-white/80 hover:bg-white/20"}
              `,children:[e.jsx("span",{className:"text-lg",children:m.icon}),e.jsxs("span",{children:[m.label," ðŸŽ¯"]}),d&&e.jsx("span",{className:"ml-1 w-2 h-2 rounded-full bg-white animate-pulse"})]},l)})})]})}function Fi(t){const n=t.name.toLowerCase();let s=0;return n.includes("online (natural)")||n.includes("neural")?s+=100:n.includes("natural")&&(s+=80),n.includes("google")&&(s+=40),n.includes("microsoft")&&!n.includes("david")&&!n.includes("zira")&&!n.includes("mark")&&(s+=30),(n.includes("premium")||n.includes("enhanced"))&&(s+=60),(n.includes("ryan")||n.includes("guy")||n.includes("thomas")||n.includes("ralf")||n.includes("george")||n.includes("male"))&&(s+=15),t.lang==="en-GB"||t.lang.startsWith("en-GB")?s+=25:t.lang.startsWith("en")&&(s+=10),t.localService||(s+=20),s}function $i(){try{const t=window.speechSynthesis;return t?t.getVoices().filter(a=>a.lang.startsWith("en")).sort((a,r)=>Fi(r)-Fi(a)):[]}catch{return[]}}function lh(t){const n=t.name.toLowerCase();return n.includes("online (natural)")||n.includes("neural")?"â˜…â˜…â˜… Neural":n.includes("natural")||n.includes("premium")||n.includes("enhanced")?"â˜…â˜… Natural":n.includes("google")?"â˜…â˜… Google":n.includes("microsoft")&&!n.includes("david")&&!n.includes("zira")?"â˜… Microsoft":t.localService?"":"â˜… Cloud"}const ch=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function dh(t){return t==="DB"?50:Number(t.slice(1))*2}function uh(t){return ch.includes(t)?dh(t):32}function cc(t,n="D16"){if(t>170||t<=1)return[];const s={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(s[t])return s[t];const a=uh(n),r=[];for(const o of[60,57,54,51,48])if(t-o===a){r.push(`T${o/3} ${n}`);break}if(!r.length){for(const o of[20,19,18,17,16,15])if(t-o===a){r.push(`${o} ${n}`);break}}return r}function dc(t,n,s,a,r){try{const o=window.speechSynthesis;if(!o)return;const l=new SpeechSynthesisUtterance,d=t?.toString().replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g," ").trim()||t||"Player",u=s<=170&&s>0,h=n===180;if(!(!r?.checkoutOnly||u||h))return;const f=r?.style||"professional",S=w=>w[Math.floor(Math.random()*w.length)];if(h){const w={professional:[`${d}... One hundred... and eighty!`,`One hundred and eighty! ${d}!`,`${d}, with a maximum! One hundred and eighty!`,`It's a maximum! ${d}, one hundred and eighty!`,`The maximum! One hundred and eighty for ${d}!`],energetic:[`ONE HUNDRED AND EIGHTY! ${d}!`,`${d}! MAXIMUM! One hundred and eighty!`,`What a visit! ${d} with a maximum! ONE EIGHTY!`,`BOOM! One hundred and eighty for ${d}!`,`${d} smashes in the maximum! One hundred and eighty!`],classic:[`${d}. One hundred and eighty.`,`One hundred and eighty, ${d}.`,`Maximum, ${d}. One eighty.`,`${d} throws the maximum.`]};l.text=S(w[f]),l.rate=f==="energetic"?1:.88,l.pitch=f==="energetic"?1.15:f==="classic"?1:1.08}else if(s===0){const w={professional:[`Game shot! And the match, ${d}!`,`${d} takes it! Game shot!`,`And that's the checkout! ${d} wins!`,`${d} checks out! Game shot and the match!`,`Checkout! ${d} finishes in style!`],energetic:[`GAME SHOT! ${d} takes the match!`,`YES! ${d} checks out! Game shot!`,`What a finish! ${d} wins it!`,`Checkout! ${d} takes the glory!`,`GAME SHOT AND THE MATCH! ${d}!`],classic:[`Game shot, ${d}.`,`${d} checks out. Game shot.`,`And the match goes to ${d}.`,`That's the game. Well played, ${d}.`]};l.text=S(w[f]),l.rate=f==="energetic"?.95:.85,l.pitch=f==="energetic"?1.12:1.02}else if(u){if(s<=40){const w={professional:[`${d}... requires ${s}.`,`${d} needs ${s} to finish.`,`You require ${s}, ${d}.`,`${d}... ${s} for the match.`],energetic:[`${d}! Just ${s} needed!`,`${s} to go for ${d}!`,`${d} is RIGHT there! ${s} remaining!`,`Can ${d} finish on ${s}?`],classic:[`${d}, ${s}.`,`${d} requires ${s}.`,`${s}, ${d}.`]};l.text=S(w[f])}else if(s<=100){const w={professional:[`${d}, you require ${s}.`,`${d} needs ${s}.`,`${s} remaining for ${d}.`,`${d} has ${s} to go.`],energetic:[`${d} is on a finish! ${s}!`,`${s} left for ${d}!`,`In the zone! ${d} needs ${s}!`],classic:[`${d}, you require ${s}.`,`${s}, ${d}.`]};l.text=S(w[f])}else{const w={professional:[`${d} leaves ${s}.`,`${d} is on ${s}.`,`${s} for ${d}.`],energetic:[`${d} leaves ${s}! On a finish!`,`${s} for ${d}! Game on!`],classic:[`${d} leaves ${s}.`,`${s}, ${d}.`]};l.text=S(w[f])}l.rate=f==="energetic"?.95:.88,l.pitch=1}else if(n===0){const w={professional:[`${d}... no score.`,`No score there for ${d}.`,`${d}, unfortunately, no score.`,`${d} blanks.`,`Nothing doing for ${d}. No score.`],energetic:[`${d}... no score!`,`Nothing there for ${d}!`,`${d} goes scoreless!`,`Oh no! No score for ${d}!`],classic:[`${d}, no score.`,`No score, ${d}.`,`${d}. No score.`]};l.text=S(w[f]),l.rate=.88,l.pitch=f==="energetic"?.95:.9}else if(n>=140){const w={professional:[`${d}! ${n}!`,`Lovely darts! ${d} with ${n}!`,`${n}! Great scoring from ${d}!`,`Superb! ${d} fires in ${n}!`,`Big score! ${d}, ${n}!`],energetic:[`${d} FIRES in ${n}!`,`What a visit! ${n} for ${d}!`,`${n}! Brilliant darts from ${d}!`,`HUGE score! ${d} with ${n}!`,`${d} smashes in ${n}!`],classic:[`${d}, ${n}.`,`${n}, ${d}. Lovely darts.`,`${d} scores ${n}.`]};l.text=S(w[f]),l.rate=f==="energetic"?1:.9,l.pitch=f==="energetic"?1.1:1.04}else if(n>=100){const w={professional:[`${d}, ${n}.`,`${n} for ${d}.`,`A ton${n>100?` ${n-100}`:""} for ${d}.`,`${d} scores ${n}.`],energetic:[`Ton${n>100?` ${n-100}`:""}! ${d}!`,`${n} for ${d}! Nice darts!`,`${d} with a ton${n>100?` ${n-100}`:""}!`],classic:[`${d}, ${n}.`,`${n}, ${d}.`]};l.text=S(w[f]),l.rate=.92,l.pitch=1}else if(n>=60){const w={professional:[`${d}, ${n}.`,`${n} for ${d}.`,`${d} scores ${n}.`],energetic:[`${d}, ${n}!`,`${n} for ${d}!`],classic:[`${d}, ${n}.`,`${n}, ${d}.`]};l.text=S(w[f]),l.rate=.92,l.pitch=.98}else if(n>=26){const w={professional:[`${d}... ${n}.`,`${n}, ${d}.`],energetic:[`${d}, ${n}.`,`${n} for ${d}.`],classic:[`${d}, ${n}.`]};l.text=S(w[f]),l.rate=.92,l.pitch=.96}else{const w={professional:[`${d}... ${n}.`,`${n} for ${d}.`],energetic:[`${d}, just ${n}.`,`Only ${n} there for ${d}.`],classic:[`${d}, ${n}.`]};l.text=S(w[f]),l.rate=.9,l.pitch=.94}const k=()=>{if(a){const w=o.getVoices(),v=w.find(g=>g.name===a);if(v)l.voice=v;else{const g=w.find(O=>O.lang.startsWith("en"));g&&(l.voice=g)}}typeof r?.volume=="number"?l.volume=Math.max(0,Math.min(1,r.volume)):l.volume=1;try{o.cancel()}catch{}o.speak(l)};o.getVoices().length>0?k():(o.addEventListener("voiceschanged",()=>{k()},{once:!0}),setTimeout(k,100))}catch{}}function mh({user:t}){const{favoriteDouble:n,callerEnabled:s,callerVoice:a,callerVolume:r,callerStyle:o,speakCheckoutOnly:l,avgMode:m,autoStartOffline:d,rememberLastOffline:u,reducedMotion:h,compactHeader:x,allowSpectate:f,cameraScale:S,cameraAspect:k,cameraFitMode:p,autoscoreProvider:w,autoscoreWsUrl:v,autoCommitMode:g,confirmUncertainDarts:O,autoScoreConfidenceThreshold:E,autoscoreDetectorMinArea:L,autoscoreDetectorThresh:A,autoscoreDetectorRequireStableN:P,harshLightingMode:D,enhanceBigTrebles:j,cameraRecordDarts:R,cameraShowLabels:M,calibrationGuide:$,preferredCameraId:W,preferredCameraLabel:Y,cameraEnabled:ne,offlineLayout:xe,textSize:ie,boxSize:je,setFavoriteDouble:Ne,setCallerEnabled:he,setCallerVoice:ke,setCallerStyle:ae,setCallerVolume:ve,setSpeakCheckoutOnly:ye,setAvgMode:Te,setAutoStartOffline:Ie,setRememberLastOffline:Ge,setReducedMotion:Xe,setCompactHeader:Qe,setAllowSpectate:tt,setCameraScale:dt,setCameraAspect:Oe,setCameraFitMode:$e,setAutoscoreProvider:B,setAutoscoreWsUrl:z,setAutoCommitMode:Ce,setConfirmUncertainDarts:se,setAutoScoreConfidenceThreshold:ee,setAutoscoreDetectorMinArea:be,setAutoscoreDetectorThresh:ht,setAutoscoreDetectorRequireStableN:Re,setHarshLightingMode:C,setEnhanceBigTrebles:_,setCameraRecordDarts:V,setCameraShowLabels:te,cameraLowLatency:de,setCameraLowLatency:ut,cameraProcessingFps:Nt,setCameraProcessingFps:X,setCalibrationGuide:fe,preserveCalibrationOverlay:pe,setPreserveCalibrationOverlay:Ue,preserveCalibrationOnCameraChange:qe,setPreserveCalibrationOnCameraChange:Je,setPreferredCamera:it,setCameraEnabled:at,setOfflineLayout:Pt,setTextSize:mt,setBoxSize:gn,dartTimerEnabled:Zt,dartTimerSeconds:bn,setDartTimerEnabled:Tt,setDartTimerSeconds:Ze,x01DoubleIn:we,setX01DoubleIn:b}=J(),[F,K]=i.useState([{key:"first180",label:"First 180",unlocked:!1,icon:"ðŸ”¥",desc:"Score 180 in a match."},{key:"hundredGames",label:"100 Games Played",unlocked:!1,icon:"ðŸ†",desc:"Play 100 games."},{key:"tournamentWin",label:"Tournament Winner",unlocked:!1,icon:"ðŸ¥‡",desc:"Win a tournament."},{key:"bestLeg",label:"Best Leg",unlocked:!1,icon:"âš¡",desc:"Finish a leg in 12 darts or less."},{key:"comeback",label:"Comeback",unlocked:!1,icon:"ðŸ”¥",desc:"Win after trailing by 3 legs."}]);i.useEffect(()=>{const N=t?.username||"";N&&K(re=>re.map(Le=>({...Le,unlocked:!!localStorage.getItem(`ndn:achieve:${Le.key}:${N}`)})))},[t?.username]),i.useEffect(()=>{function N(){try{sr("user")}catch{}}return window.addEventListener("ndn:open-settings-profile",N),()=>window.removeEventListener("ndn:open-settings-profile",N)},[]);const[Ye,rt]=i.useState(!1),[It,en]=i.useState(""),[Vn,Be]=i.useState(""),[Hn,tn]=i.useState(""),[as,pa]=i.useState(""),[rs,Ls]=i.useState(""),[os,tr]=i.useState(!0),[_t,zt]=i.useState(null),[ga,is]=i.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[Rt,Gt]=i.useState("");i.useEffect(()=>{const N=t?.username||"";if(N)try{en(localStorage.getItem(`ndn:bio:favPlayer:${N}`)||""),Be(localStorage.getItem(`ndn:bio:favTeam:${N}`)||""),tn(localStorage.getItem(`ndn:bio:favDarts:${N}`)||""),pa(localStorage.getItem(`ndn:bio:bio:${N}`)||""),Ls(localStorage.getItem(`ndn:bio:profilePhoto:${N}`)||""),tr(localStorage.getItem(`ndn:settings:allowAnalytics:${N}`)!=="false")}catch{}},[t?.username]),i.useEffect(()=>{t?.email&&De(`/api/subscription?email=${encodeURIComponent(t.email)}`).then(N=>N.json()).then(zt).catch(()=>{})},[t?.email]);const ba=()=>{const N=t?.username||"";if(N)try{localStorage.setItem(`ndn:bio:favPlayer:${N}`,It),localStorage.setItem(`ndn:bio:favTeam:${N}`,Vn),localStorage.setItem(`ndn:bio:favDarts:${N}`,Hn),localStorage.setItem(`ndn:bio:bio:${N}`,as),localStorage.setItem(`ndn:bio:profilePhoto:${N}`,rs);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:N,avatar:rs}}))}catch{}localStorage.setItem(`ndn:settings:allowAnalytics:${N}`,os.toString()),rt(!1)}catch{}},nn={"how to play":"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",camera:"Go to Settings > Camera & Vision > Camera Guide to set up your camera properly.",calibration:"Go to Settings > Camera & Vision > Camera Guide to set up your camera properly.",premium:'Premium unlocks all game modes. Click the "Upgrade to PREMIUM" button in online play.',username:"Change your username once for free in Settings > Account.",voice:"Enable voice caller in Settings > Audio & Voice. Test the voice with the Test Voice button.",friends:"Add friends in the Friends tab to play together.",stats:"View your statistics in the Stats tab.",settings:"Customize your experience in the Settings panel.",support:"Contact support via email or check the FAQ in Settings > Support."},xa=N=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:N}}))}catch(re){console.error("Navigation failed:",re)}},nr=N=>{const re=N.toLowerCase();if(re.includes("username")||re.includes("change name"))return{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]};if(re.includes("premium")||re.includes("upgrade")||re.includes("subscription"))return{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]};if(re.includes("calibrat")||re.includes("camera")||re.includes("vision"))return{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]};if(re.includes("voice")||re.includes("caller")||re.includes("audio"))return{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]};if(re.includes("friend")||re.includes("play together"))return{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]};if(re.includes("stat")||re.includes("score")||re.includes("performance"))return{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]};if(re.includes("setting")||re.includes("customiz")||re.includes("configur"))return{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]};if(re.includes("tournament")||re.includes("competition"))return{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]};if(re.includes("help")||re.includes("support")||re.includes("faq"))return{text:"You're already in the help section! Check the Support section above for more resources.",links:[{text:"Scroll to Support",tab:"settings"}]};if(re.includes("how to play")||re.includes("game")||re.includes("start"))return{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]};const Le=Object.entries(nn).find(([xt])=>re.includes(xt.toLowerCase()));return Le?{text:Le[1],links:[{text:"Open FAQ",tab:"settings"}]}:{text:"I'm not sure about that. Try asking about playing, camera setup, premium, username changes, voice settings, friends, stats, or settings."}},wn=()=>{if(!Rt.trim())return;const N=Rt.toLowerCase();is(Le=>[...Le,{text:Rt,isUser:!0}]),Gt("");const re=nr(N);setTimeout(()=>{is(Le=>[...Le,{text:re,isUser:!1}])},500)},[xn,Ve]=i.useState(""),[ft,ot]=i.useState(!1),[Ft,pt]=i.useState(""),[Me,bt]=i.useState([]);i.useEffect(()=>{const N=()=>{bt($i())};N(),speechSynthesis.onvoiceschanged=N},[]);const[Eo,ls]=i.useState(!1),[Ps,sr]=i.useState(null),vn=({label:N,icon:re,pill:Le,color:xt})=>e.jsxs("button",{onPointerDown:lt=>{lt.stopPropagation()},onMouseDown:lt=>{lt.stopPropagation()},onTouchStart:lt=>{lt.stopPropagation?.()},onClick:()=>sr(lt=>lt===Le?null:Le),type:"button","data-testid":`pill-button-${Le}`,className:`select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] bg-gradient-to-r ${xt} text-white flex items-center gap-2`,children:[e.jsx(re,{className:"w-4 h-4"})," ",N,e.jsx(hd,{className:`w-4 h-4 transition-transform ${Ps===Le?"rotate-180":""}`})]});return e.jsxs("div",{className:"space-y-6 ndn-page",children:[e.jsxs("div",{className:"rounded-[28px] border border-white/10 bg-gradient-to-br from-slate-950/70 via-indigo-950/30 to-slate-950/60 p-5 shadow-2xl space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.35em] text-slate-400",children:"Preferences"}),e.jsx("h2",{className:"mt-1 text-2xl font-extrabold text-white",children:"Settings"}),e.jsx("div",{className:"mt-1 text-sm text-slate-300/80",children:"Tune your camera, scoring, and app experience."})]}),e.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-3",children:e.jsx(_i,{})})]}),e.jsx("div",{className:"relative rounded-[22px] bg-gradient-to-br from-white/[0.08] to-white/[0.03] backdrop-blur-md border border-white/10 p-2 shadow-xl",children:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:[e.jsx(vn,{label:"User Info ðŸ‘¤",icon:Ga,pill:"user",color:"from-indigo-600 to-indigo-500"}),e.jsx(vn,{label:"Camera Setup ðŸ“",icon:oa,pill:"calibration",color:"from-emerald-600 to-emerald-500"}),e.jsx(vn,{label:"App Settings âš™ï¸",icon:ra,pill:"settings",color:"from-purple-600 to-purple-500"})]})}),null,Ps==="user"&&e.jsx("div",{"data-testid":"pill-user-content",className:"p-5 sm:p-6 rounded-[28px] border border-white/10 bg-slate-950/50 shadow-2xl space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-red-100",children:[e.jsx(Ga,{className:"w-5 h-5"})," Account ðŸ‘¤"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:logout")),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Logout ðŸšª"}),e.jsx("button",{onClick:()=>ls(!0),className:"px-4 py-2 bg-slate-700 hover:bg-slate-800 text-white rounded-lg font-medium transition-colors",children:"Highlights âœ¨"})]}),e.jsxs("div",{className:"border-t border-red-500/20 pt-3",children:[e.jsxs("div",{className:"font-medium mb-2 text-red-100",children:["Change Username âœï¸ (",(()=>{const N=t?.usernameChangeCount||0;return N<2?`${2-N} free changes remaining`:"Â£2 per change"})(),")"]}),e.jsx("div",{className:"text-sm text-red-100 mb-2",children:"You can change your username up to 2 times for free. Additional changes cost Â£2 each."}),t?.usernameChangeCount>=2&&!xn.trim()?e.jsx("div",{className:"text-amber-400 text-sm mb-2",children:"âš ï¸ Additional username changes cost Â£2"}):null,e.jsx("input",{className:"input w-full mb-2",type:"text",placeholder:"New username",value:xn,onChange:N=>Ve(N.target.value),disabled:ft}),Ft&&e.jsx("div",{className:"text-red-400 text-sm mb-2",children:Ft}),e.jsx("button",{onClick:async()=>{if(pt(""),!xn.trim()){pt("Username required");return}if(xn.length<3||xn.length>20){pt("Username must be 3-20 characters");return}(t?.usernameChangeCount||0)<2?(localStorage.setItem("pendingUsernameChange",xn.trim()),window.location.href="/?username-change=free"):window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02"},disabled:ft||!xn.trim(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:ft?"Processing...":(t?.usernameChangeCount||0)<2?"Change Username (FREE) âœï¸":"Change Username (Â£2) âœï¸"})]})]})]})}),_t&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-green-100",children:[e.jsx(Xs,{className:"w-5 h-5"})," Premium âœ¨"]}),e.jsxs("div",{className:"space-y-3 text-sm text-green-100",children:[e.jsxs("div",{children:["Status:"," ",e.jsx("span",{className:_t?.status==="active"?"text-green-400":"text-yellow-400",children:_t?.status==="active"?"âœ“ Active âœ…":"Not Active"})]}),_t?.status==="active"&&_t?.nextBillingDate&&e.jsxs("div",{children:["Next Billing:"," ",new Date(_t.nextBillingDate).toLocaleDateString()]}),_t?.source==="tournament"&&_t?.status==="active"&&e.jsx("button",{onClick:()=>window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02",className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-medium transition-colors text-xs",children:"Cancel Subscription âŒ"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-cyan-100",children:[e.jsx(Ur,{className:"w-5 h-5"})," Profile Photo ðŸ–¼ï¸"]}),e.jsx("input",{type:"file",accept:"image/*",onChange:N=>{const re=N.target.files?.[0];if(re){const Le=new FileReader;Le.onload=()=>Ls(Le.result),Le.readAsDataURL(re)}},className:"w-full text-xs text-slate-100"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-purple-100",children:[e.jsx(hn,{className:"w-5 h-5"})," Online & Socials ï¿½"]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowSpectate",checked:f,onChange:N=>tt(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowSpectate",className:"text-sm text-purple-100",children:"Allow spectators ðŸ‘ï¸"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-orange-500/40 bg-orange-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-orange-100",children:[e.jsx(Xs,{className:"w-5 h-5"})," Data & Privacy ðŸ›¡ï¸"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowAnalytics",checked:os,onChange:N=>tr(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowAnalytics",className:"text-sm text-orange-100",children:"Allow analytics ðŸ“Š"})]}),e.jsx("button",{onClick:()=>{const N={achievements:F,bio:{favPlayer:It,favTeam:Vn,favDarts:Hn,bio:as}},re=new Blob([JSON.stringify(N,null,2)],{type:"application/json"}),Le=URL.createObjectURL(re),xt=document.createElement("a");xt.href=Le,xt.download=`my-data-${new Date().toISOString().split("T")[0]}.json`,xt.click(),URL.revokeObjectURL(Le)},className:"btn bg-orange-600 hover:bg-orange-700 w-full",children:"Export My Data ðŸ“¥"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Xs,{className:"w-5 h-5 text-red-400"})," Privacy & Copyright ðŸ›¡ï¸"]}),e.jsx("div",{className:"space-y-3 text-sm text-slate-300",children:e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-red-300 mb-2",children:"âš ï¸ Legal Notice âš–ï¸"}),e.jsxs("p",{className:"mb-2 text-xs",children:[e.jsx("strong",{children:"Copyright:"})," All content is protected by copyright law. ðŸ“œ"]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Privacy:"})," Your data is protected and unauthorized access is prohibited. ðŸ”’"]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-yellow-100",children:[e.jsx(Xs,{className:"w-5 h-5"})," Blocked Users"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-yellow-100",children:"Manage players you've blocked from contacting you."}),e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:open-blocklist")),className:"btn bg-yellow-600 hover:bg-yellow-700 w-full text-sm",children:"View Blocked Users ðŸš«"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-blue-100",children:[e.jsx(hn,{className:"w-5 h-5"})," Contact & Support"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"ðŸ“§ Email Support"}),e.jsx("a",{href:"https://ninedartnation.com/help",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"â“ Help Center"}),e.jsx("a",{href:"https://ninedartnation.com/faq",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"ðŸ“‹ FAQ"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-red-100",children:[e.jsx(Xs,{className:"w-5 h-5"})," Delete Account"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3 text-xs text-red-200",children:[e.jsx("p",{className:"font-semibold mb-1",children:"âš ï¸ Warning"}),e.jsx("p",{children:"Deleting your account is permanent and cannot be undone. All your stats, achievements, and data will be erased."})]}),e.jsx("button",{onClick:()=>{window.confirm(`Are you absolutely sure you want to delete your account? This action cannot be undone.

All your stats, achievements, and data will be permanently erased.`)&&window.confirm("This is your final warning. Click OK to permanently delete your account.")&&window.dispatchEvent(new CustomEvent("ndn:delete-account"))},className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Permanently Delete Account ðŸ—‘ï¸"})]})]})})]})}),e.jsx("div",{className:"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx(vn,{label:"Camera Setup",icon:oa,pill:"calibration",color:"from-purple-500 to-pink-500 shadow-purple-500/30"})})}),Ps==="calibration"&&e.jsx("div",{"data-testid":"pill-calibration-content",className:"p-6 rounded-2xl border border-white/10 bg-white/[0.02] space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(oa,{className:"w-5 h-5 text-blue-400"})," Camera & Vision"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled",checked:ne,onChange:N=>at(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraEnabled",className:"text-sm",children:"Enable camera"})]}),ne&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pt-2 border-t border-white/10",children:[e.jsx("div",{className:"font-semibold mb-2 text-sm",children:"Lighting"}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraRecordDarts",checked:!!R,onChange:N=>V(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraRecordDarts",className:"text-sm",children:"Save detection thumbnails (no continuous video)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraShowLabels",checked:!!M,onChange:N=>te(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraShowLabels",className:"text-sm",children:"Show segment labels (e.g., T20)"})]})]}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"When enabled, small thumbnails of detections and commits are saved for review. This does not record continuous video or audio."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"harshLightingMode",checked:!!D,onChange:N=>C(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"harshLightingMode",className:"text-sm",children:"Reduce glare (ring lights / harsh lighting)"})]}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Applies highlight compression for better dart detection and slightly dims the preview."}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"enhanceBigTrebles",checked:!!j,onChange:N=>_(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"enhanceBigTrebles",className:"text-sm",children:"Enhance big trebles (T20/T19/T18)"})]}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Visual aid only. Briefly enlarges/highlights the treble segment when detected."})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"cameraScale",className:"block text-sm mb-2",children:["Scale: ",S?.toFixed(2)]}),e.jsx("input",{type:"range",id:"cameraScale",min:"0.5",max:"3",step:"0.1",value:S||1,onChange:N=>dt(parseFloat(N.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraLowLatency",checked:!!de,onChange:N=>ut(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraLowLatency",className:"text-sm",children:"Low-latency camera (prefer 720p & lower CPU)"})]}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Reduces preview resolution and throttles detection to improve responsiveness on slower devices."}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-sm block mb-1",children:"Detection FPS"}),e.jsxs("select",{value:Nt,onChange:N=>X(Number(N.target.value)),className:"input w-full",children:[e.jsx("option",{value:10,children:"10 fps (very low)"}),e.jsx("option",{value:15,children:"15 fps (balanced)"}),e.jsx("option",{value:20,children:"20 fps (smooth)"}),e.jsx("option",{value:30,children:"30 fps (high)"})]}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Lower FPS reduces CPU usage and improves stability on laggy feeds."})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cameraAspect",className:"block text-sm mb-2",children:"Aspect Ratio"}),e.jsxs("select",{onPointerDown:N=>{N.stopPropagation()},onMouseDown:N=>{N.stopPropagation()},onTouchStart:N=>{N.stopPropagation?.()},id:"cameraAspect",value:k||"wide",onChange:N=>Oe(N.target.value),className:"input w-full",children:[e.jsx("option",{value:"wide",children:"Wide (16:9)"}),e.jsx("option",{value:"square",children:"Square (1:1)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cameraFitMode",className:"block text-sm mb-2",children:"Fit Mode"}),e.jsxs("select",{onPointerDown:N=>{N.stopPropagation()},onMouseDown:N=>{N.stopPropagation()},onTouchStart:N=>{N.stopPropagation?.()},id:"cameraFitMode",value:p||"fit",onChange:N=>$e(N.target.value),className:"input w-full",children:[e.jsx("option",{value:"fill",children:"Fill (crop)"}),e.jsx("option",{value:"fit",children:"Fit (letterbox)"})]})]}),e.jsx("button",{onClick:()=>{},className:"btn bg-indigo-600 hover:bg-indigo-700 w-full",children:"Calibration Guide ðŸ“–"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"autoscoreProvider",className:"block text-sm mb-2",children:"Auto-score Provider"}),e.jsxs("select",{onPointerDown:N=>{N.stopPropagation()},onMouseDown:N=>{N.stopPropagation()},onTouchStart:N=>{N.stopPropagation?.()},id:"autoscoreProvider",value:w||"manual",onChange:N=>B(N.target.value),className:"input w-full",children:[e.jsx("option",{value:"manual",children:"Manual Scoring"}),e.jsx("option",{value:"external-ws",children:"External (WebSocket)"})]})]}),w==="external-ws"&&e.jsx("input",{type:"text",placeholder:"WebSocket URL",value:v||"",onChange:N=>z(N.target.value),className:"input w-full text-xs"}),w!=="manual"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"autoCommitMode",className:"block text-sm mb-2",children:"Turn Advance"}),e.jsxs("select",{onPointerDown:N=>{N.stopPropagation()},onMouseDown:N=>{N.stopPropagation()},onTouchStart:N=>{N.stopPropagation?.()},id:"autoCommitMode",value:g||"wait-for-clear",onChange:N=>Ce(N.target.value),className:"input w-full",children:[e.jsx("option",{value:"wait-for-clear",children:"Wait for darts to be removed"}),e.jsx("option",{value:"immediate",children:"Advance immediately after 3 darts/bust"})]}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Waiting prevents the turn from rotating until you clear the board (or 6.5s pass)."})]}),w!=="manual"&&e.jsxs("div",{className:"pt-2 border-t border-white/10",children:[e.jsx("div",{className:"font-semibold mb-2 text-sm",children:"Auto-score quality"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"confirmUncertainDarts",checked:O??!0,onChange:N=>se(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"confirmUncertainDarts",className:"text-sm",children:"Confirm uncertain darts"})]}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"If the system isnâ€™t confident enough, itâ€™ll pause and ask you to accept/reject (Omni/Scolia-style)."}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"autoScoreConfidenceThreshold",className:"block text-sm mb-2",children:["Confidence threshold:"," ",(E??.85).toFixed(2)]}),e.jsx("input",{type:"range",id:"autoScoreConfidenceThreshold",min:"0.5",max:"0.99",step:"0.01",value:E??.85,onChange:N=>ee(parseFloat(N.target.value)),className:"w-full"}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Higher = fewer confirmations, but higher risk of accepting a wrong hit."})]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm cursor-pointer select-none opacity-90",children:"Advanced detector tuning"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-2",children:["Min blob area:"," ",L??30]}),e.jsx("input",{type:"range",min:"5",max:"200",step:"1",value:L??30,onChange:N=>be(parseInt(N.target.value,10)),className:"w-full"}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Lower = more sensitive (can increase false positives)."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-2",children:["Foreground threshold:"," ",A??15]}),e.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:A??15,onChange:N=>ht(parseInt(N.target.value,10)),className:"w-full"}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Lower = more motion counts as a dart."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-2",children:["Stable frames required:"," ",P??2]}),e.jsx("input",{type:"range",min:"1",max:"6",step:"1",value:P??2,onChange:N=>Re(parseInt(N.target.value,10)),className:"w-full"}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Higher = fewer false triggers, but slower."})]})]})]})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(cd,{className:"w-5 h-5 text-purple-400"})," Audio & Voice"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"callerEnabled",checked:s,onChange:N=>he(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"callerEnabled",className:"text-sm",children:"Enable voice caller"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"callerStyle",className:"block text-sm mb-2",children:"Caller Style"}),e.jsxs("select",{onPointerDown:N=>{N.stopPropagation()},onMouseDown:N=>{N.stopPropagation()},onTouchStart:N=>{N.stopPropagation?.()},id:"callerStyle",value:o||"professional",onChange:N=>ae(N.target.value),className:"input w-full text-xs",children:[e.jsx("option",{value:"professional",children:"ðŸŽ¯ Professional â€” Measured, tension-building"}),e.jsx("option",{value:"energetic",children:"ðŸ”¥ Energetic â€” Exciting, crowd-style"}),e.jsx("option",{value:"classic",children:"ðŸŽ© Classic â€” Understated, traditional"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"callerVoice",className:"block text-sm mb-2",children:"Voice"}),e.jsxs("select",{onPointerDown:N=>{N.stopPropagation()},onMouseDown:N=>{N.stopPropagation()},onTouchStart:N=>{N.stopPropagation?.()},id:"callerVoice",value:a||"",onChange:N=>ke(N.target.value),className:"input w-full text-xs",children:[e.jsx("option",{value:"",children:"Best Available (Auto)"}),Me.map((N,re)=>{const Le=lh(N);return e.jsxs("option",{value:N.voiceURI,children:[Le?`${Le} `:"",N.name]},re)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"callerVolume",className:"block text-sm mb-2",children:["Volume: ",Math.round((r||1)*100),"%"]}),e.jsx("input",{type:"range",id:"callerVolume",min:"0",max:"1",step:"0.1",value:r||1,onChange:N=>ve(parseFloat(N.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"speakCheckoutOnly",checked:l,onChange:N=>ye(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"speakCheckoutOnly",className:"text-sm",children:"Only speak checkout scores"})]}),e.jsx("button",{onClick:()=>{const N={professional:["Player... One hundred... and eighty!","Player, you require 40.","Game shot! And the match, Player!"],energetic:["ONE HUNDRED AND EIGHTY! Player!","Player is RIGHT there! 40 needed!","GAME SHOT! Player takes the match!"],classic:["Player. One hundred and eighty.","Player requires 40.","Game shot, Player."]},re=o||"professional",Le=N[re]||N.professional,xt=Le[Math.floor(Math.random()*Le.length)],lt=new SpeechSynthesisUtterance(xt);if(lt.rate=re==="energetic"?1:re==="classic"?.85:.88,lt.pitch=re==="energetic"?1.1:1,a){const Nn=window.speechSynthesis.getVoices().find(_s=>_s.voiceURI===a);Nn&&(lt.voice=Nn)}else{const Nn=$i();Nn.length>0&&(lt.voice=Nn[0])}lt.volume=r||1,window.speechSynthesis.cancel(),window.speechSynthesis.speak(lt)},className:"btn bg-purple-600 hover:bg-purple-700 w-full text-sm",children:"Test Voice ðŸ”Š"})]})]})]})})]})}),e.jsx("div",{className:"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx(vn,{label:"Settings",icon:ra,pill:"settings",color:"from-cyan-500 to-blue-500 shadow-cyan-500/30"})})}),Ps==="settings"&&e.jsxs("div",{"data-testid":"pill-settings-content",className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Ga,{className:"w-5 h-5 text-brand-400"})," Profile Bio ðŸ‘¤"]}),Ye?e.jsxs("button",{onClick:ba,className:"flex items-center gap-2 px-3 py-1 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400 text-sm transition-colors",children:[e.jsx(ud,{className:"w-4 h-4"})," Save ðŸ’¾"]}):e.jsxs("button",{onClick:()=>rt(!0),className:"flex items-center gap-2 px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400 text-sm transition-colors",children:[e.jsx(dd,{className:"w-4 h-4"})," Edit âœï¸"]})]}),e.jsx("div",{className:"space-y-3",children:Ye?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Player ðŸ‘¤"}),e.jsx("input",{type:"text",value:It,onChange:N=>en(N.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Team ðŸ›¡ï¸"}),e.jsx("input",{type:"text",value:Vn,onChange:N=>Be(N.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Favorite Darts ðŸŽ¯"}),e.jsx("input",{type:"text",value:Hn,onChange:N=>tn(N.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Bio / Quote ðŸ’¬"}),e.jsx("textarea",{value:as,onChange:N=>pa(N.target.value),rows:3,className:"input w-full"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Favorite Player:"," ",e.jsxs("span",{className:"text-brand-300",children:[It||"Not set"," ðŸ‘¤"]})]}),e.jsxs("div",{children:["Favorite Team:"," ",e.jsxs("span",{className:"text-brand-300",children:[Vn||"Not set"," ðŸ›¡ï¸"]})]}),e.jsxs("div",{children:["Favorite Darts:"," ",e.jsxs("span",{className:"text-brand-300",children:[Hn||"Not set"," ðŸŽ¯"]})]}),e.jsxs("div",{children:["Bio:"," ",e.jsxs("span",{className:"text-brand-300",children:[as||"No bio set"," ðŸ’¬"]})]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(md,{className:"w-5 h-5 text-green-400"})," Game Preferences ï¿½"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"dartTimerEnabled",checked:!!Zt,onChange:N=>Tt(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"dartTimerEnabled",className:"text-sm",children:"Enable per-dart throw timer â±ï¸"})]}),Zt&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Time per throw:"," ",bn?Math.round(bn):0,"s"]}),e.jsx("input",{type:"range",min:"3",max:"30",value:bn||10,onChange:N=>Ze(parseInt(N.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"When the timer reaches zero, the dart is recorded as a miss and advances to the next throw."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"favoriteDouble",className:"block text-sm mb-2",children:"Favorite Finish Double"}),e.jsxs("select",{onPointerDown:N=>{N.stopPropagation()},onMouseDown:N=>{N.stopPropagation()},id:"favoriteDouble",value:n,onChange:N=>Ne(N.target.value),className:"input w-full",children:[e.jsx("option",{value:"any",children:"Any Double"}),e.jsx("option",{value:"D20",children:"Double 20"}),e.jsx("option",{value:"D10",children:"Double 10"}),e.jsx("option",{value:"D5",children:"Double 5"}),e.jsx("option",{value:"D1",children:"Double 1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"avgMode",className:"block text-sm mb-2",children:"Average Display Mode"}),e.jsxs("select",{id:"avgMode",value:m,onChange:N=>Te(N.target.value),className:"input w-full",children:[e.jsx("option",{value:"all-time",children:"All Time Average"}),e.jsx("option",{value:"24h",children:"30 Day Average"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"x01DoubleIn",checked:!!we,onChange:N=>b(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"x01DoubleIn",className:"text-sm",children:"Require Double-In for X01"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-pink-500/40 bg-pink-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ur,{className:"w-5 h-5 text-pink-400"})," UI & Accessibility ðŸ‘ï¸"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"autoStartOffline",checked:d,onChange:N=>Ie(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoStartOffline",className:"text-sm",children:"Auto-start offline games ðŸš€"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"rememberLastOffline",checked:u,onChange:N=>Ge(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"rememberLastOffline",className:"text-sm",children:"Remember last offline game settings ðŸ’¾"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"offlineLayout",className:"block text-sm mb-2",children:"Offline Layout"}),e.jsxs("select",{id:"offlineLayout",value:xe||"classic",onChange:N=>Pt(N.target.value),className:"input w-full",children:[e.jsx("option",{value:"classic",children:"Classic Layout"}),e.jsx("option",{value:"modern",children:"Modern Layout"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"reducedMotion",checked:h,onChange:N=>Xe(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"reducedMotion",className:"text-sm",children:"Reduce motion/animations"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"compactHeader",checked:x,onChange:N=>Qe(N.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"compactHeader",className:"text-sm",children:"Compact header"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/30 bg-yellow-500/6",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ra,{className:"w-5 h-5 text-yellow-400"})," Theme ï¿½"]}),e.jsx("div",{children:e.jsx(_i,{})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Br,{className:"w-5 h-5 text-blue-400"})," Support & Help ï¿½"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm opacity-80",children:"Need help? Contact us via email:"}),e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"btn bg-blue-600 hover:bg-blue-700 w-full text-xs",children:"Email Support ðŸ“§"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(hn,{className:"w-5 h-5 text-cyan-400"})," Help Assistant ðŸ¤–"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:ga.map((N,re)=>e.jsx("div",{className:`${N.isUser?"text-right":""}`,children:e.jsx("div",{className:`inline-block max-w-xs px-3 py-2 rounded-lg text-sm ${N.isUser?"bg-indigo-600 text-white":"bg-white/10 text-slate-100"}`,children:typeof N.text=="string"?N.text:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:N.text.text}),N.text.links&&e.jsx("div",{className:"mt-2 space-y-1",children:N.text.links.map((Le,xt)=>e.jsx("button",{onClick:()=>xa(Le.tab),className:"block w-full text-left text-xs px-2 py-1 bg-white/20 hover:bg-white/30 rounded transition",children:Le.text},xt))})]})})},re))}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("input",{type:"text",value:Rt,onChange:N=>Gt(N.target.value),onKeyPress:N=>N.key==="Enter"&&wn(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:wn,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(so,{className:"w-4 h-4"})})]})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Br,{className:"w-5 h-5 text-yellow-400"})," Achievements & Badges ï¿½"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:F.map(N=>e.jsxs("div",{className:`p-3 rounded-lg border ${N.unlocked?"border-yellow-500/40 bg-yellow-500/10":"border-white/10 bg-white/5"}`,title:N.desc,children:[e.jsx("div",{className:"text-lg",children:N.icon}),e.jsx("div",{className:"text-xs font-semibold mt-1",children:N.label}),e.jsx("div",{className:"text-[10px] opacity-70",children:N.unlocked?"âœ“ Unlocked":"Locked"})]},N.key))})]})})]})}function hh({onAuth:t}){const[n,s]=i.useState("signin"),[a,r]=i.useState(""),[o,l]=i.useState(""),[m,d]=i.useState(""),[u,h]=i.useState(""),[x,f]=i.useState(""),[S,k]=i.useState(!1),[p,w]=i.useState(!1),v=Ml(),g=async(D,j={},R=6e4)=>{const M=new AbortController,$=window.setTimeout(()=>M.abort(),R);try{return await fetch(D,{...j,signal:M.signal})}finally{window.clearTimeout($)}};async function O(D){D.preventDefault(),f(""),w(!0);try{Et(()=>import("./Home-1HNIjq6Y.js"),__vite__mapDeps([0,1,2,3])),Et(()=>import("./OnlinePlay.clean-Bt3pIMup.js"),__vite__mapDeps([4,1,2,5,6])),Et(()=>import("./OfflinePlay-CsXnCxeq.js"),__vite__mapDeps([7,1,2,6,8,3])),Et(()=>import("./Scoreboard-BpclTmte.js"),__vite__mapDeps([9,3,1,2,8])),Et(()=>import("./StatsPanel-Dgq91YTp.js"),__vite__mapDeps([10,3,1,2]))}catch{}if(!o||!m){f("Username and password required."),w(!1);return}try{console.time("Auth:signIn roundtrip");const j=await g(`${v}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o.includes("@")?{email:o,password:m}:{username:o,password:m})}),R=await j.json().catch(()=>({}));if(console.timeEnd("Auth:signIn roundtrip"),j.status===429)f("Too many login attempts. Please wait 60 seconds and try again.");else if(j.ok&&R?.user&&R?.token){localStorage.setItem("authToken",R.token);try{const M=(R.user.email||"").toLowerCase(),$=R.user.username||M;localStorage.setItem("ndn:ws-identity",JSON.stringify({username:$,email:M}))}catch{}t(R.user)}else f(R?.error||"Invalid username or password.")}catch(j){console.error("Login error:",j),console.log("Attempting to connect to:",`${v}/api/auth/login`),j?.name==="AbortError"?f(`Login timed out after 60 seconds. Server: ${v}. Please check if your server is running and accessible.`):f(`Network error: ${j?.message||"Unknown error"}. Server: ${v}. Please check your connection and try again.`)}finally{w(!1)}}async function E(D){if(D.preventDefault(),f(""),w(!0),!a||!o||!m){f("Email, username, and password required."),w(!1);return}try{const j=await g(`${v}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,username:o,password:m})}),R=await j.json().catch(()=>({}));j.ok&&R?.user&&R?.token?(localStorage.setItem("authToken",R.token),t(R.user)):f(R?.error||"Signup failed.")}catch(j){j?.name==="AbortError"?f("Signup timed out. Please try again."):f("Network error.")}finally{w(!1)}}const L=async(D,j,R)=>{R("â³ Waking up server...");try{await g(`${v}/api/health`,{method:"GET"},6e4)}catch{}return R("â³ Sending email..."),g(D,j,6e4)};async function A(D){if(D.preventDefault(),f(""),w(!0),!a||!a.includes("@")){f("Enter your email address."),w(!1);return}try{const R=await(await L(`${v}/api/auth/send-reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})},f)).json().catch(()=>({}));if(!R?.ok){const M=R?.error||"";throw M==="EMAIL_SEND_TIMEOUT"?new Error("Email server timed out. Please try again."):M==="EMAIL_NOT_CONFIGURED"?new Error("Email service is not configured on the server."):new Error(R?.error||"Failed to send reset email")}f("âœ… Password reset link sent to your email.")}catch(j){j?.name==="AbortError"?f("Request timed out. The server may be starting up â€” please try again."):f(j?.message||"Failed to send reset email")}finally{w(!1)}}async function P(D){D.preventDefault(),f(""),w(!0);const j=a||(o.includes("@")?o:"");if(!j||!j.includes("@")){f("Enter your email in the username field to retrieve your username."),w(!1);return}try{const M=await(await L(`${v}/api/auth/send-username`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:j})},f)).json().catch(()=>({}));if(!M?.ok){const $=M?.error||"";throw $==="EMAIL_SEND_TIMEOUT"?new Error("Email server timed out. Please try again."):$==="EMAIL_NOT_CONFIGURED"?new Error("Email service is not configured on the server."):new Error(M?.error||"Failed to send username email")}f("âœ… Your username has been emailed to you.")}catch(R){R?.name==="AbortError"?f("Request timed out. The server may be starting up â€” please try again."):f(R?.message||"Failed to send username email")}finally{w(!1)}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-[#0F0C1D] p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-[10%] -left-[10%] w-[40%] h-[40%] bg-indigo-500/10 blur-[120px] rounded-full"}),e.jsx("div",{className:"absolute -bottom-[10%] -right-[10%] w-[40%] h-[40%] bg-purple-500/10 blur-[120px] rounded-full"})]}),e.jsxs("div",{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/40 tracking-tighter mb-2",children:"NINE-DART-NATION ðŸŽ¯"}),e.jsx("p",{className:"text-white/40 font-medium uppercase tracking-[0.3em] text-xs",children:n==="signin"?"Sign In ðŸ”‘":n==="signup"?"Create Account âœ¨":"Reset Password ðŸ”„"})]}),e.jsx("div",{className:"flex items-center justify-center gap-3 mb-6",children:[{key:"signin",label:"Sign In"},{key:"signup",label:"Sign Up"},{key:"reset",label:"Reset"}].map(D=>e.jsx("button",{type:"button",onClick:()=>s(D.key),className:`px-4 py-1.5 rounded-full text-xs font-bold tracking-wide transition-all ${n===D.key?"bg-white text-indigo-600":"bg-white/5 text-white/70 hover:bg-white/10"}`,children:D.label},D.key))}),e.jsx("div",{className:"bg-white/[0.03] border border-white/10 backdrop-blur-xl rounded-[2.5rem] p-8 shadow-2xl",children:e.jsxs("form",{className:"space-y-4",onSubmit:n==="signin"?O:n==="signup"?E:A,children:[(n==="signup"||n==="reset")&&e.jsx("input",{className:"input w-full",type:"email",placeholder:"Email",value:a,onChange:D=>r(D.target.value),autoComplete:"email",required:!0}),n!=="reset"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Username or Email",value:o,onChange:D=>l(D.target.value),autoComplete:"username",required:!0}),n!=="reset"&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input w-full pr-10",type:S?"text":"password",placeholder:"Password",value:m,onChange:D=>d(D.target.value),autoComplete:"current-password",required:!0,onFocus:()=>k(!1),onBlur:()=>k(!1)}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white",tabIndex:-1,onMouseDown:D=>{D.preventDefault(),k(!0)},onMouseUp:D=>{D.preventDefault(),k(!1)},onMouseLeave:()=>k(!1),onTouchStart:D=>{D.preventDefault(),k(!0)},onTouchEnd:D=>{D.preventDefault(),k(!1)},"aria-label":"Toggle password visibility",children:S?e.jsx(fd,{className:"w-5 h-5"}):e.jsx(Ur,{className:"w-5 h-5"})})]}),n==="signup"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Password Reminder (optional)",value:u,onChange:D=>h(D.target.value),autoComplete:"off"}),x&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:x}),e.jsx("button",{type:"submit",disabled:p,className:"w-full py-4 rounded-2xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold shadow-lg shadow-indigo-500/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:hover:scale-100",children:p?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):n==="signin"?"Sign In ðŸ”‘":n==="signup"?"Sign Up âœ¨":"Send Reset Link ðŸ“§"}),n==="signin"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:P,className:"w-full py-2 text-xs font-bold text-white/30 hover:text-white/60 transition-colors",children:"Email me my username ðŸ“§"}),e.jsx("button",{type:"button",onClick:()=>{localStorage.clear(),f("Cache cleared. Please try logging in again.")},className:"w-full py-2 text-xs font-bold text-white/20 hover:text-white/40 transition-colors",children:"Clear cache & retry ðŸ”„"}),e.jsx("button",{type:"button",onClick:async()=>{f(""),w(!0);try{console.log("Testing connection to:",`${v}/api/health`);const D=await g(`${v}/api/health`,{method:"GET"},1e4);D.ok?f(`âœ… Server is reachable at ${v}`):f(`âš ï¸ Server responded with status ${D.status} at ${v}`)}catch(D){f(`âŒ Cannot reach server at ${v}. Error: ${D?.message||"Unknown"}. Please check if your server is running.`)}finally{w(!1)}},className:"w-full py-2 text-xs font-bold text-white/20 hover:text-white/40 transition-colors",children:"Test server connection ðŸ”Œ"})]})]})}),e.jsx("div",{className:"mt-12 grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"p-6 rounded-3xl bg-white/[0.02] border border-white/5",children:[e.jsx("h3",{className:"text-xl font-bold mb-3 text-white/90",children:"What's inside ðŸ“¦"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(Ja,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Online & Friends"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Challenge friends, chat, and join leagues."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(pd,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Deep Stats"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Track 3-dart averages, best legs, and more."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(ks,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Game Modes"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Start with 3 free online games upon signup. After that, PREMIUM is required to play all games."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(gd,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Premium Perks"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Polished UI, upcoming features, and early access."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(hn,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Live Support"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Chat with moderators whenever you need a hand."})]})]})]})]})})]})]})}const Ui=ah,Ds=Bn(t=>({recent:[],totals:{visits:0,darts:0,points:0,finishes:0,busts:0,byMode:{}},calibration:{hasHomography:!1,imageSize:null,lastUpdated:void 0},recordVisit:(n,s,a,r)=>t(o=>{const m={ts:Date.now(),mode:n,darts:s,visitTotal:a,preOpenDarts:r?.preOpenDarts,preRemaining:r?.preRemaining,postRemaining:r?.postRemaining,bust:r?.bust,finish:r?.finish,threeDartAvg:r?.threeDartAvg},d=[...o.recent,m].slice(-50),u={...o.totals};u.visits+=1,u.darts+=s,u.points+=a,m.finish&&(u.finishes+=1),m.bust&&(u.busts+=1);const h=u.byMode[n]||{visits:0,darts:0,points:0};h.visits+=1,h.darts+=s,h.points+=a,u.byMode[n]=h;try{const x=m.finish?"FINISH":m.bust?"BUST":"VISIT",f={mode:n,darts:s,visitTotal:a,preOpenDarts:m.preOpenDarts??0,preRemaining:m.preRemaining,postRemaining:m.postRemaining,threeDartAvg:m.threeDartAvg};Xa(`[Audit:${x}]`,f)}catch{}try{localStorage.setItem("ndn_audit_recent",JSON.stringify(d))}catch{}return{...o,recent:d,totals:u}}),setCalibrationStatus:n=>t(s=>{const a={hasHomography:n.hasHomography??s.calibration.hasHomography,imageSize:n.imageSize===void 0?s.calibration.imageSize:n.imageSize,lastUpdated:Date.now()};try{Xa("[Audit:Calibration]",a)}catch{}return{...s,calibration:a}}),reset:()=>t({recent:[],totals:{visits:0,darts:0,points:0,finishes:0,busts:0,byMode:{}},calibration:{hasHomography:!1,imageSize:null,lastUpdated:void 0}})}));try{typeof window<"u"&&(window.__NDN_AUDIT__={get:()=>Ds.getState(),subscribe:Ds.subscribe,reset:()=>Ds.getState().reset()})}catch{}try{if(typeof window<"u"){const t=localStorage.getItem("ndn_audit_recent");if(t){const n=JSON.parse(t);Array.isArray(n)&&n.length&&Ds.setState(s=>({...s,recent:n.slice(-50)}))}}}catch{}function uc(t){const n=(t.visits||[]).reduce((r,o)=>r+(o.preOpenDarts||0),0),s=Math.max(0,t.dartsThrown-n);return s===0?0:(t.totalScoreStart-t.totalScoreRemaining)/s*3}function fh(t){const n=uc(t),s=t.finished;return{avg:n,isCompleted:s,darts:t.dartsThrown,checkout:t.checkoutScore??0}}function Bi(t){if(t.legs.length===0)return;const n=[];let s,a=t.bestCheckout??0;for(const r of t.legs){if(!r.finished)continue;const o=fh(r);n.push(o.avg),(!s||o.darts<s.darts||o.darts===s.darts&&(r.endTime??0)<s.timestamp)&&(s={darts:o.darts,timestamp:r.endTime??Date.now()}),o.checkout>a&&(a=o.checkout)}n.length&&(t.bestThreeDartAvg=Math.max(...n),t.worstThreeDartAvg=Math.min(...n)),s&&(t.bestNineDart=s),t.bestCheckout=a}const gt=Bn(t=>({roomId:"",matchContext:"",players:[],currentPlayerIdx:0,startingScore:501,inProgress:!1,legsToWin:1,newMatch:(n,s,a="",r="",o=1)=>t(()=>{const l=n.map((m,d)=>({id:`${d}`,name:m,legsWon:0,legs:[]}));return console.debug("[useMatch] newMatch",n,s,a,r,"legsToWin:",o),{players:l,currentPlayerIdx:0,startingScore:s,inProgress:!0,roomId:a,matchContext:r,legsToWin:Math.max(1,o),bestLegThisMatch:void 0}}),addVisit:(n,s,a)=>t(r=>{if(console.debug("[useMatch] addVisit",{score:n,darts:s,inProgress:r.inProgress,currentPlayerIdx:r.currentPlayerIdx,players:r.players.length}),!r.inProgress)return r;const o=r.currentPlayerIdx,l=r.players[o],m=l.legs[l.legs.length-1];let d,u;!m||m.finished?(d={visits:[],totalScoreStart:r.startingScore,totalScoreRemaining:r.startingScore,dartsThrown:0,finished:!1,checkoutScore:null,startTime:Date.now()},u=[...l.legs,d]):(d={...m,visits:[...m.visits]},u=[...l.legs.slice(0,-1),d]);const h=d.totalScoreRemaining,x=Number(a?.visitTotal??n),f=Math.max(0,h-x);d.visits.push({darts:s,score:n,preOpenDarts:a?.preOpenDarts,doubleWindowDarts:a?.doubleWindowDarts,finishedByDouble:a?.finishedByDouble,visitTotal:x,entries:Array.isArray(a?.entries)?a.entries.map(p=>({label:String(p.label??""),value:Number(p.value??0),ring:String(p.ring??"")})):void 0}),d.dartsThrown+=s,d.totalScoreRemaining=f;const S={...l,legs:u};try{const p=n===0&&s>0&&f===h,w=f===0,v={},g=(d.visits||[]).reduce((E,L)=>E+(L.preOpenDarts||0),0),O=Math.max(0,d.dartsThrown-g);if(O>0&&(O%3===0||w)){const E=uc(d);Math.abs((S.currentThreeDartAvg??0)-E)>1e-4&&(S.currentThreeDartAvg=E),v.threeDartAvg=E}Ds.getState().recordVisit("x01-match",s,x,{preOpenDarts:a?.preOpenDarts??0,preRemaining:h,postRemaining:f,...v,bust:p,finish:w})}catch{}try{Ht({type:"visit",score:x,darts:s,playerIdx:r.currentPlayerIdx,ts:Date.now()})}catch{}const k=r.players.map((p,w)=>w===o?S:p);return{...r,players:k}}),undoVisit:()=>t(n=>{const s=n.currentPlayerIdx,a=n.players[s],r=a.legs[a.legs.length-1];if(!r||r.finished||r.visits.length===0)return n;const o=r.visits.slice(0,-1),l=r.visits[r.visits.length-1],m=Number(l.visitTotal??l.score),d={...r,visits:o,dartsThrown:r.dartsThrown-l.darts,totalScoreRemaining:r.totalScoreRemaining+m},u=[...a.legs.slice(0,-1),d],h={...a,legs:u},x=n.players.map((f,S)=>S===s?h:f);return{...n,players:x}}),endLeg:n=>t(s=>{const a=s.currentPlayerIdx,r=s.players[a],o=r.legs[r.legs.length-1];if(!o||o.finished)return s;const l=Date.now(),m={...o,finished:!0,checkoutScore:n,endTime:l},d=[...r.legs.slice(0,-1),m];let u=r.legsWon,h=s.bestLegThisMatch;m.totalScoreRemaining===0&&(u+=1,(!h||m.dartsThrown<h.darts)&&(h={playerId:r.id,darts:m.dartsThrown,timestamp:l}));const x={...r,legs:d,legsWon:u};let f=s.players.map((k,p)=>{if(p===a)return x;const w=k.legs[k.legs.length-1];if(w&&!w.finished){const v={...w,finished:!0,checkoutScore:null,endTime:l};return{...k,legs:[...k.legs.slice(0,-1),v]}}return k});try{Ht({type:"endLeg",checkoutScore:n,playerIdx:s.currentPlayerIdx,ts:Date.now()})}catch{}if(u>=(s.legsToWin||1)){f=f.map(k=>{const p={...k,currentThreeDartAvg:0};return Bi(p),p});try{Et(()=>Promise.resolve().then(()=>Oi),void 0).then(k=>{try{k.addMatchToAllTime(f,{recordSeries:!0})}catch{}try{k.updateHeadToHeadLegs(f)}catch{}try{k.addMatchToDistribution(f)}catch{}})}catch{}try{Ht({type:"endGame",ts:Date.now()})}catch{}return{...s,players:f,bestLegThisMatch:h,inProgress:!1}}return{...s,players:f,bestLegThisMatch:h}}),nextPlayer:()=>t(n=>{const s=(n.currentPlayerIdx+1)%n.players.length;try{Ht({type:"nextPlayer",currentPlayerIdx:s,ts:Date.now()})}catch{}return{...n,currentPlayerIdx:s}}),endGame:()=>t(n=>{if(!n.inProgress)return n;const s=n.players.map(a=>{const r={...a,currentThreeDartAvg:0};return Bi(r),r});try{Et(()=>Promise.resolve().then(()=>Oi),void 0).then(a=>{try{a.addMatchToAllTime(s,{recordSeries:!0})}catch{}try{a.updateHeadToHeadLegs(s)}catch{}try{a.addMatchToDistribution(s)}catch{}})}catch{}try{Ht({type:"endGame",ts:Date.now()})}catch{}return{...n,players:s,inProgress:!1}}),importState:n=>t(()=>({...n})),setPlayerCurrentAverage:(n,s)=>t(a=>{const r=a.players[n];if(!r)return a;if(Math.abs((r.currentThreeDartAvg??0)-s)>1e-4){const o={...r,currentThreeDartAvg:s},l=a.players.map((m,d)=>d===n?o:m);return{...a,players:l}}return a})}));function ph(){const{inProgress:t}=gt(),[n,s]=i.useState(!1),[a,r]=i.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[o,l]=i.useState(""),[m,d]=i.useState(!1),[u,h]=i.useState(""),[x,f]=i.useState(null),S=(()=>{try{return Os()}catch{return null}})();i.useEffect(()=>{if(!S)return;const v=S.addListener(g=>{try{g?.type==="help-message"&&x&&(String(g.requestId),String(x.id)),g?.type==="help-request-updated"&&x&&g.request?.id===x.id&&f(g.request)}catch{}});return()=>v()},[S,x]);const k=v=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:v}})),s(!1)}catch(g){console.error("Navigation failed:",g)}},p=v=>{const g=v.toLowerCase();return g.includes("username")||g.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:g.includes("premium")||g.includes("upgrade")||g.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:g.includes("calibrat")||g.includes("camera")||g.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:g.includes("voice")||g.includes("caller")||g.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:g.includes("friend")||g.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:g.includes("stat")||g.includes("score")||g.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:g.includes("setting")||g.includes("customiz")||g.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:g.includes("tournament")||g.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:g.includes("score")||g.includes("scoring")||g.includes("autoscore")?{text:"Auto-scoring assigns darts to board segments automatically. You can review and adjust placements in the Match Summary screen.",links:[{text:"Go to Match Summary",tab:"matchsummary"}]}:g.includes("pair")||g.includes("pairing")||g.includes("phone")||g.includes("camera pairing")?{text:"Use the Pairing flow to connect phones and cameras. Make sure devices are on the same Wi-Fi and scan the QR code shown.",links:[{text:"Open Pairing",tab:"pairing"}]}:g.includes("highlight")||g.includes("download")||g.includes("save")?{text:"Highlights can be downloaded or saved to your account from the Highlights section. We keep a record when you hit milestone checkouts or visits.",links:[{text:"Open Highlights",tab:"highlights"}]}:g.includes("privacy")||g.includes("copyright")||g.includes("legal")?{text:"Our Legal Notice and Privacy information are available in the footer. You can view privacy, copyright, and contact details there.",links:[{text:"View Legal Notice",tab:"footer"}]}:g.includes("help")||g.includes("support")||g.includes("faq")?{text:"You're already in the help section! Check Settings for more resources.",links:[{text:"Go to Settings > Support",tab:"settings"}]}:g.includes("how to play")||g.includes("game")||g.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},w=()=>{if(!o.trim())return;const v=o.trim(),g=v.toLowerCase();if(r(E=>[...E,{text:v,isUser:!0}]),l(""),m)if(g.startsWith("y")){r(E=>[...E,{text:"Okay â€” I will notify an admin. Please wait for them to join the chat.",isUser:!1}]),d(!1),(async()=>{try{let E=null,L=null;try{E=localStorage.getItem("ndn:currentUser")||null;const M=localStorage.getItem("ndn:ws-identity");M&&(L=JSON.parse(M).email||null)}catch{}const A={message:u||v,username:E,email:L},P={"Content-Type":"application/json"},D=localStorage.getItem("authToken");D&&(P.Authorization=`Bearer ${D}`);const R=await(await De("/api/help/requests",{method:"POST",headers:P,body:JSON.stringify(A)})).json().catch(()=>null);R&&R.request?(f(R.request),s(!1)):r(M=>[...M,{text:"Okay â€” I will notify an admin. Please wait for them to join the chat.",isUser:!1}])}catch{r(L=>[...L,{text:"Failed to contact admins. Please try again later.",isUser:!1}])}})();return}else{r(E=>[...E,{text:"Okay â€” I won't notify an admin. If you change your mind, just ask.",isUser:!1}]),d(!1);return}const O=p(g);if(typeof O.text=="string"&&O.text.includes("I'm not sure about that")){h(v),d(!0),setTimeout(()=>{r(E=>[...E,{text:{text:"I can connect you to a member of our admin team â€” would you like that? Type YES or NO.",links:[]},isUser:!1}])},350);return}setTimeout(()=>{r(E=>[...E,{text:O,isUser:!1}])},500)};return e.jsxs(e.Fragment,{children:[!t&&e.jsx("button",{onClick:()=>s(!0),className:"fixed bottom-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-colors",title:"Help Assistant",children:e.jsx(Br,{className:"w-6 h-6"})}),n&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-end p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>s(!1)}),e.jsxs("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-md h-96 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hn,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"font-semibold",children:"Help Assistant"})]}),e.jsx("button",{onClick:()=>s(!1),className:"text-slate-400 hover:text-white",children:e.jsx(no,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:a.map((v,g)=>e.jsx("div",{className:`flex ${v.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${v.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof v.text=="string"?v.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:v.text.text}),v.text.links&&e.jsx("div",{className:"space-y-1",children:v.text.links.map((O,E)=>e.jsx("button",{onClick:()=>k(O.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:O.text},E))})]})})},g))}),e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:v=>l(v.target.value),onKeyPress:v=>v.key==="Enter"&&w(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:w,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(so,{className:"w-4 h-4"})})]})})]})]}),x&&e.jsx(ic,{request:x,user:{email:(()=>{try{const v=localStorage.getItem("ndn:ws-identity");return v&&JSON.parse(v).email||null}catch{return null}})(),username:localStorage.getItem("ndn:currentUser")||null,isAdmin:!1},onClose:()=>f(null)})]})}const gh={};function mc(t,n){let s;try{s=t()}catch{return}return{getItem:r=>{var o;const l=d=>d===null?null:JSON.parse(d,void 0),m=(o=s.getItem(r))!=null?o:null;return m instanceof Promise?m.then(l):l(m)},setItem:(r,o)=>s.setItem(r,JSON.stringify(o,void 0)),removeItem:r=>s.removeItem(r)}}const ma=t=>n=>{try{const s=t(n);return s instanceof Promise?s:{then(a){return ma(a)(s)},catch(a){return this}}}catch(s){return{then(a){return this},catch(a){return ma(a)(s)}}}},bh=(t,n)=>(s,a,r)=>{let o={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:w=>w,version:0,merge:(w,v)=>({...v,...w}),...n},l=!1;const m=new Set,d=new Set;let u;try{u=o.getStorage()}catch{}if(!u)return t((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),s(...w)},a,r);const h=ma(o.serialize),x=()=>{const w=o.partialize({...a()});let v;const g=h({state:w,version:o.version}).then(O=>u.setItem(o.name,O)).catch(O=>{v=O});if(v)throw v;return g},f=r.setState;r.setState=(w,v)=>{f(w,v),x()};const S=t((...w)=>{s(...w),x()},a,r);let k;const p=()=>{var w;if(!u)return;l=!1,m.forEach(g=>g(a()));const v=((w=o.onRehydrateStorage)==null?void 0:w.call(o,a()))||void 0;return ma(u.getItem.bind(u))(o.name).then(g=>{if(g)return o.deserialize(g)}).then(g=>{if(g)if(typeof g.version=="number"&&g.version!==o.version){if(o.migrate)return o.migrate(g.state,g.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return g.state}).then(g=>{var O;return k=o.merge(g,(O=a())!=null?O:S),s(k,!0),x()}).then(()=>{v?.(k,void 0),l=!0,d.forEach(g=>g(k))}).catch(g=>{v?.(void 0,g)})};return r.persist={setOptions:w=>{o={...o,...w},w.getStorage&&(u=w.getStorage())},clearStorage:()=>{u?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>p(),hasHydrated:()=>l,onHydrate:w=>(m.add(w),()=>{m.delete(w)}),onFinishHydration:w=>(d.add(w),()=>{d.delete(w)})},p(),k||S},xh=(t,n)=>(s,a,r)=>{let o={storage:mc(()=>localStorage),partialize:p=>p,version:0,merge:(p,w)=>({...w,...p}),...n},l=!1;const m=new Set,d=new Set;let u=o.storage;if(!u)return t((...p)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),s(...p)},a,r);const h=()=>{const p=o.partialize({...a()});return u.setItem(o.name,{state:p,version:o.version})},x=r.setState;r.setState=(p,w)=>{x(p,w),h()};const f=t((...p)=>{s(...p),h()},a,r);r.getInitialState=()=>f;let S;const k=()=>{var p,w;if(!u)return;l=!1,m.forEach(g=>{var O;return g((O=a())!=null?O:f)});const v=((w=o.onRehydrateStorage)==null?void 0:w.call(o,(p=a())!=null?p:f))||void 0;return ma(u.getItem.bind(u))(o.name).then(g=>{if(g)if(typeof g.version=="number"&&g.version!==o.version){if(o.migrate)return[!0,o.migrate(g.state,g.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,g.state];return[!1,void 0]}).then(g=>{var O;const[E,L]=g;if(S=o.merge(L,(O=a())!=null?O:f),s(S,!0),E)return h()}).then(()=>{v?.(S,void 0),S=a(),l=!0,d.forEach(g=>g(S))}).catch(g=>{v?.(void 0,g)})};return r.persist={setOptions:p=>{o={...o,...p},p.storage&&(u=p.storage)},clearStorage:()=>{u?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>k(),hasHydrated:()=>l,onHydrate:p=>(m.add(p),()=>{m.delete(p)}),onFinishHydration:p=>(d.add(p),()=>{d.delete(p)})},o.skipHydration||k(),S||f},vh=(t,n)=>"getStorage"in n||"serialize"in n||"deserialize"in n?((gh?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),bh(t,n)):xh(t,n),yh=vh;let Ln=null,Ua=null,Lr=null,Pr=null,ea=0,js=null,Pn=null;const wh=200,$n=Bn()(yh(t=>({isStreaming:!1,mode:"local",pairingCode:null,expiresAt:null,isPaired:!1,mobileUrl:null,showOverlay:!0,isStarting:!1,setStreaming:n=>{t({isStreaming:n}),n&&t({isStarting:!1})},setStarting:n=>{t({isStarting:n})},setMode:n=>{t({mode:n})},setPairingCode:n=>t({pairingCode:n}),setExpiresAt:n=>t({expiresAt:n}),setPaired:n=>t({isPaired:n}),setMobileUrl:n=>t({mobileUrl:n}),setShowOverlay:n=>t({showOverlay:!!n}),setMediaStream:n=>{!n&&ea>0||(Ua=n)},getMediaStream:()=>{if(Ua)return Ua;try{const s=Ln?.srcObject||null;if(s)return s}catch{}return null},setPcRef:n=>{Lr=n},getPcRef:()=>Lr,setWsRef:n=>{Pr=n},getWsRef:()=>Pr,getVideoElementRef:()=>Ln,setVideoElementRef:n=>{try{if(n===null){Pn&&(clearTimeout(Pn),Pn=null,js=null),me("[cameraSession] ðŸ›‘ setVideoElementRef called - clearing ref"),Ln=null;return}if(!Ln){me("[cameraSession] âœ“ setVideoElementRef called - storing HTMLVideoElement",{tagName:n.tagName,hasStream:!!n.srcObject}),Ln=n;return}if(Ln===n)return;Pn&&(clearTimeout(Pn),Pn=null),js=n,Pn=window.setTimeout(()=>{try{me("[cameraSession] (deferred) setVideoElementRef applying pending ref",{tagName:js?.tagName,hasStream:!!js?.srcObject}),Ln=js}catch(s){me("[cameraSession] Failed to apply pending video ref:",s)}finally{js=null,Pn=null}},wh)}catch{}},acquireKeepAlive:n=>{ea+=1},releaseKeepAlive:n=>{ea=Math.max(0,ea-1)},clearSession:()=>{ea===0&&(Ln=null,Ua=null),Lr=null,Pr=null,t({isStreaming:!1,pairingCode:null,expiresAt:null,isPaired:!1,mobileUrl:null})}}),{name:"ndn-camera-session",storage:mc(()=>localStorage),partialize:t=>({isStreaming:t.isStreaming,mode:t.mode,pairingCode:t.pairingCode,expiresAt:t.expiresAt,isPaired:t.isPaired,mobileUrl:t.mobileUrl,showOverlay:t.showOverlay})}));function Nh(){const t=$n(),n=i.useRef({}),s=i.useRef({});return i.useEffect(()=>{function a(u="[GlobalCamera]"){try{const h=t.getVideoElementRef(),x=t.getMediaStream(),f=t.getPcRef&&t.getPcRef(),S=t.getWsRef&&t.getWsRef();me(u,{isStreaming:t.isStreaming,mode:t.mode,showOverlay:t.showOverlay,hasVideoElement:!!h,video:h?{videoWidth:h.videoWidth,videoHeight:h.videoHeight,srcObject:!!h.srcObject}:null,mediaTracks:x?x.getTracks().map(k=>({kind:k.kind,enabled:k.enabled,id:k.id})):null,pcState:f?f.connectionState||f.iceConnectionState:null,wsState:S?S.readyState||"unknown":null})}catch(h){console.warn("[GlobalCamera] dumpState failed",h)}}a("[GlobalCamera] INIT");let r=!0;const o=setInterval(()=>{if(r)try{const u=t.getVideoElementRef(),h=t.getMediaStream(),x=t.getPcRef&&t.getPcRef(),f={isStreaming:t.isStreaming,mode:t.mode,hasVideo:!!u,videoW:u?u.videoWidth:0,videoH:u?u.videoHeight:0,tracks:h?h.getTracks().length:0,pcState:x?x.connectionState||x.iceConnectionState:null},S=n.current;(f.isStreaming!==S.isStreaming||f.hasVideo!==S.hasVideo||f.videoW!==S.videoW||f.videoH!==S.videoH||f.tracks!==S.tracks||f.pcState!==S.pcState||t.showOverlay!==S.showOverlay)&&(n.current=f,a("[GlobalCamera] CHANGE"))}catch(u){console.warn("[GlobalCamera] poll failed",u)}},750);function l(u){try{const h=s.current.video;if(h&&h.el===u)return;if(h&&h.el){try{h.el.removeEventListener("loadedmetadata",h.loadedmetadata)}catch{}try{h.el.removeEventListener("playing",h.playing)}catch{}try{h.el.removeEventListener("pause",h.pause)}catch{}try{h.el.removeEventListener("ended",h.ended)}catch{}}if(s.current.video=null,u){const x=()=>me("[GlobalCamera] video loadedmetadata",{videoWidth:u.videoWidth,videoHeight:u.videoHeight}),f=()=>{me("[GlobalCamera] video playing",{paused:u.paused})},S=()=>{me("[GlobalCamera] video pause")},k=()=>{me("[GlobalCamera] video ended")};u.addEventListener("loadedmetadata",x),u.addEventListener("playing",f),u.addEventListener("pause",S),u.addEventListener("ended",k),s.current.video={el:u,loadedmetadata:x,playing:f,pause:S,ended:k}}}catch(h){console.warn("[GlobalCamera] attachVideoListeners failed",h)}}function m(u){try{const h=s.current.pc;if(h&&h.pc===u)return;if(h&&h.pc)try{h.pc.removeEventListener("connectionstatechange",h.connChange)}catch{}if(s.current.pc=null,u){const x=()=>me("[GlobalCamera] pc state change",{connectionState:u.connectionState,iceState:u.iceConnectionState});u.addEventListener("connectionstatechange",x),s.current.pc={pc:u,connChange:x}}}catch(h){console.warn("[GlobalCamera] attachPc failed",h)}}const d=setInterval(()=>{try{l(t.getVideoElementRef()),m(t.getPcRef&&t.getPcRef())}catch{}},1e3);return()=>{r=!1,clearInterval(o),clearInterval(d);try{const u=s.current.video;u&&u.el&&(u.el.removeEventListener("loadedmetadata",u.loadedmetadata),u.el.removeEventListener("playing",u.playing))}catch{}try{const u=s.current.pc;u&&u.pc&&u.pc.removeEventListener("connectionstatechange",u.connChange)}catch{}}},[t]),null}function Sh(){const t=$n(),n=i.useRef(null),s=i.useRef(null),a=i.useRef(0),r=i.useRef(0),o=i.useRef(0),l=i.useRef(0);return i.useEffect(()=>{n.current&&t.setVideoElementRef(n.current)},[t]),i.useEffect(()=>{let m=!0;const d=async()=>{if(m)try{const h=t.getMediaStream(),x=n.current;if(!x||!h)return;(s.current!==h||x.srcObject!==h)&&(x.srcObject=h,s.current=h),x.muted=!0,x.playsInline=!0;try{await x.play()}catch{}}catch{}};d();const u=setInterval(d,750);return()=>{m=!1,clearInterval(u)}},[t]),i.useEffect(()=>{const d=setInterval(()=>{const u=n.current,h=Date.now();if(!u||!t.isStreaming||t.mode!=="phone"){r.current=0;return}if(!u.srcObject){const f=[3e3,6e3,1e4][Math.min(l.current,2)];if(h-o.current>=f){o.current=h,l.current=Math.min(l.current+1,3);try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{reason:"missing-stream",ts:h}})),u.play().catch(()=>{})}catch{}}return}const x=u.currentTime||0;if(Number.isFinite(x))if(x===a.current?r.current+=1:r.current=0,a.current=x,r.current>=3){const f=[3e3,6e3,1e4][Math.min(l.current,2)];if(h-o.current>=f){o.current=h,l.current=Math.min(l.current+1,3);try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{reason:"stall",ts:h}})),u.play().catch(()=>{})}catch{}}}else r.current===0&&(l.current=0)},1e3);return()=>clearInterval(d)},[t]),e.jsx("video",{ref:n,style:{position:"fixed",width:1,height:1,left:-9999,top:-9999,opacity:0},muted:!0,playsInline:!0,"aria-hidden":!0})}function hc(t){const n=$n.getState(),s=J.getState(),a=Date.now();s.preferredCameraLabel==="Phone Camera"||n.mode==="phone"?window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{reason:t,ts:a}})):window.dispatchEvent(new Event("ndn:camera-reset"))}const Qr="ndn:camera-recovery";function jh(t){window.dispatchEvent(new CustomEvent(Qr,{detail:t}))}function Ch(){const t=J(h=>!!h.cameraEnabled),n=J(h=>h.preferredCameraLabel),s=t,a=$n(),r=i.useRef(-1),o=i.useRef(0),l=i.useRef(0),m=i.useRef(0),d=i.useRef(!1),u=i.useRef(null);return i.useEffect(()=>{if(!s)return;const h=p=>{const w=p*.15,v=(Math.random()*2-1)*w;return Math.max(500,Math.round(p+v))},x=p=>{const w=Date.now(),v=[2500,5e3,1e4,18e3,3e4][Math.min(m.current,4)],g=h(v);if(!(w-l.current<g)&&!d.current){d.current=!0,l.current=w,u.current=p,m.current=Math.min(m.current+1,5);try{hc(p),jh({reason:p,ts:w})}catch{}window.setTimeout(()=>{d.current=!1},1500)}},f=()=>{try{const p=a.getMediaStream?.()||null;if(!(!!a.isStreaming||!!p)){o.current=0,r.current=-1,m.current=0,d.current=!1,u.current=null;return}const v=a.getVideoElementRef?.()||null;if(!v){o.current=0,r.current=-1,p&&x("watchdog-detached");return}if(p&&!v.srcObject)try{v.srcObject=p}catch{}try{const O=p?.getVideoTracks?.()||[];if(p&&O.length>0&&O.every(E=>E.readyState==="ended"||E.muted)){x("watchdog-ended-track");return}}catch{}try{if(v.paused&&(v.play?.().catch?.(()=>{}),o.current+=1,o.current>=6)){x("watchdog-paused");return}}catch{}const g=Number(v.currentTime||0);if(!Number.isFinite(g)||(r.current===g?o.current+=1:o.current=0,r.current=g,o.current<4))return;x("watchdog-stall")}catch{}},S=()=>{try{if(document.visibilityState==="visible"){const p=a.getVideoElementRef?.()||null;try{p?.play?.().catch?.(()=>{})}catch{}(a.isStreaming||a.getMediaStream?.())&&x("watchdog-visibility-resume")}}catch{}},k=window.setInterval(f,1e3);return document.addEventListener("visibilitychange",S),()=>{window.clearInterval(k),document.removeEventListener("visibilitychange",S)}},[s,n,a]),null}function kh(t){return t.includes("ended-track")?"Camera stream ended. Recoveringâ€¦":t.includes("paused")?"Camera paused. Recoveringâ€¦":t.includes("detached")?"Camera preview detached. Reconnectingâ€¦":t.includes("visibility")?"Welcome back. Refreshing cameraâ€¦":"Camera froze. Recoveringâ€¦"}function Eh(){const t=yo(),n=i.useRef(0);return i.useEffect(()=>{const s=a=>{const o=a.detail;if(!o?.ts)return;const l=Date.now();l-n.current<8e3||(n.current=l,t(kh(o.reason),{type:"info",actionLabel:"Retry now",onAction:()=>{try{hc("user-click")}catch{}}}))};return window.addEventListener(Qr,s),()=>{window.removeEventListener(Qr,s)}},[t]),null}const Vi={};function Th(){const[t,n]=i.useState(!1),s=Vi?.VITE_PLAY_STORE_URL||"",a=Vi?.VITE_APP_STORE_URL||"",r=i.useRef(null);i.useEffect(()=>{if(!t)return;const l=d=>{d.key==="Escape"&&n(!1)},m=d=>{const u=d.target;u&&(r.current&&r.current.contains(u)||n(!1))};return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),window.addEventListener("keydown",l),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m),window.removeEventListener("keydown",l)}},[t]);async function o(){try{if(window.promptInstallApp){const l=await window.promptInstallApp()}else navigator?.standalone||"onappinstalled"in window?alert("App is already installed or your browser does not support programmatic install."):alert("Install is not available for your browser. Try using the share menu (iOS) or the install prompt (Chrome/Edge on Android).")}catch{}}return e.jsxs("div",{className:"relative inline-block",ref:r,children:[e.jsx("button",{className:"px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-sm text-white flex items-center gap-2",onClick:()=>n(l=>!l),title:"Install or download app",children:"Install"}),t&&e.jsxs("div",{role:"dialog","aria-modal":"true",className:"absolute right-0 mt-2 z-40 w-80 max-w-[calc(100vw-2rem)] rounded-3xl border border-white/15 bg-slate-900/95 p-5 text-white shadow-2xl",children:[e.jsx("button",{className:"absolute right-3 top-3 flex h-7 w-7 items-center justify-center rounded-full bg-rose-500 text-sm font-bold text-white shadow hover:bg-rose-400",onClick:()=>n(!1),"aria-label":"Close install picker",children:"Ã—"}),e.jsxs("div",{className:"pr-6",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Install or Download"}),e.jsx("p",{className:"text-sm text-white/70",children:"Install the Progressive Web App or jump to the native stores when available."})]}),e.jsxs("div",{className:"mt-4 flex flex-col space-y-2",children:[e.jsx("button",{className:"btn",onClick:()=>o(),children:"Install (PWA)"}),s?e.jsx("a",{className:"btn",target:"_blank",rel:"noreferrer",href:s,children:"Android (Google Play)"}):e.jsx("div",{className:"text-xs opacity-80",children:"Android native build not provided"}),a?e.jsx("a",{className:"btn",target:"_blank",rel:"noreferrer",href:a,children:"iOS (App Store)"}):e.jsx("div",{className:"text-xs opacity-80",children:"iOS native build not provided"}),e.jsx("div",{className:"text-xs opacity-70",children:'iOS: Open Safari â†’ Share â†’ "Add to Home Screen" to pin this dashboard like a native app.'})]})]})]})}function Ah(){const[t,n]=i.useState(!1),[s,a]=i.useState(!1),r=i.useRef(null);i.useEffect(()=>{try{window.__NDN_DEFER_INSTALL_PROMPT__=!0;const l=m=>{m.preventDefault(),window.deferredInstallPrompt=m,n(!0)};return window.addEventListener("beforeinstallprompt",l),window.deferredInstallPrompt&&n(!0),()=>{window.removeEventListener("beforeinstallprompt",l);try{window.__NDN_DEFER_INSTALL_PROMPT__=!1}catch{}}}catch{}},[]);async function o(){try{if(window.promptInstallApp)await window.promptInstallApp()||a(!0);else if(window.deferredInstallPrompt){const l=window.deferredInstallPrompt;l.prompt();const m=await l.userChoice;m&&m.outcome==="accepted"?n(!1):a(!0)}else a(!0)}catch{a(!0)}}return i.useEffect(()=>{if(!s)return;const l=d=>{d.key==="Escape"&&a(!1)},m=d=>{const u=d.target;u&&(r.current&&r.current.contains(u)||a(!1))};return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),window.addEventListener("keydown",l),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m),window.removeEventListener("keydown",l)}},[s]),e.jsxs("div",{className:"relative inline-block",ref:r,children:[e.jsx("button",{onClick:o,className:"px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-sm",title:"Add to Home Screen","data-available":t?"true":"false",children:"Add to Home Screen"}),s&&e.jsxs("div",{className:"absolute right-0 mt-2 z-40 w-80 max-w-[calc(100vw-2rem)] rounded-3xl border border-white/15 bg-slate-900/95 p-5 text-white shadow-2xl",children:[e.jsx("button",{className:"absolute right-3 top-3 flex h-7 w-7 items-center justify-center rounded-full bg-rose-500 text-sm font-bold text-white shadow hover:bg-rose-400",onClick:()=>a(!1),"aria-label":"Close add-to-home instructions",children:"Ã—"}),e.jsx("h3",{className:"text-lg font-semibold pr-6",children:"Add Nine Dart Nation to Home"}),e.jsx("p",{className:"mt-3 text-sm text-white/80 pr-4",children:Dh()?'Open Safari, tap the share icon, then choose "Add to Home Screen".':'Open your browser menu (â‹® or â‹¯) and choose "Install app" or "Add to Home Screen".'}),e.jsx("p",{className:"mt-2 text-xs text-white/60 pr-4",children:"Installing the PWA keeps alerts, matches, and calibration controls a tap away."}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-end gap-2",children:[e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>a(!1),children:"Close"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>a(!1),children:"Got it"})]})]})]})}function Dh(){try{return/iphone|ipad|ipod/i.test(navigator.userAgent)}catch{return!1}}function Mh({storageKey:t,children:n,className:s,frameClassName:a,frameFullScreenClassName:r,defaultWidth:o=520,defaultHeight:l,minWidth:m=360,minHeight:d=200,maxWidth:u=1100,maxHeight:h=900,fullScreen:x=!1,initialFitHeight:f=!1,onClose:S}){const[k,p]=i.useState(()=>{if(!x){try{const j=localStorage.getItem(t);if(j)return JSON.parse(j)}catch{}return{width:o,height:l}}return{}}),w=i.useRef(null);i.useEffect(()=>{if(x)return;function j(){try{localStorage.removeItem(t)}catch{}if(f&&A.current?.parentElement){const R=A.current.parentElement,M=window.getComputedStyle(R),$=parseFloat(M.paddingTop||"0")||0,W=parseFloat(M.paddingBottom||"0")||0,Y=Math.max(0,R.clientHeight-$-W),ne=Math.max(d,Math.min(h,Math.round(Y)));p({width:o,height:ne});return}p({width:o,height:l})}return window.addEventListener("ndn:layout-reset",j),()=>window.removeEventListener("ndn:layout-reset",j)},[t,o,l,x]),i.useEffect(()=>{if(!x)try{localStorage.setItem(t,JSON.stringify(k))}catch{}},[k,t,x]),i.useEffect(()=>{if(x||!f)return;const j=A.current?.parentElement;if(!j)return;const R=window.getComputedStyle(j),M=parseFloat(R.paddingTop||"0")||0,$=parseFloat(R.paddingBottom||"0")||0,W=Math.max(0,j.clientHeight-M-$),Y=Math.max(d,Math.min(h,Math.round(W)));try{const ne=localStorage.getItem(t);if(ne){const ie=JSON.parse(ne)?.height||0;(!ie||ie<Y)&&p(je=>({...je,height:Y}));return}}catch{}p(ne=>({...ne,height:Y}))},[f,x,t,d,h]);function v(j,R,M){return Math.max(R,Math.min(M,j))}function g(j,R){j.preventDefault();const M=A.current;if(!M)return;const $=M.getBoundingClientRect();w.current={x:j.clientX,y:j.clientY,w:$.width,h:$.height,dir:R},window.addEventListener("mousemove",E),window.addEventListener("mouseup",L)}function O(j,R){const $=j.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"," "].includes($))return;j.preventDefault();const W=$==="ArrowLeft"||$==="ArrowUp"?-20:20;p(Y=>{const ne=Y.width||o,xe=Y.height||l||d;let ie=ne,je=xe;return R.includes("e")&&(ie=v(ne+W,m,u)),R.includes("w")&&(ie=v(ne-W,m,u)),R.includes("s")&&(je=v(xe+W,d,h)),R.includes("n")&&(je=v(xe-W,d,h)),{width:Math.round(ie),height:Math.round(je)}})}function E(j){const R=w.current;if(!R)return;const M=j.clientX-R.x,$=j.clientY-R.y,W=R.dir;let Y=R.w,ne=R.h,xe=1/0;const ie=A.current?.parentElement;if(ie){const Ne=window.getComputedStyle(ie),he=parseFloat(Ne.paddingTop||"0")||0,ke=parseFloat(Ne.paddingBottom||"0")||0;xe=Math.max(0,ie.clientHeight-he-ke)}const je=Math.min(h,isFinite(xe)?xe:h);W.includes("e")&&(Y=v(R.w+M,m,u)),W.includes("s")&&(ne=v(R.h+$,d,je)),W.includes("w")&&(Y=v(R.w-M,m,u)),W.includes("n")&&(ne=v(R.h-$,d,je)),p({width:Math.round(Y),height:Math.round(ne)})}function L(){window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",L),w.current=null}const A=i.useRef(null);i.useEffect(()=>{if(!S)return;function j(R){R.key==="Escape"&&(R.stopPropagation(),S?.())}return window.addEventListener("keydown",j,!0),()=>window.removeEventListener("keydown",j,!0)},[S]);const P=x?{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%"}:{width:k.width?`${k.width}px`:void 0,height:k.height?`${k.height}px`:void 0,maxWidth:`${u}px`,maxHeight:"100%"},D=x?r??"card relative ndn-modal-full":a??"card relative";return e.jsxs("div",{ref:A,className:`${D} ${s||""}`,style:P,children:[e.jsx(Fn,{returnFocus:!0,className:"flex-1 flex flex-col min-h-0 w-full",children:n}),!x&&e.jsx("div",{className:"resizer resizer-nw",onMouseDown:j=>g(j,"nw"),role:"button",tabIndex:0,"aria-label":"Resize north-west",onKeyDown:j=>O(j,"nw")}),!x&&e.jsx("div",{className:"resizer resizer-ne",onMouseDown:j=>g(j,"ne"),role:"button",tabIndex:0,"aria-label":"Resize north-east",onKeyDown:j=>O(j,"ne")}),!x&&e.jsx("div",{className:"resizer resizer-sw",onMouseDown:j=>g(j,"sw"),role:"button",tabIndex:0,"aria-label":"Resize south-west",onKeyDown:j=>O(j,"sw")}),!x&&e.jsx("div",{className:"resizer resizer-se",onMouseDown:j=>g(j,"se"),role:"button",tabIndex:0,"aria-label":"Resize south-east",onKeyDown:j=>O(j,"se")}),!x&&e.jsx("div",{className:"resizer-edge resizer-s",onMouseDown:j=>g(j,"s"),role:"button",tabIndex:0,"aria-label":"Resize south",onKeyDown:j=>O(j,"s")})]})}function Ih(){const[t,n]=i.useState(null);i.useEffect(()=>{try{const a=r=>{r.preventDefault(),n(r)};return window.addEventListener("beforeinstallprompt",a),()=>window.removeEventListener("beforeinstallprompt",a)}catch{}},[]);async function s(){if(!t){alert('Open this site in your browser and use "Add to Home Screen" from the share menu (iOS) or use the browser install prompt (Android/Chrome).');return}try{t.prompt();const a=await t.userChoice;a&&a.outcome==="accepted"&&n(null)}catch(a){console.warn("install failed",a)}}return t?e.jsx("button",{className:"rounded bg-violet-600 text-white px-2 py-1",onClick:()=>s(),children:"Install App"}):null}function Rh(){const[t,n]=i.useState(!1),s=new Date().getFullYear();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full text-center text-xs text-gray-500 py-2 select-none",children:["Â© ",s," Nine Dart Nation â€”"," ",e.jsx("button",{className:"underline",onClick:()=>n(!0),children:"Legal Notice"}),e.jsx("span",{className:"ml-3 inline-block align-middle",children:e.jsx(Ih,{})})]}),t?e.jsx(Mh,{storageKey:"ndn:modal:legal",className:"w-[640px]",defaultWidth:640,defaultHeight:420,minWidth:420,minHeight:220,initialFitHeight:!0,children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Privacy & Copyright Notice"}),e.jsx("div",{className:"text-sm",children:"âš ï¸ IMPORTANT LEGAL NOTICE"}),e.jsx("div",{className:"text-sm",children:"Copyright Protection: All code, assets, and intellectual property in Nine Dart Nation are protected by copyright law. Unauthorized copying, modification, or distribution of this software is strictly prohibited."}),e.jsx("div",{className:"text-sm",children:"Legal Consequences: Any attempt to edit, reverse-engineer, or redistribute this code will result in immediate legal action, including but not limited to copyright infringement lawsuits and potential criminal charges."}),e.jsx("div",{className:"text-sm",children:"Privacy: Your personal data and gameplay information are protected. Any unauthorized access or data collection violates privacy laws and will be prosecuted to the full extent of the law."}),e.jsx("div",{className:"flex items-center gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:()=>n(!1),children:"Close"})})]})}):null]})}const At=Bn(t=>({paused:!1,pauseEndsAt:null,pauseStartedAt:null,pauseInitiator:null,setPaused:(n,s=null,a=null)=>t({paused:n,pauseEndsAt:s??null,pauseStartedAt:n?Date.now():null,pauseInitiator:n?a:null})}));function Oh(){const t=At(a=>a.paused),n=At(a=>a.pauseEndsAt),s=At(a=>a.setPaused);return i.useEffect(()=>{if(!t||!n)return;const a=Date.now();if(n<=a){s(!1,null);return}const r=n-a,o=setTimeout(()=>s(!1,null),r);return()=>clearTimeout(o)},[t,n,s]),null}const Wt={bullInner:6.35,bullOuter:15.9,trebleInner:99,trebleOuter:107,doubleInner:162,doubleOuter:170},cp=Wt,Qa=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];function fc(t,n){const s=new Array(9).fill(0);for(let a=0;a<3;a++)for(let r=0;r<3;r++)for(let o=0;o<3;o++)s[a*3+r]+=t[a*3+o]*n[o*3+r];return s}function Un(t,n){const s=n.x,a=n.y,r=t[6]*s+t[7]*a+t[8],o=(t[0]*s+t[1]*a+t[2])/r,l=(t[3]*s+t[4]*a+t[5])/r;return{x:o,y:l}}function dp(t,n,s){return[n*t[0],n*t[1],n*t[2],s*t[3],s*t[4],s*t[5],t[6],t[7],t[8]]}function up(t,n){const s=Math.cos(n),a=Math.sin(n),r=[s,-a,0,a,s,0,0,0,1];return fc(t,r)}function mp(t,n,s){return fc([1,0,n,0,1,s,0,0,1],t)}function Lh(t){const n=t,s=n[0],a=n[1],r=n[2],o=n[3],l=n[4],m=n[5],d=n[6],u=n[7],h=n[8],x=l*h-m*u,f=r*u-a*h,S=a*m-r*l,k=m*d-o*h,p=s*h-r*d,w=r*o-s*m,v=o*u-l*d,g=a*d-s*u,O=s*l-a*o,E=s*x+a*k+r*v;if(Math.abs(E)<1e-12)throw new Error("Singular homography");return[x/E,f/E,S/E,k/E,p/E,w/E,v/E,g/E,O/E]}function Hi(t,n){if(t.length<4||n.length<4)throw new Error("Need at least 4 correspondences");if(t.length!==n.length)throw new Error("Correspondences must have equal length");const s=[],a=[];for(let l=0;l<t.length;l++){const{x:m,y:d}=t[l],{x:u,y:h}=n[l];s.push([m,d,1,0,0,0,-u*m,-u*d]),a.push(u),s.push([0,0,0,m,d,1,-h*m,-h*d]),a.push(h)}const r=Ph(s,a);return[r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],1]}function Ph(t,n){const s=t.length,a=t[0].length,r=Array.from({length:a},()=>new Array(a).fill(0)),o=new Array(a).fill(0);for(let l=0;l<s;l++)for(let m=0;m<a;m++){o[m]+=t[l][m]*n[l];for(let d=0;d<a;d++)r[m][d]+=t[l][m]*t[l][d]}return _h(r,o)}function _h(t,n){const s=n.length,a=t.map((o,l)=>o.concat([n[l]]));for(let o=0;o<s;o++){let l=o;for(let m=o+1;m<s;m++)Math.abs(a[m][o])>Math.abs(a[l][o])&&(l=m);if(Math.abs(a[l][o])<1e-12)throw new Error("Singular matrix");if(l!==o){const m=a[o];a[o]=a[l],a[l]=m}for(let m=o+1;m<s;m++){const d=a[m][o]/a[o][o];for(let u=o;u<=s;u++)a[m][u]-=d*a[o][u]}}const r=new Array(s).fill(0);for(let o=s-1;o>=0;o--){let l=a[o][s];for(let m=o+1;m<s;m++)l-=a[o][m]*r[m];r[o]=l/a[o][o]}return r}function hp(t="center"){const n=(Wt.doubleInner+Wt.doubleOuter)/2,a=[20,6,3,11].map(r=>{const l=Qa.indexOf(r)/Qa.length*Math.PI*2-Math.PI/2,m=n*Math.cos(l),d=n*Math.sin(l);return{x:Math.abs(m)<1e-9?0:m,y:Math.abs(d)<1e-9?0:d}});return a.push({x:0,y:0}),a}function fp(t,n,s=256){const a=[];for(let r=0;r<s;r++){const o=r/s*Math.PI*2,l=Un(t,{x:n*Math.cos(o),y:n*Math.sin(o)});a.push(l)}return a}function pp(t,n="outer"){const s=Un(t,{x:0,y:0}),r={x:0,y:-(n==="outer"?Wt.doubleOuter:(Wt.doubleInner+Wt.doubleOuter)/2)},o=Un(t,r),l=o.x-s.x,m=o.y-s.y;let d=Math.atan2(m,l)*180/Math.PI;d=(d+360)%360;let h=d-270;return h=(h+180)%360-180,(Math.round(h/18)%20+20)%20}function Wi(t,n,s){let a=0;for(let r=0;r<n.length;r++){const o=Un(t,n[r]),l=o.x-s[r].x,m=o.y-s[r].y;a+=l*l+m*m}return Math.sqrt(a/n.length)}function gp(t,n,s={}){const a=t.length;if(a<4||n.length<4)throw new Error("Need at least 4 correspondences");const r=s.thresholdPx??8,o=s.maxIter??500,l=s.minInliers??4,m=s.rng??Math.random;let d=null,u=new Array(a).fill(!1),h=0,x=1/0;for(let p=0;p<o;p++){const w=new Set;for(;w.size<4;)w.add(Math.floor(m()*a));const v=Array.from(w),g=[],O=[];for(const M of v)g.push(t[M]),O.push(n[M]);let E;try{E=Hi(g,O)}catch{continue}const L=new Array(a).fill(!1);let A=0;for(let M=0;M<a;M++){const $=Un(E,t[M]),W=$.x-n[M].x,Y=$.y-n[M].y;Math.hypot(W,Y)<=r&&(L[M]=!0,A++)}if(A<l)continue;const P=[],D=[];for(let M=0;M<a;M++)L[M]&&(P.push(t[M]),D.push(n[M]));let j;try{j=Hi(P,D)}catch{continue}const R=Wi(j,P,D);(A>h||A===h&&R<x)&&(h=A,x=R,d=j,u=L.slice())}if(!d||h<l)return{H:null,inliers:new Array(a).fill(!1),errorPx:null};const f=[],S=[];for(let p=0;p<a;p++)u[p]&&(f.push(t[p]),S.push(n[p]));const k=f.length>0?Wi(d,f,S):null;return{H:d,inliers:u,errorPx:k}}function Zr(t,n){try{const s=Lh(t),a=Un(s,n);return!isFinite(a.x)||!isFinite(a.y)?null:a}catch{return null}}function Fh(t){const n=Math.hypot(t.x,t.y);let a=Math.atan2(t.y,t.x)*180/Math.PI;a=(a+360+90)%360;const r=Math.floor((a+9)%360/18),o=Qa[r],{bullInner:l,bullOuter:m,trebleInner:d,trebleOuter:u,doubleInner:h,doubleOuter:x}=Wt,f=.75,S=.5;return n>x+S?{base:0,ring:"MISS",sector:null,mult:0}:n>=h-f&&n<=x+S?{base:o*2,ring:"DOUBLE",sector:o,mult:2}:n>u+f?{base:o,ring:"SINGLE",sector:o,mult:1}:n>=d-f?{base:o*3,ring:"TRIPLE",sector:o,mult:3}:n>m+f?{base:o,ring:"SINGLE",sector:o,mult:1}:n>l+.5?{base:25,ring:"BULL",sector:25,mult:1}:{base:50,ring:"INNER_BULL",sector:25,mult:2}}function $h(t,n,s=0,a=0){const r=Math.hypot(t.x,t.y);let l=(Math.atan2(t.y,t.x)+(Number.isFinite(n)?n:0)+(Number.isFinite(a)?a:0))*180/Math.PI;l=(l+360+90)%360;const d=((Math.floor((l+9)%360/18)+(Number.isFinite(s)?s:0))%20+20)%20,u=Qa[d],{bullInner:h,bullOuter:x,trebleInner:f,trebleOuter:S,doubleInner:k,doubleOuter:p}=Wt,w=.75;return r>p+w?{base:0,ring:"MISS",sector:null,mult:0}:r>=k-w?{base:u*2,ring:"DOUBLE",sector:u,mult:2}:r>S+w?{base:u,ring:"SINGLE",sector:u,mult:1}:r>=f-w?{base:u*3,ring:"TRIPLE",sector:u,mult:3}:r>x+w?{base:u,ring:"SINGLE",sector:u,mult:1}:r>h+.5?{base:25,ring:"BULL",sector:25,mult:1}:{base:50,ring:"INNER_BULL",sector:25,mult:2}}function bp(t,n,s="#10b981",a=2){if(n.length){t.save(),t.strokeStyle=s,t.lineWidth=a,t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let r=1;r<n.length;r++)t.lineTo(n[r].x,n[r].y);t.closePath(),t.stroke(),t.restore()}}function xp(t,n,s="#f59e0b"){t.save(),t.strokeStyle=s,t.lineWidth=2,t.beginPath(),t.moveTo(n.x-8,n.y),t.lineTo(n.x+8,n.y),t.moveTo(n.x,n.y-8),t.lineTo(n.x,n.y+8),t.stroke(),t.restore()}function Za(t,n,s){return Math.max(n,Math.min(s,t))}function Uh(t,n,s){const{width:a,data:r}=t,o=[[-1,0,1],[-2,0,2],[-1,0,1]],l=[[-1,-2,-1],[0,0,0],[1,2,1]];let m=0,d=0;for(let u=-1;u<=1;u++)for(let h=-1;h<=1;h++){const x=Za(n+h,0,a-1),S=(Za(s+u,0,t.height-1)*a+x)*4,k=r[S],p=r[S+1],w=r[S+2],v=.299*k+.587*p+.114*w;m+=v*o[u+1][h+1],d+=v*l[u+1][h+1]}return Math.hypot(m,d)}function zi(t,n,s=6){const r=t.getContext("2d").getImageData(0,0,t.width,t.height),o=Za(Math.round(n.x),1,t.width-2),l=Za(Math.round(n.y),1,t.height-2);let m={x:o,y:l,mag:-1};for(let d=l-s;d<=l+s;d++)for(let u=o-s;u<=o+s;u++){if(u<=0||d<=0||u>=t.width-1||d>=t.height-1)continue;const h=Uh(r,u,d);h>m.mag&&(m={x:u,y:d,mag:h})}return{x:m.x,y:m.y}}function Gi(t){return new Promise(n=>setTimeout(n,t))}async function Bh(t,n){const s=Date.now();t.readyState>=1||(t.videoWidth??0)>0||await new Promise(a=>{let r=!1;const o=()=>{r||(r=!0,u(),a())},l=()=>o(),m=()=>o(),d=window.setInterval(()=>{Date.now()-s>n&&o(),t.readyState>=1&&o(),(t.videoWidth??0)>0&&o()},50),u=()=>{try{t.removeEventListener("loadedmetadata",l),t.removeEventListener("canplay",m),window.clearInterval(d)}catch{}};try{t.addEventListener("loadedmetadata",l),t.addEventListener("canplay",m)}catch{}})}async function ha(t){const{video:n,stream:s,attach:a=!0,muted:r=!0,playsInline:o=!0,maxAttempts:l=4,metadataTimeoutMs:m=1200,onPlayError:d}=t;if(!n)return{attached:!1,played:!1,reason:"no video"};const u=(s?.getVideoTracks?.()||[]).filter(k=>k.readyState==="live");if(!s||u.length===0)return{attached:!1,played:!1,reason:"no live stream"};try{r&&(n.muted=!0),o&&(n.playsInline=!0)}catch{}let h=!1;if(a)try{n.srcObject!==s&&(n.srcObject=s),h=!0}catch{return{attached:!1,played:!1,reason:"attach failed"}}const x=ha._playAttemptMap||new WeakMap;ha._playAttemptMap=x;const f=x.get(n);if(f)try{return await f}catch{}const S=(async()=>{for(let k=0;k<l;k++){try{await Bh(n,m)}catch{}try{const p=n.play();if(p&&typeof p.then=="function"&&await p,(n.videoWidth??0)>0&&(n.videoHeight??0)>0)return{attached:h,played:!0};if(n.paused===!1)return{attached:h,played:!0}}catch(p){try{d?.(p)}catch{}if(p&&p.name==="AbortError"){await Gi(120+k*150);continue}}await Gi(120+k*150)}return{attached:h,played:!1,reason:"play retries exhausted"}})();x.set(n,S);try{return await S}finally{try{x.delete(n)}catch{}}}const Vh=Bn()(t=>({locked:!1,lockedAt:null,lockedScale:null,lockedAspect:null,lockedFitMode:null,cameraId:null,createdAt:null,_hydrated:!0,H:null,imageSize:null,overlaySize:null,theta:null,rotationOffsetRad:null,sectorOffset:null,errorPx:null,confidence:null,anchors:null,setCalibration:n=>t(s=>{try{const a=J.getState?.()?.preserveCalibrationOnCameraChange,r=n?.cameraId;if(a&&s.locked&&r&&r!==s.cameraId){const o={...n};return o.cameraId=s.cameraId,"H"in o&&(o.H=s.H),{...s,...o}}}catch{}return{...s,...n}}),lockCameraView:(n,s,a,r)=>t({locked:!0,lockedAt:Date.now(),lockedScale:n,lockedAspect:s,lockedFitMode:a,cameraId:r,createdAt:Date.now()}),unlockCameraView:()=>t({locked:!1,lockedAt:null,lockedScale:null,lockedAspect:null,lockedFitMode:null}),reset:()=>t({locked:!1,lockedAt:null,lockedScale:null,lockedAspect:null,lockedFitMode:null,cameraId:null,createdAt:null})}));function _r(t,n,s,a,r){const o=Zr(t,n);return o?typeof s=="number"?$h(o,s,a??0,r??0):Fh(o):{base:0,ring:"MISS",sector:null,mult:0}}function Hh(t){if(t==null||Number.isNaN(t)||t<0)return null;let n;t<=.25?n=99.5+(.25-t)*2:t<=1?n=98+(1-t)*2:t<=2?n=95+(2-t)*3:t<=5?n=90+(5-t)*1.66:n=Math.max(0,90-(t-5)*5);const s=Math.max(0,Math.min(100,n));return Number(s.toFixed(1))}class Wh{width=0;height=0;bg=null;lastAcceptTs=0;cooldownMs=600;roiRadius=0;roiCx=0;roiCy=0;initialized=!1;thresh=18;minArea=60;maxArea=6e3;angMaxDeg=70;prevTip=null;prevArea=0;stableCount=0;requireStableN=2;tempOverrides=null;constructor(n){n?.thresh!==void 0&&(this.thresh=n.thresh),n?.minArea!==void 0&&(this.minArea=n.minArea),n?.maxArea!==void 0&&(this.maxArea=n.maxArea),n?.requireStableN!==void 0&&(this.requireStableN=n.requireStableN),n?.angMaxDeg!==void 0&&(this.angMaxDeg=n.angMaxDeg)}setTemporaryOverrides(n,s){const a=Math.max(0,Number(s)||0);if(a<=0){this.tempOverrides=null;return}this.tempOverrides={...n,untilTs:Date.now()+a}}_effectiveTuning(){const n=Date.now(),s=this.tempOverrides;return!s||n>=s.untilTs?(s&&n>=s.untilTs&&(this.tempOverrides=null),{thresh:this.thresh,minArea:this.minArea,maxArea:this.maxArea,requireStableN:this.requireStableN,angMaxDeg:this.angMaxDeg,inGrace:!1}):{thresh:s.thresh??this.thresh,minArea:s.minArea??this.minArea,maxArea:this.maxArea,requireStableN:s.requireStableN??this.requireStableN,angMaxDeg:s.angMaxDeg??this.angMaxDeg,inGrace:!0}}setROI(n,s,a){this.roiCx=n,this.roiCy=s,this.roiRadius=Math.max(0,a|0)}reset(n,s){this.width=n,this.height=s,this.bg=new Float32Array(n*s),this.initialized=!1}updateBackground(n,s=.05){const{width:a,height:r,data:o}=n;(!this.bg||a!==this.width||r!==this.height)&&this.reset(a,r);const l=this.bg,m=a*r;for(let d=0,u=0;d<m;d++,u+=4){const h=o[u],x=o[u+1],f=o[u+2],S=.299*h+.587*x+.114*f;this.initialized?l[d]=(1-s)*l[d]+s*S:l[d]=S}this.initialized=!0}inRoi(n,s){if(this.roiRadius<=0)return!0;const a=n-this.roiCx,r=s-this.roiCy;return a*a+r*r<=this.roiRadius*this.roiRadius}detect(n){const a=Date.now()-this.lastAcceptTs<this.cooldownMs,r=this._effectiveTuning(),{width:o,height:l,data:m}=n;(!this.bg||o!==this.width||l!==this.height)&&this.reset(o,l);const d=this.bg;if(!this.initialized)return this.updateBackground(n,1),null;const u=o*l,h=new Uint8Array(u),x=new Float32Array(u);let f=0,S=0,k=0;const p=new Uint8Array(u);for(let fe=0,pe=0;fe<u;fe++,pe+=4){const Ue=m[pe],qe=m[pe+1],Je=m[pe+2],it=Math.max(Ue,qe,Je),at=Math.min(Ue,qe,Je),Pt=.299*Ue+.587*qe+.114*Je,mt=Math.abs(Pt-d[fe]);x[fe]=mt;const gn=Math.floor(fe/o),Zt=fe-gn*o,bn=it===0?0:(it-at)/it,Tt=it>=250&&bn<=.12;Tt&&(p[fe]=1),this.inRoi(Zt,gn)&&!Tt&&(f+=mt,S+=mt*mt,k++)}const w=k?f/k:0,v=k?Math.max(0,S/k-w*w):0,g=Math.sqrt(v),O=Math.max(r.thresh,w+1.2*g);for(let fe=0;fe<u;fe++){if(p[fe]){h[fe]=0;continue}if(x[fe]>O){const pe=Math.floor(fe/o),Ue=fe-pe*o;h[fe]=this.inRoi(Ue,pe)?1:0}}this._dilate(h,o,l),this._erode(h,o,l);const E=new Uint8Array(u);let L=0,A=null;for(let fe=0;fe<u;fe++){if(h[fe]===0||E[fe])continue;const pe=[];let Ue=0,qe=0;const Je=[fe];for(E[fe]=1;qe<Je.length;){const it=Je[qe++];pe.push(it),Ue++;const at=it/o|0,Pt=[it-1,it+1,it-o,it+o];for(const mt of Pt)mt<0||mt>=u||E[mt]||(mt===it-1||mt===it+1)&&(mt/o|0)!==at||h[mt]&&(E[mt]=1,Je.push(mt))}Ue>L&&(L=Ue,A=pe)}if(!A||L<r.minArea||L>r.maxArea)return a||this.updateBackground(n,.02),Math.random()<.02&&me("[DETECTOR] No valid blob:",{bestArea:L,minArea:r.minArea,maxArea:r.maxArea,hasBlob:!!A,inGrace:r.inGrace}),null;let P=o,D=l,j=0,R=0,M=0,$=0;for(const fe of A){const pe=fe/o|0,Ue=fe-pe*o;M+=Ue,$+=pe,Ue<P&&(P=Ue),Ue>j&&(j=Ue),pe<D&&(D=pe),pe>R&&(R=pe)}M/=L,$/=L;let W=0,Y=0,ne=0;for(const fe of A){const pe=fe/o|0,qe=fe-pe*o-M,Je=pe-$;W+=qe*qe,Y+=Je*Je,ne+=qe*Je}W/=L,Y/=L,ne/=L;const xe=W+Y,ie=W*Y-ne*ne,je=Math.sqrt(Math.max(0,xe*xe/4-ie)),Ne=xe/2+je;let he=ne,ke=Ne-W;Math.hypot(he,ke)<1e-6&&(he=Ne-Y,ke=ne);const ae=Math.hypot(he,ke)||1;he/=ae,ke/=ae;const ve=M-this.roiCx,ye=$-this.roiCy,Te=Math.hypot(ve,ye),Ie=Math.max(8,this.roiRadius*.05);if(Te>=Ie){const fe=ve/Te,pe=ye/Te,Ue=Math.max(-1,Math.min(1,Math.abs(he*fe+ke*pe))),qe=Math.acos(Ue)*180/Math.PI;if(qe>r.angMaxDeg)return a||this.updateBackground(n,.02),me("[DETECTOR] Rejected - angle too large:",{angDeg:qe,maxAllowed:r.angMaxDeg,inGrace:r.inGrace}),null}let Ge=-1/0,Xe=1/0,Qe=M,tt=$,dt=M,Oe=$;for(const fe of A){const pe=fe/o|0,Ue=fe-pe*o,qe=(Ue-M)*he+(pe-$)*ke;qe>Ge&&(Ge=qe,Qe=Ue,tt=pe),qe<Xe&&(Xe=qe,dt=Ue,Oe=pe)}const $e=(fe,pe)=>{const Ue=fe-this.roiCx,qe=pe-this.roiCy;return Ue*Ue+qe*qe},B=$e(Qe,tt),z=$e(dt,Oe);let Ce,se;z<=B?(Ce=dt,se=Oe,Ge-Xe!==0&&(Ce-M)*he+(se-$)*ke>0&&(he=-he,ke=-ke)):(Ce=Qe,se=tt,(Ce-M)*he+(se-$)*ke>0&&(he=-he,ke=-ke));const ee=Ce-this.roiCx,be=se-this.roiCy,ht=ee*ee+be*be,Re=Math.max(1,j-P+1),C=Math.max(1,R-D+1),_=Re*C,V=L/_,te=Math.sqrt(ht)/Math.max(1,this.roiRadius);let de=.5;V<.45&&(de+=.2),V<.25&&(de+=.15),te<1.1&&(de+=.1);const ut=xe-Ne;return(Ne>0?1-ut/Ne:0)>.3&&(de+=.1),de=Math.max(0,Math.min(1,de)),this._isStable({x:Ce+.5,y:se+.5},L,r.requireStableN)?a?null:{tip:{x:Ce+.5,y:se+.5},axis:{x1:M-he*20,y1:$-ke*20,x2:M+he*20,y2:$+ke*20},area:L,bbox:{x:P,y:D,w:Re,h:C},confidence:de}:(me("[DETECTOR] Waiting for stability:",{stableCount:this.stableCount,needFrames:r.requireStableN,inGrace:r.inGrace}),null)}accept(n,s){if(this.lastAcceptTs=Date.now(),this.prevTip=null,this.prevArea=0,this.stableCount=0,!this.bg)return;const{width:a}=n,r=this.bg,{x:o,y:l,w:m,h:d}=s.bbox,u=.5;for(let h=l;h<l+d;h++)for(let x=o;x<o+m;x++){const f=h*a+x,S=f*4,k=n.data[S],p=n.data[S+1],w=n.data[S+2],v=.299*k+.587*p+.114*w;r[f]=(1-u)*r[f]+u*v}}_isStable(n,s,a){const r=(l,m)=>Math.hypot(l.x-m.x,l.y-m.y)<=6;if(!this.prevTip)return this.prevTip={...n},this.prevArea=s,this.stableCount=1,!1;if(r(this.prevTip,n)&&Math.abs(s-this.prevArea)/Math.max(1,s)<.3)this.prevTip={...n},this.prevArea=s,this.stableCount++;else return this.prevTip={...n},this.prevArea=s,this.stableCount=1,!1;const o=Math.max(1,a??this.requireStableN);return this.stableCount>=o}_dilate(n,s,a){const r=new Uint8Array(n.length);for(let o=0;o<a;o++)for(let l=0;l<s;l++){let m=0;for(let d=-1;d<=1;d++){for(let u=-1;u<=1;u++){const h=o+d,x=l+u;if(!(h<0||h>=a||x<0||x>=s)&&n[h*s+x]){m=1;break}}if(m)break}r[o*s+l]=m}n.set(r)}_erode(n,s,a){const r=new Uint8Array(n.length);for(let o=0;o<a;o++)for(let l=0;l<s;l++){let m=1;for(let d=-1;d<=1;d++){for(let u=-1;u<=1;u++){const h=o+d,x=l+u;if(!(h<0||h>=a||x<0||x>=s)&&!n[h*s+x]){m=0;break}}if(!m)break}r[o*s+l]=m}n.set(r)}}function qi({storageKey:t,children:n,className:s,defaultWidth:a=640,defaultHeight:r=360,minWidth:o=320,minHeight:l=200,maxWidth:m=1600,maxHeight:d=1200,autoFill:u=!1}){const[h,x]=i.useState(()=>{try{const E=localStorage.getItem(t);if(E)return JSON.parse(E)}catch{}return u?{width:a}:{width:a,height:r}}),f=i.useRef(null),S=i.useRef(null);i.useEffect(()=>{function E(){try{localStorage.removeItem(t)}catch{}x({width:a,height:r})}return window.addEventListener("ndn:layout-reset",E),window.addEventListener("ndn:camera-reset",E),()=>{window.removeEventListener("ndn:layout-reset",E),window.removeEventListener("ndn:camera-reset",E)}},[t,a,r]),i.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(h))}catch{}},[h,t]);function k(E,L,A){return Math.max(L,Math.min(A,E))}function p(E,L){E.preventDefault();const A=S.current;if(!A)return;const P=A.getBoundingClientRect();f.current={x:E.clientX,y:E.clientY,w:P.width,h:P.height,dir:L},window.addEventListener("mousemove",w),window.addEventListener("mouseup",v)}function w(E){const L=f.current;if(!L)return;const A=E.clientX-L.x,P=E.clientY-L.y;let D=L.w,j=L.h;L.dir.includes("e")&&(D=k(L.w+A,o,m)),!u&&L.dir.includes("s")&&(j=k(L.h+P,l,d)),L.dir.includes("w")&&(D=k(L.w-A,o,m)),!u&&L.dir.includes("n")&&(j=k(L.h-P,l,d)),x({width:Math.round(D),height:Math.round(j)})}function v(){window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",v),f.current=null}function g(E,L){const P=E.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"," "].includes(P))return;E.preventDefault();const D=P==="ArrowLeft"||P==="ArrowUp"?-20:20;x(j=>{const R=j.width||a,M=j.height||r;let $=R,W=M;return L.includes("e")&&($=k(R+D,o,m)),L.includes("w")&&($=k(R-D,o,m)),!u&&L.includes("s")&&(W=k(M+D,l,d)),!u&&L.includes("n")&&(W=k(M-D,l,d)),{width:Math.round($),height:Math.round(W)}})}const O={width:u?"100%":h.width?`${h.width}px`:void 0,height:u?"100%":h.height?`${h.height}px`:void 0,maxWidth:"100%",maxHeight:u?"100%":"80vh",position:"relative",...u?{display:"flex",flexDirection:"column",flex:"1 1 auto"}:{}};return e.jsxs("div",{ref:S,className:`${s||""}`,style:O,children:[n,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:E=>p(E,"nw"),role:"button",tabIndex:0,"aria-label":"Resize north-west",onKeyDown:E=>g(E,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:E=>p(E,"ne"),role:"button",tabIndex:0,"aria-label":"Resize north-east",onKeyDown:E=>g(E,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:E=>p(E,"sw"),role:"button",tabIndex:0,"aria-label":"Resize south-west",onKeyDown:E=>g(E,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:E=>p(E,"se"),role:"button",tabIndex:0,"aria-label":"Resize south-east",onKeyDown:E=>g(E,"se")})]})}const Xt=Bn(t=>({darts:0,total:0,entries:[],setVisit:(n,s,a)=>t({entries:n,darts:s,total:a}),reset:()=>t({darts:0,total:0,entries:[]})}));function zh({onClose:t,onQuit:n,onPause:s}){return wt.useEffect(()=>{const a=r=>{r.key==="Escape"&&t()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[t]),e.jsxs("div",{className:"fixed inset-0 z-[1200]",role:"presentation",children:[e.jsx("button",{className:"absolute inset-0 bg-black/50",onClick:t,"aria-label":"Close overlay"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsx(Fn,{returnFocus:!0,children:e.jsxs("div",{className:"card max-w-md w-full p-4 rounded-xl text-left",role:"dialog","aria-modal":"true","aria-labelledby":"pause-quit-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{id:"pause-quit-heading",className:"text-lg font-bold",children:"Quit or Pause ðŸŽ¯"}),e.jsx("button",{className:"btn px-3 py-1",onClick:t,"aria-label":"Close dialog",children:"âœ•"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"mb-2",children:"You can either quit the match, or pause it ðŸŽ¯."}),e.jsx("p",{className:"text-sm text-slate-400",children:"When paused, you'll choose a timer (1, 3, or 5 minutes). The match will automatically resume when the timer expires or when a player resumes early ðŸŽ¯."})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap mb-3",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1",onClick:()=>n(),children:"Quit match ðŸŽ¯"}),e.jsx("button",{className:"btn bg-amber-600 hover:bg-amber-700 px-3 py-1",onClick:()=>s(),children:"Pause match â¸ï¸"})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn btn--ghost px-3 py-1",onClick:t,children:"Cancel ðŸŽ¯"})})]})})})]})}function Gh(t){const n=Math.max(0,Math.floor(t/1e3)),s=Math.floor(n/60).toString().padStart(2,"0"),a=(n%60).toString().padStart(2,"0");return`${s}:${a}`}function pc({compact:t=!1}){const n=At(h=>h.pauseEndsAt),s=At(h=>h.pauseStartedAt),a=At(h=>h.paused),[r,o]=i.useState(Date.now());if(i.useEffect(()=>{if(!a||!n)return;const h=setInterval(()=>o(Date.now()),500);return()=>clearInterval(h)},[a,n]),!a||!n)return null;const l=Math.max(0,n-r),d=Math.max(1,n-(s??r)),u=Math.max(0,Math.min(1,1-l/d));return e.jsxs("div",{className:"mr-2",role:"status","aria-live":"polite","aria-atomic":"true","aria-label":`Match paused, ${Math.ceil(l/1e3)} seconds remaining`,children:[e.jsxs("div",{className:`px-2 py-1 rounded-full bg-amber-600 text-black text-xs font-semibold ${t?"":"mr-2"}`,children:["Paused ",Gh(l)," ðŸŽ¯"]}),!t&&e.jsx("div",{className:"w-40 h-2 bg-white/10 rounded overflow-hidden mt-1","aria-hidden":!0,children:e.jsx("div",{className:"h-2 bg-amber-400",style:{width:`${Math.round(u*100)}%`}})})]})}const gc="ndn:match-sync";function qh(){try{const t=gt.getState(),n=At.getState(),s={roomId:t.roomId,players:t.players,currentPlayerIdx:t.currentPlayerIdx,startingScore:t.startingScore,inProgress:t.inProgress,bestLegThisMatch:t.bestLegThisMatch,game:t.game??null,mode:t.mode??null,value:t.value??null};let a={};try{if(typeof localStorage<"u"){const o=localStorage.getItem("ndn:selectedMode");a.selectedMode=o||null}}catch{a={selectedMode:null}}const r={paused:n.paused,pauseEndsAt:n.pauseEndsAt??null,pauseStartedAt:n.pauseStartedAt??null};return{match:s,control:r,ui:a,ts:Date.now()}}catch{return null}}function Fr(){try{const t=qh();if(!t)return;localStorage.setItem(gc,JSON.stringify(t));try{Ht({type:"snapshot",state:t})}catch{}}catch{}}function Ji(){try{const t=localStorage.getItem(gc);if(!t)return null;const n=JSON.parse(t);return{match:n.match,control:n.control}}catch{return null}}const Jh={},Yh=4,Kh=250,Ba=400,Xh=800,Qh=1500,Zh=4500;const ta=10,Yi=8e3,Va=.8,$r=3,ef=4,tf=900,nf=2400,sf=24,af=6500,rf=!0,of=!1,lf=String(Jh?.VITE_CAMERA_VERBOSE_LOGS??"").trim().toLowerCase()==="1",na=(...t)=>{typeof t[0]=="string"&&(t[0].includes("starting detection")||t[0].includes("Exiting:")||t[0]==="[DETECTION] Effect running")&&console.log(...t),lf&&console.log(...t)};function cf(t,n){const s=Math.max(0,Math.min(255,n?.knee)),a=Math.max(0,Math.min(1,n?.strength)),r=t.data;for(let o=0;o<r.length;o+=4){const l=r[o],m=r[o+1],d=r[o+2],u=l*77+m*150+d*29>>8;if(u<=s)continue;const h=u-s,x=h/Math.max(1,255-s),f=u-a*h*x,S=u>0?f/u:1;r[o]=Math.max(0,Math.min(255,Math.round(l*S))),r[o+1]=Math.max(0,Math.min(255,Math.round(m*S))),r[o+2]=Math.max(0,Math.min(255,Math.round(d*S)))}}function Ki(t){const{videoW:n,videoH:s,calibW:a,calibH:r,fitMode:o}=t,l=n/a,m=s/r,d=n/s,u=a/r;let h=0,x=0;if(o==="fill"){if(d>u){const f=r*d;h=Math.max(0,(f-a)/2)}else if(d<u){const f=a/d;x=Math.max(0,(f-r)/2)}}else h=0,x=0;return{toCalibration:f=>{const S={x:f.x/l,y:f.y/m};return{x:S.x+h,y:S.y+x}}}}const bc=i.forwardRef(function({onVisitCommitted:n,showToolbar:s=!0,onAutoDart:a,immediateAutoCommit:r=!1,hideInlinePanels:o=!1,scoringMode:l="x01",onGenericDart:m,onGenericReplace:d,x01DoubleInOverride:u,onAddVisit:h,onEndLeg:x,cameraAutoCommit:f="camera",forceAutoStart:S=!1,disableDetection:k=!1,minimalControls:p=!1},w){const v=i.useRef(null),g=J(c=>c.preferredCameraId),O=J(c=>c.preferredCameraLabel),E=J(c=>c.autoscoreProvider),L=J(c=>c.autoscoreWsUrl),A=J(c=>c.cameraAspect),P=J(c=>c.cameraFitMode),D=J(c=>c.cameraScale),j=J(c=>c.cameraLowLatency)??!1,R=J(c=>c.cameraProcessingFps)??15;J(c=>c.autoCommitMode);const M=J(c=>c.confirmUncertainDarts)??!0,$=J(c=>c.autoScoreConfidenceThreshold)??Va,W=J(c=>c.autoscoreDetectorMinArea)??30,Y=J(c=>c.autoscoreDetectorThresh)??15,ne=J(c=>c.autoscoreDetectorRequireStableN)??2,xe=J(c=>c.harshLightingMode)??!1,ie=J(c=>c.enhanceBigTrebles)??!1,je=J(c=>c.cameraEnabled),Ne=J(c=>c.preferredCameraLocked),he=J(c=>c.hideCameraOverlay);J(c=>typeof c.cameraRecordDarts=="boolean"?c.cameraRecordDarts:!0),J(c=>typeof c.cameraShowLabels=="boolean"?c.cameraShowLabels:!1);const ke=J(c=>c.callerEnabled),ae=J(c=>c.speakCheckoutOnly),ve=J(c=>c.callerVoice),ye=J(c=>c.callerVolume),Te=J.getState().setPreferredCamera,Ie=J.getState().setCameraEnabled,Ge=J.getState().setHideCameraOverlay,Xe=J.getState().setCameraScale,Qe=J.getState().setCameraAspect,tt=J.getState().setCameraFitMode;J(c=>c.preserveCalibrationOverlay);const dt=!0,Oe=E==="manual"||k||!dt,[$e,B]=i.useState([]),z=i.useRef(g),Ce=i.useRef(null),se=i.useRef(null),ee=i.useRef(null),[be,ht]=i.useState(!1),[Re,C]=i.useState(!1),[_,V]=i.useState(!1),[te,de]=i.useState(null),[ut,Nt]=i.useState(null),X=$n(),fe=i.useCallback(c=>{v.current=c},[X]),pe=O==="Phone Camera",Ue=X.getMediaStream?.()||null,qe=X.isStreaming,Je=pe&&X.mode==="phone"&&qe&&!!Ue,it=be||qe||!1,[at,Pt]=i.useState(!1),mt=i.useRef(0),gn=i.useRef(!0);i.useEffect(()=>()=>{gn.current=!1},[]);const[Zt,bn]=i.useState(()=>typeof document>"u"?!0:!document.hidden);i.useEffect(()=>{if(typeof document>"u")return;const c=()=>bn(!document.hidden);return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[]),i.useEffect(()=>{const c=v.current,y=X.getMediaStream?.()||null;if(!(!c||!y))try{c.srcObject||(c.srcObject=y),typeof c.play=="function"&&Promise.resolve(c.play()).catch(()=>{})}catch{}},[X.isStreaming,X.mode,g]),i.useEffect(()=>{if(!je||pe&&Je)return;const c=!!X.getMediaStream?.();if(!c&&!be&&!at)try{Ct()}catch{}if(X.isStreaming&&!c&&!at){try{X.setStreaming(!1)}catch{}try{Ct()}catch{}}},[je,pe,Je,be,at,g]),i.useEffect(()=>{const c=v.current;if(!c)return;const y=()=>{try{const U=c.play();U&&typeof U.catch=="function"&&U.catch(()=>{})}catch{}},T=()=>{try{c.videoWidth&&c.videoHeight&&C(!0)}catch{}},I=()=>{try{c.videoWidth&&c.videoHeight&&C(!0)}catch{}};return c.addEventListener("loadedmetadata",y),c.addEventListener("playing",T),c.addEventListener("resize",I),()=>{c.removeEventListener("loadedmetadata",y),c.removeEventListener("playing",T),c.removeEventListener("resize",I)}},[]);const Tt=i.useCallback(c=>{const y=v.current,T=X.getMediaStream?.()||null,I=T?T.getVideoTracks():[],U=T?T.getAudioTracks():[];return{ts:Date.now(),hasVideoEl:!!y,video:{hasSrcObject:!!y?.srcObject,readyState:typeof y?.readyState=="number"?y.readyState:null,paused:typeof y?.paused=="boolean"?y.paused:null,ended:typeof y?.ended=="boolean"?y.ended:null,videoWidth:y?.videoWidth||0,videoHeight:y?.videoHeight||0},stream:{exists:!!T,videoTracks:I.length,audioTracks:U.length,videoTrackStates:I.map(G=>({enabled:G.enabled,muted:G.muted,readyState:G.readyState}))},session:{mode:X.mode,isStreaming:X.isStreaming},preferredCamera:{id:g,label:O,locked:Ne},error:c?.error??null}},[X,g,O,Ne]);i.useEffect(()=>{if(!_)return;let c=!0;const y=()=>{if(c)try{de(Tt())}catch{}};y();const T=window.setInterval(y,500);return()=>{c=!1,window.clearInterval(T)}},[_,Tt]),i.useEffect(()=>{try{window.__ndn_camera_debug=window.__ndn_camera_debug||{},window.__ndn_camera_debug.collect=()=>{try{return Tt({error:ut})}catch(c){return{error:String(c)}}},window.__ndn_camera_debug.videoEl=()=>v.current||null,window.__ndn_camera_debug.stream=()=>X.getMediaStream?.()||null}catch{}return()=>{try{window.__ndn_camera_debug&&delete window.__ndn_camera_debug.collect}catch{}}},[Tt,ut,X]),i.useLayoutEffect(()=>{if(!S)return;try{J.getState().setCameraEnabled(!0)}catch{}!!!X.getMediaStream?.()&&!be&&!at&&Ct()},[S]),i.useEffect(()=>{if(!je||S||pe&&Je)return;const c=!!X.getMediaStream?.();if(!c&&!be&&!at)try{Ct()}catch{}if(X.isStreaming&&!c&&!at){try{X.setStreaming(!1)}catch{}try{Ct()}catch{}}},[je,pe,Je,be,at,g,S]),i.useEffect(()=>{const c=y=>{me("[CAMERA] Received ndn:start-camera event",y.detail);try{Ie(!0)}catch{}!be&&!at&&Ct()};return window.addEventListener("ndn:start-camera",c),()=>window.removeEventListener("ndn:start-camera",c)},[be,at,Ie]);const{H:Ze,imageSize:we,overlaySize:b,theta:F,rotationOffsetRad:K,sectorOffset:Ye,_hydrated:rt,locked:It,errorPx:en}=Vh(),Vn=i.useRef("none"),Be=gt(c=>c),Hn=J(c=>c.user?.username),tn=!!(Be&&Be.roomId),as=12,pa=90,rs=typeof en=="number"?en:null,Ls=Hh(rs),os=!!Ze&&!!we&&(It||rs!=null&&rs<=as&&Ls!=null&&Ls>=pa),_t=tn?os:!!Ze&&!!we;i.useEffect(()=>{Ne&&!he&&Ge(!0)},[Ne,he,Ge]);const[zt,ga]=i.useState(""),[is,Rt]=i.useState(""),[Gt,ba]=i.useState(0),[nn,xa]=i.useState("MISS"),nr=i.useRef(null),wn=i.useRef({pending:!1,lastSeenTs:0,lastBullDistanceMm:null,lastTipVideoPx:null}),xn=i.useRef({sig:null,firstTs:0,lastTs:0,frames:0,lastTip:null}),[Ve,ft]=i.useState(0),ot=i.useRef(0),[Ft,pt]=i.useState(0),[Me,bt]=i.useState([]),[Eo,ls]=i.useState(!1),[Ps,sr]=i.useState(!1),vn=tn&&Me.some(c=>c.meta&&c.meta.source==="camera"&&!c.meta.calibrationValid),[N,re]=i.useState(0),[Le,xt]=i.useState(0),[lt,Nn]=i.useState(!1),_s=i.useRef(null),va=i.useRef(null),Fs=!0,[ar,rr]=i.useState(0),[xc,vc]=i.useState([]),vt=i.useRef(null),Sn=i.useRef([]),To=i.useRef(0),yc=i.useRef(null),ya=i.useRef([]),cs=i.useRef(!1),ds=i.useRef(0),$s=i.useRef(0),sn=i.useRef(!1),jn=i.useRef(null),Wn=i.useRef(0),Us=i.useRef(Number.NEGATIVE_INFINITY),an=i.useRef({lastTip:null,stableFrames:0}),us=i.useRef(0),wa=i.useRef(0),qt=i.useRef(0),zn=i.useRef(null),[zf,Ao]=i.useState([]),[Gf,wc]=i.useState(null),[qf,Nc]=i.useState(null),[Jf,Bs]=i.useState("idle"),[Yf,Na]=i.useState(null),[Do,Sc]=i.useState(!1),Vs=i.useRef({lastTs:0}),[,jc]=i.useState(0),Hs=i.useCallback(c=>{try{Vs.current={...Vs.current,...c,lastTs:Date.now()},Do&&jc(y=>(y+1)%1e5);try{window.ndnAutoscoreDiagnostics={...Vs.current,__build:{clientVersion:"autoscore-debug/v1",builtAt:new Date().toISOString()}}}catch{}}catch{}},[Do]);i.useEffect(()=>{try{const c=!!Ze,y=!!(we&&typeof we.w=="number"&&typeof we.h=="number"&&we.w>0&&we.h>0),T=y?`${Math.round(we.w)}x${Math.round(we.h)}`:"(none)";Hs({hasHomography:c,hasImageSize:y,imageSizeStr:T})}catch{}},[Ze,we,Hs]),i.useEffect(()=>{const c=y=>{try{if(String(y.key||"").toLowerCase()!=="d"||!(y.shiftKey&&(y.ctrlKey||y.metaKey)))return;y.preventDefault(),Sc(I=>!I)}catch{}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[]);const[rn,Gn]=i.useState(null),[Cc,kc]=i.useState(null),[Kf,Vt]=i.useState([]),[Ec,Tc]=i.useState(null),Ac=i.useCallback(c=>{try{if(!M)return!1;if(rn)return!0;const y=Number(c.confidence);if(!isFinite(y))return!1;const T=Math.max(.5,Math.min(.99,Number($)||Va));return y>=T?!1:(Gn({label:c.label,value:c.value,ring:c.ring,confidence:y,meta:c.meta}),!0)}catch{return!1}},[M,rn,$,Gn]),or=i.useRef(!1);i.useEffect(()=>{or.current=!1},[l]);const Sa=i.useCallback(()=>{va.current&&(clearTimeout(va.current),va.current=null)},[]),Mo=i.useCallback(c=>typeof c!="number"||Number.isNaN(c)?1:Math.min(3,Math.max(.5,Math.round(c*100)/100)),[]),ja=i.useCallback(c=>{if(!Xe)return;const y=Mo((D??1)+c);Xe(y)},[D,Mo,Xe]),Dc=i.useCallback(()=>{tt&&tt("fill"),Qe&&Qe("wide")},[tt,Qe]),Mc=i.useCallback(()=>{tt&&tt("fit"),Qe&&Qe("wide")},[tt,Qe]);i.useImperativeHandle(w,()=>({runDetectionTick:()=>{try{zn.current&&zn.current()}catch{}},__test_addDart:void 0,__test_commitVisit:void 0,runSelfTest:async()=>{try{return await Ic()}catch{return!1}},__test_forceSetPendingVisit:void 0}));const ms=i.useCallback(c=>{try{const T=ir();T&&(c.frame=T)}catch{}const y=[...Sn.current.slice(-8),c];Sn.current=y,Ao(y);try{wc(c)}catch{}try{window.ndnCameraDiagnostics=y}catch{}},[]),Ca=i.useCallback(()=>{try{const c=window.AudioContext||window.webkitAudioContext;if(!c)return;const y=new c,T=y.createOscillator(),I=y.createGain();T.type="sine",T.frequency.value=1e3,I.gain.value=.0015,T.connect(I),I.connect(y.destination),T.start(),setTimeout(()=>{try{T.stop(),y.close?.()}catch{}},120)}catch{}},[]),Ic=i.useCallback(async()=>{try{Bs("running"),Na(null),Sn.current=[],Ao([]);const c=6;for(let I=0;I<c;I++){try{zn.current&&zn.current()}catch{}await new Promise(U=>setTimeout(U,180))}const y=Sn.current.slice();y.some(I=>I.accepted||I.ready&&I.confidence>=($??Va))?(Bs("pass"),Na("Detection OK")):(Bs("fail"),Na(y.length?`No accepted detections (best confidence ${(y[y.length-1].confidence||0).toFixed(2)})`:"No detections"))}catch{Bs("fail"),Na("Self-test error")}finally{setTimeout(()=>Bs("idle"),3e3)}},[$]),ir=i.useCallback(()=>{try{const c=v.current;if(!c||!c.videoWidth||!c.videoHeight)return null;const y=640,T=Math.round(c.videoHeight/c.videoWidth*y)||360,I=document.createElement("canvas");I.width=y,I.height=T;const U=I.getContext("2d");return U?(U.drawImage(c,0,0,y,T),I.toDataURL("image/jpeg",.5)):null}catch{return null}},[]),Cn=i.useCallback(c=>{const y=_s.current;if(y){_s.current=null,Sa(),Nn(!1),Vt([]);try{const T=y.meta?.entries,I=T?.[T.length-1]?.meta?.bullDistanceMm;Xo(I)}catch{}if(n)try{n(y.score,y.darts,y.finished,y.meta);try{Ht({type:"visit",score:y.score,darts:y.darts,finished:y.finished,meta:y.meta,playerIdx:Be.currentPlayerIdx,ts:Date.now()});try{Fr()}catch{}try{const T=ir();Nc({ts:Date.now(),score:y.score,darts:y.darts,frame:T})}catch{}}catch{}}catch{}}},[n,Sa]),kn=i.useCallback(c=>{n&&(_s.current=c,Nn(!0),Sa(),va.current=window.setTimeout(()=>Cn("timeout"),af))},[n,Fs,Sa,Cn,Xo,Gs]),ka=i.useCallback(c=>{ft(0),ot.current=0,pt(0),bt([]),Vt([]),re(0),xt(0),jt(!1);try{window.dispatchEvent(new CustomEvent("ndn:clear-visit-request",{detail:{source:"camera-view",reason:c,ts:Date.now()}}))}catch{}},[]);i.useEffect(()=>{const c=()=>Cn("event");return window.addEventListener("ndn:darts-cleared",c),()=>window.removeEventListener("ndn:darts-cleared",c)},[Fs,Cn]),i.useEffect(()=>{},[Fs,Cn]),i.useEffect(()=>()=>Cn("teardown"),[Cn]);const Rc=i.useCallback(()=>{ka("indicator"),rr(c=>c+1)},[ka]),Oc=i.useCallback(()=>{Ve===0&&Ft===0||(ka("toolbar"),rr(c=>c+1))},[ka,Ve,Ft]),Lc=i.useCallback(()=>{if(!Oe)try{window.dispatchEvent(new CustomEvent("ndn:open-camera-manager",{detail:{source:"camera-view",ts:Date.now()}}))}catch(c){console.warn("[CameraView] Failed to request camera manager:",c)}},[Oe]),Pc=J(c=>c.x01DoubleIn),hs=typeof u=="boolean"?!!u:!!Pc,[_c,Io]=i.useState({}),Ea=Be.players[Be.currentPlayerIdx]?.id,fs=!!(Ea&&_c[Ea]),Ro=c=>{Ea&&Io(y=>({...y,[Ea]:c}))},lr=Be?.inProgress,Oo=Xt(c=>c.setVisit),Lo=Xt(c=>c.reset);i.useEffect(()=>{try{Oo(Me,Ve,Ft);try{const c={type:"pendingVisit",entries:Me,darts:Ve,total:Ft,playerIdx:Be.currentPlayerIdx,ts:Date.now()};try{const y=v.current;if(y&&y.videoWidth&&y.videoHeight){const I=Math.round(y.videoHeight/y.videoWidth*320)||180,U=document.createElement("canvas");U.width=320,U.height=I;const G=U.getContext("2d");if(G){G.drawImage(y,0,0,320,I);try{c.frame=U.toDataURL("image/jpeg",.45)}catch{}}}}catch{}Ht(c)}catch{}}catch{}},[Me,Ve,Ft,Oo]),i.useEffect(()=>()=>{try{Lo()}catch{}},[Lo]);const Fc=gt(c=>c.addVisit),$c=gt(c=>c.endLeg),Ws=i.useCallback(c=>{try{return Array.isArray(c)?c.slice(0,3).map(y=>({label:String(y?.label??""),value:Number(y?.value??0),ring:String(y?.ring??"")})):void 0}catch{return}},[]),En=(c,y,T)=>{try{me("CameraView: callAddVisit",c,y,T);try{Tc({score:c,darts:y,expires:Date.now()+2e3})}catch{}h?h(c,y,T):Fc(c,y,T);try{Ht({type:"visit",score:c,darts:y,playerIdx:Be.currentPlayerIdx,ts:Date.now()});try{Fr()}catch{}}catch{}}catch{}},Po=c=>{try{x?x(c):$c(typeof c=="number"?c:0)}catch{}},[Ta,Uc]=i.useState(""),[ps,$t]=i.useState(0),[,gs]=i.useState(!1),[bs,jt]=i.useState(!1),[Xf,_o]=i.useState(!1),[Bc,qn]=i.useState("manual"),[cr,Jn]=i.useState(!1),[,Fo]=i.useState(!1),[Vc,$o]=i.useState(!1),Uo=i.useRef(null),zs=J(c=>c.dartTimerEnabled),dr=J(c=>c.dartTimerSeconds)||10,[xs,ur]=i.useState(null),on=i.useRef(null),Tn=At(c=>c.paused),An=i.useRef(null),Dn=i.useRef(null),Bo=i.useRef(0),Vo=i.useRef(null),Ho=i.useRef(0),Wo=i.useRef(null),zo=i.useRef(0),mr=i.useRef(!1),vs=i.useRef(null),[Go]=i.useState(0),Aa=i.useCallback(()=>{try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{source:"camera-view",ts:Date.now()}}))}catch(c){console.warn("[CameraView] Phone camera reconnect dispatch failed:",c)}},[]);i.useEffect(()=>{const c=()=>{Oe||Fo(!0)};return window.addEventListener("ndn:open-autoscore",c),()=>window.removeEventListener("ndn:open-autoscore",c)},[dt,Oe]),i.useEffect(()=>()=>{try{vs.current&&clearTimeout(vs.current)}catch{}},[]),i.useEffect(()=>{const c=()=>$o(!0);return window.addEventListener("ndn:open-scoring",c),()=>window.removeEventListener("ndn:open-scoring",c)},[]),i.useEffect(()=>{const c=()=>{rr(y=>y+1),ft(0),ot.current=0,pt(0),bt([]),Vt([]),re(0),xt(0),jt(!1)};return window.addEventListener("ndn:darts-cleared",c),()=>window.removeEventListener("ndn:darts-cleared",c)},[]),i.useEffect(()=>{vc(c=>{if(Me.length>c.length){const y=Me.length-c.length;return[...c,...Array(y).fill(ar)]}return Me.length<c.length?c.slice(0,Me.length):c})},[Me,ar]),i.useEffect(()=>{if(jn.current&&(clearTimeout(jn.current),jn.current=null),Oe){sn.current=!1,$s.current=0,vt.current=null;return}return it?($s.current=performance.now(),vt.current=null,sn.current=!1,qt.current=0,jn.current=window.setTimeout(()=>{sn.current=!0,jn.current=null},Qh)):($s.current=0,vt.current=null,sn.current=!1,qt.current=0),()=>{jn.current&&(clearTimeout(jn.current),jn.current=null),sn.current=!1,qt.current=0,zn.current=null}},[it,Oe]),i.useEffect(()=>{let c=!0;async function y(){try{if(!navigator?.mediaDevices?.enumerateDevices)return;const T=await navigator.mediaDevices.enumerateDevices();if(!c)return;B(T.filter(I=>I.kind==="videoinput"))}catch(T){console.warn("[CAMERA] enumerateDevices failed:",T)}}y();try{navigator.mediaDevices.addEventListener("devicechange",y)}catch{try{navigator.mediaDevices.ondevicechange=y}catch{}}return()=>{c=!1;try{navigator.mediaDevices.removeEventListener("devicechange",y)}catch{}}},[]),i.useEffect(()=>{const c=()=>{qn("manual"),Jn(!0)},y=()=>{qn("manual"),Jn(!1)};return window.addEventListener("ndn:open-manual",c),window.addEventListener("ndn:close-manual",y),()=>{window.removeEventListener("ndn:open-manual",c),window.removeEventListener("ndn:close-manual",y)}},[]),i.useEffect(()=>{Oe&&(qn("manual"),Fo(!1))},[Oe]),i.useEffect(()=>{try{const c=Be.players[Be.currentPlayerIdx],y=c?.legs?.[c.legs.length-1];if(!c)return;(!y||y.dartsThrown===0)&&Io(T=>({...T,[c.id]:!1}))}catch{}},[Be.currentPlayerIdx,Be.players?.[Be.currentPlayerIdx]?.legs?.length]),i.useEffect(()=>{const c=!!zs&&lr&&!Tn&&Ve<3;if(on.current&&(clearInterval(on.current),on.current=null),!c){ur(null);return}return ur(dr),on.current=window.setInterval(()=>{ur(y=>{const T=(y??dr)-1;if(T<=0){try{const I=ot.current||0,U=Math.max(0,3-I);for(let G=0;G<U;G++)Mn(0,"MISS 0","MISS")}catch{}return on.current&&(clearInterval(on.current),on.current=null),0}return T})},1e3),()=>{on.current&&(clearInterval(on.current),on.current=null)}},[zs,dr,Ve,Be.currentPlayerIdx,Be?.inProgress,Tn]),i.useEffect(()=>{if(!cr)return;const c=setInterval(()=>{try{const y=v.current,T=Uo.current;if(!y||!T)return;const I=y.videoWidth||0,U=y.videoHeight||0;if(!I||!U)return;const G=T.clientWidth||640,le=T.clientHeight||360,Q=Math.max(1,Math.round((window.devicePixelRatio||1)*100)/100),Z=Math.floor(G*Q),Fe=Math.floor(le*Q);T.width!==Z&&(T.width=Z),T.height!==Fe&&(T.height=Fe);const q=T.getContext("2d");if(!q)return;q.imageSmoothingEnabled=!0;try{q.setTransform(Q,0,0,Q,0,0)}catch{}const ge=Math.min(G/I,le/U),Ee=Math.round(I*ge),H=Math.round(U*ge),oe=Math.floor((G-Ee)/2),Ke=Math.floor((le-H)/2);q.fillStyle="#000",q.fillRect(0,0,G,le),q.drawImage(y,oe,Ke,Ee,H)}catch(y){console.warn("Manual preview update error:",y)}},120);return()=>clearInterval(c)},[cr]),i.useEffect(()=>()=>{},[]);const qo=pe&&!Je;async function Ct(){const c=X.getMediaStream?.()||(v.current?.srcObject??null),y=(()=>{try{const I=c;if(!I)return!1;const U=I.getVideoTracks;return typeof U!="function"?!1:!!U.call(I)?.length}catch{return!1}})();if(at||be&&y)return;if(pe&&Je&&(c?.getVideoTracks?.()||[]).some(G=>G.readyState==="live")){Pt(!1);try{X.setStarting?.(!1)}catch{}return}Pt(!0);try{X.setStarting?.(!0)}catch{}try{Nt(null)}catch{}const T=async I=>{if(!I||I.kind!=="video"||!(xe||typeof window<"u"&&window.localStorage?.getItem("ndn.glareClamp")==="1"))return;const G=I.getCapabilities?.()||{},le=Z=>Z in G,Q={...le("exposureMode")?{exposureMode:"continuous"}:{},...le("whiteBalanceMode")?{whiteBalanceMode:"continuous"}:{},...le("focusMode")?{focusMode:"continuous"}:{},...le("sharpness")?{sharpness:G.sharpness?.max}:{},...le("contrast")?{contrast:G.contrast?.max}:{},...le("backlightCompensation")?{backlightCompensation:!1}:{}};if(Object.keys(Q).length)try{await I.applyConstraints(Q),me("[CAMERA] Applied anti-glare track constraints:",Q)}catch(Z){console.warn("[CAMERA] Anti-glare track constraints not supported:",Z)}};try{const I={width:{ideal:3840},height:{ideal:2160},frameRate:{ideal:30}},U={width:{ideal:2560},height:{ideal:1440},frameRate:{ideal:30}},G={width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},le={width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},Q=g?{deviceId:{exact:g}}:{facingMode:"environment"},Z=async(q,ge)=>{const Ee={video:{...Q,...q},audio:!1};return me(`[CAMERA] Using constraints (${ge}):`,Ee),navigator.mediaDevices.getUserMedia(Ee)};let Fe;try{const q=j?{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:60}}:{width:{ideal:3840},height:{ideal:2160},frameRate:{ideal:30}};try{Fe=await Z(q,"dynamic-best-effort")}catch(ge){me("[CAMERA] Dynamic hints failed, trying basic 1080p fallback:",ge),Fe=await Z(G,"1080p-fallback")}me("[CAMERA] Got stream:",!!Fe)}catch(q){console.warn("[CAMERA] First attempt failed:",q);const ge=q&&(q.name||q.code)||"";if(g&&(ge==="OverconstrainedError"||ge==="NotFoundError"))me("[CAMERA] Trying fallback without deviceId"),Fe=await navigator.mediaDevices.getUserMedia({video:{...U},audio:!1});else if(!g&&(ge==="OverconstrainedError"||ge==="NotFoundError"||ge==="NotSupportedError"))me("[CAMERA] Trying fallback for facingMode not supported"),Fe=await navigator.mediaDevices.getUserMedia({video:{...U},audio:!1});else throw q}if(v.current){me("[CAMERA] Setting stream to video element"),v.current.srcObject=Fe;try{const ge=Fe?.getVideoTracks?.()?.[0];T(ge)}catch{}try{X.setMediaStream?.(Fe),X.setMode?.("local"),X.setStreaming?.(!0),X.setStarting?.(!1)}catch(ge){console.warn("[CAMERA] Failed to sync camera session with local stream:",ge)}try{v.current.addEventListener("loadeddata",()=>me("[CAMERA] Video loadeddata")),v.current.addEventListener("loadedmetadata",()=>{me("[CAMERA] Video loadedmetadata - dimensions available"),v.current?.videoWidth&&v.current?.videoHeight&&C(!0)}),v.current.addEventListener("canplay",()=>{me("[CAMERA] Video canplay"),v.current?.videoWidth&&v.current?.videoHeight&&C(!0)}),v.current.addEventListener("play",()=>me("[CAMERA] Video started playing")),v.current.addEventListener("error",ge=>console.error("[CAMERA] Video error:",ge))}catch{}let q=null;try{if(q=await ha({video:v.current,stream:Fe,onPlayError:ge=>console.error("[CAMERA] Video play failed:",ge)}),q.played){me("[CAMERA] Video play ensured");try{mt.current=0}catch{}try{const ge=X.getVideoElementRef?.();(!ge||ge===v.current)&&X.setVideoElementRef?.(v.current)}catch{}try{(async()=>{for(let H=0;H<3;H++)try{if(v.current?.videoWidth&&v.current?.videoHeight)return C(!0),!0;me(`[CAMERA] play succeeded but no dimensions yet, reattach attempt ${H+1}`);try{v.current&&(v.current.srcObject=null)}catch{}await new Promise(oe=>setTimeout(oe,120+H*80));try{v.current&&(v.current.srcObject=Fe)}catch{}try{(await ha({video:v.current,stream:Fe,onPlayError:Ke=>console.error("[CAMERA] reattach play failed:",Ke)})).played&&me("[CAMERA] reattach play confirmed")}catch(oe){me("[CAMERA] reattach ensureVideoPlays threw:",oe)}await new Promise(oe=>setTimeout(oe,220+H*60))}catch(oe){me("[CAMERA] attach retry error:",oe)}return!1})().then(Ee=>{Ee||me("[CAMERA] attach/replay retries exhausted")})}catch{}}else console.warn("[CAMERA] ensureVideoPlays did not confirm playback:",q?.reason)}catch(ge){console.error("[CAMERA] ensureVideoPlays failed:",ge)}try{if(!!!(q&&q.played)){const H=mt.current??0;if(H<3&&gn.current){mt.current=H+1;const oe=700*Math.pow(2,H);me("[CAMERA] Scheduling camera restart retry",mt.current,"in",oe,"ms"),setTimeout(async()=>{try{if(!gn.current)return;Yn(),await new Promise(Ke=>setTimeout(Ke,120)),await Ct()}catch(Ke){me("[CAMERA] Retry attempt failed:",Ke)}},oe)}else me("[CAMERA] Max camera retries reached or unmounted; not retrying")}}catch{}if(me("[CAMERA] Stream tracks:",Fe.getTracks().length,"video tracks:",Fe.getVideoTracks().length),pe)try{X.setMediaStream?.(Fe),q?.played&&X.setVideoElementRef?.(v.current)}catch{}}else console.error("[CAMERA] Video element not found");ht(!0);try{Nt(null)}catch{}try{const q=await navigator.mediaDevices.enumerateDevices();B(q.filter(ge=>ge.kind==="videoinput")),me("[CAMERA] Found cameras:",q.filter(ge=>ge.kind==="videoinput").length)}catch(q){console.warn("[CAMERA] Failed to enumerate devices:",q)}}catch(I){console.error("[CAMERA] Camera start failed:",I);const U=I?.name||I?.code||"";Nt(U==="NotAllowedError"||U==="SecurityError"?"permission-denied":U==="NotFoundError"||U==="OverconstrainedError"?"not-found":U==="NotSupportedError"?"not-supported":"unknown"),Pt(!1);try{X.setStarting?.(!1)}catch{}}finally{Pt(!1);try{X.setStarting?.(!1)}catch{}}}function Yn(){try{const c=X.getMediaStream?.()||null;c&&c.getTracks().forEach(y=>y.stop())}catch{}if(v.current)try{v.current.srcObject=null}catch{}try{X.setMediaStream?.(null),X.setStreaming?.(!1),X.setVideoElementRef?.(null)}catch{}ht(!1),Pt(!1)}i.useEffect(()=>{if(z.current===g||(z.current=g,!je||at||!be))return;let c=!1;return(async()=>{if(Yn(),await new Promise(T=>setTimeout(T,150)),!c)try{await Ct()}catch{}})(),()=>{c=!0}},[g,je,at,be]),i.useEffect(()=>{const c=v.current;if(!c)return;const y=X.getMediaStream?.()||null,I=(X.getVideoElementRef?.()||null)?.srcObject||null,U=y||I;if(U){c.srcObject!==U&&(c.srcObject=U),c.muted=!0,c.playsInline=!0;try{Promise.resolve(c.play()).catch(()=>{})}catch{}be||ht(!0)}},[X.mode,X.isStreaming,be,X]),i.useEffect(()=>{if(_)try{de(Tt({error:ut}))}catch{}},[_,ut,Tt]),i.useEffect(()=>{let c=null,y=!0,T=!1,I=0,U=null,G=0;const le=18;se.current,v.current;function Q(){c!=null&&(cancelAnimationFrame(c),c=null)}function Z(){try{const Ee=performance&&performance.now&&performance.now()||Date.now(),H=1e3/le;if(Ee-G<H){c=requestAnimationFrame(Z);return}G=Ee}catch{}try{const Ee=v.current,H=se.current;if(!y||!Ee||!H)return Q();const oe=Ee.videoWidth||0,Ke=Ee.videoHeight||0;if(oe<=0||Ke<=0){c=requestAnimationFrame(Z);return}try{if(!T){try{Xa("CameraView: preview-canvas fallback activated")}catch{}T=!0}H.style.visibility!=="visible"&&(H.style.visibility="visible")}catch{}const He=H.getBoundingClientRect(),Pe=Math.max(1,Math.round(He.width)),Ae=Math.max(1,Math.round(He.height));(H.width!==Pe||H.height!==Ae)&&(H.width=Pe,H.height=Ae);const et=H.getContext("2d");if(!et)return Q();try{et.clearRect(0,0,H.width,H.height),et.drawImage(Ee,0,0,H.width,H.height)}catch{}c=requestAnimationFrame(Z)}catch{Q()}}const Fe=()=>{const Ee=v.current,H=se.current;if(!Ee||!H)return;const oe=!!(Ee.videoWidth&&Ee.videoHeight),Ke=Ee.readyState===0||Ee.readyState<2;try{if(typeof window<"u"){const He=window.localStorage.getItem("ndn:forceCanvasFallback");if(He==="1"||He==="true"){try{console.info("CameraView: forced canvas fallback via localStorage")}catch{}Q(),c=requestAnimationFrame(Z);return}}}catch{}if(oe&&Ke)Q(),c=requestAnimationFrame(Z);else try{se.current&&(se.current.style.visibility="hidden")}catch{}};(()=>{try{if(typeof document>"u")return;const Ee=document.createElement("canvas"),H=32,oe=32;Ee.width=H,Ee.height=oe;const Ke=Ee.getContext("2d",{willReadFrequently:!0});if(!Ke)return;U=window.setInterval(()=>{try{const He=v.current;if(!He||He.videoWidth===0||He.videoHeight===0){I=0;return}Ke.clearRect(0,0,H,oe),Ke.drawImage(He,0,0,H,oe);const Pe=Ke.getImageData(0,0,H,oe).data;let Ae=0;for(let kt=0;kt<Pe.length;kt+=4)Ae+=.299*Pe[kt]+.587*Pe[kt+1]+.114*Pe[kt+2];if(Ae/(H*oe*255)<.02?I+=1:I=0,I>=3){try{Xa("CameraView: video surface appears blank; enabling canvas fallback")}catch{}I=0,Q(),c=requestAnimationFrame(Z)}}catch{}},300)}catch{}})(),Fe();const ge=setInterval(()=>Fe(),400);return()=>{y=!1,Q(),clearInterval(ge);try{U&&clearInterval(U)}catch{}}},[v,se]);async function hr(){try{if(!navigator?.mediaDevices?.enumerateDevices){Nt("not-supported");return}const c=await navigator.mediaDevices.enumerateDevices();B(c.filter(y=>y.kind==="videoinput"))}catch(c){console.warn("[CAMERA] enumerateDevices failed:",c)}}function Jo(){const[c,y]=i.useState(""),T=async I=>{if(at)return;const U=$e.find(G=>G.deviceId===I)?.label;Te(I||void 0,U||"",!0),Yn(),await new Promise(G=>setTimeout(G,150));try{await Ct()}catch{}};return e.jsxs("div",{className:"camera-selector absolute bottom-2 right-2 z-20 flex items-center gap-2 bg-black/60 backdrop-blur-sm rounded-lg px-2 py-1.5 text-xs",children:[e.jsx("span",{className:"hidden sm:inline",children:"Cam:"}),e.jsxs("select",{onPointerDown:I=>{I.stopPropagation()},onMouseDown:I=>{I.stopPropagation()},onTouchStart:I=>{I.stopPropagation?.()},className:"bg-black/30 rounded px-1.5 py-1 min-h-[2rem] text-xs sm:text-xs",value:g||"",onChange:async I=>{if(at)return;const U=I.target.value||void 0,G=$e.find(le=>le.deviceId===U)?.label;Te(U,G||"",!0),Yn(),await new Promise(le=>setTimeout(le,150));try{await Ct()}catch(le){console.warn("Failed to start camera after device switch:",le),setTimeout(async()=>{try{await Ct()}catch(Q){console.error("Camera switch failed after retry:",Q),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),e.jsx("option",{value:"manual",children:"~ Enter device ID ..."}),$e.map(I=>e.jsx("option",{value:I.deviceId,children:I.label||(I.deviceId?`Camera (${I.deviceId.slice(0,6)})`:"Camera")},I.deviceId))]}),g==="manual"&&e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("input",{className:"input input--small",placeholder:"Device ID",value:c,onChange:I=>y(I.target.value)}),e.jsx("button",{className:"btn btn--ghost btn-sm",onClick:()=>T(c||void 0),children:"Apply"})]}),$e.length===0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-yellow-300",children:"No cameras found"}),e.jsx("button",{className:"btn btn--ghost btn-sm ml-2",onClick:hr,title:"Refresh camera list",children:"Refresh"})]}),ut==="permission-denied"&&e.jsx("div",{className:"ml-2 text-xs text-rose-300",children:"Camera permission denied. Allow camera access in your browser site settings, then click Rescan."}),e.jsx("button",{className:"btn btn--ghost btn-sm ml-2",onClick:async()=>{try{await hr()}catch(I){console.warn("Rescan failed:",I)}},title:"Rescan connected cameras",children:"Rescan"}),e.jsx("button",{className:`btn btn--ghost btn-sm ml-1 px-2 py-0.5 text-[10px] ${Ne?"text-emerald-300":"text-white/60"}`,onClick:()=>{const I=!Ne;J.getState().setPreferredCameraLocked(I)},title:Ne?"Camera locked â€” click to unlock":"Lock camera selection",children:Ne?"ðŸ”’":"ðŸ”“"}),_&&e.jsxs("div",{className:"mt-2 ml-1 text-xs rounded-lg border border-white/10 bg-black/30 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"font-semibold",children:"Video diagnostics"}),e.jsx("div",{className:"opacity-60 text-xxs",children:te?.ts?new Date(te.ts).toLocaleTimeString():""})]}),e.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-x-3 gap-y-1",children:[e.jsx("div",{className:"opacity-70",children:"preferred"}),e.jsxs("div",{className:"break-all",children:[O||"(none)"," ",g?`(${g})`:""]}),e.jsx("div",{className:"opacity-70",children:"session"}),e.jsxs("div",{children:["mode=",String(te?.session?.mode??"?")," stream=",String(te?.session?.isStreaming??"?")]}),e.jsx("div",{className:"opacity-70",children:"video el"}),e.jsxs("div",{children:["srcObject=",String(te?.video?.hasSrcObject??!1)," rs=",String(te?.video?.readyState??"?")," paused=",String(te?.video?.paused??"?")]}),e.jsx("div",{className:"opacity-70",children:"dimensions"}),e.jsxs("div",{children:[te?.video?.videoWidth??0,"ï¿½",te?.video?.videoHeight??0]}),e.jsx("div",{className:"opacity-70",children:"tracks"}),e.jsxs("div",{children:["v=",te?.stream?.videoTracks??0," a=",te?.stream?.audioTracks??0]})]}),te?.stream?.videoTrackStates?.length?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"opacity-70",children:"video track state"}),e.jsx("div",{className:"mt-1 space-y-1",children:te.stream.videoTrackStates.map((I,U)=>e.jsxs("div",{className:"text-xxs opacity-90",children:["#",U," ready=",I.readyState," enabled=",String(I.enabled),typeof I.muted=="boolean"?` muted=${String(I.muted)}`:""]},U))})]}):null,te?.error?e.jsxs("div",{className:"mt-2 text-xxs text-rose-200",children:["cameraAccessError=",String(te.error)]}):null,e.jsx("div",{className:"mt-2 text-xxs opacity-60",children:"If dims stay 0ï¿½0 but tracks>0, the video element isn't receiving frames (often a virtual cam / autoplay / stream ownership issue). If tracks=0, getUserMedia succeeded but no video track is being delivered."})]})]})}i.useEffect(()=>{},[Ze,we,it,Oe,pe,Ne,he,Zt,Cc,Ec]),i.useEffect(()=>{if(na("[DETECTION] Effect running",{manualOnly:Oe,autoscoreProvider:E,videoReady:Re,hasH:!!Ze,hasImageSize:!!we,hasVideoRef:!!v.current,videoWidth:v.current?.videoWidth,videoHeight:v.current?.videoHeight}),!Zt)return;if(Oe){console.log("[DETECTION] Exiting: TEST_MODE or manualOnly (provider="+E+")");return}if(E!=="built-in"&&E!=="built-in-v2"){na("[DETECTION] Exiting: autoscoreProvider is",E);return}const c=$n.getState(),y=J.getState().preferredCameraLabel,T=y==="Phone Camera",I=c.getVideoElementRef?.()||null,U=c.getMediaStream?.()||null,G=!!c.isStreaming,le=v.current;let Z=!!(I&&I.videoWidth>0&&I.videoHeight>0)?I:le;!Z&&I&&(Z=I);try{G&&U&&Z&&!Z.srcObject&&(Z.srcObject=U,typeof Z.play=="function"&&Promise.resolve(Z.play()).catch(()=>{}))}catch{}if(!Z){na("[DETECTION] Exiting: no sourceVideo",{preferredLabel:y,isPhone:T,phoneFeedActive:Je,sessionStreaming:G,cameraSessionMode:c?.mode,hasSessionVideo:!!I,hasLocalVideo:!!v.current});return}if(!Z.videoWidth||!Z.videoHeight){const Pe=performance.now();let Ae=!1;const et=()=>{if(Ae)return;const kt=Z?.videoWidth||0,ln=Z?.videoHeight||0;if(kt&&ln){try{C(!0)}catch{}return}if(performance.now()-Pe>2e3){na("[DETECTION] Exiting: video has no dimensions yet (after retries)",{vw:kt,vh:ln,preferredLabel:y,hasSrcObject:!!Z?.srcObject,readyState:Z?.readyState});return}window.setTimeout(et,120)};return window.setTimeout(et,60),()=>{Ae=!0}}if(!Re)try{C(!0)}catch{}if(!Ze||!we){console.log("[DETECTION] Exiting: no H or imageSize (calibration missing)");return}console.log("[DETECTION] ? All conditions met, starting detection loop! Provider:",E);let Fe=!1;const q=Z,ge=q.videoWidth||0,Ee=q.videoHeight||0,H=Ce.current;if(!H)return;const oe=An._sizeRef||(An._sizeRef={w:0,h:0});if(!An.current||ge>0&&Ee>0&&(oe.w!==ge||oe.h!==Ee)){let Pe=W,Ae=Y,et=ne,kt=70;const ln=ge*Ee;ge>0&&Ee>0&&ln<1280*720&&(Pe=Math.min(Pe,20),Ae=Math.min(Ae,14),et=Math.min(et,2)),ge>0&&Ee>0&&ln>=1920*1080&&(kt=82,et=Math.max(et,2)),An.current=new Wh({minArea:Pe,thresh:Ae,requireStableN:et,angMaxDeg:kt}),oe.w=ge,oe.h=Ee}try{const Pe=`${It?1:0}|${we?.w??0}x${we?.h??0}|${Ze?.[0]?.[0]??Ze?.a??"H"}`;if(Pe!==Vn.current){Vn.current=Pe;const Ae=An.current;Ae&&typeof Ae.setTemporaryOverrides=="function"&&(Ae.setTemporaryOverrides({requireStableN:1,angMaxDeg:90},Yi),na("[DETECTION] Applied post-calibration grace window",{ms:Yi}))}}catch{}const He=()=>{try{const Ae=performance.now(),et=1e3/(R||15);if(Ae-Bo.current<et){Dn.current=requestAnimationFrame(He),zn.current=He;return}Bo.current=Ae}catch{}let Pe=!1;if(!Fe){try{const Ae=q.videoWidth||0,et=q.videoHeight||0;if(!Ae||!et){Dn.current=requestAnimationFrame(He);return}H.width!==Ae&&(H.width=Ae),H.height!==et&&(H.height=et);const kt=H.getContext("2d",{willReadFrequently:!0});if(!kt){Dn.current=requestAnimationFrame(He);return}kt.drawImage(q,0,0,Ae,et);const ln=kt.getImageData(0,0,Ae,et);(xe||typeof window<"u"&&window.localStorage?.getItem("ndn.glareClamp")==="1")&&cf(ln,{knee:212,strength:.72}),qt.current++;const ni=Un(Ze,{x:0,y:0}),si=Un(Ze,{x:Wt.doubleOuter,y:0}),Jc=P==="fill"?"fill":"fit",Yc=Ki({videoW:Ae,videoH:et,calibW:we.w,calibH:we.h,fitMode:Jc}),ai=Ae/we.w,ri=et/we.h,oi=ni.x*ai,ii=ni.y*ri,Kc=si.x*ai,Xc=si.y*ri,Qc=Math.hypot(Kc-oi,Xc-ii)*1.08,gr=An.current;Go>=0&&gr.setROI(oi,ii,Math.max(24,Math.min(Math.max(Ae,et),Qc)));const br=(ot.current||0)<3;{const nt=!Tn,We=br,Ia=sn.current,St=qt.current>ta;me("CameraView: detection conditions",{condPaused:nt,condPending:We,condArmed:Ia,condFrame:St,frameCount:qt.current,minFrames:ta,pendingDartsRef:ot.current})}if(!Tn&&br&&sn.current&&qt.current>ta){qt.current%150===0&&console.log("[DETECTION] Loop active & branching",{paused:Tn,visitHasRoom:br,detectionArmed:sn.current,frames:qt.current}),me("CameraView: entering detection branch",{paused:Tn,pendingDarts:Ve,detectionArmed:sn.current,frameCount:qt.current,DETECTION_MIN_FRAMES:ta});const nt=gr.detect(ln);me("CameraView: raw detection",nt);const We=performance.now();if(cs.current){if(nt)ds.current=0;else if(ds.current||(ds.current=We),We-ds.current>=3e3){cs.current=!1,ds.current=0,yc.current=null,ya.current=[];try{window.dispatchEvent(new CustomEvent("ndn:darts-cleared",{detail:{source:"camera-view",ts:Date.now()}}))}catch{}}}nt?(wa.current=(wa.current||0)+1,us.current||(us.current=We,Wn.current=We,Us.current=We)):us.current=0;try{const ys=wn.current.pending&&!nt,st=We-wn.current.lastSeenTs;if(ys&&st>40&&st<900){wn.current.pending=!1,vt.current=null,jt(!1);const ct=wn.current.lastBullDistanceMm,ze=wn.current.lastTipVideoPx;try{a&&a(0,"MISS",{sector:null,mult:0,calibrationValid:!0,pBoard:null,bullDistanceMm:typeof ct=="number"?ct:void 0,tipVideoPx:ze??void 0,bounceout:!0})}catch{}try{ms({ts:We,label:"BOUNCEOUT",value:0,ring:"MISS",confidence:0,ready:!1,accepted:!1,warmup:!1})}catch{}}}catch{}try{const St=an.current.stableFrames>=$r,ys=(wa.current||0)>3;!!!nt&&(St||ys)&&(Wn.current=We,tn||(Us.current=We))}catch{}nt||(wa.current=0,an.current={lastTip:null,stableFrames:0}),vt.current&&We-vt.current.firstTs>900&&(vt.current=null);const Ia=Math.max(.5,Math.min(.99,Number($)||Va));if(nt&&M&&nt.confidence>0&&nt.confidence<Ia){if(!rn){const St=zi(H,nt.tip,6),ys=P==="fill"?"fill":"fit",ct=Ki({videoW:Ae,videoH:et,calibW:we.w,calibH:we.h,fitMode:ys}).toCalibration({x:St.x,y:St.y}),ze=_r(Ze,ct,F??0,Ye??0,K??0);let _e=null;try{_e=Zr(Ze,ct)}catch{_e=null}const Dt=ze.ring,Mt=ze.base,Kn=ze.sector??null,In=Math.max(0,Number(ze.mult)||0);let Ut="";Dt==="MISS"?Ut="MISS":Dt==="BULL"?Ut="25":Dt==="INNER_BULL"?Ut="BULL 50":Kn!=null?Ut=`${In===3?"T":In===2?"D":""}${Kn}`:Ut=`${Dt} ${Mt>0?Mt:""}`.trim();const Xn=!!Ze&&!!we&&_t;Gn({label:Ut,value:Mt,ring:Dt,confidence:nt.confidence,meta:{calibrationValid:Xn,pBoard:_e,source:"camera",__tipVideoPx:St}}),ms({ts:Date.now(),label:Ut,value:Mt,ring:Dt,confidence:nt.confidence,ready:!1,accepted:!1,warmup:!1,rejectReason:"below-confidence",pCal:ct,tip:St})}return}if(nt&&nt.confidence>=Ia){me("CameraView: detected raw",nt.confidence,nt.tip),me("CameraView: detected raw",nt.confidence,nt.tip);const St=$s.current>0&&We-$s.current<Xh,ys=!1,st=zi(H,nt.tip,6);let ct="",ze=0,_e="MISS",Dt=!1,Mt=null;try{const ce=an.current.lastTip;if(!ce)an.current={lastTip:{...st},stableFrames:1},Wn.current=We,tn||(Us.current=We);else{const On=Math.hypot(st.x-ce.x,st.y-ce.y);On<=ef?an.current={lastTip:{...st},stableFrames:an.current.stableFrames+1}:(an.current={lastTip:{...st},stableFrames:1},On>10&&(Wn.current=We,tn||(Us.current=We)),On>=sf&&(us.current=We))}}catch{}const Kn=We-Wn.current>=tf,In=an.current.stableFrames>=$r,Ut=us.current>0?We-us.current:Number.POSITIVE_INFINITY,ws=Wn.current>0?We-Wn.current:Number.POSITIVE_INFINITY,Xn=tn?!0:We-Us.current<=Zh,cn=Math.min(Ut,ws)<=nf||Xn,dn=Yc.toCalibration({x:st.x,y:st.y}),Ra=_r(Ze,dn,F??0,Ye??0,K??0);let Jt=null;try{Jt=Zr(Ze,dn)}catch{Jt=null}_e=Ra.ring,ze=Ra.base;const Yt=Ra.sector??null,Qn=Math.max(0,Number(Ra.mult)||0);_e==="MISS"?ct="MISS":_e==="BULL"?ct="25":_e==="INNER_BULL"?ct="BULL 50":Yt!=null?ct=`${Qn===3?"T":Qn===2?"D":""}${Yt}`:ct=`${_e} ${ze>0?ze:""}`.trim();const un=!0,Oa=un?2:6,La=un?2:5,Rn=!!Ze&&!!we,Ns=st.x>=-Oa&&st.x<=Ae+Oa&&st.y>=-Oa&&st.y<=et+Oa,Ss=we?dn.x>=-La&&dn.x<=we.w+La&&dn.y>=-La&&dn.y<=we.h+La:!1,li=_e==="BULL"||_e==="INNER_BULL"?Yt===25:Yt!=null&&Yt>=1&&Yt<=20;let qs=!1;Jt&&(qs=Math.hypot(Jt.x,Jt.y)<=Wt.doubleOuter+2);const Zc=!un||Jt&&qs,ed=!un||li,td=un?St:!1,ci=un?St:!1,Js=un?!Rn||!Ns||!Ss||!Zc||_e==="MISS"||!ed||td:_e==="MISS",ep=!1,nd=!Js&&Kn&&In&&cn&&!Fs;me("CameraView: detection details",{value:ze,ring:_e,calibrationGood:Rn,tipInVideo:Ns,pCalInImage:Ss,isGhost:Js});try{Hs({lastTip:st??null,lastPcal:dn??null,lastPboard:Jt??null,lastConfidence:Sn.current[Sn.current.length-1]?.confidence??null,lastLabel:ct??null,lastValue:ze??null,lastRing:_e??null,lastReject:_t?Ns?Ss?!Jt||!qs?"off-board":_e==="MISS"||!li?"invalid-segment":St?"warmup":null:"pCal-outside-image":"tip-outside-video":"calibration-invalid",detectionArmed:sn.current,paused:!!Tn,pendingDarts:Ve,frameCount:qt.current,minFrames:ta,warmupActive:St,settled:Kn,tipStable:In,tipStableFrames:an.current.stableFrames,shouldDeferCommit:Fs,calibrationValidEffective:_t,inOfflineThrowWindow:Xn})}catch{}ga(ct),ba(ze),xa(_e);try{if(ie&&_e==="TRIPLE"&&(ze===20||ze===19||ze===18)){const ce={value:ze,until:performance.now()+900};nr.current=ce}}catch{}const sd=async ce=>{};if(ci){vt.current=null,Dt=!0,Mt="warmup";try{me("[AUTOSCORE DROP] warmup",{label:ct,value:ze,ring:_e})}catch{}}else if(Js){try{me("[AUTOSCORE DROP] ghost",{label:ct,value:ze,ring:_e,calibrationGood:Rn,tipInVideo:Ns,pCalInImage:Ss,onBoard:qs,warmupActive:St})}catch{}me("CameraView: ignoring ghost detection (calibrationGood:",Rn,"tipInVideo:",Ns,"pCalInImage:",Ss,")"),vt.current=null,jt(!1),Dt=!1,Mt=Rn?Ns?Ss?qs?"ghost":"off-board":"pCal-outside-image":"tip-outside-video":"calibration-invalid";try{a&&a(ze,_e,{sector:Yt,mult:Qn,calibrationValid:!1,pBoard:null})}catch{}ms({ts:We,label:ct,value:ze,ring:_e,pCal:dn,tip:st,confidence:nt.confidence,ready:!1,accepted:!1,warmup:St,rejectReason:Mt})}else{const ce=!cs.current,On=un?ce&&Xn&&cn&&In:!Js,Ys=!un&&ce;if(_e==="MISS"||ze<=0){vt.current=null,jt(!1);try{a&&a(ze,_e,{sector:Yt,mult:Qn,calibrationValid:!!Rn,pBoard:Rn?Jt:null})}catch{}Dt=!0}else if(On){const yt=vt.current,Ot=18,yn=yt?.lastTip?Math.hypot(st.x-yt.lastTip.x,st.y-yt.lastTip.y):1/0,Pa=!!yt&&yn<=Ot;if(!yt)vt.current={value:ze,ring:_e,label:ct,sector:Yt,mult:Qn,firstTs:We,frames:1,lastTip:{...st}};else if(Pa){const ad=yt.ring==="SINGLE"&&_e!=="SINGLE"?_e:yt.ring,rd=yt.value>0?yt.value:ze;vt.current={...yt,value:rd,ring:ad,label:ct,sector:Yt,mult:Qn,frames:yt.frames+1,lastTip:{...st}}}else vt.current={value:ze,ring:_e,label:ct,sector:Yt,mult:Qn,firstTs:We,frames:1,lastTip:{...st}};const Ks=vt.current,di=We-Ks.firstTs,ui=Ks.frames>=Yh||di>=Kh,xr=un?We-To.current>=Ba:!0;if(ui&&xr)me("CameraView: candidate ready and cooled",{value:ze,ring:_e,frames:Ks.frames,nowPerf:We}),sd(Ks),Pe=!0,vt.current=null,To.current=We,Dt=!0,Mt=null;else{Mt=ui?xr?null:"cooldown":"candidate-hold";try{me("[AUTOSCORE DROP] tracking",{reason:Mt,value:ze,ring:_e,frames:Ks.frames,holdMs:di,cooled:xr,detectionFresh:cn,detectionAgeMs:Number.isFinite(Ut)?Math.round(Ut):null,motionAgeMs:Number.isFinite(ws)?Math.round(ws):null})}catch{}}}else{const yt=an.current.stableFrames,Ot=Math.max(W,Math.round(W*1.25)),yn=yt>=$r,Pa=nt.area>=Ot;Dt=!1,Mt=Xn?cn?Kn?In?"not-ready":"unstable-tip":"not-settled":"detection-stale":"no-throw-window";try{me("[AUTOSCORE DROP] gate",{reason:Mt,label:ct,value:ze,ring:_e,settled:Kn,tipStable:In,tipStableFrames:yt,detectionFresh:cn,detectionAgeMs:Number.isFinite(Ut)?Math.round(Ut):null,motionAgeMs:Number.isFinite(ws)?Math.round(ws):null})}catch{}try{Ys&&Xn&&cn&&!Js&&Rn&&nt.confidence>=.82&&Pa&&yn||(xn.current={sig:null,firstTs:0,lastTs:0,frames:0,lastTip:null})}catch{}ms({ts:We,label:ct,value:ze,ring:_e,pCal:dn,tip:st,confidence:nt.confidence,ready:!1,accepted:!1,warmup:St,rejectReason:Mt,fresh:cn})}}ms({ts:We,label:ct,value:ze,ring:_e,pCal:dn,tip:st,confidence:nt.confidence,ready:Dt,accepted:Dt&&ze>0&&_e!=="MISS",warmup:ci,rejectReason:Mt,fresh:cn});try{(rf||he)&&ee.current&&ee.current.getContext("2d")?.clearRect(0,0,ee.current.width,ee.current.height)}catch{}Dt&&!Pe&&gr.accept(ln,nt)}else vt.current&&We-vt.current.firstTs>800&&(vt.current=null)}else An.current&&An.current.updateBackground(ln,.05)}catch{}Dn.current=requestAnimationFrame(He),zn.current=He}};return Dn.current=requestAnimationFrame(He),()=>{Fe=!0,Dn.current&&cancelAnimationFrame(Dn.current),Dn.current=null}},[Oe,E,it,Ze,we,Tn,Ve,Go,ms,Re,Zt,R]);const Da=i.useCallback(async()=>{try{if(pe){const c=$e.find(y=>y.kind==="videoinput");c?Te(c.deviceId,c.label||"",!0):Te(void 0,"",!0)}await Ct()}catch(c){console.warn("[CameraView] Local camera fallback failed:",c)}},[$e,pe,Te]),Hc=()=>{if(!o)return null;const c=A||J.getState().cameraAspect||"wide";P||J.getState().cameraFitMode;const y=c==="square"?"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-center ndn-video-smooth",T=D??1,I=xe||typeof window<"u"&&(window.localStorage?.getItem("ndn.glareDimming")==="1"||window.localStorage?.getItem("ndn.glareClamp")==="1"),U={transform:`scale(${T})`,transformOrigin:"center center",filter:I?"saturate(1.05) contrast(1.25) brightness(0.86)":"saturate(1.25) contrast(1.12) brightness(1.04)",imageRendering:"crisp-edges"},le=!!(X.getMediaStream?.()||(v.current?.srcObject??null))?.getVideoTracks()?.length;return e.jsxs("div",{className:"relative h-full rounded-xl overflow-hidden bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 bg-slate-900/90 border-b border-white/10 text-xs z-20 flex-shrink-0",children:[e.jsx("span",{className:"text-white/50 font-semibold uppercase tracking-wider text-[10px] hidden sm:inline",children:"Cam"}),e.jsxs("select",{onPointerDown:Q=>{Q.stopPropagation()},onMouseDown:Q=>{Q.stopPropagation()},onTouchStart:Q=>{Q.stopPropagation?.()},className:"flex-1 min-w-0 bg-slate-800 text-white rounded-lg px-2 py-1.5 text-xs border border-white/10 min-h-[2.25rem]",value:g||"",onChange:async Q=>{if(at)return;const Z=Q.target.value||void 0,Fe=$e.find(q=>q.deviceId===Z)?.label;Te(Z,Fe||"",!0),Yn(),await new Promise(q=>setTimeout(q,150));try{await Ct()}catch{setTimeout(async()=>{try{await Ct()}catch{}},500)}},children:[e.jsx("option",{value:"",children:"Auto (back camera)"}),$e.map(Q=>e.jsx("option",{value:Q.deviceId,children:Q.label||(Q.deviceId?`Camera (${Q.deviceId.slice(0,6)})`:"Camera")},Q.deviceId))]}),e.jsx("button",{className:`rounded-lg px-2.5 py-1.5 text-sm border min-h-[2.25rem] ${Ne?"bg-emerald-600/30 border-emerald-400/40 text-emerald-300":"bg-slate-800 border-white/10 text-white/60"}`,onClick:()=>{const Q=!Ne;J.getState().setPreferredCameraLocked(Q)},title:Ne?"Camera locked â€” tap to unlock":"Lock camera selection",children:Ne?"ðŸ”’ Locked":"ðŸ”“ Lock"}),e.jsx("button",{className:"rounded-lg px-2 py-1.5 bg-slate-800 border border-white/10 text-white/60 text-[10px] min-h-[2.25rem]",onClick:async()=>{try{await hr()}catch{}},title:"Rescan cameras",children:"â†»"}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("button",{className:"rounded-lg px-2 py-1.5 bg-slate-800 border border-white/10 text-white/60 min-h-[2.25rem] text-sm font-bold",onClick:()=>ja(-.1),title:"Zoom out",children:"âˆ’"}),e.jsxs("span",{className:"w-10 text-center font-semibold text-white text-[10px]",children:[Math.round((D??1)*100),"%"]}),e.jsx("button",{className:"rounded-lg px-2 py-1.5 bg-slate-800 border border-white/10 text-white/60 min-h-[2.25rem] text-sm font-bold",onClick:()=>ja(.1),title:"Zoom in",children:"+"})]})]}),e.jsxs("div",{className:"relative flex-1 min-h-0 bg-black",children:[e.jsx("video",{ref:fe,className:y,style:U,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:se,className:"absolute inset-0 w-full h-full",style:{pointerEvents:"none"}}),e.jsx("canvas",{ref:ee,className:"absolute inset-0 w-full h-full",onClick:fr}),!le&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/70 text-center px-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:"Camera not running"}),e.jsx("button",{className:"btn px-4 py-2 text-sm",onClick:()=>{try{Ie(!0)}catch{}Ct()},children:"Start Camera"})]})})]}),e.jsx("canvas",{ref:Ce,className:"hidden"})]})},Yo=i.useCallback(()=>{try{if(typeof document>"u")return;const c=v.current||X.getVideoElementRef?.()||null;if(!c){console.warn("[CameraView] capture requested without video element");return}const y=c.videoWidth||c.clientWidth||0,T=c.videoHeight||c.clientHeight||0;if(!y||!T){console.warn("[CameraView] capture aborted: video has no dimensions");return}const I=document.createElement("canvas");I.width=y,I.height=T;const U=I.getContext("2d");if(!U){console.warn("[CameraView] capture aborted: no 2d context");return}U.drawImage(c,0,0,y,T),I.toBlob(G=>{if(!G)return;const le=URL.createObjectURL(G),Q=new Date().toISOString().replace(/[:.]/g,"-"),Z=document.createElement("a");Z.href=le,Z.download=`ndn-capture-${Q}.png`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),window.setTimeout(()=>URL.revokeObjectURL(le),4e3)},"image/png")}catch(c){console.warn("[CameraView] capture failed",c)}},[X]);i.useEffect(()=>{try{if(Ne||g)return;const c=$e.find(y=>/obs|virtual/i.test(String(y.label||"")));c&&Te(c.deviceId,c.label||"",!0)}catch{}},[$e,g,Ne,Te]),i.useEffect(()=>{try{Ds.getState().setCalibrationStatus({hasHomography:!!Ze,imageSize:we})}catch{}},[Ze,we]),i.useEffect(()=>{try{if(!ee.current||!we)return;const c=ee.current;typeof we.w=="number"&&typeof we.h=="number"&&(c.width!==we.w||c.height!==we.h)&&(c.width=we.w,c.height=we.h)}catch{}},[ee,we]),i.useEffect(()=>{},[E,L,Ac]);function fr(c){if(!ee.current||!Ze||!we)return;const y=ee.current.getBoundingClientRect(),T=c.clientX-y.left,I=c.clientY-y.top,U=ee.current.width&&we.w?ee.current.width/we.w:1,G=ee.current.height&&we.h?ee.current.height/we.h:1,le={x:T/U,y:I/G},Q=_r(Ze,le,F??0,Ye??0,K??0),Z=`${Q.ring} ${Q.base>0?Q.base:""}`.trim();ga(Z),ba(Q.base),xa(Q.ring),jt(!0)}function Ko(c){const y=c.trim().toUpperCase();if(!y)return null;const T=y==="BULL"||y==="50"||y==="DBULL"||y==="IBULL",I=y==="25"||y==="OBULL";if(T)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(I)return{label:"BULL 25",value:25,ring:"BULL"};const U=y.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!U)return null;const G=U[1]||"S",le=parseInt(U[2],10);if(le<1||le>20)return null;const Q=G==="S"?1:G==="D"?2:3,Z=G==="S"?"SINGLE":G==="D"?"DOUBLE":"TRIPLE";return{label:`${G}${le} ${le*Q}`,value:le*Q,ring:Z}}function pr(){const c=Be;if(!c.players.length)return c.startingScore;const y=c.players[c.currentPlayerIdx],T=y.legs[y.legs.length-1];return T?T.totalScoreRemaining:c.startingScore}function Xo(c){if(ke&&!(typeof c!="number"||!Number.isFinite(c)))try{const y=window.speechSynthesis;if(!y)return;const T=new SpeechSynthesisUtterance,I=Math.round(c);if(T.text=`${I} millimetres`,T.rate=.95,T.pitch=1,ve){const U=y.getVoices().find(G=>G.name===ve);U&&(T.voice=U)}T.volume=typeof ye=="number"?Math.max(0,Math.min(1,ye)):1;try{y.cancel()}catch{}y.speak(T)}catch{}}function Gs(c){if(ke)try{const y=Be.players[Be.currentPlayerIdx]?.name,T=pr();dc(y||"Player",c,Math.max(0,T),ve,{volume:ye,checkoutOnly:ae})}catch{}}function Mn(c,y,T,I){if(lt)try{Cn("event")}catch{}const U=I??{calibrationValid:!1,pBoard:null,source:"manual"};if(U.source==="camera"&&cs.current)return;if(l==="custom"){if(!U.__allowMultipleBullUp){if(or.current)return;or.current=!0}if(m)try{m(c,T,{label:y})}catch{}if((ot.current||0)>=3){ft(1),pt(c),bt([{label:y,value:c,ring:T,meta:U}]);try{Xt.getState().setVisit([{label:y,value:c,ring:T,meta:U}],1,c)}catch{}try{U.source==="camera"&&Ca()}catch{}return}const H=Ve+1;ft(H),ot.current=H,pt(oe=>oe+c),bt(oe=>[...oe,{label:y,value:c,ring:T,meta:U}]);try{const oe=[...Me,{label:y,value:c,ring:T,meta:U}],Ke=oe.reduce((He,Pe)=>He+(Number(Pe?.value)||0),0);Xt.getState().setVisit(oe,H,Ke)}catch{}return}if((ot.current||0)>=3){const H=Ft,oe=Ve,Ke=Ws(Me);En(H,oe,{preOpenDarts:N||0,doubleWindowDarts:Le||0,finishedByDouble:!1,visitTotal:H,entries:Ke});try{const Ae=Be.players[Be.currentPlayerIdx]?.name;Ae&&Zn(Ae,oe,H)}catch{}const He=!hs||fs||T==="DOUBLE"||T==="INNER_BULL",Pe=He?c:0;ft(1),ot.current=1,pt(Pe),bt([{label:y,value:Pe,ring:T,meta:U}]);try{Xt.getState().setVisit([{label:y,value:Pe,ring:T,meta:U}],1,Pe)}catch{}try{U.source==="camera"&&Ca()}catch{}re(He?0:1),xt(0),hs&&!fs&&(T==="DOUBLE"||T==="INNER_BULL")&&Ro(!0),kn({score:H,darts:oe,finished:!1});return}const G=(ot.current||0)+1;U.source==="camera"&&G>=3&&(cs.current=!0,ds.current=0),console.log(`[CameraView] addDart: value=${c} ring=${T} -> pending=${G}`);const Q=!hs||fs||T==="DOUBLE"||T==="INNER_BULL"?c:0;hs&&!fs&&(T==="DOUBLE"||T==="INNER_BULL")&&Ro(!0);const Z=Ft+Q,q=pr()-Z,ge=q===0&&(T==="DOUBLE"||T==="INNER_BULL");if(q<0||q===1||q===0&&!ge){const H=Ws([...Me,{label:y,value:Q,ring:T}]),Ke=(N||0)+(hs&&!fs&&!(T==="DOUBLE"||T==="INNER_BULL")?1:0),He=q,Pe=q+Q,Ae=Pe>50&&He<=50||Pe<=50?1:0,et=(Le||0)+Ae;En(0,G,{preOpenDarts:Ke,doubleWindowDarts:et,finishedByDouble:!1,visitTotal:0,entries:H}),Gs(0),ft(0),ot.current=0,pt(0),bt([]),Vt([]),re(0),xt(0),kn({score:0,darts:G,finished:!1});try{Xt.getState().reset()}catch{}return}ft(G),ot.current=G,pt(Z),bt(H=>{const oe=[...H,{label:y,value:Q,ring:T,meta:U}];try{const Ke=oe.reduce((He,Pe)=>He+(Number(Pe?.value)||0),0);Xt.getState().setVisit(oe,G,Ke)}catch{}return oe});try{let H=I?.__tipVideoPx??null;H||(H=Vs.current.lastTip??null),H&&typeof H.x=="number"&&typeof H.y=="number"&&(U.source==="camera"&&(ya.current=[...ya.current,{tip:{...H},ts:Date.now()}].slice(-6)),Vt(oe=>[...oe,{x:H.x,y:H.y,label:y}]),kc({x:H.x,y:H.y,expires:Date.now()+2e3}))}catch{}try{U.source==="camera"&&Ca()}catch{}(ge||G===3)&&Gs(Z),hs&&!fs&&!(T==="DOUBLE"||T==="INNER_BULL")&&re(H=>(H||0)+1);{const H=q,oe=q+Q;(oe>50&&H<=50||oe<=50)&&xt(He=>(He||0)+1)}if(ge){const H=Ws([...Me,{label:y,value:Q,ring:T}]),oe=ir();En(Z,G,{preOpenDarts:N||0,doubleWindowDarts:Le||0,finishedByDouble:!0,visitTotal:Z,entries:H}),Po(Z),ft(0),ot.current=0,pt(0),bt([]),Vt([]),re(0),xt(0),kn({score:Z,darts:G,finished:!0,meta:{label:y,ring:T,entries:H,frame:oe}});try{Xt.getState().reset()}catch{}return}if(G>=3){const H=Ws([...Me,{label:y,value:Q,ring:T}]);En(Z,G,{preOpenDarts:N||0,doubleWindowDarts:Le||0,finishedByDouble:!1,visitTotal:Z,entries:H});try{U.source==="camera"&&Ca()}catch{}ft(0),ot.current=0,pt(0),bt([]),Vt([]),re(0),xt(0),kn({score:Z,darts:G,finished:!1});try{Xt.getState().reset()}catch{}}}function Wc(){if(!lt&&zt){if(a)try{a(Gt,nn,void 0)}catch{}else Mn(Gt,zt,nn);$t(0),jt(!1)}}function Ma(){if(lt)return;const c=Ko(is);if(!c){alert("Enter like T20, D16, 5, 25, 50");return}if(!bs||!zt||nn==="MISS"||Gt===0){const y=ps+1;$t(y),y>=5&&gs(!0)}else $t(0);Mn(c.value,c.label,c.ring),Rt(""),jt(!1)}function Qo(){if(lt)return;const c=Ko(is);if(!c){alert("Enter like T20, D16, 5, 25, 50");return}if(Ve===0||Me.length===0){Ma();return}if(l==="custom"){if(!bs||!zt||nn==="MISS"||Gt===0){const q=ps+1;$t(q),q>=5&&gs(!0)}else $t(0);if(bt(q=>[...q.slice(0,-1),{label:c.label,value:c.value,ring:c.ring}]),d)try{d(c.value,c.ring,{label:c.label})}catch{}Rt(""),jt(!1);return}if(!bs||!zt||nn==="MISS"||Gt===0){const q=ps+1;$t(q),q>=5&&gs(!0)}else $t(0);const y=Me[Me.length-1],T=Ve-1,I=Ft-(y?.value||0),U=pr(),G=I+c.value,le=T+1,Q=U-G,Z=Q===0&&(c.ring==="DOUBLE"||c.ring==="INNER_BULL");if(Q<0||Q===1||Q===0&&!Z){En(0,le);try{const q=Be.players[Be.currentPlayerIdx]?.name;q&&Zn(q,le,0)}catch{}Gs(0),ft(0),ot.current=0,pt(0),bt([]),Vt([]),kn({score:0,darts:le,finished:!1}),Rt(""),jt(!1);return}if(ft(le),ot.current=le,pt(G),bt(q=>[...q.slice(0,-1),{label:c.label,value:c.value,ring:c.ring}]),(Z||le===3)&&Gs(G),Z){En(G,le),Po(G);try{const q=Be.players[Be.currentPlayerIdx]?.name;q&&Zn(q,le,G)}catch{}ft(0),ot.current=0,pt(0),bt([]),Vt([]),kn({score:G,darts:le,finished:!0}),Rt(""),jt(!1);return}if(le>=3){En(G,le);try{const q=Be.players[Be.currentPlayerIdx]?.name;q&&Zn(q,le,G)}catch{}ft(0),ot.current=0,pt(0),bt([]),Vt([]),kn({score:G,darts:le,finished:!1})}Rt(""),jt(!1)}i.useEffect(()=>{function c(y){try{const I=document.activeElement?.tagName?.toLowerCase();y.key==="m"&&I!=="input"&&I!=="textarea"&&(qn("manual"),Jn(!0))}catch{}}return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[]);function Zo(c,y){if(Ve>=3||lt)return;const T=c*(y==="S"?1:y==="D"?2:3),I=y==="S"?"SINGLE":y==="D"?"DOUBLE":"TRIPLE";if(!bs||!zt||nn==="MISS"||Gt===0){const U=ps+1;$t(U),U>=5&&gs(!0)}else $t(0);Mn(T,`${y}${c} ${T}`,I),jt(!1)}function zc(){if(Ve===0)return;const c=Me[Me.length-1];ft(y=>y-1),ot.current=Math.max(0,(ot.current||0)-1),pt(y=>y-(c?.value||0)),bt(y=>y.slice(0,-1))}function ei(){if(Ve===0||lt)return;if(vn){try{window.alert("Cannot commit: pending camera detections require camera connection validation for online matches")}catch{}return}if(l==="custom"){ft(0),ot.current=0,ot.current=0,pt(0),bt([]),Vt([]);return}const c=Ft,y=Ve,T=Ws(Me);En(c,y,{entries:T,visitTotal:c});try{const I=Be.players[Be.currentPlayerIdx]?.name;I&&Zn(I,y,c)}catch{}ft(0),ot.current=0,pt(0),bt([]),Vt([]),kn({score:c,darts:y,finished:!1})}const Gc=e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 w-full min-w-0",children:[s&&!p&&e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("button",{className:`btn px-3 py-1 text-sm ${Bc==="manual"?"tab--active":""}`,onClick:()=>{qn("manual"),Jn(!0)},title:"Open Manual Correction",children:"Manual Correction"})})}),o?null:e.jsx("div",{className:"card relative camera-fullwidth-card lg:col-span-2 w-full min-w-0",children:e.jsxs("div",{className:"camera-fullwidth-body flex flex-col gap-4 w-full min-w-0",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(qi,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black w-full",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,autoFill:!0,children:[e.jsx(Jo,{}),(()=>{const c=A||J.getState().cameraAspect||"wide",y=(P||J.getState().cameraFitMode||"fit")==="fit",T=c==="square"?"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black":y?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black ndn-video-smooth",I=D??1,U=typeof window<"u"&&(window.localStorage?.getItem("ndn.glareDimming")==="1"||window.localStorage?.getItem("ndn.glareClamp")==="1"),G={transform:`scale(${I})`,transformOrigin:"center center",filter:U?"saturate(1.05) contrast(1.25) brightness(0.86)":"saturate(1.25) contrast(1.12) brightness(1.04)",imageRendering:"crisp-edges"},le=c==="square"?"relative w-full mx-auto aspect-square bg-black":"relative w-full aspect-[4/3] bg-black",Q=()=>e.jsxs("div",{className:`camera-viewport ${le}`,children:[e.jsx("video",{ref:fe,className:T,style:G,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:ee,className:"absolute inset-0 w-full h-full",onClick:fr}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3 cursor-pointer select-none",onDoubleClick:Rc,"aria-label":`Visit status: ${Me[0]?Me[0].value>0?"hit":"miss":"pending"}, ${Me[1]?Me[1].value>0?"hit":"miss":"pending"}, ${Me[2]?Me[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(Z=>{const Fe=Me[Z],q=xc[Z],ge=!Fe,Ee=!!Fe&&q===ar,H=typeof Fe?.value=="number"?Fe.value>0:!1,oe=(Fe?.ring&&Fe.ring!=="MISS")??!1,He=Ee?Ee&&(H||oe)?"bg-emerald-400":"bg-rose-500":"bg-gray-500/70",Pe=Ee&&!ge;return e.jsx("span",{className:`visit-dot ${Pe?"active":"inactive"} ${He}`},Z)}),zs&&xs!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,xs),"s"]})]}),lt?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return pe?Je?Q():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-2xl font-semibold",children:"CAM"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Camera Connection tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Aa,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{X.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Da,disabled:!$e.length,children:"Use Local Camera"})]})]})}):Q()})()]}),!p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-xs",children:[e.jsx("span",{className:"uppercase tracking-wide text-slate-400",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>ja(-.1),title:"Decrease camera zoom",children:"-"}),e.jsxs("span",{className:"w-10 text-center font-semibold text-white",children:[Math.round((D??1)*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>ja(.1),title:"Increase camera zoom",children:"+"}),e.jsx("button",{className:`btn btn--ghost px-3 py-1 text-[11px] ${P==="fill"?"bg-emerald-500 text-white":""}`,onClick:Dc,title:"Show dartboard only",children:"Full"}),e.jsx("button",{className:`btn btn--ghost px-3 py-1 text-[11px] ${P!=="fill"?"bg-slate-200 text-slate-900":""}`,onClick:Mc,title:"Letterbox to wide view",children:"Wide"})]}),e.jsx("div",{className:"mt-3 text-xs text-slate-400",children:"Manual scoring active Â· camera preview only."})]}),lr?e.jsx("div",{className:"sr-only","aria-hidden":"true",children:e.jsx("button",{"data-testid":"commit-visit-btn",onClick:ei,disabled:Ve===0||vn,children:"Commit"})}):null,!p&&e.jsxs("div",{className:"mt-3 rounded-2xl border border-white/10 bg-slate-900/60 p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] uppercase tracking-wide text-slate-400",children:"Camera controls"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[pe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${Je?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:Je?"CAM Phone camera stream active":"CAM Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Aa,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{X.setShowOverlay?.(!X.showOverlay)}catch{}},children:X.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!Je,onClick:()=>{try{X.clearSession?.()}catch{}},children:"Stop Phone Feed"}),qo&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Da,disabled:!$e.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:be?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:Yn,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:Ct,disabled:at,children:at?"Connecting Camera...":"Connect Camera"})}),!Oe&&e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:Lc,title:"Open phone, WiFi, and USB camera options",children:"Camera Devices"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Ge(!he),title:"Toggle the board guide overlay",children:he?"Show board guides":"Hide board guides"}),e.jsx("button",{className:"btn",onClick:Yo,disabled:!it,children:"Capture Still"}),Be?.inProgress&&e.jsxs(e.Fragment,{children:[e.jsx(pc,{compact:!0}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",onClick:()=>ls(!0),children:"Quit / Pause"}),Eo&&e.jsx(zh,{onClose:()=>ls(!1),onQuit:()=>{try{window.dispatchEvent(new CustomEvent("ndn:match-quit"));try{Ht({type:"quit"})}catch{}}catch{}ls(!1)},onPause:()=>{try{At.getState().setPaused(!0,null,Hn||null);try{Ht({type:"pause",pauseStartedAt:Date.now(),pauseInitiator:Hn||null})}catch{}}catch{}ls(!1)}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>{try{Fr(),window.open(`${window.location.origin}${window.location.pathname}?match=1`,"_blank")}catch{}},children:"Open match in new window"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:async()=>{try{document.documentElement.requestFullscreen?await document.documentElement.requestFullscreen():document.body.requestFullscreen&&await document.body.requestFullscreen()}catch{}},children:"Open full screen"})]}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]})]})}),lr?e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{className:"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg",title:"Open Manual Correction (M)",onClick:()=>{qn("manual"),Jn(!0)},children:"??"})}):null,e.jsx("canvas",{ref:Ce,className:"hidden"}),rn&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[99999]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-start justify-center p-6 pt-16",children:e.jsxs("div",{className:"card w-full max-w-lg mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Confirm detected dart"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>Gn(null),children:"Close"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"This hit was detected with lower confidence."}),e.jsxs("div",{className:"flex flex-col gap-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Detected:"})," ",rn.label]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Confidence:"})," ",rn.confidence.toFixed(2)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{try{Mn(rn.value,rn.label,rn.ring,rn.meta)}catch{}Gn(null)},children:"Accept"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>Gn(null),children:"Reject"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{Gn(null),Jn(!0),qn("manual")},children:"Open Manual Correction"})]})]})})}),cr&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex flex-col",children:e.jsxs(Fn,{returnFocus:!0,children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{Jn(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:Uo,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:zt||"ï¿½"}),e.jsx("button",{className:"btn",onClick:Wc,disabled:Ve>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-[1.2]",placeholder:"Manual (T20, D16, 5, 25, 50)",value:is,onChange:c=>Rt(c.target.value),onKeyDown:c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),Ma()),c.key==="Enter"&&c.shiftKey&&(c.preventDefault(),Qo())}}),e.jsx("button",{className:"btn btn--ghost",onClick:Qo,disabled:Ve===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:Ma,disabled:Ve>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add ï¿½ Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Number pad"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 max-w-sm",children:[["7","8","9","4","5","6","1","2","3","0"].map(c=>e.jsx("button",{className:"btn text-lg",onClick:()=>{Rt(y=>/^[SDT]/i.test(y)?y+c:(y||"")+c)},children:c},c)),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:()=>Rt(""),children:"Clear"}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 text-white",onClick:()=>Rt(c=>(c||"").slice(0,-1)),children:"?"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>Ma(),disabled:Ve>=3,children:"Enter"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Tap numbers then press Enter to submit. Use D/T prefixes for doubles/trebles (e.g., D16)."})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:Ve>=3,onClick:()=>{if(!bs||!zt||nn==="MISS"||Gt===0){const c=ps+1;$t(c),c>=5&&gs(!0)}else $t(0);Mn(25,"BULL 25","BULL"),jt(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:Ve>=3,onClick:()=>{if(!bs||!zt||nn==="MISS"||Gt===0){const c=ps+1;$t(c),c>=5&&gs(!0)}else $t(0);Mn(50,"INNER_BULL 50","INNER_BULL"),jt(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:Ta,onChange:c=>Uc(c.target.value.toUpperCase()),onKeyDown:c=>{if(c.key==="Enter"){const y=Ta.match(/^(S|D|T)(\d{1,2})$/);y&&Zo(parseInt(y[2],10),y[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(c=>Array.from({length:20},(y,T)=>T+1).map(y=>e.jsx("option",{value:`${c}${y}`},`${c}${y}`)))}),e.jsx("button",{className:"btn",disabled:!Ta||Ve>=3,onClick:()=>{const c=Ta.match(/^(S|D|T)(\d{1,2})$/);if(!c)return;const y=c[1],T=parseInt(c[2],10);Zo(T,y)},children:"Add"})]})]})]})]})})]})})}),Vc&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsx(Fn,{returnFocus:!0,children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",role:"dialog","aria-modal":"true",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>$o(!1),"aria-label":"Close scoring dialog",children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(qi,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,children:[e.jsx(Jo,{}),(()=>{const y=(J.getState().cameraFitMode||"fit")==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black ndn-video-smooth":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black ndn-video-smooth",T=()=>e.jsxs("div",{className:"relative w-full aspect-[4/3] bg-black",children:[e.jsx("video",{ref:fe,className:y,style:videoStyle,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:ee,className:"absolute inset-0 w-full h-full",onClick:fr}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${Me[0]?Me[0].value>0?"hit":"miss":"pending"}, ${Me[1]?Me[1].value>0?"hit":"miss":"pending"}, ${Me[2]?Me[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(I=>{const U=Me[I],G=!U,le=!!U&&(typeof U.value=="number"?U.value>0:!0),Q=G?"bg-gray-500/70":le?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${Q}`},I)}),zs&&xs!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,xs),"s"]})]}),lt?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return pe?Je?T():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-2xl font-semibold",children:"CAM"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Aa,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{X.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Da,disabled:!$e.length,children:"Use Local Camera"})]})]})}):T()})()]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[pe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${Je?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:Je?"?? Phone camera stream active":"?? Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Aa,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{X.setShowOverlay?.(!X.showOverlay)}catch{}},children:X.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!Je,onClick:()=>{try{X.clearSession?.()}catch{}},children:"Stop Phone Feed"}),qo&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Da,disabled:!$e.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:be?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:Yn,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Ct,children:"Connect Camera"})}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:Yo,disabled:!it,children:"Capture Still"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pending Visit"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 ml-auto",children:[e.jsx("span",{className:`inline-block w-2.5 h-2.5 rounded-full ${os?"bg-emerald-400":"bg-rose-500"}`}),e.jsx("span",{children:os?"Connection OK":"Connection issue"})]})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[0,1,2].map(c=>{const y=Me[c],T=!y,I=!!y&&(typeof y.value=="number"?y.value>0:!0),U=T?"bg-gray-500/70":I?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-2.5 h-2.5 rounded-full shadow ${U}`},c)}),zs&&xs!==null&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold",children:[Math.max(0,xs),"s"]})]}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:Me.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):Me.map((c,y)=>e.jsx("li",{children:c.label},y))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",Ve,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",Ft]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:zc,disabled:Ve===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:ei,disabled:Ve===0||vn,"data-testid":"commit-visit-btn",children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:Oc,disabled:Ve===0,children:"Clear"})]})]})]})]})})})]}),ti=Hc();return o&&ti?ti:Gc}),df=Object.freeze(Object.defineProperty({__proto__:null,default:bc},Symbol.toStringTag,{value:"Module"}));function uf({gameMode:t,players:n,matchScore:s,gameRules:a}){return!n||n.length===0?null:e.jsx("div",{className:"grid w-full grid-cols-1 gap-3 mb-3",children:n.map((r,o)=>e.jsxs("div",{className:`w-full rounded-xl border p-4 ${r.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-3 uppercase tracking-wide ${r.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:r.name}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1 text-sm",children:[t==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Highest Checkout",value:r.highestCheckout||"â€”",mono:!0,bold:!0,highlight:r.highestCheckout>0}),e.jsx(Se,{label:"Best Score",value:r.bestVisitScore||"â€”",mono:!0,bold:!0,highlight:r.bestVisitScore>0}),r.avg!==void 0&&e.jsx(Se,{label:"3-Dart Avg",value:Number(r.avg||0).toFixed(2),mono:!0,bold:!0}),e.jsx(Se,{label:"C/Out Rate",value:`${r.checkoutRate||0}%`,mono:!0}),e.jsx(Se,{label:"Best Leg",value:r.bestLeg||"â€”",mono:!0}),r.matchAvg!==void 0&&r.allTimeAvg!==void 0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[e.jsx(Se,{label:"Match Avg",value:r.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:r.matchAvg>0}),e.jsx(mf,{matchAvg:r.matchAvg,allTimeAvg:r.allTimeAvg})]})})]}),(t==="Cricket"||t==="American Cricket")&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Closed",value:hf(r.closed),mono:!0}),e.jsx(Se,{label:"Points",value:r.points||0,mono:!0,bold:!0}),e.jsx(Se,{label:"Status",value:ff(r),highlight:r.isCurrentTurn})]}),(t==="Shanghai"||t==="Halve It")&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:t==="Shanghai"?"Round":"Stage",value:r.round||1,mono:!0}),e.jsx(Se,{label:"Target",value:r.target||"â€”",mono:!0}),e.jsx(Se,{label:"Score",value:r.score||0,mono:!0,bold:!0})]}),t==="Killer"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Target #",value:r.number||"â€”",mono:!0,bold:!0}),e.jsx(Se,{label:"Lives",value:r.lives||0,mono:!0,bold:!0}),r.eliminated&&e.jsx(Se,{label:"Status",value:"ELIMINATED",highlight:!1})]}),t==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Round",value:r.round||1,mono:!0}),e.jsx(Se,{label:"Target",value:r.target||"High",mono:!0}),e.jsx(Se,{label:"Score",value:r.score||0,mono:!0,bold:!0})]}),(t==="Double Practice"||t==="Treble Practice"||t==="Around the Clock")&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Target",value:r.target||"â€”",mono:!0,bold:!0}),e.jsx(Se,{label:"Hits",value:r.hits||0,mono:!0,bold:!0}),r.totalNeeded&&e.jsx(Se,{label:"Progress",value:`${r.hits||0} / ${r.totalNeeded}`,mono:!0})]}),(t==="Count-Up"||t==="High Score"||t==="Low Score")&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Round",value:r.round||1,mono:!0}),e.jsx(Se,{label:"Score",value:r.score||0,mono:!0,bold:!0}),t==="High Score"&&e.jsx(Se,{label:"Best",value:r.bestScore||0,mono:!0})]}),(t==="Checkout 170"||t==="Checkout 121")&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Remaining",value:r.remaining||0,mono:!0,bold:!0}),e.jsx(Se,{label:"Attempts",value:r.attempts||0,mono:!0}),e.jsx(Se,{label:"Successes",value:r.successes||0,mono:!0})]}),t==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Target",value:`D${r.target||1}`,mono:!0,bold:!0}),e.jsx(Se,{label:"Score",value:r.score||0,mono:!0,bold:!0})]}),t==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Inning",value:r.inning||1,mono:!0}),e.jsx(Se,{label:"Score",value:r.score||0,mono:!0,bold:!0})]}),t==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Hole",value:r.hole||1,mono:!0}),e.jsx(Se,{label:"Strokes",value:r.strokes||0,mono:!0,bold:!0})]}),t==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Turn",value:r.turn||1,mono:!0}),r.winner&&e.jsx(Se,{label:"Result",value:"WINNER!",highlight:!0})]}),t==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Target",value:r.target||"â€”",mono:!0,bold:!0}),e.jsx(Se,{label:"Darts",value:r.darts||0,mono:!0}),r.finished&&e.jsx(Se,{label:"Status",value:"FINISHED!",highlight:!0})]}),t==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Score",value:`${r.score||0}/${r.targetScore||0}`,mono:!0,bold:!0}),e.jsx(Se,{label:"Darts",value:r.darts||0,mono:!0}),r.finished&&e.jsx(Se,{label:"Status",value:"FINISHED!",highlight:!0})]}),t==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:"Score",value:`${r.score||0}/${r.targetScore||0}`,mono:!0,bold:!0}),e.jsx(Se,{label:"Darts",value:r.darts||0,mono:!0}),r.finished&&e.jsx(Se,{label:"Status",value:"FINISHED!",highlight:!0})]}),s&&(t==="X01"||t==="Cricket"||t==="American Cricket")&&o===1&&e.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:e.jsx(Se,{label:"Match",value:s,mono:!0,bold:!0,highlight:!0})})]})]},o))})}function Se({label:t,value:n,mono:s=!1,bold:a=!1,highlight:r=!1}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"opacity-70",children:[t," ðŸŽ¯:"]}),e.jsx("span",{className:`${s?"font-mono":""} ${a?"font-semibold":""} ${r?"text-emerald-300":""}`,children:n})]})}function mf({matchAvg:t,allTimeAvg:n}){const s=t-n,a=s>0,r=Math.abs(s)<.01;let o="",l="text-slate-300";return r?(o="= All-time ðŸŽ¯",l="text-slate-300"):a?(o=`+${s.toFixed(2)} vs avg ðŸŽ¯`,l="text-emerald-400"):(o=`${s.toFixed(2)} vs avg ðŸŽ¯`,l="text-orange-400"),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-70",children:"AVG vs Avg ðŸŽ¯:"}),e.jsx("span",{className:`font-mono font-semibold ${l}`,children:o})]})}function hf(t){return!t||Object.keys(t).length===0?"â€”":Object.entries(t).filter(([s,a])=>a===3).map(([s])=>s==="25"?"B":s).join(",")||"â€”"}function ff(t){if(!t.closed)return"Starting ðŸŽ¯";const n=Object.values(t.closed).filter(s=>s===3).length;return n===0?"No marks ðŸŽ¯":n<7?`${n}/7 ðŸŽ¯`:"Closing in ðŸŽ¯"}let Ha=null;function Xi(){if(Ha!==null)return Ha;if(typeof navigator>"u"||typeof window>"u")return!1;const t=navigator.userAgent||"",n=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t),s=/Macintosh/i.test(t)&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>1,a=/iPad/i.test(t)||s;return Ha=n||a,Ha}function Wa(...t){return t.filter(Boolean).join(" ")}function pf(t){const{label:n,autoStart:s,forceAutoStart:a=!1,scale:r,className:o,aspect:l="inherit",style:m,fill:d=!1,tileFitModeOverride:u}=t,h=i.useRef(null),x=$n(),[f,S]=i.useState(!1),[k,p]=i.useState(null),[w,v]=i.useState(null),g=i.useRef(null),[O,E]=i.useState(null),L=i.useRef(null);i.useEffect(()=>{g.current=w},[w]);const A=i.useCallback((ae,ve="local")=>{try{ae?(x.setMediaStream(ae),x.setMode(ve),x.setStreaming(!0),L.current=ve):L.current&&L.current!=="phone"&&(x.setStreaming(!1),x.setMediaStream(null),L.current=null)}catch{}},[x]),P=i.useCallback(async()=>{try{const ae=h.current;if(!ae)return!1;const ve=x.getMediaStream?.()||null,ye=(ve?.getVideoTracks?.()||[]).filter(Ie=>Ie.readyState==="live");if(!ve||ye.length===0)return!1;const Te=await ha({video:ae,stream:ve,onPlayError:Ie=>console.warn("[CameraTile] Play failed:",Ie)});if(S(!!Te.played),Te.played)try{const Ie=x.getVideoElementRef?.();(!Ie||Ie===ae)&&x.setVideoElementRef?.(ae)}catch{}return!!Te.played}catch{return!1}},[x]),D=J(ae=>ae.preferredCameraLabel),[j,R]=i.useState(()=>Xi()?"local":D==="Phone Camera"?"phone":localStorage.getItem("ndn:camera:mode")||"local"),[M,$]=i.useState(null),[W,Y]=i.useState(null);i.useEffect(()=>{localStorage.setItem("ndn:camera:mode",j)},[j]),i.useEffect(()=>{const ae=window.location.hostname;(ae==="localhost"||ae==="127.0.0.1")&&De("/api/hosts").then(ve=>ve.json()).then(ve=>{const ye=Array.isArray(ve?.hosts)&&ve.hosts.find(Te=>Te);ye&&$(ye)}).catch(()=>{}),De("/api/https-info").then(ve=>ve.json()).then(ve=>{ve&&typeof ve.https=="boolean"&&Y({https:!!ve.https,port:Number(ve.port)||8788})}).catch(()=>{})},[]);const ne=i.useMemo(()=>{const ae=w||"____",ve=M||window.location.hostname,ye=W?.https?"https":"http",Te=W?.https?W.port:8787;return`${ye}://${ve}:${Te}/mobile-cam.html?code=${ae}`},[w,M,W]);function xe(){if(k&&(k.readyState===WebSocket.OPEN||k.readyState===WebSocket.CONNECTING))return k;const ae=Xr(),ve=new WebSocket(ae);return p(ve),ve}const ie=i.useCallback(()=>{R("phone");const ae=xe();ae.readyState===WebSocket.OPEN?ae.send(JSON.stringify({type:"cam-create"})):ae.onopen=()=>ae.send(JSON.stringify({type:"cam-create"})),ae.onmessage=async ve=>{const ye=JSON.parse(ve.data);if(ye.type==="cam-code")v(ye.code),g.current=ye.code;else if(ye.type==="cam-peer-joined"){const Te=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});E(Te),Te.onicecandidate=Ge=>{Ge.candidate&&g.current&&ae.send(JSON.stringify({type:"cam-ice",code:g.current,payload:Ge.candidate}))},Te.ontrack=Ge=>{h.current&&Ge.streams?.[0]&&(h.current.srcObject=Ge.streams[0],h.current.play().catch(()=>{}),A(Ge.streams[0],"phone"),S(!0))};const Ie=await Te.createOffer({offerToReceiveVideo:!0});await Te.setLocalDescription(Ie),g.current&&ae.send(JSON.stringify({type:"cam-offer",code:g.current,payload:Ie}))}else if(ye.type==="cam-answer"&&O)await O.setRemoteDescription(new RTCSessionDescription(ye.payload));else if(ye.type==="cam-ice"&&O)try{await O.addIceCandidate(ye.payload)}catch{}}},[A,O,k]),je=i.useCallback(async()=>{await P()||window.dispatchEvent(new CustomEvent("ndn:start-camera",{detail:{mode:"local"}}))},[P]),Ne=i.useCallback(ae=>{if(ae==="phone"&&Xi()){R("local"),je();return}R(ae),ae==="local"?je():ae==="phone"&&ie()},[je,ie]);i.useEffect(()=>{(s||a)&&(j==="local"?je():j==="phone"&&ie())},[s,a,j,je,ie]);const he=x.isStreaming,ke=x.getMediaStream?.();return i.useEffect(()=>{if(he&&ke){try{const ae=h.current;ae&&ae.srcObject!==ke&&(ae.srcObject=ke,ae.play().catch(()=>{}),S(!0))}catch{}P()}},[he,ke,P]),e.jsx(gf,{...t,videoRef:h,streaming:f,mode:j,pairCode:w,mobileUrl:ne,startPhonePairing:ie,onModeSelect:Ne})}function gf(t){const{videoRef:n,streaming:s,mode:a,pairCode:r,mobileUrl:o,startPhonePairing:l,label:m,fill:d,className:u,style:h,scale:x,aspect:f="inherit",tileFitModeOverride:S}=t,{cameraScale:k,cameraAspect:p,cameraFitMode:w}=J(),v=i.useRef(null),g=i.useRef(null),[O,E]=i.useState(!1),L=i.useCallback(()=>{if(!v.current)return!0;const R=v.current.getBoundingClientRect();return R.width>0&&R.height>0&&R.top<(window.innerHeight||2e3)&&R.bottom>0},[]),A=S||(d?"fill":w||"fill"),P=Number(x??k??1),D=d&&A==="fill"?"free":f&&f!=="inherit"?f:p||"wide",j=D==="square"?"aspect-square":D==="portrait"?"aspect-[3/4]":D==="classic"?"aspect-[4/3]":D==="free"?"h-full":"aspect-video";return i.useEffect(()=>{let R=0,M=!0,$=0;const W=()=>{if(!M)return;const Y=n.current,ne=g.current,xe=Y&&(O||Y.videoWidth>0&&Y.readyState<2);if(Y&&ne&&xe){const ie=ne.getContext("2d",{alpha:!1});ie&&Y.videoWidth>0&&(ne.width!==Y.videoWidth&&(ne.width=Y.videoWidth,ne.height=Y.videoHeight),ie.drawImage(Y,0,0),ne.style.visibility="visible")}else ne&&(ne.style.visibility="hidden");R=requestAnimationFrame(W)};return R=requestAnimationFrame(W),$=window.setInterval(()=>{const Y=n.current;if(Y&&Y.videoWidth>0&&L()){const ne=document.createElement("canvas");ne.width=16,ne.height=16;const xe=ne.getContext("2d",{alpha:!1,willReadFrequently:!0});if(xe)try{xe.drawImage(Y,0,0,16,16);const ie=xe.getImageData(0,0,16,16).data;let je=0;for(let he=0;he<ie.length;he+=4)je+=.299*ie[he]+.587*ie[he+1]+.114*ie[he+2];je/(256*255)<.02?E(!0):E(!1)}catch{}}},2e3),()=>{M=!1,cancelAnimationFrame(R),window.clearInterval($)}},[n,L,O]),e.jsxs("div",{ref:v,className:Wa("relative bg-black rounded-3xl overflow-hidden shadow-2xl border border-white/5",u,d&&"w-full h-full"),style:h,children:[e.jsxs("div",{className:Wa("relative w-full",j),children:[e.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,className:Wa("w-full h-full",A==="fill"?"object-cover":"object-contain",O?"opacity-0 absolute":"block"),style:{transform:`scale(${P})`}}),e.jsx("canvas",{ref:g,className:Wa("absolute inset-0 w-full h-full bg-black",A==="fill"?"object-cover":"object-contain"),style:{visibility:"hidden",transform:`scale(${P})`}})]}),e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 backdrop-blur-md flex items-center justify-center text-white",children:e.jsx(oa,{size:14})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-white/40 uppercase tracking-widest font-bold",children:"Live Feed"}),e.jsx("span",{className:"text-white font-bold leading-none",children:m||a})]})]}),s&&e.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1.5 px-2 py-1 rounded-full bg-emerald-500/20 border border-emerald-500/30",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-400 animate-pulse"}),e.jsx("span",{className:"text-xs text-emerald-400 font-bold uppercase tracking-widest",children:"Live"})]})]})}const za=({label:t,value:n})=>e.jsxs("div",{className:"flex flex-col items-center gap-0",children:[e.jsx("div",{className:"text-[8px] opacity-70 uppercase font-bold tracking-tighter leading-none",children:t}),e.jsx("div",{className:"text-sm sm:text-base font-black leading-none",children:n})]});function bf({open:t=!0,players:n,user:s,initialSeconds:a=10,disableEscClose:r=!1,onDone:o,onRequestClose:l}){const[m,d]=i.useState(a),[u,h]=i.useState(!1),x=i.useRef(typeof document<"u"?document.createElement("div"):null),f=i.useRef(null),S=J(g=>g.cameraEnabled),k=J(g=>g.setCameraEnabled),p=$n();i.useEffect(()=>{const g=x.current;if(!(!g||typeof document>"u"))return g.className="ndn-match-start-portal",document.body.appendChild(g),()=>{try{g.parentNode?.removeChild(g)}catch{}}},[]),i.useEffect(()=>{t&&(d(a),h(!1),f.current&&(window.clearTimeout(f.current),f.current=null))},[t,a]),i.useEffect(()=>{if(!t)return;S||k?.(!0);const g=window.setInterval(()=>{d(O=>O<=1?(window.clearInterval(g),h(!0),f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(()=>{try{o?.(),l?.()}catch{}},1e3),0):O-1)},1e3);return()=>{window.clearInterval(g)}},[t,o,l,k,S]),i.useEffect(()=>()=>{f.current&&window.clearTimeout(f.current)},[]),i.useEffect(()=>{if(!t||r)return;const g=O=>{if(O.key==="Escape")try{l?.()}catch{}};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[t,r,l]),i.useEffect(()=>{if(!t||typeof document>"u")return;const g=document.getElementById("root");if(!g)return;const O=g.getAttribute("aria-hidden");return g.setAttribute("aria-hidden","true"),()=>{O==null?g.removeAttribute("aria-hidden"):g.setAttribute("aria-hidden",O)}},[t]),i.useEffect(()=>{if(t){try{p?.acquireKeepAlive?.("match-start-showcase")}catch{}return()=>{try{p?.releaseKeepAlive?.("match-start-showcase")}catch{}}}},[t,p]);const w=i.useMemo(()=>n.map((g,O)=>{try{const E=Co(g.name).toFixed(1),L=Vl(g.name).toFixed(1),A=Wl(g.name),P=Hl(g.name),D=Qt(g.name),j=D.scored||0,R=D.darts||0,M=zl(g.name),$=(g.legs||[]).reduce((ie,je)=>{const Ne=(je.visits||[]).filter(he=>Number(he.visitTotal??he.score)===180).length;return ie+Ne},0),W=n[1-O],Y=W?Fl(g.name,W.name):null,ne=Y&&Y.played?Y.diffA:0,xe=`${ne>0?"+":""}${ne}`;return{id:g.id,name:g.name,avg3:E,best9:L,bestCheckout:A,bestLeg:P,lifetimeScored:j,lifetimeDarts:R,career180s:M,match180s:$,legDiffStr:xe}}catch{return{id:g.id,name:g.name,avg3:"",best9:"",bestCheckout:"",bestLeg:"",lifetimeScored:0,lifetimeDarts:0,career180s:0,match180s:0,legDiffStr:"0"}}}),[n]);if(!t||!x.current)return null;const v=e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black/85 backdrop-blur-md",role:"dialog","aria-modal":"true","aria-label":"Match start showcase",children:e.jsx("div",{className:"min-h-full flex items-center justify-center p-4 sm:p-6 lg:p-8",children:e.jsx("div",{className:"w-full max-w-4xl",children:e.jsx(Fn,{returnFocus:!0,children:e.jsxs("div",{className:"bg-[#0f111a] border border-white/10 rounded-3xl p-5 shadow-2xl ring-1 ring-white/5 relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-4 border-b border-white/5 pb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-emerald-300 uppercase tracking-widest mb-1",children:"Manual scoring only"}),e.jsx("div",{className:"text-2xl md:text-3xl font-black text-white tracking-tighter",children:u||m<=0?"GO":`Match starting in ${m}s`}),e.jsx("p",{className:"text-xs text-white/70 mt-1 max-w-xl",children:"Camera is shown to both players before and during the match. No auto-calibration or auto-scoring is used â€” enter scores manually."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/15 text-white text-xs font-semibold","aria-label":"Close match start showcase",onClick:()=>{try{l?.()}catch{}},children:"Close"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-400 text-black text-xs font-bold","aria-label":"Start match now",onClick:()=>{try{o?.(),l?.()}catch{}},children:"Start now"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-3",children:w.map(g=>e.jsxs("div",{className:"p-3 rounded-2xl border border-white/10 bg-white/5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-black text-white tracking-tight",children:[g.name,s?.username===g.name?"  You":""]}),e.jsxs("div",{className:"text-[10px] text-emerald-300 font-bold",children:["Manual scoring enabled Â· ",g.match180s,"/",g.career180s]})]}),e.jsxs("div",{className:"text-sm text-white/70 font-semibold",children:["180s: ",g.match180s,"/",g.career180s]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsx(za,{label:"Avg",value:String(g.avg3)}),e.jsx(za,{label:"F9",value:String(g.best9)}),e.jsx(za,{label:"CO",value:String(g.bestCheckout)}),e.jsx(za,{label:"Leg Diff",value:g.legDiffStr})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 text-[10px] text-white/70",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{children:"Lifetime pts"}),e.jsx("span",{className:"font-semibold",children:g.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{children:"Lifetime darts"}),e.jsx("span",{className:"font-semibold",children:g.lifetimeDarts.toLocaleString()})]})]})]},g.id))}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between text-sm text-white/80 border-b border-white/5",children:[e.jsx("div",{className:"font-semibold",children:"Camera preview"}),e.jsx("div",{className:"text-xs text-emerald-300 font-bold",children:"Live Manual scoring"})]}),e.jsx("div",{className:"aspect-video relative bg-black",children:e.jsx(pf,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",tileFitModeOverride:"fit",scale:1})}),e.jsx("div",{className:"px-4 py-3 text-xs text-white/70 border-t border-white/5",children:"Confirm your board is visible and stable. Scores will be entered manually during the match."})]})]})]})})})})});return Jr.createPortal(v,x.current)}function xf(t,n="Player"){try{const s=[t?.username,t?.profile?.username,t?.profile?.fullName,t?.fullName,t?.profile?.displayName,t?.displayName,t?.name];for(const a of s){if(typeof a!="string")continue;const r=a.trim();if(r)return r}}catch{}return n}function vf({checkoutRemaining:t,away:n,home:s}){const a=J(o=>o.favoriteDouble),r=i.useMemo(()=>Number.isFinite(t)?cc(t,a)[0]??"":"",[t,a]);return e.jsx("div",{className:"pointer-events-none absolute bottom-4 left-4 z-50 w-[min(92vw,520px)]",children:e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/55 shadow-2xl backdrop-blur",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-white/10",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-slate-300/80",children:"Checkout"}),e.jsx("div",{className:"text-sm font-semibold text-indigo-200",children:r||"â€”"})]}),e.jsx("div",{className:"px-3 py-2",children:[s,n].map(o=>e.jsxs("div",{className:"grid grid-cols-[auto_1fr_auto] items-center gap-3 py-1",children:[e.jsx("div",{className:"w-10 text-center text-sm font-extrabold text-emerald-200",children:o.legsWon}),e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-300/70",children:o.side}),e.jsx("div",{className:"truncate text-sm font-semibold text-white",children:o.name||"â€”"})]})}),e.jsx("div",{className:"w-16 text-right text-lg font-extrabold text-white tabular-nums",children:Number.isFinite(o.remaining)?o.remaining:"â€”"})]},o.side))})]})})}function yf(){const t=gt();J(B=>B.hideInGameSidebar??!0),gt().importState,At(B=>B.setPaused),At();const[n,s]=i.useState(!1),[a,r]=i.useState(null),[o,l]=i.useState(null),m=J(B=>B.lastOffline?.x01Start||501),d=J(B=>B.user),u=d?.username||d?.name||d?.displayName||d?.email?.split("@")[0],h=(t.players||[]).findIndex(B=>B?.name&&B.name===u),x=h>=0?h:0,f=(t.currentPlayerIdx??0)===x,S=t.players?.[x],p=S?.legs?.[S.legs.length-1]?.totalScoreRemaining??t.startingScore??m,w=(t.players||[]).findIndex((B,z)=>z!==x),v=(t.players||[])[w>=0?w:0],O=v?.legs?.[v.legs.length-1]?.totalScoreRemaining??t.startingScore??m;(t.players||[]).filter((B,z)=>z!==x);const E=J(B=>B.callerEnabled),L=J(B=>B.callerVoice),A=J(B=>B.callerVolume),P=J(B=>B.speakCheckoutOnly),[D,j]=i.useState(0),[R,M]=i.useState(0),[$,W]=i.useState(""),[Y,ne]=i.useState(""),[xe,ie]=i.useState(""),[je,Ne]=i.useState([]),[he,ke]=i.useState(!0),ae=wt.useRef(!0),[ve,ye]=i.useState(!1),[Te,Ie]=i.useState("controls"),[Ge,Xe]=i.useState(!1),[Qe,tt]=i.useState(""),dt=i.useRef(null);i.useEffect(()=>{ae.current&&ke(!0)},[]),i.useEffect(()=>{Ge&&dt.current?.focus()},[Ge]),i.useEffect(()=>{try{J.getState().setCameraEnabled(!0)}catch{}try{const z=Ji();if(z?.match)try{gt.getState().importState(z.match)}catch{}else try{gt.getState().importState({...gt.getState(),startingScore:m})}catch{}if(z?.control)try{At.getState().setPaused(z.control.paused,z.control.pauseEndsAt)}catch{}}catch{}s(!0);const B=jm(z=>{try{if(!z)return;z.type==="snapshot"&&z.state&&(z.state.match&&gt.getState().importState(z.state.match),z.state.control&&At.getState().setPaused(z.state.control.paused,z.state.control.pauseEndsAt));const Ce=()=>{try{const se=Ji();if(se&&se.match)return gt.getState().importState(se.match),se.control&&At.getState().setPaused(se.control.paused,se.control.pauseEndsAt),!0}catch{}return!1};if(z.type==="pause")try{At.getState().setPaused(!0,z.pauseEndsAt??null)}catch{}if(z.type==="unpause")try{At.getState().setPaused(!1,null)}catch{}if(z.type==="quit")try{window.close()}catch{}if(z.type==="pendingVisit")try{const se=z.playerIdx??t.currentPlayerIdx;try{Xt.getState().setVisit(z.entries||[],z.darts||0,z.total||0)}catch{}z.frame&&l(z.frame)}catch{}if(z.type==="visit")try{const se=Ce();try{z.meta?.frame&&l(z.meta.frame),z.finished&&z.meta&&(r({label:z.meta.label||$e()||void 0,ring:z.meta.ring,frame:z.meta.frame??z.frame??null,ts:Date.now()}),t.endGame())}catch{}try{Xt.getState().reset()}catch{}}catch{}if(z.type==="nextPlayer")try{if(!Ce())try{const ee=gt.getState(),be={roomId:ee.roomId,players:ee.players,currentPlayerIdx:typeof z.currentPlayerIdx=="number"?z.currentPlayerIdx:(ee.currentPlayerIdx+1)%(ee.players?.length||1),startingScore:ee.startingScore,inProgress:ee.inProgress,bestLegThisMatch:ee.bestLegThisMatch};gt.getState().importState(be)}catch{}}catch{}if(z.type==="endLeg")try{const se=Ce()}catch{}if(z.type==="endGame")try{if(!Ce())try{const ee=gt.getState(),be={roomId:ee.roomId,players:ee.players,currentPlayerIdx:ee.currentPlayerIdx,startingScore:ee.startingScore,inProgress:!1,bestLegThisMatch:ee.bestLegThisMatch};gt.getState().importState(be)}catch{}}catch{}}catch{}});return()=>{try{typeof B=="function"&&B()}catch{}}},[]);const Oe=(B,z,Ce)=>{const se=t.players?.[t.currentPlayerIdx],ee=se?.legs?.[se.legs.length-1],be=ee?ee.totalScoreRemaining:t.startingScore,ht=typeof B=="number"?B:0;let Re=be-ht;if((!Number.isFinite(Re)||Re<0)&&(Re=0),E){const C=se?.name||xf(d,"Player");try{dc(C,ht,Re,L,{volume:A,checkoutOnly:P})}catch{}}t.addVisit(ht,z,Ce??{visitTotal:ht}),Re===0?t.endLeg(ht):t.nextPlayer()},$e=i.useCallback(()=>{try{const B=[];if((t.players||[]).forEach(se=>{(se.legs||[]).forEach(ee=>{if(ee?.finished){const be=(ee.visits||[]).slice(-1)[0];B.push({ts:ee.endTime||Date.now(),visit:be,player:se})}})}),!B.length)return null;const z=B.sort((se,ee)=>ee.ts-se.ts)[0],Ce=(z.visit?.entries||[]).slice(-1)[0];if(Ce?.label)return Ce.label;if(Ce?.ring==="DOUBLE"&&typeof Ce?.value=="number")return`Double ${Ce.value/2}`;if(typeof z.visit?.visitTotal=="number")return`Checkout ${z.visit.visitTotal}`}catch{}return null},[t.players]);return i.useEffect(()=>{if(t.inProgress){r(null);return}if(!a?.label){const B=$e();B&&r(z=>({...z,label:B}))}},[t.inProgress,$e,a?.label]),e.jsxs("div",{className:"card ndn-game-shell ndn-page relative overflow-hidden md:overflow-hidden overflow-y-auto",children:[he&&e.jsx(bf,{open:he,players:t.players||[],onDone:()=>{ae.current=!1,ke(!1)},onRequestClose:()=>{ae.current=!1,ke(!1)},showCalibrationDefault:!0}),e.jsxs("div",{className:"flex items-center gap-3 mb-4 ndn-section-title",children:[e.jsx("button",{className:"btn btn--ghost px-3 py-1",onClick:()=>{try{if(window.opener&&!window.opener.closed)try{window.opener.focus()}catch{}window.close()}catch{}},"aria-label":"Return to app and close match window",children:"Return"}),e.jsx("h2",{className:"text-3xl font-bold text-brand-700",children:"Match ðŸŽ¯"}),e.jsx("div",{className:"ml-auto",children:e.jsx(pc,{})}),a?.label&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:["Winning double: ",a.label]})]}),e.jsxs("div",{className:"ndn-shell-body",style:{paddingBottom:"calc(var(--ndn-bottomnav-h, 0px) + env(safe-area-inset-bottom, 0px) + 16px)"},children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"lg:col-span-3 flex flex-col gap-4",children:[e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-4 sm:p-5 overflow-hidden",children:[e.jsx("div",{className:`pointer-events-none absolute inset-0 bg-gradient-to-br ${f?"from-emerald-500/[0.03]":"from-white/[0.02]"} to-transparent`}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm sm:text-base font-bold text-white/90 tracking-wide",children:"Scoreboard"}),f?e.jsx("div",{className:"px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold bg-emerald-500/20 border border-emerald-400/30 text-emerald-300 animate-pulse",children:"â— Your turn"}):e.jsxs("div",{className:"px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold bg-amber-500/20 border border-amber-400/30 text-amber-300 animate-pulse",children:["â³ ",v?.name||"Opponent","'s turn"]})]}),e.jsx(uf,{gameMode:t?.game||"X01",players:(t.players||[]).map((B,z)=>({name:B.name||`Player ${z+1}`,isCurrentTurn:z===(t.currentPlayerIdx||0),legsWon:B.legsWon||0,score:B.legs?.[B.legs.length-1]?.totalScoreRemaining??t.startingScore??m,lastScore:B.legs?.length&&B.legs[B.legs.length-1].visits?.slice(-1)[0]?.score||0}))})]}),f?e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative w-full rounded-2xl border-2 border-dashed border-emerald-400/40 bg-emerald-500/5 hover:bg-emerald-500/10 active:scale-[0.98] transition-all p-6 sm:p-8 text-center group cursor-pointer focus:outline-none focus:ring-2 focus:ring-emerald-400/50",onClick:()=>{tt(""),Xe(!0)},children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-br from-emerald-500/[0.05] to-transparent"}),e.jsx("div",{className:"text-emerald-300/60 text-xs sm:text-sm uppercase tracking-widest font-semibold mb-2",children:"Enter Score"}),e.jsx("div",{className:"font-mono text-4xl sm:text-5xl font-black text-emerald-200 group-hover:text-emerald-100 transition-colors",children:p}),e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 text-sm font-semibold",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),e.jsx("path",{d:"M8 8h.01M12 8h.01M16 8h.01M8 12h.01M12 12h.01M16 12h.01M8 16h.01M12 16h.01M16 16h.01",strokeLinecap:"round"})]}),"Tap to enter score"]}),(()=>{const B=p<=170?cc(p):null;return B?e.jsx("div",{className:"mt-3 flex flex-wrap justify-center gap-1.5",children:B.map((z,Ce)=>e.jsx("span",{className:"px-2 py-0.5 rounded-lg bg-emerald-500/20 border border-emerald-400/20 text-emerald-100 text-xs font-medium",children:z},Ce))}):null})()]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:[180,140,100,85,60,45,26,0].map(B=>e.jsx("button",{className:"px-4 py-2.5 rounded-xl text-sm font-bold bg-white/5 hover:bg-white/10 active:bg-white/15 border border-white/10 text-white/90 transition-all active:scale-95",onClick:()=>{Oe(B,3,{visitTotal:B})},children:B},B))})]}):e.jsxs("div",{className:"rounded-2xl border border-amber-400/20 bg-amber-500/5 px-4 py-6 text-center",children:[e.jsx("div",{className:"text-amber-300/60 text-xs uppercase tracking-widest font-semibold mb-1",children:"Waiting"}),e.jsxs("div",{className:"text-lg font-bold text-amber-200",children:[v?.name||"Opponent"," is throwingâ€¦"]})]}),a?.label&&e.jsxs("div",{className:"rounded-2xl border border-emerald-400/30 bg-emerald-500/10 px-4 py-3 text-center",children:[e.jsx("span",{className:"text-xs text-emerald-400/70 uppercase tracking-wider font-semibold",children:"Winning Double"}),e.jsx("div",{className:"text-lg font-bold text-emerald-200 mt-0.5",children:a.label})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"lg:sticky lg:top-4",children:e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-white/5 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${f?"bg-emerald-400 shadow-lg shadow-emerald-400/50":"bg-amber-400 shadow-lg shadow-amber-400/50"} animate-pulse`}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-white/80",children:"Live Camera"})]}),!f&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-medium text-amber-300/80",children:["Waiting for ",v?.name||"opponent","â€¦"]})]}),e.jsxs("div",{className:"relative min-h-[14rem] sm:min-h-[20rem] lg:min-h-[24rem] bg-black",children:[e.jsx(bc,{hideInlinePanels:!0,forceAutoStart:!0,onAddVisit:Oe,onEndLeg:B=>{try{t.endLeg(B??0)}catch{}},onVisitCommitted:(B,z,Ce,se)=>{if(!Ce)return;const ee=se?.frame??o??null;r({label:se?.label||$e()||void 0,ring:se?.ring,frame:ee,ts:Date.now()});try{t.endGame()}catch{}}}),e.jsx(vf,{checkoutRemaining:p,away:{side:"Away",name:v?.name||"Away",legsWon:v?.legsWon||0,remaining:O},home:{side:"Home",name:S?.name||"Home",legsWon:S?.legsWon||0,remaining:p}})]})]})})})]}),Ge&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-8",onClick:()=>Xe(!1),children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs("div",{className:"relative z-10 w-full max-w-sm mx-auto bg-slate-900 border border-white/10 rounded-3xl shadow-2xl p-5",style:{animation:"slideUp .2s ease-out"},onClick:B=>B.stopPropagation(),children:[e.jsx("input",{ref:dt,type:"text",inputMode:"numeric",className:"sr-only","aria-label":"Type score",value:Qe,onChange:B=>{const z=B.target.value.replace(/[^0-9]/g,"");(z===""||Number(z)<=180)&&tt(z)},onKeyDown:B=>{if(B.key==="Enter"){B.preventDefault();const z=Math.min(180,Math.max(0,parseInt(Qe)||0));Oe(z,3,{visitTotal:z}),Xe(!1),tt(""),W("")}else B.key==="Escape"?Xe(!1):B.key}}),e.jsxs("div",{className:"text-center mb-4",onClick:()=>dt.current?.focus(),children:[e.jsx("div",{className:"text-xs text-white/50 uppercase tracking-widest mb-1",children:"Score"}),e.jsx("div",{className:"font-mono text-4xl font-black text-white min-h-[2.5rem]",children:Qe||e.jsx("span",{className:"text-white/20",children:"0"})}),e.jsx("div",{className:"text-[10px] text-white/30 mt-1",children:"Type on keyboard or tap below"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[[1,2,3,4,5,6,7,8,9].map(B=>e.jsx("button",{type:"button",className:"py-3.5 rounded-xl text-lg font-bold bg-white/5 hover:bg-white/10 active:bg-white/15 border border-white/10 text-white transition-all active:scale-95",onClick:()=>{const z=Qe+String(B);Number(z)<=180&&tt(z)},children:B},B)),e.jsx("button",{type:"button",className:"py-3.5 rounded-xl text-lg font-bold bg-rose-500/10 hover:bg-rose-500/20 border border-rose-400/20 text-rose-300 transition-all active:scale-95",onClick:()=>tt(B=>B.slice(0,-1)),children:"âŒ«"}),e.jsx("button",{type:"button",className:"py-3.5 rounded-xl text-lg font-bold bg-white/5 hover:bg-white/10 active:bg-white/15 border border-white/10 text-white transition-all active:scale-95",onClick:()=>{if(Qe.length>0){const B=Qe+"0";Number(B)<=180&&tt(B)}},children:"0"}),e.jsx("button",{type:"button",className:"py-3.5 rounded-xl text-lg font-bold bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-200 transition-all active:scale-95",onClick:()=>{const B=Math.min(180,Math.max(0,parseInt(Qe)||0));Oe(B,3,{visitTotal:B}),Xe(!1),tt(""),W("")},children:"âœ“"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 justify-center mb-3",children:[180,140,100,85,60,45,26,0].map(B=>e.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-lg text-xs font-bold bg-indigo-500/10 hover:bg-indigo-500/20 border border-indigo-400/20 text-indigo-200 transition-all active:scale-95",onClick:()=>{Oe(B,3,{visitTotal:B}),Xe(!1),tt(""),W("")},children:B},B))}),e.jsx("button",{type:"button",className:"w-full py-2.5 rounded-xl text-sm font-semibold text-white/50 hover:text-white/80 hover:bg-white/5 transition-all",onClick:()=>Xe(!1),children:"Cancel"})]})]})]})]})}const eo="ndn:open-notifications";function vp(){try{window.dispatchEvent(new CustomEvent(eo))}catch{}}function wf(){const[t,n]=i.useState(null),[s,a]=i.useState(null),r=i.useRef(null),o=(()=>{try{return Os()}catch{return null}})(),l=i.useCallback(()=>{n(null)},[]);return i.useEffect(()=>{if(!o)return;const m=o.addListener(d=>{if(d?.type!=="announcement"||!d.message)return;const u={message:String(d.message),ts:Date.now()};gt.getState().inProgress?a(u):n(u)});return()=>{try{m()}catch{}}},[o]),i.useEffect(()=>gt.subscribe(d=>{!d.inProgress&&s&&(n(s),a(null))}),[s]),i.useEffect(()=>{if(!t)return;const m=d=>{d.key==="Escape"&&l()};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[t,l]),t?e.jsx("div",{ref:r,className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",onClick:m=>{m.target===r.current&&l()},children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"relative w-full max-w-lg rounded-3xl border border-white/10 bg-[#13111C] p-6 md:p-8 shadow-2xl animate-in fade-in zoom-in-95 duration-200 overflow-hidden",onClick:m=>m.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none mix-blend-overlay"}),e.jsx("div",{className:"absolute -top-24 -right-24 w-64 h-64 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute -bottom-24 -left-24 w-64 h-64 bg-emerald-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("button",{className:"absolute right-4 top-4 flex h-8 w-8 items-center justify-center rounded-full bg-rose-500/20 hover:bg-rose-500/40 text-rose-400 hover:text-rose-300 transition z-10",onClick:l,"aria-label":"Close announcement",children:"Ã—"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-indigo-500/20 to-purple-500/20 text-indigo-400 shadow-lg shadow-indigo-500/10 ring-1 ring-white/10",children:e.jsx("span",{className:"text-2xl",children:"ðŸ“¢"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tight",children:"Announcement"}),e.jsx("p",{className:"text-xs text-white/40 font-medium",children:"From Nine Dart Nation"})]})]}),e.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-5",children:e.jsx("p",{className:"text-base text-white/90 leading-relaxed whitespace-pre-wrap",children:t.message})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{className:"btn px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl transition",onClick:l,children:"Got it"})})]})]})}):null}const Nf=768,Sf=1024;function Qi(t){return t<=Nf?"mobile":t<=Sf?"tablet":"desktop"}function jf(){const[t,n]=i.useState(()=>typeof window<"u"?Qi(window.innerWidth):"desktop");return i.useEffect(()=>{const s=()=>n(Qi(window.innerWidth));return window.addEventListener("resize",s),window.addEventListener("orientationchange",s),()=>{window.removeEventListener("resize",s),window.removeEventListener("orientationchange",s)}},[]),t}const Cf={},kf=pn(()=>Et(()=>import("./Home-1HNIjq6Y.js"),__vite__mapDeps([0,1,2,3])));pn(()=>Et(()=>Promise.resolve().then(()=>df),void 0));const Ef=pn(()=>Et(()=>import("./OfflinePlay-CsXnCxeq.js"),__vite__mapDeps([7,1,2,6,8,3]))),Tf=pn(()=>Et(()=>import("./Friends-DqsHSfcd.js"),__vite__mapDeps([11,1,2]))),Af=pn(()=>Et(()=>import("./OnlinePlay.clean-Bt3pIMup.js"),__vite__mapDeps([4,1,2,5,6]))),Df=pn(()=>Et(()=>import("./StatsPanel-Dgq91YTp.js"),__vite__mapDeps([10,3,1,2]))),Mf=pn(()=>Et(()=>import("./Tournaments-Cf9PfzqD.js"),__vite__mapDeps([12,1,2,5,6]))),If=pn(()=>Et(()=>import("./AdminAccess-BhNSupEu.js"),__vite__mapDeps([13,1,2]))),Rf=pn(()=>Et(()=>import("./CameraSetup-70EcP5JK.js"),__vite__mapDeps([14,1,2]))),Of=pn(()=>Et(()=>import("./OpsDashboard-WjjqhZ1q.js"),__vite__mapDeps([15,1,2])));function Lf(){const t=i.useRef(null),[n,s]=i.useState(""),[a,r]=i.useState(!1),o=J(C=>C.cardPaddingBottom),l=J(C=>C.statsCardMinHeight),m=(()=>{try{return Os()}catch{return null}})(),[d,u]=i.useState("score"),h=jf(),x=h==="mobile",f=h==="tablet",[S,k]=i.useState(!1);i.useEffect(()=>{const C=document.documentElement;C.style.setProperty("--ndn-card-padding-bottom",`${o??80}px`),C.style.setProperty("--ndn-stats-card-height",`${l??220}px`)},[o,l]),i.useEffect(()=>{if(!S)return;const C=_=>{_.key==="Escape"&&k(!1)};return document.addEventListener("keydown",C),()=>document.removeEventListener("keydown",C)},[S]),i.useEffect(()=>{x||k(!1)},[x]);const[p,w]=i.useState(null);function v(C){if(!C){w(C);return}w(_=>{const V={..._,...C};return _?.subscription&&!C?.subscription&&(V.subscription=_.subscription),C?.subscription&&(V.subscription=C.subscription),V.fullAccess=!!(V.subscription?.fullAccess||C?.fullAccess||V.fullAccess),V})}const g=(Cf?.VITE_MINIMAL_AFTER_LOGIN||"").toString()==="1",[O,E]=i.useState(!1),[L,A]=i.useState(0),[P,D]=i.useState(0),{avgMode:j,hiddenSections:R}=J(),M=i.useMemo(()=>new Set(R||[]),[R]),$=vo(p?.email);J(C=>C.cameraEnabled);const Y=gt(C=>C.inProgress)&&d!=="score",ne=yo(),xe=Math.abs(P)>=.05?P:0,ie=Ml();J();const je=i.useMemo(()=>Rl(p,$).map(V=>V.key).filter(V=>!M.has(`tab:${V}`)),[p,$,M]);i.useEffect(()=>{je.length&&M.has(`tab:${d}`)&&u(je[0])},[je,M,d]);const[Ne,he]=i.useState(0);i.useEffect(()=>m?m.addListener(_=>{try{if(_?.type==="invite"||_?.type==="match-prestart"||_?.type==="invite-expired"||_?.type==="invite-waiting"||_?.type==="declined"||_?.type==="match-start"){if(_?.type==="invite"){const te=_.fromName||"Someone";he(de=>de+1),ne(`ðŸŽ¯ ${te} wants to join your match!`,{type:"info",timeout:8e3,actionLabel:"View",onAction:()=>u("online")})}_?.type==="match-prestart"&&(gt.getState().inProgress||ne("âš¡ Match starting â€” get ready!",{type:"info",timeout:5e3})),_?.type==="declined"&&he(te=>Math.max(0,te-1)),_?.type==="match-start"&&he(0),!!window.__ndn_online_mounted?u("online"):(window.__ndn_pending_invite=_,u("online"),setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("ndn:match-invite",{detail:_}))}catch{}},200))}(_?.type==="tournament-match-start"||_?.type==="tournament-waiting"||_?.type==="tournament-complete")&&u("tournaments")}catch{}}):void 0,[m,ne]),i.useEffect(()=>{const C=_=>{try{console.warn("Unhandled promise rejection (suppressed):",_.reason),_.preventDefault?.()}catch(V){return console.error("Failed to refresh friend notifications:",V),!1}};return window.addEventListener("unhandledrejection",C),()=>window.removeEventListener("unhandledrejection",C)},[]),i.useEffect(()=>{const C=localStorage.getItem("authToken");C&&fetch(`${ie}/api/auth/me`,{headers:{Authorization:`Bearer ${C}`}}).then(_=>_.json()).then(_=>{if(_?.user){v(_.user);try{const V=(_.user.email||"").toLowerCase(),te=_.user.username||V;localStorage.setItem("ndn:ws-identity",JSON.stringify({username:te,email:V}))}catch{}try{const V=localStorage.getItem(`ndn:subscription:${_.user.email}`);V&&v({..._.user,subscription:JSON.parse(V)})}catch{}ke(_.user)}else localStorage.removeItem("authToken")}).catch(()=>{})},[]),i.useEffect(()=>{if(p&&g){E(!0);const C=setTimeout(()=>E(!1),1500);return()=>clearTimeout(C)}},[g,p]);try{if(new URLSearchParams(window.location.search).get("match")==="1")return e.jsxs(Ui,{children:[e.jsx(Oh,{}),e.jsx(yf,{})]})}catch{}i.useEffect(()=>{const C=()=>{try{localStorage.removeItem("mockUser"),localStorage.removeItem("authToken"),p?.email&&localStorage.removeItem(`ndn:subscription:${p.email}`)}catch{}w(null),u("score")};return window.addEventListener("ndn:logout",C),()=>window.removeEventListener("ndn:logout",C)},[]),i.useEffect(()=>{if(!p?.username){D(0);return}try{localStorage.setItem("ndn:currentUser",p.username),window.ndnCurrentUser=p.username}catch{}try{sa(p.username)}catch{}const C=setTimeout(()=>{try{sa(p.username)}catch{}},5e3),_=()=>{const de=j==="24h"?Zl(p.username):Co(p.username);A(de);const ut=`ndn:allTimeAvgSnapshot:${p.username}`,Nt=Date.now();try{const X=localStorage.getItem(ut);if(!X){localStorage.setItem(ut,JSON.stringify({value:de,ts:Nt})),D(0);return}const fe=JSON.parse(X),pe=Number(fe?.value)||0,Ue=de-pe;D(Number.isFinite(Ue)?Ue:0)}catch{D(0)}};_();const V=()=>_(),te=de=>{const ut=de.key||"";if(!ut)return;[`ndn_stats_${p.username}`,`ndn_stats_ts_${p.username}`,`ndn_stats_daily_${p.username}`,`ndn:allTimeAvgSnapshot:${p.username}`].some(X=>ut.startsWith(X))&&_()};return window.addEventListener("ndn:stats-updated",V),window.addEventListener("storage",te),()=>{clearTimeout(C),window.removeEventListener("ndn:stats-updated",V),window.removeEventListener("storage",te)}},[p?.username,j]),i.useEffect(()=>{if(!p?.username)return;const C=()=>{document.hidden||sa(p.username).then(()=>{window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:p.username}}))}).catch(()=>{})},_=()=>{sa(p.username).then(()=>{window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:p.username}}))}).catch(()=>{})};return document.addEventListener("visibilitychange",C),window.addEventListener("focus",_),()=>{document.removeEventListener("visibilitychange",C),window.removeEventListener("focus",_)}},[p?.username]),i.useEffect(()=>{if(!p?.username){s("");return}const C=localStorage.getItem(`ndn:bio:profilePhoto:${p.username}`);s(C||"")},[p?.username]),i.useEffect(()=>{const C=de=>{de.key?.startsWith("ndn:bio:profilePhoto:")&&p?.username&&de.key.endsWith(p.username)&&s(de.newValue||"")},_=de=>{if(de.detail?.username===p?.username&&s(de.detail?.avatar||""),p?.username){const ut=localStorage.getItem(`ndn:bio:profilePhoto:${p.username}`);s(ut||"")}},V=()=>{if(!document.hidden&&p?.username){const de=localStorage.getItem(`ndn:bio:profilePhoto:${p.username}`);s(de||"")}},te=setInterval(()=>{if(p?.username){const de=localStorage.getItem(`ndn:bio:profilePhoto:${p.username}`);de&&de!==n&&s(de)}},1e4);return window.addEventListener("storage",C),window.addEventListener("ndn:avatar-updated",_),document.addEventListener("visibilitychange",V),()=>{window.removeEventListener("storage",C),window.removeEventListener("ndn:avatar-updated",_),document.removeEventListener("visibilitychange",V),clearInterval(te)}},[p?.username,n]),i.useEffect(()=>{const C=new URLSearchParams(window.location.search),_=C.get("paid"),V=C.get("username-change");if(_==="1"||_==="username-change"||V==="free"){const te=localStorage.getItem("pendingUsernameChange");te&&p?.email&&fetch(`${ie}/api/change-username`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p.email,newUsername:te})}).then(de=>de.json()).then(de=>{de.ok?(alert("Username changed successfully!"),localStorage.removeItem("pendingUsernameChange"),de.token&&localStorage.setItem("authToken",de.token),de.user&&v(de.user),window.history.replaceState({},document.title,window.location.pathname)):alert("Failed to change username: "+(de.error||"Unknown error"))}).catch(()=>{alert("Network error while changing username")})}},[p?.email]),i.useEffect(()=>{const C=()=>r(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",C),r(!!document.fullscreenElement),()=>document.removeEventListener("fullscreenchange",C)},[]),i.useEffect(()=>{new URLSearchParams(window.location.search).get("subscription")==="success"&&p?.email&&fetch(`${ie}/api/auth/me`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}).then(V=>V.json()).then(V=>{V?.user&&(v(V.user),alert("Premium subscription activated successfully!"),window.history.replaceState({},document.title,window.location.pathname))}).catch(()=>{alert("Subscription activated, but failed to refresh user data. Please refresh the page.")})},[p?.email]),i.useEffect(()=>{function C(){const _=document.getElementById("ndn-header");if(!_)return;const V=Math.ceil(_.getBoundingClientRect().height);document.documentElement.style.setProperty("--ndn-header-h",`${V}px`)}return C(),window.addEventListener("resize",C),window.addEventListener("orientationchange",C),()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C)}},[Y]),i.useEffect(()=>{const C=()=>{try{localStorage.removeItem("ndn:avatar"),p?.email&&localStorage.removeItem(`ndn:subscription:${p.email}`)}catch{}w(null),u("score")};return window.addEventListener("ndn:logout",C),()=>window.removeEventListener("ndn:logout",C)},[]),i.useEffect(()=>{if(!(!m?.connected||!p?.email))try{const C=String(p.email||"").toLowerCase(),_=p.username||C;m.send({type:"presence",username:_,email:C});try{localStorage.setItem("ndn:ws-identity",JSON.stringify({username:_,email:C}))}catch{}}catch{}},[m?.connected,p?.email,p?.username]),i.useEffect(()=>{const C=_=>{try{const V=String(_?.detail?.username||"").trim();if(!V)return;w(te=>te&&{...te,username:V});try{const te=(p?.email||"").toLowerCase();m&&V&&te&&m.send({type:"presence",username:V,email:te})}catch{}}catch{}};return window.addEventListener("ndn:username-changed",C),()=>window.removeEventListener("ndn:username-changed",C)},[m,p?.email]),i.useEffect(()=>{const C=_=>{try{const V=String(_?.detail?.tab||"").trim();V&&["score","offline","online","stats","settings","admin","tournaments","friends"].includes(V)&&u(V)}catch{}};return window.addEventListener("ndn:change-tab",C),()=>window.removeEventListener("ndn:change-tab",C)},[]);async function ke(C){try{const _=C?.email?`?email=${encodeURIComponent(C.email)}`:"",V=await fetch("/api/subscription"+_);if(!V.ok)return;const te=await V.json();v({...C,fullAccess:!!te?.fullAccess,subscription:te});try{C?.email&&localStorage.setItem(`ndn:subscription:${C.email}`,JSON.stringify(te))}catch{}}catch{}}const[ae,ve]=i.useState(!1),[ye,Te]=i.useState(!1),[Ie,Ge]=i.useState([]),[Xe,Qe]=i.useState(0),[tt,dt]=i.useState(0),Oe=i.useCallback(async()=>{if(!p?.email)return[];try{const C=localStorage.getItem("authToken"),_={};C&&(_.Authorization=`Bearer ${C}`);const V=await fetch(`/api/notifications?email=${encodeURIComponent(p.email)}`,{headers:_});return V.ok?await V.json()||[]:[]}catch{return[]}},[p?.email]),$e=i.useCallback(async()=>{if(!p?.email){Qe(0),dt(0);return}try{const[C,_]=await Promise.all([De(`/api/friends/requests?email=${encodeURIComponent(p.email)}`),De(`/api/friends/messages?email=${encodeURIComponent(p.email)}`)]),V=C.ok?await C.json():{requests:[]},te=_.ok?await _.json():{messages:[]};Qe(V.requests?.length||0),dt((te.messages||[]).filter(de=>!de.read).length)}catch(C){return console.error("Failed to refresh friend notifications:",C),!1}return!0},[p?.email]),B=i.useRef(0),z=i.useRef(null);if(i.useEffect(()=>{if(!p?.subscription){ve(!1);return}const C=p.subscription,_=Date.now();let V=null;C?.expiresAt&&(V=typeof C.expiresAt=="string"?Date.parse(C.expiresAt):Number(C.expiresAt));const te=4320*60*1e3;if(V&&V>_&&V-_<=te){ve(!0);return}if(V&&V<=_&&!p?.fullAccess){ve(!0);return}if(C?.source==="stripe"&&C?.status&&C.status!=="active"){ve(!0);return}ve(!1)},[p?.subscription,p?.fullAccess]),i.useEffect(()=>{let C=!0;if(!p?.email)return Ge([]),()=>{C=!1};const _=async()=>{const te=await Oe();C&&Ge(te||[])};_();const V=setInterval(_,3e4);return()=>{C=!1,clearInterval(V)}},[Oe,p?.email]),i.useEffect(()=>{if(!p?.email)return;let C=!0;const _=async()=>{try{if(!C||typeof document<"u"&&!document.hasFocus())return;const de=z.current;if(de&&Date.now()<de)return;await $e()?(B.current=0,z.current=null):(B.current=(B.current||0)+1,B.current>=3&&(z.current=Date.now()+300*1e3,console.warn("Friend/message polling disabled for 5 minutes due to repeated failures")))}catch{}};_();const V=()=>{try{_()}catch{}};window.addEventListener("focus",V);const te=setInterval(()=>{try{_()}catch{}},3e4);return()=>{C=!1,window.removeEventListener("focus",V),clearInterval(te)}},[$e,p?.email]),i.useEffect(()=>{p?.email||(Qe(0),dt(0))},[p?.email]),i.useEffect(()=>{if(!p?.subscription||!p?.email)return;const C=p.subscription,_=Date.now();let V=null;C?.expiresAt&&(V=typeof C.expiresAt=="string"?Date.parse(C.expiresAt):Number(C.expiresAt));const te=4320*60*1e3;async function de(ut,Nt){try{const X=localStorage.getItem("authToken"),fe={"Content-Type":"application/json"};X&&(fe.Authorization=`Bearer ${X}`),await fetch("/api/notifications",{method:"POST",headers:fe,body:JSON.stringify({email:p.email,message:Nt,type:ut})})}catch{}}if(V&&V>_&&V-_<=te){de("sub_expiring",`Your premium subscription expires in ${Math.ceil((V-_)/(1440*60*1e3))} day(s)`);return}if(V&&V<=_&&!p?.fullAccess){de("sub_expired","Your premium subscription has ended");return}},[p?.email,p?.subscription,p?.fullAccess]),i.useEffect(()=>{if(!ye)return;const C=_=>{_.key==="Escape"&&Te(!1)};return document.addEventListener("keydown",C),()=>{document.removeEventListener("keydown",C)}},[ye]),i.useEffect(()=>{const C=()=>Te(!0);return window.addEventListener(eo,C),()=>window.removeEventListener(eo,C)},[]),!p)return e.jsx(hh,{onAuth:C=>{try{const _=localStorage.getItem(`ndn:subscription:${C.email}`);v(_?{...C,subscription:JSON.parse(_)}:C)}catch{v(C)}ke(C)}});const Ce=`https://ui-avatars.com/api/?name=${encodeURIComponent(p.username||"NDN")}&background=8F43EE&color=fff&bold=true&rounded=true&size=64`,se=C=>`${C.type||""} ${C.message||""}`.trim(),ee=Ie.filter(C=>/(tournament|bracket)/i.test(se(C))).length,be=Ie.filter(C=>/(check[-_\s]?in)/i.test(se(C))).length,ht=Ie.filter(C=>/(match|invite)/i.test(se(C))).length,Re=[{key:"tournaments",label:"Tournament Closures",description:"Bracket updates and notices.",count:ee,icon:ks},{key:"checkins",label:"Check-ins",description:"Venue reminders and start-of-round checks.",count:be,icon:yd},{key:"match-invites",label:"Match Invites",description:"Pending matches ready to accept.",count:ht+Ne,icon:wd},{key:"friend-requests",label:"Friend Requests",description:"Accept or decline new connections.",count:Xe,icon:Ja},{key:"messages",label:"Messages",description:"Unread chats and replies.",count:tt,icon:hn}];return e.jsxs(Ui,{children:[e.jsxs("div",{ref:t,className:`${p?.fullAccess?"premium-body":""} h-screen overflow-hidden pt-1 pb-0 px-1 xs:pt-2 xs:pb-0 xs:px-2 sm:pt-3 sm:pb-0 sm:px-3 md:pt-4 md:pb-0 md:px-4`,children:[e.jsx(wm,{}),e.jsxs("div",{className:`max-w-[1600px] mx-auto ${x?"flex flex-col":"grid grid-cols-[auto,1fr] gap-4 sm:gap-6"} h-full overflow-hidden`,children:[!x&&e.jsx("div",{className:`relative shrink-0 ${f?"w-56":"w-72"}`,children:e.jsx(Ri,{className:"w-full h-full",active:d,onChange:C=>{u(C)},user:p})}),x&&S&&e.jsxs("div",{className:"fixed inset-0 z-[200] flex",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>k(!1)}),e.jsxs("div",{className:"relative z-10 w-72 h-full animate-in slide-in-from-left duration-200",children:[e.jsx(Ri,{className:"w-full h-full",active:d,onChange:C=>{u(C),k(!1)},user:p}),e.jsx("button",{className:"absolute top-4 right-4 p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors z-20",onClick:()=>k(!1),"aria-label":"Close menu",children:e.jsx(no,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"pt-1 xs:pt-2 relative z-50",children:e.jsxs("header",{id:"ndn-header","data-testid":"ndn-header",className:`header glass flex items-center justify-between gap-2 sm:gap-4 transition-all duration-200 ${Y?"py-1 px-2":"py-2 px-4"}`,style:{willChange:"transform"},children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 shrink ndn-greeting",children:[x&&e.jsx("button",{className:"shrink-0 p-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-white transition-colors",onClick:()=>k(!0),"aria-label":"Open menu",children:e.jsx(bd,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("img",{src:n||Ce,alt:"avatar",className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full ring-1 ring-indigo-400/50 object-cover shadow-sm"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 bg-emerald-500 border border-[#13111C] rounded-full"})]}),e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"truncate text-xs text-white/70 ndn-greeting-welcome",children:["Welcome,"," ",e.jsx("span",{className:"font-bold text-white",children:p.username})]})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-[11px] sm:text-xs text-white/60 ndn-greeting-avg",children:[e.jsx("span",{className:"uppercase tracking-[0.3em] text-white/35 text-[9px]",children:j==="24h"?"30-Day 3-Dart Avg":"All-Time 3-Dart Avg"}),e.jsx("span",{className:"text-sm sm:text-base font-black text-white tracking-tight",children:L.toFixed(1)}),xe!==0&&e.jsxs("span",{className:`flex items-center gap-1 text-[11px] sm:text-xs font-semibold ${xe>0?"text-emerald-300":"text-rose-300"}`,children:[xe>0?e.jsx(xd,{className:"w-3 h-3"}):e.jsx(vd,{className:"w-3 h-3"}),xe>0?"+":"",xe.toFixed(1)]})]})]})})]}),e.jsx("div",{className:"flex-1 flex justify-center px-2",children:e.jsx("h1",{className:"w-full sm:w-auto",children:e.jsxs("button",{type:"button",className:"w-full sm:w-auto flex items-center justify-center rounded-2xl border border-white/10 bg-black/40 px-4 py-2 text-base xs:text-xl sm:text-2xl font-black text-white tracking-tighter drop-shadow-lg whitespace-nowrap cursor-pointer select-none hover:bg-black/50 transition-colors",onClick:()=>{u("score")},title:"Go Home",children:[e.jsx("span",{className:"xs:hidden",children:"NDN ðŸŽ¯"}),e.jsx("span",{className:"hidden xs:inline",children:"NINE-DART-NATION ðŸŽ¯"})]})})}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-3 shrink-0",children:[e.jsx(oc,{className:"mr-1"}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2 bg-black/20 p-1 rounded-full border border-white/5",children:e.jsx("button",{className:"px-2 sm:px-3 py-1 text-[10px] font-bold uppercase tracking-wider rounded-full bg-white/5 hover:bg-white/10 text-white transition-all",onClick:()=>{const C=t.current;C&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):C.requestFullscreen().catch(()=>{}))},children:a?"Exit":"Full"})}),!Y&&e.jsxs("div",{className:"hidden sm:flex items-center ml-2 space-x-2",children:[e.jsx(Ah,{}),e.jsx(Th,{})]})]})]})}),e.jsxs("main",{id:"ndn-main-scroll",className:"space-y-4 flex-1 overflow-y-auto pr-1 flex flex-col",style:{willChange:"scroll-position",transform:"translateZ(0)",WebkitOverflowScrolling:"touch"},children:[d==="settings"&&!M.has("tab:settings")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading settings..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(mh,{user:p})})}),d==="score"&&!M.has("tab:score")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading home..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(kf,{user:p})})}),d==="online"&&!M.has("tab:online")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading online..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(Af,{user:p})})}),d==="camera"&&!M.has("tab:camera")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading camera..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(Rf,{})})}),d==="offline"&&!M.has("tab:offline")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading offline..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(Ef,{user:p})})}),d==="friends"&&!M.has("tab:friends")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading friends..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(Tf,{user:p})})}),d==="stats"&&!M.has("tab:stats")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading stats..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(Df,{user:p})})}),d==="tournaments"&&!M.has("tab:tournaments")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading tournaments..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(Mf,{user:p})})}),d==="admin"&&!M.has("tab:admin")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading admin..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"flex-1 min-h-0 space-y-6",children:[e.jsx(sh,{user:p}),e.jsx(Of,{user:p})]})})}),d==="fullaccess"&&!M.has("tab:fullaccess")&&e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"Loading admin access..."}),children:e.jsx(mn,{className:"flex-1 min-h-0",children:e.jsx(If,{user:p})})})]})]})]})]}),!M.has("global:helpassistant")&&e.jsx(ph,{}),!M.has("global:footer")&&e.jsx(Rh,{}),!O&&!M.has("global:camera-logger")&&e.jsx(Nh,{}),!O&&!M.has("global:camera-watchdog")&&e.jsx(Ch,{}),!O&&!M.has("global:camera-recovery")&&e.jsx(Eh,{}),ye&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-start sm:items-center justify-center bg-black/90 backdrop-blur-sm pt-0 px-2 pb-2 sm:p-4 overflow-y-auto",onClick:()=>Te(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"relative w-full max-w-4xl max-h-[100dvh] sm:max-h-[85vh] overflow-y-auto overflow-x-hidden rounded-3xl sm:rounded-3xl border border-white/10 bg-[#13111C] pt-4 px-4 pb-4 sm:p-6 md:p-8 shadow-2xl animate-in fade-in zoom-in-95 duration-200",onClick:C=>C.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none mix-blend-overlay"}),e.jsx("div",{className:"absolute -top-24 -right-24 w-64 h-64 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute -bottom-24 -left-24 w-64 h-64 bg-emerald-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("button",{className:"absolute right-4 top-4 flex h-8 w-8 items-center justify-center rounded-full bg-white/5 hover:bg-white/10 text-white transition z-20",onClick:()=>Te(!1),"aria-label":"Close notifications",children:"Ã—"}),e.jsxs("div",{className:"relative z-10 flex items-center gap-4 mb-8 border-b border-white/5 pb-6",children:[e.jsx("div",{className:"p-4 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-amber-400 shadow-lg shadow-amber-500/10 ring-1 ring-white/10",children:e.jsx(hi,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tight",children:"Notifications"}),e.jsx("p",{className:"text-sm text-white/50 font-medium",children:"Stay updated with your latest activity"})]})]}),e.jsxs("div",{className:"relative z-10",children:[ae&&e.jsxs("div",{className:"mb-8 rounded-2xl bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 p-6 flex flex-col sm:flex-row items-start gap-5 shadow-lg shadow-amber-500/5",children:[e.jsx("div",{className:"p-3 rounded-xl bg-amber-500/20 text-amber-400 shrink-0 ring-1 ring-amber-500/30",children:e.jsx(ks,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-amber-200",children:"Premium Subscription Alert"}),e.jsx("p",{className:"text-sm text-amber-100/70 mt-1 leading-relaxed",children:"Your premium subscription is expiring soon or has expired. Renew now to keep full access to all features!"}),e.jsx("button",{onClick:()=>{Te(!1),u("settings")},className:"mt-4 px-6 py-2.5 rounded-xl bg-gradient-to-r from-amber-500 to-orange-600 text-white font-bold text-sm hover:shadow-lg hover:shadow-amber-500/25 hover:scale-105 transition-all duration-200",children:"Manage Subscription"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-10",children:Re.map(C=>{const _=C.icon;return e.jsxs("div",{className:"group flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/10 transition-all duration-200 cursor-pointer hover:shadow-xl hover:shadow-black/20 hover:-translate-y-0.5",onClick:()=>{Te(!1),(C.key==="friend-requests"||C.key==="messages")&&u("friends"),C.key==="tournaments"&&u("tournaments"),C.key==="match-invites"&&u("online")},children:[e.jsx("div",{className:"p-3 rounded-xl bg-indigo-500/10 text-indigo-400 group-hover:bg-indigo-500/20 group-hover:text-indigo-300 group-hover:scale-110 transition-all duration-300 ring-1 ring-white/5",children:e.jsx(_,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-white group-hover:text-indigo-200 transition-colors",children:C.label}),e.jsx("p",{className:"text-xs text-white/50 group-hover:text-white/70 transition-colors",children:C.description})]}),C.count>0&&e.jsx("span",{className:"px-3 py-1 rounded-full bg-rose-500 text-white font-bold text-xs shadow-lg shadow-rose-500/30 animate-pulse",children:C.count})]},C.key)})}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"Recent Activity"}),Ie.length>0&&e.jsxs("span",{className:"text-xs font-medium text-white/30 bg-white/5 px-2 py-1 rounded-md",children:[Ie.length," total"]})]}),e.jsx("div",{className:"space-y-3",children:Ie.length===0?e.jsxs("div",{className:"text-center py-16 rounded-3xl border border-dashed border-white/10 bg-white/[0.02]",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-white/5 flex items-center justify-center text-white/20",children:e.jsx(hi,{className:"h-8 w-8"})}),e.jsx("p",{className:"text-white/40 font-medium",children:"No recent notifications"}),e.jsx("p",{className:"text-xs text-white/20 mt-1",children:"You're all caught up!"})]}):Ie.map(C=>e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border p-5 transition-all duration-200 group ${C.read?"bg-white/[0.02] border-white/5 hover:bg-white/5":"bg-white/10 border-white/10 hover:bg-white/15 shadow-lg shadow-black/20"}`,children:[!C.read&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-rose-500 to-orange-500"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-[0.65rem] font-bold uppercase tracking-wider px-2 py-1 rounded-md ring-1 ring-inset ${C.read?"bg-white/5 text-white/40 ring-white/5":"bg-rose-500/10 text-rose-300 ring-rose-500/20"}`,children:C.type||"General"}),e.jsx("span",{className:"text-xs text-white/30 font-medium",children:new Date(C.createdAt).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),!C.read&&e.jsx("span",{className:"self-start sm:self-auto rounded-full bg-rose-500 px-2 py-0.5 text-[0.6rem] font-bold uppercase tracking-widest text-white shadow-sm shadow-rose-500/20",children:"New"})]}),e.jsx("p",{className:"text-sm font-medium text-white/90 leading-relaxed pl-1",children:C.message}),C.link&&e.jsx("a",{href:C.link,target:"_blank",rel:"noreferrer",className:"mt-4 inline-flex items-center gap-1.5 text-xs font-bold text-emerald-400 hover:text-emerald-300 transition-colors bg-emerald-500/10 px-3 py-1.5 rounded-lg hover:bg-emerald-500/20",children:"Open Link â†—"}),e.jsxs("div",{className:"mt-4 flex items-center gap-3 border-t border-white/5 pt-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[!C.read&&e.jsx("button",{onClick:async _=>{_.stopPropagation();try{const V=localStorage.getItem("authToken");await fetch(`/api/notifications/${encodeURIComponent(C.id)}?email=${encodeURIComponent(p.email)}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V}`},body:JSON.stringify({read:!0})});const te=await Oe();te&&Ge(te)}catch{}},className:"text-xs font-bold text-white/50 hover:text-white transition-colors uppercase tracking-wider",children:"Mark as read"}),e.jsx("button",{onClick:async _=>{if(_.stopPropagation(),!!confirm("Delete this notification?"))try{const V=localStorage.getItem("authToken");await fetch(`/api/notifications/${encodeURIComponent(C.id)}?email=${encodeURIComponent(p.email)}`,{method:"DELETE",headers:{Authorization:`Bearer ${V}`}});const te=await Oe();te&&Ge(te)}catch{}},className:"text-xs font-bold text-rose-400/50 hover:text-rose-400 transition-colors ml-auto uppercase tracking-wider",children:"Delete"})]})]},C.id))})]})]})}),!O&&e.jsx(Sh,{}),e.jsx(wf,{})]})}function Pf(t){return t.length>=10&&/\d/.test(t)&&/[^A-Za-z0-9]/.test(t)}function _f(){const[t,n]=i.useState(""),[s,a]=i.useState(""),[r,o]=i.useState(""),[l,m]=i.useState(""),[d,u]=i.useState("");i.useEffect(()=>{try{const f=new URLSearchParams(window.location.search).get("token")||"";n(f)}catch{}},[]);async function h(x){if(x.preventDefault(),m(""),u(""),!t){m("Missing or invalid reset token.");return}if(!s||s!==r){m("Passwords do not match.");return}if(!Pf(s)){m("Password must be at least 10 chars and include a number and symbol.");return}try{const S=await(await De("/api/auth/confirm-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,newPassword:s})})).json();if(!S?.ok)throw new Error(S?.error||"Reset failed");u("Password changed. You can now sign in.")}catch(f){m(f?.message||"Reset failed")}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsx("div",{className:"relative z-10 w-full max-w-lg mx-auto p-4",children:e.jsxs("form",{className:"card w-full space-y-4",onSubmit:h,children:[e.jsx("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:e.jsx("h1",{className:"logo text-center",children:"Reset your password"})}),!t&&e.jsx("div",{className:"text-red-400",children:"This reset link is missing a token. Please use the link from your email."}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"New password",value:s,onChange:x=>a(x.target.value),required:!0}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"Confirm password",value:r,onChange:x=>o(x.target.value),required:!0}),l&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:l}),d&&e.jsx("div",{className:"text-emerald-400 font-semibold text-sm",children:d}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:!t,children:"Change Password"}),e.jsx("a",{className:"underline text-sm text-center",href:"/",children:"Back to sign in"})]})})]})}function Ff(t){return/failed to fetch dynamically imported module/i.test(t)||/loading chunk .* failed/i.test(t)||/importing a module script failed/i.test(t)}class $f extends i.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,message:String(n?.message||n)}}componentDidCatch(n,s){console.error("[ErrorBoundary]",n,s);const a=String(n?.message||n||"");if(Ff(a)){const r="ndn_chunk_reload";if(!sessionStorage.getItem(r)){sessionStorage.setItem(r,"1"),window.location.reload();return}}}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"card max-w-lg w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"opacity-80 mb-4",children:"Please refresh the page. If this persists, let us know."}),this.state.message&&e.jsx("pre",{className:"text-xs bg-black/40 rounded p-2 overflow-auto text-left",children:this.state.message}),e.jsx("button",{className:"btn mt-4",onClick:()=>window.location.reload(),children:"Reload"})]})}):this.props.children}}function Uf(){if(!(typeof window>"u"))try{window.deferredInstallPrompt=null,window.addEventListener("beforeinstallprompt",t=>{(window.__NDN_DEFER_INSTALL_PROMPT__||localStorage.getItem("NDN_DEFER_INSTALL_PROMPT")==="1")&&(t.preventDefault(),window.deferredInstallPrompt=t)}),window.promptInstallApp=async()=>{try{const t=window.deferredInstallPrompt;if(!t)return!1;t.prompt();const n=await t.userChoice;return!!n&&n.outcome==="accepted"}catch{return!1}}}catch{}}const Bf={};function Vf(){if(!(String(Bf?.VITE_QUIET_CONSOLE||"").trim()==="1"))return;const n=window;if(n.__ndnQuietConsoleInstalled)return;n.__ndnQuietConsoleInstalled=!0;const s={error:console.error.bind(console),warn:console.warn.bind(console),log:console.log.bind(console)},a=m=>{const d=m.map(u=>typeof u=="string"?u:u?.message||"").join(" ");return!!(/Not implemented: HTMLMediaElement's play\(\) method/i.test(d)||/WebSocket connection to .* failed/i.test(d)||/ERR_NETWORK_IO_SUSPENDED|ERR_NETWORK_CHANGED/i.test(d))},r=new Map,o=2e3,l=m=>(...d)=>{if(a(d))return;const u=String(d[0]??""),h=Date.now(),x=r.get(u)||0;h-x<o||(r.set(u,h),m(...d))};console.error=l(s.error),console.warn=l(s.warn),window.addEventListener("unhandledrejection",m=>{const d=m.reason&&(m.reason.message||String(m.reason))||"unhandledrejection",u=Date.now(),h=r.get(d)||0;u-h<o||(r.set(d,u),s.warn("[ndn] Unhandled promise rejection:",m.reason))})}try{window.React=window.React||{}}catch{}rm();Uf();Vf();try{sessionStorage.removeItem("ndn_chunk_reload")}catch{}try{let t=null;const n=s=>{try{if(t=s,console.error("[NDN ErrorCollector] Captured error:",s),typeof navigator<"u"&&navigator.clipboard?.writeText)try{const a=typeof s=="string"?s:JSON.stringify(s,null,2);navigator.clipboard.writeText(a).then(()=>console.info("[NDN ErrorCollector] Error copied to clipboard"),()=>console.info("[NDN ErrorCollector] Could not copy to clipboard"))}catch{}}catch(a){try{console.error("[NDN ErrorCollector] capture failed",a)}catch{}}};window.addEventListener("error",s=>{try{const a={message:s?.message||s?.error&&s.error.message||String(s),filename:s?.filename||null,lineno:s?.lineno||null,colno:s?.colno||null,stack:s?.error?.stack||s?.error&&String(s.error)||null,type:"error"};n(a)}catch(a){try{console.error("[NDN ErrorCollector] error handler failed",a)}catch{}}},!0),window.addEventListener("unhandledrejection",s=>{try{const a=s?.reason,r={message:a?.message||String(a)||"UnhandledRejection",stack:a?.stack||null,type:"unhandledrejection"};n(r)}catch(a){try{console.error("[NDN ErrorCollector] unhandledrejection handler failed",a)}catch{}}}),window.__ndn_error_collector={collect:async()=>{try{if(!t)return null;if(typeof navigator<"u"&&navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(JSON.stringify(t,null,2)),console.info("[NDN ErrorCollector] Last error copied to clipboard")}catch{console.info("[NDN ErrorCollector] Could not copy last error to clipboard")}return t}catch(s){try{console.error("[NDN ErrorCollector] collect failed",s)}catch{}return null}},last:()=>t}}catch(t){try{console.warn("[NDN ErrorCollector] install failed",t)}catch{}}kd.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx($f,{children:e.jsx(Zm,{children:e.jsx(Hf,{})})})}));function Hf(){return window.location.pathname==="/reset"?e.jsx(_f,{}):e.jsx(Lf,{})}const Wf=new URLSearchParams(window.location.search).get("pwa")==="1"||typeof localStorage<"u"&&localStorage.getItem("NDN_ENABLE_PWA")==="1";if(Wf&&typeof navigator<"u"&&"serviceWorker"in navigator)try{navigator.serviceWorker.register("/sw.js").then(t=>{console.debug("[ServiceWorker] Registered",t)}).catch(t=>{console.warn("[ServiceWorker] Registration failed",t)})}catch{}else if(typeof navigator<"u"&&"serviceWorker"in navigator)try{navigator.serviceWorker.getRegistrations().then(t=>{if(!t||t.length===0)return;try{console.info("[ServiceWorker] Found",t.length,"registrations â€” unregistering to avoid stale caches")}catch{}let n=!1;t.forEach(s=>{try{s.active&&(n=!0)}catch{}try{s.unregister()}catch(a){try{console.warn("[ServiceWorker] unregister failed:",a)}catch{}}});try{const s=typeof localStorage<"u"&&localStorage.getItem("NDN_FORCE_SW_RELOAD")==="1";if(n&&s)try{console.info("[ServiceWorker] Active worker removed; forcing page reload to fetch latest assets"),localStorage.removeItem("NDN_FORCE_SW_RELOAD"),window.location.reload()}catch{}}catch{}})}catch{}export{Xt as $,Dm as A,Nm as B,pf as C,bc as D,Bn as E,Os as F,uf as G,Fa as H,op as I,Um as J,fa as K,Fl as L,bf as M,Vl as N,Wl as O,zh as P,Hl as Q,Mh as R,zl as S,ec as T,_n as U,Jl as V,Zl as W,Im as X,Sm as Y,Rm as Z,Bm as _,De as a,pc as a0,Wt as a1,hp as a2,gp as a3,Hi as a4,Wi as a5,Un as a6,mp as a7,Hh as a8,up as a9,dp as aa,fp as ab,Vh as ac,$n as ad,Qa as ae,cp as af,bp as ag,xp as ah,Xi as ai,fc as aj,pp as ak,Zr as al,$h as am,ha as an,vo as ao,Co as b,Yl as c,er as d,yo as e,vp as f,Qt as g,Ml as h,ip as i,e as j,gt as k,At as l,Ht as m,xf as n,dc as o,Ds as p,lp as q,Jr as r,cc as s,Fm as t,J as u,$m as v,Hm as w,rp as x,sp as y,ap as z};
//# sourceMappingURL=index-zYyjKDd0.js.map

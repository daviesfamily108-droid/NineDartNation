import{j as e,R as De,h as cn,a as dn,i as mn,u as un,k as xn,l as hn,m as bs,n as fs,o as fa,T as pn,q as ga,p as be,b as bn,c as fn,s as gs}from"./index-hEoLjEue.js";import{r as c}from"./ui-CuWypN7C.js";import{u as ya}from"./match-Bov6r4NF.js";import{a as gn,R as va,C as M}from"./CameraView-Cm4v6VMJ.js";import{g as yn,i as vn,o as ja,D as re,A as G,n as jn,N as Nn,p as Na,s as ys,c as Et,C as wa,a as qe,b as Ye,k as Sa,d as Qe,h as vs,m as wn,e as js,f as Ns,O as Sn,T as ws,G as kn,q as Cn,r as Ss,M as In,E as Mn,F as Dn,H as Tn,I as An,J as Pn,K as En,L as _n,v as Bn,w as Rn,B as On,x as $n,y as Ln,z as Hn}from"./useGameStats-BUBeBCPI.js";import{M as Fn}from"./MatchStartShowcase-Drb4-30d.js";import{u as ka,c as Wn,a as Un}from"./profanity-DTWR8NUG.js";import"./vendor-D3F3s8fL.js";import"./pendingVisit-DMkUfJ7h.js";function Gn(i){let R=0,y=0,u=null,N=null,E=0;for(const h of i.legs||[]){R+=h.totalScoreStart-h.totalScoreRemaining;const C=(h.visits||[]).reduce((I,Q)=>I+(Q.darts||0)-(Q.preOpenDarts||0),0);y+=C,h.finished&&((u===null||h.dartsThrown<u)&&(u=h.dartsThrown),(N===null||h.dartsThrown>N)&&(N=h.dartsThrown));for(const I of h.visits||[])(I?.score||0)===180&&(E+=1)}const O=y>0?R/y*3:0,D=O*3;return{points:R,darts:y,threeDA:O,nineDA:D,bestLeg:u,worstLeg:N,oneEighties:E}}function Kn({open:i,onClose:R,title:y="Match Summary",players:u,centerScore:N,doublesStats:E,allowRematch:O,onRematch:D}){if(!i)return null;const h=u.map(C=>{const I=Gn(C),Q=E?.[C.id]||{},L=Math.max(0,Number(Q.dartsAtDouble||0)),K=Math.max(0,Number(Q.doublesHit||0)),X=L>0?Math.round(K/L*100):null;return{id:C.id,name:C.name,legsWon:C.legsWon,...I,dartsAtDouble:L,doublesHit:K,doublePct:X}});return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[120]",children:e.jsxs(De,{storageKey:"ndn:modal:match-summary",className:"w-full relative",defaultWidth:860,defaultHeight:540,minWidth:640,minHeight:420,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:y}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:["Players: ",u.map(C=>C.name).join(" vs ")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[h[0]&&e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:h[0].name}),e.jsx("div",{className:"text-3xl font-extrabold",children:h[0].legsWon}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:h[0].threeDA.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:h[0].nineDA.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:h[0].dartsAtDouble??"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsx("div",{className:"font-semibold",children:h[0].doublePct!==null&&h[0].doublePct!==void 0?`${h[0].doublePct}%`:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:h[0].bestLeg?`${h[0].bestLeg} darts`:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:h[0].worstLeg?`${h[0].worstLeg} darts`:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:h[0].oneEighties})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsx("div",{className:"text-4xl font-black",children:N||(u.length===2?`${h[0]?.legsWon??0} – ${h[1]?.legsWon??0}`:"")})}),h[1]&&e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:h[1].name}),e.jsx("div",{className:"text-3xl font-extrabold",children:h[1].legsWon}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:h[1].threeDA.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:h[1].nineDA.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:h[1].dartsAtDouble??"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsx("div",{className:"font-semibold",children:h[1].doublePct!==null&&h[1].doublePct!==void 0?`${h[1].doublePct}%`:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:h[1].bestLeg?`${h[1].bestLeg} darts`:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:h[1].worstLeg?`${h[1].worstLeg} darts`:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:h[1].oneEighties})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:R,children:"Close"}),O&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:D,children:"Rematch"})]})]})})}const Ia="ndn:blocked:v1";function Xn(){try{const i=localStorage.getItem(Ia);return i?JSON.parse(i):{}}catch{return{}}}function Ca(i){try{localStorage.setItem(Ia,JSON.stringify(i))}catch{}}const Vn=cn((i,R)=>({blocked:Xn(),isBlocked:y=>!!R().blocked[(y||"").toLowerCase()],block:y=>i(u=>{const N={...u.blocked};return N[(y||"").toLowerCase()]=Date.now(),Ca(N),{blocked:N}}),unblock:y=>i(u=>{const N={...u.blocked};return delete N[(y||"").toLowerCase()],Ca(N),{blocked:N}}),all:()=>Object.keys(R().blocked)}));function ir({user:i}){const R="http://localhost:8787",y=dn(),u=(()=>{try{return mn()}catch{return null}})(),N=Vn(),[E,O]=c.useState("room-1"),[D,h]=c.useState(!1),[C,I]=c.useState([]),[Q,L]=c.useState(!1),[K,X]=c.useState(!1),Te=c.useRef(null),[le,ks]=c.useState(null),j=c.useRef(null),_t=c.useRef(0),Ae=c.useRef(null),Bt=c.useRef(!0),Cs=c.useRef(0),Is=c.useRef(!1),r=ya(),Ze=ka(),{favoriteDouble:et,callerEnabled:Rt,callerVoice:Ot,callerVolume:$t,speakCheckoutOnly:Lt,allowSpectate:fe,cameraScale:ge,setCameraScale:tt,cameraFitMode:ye="fill",setCameraFitMode:st,cameraEnabled:Ms,textSize:Ds,boxSize:Ma,autoscoreProvider:Da,matchType:Ta="singles",setMatchType:Aa,teamAName:Pa="Team A",setTeamAName:Ea,teamBName:_a="Team B",setTeamBName:Ba,x01DoubleIn:Ra}=un(),Ht=Da==="manual";c.useEffect(()=>{ye!=="fit"&&st("fit")},[ye,st]);const T=(t=>{switch(t){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(Ds),[ve,Ts]=c.useState(2),[Oa,je]=c.useState(!1),[ie,As]=c.useState([]),[Ps,qn]=c.useState(0),[b,f]=c.useState(0),[oe,at]=c.useState(0),[ce,nt]=c.useState(0),[Ft,Wt]=c.useState(""),[V,rt]=c.useState(0),[Ne,lt]=c.useState(0),[Es,_s]=c.useState(""),[J,it]=c.useState(20),[Pe,Ut]=c.useState(0),[de,Gt]=c.useState(0),[Bs,Rs]=c.useState(""),[te,Os]=c.useState(30),[ot,Kt]=c.useState(!1),[ct,$a]=c.useState(null),[z,$s]=c.useState(null),[La,dt]=c.useState(!1);function Ha(){if(z)try{const t=new Blob([JSON.stringify(z,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a"),n=`ndn-highlight-${z.player||"player"}-${z.ts||Date.now()}.json`;a.href=s,a.download=n,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(s),y?.("Downloaded highlight to device",{type:"success"}),dt(!1)}catch{y?.("Download failed",{type:"error"})}}async function Fa(){if(!z)return;const t=localStorage.getItem("authToken");if(!t){y?.("You must be signed in to save to account",{type:"error"});return}try{const s=await fs("/api/user/highlights",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(z)});if(!s.ok){const n=await s.json().catch(()=>({}));y?.(`Save failed: ${n.error||s.statusText}`,{type:"error"});return}const a=await s.json();y?.("Saved highlight to your account",{type:"success"}),dt(!1)}catch{y?.("Save failed",{type:"error"})}}const[Yn,Wa]=c.useState(null),Ls=c.useRef(null),[mt,ut]=c.useState(""),[Z,xt]=c.useState({}),[me,Ee]=c.useState({}),[ue,_e]=c.useState({}),[xe,Be]=c.useState({}),[q,ht]=c.useState({}),[he,pt]=c.useState({}),[Re,bt]=c.useState({}),[Oe,ft]=c.useState({}),[$,Xt]=c.useState(()=>yn()),[H,k]=c.useState(0),[se,$e]=c.useState(!1),[Le,gt]=c.useState(null),[yt,He]=c.useState({}),[ae,Fe]=c.useState(null),[We,Hs]=c.useState(300),vt=gn(t=>t.setPaused),[jt,Ua]=c.useState(()=>{try{const t=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(t)}catch{return!1}}),[Fs,Ws]=c.useState(!1),Us=c.useRef(!!ya.getState().inProgress),[Ga,Gs]=c.useState(!1),Vt=c.useRef(!1);c.useEffect(()=>{const t=Us.current,s=!!r.inProgress;t&&!s&&(r.players||[]).some(n=>(n.legs||[]).some(o=>o.finished))&&Ws(!0),Us.current=s,s||(Vt.current=!1),s&&!Vt.current&&(Vt.current=!0,Gs(!0))},[r.inProgress,r.players]),c.useEffect(()=>{try{return}catch{}},[]);const Ka=(()=>{const t={};for(const s of r.players||[]){let a=0,n=0;for(const o of s.legs||[])for(const d of o.visits||[])a+=Math.max(0,Number(d.doubleWindowDarts||0)),d.finishedByDouble&&(n+=1);t[s.id]={dartsAtDouble:a,doublesHit:n}}return t})(),[ne,Ks]=c.useState(null),Xs=c.useRef(null),Ue=c.useRef(null);c.useEffect(()=>{if(!se||!ae)return;const t=setInterval(()=>{Date.now()>=(ae||0)&&($e(!1),gt(null),He({}),Fe(null),vt(!1,null),v())},1e3);return()=>clearInterval(t)},[se,ae]);function Xa(){try{if(!Ue.current){const t=window.AudioContext||window.webkitAudioContext;t&&(Ue.current=new t)}Ue.current?.resume?.().catch(()=>{})}catch{}}function we(t,s,a=0,n=.05){const o=Ue.current;if(!o)return;const d=o.createOscillator(),m=o.createGain();d.type="square",d.frequency.value=t,m.gain.value=n,d.connect(m),m.connect(o.destination);const l=o.currentTime+a;d.start(l),d.stop(l+s/1e3)}function Va(t){Xa(),Ue.current&&(t==="180"?(we(880,110,0,.06),we(1175,110,.06,.06),we(1568,140,.12,.06)):(we(659,140,0,.07),we(784,140,.08,.07),we(987,200,.16,.07)))}function F(t,s){const a=Date.now(),n=Xs.current;n&&n.kind===t&&n.by===s&&a-n.ts<500||(Xs.current={kind:t,by:s,ts:a},Ks({kind:t,by:s,turnIdx:r.currentPlayerIdx,ts:a}),Va(t))}const[Ja,ee]=c.useState(!1),[za,Vs]=c.useState([]),[Jt,Js]=c.useState("bestof"),[Se,Nt]=c.useState(5),[zt,zs]=c.useState(501),[S,wt]=c.useState(null),[qs,ke]=c.useState("");function qa(t){ke(t),setTimeout(()=>ke(""),4e3);try{y(t||"Stripe checkout failed",{type:"error"})}catch{}}const[Y,Ya]=c.useState(null),[Ys,St]=c.useState(null),[P,Qs]=c.useState("X01"),[p,qt]=c.useState("X01"),[Zs,Qa]=c.useState(!1),[Ce,Yt]=c.useState(30),[kt,Za]=c.useState(!!Ra),pe=i?.username&&!i?.fullAccess?xn(i.username):1/0,W=!i?.fullAccess&&pe<=0,[Qt,ea]=c.useState("all"),[Zt,es]=c.useState("all"),[Ge,ta]=c.useState("all"),[Ie,sa]=c.useState(!1),[Me,ts]=c.useState(10),{H:ss}=hn(),Ct=i?.username?bs(i.username):0,as=ka(t=>t.unread),ns=(za||[]).filter(t=>!(Qt!=="all"&&t.mode!==Qt||Zt!=="all"&&Number(t.startingScore)!==Number(Zt)||Ge!=="all"&&t.game!==Ge||Ie&&(!Ct||!t.creatorAvg||Math.abs(Number(t.creatorAvg)-Number(Ct))>Me)));c.useEffect(()=>{const t=s=>{const a=s?.detail||{};a.game&&Qs(a.game),(a.mode==="bestof"||a.mode==="firstto")&&Js(a.mode),typeof a.value=="number"&&isFinite(a.value)&&Nt(Math.max(1,Math.floor(a.value))),typeof a.start=="number"&&isFinite(a.start)&&zs(Math.max(1,Math.floor(a.start))),ee(!0)};return window.addEventListener("ndn:online-demo",t),()=>window.removeEventListener("ndn:online-demo",t)},[]),c.useEffect(()=>{const t=String(i?.email||"").toLowerCase();t&&fs(`/api/friends/messages?email=${encodeURIComponent(t)}`).then(s=>s.json()).then(s=>{s?.ok&&Array.isArray(s.messages)&&Ze.load(s.messages)}).catch(()=>{})},[i?.email]),c.useEffect(()=>{const t=s=>{try{const a=s?.detail||{},n=Number(a.start||501);r.newMatch([i?.username||"You","Opponent"],n,E),r.addVisit(60,3),r.nextPlayer(),r.addVisit(85,3),r.nextPlayer(),r.addVisit(100,3),qt("X01"),je(!0)}catch(a){console.error("Demo error:",a)}};return window.addEventListener("ndn:online-match-demo",t),()=>window.removeEventListener("ndn:online-match-demo",t)},[]),c.useEffect(()=>(Bt.current=!0,rs(),()=>{Bt.current=!1,Ae.current&&clearTimeout(Ae.current);try{j.current?.close()}catch{}}),[]),c.useEffect(()=>{Ze.setInGame(r.inProgress)},[r.inProgress]),c.useEffect(()=>{ne&&r.currentPlayerIdx!==ne.turnIdx&&Ks(null)},[r.currentPlayerIdx,ne?.turnIdx]),c.useEffect(()=>{try{u&&u.connected?u.send({type:"presence",username:i?.username||"guest",email:(i?.email||"").toLowerCase(),allowSpectate:fe}):j.current&&j.current.readyState===WebSocket.OPEN&&j.current.send(JSON.stringify({type:"presence",username:i?.username||"guest",email:(i?.email||"").toLowerCase(),allowSpectate:fe}))}catch{}},[fe,u?.connected]),c.useEffect(()=>{const t=s=>{const a=s?.detail?.roomId;a&&(O(a),u?u.send({type:"spectate",roomId:a}):j.current?.send(JSON.stringify({type:"spectate",roomId:a})),je(!0),ee(!1))};return window.addEventListener("ndn:spectate-room",t),()=>window.removeEventListener("ndn:spectate-room",t)},[u]);function rs(){if(u){u.connected&&(u.send({type:"join",roomId:E}),u.send({type:"presence",username:i?.username||"guest",email:(i?.email||"").toLowerCase(),allowSpectate:fe}),u.send({type:"list-matches"}),h(!0));return}try{if(j.current&&(j.current.readyState===WebSocket.OPEN||j.current.readyState===WebSocket.CONNECTING))return}catch{}const t="ws://localhost:8787",s=window.location.protocol==="https:"?"wss":"ws",a=window.location.hostname,n=`${s}://${a}${window.location.port?"":":8787"}`,o=t.length>0?t:n,d=new WebSocket(o);j.current=d,d.onopen=()=>{h(!0),_t.current=0,Is.current?y("Reconnected to lobby",{type:"success"}):(y("Connected to lobby",{type:"success"}),Is.current=!0),d.send(JSON.stringify({type:"join",roomId:E})),d.send(JSON.stringify({type:"presence",username:i?.username||"guest",email:(i?.email||"").toLowerCase(),allowSpectate:fe})),d.send(JSON.stringify({type:"list-matches"}))},d.onmessage=m=>{const l=JSON.parse(m.data);if(l.type==="state"){r.importState(l.payload);const g=Number(l.payload._dpIndex),A=Number(l.payload._dpHits);Number.isFinite(g)&&at(Math.max(0,g)),Number.isFinite(A)&&nt(Math.max(0,A));const B=Number(l.payload._atcIndex),U=Number(l.payload._atcHits);Number.isFinite(B)&&rt(Math.max(0,B)),Number.isFinite(U)&&lt(Math.max(0,U));try{const x=Number(l.payload._trebleTarget),hs=Number(l.payload._trebleHits),At=Number(l.payload._trebleDarts),_=Number(l.payload._trebleMaxDarts);Number.isFinite(x)&&it(Math.max(1,Math.min(20,x))),Number.isFinite(hs)&&Ut(Math.max(0,hs)),Number.isFinite(At)&&Gt(Math.max(0,At)),Number.isFinite(_)&&Os(Math.max(0,_))}catch{}try{const x=l.payload._cricketById;x&&typeof x=="object"&&xt(x)}catch{}try{const x=l.payload._shanghaiById;x&&typeof x=="object"&&Ee(x)}catch{}try{const x=l.payload._halveById;x&&typeof x=="object"&&_e(x)}catch{}try{const x=l.payload._highlowById;x&&typeof x=="object"&&Be(x)}catch{}try{const x=l.payload._killerById;x&&typeof x=="object"&&ht(x)}catch{}try{const x=l.payload._amCricketById;x&&typeof x=="object"&&pt(x)}catch{}try{const x=l.payload._baseballById;x&&typeof x=="object"&&bt(x)}catch{}try{const x=l.payload._golfById;x&&typeof x=="object"&&ft(x)}catch{}try{const x=l.payload._tttState;x&&typeof x=="object"&&Xt(x)}catch{}try{const x=Number(l.payload._turnDarts);Number.isFinite(x)&&k(Math.max(0,x))}catch{}try{const x=l.payload._x01DoubleIn;typeof x=="boolean"&&Kt(x)}catch{}}else if(l.type==="joined")l.id&&ks(l.id);else if(l.type==="presence"||l.type==="peer-joined")As(g=>{const A=new Set(g);return l.id&&A.add(l.id),Array.from(A)});else if(l.type==="chat"){const g=!!(l.from&&le&&l.from===le),A=g?i?.username||"me":l.from||"peer",B=String(l.from||"");if(!g&&B&&N.isBlocked(B))return;if(g&&Te.current&&String(l.message||"")===Te.current.text){Te.current=null;return}I(U=>[...U,{from:A,message:l.message,fromId:B||void 0}])}else if(l.type==="matches")Vs(Array.isArray(l.matches)?l.matches:[]);else if(l.type==="invite")wt({matchId:l.matchId,fromId:l.fromId,fromName:l.fromName,calibrated:!!l.calibrated,boardPreview:l.boardPreview||null,game:l.game,mode:l.mode,value:l.value,startingScore:l.startingScore});else if(l.type==="match-start")O(l.roomId),d.send(JSON.stringify({type:"join",roomId:l.roomId})),je(!0),ee(!1),l.match?.game&&qt(l.match.game),i?.username&&!i?.fullAccess&&fa(i.username);else if(l.type==="declined")y("Invite declined",{type:"info"});else if(l.type==="error"){const g=typeof l.message=="string"?l.message:"Action not allowed";if(ke(g),l.code==="SPECTATE_NOT_ALLOWED")try{y("This player has spectating turned off.",{type:"error"})}catch{}l.code==="NOT_FOUND"&&Y&&St({game:Y.game,mode:Y.mode,value:Y.value,startingScore:Y.startingScore}),setTimeout(()=>ke(""),3500)}else if(l.type==="friend-invite")confirm(`${l.fromName||l.fromEmail} invited you to play ${l.game||"X01"} (${l.mode==="firstto"?"First To":"Best Of"} ${l.value||1}). Accept?`)?d.send(JSON.stringify({type:"start-friend-match",toEmail:l.fromEmail,game:l.game,mode:l.mode,value:l.value,startingScore:l.startingScore})):y("Invite declined",{type:"info"});else if(l.type==="friend-message")Ze.add({id:l.id||`${l.ts}-${l.from}`,from:l.from,message:l.message,ts:l.ts||Date.now()}),r.inProgress||y(`${l.from}: ${l.message}`,{type:"info"});else if(l.type==="celebration"){const g=l.by||"Player",A=l.kind==="leg"?"leg":"180";F(A,g)}else if(l.type==="cam-code")console.log("Received cam-code:",l.code),$a(l.code),y(`Pairing code: ${l.code}`,{type:"info"});else if(l.type==="cam-peer-joined")console.log("Mobile peer joined for code:",l.code),rn(l.code);else if(l.type==="cam-answer"){console.log("Received cam-answer");const g=window.mobilePC;g&&g.setRemoteDescription(new RTCSessionDescription(l.payload))}else if(l.type==="cam-ice"){console.log("Received cam-ice");const g=window.mobilePC;g&&g.addIceCandidate(l.payload)}},d.onclose=()=>{if(h(!1),!Bt.current)return;const m=(_t.current||0)+1;_t.current=m;const l=Math.min(3e4,1e3*Math.pow(2,m-1)),g=Date.now();g-Cs.current>4e3&&(y(`Disconnected. Reconnecting in ${Math.round(l/1e3)}s...`,{type:"error"}),Cs.current=g),Ae.current&&clearTimeout(Ae.current),Ae.current=setTimeout(()=>{rs()},l)}}function aa(){const t=r.players||[],s=r.currentPlayerIdx||0,a=t[s],n=a?.legs?.[a?.legs?.length-1],o=n?n.totalScoreRemaining:r.startingScore,d=(()=>{let _=0,Pt=0;if(a?.legs)for(const ps of a.legs){_+=ps.totalScoreStart-ps.totalScoreRemaining;const ln=(ps.visits||[]).reduce((on,ba)=>on+(ba.darts||0)-(ba.preOpenDarts||0),0);Pt+=ln}return{pts:_,darts:Pt}})(),m=d.darts>0?d.pts/d.darts*3:0,l=n?.visits?.[n.visits.length-1]?.score??0;let g="ÔÇö";t.length===2?g=`${t[0]?.legsWon||0}-${t[1]?.legsWon||0}`:t.length>2&&(g=t.map(_=>`${_.name}:${_.legsWon||0}`).join(" = "));const A=r.bestLegThisMatch,B=A?`${A.darts} darts${(()=>{const _=t.find(Pt=>Pt.id===A.playerId);return _?` (${_.name})`:""})()}`:"-",x=(_=>{switch(_){case"small":return"text-xs";case"large":return"text-base";default:return"text-sm"}})(Ds),At=(_=>{switch(_){case"small":return"p-2";case"large":return"p-4";default:return"p-3"}})(Ma);return e.jsxs("div",{className:`${At} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${x}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:g}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold",children:a?.name||"ÔÇö"}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-lg",children:o}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:m.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:l}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:B})]})]})}c.useEffect(()=>{if(!u)return;h(u.connected);const t=u.addListener(s=>{try{if(s.type==="state"){r.importState(s.payload);try{const a=Number(s.payload._dpIndex),n=Number(s.payload._dpHits);Number.isFinite(a)&&at(Math.max(0,a)),Number.isFinite(n)&&nt(Math.max(0,n))}catch{}try{const a=Number(s.payload._atcIndex),n=Number(s.payload._atcHits);Number.isFinite(a)&&rt(Math.max(0,a)),Number.isFinite(n)&&lt(Math.max(0,n))}catch{}try{const a=s.payload._cricketById;a&&typeof a=="object"&&xt(a)}catch{}try{const a=s.payload._shanghaiById;a&&typeof a=="object"&&Ee(a)}catch{}try{const a=s.payload._halveById;a&&typeof a=="object"&&_e(a)}catch{}try{const a=s.payload._highlowById;a&&typeof a=="object"&&Be(a)}catch{}try{const a=s.payload._killerById;a&&typeof a=="object"&&ht(a)}catch{}try{const a=s.payload._amCricketById;a&&typeof a=="object"&&pt(a)}catch{}try{const a=s.payload._baseballById;a&&typeof a=="object"&&bt(a)}catch{}try{const a=s.payload._golfById;a&&typeof a=="object"&&ft(a)}catch{}try{const a=s.payload._tttState;a&&typeof a=="object"&&Xt(a)}catch{}try{const a=Number(s.payload._turnDarts);Number.isFinite(a)&&k(Math.max(0,a))}catch{}try{const a=!!s.payload._paused;$e(a)}catch{}try{const a=Number(s.payload._pauseEndsAt);Fe(Number.isFinite(a)?a:null)}catch{}try{const a=s.payload._pauseRequestedBy;gt(typeof a=="string"?a:null)}catch{}try{const a=s.payload._pauseAcceptedBy;a&&typeof a=="object"&&He(a)}catch{}try{const a=Number(s.payload._pauseDurationSec);Number.isFinite(a)&&Hs(Math.max(60,Math.min(600,a)))}catch{}try{const a=s.payload._x01DoubleIn;typeof a=="boolean"&&Kt(a)}catch{}vt(!!s.payload._paused,Number(s.payload._pauseEndsAt)||null)}else if(s.type==="joined")s.id&&ks(s.id);else if(s.type==="presence"||s.type==="peer-joined")As(a=>Array.from(new Set([...a||[],s.id].filter(Boolean))));else if(s.type==="chat"){const a=!!(s.from&&le&&s.from===le),n=a?i?.username||"me":s.from||"peer",o=String(s.from||"");if(!a&&o&&N.isBlocked(o))return;I(d=>[...d,{from:n,message:s.message,fromId:o||void 0}])}else if(s.type==="matches")Vs(Array.isArray(s.matches)?s.matches:[]);else if(s.type==="invite")wt({matchId:s.matchId,fromId:s.fromId,fromName:s.fromName,calibrated:!!s.calibrated,boardPreview:s.boardPreview||null,game:s.game,mode:s.mode,value:s.value,startingScore:s.startingScore});else if(s.type==="match-start")O(s.roomId),u.send({type:"join",roomId:s.roomId}),je(!0),ee(!1),s.match?.game&&qt(s.match.game),i?.username&&!i?.fullAccess&&fa(i.username);else if(s.type==="declined")y("Invite declined",{type:"info"});else if(s.type==="error"){const a=typeof s.message=="string"?s.message:"Action not allowed";if(ke(a),s.code==="SPECTATE_NOT_ALLOWED")try{y("This player has spectating turned off.",{type:"error"})}catch{}s.code==="NOT_FOUND"&&Y&&St({game:Y.game,mode:Y.mode,value:Y.value,startingScore:Y.startingScore}),setTimeout(()=>ke(""),3500)}else if(s.type==="friend-invite")confirm(`${s.fromName||s.fromEmail} invited you to play ${s.game||"X01"} (${s.mode==="firstto"?"First To":"Best Of"} ${s.value||1}). Accept?`)?u.send({type:"start-friend-match",toEmail:s.fromEmail,game:s.game,mode:s.mode,value:s.value,startingScore:s.startingScore}):y("Invite declined",{type:"info"});else if(s.type==="friend-message")Ze.add({id:s.id||`${s.ts}-${s.from}`,from:s.from,message:s.message,ts:s.ts||Date.now()}),r.inProgress||y(`${s.from}: ${s.message}`,{type:"info"});else if(s.type==="celebration"){const a=s.by||"Player",n=s.kind==="leg"?"leg":"180";F(n,a)}}catch{}});return u.connected&&(u.send({type:"join",roomId:E}),u.send({type:"presence",username:i?.username||"guest",email:(i?.email||"").toLowerCase(),allowSpectate:fe}),u.send({type:"list-matches"})),()=>{t()}},[u?.connected]);function v(){if(u){u.send({type:"state",payload:{...r,_turnIdx:Ps,_participants:ie,_dpIndex:oe,_dpHits:ce,_atcIndex:V,_atcHits:Ne,_trebleTarget:J,_trebleHits:Pe,_trebleDarts:de,_trebleMaxDarts:te,_x01DoubleIn:ot,_cricketById:Z,_shanghaiById:me,_halveById:ue,_highlowById:xe,_killerById:q,_amCricketById:he,_baseballById:Re,_golfById:Oe,_tttState:$,_turnDarts:H,_paused:se,_pauseEndsAt:ae,_pauseRequestedBy:Le,_pauseAcceptedBy:yt,_pauseDurationSec:We}});return}const t=j.current;!t||t.readyState!==WebSocket.OPEN||t.send(JSON.stringify({type:"state",payload:{...r,_turnIdx:Ps,_participants:ie,_dpIndex:oe,_dpHits:ce,_atcIndex:V,_atcHits:Ne,_trebleTarget:J,_trebleHits:Pe,_trebleDarts:de,_trebleMaxDarts:te,_x01DoubleIn:ot,_cricketById:Z,_shanghaiById:me,_halveById:ue,_highlowById:xe,_killerById:q,_amCricketById:he,_baseballById:Re,_golfById:Oe,_tttState:$,_turnDarts:H,_paused:se,_pauseEndsAt:ae,_pauseRequestedBy:Le,_pauseAcceptedBy:yt,_pauseDurationSec:We}}))}function en(t){const s=i?.username||"me";if(I(n=>[...n,{from:s,message:t,fromId:le||"self"}]),Te.current={text:t,ts:Date.now()},u){u.send({type:"chat",message:t});return}const a=j.current;!a||a.readyState!==WebSocket.OPEN||a.send(JSON.stringify({type:"chat",message:t}))}function It(t){if(Cn(t,oe)){const a=ce+1,n=oe+1;nt(a),at(n);try{if(a>=re.length){const o=r.players[r.currentPlayerIdx]?.name||"Player";F("leg",o),nt(0),at(0)}}catch{}}v()}function Mt(){const t=Math.max(0,Math.floor(b|0));It(t),f(0)}function Dt(){const t=Ss(Ft);t!=null&&(It(t),Wt(""))}function tn(t,s,a){const n=G[V];return n==null?!1:typeof a=="number"&&a>=1&&a<=20&&a===n&&(s==="SINGLE"||s==="DOUBLE"||s==="TRIPLE")?!0:n===25?s==="BULL"||t===25:n===50?s==="INNER_BULL"||t===50:t===n||t===n*2||t===n*3}function ls(t,s,a){if(tn(t,s,a)){const n=Ne+1,o=V+1;lt(n),rt(o);try{if(n>=G.length){const d=r.players[r.currentPlayerIdx]?.name||"Player";F("leg",d),lt(0),rt(0)}}catch{}}v()}function na(){const t=Math.max(0,Math.floor(b|0));ls(t),f(0)}function ra(){const t=Ss(Es);t!=null&&(ls(t),_s(""))}function is(t,s,a){if(te>0&&de>=te)return;(s==="TRIPLE"&&a===J||!s&&t===J*3)&&Ut(o=>o+1),Gt(o=>{const d=o+1;if(d%3===0&&[20,19,18].includes(J)){const m=[20,19,18],l=m.indexOf(J),g=m[(l+1)%m.length];it(g)}return d}),v()}function la(){const t=Math.max(0,Math.floor(b|0));is(t),f(0)}function ia(){const t=Ss(Bs);t!=null&&(is(t),Rs(""))}function oa(){Ut(0),Gt(0)}function w(){return r.players[r.currentPlayerIdx]?.id??String(r.currentPlayerIdx)}function os(t){Z[t]||xt(s=>({...s,[t]:Et()}))}function cs(t){me[t]||Ee(s=>({...s,[t]:qe()}))}function ds(t){ue[t]||_e(s=>({...s,[t]:Ye()}))}function ms(t){xe[t]||Be(s=>({...s,[t]:Qe()}))}function us(t){if(!q[t]){const s=new Set(Object.values(q||{}).map(o=>o.number)),a=[];for(let o=1;o<=20;o++)s.has(o)||a.push(o);const n=a.length>0?a[Math.floor(Math.random()*a.length)]:20;ht(o=>({...o,[t]:In(n,3)}))}}function ca(t){he[t]||pt(s=>({...s,[t]:vs()}))}function da(t){Re[t]||bt(s=>({...s,[t]:js()}))}function ma(t){Oe[t]||ft(s=>({...s,[t]:Ns()}))}c.useEffect(()=>{k(0)},[r.currentPlayerIdx,p]);function sn(t,s){const a=r.players.filter(n=>n.id!==s);return a.length===0?!1:a.every(n=>(Z[n.id]?.marks?.[t]||0)>=3)}function Ke(t,s,a){const n=w();os(n),xt(d=>{const m={...d},l={...m[n]||Et()};return Mn(l,t,s,a,g=>sn(g,n)),m[n]=l,m});const o=H+1;k(o),o>=3&&(k(0),r.nextPlayer()),v()}function Xe(t,s,a){const n=w();cs(n),Ee(d=>{const m={...d},l={...m[n]||qe()};return Dn(l,t,s,a),m[n]=l,m});const o=H+1;k(o),o>=3&&(Ee(d=>{const m={...d},l={...m[n]||qe()};return Tn(l),m[n]=l,m}),k(0),r.nextPlayer()),v()}function Ve(t,s,a){const n=w();ds(n),_e(d=>{const m={...d},l={...m[n]||Ye()};return An(l,t,s,a),m[n]=l,m});const o=H+1;k(o),o>=3&&(_e(d=>{const m={...d},l={...m[n]||Ye()};return Pn(l),m[n]=l,m}),k(0),r.nextPlayer()),v()}function Je(t,s,a){const n=w();ms(n),Be(d=>{const m={...d},l={...m[n]||Qe()};return En(l,t,s,a),m[n]=l,m});const o=H+1;k(o),o>=3&&(Be(d=>{const m={...d},l={...m[n]||Qe()};return _n(l),m[n]=l,m}),k(0),r.nextPlayer()),v()}function ze(t,s){const a=w();r.players.forEach(o=>us(o.id)),ht(o=>{const d={};for(const[l,g]of Object.entries(o))d[l]={...g};Bn(a,d,t,s);const m=Rn(d);if(m)try{F("leg",r.players.find(l=>l.id===m)?.name||"Player")}catch{}return d});const n=H+1;k(n),n>=3&&(k(0),r.nextPlayer()),v()}function ua(t,s,a){const n=w();ca(n),pt(d=>{const m={...d},g={...m[n]||vs()};return On(g,t,s,a,B=>r.players.filter(U=>U.id!==n).every(U=>(he[U.id]?.marks?.[B]||0)>=3)),m[n]=g,m});const o=H+1;k(o),o>=3&&(k(0),r.nextPlayer()),v()}function xa(t,s,a){const n=w();da(n),bt(d=>{const m={...d},l={...m[n]||js()};return $n(l,t,s,a),m[n]=l,m});const o=H+1;k(o),o>=3&&(k(0),r.nextPlayer()),v()}function ha(t,s,a){const n=w();ma(n),ft(d=>{const m={...d},l={...m[n]||Ns()};return Ln(l,t,s,a),m[n]=l,m});const o=H+1;k(o),o>=3&&(k(0),r.nextPlayer()),v()}function xs(t,s,a,n){Xt(d=>{const m={...d,board:[...d.board]};return Hn(m,t,s,a,n),m});const o=H+1;k(o),o>=3&&(k(0),r.nextPlayer()),v()}function pa(){try{window.dispatchEvent(new Event("ndn:open-manual"))}catch{}}function Tt(t){const s=Math.max(0,t|0);try{const o=r.players[r.currentPlayerIdx],d=o?.legs?.[o.legs.length-1],m=d?d.totalScoreRemaining:r.startingScore,l=Math.max(0,m-s),g=m<=50?3:l<=50?1:0,A=l===0;r.addVisit(s,3,{preOpenDarts:0,doubleWindowDarts:g,finishedByDouble:A,visitTotal:s})}catch{r.addVisit(s,3)}f(0);const a=r.players[r.currentPlayerIdx],n=a.legs[a.legs.length-1];try{s===180&&F("180",a?.name||"Player"),n&&n.totalScoreRemaining===0&&F("leg",a?.name||"Player")}catch{}if(n&&n.totalScoreRemaining===0?r.endLeg(s):r.nextPlayer(),Rt){const o=n?n.totalScoreRemaining:r.startingScore;ys(i?.username||"Player",s,Math.max(0,o),Ot,{volume:$t,checkoutOnly:Lt})}i?.username&&a?.name===i.username&&gs(i.username,3,s),v()}function an(t,s){const a={type:"report",offenderId:t,reason:"Inappropriate language",message:s};try{u?u.send(a):j.current?.send(JSON.stringify(a))}catch{}try{y("Report submitted",{type:"info"})}catch{}}async function nn(){try{const t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),s=t.getVideoTracks?.()[0],a=document.createElement("video");a.srcObject=t,await a.play().catch(()=>{}),await new Promise(g=>setTimeout(g,120));const n=Math.min(320,a.videoWidth||320),o=Math.max(1,Math.floor((a.videoHeight||180)*(n/Math.max(1,a.videoWidth||320)))),d=document.createElement("canvas");d.width=n,d.height=o,d.getContext("2d").drawImage(a,0,0,n,o);const l=d.toDataURL("image/jpeg",.7);try{s&&s.stop()}catch{}try{t.getTracks?.().forEach(g=>g.stop())}catch{}return l}catch{return null}}const rn=async t=>{console.log("Starting WebRTC for code:",t);try{const s=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});s.ontrack=n=>{console.log("Received track:",n.streams[0]),Wa(n.streams[0]),Ls.current&&(Ls.current.srcObject=n.streams[0],console.log("Set video srcObject"))},s.onicecandidate=n=>{n.candidate&&(console.log("Sending ICE candidate"),u?u.send({type:"cam-ice",code:t,payload:n.candidate}):j.current&&j.current.readyState===WebSocket.OPEN&&j.current.send(JSON.stringify({type:"cam-ice",code:t,payload:n.candidate})))},s.onconnectionstatechange=()=>console.log("Connection state:",s.connectionState);const a=await s.createOffer();if(await s.setLocalDescription(a),console.log("Sending offer"),u)console.log("Sending offer via wsGlobal"),u.send({type:"cam-offer",code:t,payload:a});else if(j.current&&j.current.readyState===WebSocket.OPEN)console.log("Sending offer via wsRef"),j.current.send(JSON.stringify({type:"cam-offer",code:t,payload:a}));else{console.log("WS not available, POSTing offer to /cam/signal");try{await fs(`/cam/signal/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"cam-offer",payload:a,source:"desktop"})})}catch(n){console.warn("REST offer failed",n)}}window.mobilePC=s}catch(s){console.error("WebRTC error:",s),y("Failed to start mobile camera",{type:"error"})}};return e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[Ga&&e.jsx(Fn,{players:r.players||[],onDone:()=>Gs(!1)}),e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Online Play"}),e.jsxs("div",{className:"ndn-shell-body",children:[se&&e.jsxs("div",{className:"absolute inset-0 z-40 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold mb-2",children:"Game Paused"}),e.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Resumes ",ae?`in ${Math.max(0,Math.ceil((ae-Date.now())/1e3))}s`:"soon"]}),e.jsx("div",{className:"text-xs opacity-60",children:"Both players can see this pause screen."})]}),as>0&&!r.inProgress&&e.jsxs("div",{className:"mb-3 text-sm px-3 py-2 rounded bg-amber-600/30 border border-amber-500/40",children:["You have ",as," unread message",as>1?"s":"",". Check the Friends tab."]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs opacity-70 shrink-0",children:"Room"}),e.jsx("input",{className:"input w-28",value:E,onChange:t=>O(t.target.value),placeholder:"room-1"})]}),D?e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0",children:"Connected"}):e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 shrink-0",onClick:rs,children:"Connect"}),e.jsx("button",{className:"btn shrink-0",onClick:v,disabled:!D,children:"Sync"}),null,!se&&!Le&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs opacity-70",children:"Pause (max 10m)"}),e.jsxs("select",{className:"input w-28",value:We,onChange:t=>Hs(Math.max(60,Math.min(600,parseInt(t.target.value)||300))),children:[e.jsx("option",{value:120,children:"2 min"}),e.jsx("option",{value:300,children:"5 min"}),e.jsx("option",{value:600,children:"10 min"})]}),e.jsx("button",{className:"btn",disabled:!D,onClick:()=>{const t=i?.username||"player";gt(t),He({[t]:!0}),$e(!1),Fe(null),v()},children:"Request Pause"})]}),!se&&Le&&!yt[i?.username||""]&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"opacity-80",children:[Le," requested a ",Math.round((We||300)/60),"m pause"]}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{const t=i?.username||"",s={...yt,[t]:!0};He(s);const a=Object.keys(s).filter(o=>!!s[o]).length,n=Math.max(2,ie?.length||2);if(a>=2||a>=n){const o=Date.now()+Math.min(600,Math.max(60,We||300))*1e3;$e(!0),Fe(o),vt(!0,o)}v()},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>{gt(null),He({}),$e(!1),Fe(null),vt(!1,null),v()},children:"Decline"})]}),se&&e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-yellow-500/25 text-yellow-100 border border-yellow-400/40 shrink-0",children:["Paused · ",Math.max(0,Math.ceil(((ae||Date.now())-Date.now())/1e3)),"s"]}),e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40 shrink-0",title:"Open a simulated online match demo",onClick:()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch(t){console.error("Demo click error:",t)}},children:"DEMO"}),D&&e.jsx("button",{className:"btn shrink-0",onClick:()=>je(!0),disabled:W,title:W?"Weekly free games used":"",children:"Open Match"})]})}),e.jsx("div",{className:`mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end ${!D||W?"opacity-60 cursor-not-allowed":"cursor-pointer"}`,role:"button",title:D?W?"Weekly free games used":"Create a new match":"Connect to the lobby first",onClick:()=>{!D||W||(ee(!0),u?u.send({type:"list-matches"}):j.current?.send(JSON.stringify({type:"list-matches"})))},children:e.jsx("button",{className:"btn",disabled:!D||W,children:"Create Match +"})}),e.jsx("p",{className:"text-sm text-slate-600 mt-3",children:"Open this app on another device and join the same Room ID to sync scores."}),!i?.fullAccess&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Weekly free online games remaining: ",pe===1/0?"ÔÇö":pe]}),!i?.fullAccess&&pe!==1/0&&pe<=0&&e.jsx("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm",children:"You've used your 3 free online games this week. PREMIUM required to continue."}),qs&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"material-icons text-rose-300",children:"error_outline"}),qs]}),Ys&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-700/30 border border-indigo-600/40 text-indigo-100 text-sm flex items-center justify-between gap-2",children:[e.jsx("div",{children:"That room is full or no longer available. Create a new clean room with the same settings?"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const{game:t,mode:s,value:a,startingScore:n}=Ys,o=i?.username?bs(i.username):0;u?(u.send({type:"create-match",game:t,mode:s,value:a,startingScore:n||501,creatorAvg:o}),u.send({type:"list-matches"})):(j.current?.send(JSON.stringify({type:"create-match",game:t,mode:s,value:a,startingScore:n||501,creatorAvg:o})),j.current?.send(JSON.stringify({type:"list-matches"}))),St(null)},children:"Create New Match"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>St(null),children:"Dismiss"})]})]}),D&&e.jsxs("div",{className:"mt-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10 flex-1 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"World Lobby"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs opacity-80",children:["Matches: ",ns.length]}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>u?u.send({type:"list-matches"}):j.current?.send(JSON.stringify({type:"list-matches"})),children:"Refresh"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",title:D?W?"Weekly free games used":"Create a new match":"Connect to the lobby first",disabled:!D||W,onClick:()=>{!D||W||(ee(!0),u?u.send({type:"list-matches"}):j.current?.send(JSON.stringify({type:"list-matches"})))},children:"Create Match +"})]})]}),e.jsxs("div",{className:"space-y-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Mode"}),e.jsx(pn,{tabs:[{key:"all",label:"All"},{key:"bestof",label:"Best of"},{key:"firstto",label:"First to"}],active:Qt,onChange:t=>ea(t)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-2 font-semibold",children:"Game"}),e.jsxs("select",{className:"input w-full text-sm",value:Ge,onChange:t=>ta(t.target.value),children:[e.jsx("option",{value:"all",children:"All"}),ga.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-2 font-semibold",children:"Starting Score"}),e.jsxs("select",{className:"input w-full text-sm",value:Zt,onChange:t=>{const s=t.target.value;es(s==="all"?"all":Number(s))},disabled:Ge!=="all"&&Ge!=="X01",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"301",children:"301"}),e.jsx("option",{value:"501",children:"501"}),e.jsx("option",{value:"701",children:"701"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-2 font-semibold",children:"Opponent Average"}),e.jsxs("div",{className:"flex items-center gap-2 h-10 px-3 rounded bg-slate-900/30 border border-slate-500/30",children:[e.jsx("input",{id:"nearavg",type:"checkbox",className:"w-4 h-4 cursor-pointer accent-purple-500",checked:Ie,onChange:t=>sa(t.target.checked),title:!Ct||Ct===0?"Play a game first to use this filter":"Filter matches near your average"}),e.jsx("label",{htmlFor:"nearavg",className:"cursor-pointer text-sm flex-1",children:"Near my avg"}),e.jsx("input",{type:"number",className:"input w-20 text-sm px-2 py-1",min:5,max:40,step:1,value:Me,onChange:t=>{const s=parseInt(t.target.value||"10");isNaN(s)||ts(Math.max(5,Math.min(40,s)))},disabled:!Ie,title:"Tolerance range (±)"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-2",children:[e.jsxs("div",{className:"flex-1 max-w-xs",children:[e.jsx("label",{className:`block text-xs opacity-70 mb-2 font-semibold ${Ie?"":"opacity-40"}`,children:"Avg Tolerance (±)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"1",max:"50",value:Me,onChange:t=>{const s=parseInt(t.target.value,10);isNaN(s)||ts(Math.max(1,Math.min(50,s)))},disabled:!Ie,title:"Drag to set tolerance",className:"w-32 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:Ie?"linear-gradient(to right, rgb(55, 65, 81) 0%, rgb(55, 65, 81) "+(Me-1)/49*100+"%, rgb(88, 28, 135) "+(Me-1)/49*100+"%, rgb(88, 28, 135) 100%)":"linear-gradient(to right, rgb(71, 85, 105) 0%, rgb(71, 85, 105) 100%)"}}),e.jsxs("div",{className:"text-xs font-mono font-semibold w-8 text-right text-purple-400",children:["±",Me]})]})]}),e.jsx("button",{className:"btn px-3 py-2 text-sm mt-6",onClick:()=>{ea("all"),ta("all"),es("all"),sa(!1),ts(10)},children:"Reset"})]})]}),ns.length===0?e.jsx("div",{className:"text-sm text-slate-300",children:"No games waiting. Create one!"}):e.jsx("div",{className:"space-y-2",children:ns.map(t=>e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 flex items-center justify-between relative",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[t.game||"X01"," ",t.game==="X01"?` ${t.startingScore}`:""," - ",t.mode==="bestof"?`Best Of ${t.value}`:`First To ${t.value}`," - Created by ",t.creatorName]}),t.requireCalibration&&e.jsx("div",{className:"text-[11px] inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-600/30 mt-1",children:"Calibration required"}),t.creatorAvg?e.jsxs("div",{className:"text-xs opacity-70",children:["Creator avg: ",Number(t.creatorAvg).toFixed(1)]}):null,e.jsxs("div",{className:"text-xs opacity-70",children:["ID: ",t.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm bg-green-600 hover:bg-green-700",disabled:W||!i?.fullAccess&&be.includes(t.game)||!!t.requireCalibration&&!ss,title:!i?.fullAccess&&be.includes(t.game)?"PREMIUM game":W?"Weekly free games used":t.requireCalibration&&!ss?"Calibration required":"",onClick:async()=>{Ya({game:t.game,mode:t.mode,value:t.value,startingScore:t.startingScore});const s=!!ss,a=await nn();try{u?u.send({type:"join-match",matchId:t.id,calibrated:s,boardPreview:a}):j.current?.send(JSON.stringify({type:"join-match",matchId:t.id,calibrated:s,boardPreview:a}))}catch(n){qa(n?.message||"Failed to create Stripe checkout session. Please try again later.")}},children:"Join Now!"}),le&&t.creatorId===le&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Close this match",onClick:()=>{u?u.send({type:"cancel-match",matchId:t.id}):j.current?.send(JSON.stringify({type:"cancel-match",matchId:t.id}))},"aria-label":"Close match",children:"×"})]})]},t.id))})]}),!i?.fullAccess&&pe!==1/0&&pe<=0&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"­ƒöÆ"}),e.jsx("div",{className:"font-semibold",children:"Online play locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"YouÔÇÖve used your 3 free online games this week. Upgrade to PREMIUM to play all modes."}),e.jsxs("button",{onClick:async()=>{try{const s=await(await fetch(`${R}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i?.email})})).json();s.ok&&s.url?window.location.href=s.url:alert("Failed to create payment session: "+(s.error||"Unknown error"))}catch{alert("Network error")}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM = ",bn(fn(),5)]})]})]}),Oa&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-2 md:p-3 flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:"Online Match"})}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>je(!1),children:"Close"})]}),e.jsx("div",{className:"relative flex-1 overflow-hidden p-2 md:p-3",children:e.jsxs("div",{className:"card w-full h-full overflow-hidden relative p-2.5 md:p-3",children:[ne&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-start justify-center pt-8 z-20",children:[e.jsxs("div",{className:`px-4 py-2 rounded-full text-lg font-bold shadow whitespace-nowrap ${ne.kind==="leg"?"bg-indigo-500/20 border border-indigo-400/40 text-indigo-100":"bg-emerald-500/20 border border-emerald-400/40 text-emerald-100"}`,children:[ne.kind==="leg"?"­ƒÅü LEG WON ÔÇö ":"­ƒÄ» 180! ÔÇö ",ne.by]}),ne.kind==="leg"&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:"@keyframes ndn-confetti-fall{0%{transform:translateY(-10%) rotate(0deg);opacity:1}100%{transform:translateY(120%) rotate(360deg);opacity:0}}"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(24)].map((t,s)=>{const a=Math.random()*100,n=Math.random()*.2,o=1.2+Math.random()*.8,d=6+Math.random()*6,m=Math.floor(Math.random()*360);return e.jsx("span",{style:{position:"absolute",top:0,left:a+"%",width:d,height:d,background:`hsl(${m} 90% 60%)`,borderRadius:2,animation:`ndn-confetti-fall ${o}s ease-out ${n}s forwards`}},s)})})]})]}),e.jsxs("div",{className:"mb-1.5 text-xs md:text-sm flex items-center justify-between gap-2",children:[e.jsxs("span",{children:["Participants: ",ie.length||1]}),e.jsx("button",{className:"text-[11px] px-2 py-0.5 rounded-full bg-slate-700/50 hover:bg-slate-700 border border-slate-600",onClick:()=>Ua(t=>!t),title:jt?"Switch to full multi-player view":"Switch to compact player-by-player view",children:jt?"Full view":"Compact view"})]}),(()=>{const t=r.players?.[0]?.legsWon||0,s=r.players?.[1]?.legsWon||0;return e.jsx(vn,{left:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[p,p==="X01"?` / ${r.startingScore}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["Legs ",t,"–",s]})]}),right:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70 text-[10px]",children:"Match"}),e.jsxs("select",{className:`btn ${T}`,value:Ta,onChange:a=>Aa(a.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${T} w-[7.5rem]`,value:Pa,onChange:a=>Ea(a.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${T} w-[7.5rem]`,value:_a,onChange:a=>Ba(a.target.value),placeholder:"Team B"})]})})})(),jt?e.jsxs("div",{className:"mb-3",children:[(()=>{const t=r.currentPlayerIdx,s=r.players[t];if(!s)return null;const a=s.legs[s.legs.length-1],n=a?a.totalScoreRemaining:r.startingScore,o=i?.username&&s.name===i.username,d=a&&a.visits.length?a.visits[a.visits.length-1].score:0,m=(()=>{let g=0,A=0;for(const B of s?.legs||[])g+=B.totalScoreStart-B.totalScoreRemaining,A+=(B.visits||[]).reduce((U,x)=>U+(x.darts||0)-(x.preOpenDarts||0),0);return{pts:g,d:A}})(),l=m.d>0?m.pts/m.d*3:0;return p==="X01"?e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${t===r.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${t===r.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:t===r.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-4xl font-extrabold",children:n}),e.jsxs("div",{className:"text-sm mt-1",children:["Last score: ",e.jsx("span",{className:"font-semibold",children:d})]}),e.jsxs("div",{className:"text-sm",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:l.toFixed(1)})]}),o&&t===r.currentPlayerIdx&&n<=170&&n>0&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",et,"): ",ja(n,et).join("  ÔÇó  ")||"ÔÇö"]})]}):e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${t===r.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${t===r.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:t===r.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-sm opacity-80",children:p}),p==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:re[oe]?.label||"ÔÇö"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[ce," / ",re.length]})]}),p==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:G[V]===25?"25 (Outer Bull)":G[V]===50?"50 (Inner Bull)":G[V]||"ÔÇö"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[Ne," / ",G.length]})]}),p==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Treble Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:["T",J]})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[Pe," / ",de]})]})]})})(),r.players.length>1&&e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Next up: ",r.players[(r.currentPlayerIdx+1)%r.players.length]?.name]})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-3 flex flex-wrap items-center gap-2",children:r.players.map((t,s)=>{const a=t.legs[t.legs.length-1],n=a?a.totalScoreRemaining:r.startingScore;return e.jsxs("div",{className:`px-2 py-1 rounded bg-black/20 border border-slate-700/40 text-xs ${s===r.currentPlayerIdx?"ring-1 ring-brand-400":""}`,children:[e.jsx("span",{className:"font-semibold",children:t.name}),p==="X01"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:n})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:p==="Double Practice"?`${ce}/${re.length}`:p==="Around the Clock"?`${Ne}/${G.length}`:p==="Treble Practice"?`${Pe}/${de}`:p==="Cricket"?`${Z[t.id]?.points||0} pts`:p==="Shanghai"?`${me[t.id]?.score||0} pts = R${me[t.id]?.round||1}`:p==="Halve It"?`${ue[t.id]?.score||0} pts = S${(ue[t.id]?.stage||0)+1}`:p==="High-Low"?`${xe[t.id]?.score||0} pts = ${xe[t.id]?.target||"HIGH"}`:p==="Killer"?(()=>{const o=q[t.id];return o?`#${o.number} = ${o.lives}ÔØñ ${o.isKiller?"= K":""}`:"ÔÇö"})():p==="American Cricket"?`${he[t.id]?.points||0} pts`:p==="Baseball"?(()=>{const o=Re[t.id];return o?`R${o.score} = I${o.inning}`:"ÔÇö"})():p==="Golf"?(()=>{const o=Oe[t.id];return o?`S${o.strokes} = H${o.hole}`:"ÔÇö"})():p==="Tic Tac Toe"?(()=>{const o=($.board||[]).filter(m=>m==="X").length,d=($.board||[]).filter(m=>m==="O").length;return`X${o}-O${d}`})():p})]})]},`strip-${t.id}`)})})}),jt?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-col gap-2 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`btn ${T}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${T}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${T}`,onClick:pa,children:"Manual Correction"}),!Ht&&e.jsx("button",{className:`btn ${T}`,onClick:()=>{try{window.dispatchEvent(new CustomEvent("ndn:start-camera",{detail:{mode:"local"}}))}catch(t){console.warn("Enable camera event failed",t),u?u.send({type:"cam-create"}):j.current&&j.current.readyState===WebSocket.OPEN?j.current.send(JSON.stringify({type:"cam-create"})):y("Not connected to server",{type:"error"})}},children:"Enable camera"}),!Ht&&ct&&e.jsxs("div",{className:"ml-2 text-sm bg-blue-900/50 p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Mobile pairing code: "}),e.jsx("span",{className:"font-mono font-bold text-lg",children:ct})]}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["On your phone, go to: ",e.jsxs("a",{href:`/mobile-cam.html?code=${ct}`,target:"_blank",className:"underline",children:[window.location.origin,"/mobile-cam.html?code=",ct]})]})]}),!Ht&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[11px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam size"}),e.jsx("button",{className:`btn ${T}`,onClick:()=>tt(Math.max(.5,Math.round((ge-.05)*100)/100)),children:"−"}),e.jsxs("span",{className:`btn ${T} min-w-[2.5rem] text-center`,children:[Math.round(ge*100),"%"]}),e.jsx("button",{className:`btn ${T}`,onClick:()=>tt(Math.min(1.25,Math.round((ge+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${T}`,title:"Toggle fit/fill",onClick:()=>st(ye==="fill"?"fit":"fill"),children:ye==="fill"?"Fill":"Fit"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 items-start h-full",children:[e.jsx("div",{className:"order-1",children:p==="X01"?e.jsx(aa,{}):e.jsx(jn,{gameMode:p,players:Nn(p,r,ie),matchScore:r.players?.length===2?`${r.players[0]?.legsWon||0}-${r.players[1]?.legsWon||0}`:void 0})}),e.jsx("div",{className:"order-2 flex-1 min-h-0",children:Ms?e.jsx("div",{className:"min-w-0 relative z-10 flex-1 min-h-0 ndn-camera-tall",children:e.jsx(va,{storageKey:"ndn:camera:tile:online:top",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:520,defaultHeight:320,minWidth:280,minHeight:200,maxWidth:1600,maxHeight:900,autoFill:!0,children:e.jsx(Na,{label:"Your Board",autoStart:i?.username&&r.players[r.currentPlayerIdx]?.name===i.username,aspect:"classic",fill:!0})})}):null})]}),e.jsxs("div",{className:"font-semibold",children:["Current: ",r.players[r.currentPlayerIdx]?.name||"ÔÇö"]}),p==="X01"&&Ms&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs(e.Fragment,{children:[e.jsx(M,{x01DoubleInOverride:ot,hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(t,s,a)=>{if(Rt){const o=r.players[r.currentPlayerIdx],d=o?.legs[o.legs.length-1],m=d?d.totalScoreRemaining:r.startingScore;ys(i?.username||"Player",t,Math.max(0,m),Ot,{volume:$t,checkoutOnly:Lt})}const n=r.players[r.currentPlayerIdx];i?.username&&n?.name===i.username&&gs(i.username,s,t);try{t===180&&F("180",n?.name||"Player"),a&&F("leg",n?.name||"Player")}catch{}a||(ie?.length||0)>=2&&r.nextPlayer(),v();try{if(a&&t>50||t>100){const o=r.players[r.currentPlayerIdx],d=o?.legs?.[o.legs.length-1]?.totalScoreRemaining??r.startingScore,m={player:o?.name||i?.username||"Player",score:t,darts:s,finished:a,remainingBefore:Math.max(0,d+t),ts:Date.now()};$s(m),dt(!0)}}catch{}}}),La&&z?e.jsx(De,{storageKey:"ndn:modal:highlight",className:"w-[420px]",defaultWidth:420,defaultHeight:220,minWidth:320,minHeight:160,initialFitHeight:!0,children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Save highlight"}),e.jsxs("div",{className:"text-sm mb-3",children:["Player: ",e.jsx("strong",{children:z.player})," — Score: ",e.jsx("strong",{children:z.score})," — Darts: ",e.jsx("strong",{children:z.darts})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>Ha(),children:"Download to device"}),e.jsx("button",{className:"btn",onClick:()=>Fa(),children:"Save to account"}),e.jsx("button",{className:"btn btn-ghost ml-auto",onClick:()=>{dt(!1),$s(null)},children:"Close"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-3",children:"You can download this JSON to keep a copy, or save it to your account for later access."})]})}):null,e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>Tt(b),children:"Submit Visit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{r.undoVisit(),v()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-1.5 text-xs",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(t=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>Tt(t),children:t},t))]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 mb-2",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>L(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>X(!0),children:"Messages"})]})]}):p==="Double Practice"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:re[oe]?.label||"ÔÇö"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[ce," / ",re.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s)=>{(s==="DOUBLE"||s==="INNER_BULL")&&It(t)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&Mt()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Mt,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (D16, 50, 25, T20)",value:Ft,onChange:t=>Wt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Dt()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Dt,children:"Add"})]})]}):p==="Around the Clock"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Around the Clock ÔÇö Hit 1ÔåÆ20 then 25 (outer) and 50 (inner)"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:G[V]===25?"25 (Outer Bull)":G[V]===50?"50 (Inner Bull)":G[V]||"ÔÇö"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Ne," / ",G.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{ls(t,s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&na()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:na,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (T20, D5, 25, 50)",value:Es,onChange:t=>_s(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ra()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:ra,children:"Add"})]})]}):p==="Treble Practice"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Treble Practice — Aim for triples only; count hits vs total darts"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Treble target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:["T",J]})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Pe," / ",te>0?te:de]}),te>0&&de>=te&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:oa,children:"Reset"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("span",{className:"opacity-70 text-xs",children:"Quick:"}),[20,19,18].map(t=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${J===t?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>it(t),children:["T",t]},`tquick-${t}`)),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("select",{className:"input w-24 text-sm",value:J,onChange:t=>it(parseInt(t.target.value,10)),children:Array.from({length:20},(t,s)=>s+1).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:oa,children:"Reset"})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{is(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&la()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:la,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (T20)",value:Bs,onChange:t=>Rs(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ia()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:ia,children:"Add"})]})]}):p==="Cricket"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Cricket ÔÇö Close 15-20 and Bull; overflow scores points"}),(()=>{const t=w();os(t);const s=Z[t]||Et();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:wa.map(a=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:a===25?"Bull":a}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,s.marks?.[a]||0)," / 3"]})]},a))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:Z[w()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{Ke(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&(Ke(Math.max(0,b|0)),f(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Ke(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="Shanghai"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();cs(t);const s=me[t]||qe();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Shanghai ÔÇö Hit only the round's number; Single/Double/Triple score"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:s.round})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",s.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{Xe(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&(Xe(Math.max(0,b|0)),f(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Xe(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="Halve It"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();ds(t);const s=ue[t]||Ye(),a=Sa(s);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Halve It ÔÇö Hit the target each round or your score halves"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[s.stage+1,"/",s.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const n=a;return n?n.kind==="ANY_NUMBER"?"Any":n.kind==="BULL"?"Bull":n.kind==="DOUBLE"||n.kind==="TRIPLE"||n.kind==="NUMBER"?`${n.kind} ${n.num}`:"ÔÇö":"ÔÇö"})()})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",s.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{Ve(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&(Ve(Math.max(0,b|0)),f(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Ve(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="High-Low"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();ms(t);const s=xe[t]||Qe();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"High-Low ÔÇö Alternate aiming for high then low segments"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:s.round})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:s.target})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",s.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{Je(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&(Je(Math.max(0,b|0)),f(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Je(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="American Cricket"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"American Cricket ÔÇö Close 12-20 and Bull; overflow scores"}),(()=>{const t=w();ca(t);const s=he[t]||vs();return e.jsx("div",{className:"mb-2 grid grid-cols-5 gap-1 text-center text-[11px]",children:wn.map(a=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:a===25?"Bull":a}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,s.marks?.[a]||0)," / 3"]})]},a))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:he[w()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{ua(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{ua(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="Baseball"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();da(t);const s=Re[t]||js();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Baseball ÔÇö Inning ",s.inning," ÔÇó Runs ",s.score]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{xa(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{xa(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="Golf"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();ma(t);const s=Oe[t]||Ns();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Golf ÔÇö Hole ",s.hole," (target ",Sn[s.hole],") ÔÇó Strokes ",s.strokes]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{ha(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{ha(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="Tic Tac Toe"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Tic Tac Toe ÔÇö Tap a cell to claim by hitting its target"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(t,s)=>s).map(t=>e.jsx("button",{className:`h-12 rounded-xl border ${$.board[t]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if($.finished||$.board[t])return;const s=ws[t],a=Number(mt||0),n=a%3===0?"TRIPLE":a%2===0?"DOUBLE":"SINGLE",o=s.type==="BULL"?null:s.num||null;xs(t,a,n,o),ut("")},children:$.board[t]||""},t))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Enter dart score (e.g. 20, 40, 60, 25, 50)",value:mt,onChange:t=>ut(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=Array.from({length:9},(a,n)=>n).find(a=>!$.board[a]&&!$.finished);if(s!==void 0){const a=ws[s],n=Number(mt||0),o=n%3===0?"TRIPLE":n%2===0?"DOUBLE":"SINGLE",d=a.type==="BULL"?null:a.num||null;xs(s,n,o,d),ut("")}}}}),e.jsx("button",{className:"btn",onClick:()=>{const t=Array.from({length:9},(s,a)=>a).find(s=>!$.board[s]&&!$.finished);if(t!==void 0){const s=ws[t],a=Number(mt||0),n=a%3===0?"TRIPLE":a%2===0?"DOUBLE":"SINGLE",o=s.type==="BULL"?null:s.num||null;xs(t,a,n,o),ut("")}},children:"Claim Cell"})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{}})})]}):p==="Killer"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:(()=>{const t=w();return r.players.forEach(s=>us(s.id)),q[t]?.number||"ÔÇö"})()})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:(()=>{const t=w();return q[t]?.lives??"ÔÇö"})()})," ",(()=>{const t=w();return q[t]?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null})()]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{ze(s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&(ze("SINGLE",Math.max(0,b|0)),f(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{ze("SINGLE",Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-xs mb-1.5",children:[p," (online) ÔÇö manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const t=Math.max(0,b|0);r.addVisit(t,3),f(0),r.nextPlayer(),v()},children:"Submit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{r.undoVisit(),v()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>L(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>X(!0),children:"Messages"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsx(aa,{})}),e.jsxs("div",{className:`md:col-span-${ve} space-y-1.5 relative`,children:[e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("button",{className:`btn ${T}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${T}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${T}`,onClick:pa,children:"Manual Correction"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[e.jsx("span",{className:"text-xs opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${T}`,onClick:()=>tt(Math.max(.5,Math.round((ge-.05)*100)/100)),children:"−"}),e.jsxs("span",{className:`btn ${T} bg-transparent border-slate-600 text-center min-w-[3rem]`,children:[Math.round(ge*100),"%"]}),e.jsx("button",{className:`btn ${T}`,onClick:()=>tt(Math.min(1.25,Math.round((ge+.05)*100)/100)),children:"+"}),e.jsx("button",{className:`btn ${T}`,onClick:()=>Ts(ve===2?3:2),title:ve===2?"Expand camera":"Shrink camera",children:ve===2?"↔":"↙"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${T}`,title:"Toggle fit/fill",onClick:()=>st(ye==="fill"?"fit":"fill"),children:ye==="fill"?"Fill":"Fit"})]})]}),e.jsxs("div",{className:"mt-2 relative flex-1 min-h-0 ndn-camera-tall",children:[e.jsx(va,{storageKey:"ndn:camera:tile:online:row",className:"relative rounded-2xl overflow-hidden bg-black w-full",defaultWidth:720,defaultHeight:400,minWidth:320,minHeight:220,maxWidth:1600,maxHeight:900,autoFill:!0,children:e.jsx(Na,{label:"Your Board",autoStart:i?.username&&r.players[r.currentPlayerIdx]?.name===i.username,aspect:"classic",fill:!0})}),ve<3&&e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-slate-600/20 hover:bg-slate-600/40 transition-colors flex items-center justify-center group",onMouseDown:t=>{t.preventDefault();const s=t.clientX,a=ve,n=d=>{d.clientX-s>50&&a===2&&Ts(3)},o=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)},children:e.jsx("div",{className:"w-0.5 h-8 bg-slate-400 group-hover:bg-slate-300 transition-colors"})})]}),e.jsxs("div",{className:"font-semibold text-sm md:text-base",children:["Current: ",r.players[r.currentPlayerIdx]?.name||"ÔÇö"]}),p==="X01"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs(e.Fragment,{children:[e.jsx(M,{x01DoubleInOverride:ot,hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(t,s,a)=>{if(Rt){const o=r.players[r.currentPlayerIdx],d=o?.legs[o.legs.length-1],m=d?d.totalScoreRemaining:r.startingScore;ys(i?.username||"Player",t,Math.max(0,m),Ot,{volume:$t,checkoutOnly:Lt})}const n=r.players[r.currentPlayerIdx];i?.username&&n?.name===i.username&&gs(i.username,s,t);try{t===180&&F("180",n?.name||"Player"),a&&F("leg",n?.name||"Player")}catch{}a?v():(ie?.length||0)>=2?setTimeout(()=>{try{r.nextPlayer(),v()}catch{}},750):v()}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>Tt(b),children:"Submit Visit (Manual)"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{r.undoVisit(),v()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(t=>e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Tt(t),children:t},t))]}),(()=>{const t=r.players[r.currentPlayerIdx],s=t?.legs?.[t.legs?.length-1],a=s?s.totalScoreRemaining:r.startingScore;return a>0&&a<=170?e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",et,"): ",ja(a,et).join("  ÔÇó  ")||"ÔÇö"]}):null})()]}):p==="Double Practice"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:re[oe]?.label||"ÔÇö"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[ce," / ",re.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s)=>{(s==="DOUBLE"||s==="INNER_BULL")&&It(t)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0")),onKeyDown:t=>{t.key==="Enter"&&Mt()}}),e.jsx("button",{className:"btn",onClick:Mt,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:Ft,onChange:t=>Wt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Dt()}}),e.jsx("button",{className:"btn",onClick:Dt,children:"Add"})]})]}):p==="Cricket"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Cricket ÔÇö Close 15-20 and Bull; overflow scores points"}),(()=>{const t=w();os(t);const s=Z[t]||Et();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:wa.map(a=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:a===25?"Bull":a}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,s.marks?.[a]||0)," / 3"]})]},a))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:Z[w()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{Ke(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Ke(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="Shanghai"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();cs(t);const s=me[t]||qe();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["Shanghai ÔÇö Round ",s.round," ÔÇó Score ",s.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{Xe(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Xe(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="Halve It"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();ds(t);const s=ue[t]||Ye(),a=Sa(s);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm mb-2",children:["Halve It ÔÇö Stage ",s.stage+1,"/",s.targets.length," ÔÇó Score ",s.score]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const n=a;return n?n.kind==="ANY_NUMBER"?"Any":n.kind==="BULL"?"Bull":n.kind==="DOUBLE"||n.kind==="TRIPLE"||n.kind==="NUMBER"?`${n.kind} ${n.num}`:"ÔÇö":"ÔÇö"})()})]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{Ve(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Ve(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="High-Low"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();ms(t);const s=xe[t]||Qe();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["High-Low ÔÇö Round ",s.round," ÔÇó Target ",s.target," ÔÇó Score ",s.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{Je(t,s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Je(Math.max(0,b|0)),f(0)},children:"Add Dart"})]})]}):p==="Killer"&&i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const t=w();r.players.forEach(a=>us(a.id));const s=q[t];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:s?.number||"ÔÇö"})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:s?.lives??"ÔÇö"})," ",s?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 gap-1 text-[11px]",children:r.players.map(a=>{const n=q[a.id];return e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80 truncate",children:a.name}),e.jsx("span",{className:"font-mono",children:n?`#${n.number} = ${n.lives}ÔØñ${n.isKiller?" = K":""}`:"ÔÇö"})]},a.id)})})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 my-2",children:e.jsx(M,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(t,s,a)=>{ze(s==="MISS"?void 0:s,a?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{ze("SINGLE",Math.max(0,b|0)),f(0)},children:"Add Dart"})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Tip: Only doubles/triples on the opponentsÔÇÖ numbers remove lives. To become Killer, hit your own double."})]}):i?.username&&r.players[r.currentPlayerIdx]?.name===i.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-sm mb-2",children:[p," (online) ÔÇö manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:b,onChange:t=>f(parseInt(t.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const t=Math.max(0,b|0);r.addVisit(t,3),f(0),r.nextPlayer(),v()},children:"Submit"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{r.undoVisit(),v()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>L(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>X(!0),children:"Messages"})]})})]})]})})]})]}),Ja&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50",children:e.jsx("div",{className:"w-full h-full flex items-stretch justify-stretch p-0",children:e.jsxs(De,{storageKey:"ndn:modal:create-match",className:"w-full h-full rounded-none !border-0 !shadow-none relative",fullScreen:!0,children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-slate-900/80 backdrop-blur border-b border-slate-700 z-10 px-2 py-2",children:e.jsx("h3",{className:"text-xl font-bold",children:"Create Match"})}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 overflow-auto px-2",style:{maxHeight:"calc(100vh - 120px)"},children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:P,onChange:t=>Qs(t.target.value),children:ga.map(t=>e.jsxs("option",{value:t,disabled:!i?.fullAccess&&be.includes(t),children:[t," ",!i?.fullAccess&&be.includes(t)?"(PREMIUM)":""]},t))}),e.jsx("div",{className:"mt-2",children:e.jsx(kn,{gameMode:P,compact:!0})})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:Jt,onChange:t=>Js(t.target.value),children:[e.jsx("option",{value:"bestof",children:"Best Of"}),e.jsx("option",{value:"firstto",children:"First To"})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Value"}),P==="X01"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:[101,201,301,401,501].map(t=>e.jsx("button",{className:`btn px-2 py-1 text-xs ${Se===t?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>Nt(t),children:t},t))}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:Se,onChange:t=>Nt(parseInt(t.target.value||"1")),placeholder:"Or enter custom value"})]}):e.jsx("input",{className:"input w-full",type:"number",min:1,value:Se,onChange:t=>Nt(parseInt(t.target.value||"1"))}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Example: Best Of 5 — first to 3"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Starting Score"}),P==="X01"?e.jsx("select",{className:"input w-full",value:zt,onChange:t=>zs(parseInt(t.target.value||"501")),children:[301,501,701].map(t=>e.jsx("option",{value:t,children:t},t))}):e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Starting score applies to X01 only"})]}),P==="X01"&&e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"X01 Rules"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"create-x01di",type:"checkbox",className:"accent-purple-500",checked:!!kt,onChange:t=>Za(t.target.checked)}),e.jsx("label",{htmlFor:"create-x01di",className:"text-sm opacity-80",children:"Require Double-In"})]})]}),P==="Treble Practice"&&e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Throws per game"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[[9,12,18,30,60].map(t=>e.jsx("button",{className:`btn px-2 py-1 text-xs ${Ce===t?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>Yt(t),children:t},t)),e.jsx("button",{className:`btn px-2 py-1 text-xs ${Ce===0?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>Yt(0),title:"Unlimited",children:"∞"})]}),e.jsx("input",{className:"input w-full",type:"number",min:0,placeholder:"0 = unlimited",value:Ce,onChange:t=>Yt(Math.max(0,parseInt(t.target.value||"0")))})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Require Calibration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"calibreq",type:"checkbox",className:"accent-purple-500",checked:Zs,onChange:t=>Qa(t.target.checked)}),e.jsx("label",{htmlFor:"calibreq",className:"text-sm opacity-80",children:"Players must be calibrated"})]})]}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 border border-slate-700/40",children:[e.jsx("div",{className:"text-xs text-slate-300 uppercase tracking-wide mb-1",children:"Summary"}),e.jsxs("div",{className:"text-sm font-semibold",children:[P," — ",Jt==="bestof"?`Best Of ${Se}`:`First To ${Se}`," ",P==="X01"?`— ${zt}`:""]}),P==="X01"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Double-In: ",kt?"On":"Off"]}),P==="Treble Practice"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Throws per game: ",Ce||"Unlimited"]}),!i?.fullAccess&&be.includes(P)&&e.jsx("div",{className:"text-xs text-rose-300 mt-1",children:"PREMIUM required"})]})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-900/80 backdrop-blur border-t border-slate-700 z-10 px-2 py-2",children:[e.jsx("button",{className:"btn w-full",disabled:!i?.fullAccess&&be.includes(P),title:!i?.fullAccess&&be.includes(P)?"PREMIUM game":"",onClick:()=>{const t=i?.username?bs(i.username):0;P==="Treble Practice"&&Os(Math.max(0,Ce|0)),P==="X01"&&Kt(!!kt);const s={type:"create-match",game:P,mode:Jt,value:Se,startingScore:zt,creatorAvg:t,requireCalibration:Zs};P==="Treble Practice"&&(s.trebleMaxDarts=Math.max(0,Ce|0)),P==="X01"&&(s.x01DoubleIn=!!kt),u?(u.send(s),ee(!1),u.send({type:"list-matches"})):(j.current?.send(JSON.stringify(s)),ee(!1),j.current?.send(JSON.stringify({type:"list-matches"})))},children:"START GAME!"}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx("button",{className:"btn px-2 py-1",onClick:()=>ee(!1),children:"Close"})})]})]})})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(De,{storageKey:"ndn:modal:invite",className:"w-full relative",defaultWidth:620,defaultHeight:420,minWidth:520,minHeight:320,maxWidth:1e3,maxHeight:800,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-bold mb-1",children:"Incoming Match Request"}),e.jsxs("div",{className:"text-sm mb-2",children:[e.jsx("span",{className:"font-semibold",children:S.fromName})," wants to join your match.",e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${S.calibrated?"bg-emerald-500/20 text-emerald-300 border border-emerald-600/30":"bg-amber-500/20 text-amber-200 border border-amber-600/30"}`,children:S.calibrated?"Calibrated":"Not calibrated"})]}),(S.game||S.mode)&&e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[S.game||"X01"," ÔÇó ",S.mode==="firstto"?`First To ${S.value}`:`Best Of ${S.value}`," ",S.game==="X01"&&S.startingScore?`ÔÇó ${S.startingScore}`:""]}),Fs&&e.jsx(Kn,{open:Fs,onClose:()=>Ws(!1),title:"Match Summary",players:r.players||[],doublesStats:Ka,centerScore:(()=>{const t=r.players||[];return t.length===2?`${t[0]?.legsWon||0} – ${t[1]?.legsWon||0}`:""})()}),S.boardPreview?e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:S.boardPreview,alt:"Board preview",className:"rounded-lg w-full max-h-64 object-contain bg-black/40 border border-slate-700"})}):e.jsx("div",{className:"mb-3 text-xs opacity-60",children:"No camera preview provided."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{u?u.send({type:"invite-response",matchId:S.matchId,accept:!0,toId:S.fromId}):j.current?.send(JSON.stringify({type:"invite-response",matchId:S.matchId,accept:!0,toId:S.fromId})),wt(null)},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>{u?u.send({type:"invite-response",matchId:S.matchId,accept:!1,toId:S.fromId}):j.current?.send(JSON.stringify({type:"invite-response",matchId:S.matchId,accept:!1,toId:S.fromId})),wt(null)},children:"Decline"})]})]})}),Q&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(De,{storageKey:"ndn:modal:quick-chat",className:"w-full relative",defaultWidth:520,defaultHeight:280,minWidth:360,minHeight:220,maxWidth:900,maxHeight:700,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>L(!1),children:"Close"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["Good luck!","Good game!","Nice darts!","Well played!","Ready?"].map(t=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{en(t),L(!1)},disabled:!D,children:t},t))})]})}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(De,{storageKey:"ndn:modal:messages",className:"w-full relative",defaultWidth:560,defaultHeight:360,minWidth:380,minHeight:260,maxWidth:1e3,maxHeight:800,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>X(!1),children:"Close"})]}),e.jsx(Jn,{items:C.slice(-30).filter(t=>!N.isBlocked(String(t.fromId||""))).map((t,s)=>({key:String(s),from:t.from,id:String(t.fromId||t.from),text:t.message})),onDelete:t=>I(s=>s.filter((a,n)=>n!==t)),onReport:t=>{const a=C.slice(-30).filter(n=>!N.isBlocked(String(n.fromId||"")))[t];a&&an(null,a.message)},onBlock:t=>{const a=C.slice(-30).filter(n=>!N.isBlocked(String(n.fromId||"")))[t];if(a){try{N.block(String(a.fromId||a.from))}catch{}I(n=>n.filter(o=>String(o.fromId||o.from)!==String(a.fromId||a.from)));try{y(`${a.from} blocked`,{type:"info"})}catch{}}}})]})})]})]})}function Jn({items:i,onDelete:R,onReport:y,onBlock:u}){const N=(()=>{try{const C=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(C)}catch{return!1}})(),[E,O]=c.useState(null),[D,h]=c.useState(null);return e.jsx("div",{className:"h-24 overflow-auto text-sm divide-y divide-slate-700/40",children:i.length===0?e.jsx("div",{className:"opacity-60 py-1",children:"No messages yet."}):i.map((C,I)=>{const Q=Wn(C.text),L=Un(C.text);return e.jsxs("div",{className:"relative group px-1 py-1 flex items-start gap-2",onTouchStart:N?K=>{const X=K.touches[0];O({x:X.clientX,y:X.clientY,i:I,t:Date.now()})}:void 0,onTouchMove:N?K=>{if(!E||E.i!==I)return;K.touches[0].clientX-E.x<-40&&h(I)}:void 0,onTouchEnd:N?()=>{const K=E?Date.now()-E.t:0;(D===I||K>600)&&(R(I),h(null)),O(null)}:void 0,children:[e.jsxs("span",{className:"text-slate-400 shrink-0",children:["[",C.from,"]"]}),e.jsx("span",{className:"text-white break-words whitespace-pre-wrap flex-1",children:Q}),!N&&e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 ml-2",children:[e.jsx("button",{className:"w-5 h-5 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center",title:"Delete message","aria-label":"Delete message",onClick:()=>R(I),children:"├ù"}),u&&e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-slate-700 hover:bg-slate-800 text-slate-100 text-[11px]",onClick:()=>u(I),title:"Block sender",children:"Block"}),e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-amber-600/40 hover:bg-amber-600/60 text-amber-100 text-[11px]",onClick:()=>y(I),title:"Report message",children:"Report"})]}),L&&e.jsx("span",{className:"ml-2 text-[10px] px-1 rounded bg-rose-600/30 text-rose-200 border border-rose-600/40",children:"Filtered"})]},C.key)})})}export{ir as default};
//# sourceMappingURL=OnlinePlay-Dokb0L_1.js.map

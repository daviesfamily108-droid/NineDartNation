{"version":3,"file":"OfflinePlay-CCWqOVTa.js","sources":["../../src/utils/checkout.ts","../../src/components/CameraTile.tsx","../../src/utils/autoscore.ts","../../src/utils/dartDetector.ts","../../src/utils/scoring.ts","../../src/components/ui/ResizablePanel.tsx","../../src/store/heatmap.ts","../../src/store/matchControl.ts","../../src/components/CameraView.tsx","../../src/components/HeatMap.tsx","../../src/game/types.ts","../../src/game/aroundTheClock.ts","../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/game/ticTacToe.ts","../../src/game/scamFivesSevens.ts","../../src/game/americanCricket.ts","../../src/components/ui/GameHeaderBar.tsx","../../src/components/scoreboards/GameScoreboard.tsx","../../src/components/matchControlAdapters.ts","../../src/logic/matchActions.ts","../../src/components/scoreboards/useGameStats.ts","../../src/components/OfflinePlay.tsx"],"sourcesContent":["// Very lightweight checkout suggestions. For proper coverage consider a full table.\n// Returns up to a few route strings like \"T20 T20 D20\" for a given remaining.\n\nconst doubles = [\n  \"D1\",\n  \"D2\",\n  \"D3\",\n  \"D4\",\n  \"D5\",\n  \"D6\",\n  \"D7\",\n  \"D8\",\n  \"D9\",\n  \"D10\",\n  \"D11\",\n  \"D12\",\n  \"D13\",\n  \"D14\",\n  \"D15\",\n  \"D16\",\n  \"D17\",\n  \"D18\",\n  \"D19\",\n  \"D20\",\n  \"DB\",\n];\n\nfunction dVal(tag: string): number {\n  if (tag === \"DB\") return 50;\n  const n = Number(tag.slice(1));\n  return n * 2;\n}\n\nfunction prefsDoubleScore(fav: string): number {\n  if (!doubles.includes(fav)) return 32; // default D16\n  return dVal(fav);\n}\n\nexport function suggestCheckouts(\n  remaining: number,\n  favoriteDouble: string = \"D16\",\n): string[] {\n  if (remaining > 170 || remaining <= 1) return [];\n  // Simple known highest routes for popular numbers, then fall back to greedy towards favourite double\n  const hardcoded: Record<number, string[]> = {\n    170: [\"T20 T20 DB\"],\n    167: [\"T20 T19 DB\"],\n    164: [\"T20 T18 DB\"],\n    161: [\"T20 T17 DB\"],\n    160: [\"T20 T20 D20\"],\n    158: [\"T20 T20 D19\"],\n    157: [\"T20 T19 D20\"],\n    156: [\"T20 T20 D18\"],\n    155: [\"T20 T19 D19\"],\n    154: [\"T20 T18 D20\"],\n    153: [\"T20 T19 D18\"],\n    152: [\"T20 T20 D16\"],\n    151: [\"T20 T17 D20\"],\n    150: [\"T20 T18 D18\"],\n    149: [\"T20 T19 D16\"],\n    148: [\"T20 T16 D20\"],\n    147: [\"T20 T17 D18\"],\n    146: [\"T20 T18 D16\"],\n    145: [\"T20 T15 D20\"],\n    144: [\"T20 T20 D12\"],\n    141: [\"T20 T19 D12\"],\n    140: [\"T20 T20 D10\"],\n    137: [\"T20 T19 D10\"],\n    136: [\"T20 T20 D8\"],\n    132: [\"BULL T14 D20\", \"T20 T12 D8\"],\n    130: [\"T20 T20 D5\", \"T20 T18 D8\"],\n    129: [\"T19 T16 D12\"],\n    128: [\"T18 T14 D16\"],\n    127: [\"T20 T17 D8\"],\n    126: [\"T19 T19 D6\"],\n    121: [\"T20 11 D20\", \"T20 T15 D8\"],\n    120: [\"T20 20 D20\", \"T20 S20 D20\"],\n    110: [\"T20 10 D20\"],\n    100: [\"T20 D20\"],\n    99: [\"T19 10 D16\", \"T19 S10 D16\"],\n    97: [\"T19 D20\"],\n    96: [\"T20 D18\"],\n    95: [\"T19 D19\"],\n    94: [\"T18 D20\"],\n    92: [\"T20 D16\"],\n    90: [\"T18 D18\", \"T20 D15\"],\n    86: [\"T18 D16\"],\n    84: [\"T20 D12\", \"T16 D18\"],\n    82: [\"BULL D16\", \"T14 D20\"],\n    81: [\"T19 D12\"],\n    80: [\"T20 D10\", \"D20 D20\"],\n    78: [\"T18 D12\"],\n    76: [\"T20 D8\", \"T16 D14\"],\n    74: [\"T14 D16\", \"T18 D10\"],\n    72: [\"T16 D12\", \"T20 D6\"],\n    70: [\"T18 D8\", \"S20 BULL\"],\n    68: [\"T20 D4\", \"T16 D10\"],\n    66: [\"T10 D18\", \"T14 D12\"],\n    64: [\"T16 D8\", \"D16 D16\"],\n    62: [\"T10 D16\", \"T12 D13\"],\n    60: [\"20 D20\", \"S20 D20\"],\n    58: [\"18 D20\", \"S18 D20\"],\n    56: [\"16 D20\", \"S16 D20\"],\n    54: [\"14 D20\", \"S14 D20\"],\n    52: [\"20 D16\", \"S20 D16\"],\n    50: [\"BULL\", \"10 D20\"],\n    48: [\"16 D16\", \"S16 D16\"],\n    46: [\"14 D16\"],\n    44: [\"12 D16\"],\n    42: [\"10 D16\"],\n    40: [\"D20\"],\n    38: [\"D19\"],\n    36: [\"D18\"],\n    34: [\"D17\"],\n    32: [\"D16\"],\n    30: [\"D15\"],\n    28: [\"D14\"],\n    26: [\"D13\"],\n    24: [\"D12\"],\n    22: [\"D11\"],\n    20: [\"D10\"],\n    18: [\"D9\"],\n    16: [\"D8\"],\n    14: [\"D7\"],\n    12: [\"D6\"],\n    10: [\"D5\"],\n    8: [\"D4\"],\n    6: [\"D3\"],\n    4: [\"D2\"],\n    2: [\"D1\"],\n  };\n  if (hardcoded[remaining]) return hardcoded[remaining];\n  // Greedy fallback: aim to leave favourite double if possible in two darts\n  const target = prefsDoubleScore(favoriteDouble);\n  const routes: string[] = [];\n  // Try to hit a treble/big single that leaves the fav double\n  for (const t of [60, 57, 54, 51, 48]) {\n    // T20..T16\n    const left = remaining - t;\n    if (left === target) {\n      routes.push(`T${t / 3} ${favoriteDouble}`);\n      break;\n    }\n  }\n  if (!routes.length) {\n    for (const s of [20, 19, 18, 17, 16, 15]) {\n      const left = remaining - s;\n      if (left === target) {\n        routes.push(`${s} ${favoriteDouble}`);\n        break;\n      }\n    }\n  }\n  return routes;\n}\n\nexport function sayScore(\n  name: string,\n  scored: number,\n  remaining: number,\n  voiceName?: string,\n  opts?: { volume?: number; checkoutOnly?: boolean },\n) {\n  try {\n    const synth = window.speechSynthesis;\n    if (!synth) return;\n    const msg = new SpeechSynthesisUtterance();\n    const isCheckout = remaining <= 170 && remaining > 0;\n    const isOneEighty = scored === 180;\n    const shouldAnnounce = !opts?.checkoutOnly || isCheckout || isOneEighty;\n    if (!shouldAnnounce) return;\n\n    if (isOneEighty) {\n      msg.text = `${name}! One eighty!`;\n      msg.rate = 1.04;\n      msg.pitch = 1.15;\n    } else if (isCheckout) {\n      msg.text = `${name}, ${remaining} remaining.`;\n      msg.rate = 1.0;\n      msg.pitch = 1.0;\n    } else if (scored === 0) {\n      msg.text = `${name}, no score.`;\n      msg.rate = 1.0;\n      msg.pitch = 1.0;\n    } else {\n      msg.text = `${name}, ${scored}.`;\n      msg.rate = 1.0;\n      msg.pitch = 1.0;\n    }\n    if (voiceName) {\n      const v = synth.getVoices().find((v) => v.name === voiceName);\n      if (v) msg.voice = v;\n    }\n    if (typeof opts?.volume === \"number\")\n      msg.volume = Math.max(0, Math.min(1, opts.volume));\n    else msg.volume = 1;\n    try {\n      synth.cancel();\n    } catch {}\n    synth.speak(msg);\n  } catch {}\n}\n","/* eslint-disable jsx-a11y/media-has-caption */\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  type CSSProperties,\n} from \"react\";\nimport { dlog } from \"../utils/logger\";\nimport { useUserSettings } from \"../store/userSettings\";\nimport {\n  useCameraSession,\n  type CameraStreamMode,\n} from \"../store/cameraSession\";\nimport {\n  discoverNetworkDevices,\n  connectToNetworkDevice,\n  type NetworkDevice,\n  discoverUSBDevices,\n  requestUSBDevice,\n  connectToUSBDevice,\n  type USBDevice,\n} from \"../utils/networkDevices\";\nimport { apiFetch } from \"../utils/api\";\n\ntype CameraTileProps = {\n  label?: string;\n  autoStart?: boolean;\n  scale?: number;\n  className?: string;\n  aspect?: \"inherit\" | \"wide\" | \"square\" | \"portrait\" | \"classic\" | \"free\";\n  style?: CSSProperties;\n  fill?: boolean;\n  // Offline mode props\n  user?: any;\n  playerScore?: number;\n  aiScore?: number;\n  x01Score?: number;\n  inMatch?: boolean;\n  showWinPopup?: boolean;\n  pendingLegWinner?: \"player\" | \"ai\" | null;\n  playerDartsThrown?: number;\n  aiDartsThrown?: number;\n  totalPlayerDarts?: number;\n  totalAiDarts?: number;\n  totalPlayerPoints?: number;\n  totalAiPoints?: number;\n  player180s?: number;\n  player140s?: number;\n  player100s?: number;\n  ai180s?: number;\n  ai140s?: number;\n  ai100s?: number;\n  playerHighestCheckout?: number;\n  aiHighestCheckout?: number;\n  onClose?: () => void;\n  onOpen?: () => void;\n  layout?: \"classic\" | \"modern\";\n};\n\nexport default function CameraTile({\n  label,\n  autoStart,\n  scale: scaleOverride,\n  className,\n  aspect = \"inherit\",\n  style,\n  fill = false,\n}: CameraTileProps) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const cameraSession = useCameraSession();\n  const [streaming, setStreaming] = useState(false);\n  const [ws, setWs] = useState<WebSocket | null>(null);\n  const [pairCode, setPairCode] = useState<string | null>(null);\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null);\n  const lastRegisteredModeRef = useRef<CameraStreamMode | null>(null);\n  const registerStream = useCallback(\n    (stream: MediaStream | null, modeOverride: CameraStreamMode = \"local\") => {\n      try {\n        if (stream) {\n          cameraSession.setMediaStream(stream);\n          if (videoRef.current) {\n            cameraSession.setVideoElementRef(videoRef.current);\n          }\n          cameraSession.setMode(modeOverride);\n          cameraSession.setStreaming(true);\n          lastRegisteredModeRef.current = modeOverride;\n        } else if (\n          lastRegisteredModeRef.current &&\n          lastRegisteredModeRef.current !== \"phone\"\n        ) {\n          cameraSession.setStreaming(false);\n          cameraSession.setMediaStream(null);\n          lastRegisteredModeRef.current = null;\n        }\n      } catch (err) {\n        console.warn(\n          \"[CameraTile] Failed to register stream with camera session:\",\n          err,\n        );\n      }\n    },\n    [cameraSession],\n  );\n\n  // Initialize mode: prioritize phone camera if preferred, otherwise use localStorage\n  const preferredCameraLabel = useUserSettings((s) => s.preferredCameraLabel);\n  const [mode, setMode] = useState<\"local\" | \"phone\" | \"wifi\">(() => {\n    // If phone camera is selected, start in phone mode\n    if (preferredCameraLabel === \"Phone Camera\") {\n      dlog(\n        \"[CAMERATILE] Initializing mode to phone (from preferred camera selection)\",\n      );\n      return \"phone\";\n    }\n    // Otherwise use saved mode or default to local\n    const saved = localStorage.getItem(\"ndn:camera:mode\") as any;\n    dlog(\n      \"[CAMERATILE] Initializing mode to\",\n      saved || \"local\",\n      \"(from localStorage)\",\n    );\n    return saved || \"local\";\n  });\n\n  const [, setExpiresAt] = useState<number | null>(null);\n  const [, setPaired] = useState<boolean>(false);\n  const [lanHost, setLanHost] = useState<string | null>(null);\n  const [httpsInfo, setHttpsInfo] = useState<{\n    https: boolean;\n    port: number;\n  } | null>(null);\n  const [showTips, setShowTips] = useState<boolean>(true);\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([]);\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false);\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([]);\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false);\n  const autoscoreProvider = useUserSettings((s) => s.autoscoreProvider);\n  const cameraEnabledSetting = useUserSettings((s) => s.cameraEnabled);\n  const setPreferredCameraLocked = useUserSettings(\n    (s) => s.setPreferredCameraLocked,\n  );\n  const preferredCameraLocked = useUserSettings((s) => s.preferredCameraLocked);\n  const setPreferredCamera = useUserSettings((s) => s.setPreferredCamera);\n  const preferredCameraId = useUserSettings((s) => s.preferredCameraId);\n\n  if (autoscoreProvider === \"manual\") {\n    const fallbackBase = fill\n      ? \"rounded-2xl overflow-hidden bg-black w-full flex flex-col\"\n      : \"rounded-2xl overflow-hidden bg-black w-full mx-auto\";\n    const fallbackClass = [fallbackBase, className]\n      .filter(Boolean)\n      .join(\" \")\n      .trim();\n    const fallbackStyle: CSSProperties = { ...(style || {}) };\n    if (\n      !fill &&\n      fallbackStyle.aspectRatio === undefined &&\n      fallbackStyle.height === undefined &&\n      fallbackStyle.minHeight === undefined\n    ) {\n      fallbackStyle.aspectRatio = \"4 / 3\";\n    }\n    return (\n      <div className={fallbackClass} style={fallbackStyle}>\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\n          Manual scoring mode active â€” camera feeds are disabled.\n        </div>\n      </div>\n    );\n  }\n  useEffect(() => {\n    const h = window.location.hostname;\n    if (h === \"localhost\" || h === \"127.0.0.1\") {\n      apiFetch(`/api/hosts`)\n        .then((r) => r.json())\n        .then((j) => {\n          const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x);\n          if (ip) setLanHost(ip);\n        })\n        .catch(() => {});\n    }\n    // Detect HTTPS support for the phone link\n    apiFetch(`/api/https-info`)\n      .then((r) => r.json())\n      .then((j) => {\n        if (j && typeof j.https === \"boolean\")\n          setHttpsInfo({ https: !!j.https, port: Number(j.port) || 8788 });\n      })\n      .catch(() => {});\n  }, []);\n  const mobileUrl = useMemo(() => {\n    const code = pairCode || \"____\";\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined;\n    if (envUrl && envUrl.length > 0) {\n      try {\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\n        const u = new URL(envUrl);\n        const isSecure = u.protocol === \"wss:\";\n        const origin = `${isSecure ? \"https\" : \"http\"}://${u.host}${u.pathname.endsWith(\"/ws\") ? \"\" : u.pathname}`;\n        const base = origin.replace(/\\/?ws$/i, \"\");\n        return `${base}/mobile-cam.html?code=${code}`;\n      } catch {}\n    }\n    // Fallback to local development: prefer LAN host if detected\n    const host = lanHost || window.location.hostname;\n    const useHttps = !!httpsInfo?.https;\n    const port = useHttps ? httpsInfo?.port || 8788 : 8787;\n    const proto = useHttps ? \"https\" : \"http\";\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`;\n  }, [pairCode, lanHost, httpsInfo]);\n  useEffect(() => {\n    dlog(\"[CAMERATILE] Mode changed to:\", mode, \"- persisting to localStorage\");\n    localStorage.setItem(\"ndn:camera:mode\", mode);\n  }, [mode]);\n\n  const [manualModeSetAt, setManualModeSetAt] = useState<number | null>(null);\n\n  // start/stop are implemented later (deduplicated); keep single definition below.\n\n  // Sync phone camera selection from Calibrator into CameraTile mode state\n  // When user locks in phone camera in Calibrator, it updates preferredCameraLabel\n  // This effect ensures CameraTile's UI reflects that selection\n  useEffect(() => {\n    const ignore = useUserSettings.getState().ignorePreferredCameraSync;\n    dlog(\n      \"[CAMERATILE] Checking camera selection sync: preferredCameraLabel=\",\n      preferredCameraLabel,\n      \"mode=\",\n      mode,\n      \"ignoreSync=\",\n      ignore,\n      \"manualModeSetAt=\",\n      manualModeSetAt,\n    );\n    if (ignore) return;\n    // If user manually changed mode recently, avoid auto-syncing preferred camera\n    if (manualModeSetAt && Date.now() - manualModeSetAt < 30_000) return;\n    if (preferredCameraLabel === \"Phone Camera\" && mode !== \"phone\") {\n      dlog(\"[CAMERATILE] Syncing mode to phone from Calibrator selection\");\n      setMode(\"phone\");\n    }\n  }, [preferredCameraLabel, mode, manualModeSetAt]);\n\n  // Intentionally disabled automatic regeneration of phone pairing codes.\n  // Codes will only be created when the user explicitly requests it (button click).\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\n\n  useEffect(() => {\n    if (\n      !cameraEnabledSetting ||\n      (autoscoreProvider &&\n        autoscoreProvider !== \"built-in\" &&\n        autoscoreProvider !== \"external-ws\")\n    )\n      return;\n    if (autoStart === undefined) return;\n    if (autoStart) {\n      let cancelled = false;\n      const desiredLabel = preferredCameraLabel || \"default\";\n      const timer = window.setTimeout(() => {\n        if (cancelled || streaming) return;\n        start().catch((err) =>\n          console.warn(\n            `[CameraTile] Auto-start failed for ${desiredLabel}:`,\n            err,\n          ),\n        );\n      }, 200);\n      return () => {\n        cancelled = true;\n        window.clearTimeout(timer);\n      };\n    }\n    stop();\n  }, [\n    autoStart,\n    streaming,\n    cameraEnabledSetting,\n    autoscoreProvider,\n    preferredCameraLabel,\n    start,\n    stop,\n  ]);\n\n  // If the user selected Phone Camera, bind the global stream into this tile\n  useEffect(() => {\n    const apply = async () => {\n      try {\n        const allowPhoneAttach =\n          (preferredCameraLabel === \"Phone Camera\" &&\n            (!manualModeSetAt || Date.now() - manualModeSetAt >= 30_000)) ||\n          mode === \"phone\";\n        if (!allowPhoneAttach) return;\n        const s = cameraSession.getMediaStream();\n        const v = videoRef.current;\n        if (!v || !s) return;\n        if (v.srcObject !== s) {\n          v.srcObject = s;\n        }\n        v.muted = true;\n        (v as any).playsInline = true;\n        try {\n          await v.play();\n        } catch {}\n        setStreaming(true);\n      } catch {}\n    };\n    // Try immediately and poll briefly to catch late-arriving stream\n    apply();\n    const t = setInterval(apply, 800);\n    return () => clearInterval(t);\n  }, [preferredCameraLabel, mode, cameraSession, cameraSession.isStreaming]);\n\n  const start = useCallback(async () => {\n    dlog(\"[CameraTile] start() invoked with mode=\", mode);\n    if (mode === \"wifi\") {\n      return startWifiConnection();\n    }\n    dlog(\"[CameraTile] Attempting to attach global stream for phone mode...\");\n\n    // If phone camera is selected and paired, don't try to start local camera\n    if (preferredCameraLabel === \"Phone Camera\" || mode === \"phone\") {\n      const s = cameraSession.getMediaStream();\n      if (s && videoRef.current) {\n        try {\n          videoRef.current.srcObject = s;\n          await videoRef.current.play();\n          setStreaming(true);\n          return;\n        } catch {}\n      }\n      // If no global stream yet, for phone mode we should attempt pairing\n      if (mode === \"phone\") {\n        try {\n          await startPhonePairing();\n          return;\n        } catch {}\n      }\n    }\n\n    try {\n      // Prefer saved camera if available\n      const { preferredCameraId, setPreferredCamera } =\n        useUserSettings.getState();\n      const constraints: MediaStreamConstraints = preferredCameraId\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false }\n        : { video: true, audio: false };\n      let stream: MediaStream;\n      try {\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\n      } catch (err: any) {\n        const name = (err && (err.name || err.code)) || \"\";\n        if (\n          preferredCameraId &&\n          (name === \"OverconstrainedError\" || name === \"NotFoundError\")\n        ) {\n          stream = await navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: false,\n          });\n        } else {\n          throw err;\n        }\n      }\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await videoRef.current.play();\n        setStreaming(true);\n        registerStream(stream, \"local\");\n      }\n      // Camera started successfully - no automatic preference updates\n    } catch {}\n  }, [mode, preferredCameraLabel, cameraSession, registerStream, startPhonePairing, startWifiConnection]);\n  const stop = useCallback(() => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks();\n      tracks.forEach((t) => t.stop());\n      videoRef.current.srcObject = null;\n      setStreaming(false);\n      registerStream(null);\n    }\n  }, [registerStream]);\n\n  async function startWifiConnection() {\n    setDiscoveringWifi(true);\n    try {\n      const devices = await discoverNetworkDevices();\n      setWifiDevices(devices);\n      if (devices.length === 0) {\n        alert(\n          \"No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.\",\n        );\n      }\n    } catch (error) {\n      console.error(\"Wifi device discovery failed:\", error);\n      alert(\n        \"Failed to discover wifi devices. Please check your network connection.\",\n      );\n    } finally {\n      setDiscoveringWifi(false);\n    }\n  }\n\n  async function connectToWifiDevice(device: NetworkDevice) {\n    try {\n      setWifiDevices((devices) =>\n        devices.map((d) =>\n          d.id === device.id ? { ...d, status: \"connecting\" as const } : d,\n        ),\n      );\n\n      const stream = await connectToNetworkDevice(device);\n      if (stream && videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await videoRef.current.play();\n        setStreaming(true);\n        registerStream(stream, \"wifi\");\n        setWifiDevices((devices) =>\n          devices.map((d) =>\n            d.id === device.id ? { ...d, status: \"online\" as const } : d,\n          ),\n        );\n      } else {\n        throw new Error(\"Failed to get video stream\");\n      }\n    } catch (error) {\n      console.error(\"Failed to connect to wifi device:\", error);\n      alert(\n        `Failed to connect to ${device.name}. Please check the device and try again.`,\n      );\n      setWifiDevices((devices) =>\n        devices.map((d) =>\n          d.id === device.id ? { ...d, status: \"offline\" as const } : d,\n        ),\n      );\n    }\n  }\n\n  async function startUsbConnection() {\n    setDiscoveringUsb(true);\n    try {\n      // First try to get already paired devices\n      const devices = await discoverUSBDevices();\n      setUsbDevices(devices);\n\n      // Then request user to select a new device\n      const newDevice = await requestUSBDevice();\n      if (newDevice) {\n        setUsbDevices((prev) => [...prev, newDevice]);\n      }\n\n      if (devices.length === 0 && !newDevice) {\n        alert(\n          \"No USB scoring devices found. Please connect a device and try again.\",\n        );\n      }\n    } catch (error) {\n      console.error(\"USB device discovery failed:\", error);\n      alert(\"Failed to discover USB devices. Please check device connections.\");\n    } finally {\n      setDiscoveringUsb(false);\n    }\n  }\n\n  async function connectToUsbDevice(device: USBDevice) {\n    try {\n      setUsbDevices((devices) =>\n        devices.map((d) =>\n          d.id === device.id ? { ...d, status: \"connecting\" as const } : d,\n        ),\n      );\n      const stream = await connectToUSBDevice(device);\n      if (stream && videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await videoRef.current.play();\n        setStreaming(true);\n        setMode(\"wifi\"); // Using wifi mode for USB devices too\n        registerStream(stream, \"wifi\");\n        setUsbDevices((devices) =>\n          devices.map((d) =>\n            d.id === device.id ? { ...d, status: \"online\" as const } : d,\n          ),\n        );\n      } else {\n        throw new Error(\"Failed to get video stream\");\n      }\n    } catch (error) {\n      console.error(\"Failed to connect to USB device:\", error);\n      alert(\n        `Failed to connect to ${device.name}. Please check the device and try again.`,\n      );\n      setUsbDevices((devices) =>\n        devices.map((d) =>\n          d.id === device.id ? { ...d, status: \"offline\" as const } : d,\n        ),\n      );\n    }\n  }\n\n  // Listen for global event to start local camera from other UI components\n  const handleModeSelect = useCallback(\n    (newMode: \"local\" | \"phone\" | \"wifi\" | \"usb\") => {\n      try {\n        setMode(newMode === \"usb\" ? \"wifi\" : newMode);\n        setManualModeSetAt(Date.now());\n        // Persist the user's selection and lock it to avoid auto-switching\n        try {\n          if (newMode === \"local\") {\n            try {\n              setPreferredCamera(preferredCameraId, \"Local\", true);\n            } catch {}\n            try {\n              setPreferredCameraLocked(true);\n            } catch {}\n          } else if (newMode === \"phone\") {\n            try {\n              setPreferredCamera(undefined, \"Phone Camera\", true);\n            } catch {}\n            try {\n              setPreferredCameraLocked(true);\n            } catch {}\n          } else if (newMode === \"wifi\" || newMode === \"usb\") {\n            try {\n              setPreferredCamera(undefined, \"WiFi/USB\", true);\n            } catch {}\n            try {\n              setPreferredCameraLocked(true);\n            } catch {}\n          }\n        } catch {}\n        if (newMode === \"local\") {\n          start().catch(() => {});\n        } else if (newMode === \"phone\") {\n          startPhonePairing();\n        } else if (newMode === \"wifi\") {\n          startWifiConnection();\n        } else if (newMode === \"usb\") {\n          startUsbConnection();\n        }\n      } catch (err) {\n        console.warn(\"[CameraTile] handleModeSelect failed\", err);\n      }\n    },\n    [\n      start,\n      startPhonePairing,\n      startWifiConnection,\n      startUsbConnection,\n      setPreferredCamera,\n      setPreferredCameraLocked,\n      preferredCameraId,\n    ],\n  );\n\n  useEffect(() => {\n    const onStart = (ev: any) => {\n      try {\n        const modeFromEvent = ev && ev.detail && ev.detail.mode;\n        if (\n          modeFromEvent &&\n          [\"local\", \"phone\", \"wifi\", \"usb\"].includes(modeFromEvent)\n        ) {\n          // Respect explicit mode requests and treat as manual selection\n          handleModeSelect(modeFromEvent);\n          // Ensure start is invoked after selection is applied\n          start().catch(() => {});\n        } else {\n          // No explicit mode provided â€” just try to start current mode\n          start().catch(() => {});\n        }\n      } catch {}\n    };\n    window.addEventListener(\"ndn:start-camera\" as any, onStart as any);\n    return () => {\n      window.removeEventListener(\"ndn:start-camera\" as any, onStart as any);\n    };\n  }, [start, handleModeSelect]);\n\n  // Phone pairing via WebRTC\n  function ensureWS() {\n    if (ws && ws.readyState === WebSocket.OPEN) return ws;\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined;\n    const normalizedEnv =\n      envUrl && envUrl.length > 0\n        ? envUrl.endsWith(\"/ws\")\n          ? envUrl\n          : envUrl.replace(/\\/$/, \"\") + \"/ws\"\n        : undefined;\n    const proto = window.location.protocol === \"https:\" ? \"wss\" : \"ws\";\n    const sameOrigin = `${proto}://${window.location.host}/ws`;\n    const host = window.location.hostname;\n    const isLocalhost = host === \"localhost\" || host === \"127.0.0.1\";\n    const isRenderHost = host.endsWith(\"onrender.com\");\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\n    const renderWS = `wss://ninedartnation.onrender.com/ws`;\n    let url = normalizedEnv;\n    if (!url) {\n      if (isLocalhost) {\n        url = `${proto}://${host}:8787/ws`;\n      } else if (isRenderHost) {\n        url = sameOrigin;\n      } else {\n        url = renderWS;\n      }\n    }\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\n    if (!url) url = sameOrigin;\n    const socket = new WebSocket(url);\n    setWs(socket);\n    return socket;\n  }\n  async function startPhonePairing() {\n    setMode(\"phone\");\n    setPaired(false);\n    const socket = ensureWS();\n    if (socket.readyState === WebSocket.OPEN) {\n      socket.send(JSON.stringify({ type: \"cam-create\" }));\n    } else {\n      socket.onopen = () => socket.send(JSON.stringify({ type: \"cam-create\" }));\n    }\n    socket.onmessage = async (ev) => {\n      const data = JSON.parse(ev.data);\n      if (data.type === \"cam-code\") {\n        setPairCode(data.code);\n        if (data.expiresAt) setExpiresAt(data.expiresAt);\n      } else if (data.type === \"cam-peer-joined\") {\n        setPaired(true);\n        // Create offer to the phone\n        const peer = new RTCPeerConnection({\n          iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }],\n        });\n        setPc(peer);\n        peer.onicecandidate = (e) => {\n          if (e.candidate && pairCode)\n            socket.send(\n              JSON.stringify({\n                type: \"cam-ice\",\n                code: pairCode,\n                payload: e.candidate,\n              }),\n            );\n        };\n        peer.ontrack = (ev) => {\n          if (videoRef.current) {\n            const inbound = ev.streams?.[0];\n            if (inbound) {\n              videoRef.current.srcObject = inbound;\n              videoRef.current.play().catch(() => {});\n              setStreaming(true);\n            }\n          }\n        };\n        const offer = await peer.createOffer({\n          offerToReceiveAudio: false,\n          offerToReceiveVideo: true,\n        });\n        await peer.setLocalDescription(offer);\n        if (pairCode)\n          socket.send(\n            JSON.stringify({\n              type: \"cam-offer\",\n              code: pairCode,\n              payload: offer,\n            }),\n          );\n      } else if (data.type === \"cam-answer\") {\n        if (pc)\n          await pc.setRemoteDescription(\n            new RTCSessionDescription(data.payload),\n          );\n      } else if (data.type === \"cam-ice\") {\n        if (pc)\n          try {\n            await pc.addIceCandidate(data.payload);\n          } catch {}\n      }\n    };\n  }\n  function regenerateCode() {\n    setPairCode(null);\n    setExpiresAt(null);\n    setPaired(false);\n    if (ws && ws.readyState === WebSocket.OPEN) {\n      ws.send(JSON.stringify({ type: \"cam-create\" }));\n    } else {\n      startPhonePairing();\n    }\n    try {\n      setPreferredCameraLocked(true);\n    } catch {}\n  }\n\n  function stopAll() {\n    stop();\n    setPairCode(null);\n    setPaired(false);\n    setExpiresAt(null);\n    if (pc) {\n      try {\n        pc.close();\n      } catch {}\n      setPc(null);\n    }\n  }\n  return (\n    <CameraFrame\n      label={label}\n      autoStart={autoStart}\n      start={start}\n      stopAll={stopAll}\n      startPhonePairing={startPhonePairing}\n      startWifiConnection={startWifiConnection}\n      startUsbConnection={startUsbConnection}\n      connectToWifiDevice={connectToWifiDevice}\n      connectToUsbDevice={connectToUsbDevice}\n      videoRef={videoRef}\n      streaming={streaming}\n      mode={mode}\n      setMode={setMode}\n      pairCode={pairCode}\n      mobileUrl={mobileUrl}\n      regenerateCode={regenerateCode}\n      httpsInfo={httpsInfo}\n      showTips={showTips}\n      setShowTips={setShowTips}\n      wifiDevices={wifiDevices}\n      usbDevices={usbDevices}\n      discoveringWifi={discoveringWifi}\n      discoveringUsb={discoveringUsb}\n      scaleOverride={scaleOverride}\n      className={className}\n      aspect={aspect}\n      style={style}\n      fill={fill}\n      onModeSelect={handleModeSelect}\n      preferredCameraLocked={preferredCameraLocked}\n    />\n  );\n}\n\nfunction CameraFrame(props: any) {\n  const cameraSession = useCameraSession();\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings();\n  const {\n    label,\n    start,\n    stopAll,\n    startPhonePairing,\n    startWifiConnection,\n    startUsbConnection,\n    connectToWifiDevice,\n    connectToUsbDevice,\n    videoRef,\n    streaming,\n    mode,\n    setMode,\n    onModeSelect,\n    pairCode,\n    mobileUrl,\n    regenerateCode,\n    httpsInfo,\n    showTips,\n    setShowTips,\n    wifiDevices,\n    usbDevices,\n    discoveringWifi,\n    discoveringUsb,\n    className,\n    aspect,\n    style,\n    fill,\n    preferredCameraLocked,\n  } = props;\n\n  const modeDisplayName: Record<string, string> = {\n    local: \"Local\",\n    phone: \"PhoneCam\",\n    wifi: \"Wi-Fi/USB\",\n  };\n\n  const reconnectOptions = useMemo(() => {\n    return [\n      {\n        id: \"local\",\n        title: \"Local camera\",\n        description: \"Use the desktop webcam or capture card.\",\n        action: () => {\n          if (onModeSelect) onModeSelect(\"local\");\n        },\n      },\n      {\n        id: \"phone\",\n        title: \"PhoneCam\",\n        description: \"Stream from your phone via the mobile link.\",\n        action: () => {\n          if (onModeSelect) onModeSelect(\"phone\");\n        },\n      },\n      {\n        id: \"wifi\",\n        title: \"Wi-Fi/USB\",\n        description: \"Connect to scoring devices on your local network.\",\n        action: () => {\n          if (onModeSelect) onModeSelect(\"wifi\");\n        },\n      },\n      {\n        id: \"usb\",\n        title: \"USB\",\n        description: \"Connect a USB capture device (treated like WiFi mode).\",\n        action: () => {\n          if (onModeSelect) onModeSelect(\"usb\");\n        },\n      },\n    ];\n  }, [\n    setMode,\n    start,\n    startPhonePairing,\n    startWifiConnection,\n    startUsbConnection,\n  ]);\n\n  const [copyFeedback, setCopyFeedback] = useState<\"link\" | \"code\" | null>(\n    null,\n  );\n  const copyTimeoutRef = useRef<number | null>(null);\n\n  useEffect(() => {\n    return () => {\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current);\n    };\n  }, []);\n\n  // Respect stored aspect unless we're explicitly in full-bleed fill mode,\n  // in which case drop the aspect box so the video can truly cover the area.\n  const { cameraFitMode: globalFitMode } = useUserSettings();\n  const effectiveFitMode: \"fit\" | \"fill\" = fill\n    ? \"fill\"\n    : globalFitMode || \"fill\";\n  // In fill mode we guarantee no black bars: never allow downscaling below 1.0\n  const scale = (() => {\n    const raw = Number(props.scaleOverride ?? cameraScale ?? 1);\n    const clamped = Math.max(0.5, Math.min(1.25, raw));\n    return effectiveFitMode === \"fill\" ? Math.max(1, clamped) : clamped;\n  })();\n  const aspectChoice: \"wide\" | \"square\" | \"portrait\" | \"classic\" | \"free\" =\n    fill && effectiveFitMode === \"fill\"\n      ? \"free\"\n      : aspect && aspect !== \"inherit\"\n        ? aspect\n        : (storedAspect as any) || \"wide\";\n\n  const shouldMaintainAspect = aspectChoice !== \"free\";\n  const aspectClass = shouldMaintainAspect\n    ? aspectChoice === \"square\"\n      ? \"aspect-square\"\n      : aspectChoice === \"portrait\"\n        ? \"aspect-[3/4]\"\n        : aspectChoice === \"classic\"\n          ? \"aspect-[4/3]\"\n          : \"aspect-video\"\n    : \"\";\n\n  const containerBase = fill\n    ? \"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30\"\n    : \"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30\";\n  const containerClass = [containerBase, className]\n    .filter(Boolean)\n    .join(\" \")\n    .trim();\n  const containerStyle: CSSProperties = { ...(style || {}) };\n\n  const viewportClass = fill\n    ? \"relative flex-1 min-h-[420px] bg-black\"\n    : \"relative w-full bg-black\";\n\n  const commonVideoProps = {\n    style: { transform: `scale(${scale})`, transformOrigin: \"center\" as const },\n  };\n\n  const usbActive =\n    mode === \"wifi\" && usbDevices.some((d: USBDevice) => d.status === \"online\");\n\n  const videoElement = (() => {\n    // Apply Fit/Fill preference (fill prop hard-overrides to full-bleed)\n    const isFit = effectiveFitMode === \"fit\";\n    const baseVideoClass = isFit\n      ? // Fit: preserve entire frame (may letterbox)\n        \"absolute inset-0 w-full h-full object-contain object-center bg-transparent\"\n      : // Fill: guarantee full coverage with object-cover so there are no black bars\n        \"absolute inset-0 w-full h-full object-cover object-center bg-transparent\";\n    if (fill) {\n      if (shouldMaintainAspect) {\n        return (\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div\n              className={`relative w-full max-w-full max-h-full ${aspectClass}`}\n            >\n              <video\n                ref={videoRef}\n                className={baseVideoClass}\n                {...commonVideoProps}\n              />\n            </div>\n          </div>\n        );\n      }\n      return (\n        <video\n          ref={videoRef}\n          className={baseVideoClass}\n          {...commonVideoProps}\n        />\n      );\n    }\n    if (shouldMaintainAspect) {\n      return (\n        <div className={`relative w-full ${aspectClass}`}>\n          <video\n            ref={videoRef}\n            className={baseVideoClass}\n            {...commonVideoProps}\n          />\n        </div>\n      );\n    }\n    return (\n      <div className=\"relative w-full\">\n        <video\n          ref={videoRef}\n          className={baseVideoClass}\n          {...commonVideoProps}\n        />\n      </div>\n    );\n  })();\n\n  async function copyValue(\n    value: string | null | undefined,\n    type: \"link\" | \"code\",\n  ) {\n    if (!value) return;\n    try {\n      if (navigator.clipboard && navigator.clipboard.writeText) {\n        await navigator.clipboard.writeText(value);\n      } else {\n        const textarea = document.createElement(\"textarea\");\n        textarea.value = value;\n        textarea.style.position = \"fixed\";\n        textarea.style.opacity = \"0\";\n        document.body.appendChild(textarea);\n        textarea.focus();\n        textarea.select();\n        document.execCommand(\"copy\");\n        document.body.removeChild(textarea);\n      }\n      setCopyFeedback(type);\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current);\n      copyTimeoutRef.current = window.setTimeout(\n        () => setCopyFeedback(null),\n        1500,\n      );\n    } catch (err) {\n      console.warn(\"Copy to clipboard failed:\", err);\n      setCopyFeedback(null);\n    }\n  }\n\n  return (\n    <div className={containerClass} style={containerStyle}>\n      <div className={viewportClass}>\n        {videoElement}\n        {cameraSession.isStreaming && mode === \"phone\" && (\n          <div className=\"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg\">\n            <span className=\"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse\" />\n            <span>REC</span>\n          </div>\n        )}\n      </div>\n      <div className=\"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50\">\n        <span className=\"truncate font-medium\">\n          {label ||\n            (streaming\n              ? mode === \"phone\"\n                ? \"PHONE LIVE\"\n                : mode === \"wifi\"\n                  ? \"WIFI LIVE\"\n                  : \"LIVE\"\n              : \"Camera\")}\n          {preferredCameraLocked && (\n            <span className=\"ml-2 text-xs opacity-80\">ðŸ”’</span>\n          )}\n        </span>\n        <div className=\"flex items-center gap-2\">\n          {!streaming && (\n            <>\n              <button\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"local\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\n                onClick={() => onModeSelect(\"local\")}\n              >\n                Local\n              </button>\n              <button\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"phone\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\n                onClick={() => onModeSelect(\"phone\")}\n              >\n                Phone\n              </button>\n              <button\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"wifi\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\n                onClick={() => onModeSelect(\"wifi\")}\n              >\n                WiFi\n              </button>\n              <button\n                className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode === \"wifi\" ? \"bg-emerald-500 text-white\" : \"bg-slate-700 text-slate-200 hover:bg-slate-600\"}`}\n                onClick={() => onModeSelect(\"usb\")}\n              >\n                USB\n              </button>\n            </>\n          )}\n          {streaming ? (\n            <button\n              className=\"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all\"\n              onClick={stopAll}\n            >\n              Stop\n            </button>\n          ) : null}\n        </div>\n      </div>\n      {mode === \"phone\" && pairCode && !streaming && (\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\n          <button\n            type=\"button\"\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\n            onClick={() => copyValue(mobileUrl, \"link\")}\n            title=\"Copy mobile camera link\"\n          >\n            <span className=\"flex-1 min-w-0 font-mono break-all\">\n              {mobileUrl}\n            </span>\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">\n              {copyFeedback === \"link\" ? \"Copied!\" : \"Copy\"}\n            </span>\n          </button>\n          <div className=\"mt-1 flex items-center gap-2\">\n            <a\n              href={mobileUrl}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\n            >\n              Open link\n            </a>\n            <button\n              type=\"button\"\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\n              onClick={() => copyValue(pairCode, \"code\")}\n              title=\"Copy pairing code\"\n            >\n              <span className=\"font-mono tracking-[0.3em] text-sm\">\n                {pairCode}\n              </span>\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">\n                {copyFeedback === \"code\" ? \"Copied!\" : \"Copy\"}\n              </span>\n            </button>\n          </div>\n          <div className=\"mt-1 flex items-center gap-2\">\n            <button\n              className=\"px-1 py-0.5 rounded bg-slate-700\"\n              onClick={regenerateCode}\n            >\n              Regenerate\n            </button>\n          </div>\n          {showTips && (\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\n              <ul className=\"list-disc pl-4 space-y-1\">\n                <li>Phone and desktop must be on the same Wiâ€‘Fi network.</li>\n                <li>\n                  Allow the server through your firewall (ports 8787 and{\" \"}\n                  {httpsInfo?.https ? httpsInfo.port : 8788}).\n                </li>\n                <li>\n                  On iPhone, use HTTPS links (QR will prefer https when\n                  enabled).\n                </li>\n              </ul>\n              <div className=\"mt-2 text-right\">\n                <button\n                  className=\"btn btn--ghost px-2 py-1 text-xs\"\n                  onClick={() => setShowTips(false)}\n                >\n                  Hide tips\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n      {mode === \"wifi\" && !streaming && (\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\n\n          {/* WiFi Devices */}\n          <div className=\"mb-3\">\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\n            {discoveringWifi ? (\n              <div className=\"flex items-center gap-2\">\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\n                <span>Scanning network...</span>\n              </div>\n            ) : wifiDevices.length > 0 ? (\n              <div className=\"space-y-1\">\n                {wifiDevices.map((device: NetworkDevice) => (\n                  <div\n                    key={device.id}\n                    className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\"\n                  >\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium truncate\">{device.name}</div>\n                      <div className=\"opacity-70 text-[9px]\">\n                        {device.ip}:{device.port}\n                      </div>\n                    </div>\n                    <button\n                      className={`px-1 py-0.5 rounded text-[9px] ${\n                        device.status === \"connecting\"\n                          ? \"bg-yellow-600\"\n                          : device.status === \"online\"\n                            ? \"bg-green-600\"\n                            : \"bg-blue-600\"\n                      }`}\n                      onClick={() => connectToWifiDevice(device)}\n                      disabled={device.status === \"connecting\"}\n                    >\n                      {device.status === \"connecting\" ? \"...\" : \"Connect\"}\n                    </button>\n                  </div>\n                ))}\n                <div className=\"text-center mt-2\">\n                  <button\n                    className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\n                    onClick={startWifiConnection}\n                  >\n                    Rescan WiFi\n                  </button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-center\">\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\n                <button\n                  className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\n                  onClick={startWifiConnection}\n                >\n                  Scan WiFi\n                </button>\n              </div>\n            )}\n          </div>\n\n          {/* USB Devices */}\n          <div>\n            <div className=\"font-medium mb-1\">USB Devices</div>\n            {discoveringUsb ? (\n              <div className=\"flex items-center gap-2\">\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\n                <span>Scanning USB...</span>\n              </div>\n            ) : usbDevices.length > 0 ? (\n              <div className=\"space-y-1\">\n                {usbDevices.map((device: USBDevice) => (\n                  <div\n                    key={device.id}\n                    className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\"\n                  >\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium truncate\">{device.name}</div>\n                      <div className=\"opacity-70 text-[9px]\">\n                        {device.type.toUpperCase()}\n                      </div>\n                    </div>\n                    <button\n                      className={`px-1 py-0.5 rounded text-[9px] ${\n                        device.status === \"connecting\"\n                          ? \"bg-yellow-600\"\n                          : device.status === \"online\"\n                            ? \"bg-green-600\"\n                            : \"bg-blue-600\"\n                      }`}\n                      onClick={() => connectToUsbDevice(device)}\n                      disabled={device.status === \"connecting\"}\n                    >\n                      {device.status === \"connecting\" ? \"...\" : \"Connect\"}\n                    </button>\n                  </div>\n                ))}\n                <div className=\"text-center mt-2\">\n                  <button\n                    className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\n                    onClick={startUsbConnection}\n                  >\n                    Rescan USB\n                  </button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-center\">\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\n                <button\n                  className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\"\n                  onClick={startUsbConnection}\n                >\n                  Scan USB\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      {!streaming && (\n        <div className=\"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div>\n              <div className=\"text-[10px] uppercase tracking-wide text-slate-500\">\n                Camera modes\n              </div>\n              <div className=\"text-sm font-semibold text-slate-900\">\n                Reconnect camera\n              </div>\n            </div>\n            <span className=\"text-xs text-slate-500\">\n              Current: {modeDisplayName[mode] || \"Local\"}\n            </span>\n          </div>\n          <p className=\"text-xs text-slate-500 mb-2\">\n            Tap a mode to restart the feed or switch inputs.\n          </p>\n          <div className=\"grid grid-cols-2 gap-2\">\n            {reconnectOptions.map((option) => {\n              const isActive =\n                option.id === \"usb\" ? usbActive : option.id === mode;\n              return (\n                <button\n                  key={option.id}\n                  type=\"button\"\n                  onClick={option.action}\n                  className={`text-left p-3 rounded-2xl border ${isActive ? \"border-emerald-500 bg-emerald-50 shadow\" : \"border-slate-200 bg-white/80 hover:bg-slate-50\"} transition`}\n                >\n                  <div className=\"text-xs font-semibold uppercase tracking-wide text-slate-500\">\n                    {option.title}\n                  </div>\n                  <div className=\"text-[11px] text-slate-600 mt-1\">\n                    {option.description}\n                  </div>\n                  {isActive && (\n                    <div className=\"text-[10px] text-emerald-500 mt-2\">\n                      Active\n                    </div>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import type { Homography, Point } from \"./vision\";\nimport { imageToBoard, scoreAtBoardPoint } from \"./vision\";\n\nexport function scoreFromImagePoint(H_boardToImage: Homography, pImg: Point) {\n  const pBoard = imageToBoard(H_boardToImage, pImg);\n  return scoreAtBoardPoint(pBoard);\n}\n","// High-accuracy dart detector for built-in autoscore\n// Strategy:\n// - Maintain a grayscale background model (running average) when no darts are present\n// - For each frame, compute abs-diff mask vs background and apply a 3x3 morphological closing to reduce noise\n// - Restrict detection to a circular ROI around board center (from calibration) to ignore background\n// - Find the largest foreground blob; compute PCA on blob pixels to estimate shaft orientation\n// - Estimate the tip as the extreme along the principal axis in the outward radial direction from board center\n// - Stabilize across consecutive frames (2+) before emitting a detection; debounce between darts\n\nexport type Point = { x: number; y: number };\n\nexport type DartDetection = {\n  tip: Point;\n  axis?: { x1: number; y1: number; x2: number; y2: number };\n  area: number;\n  bbox: { x: number; y: number; w: number; h: number };\n  confidence: number; // 0..1 heuristic\n};\n\nexport class DartDetector {\n  private width = 0;\n  private height = 0;\n  private bg: Float32Array | null = null; // grayscale background\n  private lastAcceptTs = 0;\n  private cooldownMs = 600;\n  private roiRadius = 0; // pixels; 0 means disabled\n  private roiCx = 0;\n  private roiCy = 0;\n  private initialized = false;\n\n  // Tuning\n  private thresh = 28; // intensity threshold for foreground\n  private minArea = 90; // min connected pixels to consider a dart\n  private maxArea = 6000; // guard against massive motion\n  // temporal stabilization\n  private prevTip: Point | null = null;\n  private prevArea: number = 0;\n  private stableCount = 0;\n  private requireStableN = 3;\n\n  constructor() {}\n\n  setROI(cx: number, cy: number, radius: number) {\n    this.roiCx = cx;\n    this.roiCy = cy;\n    this.roiRadius = Math.max(0, radius | 0);\n  }\n\n  reset(width: number, height: number) {\n    this.width = width;\n    this.height = height;\n    this.bg = new Float32Array(width * height);\n    this.initialized = false;\n  }\n\n  // Seed or update background model with the provided frame\n  // If not initialized, copy; else running average with small alpha\n  updateBackground(frame: ImageData, alpha = 0.05) {\n    const { width: w, height: h, data } = frame;\n    if (!this.bg || w !== this.width || h !== this.height) {\n      this.reset(w, h);\n    }\n    const bg = this.bg!;\n    const n = w * h;\n    for (let i = 0, p = 0; i < n; i++, p += 4) {\n      const r = data[p],\n        g = data[p + 1],\n        b = data[p + 2];\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n      if (!this.initialized) bg[i] = gray;\n      else bg[i] = (1 - alpha) * bg[i] + alpha * gray;\n    }\n    this.initialized = true;\n  }\n\n  private inRoi(x: number, y: number): boolean {\n    if (this.roiRadius <= 0) return true;\n    const dx = x - this.roiCx;\n    const dy = y - this.roiCy;\n    return dx * dx + dy * dy <= this.roiRadius * this.roiRadius;\n  }\n\n  // Returns a detection if a new dart-like blob is found; null otherwise\n  detect(frame: ImageData): DartDetection | null {\n    const now = Date.now();\n    const recent = now - this.lastAcceptTs < this.cooldownMs;\n    const { width: w, height: h, data } = frame;\n    if (!this.bg || w !== this.width || h !== this.height) this.reset(w, h);\n    const bg = this.bg!;\n    if (!this.initialized) {\n      this.updateBackground(frame, 1.0);\n      return null;\n    }\n\n    // Build diff buffer and compute dynamic threshold excluding specular highlights\n    const n = w * h;\n    const mask = new Uint8Array(n);\n    const diff = new Float32Array(n);\n    let sum = 0,\n      sum2 = 0,\n      cnt = 0;\n    const isHighlight = new Uint8Array(n);\n    for (let i = 0, p = 0; i < n; i++, p += 4) {\n      const r = data[p],\n        g = data[p + 1],\n        b = data[p + 2];\n      const maxc = Math.max(r, g, b);\n      const minc = Math.min(r, g, b);\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n      const d = Math.abs(gray - bg[i]);\n      diff[i] = d;\n      const y = Math.floor(i / w);\n      const x = i - y * w;\n      // specular highlight heuristic: very bright with low chroma\n      const satApprox = maxc === 0 ? 0 : (maxc - minc) / maxc;\n      const isHi = maxc >= 250 && satApprox <= 0.12;\n      if (isHi) isHighlight[i] = 1;\n      if (this.inRoi(x, y) && !isHi) {\n        sum += d;\n        sum2 += d * d;\n        cnt++;\n      }\n    }\n    const mu = cnt ? sum / cnt : 0;\n    const var_ = cnt ? Math.max(0, sum2 / cnt - mu * mu) : 0;\n    const sigma = Math.sqrt(var_);\n    const dynamicThresh = Math.max(this.thresh, mu + 1.2 * sigma);\n    // Rebuild mask using dynamic threshold and ignoring highlights\n    for (let i = 0; i < n; i++) {\n      if (isHighlight[i]) {\n        mask[i] = 0;\n        continue;\n      }\n      if (diff[i] > dynamicThresh) {\n        const y = Math.floor(i / w);\n        const x = i - y * w;\n        mask[i] = this.inRoi(x, y) ? 1 : 0;\n      }\n    }\n\n    // Morphological closing (dilate then erode) to consolidate thin shapes\n    this._dilate(mask, w, h);\n    this._erode(mask, w, h);\n\n    // Connected components (single pass using queue BFS); track largest blob\n    const visited = new Uint8Array(n);\n    let bestArea = 0;\n    let bestIdxs: number[] | null = null;\n    for (let i = 0; i < n; i++) {\n      if (mask[i] === 0 || visited[i]) continue;\n      const idxs: number[] = [];\n      let area = 0;\n      let qh = 0;\n      const q: number[] = [i];\n      visited[i] = 1;\n      while (qh < q.length) {\n        const cur = q[qh++];\n        idxs.push(cur);\n        area++;\n        const y = (cur / w) | 0;\n        const x = cur - y * w;\n        // 4-neighborhood\n        const nbs = [cur - 1, cur + 1, cur - w, cur + w];\n        for (const nb of nbs) {\n          if (nb < 0 || nb >= n) continue;\n          if (visited[nb]) continue;\n          // bounds checks for left/right\n          if ((nb === cur - 1 || nb === cur + 1) && ((nb / w) | 0) !== y)\n            continue;\n          if (mask[nb]) {\n            visited[nb] = 1;\n            q.push(nb);\n          }\n        }\n      }\n      if (area > bestArea) {\n        bestArea = area;\n        bestIdxs = idxs;\n      }\n    }\n\n    if (!bestIdxs || bestArea < this.minArea || bestArea > this.maxArea) {\n      // Slowly update background when no valid detection to adapt lighting\n      if (!recent) this.updateBackground(frame, 0.02);\n      return null;\n    }\n\n    // Compute PCA (covariance) on blob pixels to estimate shaft orientation\n    let minX = w,\n      minY = h,\n      maxX = 0,\n      maxY = 0;\n    let meanX = 0,\n      meanY = 0;\n    for (const idx of bestIdxs) {\n      const y = (idx / w) | 0;\n      const x = idx - y * w;\n      meanX += x;\n      meanY += y;\n      if (x < minX) minX = x;\n      if (x > maxX) maxX = x;\n      if (y < minY) minY = y;\n      if (y > maxY) maxY = y;\n    }\n    meanX /= bestArea;\n    meanY /= bestArea;\n    let cxx = 0,\n      cyy = 0,\n      cxy = 0;\n    for (const idx of bestIdxs) {\n      const y = (idx / w) | 0;\n      const x = idx - y * w;\n      const dx = x - meanX;\n      const dy = y - meanY;\n      cxx += dx * dx;\n      cyy += dy * dy;\n      cxy += dx * dy;\n    }\n    cxx /= bestArea;\n    cyy /= bestArea;\n    cxy /= bestArea;\n    // Principal axis (eigenvector of covariance with largest eigenvalue)\n    // For 2x2 symmetric matrix [[cxx,cxy],[cxy,cyy]], eigenvector for largest eigenvalue lambda satisfies (cxx-l)x + cxy y = 0\n    const trace = cxx + cyy;\n    const det = cxx * cyy - cxy * cxy;\n    const tmp = Math.sqrt(Math.max(0, (trace * trace) / 4 - det));\n    const l1 = trace / 2 + tmp; // largest eigenvalue\n    // eigenvector v = (cxy, l1 - cxx) or (l1 - cyy, cxy); choose longer\n    let vx = cxy,\n      vy = l1 - cxx;\n    if (Math.hypot(vx, vy) < 1e-6) {\n      vx = l1 - cyy;\n      vy = cxy;\n    }\n    const vlen = Math.hypot(vx, vy) || 1;\n    vx /= vlen;\n    vy /= vlen;\n\n    // Determine which direction along the axis points outward from board center\n    const dxc = meanX - this.roiCx;\n    const dyc = meanY - this.roiCy;\n    const outward = dxc * vx + dyc * vy > 0 ? 1 : -1;\n    vx *= outward;\n    vy *= outward;\n\n    // Enforce radial alignment: reject if principal axis deviates too much from radial direction\n    const rlen = Math.hypot(dxc, dyc) || 1;\n    const rx = dxc / rlen,\n      ry = dyc / rlen;\n    const cosAng = Math.max(-1, Math.min(1, vx * rx + vy * ry));\n    const angDeg = (Math.acos(cosAng) * 180) / Math.PI;\n    if (angDeg > 55) {\n      // likely glare or non-radial artifact\n      if (!recent) this.updateBackground(frame, 0.02);\n      return null;\n    }\n\n    // Project all blob points onto axis and pick extreme (max t) as tip candidate\n    let maxT = -Infinity;\n    let tipX = meanX,\n      tipY = meanY;\n    for (const idx of bestIdxs) {\n      const y = (idx / w) | 0;\n      const x = idx - y * w;\n      const t = (x - meanX) * vx + (y - meanY) * vy;\n      if (t > maxT) {\n        maxT = t;\n        tipX = x;\n        tipY = y;\n      }\n    }\n\n    // Distance to center for confidence heuristic\n    const dxr = tipX - this.roiCx;\n    const dyr = tipY - this.roiCy;\n    const minR2 = dxr * dxr + dyr * dyr;\n\n    // Confidence heuristic based on compactness and radial extent\n    const bboxW = Math.max(1, maxX - minX + 1);\n    const bboxH = Math.max(1, maxY - minY + 1);\n    const bboxArea = bboxW * bboxH;\n    const fill = bestArea / bboxArea; // 0..1 (thin dart should be small fill)\n    const radial = Math.sqrt(minR2) / Math.max(1, this.roiRadius);\n    let confidence = 0.5;\n    // Prefer thin elongated shapes with small fill and inside ROI\n    if (fill < 0.45) confidence += 0.2;\n    if (fill < 0.25) confidence += 0.15;\n    if (radial < 1.1) confidence += 0.1;\n    // Orientation confidence: larger principal eigenvalue vs minor\n    const l2 = trace - l1;\n    const elong = l1 > 0 ? 1 - l2 / l1 : 0;\n    if (elong > 0.3) confidence += 0.1;\n    confidence = Math.max(0, Math.min(1, confidence));\n\n    // Update background outside the blob to keep stability\n    // Optionally, we can inpaint the blob into background upon acceptance by caller\n\n    // Temporal stabilization: require 2+ consistent frames for the same dart\n    const stable = this._isStable({ x: tipX + 0.5, y: tipY + 0.5 }, bestArea);\n    if (!stable) return null;\n    // Debounce\n    if (recent) return null;\n\n    return {\n      tip: { x: tipX + 0.5, y: tipY + 0.5 },\n      axis: {\n        x1: meanX - vx * 20,\n        y1: meanY - vy * 20,\n        x2: meanX + vx * 20,\n        y2: meanY + vy * 20,\n      },\n      area: bestArea,\n      bbox: { x: minX, y: minY, w: bboxW, h: bboxH },\n      confidence,\n    };\n  }\n\n  // Incorporate the accepted detection into background so it won't trigger again\n  accept(frame: ImageData, det: DartDetection) {\n    this.lastAcceptTs = Date.now();\n    // reset temporal stabilization for next dart\n    this.prevTip = null;\n    this.prevArea = 0;\n    this.stableCount = 0;\n    if (!this.bg) return;\n    const { width: w } = frame;\n    const bg = this.bg;\n    const { x, y, w: bw, h: bh } = det.bbox;\n    const alpha = 0.5;\n    for (let yy = y; yy < y + bh; yy++) {\n      for (let xx = x; xx < x + bw; xx++) {\n        const i = yy * w + xx;\n        const p = i * 4;\n        const r = frame.data[p],\n          g = frame.data[p + 1],\n          b = frame.data[p + 2];\n        const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n        bg[i] = (1 - alpha) * bg[i] + alpha * gray;\n      }\n    }\n  }\n\n  // --- helpers ---\n  private _isStable(tip: Point, area: number): boolean {\n    const close = (a: Point, b: Point) => Math.hypot(a.x - b.x, a.y - b.y) <= 6;\n    if (!this.prevTip) {\n      this.prevTip = { ...tip };\n      this.prevArea = area;\n      this.stableCount = 1;\n      return false;\n    }\n    if (\n      close(this.prevTip, tip) &&\n      Math.abs(area - this.prevArea) / Math.max(1, area) < 0.3\n    ) {\n      this.prevTip = { ...tip };\n      this.prevArea = area;\n      this.stableCount++;\n    } else {\n      this.prevTip = { ...tip };\n      this.prevArea = area;\n      this.stableCount = 1;\n      return false;\n    }\n    return this.stableCount >= this.requireStableN;\n  }\n\n  private _dilate(mask: Uint8Array, w: number, h: number) {\n    const out = new Uint8Array(mask.length);\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        let on = 0;\n        for (let j = -1; j <= 1; j++) {\n          for (let i = -1; i <= 1; i++) {\n            const yy = y + j,\n              xx = x + i;\n            if (yy < 0 || yy >= h || xx < 0 || xx >= w) continue;\n            if (mask[yy * w + xx]) {\n              on = 1;\n              break;\n            }\n          }\n          if (on) break;\n        }\n        out[y * w + x] = on;\n      }\n    }\n    mask.set(out);\n  }\n\n  private _erode(mask: Uint8Array, w: number, h: number) {\n    const out = new Uint8Array(mask.length);\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        let on = 1;\n        for (let j = -1; j <= 1; j++) {\n          for (let i = -1; i <= 1; i++) {\n            const yy = y + j,\n              xx = x + i;\n            if (yy < 0 || yy >= h || xx < 0 || xx >= w) continue;\n            if (!mask[yy * w + xx]) {\n              on = 0;\n              break;\n            }\n          }\n          if (!on) break;\n        }\n        out[y * w + x] = on;\n      }\n    }\n    mask.set(out);\n  }\n}\n","// Generic autoscore provider helpers: parse vendor-agnostic payloads and subscribe via WebSocket\n\nexport type Ring =\n  | \"MISS\"\n  | \"SINGLE\"\n  | \"DOUBLE\"\n  | \"TRIPLE\"\n  | \"BULL\"\n  | \"INNER_BULL\";\nexport type ParsedDart = {\n  value: number;\n  ring: Ring;\n  sector?: number | null;\n  mult?: 0 | 1 | 2 | 3;\n};\n\n// Try to parse a variety of vendor payload shapes\nexport function parseExternalDart(data: any): ParsedDart | null {\n  try {\n    if (!data || typeof data !== \"object\") return null;\n    // 1) { type:'dart', value: <0-60>, ring: 'SINGLE'|'DOUBLE'|... }\n    if (\n      (data.type === \"dart\" || data.kind === \"dart\" || data.event === \"dart\") &&\n      typeof data.value === \"number\"\n    ) {\n      const ring = normalizeRing(data.ring);\n      return finalizeFromValue(data.value, ring);\n    }\n    // 2) { value, ring }\n    if (typeof data.value === \"number\" && data.ring) {\n      const ring = normalizeRing(data.ring);\n      return finalizeFromValue(data.value, ring);\n    }\n    // 3) { score: 'T20'|'D16'|'S5'|'25'|'50' }\n    if (typeof data.score === \"string\") {\n      const s = data.score.trim().toUpperCase();\n      if (s === \"50\" || s === \"DBULL\" || s === \"INNER_BULL\")\n        return { value: 50, ring: \"INNER_BULL\", sector: null, mult: 0 };\n      if (s === \"25\" || s === \"BULL\" || s === \"OBULL\")\n        return { value: 25, ring: \"BULL\", sector: null, mult: 0 };\n      const m = s.match(/^(S|D|T)(\\d{1,2})$/);\n      if (m) {\n        const mult = m[1] === \"S\" ? 1 : m[1] === \"D\" ? 2 : 3;\n        const sec = parseInt(m[2], 10);\n        if (sec >= 1 && sec <= 20)\n          return {\n            value: sec * mult,\n            ring: mult === 1 ? \"SINGLE\" : mult === 2 ? \"DOUBLE\" : \"TRIPLE\",\n            sector: sec,\n            mult: mult as 1 | 2 | 3,\n          };\n      }\n    }\n    // 4) { sector: 1..20, mult: 1|2|3 }\n    if (typeof data.sector === \"number\" && typeof data.mult === \"number\") {\n      const sec = Math.max(1, Math.min(20, Math.floor(data.sector)));\n      const mul = data.mult === 1 ? 1 : data.mult === 2 ? 2 : 3;\n      return {\n        value: sec * mul,\n        ring: mul === 1 ? \"SINGLE\" : mul === 2 ? \"DOUBLE\" : \"TRIPLE\",\n        sector: sec,\n        mult: mul as 1 | 2 | 3,\n      };\n    }\n    // 5) { bull: 'outer'|'inner'|true }\n    if (data.bull) {\n      const inner =\n        String(data.bull).toLowerCase() === \"inner\" || data.bull === true;\n      return {\n        value: inner ? 50 : 25,\n        ring: inner ? \"INNER_BULL\" : \"BULL\",\n        sector: null,\n        mult: 0,\n      };\n    }\n  } catch {}\n  return null;\n}\n\nfunction normalizeRing(r: any): Ring {\n  const s = String(r || \"\").toUpperCase();\n  if (s.startsWith(\"TR\")) return \"TRIPLE\";\n  if (s.startsWith(\"DO\")) return \"DOUBLE\";\n  if (s.startsWith(\"SI\")) return \"SINGLE\";\n  if (s === \"INNER_BULL\" || s === \"DBULL\" || s === \"50\" || s === \"IBULL\")\n    return \"INNER_BULL\";\n  if (s === \"BULL\" || s === \"25\" || s === \"OBULL\" || s === \"OUTER_BULL\")\n    return \"BULL\";\n  if (s === \"MISS\" || s === \"0\") return \"MISS\";\n  return \"SINGLE\";\n}\n\nfunction finalizeFromValue(value: number, ring: Ring): ParsedDart | null {\n  const v = Math.max(0, Math.min(60, Math.round(Number(value) || 0)));\n  if (ring === \"INNER_BULL\") return { value: 50, ring };\n  if (ring === \"BULL\") return { value: 25, ring };\n  // Best-effort: preserve base if consistent with ring\n  return { value: v, ring };\n}\n\nexport type ExternalSub = { close: () => void };\n\nexport function subscribeExternalWS(\n  url: string,\n  onDart: (d: ParsedDart) => void,\n): ExternalSub {\n  let socket: WebSocket | null = null;\n  let alive = true;\n  // Lightweight duplicate suppression: ignore exact repeat within a short window\n  let lastSig: string | null = null;\n  let lastSigAt = 0;\n  const DEDUP_WINDOW_MS = 400;\n  // Optional ID-based dedup if provider sends unique ids\n  const seenIds: string[] = [];\n  const seenSet = new Set<string>();\n\n  function considerForward(payload: any, parsed: ParsedDart) {\n    // If payload has a stable id, drop if seen\n    const pid =\n      typeof payload?.id === \"string\" || typeof payload?.id === \"number\"\n        ? String(payload.id)\n        : null;\n    if (pid) {\n      if (seenSet.has(pid)) return;\n      seenSet.add(pid);\n      seenIds.push(pid);\n      if (seenIds.length > 200) {\n        const old = seenIds.shift();\n        if (old) seenSet.delete(old);\n      }\n    }\n    // Time-based dedup by signature (safe; darts cannot occur within <400ms)\n    const sig = `${parsed.value}|${parsed.ring}|${parsed.sector ?? \"\"}|${parsed.mult ?? \"\"}`;\n    const now = Date.now();\n    if (sig === lastSig && now - lastSigAt < DEDUP_WINDOW_MS) return;\n    lastSig = sig;\n    lastSigAt = now;\n    onDart(parsed);\n  }\n\n  function connect() {\n    if (!alive) return;\n    try {\n      socket = new WebSocket(url);\n      socket.onmessage = (ev) => {\n        try {\n          const payload = JSON.parse(ev.data);\n          const parsed = parseExternalDart(payload);\n          if (parsed) considerForward(payload, parsed);\n        } catch {}\n      };\n      socket.onclose = () => {\n        socket = null;\n        setTimeout(connect, 1500);\n      };\n      socket.onerror = () => {\n        /* ignore; will reconnect on close */\n      };\n    } catch {\n      setTimeout(connect, 2000);\n    }\n  }\n  connect();\n  return {\n    close: () => {\n      alive = false;\n      try {\n        socket?.close();\n      } catch {}\n    },\n  };\n}\n","import React, {\n  useEffect,\n  useRef,\n  useState,\n  type ReactNode,\n  type CSSProperties,\n} from \"react\";\n\ntype Props = {\n  storageKey: string;\n  children: ReactNode;\n  className?: string;\n  defaultWidth?: number;\n  defaultHeight?: number;\n  minWidth?: number;\n  minHeight?: number;\n  maxWidth?: number;\n  maxHeight?: number;\n  autoFill?: boolean;\n};\n\ntype Size = { width?: number; height?: number };\n\nexport default function ResizablePanel({\n  storageKey,\n  children,\n  className,\n  defaultWidth = 640,\n  defaultHeight = 360,\n  minWidth = 320,\n  minHeight = 200,\n  maxWidth = 1600,\n  maxHeight = 1200,\n  autoFill = false,\n}: Props) {\n  const [size, setSize] = useState<Size>(() => {\n    try {\n      const raw = localStorage.getItem(storageKey);\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    // If autoFill is requested, don't persist a fixed height â€” let CSS stretch the panel\n    return autoFill\n      ? { width: defaultWidth }\n      : { width: defaultWidth, height: defaultHeight };\n  });\n  const startRef = useRef<{\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n    dir: string;\n  } | null>(null);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    function onReset() {\n      try {\n        localStorage.removeItem(storageKey);\n      } catch {}\n      setSize({ width: defaultWidth, height: defaultHeight });\n    }\n    window.addEventListener(\"ndn:layout-reset\" as any, onReset);\n    window.addEventListener(\"ndn:camera-reset\" as any, onReset);\n    return () => {\n      window.removeEventListener(\"ndn:layout-reset\" as any, onReset);\n      window.removeEventListener(\"ndn:camera-reset\" as any, onReset);\n    };\n  }, [storageKey, defaultWidth, defaultHeight]);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem(storageKey, JSON.stringify(size));\n    } catch {}\n  }, [size, storageKey]);\n\n  function clamp(n: number, min: number, max: number) {\n    return Math.max(min, Math.min(max, n));\n  }\n  function beginResize(e: React.MouseEvent, dir: string) {\n    e.preventDefault();\n    const el = containerRef.current;\n    if (!el) return;\n    const rect = el.getBoundingClientRect();\n    startRef.current = {\n      x: e.clientX,\n      y: e.clientY,\n      w: rect.width,\n      h: rect.height,\n      dir,\n    };\n    window.addEventListener(\"mousemove\", onMove);\n    window.addEventListener(\"mouseup\", endResize);\n  }\n  function onMove(e: globalThis.MouseEvent) {\n    const s = startRef.current;\n    if (!s) return;\n    const dx = e.clientX - s.x;\n    const dy = e.clientY - s.y;\n    let w = s.w;\n    let h = s.h;\n    if (s.dir.includes(\"e\")) w = clamp(s.w + dx, minWidth, maxWidth);\n    // If autoFill is enabled, ignore vertical resizing (panel should fill parent)\n    if (!autoFill && s.dir.includes(\"s\"))\n      h = clamp(s.h + dy, minHeight, maxHeight);\n    if (s.dir.includes(\"w\")) w = clamp(s.w - dx, minWidth, maxWidth);\n    if (!autoFill && s.dir.includes(\"n\"))\n      h = clamp(s.h - dy, minHeight, maxHeight);\n    setSize({ width: Math.round(w), height: Math.round(h) });\n  }\n  function endResize() {\n    window.removeEventListener(\"mousemove\", onMove);\n    window.removeEventListener(\"mouseup\", endResize);\n    startRef.current = null;\n  }\n\n  function handleKeyResize(e: React.KeyboardEvent, dir: string) {\n    const step = 20;\n    const k = e.key;\n    if (\n      ![\n        \"ArrowLeft\",\n        \"ArrowRight\",\n        \"ArrowUp\",\n        \"ArrowDown\",\n        \"Enter\",\n        \" \",\n      ].includes(k)\n    )\n      return;\n    e.preventDefault();\n    const delta = k === \"ArrowLeft\" || k === \"ArrowUp\" ? -step : step;\n    setSize((s) => {\n      const curW = s.width || defaultWidth;\n      const curH = s.height || defaultHeight;\n      let w = curW;\n      let h = curH;\n      if (dir.includes(\"e\")) w = clamp(curW + delta, minWidth, maxWidth);\n      if (dir.includes(\"w\")) w = clamp(curW - delta, minWidth, maxWidth);\n      if (!autoFill && dir.includes(\"s\"))\n        h = clamp(curH + delta, minHeight, maxHeight);\n      if (!autoFill && dir.includes(\"n\"))\n        h = clamp(curH - delta, minHeight, maxHeight);\n      return { width: Math.round(w), height: Math.round(h) };\n    });\n  }\n\n  const style: CSSProperties = {\n    width: autoFill ? \"100%\" : size.width ? `${size.width}px` : undefined,\n    height: autoFill ? \"100%\" : size.height ? `${size.height}px` : undefined,\n    maxWidth: \"100%\",\n    // Allow the panel to fill the parent when autoFill is enabled. Otherwise keep a sensible cap.\n    maxHeight: autoFill ? \"100%\" : \"80vh\",\n    position: \"relative\",\n    // Make it participate in flex layouts when filling\n    ...(autoFill\n      ? { display: \"flex\", flexDirection: \"column\", flex: \"1 1 auto\" }\n      : {}),\n  };\n\n  return (\n    <div ref={containerRef} className={`${className || \"\"}`} style={style}>\n      {children}\n      <div\n        className=\"resizer resizer-nw\"\n        onMouseDown={(e) => beginResize(e, \"nw\")}\n        role=\"button\"\n        tabIndex={0}\n        aria-label=\"Resize north-west\"\n        onKeyDown={(e) => handleKeyResize(e, \"nw\")}\n      />\n      <div\n        className=\"resizer resizer-ne\"\n        onMouseDown={(e) => beginResize(e, \"ne\")}\n        role=\"button\"\n        tabIndex={0}\n        aria-label=\"Resize north-east\"\n        onKeyDown={(e) => handleKeyResize(e, \"ne\")}\n      />\n      <div\n        className=\"resizer resizer-sw\"\n        onMouseDown={(e) => beginResize(e, \"sw\")}\n        role=\"button\"\n        tabIndex={0}\n        aria-label=\"Resize south-west\"\n        onKeyDown={(e) => handleKeyResize(e, \"sw\")}\n      />\n      <div\n        className=\"resizer resizer-se\"\n        onMouseDown={(e) => beginResize(e, \"se\")}\n        role=\"button\"\n        tabIndex={0}\n        aria-label=\"Resize south-east\"\n        onKeyDown={(e) => handleKeyResize(e, \"se\")}\n      />\n    </div>\n  );\n}\n","import { create } from \"zustand\";\n\nexport type HeatSample = {\n  playerId: string | null;\n  sector: number | null;\n  mult: 0 | 1 | 2 | 3;\n  ring: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\";\n  ts: number;\n};\n\ntype HeatState = {\n  samples: HeatSample[];\n  addSample: (s: HeatSample) => void;\n  clear: () => void;\n  export: () => HeatSample[];\n};\n\nexport const useHeatmapStore = create<HeatState>((set, get) => ({\n  samples: [],\n  addSample: (s) => set((state) => ({ samples: [...state.samples, s] })),\n  clear: () => set({ samples: [] }),\n  export: () => get().samples.slice(),\n}));\n\nexport default useHeatmapStore;\n","import { create } from \"zustand\";\n\ntype MatchControlState = {\n  paused: boolean;\n  pauseEndsAt: number | null;\n  setPaused: (v: boolean, endsAt?: number | null) => void;\n};\n\nexport const useMatchControl = create<MatchControlState>((set) => ({\n  paused: false,\n  pauseEndsAt: null,\n  setPaused: (v, endsAt = null) =>\n    set({ paused: v, pauseEndsAt: endsAt ?? null }),\n}));\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { dlog } from \"../utils/logger\";\nimport { useUserSettings } from \"../store/userSettings\";\nimport { useCalibration } from \"../store/calibration\";\nimport { useMatch } from \"../store/match\";\nimport {\n  BoardRadii,\n  drawPolyline,\n  sampleRing,\n  scaleHomography,\n  type Point,\n  applyHomography,\n  drawCross,\n  refinePointSobel,\n} from \"../utils/vision\";\nimport { scoreFromImagePoint } from \"../utils/autoscore\";\nimport { DartDetector } from \"../utils/dartDetector\";\nimport { addSample } from \"../store/profileStats\";\nimport { subscribeExternalWS } from \"../utils/scoring\";\nimport ResizablePanel from \"./ui/ResizablePanel\";\nimport ResizableModal from \"./ui/ResizableModal\";\nimport FocusLock from \"react-focus-lock\";\nimport useHeatmapStore from \"../store/heatmap\";\nimport { usePendingVisit } from \"../store/pendingVisit\";\nimport { useCameraSession } from \"../store/cameraSession\";\nimport { useMatchControl } from \"../store/matchControl\";\nimport { useAudit } from \"../store/audit\";\n\n// Shared ring type across autoscore/manual flows\ntype Ring = \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\";\n\nconst AUTO_COMMIT_MIN_FRAMES = 1;\nconst AUTO_COMMIT_HOLD_MS = 120;\nconst AUTO_COMMIT_COOLDOWN_MS = 400;\nconst AUTO_STREAM_IGNORE_MS = 450;\nconst DETECTION_ARM_DELAY_MS = 5000;\nconst AUTO_COMMIT_CONFIDENCE = 0.85;\nconst BOARD_CLEAR_GRACE_MS = 6500;\nconst DISABLE_CAMERA_OVERLAY = true;\n\ntype AutoCandidate = {\n  value: number;\n  ring: Ring;\n  label: string;\n  sector: number | null;\n  mult: 0 | 1 | 2 | 3;\n  firstTs: number;\n  frames: number;\n};\n\ntype DetectionLogEntry = {\n  ts: number;\n  label: string;\n  value: number;\n  ring: Ring;\n  confidence: number;\n  ready: boolean;\n  accepted: boolean;\n  warmup: boolean;\n};\n\nexport default function CameraView({\n  onVisitCommitted,\n  showToolbar = true,\n  onAutoDart,\n  immediateAutoCommit = false,\n  hideInlinePanels = false,\n  scoringMode = \"x01\",\n  onGenericDart,\n  onGenericReplace,\n  x01DoubleInOverride,\n  onAddVisit,\n  onEndLeg,\n}: {\n  onVisitCommitted?: (score: number, darts: number, finished: boolean) => void;\n  showToolbar?: boolean;\n  onAutoDart?: (\n    value: number,\n    ring: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    info?: { sector: number | null; mult: 0 | 1 | 2 | 3 },\n  ) => void;\n  immediateAutoCommit?: boolean;\n  hideInlinePanels?: boolean;\n  scoringMode?: \"x01\" | \"custom\";\n  onGenericDart?: (value: number, ring: Ring, meta: { label: string }) => void;\n  onGenericReplace?: (\n    value: number,\n    ring: Ring,\n    meta: { label: string },\n  ) => void;\n  x01DoubleInOverride?: boolean;\n  onAddVisit?: (score: number, darts: number, meta?: any) => void;\n  onEndLeg?: (score?: number) => void;\n}) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const {\n    preferredCameraId,\n    preferredCameraLabel,\n    setPreferredCamera,\n    autoscoreProvider,\n    autoscoreWsUrl,\n    cameraAspect,\n    cameraFitMode,\n    autoCommitMode = \"wait-for-clear\",\n    cameraEnabled,\n    setCameraEnabled,\n    preferredCameraLocked,\n    hideCameraOverlay,\n    setHideCameraOverlay,\n  } = useUserSettings();\n  const manualOnly = autoscoreProvider === \"manual\";\n  const [availableCameras, setAvailableCameras] = useState<MediaDeviceInfo[]>(\n    [],\n  );\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const overlayRef = useRef<HTMLCanvasElement>(null);\n  const [streaming, setStreaming] = useState(false);\n  const cameraSession = useCameraSession();\n  const isPhoneCamera = preferredCameraLabel === \"Phone Camera\";\n  const sessionStream = cameraSession.getMediaStream?.() || null;\n  const sessionStreaming = cameraSession.isStreaming;\n  const phoneFeedActive =\n    isPhoneCamera &&\n    cameraSession.mode === \"phone\" &&\n    sessionStreaming &&\n    !!sessionStream;\n  const effectiveStreaming = streaming || sessionStreaming;\n  const [cameraStarting, setCameraStarting] = useState(false);\n  const [snapshotUrl, setSnapshotUrl] = useState<string | null>(null);\n  const { H, imageSize, reset: resetCalibration, _hydrated } = useCalibration();\n  useEffect(() => {\n    if (preferredCameraLocked && !hideCameraOverlay) {\n      setHideCameraOverlay(true);\n    }\n  }, [preferredCameraLocked, hideCameraOverlay, setHideCameraOverlay]);\n  const [lastAutoScore, setLastAutoScore] = useState<string>(\"\");\n  const [manualScore, setManualScore] = useState<string>(\"\");\n  const [lastAutoValue, setLastAutoValue] = useState<number>(0);\n  const [lastAutoRing, setLastAutoRing] = useState<Ring>(\"MISS\");\n  const [pendingDarts, setPendingDarts] = useState<number>(0);\n  const [pendingScore, setPendingScore] = useState<number>(0);\n  const [pendingEntries, setPendingEntries] = useState<\n    { label: string; value: number; ring: Ring }[]\n  >([]);\n  const [pendingPreOpenDarts, setPendingPreOpenDarts] = useState<number>(0);\n  const [pendingDartsAtDouble, setPendingDartsAtDouble] = useState<number>(0);\n  const [awaitingClear, setAwaitingClear] = useState(false);\n  const pendingCommitRef = useRef<{\n    score: number;\n    darts: number;\n    finished: boolean;\n  } | null>(null);\n  const pendingCommitTimerRef = useRef<number | null>(null);\n  const shouldDeferCommit =\n    !immediateAutoCommit && autoCommitMode !== \"immediate\";\n  const [indicatorVersion, setIndicatorVersion] = useState(0);\n  const [indicatorEntryVersions, setIndicatorEntryVersions] = useState<\n    number[]\n  >([]);\n  const autoCandidateRef = useRef<AutoCandidate | null>(null);\n  const detectionLogRef = useRef<DetectionLogEntry[]>([]);\n  const lastAutoCommitRef = useRef<number>(0);\n  const streamingStartMsRef = useRef<number>(0);\n  const detectionArmedRef = useRef<boolean>(false);\n  const detectionArmTimerRef = useRef<number | null>(null);\n  const frameCountRef = useRef<number>(0);\n  const [detectionLog, setDetectionLog] = useState<DetectionLogEntry[]>([]);\n  const [showDetectionLog, setShowDetectionLog] = useState(false);\n  const clearPendingCommitTimer = useCallback(() => {\n    if (pendingCommitTimerRef.current) {\n      clearTimeout(pendingCommitTimerRef.current);\n      pendingCommitTimerRef.current = null;\n    }\n  }, []);\n\n  const captureDetectionLog = useCallback((entry: DetectionLogEntry) => {\n    const next = [...detectionLogRef.current.slice(-8), entry];\n    detectionLogRef.current = next;\n    setDetectionLog(next);\n    try {\n      (window as any).ndnCameraDiagnostics = next;\n    } catch {}\n  }, []);\n  const finalizePendingCommit = useCallback(\n    (_trigger: \"event\" | \"timeout\" | \"teardown\") => {\n      const pending = pendingCommitRef.current;\n      if (!pending) return;\n      pendingCommitRef.current = null;\n      clearPendingCommitTimer();\n      setAwaitingClear(false);\n      if (onVisitCommitted) {\n        try {\n          onVisitCommitted(pending.score, pending.darts, pending.finished);\n        } catch {}\n      }\n    },\n    [onVisitCommitted, clearPendingCommitTimer],\n  );\n  const enqueueVisitCommit = useCallback(\n    (payload: { score: number; darts: number; finished: boolean }) => {\n      if (!onVisitCommitted) return;\n      if (!shouldDeferCommit) {\n        try {\n          onVisitCommitted(payload.score, payload.darts, payload.finished);\n        } catch {}\n        return;\n      }\n      pendingCommitRef.current = payload;\n      setAwaitingClear(true);\n      clearPendingCommitTimer();\n      pendingCommitTimerRef.current = window.setTimeout(\n        () => finalizePendingCommit(\"timeout\"),\n        BOARD_CLEAR_GRACE_MS,\n      );\n    },\n    [\n      onVisitCommitted,\n      shouldDeferCommit,\n      clearPendingCommitTimer,\n      finalizePendingCommit,\n    ],\n  );\n  const clearPendingManual = useCallback((reason: \"indicator\" | \"toolbar\") => {\n    setPendingDarts(0);\n    setPendingScore(0);\n    setPendingEntries([]);\n    setPendingPreOpenDarts(0);\n    setPendingDartsAtDouble(0);\n    setHadRecentAuto(false);\n    try {\n      window.dispatchEvent(\n        new CustomEvent(\"ndn:clear-visit-request\", {\n          detail: { source: \"camera-view\", reason, ts: Date.now() },\n        }),\n      );\n    } catch {}\n  }, []);\n  useEffect(() => {\n    if (!shouldDeferCommit) return;\n    const handler = () => finalizePendingCommit(\"event\");\n    window.addEventListener(\"ndn:darts-cleared\", handler as EventListener);\n    return () =>\n      window.removeEventListener(\"ndn:darts-cleared\", handler as EventListener);\n  }, [shouldDeferCommit, finalizePendingCommit]);\n  useEffect(() => {\n    if (!shouldDeferCommit) finalizePendingCommit(\"timeout\");\n  }, [shouldDeferCommit, finalizePendingCommit]);\n  useEffect(\n    () => () => finalizePendingCommit(\"teardown\"),\n    [finalizePendingCommit],\n  );\n  const handleIndicatorReset = useCallback(() => {\n    clearPendingManual(\"indicator\");\n    setIndicatorVersion((v) => v + 1);\n  }, [clearPendingManual]);\n  const handleToolbarClear = useCallback(() => {\n    if (pendingDarts === 0 && pendingScore === 0) return;\n    clearPendingManual(\"toolbar\");\n    setIndicatorVersion((v) => v + 1);\n  }, [clearPendingManual, pendingDarts, pendingScore]);\n  const requestDeviceManager = useCallback(() => {\n    if (manualOnly) return;\n    try {\n      window.dispatchEvent(\n        new CustomEvent(\"ndn:open-camera-manager\", {\n          detail: { source: \"camera-view\", ts: Date.now() },\n        }),\n      );\n    } catch (err) {\n      console.warn(\"[CameraView] Failed to request camera manager:\", err);\n    }\n  }, [manualOnly]);\n  // X01 Double-In handling: per-player opened state in this session\n  const x01DoubleInSetting = useUserSettings((s) => s.x01DoubleIn);\n  const x01DoubleIn =\n    typeof x01DoubleInOverride === \"boolean\"\n      ? !!x01DoubleInOverride\n      : !!x01DoubleInSetting;\n  const [openedById, setOpenedById] = useState<Record<string, boolean>>({});\n  const matchState = useMatch((s) => s);\n  const currentPlayerId = matchState.players[matchState.currentPlayerIdx]?.id;\n  const isOpened = !!(currentPlayerId && openedById[currentPlayerId]);\n  const setOpened = (v: boolean) => {\n    if (!currentPlayerId) return;\n    setOpenedById((m) => ({ ...m, [currentPlayerId]: v }));\n  };\n  const inProgress = (matchState as any)?.inProgress;\n  // Broadcast pending visit to global store so Scoreboard can visualize dots\n  const setVisit = usePendingVisit((s) => s.setVisit);\n  const resetPendingVisit = usePendingVisit((s) => s.reset);\n  useEffect(() => {\n    try {\n      setVisit(pendingEntries as any, pendingDarts, pendingScore);\n    } catch {}\n  }, [pendingEntries, pendingDarts, pendingScore, setVisit]);\n  useEffect(\n    () => () => {\n      try {\n        resetPendingVisit();\n      } catch {}\n    },\n    [resetPendingVisit],\n  );\n  const addVisit = useMatch((s) => s.addVisit);\n  const endLeg = useMatch((s) => s.endLeg);\n  // Prefer provided adapters (matchActions wrappers) when available\n  const callAddVisit = (score: number, darts: number, meta?: any) => {\n    try {\n      if (onAddVisit) onAddVisit(score, darts, meta);\n      else addVisit(score, darts, meta);\n    } catch {\n      /* noop */\n    }\n  };\n  const callEndLeg = (score?: number) => {\n    try {\n      if (onEndLeg) onEndLeg(score);\n      else endLeg(typeof score === \"number\" ? score : 0);\n    } catch {\n      /* noop */\n    }\n  };\n  const addHeatSample = useHeatmapStore((s) => s.addSample);\n  // Quick entry dropdown selections\n  const [quickSelAuto, setQuickSelAuto] = useState(\"\");\n  const [quickSelManual, setQuickSelManual] = useState(\"\");\n  const [nonRegCount, setNonRegCount] = useState(0);\n  const [showRecalModal, setShowRecalModal] = useState(false);\n  const [hadRecentAuto, setHadRecentAuto] = useState(false);\n  const [pulseManualPill, setPulseManualPill] = useState(false);\n  const pulseTimeoutRef = useRef<number | null>(null);\n  const [activeTab, setActiveTab] = useState<\"auto\" | \"manual\">(\"auto\");\n  const [showManualModal, setShowManualModal] = useState(false);\n  const [showAutoModal, setShowAutoModal] = useState(false);\n  const [showScoringModal, setShowScoringModal] = useState(false);\n  const manualPreviewRef = useRef<HTMLCanvasElement | null>(null);\n  // Dart timer\n  const dartTimerEnabled = useUserSettings((s) => s.dartTimerEnabled);\n  const dartTimerSeconds = useUserSettings((s) => s.dartTimerSeconds) || 10;\n  const [dartTimeLeft, setDartTimeLeft] = useState<number | null>(null);\n  const timerRef = useRef<number | null>(null);\n  const paused = useMatchControl((s) => s.paused);\n  // Built-in CV detector\n  const detectorRef = useRef<DartDetector | null>(null);\n  const rafRef = useRef<number | null>(null);\n  const [detectorSeedVersion, setDetectorSeedVersion] = useState(0);\n  const handlePhoneReconnect = useCallback(() => {\n    try {\n      window.dispatchEvent(\n        new CustomEvent(\"ndn:phone-camera-reconnect\", {\n          detail: { source: \"camera-view\", ts: Date.now() },\n        }),\n      );\n    } catch (err) {\n      console.warn(\"[CameraView] Phone camera reconnect dispatch failed:\", err);\n    }\n  }, []);\n  // Open Autoscore modal from parent via global event\n  useEffect(() => {\n    const onOpen = () => {\n      if (!manualOnly) setShowAutoModal(true);\n    };\n    window.addEventListener(\"ndn:open-autoscore\" as any, onOpen);\n    return () =>\n      window.removeEventListener(\"ndn:open-autoscore\" as any, onOpen);\n  }, [manualOnly]);\n\n  // cleanup pulse timer on unmount\n  useEffect(() => {\n    return () => {\n      try {\n        if (pulseTimeoutRef.current) clearTimeout(pulseTimeoutRef.current);\n      } catch {}\n    };\n  }, []);\n\n  // Open Scoring (Camera + Pending Visit) modal from parent via global event\n  useEffect(() => {\n    const onOpen = () => setShowScoringModal(true);\n    window.addEventListener(\"ndn:open-scoring\" as any, onOpen);\n    return () => window.removeEventListener(\"ndn:open-scoring\" as any, onOpen);\n  }, []);\n\n  useEffect(() => {\n    const onDartsCleared = () => {\n      setIndicatorVersion((v) => v + 1);\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      setPendingPreOpenDarts(0);\n      setPendingDartsAtDouble(0);\n      setHadRecentAuto(false);\n    };\n    window.addEventListener(\n      \"ndn:darts-cleared\",\n      onDartsCleared as EventListener,\n    );\n    return () =>\n      window.removeEventListener(\n        \"ndn:darts-cleared\",\n        onDartsCleared as EventListener,\n      );\n  }, []);\n\n  useEffect(() => {\n    setIndicatorEntryVersions((prev) => {\n      if (pendingEntries.length > prev.length) {\n        const diff = pendingEntries.length - prev.length;\n        return [...prev, ...Array(diff).fill(indicatorVersion)];\n      }\n      if (pendingEntries.length < prev.length) {\n        return prev.slice(0, pendingEntries.length);\n      }\n      return prev;\n    });\n  }, [pendingEntries, indicatorVersion]);\n\n  useEffect(() => {\n    if (detectionArmTimerRef.current) {\n      clearTimeout(detectionArmTimerRef.current);\n      detectionArmTimerRef.current = null;\n    }\n    if (manualOnly) {\n      detectionArmedRef.current = false;\n      streamingStartMsRef.current = 0;\n      autoCandidateRef.current = null;\n      return;\n    }\n    if (effectiveStreaming) {\n      streamingStartMsRef.current = performance.now();\n      autoCandidateRef.current = null;\n      detectionArmedRef.current = false;\n      frameCountRef.current = 0;\n      detectionArmTimerRef.current = window.setTimeout(() => {\n        detectionArmedRef.current = true;\n        detectionArmTimerRef.current = null;\n      }, DETECTION_ARM_DELAY_MS);\n    } else {\n      streamingStartMsRef.current = 0;\n      autoCandidateRef.current = null;\n      detectionArmedRef.current = false;\n      frameCountRef.current = 0;\n    }\n    return () => {\n      if (detectionArmTimerRef.current) {\n        clearTimeout(detectionArmTimerRef.current);\n        detectionArmTimerRef.current = null;\n      }\n      detectionArmedRef.current = false;\n      frameCountRef.current = 0;\n    };\n  }, [effectiveStreaming, manualOnly]);\n\n  // Enumerate devices on mount and when devices change so USB webcams appear quickly\n  useEffect(() => {\n    let mounted = true;\n    async function refresh() {\n      try {\n        if (!navigator?.mediaDevices?.enumerateDevices) return;\n        const list = await navigator.mediaDevices.enumerateDevices();\n        if (!mounted) return;\n        setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\n      } catch (err) {\n        console.warn(\"[CAMERA] enumerateDevices failed:\", err);\n      }\n    }\n    refresh();\n    try {\n      navigator.mediaDevices.addEventListener(\"devicechange\", refresh);\n    } catch {\n      try {\n        (navigator.mediaDevices as any).ondevicechange = refresh;\n      } catch {}\n    }\n    return () => {\n      mounted = false;\n      try {\n        navigator.mediaDevices.removeEventListener(\"devicechange\", refresh);\n      } catch {}\n    };\n  }, []);\n\n  // Allow parent to open/close the manual modal via global events\n  useEffect(() => {\n    const onOpen = () => {\n      setActiveTab(\"manual\");\n      setShowManualModal(true);\n    };\n    const onClose = () => {\n      setActiveTab(\"auto\");\n      setShowManualModal(false);\n    };\n    window.addEventListener(\"ndn:open-manual\" as any, onOpen);\n    window.addEventListener(\"ndn:close-manual\" as any, onClose);\n    return () => {\n      window.removeEventListener(\"ndn:open-manual\" as any, onOpen);\n      window.removeEventListener(\"ndn:close-manual\" as any, onClose);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (manualOnly) {\n      setActiveTab(\"manual\");\n      setShowAutoModal(false);\n    }\n  }, [manualOnly]);\n\n  // Reset open state at the start of a leg (no darts thrown yet), keep across visits within leg\n  useEffect(() => {\n    try {\n      const p = matchState.players[matchState.currentPlayerIdx];\n      const leg = p?.legs?.[p.legs.length - 1];\n      if (!p) return;\n      if (!leg || leg.dartsThrown === 0) {\n        setOpenedById((m) => ({ ...m, [p.id]: false }));\n      }\n    } catch {}\n  }, [\n    matchState.currentPlayerIdx,\n    matchState.players?.[matchState.currentPlayerIdx]?.legs?.length,\n  ]);\n\n  // Manage per-dart timer lifecycle\n  useEffect(() => {\n    const shouldRun =\n      !!dartTimerEnabled && inProgress && !paused && pendingDarts < 3;\n    // Clear any existing interval\n    if (timerRef.current) {\n      clearInterval(timerRef.current as any);\n      timerRef.current = null;\n    }\n    if (!shouldRun) {\n      setDartTimeLeft(null);\n      return;\n    }\n    // Reset timer each time dependencies change (new dart, player change, setting change)\n    setDartTimeLeft(dartTimerSeconds);\n    timerRef.current = window.setInterval(() => {\n      setDartTimeLeft((prev) => {\n        const next = (prev ?? dartTimerSeconds) - 1;\n        if (next <= 0) {\n          // Time expired: record a MISS and reset will occur via pendingEntries change\n          try {\n            addDart(0, \"MISS 0\", \"MISS\");\n          } catch {}\n          // Stop interval until effect re-initializes on state change\n          if (timerRef.current) {\n            clearInterval(timerRef.current as any);\n            timerRef.current = null;\n          }\n          return 0;\n        }\n        return next;\n      });\n    }, 1000) as any;\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current as any);\n        timerRef.current = null;\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    dartTimerEnabled,\n    dartTimerSeconds,\n    pendingDarts,\n    matchState.currentPlayerIdx,\n    (matchState as any)?.inProgress,\n    paused,\n  ]);\n\n  // Drive a lightweight live preview inside the manual modal from the main video element\n  useEffect(() => {\n    if (!showManualModal) return;\n    const id = setInterval(() => {\n      try {\n        const v = videoRef.current;\n        const c = manualPreviewRef.current;\n        if (!v || !c) return;\n        const vw = v.videoWidth || 0;\n        const vh = v.videoHeight || 0;\n        if (!vw || !vh) return;\n        const cw = c.clientWidth || 640;\n        const ch = c.clientHeight || 360;\n        // Set backing size to match display for crisp rendering\n        if (c.width !== cw) c.width = cw;\n        if (c.height !== ch) c.height = ch;\n        const ctx = c.getContext(\"2d\");\n        if (!ctx) return;\n        ctx.imageSmoothingEnabled = true;\n        // Letterbox fit\n        const scale = Math.min(cw / vw, ch / vh);\n        const dw = Math.round(vw * scale);\n        const dh = Math.round(vh * scale);\n        const dx = Math.floor((cw - dw) / 2);\n        const dy = Math.floor((ch - dh) / 2);\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, cw, ch);\n        ctx.drawImage(v, dx, dy, dw, dh);\n      } catch (e) {\n        // Silently ignore preview update errors\n        console.warn(\"Manual preview update error:\", e);\n      }\n    }, 120);\n    return () => clearInterval(id);\n  }, [showManualModal]);\n\n  useEffect(() => {\n    return () => stopCamera();\n  }, []);\n\n  const canFallbackToLocal = isPhoneCamera && !phoneFeedActive;\n\n  async function startCamera() {\n    if (cameraStarting || streaming) return;\n\n    // Only skip local startup when the phone feed is actively streaming\n    if (isPhoneCamera && phoneFeedActive) {\n      dlog(\"[CAMERA] Phone camera stream active - leaving local camera idle\");\n      setCameraStarting(false);\n      return;\n    }\n\n    setCameraStarting(true);\n    dlog(\"[CAMERA] Starting camera...\");\n    try {\n      // If a preferred camera is set, request it; otherwise default to back camera on mobile\n      const constraints: MediaStreamConstraints = preferredCameraId\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false }\n        : { video: { facingMode: \"environment\" }, audio: false }; // Prefer back camera on mobile\n      dlog(\"[CAMERA] Using constraints:\", constraints);\n      let stream: MediaStream;\n      try {\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\n        dlog(\"[CAMERA] Got stream:\", !!stream);\n      } catch (err: any) {\n        console.warn(\"[CAMERA] First attempt failed:\", err);\n        // Fallback if specific device isn't available or facingMode not supported\n        const name = (err && (err.name || err.code)) || \"\";\n        if (\n          preferredCameraId &&\n          (name === \"OverconstrainedError\" || name === \"NotFoundError\")\n        ) {\n          dlog(\"[CAMERA] Trying fallback without deviceId\");\n          stream = await navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: false,\n          });\n        } else if (\n          !preferredCameraId &&\n          (name === \"OverconstrainedError\" ||\n            name === \"NotFoundError\" ||\n            name === \"NotSupportedError\")\n        ) {\n          dlog(\"[CAMERA] Trying fallback for facingMode not supported\");\n          // Fallback for devices that don't support facingMode\n          stream = await navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: false,\n          });\n        } else {\n          throw err;\n        }\n      }\n      if (videoRef.current) {\n        dlog(\"[CAMERA] Setting stream to video element\");\n        videoRef.current.srcObject = stream;\n        dlog(\n          \"[CAMERA] Stream tracks:\",\n          stream.getTracks().length,\n          \"video tracks:\",\n          stream.getVideoTracks().length,\n        );\n        // Add event listeners for debugging\n        videoRef.current.addEventListener(\"loadeddata\", () =>\n          dlog(\"[CAMERA] Video loadeddata\"),\n        );\n        videoRef.current.addEventListener(\"canplay\", () =>\n          dlog(\"[CAMERA] Video canplay\"),\n        );\n        videoRef.current.addEventListener(\"play\", () =>\n          dlog(\"[CAMERA] Video started playing\"),\n        );\n        videoRef.current.addEventListener(\"error\", (e) =>\n          console.error(\"[CAMERA] Video error:\", e),\n        );\n        try {\n          videoRef.current.play();\n          dlog(\"[CAMERA] Play called successfully\");\n        } catch (playErr) {\n          console.error(\"[CAMERA] Video play failed:\", playErr);\n          // Try again after a short delay\n          setTimeout(() => {\n            try {\n              videoRef.current?.play();\n              dlog(\"[CAMERA] Retry play called\");\n            } catch (retryErr) {\n              console.error(\"[CAMERA] Retry play failed:\", retryErr);\n            }\n          }, 100);\n        }\n        try {\n          cameraSession.setVideoElementRef?.(videoRef.current);\n          cameraSession.setMediaStream?.(stream);\n          cameraSession.setMode?.(\"local\");\n          cameraSession.setStreaming?.(true);\n        } catch (err) {\n          console.warn(\n            \"[CAMERA] Failed to sync camera session with local stream:\",\n            err,\n          );\n        }\n      } else {\n        console.error(\"[CAMERA] Video element not found\");\n      }\n      setStreaming(true);\n      // Capture device list for inline picker - no automatic preference updates\n      try {\n        const list = await navigator.mediaDevices.enumerateDevices();\n        setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\n        dlog(\n          \"[CAMERA] Found cameras:\",\n          list.filter((d) => d.kind === \"videoinput\").length,\n        );\n      } catch (enumErr) {\n        console.warn(\"[CAMERA] Failed to enumerate devices:\", enumErr);\n      }\n    } catch (e) {\n      console.error(\"[CAMERA] Camera start failed:\", e);\n      alert(\"Camera permission denied or not available.\");\n    } finally {\n      setCameraStarting(false);\n    }\n  }\n\n  function stopCamera() {\n    if (videoRef.current && videoRef.current.srcObject) {\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks();\n      tracks.forEach((t) => t.stop());\n      videoRef.current.srcObject = null;\n      setStreaming(false);\n      setCameraStarting(false);\n    }\n  }\n\n  useEffect(() => {\n    const videoEl = videoRef.current;\n    if (!videoEl) return;\n    const sessionStream = cameraSession.getMediaStream?.() || null;\n    const sessionVideo = cameraSession.getVideoElementRef?.() || null;\n    const fallbackStream =\n      (sessionVideo?.srcObject as MediaStream | null) || null;\n    const activeStream = sessionStream || fallbackStream;\n    if (!activeStream) return;\n    if (videoEl.srcObject !== activeStream) {\n      videoEl.srcObject = activeStream;\n    }\n    videoEl.muted = true;\n    (videoEl as any).playsInline = true;\n    try {\n      videoEl.play?.();\n    } catch {}\n    if (!streaming) setStreaming(true);\n  }, [cameraSession.mode, cameraSession.isStreaming, streaming, cameraSession]);\n\n  function capture() {\n    try {\n      if (!canvasRef.current) return;\n      const primary = videoRef.current;\n      const sessionVideo = cameraSession.getVideoElementRef?.() || null;\n      const source =\n        primary && primary.videoWidth > 0 && primary.videoHeight > 0\n          ? primary\n          : sessionVideo || primary;\n      if (!source) return;\n      const video = source;\n      const canvas = canvasRef.current;\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      const ctx = canvas.getContext(\"2d\");\n      if (!ctx) return;\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      const url = canvas.toDataURL(\"image/png\");\n      setSnapshotUrl(url);\n    } catch (e) {\n      console.warn(\"Capture error:\", e);\n    }\n  }\n\n  // Inline light-weight device switcher (optional)\n  function CameraSelector() {\n    if (!availableCameras.length) return null;\n    return (\n      <div className=\"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs\">\n        <span>Cam:</span>\n        <select\n          className=\"bg-black/20 rounded px-1 py-0.5\"\n          value={preferredCameraId || \"\"}\n          onChange={async (e) => {\n            if (cameraStarting) return;\n            const id = e.target.value || undefined;\n            const label = availableCameras.find(\n              (d) => d.deviceId === id,\n            )?.label;\n            // This is a user-initiated change so force the preference even when locked\n            setPreferredCamera(id, label || \"\", true);\n            // Stop current camera and wait for cleanup\n            stopCamera();\n            // Small delay to ensure camera device is fully released\n            await new Promise((resolve) => setTimeout(resolve, 150));\n            try {\n              await startCamera();\n            } catch (err) {\n              console.warn(\"Failed to start camera after device switch:\", err);\n              // Try one more time after a longer delay\n              setTimeout(async () => {\n                try {\n                  await startCamera();\n                } catch (retryErr) {\n                  console.error(\"Camera switch failed after retry:\", retryErr);\n                  alert(\n                    \"Failed to switch camera. Please try again or refresh the page.\",\n                  );\n                }\n              }, 500);\n            }\n          }}\n        >\n          <option value=\"\">Auto</option>\n          {availableCameras.map((d) => (\n            <option key={d.deviceId} value={d.deviceId}>\n              {d.label ||\n                (d.deviceId ? `Camera (${d.deviceId.slice(0, 6)})` : \"Camera\")}\n            </option>\n          ))}\n        </select>\n        <button\n          className=\"btn btn--ghost btn-sm ml-2\"\n          onClick={async () => {\n            try {\n              // quick user-triggered rescan\n              const list = await navigator.mediaDevices.enumerateDevices();\n              setAvailableCameras(list.filter((d) => d.kind === \"videoinput\"));\n            } catch (err) {\n              console.warn(\"Rescan failed:\", err);\n              alert(\n                \"Failed to rescan devices. Ensure camera permissions are granted.\",\n              );\n            }\n          }}\n          title=\"Rescan connected cameras\"\n        >\n          Rescan\n        </button>\n      </div>\n    );\n  }\n\n  function drawOverlay() {\n    if (DISABLE_CAMERA_OVERLAY) {\n      if (overlayRef.current) {\n        const ctx = overlayRef.current.getContext(\"2d\");\n        if (ctx)\n          ctx.clearRect(\n            0,\n            0,\n            overlayRef.current.width,\n            overlayRef.current.height,\n          );\n      }\n      return;\n    }\n    try {\n      // Only render overlays when calibration data exists and the phone stream isn't providing the image\n      if (!overlayRef.current || !videoRef.current || !H || !imageSize) {\n        if (overlayRef.current) {\n          const ctx = overlayRef.current.getContext(\"2d\");\n          ctx?.clearRect(\n            0,\n            0,\n            overlayRef.current.width,\n            overlayRef.current.height,\n          );\n        }\n        return;\n      }\n      if (isPhoneCamera) return;\n      const o = overlayRef.current;\n      const v = videoRef.current;\n      const w = v.clientWidth;\n      const h = v.clientHeight;\n      o.width = w;\n      o.height = h;\n      const ctx = o.getContext(\"2d\");\n      if (!ctx) return;\n      ctx.clearRect(0, 0, w, h);\n      if (preferredCameraLocked || hideCameraOverlay) return;\n\n      // scale homography from calibration image size to current rendered size\n      const sx = w / imageSize.w;\n      const sy = h / imageSize.h;\n      const Hs = scaleHomography(H, sx, sy);\n      const rings = [\n        BoardRadii.bullInner,\n        BoardRadii.bullOuter,\n        BoardRadii.trebleInner,\n        BoardRadii.trebleOuter,\n        BoardRadii.doubleInner,\n        BoardRadii.doubleOuter,\n      ];\n      for (const r of rings) {\n        const poly = sampleRing(Hs, r, 720);\n        drawPolyline(\n          ctx,\n          poly,\n          r === BoardRadii.doubleOuter ? \"#22d3ee\" : \"#a78bfa\",\n          r === BoardRadii.doubleOuter ? 3 : 2,\n        );\n      }\n    } catch (e) {\n      // Silently ignore drawing errors to prevent re-render loops\n      console.warn(\"Overlay drawing error:\", e);\n    }\n  }\n\n  useEffect(() => {\n    if (manualOnly || DISABLE_CAMERA_OVERLAY) return;\n    const id = setInterval(drawOverlay, 250);\n    return () => clearInterval(id);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    H,\n    imageSize,\n    effectiveStreaming,\n    manualOnly,\n    isPhoneCamera,\n    preferredCameraLocked,\n    hideCameraOverlay,\n  ]);\n\n  // Built-in autoscore loop (offline/local CV)\n  useEffect(() => {\n    if (manualOnly) return;\n    if (autoscoreProvider !== \"built-in\") return;\n    // Choose source: local video element, or paired phone camera element\n    const cameraSession = useCameraSession.getState();\n    const isPhone =\n      useUserSettings.getState().preferredCameraLabel === \"Phone Camera\";\n    const sourceVideo: HTMLVideoElement | null = isPhone\n      ? cameraSession.getVideoElementRef?.() || null\n      : videoRef.current;\n    if (!sourceVideo) return;\n    if (!H || !imageSize) return;\n\n    let canceled = false;\n    const v = sourceVideo;\n    const proc = canvasRef.current;\n    if (!proc) return;\n\n    // Initialize or reset detector\n    if (!detectorRef.current) detectorRef.current = new DartDetector();\n\n    const tick = () => {\n      if (canceled) return;\n      try {\n        const vw = v.videoWidth || 0;\n        const vh = v.videoHeight || 0;\n        if (!vw || !vh) {\n          rafRef.current = requestAnimationFrame(tick);\n          return;\n        }\n        if (proc.width !== vw) proc.width = vw;\n        if (proc.height !== vh) proc.height = vh;\n        const ctx = proc.getContext(\"2d\", { willReadFrequently: true });\n        if (!ctx) {\n          rafRef.current = requestAnimationFrame(tick);\n          return;\n        }\n        ctx.drawImage(v, 0, 0, vw, vh);\n        const frame = ctx.getImageData(0, 0, vw, vh);\n\n        frameCountRef.current++;\n\n        // Seed ROI from calibration homography (board center + double radius along X)\n        const cImg = applyHomography(H, { x: 0, y: 0 });\n        const rImg = applyHomography(H, { x: BoardRadii.doubleOuter, y: 0 });\n        // Scale calibration image coordinates to current video size\n        const sx = vw / imageSize.w;\n        const sy = vh / imageSize.h;\n        const cx = cImg.x * sx;\n        const cy = cImg.y * sy;\n        const rx = rImg.x * sx;\n        const ry = rImg.y * sy;\n        const roiR = Math.hypot(rx - cx, ry - cy) * 1.08;\n\n        const detector = detectorRef.current!;\n        if (detectorSeedVersion >= 0) {\n          detector.setROI(\n            cx,\n            cy,\n            Math.max(24, Math.min(Math.max(vw, vh), roiR)),\n          );\n        }\n\n        // Try to detect a new dart when not paused and visit has room\n        if (\n          !paused &&\n          pendingDarts < 3 &&\n          detectionArmedRef.current &&\n          frameCountRef.current > 150\n        ) {\n          const det = detector.detect(frame);\n          const nowPerf = performance.now();\n          if (\n            autoCandidateRef.current &&\n            nowPerf - autoCandidateRef.current.firstTs > 900\n          ) {\n            autoCandidateRef.current = null;\n          }\n          if (det && det.confidence >= AUTO_COMMIT_CONFIDENCE) {\n            const warmupActive =\n              streamingStartMsRef.current > 0 &&\n              nowPerf - streamingStartMsRef.current < AUTO_STREAM_IGNORE_MS;\n            // Refine tip on gradients\n            const tipRefined = refinePointSobel(proc, det.tip, 6);\n            // Map to calibration image space before scoring\n            const pCal = { x: tipRefined.x / sx, y: tipRefined.y / sy };\n            const score = scoreFromImagePoint(H, pCal);\n            const ring = score.ring as Ring;\n            const value = score.base;\n            const label = `${ring} ${value > 0 ? value : \"\"}`.trim();\n            const sector = (score.sector ?? null) as number | null;\n            const mult = Math.max(0, Number(score.mult) || 0) as 0 | 1 | 2 | 3;\n            let shouldAccept = false;\n\n            setLastAutoScore(label);\n            setLastAutoValue(value);\n            setLastAutoRing(ring);\n\n            const applyAutoHit = (candidate: AutoCandidate) => {\n              if (candidate.value > 0) {\n                setHadRecentAuto(true);\n                setPulseManualPill(true);\n                try {\n                  if (pulseTimeoutRef.current)\n                    clearTimeout(pulseTimeoutRef.current);\n                } catch {}\n                pulseTimeoutRef.current = window.setTimeout(() => {\n                  setPulseManualPill(false);\n                  pulseTimeoutRef.current = null;\n                }, 1500);\n                try {\n                  addDart(candidate.value, candidate.label, candidate.ring);\n                } catch {}\n              } else {\n                setHadRecentAuto(false);\n              }\n              try {\n                if (onAutoDart)\n                  onAutoDart(candidate.value, candidate.ring, {\n                    sector: candidate.sector,\n                    mult: candidate.mult,\n                  });\n              } catch {}\n            };\n\n            if (!warmupActive) {\n              if (ring === \"MISS\" || value <= 0) {\n                autoCandidateRef.current = null;\n                setHadRecentAuto(false);\n                try {\n                  if (onAutoDart) onAutoDart(value, ring, { sector, mult });\n                } catch {}\n                shouldAccept = true;\n              } else {\n                const existing = autoCandidateRef.current;\n                if (\n                  !existing ||\n                  existing.value !== value ||\n                  existing.ring !== ring\n                ) {\n                  autoCandidateRef.current = {\n                    value,\n                    ring,\n                    label,\n                    sector,\n                    mult,\n                    firstTs: nowPerf,\n                    frames: 1,\n                  };\n                } else {\n                  autoCandidateRef.current = {\n                    ...existing,\n                    label,\n                    frames: existing.frames + 1,\n                  };\n                }\n                const current = autoCandidateRef.current!;\n                const holdMs = nowPerf - current.firstTs;\n                const ready =\n                  current.frames >= AUTO_COMMIT_MIN_FRAMES ||\n                  holdMs >= AUTO_COMMIT_HOLD_MS;\n                const cooled =\n                  nowPerf - lastAutoCommitRef.current >=\n                  AUTO_COMMIT_COOLDOWN_MS;\n                if (ready && cooled) {\n                  applyAutoHit(current);\n                  autoCandidateRef.current = null;\n                  lastAutoCommitRef.current = nowPerf;\n                  shouldAccept = true;\n                }\n              }\n            } else {\n              autoCandidateRef.current = null;\n              shouldAccept = true;\n            }\n\n            captureDetectionLog({\n              ts: nowPerf,\n              label,\n              value,\n              ring,\n              confidence: det.confidence,\n              ready: shouldAccept,\n              accepted: shouldAccept && value > 0 && ring !== \"MISS\",\n              warmup: warmupActive,\n            });\n\n            // Draw debug tip and shaft axis on overlay (scaled to overlay canvas)\n            try {\n              const drawOverlayHint = value > 0 && ring !== \"MISS\";\n              if (drawOverlayHint) {\n                const o = overlayRef.current;\n                if (o) {\n                  const octx = o.getContext(\"2d\");\n                  if (octx) {\n                    // Maintain overlay size and clear a small area\n                    const ox = (tipRefined.x / vw) * o.width;\n                    const oy = (tipRefined.y / vh) * o.height;\n                    octx.save();\n                    octx.beginPath();\n                    octx.strokeStyle = \"#f59e0b\";\n                    octx.lineWidth = 2;\n                    octx.arc(ox, oy, 6, 0, Math.PI * 2);\n                    octx.stroke();\n                    // axis line if available\n                    if ((det as any).axis) {\n                      const ax = (det as any).axis;\n                      const ax1 = (ax.x1 / vw) * o.width;\n                      const ay1 = (ax.y1 / vh) * o.height;\n                      const ax2 = (ax.x2 / vw) * o.width;\n                      const ay2 = (ax.y2 / vh) * o.height;\n                      octx.beginPath();\n                      octx.moveTo(ax1, ay1);\n                      octx.lineTo(ax2, ay2);\n                      octx.stroke();\n                    }\n                    // bbox\n                    if ((det as any).bbox) {\n                      const bx = ((det as any).bbox.x / vw) * o.width;\n                      const by = ((det as any).bbox.y / vh) * o.height;\n                      const bw = ((det as any).bbox.w / vw) * o.width;\n                      const bh = ((det as any).bbox.h / vh) * o.height;\n                      octx.strokeStyle = \"#22d3ee\";\n                      octx.strokeRect(bx, by, bw, bh);\n                    }\n                    octx.restore();\n                  }\n                }\n              }\n            } catch {}\n\n            if (shouldAccept) {\n              detector.accept(frame, det);\n            }\n          } else {\n            if (\n              autoCandidateRef.current &&\n              nowPerf - autoCandidateRef.current.firstTs > 800\n            ) {\n              autoCandidateRef.current = null;\n            }\n          }\n        }\n      } catch (e) {\n        // Soft-fail; continue next frame\n        // console.warn('Autoscore tick error:', e)\n      }\n      rafRef.current = requestAnimationFrame(tick);\n    };\n\n    rafRef.current = requestAnimationFrame(tick);\n    return () => {\n      canceled = true;\n      if (rafRef.current) cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    manualOnly,\n    autoscoreProvider,\n    effectiveStreaming,\n    H,\n    imageSize,\n    paused,\n    pendingDarts,\n    detectorSeedVersion,\n    captureDetectionLog,\n  ]);\n\n  const handleUseLocalCamera = useCallback(async () => {\n    try {\n      if (isPhoneCamera) {\n        const fallback = availableCameras.find((c) => c.kind === \"videoinput\");\n        if (fallback) {\n          setPreferredCamera(fallback.deviceId, fallback.label || \"\", true);\n        } else {\n          setPreferredCamera(undefined, \"\", true);\n        }\n      }\n      await startCamera();\n    } catch (err) {\n      console.warn(\"[CameraView] Local camera fallback failed:\", err);\n    }\n  }, [availableCameras, isPhoneCamera, setPreferredCamera]);\n\n  // Update calibration audit status whenever homography or image size changes\n  useEffect(() => {\n    try {\n      useAudit\n        .getState()\n        .setCalibrationStatus({ hasHomography: !!H, imageSize });\n    } catch {}\n  }, [H, imageSize]);\n\n  // External autoscore subscription\n  useEffect(() => {\n    if (autoscoreProvider !== \"external-ws\" || !autoscoreWsUrl) return;\n    const sub = subscribeExternalWS(autoscoreWsUrl, (d) => {\n      if (\n        !detectionArmedRef.current ||\n        performance.now() - streamingStartMsRef.current < 5000\n      )\n        return;\n      // Prefer parent hook if provided; otherwise add to visit directly\n      if (onAutoDart) {\n        try {\n          onAutoDart(d.value, d.ring as any, {\n            sector: d.sector ?? null,\n            mult: (d.mult as any) ?? 0,\n          });\n        } catch {}\n        try {\n          addHeatSample({\n            playerId:\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\n            sector: d.sector ?? null,\n            mult: (d.mult as any) ?? 0,\n            ring: d.ring as any,\n            ts: Date.now(),\n          });\n        } catch {}\n      } else {\n        const label =\n          d.ring === \"INNER_BULL\"\n            ? \"INNER_BULL 50\"\n            : d.ring === \"BULL\"\n              ? \"BULL 25\"\n              : `${d.ring[0]}${d.value / (d.mult || 1) || d.value} ${d.value}`;\n        addDart(d.value, label, d.ring as any);\n        try {\n          addHeatSample({\n            playerId:\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\n            sector: d.sector ?? null,\n            mult: (d.mult as any) ?? 0,\n            ring: d.ring as any,\n            ts: Date.now(),\n          });\n        } catch {}\n      }\n    });\n    return () => sub.close();\n  }, [autoscoreProvider, autoscoreWsUrl]);\n\n  function onOverlayClick(e: React.MouseEvent<HTMLCanvasElement>) {\n    if (!overlayRef.current || !H || !imageSize) return;\n    const rect = overlayRef.current.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    // Map to calibration coordinate space by reversing the display scaling\n    const sx = overlayRef.current.width / imageSize.w;\n    const sy = overlayRef.current.height / imageSize.h;\n    const pCal: Point = { x: x / sx, y: y / sy };\n    const score = scoreFromImagePoint(H, pCal);\n    const s = `${score.ring} ${score.base > 0 ? score.base : \"\"}`.trim();\n    setLastAutoScore(s);\n    setLastAutoValue(score.base);\n    setLastAutoRing(score.ring as Ring);\n    setHadRecentAuto(true);\n    // Optional immediate commit hook (e.g., Double Practice)\n    try {\n      if (immediateAutoCommit && onAutoDart) {\n        onAutoDart(score.base, score.ring as Ring, {\n          sector: score.sector,\n          mult: score.mult,\n        });\n        try {\n          addHeatSample({\n            playerId:\n              matchState.players[matchState.currentPlayerIdx]?.id ?? null,\n            sector: score.sector ?? null,\n            mult: score.mult ?? 0,\n            ring: score.ring as any,\n            ts: Date.now(),\n          });\n        } catch {}\n        setHadRecentAuto(false);\n      }\n    } catch {}\n  }\n\n  function parseManual(\n    input: string,\n  ): { label: string; value: number; ring: Ring } | null {\n    const t = input.trim().toUpperCase();\n    if (!t) return null;\n    const bull = t === \"BULL\" || t === \"50\" || t === \"DBULL\" || t === \"IBULL\";\n    const outerBull = t === \"25\" || t === \"OBULL\";\n    if (bull) return { label: \"INNER_BULL 50\", value: 50, ring: \"INNER_BULL\" };\n    if (outerBull) return { label: \"BULL 25\", value: 25, ring: \"BULL\" };\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\n    if (!m) return null;\n    const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\n    const num = parseInt(m[2], 10);\n    if (num < 1 || num > 20) return null;\n    const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\n    const ring: Ring =\n      mult === \"S\" ? \"SINGLE\" : mult === \"D\" ? \"DOUBLE\" : \"TRIPLE\";\n    return {\n      label: `${mult}${num} ${num * multVal}`,\n      value: num * multVal,\n      ring,\n    };\n  }\n\n  function getCurrentRemaining(): number {\n    const s = matchState;\n    if (!s.players.length) return s.startingScore;\n    const p = s.players[s.currentPlayerIdx];\n    const leg = p.legs[p.legs.length - 1];\n    if (!leg) return s.startingScore;\n    return leg.totalScoreRemaining;\n  }\n\n  function addDart(value: number, label: string, ring: Ring) {\n    if (shouldDeferCommit && awaitingClear) {\n      if (!pulseManualPill) {\n        setPulseManualPill(true);\n        try {\n          if (pulseTimeoutRef.current) clearTimeout(pulseTimeoutRef.current);\n        } catch {}\n        pulseTimeoutRef.current = window.setTimeout(() => {\n          setPulseManualPill(false);\n          pulseTimeoutRef.current = null;\n        }, 1200);\n      }\n      return;\n    }\n    // In generic mode, delegate to parent without X01 bust/finish rules\n    if (scoringMode === \"custom\") {\n      if (onGenericDart)\n        try {\n          onGenericDart(value, ring, { label });\n        } catch {}\n      // Maintain a lightweight pending list for UI only\n      if (pendingDarts >= 3) {\n        // Rotate to next visit locally so we don't drop darts visually\n        setPendingDarts(1);\n        setPendingScore(value);\n        setPendingEntries([{ label, value, ring }]);\n        return;\n      }\n      const newDarts = pendingDarts + 1;\n      setPendingDarts(newDarts);\n      setPendingScore((s) => s + value);\n      setPendingEntries((e) => [...e, { label, value, ring }]);\n      return;\n    }\n\n    // If a new dart arrives while 3 are pending, auto-commit previous visit and start a new one\n    if (pendingDarts >= 3) {\n      const previousScore = pendingScore;\n      const previousDarts = pendingDarts;\n      // Commit previous full visit\n      callAddVisit(previousScore, previousDarts, {\n        preOpenDarts: pendingPreOpenDarts || 0,\n        doubleWindowDarts: pendingDartsAtDouble || 0,\n        finishedByDouble: false,\n        visitTotal: previousScore,\n      });\n      try {\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\n        if (name) addSample(name, previousDarts, previousScore);\n      } catch {}\n      // Start next visit with this dart\n      const willCount =\n        !x01DoubleIn || isOpened || ring === \"DOUBLE\" || ring === \"INNER_BULL\";\n      const applied = willCount ? value : 0;\n      setPendingDarts(1);\n      setPendingScore(applied);\n      setPendingEntries([{ label, value: applied, ring }]);\n      setPendingPreOpenDarts(willCount ? 0 : 1);\n      setPendingDartsAtDouble(0);\n      if (\n        x01DoubleIn &&\n        !isOpened &&\n        (ring === \"DOUBLE\" || ring === \"INNER_BULL\")\n      ) {\n        setOpened(true);\n      }\n      enqueueVisitCommit({\n        score: previousScore,\n        darts: previousDarts,\n        finished: false,\n      });\n      return;\n    }\n    const newDarts = pendingDarts + 1;\n    // Apply X01 Double-In rule before scoring if enabled and not opened yet\n    const countsForScore =\n      !x01DoubleIn || isOpened || ring === \"DOUBLE\" || ring === \"INNER_BULL\";\n    const appliedValue = countsForScore ? value : 0;\n    if (\n      x01DoubleIn &&\n      !isOpened &&\n      (ring === \"DOUBLE\" || ring === \"INNER_BULL\")\n    ) {\n      setOpened(true);\n    }\n    const newScore = pendingScore + appliedValue;\n    const remaining = getCurrentRemaining();\n    const after = remaining - newScore;\n\n    // Bust conditions (double-out): negative or 1, or 0 without double/inner bull\n    const isFinish =\n      after === 0 && (ring === \"DOUBLE\" || ring === \"INNER_BULL\");\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish);\n\n    if (isBust) {\n      // Commit bust visit: 0 score, darts thrown so far including this one\n      const preOpenThis =\n        x01DoubleIn &&\n        !isOpened &&\n        !(ring === \"DOUBLE\" || ring === \"INNER_BULL\")\n          ? 1\n          : 0;\n      const preOpenTotal = (pendingPreOpenDarts || 0) + preOpenThis;\n      // Count attempts in double-out window\n      const postAfter = after;\n      const postBefore = after + appliedValue;\n      const attemptsThisDart =\n        (postBefore > 50 && postAfter <= 50) || postBefore <= 50 ? 1 : 0;\n      const attemptsTotal = (pendingDartsAtDouble || 0) + attemptsThisDart;\n      callAddVisit(0, newDarts, {\n        preOpenDarts: preOpenTotal,\n        doubleWindowDarts: attemptsTotal,\n        finishedByDouble: false,\n        visitTotal: 0,\n      });\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      setPendingPreOpenDarts(0);\n      setPendingDartsAtDouble(0);\n      enqueueVisitCommit({ score: 0, darts: newDarts, finished: false });\n      return;\n    }\n\n    // Normal add (value may be zero if not opened yet)\n    setPendingDarts(newDarts);\n    setPendingScore(newScore);\n    setPendingEntries((e) => [...e, { label, value: appliedValue, ring }]);\n    if (\n      x01DoubleIn &&\n      !isOpened &&\n      !(ring === \"DOUBLE\" || ring === \"INNER_BULL\")\n    ) {\n      setPendingPreOpenDarts((n) => (n || 0) + 1);\n    }\n    // Track double-out attempts within this visit\n    {\n      const postAfter = after;\n      const postBefore = after + appliedValue;\n      const countThisDart =\n        (postBefore > 50 && postAfter <= 50) || postBefore <= 50;\n      if (countThisDart) setPendingDartsAtDouble((c) => (c || 0) + 1);\n    }\n\n    if (isFinish) {\n      // Commit visit with current total and end leg\n      callAddVisit(newScore, newDarts, {\n        preOpenDarts: pendingPreOpenDarts || 0,\n        doubleWindowDarts: pendingDartsAtDouble || 0,\n        finishedByDouble: true,\n        visitTotal: newScore,\n      });\n      callEndLeg(newScore);\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      setPendingPreOpenDarts(0);\n      setPendingDartsAtDouble(0);\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: true });\n      return;\n    }\n\n    if (newDarts >= 3) {\n      callAddVisit(newScore, newDarts, {\n        preOpenDarts: pendingPreOpenDarts || 0,\n        doubleWindowDarts: pendingDartsAtDouble || 0,\n        finishedByDouble: false,\n        visitTotal: newScore,\n      });\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      setPendingPreOpenDarts(0);\n      setPendingDartsAtDouble(0);\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: false });\n    }\n  }\n\n  function onAddAutoDart() {\n    if (shouldDeferCommit && awaitingClear) return;\n    if (lastAutoScore) {\n      if (onAutoDart) {\n        try {\n          onAutoDart(lastAutoValue, lastAutoRing, undefined);\n        } catch {}\n      } else {\n        addDart(lastAutoValue, lastAutoScore, lastAutoRing);\n      }\n      setNonRegCount(0);\n      setHadRecentAuto(false);\n    }\n  }\n\n  function onApplyManual() {\n    if (shouldDeferCommit && awaitingClear) return;\n    const parsed = parseManual(manualScore);\n    if (!parsed) {\n      alert(\"Enter like T20, D16, 5, 25, 50\");\n      return;\n    }\n    // If autoscore didn't register recently, count toward recalibration\n    if (\n      !hadRecentAuto ||\n      !lastAutoScore ||\n      lastAutoRing === \"MISS\" ||\n      lastAutoValue === 0\n    ) {\n      const c = nonRegCount + 1;\n      setNonRegCount(c);\n      if (c >= 5) setShowRecalModal(true);\n    } else {\n      setNonRegCount(0);\n    }\n    addDart(parsed.value, parsed.label, parsed.ring);\n    setManualScore(\"\");\n    setHadRecentAuto(false);\n  }\n\n  // Replace the last pending dart with a manually typed correction\n  function onReplaceManual() {\n    if (shouldDeferCommit && awaitingClear) return;\n    const parsed = parseManual(manualScore);\n    if (!parsed) {\n      alert(\"Enter like T20, D16, 5, 25, 50\");\n      return;\n    }\n    if (pendingDarts === 0 || pendingEntries.length === 0) {\n      onApplyManual();\n      return;\n    }\n    if (scoringMode === \"custom\") {\n      // Let parent handle replacement semantics\n      if (\n        !hadRecentAuto ||\n        !lastAutoScore ||\n        lastAutoRing === \"MISS\" ||\n        lastAutoValue === 0\n      ) {\n        const c = nonRegCount + 1;\n        setNonRegCount(c);\n        if (c >= 5) setShowRecalModal(true);\n      } else setNonRegCount(0);\n\n      // Update local pending UI\n      setPendingEntries((e) => [\n        ...e.slice(0, -1),\n        { label: parsed.label, value: parsed.value, ring: parsed.ring },\n      ]);\n      if (onGenericReplace)\n        try {\n          onGenericReplace(parsed.value, parsed.ring, { label: parsed.label });\n        } catch {}\n      setManualScore(\"\");\n      setHadRecentAuto(false);\n      return;\n    }\n    if (\n      !hadRecentAuto ||\n      !lastAutoScore ||\n      lastAutoRing === \"MISS\" ||\n      lastAutoValue === 0\n    ) {\n      const c = nonRegCount + 1;\n      setNonRegCount(c);\n      if (c >= 5) setShowRecalModal(true);\n    } else setNonRegCount(0);\n\n    const last = pendingEntries[pendingEntries.length - 1];\n    const prevDarts = pendingDarts - 1;\n    const prevScore = pendingScore - (last?.value || 0);\n    const remaining = getCurrentRemaining();\n    const newScore = prevScore + parsed.value;\n    const newDarts = prevDarts + 1;\n    const after = remaining - newScore;\n    const isFinish =\n      after === 0 && (parsed.ring === \"DOUBLE\" || parsed.ring === \"INNER_BULL\");\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish);\n\n    if (isBust) {\n      callAddVisit(0, newDarts);\n      try {\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\n        if (name) addSample(name, newDarts, 0);\n      } catch {}\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      enqueueVisitCommit({ score: 0, darts: newDarts, finished: false });\n      setManualScore(\"\");\n      setHadRecentAuto(false);\n      return;\n    }\n\n    setPendingDarts(newDarts);\n    setPendingScore(newScore);\n    setPendingEntries((e) => [\n      ...e.slice(0, -1),\n      { label: parsed.label, value: parsed.value, ring: parsed.ring },\n    ]);\n\n    if (isFinish) {\n      callAddVisit(newScore, newDarts);\n      callEndLeg(newScore);\n      try {\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\n        if (name) addSample(name, newDarts, newScore);\n      } catch {}\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: true });\n      setManualScore(\"\");\n      setHadRecentAuto(false);\n      return;\n    }\n\n    if (newDarts >= 3) {\n      callAddVisit(newScore, newDarts);\n      try {\n        const name = matchState.players[matchState.currentPlayerIdx]?.name;\n        if (name) addSample(name, newDarts, newScore);\n      } catch {}\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      enqueueVisitCommit({ score: newScore, darts: newDarts, finished: false });\n    }\n    setManualScore(\"\");\n    setHadRecentAuto(false);\n  }\n\n  function onRecalibrateNow() {\n    setShowRecalModal(false);\n    setNonRegCount(0);\n    // Ask App to switch to calibrate tab\n    try {\n      window.dispatchEvent(new CustomEvent(\"ndn:request-calibrate\"));\n    } catch {}\n  }\n\n  function onResetCalibration() {\n    resetCalibration();\n    setShowRecalModal(false);\n    setNonRegCount(0);\n  }\n\n  // Keyboard shortcut: press 'm' to open Manual Correction (if not typing in an input)\n  useEffect(() => {\n    function onKey(e: KeyboardEvent) {\n      try {\n        const active = document.activeElement as HTMLElement | null;\n        const tag = active?.tagName?.toLowerCase();\n        if (e.key === \"m\" && tag !== \"input\" && tag !== \"textarea\") {\n          setActiveTab(\"manual\");\n          setShowManualModal(true);\n        }\n      } catch {}\n    }\n    window.addEventListener(\"keydown\", onKey);\n    return () => window.removeEventListener(\"keydown\", onKey);\n  }, []);\n\n  // Centralized quick-entry handler for S/D/T 1-20 buttons\n  function onQuickEntry(num: number, mult: \"S\" | \"D\" | \"T\") {\n    if (pendingDarts >= 3 || (shouldDeferCommit && awaitingClear)) return;\n    const val = num * (mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3);\n    const ring: Ring =\n      mult === \"S\" ? \"SINGLE\" : mult === \"D\" ? \"DOUBLE\" : \"TRIPLE\";\n    // If autoscore didn't register recently, count toward recalibration\n    if (\n      !hadRecentAuto ||\n      !lastAutoScore ||\n      lastAutoRing === \"MISS\" ||\n      lastAutoValue === 0\n    ) {\n      const c = nonRegCount + 1;\n      setNonRegCount(c);\n      if (c >= 5) setShowRecalModal(true);\n    } else {\n      setNonRegCount(0);\n    }\n    addDart(val, `${mult}${num} ${val}`, ring);\n    setHadRecentAuto(false);\n  }\n\n  function onUndoDart() {\n    if (pendingDarts === 0) return;\n    const last = pendingEntries[pendingEntries.length - 1];\n    setPendingDarts((d) => d - 1);\n    setPendingScore((s) => s - (last?.value || 0));\n    setPendingEntries((e) => e.slice(0, -1));\n  }\n\n  function onCommitVisit() {\n    if (pendingDarts === 0 || (shouldDeferCommit && awaitingClear)) return;\n    if (scoringMode === \"custom\") {\n      // For custom mode, simply clear local pending (parent maintains its own scoring)\n      setPendingDarts(0);\n      setPendingScore(0);\n      setPendingEntries([]);\n      return;\n    }\n    const visitScore = pendingScore;\n    const visitDarts = pendingDarts;\n    callAddVisit(visitScore, visitDarts);\n    try {\n      const name = matchState.players[matchState.currentPlayerIdx]?.name;\n      if (name) addSample(name, visitDarts, visitScore);\n    } catch {}\n    setPendingDarts(0);\n    setPendingScore(0);\n    setPendingEntries([]);\n    enqueueVisitCommit({\n      score: visitScore,\n      darts: visitDarts,\n      finished: false,\n    });\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n      {/* Pills (optional; can be hidden and controlled by parent) */}\n      {showToolbar && (\n        <div className=\"lg:col-span-2\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            {!manualOnly && (\n              <button\n                className={`btn px-3 py-1 text-sm ${activeTab === \"auto\" ? \"tab--active\" : \"\"}`}\n                onClick={() => {\n                  setActiveTab(\"auto\");\n                  setShowManualModal(false);\n                  setShowAutoModal(true);\n                }}\n              >\n                Autoscore\n              </button>\n            )}\n            <button\n              className={`btn px-3 py-1 text-sm ${activeTab === \"manual\" ? \"tab--active\" : \"\"}`}\n              onClick={() => {\n                setActiveTab(\"manual\");\n                setShowManualModal(true);\n              }}\n              title=\"Open Manual Correction\"\n            >\n              Manual Correction\n            </button>\n            {manualOnly && (\n              <span className=\"text-xs opacity-70\">\n                Manual scoring mode active\n              </span>\n            )}\n          </div>\n        </div>\n      )}\n      {!hideInlinePanels && !manualOnly ? (\n        <div className=\"card relative camera-fullwidth-card lg:col-span-2\">\n          <h2 className=\"text-xl font-semibold mb-3\">Camera</h2>\n          <ResizablePanel\n            storageKey=\"ndn:camera:size\"\n            className=\"relative rounded-2xl overflow-hidden bg-black\"\n            defaultWidth={480}\n            defaultHeight={360}\n            minWidth={360}\n            minHeight={270}\n            maxWidth={800}\n            maxHeight={600}\n            autoFill\n          >\n            <CameraSelector />\n            {(() => {\n              const aspect =\n                cameraAspect ||\n                useUserSettings.getState().cameraAspect ||\n                \"wide\";\n              const fit =\n                (cameraFitMode ||\n                  useUserSettings.getState().cameraFitMode ||\n                  \"fit\") === \"fit\";\n              const videoClass =\n                aspect === \"square\"\n                  ? \"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black\"\n                  : fit\n                    ? \"absolute inset-0 w-full h-full object-contain object-center bg-black\"\n                    : \"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black\";\n              const containerClass =\n                aspect === \"square\"\n                  ? \"relative w-full mx-auto aspect-square bg-black\"\n                  : \"relative w-full aspect-[4/3] bg-black\";\n              const renderVideoSurface = () => (\n                <div className={containerClass}>\n                  <video\n                    ref={videoRef}\n                    className={videoClass}\n                    playsInline\n                    muted\n                    autoPlay\n                  />\n                  <canvas\n                    ref={overlayRef}\n                    className=\"absolute inset-0 w-full h-full\"\n                    onClick={onOverlayClick}\n                  />\n                  <div\n                    className=\"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3 cursor-pointer select-none\"\n                    onDoubleClick={handleIndicatorReset}\n                    aria-label={`Visit status: ${pendingEntries[0] ? (pendingEntries[0].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[1] ? (pendingEntries[1].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[2] ? (pendingEntries[2].value > 0 ? \"hit\" : \"miss\") : \"pending\"}`}\n                  >\n                    {[0, 1, 2].map((i) => {\n                      const e = pendingEntries[i] as any;\n                      const entrySeq = indicatorEntryVersions[i];\n                      const isPending = !e;\n                      const isActive = !!e && entrySeq === indicatorVersion;\n                      const hasPositiveValue =\n                        typeof e?.value === \"number\" ? e.value > 0 : false;\n                      const hasHitRing =\n                        (e?.ring && e.ring !== \"MISS\") ?? false;\n                      const isHit =\n                        isActive && (hasPositiveValue || hasHitRing);\n                      const color = !isActive\n                        ? \"bg-gray-500/70\"\n                        : isHit\n                          ? \"bg-emerald-400\"\n                          : \"bg-rose-500\";\n                      const activeState = isActive && !isPending;\n                      return (\n                        <span\n                          key={i}\n                          className={`visit-dot ${activeState ? \"active\" : \"inactive\"} ${color}`}\n                        />\n                      );\n                    })}\n                    {dartTimerEnabled && dartTimeLeft !== null && (\n                      <span className=\"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold\">\n                        {Math.max(0, dartTimeLeft)}s\n                      </span>\n                    )}\n                  </div>\n                  {shouldDeferCommit && awaitingClear ? (\n                    <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow\">\n                      Remove darts to continue\n                    </div>\n                  ) : null}\n                </div>\n              );\n              if (isPhoneCamera) {\n                if (!phoneFeedActive) {\n                  return (\n                    <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50\">\n                      <div className=\"text-center space-y-3 max-w-xs mx-auto\">\n                        <div className=\"text-4xl\">ðŸ“±</div>\n                        <div className=\"text-lg font-semibold text-blue-100\">\n                          Phone camera selected\n                        </div>\n                        <p className=\"text-sm text-slate-300\">\n                          Start streaming from the Calibrator tab or reconnect\n                          below.\n                        </p>\n                        <div className=\"flex items-center justify-center gap-2 flex-wrap\">\n                          <button\n                            className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\n                            onClick={handlePhoneReconnect}\n                          >\n                            Reconnect Phone\n                          </button>\n                          <button\n                            className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\n                            onClick={() => {\n                              try {\n                                cameraSession.setShowOverlay?.(true);\n                              } catch {}\n                            }}\n                          >\n                            Show Overlay\n                          </button>\n                          <button\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\n                            onClick={handleUseLocalCamera}\n                            disabled={!availableCameras.length}\n                          >\n                            Use Local Camera\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  );\n                }\n                return renderVideoSurface();\n              }\n              return renderVideoSurface();\n            })()}\n          </ResizablePanel>\n\n          <div className=\"mt-3 flex items-center justify-between gap-2\">\n            <button\n              className=\"btn btn--ghost px-3 py-1 text-xs font-semibold\"\n              onClick={() => setShowDetectionLog((prev) => !prev)}\n            >\n              {showDetectionLog ? \"Hide\" : \"Show\"} detection log\n            </button>\n            <span className=\"text-xs text-slate-400\">\n              Recent detections: {detectionLog.length}\n            </span>\n          </div>\n          {showDetectionLog && (\n            <div className=\"mt-2 rounded-2xl border border-white/15 bg-slate-900/80 p-3 text-xs text-white font-mono max-h-36 overflow-y-auto space-y-1\">\n              {detectionLog.length === 0 ? (\n                <div className=\"text-center text-slate-400\">\n                  No autoscore detections yet.\n                </div>\n              ) : (\n                detectionLog\n                  .slice()\n                  .reverse()\n                  .map((entry) => (\n                    <div\n                      key={entry.ts}\n                      className=\"flex items-center justify-between gap-3\"\n                    >\n                      <span\n                        className=\"truncate flex-1\"\n                        title={`Value ${entry.value} ${entry.ring}`}\n                      >\n                        {entry.label.padEnd(6, \" \")}\n                      </span>\n                      <span className=\"text-slate-400\">\n                        {entry.confidence.toFixed(2)}\n                      </span>\n                      <span\n                        className={`px-2 rounded-full text-[10px] font-semibold ${entry.accepted ? \"bg-emerald-500/80\" : entry.ready ? \"bg-amber-500/80\" : \"bg-rose-500/80\"}`}\n                      >\n                        {entry.accepted\n                          ? \"accepted\"\n                          : entry.ready\n                            ? \"queued\"\n                            : \"ignored\"}\n                      </span>\n                    </div>\n                  ))\n              )}\n            </div>\n          )}\n\n          {/* Small Manual pill in top-right of camera card so users in any game mode can open Manual Correction */}\n          {inProgress ? (\n            <div className=\"absolute top-3 right-3 z-30\">\n              {/**\n               * Autoscore state styles:\n               * - success: recent auto detected a valid non-miss score -> green\n               * - ambiguous: recent auto detected but result is miss/zero/empty -> amber\n               * - idle: default white/neutral\n               */}\n              {(() => {\n                let stateClass = \"bg-white/90 text-slate-800\";\n                let title = \"Manual Correction (M)\";\n                if (hadRecentAuto) {\n                  const ok =\n                    !!lastAutoScore &&\n                    lastAutoRing !== \"MISS\" &&\n                    lastAutoValue > 0;\n                  if (ok) {\n                    stateClass = \"bg-emerald-600 text-white\";\n                    title = `Manual Correction (M) â€” Autoscore: ${lastAutoScore} (confirmed)`;\n                  } else {\n                    stateClass = \"bg-amber-400 text-black\";\n                    title = `Manual Correction (M) â€” Autoscore ambiguous: ${lastAutoScore || \"â€”\"}`;\n                  }\n                }\n                // Larger, clearer pill text and padding\n                const baseClasses =\n                  \"px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90\";\n                const okNow =\n                  hadRecentAuto &&\n                  !!lastAutoScore &&\n                  lastAutoRing !== \"MISS\" &&\n                  lastAutoValue > 0;\n                const pulseClass =\n                  pulseManualPill && okNow\n                    ? \"ring-4 ring-emerald-400/60 animate-ping\"\n                    : hadRecentAuto && !okNow\n                      ? \"animate-pulse\"\n                      : \"\";\n                return (\n                  <button\n                    className={`${baseClasses} ${stateClass} ${pulseClass}`}\n                    onClick={() => {\n                      setActiveTab(\"manual\");\n                      setShowManualModal(true);\n                    }}\n                    title={title}\n                  >\n                    Manual\n                  </button>\n                );\n              })()}\n            </div>\n          ) : null}\n          <div className=\"flex flex-wrap items-center gap-2 mt-3\">\n            {isPhoneCamera ? (\n              <>\n                <div\n                  className={`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${phoneFeedActive ? \"bg-emerald-500/10 border-emerald-400/40 text-emerald-100\" : \"bg-amber-500/10 border-amber-400/40 text-amber-100\"}`}\n                >\n                  {phoneFeedActive\n                    ? \"ðŸ“± Phone camera stream active\"\n                    : \"ðŸ“± Waiting for phone camera stream\"}\n                </div>\n                <button\n                  className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\n                  onClick={handlePhoneReconnect}\n                >\n                  Reconnect Phone\n                </button>\n                <button\n                  className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\n                  onClick={() => {\n                    try {\n                      cameraSession.setShowOverlay?.(\n                        !cameraSession.showOverlay,\n                      );\n                    } catch {}\n                  }}\n                >\n                  {cameraSession.showOverlay ? \"Hide Overlay\" : \"Show Overlay\"}\n                </button>\n                <button\n                  className=\"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm\"\n                  disabled={!phoneFeedActive}\n                  onClick={() => {\n                    try {\n                      cameraSession.clearSession?.();\n                    } catch {}\n                  }}\n                >\n                  Stop Phone Feed\n                </button>\n                {canFallbackToLocal && (\n                  <button\n                    className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\n                    onClick={handleUseLocalCamera}\n                    disabled={!availableCameras.length}\n                  >\n                    Use Local Camera\n                  </button>\n                )}\n              </>\n            ) : (\n              <>\n                {!streaming ? (\n                  <button\n                    className=\"btn\"\n                    onClick={startCamera}\n                    disabled={cameraStarting}\n                  >\n                    {cameraStarting ? \"Connecting Camera...\" : \"Connect Camera\"}\n                  </button>\n                ) : (\n                  <button\n                    className=\"btn bg-rose-600 hover:bg-rose-700\"\n                    onClick={stopCamera}\n                  >\n                    Stop Camera\n                  </button>\n                )}\n              </>\n            )}\n            {!manualOnly && (\n              <button\n                className=\"btn bg-slate-700 hover:bg-slate-800\"\n                onClick={requestDeviceManager}\n                title=\"Open phone, WiFi, and USB camera options\"\n              >\n                Camera Devices\n              </button>\n            )}\n            <button\n              className=\"btn btn--ghost px-3 py-1 text-sm\"\n              onClick={() => setHideCameraOverlay(!hideCameraOverlay)}\n              title=\"Toggle the board guide overlay\"\n            >\n              {hideCameraOverlay ? \"Show board guides\" : \"Hide board guides\"}\n            </button>\n            <button\n              className={`btn ${cameraEnabled ? \"bg-rose-600 hover:bg-rose-700 text-white\" : \"bg-emerald-600 hover:bg-emerald-700 text-white\"}`}\n              onClick={() => setCameraEnabled(!cameraEnabled)}\n              title=\"Toggle whether the camera is used for scoring\"\n            >\n              {cameraEnabled ? \"Disable camera mode\" : \"Enable camera mode\"}\n            </button>\n            <button\n              className=\"btn\"\n              onClick={capture}\n              disabled={!effectiveStreaming}\n            >\n              Capture Still\n            </button>\n            <button\n              className=\"btn bg-slate-700 hover:bg-slate-800\"\n              disabled={!effectiveStreaming}\n              onClick={() => {\n                detectorRef.current = null;\n                setDetectorSeedVersion((v) => v + 1);\n              }}\n            >\n              Reset Autoscore Background\n            </button>\n            <button\n              className=\"btn bg-slate-700 hover:bg-slate-800\"\n              onClick={() => {\n                try {\n                  window.dispatchEvent(new Event(\"ndn:camera-reset\" as any));\n                } catch {}\n              }}\n            >\n              Reset Camera Size\n            </button>\n          </div>\n        </div>\n      ) : null}\n\n      {/* Floating Manual Correction button (always available for quick manual typing during games) */}\n      {inProgress ? (\n        <div className=\"fixed bottom-6 right-6 z-50\">\n          <button\n            className=\"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg\"\n            title=\"Open Manual Correction (M)\"\n            onClick={() => {\n              setActiveTab(\"manual\");\n              setShowManualModal(true);\n            }}\n          >\n            âœï¸\n          </button>\n        </div>\n      ) : null}\n      {!hideInlinePanels && manualOnly && (\n        <div className=\"card\">\n          <h2 className=\"text-xl font-semibold mb-3\">Manual Scoring</h2>\n          <p className=\"text-sm opacity-80 mb-3\">\n            Camera-based autoscore is disabled. Use the manual visit input or\n            open the Manual Correction panel to record darts.\n          </p>\n          <div className=\"flex flex-wrap items-center gap-2\">\n            <button\n              className=\"btn\"\n              onClick={() => {\n                setShowManualModal(true);\n                setActiveTab(\"manual\");\n              }}\n            >\n              Open Manual Correction\n            </button>\n            <button\n              className=\"btn btn--ghost\"\n              onClick={() => {\n                try {\n                  window.dispatchEvent(new Event(\"ndn:open-scoring\" as any));\n                } catch {}\n              }}\n            >\n              Manage Pending Visit\n            </button>\n          </div>\n        </div>\n      )}\n      {/* Snapshot panel removed to reduce unused space */}\n      <canvas ref={canvasRef} className=\"hidden\"></canvas>\n      {/* Autoscore moved into a pill-triggered modal to reduce on-screen clutter */}\n      {/* Modal: Autoscore */}\n      {showAutoModal && !manualOnly && (\n        <div\n          className=\"fixed inset-0 bg-black/60 z-[100]\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n        >\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\n            <ResizableModal\n              storageKey=\"ndn:autoscore:size\"\n              className=\"w-full max-w-3xl\"\n              defaultWidth={720}\n              defaultHeight={520}\n              minWidth={420}\n              minHeight={320}\n              maxWidth={1400}\n              maxHeight={900}\n              initialFitHeight\n            >\n              <div className=\"flex items-center justify-between mb-3\">\n                <h2 className=\"text-xl font-semibold\">Autoscore</h2>\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    className=\"btn btn--ghost\"\n                    onClick={() => setShowAutoModal(false)}\n                  >\n                    Close\n                  </button>\n                </div>\n              </div>\n              <div className=\"text-sm opacity-80 mb-3\">\n                Click the camera overlay to autoscore. Use Manual Correction if\n                the last auto is off.\n              </div>\n              <div className=\"flex items-center gap-2 mb-3 flex-wrap\">\n                <span className=\"font-semibold\">Last auto:</span>\n                <span>{lastAutoScore || \"â€”\"}</span>\n                <button\n                  className=\"btn\"\n                  onClick={onAddAutoDart}\n                  disabled={pendingDarts >= 3}\n                >\n                  Add Auto Dart\n                </button>\n                {nonRegCount > 0 && (\n                  <span className=\"text-sm opacity-80\">\n                    No-registers: {nonRegCount}/3\n                  </span>\n                )}\n              </div>\n              <div className=\"mt-2\">\n                <div className=\"text-sm font-semibold mb-2\">Quick entry</div>\n                {/* Bulls */}\n                <div className=\"flex flex-wrap gap-2 mb-3\">\n                  <button\n                    className=\"btn\"\n                    disabled={pendingDarts >= 3}\n                    onClick={() => {\n                      if (\n                        !hadRecentAuto ||\n                        !lastAutoScore ||\n                        lastAutoRing === \"MISS\" ||\n                        lastAutoValue === 0\n                      ) {\n                        const c = nonRegCount + 1;\n                        setNonRegCount(c);\n                        if (c >= 5) setShowRecalModal(true);\n                      } else setNonRegCount(0);\n                      addDart(25, \"BULL 25\", \"BULL\");\n                      setHadRecentAuto(false);\n                    }}\n                  >\n                    25\n                  </button>\n                  <button\n                    className=\"btn\"\n                    disabled={pendingDarts >= 3}\n                    onClick={() => {\n                      if (\n                        !hadRecentAuto ||\n                        !lastAutoScore ||\n                        lastAutoRing === \"MISS\" ||\n                        lastAutoValue === 0\n                      ) {\n                        const c = nonRegCount + 1;\n                        setNonRegCount(c);\n                        if (c >= 5) setShowRecalModal(true);\n                      } else setNonRegCount(0);\n                      addDart(50, \"INNER_BULL 50\", \"INNER_BULL\");\n                      setHadRecentAuto(false);\n                    }}\n                  >\n                    50\n                  </button>\n                </div>\n                {/* Grouped dropdown: Doubles, Singles, Trebles */}\n                <div className=\"flex items-center gap-2 mb-3\">\n                  <input\n                    className=\"input w-full max-w-sm\"\n                    list=\"autoscore-quick-list\"\n                    placeholder=\"Type or select (e.g., D16, T20, S5)\"\n                    value={quickSelAuto}\n                    onChange={(e) =>\n                      setQuickSelAuto(e.target.value.toUpperCase())\n                    }\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\") {\n                        const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/);\n                        if (m) {\n                          onQuickEntry(parseInt(m[2], 10), m[1] as any);\n                        }\n                      }\n                    }}\n                  />\n                  <datalist id=\"autoscore-quick-list\">\n                    {([\"D\", \"S\", \"T\"] as const).map((mult) =>\n                      Array.from({ length: 20 }, (_, i) => i + 1).map((num) => (\n                        <option key={`${mult}${num}`} value={`${mult}${num}`} />\n                      )),\n                    )}\n                  </datalist>\n                  <button\n                    className=\"btn\"\n                    disabled={!quickSelAuto || pendingDarts >= 3}\n                    onClick={() => {\n                      const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/);\n                      if (!m) return;\n                      const mult = m[1] as \"S\" | \"D\" | \"T\";\n                      const num = parseInt(m[2], 10);\n                      onQuickEntry(num, mult);\n                    }}\n                  >\n                    Add\n                  </button>\n                </div>\n              </div>\n            </ResizableModal>\n          </div>\n        </div>\n      )}\n      {showManualModal && (\n        <div\n          className=\"fixed inset-0 bg-black/60 z-[100]\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n        >\n          <div className=\"absolute inset-0 flex flex-col\">\n            <FocusLock returnFocus>\n              <div className=\"p-3 md:p-4 flex items-center justify-between\">\n                <h3 className=\"text-xl md:text-2xl font-semibold\">\n                  Manual Correction\n                </h3>\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    className=\"btn bg-slate-700 hover:bg-slate-800\"\n                    onClick={() => {\n                      setShowManualModal(false);\n                    }}\n                  >\n                    Close\n                  </button>\n                </div>\n              </div>\n              <div className=\"flex-1 p-3 md:p-4\">\n                <div className=\"h-full grid grid-cols-1 lg:grid-cols-2 gap-4\">\n                  {/* Live preview */}\n                  <div className=\"card relative flex flex-col\">\n                    <div className=\"text-sm font-semibold mb-2\">\n                      Live Preview\n                    </div>\n                    <div className=\"relative flex-1 rounded-2xl overflow-hidden bg-black\">\n                      <canvas\n                        ref={manualPreviewRef}\n                        className=\"absolute inset-0 w-full h-full\"\n                      />\n                    </div>\n                  </div>\n                  {/* Manual controls */}\n                  <div className=\"card flex flex-col\">\n                    <div className=\"text-sm opacity-80 mb-2\">\n                      Type a correction or replace the last dart. The preview\n                      updates live.\n                    </div>\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <span className=\"font-semibold\">Last auto:</span>\n                      <span>{lastAutoScore || \"â€”\"}</span>\n                      <button\n                        className=\"btn\"\n                        onClick={onAddAutoDart}\n                        disabled={pendingDarts >= 3}\n                      >\n                        Add Auto Dart\n                      </button>\n                    </div>\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <input\n                        className=\"input flex-[1.2]\"\n                        placeholder=\"Manual (T20, D16, 5, 25, 50)\"\n                        value={manualScore}\n                        onChange={(e) => setManualScore(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === \"Enter\" && !e.shiftKey) {\n                            e.preventDefault();\n                            onApplyManual();\n                          }\n                          if (e.key === \"Enter\" && e.shiftKey) {\n                            e.preventDefault();\n                            onReplaceManual();\n                          }\n                        }}\n                      />\n                      <button\n                        className=\"btn btn--ghost\"\n                        onClick={onReplaceManual}\n                        disabled={pendingDarts === 0}\n                      >\n                        Replace Last\n                      </button>\n                      <button\n                        className=\"btn\"\n                        onClick={onApplyManual}\n                        disabled={pendingDarts >= 3}\n                      >\n                        Add\n                      </button>\n                    </div>\n                    <div className=\"text-xs opacity-70 mb-4\">\n                      Press Enter to Add Â· Shift+Enter to Replace Last\n                    </div>\n                    {/* Numeric keypad for quick manual numeric entry */}\n                    <div className=\"mb-4\">\n                      <div className=\"text-sm font-semibold mb-2\">\n                        Number pad\n                      </div>\n                      <div className=\"grid grid-cols-3 gap-2 max-w-sm\">\n                        {[\"7\", \"8\", \"9\", \"4\", \"5\", \"6\", \"1\", \"2\", \"3\", \"0\"].map(\n                          (d) => (\n                            <button\n                              key={d}\n                              className=\"btn text-lg\"\n                              onClick={() => {\n                                // Append digit to manualScore (keep T/D/T prefixes if present)\n                                setManualScore((ms) => {\n                                  // If existing starts with letter (S/D/T), append after it\n                                  if (/^[SDT]/i.test(ms)) return ms + d;\n                                  return (ms || \"\") + d;\n                                });\n                              }}\n                            >\n                              {d}\n                            </button>\n                          ),\n                        )}\n                        <button\n                          className=\"btn bg-rose-600 hover:bg-rose-700 text-white\"\n                          onClick={() => setManualScore(\"\")}\n                        >\n                          Clear\n                        </button>\n                        <button\n                          className=\"btn bg-slate-600 hover:bg-slate-700 text-white\"\n                          onClick={() =>\n                            setManualScore((ms) => (ms || \"\").slice(0, -1))\n                          }\n                        >\n                          âŒ«\n                        </button>\n                        <button\n                          className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\"\n                          onClick={() => onApplyManual()}\n                          disabled={pendingDarts >= 3}\n                        >\n                          Enter\n                        </button>\n                      </div>\n                      <div className=\"text-xs opacity-70 mt-2\">\n                        Tap numbers then press Enter to submit. Use D/T prefixes\n                        for doubles/trebles (e.g., D16).\n                      </div>\n                    </div>\n                    <div className=\"mt-auto\">\n                      <div className=\"text-sm font-semibold mb-2\">\n                        Quick entry\n                      </div>\n                      {/* Bulls */}\n                      <div className=\"flex flex-wrap gap-2 mb-3\">\n                        <button\n                          className=\"btn\"\n                          disabled={pendingDarts >= 3}\n                          onClick={() => {\n                            if (\n                              !hadRecentAuto ||\n                              !lastAutoScore ||\n                              lastAutoRing === \"MISS\" ||\n                              lastAutoValue === 0\n                            ) {\n                              const c = nonRegCount + 1;\n                              setNonRegCount(c);\n                              if (c >= 5) setShowRecalModal(true);\n                            } else setNonRegCount(0);\n                            addDart(25, \"BULL 25\", \"BULL\");\n                            setHadRecentAuto(false);\n                          }}\n                        >\n                          25\n                        </button>\n                        <button\n                          className=\"btn\"\n                          disabled={pendingDarts >= 3}\n                          onClick={() => {\n                            if (\n                              !hadRecentAuto ||\n                              !lastAutoScore ||\n                              lastAutoRing === \"MISS\" ||\n                              lastAutoValue === 0\n                            ) {\n                              const c = nonRegCount + 1;\n                              setNonRegCount(c);\n                              if (c >= 5) setShowRecalModal(true);\n                            } else setNonRegCount(0);\n                            addDart(50, \"INNER_BULL 50\", \"INNER_BULL\");\n                            setHadRecentAuto(false);\n                          }}\n                        >\n                          50\n                        </button>\n                      </div>\n                      {/* Grouped dropdown: Doubles, Singles, Trebles */}\n                      <div className=\"flex items-center gap-2 mb-3\">\n                        <input\n                          className=\"input w-full max-w-sm\"\n                          list=\"manual-quick-list\"\n                          placeholder=\"Type or select (e.g., D16, T20, S5)\"\n                          value={quickSelManual}\n                          onChange={(e) =>\n                            setQuickSelManual(e.target.value.toUpperCase())\n                          }\n                          onKeyDown={(e) => {\n                            if (e.key === \"Enter\") {\n                              const m =\n                                quickSelManual.match(/^(S|D|T)(\\d{1,2})$/);\n                              if (m) {\n                                onQuickEntry(parseInt(m[2], 10), m[1] as any);\n                              }\n                            }\n                          }}\n                        />\n                        <datalist id=\"manual-quick-list\">\n                          {([\"D\", \"S\", \"T\"] as const).map((mult) =>\n                            Array.from({ length: 20 }, (_, i) => i + 1).map(\n                              (num) => (\n                                <option\n                                  key={`${mult}${num}`}\n                                  value={`${mult}${num}`}\n                                />\n                              ),\n                            ),\n                          )}\n                        </datalist>\n                        <button\n                          className=\"btn\"\n                          disabled={!quickSelManual || pendingDarts >= 3}\n                          onClick={() => {\n                            const m =\n                              quickSelManual.match(/^(S|D|T)(\\d{1,2})$/);\n                            if (!m) return;\n                            const mult = m[1] as \"S\" | \"D\" | \"T\";\n                            const num = parseInt(m[2], 10);\n                            onQuickEntry(num, mult);\n                          }}\n                        >\n                          Add\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </FocusLock>\n          </div>\n        </div>\n      )}\n      {showScoringModal && (\n        <div className=\"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center\">\n          <FocusLock returnFocus>\n            <div\n              className=\"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\"\n              role=\"dialog\"\n              aria-modal=\"true\"\n            >\n              <button\n                className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\"\n                onClick={() => setShowScoringModal(false)}\n                aria-label=\"Close scoring dialog\"\n              >\n                Close\n              </button>\n              <h2 className=\"text-xl font-bold mb-4 flex items-center gap-2 text-white\">\n                Scoring\n              </h2>\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* Camera section */}\n                <div className=\"bg-black/30 rounded-2xl p-4\">\n                  <h2 className=\"text-lg font-semibold mb-3\">Camera</h2>\n                  <ResizablePanel\n                    storageKey=\"ndn:camera:size:modal\"\n                    className=\"relative rounded-2xl overflow-hidden bg-black\"\n                    defaultWidth={480}\n                    defaultHeight={360}\n                    minWidth={360}\n                    minHeight={270}\n                    maxWidth={800}\n                    maxHeight={600}\n                  >\n                    <CameraSelector />\n                    {(() => {\n                      const fit =\n                        (useUserSettings.getState().cameraFitMode || \"fit\") ===\n                        \"fit\";\n                      const videoClass = fit\n                        ? \"absolute inset-0 w-full h-full object-contain object-center bg-black\"\n                        : \"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black\";\n                      const renderVideoSurface = () => (\n                        <div className=\"relative w-full aspect-[4/3] bg-black\">\n                          <video\n                            ref={videoRef}\n                            className={videoClass}\n                            playsInline\n                            muted\n                            autoPlay\n                          />\n                          <canvas\n                            ref={overlayRef}\n                            className=\"absolute inset-0 w-full h-full\"\n                            onClick={onOverlayClick}\n                          />\n                          <div\n                            className=\"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3\"\n                            aria-label={`Visit status: ${pendingEntries[0] ? (pendingEntries[0].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[1] ? (pendingEntries[1].value > 0 ? \"hit\" : \"miss\") : \"pending\"}, ${pendingEntries[2] ? (pendingEntries[2].value > 0 ? \"hit\" : \"miss\") : \"pending\"}`}\n                          >\n                            {[0, 1, 2].map((i) => {\n                              const e = pendingEntries[i] as any;\n                              const isPending = !e;\n                              const isHit =\n                                !!e &&\n                                (typeof e.value === \"number\"\n                                  ? e.value > 0\n                                  : true);\n                              const color = isPending\n                                ? \"bg-gray-500/70\"\n                                : isHit\n                                  ? \"bg-emerald-400\"\n                                  : \"bg-rose-500\";\n                              return (\n                                <span\n                                  key={i}\n                                  className={`w-3 h-3 rounded-full shadow ${color}`}\n                                />\n                              );\n                            })}\n                            {dartTimerEnabled && dartTimeLeft !== null && (\n                              <span className=\"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold\">\n                                {Math.max(0, dartTimeLeft)}s\n                              </span>\n                            )}\n                          </div>\n                          {shouldDeferCommit && awaitingClear ? (\n                            <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow\">\n                              Remove darts to continue\n                            </div>\n                          ) : null}\n                        </div>\n                      );\n                      if (isPhoneCamera) {\n                        if (!phoneFeedActive) {\n                          return (\n                            <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50\">\n                              <div className=\"text-center space-y-3 max-w-xs mx-auto\">\n                                <div className=\"text-4xl\">ðŸ“±</div>\n                                <div className=\"text-lg font-semibold text-blue-100\">\n                                  Phone camera selected\n                                </div>\n                                <p className=\"text-sm text-slate-300\">\n                                  Start streaming from the Calibrator tab or\n                                  reconnect below.\n                                </p>\n                                <div className=\"flex items-center justify-center gap-2 flex-wrap\">\n                                  <button\n                                    className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\n                                    onClick={handlePhoneReconnect}\n                                  >\n                                    Reconnect Phone\n                                  </button>\n                                  <button\n                                    className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\n                                    onClick={() => {\n                                      try {\n                                        cameraSession.setShowOverlay?.(true);\n                                      } catch {}\n                                    }}\n                                  >\n                                    Show Overlay\n                                  </button>\n                                  <button\n                                    className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\n                                    onClick={handleUseLocalCamera}\n                                    disabled={!availableCameras.length}\n                                  >\n                                    Use Local Camera\n                                  </button>\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        }\n                        return renderVideoSurface();\n                      }\n                      return renderVideoSurface();\n                    })()}\n                  </ResizablePanel>\n                  <div className=\"flex flex-wrap items-center gap-2 mt-3\">\n                    {isPhoneCamera ? (\n                      <>\n                        <div\n                          className={`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${phoneFeedActive ? \"bg-emerald-500/10 border-emerald-400/40 text-emerald-100\" : \"bg-amber-500/10 border-amber-400/40 text-amber-100\"}`}\n                        >\n                          {phoneFeedActive\n                            ? \"ðŸ“± Phone camera stream active\"\n                            : \"ðŸ“± Waiting for phone camera stream\"}\n                        </div>\n                        <button\n                          className=\"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm\"\n                          onClick={handlePhoneReconnect}\n                        >\n                          Reconnect Phone\n                        </button>\n                        <button\n                          className=\"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm\"\n                          onClick={() => {\n                            try {\n                              cameraSession.setShowOverlay?.(\n                                !cameraSession.showOverlay,\n                              );\n                            } catch {}\n                          }}\n                        >\n                          {cameraSession.showOverlay\n                            ? \"Hide Overlay\"\n                            : \"Show Overlay\"}\n                        </button>\n                        <button\n                          className=\"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm\"\n                          disabled={!phoneFeedActive}\n                          onClick={() => {\n                            try {\n                              cameraSession.clearSession?.();\n                            } catch {}\n                          }}\n                        >\n                          Stop Phone Feed\n                        </button>\n                        {canFallbackToLocal && (\n                          <button\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm\"\n                            onClick={handleUseLocalCamera}\n                            disabled={!availableCameras.length}\n                          >\n                            Use Local Camera\n                          </button>\n                        )}\n                      </>\n                    ) : (\n                      <>\n                        {!streaming ? (\n                          <button\n                            className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\n                            onClick={startCamera}\n                          >\n                            Connect Camera\n                          </button>\n                        ) : (\n                          <button\n                            className=\"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold\"\n                            onClick={stopCamera}\n                          >\n                            Stop Camera\n                          </button>\n                        )}\n                      </>\n                    )}\n                    <button\n                      className=\"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold\"\n                      onClick={capture}\n                      disabled={!effectiveStreaming}\n                    >\n                      Capture Still\n                    </button>\n                    <button\n                      className=\"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold\"\n                      disabled={!effectiveStreaming}\n                      onClick={() => {\n                        detectorRef.current = null;\n                        setDetectorSeedVersion((v) => v + 1);\n                      }}\n                    >\n                      Reset Autoscore Background\n                    </button>\n                    <button\n                      className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\n                      onClick={() => {\n                        try {\n                          window.dispatchEvent(\n                            new Event(\"ndn:camera-reset\" as any),\n                          );\n                        } catch {}\n                      }}\n                    >\n                      Reset Camera Size\n                    </button>\n                  </div>\n                </div>\n                {/* Pending Visit section */}\n                <div className=\"bg-black/30 rounded-2xl p-4\">\n                  <h2 className=\"text-lg font-semibold mb-3\">Pending Visit</h2>\n                  <div className=\"text-sm opacity-80 mb-2\">\n                    Up to 3 darts per visit.\n                  </div>\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    {[0, 1, 2].map((i) => {\n                      const e = pendingEntries[i] as any;\n                      const isPending = !e;\n                      const isHit =\n                        !!e &&\n                        (typeof e.value === \"number\" ? e.value > 0 : true);\n                      const color = isPending\n                        ? \"bg-gray-500/70\"\n                        : isHit\n                          ? \"bg-emerald-400\"\n                          : \"bg-rose-500\";\n                      return (\n                        <span\n                          key={i}\n                          className={`w-2.5 h-2.5 rounded-full shadow ${color}`}\n                        />\n                      );\n                    })}\n                    {dartTimerEnabled && dartTimeLeft !== null && (\n                      <span className=\"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold\">\n                        {Math.max(0, dartTimeLeft)}s\n                      </span>\n                    )}\n                  </div>\n                  <ul className=\"text-sm mb-2 list-disc pl-5\">\n                    {pendingEntries.length === 0 ? (\n                      <li className=\"opacity-60\">No darts yet</li>\n                    ) : (\n                      pendingEntries.map((e, i) => <li key={i}>{e.label}</li>)\n                    )}\n                  </ul>\n                  <div className=\"flex items-center gap-4 mb-2\">\n                    <div className=\"font-semibold\">Darts: {pendingDarts}/3</div>\n                    <div className=\"font-semibold\">Total: {pendingScore}</div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\n                      onClick={onUndoDart}\n                      disabled={pendingDarts === 0}\n                    >\n                      Undo Dart\n                    </button>\n                    <button\n                      className=\"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold\"\n                      onClick={onCommitVisit}\n                      disabled={pendingDarts === 0}\n                    >\n                      Commit Visit\n                    </button>\n                    <button\n                      className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\n                      onClick={handleToolbarClear}\n                      disabled={pendingDarts === 0}\n                    >\n                      Clear\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </FocusLock>\n        </div>\n      )}\n      {showRecalModal && (\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\n          <div className=\"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\n            <button\n              className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\"\n              onClick={() => {\n                setShowRecalModal(false);\n                setNonRegCount(0);\n              }}\n            >\n              Close\n            </button>\n            <h3 className=\"text-xl font-bold mb-2 flex items-center gap-2 text-white\">\n              Recalibration Recommended\n            </h3>\n            <div className=\"mb-4 text-lg font-semibold text-indigo-200\">\n              We detected 3 incorrect autoscores in a row. You can recalibrate\n              now or reset calibration and try again.\n            </div>\n            <div className=\"flex gap-2\">\n              <button\n                className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\"\n                onClick={onRecalibrateNow}\n              >\n                Go to Calibrate\n              </button>\n              <button\n                className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\n                onClick={onResetCalibration}\n              >\n                Reset Calibration\n              </button>\n              <button\n                className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\"\n                onClick={() => {\n                  setShowRecalModal(false);\n                  setNonRegCount(0);\n                }}\n              >\n                Dismiss\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      {/* Duplicate Pending Visit panel removed to avoid showing the same controls twice when inline panels are visible. */}\n    </div>\n  );\n}\n","import React, { useEffect, useRef } from \"react\";\nimport useHeatmapStore from \"../store/heatmap\";\nimport { BoardRadii } from \"../utils/vision\";\n\nfunction polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {\n  const a = ((angleDeg - 90) * Math.PI) / 180.0;\n  return { x: cx + r * Math.cos(a), y: cy + r * Math.sin(a) };\n}\n\nfunction sectorAngle(sector: number) {\n  // SectorOrder puts 20 at top; 360/20 = 18deg per sector\n  const SectorOrder = [\n    20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5,\n  ];\n  const idx = SectorOrder.indexOf(sector);\n  const mid = idx * 18 + 9; // middle of sector\n  return mid;\n}\n\nexport default function HeatMap({\n  width = 320,\n  height = 320,\n}: {\n  width?: number;\n  height?: number;\n}) {\n  const samples = useHeatmapStore((s) => s.samples);\n  const ref = useRef<HTMLCanvasElement | null>(null);\n\n  useEffect(() => {\n    const c = ref.current;\n    if (!c) return;\n    const ctx = c.getContext(\"2d\");\n    if (!ctx) return;\n    c.width = width;\n    c.height = height;\n    ctx.clearRect(0, 0, width, height);\n    // Draw a faint dartboard backdrop (rings)\n    const cx = width / 2;\n    const cy = height / 2;\n    const scale = Math.min(width, height) / (BoardRadii.doubleOuter * 2 + 20);\n    const radii = {\n      bullInner: BoardRadii.bullInner * scale,\n      bullOuter: BoardRadii.bullOuter * scale,\n      trebleInner: BoardRadii.trebleInner * scale,\n      trebleOuter: BoardRadii.trebleOuter * scale,\n      doubleInner: BoardRadii.doubleInner * scale,\n      doubleOuter: BoardRadii.doubleOuter * scale,\n    };\n    // rings\n    ctx.strokeStyle = \"rgba(255,255,255,0.06)\";\n    ctx.lineWidth = 1;\n    const ringOrder = [\n      \"doubleOuter\",\n      \"doubleInner\",\n      \"trebleOuter\",\n      \"trebleInner\",\n      \"bullOuter\",\n      \"bullInner\",\n    ] as const;\n    for (const k of ringOrder) {\n      ctx.beginPath();\n      ctx.arc(cx, cy, (radii as any)[k], 0, Math.PI * 2);\n      ctx.stroke();\n    }\n\n    // Aggregate sample weights by approximate xy\n    const points: { x: number; y: number; w: number }[] = [];\n    for (const s of samples) {\n      // if sector unknown, scatter in board\n      let angle = Math.random() * 360;\n      let r = Math.random() * radii.doubleOuter;\n      if (typeof s.sector === \"number\" && s.sector >= 1 && s.sector <= 20) {\n        angle = sectorAngle(s.sector);\n        // choose radius by mult/ring\n        if (s.ring === \"DOUBLE\")\n          r = (radii.doubleInner + radii.doubleOuter) / 2;\n        else if (s.ring === \"TRIPLE\")\n          r = (radii.trebleInner + radii.trebleOuter) / 2;\n        else if (s.ring === \"INNER_BULL\") r = radii.bullInner * 0.5;\n        else if (s.ring === \"BULL\") r = radii.bullOuter * 0.8;\n        else\n          r =\n            ((radii.trebleOuter + radii.doubleInner) / 2) *\n            (0.6 + Math.random() * 0.4);\n      }\n      const p = polarToCartesian(cx, cy, r, angle);\n      points.push({ x: p.x, y: p.y, w: 1 });\n    }\n\n    // Draw heat circles additive\n    for (const p of points) {\n      const grd = ctx.createRadialGradient(p.x, p.y, 1, p.x, p.y, 60);\n      grd.addColorStop(0, \"rgba(255,0,0,0.9)\");\n      grd.addColorStop(0.3, \"rgba(255,100,0,0.5)\");\n      grd.addColorStop(1, \"rgba(255,100,0,0)\");\n      ctx.fillStyle = grd;\n      ctx.beginPath();\n      ctx.arc(p.x, p.y, 60, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    // Optionally overlay counts per sector\n    ctx.fillStyle = \"rgba(255,255,255,0.85)\";\n    ctx.font = \"12px ui-sans-serif\";\n    // compute counts per sector\n    const sectorCounts: Record<number, number> = {};\n    for (const s of samples)\n      if (s.sector) sectorCounts[s.sector] = (sectorCounts[s.sector] || 0) + 1;\n    for (const secStr of Object.keys(sectorCounts)) {\n      const sec = Number(secStr);\n      const a = sectorAngle(sec);\n      const pos = polarToCartesian(cx, cy, radii.trebleOuter + 18, a);\n      ctx.fillText(String(sectorCounts[sec]), pos.x - 6, pos.y + 4);\n    }\n  }, [samples, width, height]);\n\n  return (\n    <canvas\n      ref={ref}\n      style={{\n        width: \"100%\",\n        height: \"auto\",\n        borderRadius: 8,\n        background: \"#081018\",\n      }}\n    />\n  );\n}\n","export type DartMult = \"S\" | \"D\" | \"T\";\nexport type Dart = { mult: DartMult; num: number } | { bull: 25 | 50 };\n\nexport type DoublePracticeState = {\n  targetIndex: number; // 0..20 for D1..D20 then 21 for DBULL\n  completed: boolean;\n};\n\nexport const DOUBLE_PRACTICE_TARGETS: Array<{\n  label: string;\n  score: number;\n  isBull?: boolean;\n}>[] = [] as any;\n\nexport const DOUBLE_PRACTICE_ORDER: {\n  label: string;\n  score: number;\n  isBull?: boolean;\n}[] = [\n  ...Array.from({ length: 20 }, (_, i) => ({\n    label: `D${i + 1}`,\n    score: (i + 1) * 2,\n  })),\n  { label: \"DBULL\", score: 50, isBull: true },\n];\n\nexport function isDoubleHit(value: number, targetIdx: number): boolean {\n  const t = DOUBLE_PRACTICE_ORDER[targetIdx];\n  return !!t && value === t.score;\n}\n\nexport function parseManualDart(input: string): number | null {\n  const t = input.trim().toUpperCase();\n  if (!t) return null;\n  if (t === \"50\" || t === \"BULL\" || t === \"DBULL\" || t === \"IBULL\") return 50;\n  if (t === \"25\" || t === \"OBULL\") return 25;\n  const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\n  if (!m) return null;\n  const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\n  const num = parseInt(m[2], 10);\n  if (num < 1 || num > 20) return null;\n  const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\n  return num * multVal;\n}\n\n// Parse a detailed dart string like \"T20\", \"D16\", \"S5\", \"25\", \"50\", \"BULL\", returning a structured Dart.\nexport function parseDartDetailed(input: string): Dart | null {\n  const t = input.trim().toUpperCase();\n  if (!t) return null;\n  if (\n    t === \"50\" ||\n    t === \"BULL\" ||\n    t === \"DBULL\" ||\n    t === \"IBULL\" ||\n    t === \"INNER BULL\" ||\n    t === \"INNER_BULL\"\n  )\n    return { bull: 50 };\n  if (t === \"25\" || t === \"OBULL\" || t === \"OUTER BULL\" || t === \"BULL25\")\n    return { bull: 25 };\n  const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\n  if (!m) return null;\n  const mult = (m[1] || \"S\") as DartMult;\n  const num = parseInt(m[2], 10);\n  if (num < 1 || num > 20) return null;\n  return { mult, num };\n}\n\n// Convert autoscore ring+sector data into a structured Dart\n// ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\n// sector: 1..20 for numbered segments; null/undefined for bull/miss\nexport function ringSectorToDart(\n  ring?: string,\n  sector?: number | null,\n): Dart | null {\n  if (!ring || ring === \"MISS\") return null;\n  if (ring === \"BULL\") return { bull: 25 };\n  if (ring === \"INNER_BULL\") return { bull: 50 };\n  if (typeof sector === \"number\" && sector >= 1 && sector <= 20) {\n    const mult: DartMult =\n      ring === \"DOUBLE\" ? \"D\" : ring === \"TRIPLE\" ? \"T\" : \"S\";\n    return { mult, num: sector };\n  }\n  return null;\n}\n","export type ATCState = {\n  target: number; // 1..20 then 25 (outer bull) then 50 (inner)\n  finished: boolean;\n};\n\nexport const ATC_ORDER: number[] = [\n  ...Array.from({ length: 20 }, (_, i) => i + 1),\n  25,\n  50,\n];\n\nexport function nextTarget(current: number): number | null {\n  const idx = ATC_ORDER.indexOf(current);\n  if (idx < 0) return ATC_ORDER[0];\n  if (idx >= ATC_ORDER.length - 1) return null;\n  return ATC_ORDER[idx + 1];\n}\n\nexport function isCorrectHit(value: number, target: number): boolean {\n  return value === target;\n}\n","export type CricketMark = 0 | 1 | 2 | 3;\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25; // 25 is bull (outer+inner)\n\nexport type CricketState = {\n  // marks per number\n  marks: Record<CricketNumber, CricketMark>;\n  // accumulated points when opponent hasn't closed a number\n  points: number;\n};\n\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25];\n\nexport function createCricketState(): CricketState {\n  const marks: any = {};\n  CRICKET_NUMBERS.forEach((n) => {\n    marks[n] = 0;\n  });\n  return { marks, points: 0 };\n}\n\n// Apply a single dart to a player's cricket state\n// Returns deltaPoints scored on this dart\nexport function applyCricketDart(\n  state: CricketState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n  opponentClosed: (n: CricketNumber) => boolean = () => false,\n): number {\n  // Map autoscore terms to logical hits\n  let num: CricketNumber | null = null;\n  let hits = 0;\n  if (\n    ring === \"BULL\" ||\n    ring === \"INNER_BULL\" ||\n    value === 25 ||\n    value === 50\n  ) {\n    num = 25;\n    hits = ring === \"INNER_BULL\" || value === 50 ? 2 : 1;\n  } else if (\n    typeof sector === \"number\" &&\n    (sector as number) >= 15 &&\n    (sector as number) <= 20\n  ) {\n    num = sector as CricketNumber;\n    if (ring === \"TRIPLE\") hits = 3;\n    else if (ring === \"DOUBLE\") hits = 2;\n    else hits = 1;\n  } else if (value) {\n    // Fallback when only numeric score provided (manual): infer by divisibility\n    const cand: CricketNumber[] = [20, 19, 18, 17, 16, 15];\n    for (const c of cand) {\n      if (value === c) {\n        num = c;\n        hits = 1;\n        break;\n      }\n      if (value === c * 2) {\n        num = c;\n        hits = 2;\n        break;\n      }\n      if (value === c * 3) {\n        num = c;\n        hits = 3;\n        break;\n      }\n    }\n    if (!num && (value === 25 || value === 50)) {\n      num = 25;\n      hits = value === 50 ? 2 : 1;\n    }\n  }\n  if (!num) return 0;\n\n  const before = state.marks[num];\n  const remainToClose = Math.max(0, 3 - before);\n  const toApply = Math.min(remainToClose, hits);\n  const overflow = Math.max(0, hits - toApply);\n  // Increase marks up to 3\n  const after = (before + toApply) as CricketMark;\n  state.marks[num] = after > 3 ? 3 : after;\n\n  // Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\n  let points = 0;\n  if (overflow > 0 && !opponentClosed(num)) {\n    if (num === 25) {\n      // Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\n      if (ring === \"INNER_BULL\") points += 50 * overflow;\n      else points += 25 * overflow;\n    } else {\n      points += num * overflow;\n    }\n  }\n\n  state.points += points;\n  return points;\n}\n\nexport function hasClosedAll(state: CricketState): boolean {\n  return CRICKET_NUMBERS.every((n) => (state.marks[n] || 0) >= 3);\n}\n\nexport function cricketWinner(\n  self: CricketState,\n  opponents: CricketState[],\n): boolean {\n  // Win when all closed and you have >= opponents' points\n  if (!hasClosedAll(self)) return false;\n  const maxOppPoints = Math.max(0, ...opponents.map((o) => o.points));\n  return self.points >= maxOppPoints;\n}\n","export type ShanghaiRound =\n  | 1\n  | 2\n  | 3\n  | 4\n  | 5\n  | 6\n  | 7\n  | 8\n  | 9\n  | 10\n  | 11\n  | 12\n  | 13\n  | 14\n  | 15\n  | 16\n  | 17\n  | 18\n  | 19\n  | 20;\n\nexport type ShanghaiState = {\n  round: ShanghaiRound;\n  score: number;\n  finished: boolean;\n  shanghaiAchieved: boolean; // single+double+triple of target in same 3-dart turn\n  turnHits: { singles: number; doubles: number; triples: number };\n};\n\nexport function createShanghaiState(): ShanghaiState {\n  return {\n    round: 1,\n    score: 0,\n    finished: false,\n    shanghaiAchieved: false,\n    turnHits: { singles: 0, doubles: 0, triples: 0 },\n  };\n}\n\nexport function getRoundTarget(state: ShanghaiState): number {\n  return state.round;\n}\n\n// Apply one dart; returns points scored on this dart\nexport function applyShanghaiDart(\n  state: ShanghaiState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): number {\n  if (state.finished) return 0;\n  const target = getRoundTarget(state);\n  let points = 0;\n  if (typeof sector === \"number\" && sector === target) {\n    if (ring === \"TRIPLE\") {\n      points = target * 3;\n      state.turnHits.triples++;\n    } else if (ring === \"DOUBLE\") {\n      points = target * 2;\n      state.turnHits.doubles++;\n    } else if (ring === \"SINGLE\") {\n      points = target * 1;\n      state.turnHits.singles++;\n    }\n  } else if (\n    !sector &&\n    (value === target || value === target * 2 || value === target * 3)\n  ) {\n    // manual numeric entry fallback\n    if (value === target * 3) {\n      points = target * 3;\n      state.turnHits.triples++;\n    } else if (value === target * 2) {\n      points = target * 2;\n      state.turnHits.doubles++;\n    } else if (value === target) {\n      points = target;\n      state.turnHits.singles++;\n    }\n  }\n  state.score += points;\n  return points;\n}\n\n// Call at end of 3-dart turn; advances round and checks Shanghai\nexport function endShanghaiTurn(state: ShanghaiState) {\n  if (!state.finished) {\n    if (\n      state.turnHits.singles > 0 &&\n      state.turnHits.doubles > 0 &&\n      state.turnHits.triples > 0\n    ) {\n      state.shanghaiAchieved = true;\n      state.finished = true;\n      return;\n    }\n    const next = (state.round + 1) as ShanghaiRound;\n    if (next > 20) {\n      state.finished = true;\n    } else {\n      state.round = next;\n    }\n  }\n  // reset per-turn hits\n  state.turnHits = { singles: 0, doubles: 0, triples: 0 };\n}\n","export type HalveItTarget =\n  | { kind: \"ANY_NUMBER\" }\n  | { kind: \"DOUBLE\"; num: number }\n  | { kind: \"TRIPLE\"; num: number }\n  | { kind: \"BULL\" }\n  | { kind: \"NUMBER\"; num: number };\n\nexport type HalveItState = {\n  stage: number;\n  targets: HalveItTarget[];\n  score: number;\n  finished: boolean;\n  hitThisRound: boolean;\n};\n\nexport function createDefaultHalveIt(): HalveItState {\n  const targets: HalveItTarget[] = [\n    { kind: \"NUMBER\", num: 20 },\n    { kind: \"DOUBLE\", num: 16 },\n    { kind: \"TRIPLE\", num: 14 },\n    { kind: \"NUMBER\", num: 19 },\n    { kind: \"BULL\" },\n    { kind: \"ANY_NUMBER\" },\n  ];\n  return { stage: 0, targets, score: 0, finished: false, hitThisRound: false };\n}\n\nexport function getCurrentHalveTarget(\n  state: HalveItState,\n): HalveItTarget | null {\n  return state.targets[state.stage] || null;\n}\n\nexport function applyHalveItDart(\n  state: HalveItState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): number {\n  if (state.finished) return 0;\n  const t = getCurrentHalveTarget(state);\n  if (!t) return 0;\n  let scored = 0;\n  switch (t.kind) {\n    case \"NUMBER\": {\n      if (typeof sector === \"number\" && sector === t.num) {\n        if (ring === \"TRIPLE\") scored = t.num * 3;\n        else if (ring === \"DOUBLE\") scored = t.num * 2;\n        else if (ring === \"SINGLE\") scored = t.num;\n      } else if (\n        !sector &&\n        (value === t.num || value === t.num * 2 || value === t.num * 3)\n      ) {\n        scored = value;\n      }\n      if (scored > 0) state.hitThisRound = true;\n      break;\n    }\n    case \"DOUBLE\": {\n      if ((ring === \"DOUBLE\" && sector === t.num) || value === t.num * 2) {\n        scored = t.num * 2;\n        state.hitThisRound = true;\n      }\n      break;\n    }\n    case \"TRIPLE\": {\n      if ((ring === \"TRIPLE\" && sector === t.num) || value === t.num * 3) {\n        scored = t.num * 3;\n        state.hitThisRound = true;\n      }\n      break;\n    }\n    case \"BULL\": {\n      if (\n        ring === \"BULL\" ||\n        ring === \"INNER_BULL\" ||\n        value === 25 ||\n        value === 50\n      ) {\n        scored = ring === \"INNER_BULL\" || value === 50 ? 50 : 25;\n        state.hitThisRound = true;\n      }\n      break;\n    }\n    case \"ANY_NUMBER\": {\n      // any valid score counts\n      if (value > 0) {\n        scored = value;\n        state.hitThisRound = true;\n      }\n      break;\n    }\n  }\n  state.score += scored;\n  return scored;\n}\n\nexport function endHalveItTurn(state: HalveItState) {\n  if (state.finished) return;\n  if (!state.hitThisRound) {\n    state.score = Math.floor(state.score / 2);\n  }\n  state.hitThisRound = false;\n  state.stage += 1;\n  if (state.stage >= state.targets.length) state.finished = true;\n}\n","export type HighLowState = {\n  round: number;\n  score: number;\n  target: \"HIGH\" | \"LOW\";\n  finished: boolean;\n};\n\nexport function createHighLow(): HighLowState {\n  return { round: 1, score: 0, target: \"HIGH\", finished: false };\n}\n\nexport function applyHighLowDart(\n  state: HighLowState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): number {\n  if (state.finished) return 0;\n  // For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\n  // When LOW, count only scores <= 10 (any ring) and bull does not count\n  let scored = 0;\n  if (state.target === \"HIGH\") {\n    if (ring === \"INNER_BULL\") scored = 50;\n    else if (typeof sector === \"number\") {\n      const mult = ring === \"TRIPLE\" ? 3 : ring === \"DOUBLE\" ? 2 : 1;\n      const v = sector * mult;\n      if (sector >= 20) scored = v;\n    } else {\n      // manual numeric fallback\n      if (value >= 40) scored = value;\n    }\n  } else {\n    if (typeof sector === \"number\") {\n      const mult = ring === \"TRIPLE\" ? 3 : ring === \"DOUBLE\" ? 2 : 1;\n      const v = sector * mult;\n      if (sector <= 10) scored = v;\n    } else {\n      if (value > 0 && value <= 30) scored = value;\n    }\n  }\n  state.score += scored;\n  return scored;\n}\n\nexport function endHighLowTurn(state: HighLowState) {\n  if (state.finished) return;\n  state.round += 1;\n  if (state.round > 10) {\n    state.finished = true;\n    return;\n  }\n  state.target = state.target === \"HIGH\" ? \"LOW\" : \"HIGH\";\n}\n","export type KillerState = {\n  number: number; // assigned sector 1..20\n  lives: number; // start with 3\n  isKiller: boolean; // became killer by hitting own double\n  eliminated: boolean;\n};\n\nexport function createKillerState(assigned: number, lives = 3): KillerState {\n  return { number: assigned, lives, isKiller: false, eliminated: false };\n}\n\n// Assign unique random numbers (1..20) to each player id\nexport function assignKillerNumbers<T extends string>(\n  playerIds: T[],\n): Record<T, number> {\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1);\n  const res: any = {};\n  for (const id of playerIds) {\n    // pick a random remaining number\n    const idx = Math.floor(Math.random() * pool.length);\n    const num = pool.splice(idx, 1)[0];\n    res[id] = num;\n  }\n  return res;\n}\n\n// Apply a single dart in Killer context.\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\nexport function applyKillerDart(\n  selfId: string,\n  states: Record<string, KillerState>,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\n  const me = states[selfId];\n  if (!me || !sector || !ring) return { becameKiller: false };\n  // Becoming killer: hit your own DOUBLE only\n  if (!me.isKiller && ring === \"DOUBLE\" && sector === me.number) {\n    me.isKiller = true;\n    return { becameKiller: true };\n  }\n  // If already killer, hitting opponents' doubles/triples removes lives\n  if (me.isKiller && (ring === \"DOUBLE\" || ring === \"TRIPLE\")) {\n    const victimId = Object.keys(states).find(\n      (pid) =>\n        pid !== selfId &&\n        !states[pid].eliminated &&\n        states[pid].number === sector,\n    );\n    if (victimId) {\n      const victim = states[victimId];\n      const delta = ring === \"TRIPLE\" ? 2 : 1;\n      victim.lives = Math.max(0, victim.lives - delta);\n      if (victim.lives === 0) victim.eliminated = true;\n      return { becameKiller: false, victimId, livesRemoved: delta };\n    }\n  }\n  return { becameKiller: false };\n}\n\nexport function killerWinner(\n  states: Record<string, KillerState>,\n): string | null {\n  const alive = Object.entries(states).filter(\n    ([, st]) => !st.eliminated && st.lives > 0,\n  );\n  if (alive.length === 1) return alive[0][0];\n  return null;\n}\n","export type BaseballInning = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9;\n\nexport type BaseballState = {\n  inning: BaseballInning;\n  score: number;\n  dartsThisInning: number;\n  finished: boolean;\n};\n\nexport function createBaseball(): BaseballState {\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false };\n}\n\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\nexport function applyBaseballDart(\n  state: BaseballState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\n  sector?: number | null,\n): number {\n  if (state.finished) return 0;\n  let runs = 0;\n  if (typeof sector === \"number\" && sector === state.inning) {\n    if (ring === \"TRIPLE\") runs = 3;\n    else if (ring === \"DOUBLE\") runs = 2;\n    else runs = 1;\n  } else if (\n    !sector &&\n    (value === state.inning ||\n      value === state.inning * 2 ||\n      value === state.inning * 3)\n  ) {\n    runs = value === state.inning * 3 ? 3 : value === state.inning * 2 ? 2 : 1;\n  }\n  state.score += runs;\n  state.dartsThisInning += 1;\n  if (state.dartsThisInning >= 3) {\n    const next = (state.inning + 1) as BaseballInning;\n    if (next > 9) state.finished = true;\n    else {\n      state.inning = next;\n      state.dartsThisInning = 0;\n    }\n  }\n  return runs;\n}\n","export type GolfHole =\n  | 1\n  | 2\n  | 3\n  | 4\n  | 5\n  | 6\n  | 7\n  | 8\n  | 9\n  | 10\n  | 11\n  | 12\n  | 13\n  | 14\n  | 15\n  | 16\n  | 17\n  | 18;\n\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\n\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\n  1: 5,\n  2: 20,\n  3: 1,\n  4: 18,\n  5: 4,\n  6: 13,\n  7: 6,\n  8: 10,\n  9: 15,\n  10: 2,\n  11: 17,\n  12: 3,\n  13: 19,\n  14: 7,\n  15: 16,\n  16: 8,\n  17: 11,\n  18: 14,\n};\n\nexport type GolfState = {\n  hole: GolfHole;\n  strokes: number;\n  dartsThisHole: number;\n  finished: boolean;\n};\n\nexport function createGolf(): GolfState {\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false };\n}\n\nexport function applyGolfDart(\n  state: GolfState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\n  sector?: number | null,\n): boolean {\n  if (state.finished) return false;\n  const target = GOLF_TARGETS[state.hole];\n  state.dartsThisHole += 1;\n  const hit =\n    (typeof sector === \"number\" &&\n      sector === target &&\n      (ring === \"SINGLE\" || ring === \"DOUBLE\" || ring === \"TRIPLE\")) ||\n    (!sector &&\n      (value === target || value === target * 2 || value === target * 3));\n  if (hit) {\n    state.strokes += state.dartsThisHole;\n    // advance to next hole\n    const next = (state.hole + 1) as GolfHole;\n    if (next > 18) state.finished = true;\n    else {\n      state.hole = next;\n      state.dartsThisHole = 0;\n    }\n    return true;\n  }\n  // If not finished and took 3 darts, score 3 and advance hole\n  if (state.dartsThisHole >= 3) {\n    state.strokes += 3;\n    const next = (state.hole + 1) as GolfHole;\n    if (next > 18) state.finished = true;\n    else {\n      state.hole = next;\n      state.dartsThisHole = 0;\n    }\n  }\n  return false;\n}\n","export type TicCell = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8;\n\n// Map grid cells to targets: center uses Bull; edges/corners use numbers.\nexport const TTT_TARGETS: Record<\n  TicCell,\n  { type: \"NUM\" | \"BULL\"; num?: number }\n> = {\n  0: { type: \"NUM\", num: 20 },\n  1: { type: \"NUM\", num: 19 },\n  2: { type: \"NUM\", num: 18 },\n  3: { type: \"NUM\", num: 17 },\n  4: { type: \"BULL\" },\n  5: { type: \"NUM\", num: 16 },\n  6: { type: \"NUM\", num: 15 },\n  7: { type: \"NUM\", num: 14 },\n  8: { type: \"NUM\", num: 13 },\n};\n\nexport type TicTacToeState = {\n  board: Array<\"X\" | \"O\" | null>;\n  turn: \"X\" | \"O\";\n  finished: boolean;\n  winner: \"X\" | \"O\" | \"Draw\" | null;\n};\n\nexport function createTicTacToe(): TicTacToeState {\n  return {\n    board: Array(9).fill(null),\n    turn: \"X\",\n    finished: false,\n    winner: null,\n  };\n}\n\nfunction checkWin(board: Array<\"X\" | \"O\" | null>): \"X\" | \"O\" | \"Draw\" | null {\n  const lines = [\n    [0, 1, 2],\n    [3, 4, 5],\n    [6, 7, 8],\n    [0, 3, 6],\n    [1, 4, 7],\n    [2, 5, 8],\n    [0, 4, 8],\n    [2, 4, 6],\n  ];\n  for (const [a, b, c] of lines) {\n    if (board[a] && board[a] === board[b] && board[a] === board[c])\n      return board[a] as \"X\" | \"O\";\n  }\n  if (board.every((c) => c)) return \"Draw\";\n  return null;\n}\n\nexport function tryClaimCell(\n  state: TicTacToeState,\n  cell: TicCell,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n): boolean {\n  if (state.finished || state.board[cell]) return false;\n  const tgt = TTT_TARGETS[cell];\n  let ok = false;\n  if (tgt.type === \"BULL\")\n    ok =\n      ring === \"BULL\" || ring === \"INNER_BULL\" || value === 25 || value === 50;\n  else if (tgt.type === \"NUM\" && typeof tgt.num === \"number\") {\n    if (typeof sector === \"number\" && sector === tgt.num) ok = true;\n    else if (\n      !sector &&\n      (value === tgt.num || value === tgt.num * 2 || value === tgt.num * 3)\n    )\n      ok = true;\n  }\n  if (!ok) return false;\n  state.board[cell] = state.turn;\n  const w = checkWin(state.board);\n  if (w) {\n    state.finished = true;\n    state.winner = w;\n    return true;\n  }\n  state.turn = state.turn === \"X\" ? \"O\" : \"X\";\n  return true;\n}\n","/**\n * Scam, Fives, and Sevens game logic\n * All three follow a similar score-race pattern:\n * - Players accumulate scores\n * - Only certain numbers count\n * - First to reach target wins\n */\n\n// SCAM/SCUM - Hit targets 1â†’20â†’Bull in sequence\nexport interface ScamState {\n  targetIndex: number; // 0-20 for numbers 1-20, 21 for bull (25/50)\n  darts: number;\n  finished: boolean;\n}\n\nexport function createScamState(): ScamState {\n  return {\n    targetIndex: 0,\n    darts: 0,\n    finished: false,\n  };\n}\n\nexport const SCAM_TARGETS = [\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25,\n];\nexport const SCAM_TARGET_NAMES = [\n  \"1\",\n  \"2\",\n  \"3\",\n  \"4\",\n  \"5\",\n  \"6\",\n  \"7\",\n  \"8\",\n  \"9\",\n  \"10\",\n  \"11\",\n  \"12\",\n  \"13\",\n  \"14\",\n  \"15\",\n  \"16\",\n  \"17\",\n  \"18\",\n  \"19\",\n  \"20\",\n  \"Bull\",\n];\n\nexport function getScamTarget(state: ScamState): number {\n  return SCAM_TARGETS[state.targetIndex];\n}\n\nexport function addScamAuto(\n  state: ScamState,\n  value: number,\n  ring?: string,\n): ScamState {\n  if (state.finished) return state;\n\n  const target = getScamTarget(state);\n  const targetHit =\n    (ring === \"SINGLE\" && value === target) ||\n    (ring === \"DOUBLE\" && value === target) ||\n    (ring === \"TRIPLE\" && value === target) ||\n    (ring === \"INNER_BULL\" && target === 25);\n\n  if (!targetHit) return state;\n\n  // Hit! Move to next target\n  const newIndex = state.targetIndex + 1;\n  const finished = newIndex >= SCAM_TARGETS.length;\n\n  return {\n    targetIndex: newIndex,\n    darts: state.darts + 1,\n    finished,\n  };\n}\n\nexport function addScamNumeric(state: ScamState, value: number): ScamState {\n  // For manual input, assume single ring hit\n  return addScamAuto(state, value, \"SINGLE\");\n}\n\nexport function resetScam(): ScamState {\n  return createScamState();\n}\n\n// FIVES - Only multiples of 5 count (5,10,15,20,25,50)\nexport interface FivesState {\n  score: number;\n  darts: number;\n  finished: boolean;\n  target: number; // default 50\n}\n\nexport function createFivesState(target: number = 50): FivesState {\n  return {\n    score: 0,\n    darts: 0,\n    finished: false,\n    target,\n  };\n}\n\nexport const FIVES_VALID_NUMBERS = [5, 10, 15, 20, 25, 50];\n\nexport function isFivesValid(value: number): boolean {\n  return FIVES_VALID_NUMBERS.includes(value);\n}\n\nexport function addFivesAuto(\n  state: FivesState,\n  value: number,\n  ring?: string,\n): FivesState {\n  if (state.finished) return state;\n\n  // Only multiples of 5 count\n  if (!isFivesValid(value)) {\n    return { ...state, darts: state.darts + 1 };\n  }\n\n  const newScore = state.score + value;\n  const finished = newScore >= state.target;\n\n  return {\n    score: finished ? state.target : newScore,\n    darts: state.darts + 1,\n    finished,\n    target: state.target,\n  };\n}\n\nexport function addFivesNumeric(state: FivesState, value: number): FivesState {\n  return addFivesAuto(state, value, \"SINGLE\");\n}\n\nexport function resetFives(target: number = 50): FivesState {\n  return createFivesState(target);\n}\n\n// SEVENS - Only multiples of 7 count (7,14,21)\nexport interface SevensState {\n  score: number;\n  darts: number;\n  finished: boolean;\n  target: number; // default 70\n}\n\nexport function createSevensState(target: number = 70): SevensState {\n  return {\n    score: 0,\n    darts: 0,\n    finished: false,\n    target,\n  };\n}\n\nexport const SEVENS_VALID_NUMBERS = [7, 14, 21];\n\nexport function isSevensValid(value: number): boolean {\n  return SEVENS_VALID_NUMBERS.includes(value);\n}\n\nexport function addSevensAuto(\n  state: SevensState,\n  value: number,\n  ring?: string,\n): SevensState {\n  if (state.finished) return state;\n\n  // Only multiples of 7 count\n  if (!isSevensValid(value)) {\n    return { ...state, darts: state.darts + 1 };\n  }\n\n  const newScore = state.score + value;\n  const finished = newScore >= state.target;\n\n  return {\n    score: finished ? state.target : newScore,\n    darts: state.darts + 1,\n    finished,\n    target: state.target,\n  };\n}\n\nexport function addSevensNumeric(\n  state: SevensState,\n  value: number,\n): SevensState {\n  return addSevensAuto(state, value, \"SINGLE\");\n}\n\nexport function resetSevens(target: number = 70): SevensState {\n  return createSevensState(target);\n}\n","export type AmCricketMark = 0 | 1 | 2 | 3;\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25;\n\nexport type AmCricketState = {\n  marks: Record<AmCricketNumber, AmCricketMark>;\n  points: number;\n};\n\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [\n  20, 19, 18, 17, 16, 15, 14, 13, 12, 25,\n];\n\nexport function createAmCricketState(): AmCricketState {\n  const marks: any = {};\n  AM_CRICKET_NUMBERS.forEach((n) => {\n    marks[n] = 0;\n  });\n  return { marks, points: 0 };\n}\n\nexport function applyAmCricketDart(\n  state: AmCricketState,\n  value: number,\n  ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  sector?: number | null,\n  opponentClosed: (n: AmCricketNumber) => boolean = () => false,\n): number {\n  let num: AmCricketNumber | null = null;\n  let hits = 0;\n  if (\n    ring === \"BULL\" ||\n    ring === \"INNER_BULL\" ||\n    value === 25 ||\n    value === 50\n  ) {\n    num = 25;\n    hits = ring === \"INNER_BULL\" || value === 50 ? 2 : 1;\n  } else if (typeof sector === \"number\" && sector >= 12 && sector <= 20) {\n    num = sector as AmCricketNumber;\n    if (ring === \"TRIPLE\") hits = 3;\n    else if (ring === \"DOUBLE\") hits = 2;\n    else hits = 1;\n  } else if (value) {\n    for (const c of [20, 19, 18, 17, 16, 15, 14, 13, 12] as AmCricketNumber[]) {\n      if (value === c) {\n        num = c;\n        hits = 1;\n        break;\n      }\n      if (value === c * 2) {\n        num = c;\n        hits = 2;\n        break;\n      }\n      if (value === c * 3) {\n        num = c;\n        hits = 3;\n        break;\n      }\n    }\n    if (!num && (value === 25 || value === 50)) {\n      num = 25;\n      hits = value === 50 ? 2 : 1;\n    }\n  }\n  if (!num) return 0;\n\n  const before = state.marks[num];\n  const toClose = Math.max(0, 3 - before);\n  const toApply = Math.min(toClose, hits);\n  const overflow = Math.max(0, hits - toApply);\n  const after = (before + toApply) as AmCricketMark;\n  state.marks[num] = after > 3 ? 3 : after;\n\n  let points = 0;\n  if (overflow > 0 && !opponentClosed(num)) {\n    if (num === 25) {\n      if (ring === \"INNER_BULL\") points += 50 * overflow;\n      else points += 25 * overflow;\n    } else {\n      points += (num as number) * overflow;\n    }\n  }\n  state.points += points;\n  return points;\n}\n\nexport function hasClosedAllAm(state: AmCricketState): boolean {\n  return AM_CRICKET_NUMBERS.every((n) => (state.marks[n] || 0) >= 3);\n}\n","import type { ReactNode } from \"react\";\n\n// Glassy sticky header bar used across Offline and Online match UIs for visual parity\nexport default function GameHeaderBar({\n  left,\n  right,\n  className = \"\",\n  sticky = true,\n}: {\n  left: ReactNode;\n  right?: ReactNode;\n  className?: string;\n  sticky?: boolean;\n}) {\n  return (\n    <div\n      className={`${sticky ? \"sticky top-0\" : \"\"} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${className}`}\n    >\n      <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent\" />\n      <div className=\"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap\">\n        {left}\n      </div>\n      <div className=\"flex items-center gap-1 flex-wrap justify-end\">\n        {right}\n      </div>\n    </div>\n  );\n}\n","/**\n * Universal Game Scoreboard Component\n * Displays game-specific stats based on the game mode and current game state\n * Works for Online, Offline, and Tournament modes\n */\n\nimport React from \"react\";\n\nexport type GameMode =\n  | \"X01\"\n  | \"Cricket\"\n  | \"Shanghai\"\n  | \"Killer\"\n  | \"High-Low\"\n  | \"Halve It\"\n  | \"Around the Clock\"\n  | \"Double Practice\"\n  | \"Treble Practice\"\n  | \"Count-Up\"\n  | \"High Score\"\n  | \"Low Score\"\n  | \"Checkout 170\"\n  | \"Checkout 121\"\n  | \"American Cricket\"\n  | \"Baseball\"\n  | \"Golf\"\n  | \"Tic Tac Toe\"\n  | \"Bob's 27\"\n  | \"Scam\"\n  | \"Fives\"\n  | \"Sevens\";\n\nexport interface PlayerStats {\n  name: string;\n  isCurrentTurn: boolean;\n  legsWon?: number;\n  score?: number;\n  lastScore?: number;\n  checkoutRate?: number; // 0-100\n  bestLeg?: number | string;\n  // Cricket-specific\n  closed?: Record<number, number>; // { 20: 3, 19: 2, etc }\n  points?: number;\n  // Shanghai-specific\n  round?: number;\n  target?: number;\n  // Killer-specific\n  number?: number;\n  lives?: number;\n  eliminated?: boolean;\n  // Match statistics\n  matchAvg?: number; // Current match 3-dart average\n  allTimeAvg?: number; // Player's all-time 3-dart average\n  // Other generics\n  [key: string]: any;\n}\n\ninterface GameScoreboardProps {\n  gameMode: GameMode;\n  players: PlayerStats[];\n  matchScore?: string; // e.g., \"3-1\"\n  gameRules?: any; // Additional rules/config for the game\n}\n\nexport default function GameScoreboard({\n  gameMode,\n  players,\n  matchScore,\n  gameRules,\n}: GameScoreboardProps) {\n  if (!players || players.length === 0) return null;\n\n  return (\n    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3\">\n      {players.map((player, idx) => (\n        <div\n          key={idx}\n          className={`rounded-lg border p-3 ${\n            player.isCurrentTurn\n              ? \"border-emerald-500/40 bg-emerald-500/10\"\n              : \"border-slate-500/40 bg-slate-500/10\"\n          }`}\n        >\n          <div\n            className={`text-sm font-semibold mb-2 uppercase tracking-wide ${\n              player.isCurrentTurn ? \"text-emerald-300\" : \"text-slate-300\"\n            }`}\n          >\n            {player.name}\n          </div>\n\n          <div className=\"space-y-1 text-sm\">\n            {/* X01 specific */}\n            {gameMode === \"X01\" && (\n              <>\n                <ScoreRow\n                  label=\"Legs Won\"\n                  value={`â— ${player.legsWon || 0}`}\n                  highlight\n                />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n                <ScoreRow\n                  label=\"Last Score\"\n                  value={player.lastScore || \"0\"}\n                  mono\n                />\n                <ScoreRow\n                  label=\"C/Out Rate\"\n                  value={`${player.checkoutRate || 0}%`}\n                  mono\n                />\n                <ScoreRow label=\"Best Leg\" value={player.bestLeg || \"â€”\"} mono />\n                {/* AVG +/- feature */}\n                {player.matchAvg !== undefined &&\n                  player.allTimeAvg !== undefined && (\n                    <>\n                      <div className=\"border-t border-white/20 pt-1 mt-1\">\n                        <ScoreRow\n                          label=\"Match Avg\"\n                          value={player.matchAvg.toFixed(2)}\n                          mono\n                          bold\n                          highlight={player.matchAvg > 0}\n                        />\n                        <AvgDifferenceRow\n                          matchAvg={player.matchAvg}\n                          allTimeAvg={player.allTimeAvg}\n                        />\n                      </div>\n                    </>\n                  )}\n              </>\n            )}\n\n            {/* Cricket & American Cricket specific */}\n            {(gameMode === \"Cricket\" || gameMode === \"American Cricket\") && (\n              <>\n                <ScoreRow\n                  label=\"Closed\"\n                  value={formatCricketClosed(player.closed)}\n                  mono\n                />\n                <ScoreRow label=\"Points\" value={player.points || 0} mono bold />\n                <ScoreRow\n                  label=\"Status\"\n                  value={getCricketStatus(player)}\n                  highlight={player.isCurrentTurn}\n                />\n              </>\n            )}\n\n            {/* Shanghai & Halve It - Round-based */}\n            {(gameMode === \"Shanghai\" || gameMode === \"Halve It\") && (\n              <>\n                <ScoreRow\n                  label={gameMode === \"Shanghai\" ? \"Round\" : \"Stage\"}\n                  value={player.round || 1}\n                  mono\n                />\n                <ScoreRow label=\"Target\" value={player.target || \"â€”\"} mono />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n              </>\n            )}\n\n            {/* Killer specific */}\n            {gameMode === \"Killer\" && (\n              <>\n                <ScoreRow\n                  label=\"Target #\"\n                  value={player.number || \"â€”\"}\n                  mono\n                  bold\n                />\n                <ScoreRow label=\"Lives\" value={player.lives || 0} mono bold />\n                {player.eliminated && (\n                  <ScoreRow\n                    label=\"Status\"\n                    value=\"ELIMINATED\"\n                    highlight={false}\n                  />\n                )}\n              </>\n            )}\n\n            {/* High-Low specific */}\n            {gameMode === \"High-Low\" && (\n              <>\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\n                <ScoreRow label=\"Target\" value={player.target || \"High\"} mono />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n              </>\n            )}\n\n            {/* Practice games */}\n            {(gameMode === \"Double Practice\" ||\n              gameMode === \"Treble Practice\" ||\n              gameMode === \"Around the Clock\") && (\n              <>\n                <ScoreRow\n                  label=\"Target\"\n                  value={player.target || \"â€”\"}\n                  mono\n                  bold\n                />\n                <ScoreRow label=\"Hits\" value={player.hits || 0} mono bold />\n                {player.totalNeeded && (\n                  <ScoreRow\n                    label=\"Progress\"\n                    value={`${player.hits || 0} / ${player.totalNeeded}`}\n                    mono\n                  />\n                )}\n              </>\n            )}\n\n            {/* Count-Up, High Score, Low Score */}\n            {(gameMode === \"Count-Up\" ||\n              gameMode === \"High Score\" ||\n              gameMode === \"Low Score\") && (\n              <>\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n                {gameMode === \"High Score\" && (\n                  <ScoreRow label=\"Best\" value={player.bestScore || 0} mono />\n                )}\n              </>\n            )}\n\n            {/* Checkout challenges */}\n            {(gameMode === \"Checkout 170\" || gameMode === \"Checkout 121\") && (\n              <>\n                <ScoreRow\n                  label=\"Remaining\"\n                  value={player.remaining || 0}\n                  mono\n                  bold\n                />\n                <ScoreRow label=\"Attempts\" value={player.attempts || 0} mono />\n                <ScoreRow\n                  label=\"Successes\"\n                  value={player.successes || 0}\n                  mono\n                />\n              </>\n            )}\n\n            {/* Bob's 27 */}\n            {gameMode === \"Bob's 27\" && (\n              <>\n                <ScoreRow\n                  label=\"Target\"\n                  value={`D${player.target || 1}`}\n                  mono\n                  bold\n                />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n              </>\n            )}\n\n            {/* Baseball & Golf */}\n            {gameMode === \"Baseball\" && (\n              <>\n                <ScoreRow label=\"Inning\" value={player.inning || 1} mono />\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\n              </>\n            )}\n\n            {gameMode === \"Golf\" && (\n              <>\n                <ScoreRow label=\"Hole\" value={player.hole || 1} mono />\n                <ScoreRow\n                  label=\"Strokes\"\n                  value={player.strokes || 0}\n                  mono\n                  bold\n                />\n              </>\n            )}\n\n            {/* Tic Tac Toe */}\n            {gameMode === \"Tic Tac Toe\" && (\n              <>\n                <ScoreRow label=\"Turn\" value={player.turn || 1} mono />\n                {player.winner && (\n                  <ScoreRow label=\"Result\" value=\"WINNER!\" highlight />\n                )}\n              </>\n            )}\n\n            {/* Match score display for competitive games */}\n            {matchScore &&\n              (gameMode === \"X01\" ||\n                gameMode === \"Cricket\" ||\n                gameMode === \"American Cricket\") &&\n              idx === 1 && (\n                <div className=\"border-t border-white/10 pt-1 mt-1\">\n                  <ScoreRow\n                    label=\"Match\"\n                    value={matchScore}\n                    mono\n                    bold\n                    highlight\n                  />\n                </div>\n              )}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\n// Helper component for consistent score row display\nfunction ScoreRow({\n  label,\n  value,\n  mono = false,\n  bold = false,\n  highlight = false,\n}: {\n  label: string;\n  value: string | number;\n  mono?: boolean;\n  bold?: boolean;\n  highlight?: boolean;\n}) {\n  return (\n    <div className=\"flex justify-between\">\n      <span className=\"opacity-70\">{label}:</span>\n      <span\n        className={`${mono ? \"font-mono\" : \"\"} ${bold ? \"font-semibold\" : \"\"} ${\n          highlight ? \"text-emerald-300\" : \"\"\n        }`}\n      >\n        {value}\n      </span>\n    </div>\n  );\n}\n\n// AVG +/- component showing difference from all-time average\nfunction AvgDifferenceRow({\n  matchAvg,\n  allTimeAvg,\n}: {\n  matchAvg: number;\n  allTimeAvg: number;\n}) {\n  const diff = matchAvg - allTimeAvg;\n  const isPositive = diff > 0;\n  const isNeutral = Math.abs(diff) < 0.01;\n\n  let diffText = \"\";\n  let diffColor = \"text-slate-300\";\n\n  if (isNeutral) {\n    diffText = \"= All-time\";\n    diffColor = \"text-slate-300\";\n  } else if (isPositive) {\n    diffText = `+${diff.toFixed(2)} vs avg`;\n    diffColor = \"text-emerald-400\";\n  } else {\n    diffText = `${diff.toFixed(2)} vs avg`;\n    diffColor = \"text-orange-400\";\n  }\n\n  return (\n    <div className=\"flex justify-between\">\n      <span className=\"opacity-70\">AVG vs Avg:</span>\n      <span className={`font-mono font-semibold ${diffColor}`}>{diffText}</span>\n    </div>\n  );\n}\n\n// Cricket helpers\nfunction formatCricketClosed(closed?: Record<number, number>): string {\n  if (!closed || Object.keys(closed).length === 0) return \"â€”\";\n  const closedNumbers = Object.entries(closed)\n    .filter(([_, count]) => count === 3)\n    .map(([num]) => (num === \"25\" ? \"B\" : num))\n    .join(\",\");\n  return closedNumbers || \"â€”\";\n}\n\nfunction getCricketStatus(player: PlayerStats): string {\n  if (!player.closed) return \"Starting\";\n  const closedCount = Object.values(player.closed).filter(\n    (c) => c === 3,\n  ).length;\n  if (closedCount === 0) return \"No marks\";\n  if (closedCount < 7) return `${closedCount}/7`;\n  return \"Closing in\";\n}\n","// Small adapter helpers to convert generic MatchControls onAddVisit callbacks to the local handlers\nexport function makeOnlineAddVisitAdapter(\n  submitVisitManual: (v: number) => void,\n) {\n  return (score: number, darts: number) => {\n    submitVisitManual(score);\n  };\n}\n\nexport function makeOfflineAddVisitAdapter(\n  commitManualVisitTotal: (v: number) => boolean,\n) {\n  return (score: number, darts: number) => {\n    commitManualVisitTotal(score);\n  };\n}\n","import type { Actions as MatchActions } from \"../store/match\";\n\nexport type UnifiedMatchActions = {\n  addVisit: (score: number, darts?: number, meta?: any) => void;\n  undoVisit: () => void;\n  nextPlayer: () => void;\n  endLeg: (score?: number) => void;\n  endGame: () => void;\n};\n\nexport function createOnlineMatchActions(args: {\n  match: MatchActions;\n  sendState: () => void;\n  submitVisitManual?: (v: number) => void;\n}): UnifiedMatchActions {\n  const { match, sendState, submitVisitManual } = args;\n  return {\n    addVisit: (score: number, darts = 3, meta?: any) => {\n      // Prefer the manual submit helper when available as it computes double/finish meta\n      if (submitVisitManual) {\n        submitVisitManual(score);\n        return;\n      }\n      try {\n        match.addVisit(score, darts, meta);\n      } catch {\n        match.addVisit(score, darts);\n      }\n      try {\n        sendState();\n      } catch {}\n    },\n    undoVisit: () => {\n      match.undoVisit();\n      try {\n        sendState();\n      } catch {}\n    },\n    nextPlayer: () => {\n      match.nextPlayer();\n      try {\n        sendState();\n      } catch {}\n    },\n    endLeg: (score?: number) => {\n      if (typeof score === \"number\") match.endLeg(score);\n      else match.endLeg(0);\n      try {\n        sendState();\n      } catch {}\n    },\n    endGame: () => {\n      match.endGame();\n      try {\n        sendState();\n      } catch {}\n    },\n  };\n}\n\nexport function createOfflineMatchActions(args: {\n  match: MatchActions;\n  commitManualVisitTotal?: (v: number) => boolean;\n  endTurn?: (nextRemaining: number) => void;\n}): UnifiedMatchActions {\n  const { match, commitManualVisitTotal, endTurn } = args;\n  return {\n    addVisit: (score: number, darts = 3, meta?: any) => {\n      if (commitManualVisitTotal) {\n        commitManualVisitTotal(score);\n        return;\n      }\n      try {\n        match.addVisit(score, darts, meta);\n      } catch {\n        match.addVisit(score, darts);\n      }\n    },\n    undoVisit: () => {\n      match.undoVisit();\n    },\n    nextPlayer: () => {\n      if (endTurn) {\n        try {\n          endTurn(0);\n        } catch {\n          match.nextPlayer();\n        }\n      } else {\n        match.nextPlayer();\n      }\n    },\n    endLeg: (score?: number) => {\n      if (typeof score === \"number\") match.endLeg(score);\n      else match.endLeg(0);\n    },\n    endGame: () => {\n      match.endGame();\n    },\n  };\n}\n","/**\n * Hook to convert OfflinePlay game state to GameScoreboard format\n */\n\nimport { useMemo } from \"react\";\nimport type { PlayerStats } from \"./GameScoreboard\";\nimport type { GameMode } from \"./GameScoreboard\";\nimport { getAllTimeAvg } from \"../../store/profileStats\";\n\nexport function useOfflineGameStats(\n  gameMode: GameMode,\n  // X01 state\n  playerScore?: number,\n  aiScore?: number,\n  playerLegs?: number,\n  aiLegs?: number,\n  playerLastDart?: number,\n  aiLastDart?: number,\n  playerVisitSum?: number,\n  aiVisitSum?: number,\n  playerLastVisitScore?: number | null,\n  aiLastVisitScore?: number | null,\n  playerVisitDartCount?: number,\n  aiVisitDartCount?: number,\n  playerDoublesHit?: number,\n  playerDoublesAtt?: number,\n  aiDoublesHit?: number,\n  aiDoublesAtt?: number,\n  legStats?: Array<any>,\n  isPlayerTurn?: boolean,\n  ai?: string,\n  x01Score?: number,\n  // Cricket state\n  cricket?: any,\n  // Shanghai state\n  shanghai?: any,\n  // Killer state\n  killerPlayers?: Array<any>,\n  killerStates?: Record<string, any>,\n  killerAssigned?: Record<string, number>,\n  killerTurnIdx?: number,\n): PlayerStats[] {\n  return useMemo(() => {\n    const players: PlayerStats[] = [];\n\n    if (gameMode === \"X01\") {\n      // Calculate player match average\n      let playerMatchAvg = 0;\n      let playerDarts = 0;\n      let playerScored = 0;\n      if (legStats && legStats.length > 0) {\n        for (const leg of legStats) {\n          if (leg.dartsThrown && leg.totalScored) {\n            playerDarts += leg.dartsThrown;\n            playerScored += leg.totalScored;\n          }\n        }\n        if (playerDarts > 0) {\n          playerMatchAvg = (playerScored / playerDarts) * 3;\n        }\n      }\n\n      // Player card\n      const playerVisitDarts = playerVisitDartCount ?? 0;\n      const playerCurrentVisitActive = playerVisitDarts > 0;\n      const playerCurrentVisitSum = playerVisitSum ?? 0;\n      const playerLastVisitTotal = playerLastVisitScore ?? null;\n      const playerLastDartValue = playerLastDart ?? 0;\n      const resolvedPlayerLastScore = playerCurrentVisitActive\n        ? playerCurrentVisitSum\n        : (playerLastVisitTotal ?? playerLastDartValue);\n\n      players.push({\n        name: \"You\",\n        isCurrentTurn: !!isPlayerTurn,\n        legsWon: playerLegs || 0,\n        score: playerScore || 0,\n        lastScore: resolvedPlayerLastScore,\n        checkoutRate:\n          playerDoublesAtt && playerDoublesAtt > 0\n            ? Math.round(((playerDoublesHit || 0) / playerDoublesAtt) * 100)\n            : 0,\n        bestLeg:\n          legStats && legStats.length > 0\n            ? `${Math.min(...legStats.map((l) => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\n            : \"â€”\",\n        matchAvg: playerMatchAvg,\n        allTimeAvg: getAllTimeAvg(\"You\") || 0,\n      });\n\n      // AI card (if playing against AI)\n      if (ai && ai !== \"None\") {\n        const aiVisitDarts = aiVisitDartCount ?? 0;\n        const aiCurrentVisitActive = aiVisitDarts > 0;\n        const aiCurrentVisitSum = aiVisitSum ?? 0;\n        const aiLastVisitTotal = aiLastVisitScore ?? null;\n        const aiLastDartValue = aiLastDart ?? 0;\n        const resolvedAiLastScore = aiCurrentVisitActive\n          ? aiCurrentVisitSum\n          : (aiLastVisitTotal ?? aiLastDartValue);\n\n        players.push({\n          name: `${ai} AI`,\n          isCurrentTurn: !isPlayerTurn,\n          legsWon: aiLegs || 0,\n          score: aiScore || 0,\n          lastScore: resolvedAiLastScore,\n          checkoutRate:\n            aiDoublesAtt && aiDoublesAtt > 0\n              ? Math.round(((aiDoublesHit || 0) / aiDoublesAtt) * 100)\n              : 0,\n          bestLeg: \"â€”\",\n        });\n      }\n    }\n\n    if (gameMode === \"Cricket\") {\n      players.push({\n        name: \"You\",\n        isCurrentTurn: !!isPlayerTurn,\n        closed: cricket?.marks || {},\n        points: cricket?.points || 0,\n      });\n\n      if (ai && ai !== \"None\") {\n        players.push({\n          name: `${ai} AI`,\n          isCurrentTurn: !isPlayerTurn,\n          closed: {},\n          points: 0,\n        });\n      }\n    }\n\n    if (gameMode === \"Shanghai\") {\n      players.push({\n        name: \"You\",\n        isCurrentTurn: !!isPlayerTurn,\n        round: shanghai?.round || 1,\n        target: shanghai?.target || 1,\n        score: shanghai?.score || 0,\n      });\n\n      if (ai && ai !== \"None\") {\n        players.push({\n          name: `${ai} AI`,\n          isCurrentTurn: !isPlayerTurn,\n          round: shanghai?.round || 1,\n          target: shanghai?.target || 1,\n          score: 0,\n        });\n      }\n    }\n\n    if (gameMode === \"Killer\" && killerPlayers && killerPlayers.length > 0) {\n      killerPlayers.forEach((p, idx) => {\n        const state = killerStates?.[p.id];\n        players.push({\n          name: p.name,\n          isCurrentTurn: idx === killerTurnIdx,\n          number: killerAssigned?.[p.id],\n          lives: state?.lives || 0,\n          eliminated: state?.eliminated || false,\n        });\n      });\n    }\n\n    return players;\n  }, [\n    gameMode,\n    playerScore,\n    aiScore,\n    playerLegs,\n    aiLegs,\n    playerLastDart,\n    aiLastDart,\n    playerVisitSum,\n    aiVisitSum,\n    playerLastVisitScore,\n    aiLastVisitScore,\n    playerVisitDartCount,\n    aiVisitDartCount,\n    playerDoublesHit,\n    playerDoublesAtt,\n    aiDoublesHit,\n    aiDoublesAtt,\n    legStats,\n    isPlayerTurn,\n    ai,\n    cricket,\n    shanghai,\n    killerPlayers,\n    killerStates,\n    killerAssigned,\n    killerTurnIdx,\n  ]);\n}\n\nexport function useOnlineGameStats(\n  gameMode: GameMode,\n  matchState?: any, // From useMatch() store\n  participants?: string[],\n): PlayerStats[] {\n  return useMemo(() => {\n    const players: PlayerStats[] = [];\n\n    if (!matchState || !matchState.players || matchState.players.length === 0) {\n      return players;\n    }\n\n    matchState.players.forEach((player: any, idx: number) => {\n      const isCurrentTurn = idx === matchState.currentPlayerIdx;\n\n      if (gameMode === \"X01\") {\n        // Calculate match average for this player\n        let matchAvg = 0;\n        let totalDarts = 0;\n        let totalScored = 0;\n\n        if (player.legs && player.legs.length > 0) {\n          for (const leg of player.legs) {\n            if (leg.finished) {\n              const legDarts = leg.dartsThrown || 0;\n              const legScored =\n                Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining) || 0;\n              totalDarts += legDarts;\n              totalScored += legScored;\n            }\n          }\n        }\n\n        if (totalDarts > 0) {\n          matchAvg = (totalScored / totalDarts) * 3;\n        }\n\n        players.push({\n          name: player.name || `Player ${idx + 1}`,\n          isCurrentTurn,\n          legsWon: player.legsWon || 0,\n          score: player.score || 0,\n          lastScore: player.lastVisitScore || 0,\n          checkoutRate:\n            player.doublesAttempted > 0\n              ? Math.round((player.doublesHit / player.doublesAttempted) * 100)\n              : 0,\n          bestLeg: player.bestLegDarts ? `${player.bestLegDarts} darts` : \"â€”\",\n          matchAvg: matchAvg,\n          allTimeAvg: player.name ? getAllTimeAvg(player.name) : 0,\n        });\n      }\n\n      if (gameMode === \"Cricket\") {\n        players.push({\n          name: player.name || `Player ${idx + 1}`,\n          isCurrentTurn,\n          closed: player.cricket?.marks || {},\n          points: player.cricket?.points || 0,\n        });\n      }\n\n      if (gameMode === \"Killer\") {\n        players.push({\n          name: player.name || `Player ${idx + 1}`,\n          isCurrentTurn,\n          number: player.killerNumber || null,\n          lives: player.killerLives || 3,\n          eliminated: player.killerEliminated || false,\n        });\n      }\n    });\n\n    return players;\n  }, [gameMode, matchState, participants]);\n}\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { suggestCheckouts, sayScore } from \"../utils/checkout\";\nimport { useUserSettings } from \"../store/userSettings\";\nimport { useToast } from \"../store/toast\";\nimport { useCalibration } from \"../store/calibration\";\nimport GameCalibrationStatus from \"./GameCalibrationStatus\";\nimport CameraTile from \"./CameraTile\";\nimport CameraView from \"./CameraView\";\nimport HeatMap from \"./HeatMap\";\nimport { getUserCurrency, formatPriceInCurrency } from \"../utils/config\";\nimport { bumpGameMode } from \"../store/profileStats\";\nimport {\n  DOUBLE_PRACTICE_ORDER,\n  isDoubleHit,\n  parseManualDart,\n} from \"../game/types\";\nimport { ATC_ORDER } from \"../game/aroundTheClock\";\nimport {\n  createCricketState,\n  applyCricketDart,\n  CRICKET_NUMBERS,\n  hasClosedAll as cricketClosedAll,\n} from \"../game/cricket\";\nimport {\n  createShanghaiState,\n  applyShanghaiDart,\n  endShanghaiTurn,\n} from \"../game/shanghai\";\nimport {\n  createDefaultHalveIt,\n  getCurrentHalveTarget,\n  applyHalveItDart,\n  endHalveItTurn,\n} from \"../game/halveIt\";\nimport {\n  createHighLow,\n  applyHighLowDart,\n  endHighLowTurn,\n} from \"../game/highLow\";\nimport {\n  createKillerState,\n  assignKillerNumbers,\n  applyKillerDart,\n  killerWinner,\n  KillerState,\n} from \"../game/killer\";\nimport { createBaseball, applyBaseballDart } from \"../game/baseball\";\nimport { createGolf, applyGolfDart } from \"../game/golf\";\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from \"../game/ticTacToe\";\nimport {\n  createScamState,\n  addScamAuto,\n  addScamNumeric,\n  resetScam,\n  getScamTarget,\n  SCAM_TARGET_NAMES,\n  ScamState,\n  createFivesState,\n  addFivesAuto,\n  addFivesNumeric,\n  resetFives,\n  FivesState,\n  createSevensState,\n  addSevensAuto,\n  addSevensNumeric,\n  resetSevens,\n  SevensState,\n} from \"../game/scamFivesSevens\";\nimport {\n  createAmCricketState,\n  applyAmCricketDart,\n  AM_CRICKET_NUMBERS,\n  hasClosedAllAm,\n} from \"../game/americanCricket\";\nimport ResizableModal from \"./ui/ResizableModal\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase\";\nimport { useAudit } from \"../store/audit\";\nimport ResizablePanel from \"./ui/ResizablePanel\";\nimport GameHeaderBar from \"./ui/GameHeaderBar\";\nimport GameScoreboard, { type PlayerStats } from \"./scoreboards/GameScoreboard\";\nimport MatchControls from \"./MatchControls\";\nimport { makeOfflineAddVisitAdapter } from \"./matchControlAdapters\";\nimport {\n  createOfflineMatchActions,\n  UnifiedMatchActions,\n} from \"../logic/matchActions\";\nimport { useMatch } from \"../store/match\";\nimport { useOfflineGameStats } from \"./scoreboards/useGameStats\";\nimport { freeGames, premiumGames, allGames } from \"../utils/games\";\n\nconst aiLevels = [\"Easy\", \"Medium\", \"Hardened\"];\n\nfunction clamp(n: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, n));\n}\n\ntype PendingAutoVisit = {\n  visitTotal: number;\n  darts: number;\n  preRemaining: number;\n  remaining: number;\n  doubleAttempts: number;\n  finished: boolean;\n  doubleWindow: boolean;\n  highestCheckout?: number | null;\n  announced?: boolean;\n};\n\nconst BOARD_CLEAR_GRACE_MS = 6500;\n\nfunction aiVisitScore(remaining: number, level: string): number {\n  let target = 0;\n  if (level === \"Easy\") {\n    const candidates = [22, 26, 41, 45, 60];\n    target = candidates[Math.floor(Math.random() * candidates.length)];\n  } else if (level === \"Medium\") {\n    target = Math.round(clamp(60 + (Math.random() * 30 - 15), 30, 100));\n  } else {\n    target = Math.round(clamp(80 + (Math.random() * 20 - 10), 50, 120));\n  }\n  if (remaining <= 0) return 0;\n  if (target > remaining) {\n    const safe = [100, 85, 81, 60, 57, 45, 41, 26, 22, 20, 1].find(\n      (v) => v <= remaining,\n    );\n    return safe ?? 0;\n  }\n  return target;\n}\n\nfunction X01RulesPopup({ onClose }: { onClose: () => void }) {\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\n      <div className=\"card max-w-lg w-full relative\">\n        <button\n          className=\"absolute top-2 right-2 btn px-2 py-1\"\n          onClick={onClose}\n        >\n          Close\n        </button>\n        <h3 className=\"text-xl font-bold mb-2\">X01 Rules & Regulations</h3>\n        <ul className=\"list-disc pl-5 text-left mb-2\">\n          <li>Double In: Start scoring only after hitting a double.</li>\n          <li>\n            Double Out: Finish the game by hitting a double to reach exactly\n            zero.\n          </li>\n          <li>\n            Best Of: Play a set number of legs, winner is first to reach\n            majority.\n          </li>\n          <li>First To: Play until a player reaches a set number of legs.</li>\n          <li>\n            No Cheating: All scores must be valid, no manual score changes\n            mid-leg.\n          </li>\n          <li>\n            Competitive Standard: Follow latest WDF/PDC rules for match play.\n          </li>\n        </ul>\n        <p className=\"text-sm text-slate-600\">\n          For full details, see official darts governing body rules.\n        </p>\n      </div>\n    </div>\n  );\n}\n\nconst API_URL = (import.meta as any).env?.VITE_API_URL || \"\";\n\nexport default function OfflinePlay({ user }: { user: any }) {\n  const {\n    offlineLayout,\n    favoriteDouble,\n    callerEnabled,\n    callerVoice,\n    callerVolume,\n    speakCheckoutOnly,\n    rememberLastOffline,\n    setLastOffline,\n    autoStartOffline,\n    cameraScale,\n    setCameraScale,\n    cameraAspect = \"wide\",\n    setCameraAspect,\n    cameraFitMode = \"fill\",\n    setCameraFitMode,\n    cameraEnabled,\n    textSize,\n    boxSize,\n    autoscoreProvider,\n    autoCommitMode = \"wait-for-clear\",\n    matchType = \"singles\",\n    setMatchType,\n    teamAName = \"Team A\",\n    setTeamAName,\n    teamBName = \"Team B\",\n    setTeamBName,\n  } = useUserSettings();\n  const manualScoring = autoscoreProvider === \"manual\";\n  const cameraToolbarVisible = cameraEnabled && !manualScoring;\n  const waitForBoardClear =\n    cameraEnabled && !manualScoring && autoCommitMode !== \"immediate\";\n  const [selectedMode, setSelectedMode] = useState<string>(\"X01\");\n  const [x01Score, setX01Score] = useState(501);\n  const [ai, setAI] = useState(\"None\");\n  const [showRules, setShowRules] = useState(false);\n  const [inMatch, setInMatch] = useState(false);\n  const [playerScore, setPlayerScore] = useState(x01Score);\n  const [aiScore, setAiScore] = useState(x01Score);\n  const [onDouble, setOnDouble] = useState(false);\n  const [showWinPopup, setShowWinPopup] = useState(false);\n  // Match format: First-to selector and leg counters\n  const [firstTo, setFirstTo] = useState<number>(1);\n  const [playerLegs, setPlayerLegs] = useState<number>(0);\n  const match = useMatch();\n  const [showStartShowcase, setShowStartShowcase] = useState(false);\n  const startedShowcasedRef = useRef(false);\n  const [aiLegs, setAiLegs] = useState<number>(0);\n  // Placeholder for unified offline actions; once commitManualVisitTotal/endTurn defined, we'll assign\n\n  const [pendingLegWinner, setPendingLegWinner] = useState<\n    \"player\" | \"ai\" | null\n  >(null);\n  const [doubleDarts, setDoubleDarts] = useState(1);\n  const [checkoutDarts, setCheckoutDarts] = useState(1);\n  const [legStats, setLegStats] = useState<\n    {\n      winner: \"player\" | \"ai\";\n      doubleDarts: number;\n      checkoutDarts: number;\n      winnerDarts: number;\n      doublesAtt?: number;\n      doublesHit?: number;\n    }[]\n  >([]);\n  // New: pre-game adjustable AI delay (ms)\n  const [aiDelayMs, setAiDelayMs] = useState<number>(2000);\n  const toast = useToast();\n  // New: match popup state\n  const [showMatchModal, setShowMatchModal] = useState(false);\n  // Mirror Online layout defaults when in modern layout, otherwise keep classic feel\n  const [maximized, setMaximized] = useState(offlineLayout === \"modern\");\n  const [fitAll, setFitAll] = useState(offlineLayout === \"modern\");\n  // React to layout changes at runtime\n  useEffect(() => {\n    setMaximized(offlineLayout === \"modern\");\n    setFitAll(offlineLayout === \"modern\");\n  }, [offlineLayout]);\n  useEffect(() => {\n    if (cameraFitMode !== \"fit\") {\n      setCameraFitMode(\"fit\");\n    }\n  }, [cameraFitMode, setCameraFitMode]);\n  const [fitScale, setFitScale] = useState(1);\n  const [fitOverflowing, setFitOverflowing] = useState(false);\n  const [isPlayerTurn, setIsPlayerTurn] = useState(true);\n  useEffect(() => {\n    const handleOpenManager = () => setShowCameraManager(true);\n    window.addEventListener(\"ndn:open-camera-manager\", handleOpenManager);\n    return () =>\n      window.removeEventListener(\"ndn:open-camera-manager\", handleOpenManager);\n  }, []);\n  // Per-dart input and stats\n  const [playerDartPoints, setPlayerDartPoints] = useState<number>(0);\n  const [dpIndex, setDpIndex] = useState<number>(0); // 0..20 (DBULL at 20)\n  const [dpHits, setDpHits] = useState<number>(0);\n  // Around the Clock (offline practice)\n  const [atcIndex, setAtcIndex] = useState<number>(0);\n  const [atcHits, setAtcHits] = useState<number>(0);\n  // Practice mode states\n  const [cricket, setCricket] = useState(createCricketState());\n  const [shanghai, setShanghai] = useState(createShanghaiState());\n  const [halve, setHalve] = useState(createDefaultHalveIt());\n  const [highlow, setHighlow] = useState(createHighLow());\n  const [practiceTurnDarts, setPracticeTurnDarts] = useState<number>(0);\n  // Phase 1 practice modes\n  const [b27Stage, setB27Stage] = useState<number>(1);\n  const [b27Score, setB27Score] = useState<number>(27);\n  const [b27Darts, setB27Darts] = useState<number>(0);\n  const [b27Hits, setB27Hits] = useState<number>(0);\n  const [b27Finished, setB27Finished] = useState<boolean>(false);\n  const [cuRound, setCuRound] = useState<number>(1);\n  const [cuScore, setCuScore] = useState<number>(0);\n  const [cuDarts, setCuDarts] = useState<number>(0);\n  const cuMaxRounds = 8;\n  const [hsRound, setHsRound] = useState<number>(1);\n  const [hsScore, setHsScore] = useState<number>(0);\n  const [hsDarts, setHsDarts] = useState<number>(0);\n  const hsMaxRounds = 10;\n  const [lsRound, setLsRound] = useState<number>(1);\n  const [lsScore, setLsScore] = useState<number>(0);\n  const [lsDarts, setLsDarts] = useState<number>(0);\n  const lsMaxRounds = 10;\n  const [co170Rem, setCo170Rem] = useState<number>(170);\n  const [co170Darts, setCo170Darts] = useState<number>(0);\n  const [co170Attempts, setCo170Attempts] = useState<number>(0);\n  const [co170Successes, setCo170Successes] = useState<number>(0);\n  const [co121Rem, setCo121Rem] = useState<number>(121);\n  const [co121Darts, setCo121Darts] = useState<number>(0);\n  const [co121Attempts, setCo121Attempts] = useState<number>(0);\n  const [co121Successes, setCo121Successes] = useState<number>(0);\n  const [trebleTarget, setTrebleTarget] = useState<number>(20);\n  const [trebleHits, setTrebleHits] = useState<number>(0);\n  const [trebleDarts, setTrebleDarts] = useState<number>(0);\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30);\n  const [trebleFinished, setTrebleFinished] = useState<boolean>(false);\n  // Phase 2 states\n  const [baseball, setBaseball] = useState(createBaseball());\n  const [golf, setGolf] = useState(createGolf());\n  const [ttt, setTTT] = useState(createTicTacToe());\n  const [amCricket, setAmCricket] = useState(createAmCricketState());\n  // Killer (hotseat) state\n  const [killerPlayers, setKillerPlayers] = useState<\n    Array<{ id: string; name: string }>\n  >([\n    { id: \"p1\", name: \"Player 1\" },\n    { id: \"p2\", name: \"Player 2\" },\n  ]);\n  const [killerStates, setKillerStates] = useState<Record<string, KillerState>>(\n    {},\n  );\n  const [killerAssigned, setKillerAssigned] = useState<Record<string, number>>(\n    {},\n  );\n  const [killerSetupDone, setKillerSetupDone] = useState<boolean>(false);\n  const [killerTurnIdx, setKillerTurnIdx] = useState<number>(0);\n  const [killerDarts, setKillerDarts] = useState<number>(0);\n  const [killerWinnerId, setKillerWinnerId] = useState<string | null>(null);\n  const [killerLastEvent, setKillerLastEvent] = useState<string>(\"\");\n  // Scam/Scum state\n  const [scam, setScam] = useState(createScamState());\n  const [scamPlayer, setScamPlayer] = useState(createScamState());\n  // Fives state\n  const [fives, setFives] = useState(createFivesState(50));\n  const [fivesPlayer, setFivesPlayer] = useState(createFivesState(50));\n  // Sevens state\n  const [sevens, setSevens] = useState(createSevensState(70));\n  const [sevensPlayer, setSevensPlayer] = useState(createSevensState(70));\n  const [playerDartsThrown, setPlayerDartsThrown] = useState<number>(0);\n  const [playerLastDart, setPlayerLastDart] = useState<number>(0);\n  const [playerVisitDarts, setPlayerVisitDarts] = useState<number>(0);\n  const [playerVisitStart, setPlayerVisitStart] = useState<number>(x01Score);\n  const [playerVisitSum, setPlayerVisitSum] = useState<number>(0);\n  const [playerLastVisitScore, setPlayerLastVisitScore] = useState<\n    number | null\n  >(null);\n  const [playerVisitDartsAtDouble, setPlayerVisitDartsAtDouble] =\n    useState<number>(0);\n  const lastBounceMissTsRef = useRef<number>(0);\n  const lastVisitDartsRef = useRef<number>(0);\n  const playerScoreRef = useRef<number>(playerScore);\n  const playerVisitDartsRef = useRef<number>(playerVisitDarts);\n  const playerVisitSumRef = useRef<number>(playerVisitSum);\n  const playerVisitStartRef = useRef<number>(playerVisitStart);\n  const playerVisitDartsAtDoubleRef = useRef<number>(playerVisitDartsAtDouble);\n\n  useEffect(() => {\n    playerScoreRef.current = playerScore;\n  }, [playerScore]);\n  useEffect(() => {\n    playerVisitDartsRef.current = playerVisitDarts;\n  }, [playerVisitDarts]);\n  useEffect(() => {\n    playerVisitSumRef.current = playerVisitSum;\n  }, [playerVisitSum]);\n  useEffect(() => {\n    playerVisitStartRef.current = playerVisitStart;\n  }, [playerVisitStart]);\n  useEffect(() => {\n    playerVisitDartsAtDoubleRef.current = playerVisitDartsAtDouble;\n  }, [playerVisitDartsAtDouble]);\n  const [aiCountdownMs, setAiCountdownMs] = useState<number>(0);\n  const aiTimerRef = useRef<number | null>(null);\n  const [aiDartsThrown, setAiDartsThrown] = useState<number>(0);\n  const [aiLastDart, setAiLastDart] = useState<number>(0);\n  const [aiVisitSum, setAiVisitSum] = useState<number>(0);\n  const [aiVisitDarts, setAiVisitDarts] = useState<number>(0);\n  const [aiLastVisitScore, setAiLastVisitScore] = useState<number | null>(null);\n  const [aiVisitDartsAtDouble, setAiVisitDartsAtDouble] = useState<number>(0);\n  // Doubles attempts/hits\n  const [playerDoublesAtt, setPlayerDoublesAtt] = useState<number>(0);\n  const [playerDoublesHit, setPlayerDoublesHit] = useState<number>(0);\n  const [aiDoublesAtt, setAiDoublesAtt] = useState<number>(0);\n  const [aiDoublesHit, setAiDoublesHit] = useState<number>(0);\n  // Match-long totals for averages\n  const [totalPlayerDarts, setTotalPlayerDarts] = useState<number>(0);\n  const [totalAiDarts, setTotalAiDarts] = useState<number>(0);\n  const [totalPlayerPoints, setTotalPlayerPoints] = useState<number>(0);\n  const [totalAiPoints, setTotalAiPoints] = useState<number>(0);\n  // Power scoring and checkout highs\n  const [player180s, setPlayer180s] = useState<number>(0);\n  const [player140s, setPlayer140s] = useState<number>(0);\n  const [player100s, setPlayer100s] = useState<number>(0);\n  const [ai180s, setAi180s] = useState<number>(0);\n  const [ai140s, setAi140s] = useState<number>(0);\n  const [ai100s, setAi100s] = useState<number>(0);\n  const [playerHighestCheckout, setPlayerHighestCheckout] = useState<number>(0);\n  const [aiHighestCheckout, setAiHighestCheckout] = useState<number>(0);\n  // End-of-match summary modal\n  const [showMatchSummary, setShowMatchSummary] = useState<boolean>(false);\n  // Manual correction input for offline (matches CameraView UX)\n  const [manualBox, setManualBox] = useState<string>(\"\");\n  const [manualTextarea, setManualTextarea] = useState<string>(\"\");\n  const [manualPlayerScoreInput, setManualPlayerScoreInput] =\n    useState<string>(\"\");\n  const [manualOpponentScoreInput, setManualOpponentScoreInput] =\n    useState<string>(\"\");\n  const [manualPlayerLegsInput, setManualPlayerLegsInput] =\n    useState<string>(\"\");\n  const [manualOpponentLegsInput, setManualOpponentLegsInput] =\n    useState<string>(\"\");\n  const [legOverrideConfirm, setLegOverrideConfirm] = useState<{\n    target: \"player\" | \"ai\";\n    value: number;\n    stage: 1 | 2;\n  } | null>(null);\n  const [showCameraManager, setShowCameraManager] = useState<boolean>(false);\n  const [dartCounts, setDartCounts] = useState<Record<string, number>>({});\n  const [awaitingBoardClear, setAwaitingBoardClear] = useState<boolean>(false);\n  const pendingVisitRef = useRef<PendingAutoVisit | null>(null);\n  const pendingVisitTimerRef = useRef<ReturnType<typeof setTimeout> | null>(\n    null,\n  );\n\n  const clearPendingVisitTimer = useCallback(() => {\n    const timer = pendingVisitTimerRef.current;\n    if (timer) {\n      clearTimeout(timer);\n      pendingVisitTimerRef.current = null;\n    }\n  }, []);\n\n  const speakAutoVisit = useCallback(\n    (pending: PendingAutoVisit) => {\n      if (!callerEnabled) return;\n      const speaker = user?.username || \"Player\";\n      try {\n        sayScore(\n          speaker,\n          pending.visitTotal,\n          Math.max(pending.remaining, 0),\n          callerVoice,\n          { volume: callerVolume, checkoutOnly: speakCheckoutOnly },\n        );\n      } catch {}\n    },\n    [\n      callerEnabled,\n      callerVoice,\n      callerVolume,\n      speakCheckoutOnly,\n      user?.username,\n    ],\n  );\n\n  const commitPendingVisit = useCallback(\n    (\n      pending: PendingAutoVisit,\n      _trigger: \"immediate\" | \"event\" | \"timeout\",\n    ) => {\n      setAwaitingBoardClear(false);\n      const {\n        visitTotal,\n        darts,\n        preRemaining,\n        remaining,\n        doubleAttempts,\n        finished,\n        doubleWindow,\n        highestCheckout,\n      } = pending;\n\n      if (!finished) {\n        setPlayerScore(remaining);\n        playerScoreRef.current = remaining;\n      } else {\n        setPlayerScore(0);\n        playerScoreRef.current = 0;\n        if (typeof highestCheckout === \"number\" && highestCheckout > 0) {\n          setPlayerHighestCheckout((h) => Math.max(h, highestCheckout));\n        }\n      }\n\n      setPlayerLastVisitScore(visitTotal);\n\n      if (visitTotal === 180) setPlayer180s((n) => n + 1);\n      else if (visitTotal >= 140) setPlayer140s((n) => n + 1);\n      else if (visitTotal >= 100) setPlayer100s((n) => n + 1);\n\n      if (doubleWindow && doubleAttempts > 0) {\n        setPlayerDoublesAtt((a) => a + doubleAttempts);\n        if (finished) setPlayerDoublesHit((h) => h + 1);\n      }\n\n      if (!pending.announced) speakAutoVisit(pending);\n\n      try {\n        useAudit.getState().recordVisit(\"offline-x01\", darts, visitTotal, {\n          preRemaining,\n          postRemaining: finished ? 0 : remaining,\n          finish: finished,\n          bust: false,\n        });\n      } catch {}\n\n      if (finished) {\n        setPendingLegWinner(\"player\");\n        setShowWinPopup(true);\n      }\n\n      endTurn(finished ? 0 : remaining);\n\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n    },\n    [\n      endTurn,\n      setPlayerHighestCheckout,\n      setPendingLegWinner,\n      setPlayerScore,\n      setPlayerLastVisitScore,\n      setPlayerVisitSum,\n      setPlayerVisitDarts,\n      setPlayerVisitDartsAtDouble,\n      setShowWinPopup,\n      setPlayer180s,\n      setPlayer140s,\n      setPlayer100s,\n      setPlayerDoublesAtt,\n      setPlayerDoublesHit,\n      speakAutoVisit,\n    ],\n  );\n\n  const finalizePendingVisit = useCallback(\n    (trigger: \"event\" | \"timeout\") => {\n      const pending = pendingVisitRef.current;\n      if (!pending) return;\n      pendingVisitRef.current = null;\n      clearPendingVisitTimer();\n      commitPendingVisit(pending, trigger);\n    },\n    [clearPendingVisitTimer, commitPendingVisit],\n  );\n\n  const queuePendingVisit = useCallback(\n    (pending: PendingAutoVisit) => {\n      speakAutoVisit(pending);\n      pendingVisitRef.current = { ...pending, announced: true };\n      setAwaitingBoardClear(true);\n      clearPendingVisitTimer();\n      pendingVisitTimerRef.current = setTimeout(\n        () => finalizePendingVisit(\"timeout\"),\n        BOARD_CLEAR_GRACE_MS,\n      );\n    },\n    [clearPendingVisitTimer, finalizePendingVisit, speakAutoVisit],\n  );\n\n  useEffect(() => {\n    if (!waitForBoardClear) return;\n    const handler = () => finalizePendingVisit(\"event\");\n    window.addEventListener(\"ndn:darts-cleared\", handler as EventListener);\n    return () =>\n      window.removeEventListener(\"ndn:darts-cleared\", handler as EventListener);\n  }, [waitForBoardClear, finalizePendingVisit]);\n\n  useEffect(() => {\n    if (!waitForBoardClear) finalizePendingVisit(\"timeout\");\n  }, [waitForBoardClear, finalizePendingVisit]);\n\n  useEffect(() => () => clearPendingVisitTimer(), [clearPendingVisitTimer]);\n\n  useEffect(() => {\n    if (playerVisitDarts === 0) {\n      try {\n        window.dispatchEvent(\n          new CustomEvent(\"ndn:darts-cleared\", {\n            detail: { source: \"offline-play\", ts: Date.now() },\n          }),\n        );\n      } catch {}\n      lastBounceMissTsRef.current = 0;\n    }\n    lastVisitDartsRef.current = playerVisitDarts;\n  }, [playerVisitDarts]);\n\n  const humanName = user?.username || \"Player 1\";\n  const aiDisplayName = ai === \"None\" ? \"Player 2\" : ai;\n\n  // Call all game stat hooks unconditionally at component level (React hooks rules)\n  const statsX01 = useOfflineGameStats(\n    \"X01\" as any,\n    playerScore,\n    aiScore,\n    playerLegs,\n    aiLegs,\n    playerLastDart,\n    aiLastDart,\n    playerVisitSum,\n    aiVisitSum,\n    playerLastVisitScore,\n    aiLastVisitScore,\n    playerVisitDarts,\n    aiVisitDarts,\n    playerDoublesHit,\n    playerDoublesAtt,\n    aiDoublesHit,\n    aiDoublesAtt,\n    legStats,\n    isPlayerTurn,\n    ai,\n    x01Score,\n  );\n  const statsCricket = useOfflineGameStats(\n    \"Cricket\" as any,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    cricket,\n  );\n  const statsShanghai = useOfflineGameStats(\n    \"Shanghai\" as any,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    isPlayerTurn,\n    ai,\n    undefined,\n    cricket,\n    shanghai,\n  );\n  const statsKiller = useOfflineGameStats(\n    \"Killer\" as any,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    killerPlayers,\n    killerStates,\n    killerAssigned,\n    killerTurnIdx,\n  );\n  const statsScam = useOfflineGameStats(\"Scam\" as any);\n  const statsFives = useOfflineGameStats(\"Fives\" as any);\n  const statsSevens = useOfflineGameStats(\"Sevens\" as any);\n\n  const activeScoreboardStats = useMemo(() => {\n    const list = statsX01 || [];\n    const playerResolvedLastScore =\n      playerVisitDarts > 0\n        ? playerVisitSum\n        : (playerLastVisitScore ?? playerLastDart);\n    const aiResolvedLastScore =\n      aiVisitDarts > 0 ? aiVisitSum : (aiLastVisitScore ?? aiLastDart);\n    if (list.length === 0) {\n      return {\n        name: isPlayerTurn ? humanName : aiDisplayName,\n        isCurrentTurn: true,\n        legsWon: isPlayerTurn ? playerLegs : aiLegs,\n        score: isPlayerTurn ? playerScore : aiScore,\n        lastScore: isPlayerTurn ? playerResolvedLastScore : aiResolvedLastScore,\n      } as PlayerStats;\n    }\n    return list.find((player) => player.isCurrentTurn) ?? list[0];\n  }, [\n    statsX01,\n    isPlayerTurn,\n    humanName,\n    aiDisplayName,\n    playerLegs,\n    aiLegs,\n    playerScore,\n    aiScore,\n    playerVisitDarts,\n    playerVisitSum,\n    playerLastVisitScore,\n    playerLastDart,\n    aiVisitSum,\n    aiLastVisitScore,\n    aiLastDart,\n    aiVisitDarts,\n  ]);\n\n  const singlePlayerScoreboard: PlayerStats[] = useMemo(() => {\n    if (!activeScoreboardStats) return [];\n    const { matchAvg, allTimeAvg, ...rest } = activeScoreboardStats;\n    return [\n      { ...rest, matchAvg: undefined, allTimeAvg: undefined } as PlayerStats,\n    ];\n  }, [activeScoreboardStats]);\n\n  const inactivePlayerName = isPlayerTurn ? aiDisplayName : humanName;\n  const activePlayerName =\n    activeScoreboardStats?.name ?? (isPlayerTurn ? humanName : aiDisplayName);\n  const activeRemaining = isPlayerTurn ? playerScore : aiScore;\n  const activeLastScore = isPlayerTurn\n    ? playerVisitDarts > 0\n      ? playerVisitSum\n      : (playerLastVisitScore ?? playerLastDart)\n    : aiVisitDarts > 0\n      ? aiVisitSum\n      : (aiLastVisitScore ?? aiLastDart);\n\n  const recordDart = useCallback((mode: string, count = 1) => {\n    if (!mode || count <= 0) return;\n    setDartCounts((prev) => ({\n      ...prev,\n      [mode]: (prev[mode] || 0) + count,\n    }));\n  }, []);\n\n  const resetDartCount = useCallback((mode: string) => {\n    if (!mode) return;\n    setDartCounts((prev) => {\n      if (prev[mode] === undefined) return prev;\n      return { ...prev, [mode]: 0 };\n    });\n  }, []);\n\n  const activeModeDarts = dartCounts[selectedMode] || 0;\n\n  const parseManualScoreOverride = (value: string): number | null => {\n    if (!value.trim()) return null;\n    const parsed = Number(value);\n    if (!Number.isFinite(parsed)) return null;\n    return clamp(Math.round(parsed), 0, x01Score);\n  };\n\n  const parseManualLegsOverride = (value: string): number | null => {\n    if (!value.trim()) return null;\n    const parsed = Number(value);\n    if (!Number.isFinite(parsed)) return null;\n    return Math.max(0, Math.round(parsed));\n  };\n\n  const cancelPendingAutoVisit = useCallback(() => {\n    if (pendingVisitRef.current) {\n      pendingVisitRef.current = null;\n    }\n    clearPendingVisitTimer();\n    setAwaitingBoardClear(false);\n  }, [clearPendingVisitTimer]);\n\n  const applyPlayerScoreOverride = useCallback(\n    (nextScore: number) => {\n      const safeScore = clamp(nextScore, 0, x01Score);\n      cancelPendingAutoVisit();\n      setPlayerScore(safeScore);\n      playerScoreRef.current = safeScore;\n\n      const nextVisitStart = safeScore === 0 ? x01Score : safeScore;\n      setPlayerVisitStart(nextVisitStart);\n      playerVisitStartRef.current = nextVisitStart;\n\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n\n      setPlayerLastVisitScore(null);\n      setPlayerLastDart(0);\n      setPlayerDartPoints(0);\n      lastBounceMissTsRef.current = 0;\n\n      if (safeScore === 0) {\n        setPendingLegWinner(\"player\");\n        setShowWinPopup(true);\n      } else {\n        setPendingLegWinner(null);\n        setShowWinPopup(false);\n      }\n    },\n    [\n      cancelPendingAutoVisit,\n      setPlayerScore,\n      x01Score,\n      setPlayerVisitStart,\n      setPlayerVisitSum,\n      setPlayerVisitDarts,\n      setPlayerVisitDartsAtDouble,\n      setPlayerLastVisitScore,\n      setPlayerLastDart,\n      setPlayerDartPoints,\n      setPendingLegWinner,\n      setShowWinPopup,\n    ],\n  );\n\n  const handleManualScoreOverride = (target: \"player\" | \"ai\") => {\n    const source =\n      target === \"player\" ? manualPlayerScoreInput : manualOpponentScoreInput;\n    const parsed = parseManualScoreOverride(source);\n    if (parsed === null) {\n      toast(`Enter a number between 0 and ${x01Score}`, {\n        type: \"error\",\n        timeout: 2500,\n      });\n      return;\n    }\n    if (target === \"player\") {\n      applyPlayerScoreOverride(parsed);\n      setManualPlayerScoreInput(\"\");\n      return;\n    } else {\n      setAiScore(parsed);\n      setAiVisitSum(0);\n      setAiVisitDarts(0);\n      setAiLastVisitScore(null);\n      setAiVisitDartsAtDouble(0);\n      setAiLastDart(0);\n      setManualOpponentScoreInput(\"\");\n    }\n    setPendingLegWinner(null);\n    setShowWinPopup(false);\n  };\n\n  const applyManualLegOverride = useCallback(\n    (target: \"player\" | \"ai\", value: number) => {\n      if (target === \"player\") {\n        setPlayerLegs(value);\n        setManualPlayerLegsInput(\"\");\n      } else {\n        setAiLegs(value);\n        setManualOpponentLegsInput(\"\");\n      }\n      setPendingLegWinner(null);\n      setShowWinPopup(false);\n    },\n    [\n      setAiLegs,\n      setManualOpponentLegsInput,\n      setManualPlayerLegsInput,\n      setPendingLegWinner,\n      setPlayerLegs,\n      setShowWinPopup,\n    ],\n  );\n\n  const handleManualLegsOverride = (target: \"player\" | \"ai\") => {\n    const source =\n      target === \"player\" ? manualPlayerLegsInput : manualOpponentLegsInput;\n    const parsed = parseManualLegsOverride(source);\n    if (parsed === null) {\n      toast(\"Enter a non-negative whole number for legs\", {\n        type: \"error\",\n        timeout: 2500,\n      });\n      return;\n    }\n    setLegOverrideConfirm({ target, value: parsed, stage: 1 });\n  };\n\n  const handleLegOverrideYes = useCallback(() => {\n    setLegOverrideConfirm((prev) => {\n      if (!prev) return prev;\n      if (prev.stage === 1) return { ...prev, stage: 2 };\n      applyManualLegOverride(prev.target, prev.value);\n      return null;\n    });\n  }, [applyManualLegOverride]);\n\n  const handleLegOverrideNo = useCallback(() => {\n    setLegOverrideConfirm(null);\n  }, []);\n\n  useEffect(() => {\n    if (!legOverrideConfirm) return;\n    const handleKey = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        event.preventDefault();\n        handleLegOverrideNo();\n      }\n    };\n    window.addEventListener(\"keydown\", handleKey);\n    return () => window.removeEventListener(\"keydown\", handleKey);\n  }, [handleLegOverrideNo, legOverrideConfirm]);\n\n  // Button size classes for toolbar buttons\n  const getButtonSizeClasses = (size: string) => {\n    switch (size) {\n      case \"small\":\n        return \"px-1.5 py-0.5 text-xs\";\n      case \"large\":\n        return \"px-3 py-1 text-sm\";\n      default:\n        return \"px-2 py-0.5 text-sm\";\n    }\n  };\n  const buttonSizeClass = getButtonSizeClasses(textSize);\n  // Fit-all scaling measurement\n  const scrollerRef = useRef<HTMLDivElement | null>(null);\n  const contentRef = useRef<HTMLDivElement | null>(null);\n  const headerBarRef = useRef<HTMLDivElement | null>(null);\n  // Match format controls (offline only): First to N or Best of N with editable count\n  const [formatType, setFormatType] = useState<\"first\" | \"best\">(\"first\");\n  const [formatCount, setFormatCount] = useState<number>(1);\n  const formatRef = useRef<HTMLDivElement | null>(null);\n  // Keep internal required wins (firstTo) in sync with format selection\n  useEffect(() => {\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1));\n    const wins = formatType === \"first\" ? n : Math.max(1, Math.ceil(n / 2));\n    setFirstTo(wins);\n  }, [formatType, formatCount]);\n  useEffect(() => {\n    if (!fitAll) {\n      setFitScale(1);\n      setFitOverflowing(false);\n      return;\n    }\n    const measure = () => {\n      const scroller = scrollerRef.current;\n      const content = contentRef.current;\n      if (!scroller || !content) return;\n      // Available size excludes the sticky header inside the scroller\n      const headerH = headerBarRef.current\n        ? headerBarRef.current.getBoundingClientRect().height\n        : 0;\n      const availH = Math.max(0, scroller.clientHeight - headerH - 6); // small breathing room\n      const availW = Math.max(0, scroller.clientWidth - 8);\n      // Measure the content size without scale\n      const rect = content.getBoundingClientRect();\n      const currentScale = fitScale || 1;\n      const naturalHeight = rect.height / currentScale;\n      const naturalWidth = rect.width / currentScale;\n      // Compute scale to fit both height and width\n      const scaleH = availH > 0 ? availH / naturalHeight : 1;\n      const scaleW = availW > 0 ? availW / naturalWidth : 1;\n      const next = Math.min(1, Math.max(0.5, Math.min(scaleH, scaleW)));\n      const scaledHeight = naturalHeight * next;\n      const overflowing = availH > 0 && scaledHeight - availH > 1;\n      setFitOverflowing(overflowing);\n      setFitScale(next);\n    };\n    measure();\n    const RO: any = (window as any).ResizeObserver;\n    const ro = RO ? new RO(() => measure()) : null;\n    ro && scrollerRef.current && ro.observe(scrollerRef.current as any);\n    ro && contentRef.current && ro.observe(contentRef.current as any);\n    window.addEventListener(\"resize\", measure);\n    return () => {\n      window.removeEventListener(\"resize\", measure);\n      try {\n        ro && scrollerRef.current && ro.unobserve(scrollerRef.current as any);\n      } catch {}\n      try {\n        ro && contentRef.current && ro.unobserve(contentRef.current as any);\n      } catch {}\n    };\n  }, [fitAll, fitScale]);\n\n  // Auto-start handler (from Home or other tabs)\n  useEffect(() => {\n    const onAuto = (e: any) => {\n      const m = e?.detail?.mode as string | undefined;\n      if (!m) return;\n      setSelectedMode(m);\n      // For Double Practice we could load a specific flow. For now, we just open the X01-like modal with immediate start.\n      startMatch();\n    };\n    window.addEventListener(\"ndn:auto-start\", onAuto as any);\n    return () => window.removeEventListener(\"ndn:auto-start\", onAuto as any);\n  }, []);\n\n  // Accept demo parameters to preconfigure format and starting score before auto-start\n  useEffect(() => {\n    const onFmt = (e: any) => {\n      const t = e?.detail?.formatType;\n      const c = e?.detail?.formatCount;\n      const s = e?.detail?.startScore;\n      if (t === \"first\" || t === \"best\") setFormatType(t);\n      if (typeof c === \"number\" && isFinite(c))\n        setFormatCount(Math.max(1, Math.floor(c)));\n      if (typeof s === \"number\" && isFinite(s))\n        setX01Score(Math.max(1, Math.floor(s)));\n    };\n    window.addEventListener(\"ndn:offline-format\", onFmt as any);\n    return () => window.removeEventListener(\"ndn:offline-format\", onFmt as any);\n  }, []);\n\n  // Auto-start last offline match when opening this tab, if enabled\n  useEffect(() => {\n    if (!autoStartOffline) return;\n    // Kick off a match after initial render for a smooth modal open\n    const id = setTimeout(() => startMatch(), 50);\n    return () => clearTimeout(id);\n  }, [autoStartOffline]);\n\n  // Drive AI countdown and perform AI visit when countdown elapses\n  useEffect(() => {\n    if (!showMatchModal || isPlayerTurn || ai === \"None\" || aiCountdownMs <= 0)\n      return;\n    let raf: number;\n    let last = performance.now();\n    const tick = (now: number) => {\n      const dt = now - last;\n      last = now;\n      setAiCountdownMs((prev) => {\n        const next = prev - dt;\n        if (next <= 0) {\n          // Execute AI visit per dart (up to 3 darts or until finish/bust)\n          let visitDarts = 0;\n          let visitTotal = 0;\n          let remaining = aiScore;\n          setAiVisitDarts(0);\n          while (visitDarts < 3 && remaining > 0) {\n            const targetVisit = aiVisitScore(remaining, ai);\n            // break target into up to 3 darts (roughly 20 per dart for easy split)\n            const dart = clamp(\n              targetVisit - visitDarts * 20,\n              0,\n              Math.min(60, remaining),\n            );\n            const after = remaining - dart;\n            setAiLastDart(dart);\n            setAiDartsThrown((d) => d + 1);\n            setTotalAiDarts((d) => d + 1);\n            if (after < 0) {\n              // bust: revert to remaining before visit\n              remaining = aiScore;\n              setAiVisitSum(0);\n              setAiVisitDartsAtDouble(0);\n              visitTotal = 0;\n              setAiLastVisitScore(0);\n              setAiVisitDarts(0);\n              break;\n            }\n            // Only add points after confirming not a bust\n            visitTotal += dart;\n            setAiVisitSum((s) => s + dart);\n            setTotalAiPoints((p) => p + dart);\n            // Track darts at double window\n            const preRem = remaining;\n            const postRem = after;\n            if (preRem > 50 && postRem <= 50) setAiVisitDartsAtDouble(1);\n            else if (preRem <= 50) setAiVisitDartsAtDouble((c) => c + 1);\n            remaining = after;\n            visitDarts += 1;\n            setAiVisitDarts(visitDarts);\n            if (remaining === 0) break;\n          }\n          setAiScore(remaining);\n          if (remaining === 0) {\n            // Power score classification\n            if (visitTotal === 180) setAi180s((n) => n + 1);\n            else if (visitTotal >= 140) setAi140s((n) => n + 1);\n            else if (visitTotal >= 100) setAi100s((n) => n + 1);\n            // Highest checkout\n            const checkout = aiScore;\n            if (checkout <= 170)\n              setAiHighestCheckout((h) => Math.max(h, checkout));\n            // Doubles attempts/hit if finished from <= 50\n            if (aiScore <= 50) {\n              setAiDoublesAtt(\n                (a) =>\n                  a + (aiVisitDartsAtDouble > 0 ? aiVisitDartsAtDouble : 1),\n              );\n              setAiDoublesHit((h) => h + 1);\n            }\n            setAiLastVisitScore(visitTotal);\n            setAiVisitSum(0);\n            setAiVisitDartsAtDouble(0);\n            setAiVisitDarts(0);\n            // AI won the leg\n            setPendingLegWinner(\"ai\");\n            setShowWinPopup(true);\n          }\n          // If AI did not finish, but threw 3 darts this visit, classify power score and reset visit sum\n          if (remaining > 0 && visitDarts >= 3) {\n            if (visitTotal === 180) setAi180s((n) => n + 1);\n            else if (visitTotal >= 140) setAi140s((n) => n + 1);\n            else if (visitTotal >= 100) setAi100s((n) => n + 1);\n            setAiLastVisitScore(visitTotal);\n            setAiVisitSum(0);\n            setAiVisitDartsAtDouble(0);\n            setAiVisitDarts(0);\n          }\n          // Hand turn back to player\n          setAiVisitDarts(0);\n          setIsPlayerTurn(true);\n          return 0;\n        }\n        return next;\n      });\n      raf = requestAnimationFrame(tick);\n    };\n    raf = requestAnimationFrame(tick);\n    return () => cancelAnimationFrame(raf);\n  }, [showMatchModal, isPlayerTurn, ai, aiScore]);\n\n  useEffect(() => {\n    if (!match.inProgress) return;\n    if (startedShowcasedRef.current) return;\n    setShowStartShowcase(true);\n    startedShowcasedRef.current = true;\n  }, [match.inProgress]);\n\n  function startMatch() {\n    setInMatch(true);\n    setPlayerScore(x01Score);\n    playerScoreRef.current = x01Score;\n    setAiScore(x01Score);\n    setOnDouble(false);\n    setShowMatchModal(true);\n    setIsPlayerTurn(true);\n    setPlayerDartPoints(0);\n    setPlayerDartsThrown(0);\n    setPlayerLastDart(0);\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitStart(x01Score);\n    setPlayerVisitSum(0);\n    setPlayerLastVisitScore(null);\n    setPlayerVisitDartsAtDouble(0);\n    setAiCountdownMs(0);\n    setAiDartsThrown(0);\n    setAiLastDart(0);\n    setAiVisitSum(0);\n    setAiVisitDarts(0);\n    setAiLastVisitScore(null);\n    setPendingLegWinner(null);\n    // When starting a brand-new match from menu, reset legs\n    setPlayerLegs(0);\n    setAiLegs(0);\n    setLegStats([]);\n    // Reset Treble Practice session state when starting a new match\n    setTrebleHits(0);\n    setTrebleDarts(0);\n    setTrebleFinished(false);\n    // Reset match-long totals\n    setTotalPlayerDarts(0);\n    setTotalAiDarts(0);\n    setTotalPlayerPoints(0);\n    setTotalAiPoints(0);\n    setPlayer180s(0);\n    setPlayer140s(0);\n    setPlayer100s(0);\n    setAi180s(0);\n    setAi140s(0);\n    setAi100s(0);\n    setPlayerHighestCheckout(0);\n    setAiHighestCheckout(0);\n    setPlayerDoublesAtt(0);\n    setPlayerDoublesHit(0);\n    setAiDoublesAtt(0);\n    setAiDoublesHit(0);\n    resetDartCount(\"X01\");\n    // Sync required wins from current format selection\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1));\n    setFirstTo(formatType === \"first\" ? n : Math.max(1, Math.ceil(n / 2)));\n    if (rememberLastOffline) {\n      try {\n        setLastOffline({\n          mode: selectedMode,\n          x01Start: x01Score,\n          firstTo,\n          aiLevel: ai,\n        });\n      } catch {}\n    }\n  }\n\n  function startNextLeg() {\n    setPlayerScore(x01Score);\n    playerScoreRef.current = x01Score;\n    setAiScore(x01Score);\n    setOnDouble(false);\n    setShowMatchModal(true);\n    setIsPlayerTurn(true);\n    setPlayerDartPoints(0);\n    setPlayerDartsThrown(0);\n    setPlayerLastDart(0);\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitStart(x01Score);\n    setPlayerVisitSum(0);\n    playerVisitStartRef.current = x01Score;\n    playerVisitSumRef.current = 0;\n    setPlayerLastVisitScore(null);\n    setPlayerVisitDartsAtDouble(0);\n    playerVisitDartsAtDoubleRef.current = 0;\n    playerVisitDartsAtDoubleRef.current = 0;\n    setAiCountdownMs(0);\n    setAiDartsThrown(0);\n    setAiLastDart(0);\n    setAiVisitSum(0);\n    setAiVisitDarts(0);\n    setAiLastVisitScore(null);\n    setPendingLegWinner(null);\n  }\n\n  // --- Offline per-dart helpers ---\n  function endTurn(nextRemaining: number) {\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitStart(nextRemaining === 0 ? x01Score : nextRemaining);\n    playerVisitStartRef.current =\n      nextRemaining === 0 ? x01Score : nextRemaining;\n    setPlayerVisitDartsAtDouble(0);\n    playerVisitDartsAtDoubleRef.current = 0;\n    if (ai !== \"None\") {\n      setIsPlayerTurn(false);\n      setAiCountdownMs(aiDelayMs);\n    } else {\n      setAiCountdownMs(0);\n      setIsPlayerTurn(true);\n    }\n  }\n\n  function applyDartValue(dart: number) {\n    if (waitForBoardClear && pendingVisitRef.current) {\n      if (!awaitingBoardClear) setAwaitingBoardClear(true);\n      toast(\"Remove your darts before starting the next throw\", {\n        type: \"info\",\n        timeout: 1800,\n      });\n      return;\n    }\n    recordDart(\"X01\");\n    const currentScore = playerScoreRef.current;\n    const currentVisitDarts = playerVisitDartsRef.current;\n    const currentVisitSum = playerVisitSumRef.current;\n    const currentVisitStart = playerVisitStartRef.current;\n    const currentVisitDartsAtDouble = playerVisitDartsAtDoubleRef.current;\n    const remaining = currentScore - dart;\n    const newVisitDarts = currentVisitDarts + 1;\n\n    setPlayerLastDart(dart);\n    setPlayerDartsThrown((d) => d + 1);\n    setTotalPlayerDarts((d) => d + 1);\n\n    if (remaining < 0) {\n      try {\n        const preRemaining = currentScore;\n        const postRemaining = currentVisitStart;\n        useAudit.getState().recordVisit(\"offline-x01\", newVisitDarts, 0, {\n          preRemaining,\n          postRemaining,\n          bust: true,\n          finish: false,\n        });\n      } catch {}\n      setPlayerScore(currentVisitStart);\n      playerScoreRef.current = currentVisitStart;\n\n      if (currentScore <= 50) {\n        const attemptsThisVisit = (currentVisitDartsAtDouble || 0) + 1;\n        setPlayerDoublesAtt((a) => a + attemptsThisVisit);\n      }\n\n      if (callerEnabled) {\n        try {\n          sayScore(\n            user?.username || \"Player\",\n            0,\n            Math.max(currentVisitStart, 0),\n            callerVoice,\n            { volume: callerVolume, checkoutOnly: speakCheckoutOnly },\n          );\n        } catch {}\n      }\n\n      setPlayerLastVisitScore(0);\n      setPlayerDartPoints(0);\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n      endTurn(currentVisitStart);\n      return;\n    }\n\n    setPlayerScore(remaining);\n    playerScoreRef.current = remaining;\n\n    setPlayerVisitDarts(newVisitDarts);\n    playerVisitDartsRef.current = newVisitDarts;\n    const newVisitSum = currentVisitSum + dart;\n    setPlayerVisitSum(newVisitSum);\n    playerVisitSumRef.current = newVisitSum;\n\n    setTotalPlayerPoints((p) => p + dart);\n    setPlayerDartPoints(0);\n\n    const preRemaining = currentScore;\n    const postRemaining = remaining;\n    const startedDoubleWindow = preRemaining > 50 && postRemaining <= 50;\n    const stillInDoubleWindow = preRemaining <= 50;\n    if (startedDoubleWindow) {\n      setPlayerVisitDartsAtDouble(1);\n      playerVisitDartsAtDoubleRef.current = 1;\n    } else if (stillInDoubleWindow) {\n      setPlayerVisitDartsAtDouble((c) => c + 1);\n      playerVisitDartsAtDoubleRef.current =\n        (currentVisitDartsAtDouble || 0) + 1;\n    }\n\n    const doubleAttemptsNow = playerVisitDartsAtDoubleRef.current || 0;\n    const inDoubleWindow = preRemaining <= 50;\n    const attemptsForVisit = inDoubleWindow\n      ? Math.max(doubleAttemptsNow, Math.min(newVisitDarts, 3))\n      : 0;\n\n    if (remaining === 0) {\n      const pending: PendingAutoVisit = {\n        visitTotal: newVisitSum,\n        darts: newVisitDarts,\n        preRemaining: currentScore,\n        remaining: 0,\n        doubleAttempts: attemptsForVisit,\n        finished: true,\n        doubleWindow: inDoubleWindow,\n        highestCheckout: currentVisitStart <= 170 ? currentVisitStart : null,\n      };\n      if (waitForBoardClear) {\n        queuePendingVisit(pending);\n      } else {\n        commitPendingVisit(pending, \"immediate\");\n      }\n      return;\n    }\n\n    if (newVisitDarts >= 3) {\n      const pending: PendingAutoVisit = {\n        visitTotal: newVisitSum,\n        darts: newVisitDarts,\n        preRemaining: currentScore,\n        remaining,\n        doubleAttempts: attemptsForVisit,\n        finished: false,\n        doubleWindow: inDoubleWindow,\n        highestCheckout: null,\n      };\n      if (waitForBoardClear) {\n        queuePendingVisit(pending);\n      } else {\n        commitPendingVisit(pending, \"immediate\");\n      }\n      return;\n    }\n  }\n\n  function addDartNumeric() {\n    const dart = clamp(Math.round(Number(playerDartPoints) || 0), 0, 60);\n    applyDartValue(dart);\n  }\n\n  function commitManualVisitTotal(rawTotal: number): boolean {\n    if (!Number.isFinite(rawTotal)) return false;\n\n    const visitStart = playerVisitStartRef.current;\n    const liveScore = playerScoreRef.current;\n    const existingDarts = playerVisitDartsRef.current;\n    const existingSum = playerVisitSumRef.current;\n    const hadPartialVisit = existingDarts > 0 || existingSum > 0;\n\n    if (hadPartialVisit) {\n      setPlayerScore(visitStart);\n      playerScoreRef.current = visitStart;\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n      setPlayerLastDart(0);\n      setPlayerDartPoints(0);\n      setPlayerDartsThrown((d) => Math.max(0, d - existingDarts));\n      setTotalPlayerDarts((d) => Math.max(0, d - existingDarts));\n      setTotalPlayerPoints((p) => Math.max(0, p - existingSum));\n      lastBounceMissTsRef.current = 0;\n    }\n\n    const preRemaining = hadPartialVisit ? visitStart : liveScore;\n    const checkoutCap = preRemaining <= 170 ? 170 : 180;\n    const total = clamp(Math.round(rawTotal), 0, checkoutCap);\n\n    recordDart(\"X01\", 3);\n    setPlayerDartsThrown((d) => d + 3);\n    setTotalPlayerDarts((d) => d + 3);\n    setPlayerVisitDarts(3);\n    playerVisitDartsRef.current = 3;\n    setPlayerVisitSum(total);\n    playerVisitSumRef.current = total;\n    setPlayerLastVisitScore(total);\n\n    if (total === 180) setPlayer180s((n) => n + 1);\n    else if (total >= 140) setPlayer140s((n) => n + 1);\n    else if (total >= 100) setPlayer100s((n) => n + 1);\n\n    const remaining = preRemaining - total;\n\n    if (remaining < 0) {\n      if (callerEnabled) {\n        try {\n          sayScore(humanName, 0, Math.max(visitStart, 0), callerVoice, {\n            volume: callerVolume,\n            checkoutOnly: speakCheckoutOnly,\n          });\n        } catch {}\n      }\n      try {\n        useAudit.getState().recordVisit(\"offline-x01\", 3, 0, {\n          preRemaining,\n          postRemaining: visitStart,\n          bust: true,\n          finish: false,\n        });\n      } catch {}\n      setPlayerScore(visitStart);\n      playerScoreRef.current = visitStart;\n      setPlayerLastVisitScore(0);\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n      endTurn(visitStart);\n      return true;\n    }\n\n    setPlayerScore(remaining);\n    playerScoreRef.current = remaining;\n    setTotalPlayerPoints((p) => p + total);\n\n    if (callerEnabled) {\n      try {\n        sayScore(humanName, total, Math.max(remaining, 0), callerVoice, {\n          volume: callerVolume,\n          checkoutOnly: speakCheckoutOnly,\n        });\n      } catch {}\n    }\n\n    if (preRemaining <= 50) {\n      setPlayerDoublesAtt((a) => a + 3);\n      if (remaining === 0) setPlayerDoublesHit((h) => h + 1);\n    }\n\n    if (remaining === 0) {\n      if (preRemaining <= 170)\n        setPlayerHighestCheckout((h) => Math.max(h, preRemaining));\n      try {\n        useAudit.getState().recordVisit(\"offline-x01\", 3, total, {\n          preRemaining,\n          postRemaining: 0,\n          finish: true,\n          bust: false,\n        });\n      } catch {}\n      setPendingLegWinner(\"player\");\n      setShowWinPopup(true);\n      setPlayerVisitDarts(0);\n      playerVisitDartsRef.current = 0;\n      setPlayerVisitSum(0);\n      playerVisitSumRef.current = 0;\n      setPlayerVisitDartsAtDouble(0);\n      playerVisitDartsAtDoubleRef.current = 0;\n      return true;\n    }\n\n    try {\n      useAudit.getState().recordVisit(\"offline-x01\", 3, total, {\n        preRemaining,\n        postRemaining: remaining,\n        finish: false,\n        bust: false,\n      });\n    } catch {}\n    endTurn(remaining);\n    setPlayerVisitSum(0);\n    playerVisitSumRef.current = 0;\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitDartsAtDouble(0);\n    playerVisitDartsAtDoubleRef.current = 0;\n    return true;\n  }\n\n  // Once local commit and endTurn functions are defined, create the unified offline actions wrapper\n  const matchActions: UnifiedMatchActions = createOfflineMatchActions({\n    match,\n    commitManualVisitTotal,\n    endTurn,\n  });\n\n  // Optional: Add a full-visit total (0â€“180) input for quick entry like \"93\"\n  const [visitTotalInput, setVisitTotalInput] = useState<string>(\"\");\n  const handleVisitTotalChange = (raw: string) => {\n    if (!raw) {\n      setVisitTotalInput(\"\");\n      return;\n    }\n    const numericOnly = raw.replace(/[^0-9]/g, \"\");\n    if (!numericOnly) {\n      setVisitTotalInput(\"\");\n      return;\n    }\n    const parsed = Number(numericOnly);\n    if (!Number.isFinite(parsed)) return;\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180;\n    const safe = clamp(Math.round(parsed), 0, maxAllowed);\n    setVisitTotalInput(String(safe));\n  };\n  function addVisitTotal() {\n    if (!visitTotalInput) {\n      alert(\"Enter a number 0â€“180 for visit total\");\n      return;\n    }\n    const parsed = Number(visitTotalInput);\n    if (!Number.isFinite(parsed)) {\n      alert(\"Enter a number 0â€“180 for visit total\");\n      return;\n    }\n    const maxAllowed = playerScoreRef.current <= 170 ? 170 : 180;\n    const bounded = clamp(Math.round(parsed), 0, maxAllowed);\n    if (parsed > maxAllowed) {\n      toast(`Visit totals cannot exceed ${maxAllowed}.`, {\n        type: \"info\",\n        timeout: 2200,\n      });\n    }\n    if (commitManualVisitTotal(bounded)) {\n      setVisitTotalInput(\"\");\n    }\n  }\n\n  const clearCurrentVisit = useCallback(() => {\n    if (pendingVisitRef.current) {\n      pendingVisitRef.current = null;\n      clearPendingVisitTimer();\n      setAwaitingBoardClear(false);\n    }\n    const visitDarts = playerVisitDartsRef.current;\n    const visitTotal = playerVisitSumRef.current;\n    const visitStart = playerVisitStartRef.current;\n    if (visitDarts === 0 && visitTotal === 0) return;\n    setPlayerScore(visitStart);\n    playerScoreRef.current = visitStart;\n    setPlayerVisitDarts(0);\n    playerVisitDartsRef.current = 0;\n    setPlayerVisitSum(0);\n    playerVisitSumRef.current = 0;\n    setPlayerVisitDartsAtDouble(0);\n    playerVisitDartsAtDoubleRef.current = 0;\n    setPlayerLastDart(0);\n    setPlayerDartPoints(0);\n    setPlayerDartsThrown((d) => Math.max(0, d - visitDarts));\n    setTotalPlayerDarts((d) => Math.max(0, d - visitDarts));\n    setTotalPlayerPoints((p) => Math.max(0, p - visitTotal));\n    lastBounceMissTsRef.current = 0;\n  }, [clearPendingVisitTimer]);\n\n  useEffect(() => {\n    const onClearRequest = (evt: Event) => {\n      const detail = (evt as CustomEvent)?.detail;\n      if (!detail || detail?.source === \"offline-play\") return;\n      clearCurrentVisit();\n    };\n    window.addEventListener(\n      \"ndn:clear-visit-request\",\n      onClearRequest as EventListener,\n    );\n    return () =>\n      window.removeEventListener(\n        \"ndn:clear-visit-request\",\n        onClearRequest as EventListener,\n      );\n  }, [clearCurrentVisit]);\n\n  // --- Double Practice helpers ---\n  function addDpValue(val: number) {\n    recordDart(\"Double Practice\");\n    const dart = clamp(Math.round(val || 0), 0, 60);\n    setPlayerLastDart(dart);\n    setPlayerDartsThrown((d) => d + 1);\n    setTotalPlayerDarts((d) => d + 1);\n    if (isDoubleHit(dart, dpIndex)) {\n      const nextHits = dpHits + 1;\n      setDpHits(nextHits);\n      setDpIndex((i) => Math.min(20, i + 1));\n      // End when DBULL (index 20) is hit\n      if (nextHits >= 21) {\n        setPendingLegWinner(\"player\");\n        setShowWinPopup(true);\n      }\n    }\n    setPlayerDartPoints(0);\n  }\n  function addDpNumeric() {\n    addDpValue(Number(playerDartPoints));\n  }\n  function addDpManual() {\n    const v = parseManualDart(manualBox);\n    if (v == null) {\n      alert(\"Enter like D16, 50, 25, T20\");\n      return;\n    }\n    addDpValue(v);\n    setManualBox(\"\");\n  }\n\n  // Bob's 27\n  function addB27Auto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    if (b27Finished) return;\n    recordDart(\"Bob's 27\");\n    const target = b27Stage;\n    const hit =\n      (ring === \"DOUBLE\" && sector === target) ||\n      (!ring && value === target * 2);\n    if (hit) setB27Hits((h) => h + 1);\n    setB27Darts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        const totalHits = b27Hits + (hit ? 1 : 0);\n        if (totalHits > 0) setB27Score((s) => s + totalHits * target * 2);\n        else setB27Score((s) => s - target * 2);\n        const next = target + 1;\n        setB27Stage(next);\n        setB27Hits(0);\n        if (next > 20) setB27Finished(true);\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addB27Numeric() {\n    addB27Auto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n  function resetB27() {\n    setB27Stage(1);\n    setB27Score(27);\n    setB27Darts(0);\n    setB27Hits(0);\n    setB27Finished(false);\n    resetDartCount(\"Bob's 27\");\n  }\n\n  // Count-Up / High Score / Low Score\n  function addCountUpAuto(value: number) {\n    recordDart(\"Count-Up\");\n    setCuScore((s) => s + Math.max(0, value | 0));\n    setCuDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setCuRound((r) => r + 1);\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addHighScoreAuto(value: number) {\n    recordDart(\"High Score\");\n    setHsScore((s) => s + Math.max(0, value | 0));\n    setHsDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setHsRound((r) => r + 1);\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addLowScoreAuto(value: number) {\n    recordDart(\"Low Score\");\n    setLsScore((s) => s + Math.max(0, value | 0));\n    setLsDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setLsRound((r) => r + 1);\n        return 0;\n      }\n      return nd;\n    });\n  }\n\n  // Checkout routines (double out)\n  function applyCheckout(\n    rem: number,\n    setRem: (n: number) => void,\n    darts: number,\n    setDarts: (f: (n: number) => number) => void,\n    setAttempts: (f: (n: number) => number) => void,\n    setSuccesses: (f: (n: number) => number) => void,\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  ) {\n    const next = rem - value;\n    if (next < 0) {\n      // bust: ignore progress during attempt\n    } else if (next === 0) {\n      if (ring === \"DOUBLE\" || ring === \"INNER_BULL\") {\n        setSuccesses((s) => s + 1);\n        setAttempts((a) => a + 1);\n        setDarts(() => 0);\n        setRem(rem); // caller will reset to initial value right after\n        return;\n      }\n      setRem(next);\n    } else {\n      setRem(next);\n    }\n    setDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setAttempts((a) => a + 1);\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addCo170Auto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  ) {\n    recordDart(\"Checkout 170\");\n    applyCheckout(\n      co170Rem,\n      setCo170Rem,\n      co170Darts,\n      setCo170Darts,\n      setCo170Attempts,\n      setCo170Successes,\n      value,\n      ring,\n    );\n    if (co170Darts + 1 >= 3) setCo170Rem(170);\n  }\n  function addCo121Auto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n  ) {\n    recordDart(\"Checkout 121\");\n    applyCheckout(\n      co121Rem,\n      setCo121Rem,\n      co121Darts,\n      setCo121Darts,\n      setCo121Attempts,\n      setCo121Successes,\n      value,\n      ring,\n    );\n    if (co121Darts + 1 >= 3) setCo121Rem(121);\n  }\n  function addCoManual(is170: boolean) {\n    const v = parseManualDart(manualBox);\n    if (v == null) {\n      alert(\"Enter like T20, D16, 25, 50\");\n      return;\n    }\n    const t = manualBox.trim().toUpperCase();\n    const isDouble =\n      t.startsWith(\"D\") ||\n      t === \"50\" ||\n      t === \"BULL\" ||\n      t === \"DBULL\" ||\n      t === \"IBULL\" ||\n      t.includes(\"INNER\");\n    if (is170) addCo170Auto(v, isDouble ? \"DOUBLE\" : undefined);\n    else addCo121Auto(v, isDouble ? \"DOUBLE\" : undefined);\n    setManualBox(\"\");\n  }\n  function resetCo170() {\n    setCo170Rem(170);\n    setCo170Darts(0);\n    setCo170Attempts(0);\n    setCo170Successes(0);\n    resetDartCount(\"Checkout 170\");\n  }\n  function resetCo121() {\n    setCo121Rem(121);\n    setCo121Darts(0);\n    setCo121Attempts(0);\n    setCo121Successes(0);\n    resetDartCount(\"Checkout 121\");\n  }\n\n  // Treble practice\n  function addTrebleAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    if (trebleFinished) return;\n    recordDart(\"Treble Practice\");\n    const isHit =\n      (ring === \"TRIPLE\" && sector === trebleTarget) ||\n      (!ring && value === trebleTarget * 3);\n    if (isHit) setTrebleHits((h) => h + 1);\n    setTrebleDarts((d) => {\n      const nd = d + 1;\n      // Auto-rotate target every 3 darts among T20â†’T19â†’T18\n      if (nd % 3 === 0 && [20, 19, 18].includes(trebleTarget)) {\n        const cycle = [20, 19, 18];\n        const idx = cycle.indexOf(trebleTarget);\n        const next = cycle[(idx + 1) % cycle.length];\n        setTrebleTarget(next);\n      }\n      // End session at configured throws\n      if (trebleMaxDarts > 0 && nd >= trebleMaxDarts) setTrebleFinished(true);\n      return nd;\n    });\n  }\n  function resetTreble() {\n    setTrebleHits(0);\n    setTrebleDarts(0);\n    setTrebleFinished(false);\n    resetDartCount(\"Treble Practice\");\n  }\n\n  // Baseball\n  function addBaseballAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Baseball\");\n    setBaseball((prev) => {\n      const cp = { ...prev };\n      applyBaseballDart(cp as any, value, ring as any, sector);\n      return cp;\n    });\n  }\n  function resetBaseball() {\n    setBaseball(createBaseball());\n    resetDartCount(\"Baseball\");\n  }\n\n  // Golf\n  function addGolfAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Golf\");\n    setGolf((prev) => {\n      const cp = { ...prev };\n      applyGolfDart(cp as any, value, ring as any, sector);\n      return cp;\n    });\n  }\n  function resetGolf() {\n    setGolf(createGolf());\n    resetDartCount(\"Golf\");\n  }\n\n  // Tic Tac Toe\n  function addTttAuto(\n    cell: number,\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Tic Tac Toe\");\n    setTTT((prev) => {\n      const cp = { ...prev, board: [...prev.board] as any };\n      tryClaimCell(cp as any, cell as any, value, ring as any, sector);\n      return cp;\n    });\n  }\n  function resetTtt() {\n    setTTT(createTicTacToe());\n    resetDartCount(\"Tic Tac Toe\");\n  }\n\n  // American Cricket\n  function addAmCricketAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"American Cricket\");\n    setAmCricket((prev) => {\n      const cp = { ...prev, marks: { ...prev.marks } };\n      applyAmCricketDart(cp as any, value, ring as any, sector, () => false);\n      return cp;\n    });\n  }\n  function resetAmCricket() {\n    setAmCricket(createAmCricketState());\n    resetDartCount(\"American Cricket\");\n  }\n\n  // --- Around the Clock helpers ---\n  function addAtcValue(\n    val: number,\n    ring?: \"MISS\" | \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Around the Clock\");\n    const target = ATC_ORDER[atcIndex];\n    let hit = false;\n    if (\n      typeof sector === \"number\" &&\n      sector === target &&\n      (ring === \"SINGLE\" || ring === \"DOUBLE\" || ring === \"TRIPLE\")\n    )\n      hit = true;\n    if (target === 25 && (ring === \"BULL\" || val === 25)) hit = true;\n    if (target === 50 && (ring === \"INNER_BULL\" || val === 50)) hit = true;\n    if (!hit) {\n      // Fallback by value only\n      if (val === target || val === target * 2 || val === target * 3)\n        hit = true;\n    }\n    if (hit) {\n      const newHits = atcHits + 1;\n      setAtcHits(newHits);\n      setAtcIndex((i) => i + 1);\n    }\n  }\n  function addAtcNumeric() {\n    addAtcValue(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n  function addAtcManual() {\n    const v = parseManualDart(manualBox);\n    if (v == null) {\n      alert(\"Enter like T20, D5, 25, 50\");\n      return;\n    }\n    addAtcValue(v);\n    setManualBox(\"\");\n  }\n\n  // --- Cricket helpers (solo practice) ---\n  function addCricketAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Cricket\");\n    setCricket((prev) => {\n      const copy = { ...prev, marks: { ...prev.marks } };\n      applyCricketDart(copy as any, value, ring, sector, () => false);\n      return copy;\n    });\n    setPracticeTurnDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) return 0;\n      return nd;\n    });\n  }\n  function addCricketNumeric() {\n    addCricketAuto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n\n  // --- Shanghai helpers ---\n  function addShanghaiAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Shanghai\");\n    setShanghai((prev) => {\n      const copy = { ...prev, turnHits: { ...prev.turnHits } };\n      applyShanghaiDart(copy as any, value, ring, sector);\n      return copy;\n    });\n    setPracticeTurnDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setShanghai((prev) => {\n          const cp = { ...prev, turnHits: { ...prev.turnHits } };\n          endShanghaiTurn(cp as any);\n          return cp;\n        });\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addShanghaiNumeric() {\n    addShanghaiAuto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n\n  // --- Halve It helpers ---\n  function addHalveAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"Halve It\");\n    setHalve((prev) => {\n      const copy = { ...prev, targets: [...prev.targets] };\n      applyHalveItDart(copy as any, value, ring, sector);\n      return copy;\n    });\n    setPracticeTurnDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setHalve((prev) => {\n          const cp = { ...prev, targets: [...prev.targets] };\n          endHalveItTurn(cp as any);\n          return cp;\n        });\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addHalveNumeric() {\n    addHalveAuto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n\n  // --- High-Low helpers ---\n  function addHighLowAuto(\n    value: number,\n    ring?: \"SINGLE\" | \"DOUBLE\" | \"TRIPLE\" | \"BULL\" | \"INNER_BULL\",\n    sector?: number | null,\n  ) {\n    recordDart(\"High-Low\");\n    setHighlow((prev) => {\n      const copy = { ...prev };\n      applyHighLowDart(copy as any, value, ring, sector);\n      return copy;\n    });\n    setPracticeTurnDarts((d) => {\n      const nd = d + 1;\n      if (nd >= 3) {\n        setHighlow((prev) => {\n          const cp = { ...prev };\n          endHighLowTurn(cp as any);\n          return cp;\n        });\n        return 0;\n      }\n      return nd;\n    });\n  }\n  function addHighLowNumeric() {\n    addHighLowAuto(Math.max(0, playerDartPoints | 0));\n    setPlayerDartPoints(0);\n  }\n\n  function parseManualBox(): number | null {\n    const t = manualBox.trim().toUpperCase();\n    if (!t) return null;\n    if (t === \"50\" || t === \"BULL\" || t === \"DBULL\" || t === \"IBULL\") return 50;\n    if (t === \"25\" || t === \"OBULL\") return 25;\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/);\n    if (!m) return null;\n    const mult = (m[1] || \"S\") as \"S\" | \"D\" | \"T\";\n    const num = parseInt(m[2], 10);\n    if (num < 1 || num > 20) return null;\n    const multVal = mult === \"S\" ? 1 : mult === \"D\" ? 2 : 3;\n    return num * multVal;\n  }\n\n  function addManual() {\n    const val = parseManualBox();\n    if (val == null) {\n      alert(\"Enter like T20, D16, 5, 25, 50\");\n      return;\n    }\n    applyDartValue(val);\n    setManualBox(\"\");\n  }\n\n  function addManualTextarea() {\n    const lines = manualTextarea\n      .trim()\n      .split(\"\\n\")\n      .map((l) => l.trim())\n      .filter((l) => l);\n    if (lines.length === 0) return;\n    for (const line of lines) {\n      const val = parseManualDart(line);\n      if (val == null) {\n        alert(`Invalid score: ${line}`);\n        return;\n      }\n      applyDartValue(val);\n    }\n    setManualTextarea(\"\");\n  }\n\n  function replaceLast() {\n    if (playerVisitDarts === 0) return;\n    // Rewind one dart: approximate by adding back last dart into score\n    setPlayerScore((s) => s + playerLastDart);\n    setPlayerVisitDarts((d) => Math.max(0, d - 1));\n  }\n\n  function replaceLastManual() {\n    const val = parseManualBox();\n    if (val == null) {\n      alert(\"Enter like T20, D16, 5, 25, 50\");\n      return;\n    }\n    if (playerVisitDarts === 0) {\n      addManual();\n      return;\n    }\n    // Rewind last then apply\n    const rewind = playerLastDart;\n    setPlayerScore((s) => s + rewind);\n    setPlayerVisitDarts((d) => Math.max(0, d - 1));\n    // Apply new value in next microtask to ensure state has updated\n    setTimeout(() => applyDartValue(val), 0);\n    setManualBox(\"\");\n  }\n\n  function playerThrow(points: number) {\n    const newScore = playerScore - points;\n    if (newScore < 0) {\n      setPlayerScore(playerScore); // bust\n      return;\n    }\n    setPlayerScore(newScore);\n    if (newScore === 0) {\n      setPendingLegWinner(\"player\");\n      setShowWinPopup(true);\n    }\n    setOnDouble(newScore <= 40 && newScore % 2 === 0);\n  }\n\n  function aiTurn() {\n    // This is now automated inside the modal turn loop\n  }\n\n  function handleBust() {\n    setPlayerScore(playerScore); // bust, score unchanged\n    setOnDouble(false);\n  }\n\n  function handleWinPopupSubmit() {\n    const winner = pendingLegWinner ?? \"player\";\n    // Approximate per-leg doubles attempts: if winner is player and they finished from <=50, attempts were counted in playerVisitDartsAtDouble; otherwise leave undefined\n    const legDoublesAtt =\n      winner === \"player\"\n        ? playerVisitDartsAtDouble || undefined\n        : aiVisitDartsAtDouble || undefined;\n    const legDoublesHit = 1;\n    const winnerDarts = winner === \"player\" ? playerDartsThrown : aiDartsThrown;\n    setLegStats([\n      ...legStats,\n      {\n        winner,\n        doubleDarts,\n        checkoutDarts,\n        winnerDarts,\n        doublesAtt: legDoublesAtt,\n        doublesHit: legDoublesHit,\n      },\n    ]);\n    setShowWinPopup(false);\n    // Increment legs for the winner\n    let p = playerLegs;\n    let a = aiLegs;\n    if (pendingLegWinner === \"player\") p += 1;\n    else if (pendingLegWinner === \"ai\") a += 1;\n    setPlayerLegs(p);\n    setAiLegs(a);\n    setPendingLegWinner(null);\n    // Check if match is over\n    if (p >= firstTo || a >= firstTo) {\n      // End of match: close modal back to menu state\n      // Record per-game-mode result (local-only demo)\n      try {\n        bumpGameMode(selectedMode, winner === \"player\");\n      } catch {}\n      setShowMatchModal(false);\n      setInMatch(false);\n      // Reset leg-specific stats for next match but keep the summary list visible\n      setPlayerScore(x01Score);\n      setAiScore(x01Score);\n      setShowMatchSummary(true);\n      return;\n    }\n    // Otherwise, start the next leg immediately\n    startNextLeg();\n  }\n\n  const isFreeSelected = freeGames.includes(selectedMode as any);\n  const lockedPremium = !isFreeSelected && !(user?.fullAccess || user?.admin);\n\n  // no external overlay: we render the match modal as absolute inset-0 inside this card\n\n  return (\n    <div className=\"card ndn-game-shell relative overflow-hidden\">\n      {showStartShowcase && (\n        <MatchStartShowcase\n          players={(match.players || []) as any}\n          onDone={() => setShowStartShowcase(false)}\n        />\n      )}\n      <h2 className=\"text-3xl font-bold text-brand-700 mb-4\">\n        Offline Mode{\" \"}\n        {offlineLayout === \"classic\" ? (\n          <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle\">\n            Classic layout\n          </span>\n        ) : (\n          <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle\">\n            Modern layout\n          </span>\n        )}\n      </h2>\n      <div className=\"ndn-shell-body\">\n        <div className=\"mb-4 flex flex-col gap-3\">\n          <select\n            className=\"input w-full\"\n            value={selectedMode}\n            onChange={(e) => setSelectedMode(e.target.value)}\n          >\n            {freeGames.map((mode) => (\n              <option key={mode} value={mode}>\n                {mode}\n              </option>\n            ))}\n            {premiumGames.map((mode) => (\n              <option\n                key={mode}\n                value={mode}\n                disabled={!(user?.fullAccess || user?.admin)}\n              >\n                {mode} {user?.fullAccess || user?.admin ? \"\" : \"(Premium)\"}\n              </option>\n            ))}\n          </select>\n\n          {/* Calibration Status - displayed below game mode selector */}\n          <GameCalibrationStatus gameMode={selectedMode} compact={true} />\n\n          {selectedMode === \"Treble Practice\" && (\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end\">\n              <div className=\"sm:col-span-1\">\n                <label className=\"font-semibold\">Throws per game</label>\n                <input\n                  className=\"input w-full\"\n                  type=\"number\"\n                  min={3}\n                  step={3}\n                  value={trebleMaxDarts}\n                  onChange={(e) =>\n                    setTrebleMaxDarts(\n                      Math.max(3, Math.floor(Number(e.target.value) || 30)),\n                    )\n                  }\n                />\n              </div>\n              <div className=\"sm:col-span-2 text-xs text-slate-300\">\n                Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the\n                selected number of throws.\n              </div>\n            </div>\n          )}\n          {!user?.fullAccess && (\n            <div className=\"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2\">\n              <span>ðŸ”’</span>\n              <span>\n                Only X01 and Double Practice are free. Advanced modes (Killer,\n                Cricket, Shanghai, etc.) require PREMIUM.\n              </span>\n            </div>\n          )}\n          {selectedMode === \"X01\" && (\n            <>\n              <label className=\"font-semibold mt-2\">\n                Enter starting score (1-1001):\n              </label>\n              <input\n                className=\"input w-full\"\n                type=\"number\"\n                min={1}\n                max={1001}\n                value={x01Score}\n                onChange={(e) => setX01Score(Number(e.target.value))}\n              />\n              <label className=\"font-semibold mt-2\">Play against AI bot?</label>\n              <select\n                className=\"input w-full\"\n                value={ai}\n                onChange={(e) => setAI(e.target.value)}\n              >\n                <option value=\"None\">None</option>\n                {aiLevels.map((level) => (\n                  <option key={level} value={level}>\n                    {level}\n                  </option>\n                ))}\n              </select>\n              {ai !== \"None\" && (\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2\">\n                  <div className=\"sm:col-span-2\">\n                    <label className=\"font-semibold\">\n                      AI throw delay (seconds)\n                    </label>\n                    <input\n                      className=\"input w-full\"\n                      type=\"number\"\n                      min={0.5}\n                      max={10}\n                      step={0.5}\n                      value={aiDelayMs / 1000}\n                      onChange={(e) =>\n                        setAiDelayMs(Math.round(Number(e.target.value) * 1000))\n                      }\n                    />\n                  </div>\n                  <div className=\"text-sm text-slate-300\">\n                    Controls how long the AI waits before its visit.\n                  </div>\n                </div>\n              )}\n              <button className=\"btn mt-2\" onClick={() => setShowRules(true)}>\n                X01 Rules & Regulations!\n              </button>\n            </>\n          )}\n          {selectedMode === \"Double Practice\" && (\n            <div className=\"mt-2 text-brand-600\">\n              Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and\n              X01 settings donâ€™t apply.\n            </div>\n          )}\n        </div>\n        {!inMatch && (\n          <button\n            className=\"btn\"\n            disabled={lockedPremium}\n            title={lockedPremium ? \"PREMIUM required for this mode\" : \"\"}\n            onClick={startMatch}\n          >\n            Start Match\n          </button>\n        )}\n        {/* Match Modal with turn-by-turn flow */}\n        {showMatchModal && (\n          <div\n            className={`absolute inset-0 z-[1000] ${maximized ? \"\" : \"flex items-center justify-center p-3 sm:p-4\"}`}\n          >\n            <ResizableModal\n              storageKey=\"ndn:modal:offline-match\"\n              className={`${maximized ? \"w-full h-full ndn-modal-tight\" : \"\"} relative flex flex-col overflow-hidden`}\n              fullScreen={maximized}\n              defaultWidth={1100}\n              defaultHeight={720}\n              minWidth={720}\n              minHeight={480}\n              maxWidth={1600}\n              maxHeight={1200}\n              initialFitHeight\n            >\n              {/* Header bar with visible mode and actions; sheen is clipped to this area */}\n              <div\n                className=\"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2\"\n                style={{ overflowY: \"scroll\" }}\n                ref={(el) => {\n                  (scrollerRef as any).current = el;\n                }}\n              >\n                <div\n                  ref={(el) => {\n                    (headerBarRef as any).current = el;\n                  }}\n                >\n                  <GameHeaderBar\n                    left={\n                      <>\n                        <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">\n                          Game Mode\n                        </span>\n                        <span className=\"font-medium whitespace-nowrap\">\n                          {selectedMode}\n                          {selectedMode === \"X01\" ? ` / ${x01Score}` : \"\"}\n                        </span>\n                        <span className=\"opacity-80 whitespace-nowrap\">\n                          First to {firstTo} Â· Legs {playerLegs}-{aiLegs}\n                        </span>\n                        <span\n                          className={`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${offlineLayout === \"modern\" ? \"bg-emerald-500/15 text-emerald-200 border-emerald-400/30\" : \"bg-white/10 text-white/70 border-white/20\"}`}\n                        >\n                          {offlineLayout === \"modern\"\n                            ? \"Modern layout\"\n                            : \"Classic layout\"}\n                        </span>\n                      </>\n                    }\n                    right={\n                      <>\n                        {/* Camera scale controls (match Online UI) */}\n                        <div className=\"hidden items-center gap-2 mr-2 text-xs\">\n                          <span className=\"opacity-80\">Cam</span>\n                          <button\n                            className=\"btn btn--ghost px-2 py-1\"\n                            onClick={() =>\n                              setCameraScale(\n                                Math.max(\n                                  0.5,\n                                  Math.round((cameraScale - 0.05) * 100) / 100,\n                                ),\n                              )\n                            }\n                            title=\"Decrease camera size\"\n                          >\n                            âˆ’\n                          </button>\n                          <span className=\"w-9 text-center\">\n                            {Math.round(cameraScale * 100)}%\n                          </span>\n                          <button\n                            className=\"btn btn--ghost px-2 py-1\"\n                            onClick={() =>\n                              setCameraScale(\n                                Math.min(\n                                  1.25,\n                                  Math.round((cameraScale + 0.05) * 100) / 100,\n                                ),\n                              )\n                            }\n                            title=\"Increase camera size\"\n                          >\n                            +\n                          </button>\n                        </div>\n                        <button\n                          className=\"btn btn--ghost px-3 py-1 text-sm\"\n                          title={fitAll ? \"Actual Size\" : \"Fit All\"}\n                          onClick={() => setFitAll((v) => !v)}\n                        >\n                          {fitAll ? \"Actual Size\" : \"Fit All\"}\n                        </button>\n                        <button\n                          className=\"btn btn--ghost px-3 py-1 text-sm\"\n                          title={maximized ? \"Restore\" : \"Maximize\"}\n                          onClick={() => setMaximized((m) => !m)}\n                        >\n                          {maximized ? \"Restore\" : \"Maximize\"}\n                        </button>\n                        <button\n                          className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                          onClick={() => {\n                            startMatch();\n                          }}\n                        >\n                          Restart\n                        </button>\n                        <button\n                          className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\n                          onClick={() => {\n                            setShowMatchModal(false);\n                            setInMatch(false);\n                          }}\n                        >\n                          Quit\n                        </button>\n                      </>\n                    }\n                  />\n                </div>\n                <div\n                  ref={(el) => {\n                    (contentRef as any).current = el;\n                  }}\n                  className=\"will-change-transform\"\n                  style={\n                    fitAll\n                      ? {\n                          transform: `scale(${fitScale})`,\n                          transformOrigin: \"top left\",\n                          width: \"100%\",\n                          fontSize: `${Math.max(0.8, Math.min(1, fitScale))}em`,\n                        }\n                      : undefined\n                  }\n                >\n                  <h3 className=\"text-xl font-bold mb-2 mt-1 leading-tight\">\n                    {selectedMode === \"X01\" ? \"X01 Match\" : selectedMode}\n                  </h3>\n                  <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                      Mode: {selectedMode}\n                    </span>\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                      Start: {x01Score}\n                    </span>\n                    <div\n                      ref={formatRef}\n                      className=\"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10\"\n                    >\n                      <span>Format:</span>\n                      {(() => {\n                        const disabled =\n                          playerScore !== x01Score ||\n                          aiScore !== x01Score ||\n                          playerVisitDarts > 0;\n                        const pillCls = `px-2 py-0.5 rounded border text-xs ${disabled ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer\"} `;\n                        return (\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"flex items-center gap-1\">\n                              <button\n                                type=\"button\"\n                                className={`${pillCls} ${formatType === \"first\" ? \"bg-indigo-500/20 text-indigo-100 border-indigo-400/30\" : \"bg-white/10 text-white/80 border-white/20\"}`}\n                                onClick={() => {\n                                  if (!disabled) setFormatType(\"first\");\n                                }}\n                                title=\"First to N\"\n                              >\n                                First to\n                              </button>\n                              <button\n                                type=\"button\"\n                                className={`${pillCls} ${formatType === \"best\" ? \"bg-indigo-500/20 text-indigo-100 border-indigo-400/30\" : \"bg-white/10 text-white/80 border-white/20\"}`}\n                                onClick={() => {\n                                  if (!disabled) setFormatType(\"best\");\n                                }}\n                                title=\"Best of N (wins = ceil(N/2)\"\n                              >\n                                Best of\n                              </button>\n                            </div>\n                            <input\n                              className={`input w-16 text-center ${disabled ? \"opacity-50\" : \"\"}`}\n                              type=\"number\"\n                              min={1}\n                              step={1}\n                              value={formatCount}\n                              onChange={(e) =>\n                                setFormatCount(\n                                  Math.max(\n                                    1,\n                                    Math.floor(Number(e.target.value) || 1),\n                                  ),\n                                )\n                              }\n                              disabled={disabled}\n                              title={\n                                formatType === \"first\"\n                                  ? \"First to N\"\n                                  : \"Best of N (wins = ceil(N/2))\"\n                              }\n                            />\n                          </div>\n                        );\n                      })()}\n                    </div>\n                    <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                      Legs: {playerLegs}â€“{aiLegs}\n                    </span>\n                    {/* Move match type and team names to the right of Legs for a single-row header */}\n                    <div className=\"ml-auto flex items-center gap-1 text-[10px] flex-wrap\">\n                      <span className=\"opacity-70\">Match</span>\n                      <select\n                        className={`btn ${buttonSizeClass}`}\n                        value={matchType}\n                        onChange={(e) =>\n                          setMatchType(e.target.value as \"singles\" | \"doubles\")\n                        }\n                      >\n                        <option value=\"singles\">Singles</option>\n                        <option value=\"doubles\">Doubles</option>\n                      </select>\n                      <input\n                        className={`input ${buttonSizeClass} w-[7.5rem]`}\n                        value={teamAName}\n                        onChange={(e) => setTeamAName(e.target.value)}\n                        placeholder=\"Team A\"\n                      />\n                      <span className=\"opacity-50\">vs</span>\n                      <input\n                        className={`input ${buttonSizeClass} w-[7.5rem]`}\n                        value={teamBName}\n                        onChange={(e) => setTeamBName(e.target.value)}\n                        placeholder=\"Team B\"\n                      />\n                    </div>\n                  </div>\n                  {selectedMode !== \"X01\" ? (\n                    <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2\">\n                      {selectedMode === \"Double Practice\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span className=\"opacity-80\">Current Target</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                              {DOUBLE_PRACTICE_ORDER[dpIndex]?.label || \"â€”\"}\n                            </span>\n                          </div>\n                          {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\n                        </>\n                      )}\n                      {selectedMode === \"Around the Clock\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span className=\"opacity-80\">Current Target</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                              {ATC_ORDER[atcIndex] === 25\n                                ? \"25 (Outer Bull)\"\n                                : ATC_ORDER[atcIndex] === 50\n                                  ? \"50 (Inner Bull)\"\n                                  : ATC_ORDER[atcIndex] || \"â€”\"}\n                            </span>\n                          </div>\n                          {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\n                        </>\n                      )}\n                      {selectedMode === \"Cricket\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 mb-1\">\n                            Cricket â€” Close 20â€“15 and Bull; overflow scores\n                            points\n                          </div>\n                          <div className=\"grid grid-cols-7 gap-1 text-center text-[11px] mb-2\">\n                            {CRICKET_NUMBERS.map((n) => (\n                              <div\n                                key={n}\n                                className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\"\n                              >\n                                <div className=\"opacity-70\">\n                                  {n === 25 ? \"Bull\" : n}\n                                </div>\n                                <div className=\"font-semibold\">\n                                  {Math.min(3, cricket.marks?.[n] || 0)} / 3\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                          <div className=\"text-sm\">\n                            Points:{\" \"}\n                            <span className=\"font-semibold\">\n                              {cricket.points}\n                            </span>\n                          </div>\n                          {cricketClosedAll(cricket) && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setCricket(createCricketState());\n                                  setPracticeTurnDarts(0);\n                                  resetDartCount(\"Cricket\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Shanghai\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span>Round</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">\n                              {shanghai.round}\n                            </span>\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {shanghai.score}\n                          </div>\n                          {shanghai.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setShanghai(createShanghaiState());\n                                  setPracticeTurnDarts(0);\n                                  resetDartCount(\"Shanghai\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Halve It\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span>Stage</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">\n                              {halve.stage + 1}/{halve.targets.length}\n                            </span>\n                          </div>\n                          <div className=\"text-sm\">\n                            Target:{\" \"}\n                            <span className=\"font-semibold\">\n                              {(() => {\n                                const t = getCurrentHalveTarget(halve);\n                                if (!t) return \"â€”\";\n                                if (t.kind === \"ANY_NUMBER\") return \"Any\";\n                                if (t.kind === \"BULL\") return \"Bull\";\n                                if (\n                                  t.kind === \"DOUBLE\" ||\n                                  t.kind === \"TRIPLE\" ||\n                                  t.kind === \"NUMBER\"\n                                )\n                                  return `${t.kind} ${(t as any).num}`;\n                                return \"â€”\";\n                              })()}\n                            </span>\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {halve.score}\n                          </div>\n                          {halve.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setHalve(createDefaultHalveIt());\n                                  setPracticeTurnDarts(0);\n                                  resetDartCount(\"Halve It\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"High-Low\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Round {highlow.round} Â· Target {highlow.target}\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {highlow.score}\n                          </div>\n                          {highlow.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setHighlow(createHighLow());\n                                  setPracticeTurnDarts(0);\n                                  resetDartCount(\"High-Low\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Bob's 27\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span>Target</span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold\">\n                              D{b27Stage}\n                            </span>\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {b27Score}\n                          </div>\n                          {b27Finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={resetB27}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Count-Up\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Round {cuRound}/8\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {cuScore}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"High Score\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Round {hsRound}/10\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {hsScore}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Low Score\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Round {lsRound}/10\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            Score: {lsScore}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Checkout 170\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Remaining\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {co170Rem}\n                          </div>\n                          <div className=\"text-xs text-slate-400 mt-1\">\n                            Attempts: {co170Attempts} Â· Successes:{\" \"}\n                            {co170Successes}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Checkout 121\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">\n                            Remaining\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {co121Rem}\n                          </div>\n                          <div className=\"text-xs text-slate-400 mt-1\">\n                            Attempts: {co121Attempts} Â· Successes:{\" \"}\n                            {co121Successes}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Treble Practice\" && (\n                        <>\n                          <div className=\"flex items-center justify-between gap-4\">\n                            <div>\n                              <div className=\"text-xs text-slate-600\">\n                                Treble Target: T{trebleTarget}\n                              </div>\n                              <div className=\"text-3xl font-extrabold tracking-tight\">\n                                Hits: {trebleHits}\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-2 flex-wrap\">\n                              <label className=\"text-sm\">Target</label>\n                              <div className=\"inline-flex items-center gap-1\">\n                                {[20, 19, 18].map((n) => (\n                                  <button\n                                    key={`tpick-header-${n}`}\n                                    className={`btn px-2 py-0.5 text-xs ${trebleTarget === n ? \"bg-emerald-600/30 border border-emerald-400/30\" : \"\"}`}\n                                    onClick={() => setTrebleTarget(n)}\n                                  >\n                                    T{n}\n                                  </button>\n                                ))}\n                              </div>\n                              <span className=\"opacity-60 text-xs\">or</span>\n                              <select\n                                className=\"input w-24\"\n                                value={trebleTarget}\n                                onChange={(e) =>\n                                  setTrebleTarget(parseInt(e.target.value, 10))\n                                }\n                              >\n                                {Array.from(\n                                  { length: 20 },\n                                  (_, i) => i + 1,\n                                ).map((n) => (\n                                  <option key={n} value={n}>\n                                    {n}\n                                  </option>\n                                ))}\n                              </select>\n                              <button\n                                className=\"btn px-3 py-1 text-sm\"\n                                onClick={resetTreble}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Baseball\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Inning</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {baseball.inning}\n                          </div>\n                          <div className=\"text-sm\">\n                            Score:{\" \"}\n                            <span className=\"font-semibold\">\n                              {baseball.score}\n                            </span>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Golf\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Hole</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {golf.hole}\n                          </div>\n                          <div className=\"text-sm\">\n                            Strokes:{\" \"}\n                            <span className=\"font-semibold\">\n                              {golf.strokes}\n                            </span>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Tic Tac Toe\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Turn</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {ttt.turn}\n                          </div>\n                          {ttt.finished && (\n                            <div className=\"mt-1 text-xs\">\n                              Winner: {ttt.winner || \"â€”\"}\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Scam\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Target</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {SCAM_TARGET_NAMES[scam.targetIndex]}\n                          </div>\n                          <div className=\"text-sm\">\n                            Progress:{\" \"}\n                            <span className=\"font-semibold\">\n                              {scam.targetIndex + 1}/{SCAM_TARGET_NAMES.length}\n                            </span>\n                          </div>\n                          {scam.finished && (\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\n                              ðŸŽ‰ Finished in {scam.darts} darts!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Fives\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Score</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {fives.score}/{fives.target}\n                          </div>\n                          <div className=\"text-sm\">\n                            Darts:{\" \"}\n                            <span className=\"font-semibold\">{fives.darts}</span>\n                          </div>\n                          {fives.finished && (\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\n                              âœ“ Reached {fives.target}!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Sevens\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600\">Score</div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {sevens.score}/{sevens.target}\n                          </div>\n                          <div className=\"text-sm\">\n                            Darts:{\" \"}\n                            <span className=\"font-semibold\">\n                              {sevens.darts}\n                            </span>\n                          </div>\n                          {sevens.finished && (\n                            <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">\n                              âœ“ Reached {sevens.target}!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"American Cricket\" && (\n                        <>\n                          <div className=\"text-xs text-slate-600 mb-1\">\n                            Close 20â€“12 and Bull; overflow scores points\n                          </div>\n                          <div className=\"grid grid-cols-10 gap-1 text-center text-[11px] mb-2\">\n                            {AM_CRICKET_NUMBERS.map((n) => (\n                              <div\n                                key={n}\n                                className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\"\n                              >\n                                <div className=\"opacity-70\">\n                                  {n === 25 ? \"Bull\" : n}\n                                </div>\n                                <div className=\"font-semibold\">\n                                  {Math.min(3, amCricket.marks?.[n] || 0)} / 3\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                          <div className=\"text-sm\">\n                            Points:{\" \"}\n                            <span className=\"font-semibold\">\n                              {amCricket.points}\n                            </span>\n                          </div>\n                          {hasClosedAllAm(amCricket) && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={resetAmCricket}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Killer\" && (\n                        <>\n                          {!killerSetupDone ? (\n                            <div className=\"text-xs text-slate-600\">\n                              Setup players and assign numbers\n                            </div>\n                          ) : (\n                            <>\n                              <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                                <span>Turn</span>\n                                <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                                  {killerPlayers[killerTurnIdx]?.name || \"â€”\"}\n                                </span>\n                              </div>\n                              <div className=\"text-3xl font-extrabold tracking-tight\">\n                                {killerWinnerId\n                                  ? `${killerPlayers.find((p) => p.id === killerWinnerId)?.name || \"Winner\"} Wins`\n                                  : killerLastEvent || \"Ready\"}\n                              </div>\n                            </>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  ) : offlineLayout === \"modern\" ? (\n                    <div className=\"space-y-3 mb-2\">\n                      {!manualScoring ? (\n                        <>\n                          <div className=\"flex items-center flex-wrap gap-1.5 mt-1\">\n                            <div className=\"ml-auto flex items-center gap-1 text-[10px]\">\n                              <span className=\"opacity-70\">Cam</span>\n                              <button\n                                className={`btn ${buttonSizeClass}`}\n                                onClick={() =>\n                                  setCameraScale(\n                                    Math.max(\n                                      0.5,\n                                      Math.round((cameraScale - 0.05) * 100) /\n                                        100,\n                                    ),\n                                  )\n                                }\n                              >\n                                âˆ’\n                              </button>\n                              <span\n                                className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}\n                              >\n                                {Math.round(cameraScale * 100)}%\n                              </span>\n                              <button\n                                className={`btn ${buttonSizeClass}`}\n                                onClick={() =>\n                                  setCameraScale(\n                                    Math.min(\n                                      1.25,\n                                      Math.round((cameraScale + 0.05) * 100) /\n                                        100,\n                                    ),\n                                  )\n                                }\n                              >\n                                +\n                              </button>\n                              <span className=\"opacity-50\">|</span>\n                              <button\n                                className={`btn ${buttonSizeClass}`}\n                                title=\"Toggle fit/fill\"\n                                onClick={() =>\n                                  setCameraFitMode(\n                                    cameraFitMode === \"fill\" ? \"fit\" : \"fill\",\n                                  )\n                                }\n                              >\n                                {cameraFitMode === \"fill\" ? \"Fill\" : \"Fit\"}\n                              </button>\n                              <span className=\"opacity-50\">|</span>\n                              <button\n                                className={`btn ${buttonSizeClass}`}\n                                title=\"Toggle camera aspect\"\n                                onClick={() =>\n                                  setCameraAspect(\n                                    cameraAspect === \"square\"\n                                      ? \"wide\"\n                                      : \"square\",\n                                  )\n                                }\n                              >\n                                {cameraAspect === \"square\" ? \"Square\" : \"Wide\"}\n                              </button>\n                            </div>\n                          </div>\n                          <div className=\"relative\">\n                            <div className=\"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6\">\n                              <div className=\"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]\">\n                                <CameraView\n                                  scoringMode=\"x01\"\n                                  showToolbar={cameraToolbarVisible}\n                                  immediateAutoCommit\n                                  onAutoDart={(value, ring, info) => {\n                                    applyDartValue(value);\n                                  }}\n                                />\n                              </div>\n\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4\">\n                                  <div className=\"space-y-4\">\n                                    <div className=\"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\n                                      <div className=\"text-xs uppercase tracking-wide text-white/50\">\n                                        Current Shooter\n                                      </div>\n                                      <div className=\"mt-1 text-xl font-semibold text-white\">\n                                        {activePlayerName}\n                                      </div>\n                                      <div className=\"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80\">\n                                        <div>\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\n                                            Remaining\n                                          </div>\n                                          <div className=\"font-mono text-lg text-white\">\n                                            {activeRemaining}\n                                          </div>\n                                        </div>\n                                        <div>\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\n                                            Last Dart\n                                          </div>\n                                          <div className=\"font-mono text-lg text-white\">\n                                            {activeLastScore || 0}\n                                          </div>\n                                        </div>\n                                        <div>\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\n                                            Match Legs\n                                          </div>\n                                          <div className=\"font-semibold text-white\">\n                                            {playerLegs}-{aiLegs}\n                                          </div>\n                                        </div>\n                                        <div>\n                                          <div className=\"text-xs uppercase tracking-wide text-white/40\">\n                                            Next Up\n                                          </div>\n                                          <div className=\"font-medium text-white\">\n                                            {inactivePlayerName}\n                                          </div>\n                                        </div>\n                                      </div>\n                                    </div>\n                                  </div>\n\n                                  <div className=\"hidden md:block\">\n                                    <GameScoreboard\n                                      gameMode={selectedMode as any}\n                                      players={singlePlayerScoreboard}\n                                      matchScore={`${playerLegs}-${aiLegs}`}\n                                    />\n                                  </div>\n                                </div>\n\n                                <div className=\"md:hidden\">\n                                  <GameScoreboard\n                                    gameMode={selectedMode as any}\n                                    players={singlePlayerScoreboard}\n                                    matchScore={`${playerLegs}-${aiLegs}`}\n                                  />\n                                </div>\n\n                                {(selectedMode as any) === \"X01\" && (\n                                  <div className=\"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm\">\n                                    <div className=\"text-xs uppercase tracking-wide text-white/50\">\n                                      Manual Scoreboard Override\n                                    </div>\n                                    <p className=\"mt-1 text-xs text-white/40\">\n                                      Adjust the live totals if a dart was\n                                      misread. Values are clamped between 0 and{\" \"}\n                                      {x01Score}.\n                                    </p>\n                                    <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm\">\n                                      <div className=\"space-y-3\">\n                                        <div className=\"text-sm font-semibold text-white\">\n                                          {humanName}\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\n                                            Commit Visit\n                                          </label>\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <MatchControls\n                                              inProgress={true}\n                                              startingScore={x01Score}\n                                              onAddVisit={makeOfflineAddVisitAdapter(\n                                                commitManualVisitTotal,\n                                              )}\n                                              quickButtons={[180, 140, 100, 60]}\n                                              onNextPlayer={() =>\n                                                matchActions?.nextPlayer()\n                                              }\n                                              onEndLeg={() => {\n                                                /* End leg handled via commitManualVisitTotal / addVisitTotal */\n                                              }}\n                                              onUndo={() => {\n                                                /* offline undo not implemented here; optionally reset pending visit */\n                                              }}\n                                              showDartsSelect={true}\n                                            />\n                                          </div>\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\n                                            Legs Override\n                                          </label>\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <input\n                                              className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                              type=\"number\"\n                                              min={0}\n                                              value={manualPlayerLegsInput}\n                                              onChange={(e) =>\n                                                setManualPlayerLegsInput(\n                                                  e.target.value,\n                                                )\n                                              }\n                                              onKeyDown={(e) => {\n                                                if (e.key === \"Enter\")\n                                                  handleManualLegsOverride(\n                                                    \"player\",\n                                                  );\n                                              }}\n                                              placeholder={`${playerLegs}`}\n                                            />\n                                            <button\n                                              className=\"btn px-3 py-1 text-sm\"\n                                              onClick={() =>\n                                                handleManualLegsOverride(\n                                                  \"player\",\n                                                )\n                                              }\n                                            >\n                                              Set\n                                            </button>\n                                          </div>\n                                        </div>\n                                      </div>\n                                      <div className=\"space-y-3\">\n                                        <div className=\"text-sm font-semibold text-white\">\n                                          {aiDisplayName}\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\n                                            Three Dart Edit\n                                          </label>\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <input\n                                              className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                              type=\"number\"\n                                              min={0}\n                                              max={x01Score}\n                                              value={manualOpponentScoreInput}\n                                              onChange={(e) =>\n                                                setManualOpponentScoreInput(\n                                                  e.target.value,\n                                                )\n                                              }\n                                              onKeyDown={(e) => {\n                                                if (e.key === \"Enter\")\n                                                  handleManualScoreOverride(\n                                                    \"ai\",\n                                                  );\n                                              }}\n                                              placeholder={`${aiScore}`}\n                                            />\n                                            <button\n                                              className=\"btn px-3 py-1 text-sm\"\n                                              onClick={() =>\n                                                handleManualScoreOverride(\"ai\")\n                                              }\n                                            >\n                                              Set\n                                            </button>\n                                          </div>\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                          <label className=\"text-xs uppercase tracking-wide text-white/50\">\n                                            Legs Override\n                                          </label>\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <input\n                                              className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                              type=\"number\"\n                                              min={0}\n                                              value={manualOpponentLegsInput}\n                                              onChange={(e) =>\n                                                setManualOpponentLegsInput(\n                                                  e.target.value,\n                                                )\n                                              }\n                                              onKeyDown={(e) => {\n                                                if (e.key === \"Enter\")\n                                                  handleManualLegsOverride(\n                                                    \"ai\",\n                                                  );\n                                              }}\n                                              placeholder={`${aiLegs}`}\n                                            />\n                                            <button\n                                              className=\"btn px-3 py-1 text-sm\"\n                                              onClick={() =>\n                                                handleManualLegsOverride(\"ai\")\n                                              }\n                                            >\n                                              Set\n                                            </button>\n                                          </div>\n                                        </div>\n                                      </div>\n                                    </div>\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        </>\n                      ) : (\n                        <div className=\"card\">\n                          <div className=\"text-sm font-semibold mb-1\">\n                            Manual scoring active\n                          </div>\n                          <div className=\"text-xs opacity-70\">\n                            Camera previews are disabled. Use the manual entry\n                            controls below to record your turn.\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0\">\n                      <div className=\"flex items-stretch justify-center md:px-3 min-w-0\">\n                        <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\n                          <div className=\"text-xs text-slate-600 flex items-center justify-between\">\n                            <span className=\"opacity-80\">You Remain</span>\n                            {isPlayerTurn ? (\n                              <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                                THROWING\n                              </span>\n                            ) : (\n                              <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">\n                                WAITING TO THROW\n                              </span>\n                            )}\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {playerScore}\n                          </div>\n                          <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\n                            <div\n                              className=\"h-full bg-emerald-400/70\"\n                              style={{\n                                width: `${Math.max(0, Math.min(100, (1 - playerScore / x01Score) * 100))}%`,\n                              }}\n                            />\n                          </div>\n                          <div className=\"text-sm mt-1 opacity-90\">\n                            Last dart:{\" \"}\n                            <span className=\"font-semibold\">\n                              {playerLastDart}\n                            </span>\n                          </div>\n                          <div className=\"text-sm opacity-90\">\n                            Last score:{\" \"}\n                            <span className=\"font-semibold\">\n                              {playerVisitDarts > 0\n                                ? playerVisitSum\n                                : (playerLastVisitScore ?? playerLastDart)}\n                            </span>\n                          </div>\n                          <div className=\"text-sm opacity-90\">\n                            3-Dart Avg:{\" \"}\n                            <span className=\"font-semibold\">\n                              {totalPlayerDarts > 0\n                                ? (\n                                    (totalPlayerPoints / totalPlayerDarts) *\n                                    3\n                                  ).toFixed(1)\n                                : \"0.0\"}\n                            </span>\n                          </div>\n                          <div className=\"text-xs opacity-70 flex items-center gap-2\">\n                            <span>Darts thrown: {playerDartsThrown}</span>\n                            <span\n                              className=\"inline-flex items-center gap-1\"\n                              aria-label=\"Visit darts\"\n                            >\n                              {[0, 1, 2].map((i) => (\n                                <span\n                                  key={i}\n                                  className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? \"bg-emerald-400\" : \"bg-white/20\"}`}\n                                ></span>\n                              ))}\n                            </span>\n                          </div>\n                          <div className=\"text-xs opacity-80 mt-1\">\n                            Doubles:{\" \"}\n                            <span className=\"font-semibold\">\n                              Att {playerDoublesAtt} Â· Hit {playerDoublesHit}\n                            </span>\n                          </div>\n                          {playerScore <= 170 &&\n                            playerScore > 0 &&\n                            (() => {\n                              const sugs = suggestCheckouts(\n                                playerScore,\n                                favoriteDouble,\n                              );\n                              const first = sugs[0] || \"â€”\";\n                              return (\n                                <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\n                                  <span className=\"opacity-70\">Checkout</span>\n                                  <span className=\"font-semibold\">{first}</span>\n                                </div>\n                              );\n                            })()}\n                        </div>\n                        {/* Center camera preview: right-aligned and square when selected */}\n                        <div className=\"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall\">\n                          <ResizablePanel\n                            storageKey=\"ndn:camera:tile:offline:center:v4\"\n                            className=\"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card\"\n                            defaultWidth={0}\n                            defaultHeight={0}\n                            minWidth={300}\n                            minHeight={300}\n                            maxWidth={2000}\n                            maxHeight={1200}\n                            autoFill\n                          >\n                            <CameraTile\n                              label=\"Your Board\"\n                              autoStart={true}\n                              className=\"min-w-0 h-full\"\n                              aspect=\"classic\"\n                              fill\n                            />\n                          </ResizablePanel>\n                        </div>\n                        {/* Match summary (offline) */}\n                        <div\n                          className={`mt-2 ${boxSize === \"small\" ? \"p-2\" : boxSize === \"large\" ? \"p-4\" : \"p-3\"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === \"small\" ? \"text-xs\" : textSize === \"large\" ? \"text-base\" : \"text-sm\"}`}\n                        >\n                          <div className=\"font-semibold mb-2\">\n                            Match Summary\n                          </div>\n                          {(() => {\n                            // In offline X01, player is vs AI or practice\n                            const currentThrower = isPlayerTurn\n                              ? user?.username || \"You\"\n                              : ai === \"None\"\n                                ? \"â€”\"\n                                : `${ai} AI`;\n                            const currentRemaining = isPlayerTurn\n                              ? playerScore\n                              : ai === \"None\"\n                                ? 0\n                                : aiScore;\n                            const lastScoreDisplay = isPlayerTurn\n                              ? playerVisitDarts > 0\n                                ? playerVisitSum\n                                : (playerLastVisitScore ?? playerLastDart)\n                              : aiVisitDarts > 0\n                                ? aiVisitSum\n                                : (aiLastVisitScore ?? aiLastDart);\n                            const dartsThrown = isPlayerTurn\n                              ? playerDartsThrown\n                              : aiDartsThrown;\n                            const scored =\n                              x01Score -\n                              (isPlayerTurn\n                                ? playerScore\n                                : ai === \"None\"\n                                  ? x01Score\n                                  : aiScore);\n                            const avg3 =\n                              dartsThrown > 0 ? (scored / dartsThrown) * 3 : 0;\n                            const matchScore = `${playerLegs}-${aiLegs}`;\n                            const bestLegText =\n                              legStats.length > 0\n                                ? `${Math.min(...legStats.map((l) => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\n                                : \"â€”\";\n                            return (\n                              <div className=\"grid grid-cols-2 gap-y-1\">\n                                <div className=\"opacity-80\">Current score</div>\n                                <div className=\"font-mono text-right\">\n                                  {matchScore}\n                                </div>\n                                <div className=\"opacity-80\">\n                                  Current thrower\n                                </div>\n                                <div className=\"text-right font-semibold text-lg\">\n                                  {currentThrower}\n                                </div>\n                                <div className=\"opacity-80\">\n                                  Score remaining\n                                </div>\n                                <div className=\"text-right font-mono font-bold text-xl\">\n                                  {currentRemaining}\n                                </div>\n                                <div className=\"opacity-80\">3-dart avg</div>\n                                <div className=\"text-right font-mono\">\n                                  {avg3.toFixed(1)}\n                                </div>\n                                <div className=\"opacity-80\">Last score</div>\n                                <div className=\"text-right font-mono\">\n                                  {lastScoreDisplay}\n                                </div>\n                                <div className=\"opacity-80\">Best leg</div>\n                                <div className=\"text-right\">{bestLegText}</div>\n                              </div>\n                            );\n                          })()}\n                        </div>\n                        <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\n                          <div className=\"text-xs flex items-center justify-between opacity-80\">\n                            <span>\n                              {ai === \"None\" ? \"Opponent\" : `${ai} AI`} Remain\n                            </span>\n                            {!isPlayerTurn ? (\n                              <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">\n                                THROWING\n                              </span>\n                            ) : (\n                              <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">\n                                WAITING TO THROW\n                              </span>\n                            )}\n                          </div>\n                          <div className=\"text-3xl font-extrabold tracking-tight\">\n                            {ai !== \"None\" ? aiScore : \"N/A\"}\n                          </div>\n                          {ai !== \"None\" && (\n                            <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\n                              <div\n                                className=\"h-full bg-fuchsia-400/70\"\n                                style={{\n                                  width: `${Math.max(0, Math.min(100, (1 - aiScore / x01Score) * 100))}%`,\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"text-sm mt-1 opacity-90\">\n                            Last dart:{\" \"}\n                            <span className=\"font-semibold\">\n                              {ai === \"None\" ? 0 : aiLastDart}\n                            </span>\n                          </div>\n                          <div className=\"text-sm opacity-90\">\n                            Last score:{\" \"}\n                            <span className=\"font-semibold\">\n                              {ai === \"None\"\n                                ? \"â€”\"\n                                : aiVisitDarts > 0\n                                  ? aiVisitSum\n                                  : (aiLastVisitScore ?? aiLastDart)}\n                            </span>\n                          </div>\n                          <div className=\"text-sm opacity-90\">\n                            3-Dart Avg:{\" \"}\n                            <span className=\"font-semibold\">\n                              {ai !== \"None\"\n                                ? totalAiDarts > 0\n                                  ? (\n                                      (totalAiPoints / totalAiDarts) *\n                                      3\n                                    ).toFixed(1)\n                                  : \"0.0\"\n                                : \"â€”\"}\n                            </span>\n                          </div>\n                          {ai !== \"None\" && (\n                            <div className=\"text-xs opacity-70\">\n                              Darts thrown: {aiDartsThrown}\n                            </div>\n                          )}\n                          {ai !== \"None\" && (\n                            <div className=\"text-xs opacity-80 mt-1\">\n                              Doubles:{\" \"}\n                              <span className=\"font-semibold\">\n                                Att {aiDoublesAtt} Â· Hit {aiDoublesHit}\n                              </span>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                  {/* Turn area */}\n                  {selectedMode !== \"X01\" ? (\n                    <div className=\"space-y-2\">\n                      {selectedMode === \"Double Practice\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Target:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {DOUBLE_PRACTICE_ORDER[dpIndex]?.label || \"â€”\"}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                onAutoDart={(value, ring) => {\n                                  if (\n                                    ring === \"DOUBLE\" ||\n                                    ring === \"INNER_BULL\"\n                                  ) {\n                                    const hit = isDoubleHit(value, dpIndex);\n                                    if (hit) {\n                                      const nh = dpHits + 1;\n                                      const ni = dpIndex + 1;\n                                      setDpHits(nh);\n                                      setDpIndex(ni);\n                                      if (nh >= DOUBLE_PRACTICE_ORDER.length)\n                                        setTimeout(() => {\n                                          setDpHits(0);\n                                          setDpIndex(0);\n                                        }, 250);\n                                    }\n                                  }\n                                }}\n                                immediateAutoCommit\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-col gap-2\">\n                            <div className=\"flex items-center gap-2\">\n                              <input\n                                className=\"input w-24\"\n                                type=\"number\"\n                                min={0}\n                                max={60}\n                                value={playerDartPoints}\n                                onChange={(e) =>\n                                  setPlayerDartPoints(\n                                    Number(e.target.value || 0),\n                                  )\n                                }\n                                onKeyDown={(e) => {\n                                  if (e.key === \"Enter\") addDpNumeric();\n                                }}\n                              />\n                              <button\n                                className=\"btn px-3 py-1 text-sm\"\n                                onClick={addDpNumeric}\n                              >\n                                Add Dart\n                              </button>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <input\n                                className=\"input w-44\"\n                                placeholder=\"Manual (D16, 50, 25, T20)\"\n                                value={manualBox}\n                                onChange={(e) => setManualBox(e.target.value)}\n                                onKeyDown={(e) => {\n                                  if (e.key === \"Enter\") addDpManual();\n                                }}\n                              />\n                              <button\n                                className=\"btn px-3 py-1 text-sm\"\n                                onClick={addDpManual}\n                              >\n                                Add\n                              </button>\n                            </div>\n                          </div>\n                          <div className=\"text-xs text-slate-300\">\n                            Progress: {dpHits} of 21\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Around the Clock\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Target:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {ATC_ORDER[atcIndex] === 25\n                                ? \"25 (Outer Bull)\"\n                                : ATC_ORDER[atcIndex] === 50\n                                  ? \"50 (Inner Bull)\"\n                                  : ATC_ORDER[atcIndex] || \"â€”\"}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addAtcValue(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addAtcNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addAtcNumeric}\n                            >\n                              Add Dart\n                            </button>\n                          </div>\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-44\"\n                              placeholder=\"Manual (T20, D5, 25, 50)\"\n                              value={manualBox}\n                              onChange={(e) => setManualBox(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addAtcManual();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addAtcManual}\n                            >\n                              Add\n                            </button>\n                          </div>\n                          {atcHits >= ATC_ORDER.length && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={() => {\n                                  setAtcHits(0);\n                                  setAtcIndex(0);\n                                  resetDartCount(\"Around the Clock\");\n                                }}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Cricket\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addCricketAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addCricketNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addCricketNumeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setCricket(createCricketState());\n                                setPracticeTurnDarts(0);\n                                resetDartCount(\"Cricket\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Shanghai\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addShanghaiAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addShanghaiNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addShanghaiNumeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setShanghai(createShanghaiState());\n                                setPracticeTurnDarts(0);\n                                resetDartCount(\"Shanghai\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Halve It\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addHalveAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addHalveNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addHalveNumeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setHalve(createDefaultHalveIt());\n                                setPracticeTurnDarts(0);\n                                resetDartCount(\"Halve It\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"High-Low\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addHighLowAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addHighLowNumeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addHighLowNumeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setHighlow(createHighLow());\n                                setPracticeTurnDarts(0);\n                                resetDartCount(\"High-Low\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Bob's 27\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addB27Auto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addB27Numeric();\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addB27Numeric}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetB27}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Count-Up\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value) => addCountUpAuto(value)}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  addCountUpAuto(playerDartPoints);\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                addCountUpAuto(playerDartPoints);\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setCuRound(1);\n                                setCuScore(0);\n                                setCuDarts(0);\n                                resetDartCount(\"Count-Up\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Round {cuRound}/{cuMaxRounds}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"High Score\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value) => addHighScoreAuto(value)}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  addHighScoreAuto(playerDartPoints);\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                addHighScoreAuto(playerDartPoints);\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setHsRound(1);\n                                setHsScore(0);\n                                setHsDarts(0);\n                                resetDartCount(\"High Score\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Round {hsRound}/{hsMaxRounds}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Low Score\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value) => addLowScoreAuto(value)}\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={0}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  addLowScoreAuto(playerDartPoints);\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                addLowScoreAuto(playerDartPoints);\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setLsRound(1);\n                                setLsScore(0);\n                                setLsDarts(0);\n                                resetDartCount(\"Low Score\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Round {lsRound}/{lsMaxRounds}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Checkout 170\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring) =>\n                                  addCo170Auto(\n                                    value,\n                                    ring === \"MISS\" ? undefined : ring,\n                                  )\n                                }\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"text\"\n                              placeholder=\"Manual (D16, T20)\"\n                              value={manualBox}\n                              onChange={(e) => setManualBox(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addCoManual(true);\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => addCoManual(true)}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetCo170}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Remaining: {co170Rem} Â· Attempts: {co170Attempts} Â·\n                            Successes: {co170Successes}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Checkout 121\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring) =>\n                                  addCo121Auto(\n                                    value,\n                                    ring === \"MISS\" ? undefined : ring,\n                                  )\n                                }\n                                onAddVisit={makeOfflineAddVisitAdapter(\n                                  commitManualVisitTotal,\n                                )}\n                                onEndLeg={(s?: number) =>\n                                  matchActions.endLeg(s)\n                                }\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"text\"\n                              placeholder=\"Manual (D16, T20)\"\n                              value={manualBox}\n                              onChange={(e) => setManualBox(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") addCoManual(false);\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => addCoManual(false)}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetCo121}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Remaining: {co121Rem} Â· Attempts: {co121Attempts} Â·\n                            Successes: {co121Successes}\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Treble Practice\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addTrebleAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"text\"\n                              placeholder=\"Manual (T20)\"\n                              value={manualBox}\n                              onChange={(e) => setManualBox(e.target.value)}\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  const v = parseManualDart(manualBox);\n                                  if (v != null)\n                                    addTrebleAuto(v, undefined, undefined);\n                                  setManualBox(\"\");\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                const v = parseManualDart(manualBox);\n                                if (v != null)\n                                  addTrebleAuto(v, undefined, undefined);\n                                setManualBox(\"\");\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Hits: {trebleHits} Â· Misses:{\" \"}\n                            {Math.max(0, trebleDarts - trebleHits)} Â· Darts:{\" \"}\n                            {trebleDarts}\n                            {trebleMaxDarts > 0 ? `/${trebleMaxDarts}` : \"\"}\n                          </div>\n                          {trebleFinished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              Completed!{\" \"}\n                              <button\n                                className=\"ml-2 underline\"\n                                onClick={resetTreble}\n                              >\n                                Reset\n                              </button>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Baseball\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addBaseballAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetBaseball}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Golf\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addGolfAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetGolf}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Tic Tac Toe\" && (\n                        <>\n                          <div className=\"grid grid-cols-3 gap-1 mb-2\">\n                            {Array.from({ length: 9 }, (_, i) => i).map(\n                              (cell) => (\n                                <button\n                                  key={cell}\n                                  className={`h-16 rounded-xl border ${ttt.board[cell] ? \"bg-emerald-500/20 border-emerald-400/30\" : \"bg-slate-800/50 border-slate-700/50\"}`}\n                                  onClick={() => {\n                                    if (ttt.finished || ttt.board[cell]) return;\n                                    // One-tap claim attempt using autoscore last dart; fallback: prompt numeric\n                                    // For simplicity here, we use a no-op value and rely on next autoscore dart; as a usable fallback, open a numeric prompt\n                                    const promptVal = Number(\n                                      prompt(\n                                        \"Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)\",\n                                      ) || 0,\n                                    );\n                                    const ring =\n                                      promptVal % 3 === 0\n                                        ? \"TRIPLE\"\n                                        : promptVal % 2 === 0\n                                          ? \"DOUBLE\"\n                                          : \"SINGLE\";\n                                    const tcell = cell as unknown as\n                                      | 0\n                                      | 1\n                                      | 2\n                                      | 3\n                                      | 4\n                                      | 5\n                                      | 6\n                                      | 7\n                                      | 8;\n                                    const tgt = TTT_TARGETS[tcell];\n                                    const num =\n                                      tgt.type === \"BULL\"\n                                        ? null\n                                        : tgt.num || null;\n                                    addTttAuto(\n                                      tcell,\n                                      promptVal,\n                                      ring as any,\n                                      num as any,\n                                    );\n                                  }}\n                                >\n                                  {ttt.board[cell] || \"\"}\n                                </button>\n                              ),\n                            )}\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  // Attempt to claim the currently tapped-looking cell not tracked; as a simple flow, map by round-robin preference or let user click a cell button above.\n                                  // No-op here; primary interaction is via buttons with prompt for now.\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetTtt}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"American Cricket\" && (\n                        <>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addAmCricketAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={resetAmCricket}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                        </>\n                      )}\n                      {selectedMode === \"Scam\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Target:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {SCAM_TARGET_NAMES[scamPlayer.targetIndex]}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  recordDart(\"Scam\");\n                                  setScamPlayer(\n                                    addScamAuto(scamPlayer, value, r as any),\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={1}\n                              max={25}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  recordDart(\"Scam\");\n                                  setScamPlayer(\n                                    addScamNumeric(\n                                      scamPlayer,\n                                      playerDartPoints,\n                                    ),\n                                  );\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                recordDart(\"Scam\");\n                                setScamPlayer(\n                                  addScamNumeric(scamPlayer, playerDartPoints),\n                                );\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setScamPlayer(resetScam());\n                                resetDartCount(\"Scam\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          {scamPlayer.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              ðŸŽ‰ Finished in {scamPlayer.darts} darts!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Fives\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Score:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {fivesPlayer.score}/{fivesPlayer.target}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  recordDart(\"Fives\");\n                                  setFivesPlayer(\n                                    addFivesAuto(\n                                      fivesPlayer,\n                                      value,\n                                      ring as any,\n                                    ),\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={5}\n                              max={50}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  recordDart(\"Fives\");\n                                  setFivesPlayer(\n                                    addFivesNumeric(\n                                      fivesPlayer,\n                                      playerDartPoints,\n                                    ),\n                                  );\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                recordDart(\"Fives\");\n                                setFivesPlayer(\n                                  addFivesNumeric(\n                                    fivesPlayer,\n                                    playerDartPoints,\n                                  ),\n                                );\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setFivesPlayer(resetFives(fivesPlayer.target));\n                                resetDartCount(\"Fives\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:{\" \"}\n                            {fivesPlayer.darts}\n                          </div>\n                          {fivesPlayer.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              âœ“ Reached {fivesPlayer.target} in{\" \"}\n                              {fivesPlayer.darts} darts!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Sevens\" && (\n                        <>\n                          <div className=\"font-semibold\">\n                            Score:{\" \"}\n                            <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\n                              {sevensPlayer.score}/{sevensPlayer.target}\n                            </span>\n                          </div>\n                          {cameraEnabled && (\n                            <div className=\"rounded-2xl overflow-hidden bg-black\">\n                              <CameraView\n                                scoringMode=\"custom\"\n                                showToolbar={cameraToolbarVisible}\n                                immediateAutoCommit\n                                onAutoDart={(value, ring, info) => {\n                                  recordDart(\"Sevens\");\n                                  setSevensPlayer(\n                                    addSevensAuto(\n                                      sevensPlayer,\n                                      value,\n                                      ring as any,\n                                    ),\n                                  );\n                                }}\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <input\n                              className=\"input w-24\"\n                              type=\"number\"\n                              min={7}\n                              max={21}\n                              value={playerDartPoints}\n                              onChange={(e) =>\n                                setPlayerDartPoints(Number(e.target.value || 0))\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  recordDart(\"Sevens\");\n                                  setSevensPlayer(\n                                    addSevensNumeric(\n                                      sevensPlayer,\n                                      playerDartPoints,\n                                    ),\n                                  );\n                                  setPlayerDartPoints(0);\n                                }\n                              }}\n                            />\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={() => {\n                                recordDart(\"Sevens\");\n                                setSevensPlayer(\n                                  addSevensNumeric(\n                                    sevensPlayer,\n                                    playerDartPoints,\n                                  ),\n                                );\n                                setPlayerDartPoints(0);\n                              }}\n                            >\n                              Add Dart\n                            </button>\n                            <button\n                              className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                              onClick={() => {\n                                setSevensPlayer(\n                                  resetSevens(sevensPlayer.target),\n                                );\n                                resetDartCount(\"Sevens\");\n                              }}\n                            >\n                              Reset\n                            </button>\n                          </div>\n                          <div className=\"text-xs text-slate-400\">\n                            Valid scores: 7, 14, 21 Â· Darts:{\" \"}\n                            {sevensPlayer.darts}\n                          </div>\n                          {sevensPlayer.finished && (\n                            <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                              âœ“ Reached {sevensPlayer.target} in{\" \"}\n                              {sevensPlayer.darts} darts!\n                            </div>\n                          )}\n                        </>\n                      )}\n                      {selectedMode === \"Killer\" && (\n                        <>\n                          {!killerSetupDone ? (\n                            <div className=\"space-y-2\">\n                              <div className=\"font-semibold\">Players</div>\n                              <div className=\"space-y-1\">\n                                {killerPlayers.map((p, idx) => (\n                                  <div\n                                    key={p.id}\n                                    className=\"flex items-center gap-2\"\n                                  >\n                                    <input\n                                      className=\"input\"\n                                      value={p.name}\n                                      onChange={(e) => {\n                                        const name = e.target.value;\n                                        setKillerPlayers((list) =>\n                                          list.map((it, i) =>\n                                            i === idx ? { ...it, name } : it,\n                                          ),\n                                        );\n                                      }}\n                                    />\n                                    <button\n                                      className=\"btn px-2 py-1\"\n                                      onClick={() =>\n                                        setKillerPlayers((list) =>\n                                          list.filter((_, i) => i !== idx),\n                                        )\n                                      }\n                                      disabled={killerPlayers.length <= 2}\n                                    >\n                                      Remove\n                                    </button>\n                                  </div>\n                                ))}\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <button\n                                  className=\"btn px-2 py-1\"\n                                  onClick={() =>\n                                    setKillerPlayers((list) => {\n                                      const id = `p${list.length + 1}`;\n                                      return [\n                                        ...list,\n                                        {\n                                          id,\n                                          name: `Player ${list.length + 1}`,\n                                        },\n                                      ];\n                                    })\n                                  }\n                                >\n                                  Add Player\n                                </button>\n                                <button\n                                  className=\"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1\"\n                                  onClick={() => {\n                                    if (killerPlayers.length < 2) {\n                                      alert(\"Need at least 2 players\");\n                                      return;\n                                    }\n                                    const ids = killerPlayers.map((p) => p.id);\n                                    const assigned = assignKillerNumbers(ids);\n                                    const initStates: Record<\n                                      string,\n                                      KillerState\n                                    > = {};\n                                    ids.forEach((id) => {\n                                      initStates[id] = createKillerState(\n                                        assigned[id],\n                                      );\n                                    });\n                                    setKillerAssigned(assigned);\n                                    setKillerStates(initStates);\n                                    setKillerTurnIdx(0);\n                                    setKillerDarts(0);\n                                    setKillerWinnerId(null);\n                                    setKillerLastEvent(\"Assigned numbers\");\n                                    setKillerSetupDone(true);\n                                  }}\n                                >\n                                  Assign Numbers & Start\n                                </button>\n                              </div>\n                            </div>\n                          ) : (\n                            <div className=\"space-y-3\">\n                              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\n                                {killerPlayers.map((p) => {\n                                  const st = killerStates[p.id];\n                                  const num = killerAssigned[p.id];\n                                  return (\n                                    <div\n                                      key={p.id}\n                                      className={`p-2 rounded-xl border ${st?.eliminated ? \"opacity-50 border-red-500/40 bg-red-500/10\" : \"border-slate-700/50 bg-slate-800/50\"}`}\n                                    >\n                                      <div className=\"flex items-center justify-between text-xs\">\n                                        <div className=\"font-semibold\">\n                                          {p.name}\n                                        </div>\n                                        <div\n                                          className={`text-[10px] px-1.5 py-0.5 rounded ${st?.isKiller ? \"bg-purple-500/20 text-purple-200 border border-purple-400/30\" : \"bg-slate-600/30 text-slate-300\"}`}\n                                        >\n                                          {st?.isKiller\n                                            ? \"Killer\"\n                                            : \"Not Killer\"}\n                                        </div>\n                                      </div>\n                                      <div className=\"mt-1 text-sm\">\n                                        Number:{\" \"}\n                                        <span className=\"font-semibold\">\n                                          {num}\n                                        </span>\n                                      </div>\n                                      <div className=\"text-sm\">\n                                        Lives:{\" \"}\n                                        <span className=\"font-semibold\">\n                                          {st?.lives ?? 0}\n                                        </span>\n                                      </div>\n                                    </div>\n                                  );\n                                })}\n                              </div>\n                              {cameraEnabled && (\n                                <div className=\"rounded-2xl overflow-hidden bg-black\">\n                                  <CameraView\n                                    scoringMode=\"custom\"\n                                    showToolbar={cameraToolbarVisible}\n                                    immediateAutoCommit\n                                    onAutoDart={(value, ring, info) => {\n                                      if (killerWinnerId) return;\n                                      const r =\n                                        ring === \"MISS\" ? undefined : ring;\n                                      const sector = info?.sector ?? null;\n                                      const cur = killerPlayers[killerTurnIdx];\n                                      if (!cur) return;\n                                      setKillerStates((prev) => {\n                                        const copy: Record<\n                                          string,\n                                          KillerState\n                                        > = {};\n                                        Object.keys(prev).forEach(\n                                          (k) => (copy[k] = { ...prev[k] }),\n                                        );\n                                        const res = applyKillerDart(\n                                          cur.id,\n                                          copy,\n                                          r as any,\n                                          sector,\n                                        );\n                                        if (res.becameKiller)\n                                          setKillerLastEvent(\n                                            `${cur.name} became a Killer`,\n                                          );\n                                        else if (res.victimId) {\n                                          const v = killerPlayers.find(\n                                            (p) => p.id === res.victimId,\n                                          );\n                                          setKillerLastEvent(\n                                            `${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved || 0) > 1 ? \"s\" : \"\"})`,\n                                          );\n                                        } else setKillerLastEvent(\"No effect\");\n                                        // Check winner\n                                        const win = killerWinner(copy);\n                                        if (win) setKillerWinnerId(win);\n                                        return copy;\n                                      });\n                                      setKillerDarts((d) => {\n                                        const nd = d + 1;\n                                        if (nd >= 3) {\n                                          // advance to next alive\n                                          let next = killerTurnIdx;\n                                          for (\n                                            let i = 1;\n                                            i <= killerPlayers.length;\n                                            i++\n                                          ) {\n                                            const idx =\n                                              (killerTurnIdx + i) %\n                                              killerPlayers.length;\n                                            const pid = killerPlayers[idx].id;\n                                            const st = killerStates[pid];\n                                            if (\n                                              st &&\n                                              !st.eliminated &&\n                                              st.lives > 0\n                                            ) {\n                                              next = idx;\n                                              break;\n                                            }\n                                          }\n                                          setKillerTurnIdx(next);\n                                          return 0;\n                                        }\n                                        return nd;\n                                      });\n                                    }}\n                                  />\n                                </div>\n                              )}\n                              <div className=\"flex items-center gap-2\">\n                                <input\n                                  className=\"input w-40\"\n                                  placeholder=\"Manual (D16, T5)\"\n                                  value={manualBox}\n                                  onChange={(e) => setManualBox(e.target.value)}\n                                  onKeyDown={(e) => {\n                                    if (e.key === \"Enter\") {\n                                      if (killerWinnerId) return;\n                                      const t = manualBox.trim().toUpperCase();\n                                      const m = t.match(\n                                        /^(S|D|T)?\\s*(\\d{1,2})$/,\n                                      );\n                                      if (!m) {\n                                        setManualBox(\"\");\n                                        return;\n                                      }\n                                      const mult = (m[1] || \"S\") as\n                                        | \"S\"\n                                        | \"D\"\n                                        | \"T\";\n                                      const num = parseInt(m[2], 10);\n                                      const ring =\n                                        mult === \"D\"\n                                          ? \"DOUBLE\"\n                                          : mult === \"T\"\n                                            ? \"TRIPLE\"\n                                            : \"SINGLE\";\n                                      const cur = killerPlayers[killerTurnIdx];\n                                      setKillerStates((prev) => {\n                                        const copy: Record<\n                                          string,\n                                          KillerState\n                                        > = {};\n                                        Object.keys(prev).forEach(\n                                          (k) => (copy[k] = { ...prev[k] }),\n                                        );\n                                        const res = applyKillerDart(\n                                          cur.id,\n                                          copy,\n                                          ring as any,\n                                          num,\n                                        );\n                                        if (res.becameKiller)\n                                          setKillerLastEvent(\n                                            `${cur.name} became a Killer`,\n                                          );\n                                        else if (res.victimId) {\n                                          const v = killerPlayers.find(\n                                            (p) => p.id === res.victimId,\n                                          );\n                                          setKillerLastEvent(\n                                            `${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved || 0) > 1 ? \"s\" : \"\"})`,\n                                          );\n                                        } else setKillerLastEvent(\"No effect\");\n                                        const win = killerWinner(copy);\n                                        if (win) setKillerWinnerId(win);\n                                        return copy;\n                                      });\n                                      setManualBox(\"\");\n                                      setKillerDarts((d) => {\n                                        const nd = d + 1;\n                                        if (nd >= 3) {\n                                          let next = killerTurnIdx;\n                                          for (\n                                            let i = 1;\n                                            i <= killerPlayers.length;\n                                            i++\n                                          ) {\n                                            const idx =\n                                              (killerTurnIdx + i) %\n                                              killerPlayers.length;\n                                            const pid = killerPlayers[idx].id;\n                                            const st = killerStates[pid];\n                                            if (\n                                              st &&\n                                              !st.eliminated &&\n                                              st.lives > 0\n                                            ) {\n                                              next = idx;\n                                              break;\n                                            }\n                                          }\n                                          setKillerTurnIdx(next);\n                                          return 0;\n                                        }\n                                        return nd;\n                                      });\n                                    }\n                                  }}\n                                />\n                                <button\n                                  className=\"btn px-3 py-1 text-sm\"\n                                  onClick={() => {\n                                    // Skip to next alive player\n                                    let next = killerTurnIdx;\n                                    for (\n                                      let i = 1;\n                                      i <= killerPlayers.length;\n                                      i++\n                                    ) {\n                                      const idx =\n                                        (killerTurnIdx + i) %\n                                        killerPlayers.length;\n                                      const pid = killerPlayers[idx].id;\n                                      const st = killerStates[pid];\n                                      if (\n                                        st &&\n                                        !st.eliminated &&\n                                        st.lives > 0\n                                      ) {\n                                        next = idx;\n                                        break;\n                                      }\n                                    }\n                                    setKillerTurnIdx(next);\n                                    setKillerDarts(0);\n                                  }}\n                                >\n                                  Next Player\n                                </button>\n                                <button\n                                  className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\"\n                                  onClick={() => {\n                                    // Reset Killer\n                                    setKillerStates({});\n                                    setKillerAssigned({});\n                                    setKillerSetupDone(false);\n                                    setKillerTurnIdx(0);\n                                    setKillerDarts(0);\n                                    setKillerWinnerId(null);\n                                    setKillerLastEvent(\"\");\n                                  }}\n                                >\n                                  Reset\n                                </button>\n                              </div>\n                              {killerWinnerId && (\n                                <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">\n                                  Winner:{\" \"}\n                                  {\n                                    killerPlayers.find(\n                                      (p) => p.id === killerWinnerId,\n                                    )?.name\n                                  }{\" \"}\n                                  <button\n                                    className=\"ml-2 underline\"\n                                    onClick={() => {\n                                      setKillerStates({});\n                                      setKillerAssigned({});\n                                      setKillerSetupDone(false);\n                                      setKillerTurnIdx(0);\n                                      setKillerDarts(0);\n                                      setKillerWinnerId(null);\n                                      setKillerLastEvent(\"\");\n                                    }}\n                                  >\n                                    Play Again\n                                  </button>\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {/* Scorecard + Camera split (Option A): Scoreboard LEFT, Camera RIGHT */}\n                      <div className=\"flex gap-3 min-h-0 flex-1 text-[14px]\">\n                        {/* Left column: Scoreboard + Manual Scoring (50% width) */}\n                        <div className=\"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm\">\n                          <div className=\"text-sm font-semibold opacity-80\">\n                            Scoreboard\n                          </div>\n                          {/* Scoreboard */}\n                          <div className=\"flex-shrink-0\">\n                            <GameScoreboard\n                              gameMode={selectedMode as any}\n                              players={statsX01}\n                              matchScore={`${playerLegs}-${aiLegs}`}\n                            />\n                          </div>\n\n                          {/* Manual Scoring Section */}\n                          {isPlayerTurn && (\n                            <div className=\"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0\">\n                              <div className=\"flex flex-wrap items-center justify-between gap-3\">\n                                <h4 className=\"text-sm font-semibold tracking-wide uppercase text-indigo-200\">\n                                  Manual Scoring\n                                </h4>\n                                <span className=\"text-xs text-white/60\">\n                                  Override a visit or enter dart-by-dart scores.\n                                </span>\n                              </div>\n                              <div className=\"mt-3 space-y-3\">\n                                <div className=\"flex flex-wrap items-center gap-2\">\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\n                                    Single Dart\n                                  </label>\n                                  <input\n                                    className=\"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                    type=\"number\"\n                                    min={0}\n                                    max={60}\n                                    value={playerDartPoints}\n                                    onChange={(e) =>\n                                      setPlayerDartPoints(\n                                        Number(e.target.value || 0),\n                                      )\n                                    }\n                                    onKeyDown={(e) => {\n                                      if (e.key === \"Enter\")\n                                        e.shiftKey\n                                          ? replaceLast()\n                                          : addDartNumeric();\n                                    }}\n                                    placeholder=\"60\"\n                                  />\n                                  <button\n                                    className=\"btn px-3 py-1 text-sm\"\n                                    onClick={addDartNumeric}\n                                  >\n                                    Add Dart\n                                  </button>\n                                </div>\n\n                                <div className=\"flex flex-wrap items-center gap-2\">\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\n                                    Three Dart Edit\n                                  </label>\n                                  <input\n                                    className=\"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                    type=\"number\"\n                                    min={0}\n                                    max={playerScore <= 170 ? 170 : 180}\n                                    value={visitTotalInput}\n                                    onChange={(e) =>\n                                      handleVisitTotalChange(e.target.value)\n                                    }\n                                    onKeyDown={(e) => {\n                                      if (e.key === \"Enter\") addVisitTotal();\n                                    }}\n                                    placeholder=\"100\"\n                                  />\n                                  <button\n                                    className=\"btn px-3 py-1 text-sm\"\n                                    onClick={addVisitTotal}\n                                  >\n                                    Commit Visit\n                                  </button>\n                                  <button\n                                    className=\"btn btn--ghost px-3 py-1 text-sm\"\n                                    onClick={replaceLast}\n                                  >\n                                    Undo Visit\n                                  </button>\n                                </div>\n\n                                <div className=\"flex flex-wrap items-center gap-2\">\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\n                                    Manual\n                                  </label>\n                                  <input\n                                    className=\"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40\"\n                                    value={manualBox}\n                                    onChange={(e) =>\n                                      setManualBox(e.target.value)\n                                    }\n                                    onKeyDown={(e) => {\n                                      if (e.key === \"Enter\")\n                                        e.shiftKey\n                                          ? replaceLastManual()\n                                          : addManual();\n                                    }}\n                                    placeholder=\"T20\"\n                                  />\n                                  <button\n                                    className=\"btn px-3 py-1 text-sm\"\n                                    onClick={addManual}\n                                  >\n                                    Apply\n                                  </button>\n                                  <button\n                                    className=\"btn btn--ghost px-3 py-1 text-sm\"\n                                    onClick={replaceLastManual}\n                                    disabled={playerVisitDarts === 0}\n                                  >\n                                    Replace Last\n                                  </button>\n                                </div>\n\n                                <div>\n                                  <label className=\"text-xs uppercase tracking-wide text-white/60\">\n                                    Multi-entry (one per line)\n                                  </label>\n                                  <textarea\n                                    className=\"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30\"\n                                    rows={3}\n                                    value={manualTextarea}\n                                    onChange={(e) =>\n                                      setManualTextarea(e.target.value)\n                                    }\n                                    placeholder={\"T20\\nD16\\n25\"}\n                                  />\n                                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                                    <button\n                                      className=\"btn px-3 py-1 text-sm\"\n                                      onClick={addManualTextarea}\n                                    >\n                                      Apply All\n                                    </button>\n                                    <button\n                                      className=\"btn btn--ghost px-3 py-1 text-sm\"\n                                      onClick={() => setManualTextarea(\"\")}\n                                    >\n                                      Clear\n                                    </button>\n                                  </div>\n                                </div>\n\n                                <div className=\"pt-2 border-t border-white/10 mt-3\">\n                                  <button\n                                    className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\"\n                                    onClick={clearCurrentVisit}\n                                    disabled={\n                                      playerVisitDarts === 0 &&\n                                      playerVisitSum === 0\n                                    }\n                                  >\n                                    Clear Current Visit\n                                  </button>\n                                </div>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Right column: Main Camera Feed (50% width) */}\n                        {cameraEnabled && (\n                          <div className=\"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black\">\n                            <CameraView\n                              scoringMode=\"custom\"\n                              showToolbar={cameraToolbarVisible}\n                              immediateAutoCommit\n                              onAutoDart={(value, ring) => {\n                                const ringLabel = ring ?? \"MISS\";\n                                const safeValue = Number.isFinite(value)\n                                  ? Math.max(0, value)\n                                  : 0;\n                                const now = Date.now();\n                                if (safeValue <= 0) {\n                                  if (ringLabel !== \"MISS\") return;\n                                  if (\n                                    now - (lastBounceMissTsRef.current || 0) <\n                                    1200\n                                  ) {\n                                    return;\n                                  }\n                                  lastBounceMissTsRef.current = now;\n                                } else {\n                                  lastBounceMissTsRef.current = 0;\n                                }\n                                applyDartValue(safeValue);\n                              }}\n                            />\n                          </div>\n                        )}\n                      </div>\n                      {/* Remove the separate camera view below scoreboard */}\n                      {(selectedMode as any) === \"X01\" && !cameraEnabled && (\n                        <>\n                          <GameScoreboard\n                            gameMode={selectedMode as any}\n                            players={statsX01}\n                            matchScore={`${playerLegs}-${aiLegs}`}\n                          />\n                        </>\n                      )}\n                      {(selectedMode as any) === \"Cricket\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Cricket\"\n                            players={statsCricket}\n                          />\n                        </>\n                      )}\n                      {/* Camera view for Cricket auto-scoring */}\n                      {(selectedMode as any) === \"Cricket\" && cameraEnabled && (\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\n                          <CameraView\n                            scoringMode=\"custom\"\n                            showToolbar={cameraToolbarVisible}\n                            immediateAutoCommit\n                            onAutoDart={(value, ring, info) => {\n                              if (value > 0) {\n                                const r = ring === \"MISS\" ? undefined : ring;\n                                addCricketAuto(\n                                  value,\n                                  r as any,\n                                  info?.sector ?? null,\n                                );\n                              }\n                            }}\n                          />\n                        </div>\n                      )}\n                      {(selectedMode as any) === \"Shanghai\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Shanghai\"\n                            players={statsShanghai}\n                          />\n                        </>\n                      )}\n                      {/* Camera view for Shanghai auto-scoring */}\n                      {(selectedMode as any) === \"Shanghai\" &&\n                        cameraEnabled && (\n                          <div className=\"rounded-2xl overflow-hidden bg-black\">\n                            <CameraView\n                              scoringMode=\"custom\"\n                              showToolbar={cameraToolbarVisible}\n                              immediateAutoCommit\n                              onAutoDart={(value, ring, info) => {\n                                if (value > 0) {\n                                  const r = ring === \"MISS\" ? undefined : ring;\n                                  addShanghaiAuto(\n                                    value,\n                                    r as any,\n                                    info?.sector ?? null,\n                                  );\n                                }\n                              }}\n                            />\n                          </div>\n                        )}\n                      {(selectedMode as any) === \"Killer\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Killer\"\n                            players={statsKiller}\n                          />\n                        </>\n                      )}\n                      {(selectedMode as any) === \"Scam\" && (\n                        <>\n                          <GameScoreboard gameMode=\"Scam\" players={statsScam} />\n                        </>\n                      )}\n                      {/* Camera view for Scam auto-scoring */}\n                      {(selectedMode as any) === \"Scam\" && cameraEnabled && (\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\n                          <CameraView\n                            scoringMode=\"custom\"\n                            showToolbar={cameraToolbarVisible}\n                            immediateAutoCommit\n                            onAutoDart={(value, ring, info) => {\n                              if (value > 0) {\n                                setScamPlayer(\n                                  addScamAuto(scamPlayer, value, ring as any),\n                                );\n                              }\n                            }}\n                          />\n                        </div>\n                      )}\n                      {(selectedMode as any) === \"Fives\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Fives\"\n                            players={statsFives}\n                          />\n                        </>\n                      )}\n                      {/* Camera view for Fives auto-scoring */}\n                      {(selectedMode as any) === \"Fives\" && cameraEnabled && (\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\n                          <CameraView\n                            scoringMode=\"custom\"\n                            showToolbar={cameraToolbarVisible}\n                            immediateAutoCommit\n                            onAutoDart={(value, ring, info) => {\n                              if (value > 0) {\n                                setFivesPlayer(\n                                  addFivesAuto(fivesPlayer, value, ring as any),\n                                );\n                              }\n                            }}\n                          />\n                        </div>\n                      )}\n                      {(selectedMode as any) === \"Sevens\" && (\n                        <>\n                          <GameScoreboard\n                            gameMode=\"Sevens\"\n                            players={statsSevens}\n                          />\n                        </>\n                      )}\n                      {/* Camera view for Sevens auto-scoring */}\n                      {(selectedMode as any) === \"Sevens\" && cameraEnabled && (\n                        <div className=\"rounded-2xl overflow-hidden bg-black\">\n                          <CameraView\n                            scoringMode=\"custom\"\n                            showToolbar={cameraToolbarVisible}\n                            immediateAutoCommit\n                            onAutoDart={(value, ring, info) => {\n                              if (value > 0) {\n                                setSevensPlayer(\n                                  addSevensAuto(\n                                    sevensPlayer,\n                                    value,\n                                    ring as any,\n                                  ),\n                                );\n                              }\n                            }}\n                          />\n                        </div>\n                      )}\n                      <div className=\"font-semibold\">Your Turn</div>\n                      <div className=\"flex flex-col gap-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            className=\"input w-24\"\n                            type=\"number\"\n                            min={0}\n                            max={60}\n                            value={playerDartPoints}\n                            onChange={(e) =>\n                              setPlayerDartPoints(Number(e.target.value || 0))\n                            }\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\")\n                                e.shiftKey ? replaceLast() : addDartNumeric();\n                            }}\n                          />\n                          <button\n                            className=\"btn px-3 py-1 text-sm\"\n                            onClick={addDartNumeric}\n                            title=\"Add a single dart (0â€“60)\"\n                          >\n                            Add Dart\n                          </button>\n                        </div>\n                        {/* Visit total entry */}\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            className=\"input w-28\"\n                            type=\"number\"\n                            min={0}\n                            max={playerScore <= 170 ? 170 : 180}\n                            placeholder=\"Visit total (0â€“180)\"\n                            value={visitTotalInput}\n                            onChange={(e) =>\n                              handleVisitTotalChange(e.target.value)\n                            }\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\") addVisitTotal();\n                            }}\n                          />\n                          <button\n                            className=\"btn px-3 py-1 text-sm\"\n                            onClick={addVisitTotal}\n                            title=\"Commit a full 3-dart total like 93\"\n                          >\n                            Commit Visit\n                          </button>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            className=\"input w-44\"\n                            placeholder=\"Manual (T20, D16, 5, 25, 50)\"\n                            value={manualBox}\n                            onChange={(e) => setManualBox(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\")\n                                e.shiftKey ? replaceLastManual() : addManual();\n                            }}\n                          />\n                          <button\n                            className=\"btn btn--ghost px-3 py-1 text-sm\"\n                            onClick={replaceLastManual}\n                            disabled={playerVisitDarts === 0}\n                          >\n                            Replace Last\n                          </button>\n                          <button\n                            className=\"btn px-3 py-1 text-sm\"\n                            onClick={addManual}\n                          >\n                            Add\n                          </button>\n                        </div>\n                        <div>\n                          <textarea\n                            className=\"input w-full h-24 resize-none\"\n                            placeholder=\"Type scores manually (one per line, e.g. T20&#10;D16&#10;5&#10;25&#10;50) - No camera needed!\"\n                            value={manualTextarea}\n                            onChange={(e) => setManualTextarea(e.target.value)}\n                          />\n                          <div className=\"flex gap-2 mt-1\">\n                            <button\n                              className=\"btn px-3 py-1 text-sm\"\n                              onClick={addManualTextarea}\n                            >\n                              Add All Scores\n                            </button>\n                            <button\n                              className=\"btn btn--ghost px-3 py-1 text-sm\"\n                              onClick={() => setManualTextarea(\"\")}\n                            >\n                              Clear\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-slate-300\">\n                        Tip: Enter to Add Â· Shift+Enter to Replace Last\n                      </div>\n                    </div>\n                  )}\n                  <div className=\"h-1\" />\n                </div>\n              </div>\n            </ResizableModal>\n          </div>\n        )}\n        {showRules && <X01RulesPopup onClose={() => setShowRules(false)} />}\n        {/* Frosted overlay when selecting premium mode without access */}\n        {lockedPremium && (\n          <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\n            <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\n            <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\n              <div className=\"text-3xl mb-2\">ðŸ”’</div>\n              <div className=\"font-semibold\">Premium mode locked</div>\n              <div className=\"text-sm text-slate-200/80\">\n                Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai,\n                and more.\n              </div>\n              <button\n                onClick={async () => {\n                  try {\n                    const res = await fetch(\n                      `${API_URL}/api/stripe/create-checkout-session`,\n                      {\n                        method: \"POST\",\n                        headers: { \"Content-Type\": \"application/json\" },\n                        body: JSON.stringify({ email: user?.email }),\n                      },\n                    );\n                    const data = await res.json();\n                    if (data.ok && data.url) {\n                      window.location.href = data.url;\n                      if (data.development) {\n                        toast(\n                          \"Opened Stripe test checkout (development mode)\",\n                          { type: \"info\", timeout: 3000 },\n                        );\n                      }\n                    } else if (data.error === \"STRIPE_NOT_CONFIGURED\") {\n                      toast(\n                        \"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\",\n                        { type: \"error\", timeout: 4000 },\n                      );\n                    } else {\n                      toast(\n                        \"Failed to create checkout session. Please try again.\",\n                        { type: \"error\", timeout: 4000 },\n                      );\n                    }\n                  } catch (err) {\n                    toast(\"Error creating checkout. Please try again.\", {\n                      type: \"error\",\n                      timeout: 4000,\n                    });\n                  }\n                }}\n                className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\n              >\n                Upgrade to PREMIUM Â·{\" \"}\n                {formatPriceInCurrency(getUserCurrency(), 5)}\n              </button>\n            </div>\n          </div>\n        )}\n        {showCameraManager && typeof document !== \"undefined\"\n          ? createPortal(\n              <div\n                className=\"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4\"\n                onClick={() => setShowCameraManager(false)}\n              >\n                <ResizableModal\n                  storageKey=\"ndn:modal:offline-camera-manager\"\n                  className=\"relative\"\n                  defaultWidth={640}\n                  defaultHeight={520}\n                  minWidth={480}\n                  minHeight={420}\n                  maxWidth={1200}\n                  maxHeight={900}\n                  initialFitHeight\n                  onClose={() => setShowCameraManager(false)}\n                >\n                  <div\n                    className=\"space-y-3\"\n                    onClick={(e) => e.stopPropagation()}\n                  >\n                    <div className=\"flex items-center justify-between gap-3\">\n                      <div>\n                        <div className=\"text-xs uppercase tracking-wide text-white/50\">\n                          Camera Devices\n                        </div>\n                        <div className=\"text-xl font-semibold text-white mt-1\">\n                          Manage Offline Camera Feeds\n                        </div>\n                      </div>\n                      <button\n                        className=\"btn bg-slate-800 hover:bg-slate-700 text-white\"\n                        onClick={() => setShowCameraManager(false)}\n                      >\n                        Close\n                      </button>\n                    </div>\n                    <CameraTile\n                      fill\n                      user={user}\n                      playerScore={playerScore}\n                      aiScore={aiScore}\n                      x01Score={x01Score}\n                      inMatch={inMatch}\n                      showWinPopup={showWinPopup}\n                      pendingLegWinner={pendingLegWinner}\n                      playerDartsThrown={playerDartsThrown}\n                      aiDartsThrown={aiDartsThrown}\n                      totalPlayerDarts={totalPlayerDarts}\n                      totalAiDarts={totalAiDarts}\n                      totalPlayerPoints={totalPlayerPoints}\n                      totalAiPoints={totalAiPoints}\n                      player180s={player180s}\n                      player140s={player140s}\n                      player100s={player100s}\n                      ai180s={ai180s}\n                      ai140s={ai140s}\n                      ai100s={ai100s}\n                      playerHighestCheckout={playerHighestCheckout}\n                      aiHighestCheckout={aiHighestCheckout}\n                      onClose={() => setShowCameraManager(false)}\n                      onOpen={() => setShowCameraManager(true)}\n                      layout={offlineLayout}\n                    />\n                  </div>\n                </ResizableModal>\n              </div>,\n              document.body,\n            )\n          : null}\n        {legOverrideConfirm && typeof document !== \"undefined\"\n          ? createPortal(\n              (() => {\n                const { target, value, stage } = legOverrideConfirm;\n                const targetName =\n                  target === \"player\" ? humanName : aiDisplayName;\n                const currentLegs = target === \"player\" ? playerLegs : aiLegs;\n                return (\n                  <div\n                    className=\"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4\"\n                    onClick={handleLegOverrideNo}\n                  >\n                    <ResizableModal\n                      storageKey=\"ndn:modal:offline-leg-override\"\n                      className=\"relative\"\n                      defaultWidth={360}\n                      defaultHeight={240}\n                      minWidth={280}\n                      minHeight={200}\n                      maxWidth={420}\n                      maxHeight={360}\n                      initialFitHeight\n                      onClose={handleLegOverrideNo}\n                    >\n                      <div\n                        className=\"space-y-3 max-w-[18rem] mx-auto\"\n                        onClick={(e) => e.stopPropagation()}\n                      >\n                        <div>\n                          <div className=\"text-xs uppercase tracking-wide text-white/50\">\n                            Step {stage} of 2\n                          </div>\n                          <div className=\"text-xl font-semibold text-white mt-1\">\n                            Override legs?\n                          </div>\n                        </div>\n                        <div className=\"text-sm text-slate-200 leading-relaxed\">\n                          {stage === 1 ? (\n                            <>\n                              Set {targetName}&apos;s legs to{\" \"}\n                              <span className=\"font-semibold text-white\">\n                                {value}\n                              </span>\n                              ? Confirm to continue.\n                            </>\n                          ) : (\n                            <>\n                              Final confirmation: set {targetName}&apos;s legs\n                              to{\" \"}\n                              <span className=\"font-semibold text-white\">\n                                {value}\n                              </span>\n                              . Select{\" \"}\n                              <span className=\"font-semibold text-emerald-200\">\n                                Yes\n                              </span>{\" \"}\n                              to apply immediately.\n                            </>\n                          )}\n                        </div>\n                        <div className=\"rounded-xl bg-black/40 border border-white/10 p-3 text-sm\">\n                          <div className=\"text-xs uppercase tracking-wide text-white/50 mb-1\">\n                            Current legs\n                          </div>\n                          <div className=\"text-base font-semibold text-white\">\n                            {currentLegs}\n                          </div>\n                        </div>\n                        <div className=\"flex items-center justify-end gap-2 pt-2\">\n                          <button\n                            className=\"btn bg-rose-600 hover:bg-rose-700 text-white\"\n                            onClick={handleLegOverrideNo}\n                          >\n                            No\n                          </button>\n                          <button\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\"\n                            onClick={handleLegOverrideYes}\n                          >\n                            Yes\n                          </button>\n                        </div>\n                      </div>\n                    </ResizableModal>\n                  </div>\n                );\n              })(),\n              document.body,\n            )\n          : null}\n        {showWinPopup && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\n            <ResizableModal\n              storageKey=\"ndn:modal:offline-win\"\n              className=\"w-full relative\"\n              defaultWidth={420}\n              defaultHeight={360}\n              minWidth={360}\n              minHeight={300}\n              maxWidth={800}\n              maxHeight={700}\n              initialFitHeight\n            >\n              <h3 className=\"text-lg font-bold mb-2\">Leg Won!</h3>\n              <label className=\"block mb-1\">Darts to hit double:</label>\n              <div className=\"flex gap-2 mb-2\">\n                {[1, 2, 3].map((n) => (\n                  <button\n                    key={n}\n                    className={`btn ${doubleDarts === n ? \"bg-brand-600\" : \"\"}`}\n                    onClick={() => setDoubleDarts(n)}\n                  >\n                    {n}\n                  </button>\n                ))}\n              </div>\n              <label className=\"block mb-1\">Darts for checkout:</label>\n              <div className=\"flex gap-2 mb-2\">\n                {[1, 2, 3].map((n) => (\n                  <button\n                    key={n}\n                    className={`btn ${checkoutDarts === n ? \"bg-brand-600\" : \"\"}`}\n                    onClick={() => setCheckoutDarts(n)}\n                  >\n                    {n}\n                  </button>\n                ))}\n              </div>\n              <div className=\"grid grid-cols-1 gap-2 mt-2\">\n                <button className=\"btn w-full\" onClick={handleWinPopupSubmit}>\n                  Submit\n                </button>\n                <button\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700 w-full\"\n                  onClick={() => {\n                    setShowWinPopup(false);\n                    startMatch();\n                  }}\n                >\n                  Rematch\n                </button>\n                <button\n                  className=\"btn bg-slate-700 hover:bg-slate-800 w-full\"\n                  onClick={() => {\n                    setShowWinPopup(false);\n                    setShowMatchModal(false);\n                    setInMatch(false);\n                  }}\n                >\n                  Back to Menu\n                </button>\n              </div>\n            </ResizableModal>\n          </div>\n        )}\n        {showMatchSummary && (\n          <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]\">\n            <ResizableModal\n              storageKey=\"ndn:modal:offline-summary\"\n              className=\"w-full relative\"\n              defaultWidth={820}\n              defaultHeight={520}\n              minWidth={600}\n              minHeight={400}\n              maxWidth={1400}\n              maxHeight={1000}\n              initialFitHeight\n            >\n              <h3 className=\"text-xl font-extrabold mb-2\">Match Summary</h3>\n              <div className=\"text-xs opacity-80 mb-3\">\n                {selectedMode} Â· {x01Score} start Â· First to {firstTo}\n              </div>\n              {(() => {\n                const player3da =\n                  totalPlayerDarts > 0\n                    ? (totalPlayerPoints / totalPlayerDarts) * 3\n                    : 0;\n                const player9da = player3da * 3;\n                const playerBest = (() => {\n                  const darts = legStats\n                    .filter(\n                      (l) =>\n                        l.winner === \"player\" &&\n                        typeof l.winnerDarts === \"number\",\n                    )\n                    .map((l) => l.winnerDarts);\n                  if (!darts.length) return \"â€”\";\n                  return `${Math.min(...darts)} darts`;\n                })();\n                const playerWorst = (() => {\n                  const darts = legStats\n                    .filter(\n                      (l) =>\n                        l.winner === \"player\" &&\n                        typeof l.winnerDarts === \"number\",\n                    )\n                    .map((l) => l.winnerDarts);\n                  if (!darts.length) return \"â€”\";\n                  return `${Math.max(...darts)} darts`;\n                })();\n                const playerPct =\n                  playerDoublesAtt > 0\n                    ? Math.round((playerDoublesHit / playerDoublesAtt) * 100)\n                    : 0;\n\n                const ai3da =\n                  totalAiDarts > 0 ? (totalAiPoints / totalAiDarts) * 3 : 0;\n                const ai9da = ai3da * 3;\n                const aiBest = (() => {\n                  const darts = legStats\n                    .filter(\n                      (l) =>\n                        l.winner === \"ai\" && typeof l.winnerDarts === \"number\",\n                    )\n                    .map((l) => l.winnerDarts);\n                  if (!darts.length) return \"â€”\";\n                  return `${Math.min(...darts)} darts`;\n                })();\n                const aiWorst = (() => {\n                  const darts = legStats\n                    .filter(\n                      (l) =>\n                        l.winner === \"ai\" && typeof l.winnerDarts === \"number\",\n                    )\n                    .map((l) => l.winnerDarts);\n                  if (!darts.length) return \"â€”\";\n                  return `${Math.max(...darts)} darts`;\n                })();\n                const aiPct =\n                  aiDoublesAtt > 0\n                    ? Math.round((aiDoublesHit / aiDoublesAtt) * 100)\n                    : 0;\n\n                return (\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n                    <div className=\"p-3 rounded-2xl glass border border-white/10\">\n                      <div className=\"text-sm font-semibold mb-1\">\n                        {user?.username || \"You\"}\n                      </div>\n                      <div className=\"text-3xl font-extrabold\">\n                        {playerLegs}\n                      </div>\n                      <div className=\"text-xs opacity-80\">Legs Won</div>\n                      <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\n                        <div>\n                          <span className=\"opacity-70\">Final 3DA</span>\n                          <div className=\"font-semibold\">\n                            {player3da.toFixed(1)}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Final 9DA</span>\n                          <div className=\"font-semibold\">\n                            {player9da.toFixed(1)}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Darts At Double</span>\n                          <div className=\"font-semibold\">\n                            {playerDoublesAtt}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Double %</span>\n                          <div className=\"font-semibold\">{playerPct}%</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Best Dart Leg</span>\n                          <div className=\"font-semibold\">{playerBest}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Worst Dart Leg</span>\n                          <div className=\"font-semibold\">{playerWorst}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">180's Hit</span>\n                          <div className=\"font-semibold\">{player180s}</div>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"hidden md:flex items-center justify-center\">\n                      <div className=\"text-4xl font-black\">\n                        {playerLegs} â€“ {aiLegs}\n                      </div>\n                    </div>\n                    <div className=\"p-3 rounded-2xl glass border border-white/10\">\n                      <div className=\"text-sm font-semibold mb-1\">\n                        {ai === \"None\" ? \"Opponent\" : `${ai} AI`}\n                      </div>\n                      <div className=\"text-3xl font-extrabold\">{aiLegs}</div>\n                      <div className=\"text-xs opacity-80\">Legs Won</div>\n                      <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\n                        <div>\n                          <span className=\"opacity-70\">Final 3DA</span>\n                          <div className=\"font-semibold\">\n                            {ai3da.toFixed(1)}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Final 9DA</span>\n                          <div className=\"font-semibold\">\n                            {ai9da.toFixed(1)}\n                          </div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Darts At Double</span>\n                          <div className=\"font-semibold\">{aiDoublesAtt}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Double %</span>\n                          <div className=\"font-semibold\">{aiPct}%</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Best Dart Leg</span>\n                          <div className=\"font-semibold\">{aiBest}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">Worst Dart Leg</span>\n                          <div className=\"font-semibold\">{aiWorst}</div>\n                        </div>\n                        <div>\n                          <span className=\"opacity-70\">180's Hit</span>\n                          <div className=\"font-semibold\">{ai180s}</div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })()}\n              <div className=\"mt-4\">\n                <div className=\"text-sm font-semibold mb-2\">Legs Timeline</div>\n                <div className=\"flex flex-wrap gap-2\">\n                  {legStats.map((leg, i) => (\n                    <div\n                      key={i}\n                      className={`px-3 py-1 rounded-full border text-xs ${leg.winner === \"player\" ? \"bg-emerald-500/15 border-emerald-400/30\" : \"bg-fuchsia-500/15 border-fuchsia-400/30\"}`}\n                    >\n                      Leg {i + 1}:{\" \"}\n                      {leg.winner === \"player\"\n                        ? \"You\"\n                        : ai === \"None\"\n                          ? \"Opp\"\n                          : \"AI\"}{\" \"}\n                      Â· Dbl {leg.doubleDarts} Â· CO {leg.checkoutDarts}\n                    </div>\n                  ))}\n                </div>\n              </div>\n              <div className=\"mt-4\">\n                <div className=\"text-sm font-semibold mb-2\">Shot Heat Map</div>\n                <div className=\"rounded-2xl overflow-hidden bg-black p-3\">\n                  {/* Lazy-load HeatMap component to avoid increasing initial bundle too much */}\n                  <HeatMap />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-2 mt-4\">\n                <button\n                  className=\"btn bg-slate-700 hover:bg-slate-800\"\n                  onClick={() => setShowMatchSummary(false)}\n                >\n                  Close\n                </button>\n                <button\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700\"\n                  onClick={() => {\n                    setShowMatchSummary(false);\n                    startMatch();\n                  }}\n                >\n                  Rematch\n                </button>\n              </div>\n            </ResizableModal>\n          </div>\n        )}\n        {legStats.length > 0 && (\n          <div className=\"mt-4\">\n            <h4 className=\"font-semibold mb-2\">Leg Stats</h4>\n            <ul>\n              {legStats.map((leg, i) => (\n                <li key={i}>\n                  Leg {i + 1}: Double darts: {leg.doubleDarts}, Checkout darts:{\" \"}\n                  {leg.checkoutDarts}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {/* Phone camera overlay removed per UX preference; use header badge preview only */}\n      </div>\n    </div>\n  );\n}\n"],"names":["doubles","dVal","tag","prefsDoubleScore","fav","suggestCheckouts","remaining","favoriteDouble","hardcoded","target","routes","t","s","sayScore","name","scored","voiceName","opts","synth","msg","isCheckout","isOneEighty","v","CameraTile","label","autoStart","scaleOverride","className","aspect","style","fill","videoRef","useRef","cameraSession","useCameraSession","streaming","setStreaming","useState","ws","setWs","pairCode","setPairCode","pc","setPc","lastRegisteredModeRef","registerStream","useCallback","stream","modeOverride","err","preferredCameraLabel","useUserSettings","mode","setMode","setExpiresAt","setPaired","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","cameraEnabledSetting","setPreferredCameraLocked","preferredCameraLocked","setPreferredCamera","preferredCameraId","fallbackClass","fallbackStyle","jsx","useEffect","h","apiFetch","r","ip","x","mobileUrl","useMemo","code","envUrl","u","host","useHttps","port","manualModeSetAt","setManualModeSetAt","cancelled","desiredLabel","timer","start","stop","apply","startWifiConnection","startPhonePairing","constraints","devices","discoverNetworkDevices","error","connectToWifiDevice","device","d","connectToNetworkDevice","startUsbConnection","discoverUSBDevices","newDevice","requestUSBDevice","prev","connectToUsbDevice","connectToUSBDevice","handleModeSelect","newMode","onStart","ev","modeFromEvent","ensureWS","normalizedEnv","proto","sameOrigin","isLocalhost","isRenderHost","renderWS","url","socket","data","peer","e","inbound","offer","regenerateCode","stopAll","CameraFrame","props","cameraScale","storedAspect","onModeSelect","modeDisplayName","reconnectOptions","copyFeedback","setCopyFeedback","copyTimeoutRef","globalFitMode","effectiveFitMode","scale","raw","clamped","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","usbActive","videoElement","baseVideoClass","copyValue","value","type","textarea","jsxs","Fragment","option","isActive","scoreFromImagePoint","H_boardToImage","pImg","pBoard","imageToBoard","scoreAtBoardPoint","DartDetector","cx","cy","radius","width","height","frame","alpha","w","bg","n","i","p","g","b","gray","y","dx","dy","recent","mask","diff","sum","sum2","cnt","isHighlight","maxc","minc","satApprox","isHi","mu","var_","sigma","dynamicThresh","visited","bestArea","bestIdxs","idxs","area","qh","q","cur","nbs","nb","minX","minY","maxX","maxY","meanX","meanY","idx","cxx","cyy","cxy","trace","det","tmp","l1","vx","vy","vlen","dxc","dyc","outward","rlen","rx","ry","cosAng","maxT","tipX","tipY","dxr","dyr","minR2","bboxW","bboxH","bboxArea","radial","confidence","l2","bw","bh","yy","xx","tip","close","a","out","on","j","parseExternalDart","ring","normalizeRing","finalizeFromValue","m","mult","sec","mul","inner","subscribeExternalWS","onDart","alive","lastSig","lastSigAt","DEDUP_WINDOW_MS","seenIds","seenSet","considerForward","payload","parsed","pid","old","sig","now","connect","ResizablePanel","storageKey","children","defaultWidth","defaultHeight","minWidth","minHeight","maxWidth","maxHeight","autoFill","size","setSize","startRef","containerRef","onReset","clamp","min","max","beginResize","dir","el","rect","onMove","endResize","handleKeyResize","k","delta","curW","curH","useHeatmapStore","create","set","get","state","useMatchControl","endsAt","AUTO_COMMIT_MIN_FRAMES","AUTO_COMMIT_HOLD_MS","AUTO_COMMIT_COOLDOWN_MS","AUTO_STREAM_IGNORE_MS","DETECTION_ARM_DELAY_MS","AUTO_COMMIT_CONFIDENCE","BOARD_CLEAR_GRACE_MS","CameraView","onVisitCommitted","showToolbar","onAutoDart","immediateAutoCommit","hideInlinePanels","scoringMode","onGenericDart","onGenericReplace","x01DoubleInOverride","onAddVisit","onEndLeg","autoscoreWsUrl","cameraAspect","cameraFitMode","autoCommitMode","cameraEnabled","setCameraEnabled","hideCameraOverlay","setHideCameraOverlay","manualOnly","availableCameras","setAvailableCameras","canvasRef","overlayRef","isPhoneCamera","sessionStream","sessionStreaming","phoneFeedActive","effectiveStreaming","cameraStarting","setCameraStarting","snapshotUrl","setSnapshotUrl","H","imageSize","resetCalibration","_hydrated","useCalibration","lastAutoScore","setLastAutoScore","manualScore","setManualScore","lastAutoValue","setLastAutoValue","lastAutoRing","setLastAutoRing","pendingDarts","setPendingDarts","pendingScore","setPendingScore","pendingEntries","setPendingEntries","pendingPreOpenDarts","setPendingPreOpenDarts","pendingDartsAtDouble","setPendingDartsAtDouble","awaitingClear","setAwaitingClear","pendingCommitRef","pendingCommitTimerRef","shouldDeferCommit","indicatorVersion","setIndicatorVersion","indicatorEntryVersions","setIndicatorEntryVersions","autoCandidateRef","detectionLogRef","lastAutoCommitRef","streamingStartMsRef","detectionArmedRef","detectionArmTimerRef","frameCountRef","detectionLog","setDetectionLog","showDetectionLog","setShowDetectionLog","clearPendingCommitTimer","captureDetectionLog","entry","next","finalizePendingCommit","_trigger","pending","enqueueVisitCommit","clearPendingManual","reason","setHadRecentAuto","handler","handleIndicatorReset","handleToolbarClear","requestDeviceManager","x01DoubleInSetting","x01DoubleIn","openedById","setOpenedById","matchState","useMatch","currentPlayerId","isOpened","setOpened","inProgress","setVisit","usePendingVisit","resetPendingVisit","addVisit","endLeg","callAddVisit","score","darts","meta","callEndLeg","addHeatSample","quickSelAuto","setQuickSelAuto","quickSelManual","setQuickSelManual","nonRegCount","setNonRegCount","showRecalModal","setShowRecalModal","hadRecentAuto","pulseManualPill","setPulseManualPill","pulseTimeoutRef","activeTab","setActiveTab","showManualModal","setShowManualModal","showAutoModal","setShowAutoModal","showScoringModal","setShowScoringModal","manualPreviewRef","dartTimerEnabled","dartTimerSeconds","dartTimeLeft","setDartTimeLeft","timerRef","paused","detectorRef","rafRef","detectorSeedVersion","setDetectorSeedVersion","handlePhoneReconnect","onOpen","onDartsCleared","mounted","refresh","list","onClose","leg","shouldRun","addDart","id","c","vw","vh","cw","ch","ctx","dw","dh","stopCamera","canFallbackToLocal","startCamera","dlog","playErr","retryErr","enumErr","videoEl","fallbackStream","activeStream","capture","primary","sessionVideo","source","video","canvas","CameraSelector","resolve","sourceVideo","canceled","proc","tick","cImg","applyHomography","rImg","BoardRadii","sx","sy","roiR","detector","nowPerf","warmupActive","tipRefined","refinePointSobel","pCal","sector","shouldAccept","applyAutoHit","candidate","existing","current","holdMs","ready","cooled","o","octx","ox","oy","ax","ax1","ay1","ax2","ay2","bx","by","handleUseLocalCamera","fallback","useAudit","sub","onOverlayClick","parseManual","input","bull","outerBull","num","multVal","getCurrentRemaining","newDarts","previousScore","previousDarts","addSample","willCount","applied","appliedValue","newScore","after","isFinish","preOpenTotal","postAfter","postBefore","attemptsThisDart","attemptsTotal","onAddAutoDart","onApplyManual","onReplaceManual","last","prevDarts","prevScore","onRecalibrateNow","onResetCalibration","onKey","onQuickEntry","val","onUndoDart","onCommitVisit","visitScore","visitDarts","fit","videoClass","renderVideoSurface","entrySeq","isPending","hasPositiveValue","hasHitRing","color","activeState","stateClass","title","baseClasses","okNow","pulseClass","ResizableModal","_","FocusLock","ms","isHit","polarToCartesian","angleDeg","sectorAngle","HeatMap","samples","ref","radii","ringOrder","points","angle","grd","sectorCounts","secStr","pos","DOUBLE_PRACTICE_ORDER","isDoubleHit","targetIdx","parseManualDart","ATC_ORDER","CRICKET_NUMBERS","createCricketState","marks","applyCricketDart","opponentClosed","hits","cand","before","remainToClose","toApply","overflow","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","endShanghaiTurn","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","endHalveItTurn","createHighLow","applyHighLowDart","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","res","applyKillerDart","selfId","states","me","victimId","victim","killerWinner","st","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","TTT_TARGETS","createTicTacToe","checkWin","board","lines","tryClaimCell","cell","tgt","ok","createScamState","SCAM_TARGETS","SCAM_TARGET_NAMES","getScamTarget","addScamAuto","newIndex","finished","addScamNumeric","resetScam","createFivesState","FIVES_VALID_NUMBERS","isFivesValid","addFivesAuto","addFivesNumeric","resetFives","createSevensState","SEVENS_VALID_NUMBERS","isSevensValid","addSevensAuto","addSevensNumeric","resetSevens","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","GameHeaderBar","left","right","sticky","GameScoreboard","gameMode","players","matchScore","gameRules","player","ScoreRow","AvgDifferenceRow","formatCricketClosed","getCricketStatus","mono","bold","highlight","matchAvg","allTimeAvg","isPositive","isNeutral","diffText","diffColor","closed","count","closedCount","makeOfflineAddVisitAdapter","commitManualVisitTotal","createOfflineMatchActions","args","match","endTurn","useOfflineGameStats","playerScore","aiScore","playerLegs","aiLegs","playerLastDart","aiLastDart","playerVisitSum","aiVisitSum","playerLastVisitScore","aiLastVisitScore","playerVisitDartCount","aiVisitDartCount","playerDoublesHit","playerDoublesAtt","aiDoublesHit","aiDoublesAtt","legStats","isPlayerTurn","ai","x01Score","cricket","shanghai","killerPlayers","killerStates","killerAssigned","killerTurnIdx","playerMatchAvg","playerDarts","playerScored","resolvedPlayerLastScore","l","getAllTimeAvg","resolvedAiLastScore","aiLevels","aiVisitScore","level","candidates","X01RulesPopup","API_URL","OfflinePlay","user","offlineLayout","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","rememberLastOffline","setLastOffline","autoStartOffline","setCameraScale","setCameraAspect","setCameraFitMode","textSize","boxSize","matchType","setMatchType","teamAName","setTeamAName","teamBName","setTeamBName","manualScoring","cameraToolbarVisible","waitForBoardClear","selectedMode","setSelectedMode","setX01Score","setAI","showRules","setShowRules","inMatch","setInMatch","setPlayerScore","setAiScore","onDouble","setOnDouble","showWinPopup","setShowWinPopup","firstTo","setFirstTo","setPlayerLegs","showStartShowcase","setShowStartShowcase","startedShowcasedRef","setAiLegs","pendingLegWinner","setPendingLegWinner","doubleDarts","setDoubleDarts","checkoutDarts","setCheckoutDarts","setLegStats","aiDelayMs","setAiDelayMs","toast","useToast","showMatchModal","setShowMatchModal","maximized","setMaximized","fitAll","setFitAll","fitScale","setFitScale","fitOverflowing","setFitOverflowing","setIsPlayerTurn","handleOpenManager","setShowCameraManager","playerDartPoints","setPlayerDartPoints","dpIndex","setDpIndex","dpHits","setDpHits","atcIndex","setAtcIndex","atcHits","setAtcHits","setCricket","setShanghai","halve","setHalve","highlow","setHighlow","practiceTurnDarts","setPracticeTurnDarts","b27Stage","setB27Stage","b27Score","setB27Score","b27Darts","setB27Darts","b27Hits","setB27Hits","b27Finished","setB27Finished","cuRound","setCuRound","cuScore","setCuScore","cuDarts","setCuDarts","cuMaxRounds","hsRound","setHsRound","hsScore","setHsScore","hsDarts","setHsDarts","hsMaxRounds","lsRound","setLsRound","lsScore","setLsScore","lsDarts","setLsDarts","lsMaxRounds","co170Rem","setCo170Rem","co170Darts","setCo170Darts","co170Attempts","setCo170Attempts","co170Successes","setCo170Successes","co121Rem","setCo121Rem","co121Darts","setCo121Darts","co121Attempts","setCo121Attempts","co121Successes","setCo121Successes","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","trebleMaxDarts","setTrebleMaxDarts","trebleFinished","setTrebleFinished","baseball","setBaseball","golf","setGolf","ttt","setTTT","amCricket","setAmCricket","setKillerPlayers","setKillerStates","setKillerAssigned","killerSetupDone","setKillerSetupDone","setKillerTurnIdx","killerDarts","setKillerDarts","killerWinnerId","setKillerWinnerId","killerLastEvent","setKillerLastEvent","scam","setScam","scamPlayer","setScamPlayer","fives","setFives","fivesPlayer","setFivesPlayer","sevens","setSevens","sevensPlayer","setSevensPlayer","playerDartsThrown","setPlayerDartsThrown","setPlayerLastDart","playerVisitDarts","setPlayerVisitDarts","playerVisitStart","setPlayerVisitStart","setPlayerVisitSum","setPlayerLastVisitScore","playerVisitDartsAtDouble","setPlayerVisitDartsAtDouble","lastBounceMissTsRef","lastVisitDartsRef","playerScoreRef","playerVisitDartsRef","playerVisitSumRef","playerVisitStartRef","playerVisitDartsAtDoubleRef","aiCountdownMs","setAiCountdownMs","aiDartsThrown","setAiDartsThrown","setAiLastDart","setAiVisitSum","aiVisitDarts","setAiVisitDarts","setAiLastVisitScore","aiVisitDartsAtDouble","setAiVisitDartsAtDouble","setPlayerDoublesAtt","setPlayerDoublesHit","setAiDoublesAtt","setAiDoublesHit","totalPlayerDarts","setTotalPlayerDarts","totalAiDarts","setTotalAiDarts","totalPlayerPoints","setTotalPlayerPoints","totalAiPoints","setTotalAiPoints","player180s","setPlayer180s","player140s","setPlayer140s","player100s","setPlayer100s","ai180s","setAi180s","ai140s","setAi140s","ai100s","setAi100s","playerHighestCheckout","setPlayerHighestCheckout","aiHighestCheckout","setAiHighestCheckout","showMatchSummary","setShowMatchSummary","manualBox","setManualBox","manualTextarea","setManualTextarea","manualPlayerScoreInput","setManualPlayerScoreInput","manualOpponentScoreInput","setManualOpponentScoreInput","manualPlayerLegsInput","setManualPlayerLegsInput","manualOpponentLegsInput","setManualOpponentLegsInput","legOverrideConfirm","setLegOverrideConfirm","showCameraManager","dartCounts","setDartCounts","awaitingBoardClear","setAwaitingBoardClear","pendingVisitRef","pendingVisitTimerRef","clearPendingVisitTimer","speakAutoVisit","speaker","commitPendingVisit","visitTotal","preRemaining","doubleAttempts","doubleWindow","highestCheckout","finalizePendingVisit","trigger","queuePendingVisit","humanName","aiDisplayName","statsX01","statsCricket","statsShanghai","statsKiller","statsScam","statsFives","statsSevens","activeScoreboardStats","playerResolvedLastScore","aiResolvedLastScore","singlePlayerScoreboard","rest","inactivePlayerName","activePlayerName","activeRemaining","activeLastScore","recordDart","resetDartCount","parseManualScoreOverride","parseManualLegsOverride","cancelPendingAutoVisit","nextScore","safeScore","nextVisitStart","handleManualScoreOverride","applyManualLegOverride","handleManualLegsOverride","handleLegOverrideYes","handleLegOverrideNo","handleKey","event","buttonSizeClass","scrollerRef","contentRef","headerBarRef","formatType","setFormatType","formatCount","setFormatCount","formatRef","wins","measure","scroller","content","headerH","availH","availW","currentScale","naturalHeight","naturalWidth","scaleH","scaleW","scaledHeight","overflowing","RO","ro","onAuto","startMatch","onFmt","raf","dt","targetVisit","dart","preRem","postRem","checkout","startNextLeg","nextRemaining","applyDartValue","currentScore","currentVisitDarts","currentVisitSum","currentVisitStart","currentVisitDartsAtDouble","newVisitDarts","postRemaining","attemptsThisVisit","newVisitSum","startedDoubleWindow","stillInDoubleWindow","doubleAttemptsNow","inDoubleWindow","attemptsForVisit","addDartNumeric","rawTotal","visitStart","liveScore","existingDarts","existingSum","hadPartialVisit","checkoutCap","total","matchActions","visitTotalInput","setVisitTotalInput","handleVisitTotalChange","numericOnly","maxAllowed","safe","addVisitTotal","bounded","clearCurrentVisit","onClearRequest","evt","detail","addDpValue","nextHits","addDpNumeric","addDpManual","addB27Auto","hit","nd","totalHits","addB27Numeric","resetB27","addCountUpAuto","addHighScoreAuto","addLowScoreAuto","applyCheckout","rem","setRem","setDarts","setAttempts","setSuccesses","addCo170Auto","addCo121Auto","addCoManual","is170","isDouble","resetCo170","resetCo121","addTrebleAuto","cycle","resetTreble","addBaseballAuto","cp","resetBaseball","addGolfAuto","resetGolf","addTttAuto","resetTtt","addAmCricketAuto","resetAmCricket","addAtcValue","newHits","addAtcNumeric","addAtcManual","addCricketAuto","copy","addCricketNumeric","addShanghaiAuto","addShanghaiNumeric","addHalveAuto","addHalveNumeric","addHighLowAuto","addHighLowNumeric","parseManualBox","addManual","addManualTextarea","line","replaceLast","replaceLastManual","rewind","handleWinPopupSubmit","winner","legDoublesAtt","legDoublesHit","winnerDarts","bumpGameMode","lockedPremium","freeGames","MatchStartShowcase","premiumGames","GameCalibrationStatus","disabled","pillCls","cricketClosedAll","info","MatchControls","first","currentThrower","currentRemaining","lastScoreDisplay","dartsThrown","avg3","bestLegText","nh","ni","promptVal","tcell","win","it","ids","initStates","ringLabel","safeValue","formatPriceInCurrency","getUserCurrency","createPortal","stage","targetName","currentLegs","player3da","player9da","playerBest","playerWorst","playerPct","ai3da","ai9da","aiBest","aiWorst","aiPct"],"mappings":"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EAAG,CAC1B,GAAI,CACF,OAAO,cACL,IAAI,YAAY,oBAAqB,CACnC,OAAQ,CAAE,OAAQ,eAAgB,GAAI,KAAK,KAAI,CAAE,CAClD,CAAA,CAEL,MAAQ,CAAC,CACTQ,GAAoB,QAAU,CAChC,CACAC,GAAkB,QAAUT,EAC9B,EAAG,CAACA,EAAgB,CAAC,EAErB,MAAMyF,GAAY3Q,GAAM,UAAY,WAC9B4Q,GAAgBlS,IAAO,OAAS,WAAaA,EAG7CmS,GAAWtT,GACf,MACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAiN,GACAqB,GACAnO,GACAC,GACAC,GACAC,GACAC,EACAC,GACAC,CAEF,EACMoS,GAAevT,GACnB,UACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAqB,EAAA,EAEImS,GAAgBxT,GACpB,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAkB,GACAC,EACA,OACAE,GACAC,EAAA,EAEImS,GAAczT,GAClB,SACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACAuB,EACAC,GACAC,GACAC,EAAA,EAEIgS,GAAY1T,GAAoB,MAAa,EAC7C2T,GAAa3T,GAAoB,OAAc,EAC/C4T,GAAc5T,GAAoB,QAAe,EAEjD6T,GAAwBh9B,EAAAA,QAAQ,IAAM,CAC1C,MAAM+Y,EAAO0jB,IAAY,CAAA,EACnBQ,EACJnG,GAAmB,EACfpN,GACCE,IAAwBJ,GACzB0T,EACJ/E,GAAe,EAAIxO,GAAcE,IAAoBJ,GACvD,OAAI1Q,EAAK,SAAW,EACX,CACL,KAAMsR,GAAekS,GAAYC,GACjC,cAAe,GACf,QAASnS,GAAef,GAAaC,GACrC,MAAOc,GAAejB,GAAcC,GACpC,UAAWgB,GAAe4S,EAA0BC,CAAA,EAGjDnkB,EAAK,KAAM6O,GAAWA,EAAO,aAAa,GAAK7O,EAAK,CAAC,CAC9D,EAAG,CACD0jB,GACApS,GACAkS,GACAC,GACAlT,GACAC,GACAH,GACAC,GACAyN,GACApN,GACAE,GACAJ,GACAG,GACAE,GACAJ,GACA0O,EAAA,CACD,EAEKgF,GAAwCn9B,EAAAA,QAAQ,IAAM,CAC1D,GAAI,CAACg9B,GAAuB,MAAO,CAAA,EACnC,KAAM,CAAE,SAAA5U,EAAU,WAAAC,EAAY,GAAG+U,GAASJ,GAC1C,MAAO,CACL,CAAE,GAAGI,EAAM,SAAU,OAAW,WAAY,MAAA,CAAU,CAE1D,EAAG,CAACJ,EAAqB,CAAC,EAEpBK,GAAqBhT,GAAemS,GAAgBD,GACpDe,GACJN,IAAuB,OAAS3S,GAAekS,GAAYC,IACvDe,GAAkBlT,GAAejB,GAAcC,GAC/CmU,GAAkBnT,GACpByM,GAAmB,EACjBpN,GACCE,IAAwBJ,GAC3B2O,GAAe,EACbxO,GACCE,IAAoBJ,GAErBgU,GAAajgC,EAAAA,YAAY,CAACM,EAAc6qB,EAAQ,IAAM,CACtD,CAAC7qB,GAAQ6qB,GAAS,GACtB2S,GAAez5B,IAAU,CACvB,GAAGA,EACH,CAAC/D,CAAI,GAAI+D,EAAK/D,CAAI,GAAK,GAAK6qB,CAAA,EAC5B,CACJ,EAAG,CAAA,CAAE,EAEC+U,GAAiBlgC,cAAaM,GAAiB,CAC9CA,GACLw9B,GAAez5B,GACTA,EAAK/D,CAAI,IAAM,OAAkB+D,EAC9B,CAAE,GAAGA,EAAM,CAAC/D,CAAI,EAAG,CAAA,CAC3B,CACH,EAAG,CAAA,CAAE,EAEmBu9B,GAAWlO,CAAY,EAE/C,MAAMwQ,GAA4B54B,GAAiC,CACjE,GAAI,CAACA,EAAM,KAAA,EAAQ,OAAO,KAC1B,MAAM0H,EAAS,OAAO1H,CAAK,EAC3B,OAAK,OAAO,SAAS0H,CAAM,EACpBqB,GAAM,KAAK,MAAMrB,CAAM,EAAG,EAAG8d,CAAQ,EADP,IAEvC,EAEMqT,GAA2B74B,GAAiC,CAChE,GAAI,CAACA,EAAM,KAAA,EAAQ,OAAO,KAC1B,MAAM0H,EAAS,OAAO1H,CAAK,EAC3B,OAAK,OAAO,SAAS0H,CAAM,EACpB,KAAK,IAAI,EAAG,KAAK,MAAMA,CAAM,CAAC,EADA,IAEvC,EAEMoxB,GAAyBrgC,EAAAA,YAAY,IAAM,CAC3Ci+B,GAAgB,UAClBA,GAAgB,QAAU,MAE5BE,GAAA,EACAH,GAAsB,EAAK,CAC7B,EAAG,CAACG,EAAsB,CAAC,EAEMn+B,EAAAA,YAC9BsgC,GAAsB,CACrB,MAAMC,EAAYjwB,GAAMgwB,EAAW,EAAGvT,CAAQ,EAC9CsT,GAAA,EACAlQ,GAAeoQ,CAAS,EACxBvG,GAAe,QAAUuG,EAEzB,MAAMC,EAAiBD,IAAc,EAAIxT,EAAWwT,EACpD9G,GAAoB+G,CAAc,EAClCrG,GAAoB,QAAUqG,EAE9B9G,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BX,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BJ,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EAEtCT,GAAwB,IAAI,EAC5BN,GAAkB,CAAC,EACnB5G,EAAoB,CAAC,EACrBqH,GAAoB,QAAU,EAE1ByG,IAAc,GAChBtP,EAAoB,QAAQ,EAC5BT,GAAgB,EAAI,IAEpBS,EAAoB,IAAI,EACxBT,GAAgB,EAAK,EAEzB,EACA,CACE6P,GACAlQ,GACApD,EACA0M,GACAC,GACAH,GACAM,GACAF,GACAN,GACA5G,EACAxB,EACAT,EAAA,CACF,EAGF,MAAMiQ,GAA6B9iC,GAA4B,CAG7D,MAAMsR,EAASkxB,GADkC/C,EACH,EAC9C,GAAInuB,IAAW,KAAM,CACnBwiB,GAAM,gCAAgC1E,CAAQ,GAAI,CAChD,KAAM,QACN,QAAS,IAAA,CACV,EACD,MACF,CAMEqD,GAAWnhB,CAAM,EACjByrB,GAAc,CAAC,EACfE,GAAgB,CAAC,EACjBC,GAAoB,IAAI,EACxBE,GAAwB,CAAC,EACzBN,GAAc,CAAC,EACf4C,GAA4B,EAAE,EAEhCpM,EAAoB,IAAI,EACxBT,GAAgB,EAAK,CACvB,EAEMkQ,GAAyB1gC,EAAAA,YAC7B,CAACrC,EAAyB4J,IAAkB,CACtC5J,IAAW,UACbgzB,EAAcppB,CAAK,EACnBg2B,GAAyB,EAAE,IAE3BxM,GAAUxpB,CAAK,EACfk2B,GAA2B,EAAE,GAE/BxM,EAAoB,IAAI,EACxBT,GAAgB,EAAK,CACvB,EACA,CACEO,GACA0M,GACAF,GACAtM,EACAN,EACAH,EAAA,CACF,EAGImQ,GAA4BhjC,GAA4B,CAG5D,MAAMsR,EAASmxB,GADbziC,IAAW,SAAW2/B,GAAwBE,EACH,EAC7C,GAAIvuB,IAAW,KAAM,CACnBwiB,GAAM,6CAA8C,CAClD,KAAM,QACN,QAAS,IAAA,CACV,EACD,MACF,CACAkM,GAAsB,CAAE,OAAAhgC,EAAQ,MAAOsR,EAAQ,MAAO,EAAG,CAC3D,EAEM2xB,GAAuB5gC,EAAAA,YAAY,IAAM,CAC7C29B,GAAuBt5B,GAChBA,IACDA,EAAK,QAAU,EAAU,CAAE,GAAGA,EAAM,MAAO,CAAA,GAC/Cq8B,GAAuBr8B,EAAK,OAAQA,EAAK,KAAK,EACvC,MACR,CACH,EAAG,CAACq8B,EAAsB,CAAC,EAErBG,GAAsB7gC,EAAAA,YAAY,IAAM,CAC5C29B,GAAsB,IAAI,CAC5B,EAAG,CAAA,CAAE,EAEL17B,EAAAA,UAAU,IAAM,CACd,GAAI,CAACy7B,GAAoB,OACzB,MAAMoD,EAAaC,GAAyB,CACtCA,EAAM,MAAQ,WAChBA,EAAM,eAAA,EACNF,GAAA,EAEJ,EACA,cAAO,iBAAiB,UAAWC,CAAS,EACrC,IAAM,OAAO,oBAAoB,UAAWA,CAAS,CAC9D,EAAG,CAACD,GAAqBnD,EAAkB,CAAC,EAa5C,MAAMsD,IAVwB/wB,GAAiB,CAC7C,OAAQA,EAAA,CACN,IAAK,QACH,MAAO,wBACT,IAAK,QACH,MAAO,oBACT,QACE,MAAO,qBAAA,CAEb,GAC6C+e,EAAQ,EAE/CiS,GAAc/hC,EAAAA,OAA8B,IAAI,EAChDgiC,GAAahiC,EAAAA,OAA8B,IAAI,EAC/CiiC,GAAejiC,EAAAA,OAA8B,IAAI,EAEjD,CAACkiC,GAAYC,EAAa,EAAI9hC,EAAAA,SAA2B,OAAO,EAChE,CAAC+hC,GAAaC,EAAc,EAAIhiC,EAAAA,SAAiB,CAAC,EAClDiiC,GAAYtiC,EAAAA,OAA8B,IAAI,EAEpD+C,EAAAA,UAAU,IAAM,CACd,MAAM6G,EAAI,KAAK,IAAI,EAAG,KAAK,MAAM,OAAOw4B,EAAW,GAAK,CAAC,CAAC,EACpDG,EAAOL,KAAe,QAAUt4B,EAAI,KAAK,IAAI,EAAG,KAAK,KAAKA,EAAI,CAAC,CAAC,EACtE4nB,GAAW+Q,CAAI,CACjB,EAAG,CAACL,GAAYE,EAAW,CAAC,EAC5Br/B,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC8vB,GAAQ,CACXG,GAAY,CAAC,EACbE,GAAkB,EAAK,EACvB,MACF,CACA,MAAMsP,EAAU,IAAM,CACpB,MAAMC,EAAWV,GAAY,QACvBW,EAAUV,GAAW,QAC3B,GAAI,CAACS,GAAY,CAACC,EAAS,OAE3B,MAAMC,EAAUV,GAAa,QACzBA,GAAa,QAAQ,sBAAA,EAAwB,OAC7C,EACEW,EAAS,KAAK,IAAI,EAAGH,EAAS,aAAeE,EAAU,CAAC,EACxDE,EAAS,KAAK,IAAI,EAAGJ,EAAS,YAAc,CAAC,EAE7C/wB,EAAOgxB,EAAQ,sBAAA,EACfI,EAAe/P,IAAY,EAC3BgQ,EAAgBrxB,EAAK,OAASoxB,EAC9BE,EAAetxB,EAAK,MAAQoxB,EAE5BG,GAASL,EAAS,EAAIA,EAASG,EAAgB,EAC/CG,GAASL,EAAS,EAAIA,EAASG,EAAe,EAC9ChrB,GAAO,KAAK,IAAI,EAAG,KAAK,IAAI,GAAK,KAAK,IAAIirB,GAAQC,EAAM,CAAC,CAAC,EAC1DC,GAAeJ,EAAgB/qB,GAC/BorB,GAAcR,EAAS,GAAKO,GAAeP,EAAS,EAC1D1P,GAAkBkQ,EAAW,EAC7BpQ,GAAYhb,EAAI,CAClB,EACAwqB,EAAA,EACA,MAAMa,EAAW,OAAe,eAC1BC,EAAKD,EAAK,IAAIA,EAAG,IAAMb,EAAA,CAAS,EAAI,KAC1C,OAAAc,GAAMvB,GAAY,SAAWuB,EAAG,QAAQvB,GAAY,OAAc,EAClEuB,GAAMtB,GAAW,SAAWsB,EAAG,QAAQtB,GAAW,OAAc,EAChE,OAAO,iBAAiB,SAAUQ,CAAO,EAClC,IAAM,CACX,OAAO,oBAAoB,SAAUA,CAAO,EAC5C,GAAI,CACFc,GAAMvB,GAAY,SAAWuB,EAAG,UAAUvB,GAAY,OAAc,CACtE,MAAQ,CAAC,CACT,GAAI,CACFuB,GAAMtB,GAAW,SAAWsB,EAAG,UAAUtB,GAAW,OAAc,CACpE,MAAQ,CAAC,CACX,CACF,EAAG,CAACnP,GAAQE,EAAQ,CAAC,EAGrBhwB,EAAAA,UAAU,IAAM,CACd,MAAMwgC,EAAUj9B,GAAW,CACzB,MAAM0I,EAAI1I,GAAG,QAAQ,KAChB0I,IACL0hB,GAAgB1hB,CAAC,EAEjBw0B,GAAA,EACF,EACA,cAAO,iBAAiB,iBAAkBD,CAAa,EAChD,IAAM,OAAO,oBAAoB,iBAAkBA,CAAa,CACzE,EAAG,CAAA,CAAE,EAGLxgC,EAAAA,UAAU,IAAM,CACd,MAAM0gC,EAASn9B,GAAW,CACxB,MAAM3H,EAAI2H,GAAG,QAAQ,WACfqW,EAAIrW,GAAG,QAAQ,YACf1H,EAAI0H,GAAG,QAAQ,YACjB3H,IAAM,SAAWA,IAAM,YAAsBA,CAAC,EAC9C,OAAOge,GAAM,UAAY,SAASA,CAAC,GACrC0lB,GAAe,KAAK,IAAI,EAAG,KAAK,MAAM1lB,CAAC,CAAC,CAAC,EACvC,OAAO/d,GAAM,UAAY,SAASA,CAAC,GACrC+xB,GAAY,KAAK,IAAI,EAAG,KAAK,MAAM/xB,CAAC,CAAC,CAAC,CAC1C,EACA,cAAO,iBAAiB,qBAAsB6kC,CAAY,EACnD,IAAM,OAAO,oBAAoB,qBAAsBA,CAAY,CAC5E,EAAG,CAAA,CAAE,EAGL1gC,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC2sB,EAAkB,OAEvB,MAAMhT,EAAK,WAAW,IAAM8mB,GAAA,EAAc,EAAE,EAC5C,MAAO,IAAM,aAAa9mB,CAAE,CAC9B,EAAG,CAACgT,CAAgB,CAAC,EAGrB3sB,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC0vB,IAAkB9E,IAAgBC,IAAO,QAAUuN,IAAiB,EACvE,OACF,IAAIuI,EACAlhB,EAAO,YAAY,IAAA,EACvB,MAAMhE,EAAQrO,GAAgB,CAC5B,MAAMwzB,EAAKxzB,EAAMqS,EACjBA,EAAOrS,EACPirB,GAAkBj2B,GAAS,CACzB,MAAM6S,EAAO7S,EAAOw+B,EACpB,GAAI3rB,GAAQ,EAAG,CAEb,IAAImL,EAAa,EACbkc,EAAa,EACb/gC,EAAYquB,GAEhB,IADA+O,GAAgB,CAAC,EACVvY,EAAa,GAAK7kB,EAAY,GAAG,CACtC,MAAMslC,EAAchV,GAAatwB,EAAWsvB,CAAE,EAExCiW,EAAOzyB,GACXwyB,EAAczgB,EAAa,GAC3B,EACA,KAAK,IAAI,GAAI7kB,CAAS,CAAA,EAElBwjB,GAAQxjB,EAAYulC,EAI1B,GAHAtI,GAAcsI,CAAI,EAClBvI,GAAkBz2B,IAAMA,GAAI,CAAC,EAC7Bw3B,GAAiBx3B,IAAMA,GAAI,CAAC,EACxBid,GAAQ,EAAG,CAEbxjB,EAAYquB,GACZ6O,GAAc,CAAC,EACfK,GAAwB,CAAC,EACzBwD,EAAa,EACb1D,GAAoB,CAAC,EACrBD,GAAgB,CAAC,EACjB,KACF,CAEA2D,GAAcwE,EACdrI,GAAe58B,IAAMA,GAAIilC,CAAI,EAC7BpH,GAAkB3yB,IAAMA,GAAI+5B,CAAI,EAEhC,MAAMC,GAASxlC,EACTylC,GAAUjiB,GAMhB,GALIgiB,GAAS,IAAMC,IAAW,MAA4B,CAAC,EAClDD,IAAU,IAAIjI,GAAyBlf,IAAMA,GAAI,CAAC,EAC3Dre,EAAYwjB,GACZqB,GAAc,EACduY,GAAgBvY,CAAU,EACtB7kB,IAAc,EAAG,KACvB,CAEA,GADA4yB,GAAW5yB,CAAS,EAChBA,IAAc,EAAG,CAEf+gC,IAAe,IAAKpC,GAAWrzB,GAAMA,EAAI,CAAC,EACrCy1B,GAAc,IAAKlC,GAAWvzB,GAAMA,EAAI,CAAC,EACzCy1B,GAAc,KAAKhC,GAAWzzB,GAAMA,EAAI,CAAC,EAElD,MAAMo6B,EAAWrX,GACbqX,GAAY,KACdvG,GAAsBz6B,GAAM,KAAK,IAAIA,EAAGghC,CAAQ,CAAC,EAE/CrX,IAAW,KACbqP,GACGxtB,GACCA,GAAKotB,GAAuB,EAAIA,GAAuB,EAAA,EAE3DK,GAAiBj5B,GAAMA,EAAI,CAAC,GAE9B24B,GAAoB0D,CAAU,EAC9B7D,GAAc,CAAC,EACfK,GAAwB,CAAC,EACzBH,GAAgB,CAAC,EAEjB3J,EAAoB,IAAI,EACxBT,GAAgB,EAAI,CACtB,CAEA,OAAIhzB,EAAY,GAAK6kB,GAAc,IAC7Bkc,IAAe,IAAKpC,GAAWrzB,GAAMA,EAAI,CAAC,EACrCy1B,GAAc,IAAKlC,GAAWvzB,GAAMA,EAAI,CAAC,EACzCy1B,GAAc,KAAKhC,GAAWzzB,GAAMA,EAAI,CAAC,EAClD+xB,GAAoB0D,CAAU,EAC9B7D,GAAc,CAAC,EACfK,GAAwB,CAAC,EACzBH,GAAgB,CAAC,GAGnBA,GAAgB,CAAC,EACjBvI,GAAgB,EAAI,EACb,CACT,CACA,OAAOnb,CACT,CAAC,EACD0rB,EAAM,sBAAsBllB,CAAI,CAClC,EACA,OAAAklB,EAAM,sBAAsBllB,CAAI,EACzB,IAAM,qBAAqBklB,CAAG,CACvC,EAAG,CAACjR,GAAgB9E,GAAcC,EAAIjB,EAAO,CAAC,EAE9C5pB,EAAAA,UAAU,IAAM,CACTwpB,GAAM,aACPqF,GAAoB,UACxBD,EAAqB,EAAI,EACzBC,GAAoB,QAAU,IAChC,EAAG,CAACrF,GAAM,UAAU,CAAC,EAErB,SAASiX,IAAa,CACpBxS,GAAW,EAAI,EACfC,GAAepD,CAAQ,EACvBiN,GAAe,QAAUjN,EACzBqD,GAAWrD,CAAQ,EACnBuD,GAAY,EAAK,EACjBsB,GAAkB,EAAI,EACtBS,GAAgB,EAAI,EACpBI,EAAoB,CAAC,EACrB2G,GAAqB,CAAC,EACtBC,GAAkB,CAAC,EACnBE,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BR,GAAoB1M,CAAQ,EAC5B2M,GAAkB,CAAC,EACnBC,GAAwB,IAAI,EAC5BE,GAA4B,CAAC,EAC7BS,GAAiB,CAAC,EAClBE,GAAiB,CAAC,EAClBC,GAAc,CAAC,EACfC,GAAc,CAAC,EACfE,GAAgB,CAAC,EACjBC,GAAoB,IAAI,EACxB5J,EAAoB,IAAI,EAExBN,EAAc,CAAC,EACfI,GAAU,CAAC,EACXO,GAAY,CAAA,CAAE,EAEdsF,GAAc,CAAC,EACfE,GAAe,CAAC,EAChBI,GAAkB,EAAK,EAEvBmE,GAAoB,CAAC,EACrBE,GAAgB,CAAC,EACjBE,GAAqB,CAAC,EACtBE,GAAiB,CAAC,EAClBE,GAAc,CAAC,EACfE,GAAc,CAAC,EACfE,GAAc,CAAC,EACfE,GAAU,CAAC,EACXE,GAAU,CAAC,EACXE,GAAU,CAAC,EACXE,GAAyB,CAAC,EAC1BE,GAAqB,CAAC,EACtB3B,GAAoB,CAAC,EACrBC,GAAoB,CAAC,EACrBC,GAAgB,CAAC,EACjBC,GAAgB,CAAC,EACjB+E,GAAe,KAAK,EAEpB,MAAMp3B,EAAI,KAAK,IAAI,EAAG,KAAK,MAAM,OAAOw4B,EAAW,GAAK,CAAC,CAAC,EAE1D,GADA5Q,GAAW0Q,KAAe,QAAUt4B,EAAI,KAAK,IAAI,EAAG,KAAK,KAAKA,EAAI,CAAC,CAAC,CAAC,EACjE4lB,EACF,GAAI,CACFC,EAAe,CACb,KAAMgB,EACN,SAAU5C,EACV,QAAA0D,GACA,QAAS3D,CAAA,CACV,CACH,MAAQ,CAAC,CAEb,CAEA,SAASqW,IAAe,CACtBhT,GAAepD,CAAQ,EACvBiN,GAAe,QAAUjN,EACzBqD,GAAWrD,CAAQ,EACnBuD,GAAY,EAAK,EACjBsB,GAAkB,EAAI,EACtBS,GAAgB,EAAI,EACpBI,EAAoB,CAAC,EACrB2G,GAAqB,CAAC,EACtBC,GAAkB,CAAC,EACnBE,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BR,GAAoB1M,CAAQ,EAC5B2M,GAAkB,CAAC,EACnBS,GAAoB,QAAUpN,EAC9BmN,GAAkB,QAAU,EAC5BP,GAAwB,IAAI,EAC5BE,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtCA,GAA4B,QAAU,EACtCE,GAAiB,CAAC,EAClBE,GAAiB,CAAC,EAClBC,GAAc,CAAC,EACfC,GAAc,CAAC,EACfE,GAAgB,CAAC,EACjBC,GAAoB,IAAI,EACxB5J,EAAoB,IAAI,CAC1B,CAGA,SAASvF,GAAQ0X,EAAuB,CACtC7J,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BR,GAAoB2J,IAAkB,EAAIrW,EAAWqW,CAAa,EAClEjJ,GAAoB,QAClBiJ,IAAkB,EAAIrW,EAAWqW,EACnCvJ,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EAClCtN,IAAO,QACTuF,GAAgB,EAAK,EACrBiI,GAAiB/I,EAAS,IAE1B+I,GAAiB,CAAC,EAClBjI,GAAgB,EAAI,EAExB,CAEA,SAASgR,GAAeN,EAAc,CACpC,GAAIrT,IAAqBuO,GAAgB,QAAS,CAC3CF,IAAoBC,GAAsB,EAAI,EACnDvM,GAAM,mDAAoD,CACxD,KAAM,OACN,QAAS,IAAA,CACV,EACD,MACF,CACAwO,GAAW,KAAK,EAChB,MAAMqD,EAAetJ,GAAe,QAC9BuJ,EAAoBtJ,GAAoB,QACxCuJ,EAAkBtJ,GAAkB,QACpCuJ,EAAoBtJ,GAAoB,QACxCuJ,EAA4BtJ,GAA4B,QACxD58B,EAAY8lC,EAAeP,EAC3BY,EAAgBJ,EAAoB,EAM1C,GAJAlK,GAAkB0J,CAAI,EACtB3J,GAAsBr1B,IAAMA,GAAI,CAAC,EACjCs3B,GAAqBt3B,IAAMA,GAAI,CAAC,EAE5BvG,EAAY,EAAG,CACjB,GAAI,CACF,MAAMghC,GAAe8E,EACfM,GAAgBH,EACtB3jB,GAAS,SAAA,EAAW,YAAY,cAAe6jB,EAAe,EAAG,CAC/D,aAAAnF,GACA,cAAAoF,GACA,KAAM,GACN,OAAQ,EAAA,CACT,CACH,MAAQ,CAAC,CAIT,GAHAzT,GAAesT,CAAiB,EAChCzJ,GAAe,QAAUyJ,EAErBH,GAAgB,GAAI,CACtB,MAAMO,IAAqBH,GAA6B,GAAK,EAC7D1I,GAAqBttB,IAAMA,GAAIm2B,EAAiB,CAClD,CAEA,GAAIvV,EACF,GAAI,CACFvwB,GACEqwB,GAAM,UAAY,SAClB,EACA,KAAK,IAAIqV,EAAmB,CAAC,EAC7BlV,EACA,CAAE,OAAQC,EAAc,aAAcC,CAAA,CAAkB,CAE5D,MAAQ,CAAC,CAGXkL,GAAwB,CAAC,EACzBlH,EAAoB,CAAC,EACrBiH,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtC1O,GAAQ+X,CAAiB,EACzB,MACF,CAEAtT,GAAe3yB,CAAS,EACxBw8B,GAAe,QAAUx8B,EAEzB+7B,GAAoBoK,CAAa,EACjC1J,GAAoB,QAAU0J,EAC9B,MAAMG,EAAcN,EAAkBT,EACtCrJ,GAAkBoK,CAAW,EAC7B5J,GAAkB,QAAU4J,EAE5BrI,GAAsBzyB,IAAMA,GAAI+5B,CAAI,EACpCtQ,EAAoB,CAAC,EAErB,MAAM+L,EAAe8E,EACfM,EAAgBpmC,EAChBumC,EAAsBvF,EAAe,IAAMoF,GAAiB,GAC5DI,GAAsBxF,GAAgB,GACxCuF,GACFlK,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,GAC7B4J,KACTnK,GAA6Bhe,IAAMA,GAAI,CAAC,EACxCue,GAA4B,SACzBsJ,GAA6B,GAAK,GAGvC,MAAMO,GAAoB7J,GAA4B,SAAW,EAC3D8J,GAAiB1F,GAAgB,GACjC2F,GAAmBD,GACrB,KAAK,IAAID,GAAmB,KAAK,IAAIN,EAAe,CAAC,CAAC,EACtD,EAEJ,GAAInmC,IAAc,EAAG,CACnB,MAAM6Z,GAA4B,CAChC,WAAYysB,EACZ,MAAOH,EACP,aAAcL,EACd,UAAW,EACX,eAAgBa,GAChB,SAAU,GACV,aAAcD,GACd,gBAAiBT,GAAqB,IAAMA,EAAoB,IAAA,EAE9D/T,GACFoP,GAAkBznB,EAAO,EAEzBinB,GAAmBjnB,GAAS,WAAW,EAEzC,MACF,CAEA,GAAIssB,GAAiB,EAAG,CACtB,MAAMtsB,GAA4B,CAChC,WAAYysB,EACZ,MAAOH,EACP,aAAcL,EACd,UAAA9lC,EACA,eAAgB2mC,GAChB,SAAU,GACV,aAAcD,GACd,gBAAiB,IAAA,EAEfxU,GACFoP,GAAkBznB,EAAO,EAEzBinB,GAAmBjnB,GAAS,WAAW,EAEzC,MACF,CACF,CAEA,SAAS+sB,IAAiB,CACxB,MAAMrB,EAAOzyB,GAAM,KAAK,MAAM,OAAOkiB,EAAgB,GAAK,CAAC,EAAG,EAAG,EAAE,EACnE6Q,GAAeN,CAAI,CACrB,CAEA,SAASzX,GAAuB+Y,EAA2B,CACzD,GAAI,CAAC,OAAO,SAASA,CAAQ,EAAG,MAAO,GAEvC,MAAMC,EAAanK,GAAoB,QACjCoK,EAAYvK,GAAe,QAC3BwK,EAAgBvK,GAAoB,QACpCwK,EAAcvK,GAAkB,QAChCwK,EAAkBF,EAAgB,GAAKC,EAAc,EAEvDC,IACFvU,GAAemU,CAAU,EACzBtK,GAAe,QAAUsK,EACzB/K,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BP,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtCf,GAAkB,CAAC,EACnB5G,EAAoB,CAAC,EACrB2G,GAAsBr1B,GAAM,KAAK,IAAI,EAAGA,EAAIygC,CAAa,CAAC,EAC1DnJ,GAAqBt3B,GAAM,KAAK,IAAI,EAAGA,EAAIygC,CAAa,CAAC,EACzD/I,GAAsBzyB,GAAM,KAAK,IAAI,EAAGA,EAAIy7B,CAAW,CAAC,EACxD3K,GAAoB,QAAU,GAGhC,MAAM0E,EAAekG,EAAkBJ,EAAaC,EAC9CI,EAAcnG,GAAgB,IAAM,IAAM,IAC1CoG,EAAQt0B,GAAM,KAAK,MAAM+zB,CAAQ,EAAG,EAAGM,CAAW,EAExD1E,GAAW,MAAO,CAAC,EACnB7G,GAAsBr1B,GAAMA,EAAI,CAAC,EACjCs3B,GAAqBt3B,GAAMA,EAAI,CAAC,EAChCw1B,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BP,GAAkBkL,CAAK,EACvB1K,GAAkB,QAAU0K,EAC5BjL,GAAwBiL,CAAK,EAEzBA,IAAU,IAAK/I,GAAe/yB,GAAMA,EAAI,CAAC,EACpC87B,GAAS,IAAK7I,GAAejzB,GAAMA,EAAI,CAAC,EACxC87B,GAAS,KAAK3I,GAAenzB,GAAMA,EAAI,CAAC,EAEjD,MAAMtL,EAAYghC,EAAeoG,EAEjC,GAAIpnC,EAAY,EAAG,CACjB,GAAI8wB,EACF,GAAI,CACFvwB,GAASghC,GAAW,EAAG,KAAK,IAAIuF,EAAY,CAAC,EAAG/V,EAAa,CAC3D,OAAQC,EACR,aAAcC,CAAA,CACf,CACH,MAAQ,CAAC,CAEX,GAAI,CACF3O,GAAS,SAAA,EAAW,YAAY,cAAe,EAAG,EAAG,CACnD,aAAA0e,EACA,cAAe8F,EACf,KAAM,GACN,OAAQ,EAAA,CACT,CACH,MAAQ,CAAC,CACT,OAAAnU,GAAemU,CAAU,EACzBtK,GAAe,QAAUsK,EACzB3K,GAAwB,CAAC,EACzBD,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BX,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BJ,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtC1O,GAAQ4Y,CAAU,EACX,EACT,CAMA,GAJAnU,GAAe3yB,CAAS,EACxBw8B,GAAe,QAAUx8B,EACzBi+B,GAAsBzyB,GAAMA,EAAI47B,CAAK,EAEjCtW,EACF,GAAI,CACFvwB,GAASghC,GAAW6F,EAAO,KAAK,IAAIpnC,EAAW,CAAC,EAAG+wB,EAAa,CAC9D,OAAQC,EACR,aAAcC,CAAA,CACf,CACH,MAAQ,CAAC,CAQX,GALI+P,GAAgB,KAClBxD,GAAqBttB,GAAMA,EAAI,CAAC,EAC5BlQ,IAAc,GAAGy9B,GAAqB/4B,GAAMA,EAAI,CAAC,GAGnD1E,IAAc,EAAG,CACfghC,GAAgB,KAClB/B,GAA0Bv6B,GAAM,KAAK,IAAIA,EAAGs8B,CAAY,CAAC,EAC3D,GAAI,CACF1e,GAAS,SAAA,EAAW,YAAY,cAAe,EAAG8kB,EAAO,CACvD,aAAApG,EACA,cAAe,EACf,OAAQ,GACR,KAAM,EAAA,CACP,CACH,MAAQ,CAAC,CACT,OAAAvN,EAAoB,QAAQ,EAC5BT,GAAgB,EAAI,EACpB+I,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BP,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EAC/B,EACT,CAEA,GAAI,CACFta,GAAS,SAAA,EAAW,YAAY,cAAe,EAAG8kB,EAAO,CACvD,aAAApG,EACA,cAAehhC,EACf,OAAQ,GACR,KAAM,EAAA,CACP,CACH,MAAQ,CAAC,CACT,OAAAkuB,GAAQluB,CAAS,EACjBk8B,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BX,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BJ,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EAC/B,EACT,CAGA,MAAMyK,GAAoCtZ,GAA0B,CAClE,MAAAE,GACA,uBAAAH,GACA,QAAAI,EAAA,CACD,EAGK,CAACoZ,GAAiBC,EAAkB,EAAIxlC,EAAAA,SAAiB,EAAE,EAC3DylC,GAA0Bt+B,GAAgB,CAC9C,GAAI,CAACA,EAAK,CACRq+B,GAAmB,EAAE,EACrB,MACF,CACA,MAAME,EAAcv+B,EAAI,QAAQ,UAAW,EAAE,EAC7C,GAAI,CAACu+B,EAAa,CAChBF,GAAmB,EAAE,EACrB,MACF,CACA,MAAM91B,EAAS,OAAOg2B,CAAW,EACjC,GAAI,CAAC,OAAO,SAASh2B,CAAM,EAAG,OAC9B,MAAMi2B,EAAalL,GAAe,SAAW,IAAM,IAAM,IACnDmL,EAAO70B,GAAM,KAAK,MAAMrB,CAAM,EAAG,EAAGi2B,CAAU,EACpDH,GAAmB,OAAOI,CAAI,CAAC,CACjC,EACA,SAASC,IAAgB,CACvB,GAAI,CAACN,GAAiB,CACpB,MAAM,sCAAsC,EAC5C,MACF,CACA,MAAM71B,EAAS,OAAO61B,EAAe,EACrC,GAAI,CAAC,OAAO,SAAS71B,CAAM,EAAG,CAC5B,MAAM,sCAAsC,EAC5C,MACF,CACA,MAAMi2B,EAAalL,GAAe,SAAW,IAAM,IAAM,IACnDqL,EAAU/0B,GAAM,KAAK,MAAMrB,CAAM,EAAG,EAAGi2B,CAAU,EACnDj2B,EAASi2B,GACXzT,GAAM,8BAA8ByT,CAAU,IAAK,CACjD,KAAM,OACN,QAAS,IAAA,CACV,EAEC5Z,GAAuB+Z,CAAO,GAChCN,GAAmB,EAAE,CAEzB,CAEA,MAAMO,GAAoBtlC,EAAAA,YAAY,IAAM,CACtCi+B,GAAgB,UAClBA,GAAgB,QAAU,KAC1BE,GAAA,EACAH,GAAsB,EAAK,GAE7B,MAAM3b,EAAa4X,GAAoB,QACjCsE,EAAarE,GAAkB,QAC/BoK,EAAanK,GAAoB,QACnC9X,IAAe,GAAKkc,IAAe,IACvCpO,GAAemU,CAAU,EACzBtK,GAAe,QAAUsK,EACzB/K,GAAoB,CAAC,EACrBU,GAAoB,QAAU,EAC9BP,GAAkB,CAAC,EACnBQ,GAAkB,QAAU,EAC5BL,GAA4B,CAAC,EAC7BO,GAA4B,QAAU,EACtCf,GAAkB,CAAC,EACnB5G,EAAoB,CAAC,EACrB2G,GAAsBr1B,GAAM,KAAK,IAAI,EAAGA,EAAIse,CAAU,CAAC,EACvDgZ,GAAqBt3B,GAAM,KAAK,IAAI,EAAGA,EAAIse,CAAU,CAAC,EACtDoZ,GAAsBzyB,GAAM,KAAK,IAAI,EAAGA,EAAIu1B,CAAU,CAAC,EACvDzE,GAAoB,QAAU,EAChC,EAAG,CAACqE,EAAsB,CAAC,EAE3Bl8B,EAAAA,UAAU,IAAM,CACd,MAAMsjC,EAAkBC,GAAe,CACrC,MAAMC,EAAUD,GAAqB,OACjC,CAACC,GAAUA,GAAQ,SAAW,gBAClCH,GAAA,CACF,EACA,cAAO,iBACL,0BACAC,CAAA,EAEK,IACL,OAAO,oBACL,0BACAA,CAAA,CAEN,EAAG,CAACD,EAAiB,CAAC,EAGtB,SAASI,GAAWzjB,EAAa,CAC/Bge,GAAW,iBAAiB,EAC5B,MAAM8C,EAAOzyB,GAAM,KAAK,MAAM2R,GAAO,CAAC,EAAG,EAAG,EAAE,EAI9C,GAHAoX,GAAkB0J,CAAI,EACtB3J,GAAsBr1B,GAAMA,EAAI,CAAC,EACjCs3B,GAAqBt3B,GAAMA,EAAI,CAAC,EAC5BygB,GAAYue,EAAMrQ,EAAO,EAAG,CAC9B,MAAMiT,EAAW/S,GAAS,EAC1BC,GAAU8S,CAAQ,EAClBhT,GAAY5pB,GAAM,KAAK,IAAI,GAAIA,EAAI,CAAC,CAAC,EAEjC48B,GAAY,KACd1U,EAAoB,QAAQ,EAC5BT,GAAgB,EAAI,EAExB,CACAiC,EAAoB,CAAC,CACvB,CACA,SAASmT,IAAe,CACtBF,GAAW,OAAOlT,EAAgB,CAAC,CACrC,CACA,SAASqT,IAAc,CACrB,MAAMrnC,EAAIkmB,GAAgBoY,EAAS,EACnC,GAAIt+B,GAAK,KAAM,CACb,MAAM,6BAA6B,EACnC,MACF,CACAknC,GAAWlnC,CAAC,EACZu+B,GAAa,EAAE,CACjB,CAGA,SAAS+I,GACPv+B,EACAwG,EACAyQ,EACA,CACA,GAAI0V,GAAa,OACjB+L,GAAW,UAAU,EACrB,MAAMtiC,EAAS+1B,GACTqS,EACHh4B,IAAS,UAAYyQ,IAAW7gB,GAChC,CAACoQ,GAAQxG,IAAU5J,EAAS,EAC3BooC,GAAK9R,GAAY/xB,GAAMA,EAAI,CAAC,EAChC6xB,GAAahwB,GAAM,CACjB,MAAMiiC,EAAKjiC,EAAI,EACf,GAAIiiC,GAAM,EAAG,CACX,MAAMC,EAAYjS,IAAW+R,EAAM,EAAI,GACnCE,EAAY,EAAGpS,GAAa/1B,GAAMA,EAAImoC,EAAYtoC,EAAS,CAAC,EAC3Dk2B,GAAa/1B,GAAMA,EAAIH,EAAS,CAAC,EACtC,MAAMuZ,EAAOvZ,EAAS,EACtB,OAAAg2B,GAAYzc,CAAI,EAChB+c,GAAW,CAAC,EACR/c,EAAO,IAAIid,GAAe,EAAI,EAC3B,CACT,CACA,OAAO6R,CACT,CAAC,CACH,CACA,SAASE,IAAgB,CACvBJ,GAAW,KAAK,IAAI,EAAGtT,GAAmB,CAAC,CAAC,EAC5CC,EAAoB,CAAC,CACvB,CACA,SAAS0T,IAAW,CAClBxS,GAAY,CAAC,EACbE,GAAY,EAAE,EACdE,GAAY,CAAC,EACbE,GAAW,CAAC,EACZE,GAAe,EAAK,EACpB+L,GAAe,UAAU,CAC3B,CAGA,SAASkG,GAAe7+B,EAAe,CACrC04B,GAAW,UAAU,EACrB1L,GAAYz2B,GAAMA,EAAI,KAAK,IAAI,EAAGyJ,EAAQ,CAAC,CAAC,EAC5CktB,GAAY1wB,GAAM,CAChB,MAAMiiC,EAAKjiC,EAAI,EACf,OAAIiiC,GAAM,GACR3R,GAAYjyB,GAAMA,EAAI,CAAC,EAChB,GAEF4jC,CACT,CAAC,CACH,CACA,SAASK,GAAiB9+B,EAAe,CACvC04B,GAAW,YAAY,EACvBnL,GAAYh3B,GAAMA,EAAI,KAAK,IAAI,EAAGyJ,EAAQ,CAAC,CAAC,EAC5CytB,GAAYjxB,GAAM,CAChB,MAAMiiC,EAAKjiC,EAAI,EACf,OAAIiiC,GAAM,GACRpR,GAAYxyB,GAAMA,EAAI,CAAC,EAChB,GAEF4jC,CACT,CAAC,CACH,CACA,SAASM,GAAgB/+B,EAAe,CACtC04B,GAAW,WAAW,EACtB5K,GAAYv3B,GAAMA,EAAI,KAAK,IAAI,EAAGyJ,EAAQ,CAAC,CAAC,EAC5CguB,GAAYxxB,GAAM,CAChB,MAAMiiC,EAAKjiC,EAAI,EACf,OAAIiiC,GAAM,GACR7Q,GAAY/yB,GAAMA,EAAI,CAAC,EAChB,GAEF4jC,CACT,CAAC,CACH,CAGA,SAASO,GACPC,EACAC,EACA1tB,EACA2tB,EACAC,EACAC,EACAr/B,EACAwG,EACA,CACA,MAAMmJ,EAAOsvB,EAAMj/B,EACnB,GAAI,EAAA2P,EAAO,GAEX,GAAWA,IAAS,EAAG,CACrB,GAAInJ,IAAS,UAAYA,IAAS,aAAc,CAC9C64B,EAAc9oC,GAAMA,EAAI,CAAC,EACzB6oC,EAAaj5B,GAAMA,EAAI,CAAC,EACxBg5B,EAAS,IAAM,CAAC,EAChBD,EAAOD,CAAG,EACV,MACF,CACAC,EAAOvvB,CAAI,CACb,MACEuvB,EAAOvvB,CAAI,EAEbwvB,EAAU3iC,GAAM,CACd,MAAMiiC,EAAKjiC,EAAI,EACf,OAAIiiC,GAAM,GACRW,EAAaj5B,GAAMA,EAAI,CAAC,EACjB,GAEFs4B,CACT,CAAC,CACH,CACA,SAASa,GACPt/B,EACAwG,EACA,CACAkyB,GAAW,cAAc,EACzBsG,GACE9Q,GACAC,GACAC,GACAC,GACAE,GACAE,GACAzuB,EACAwG,CAAA,EAEE4nB,GAAa,GAAK,GAAGD,GAAY,GAAG,CAC1C,CACA,SAASoR,GACPv/B,EACAwG,EACA,CACAkyB,GAAW,cAAc,EACzBsG,GACEtQ,GACAC,GACAC,GACAC,GACAE,GACAE,GACAjvB,EACAwG,CAAA,EAEEooB,GAAa,GAAK,GAAGD,GAAY,GAAG,CAC1C,CACA,SAAS6Q,GAAYC,EAAgB,CACnC,MAAMxoC,EAAIkmB,GAAgBoY,EAAS,EACnC,GAAIt+B,GAAK,KAAM,CACb,MAAM,6BAA6B,EACnC,MACF,CACA,MAAMX,EAAIi/B,GAAU,KAAA,EAAO,YAAA,EACrBmK,EACJppC,EAAE,WAAW,GAAG,GAChBA,IAAM,MACNA,IAAM,QACNA,IAAM,SACNA,IAAM,SACNA,EAAE,SAAS,OAAO,EAChBmpC,EAAOH,GAAaroC,EAAGyoC,EAAW,SAAW,MAAS,EACrDH,GAAatoC,EAAGyoC,EAAW,SAAW,MAAS,EACpDlK,GAAa,EAAE,CACjB,CACA,SAASmK,IAAa,CACpBxR,GAAY,GAAG,EACfE,GAAc,CAAC,EACfE,GAAiB,CAAC,EAClBE,GAAkB,CAAC,EACnBkK,GAAe,cAAc,CAC/B,CACA,SAASiH,IAAa,CACpBjR,GAAY,GAAG,EACfE,GAAc,CAAC,EACfE,GAAiB,CAAC,EAClBE,GAAkB,CAAC,EACnB0J,GAAe,cAAc,CAC/B,CAGA,SAASkH,GACP7/B,EACAwG,EACAyQ,EACA,CACA,GAAIyY,GAAgB,OACpBgJ,GAAW,iBAAiB,GAEzBlyB,IAAS,UAAYyQ,IAAWiY,IAChC,CAAC1oB,GAAQxG,IAAUkvB,GAAe,IAC1BG,GAAe10B,GAAMA,EAAI,CAAC,EACrC40B,GAAgB/yB,GAAM,CACpB,MAAMiiC,EAAKjiC,EAAI,EAEf,GAAIiiC,EAAK,IAAM,GAAK,CAAC,GAAI,GAAI,EAAE,EAAE,SAASvP,EAAY,EAAG,CACvD,MAAM4Q,EAAQ,CAAC,GAAI,GAAI,EAAE,EACnB/7B,EAAM+7B,EAAM,QAAQ5Q,EAAY,EAChCvf,EAAOmwB,GAAO/7B,EAAM,GAAK+7B,EAAM,MAAM,EAC3C3Q,GAAgBxf,CAAI,CACtB,CAEA,OAAI6f,GAAiB,GAAKiP,GAAMjP,OAAkC,EAAI,EAC/DiP,CACT,CAAC,CACH,CACA,SAASsB,IAAc,CACrB1Q,GAAc,CAAC,EACfE,GAAe,CAAC,EAChBI,GAAkB,EAAK,EACvBgJ,GAAe,iBAAiB,CAClC,CAGA,SAASqH,GACPhgC,EACAwG,EACAyQ,EACA,CACAyhB,GAAW,UAAU,EACrB7I,EAAa/yB,GAAS,CACpB,MAAMmjC,EAAK,CAAE,GAAGnjC,CAAA,EAChB,OAAA8iB,GAAkBqgB,EAAWjgC,EAAOwG,EAAayQ,CAAM,EAChDgpB,CACT,CAAC,CACH,CACA,SAASC,IAAgB,CACvBrQ,EAAYlQ,IAAgB,EAC5BgZ,GAAe,UAAU,CAC3B,CAGA,SAASwH,GACPngC,EACAwG,EACAyQ,EACA,CACAyhB,GAAW,MAAM,EACjB3I,EAASjzB,GAAS,CAChB,MAAMmjC,EAAK,CAAE,GAAGnjC,CAAA,EAChB,OAAAkjB,GAAcigB,EAAWjgC,EAAOwG,EAAayQ,CAAM,EAC5CgpB,CACT,CAAC,CACH,CACA,SAASG,IAAY,CACnBrQ,EAAQhQ,IAAY,EACpB4Y,GAAe,MAAM,CACvB,CAGA,SAAS0H,GACP9f,EACAvgB,EACAwG,EACAyQ,EACA,CACAyhB,GAAW,aAAa,EACxBzI,EAAQnzB,GAAS,CACf,MAAMmjC,EAAK,CAAE,GAAGnjC,EAAM,MAAO,CAAC,GAAGA,EAAK,KAAK,CAAA,EAC3C,OAAAwjB,GAAa2f,EAAW1f,EAAavgB,EAAOwG,EAAayQ,CAAM,EACxDgpB,CACT,CAAC,CACH,CACA,SAASK,IAAW,CAClBrQ,EAAO/P,IAAiB,EACxByY,GAAe,aAAa,CAC9B,CAGA,SAAS4H,GACPvgC,EACAwG,EACAyQ,EACA,CACAyhB,GAAW,kBAAkB,EAC7BvI,EAAcrzB,GAAS,CACrB,MAAMmjC,EAAK,CAAE,GAAGnjC,EAAM,MAAO,CAAE,GAAGA,EAAK,MAAM,EAC7C,OAAAmlB,GAAmBge,EAAWjgC,EAAOwG,EAAayQ,EAAQ,IAAM,EAAK,EAC9DgpB,CACT,CAAC,CACH,CACA,SAASO,IAAiB,CACxBrQ,EAAanO,IAAsB,EACnC2W,GAAe,kBAAkB,CACnC,CAGA,SAAS8H,GACP/lB,EACAlU,EACAyQ,EACA,CACAyhB,GAAW,kBAAkB,EAC7B,MAAMtiC,EAASgnB,GAAUmO,EAAQ,EACjC,IAAIiT,EAAM,GAcV,GAZE,OAAOvnB,GAAW,UAClBA,IAAW7gB,IACVoQ,IAAS,UAAYA,IAAS,UAAYA,IAAS,YAEpDg4B,EAAM,IACJpoC,IAAW,KAAOoQ,IAAS,QAAUkU,IAAQ,MAAK8jB,EAAM,IACxDpoC,IAAW,KAAOoQ,IAAS,cAAgBkU,IAAQ,MAAK8jB,EAAM,IAC7DA,IAEC9jB,IAAQtkB,GAAUskB,IAAQtkB,EAAS,GAAKskB,IAAQtkB,EAAS,KAC3DooC,EAAM,IAENA,EAAK,CACP,MAAMkC,EAAUjV,GAAU,EAC1BC,GAAWgV,CAAO,EAClBlV,GAAahqB,GAAMA,EAAI,CAAC,CAC1B,CACF,CACA,SAASm/B,IAAgB,CACvBF,GAAY,KAAK,IAAI,EAAGxV,GAAmB,CAAC,CAAC,EAC7CC,EAAoB,CAAC,CACvB,CACA,SAAS0V,IAAe,CACtB,MAAM3pC,EAAIkmB,GAAgBoY,EAAS,EACnC,GAAIt+B,GAAK,KAAM,CACb,MAAM,4BAA4B,EAClC,MACF,CACAwpC,GAAYxpC,CAAC,EACbu+B,GAAa,EAAE,CACjB,CAGA,SAASqL,GACP7gC,EACAwG,EACAyQ,EACA,CACAyhB,GAAW,SAAS,EACpB/M,GAAY7uB,GAAS,CACnB,MAAMgkC,EAAO,CAAE,GAAGhkC,EAAM,MAAO,CAAE,GAAGA,EAAK,MAAM,EAC/C,OAAA0gB,GAAiBsjB,EAAa9gC,EAAOwG,EAAMyQ,EAAQ,IAAM,EAAK,EACvD6pB,CACT,CAAC,EACD5U,GAAsB1vB,GAAM,CAC1B,MAAMiiC,EAAKjiC,EAAI,EACf,OAAIiiC,GAAM,EAAU,EACbA,CACT,CAAC,CACH,CACA,SAASsC,IAAoB,CAC3BF,GAAe,KAAK,IAAI,EAAG5V,GAAmB,CAAC,CAAC,EAChDC,EAAoB,CAAC,CACvB,CAGA,SAAS8V,GACPhhC,EACAwG,EACAyQ,EACA,CACAyhB,GAAW,UAAU,EACrB9M,GAAa9uB,GAAS,CACpB,MAAMgkC,EAAO,CAAE,GAAGhkC,EAAM,SAAU,CAAE,GAAGA,EAAK,SAAS,EACrD,OAAAqhB,GAAkB2iB,EAAa9gC,EAAOwG,EAAMyQ,CAAM,EAC3C6pB,CACT,CAAC,EACD5U,GAAsB1vB,GAAM,CAC1B,MAAMiiC,EAAKjiC,EAAI,EACf,OAAIiiC,GAAM,GACR7S,GAAa9uB,GAAS,CACpB,MAAMmjC,EAAK,CAAE,GAAGnjC,EAAM,SAAU,CAAE,GAAGA,EAAK,SAAS,EACnD,OAAAshB,GAAgB6hB,CAAS,EAClBA,CACT,CAAC,EACM,GAEFxB,CACT,CAAC,CACH,CACA,SAASwC,IAAqB,CAC5BD,GAAgB,KAAK,IAAI,EAAG/V,GAAmB,CAAC,CAAC,EACjDC,EAAoB,CAAC,CACvB,CAGA,SAASgW,GACPlhC,EACAwG,EACAyQ,EACA,CACAyhB,GAAW,UAAU,EACrB5M,GAAUhvB,GAAS,CACjB,MAAMgkC,EAAO,CAAE,GAAGhkC,EAAM,QAAS,CAAC,GAAGA,EAAK,OAAO,CAAA,EACjD,OAAAyhB,GAAiBuiB,EAAa9gC,EAAOwG,EAAMyQ,CAAM,EAC1C6pB,CACT,CAAC,EACD5U,GAAsB1vB,GAAM,CAC1B,MAAMiiC,EAAKjiC,EAAI,EACf,OAAIiiC,GAAM,GACR3S,GAAUhvB,GAAS,CACjB,MAAMmjC,EAAK,CAAE,GAAGnjC,EAAM,QAAS,CAAC,GAAGA,EAAK,OAAO,CAAA,EAC/C,OAAA0hB,GAAeyhB,CAAS,EACjBA,CACT,CAAC,EACM,GAEFxB,CACT,CAAC,CACH,CACA,SAAS0C,IAAkB,CACzBD,GAAa,KAAK,IAAI,EAAGjW,GAAmB,CAAC,CAAC,EAC9CC,EAAoB,CAAC,CACvB,CAGA,SAASkW,GACPphC,EACAwG,EACAyQ,EACA,CACAyhB,GAAW,UAAU,EACrB1M,GAAYlvB,GAAS,CACnB,MAAMgkC,EAAO,CAAE,GAAGhkC,CAAA,EAClB,OAAA4hB,GAAiBoiB,EAAa9gC,EAAOwG,EAAMyQ,CAAM,EAC1C6pB,CACT,CAAC,EACD5U,GAAsB1vB,GAAM,CAC1B,MAAMiiC,EAAKjiC,EAAI,EACf,OAAIiiC,GAAM,GACRzS,GAAYlvB,GAAS,CACnB,MAAMmjC,EAAK,CAAE,GAAGnjC,CAAA,EAChB,OAAA6hB,GAAeshB,CAAS,EACjBA,CACT,CAAC,EACM,GAEFxB,CACT,CAAC,CACH,CACA,SAAS4C,IAAoB,CAC3BD,GAAe,KAAK,IAAI,EAAGnW,GAAmB,CAAC,CAAC,EAChDC,EAAoB,CAAC,CACvB,CAEA,SAASoW,IAAgC,CACvC,MAAM,EAAI/L,GAAU,KAAA,EAAO,YAAA,EAC3B,GAAI,CAAC,EAAG,OAAO,KACf,GAAI,IAAM,MAAQ,IAAM,QAAU,IAAM,SAAW,IAAM,QAAS,MAAO,IACzE,GAAI,IAAM,MAAQ,IAAM,QAAS,MAAO,IACxC,MAAM5uB,EAAI,EAAE,MAAM,wBAAwB,EAC1C,GAAI,CAACA,EAAG,OAAO,KACf,MAAMC,EAAQD,EAAE,CAAC,GAAK,IAChBmS,EAAM,SAASnS,EAAE,CAAC,EAAG,EAAE,EAC7B,OAAImS,EAAM,GAAKA,EAAM,GAAW,KAEzBA,GADSlS,IAAS,IAAM,EAAIA,IAAS,IAAM,EAAI,EAExD,CAEA,SAAS26B,IAAY,CACnB,MAAM7mB,EAAM4mB,GAAA,EACZ,GAAI5mB,GAAO,KAAM,CACf,MAAM,gCAAgC,EACtC,MACF,CACAohB,GAAephB,CAAG,EAClB8a,GAAa,EAAE,CACjB,CAEA,SAASgM,IAAoB,CAC3B,MAAMnhB,EAAQoV,GACX,KAAA,EACA,MAAM;AAAA,CAAI,EACV,IAAKtP,GAAMA,EAAE,KAAA,CAAM,EACnB,OAAQA,GAAMA,CAAC,EAClB,GAAI9F,EAAM,SAAW,EACrB,WAAWohB,KAAQphB,EAAO,CACxB,MAAM3F,EAAMyC,GAAgBskB,CAAI,EAChC,GAAI/mB,GAAO,KAAM,CACf,MAAM,kBAAkB+mB,CAAI,EAAE,EAC9B,MACF,CACA3F,GAAephB,CAAG,CACpB,CACAgb,GAAkB,EAAE,EACtB,CAEA,SAASgM,IAAc,CACjB3P,KAAqB,IAEzBnJ,GAAgBryB,GAAMA,EAAIkuB,EAAc,EACxCuN,GAAqBx1B,GAAM,KAAK,IAAI,EAAGA,EAAI,CAAC,CAAC,EAC/C,CAEA,SAASmlC,IAAoB,CAC3B,MAAMjnB,EAAM4mB,GAAA,EACZ,GAAI5mB,GAAO,KAAM,CACf,MAAM,gCAAgC,EACtC,MACF,CACA,GAAIqX,KAAqB,EAAG,CAC1BwP,GAAA,EACA,MACF,CAEA,MAAMK,EAASnd,GACfmE,GAAgBryB,GAAMA,EAAIqrC,CAAM,EAChC5P,GAAqBx1B,GAAM,KAAK,IAAI,EAAGA,EAAI,CAAC,CAAC,EAE7C,WAAW,IAAMs/B,GAAephB,CAAG,EAAG,CAAC,EACvC8a,GAAa,EAAE,CACjB,CAyBA,SAASqM,IAAuB,CAC9B,MAAMC,EAASrY,GAAoB,SAE7BsY,EACJD,IAAW,SACPzP,IAA4B,OAC5BkB,IAAwB,OACxByO,EAAgB,EAChBC,EAAcH,IAAW,SAAWlQ,GAAoBoB,GAC9DjJ,GAAY,CACV,GAAG1E,EACH,CACE,OAAAyc,EACA,YAAAnY,EACA,cAAAE,EACA,YAAAoY,EACA,WAAYF,EACZ,WAAYC,CAAA,CACd,CACD,EACD/Y,GAAgB,EAAK,EAErB,IAAIxnB,EAAI8iB,GACJpe,EAAIqe,GAOR,GANIiF,IAAqB,SAAUhoB,GAAK,EAC/BgoB,IAAqB,OAAMtjB,GAAK,GACzCijB,EAAc3nB,CAAC,EACf+nB,GAAUrjB,CAAC,EACXujB,EAAoB,IAAI,EAEpBjoB,GAAKynB,IAAW/iB,GAAK+iB,GAAS,CAGhC,GAAI,CACFgZ,GAAa9Z,EAAc0Z,IAAW,QAAQ,CAChD,MAAQ,CAAC,CACTzX,GAAkB,EAAK,EACvB1B,GAAW,EAAK,EAEhBC,GAAepD,CAAQ,EACvBqD,GAAWrD,CAAQ,EACnB8P,GAAoB,EAAI,EACxB,MACF,CAEAsG,GAAA,CACF,CAGA,MAAMuG,GAAgB,CADCC,GAAU,SAASha,CAAmB,GACpB,EAAEvB,GAAM,YAAcA,GAAM,OAIrE,OACE1mB,EAAAA,KAAC,MAAA,CAAI,UAAU,+CACZ,SAAA,CAAAkpB,IACC5uB,EAAAA,IAAC4nC,GAAA,CACC,QAAUne,GAAM,SAAW,CAAA,EAC3B,OAAQ,IAAMoF,EAAqB,EAAK,CAAA,CAAA,EAG5CnpB,EAAAA,KAAC,KAAA,CAAG,UAAU,yCAAyC,SAAA,CAAA,eACxC,IACZ2mB,IAAkB,UACjBrsB,EAAAA,IAAC,OAAA,CAAK,UAAU,wFAAwF,SAAA,gBAAA,CAExG,QAEC,OAAA,CAAK,UAAU,qHAAqH,SAAA,gBAErI,CAAA,EAEJ,EACA0F,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,UAAU,eACV,MAAOioB,EACP,SAAWnqB,GAAMoqB,GAAgBpqB,EAAE,OAAO,KAAK,EAE9C,SAAA,CAAAmkC,GAAU,IAAKrpC,GACd0B,EAAAA,IAAC,UAAkB,MAAO1B,EACvB,SAAAA,CAAA,EADUA,CAEb,CACD,EACAupC,GAAa,IAAKvpC,GACjBoH,EAAAA,KAAC,SAAA,CAEC,MAAOpH,EACP,SAAU,EAAE8tB,GAAM,YAAcA,GAAM,OAErC,SAAA,CAAA9tB,EAAK,IAAE8tB,GAAM,YAAcA,GAAM,MAAQ,GAAK,WAAA,CAAA,EAJ1C9tB,CAAA,CAMR,CAAA,CAAA,CAAA,QAIFwpC,GAAA,CAAsB,SAAUna,EAAc,QAAS,GAAM,EAE7DA,IAAiB,mBAChBjoB,OAAC,MAAA,CAAI,UAAU,kDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,OAAC,QAAA,CAAM,UAAU,gBAAgB,SAAA,kBAAe,EAChD1F,EAAAA,IAAC,QAAA,CACC,UAAU,eACV,KAAK,SACL,IAAK,EACL,KAAM,EACN,MAAO+0B,GACP,SAAWvxB,GACTwxB,GACE,KAAK,IAAI,EAAG,KAAK,MAAM,OAAOxxB,EAAE,OAAO,KAAK,GAAK,EAAE,CAAC,CAAA,CACtD,CAAA,CAEJ,EACF,QACC,MAAA,CAAI,UAAU,uCAAuC,SAAA,0FAGtD,CAAA,EACF,EAED,CAAC4oB,GAAM,YACN1mB,EAAAA,KAAC,MAAA,CAAI,UAAU,gHACb,SAAA,CAAA1F,EAAAA,IAAC,QAAK,SAAA,KAAE,EACRA,EAAAA,IAAC,QAAK,SAAA,2GAGN,CAAA,EACF,EAED2tB,IAAiB,OAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,QAAA,CAAM,UAAU,qBAAqB,SAAA,iCAEtC,EACA3F,EAAAA,IAAC,QAAA,CACC,UAAU,eACV,KAAK,SACL,IAAK,EACL,IAAK,KACL,MAAO+qB,EACP,SAAWvnB,GAAMqqB,GAAY,OAAOrqB,EAAE,OAAO,KAAK,CAAC,CAAA,CAAA,QAEpD,QAAA,CAAM,UAAU,qBAAqB,SAAA,uBAAoB,EAC1DkC,EAAAA,KAAC,SAAA,CACC,UAAU,eACV,MAAOolB,EACP,SAAWtnB,GAAMsqB,GAAMtqB,EAAE,OAAO,KAAK,EAErC,SAAA,OAAC,SAAA,CAAO,MAAM,OAAO,SAAA,OAAI,EACxBqoB,GAAS,IAAKE,GACb/rB,EAAAA,IAAC,UAAmB,MAAO+rB,EACxB,SAAAA,CAAA,EADUA,CAEb,CACD,CAAA,CAAA,CAAA,EAEFjB,IAAO,QACNplB,OAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,OAAC,QAAA,CAAM,UAAU,gBAAgB,SAAA,2BAEjC,EACA1F,EAAAA,IAAC,QAAA,CACC,UAAU,eACV,KAAK,SACL,IAAK,GACL,IAAK,GACL,KAAM,GACN,MAAOuvB,GAAY,IACnB,SAAW/rB,GACTgsB,GAAa,KAAK,MAAM,OAAOhsB,EAAE,OAAO,KAAK,EAAI,GAAI,CAAC,CAAA,CAAA,CAE1D,EACF,QACC,MAAA,CAAI,UAAU,yBAAyB,SAAA,mDAExC,CAAA,EACF,EAEFxD,EAAAA,IAAC,UAAO,UAAU,WAAW,QAAS,IAAMguB,GAAa,EAAI,EAAG,SAAA,0BAAA,CAEhE,CAAA,EACF,EAEDL,IAAiB,mBAChB3tB,EAAAA,IAAC,MAAA,CAAI,UAAU,sBAAsB,SAAA,4FAAA,CAGrC,CAAA,EAEJ,EACC,CAACiuB,IACAjuB,EAAAA,IAAC,SAAA,CACC,UAAU,MACV,SAAU0nC,GACV,MAAOA,GAAgB,iCAAmC,GAC1D,QAAShH,GACV,SAAA,aAAA,CAAA,EAKF/Q,IACC3vB,EAAAA,IAAC,MAAA,CACC,UAAW,6BAA6B6vB,GAAY,GAAK,6CAA6C,GAEtG,SAAA7vB,EAAAA,IAACohB,GAAA,CACC,WAAW,0BACX,UAAW,GAAGyO,GAAY,gCAAkC,EAAE,0CAC9D,WAAYA,GACZ,aAAc,KACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,KACV,UAAW,KACX,iBAAgB,GAGhB,SAAAnqB,EAAAA,KAAC,MAAA,CACC,UAAU,kDACV,MAAO,CAAE,UAAW,QAAA,EACpB,IAAMiJ,GAAO,CACVswB,GAAoB,QAAUtwB,CACjC,EAEA,SAAA,CAAA3O,EAAAA,IAAC,MAAA,CACC,IAAM2O,GAAO,CACVwwB,GAAqB,QAAUxwB,CAClC,EAEA,SAAA3O,EAAAA,IAAC2nB,GAAA,CACC,KACEjiB,EAAAA,KAAAC,WAAA,CACE,SAAA,OAAC,OAAA,CAAK,UAAU,gIAAgI,SAAA,YAEhJ,EACAD,EAAAA,KAAC,OAAA,CAAK,UAAU,gCACb,SAAA,CAAAioB,EACAA,IAAiB,MAAQ,MAAM5C,CAAQ,GAAK,EAAA,EAC/C,EACArlB,EAAAA,KAAC,OAAA,CAAK,UAAU,+BAA+B,SAAA,CAAA,YACnC+oB,GAAQ,WAAS3E,GAAW,IAAEC,EAAA,EAC1C,EACA/pB,EAAAA,IAAC,OAAA,CACC,UAAW,+DAA+DqsB,IAAkB,SAAW,2DAA6D,2CAA2C,GAE9M,SAAAA,IAAkB,SACf,gBACA,gBAAA,CAAA,CACN,EACF,EAEF,MACE3mB,EAAAA,KAAAC,WAAA,CAEE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,MAAG,EAChC1F,EAAAA,IAAC,SAAA,CACC,UAAU,2BACV,QAAS,IACP6sB,EACE,KAAK,IACH,GACA,KAAK,OAAO9oB,EAAc,KAAQ,GAAG,EAAI,GAAA,CAC3C,EAGJ,MAAM,uBACP,SAAA,GAAA,CAAA,EAGD2B,EAAAA,KAAC,OAAA,CAAK,UAAU,kBACb,SAAA,CAAA,KAAK,MAAM3B,EAAc,GAAG,EAAE,GAAA,EACjC,EACA/D,EAAAA,IAAC,SAAA,CACC,UAAU,2BACV,QAAS,IACP6sB,EACE,KAAK,IACH,KACA,KAAK,OAAO9oB,EAAc,KAAQ,GAAG,EAAI,GAAA,CAC3C,EAGJ,MAAM,uBACP,SAAA,GAAA,CAAA,CAED,EACF,EACA/D,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,MAAO+vB,GAAS,cAAgB,UAChC,QAAS,IAAMC,GAAWxzB,GAAM,CAACA,CAAC,EAEjC,YAAS,cAAgB,SAAA,CAAA,EAE5BwD,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,MAAO6vB,GAAY,UAAY,WAC/B,QAAS,IAAMC,GAAc5jB,GAAM,CAACA,CAAC,EAEpC,YAAY,UAAY,UAAA,CAAA,EAE3BlM,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACb0gC,GAAA,CACF,EACD,SAAA,SAAA,CAAA,EAGD1gC,EAAAA,IAAC,SAAA,CACC,UAAU,sDACV,QAAS,IAAM,CACb4vB,GAAkB,EAAK,EACvB1B,GAAW,EAAK,CAClB,EACD,SAAA,MAAA,CAAA,CAED,EACF,CAAA,CAAA,CAEJ,CAAA,EAEFxoB,EAAAA,KAAC,MAAA,CACC,IAAMiJ,GAAO,CACVuwB,GAAmB,QAAUvwB,CAChC,EACA,UAAU,wBACV,MACEohB,GACI,CACE,UAAW,SAASE,EAAQ,IAC5B,gBAAiB,WACjB,MAAO,OACP,SAAU,GAAG,KAAK,IAAI,GAAK,KAAK,IAAI,EAAGA,EAAQ,CAAC,CAAC,IAAA,EAEnD,OAGN,SAAA,CAAAjwB,MAAC,MAAG,UAAU,4CACX,SAAA2tB,IAAiB,MAAQ,YAAcA,EAC1C,EACAjoB,EAAAA,KAAC,MAAA,CAAI,UAAU,iDACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,8DAA8D,SAAA,CAAA,SACrEioB,CAAA,EACT,EACAjoB,EAAAA,KAAC,OAAA,CAAK,UAAU,8DAA8D,SAAA,CAAA,UACpEqlB,CAAA,EACV,EACArlB,EAAAA,KAAC,MAAA,CACC,IAAK85B,GACL,UAAU,6FAEV,SAAA,CAAAx/B,EAAAA,IAAC,QAAK,SAAA,UAAO,GACX,IAAM,CACN,MAAM+nC,EACJne,KAAgBmB,GAChBlB,KAAYkB,GACZuM,GAAmB,EACf0Q,EAAU,sCAAsCD,EAAW,gCAAkC,gBAAgB,IACnH,OACEriC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAW,GAAGgoC,CAAO,IAAI5I,KAAe,QAAU,wDAA0D,2CAA2C,GACvJ,QAAS,IAAM,CACR2I,GAAU1I,GAAc,OAAO,CACtC,EACA,MAAM,aACP,SAAA,UAAA,CAAA,EAGDr/B,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAW,GAAGgoC,CAAO,IAAI5I,KAAe,OAAS,wDAA0D,2CAA2C,GACtJ,QAAS,IAAM,CACR2I,GAAU1I,GAAc,MAAM,CACrC,EACA,MAAM,8BACP,SAAA,SAAA,CAAA,CAED,EACF,EACAr/B,EAAAA,IAAC,QAAA,CACC,UAAW,0BAA0B+nC,EAAW,aAAe,EAAE,GACjE,KAAK,SACL,IAAK,EACL,KAAM,EACN,MAAOzI,GACP,SAAW97B,GACT+7B,GACE,KAAK,IACH,EACA,KAAK,MAAM,OAAO/7B,EAAE,OAAO,KAAK,GAAK,CAAC,CAAA,CACxC,EAGJ,SAAAukC,EACA,MACE3I,KAAe,QACX,aACA,8BAAA,CAAA,CAER,EACF,CAEJ,GAAA,CAAG,CAAA,CAAA,EAEL15B,EAAAA,KAAC,OAAA,CAAK,UAAU,8DAA8D,SAAA,CAAA,SACrEokB,GAAW,IAAEC,EAAA,EACtB,EAEArkB,EAAAA,KAAC,MAAA,CAAI,UAAU,wDACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,QAAK,EAClCA,EAAAA,KAAC,SAAA,CACC,UAAW,OAAOs5B,EAAe,GACjC,MAAO9R,EACP,SAAW1pB,GACT2pB,GAAa3pB,EAAE,OAAO,KAA8B,EAGtD,SAAA,OAAC,SAAA,CAAO,MAAM,UAAU,SAAA,UAAO,QAC9B,SAAA,CAAO,MAAM,UAAU,SAAA,UAAO,CAAA,CAAA,CAAA,EAEjCxD,EAAAA,IAAC,QAAA,CACC,UAAW,SAASg/B,EAAe,cACnC,MAAO5R,GACP,SAAW5pB,GAAM6pB,GAAa7pB,EAAE,OAAO,KAAK,EAC5C,YAAY,QAAA,CAAA,QAEb,OAAA,CAAK,UAAU,aAAa,SAAA,KAAE,EAC/BxD,EAAAA,IAAC,QAAA,CACC,UAAW,SAASg/B,EAAe,cACnC,MAAO1R,GACP,SAAW9pB,GAAM+pB,GAAa/pB,EAAE,OAAO,KAAK,EAC5C,YAAY,QAAA,CAAA,CACd,EACF,CAAA,EACF,EACCmqB,IAAiB,MAChBjoB,OAAC,MAAA,CAAI,UAAU,4FACZ,SAAA,CAAAioB,IAAiB,mBAChB3tB,MAAA2F,EAAAA,SAAA,CACE,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,iBAAc,EAC3C1F,MAAC,QAAK,UAAU,gFACb,YAAsB0wB,EAAO,GAAG,OAAS,GAAA,CAC5C,CAAA,CAAA,CACF,CAAA,CAEF,EAED/C,IAAiB,oBAChB3tB,MAAA2F,EAAAA,SAAA,CACE,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,iBAAc,QAC1C,OAAA,CAAK,UAAU,gFACb,SAAAid,GAAUmO,EAAQ,IAAM,GACrB,kBACAnO,GAAUmO,EAAQ,IAAM,GACtB,kBACAnO,GAAUmO,EAAQ,GAAK,IAC/B,CAAA,CAAA,CACF,CAAA,CAEF,EAEDnD,IAAiB,WAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,yDAG7C,QACC,MAAA,CAAI,UAAU,sDACZ,SAAAid,GAAgB,IAAK9b,GACpBpB,EAAAA,KAAC,MAAA,CAEC,UAAU,yDAEV,SAAA,CAAA1F,MAAC,OAAI,UAAU,aACZ,SAAA8G,IAAM,GAAK,OAASA,EACvB,EACApB,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACZ,SAAA,CAAA,KAAK,IAAI,EAAGslB,GAAQ,QAAQlkB,CAAC,GAAK,CAAC,EAAE,MAAA,EACxC,CAAA,CAAA,EARKA,CAAA,CAUR,EACH,EACApB,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,UACf,IACR1F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,YAAQ,OACX,CAAA,EACF,EACCioC,GAAiBjd,EAAO,GACvBtlB,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX1F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbkxB,GAAWrO,IAAoB,EAC/B4O,GAAqB,CAAC,EACtByM,GAAe,SAAS,CAC1B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDvQ,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAA1F,EAAAA,IAAC,QAAK,SAAA,QAAK,EACXA,EAAAA,IAAC,OAAA,CAAK,UAAU,iHACb,YAAS,MACZ,CAAA,EACF,EACA0F,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9CulB,GAAS,KAAA,EACnB,EACCA,GAAS,UACRvlB,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX1F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbmxB,GAAY3N,IAAqB,EACjCiO,GAAqB,CAAC,EACtByM,GAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDvQ,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAA1F,EAAAA,IAAC,QAAK,SAAA,QAAK,EACX0F,EAAAA,KAAC,OAAA,CAAK,UAAU,iHACb,SAAA,CAAA0rB,GAAM,MAAQ,EAAE,IAAEA,GAAM,QAAQ,MAAA,EACnC,CAAA,EACF,EACA1rB,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,UACf,UACP,OAAA,CAAK,UAAU,gBACZ,UAAA,IAAM,CACN,MAAM,EAAIme,GAAsBuN,EAAK,EACrC,OAAK,EACD,EAAE,OAAS,aAAqB,MAChC,EAAE,OAAS,OAAe,OAE5B,EAAE,OAAS,UACX,EAAE,OAAS,UACX,EAAE,OAAS,SAEJ,GAAG,EAAE,IAAI,IAAK,EAAU,GAAG,GAC7B,IATQ,GAUjB,KACF,CAAA,EACF,EACA1rB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9C0rB,GAAM,KAAA,EAChB,EACCA,GAAM,UACL1rB,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX1F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbqxB,GAASzN,IAAsB,EAC/B6N,GAAqB,CAAC,EACtByM,GAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDvQ,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/B4rB,GAAQ,MAAM,aAAWA,GAAQ,MAAA,EAC1C,EACA5rB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9C4rB,GAAQ,KAAA,EAClB,EACCA,GAAQ,UACP5rB,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX1F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbuxB,GAAWvN,IAAe,EAC1ByN,GAAqB,CAAC,EACtByM,GAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDvQ,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAA1F,EAAAA,IAAC,QAAK,SAAA,SAAM,EACZ0F,EAAAA,KAAC,OAAA,CAAK,UAAU,oFAAoF,SAAA,CAAA,IAChGgsB,EAAA,EACJ,CAAA,EACF,EACAhsB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9CksB,EAAA,EACV,EACCM,IACCxsB,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX1F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAASmkC,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDxW,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/B0sB,GAAQ,IAAA,EACjB,EACA1sB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9C4sB,EAAA,EACV,CAAA,EACF,EAED3E,IAAiB,cAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BitB,GAAQ,KAAA,EACjB,EACAjtB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9CmtB,EAAA,EACV,CAAA,EACF,EAEDlF,IAAiB,aAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BwtB,GAAQ,KAAA,EACjB,EACAxtB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,UAC9C0tB,EAAA,EACV,CAAA,EACF,EAEDzF,IAAiB,gBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,YAExC,QACC,MAAA,CAAI,UAAU,yCACZ,SAAA8tB,GACH,EACA/tB,EAAAA,KAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,CAAA,aAChCmuB,GAAc,gBAAc,IACtCE,EAAA,EACH,CAAA,EACF,EAEDpG,IAAiB,gBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,YAExC,QACC,MAAA,CAAI,UAAU,yCACZ,SAAAsuB,GACH,EACAvuB,EAAAA,KAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,CAAA,aAChC2uB,GAAc,gBAAc,IACtCE,EAAA,EACH,CAAA,EACF,EAED5G,IAAiB,mBAChB3tB,MAAA2F,EAAAA,SAAA,CACE,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,mBACrB+uB,EAAA,EACnB,EACA/uB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,CAAA,SAC/CivB,EAAA,EACT,CAAA,EACF,EACAjvB,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,QAAA,CAAM,UAAU,UAAU,SAAA,SAAM,EACjC1F,EAAAA,IAAC,MAAA,CAAI,UAAU,iCACZ,SAAA,CAAC,GAAI,GAAI,EAAE,EAAE,IAAK8G,GACjBpB,EAAAA,KAAC,SAAA,CAEC,UAAW,2BAA2B+uB,KAAiB3tB,EAAI,iDAAmD,EAAE,GAChH,QAAS,IAAM4tB,GAAgB5tB,CAAC,EACjC,SAAA,CAAA,IACGA,CAAA,CAAA,EAJG,gBAAgBA,CAAC,EAAA,CAMzB,EACH,QACC,OAAA,CAAK,UAAU,qBAAqB,SAAA,KAAE,EACvC9G,EAAAA,IAAC,SAAA,CACC,UAAU,aACV,MAAOy0B,GACP,SAAWjxB,GACTkxB,GAAgB,SAASlxB,EAAE,OAAO,MAAO,EAAE,CAAC,EAG7C,SAAA,MAAM,KACL,CAAE,OAAQ,EAAA,EACV,CAAC6d,EAAGta,IAAMA,EAAI,CAAA,EACd,IAAKD,GACL9G,EAAAA,IAAC,UAAe,MAAO8G,EACpB,SAAAA,CAAA,EADUA,CAEb,CACD,CAAA,CAAA,EAEH9G,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASslC,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,CAAA,CACF,CAAA,CACF,EAED3X,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,SAAM,EAC9C3F,EAAAA,IAAC,MAAA,CAAI,UAAU,yCACZ,YAAS,OACZ,EACA0F,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,SAChB,IACP1F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,YAAS,MACZ,CAAA,EACF,CAAA,EACF,EAED2tB,IAAiB,QAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,OAAI,EAC5C3F,EAAAA,IAAC,MAAA,CAAI,UAAU,yCACZ,WAAK,KACR,EACA0F,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,WACd,IACT1F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,WAAK,QACR,CAAA,EACF,CAAA,EACF,EAED2tB,IAAiB,eAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,OAAI,EAC5C3F,EAAAA,IAAC,MAAA,CAAI,UAAU,yCACZ,WAAI,KACP,EACCu1B,EAAI,UACH7vB,OAAC,MAAA,CAAI,UAAU,eAAe,SAAA,CAAA,WACnB6vB,EAAI,QAAU,GAAA,EACzB,CAAA,EAEJ,EAED5H,IAAiB,QAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,SAAM,QAC7C,MAAA,CAAI,UAAU,yCACZ,SAAAwgB,GAAkBoQ,GAAK,WAAW,EACrC,EACA7wB,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,YACb,IACVA,EAAAA,KAAC,OAAA,CAAK,UAAU,gBACb,SAAA,CAAA6wB,GAAK,YAAc,EAAE,IAAEpQ,GAAkB,MAAA,EAC5C,CAAA,EACF,EACCoQ,GAAK,UACJ7wB,OAAC,MAAA,CAAI,UAAU,oEAAoE,SAAA,CAAA,kBACjE6wB,GAAK,MAAM,SAAA,EAC7B,CAAA,EAEJ,EAED5I,IAAiB,SAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,QAAK,EAC7CD,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACZ,SAAA,CAAAixB,GAAM,MAAM,IAAEA,GAAM,MAAA,EACvB,EACAjxB,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,SAChB,IACP1F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBAAiB,YAAM,MAAM,CAAA,EAC/C,EACC22B,GAAM,UACLjxB,OAAC,MAAA,CAAI,UAAU,oEAAoE,SAAA,CAAA,aACtEixB,GAAM,OAAO,GAAA,EAC1B,CAAA,EAEJ,EAEDhJ,IAAiB,UAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,QAAK,EAC7CD,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACZ,SAAA,CAAAqxB,GAAO,MAAM,IAAEA,GAAO,MAAA,EACzB,EACArxB,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,SAChB,IACP1F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,YAAO,MACV,CAAA,EACF,EACC+2B,GAAO,UACNrxB,OAAC,MAAA,CAAI,UAAU,oEAAoE,SAAA,CAAA,aACtEqxB,GAAO,OAAO,GAAA,EAC3B,CAAA,EAEJ,EAEDpJ,IAAiB,oBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,+CAE7C,QACC,MAAA,CAAI,UAAU,uDACZ,SAAA2hB,GAAmB,IAAKxgB,GACvBpB,EAAAA,KAAC,MAAA,CAEC,UAAU,yDAEV,SAAA,CAAA1F,MAAC,OAAI,UAAU,aACZ,SAAA8G,IAAM,GAAK,OAASA,EACvB,EACApB,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACZ,SAAA,CAAA,KAAK,IAAI,EAAG+vB,EAAU,QAAQ3uB,CAAC,GAAK,CAAC,EAAE,MAAA,EAC1C,CAAA,CAAA,EARKA,CAAA,CAUR,EACH,EACApB,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,UACf,IACR1F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,WAAU,OACb,CAAA,EACF,EACC0nB,GAAe+N,CAAS,GACvB/vB,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX1F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS+lC,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDpY,IAAiB,UAChB3tB,MAAA2F,EAAAA,SAAA,CACG,SAACmwB,GAKApwB,OAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAA1F,EAAAA,IAAC,QAAK,SAAA,OAAI,EACVA,MAAC,QAAK,UAAU,gFACb,WAAcqrB,EAAa,GAAG,MAAQ,GAAA,CACzC,CAAA,EACF,QACC,MAAA,CAAI,UAAU,yCACZ,SAAA8K,GACG,GAAGjL,EAAc,KAAMlkB,GAAMA,EAAE,KAAOmvB,EAAc,GAAG,MAAQ,QAAQ,QACvEE,IAAmB,OAAA,CACzB,CAAA,CAAA,CACF,EAhBAr2B,MAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,kCAAA,CAExC,CAcA,CAEJ,CAAA,EAEJ,EACEqsB,IAAkB,eACnB,OAAI,UAAU,iBACZ,SAACmB,GA2SA9nB,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,wBAE5C,QACC,MAAA,CAAI,UAAU,qBAAqB,SAAA,yFAGpC,CAAA,EACF,EAlTAA,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAA3F,EAAAA,IAAC,OAAI,UAAU,2CACb,SAAA0F,EAAAA,KAAC,MAAA,CAAI,UAAU,8CACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,MAAG,EAChC1F,EAAAA,IAAC,SAAA,CACC,UAAW,OAAOg/B,EAAe,GACjC,QAAS,IACPnS,EACE,KAAK,IACH,GACA,KAAK,OAAO9oB,EAAc,KAAQ,GAAG,EACnC,GAAA,CACJ,EAGL,SAAA,GAAA,CAAA,EAGD2B,EAAAA,KAAC,OAAA,CACC,UAAW,OAAOs5B,EAAe,8BAEhC,SAAA,CAAA,KAAK,MAAMj7B,EAAc,GAAG,EAAE,GAAA,CAAA,CAAA,EAEjC/D,EAAAA,IAAC,SAAA,CACC,UAAW,OAAOg/B,EAAe,GACjC,QAAS,IACPnS,EACE,KAAK,IACH,KACA,KAAK,OAAO9oB,EAAc,KAAQ,GAAG,EACnC,GAAA,CACJ,EAGL,SAAA,GAAA,CAAA,QAGA,OAAA,CAAK,UAAU,aAAa,SAAA,IAAC,EAC9B/D,EAAAA,IAAC,SAAA,CACC,UAAW,OAAOg/B,EAAe,GACjC,MAAM,kBACN,QAAS,IACPjS,EACE/b,IAAkB,OAAS,MAAQ,MAAA,EAItC,SAAAA,IAAkB,OAAS,OAAS,KAAA,CAAA,QAEtC,OAAA,CAAK,UAAU,aAAa,SAAA,IAAC,EAC9BhR,EAAAA,IAAC,SAAA,CACC,UAAW,OAAOg/B,EAAe,GACjC,MAAM,uBACN,QAAS,IACPlS,EACE/b,IAAiB,SACb,OACA,QAAA,EAIP,SAAAA,IAAiB,SAAW,SAAW,MAAA,CAAA,CAC1C,CAAA,CACF,CAAA,CACF,QACC,MAAA,CAAI,UAAU,WACb,SAAArL,EAAAA,KAAC,MAAA,CAAI,UAAU,kEACb,SAAA,CAAA1F,EAAAA,IAAC,MAAA,CAAI,UAAU,8FACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,MACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CACjC7G,GAAe97B,CAAK,CACtB,CAAA,CAAA,EAEJ,EAEAG,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,4FACb,SAAA,CAAA1F,EAAAA,IAAC,OAAI,UAAU,YACb,SAAA0F,EAAAA,KAAC,MAAA,CAAI,UAAU,mGACb,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,kBAE/D,QACC,MAAA,CAAI,UAAU,wCACZ,SAAAo4B,GACH,EACAp4B,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,YAE/D,QACC,MAAA,CAAI,UAAU,+BACZ,SAAAq4B,GACH,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,YAE/D,EACA/9B,EAAAA,IAAC,MAAA,CAAI,UAAU,+BACZ,aAAmB,EACtB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,aAE/D,EACA0F,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACZ,SAAA,CAAAokB,GAAW,IAAEC,EAAA,EAChB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,UAE/D,QACC,MAAA,CAAI,UAAU,yBACZ,SAAA8T,GACH,CAAA,EACF,CAAA,EACF,CAAA,CAAA,CACF,CAAA,CACF,EAEA79B,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACb,SAAAA,EAAAA,IAAC+nB,GAAA,CACC,SAAU4F,EACV,QAASgQ,GACT,WAAY,GAAG7T,EAAU,IAAIC,EAAM,EAAA,CAAA,EAEvC,CAAA,EACF,EAEA/pB,EAAAA,IAAC,MAAA,CAAI,UAAU,YACb,SAAAA,EAAAA,IAAC+nB,GAAA,CACC,SAAU4F,EACV,QAASgQ,GACT,WAAY,GAAG7T,EAAU,IAAIC,EAAM,EAAA,CAAA,EAEvC,EAEE4D,IAAyB,OACzBjoB,OAAC,MAAA,CAAI,UAAU,gHACb,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,6BAE/D,EACAA,EAAAA,KAAC,IAAA,CAAE,UAAU,6BAA6B,SAAA,CAAA,iFAEE,IACzCqlB,EAAS,GAAA,EACZ,EACArlB,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,MAAA,CAAI,UAAU,mCACZ,SAAAq3B,GACH,EACAr3B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,eAEjE,EACA1F,EAAAA,IAAC,MAAA,CAAI,UAAU,oCACb,SAAAA,EAAAA,IAACmoC,GAAA,CACC,WAAY,GACZ,cAAepd,EACf,WAAY1B,GACVC,EAAA,EAEF,aAAc,CAAC,IAAK,IAAK,IAAK,EAAE,EAChC,aAAc,IACZuZ,IAAc,WAAA,EAEhB,SAAU,IAAM,CAEhB,EACA,OAAQ,IAAM,CAEd,EACA,gBAAiB,EAAA,CAAA,EAErB,CAAA,EACF,EACAn9B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,gBAEjE,EACAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,MAAOs7B,GACP,SAAW93B,GACT+3B,GACE/3B,EAAE,OAAO,KAAA,EAGb,UAAYA,GAAM,CACZA,EAAE,MAAQ,SACZm7B,GACE,QAAA,CAEN,EACA,YAAa,GAAG7U,EAAU,EAAA,CAAA,EAE5B9pB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IACP2+B,GACE,QAAA,EAGL,SAAA,KAAA,CAAA,CAED,EACF,CAAA,EACF,CAAA,EACF,EACAj5B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,MAAA,CAAI,UAAU,mCACZ,SAAAs3B,GACH,EACAt3B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,kBAEjE,EACAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,IAAK+qB,EACL,MAAOqQ,GACP,SAAW53B,GACT63B,GACE73B,EAAE,OAAO,KAAA,EAGb,UAAYA,GAAM,CACZA,EAAE,MAAQ,SACZi7B,GAEA,CACJ,EACA,YAAa,GAAG5U,EAAO,EAAA,CAAA,EAEzB7pB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IACPy+B,GAA8B,EAEjC,SAAA,KAAA,CAAA,CAED,EACF,CAAA,EACF,EACA/4B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,gBAEjE,EACAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,MAAOw7B,GACP,SAAWh4B,GACTi4B,GACEj4B,EAAE,OAAO,KAAA,EAGb,UAAYA,GAAM,CACZA,EAAE,MAAQ,SACZm7B,GACE,IAAA,CAEN,EACA,YAAa,GAAG5U,EAAM,EAAA,CAAA,EAExB/pB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IACP2+B,GAAyB,IAAI,EAEhC,SAAA,KAAA,CAAA,CAED,EACF,CAAA,EACF,CAAA,EACF,CAAA,EACF,CAAA,EACF,CAAA,EAEJ,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CACF,CAUA,CAEJ,QAEC,MAAA,CAAI,UAAU,+HACb,SAAAj5B,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,aAAU,EACtCmlB,GACC7qB,EAAAA,IAAC,OAAA,CAAK,UAAU,gFAAgF,SAAA,UAAA,CAEhG,QAEC,OAAA,CAAK,UAAU,4EAA4E,SAAA,mBAE5F,CAAA,EAEJ,QACC,MAAA,CAAI,UAAU,yCACZ,SAAA4pB,GACH,EACA5pB,EAAAA,IAAC,MAAA,CAAI,UAAU,6DACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,2BACV,MAAO,CACL,MAAO,GAAG,KAAK,IAAI,EAAG,KAAK,IAAI,KAAM,EAAI4pB,GAAcmB,GAAY,GAAG,CAAC,CAAC,GAAA,CAC1E,CAAA,EAEJ,EACArlB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,aAC5B,UACV,OAAA,CAAK,UAAU,gBACb,SAAAskB,GACH,CAAA,EACF,EACAtkB,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,cACtB,IACZ1F,EAAAA,IAAC,QAAK,UAAU,gBACb,YAAmB,EAChBkqB,GACCE,IAAwBJ,EAAA,CAC/B,CAAA,EACF,EACAtkB,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,cACtB,IACZ1F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,SAAAo5B,GAAmB,GAEbI,GAAoBJ,GACrB,GACA,QAAQ,CAAC,EACX,MACN,CAAA,EACF,EACA1zB,EAAAA,KAAC,MAAA,CAAI,UAAU,6CACb,SAAA,CAAAA,OAAC,OAAA,CAAK,SAAA,CAAA,iBAAeyxB,EAAA,EAAkB,EACvCn3B,EAAAA,IAAC,OAAA,CACC,UAAU,iCACV,aAAW,cAEV,UAAC,EAAG,EAAG,CAAC,EAAE,IAAK+G,GACd/G,EAAAA,IAAC,OAAA,CAEC,UAAW,wBAAwB+G,EAAIuwB,GAAmB,iBAAmB,aAAa,EAAA,EADrFvwB,CAAA,CAGR,CAAA,CAAA,CACH,EACF,EACArB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,WAC9B,IACTA,EAAAA,KAAC,OAAA,CAAK,UAAU,gBAAgB,SAAA,CAAA,OACzB+kB,GAAiB,UAAQD,EAAA,EAChC,CAAA,EACF,EACCZ,IAAe,KACdA,GAAc,IACb,IAAM,CAKL,MAAMwe,EAJO7sC,GACXquB,GACAnuB,CAAA,EAEiB,CAAC,GAAK,IACzB,OACEiK,EAAAA,KAAC,MAAA,CAAI,UAAU,mHACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,WAAQ,QACpC,OAAA,CAAK,UAAU,gBAAiB,SAAA0iC,EAAM,CAAA,EACzC,CAEJ,GAAA,CAAG,EACP,EAEApoC,EAAAA,IAAC,MAAA,CAAI,UAAU,kGACb,SAAAA,EAAAA,IAACuN,GAAA,CACC,WAAW,oCACX,UAAU,6EACV,aAAc,EACd,cAAe,EACf,SAAU,IACV,UAAW,IACX,SAAU,IACV,UAAW,KACX,SAAQ,GAER,SAAAvN,EAAAA,IAACvD,GAAA,CACC,MAAM,aACN,UAAW,GACX,UAAU,iBACV,OAAO,UACP,KAAI,EAAA,CAAA,CACN,CAAA,EAEJ,EAEAiJ,EAAAA,KAAC,MAAA,CACC,UAAW,QAAQunB,KAAY,QAAU,MAAQA,KAAY,QAAU,MAAQ,KAAK,kEAAkED,KAAa,QAAU,UAAYA,KAAa,QAAU,YAAc,SAAS,GAEvO,SAAA,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,gBAEpC,GACE,IAAM,CAEN,MAAMqb,EAAiBxd,GACnBuB,GAAM,UAAY,MAClBtB,IAAO,OACL,IACA,GAAGA,CAAE,MACLwd,EAAmBzd,GACrBjB,GACAkB,IAAO,OACL,EACAjB,GACA0e,EAAmB1d,GACrByM,GAAmB,EACjBpN,GACCE,IAAwBJ,GAC3B2O,GAAe,EACbxO,GACCE,IAAoBJ,GACrBue,EAAc3d,GAChBsM,GACAoB,GACEt8B,EACJ8uB,GACCF,GACGjB,GACAkB,IAAO,OACLC,EACAlB,IACF4e,EACJD,EAAc,EAAKvsC,EAASusC,EAAe,EAAI,EAC3CtgB,EAAa,GAAG4B,EAAU,IAAIC,EAAM,GACpC2e,EACJ9d,EAAS,OAAS,EACd,GAAG,KAAK,IAAI,GAAGA,EAAS,IAAKc,GAAMA,EAAE,aAAeA,EAAE,eAAiB,EAAE,CAAC,GAAK,CAAC,SAChF,IACN,OACEhmB,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACb,SAAA,OAAC,MAAA,CAAI,UAAU,aAAa,SAAA,gBAAa,QACxC,MAAA,CAAI,UAAU,uBACZ,SAAAwiB,EACH,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,kBAE5B,QACC,MAAA,CAAI,UAAU,mCACZ,SAAAmgB,EACH,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,kBAE5B,QACC,MAAA,CAAI,UAAU,yCACZ,SAAAC,EACH,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,aAAU,QACrC,MAAA,CAAI,UAAU,uBACZ,SAAAG,EAAK,QAAQ,CAAC,EACjB,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,aAAU,QACrC,MAAA,CAAI,UAAU,uBACZ,SAAAF,EACH,QACC,MAAA,CAAI,UAAU,aAAa,SAAA,WAAQ,QACnC,MAAA,CAAI,UAAU,aAAc,SAAAG,EAAY,CAAA,EAC3C,CAEJ,GAAA,CAAG,CAAA,CAAA,EAELhjC,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAA,OAAC,OAAA,CACE,SAAA,CAAAolB,IAAO,OAAS,WAAa,GAAGA,CAAE,MAAM,SAAA,EAC3C,EACED,SAKC,OAAA,CAAK,UAAU,4EAA4E,SAAA,mBAE5F,EANA7qB,EAAAA,IAAC,OAAA,CAAK,UAAU,gFAAgF,SAAA,UAAA,CAEhG,CAIA,EAEJ,QACC,MAAA,CAAI,UAAU,yCACZ,SAAA8qB,IAAO,OAASjB,GAAU,MAC7B,EACCiB,IAAO,QACN9qB,MAAC,MAAA,CAAI,UAAU,6DACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,2BACV,MAAO,CACL,MAAO,GAAG,KAAK,IAAI,EAAG,KAAK,IAAI,KAAM,EAAI6pB,GAAUkB,GAAY,GAAG,CAAC,CAAC,GAAA,CACtE,CAAA,EAEJ,EAEFrlB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,aAC5B,UACV,OAAA,CAAK,UAAU,gBACb,SAAAolB,IAAO,OAAS,EAAIb,EAAA,CACvB,CAAA,EACF,EACAvkB,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,cACtB,IACZ1F,EAAAA,IAAC,OAAA,CAAK,UAAU,gBACb,SAAA8qB,IAAO,OACJ,IACA6N,GAAe,EACbxO,GACCE,IAAoBJ,GAC7B,CAAA,EACF,EACAvkB,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,cACtB,UACX,OAAA,CAAK,UAAU,gBACb,aAAO,OACJ4zB,GAAe,GAEVI,GAAgBJ,GACjB,GACA,QAAQ,CAAC,EACX,MACF,IACN,CAAA,EACF,EACCxO,IAAO,QACNplB,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,iBACnB6yB,EAAA,EACjB,EAEDzN,IAAO,QACNplB,OAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,WAC9B,IACTA,EAAAA,KAAC,OAAA,CAAK,UAAU,gBAAgB,SAAA,CAAA,OACzBilB,GAAa,UAAQD,EAAA,EAC5B,CAAA,EACF,CAAA,EAEJ,CAAA,CAAA,CACF,CAAA,CACF,EAGDiD,IAAiB,MAChBjoB,OAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAAioB,IAAiB,mBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,UACrB,IACR1F,MAAC,QAAK,UAAU,8DACb,YAAsB0wB,EAAO,GAAG,OAAS,GAAA,CAC5C,CAAA,EACF,EACCxf,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,WAAY,CAACloB,EAAOwG,IAAS,CAC3B,IACEA,IAAS,UACTA,IAAS,eAEGyW,GAAYjd,EAAOmrB,EAAO,EAC7B,CACP,MAAMiY,EAAK/X,GAAS,EACdgY,EAAKlY,GAAU,EACrBG,GAAU8X,CAAE,EACZhY,GAAWiY,CAAE,EACTD,GAAMpmB,GAAsB,QAC9B,WAAW,IAAM,CACfsO,GAAU,CAAC,EACXF,GAAW,CAAC,CACd,EAAG,GAAG,CACV,CAEJ,EACA,oBAAmB,GACnB,WAAYtH,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EACE,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAA,EAG9B,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASogC,GAAA,CACzB,CAAA,CAAA,EAEF5jC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS4jC,GACV,SAAA,UAAA,CAAA,CAED,EACF,EACAl+B,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,YAAY,4BACZ,MAAO86B,GACP,SAAWt3B,GAAMu3B,GAAav3B,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASqgC,GAAA,CACzB,CAAA,CAAA,EAEF7jC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS6jC,GACV,SAAA,KAAA,CAAA,CAED,EACF,CAAA,EACF,EACAn+B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,aAC3BkrB,GAAO,QAAA,EACpB,CAAA,EACF,EAEDjD,IAAiB,oBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,UACrB,UACP,OAAA,CAAK,UAAU,8DACb,SAAAid,GAAUmO,EAAQ,IAAM,GACrB,kBACAnO,GAAUmO,EAAQ,IAAM,GACtB,kBACAnO,GAAUmO,EAAQ,GAAK,IAC/B,CAAA,EACF,EACC5f,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjClC,GACEzgC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,EACA,WAAY7e,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS0iC,GAAA,CACzB,CAAA,CAAA,EAEFlmC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASkmC,GACV,SAAA,UAAA,CAAA,CAED,EACF,EACAxgC,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,YAAY,2BACZ,MAAO86B,GACP,SAAWt3B,GAAMu3B,GAAav3B,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS2iC,GAAA,CACzB,CAAA,CAAA,EAEFnmC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASmmC,GACV,SAAA,KAAA,CAAA,CAED,EACF,EACCnV,IAAWrO,GAAU,QACpBjd,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX1F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACbixB,GAAW,CAAC,EACZF,GAAY,CAAC,EACbmN,GAAe,kBAAkB,CACnC,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAEDvQ,IAAiB,WAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjC9B,GACE7gC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,EACA,WAAY7e,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS8iC,GAAA,CACzB,CAAA,CAAA,EAEFtmC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASsmC,GACV,SAAA,UAAA,CAAA,EAGDtmC,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbkxB,GAAWrO,IAAoB,EAC/B4O,GAAqB,CAAC,EACtByM,GAAe,SAAS,CAC1B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDvQ,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjC3B,GACEhhC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,EACA,WAAY7e,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASgjC,GAAA,CACzB,CAAA,CAAA,EAEFxmC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASwmC,GACV,SAAA,UAAA,CAAA,EAGDxmC,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbmxB,GAAY3N,IAAqB,EACjCiO,GAAqB,CAAC,EACtByM,GAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDvQ,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjCzB,GACElhC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,EACA,WAAY7e,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASkjC,GAAA,CACzB,CAAA,CAAA,EAEF1mC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS0mC,GACV,SAAA,UAAA,CAAA,EAGD1mC,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbqxB,GAASzN,IAAsB,EAC/B6N,GAAqB,CAAC,EACtByM,GAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDvQ,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjCvB,GACEphC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,EACA,WAAY7e,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASojC,GAAA,CACzB,CAAA,CAAA,EAEF5mC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS4mC,GACV,SAAA,UAAA,CAAA,EAGD5mC,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbuxB,GAAWvN,IAAe,EAC1ByN,GAAqB,CAAC,EACtByM,GAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDvQ,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjCpE,GACEv+B,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,EACA,WAAY7e,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS0gC,GAAA,CACzB,CAAA,CAAA,EAEFlkC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASkkC,GACV,SAAA,UAAA,CAAA,EAGDlkC,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAASmkC,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEDxW,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAaloB,GAAU6+B,GAAe7+B,CAAK,EAC3C,WAAY8jB,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZ4gC,GAAe5T,EAAgB,EAC/BC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEFzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACbokC,GAAe5T,EAAgB,EAC/BC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGDzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbqyB,GAAW,CAAC,EACZE,GAAW,CAAC,EACZE,GAAW,CAAC,EACZyL,GAAe,UAAU,CAC3B,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAx4B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/B0sB,GAAQ,IAAEM,EAAA,EACnB,CAAA,EACF,EAED/E,IAAiB,cAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAaloB,GAAU8+B,GAAiB9+B,CAAK,EAC7C,WAAY8jB,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZ6gC,GAAiB7T,EAAgB,EACjCC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEFzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACbqkC,GAAiB7T,EAAgB,EACjCC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGDzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACb4yB,GAAW,CAAC,EACZE,GAAW,CAAC,EACZE,GAAW,CAAC,EACZkL,GAAe,YAAY,CAC7B,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAx4B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BitB,GAAQ,IAAEM,EAAA,EACnB,CAAA,EACF,EAEDtF,IAAiB,aAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAaloB,GAAU++B,GAAgB/+B,CAAK,EAC5C,WAAY8jB,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZ8gC,GAAgB9T,EAAgB,EAChCC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEFzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACbskC,GAAgB9T,EAAgB,EAChCC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGDzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbmzB,GAAW,CAAC,EACZE,GAAW,CAAC,EACZE,GAAW,CAAC,EACZ2K,GAAe,WAAW,CAC5B,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAx4B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BwtB,GAAQ,IAAEM,EAAA,EACnB,CAAA,EACF,EAED7F,IAAiB,gBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,IAClB84B,GACEt/B,EACAwG,IAAS,OAAS,OAAYA,CAAA,EAGlC,WAAYsd,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,OACL,YAAY,oBACZ,MAAO86B,GACP,SAAWt3B,GAAMu3B,GAAav3B,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASuhC,GAAY,EAAI,CACzC,CAAA,CAAA,EAEF/kC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM+kC,GAAY,EAAI,EAChC,SAAA,UAAA,CAAA,EAGD/kC,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAASklC,GACV,SAAA,OAAA,CAAA,CAED,EACF,EACAx/B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,cAC1B+tB,GAAS,gBAAcI,GAAc,iBACrCE,EAAA,EACd,CAAA,EACF,EAEDpG,IAAiB,gBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,IAClB+4B,GACEv/B,EACAwG,IAAS,OAAS,OAAYA,CAAA,EAGlC,WAAYsd,GACVC,EAAA,EAEF,SAAWxtB,GACT+mC,GAAa,OAAO/mC,CAAC,CAAA,CAAA,EAG3B,EAEF4J,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,OACL,YAAY,oBACZ,MAAO86B,GACP,SAAWt3B,GAAMu3B,GAAav3B,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASuhC,GAAY,EAAK,CAC1C,CAAA,CAAA,EAEF/kC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM+kC,GAAY,EAAK,EACjC,SAAA,UAAA,CAAA,EAGD/kC,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAASmlC,GACV,SAAA,OAAA,CAAA,CAED,EACF,EACAz/B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,cAC1BuuB,GAAS,gBAAcI,GAAc,iBACrCE,EAAA,EACd,CAAA,EACF,EAED5G,IAAiB,mBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjC9C,GACE7/B,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,CAAA,CAAA,EAEJ,EAEFxiC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,OACL,YAAY,eACZ,MAAO86B,GACP,SAAWt3B,GAAMu3B,GAAav3B,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CAChB,GAAIA,EAAE,MAAQ,QAAS,CACrB,MAAMhH,EAAIkmB,GAAgBoY,EAAS,EAC/Bt+B,GAAK,MACP4oC,GAAc5oC,EAAG,OAAW,MAAS,EACvCu+B,GAAa,EAAE,CACjB,CACF,CAAA,CAAA,EAEF/6B,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACb,MAAMxD,EAAIkmB,GAAgBoY,EAAS,EAC/Bt+B,GAAK,MACP4oC,GAAc5oC,EAAG,OAAW,MAAS,EACvCu+B,GAAa,EAAE,CACjB,EACD,SAAA,UAAA,CAAA,CAED,EACF,EACAr1B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,SAC/BivB,GAAW,aAAW,IAC5B,KAAK,IAAI,EAAGE,GAAcF,EAAU,EAAE,YAAU,IAChDE,GACAE,GAAiB,EAAI,IAAIA,EAAc,GAAK,EAAA,EAC/C,EACCE,IACCvvB,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChH,IACX1F,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAASslC,GACV,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EAEJ,EAED3X,IAAiB,YAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjC3C,GACEhgC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,CAAA,CAAA,EAEJ,EAEFloC,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAASylC,GACV,SAAA,OAAA,CAAA,EAGH,CAAA,EACF,EAED9X,IAAiB,QAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjCxC,GACEngC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,CAAA,CAAA,EAEJ,EAEFloC,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS2lC,GACV,SAAA,OAAA,CAAA,EAGH,CAAA,EACF,EAEDhY,IAAiB,eAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,MAAA,CAAI,UAAU,8BACZ,SAAA,MAAM,KAAK,CAAE,OAAQ,GAAK,CAAC0b,EAAGta,IAAMA,CAAC,EAAE,IACrC+e,GACC9lB,EAAAA,IAAC,SAAA,CAEC,UAAW,0BAA0Bu1B,EAAI,MAAMzP,CAAI,EAAI,0CAA4C,qCAAqC,GACxI,QAAS,IAAM,CACb,GAAIyP,EAAI,UAAYA,EAAI,MAAMzP,CAAI,EAAG,OAGrC,MAAM+iB,EAAY,OAChB,OACE,wEAAA,GACG,CAAA,EAED98B,EACJ88B,EAAY,IAAM,EACd,SACAA,EAAY,IAAM,EAChB,SACA,SACFC,EAAQhjB,EAURC,EAAMP,GAAYsjB,CAAK,EACvBzqB,EACJ0H,EAAI,OAAS,OACT,KACAA,EAAI,KAAO,KACjB6f,GACEkD,EACAD,EACA98B,EACAsS,CAAA,CAEJ,EAEC,SAAAkX,EAAI,MAAMzP,CAAI,GAAK,EAAA,EAxCfA,CAAA,CAyCP,EAGN,EACC5U,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAGnC,CAAA,CAAA,EAEJ,EAEFloC,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS6lC,GACV,SAAA,OAAA,CAAA,EAGH,CAAA,EACF,EAEDlY,IAAiB,oBAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACG,SAAA,CAAAuL,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAEjCpC,GACEvgC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAEpB,CAAA,CAAA,EAEJ,EAEFloC,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS+lC,GACV,SAAA,OAAA,CAAA,EAGH,CAAA,EACF,EAEDpY,IAAiB,QAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,UACrB,UACP,OAAA,CAAK,UAAU,8DACb,SAAAygB,GAAkBsQ,GAAW,WAAW,CAAA,CAC3C,CAAA,EACF,EACCvlB,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CACjC,MAAM9nC,EAAI2L,IAAS,OAAS,OAAYA,EACxCkyB,GAAW,MAAM,EACjBvH,GACErQ,GAAYoQ,GAAYlxB,EAAOnF,CAAQ,CAAA,CAE3C,CAAA,CAAA,EAEJ,EAEFsF,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZy6B,GAAW,MAAM,EACjBvH,GACElQ,GACEiQ,GACAjG,EAAA,CACF,EAEFC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEFzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACbi+B,GAAW,MAAM,EACjBvH,GACElQ,GAAeiQ,GAAYjG,EAAgB,CAAA,EAE7CC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGDzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACb02B,GAAcjQ,IAAW,EACzByX,GAAe,MAAM,CACvB,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACCzH,GAAW,UACV/wB,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,kBAC3G+wB,GAAW,MAAM,SAAA,EACnC,CAAA,EAEJ,EAED9I,IAAiB,SAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,SACtB,IACPA,EAAAA,KAAC,OAAA,CAAK,UAAU,8DACb,SAAA,CAAAmxB,GAAY,MAAM,IAAEA,GAAY,MAAA,EACnC,CAAA,EACF,EACC3lB,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CACjCjK,GAAW,OAAO,EAClBnH,GACEjQ,GACEgQ,GACAtxB,CAEF,CAAA,CAEJ,CAAA,CAAA,EAEJ,EAEFG,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZy6B,GAAW,OAAO,EAClBnH,GACEhQ,GACE+P,GACArG,EAAA,CACF,EAEFC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEFzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACbi+B,GAAW,OAAO,EAClBnH,GACEhQ,GACE+P,GACArG,EAAA,CACF,EAEFC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGDzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACb82B,GAAe/P,GAAW8P,GAAY,MAAM,CAAC,EAC7CqH,GAAe,OAAO,CACxB,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAx4B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,+CACO,IAC5CmxB,GAAY,KAAA,EACf,EACCA,GAAY,UACXnxB,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChHmxB,GAAY,OAAO,MAAI,IACjCA,GAAY,MAAM,SAAA,EACrB,CAAA,EAEJ,EAEDlJ,IAAiB,UAChBjoB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,SACtB,IACPA,EAAAA,KAAC,OAAA,CAAK,UAAU,8DACb,SAAA,CAAAuxB,GAAa,MAAM,IAAEA,GAAa,MAAA,EACrC,CAAA,EACF,EACC/lB,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CACjCjK,GAAW,QAAQ,EACnB/G,GACE/P,GACE8P,GACA1xB,CAEF,CAAA,CAEJ,CAAA,CAAA,EAEJ,EAEFG,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZy6B,GAAW,QAAQ,EACnB/G,GACE9P,GACE6P,GACAzG,EAAA,CACF,EAEFC,EAAoB,CAAC,EAEzB,CAAA,CAAA,EAEFzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CACbi+B,GAAW,QAAQ,EACnB/G,GACE9P,GACE6P,GACAzG,EAAA,CACF,EAEFC,EAAoB,CAAC,CACvB,EACD,SAAA,UAAA,CAAA,EAGDzwB,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CACbk3B,GACE7P,GAAY4P,GAAa,MAAM,CAAA,EAEjCiH,GAAe,QAAQ,CACzB,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACAx4B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBAAyB,SAAA,CAAA,mCACL,IAChCuxB,GAAa,KAAA,EAChB,EACCA,GAAa,UACZvxB,OAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,aAChHuxB,GAAa,OAAO,MAAI,IAClCA,GAAa,MAAM,SAAA,EACtB,CAAA,EAEJ,EAEDtJ,IAAiB,UAChB3tB,EAAAA,IAAA2F,EAAAA,SAAA,CACG,SAACmwB,GAqFApwB,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAA1F,MAAC,OAAI,UAAU,wCACZ,SAAAkrB,EAAc,IAAKlkB,GAAM,CACxB,MAAMie,EAAKkG,GAAankB,EAAE,EAAE,EACtBqX,EAAM+M,GAAepkB,EAAE,EAAE,EAC/B,OACEtB,EAAAA,KAAC,MAAA,CAEC,UAAW,yBAAyBuf,GAAI,WAAa,6CAA+C,qCAAqC,GAEzI,SAAA,CAAAvf,EAAAA,KAAC,MAAA,CAAI,UAAU,4CACb,SAAA,CAAA1F,EAAAA,IAAC,MAAA,CAAI,UAAU,gBACZ,SAAAgH,EAAE,KACL,EACAhH,EAAAA,IAAC,MAAA,CACC,UAAW,qCAAqCilB,GAAI,SAAW,+DAAiE,gCAAgC,GAE/J,SAAAA,GAAI,SACD,SACA,YAAA,CAAA,CACN,EACF,EACAvf,EAAAA,KAAC,MAAA,CAAI,UAAU,eAAe,SAAA,CAAA,UACpB,UACP,OAAA,CAAK,UAAU,gBACb,SAAA2Y,EACH,CAAA,EACF,EACA3Y,EAAAA,KAAC,MAAA,CAAI,UAAU,UAAU,SAAA,CAAA,SAChB,UACN,OAAA,CAAK,UAAU,gBACb,SAAAuf,GAAI,OAAS,CAAA,CAChB,CAAA,EACF,CAAA,CAAA,EA1BKje,EAAE,EAAA,CA6Bb,CAAC,EACH,EACCkK,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CACjC,GAAI/R,GAAgB,OACpB,MAAM/1B,EACJ2L,IAAS,OAAS,OAAYA,EAC1ByQ,EAAS0rB,GAAM,QAAU,KACzBr/B,EAAMqiB,EAAcG,EAAa,EAClCxiB,IACL+sB,GAAiBvzB,GAAS,CACxB,MAAMgkC,EAGF,CAAA,EACJ,OAAO,KAAKhkC,CAAI,EAAE,QACf2M,GAAOq3B,EAAKr3B,CAAC,EAAI,CAAE,GAAG3M,EAAK2M,CAAC,CAAA,CAAE,EAEjC,MAAMyV,EAAMC,GACV7b,EAAI,GACJw9B,EACAjmC,EACAoc,CAAA,EAEF,GAAIiI,EAAI,aACN6R,GACE,GAAGztB,EAAI,IAAI,kBAAA,UAEN4b,EAAI,SAAU,CACrB,MAAMjoB,EAAI0uB,EAAc,KACrBlkB,GAAMA,EAAE,KAAOyd,EAAI,QAAA,EAEtB6R,GACE,GAAGztB,EAAI,IAAI,QAAQrM,GAAG,IAAI,MAAM4uB,GAAe3G,EAAI,QAAQ,CAAC,KAAKA,EAAI,YAAY,SAASA,EAAI,cAAgB,GAAK,EAAI,IAAM,EAAE,GAAA,CAEnI,SAA0B,WAAW,EAErC,MAAMskB,EAAM/jB,GAAaqhB,CAAI,EAC7B,OAAI0C,MAAuBA,CAAG,EACvB1C,CACT,CAAC,EACDnQ,GAAgBn0B,GAAM,CACpB,MAAMiiC,EAAKjiC,EAAI,EACf,GAAIiiC,GAAM,EAAG,CAEX,IAAI9uB,EAAOmW,GACX,QACMtkB,EAAI,EACRA,GAAKmkB,EAAc,OACnBnkB,IACA,CACA,MAAMuC,GACH+hB,GAAgBtkB,GACjBmkB,EAAc,OACVhe,EAAMge,EAAc5hB,CAAG,EAAE,GACzB2b,GAAKkG,GAAaje,CAAG,EAC3B,GACE+X,IACA,CAACA,GAAG,YACJA,GAAG,MAAQ,EACX,CACA/P,EAAO5L,EACP,KACF,CACF,CACA,OAAA0sB,GAAiB9gB,CAAI,EACd,CACT,CACA,OAAO8uB,CACT,CAAC,EACH,CAAA,CAAA,EAEJ,EAEFt+B,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,YAAY,mBACZ,MAAO86B,GACP,SAAWt3B,GAAMu3B,GAAav3B,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CAChB,GAAIA,EAAE,MAAQ,QAAS,CACrB,GAAI2yB,GAAgB,OAEpB,MAAMjqB,EADI4uB,GAAU,KAAA,EAAO,YAAA,EACf,MACV,wBAAA,EAEF,GAAI,CAAC5uB,EAAG,CACN6uB,GAAa,EAAE,EACf,MACF,CACA,MAAM5uB,EAAQD,EAAE,CAAC,GAAK,IAIhBmS,EAAM,SAASnS,EAAE,CAAC,EAAG,EAAE,EACvBH,EACJI,IAAS,IACL,SACAA,IAAS,IACP,SACA,SACFtD,EAAMqiB,EAAcG,EAAa,EACvCuK,GAAiBvzB,GAAS,CACxB,MAAMgkC,EAGF,CAAA,EACJ,OAAO,KAAKhkC,CAAI,EAAE,QACf2M,GAAOq3B,EAAKr3B,CAAC,EAAI,CAAE,GAAG3M,EAAK2M,CAAC,CAAA,CAAE,EAEjC,MAAMyV,EAAMC,GACV7b,EAAI,GACJw9B,EACAt6B,EACAsS,CAAA,EAEF,GAAIoG,EAAI,aACN6R,GACE,GAAGztB,EAAI,IAAI,kBAAA,UAEN4b,EAAI,SAAU,CACrB,MAAMjoB,EAAI0uB,EAAc,KACrBlkB,IAAMA,GAAE,KAAOyd,EAAI,QAAA,EAEtB6R,GACE,GAAGztB,EAAI,IAAI,QAAQrM,GAAG,IAAI,MAAM4uB,GAAe3G,EAAI,QAAQ,CAAC,KAAKA,EAAI,YAAY,SAASA,EAAI,cAAgB,GAAK,EAAI,IAAM,EAAE,GAAA,CAEnI,SAA0B,WAAW,EACrC,MAAMskB,EAAM/jB,GAAaqhB,CAAI,EAC7B,OAAI0C,MAAuBA,CAAG,EACvB1C,CACT,CAAC,EACDtL,GAAa,EAAE,EACf7E,GAAgBn0B,GAAM,CACpB,MAAMiiC,EAAKjiC,EAAI,EACf,GAAIiiC,GAAM,EAAG,CACX,IAAI9uB,EAAOmW,GACX,QACMtkB,EAAI,EACRA,GAAKmkB,EAAc,OACnBnkB,IACA,CACA,MAAMuC,GACH+hB,GAAgBtkB,GACjBmkB,EAAc,OACVhe,GAAMge,EAAc5hB,CAAG,EAAE,GACzB2b,GAAKkG,GAAaje,EAAG,EAC3B,GACE+X,IACA,CAACA,GAAG,YACJA,GAAG,MAAQ,EACX,CACA/P,EAAO5L,EACP,KACF,CACF,CACA,OAAA0sB,GAAiB9gB,CAAI,EACd,CACT,CACA,OAAO8uB,CACT,CAAC,CACH,CACF,CAAA,CAAA,EAEFhkC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS,IAAM,CAEb,IAAIkV,EAAOmW,GACX,QACMtkB,EAAI,EACRA,GAAKmkB,EAAc,OACnBnkB,IACA,CACA,MAAMuC,GACH+hB,GAAgBtkB,GACjBmkB,EAAc,OACVhe,EAAMge,EAAc5hB,CAAG,EAAE,GACzB2b,EAAKkG,GAAaje,CAAG,EAC3B,GACE+X,GACA,CAACA,EAAG,YACJA,EAAG,MAAQ,EACX,CACA/P,EAAO5L,EACP,KACF,CACF,CACA0sB,GAAiB9gB,CAAI,EACrBghB,GAAe,CAAC,CAClB,EACD,SAAA,aAAA,CAAA,EAGDl2B,EAAAA,IAAC,SAAA,CACC,UAAU,wDACV,QAAS,IAAM,CAEb41B,GAAgB,CAAA,CAAE,EAClBC,GAAkB,CAAA,CAAE,EACpBE,GAAmB,EAAK,EACxBC,GAAiB,CAAC,EAClBE,GAAe,CAAC,EAChBE,GAAkB,IAAI,EACtBE,GAAmB,EAAE,CACvB,EACD,SAAA,OAAA,CAAA,CAED,EACF,EACCH,IACCzwB,EAAAA,KAAC,MAAA,CAAI,UAAU,8GAA8G,SAAA,CAAA,UACnH,IAENwlB,EAAc,KACXlkB,GAAMA,EAAE,KAAOmvB,EAAA,GACf,KACH,IACFn2B,EAAAA,IAAC,SAAA,CACC,UAAU,iBACV,QAAS,IAAM,CACb41B,GAAgB,CAAA,CAAE,EAClBC,GAAkB,CAAA,CAAE,EACpBE,GAAmB,EAAK,EACxBC,GAAiB,CAAC,EAClBE,GAAe,CAAC,EAChBE,GAAkB,IAAI,EACtBE,GAAmB,EAAE,CACvB,EACD,SAAA,YAAA,CAAA,CAED,EACF,CAAA,CAAA,CAEJ,EAxWA5wB,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,OAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,UAAO,EACtC1F,EAAAA,IAAC,OAAI,UAAU,YACZ,WAAc,IAAI,CAACgH,EAAGsC,IACrB5D,EAAAA,KAAC,MAAA,CAEC,UAAU,0BAEV,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,QACV,MAAOgH,EAAE,KACT,SAAWxD,GAAM,CACf,MAAMxH,EAAOwH,EAAE,OAAO,MACtBmyB,GAAkBpc,GAChBA,EAAK,IAAI,CAACyvB,EAAIjiC,IACZA,IAAMuC,EAAM,CAAE,GAAG0/B,EAAI,KAAAhtC,GAASgtC,CAAA,CAChC,CAEJ,CAAA,CAAA,EAEFhpC,EAAAA,IAAC,SAAA,CACC,UAAU,gBACV,QAAS,IACP21B,GAAkBpc,GAChBA,EAAK,OAAO,CAAC8H,EAAGta,IAAMA,IAAMuC,CAAG,CAAA,EAGnC,SAAU4hB,EAAc,QAAU,EACnC,SAAA,QAAA,CAAA,CAED,CAAA,EAzBKlkB,EAAE,EAAA,CA2BV,EACH,EACAtB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,SAAA,CACC,UAAU,gBACV,QAAS,IACP21B,GAAkBpc,GAAS,CACzB,MAAMK,EAAK,IAAIL,EAAK,OAAS,CAAC,GAC9B,MAAO,CACL,GAAGA,EACH,CACE,GAAAK,EACA,KAAM,UAAUL,EAAK,OAAS,CAAC,EAAA,CACjC,CAEJ,CAAC,EAEJ,SAAA,YAAA,CAAA,EAGDvZ,EAAAA,IAAC,SAAA,CACC,UAAU,oDACV,QAAS,IAAM,CACb,GAAIkrB,EAAc,OAAS,EAAG,CAC5B,MAAM,yBAAyB,EAC/B,MACF,CACA,MAAM+d,EAAM/d,EAAc,IAAKlkB,GAAMA,EAAE,EAAE,EACnCod,EAAWE,GAAoB2kB,CAAG,EAClCC,EAGF,CAAA,EACJD,EAAI,QAASrvB,GAAO,CAClBsvB,EAAWtvB,CAAE,EAAIuK,GACfC,EAASxK,CAAE,CAAA,CAEf,CAAC,EACDic,GAAkBzR,CAAQ,EAC1BwR,GAAgBsT,CAAU,EAC1BlT,GAAiB,CAAC,EAClBE,GAAe,CAAC,EAChBE,GAAkB,IAAI,EACtBE,GAAmB,kBAAkB,EACrCP,GAAmB,EAAI,CACzB,EACD,SAAA,wBAAA,CAAA,CAED,EACF,CAAA,CAAA,CACF,CAsRA,CAEJ,CAAA,CAAA,CAEJ,EAEArwB,EAAAA,KAAC,MAAA,CAAI,UAAU,YAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,wCAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,8EACb,SAAA,OAAC,MAAA,CAAI,UAAU,mCAAmC,SAAA,aAElD,EAEA1F,EAAAA,IAAC,MAAA,CAAI,UAAU,gBACb,SAAAA,EAAAA,IAAC+nB,GAAA,CACC,SAAU4F,EACV,QAASsP,GACT,WAAY,GAAGnT,EAAU,IAAIC,EAAM,EAAA,CAAA,EAEvC,EAGCc,IACCnlB,EAAAA,KAAC,MAAA,CAAI,UAAU,iHACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,OAAC,KAAA,CAAG,UAAU,gEAAgE,SAAA,iBAE9E,QACC,OAAA,CAAK,UAAU,wBAAwB,SAAA,iDAExC,CAAA,EACF,EACAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,cAEjE,EACA1F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EACE,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAA,EAG9B,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZA,EAAE,SACEyjC,GAAA,EACA7E,GAAA,EACR,EACA,YAAY,IAAA,CAAA,EAEdpiC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASoiC,GACV,SAAA,UAAA,CAAA,CAED,EACF,EAEA18B,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,kBAEjE,EACA1F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,KAAK,SACL,IAAK,EACL,IAAK4pB,IAAe,IAAM,IAAM,IAChC,MAAOkZ,GACP,SAAWt/B,GACTw/B,GAAuBx/B,EAAE,OAAO,KAAK,EAEvC,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS4/B,GAAA,CACzB,EACA,YAAY,KAAA,CAAA,EAEdpjC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASojC,GACV,SAAA,cAAA,CAAA,EAGDpjC,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAASinC,GACV,SAAA,YAAA,CAAA,CAED,EACF,EAEAvhC,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,SAEjE,EACA1F,EAAAA,IAAC,QAAA,CACC,UAAU,qIACV,MAAO86B,GACP,SAAWt3B,GACTu3B,GAAav3B,EAAE,OAAO,KAAK,EAE7B,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZA,EAAE,SACE0jC,GAAA,EACAJ,GAAA,EACR,EACA,YAAY,KAAA,CAAA,EAEd9mC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS8mC,GACV,SAAA,OAAA,CAAA,EAGD9mC,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAASknC,GACT,SAAU5P,KAAqB,EAChC,SAAA,cAAA,CAAA,CAED,EACF,SAEC,MAAA,CACC,SAAA,OAAC,QAAA,CAAM,UAAU,gDAAgD,SAAA,6BAEjE,EACAt3B,EAAAA,IAAC,WAAA,CACC,UAAU,sMACV,KAAM,EACN,MAAOg7B,GACP,SAAWx3B,GACTy3B,GAAkBz3B,EAAE,OAAO,KAAK,EAElC,YAAa;AAAA;AAAA,GAAA,CAAA,EAEfkC,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAA1F,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS+mC,GACV,SAAA,WAAA,CAAA,EAGD/mC,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAAS,IAAMi7B,GAAkB,EAAE,EACpC,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,EAEAj7B,EAAAA,IAAC,MAAA,CAAI,UAAU,qCACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,sDACV,QAASsjC,GACT,SACEhM,KAAqB,GACrBpN,KAAmB,EAEtB,SAAA,qBAAA,CAAA,EAGH,CAAA,EACF,CAAA,EACF,CAAA,EAEJ,EAGChZ,GACClR,EAAAA,IAAC,MAAA,CAAI,UAAU,kEACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,IAAS,CAC3B,MAAMo9B,EAAYp9B,GAAQ,OACpBq9B,EAAY,OAAO,SAAS7jC,CAAK,EACnC,KAAK,IAAI,EAAGA,CAAK,EACjB,EACE8H,EAAM,KAAK,IAAA,EACjB,GAAI+7B,GAAa,EAAG,CAElB,GADID,IAAc,QAEhB97B,GAAOyqB,GAAoB,SAAW,GACtC,KAEA,OAEFA,GAAoB,QAAUzqB,CAChC,MACEyqB,GAAoB,QAAU,EAEhCuJ,GAAe+H,CAAS,CAC1B,CAAA,CAAA,EAEJ,CAAA,EAEJ,EAEEzb,IAAyB,OAAS,CAACzc,GACnClR,EAAAA,IAAA2F,EAAAA,SAAA,CACE,SAAA3F,EAAAA,IAAC+nB,GAAA,CACC,SAAU4F,EACV,QAASsP,GACT,WAAY,GAAGnT,EAAU,IAAIC,EAAM,EAAA,CAAA,EAEvC,EAEA4D,IAAyB,WACzB3tB,EAAAA,IAAA2F,EAAAA,SAAA,CACE,SAAA3F,EAAAA,IAAC+nB,GAAA,CACC,SAAS,UACT,QAASmV,EAAA,CAAA,EAEb,EAGAvP,IAAyB,WAAazc,GACtClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAC7B3iC,EAAQ,GAEV6gC,GACE7gC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAGtB,CAAA,CAAA,EAEJ,EAEAva,IAAyB,YACzB3tB,EAAAA,IAAA2F,EAAAA,SAAA,CACE,SAAA3F,EAAAA,IAAC+nB,GAAA,CACC,SAAS,WACT,QAASoV,EAAA,CAAA,EAEb,EAGAxP,IAAyB,YACzBzc,GACElR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAC7B3iC,EAAQ,GAEVghC,GACEhhC,EAFQwG,IAAS,OAAS,OAAYA,EAItCm8B,GAAM,QAAU,IAAA,CAGtB,CAAA,CAAA,EAEJ,EAEFva,IAAyB,UACzB3tB,EAAAA,IAAA2F,EAAAA,SAAA,CACE,SAAA3F,EAAAA,IAAC+nB,GAAA,CACC,SAAS,SACT,QAASqV,EAAA,CAAA,EAEb,EAEAzP,IAAyB,QACzB3tB,EAAAA,IAAA2F,EAAAA,SAAA,CACE,SAAA3F,EAAAA,IAAC+nB,IAAe,SAAS,OAAO,QAASsV,EAAA,CAAW,EACtD,EAGA1P,IAAyB,QAAUzc,GACnClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAC7B3iC,EAAQ,GACVmxB,GACErQ,GAAYoQ,GAAYlxB,EAAOwG,CAAW,CAAA,CAGhD,CAAA,CAAA,EAEJ,EAEA4hB,IAAyB,SACzB3tB,EAAAA,IAAA2F,EAAAA,SAAA,CACE,SAAA3F,EAAAA,IAAC+nB,GAAA,CACC,SAAS,QACT,QAASuV,EAAA,CAAA,EAEb,EAGA3P,IAAyB,SAAWzc,GACpClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAC7B3iC,EAAQ,GACVuxB,GACEjQ,GAAagQ,GAAatxB,CAAkB,CAAA,CAGlD,CAAA,CAAA,EAEJ,EAEAooB,IAAyB,UACzB3tB,EAAAA,IAAA2F,EAAAA,SAAA,CACE,SAAA3F,EAAAA,IAAC+nB,GAAA,CACC,SAAS,SACT,QAASwV,EAAA,CAAA,EAEb,EAGA5P,IAAyB,UAAYzc,GACrClR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACb,SAAAA,EAAAA,IAACkQ,GAAA,CACC,YAAY,SACZ,YAAaud,EACb,oBAAmB,GACnB,WAAY,CAACloB,EAAOwG,EAAMm8B,IAAS,CAC7B3iC,EAAQ,GACV2xB,GACE/P,GACE8P,GACA1xB,CAEF,CAAA,CAGN,CAAA,CAAA,EAEJ,QAED,MAAA,CAAI,UAAU,gBAAgB,SAAA,YAAS,EACxCG,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK,GACL,MAAOwwB,GACP,SAAWhtB,GACTitB,EAAoB,OAAOjtB,EAAE,OAAO,OAAS,CAAC,CAAC,EAEjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZA,EAAE,SAAWyjC,GAAA,EAAgB7E,GAAA,EACjC,CAAA,CAAA,EAEFpiC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASoiC,GACT,MAAM,2BACP,SAAA,UAAA,CAAA,CAED,EACF,EAEA18B,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,KAAK,SACL,IAAK,EACL,IAAK4pB,IAAe,IAAM,IAAM,IAChC,YAAY,sBACZ,MAAOkZ,GACP,SAAWt/B,GACTw/B,GAAuBx/B,EAAE,OAAO,KAAK,EAEvC,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS4/B,GAAA,CACzB,CAAA,CAAA,EAEFpjC,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAASojC,GACT,MAAM,qCACP,SAAA,cAAA,CAAA,CAED,EACF,EACA19B,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAA1F,EAAAA,IAAC,QAAA,CACC,UAAU,aACV,YAAY,+BACZ,MAAO86B,GACP,SAAWt3B,GAAMu3B,GAAav3B,EAAE,OAAO,KAAK,EAC5C,UAAYA,GAAM,CACZA,EAAE,MAAQ,UACZA,EAAE,SAAW0jC,GAAA,EAAsBJ,GAAA,EACvC,CAAA,CAAA,EAEF9mC,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAASknC,GACT,SAAU5P,KAAqB,EAChC,SAAA,cAAA,CAAA,EAGDt3B,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS8mC,GACV,SAAA,KAAA,CAAA,CAED,EACF,SACC,MAAA,CACC,SAAA,CAAA9mC,EAAAA,IAAC,WAAA,CACC,UAAU,gCACV,YAAY;AAAA;AAAA;AAAA;AAAA,yBACZ,MAAOg7B,GACP,SAAWx3B,GAAMy3B,GAAkBz3B,EAAE,OAAO,KAAK,CAAA,CAAA,EAEnDkC,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAA1F,EAAAA,IAAC,SAAA,CACC,UAAU,wBACV,QAAS+mC,GACV,SAAA,gBAAA,CAAA,EAGD/mC,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAAS,IAAMi7B,GAAkB,EAAE,EACpC,SAAA,OAAA,CAAA,CAED,EACF,CAAA,EACF,CAAA,EACF,QACC,MAAA,CAAI,UAAU,yBAAyB,SAAA,kDAExC,CAAA,EACF,EAEFj7B,EAAAA,IAAC,MAAA,CAAI,UAAU,MAAM,CAAA,CAAA,CAAA,CACvB,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EAGH+tB,UAAc9B,GAAA,CAAc,QAAS,IAAM+B,GAAa,EAAK,EAAG,EAEhE0Z,IACChiC,EAAAA,KAAC,MAAA,CAAI,UAAU,yDACb,SAAA,CAAA1F,EAAAA,IAAC,MAAA,CAAI,UAAU,oDAAoD,EACnE0F,EAAAA,KAAC,MAAA,CAAI,UAAU,+EACb,SAAA,OAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,KAAE,QAChC,MAAA,CAAI,UAAU,gBAAgB,SAAA,sBAAmB,QACjD,MAAA,CAAI,UAAU,4BAA4B,SAAA,6EAG3C,EACAA,EAAAA,KAAC,SAAA,CACC,QAAS,SAAY,CACnB,GAAI,CASF,MAAMpC,EAAO,MARD,MAAM,MAChB,GAAG4oB,EAAO,sCACV,CACE,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,MAAOE,GAAM,MAAO,CAAA,CAC7C,GAEqB,KAAA,EACnB9oB,EAAK,IAAMA,EAAK,KAClB,OAAO,SAAS,KAAOA,EAAK,IACxBA,EAAK,aACPmsB,GACE,iDACA,CAAE,KAAM,OAAQ,QAAS,GAAA,CAAK,GAGzBnsB,EAAK,QAAU,wBACxBmsB,GACE,oHACA,CAAE,KAAM,QAAS,QAAS,GAAA,CAAK,EAGjCA,GACE,uDACA,CAAE,KAAM,QAAS,QAAS,GAAA,CAAK,CAGrC,MAAc,CACZA,GAAM,6CAA8C,CAClD,KAAM,QACN,QAAS,GAAA,CACV,CACH,CACF,EACA,UAAU,gFACX,SAAA,CAAA,uBACsB,IACpB4Z,GAAsBC,GAAA,EAAmB,CAAC,CAAA,CAAA,CAAA,CAC7C,EACF,CAAA,EACF,EAED1N,IAAqB,OAAO,SAAa,IACtC2N,GAAAA,aACEvpC,EAAAA,IAAC,MAAA,CACC,UAAU,yEACV,QAAS,IAAMuwB,GAAqB,EAAK,EAEzC,SAAAvwB,EAAAA,IAACohB,GAAA,CACC,WAAW,mCACX,UAAU,WACV,aAAc,IACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,KACV,UAAW,IACX,iBAAgB,GAChB,QAAS,IAAMmP,GAAqB,EAAK,EAEzC,SAAA7qB,EAAAA,KAAC,MAAA,CACC,UAAU,YACV,QAAUlC,GAAMA,EAAE,gBAAA,EAElB,SAAA,CAAAkC,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,iBAE/D,QACC,MAAA,CAAI,UAAU,wCAAwC,SAAA,8BAEvD,CAAA,EACF,EACA1F,EAAAA,IAAC,SAAA,CACC,UAAU,iDACV,QAAS,IAAMuwB,GAAqB,EAAK,EAC1C,SAAA,OAAA,CAAA,CAED,EACF,EACAvwB,EAAAA,IAACvD,GAAA,CACC,KAAI,GACJ,KAAA2vB,EACA,YAAAxC,GACA,QAAAC,GACA,SAAAkB,EACA,QAAAkD,GACA,aAAAM,GACA,iBAAAS,EACA,kBAAAmI,GACA,cAAAoB,GACA,iBAAAa,GACA,aAAAE,GACA,kBAAAE,GACA,cAAAE,GACA,WAAAE,GACA,WAAAE,GACA,WAAAE,GACA,OAAAE,GACA,OAAAE,GACA,OAAAE,GACA,sBAAAE,GACA,kBAAAE,GACA,QAAS,IAAMnK,GAAqB,EAAK,EACzC,OAAQ,IAAMA,GAAqB,EAAI,EACvC,OAAQlE,CAAA,CAAA,CACV,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EAEF,SAAS,IAAA,EAEX,KACHqP,IAAsB,OAAO,SAAa,IACvC6N,GAAAA,cACG,IAAM,CACL,KAAM,CAAE,OAAA5tC,EAAQ,MAAA4J,EAAO,MAAAikC,CAAA,EAAU9N,GAC3B+N,EACJ9tC,IAAW,SAAWohC,GAAYC,GAC9B0M,EAAc/tC,IAAW,SAAWmuB,GAAaC,GACvD,OACE/pB,EAAAA,IAAC,MAAA,CACC,UAAU,yEACV,QAAS6+B,GAET,SAAA7+B,EAAAA,IAACohB,GAAA,CACC,WAAW,iCACX,UAAU,WACV,aAAc,IACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,IACV,UAAW,IACX,iBAAgB,GAChB,QAASyd,GAET,SAAAn5B,EAAAA,KAAC,MAAA,CACC,UAAU,kCACV,QAAUlC,GAAMA,EAAE,gBAAA,EAElB,SAAA,CAAAkC,OAAC,MAAA,CACC,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gDAAgD,SAAA,CAAA,QACvD8jC,EAAM,OAAA,EACd,QACC,MAAA,CAAI,UAAU,wCAAwC,SAAA,iBAEvD,CAAA,EACF,QACC,MAAA,CAAI,UAAU,yCACZ,SAAAA,IAAU,EACT9jC,EAAAA,KAAAC,EAAAA,SAAA,CAAE,SAAA,CAAA,OACK8jC,EAAW,aAAgB,UAC/B,OAAA,CAAK,UAAU,2BACb,SAAAlkC,EACH,EAAO,wBAAA,EAET,EAEAG,EAAAA,KAAAC,EAAAA,SAAA,CAAE,SAAA,CAAA,2BACyB8jC,EAAW,aACjC,UACF,OAAA,CAAK,UAAU,2BACb,SAAAlkC,EACH,EAAO,WACE,UACR,OAAA,CAAK,UAAU,iCAAiC,SAAA,MAEjD,EAAQ,IAAI,uBAAA,CAAA,CAEd,CAAA,CAEJ,EACAG,EAAAA,KAAC,MAAA,CAAI,UAAU,4DACb,SAAA,OAAC,MAAA,CAAI,UAAU,qDAAqD,SAAA,eAEpE,QACC,MAAA,CAAI,UAAU,qCACZ,SAAAgkC,EACH,CAAA,EACF,EACAhkC,EAAAA,KAAC,MAAA,CAAI,UAAU,2CACb,SAAA,CAAA1F,EAAAA,IAAC,SAAA,CACC,UAAU,+CACV,QAAS6+B,GACV,SAAA,IAAA,CAAA,EAGD7+B,EAAAA,IAAC,SAAA,CACC,UAAU,qDACV,QAAS4+B,GACV,SAAA,KAAA,CAAA,CAED,EACF,CAAA,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAGN,GAAA,EACA,SAAS,IAAA,EAEX,KACHrQ,IACCvuB,EAAAA,IAAC,MAAA,CAAI,UAAU,6EACb,SAAA0F,EAAAA,KAAC0b,GAAA,CACC,WAAW,wBACX,UAAU,kBACV,aAAc,IACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,IACV,UAAW,IACX,iBAAgB,GAEhB,SAAA,OAAC,KAAA,CAAG,UAAU,yBAAyB,SAAA,WAAQ,QAC9C,QAAA,CAAM,UAAU,aAAa,SAAA,uBAAoB,EAClDphB,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACZ,SAAA,CAAC,EAAG,EAAG,CAAC,EAAE,IAAK8G,GACd9G,EAAAA,IAAC,SAAA,CAEC,UAAW,OAAOkvB,IAAgBpoB,EAAI,eAAiB,EAAE,GACzD,QAAS,IAAMqoB,EAAeroB,CAAC,EAE9B,SAAAA,CAAA,EAJIA,CAAA,CAMR,EACH,QACC,QAAA,CAAM,UAAU,aAAa,SAAA,sBAAmB,EACjD9G,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACZ,SAAA,CAAC,EAAG,EAAG,CAAC,EAAE,IAAK8G,GACd9G,EAAAA,IAAC,SAAA,CAEC,UAAW,OAAOovB,IAAkBtoB,EAAI,eAAiB,EAAE,GAC3D,QAAS,IAAMuoB,GAAiBvoB,CAAC,EAEhC,SAAAA,CAAA,EAJIA,CAAA,CAMR,EACH,EACApB,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAA1F,MAAC,SAAA,CAAO,UAAU,aAAa,QAASonC,GAAsB,SAAA,SAE9D,EACApnC,EAAAA,IAAC,SAAA,CACC,UAAU,iDACV,QAAS,IAAM,CACbwuB,GAAgB,EAAK,EACrBkS,GAAA,CACF,EACD,SAAA,SAAA,CAAA,EAGD1gC,EAAAA,IAAC,SAAA,CACC,UAAU,6CACV,QAAS,IAAM,CACbwuB,GAAgB,EAAK,EACrBoB,GAAkB,EAAK,EACvB1B,GAAW,EAAK,CAClB,EACD,SAAA,cAAA,CAAA,CAED,EACF,CAAA,CAAA,CAAA,EAEJ,EAED0M,IACC56B,EAAAA,IAAC,MAAA,CAAI,UAAU,oEACb,SAAA0F,EAAAA,KAAC0b,GAAA,CACC,WAAW,4BACX,UAAU,kBACV,aAAc,IACd,cAAe,IACf,SAAU,IACV,UAAW,IACX,SAAU,KACV,UAAW,IACX,iBAAgB,GAEhB,SAAA,OAAC,KAAA,CAAG,UAAU,8BAA8B,SAAA,gBAAa,EACzD1b,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAAioB,EAAa,MAAI5C,EAAS,qBAAmB0D,EAAA,EAChD,GACE,IAAM,CACN,MAAMkb,EACJvQ,GAAmB,EACdI,GAAoBJ,GAAoB,EACzC,EACAwQ,EAAYD,EAAY,EACxBE,GAAc,IAAM,CACxB,MAAM9yB,EAAQ6T,EACX,OACEc,GACCA,EAAE,SAAW,UACb,OAAOA,EAAE,aAAgB,QAAA,EAE5B,IAAKA,GAAMA,EAAE,WAAW,EAC3B,OAAK3U,EAAM,OACJ,GAAG,KAAK,IAAI,GAAGA,CAAK,CAAC,SADF,GAE5B,GAAA,EACM+yB,GAAe,IAAM,CACzB,MAAM/yB,EAAQ6T,EACX,OACEc,GACCA,EAAE,SAAW,UACb,OAAOA,EAAE,aAAgB,QAAA,EAE5B,IAAKA,GAAMA,EAAE,WAAW,EAC3B,OAAK3U,EAAM,OACJ,GAAG,KAAK,IAAI,GAAGA,CAAK,CAAC,SADF,GAE5B,GAAA,EACMgzB,EACJtf,GAAmB,EACf,KAAK,MAAOD,GAAmBC,GAAoB,GAAG,EACtD,EAEAuf,EACJ1Q,GAAe,EAAKI,GAAgBJ,GAAgB,EAAI,EACpD2Q,EAAQD,EAAQ,EAChBE,GAAU,IAAM,CACpB,MAAMnzB,EAAQ6T,EACX,OACEc,GACCA,EAAE,SAAW,MAAQ,OAAOA,EAAE,aAAgB,QAAA,EAEjD,IAAKA,GAAMA,EAAE,WAAW,EAC3B,OAAK3U,EAAM,OACJ,GAAG,KAAK,IAAI,GAAGA,CAAK,CAAC,SADF,GAE5B,GAAA,EACMozB,GAAW,IAAM,CACrB,MAAMpzB,EAAQ6T,EACX,OACEc,GACCA,EAAE,SAAW,MAAQ,OAAOA,EAAE,aAAgB,QAAA,EAEjD,IAAKA,GAAMA,EAAE,WAAW,EAC3B,OAAK3U,EAAM,OACJ,GAAG,KAAK,IAAI,GAAGA,CAAK,CAAC,SADF,GAE5B,GAAA,EACMqzB,EACJzf,GAAe,EACX,KAAK,MAAOD,GAAeC,GAAgB,GAAG,EAC9C,EAEN,OACEjlB,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,+CACb,SAAA,CAAA1F,MAAC,MAAA,CAAI,UAAU,6BACZ,SAAAosB,GAAM,UAAY,MACrB,QACC,MAAA,CAAI,UAAU,0BACZ,SAAAtC,GACH,QACC,MAAA,CAAI,UAAU,qBAAqB,SAAA,WAAQ,EAC5CpkB,EAAAA,KAAC,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBACZ,SAAAikC,EAAU,QAAQ,CAAC,CAAA,CACtB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBACZ,SAAAC,EAAU,QAAQ,CAAC,CAAA,CACtB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,kBAAe,QAC3C,MAAA,CAAI,UAAU,gBACZ,SAAAnf,GACH,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,WAAQ,EACrC/kB,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAiB,SAAA,CAAAqkC,EAAU,GAAA,EAAC,CAAA,EAC7C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,gBAAa,QACzC,MAAA,CAAI,UAAU,gBAAiB,SAAAF,EAAW,CAAA,EAC7C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,iBAAc,QAC1C,MAAA,CAAI,UAAU,gBAAiB,SAAAC,EAAY,CAAA,EAC9C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBAAiB,SAAAlQ,GAAW,CAAA,EAC7C,CAAA,EACF,CAAA,EACF,QACC,MAAA,CAAI,UAAU,6CACb,SAAAl0B,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACZ,SAAA,CAAAokB,GAAW,MAAIC,EAAA,CAAA,CAClB,CAAA,CACF,EACArkB,EAAAA,KAAC,MAAA,CAAI,UAAU,+CACb,SAAA,CAAA1F,EAAAA,IAAC,MAAA,CAAI,UAAU,6BACZ,SAAA8qB,IAAO,OAAS,WAAa,GAAGA,CAAE,KAAA,CACrC,QACC,MAAA,CAAI,UAAU,0BAA2B,SAAAf,GAAO,QAChD,MAAA,CAAI,UAAU,qBAAqB,SAAA,WAAQ,EAC5CrkB,EAAAA,KAAC,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBACZ,SAAAskC,EAAM,QAAQ,CAAC,CAAA,CAClB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBACZ,SAAAC,EAAM,QAAQ,CAAC,CAAA,CAClB,CAAA,EACF,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,kBAAe,QAC3C,MAAA,CAAI,UAAU,gBAAiB,SAAAtf,GAAa,CAAA,EAC/C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,WAAQ,EACrCjlB,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAAiB,SAAA,CAAA0kC,EAAM,GAAA,EAAC,CAAA,EACzC,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,gBAAa,QACzC,MAAA,CAAI,UAAU,gBAAiB,SAAAF,EAAO,CAAA,EACzC,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,iBAAc,QAC1C,MAAA,CAAI,UAAU,gBAAiB,SAAAC,EAAQ,CAAA,EAC1C,SACC,MAAA,CACC,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,YAAS,QACrC,MAAA,CAAI,UAAU,gBAAiB,SAAAjQ,GAAO,CAAA,EACzC,CAAA,EACF,CAAA,EACF,CAAA,EACF,CAEJ,GAAA,EACAx0B,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,gBAAa,EACzD1F,EAAAA,IAAC,OAAI,UAAU,uBACZ,WAAS,IAAI,CAACyZ,EAAK1S,IAClBrB,EAAAA,KAAC,MAAA,CAEC,UAAW,yCAAyC+T,EAAI,SAAW,SAAW,0CAA4C,yCAAyC,GACpK,SAAA,CAAA,OACM1S,EAAI,EAAE,IAAE,IACZ0S,EAAI,SAAW,SACZ,MACAqR,IAAO,OACL,MACA,KAAM,IAAI,SACTrR,EAAI,YAAY,SAAOA,EAAI,aAAA,CAAA,EAT7B1S,CAAA,CAWR,EACH,CAAA,EACF,EACArB,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,gBAAa,QACxD,MAAA,CAAI,UAAU,2CAEb,SAAA1F,EAAAA,IAAC4hB,KAAQ,CAAA,CACX,CAAA,EACF,EACAlc,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAA1F,EAAAA,IAAC,SAAA,CACC,UAAU,sCACV,QAAS,IAAM66B,GAAoB,EAAK,EACzC,SAAA,OAAA,CAAA,EAGD76B,EAAAA,IAAC,SAAA,CACC,UAAU,0CACV,QAAS,IAAM,CACb66B,GAAoB,EAAK,EACzB6F,GAAA,CACF,EACD,SAAA,SAAA,CAAA,CAED,EACF,CAAA,CAAA,CAAA,EAEJ,EAED9V,EAAS,OAAS,GACjBllB,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,KAAA,CAAG,UAAU,qBAAqB,SAAA,YAAS,EAC5C1F,EAAAA,IAAC,MACE,SAAA4qB,EAAS,IAAI,CAACnR,EAAK1S,WACjB,KAAA,CAAW,SAAA,CAAA,OACLA,EAAI,EAAE,mBAAiB0S,EAAI,YAAY,oBAAkB,IAC7DA,EAAI,aAAA,CAAA,EAFE1S,CAGT,CACD,EACH,CAAA,EACF,CAAA,EAIJ,CAAA,EACF,CAEJ"}
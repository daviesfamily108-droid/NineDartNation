{"version":3,"file":"OnlinePlay.clean-BOKMzy6V.js","sources":["../../src/components/ui/CreateMatchModal.tsx","../../src/components/OnlinePlay.clean.tsx"],"sourcesContent":["import React, { useLayoutEffect, useState, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport {\n  allGames,\n  type GameKey,\n  getStartOptionsForGame,\n} from \"../../utils/games\";\nimport { useUserSettings } from \"../../store/userSettings\";\n\ntype Props = {\n  open: boolean;\n  onClose: () => void;\n  onCreate: (payload: any) => void;\n};\n\nexport default function CreateMatchModal({ open, onClose, onCreate }: Props) {\n  const [portalEl] = useState(() => document.createElement(\"div\"));\n  const [game, setGame] = useState<GameKey>(\"X01\");\n  const [modeType, setModeType] = useState<\"bestof\" | \"firstto\">(\"bestof\");\n  const [legs, setLegs] = useState<number>(3);\n  const legsRef = useRef<HTMLInputElement | null>(null);\n  const [avgChoice, setAvgChoice] = useState<number>(0);\n  const [startingScore, setStartingScore] = useState<number | undefined>(() => {\n    const opts = getStartOptionsForGame(game);\n    return opts?.[0];\n  });\n  const user = (useUserSettings() as any).username || \"Anonymous\";\n\n  useLayoutEffect(() => {\n    portalEl.className = \"ndn-create-match-portal\";\n    document.body.appendChild(portalEl);\n    return () => {\n      try {\n        portalEl && portalEl.remove();\n      } catch {}\n    };\n  }, [portalEl]);\n\n  // Close modal on Escape key\n  useLayoutEffect(() => {\n    function onKey(e: KeyboardEvent) {\n      if (e.key === \"Escape\") onClose();\n    }\n    if (open) document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [open, onClose]);\n\n  const handleCreate = () => {\n    const payload = {\n      createdBy: user,\n      game,\n      modeType,\n      legs,\n      avgChoice,\n      startingScore,\n    };\n    onCreate(payload);\n    onClose();\n  };\n\n  if (!open) return null;\n\n  if (!portalEl) return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4\">\n      {/* A dedicated, accessible button covers the backdrop to capture clicks and keyboard input */}\n      <button\n        aria-label=\"Close dialog\"\n        className=\"absolute inset-0 w-full h-full bg-transparent\"\n        onClick={onClose}\n      />\n      <div\n        className=\"card rounded-xl p-6 max-w-lg w-full relative text-white\"\n        role=\"dialog\"\n      >\n        <button\n          aria-label=\"Close\"\n          className=\"absolute top-3 right-3 text-rose-400 font-bold\"\n          onClick={onClose}\n        >\n          ‚úï\n        </button>\n        <h2 className=\"text-lg font-semibold mb-3\">Create Match üéØ</h2>\n        <div className=\"grid grid-cols-1 gap-3\">\n          <div>\n            <div className=\"text-sm opacity-80\">Created By üéØ</div>\n            <div className=\"mt-1 p-2 bg-white/5 rounded text-white\">\n              {user} üéØ\n            </div>\n          </div>\n          <div>\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-game\">\n              Match Name (Game) üéØ\n            </label>\n            <select\n              id=\"match-game\"\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\n              value={game}\n              onChange={(e) => {\n                const v = e.target.value as GameKey;\n                setGame(v);\n                const opts = getStartOptionsForGame(v);\n                setStartingScore(opts?.[0]);\n              }}\n              onPointerDown={(e) => {\n                (e as any).stopPropagation();\n              }}\n              onMouseDown={(e) => {\n                e.stopPropagation();\n              }}\n              onTouchStart={(e) => {\n                (e as any).stopPropagation?.();\n              }}\n            >\n              {allGames.map((g) => (\n                <option key={g} value={g}>\n                  {g}\n                </option>\n              ))}\n            </select>\n          </div>\n          {getStartOptionsForGame(game).length > 0 ? (\n            <div>\n              <label className=\"text-sm opacity-80\" htmlFor=\"match-start\">\n                {`${game} Starting Score üéØ`}\n              </label>\n              <select\n                id=\"match-start\"\n                className=\"ml-2 p-2 border border-white/10 bg-white/5 rounded text-white w-full\"\n                value={startingScore}\n                onChange={(e) => setStartingScore(Number(e.target.value))}\n                onPointerDown={(e) => {\n                  (e as any).stopPropagation();\n                }}\n                onMouseDown={(e) => {\n                  e.stopPropagation();\n                }}\n                onTouchStart={(e) => {\n                  (e as any).stopPropagation?.();\n                }}\n              >\n                {getStartOptionsForGame(game).map((opt) => (\n                  <option key={opt} value={opt}>\n                    {opt}\n                  </option>\n                ))}\n              </select>\n            </div>\n          ) : null}\n          <div>\n            <div className=\"text-sm opacity-80\">Mode üéØ</div>\n            <div className=\"flex gap-2 mt-1 justify-center\">\n              <label\n                className={`btn ${modeType === \"bestof\" ? \"btn-primary\" : \"btn-ghost\"}`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"mode\"\n                  value=\"bestof\"\n                  checked={modeType === \"bestof\"}\n                  onChange={() => {\n                    setModeType(\"bestof\");\n                    setLegs((prev) => {\n                      const base = Math.max(1, prev || 3);\n                      // Ensure odd for Best Of\n                      return base % 2 === 1 ? base : base + 1;\n                    });\n                    setTimeout(() => legsRef.current?.focus(), 0);\n                  }}\n                  className=\"sr-only\"\n                />{\" \"}\n                Best Of üéØ\n              </label>\n              <label\n                className={`btn ${modeType === \"firstto\" ? \"btn-primary\" : \"btn-ghost\"}`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"mode\"\n                  value=\"firstto\"\n                  checked={modeType === \"firstto\"}\n                  onChange={() => {\n                    setModeType(\"firstto\");\n                    setLegs((prev) => Math.max(1, prev || 3));\n                    setTimeout(() => legsRef.current?.focus(), 0);\n                  }}\n                  className=\"sr-only\"\n                />{\" \"}\n                First To üéØ\n              </label>\n            </div>\n          </div>\n          <div>\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-legs\">\n              {modeType === \"bestof\" ? \"Best Of üéØ\" : \"First To üéØ\"}\n            </label>\n            <input\n              id=\"match-legs\"\n              type=\"number\"\n              min={1}\n              value={legs}\n              onChange={(e) =>\n                setLegs(Math.max(1, Number(e.target.value || 1)))\n              }\n              ref={legsRef}\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\n            />\n          </div>\n          <div>\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-avg\">\n              Average Choice (¬±) üéØ\n            </label>\n            <input\n              id=\"match-avg\"\n              type=\"number\"\n              value={avgChoice}\n              onChange={(e) => setAvgChoice(Number(e.target.value || 0))}\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\n            />\n          </div>\n        </div>\n        <div className=\"flex justify-end mt-4\">\n          <button className=\"btn btn-primary\" onClick={handleCreate}>\n            Create Match üéØ\n          </button>\n        </div>\n      </div>\n    </div>,\n    portalEl,\n  );\n}\n","import React, { useState, useMemo, useEffect, useRef } from \"react\";\nimport {\n  Search,\n  Filter,\n  Zap,\n  Target,\n  Trophy,\n  Users,\n  Clock,\n  ChevronDown,\n} from \"lucide-react\";\nimport CreateMatchModal from \"./ui/CreateMatchModal\";\nimport GameCalibrationStatus from \"./GameCalibrationStatus\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase\";\nimport { useMatch } from \"../store/match\";\nimport { useWS } from \"./WSProvider\";\n\nexport default function OnlinePlayClean({ user }: { user?: any }) {\n  const username = user?.username || \"You\";\n  const [currentRoomIdx, setCurrentRoomIdx] = useState(0);\n  const [rooms, setRooms] = useState(() => [\n    { id: 1, name: \"room-1\", matches: [] as any[] },\n  ]);\n  const wsGlobal = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  const [serverMatches, setServerMatches] = useState<any[]>([]);\n  const inProgress = useMatch((s) => s.inProgress);\n  const players = useMatch((s) => s.players);\n  const [focusMode, setFocusMode] = useState(false);\n  const matchesRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    if (!focusMode) return;\n    function onDocClick(e: MouseEvent) {\n      try {\n        if (!matchesRef.current) return;\n        if (!matchesRef.current.contains(e.target as Node)) {\n          setFocusMode(false);\n        }\n      } catch {}\n    }\n    document.addEventListener(\"mousedown\", onDocClick);\n    return () => document.removeEventListener(\"mousedown\", onDocClick);\n  }, [focusMode]);\n  const [showStartShowcase, setShowStartShowcase] = useState<boolean>(false);\n  const startedShowcasedRef = React.useRef(false);\n  useEffect(() => {\n    if (!inProgress) return;\n    if (startedShowcasedRef.current) return;\n    startedShowcasedRef.current = true;\n    setShowStartShowcase(true);\n  }, [inProgress]);\n\n  // Allow the overlay to show again the next time a match starts.\n  useEffect(() => {\n    if (inProgress) return;\n    startedShowcasedRef.current = false;\n  }, [inProgress]);\n\n  // Announce presence to server so it knows our username\n  useEffect(() => {\n    if (wsGlobal?.connected && user?.username) {\n      try {\n        wsGlobal.send({\n          type: \"presence\",\n          username: user.username,\n          email: user.email || \"\",\n        });\n      } catch {}\n    }\n  }, [wsGlobal?.connected, user]);\n\n  // Global quit handler (from CameraView Quit / Pause modal)\n  useEffect(() => {\n    const onQuit = () => {\n      try {\n        useMatch.getState().endGame();\n      } catch (e) {}\n    };\n    try {\n      window.addEventListener(\"ndn:match-quit\" as any, onQuit as any);\n    } catch {}\n    return () => {\n      try {\n        window.removeEventListener(\"ndn:match-quit\" as any, onQuit as any);\n      } catch {}\n    };\n  }, []);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [joinMatch, setJoinMatch] = useState<any | null>(null);\n  const joinAcceptRef = React.useRef<HTMLButtonElement | null>(null);\n  const [_selfId, setSelfId] = useState<string | null>(null);\n  const [participants, setParticipants] = useState<Record<string, string>>({});\n  const [joinTimer, setJoinTimer] = useState(30);\n  const serverPrestartRef = React.useRef(false);\n  const [joinChoice, setJoinChoice] = useState<null | \"bull\" | \"skip\">(null);\n  const [remoteChoices, setRemoteChoices] = useState<\n    Record<string, \"bull\" | \"skip\">\n  >({});\n  const [bullActive, setBullActive] = useState(false);\n  const [bullThrow, setBullThrow] = useState<number | null>(null);\n  const [bullWinner, setBullWinner] = useState<string | null>(null);\n  const [bullLocalThrow, setBullLocalThrow] = useState<number | null>(null);\n  const [bullThrown, setBullThrown] = useState(false);\n\n  // Filter & Sort State\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filterGame, setFilterGame] = useState<\n    \"all\" | \"x01\" | \"cricket\" | \"bermuda\" | \"gotcha\"\n  >(\"all\");\n  const [filterMode, setFilterMode] = useState<\"all\" | \"first_to\" | \"best_of\">(\n    \"all\",\n  );\n  const [sortBy, setSortBy] = useState<\"newest\" | \"oldest\">(\"newest\");\n\n  // Pagination State\n  const [currentPage, setCurrentPage] = useState(1);\n  const itemsPerPage = 16;\n\n  const currentRoom = rooms[currentRoomIdx];\n  const maxMatchesPerRoom = 16; // Updated to 16 as requested\n  const worldLobby = useMemo(() => {\n    if (serverMatches && serverMatches.length) return serverMatches as any[];\n    return rooms.flatMap((r) =>\n      r.matches.map((m) => ({ ...m, roomName: r.name })),\n    );\n  }, [rooms, serverMatches]);\n\n  // Combined matches: current room first, then world lobby matches that are not in current room\n  const combinedMatches = useMemo(() => {\n    const local = currentRoom?.matches || [];\n    const ids = new Set(local.map((m: any) => m.id));\n    const others = (worldLobby || []).filter((m: any) => !ids.has(m.id));\n    let all = [...local, ...others];\n\n    // 1. Search\n    if (searchQuery.trim()) {\n      const q = searchQuery.toLowerCase();\n      all = all.filter(\n        (m) =>\n          (m.game || \"\").toLowerCase().includes(q) ||\n          (m.createdBy || m.creatorName || \"\").toLowerCase().includes(q) ||\n          (m.id || \"\").toLowerCase().includes(q),\n      );\n    }\n\n    // 2. Filter Game\n    if (filterGame !== \"all\") {\n      all = all.filter((m) => (m.game || \"\").toLowerCase() === filterGame);\n    }\n\n    // 3. Filter Mode\n    if (filterMode !== \"all\") {\n      // normalize modeType. Some might be 'first_to' or 'bestof'\n      all = all.filter((m) => {\n        const mt = (m.modeType || \"\").replace(\"_\", \"\").toLowerCase(); // 'firstto', 'bestof'\n        const target = filterMode.replace(\"_\", \"\").toLowerCase();\n        return mt.includes(target);\n      });\n    }\n\n    // 4. Sort\n    all.sort((a, b) => {\n      const tA = a.createdAt || 0;\n      const tB = b.createdAt || 0;\n      return sortBy === \"newest\" ? tB - tA : tA - tB;\n    });\n\n    return all;\n  }, [currentRoom, worldLobby, searchQuery, filterGame, filterMode, sortBy]);\n\n  // Reset page when filters change\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [searchQuery, filterGame, filterMode, sortBy, currentRoomIdx]);\n\n  const totalPages = Math.ceil(combinedMatches.length / itemsPerPage);\n  const paginatedMatches = combinedMatches.slice(\n    (currentPage - 1) * itemsPerPage,\n    currentPage * itemsPerPage,\n  );\n\n  const handleQuickJoin = () => {\n    if (combinedMatches.length > 0) {\n      requestJoin(combinedMatches[0]);\n    }\n  };\n\n  const handleCreateMatch = (payload: any) => {\n    const newMatch = {\n      id: `m-${Date.now()}`,\n      createdBy: payload.createdBy || username,\n      game: payload.game,\n      modeType: payload.modeType,\n      legs: payload.legs,\n      startingScore: payload.startingScore,\n      createdAt: Date.now(),\n    };\n\n    // Only add optimistically if we are NOT connected to the server\n    // Otherwise, we wait for the server to broadcast the new match to avoid duplicates\n    if (!wsGlobal?.connected) {\n      setRooms((prev) =>\n        prev.map((r, idx) =>\n          idx === currentRoomIdx\n            ? { ...r, matches: [newMatch, ...r.matches] }\n            : r,\n        ),\n      );\n    }\n\n    // If we have a server WS connection, send a create-match message\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before creating match to guarantee correct attribution\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n\n        wsGlobal.send({\n          type: \"create-match\",\n          game: payload.game,\n          mode: payload.modeType,\n          value: payload.legs,\n          startingScore: payload.startingScore,\n          creatorAvg: payload.avgChoice || 0,\n        });\n      }\n    } catch {}\n  };\n\n  const newRoom = () => {\n    setRooms((prev) => {\n      const id = prev.length + 1;\n      const newRooms = [...prev, { id, name: `room-${id}`, matches: [] }];\n      setCurrentRoomIdx(newRooms.length - 1);\n      return newRooms;\n    });\n  };\n\n  // WS: subscribe to lobby and prestart events\n  useEffect(() => {\n    if (!wsGlobal) return;\n    if (wsGlobal.connected) wsGlobal.send({ type: \"list-matches\" });\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg?.type === \"joined\") {\n          if (msg.id) setSelfId(msg.id);\n        }\n        if (msg?.type === \"presence\") {\n          // presence carries id and username\n          try {\n            if (msg.id)\n              setParticipants((prev) => ({\n                ...prev,\n                [msg.id]: msg.username || msg.name || msg.id,\n              }));\n          } catch {}\n        }\n        if (msg?.type === \"matches\") {\n          setServerMatches(msg.matches || []);\n        }\n        if (msg?.type === \"match-prestart\") {\n          // Someone accepted the invite; show prestart and update join match if it matches\n          const m = msg.match || null;\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\n          // Ensure we know the creator's username\n          try {\n            if (m?.creatorId && m?.creatorName)\n              setParticipants((prev) => ({\n                ...prev,\n                [m.creatorId]: m.creatorName,\n              }));\n          } catch {}\n          serverPrestartRef.current = true;\n          setJoinMatch(m);\n          const endsAt = msg.prestartEndsAt || Date.now();\n          setJoinTimer(\n            Math.max(\n              0,\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\n            ),\n          );\n          setTimeout(() => {\n            serverPrestartRef.current = false;\n          }, 0);\n          // store on joinMatch as prestartEndsAt\n          // reset diffuse state\n          setJoinChoice(null);\n          setRemoteChoices({});\n          setBullActive(false);\n          setBullThrow(null);\n          setBullWinner(null);\n        }\n        if (msg?.type === \"match-start\") {\n          // If the started match matches our current join request, close the modal\n          if (joinMatch && msg.roomId === joinMatch.id) {\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setRemoteChoices({});\n            // (joinPrestart ends were attached to joinMatch; no-op)\n          }\n        }\n        if (msg?.type === \"prestart-choice-notify\") {\n          const { roomId, playerId, choice } = msg;\n          if (!roomId || !choice) return;\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\n        }\n        if (msg?.type === \"prestart-bull\") {\n          setBullActive(true);\n          setBullThrown(false);\n          setBullLocalThrow(null);\n        }\n        if (msg?.type === \"prestart-bull-winner\") {\n          setBullWinner(msg.winnerId || null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n        if (msg?.type === \"prestart-bull-tie\") {\n          // reset to allow another round\n          setBullWinner(null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n      } catch (err) {}\n    });\n    return unsub;\n  }, [wsGlobal, joinChoice]);\n\n  // Join timer\n  useEffect(() => {\n    if (!joinMatch) return;\n    if (serverPrestartRef.current) return;\n    // If a server-supplied prestart exists, do not override joinTimer\n    if ((joinMatch as any).prestartEndsAt) return;\n    setJoinTimer(30);\n    setJoinChoice(null);\n    setRemoteChoices({});\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\n    return () => clearInterval(t);\n  }, [joinMatch]);\n\n  // Focus the accept button when the join modal is shown\n  useEffect(() => {\n    if (!joinMatch) return;\n    setTimeout(() => joinAcceptRef.current?.focus(), 0);\n  }, [joinMatch]);\n\n  const handleJoinAccept = () => {\n    // Show the pre-game overlay immediately for snappy UX.\n    setShowStartShowcase(true);\n    // Send accept (invite-response) to server if we have a match prestart\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"invite-response\",\n          matchId: joinMatch.id,\n          accept: true,\n          toId: joinMatch.creatorId,\n        });\n      }\n    } catch {}\n    setJoinMatch(null);\n  };\n\n  const requestJoin = (m: any) => {\n    setJoinMatch(m);\n    // Show the pre-game overlay immediately while the server processes the join.\n    setShowStartShowcase(true);\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before joining\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n        wsGlobal.send({ type: \"join-match\", matchId: m.id, calibrated: true });\n      }\n    } catch {}\n  };\n\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\n    setJoinChoice(choice);\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"prestart-choice\",\n          roomId: joinMatch.id,\n          choice,\n        });\n      }\n    } catch {}\n  };\n\n  // No local state for the start showcase; MatchStartShowcase reads from `match.inProgress` directly\n\n  return (\n    <div\n      className=\"flex-1 min-h-0\"\n      style={{ position: \"relative\", marginTop: 0 }}\n    >\n      <div className=\"card ndn-game-shell relative overflow-hidden h-full flex flex-col\">\n        {showStartShowcase && (\n          <MatchStartShowcase\n            players={(players || []) as any}\n            user={user}\n            onDone={() => setShowStartShowcase(false)}\n            onRequestClose={() => setShowStartShowcase(false)}\n          />\n        )}\n        <h2 className=\"text-3xl font-bold text-black dark:text-white mb-4\">\n          Online Lobby üåê\n        </h2>\n        <div className=\"ndn-shell-body flex-1 overflow-hidden p-3 pb-0\">\n          <div className=\"rounded-xl border border-slate-700 bg-black/10 p-3 flex-1 min-h-0 overflow-hidden flex flex-col\">\n            {/* Top row: Room, New Room, Create Match */}\n            <div className=\"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap\">\n              <div className=\"min-w-0\">\n                <div className=\"text-sm opacity-80\">Room</div>\n                <div className=\"px-3 py-1 bg-white/5 rounded border border-white/10\">\n                  Room ({currentRoom?.id})\n                </div>\n                <div style={{ width: 12 }} />\n                <button className=\"btn btn-ghost\" onClick={newRoom}>\n                  New Room üö™\n                </button>\n              </div>\n              <div className=\"shrink-0 flex items-center gap-2\">\n                <button\n                  className=\"btn btn-primary flex items-center gap-2\"\n                  onClick={() => setShowCreateModal(true)}\n                  disabled={\n                    (currentRoom?.matches?.length || 0) >= maxMatchesPerRoom\n                  }\n                >\n                  <Trophy className=\"w-4 h-4\" />\n                  Create Match + ‚öîÔ∏è\n                </button>\n                {(currentRoom?.matches?.length || 0) >= maxMatchesPerRoom && (\n                  <div className=\"text-xs text-rose-400 mt-1\">\n                    Room full ‚Äî create a new room\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <p className=\"mb-2\" />\n\n            {/* Filters & Controls */}\n            {!inProgress && (\n              <div className=\"mb-4 p-3 rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-white/5 flex flex-col gap-3 shadow-lg\">\n                <div className=\"flex flex-wrap items-center gap-3\">\n                  <div className=\"flex-1 min-w-[200px] relative\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40\" />\n                    <input\n                      type=\"text\"\n                      placeholder=\"Search matches, players...\"\n                      className=\"w-full pl-9 pr-3 py-2.5 rounded-lg bg-black/40 border border-white/10 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 transition-all\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                    />\n                  </div>\n                  <button\n                    className=\"btn bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-lg shadow-indigo-500/20 flex items-center gap-2 px-4 py-2.5 rounded-lg transition-all active:scale-95 disabled:opacity-50 disabled:active:scale-100\"\n                    onClick={handleQuickJoin}\n                    disabled={combinedMatches.length === 0}\n                  >\n                    <Zap className=\"w-4 h-4 fill-current\" />\n                    <span className=\"font-medium\">Quick Join ‚ö°</span>\n                  </button>\n                </div>\n\n                <div className=\"flex items-center gap-2 text-[11px] font-semibold uppercase tracking-wide text-white/50\">\n                  <Filter className=\"w-4 h-4\" />\n                  <span>Filters</span>\n                </div>\n\n                <div className=\"flex flex-wrap items-center gap-2 text-sm\">\n                  <div className=\"flex items-center gap-2\">\n                    <select\n                      className=\"input input-compact cursor-pointer font-bold\"\n                      value={filterGame}\n                      onChange={(e) => setFilterGame(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Games üéØ</option>\n                      <option value=\"x01\">X01</option>\n                      <option value=\"cricket\">Cricket</option>\n                      <option value=\"bermuda\">Bermuda</option>\n                      <option value=\"gotcha\">Gotcha</option>\n                    </select>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <select\n                      className=\"input input-compact cursor-pointer font-bold\"\n                      value={filterMode}\n                      onChange={(e) => setFilterMode(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Modes üèÜ</option>\n                      <option value=\"first_to\">First To</option>\n                      <option value=\"best_of\">Best Of</option>\n                    </select>\n                  </div>\n\n                  <div className=\"flex-1\" />\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className={`px-3 py-2 rounded-lg text-sm font-semibold transition-all ${focusMode ? \"bg-red-600 text-white\" : \"bg-white/5 text-white/80 hover:bg-white/10\"}`}\n                      onClick={() => setFocusMode((s) => !s)}\n                      aria-pressed={focusMode}\n                      title=\"Toggle focus mode: hide small details and show focused view\"\n                    >\n                      {focusMode ? \"Exit Focus üîç\" : \"Focus Mode üîç\"}\n                    </button>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <select\n                      className=\"input input-compact cursor-pointer font-bold\"\n                      value={sortBy}\n                      onChange={(e) => setSortBy(e.target.value as any)}\n                    >\n                      <option value=\"newest\">Newest First üÜï</option>\n                      <option value=\"oldest\">Oldest First</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex-1 overflow-auto\">\n              <h3 className=\"font-semibold text-lg mb-4 flex items-center gap-2\">\n                <Users className=\"w-5 h-5 text-indigo-400\" />\n                Active Matches ÔøΩÔ∏è\n              </h3>\n              <div className=\"mb-3 p-1 rounded-xl border border-slate-700/50 bg-black/10\">\n                <div className=\"mb-4\">\n                  {(combinedMatches.length || 0) === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-12 text-center opacity-60\">\n                      <div className=\"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4\">\n                        <Target className=\"w-8 h-8 text-white/20\" />\n                      </div>\n                      <p className=\"text-lg font-medium mb-1\">\n                        No matches found\n                      </p>\n                      <p className=\"text-sm max-w-xs mx-auto\">\n                        Create a new match to get started or try adjusting your\n                        filters.\n                      </p>\n                    </div>\n                  ) : null}\n\n                  {(combinedMatches.length || 0) !== 0 && (\n                    <div className=\"relative\">\n                      {focusMode && (\n                        <div className=\"absolute inset-0 z-10 flex items-center justify-center pointer-events-none\">\n                          <div className=\"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-lg shadow-lg text-lg font-bold transform transition-all duration-200 ease-out\">\n                            <button\n                              onClick={() => setFocusMode(false)}\n                              className=\"w-full text-center\"\n                            >\n                              FOCUS MODE ‚Äî Click to exit\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                      <div\n                        ref={matchesRef}\n                        className={`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[28rem] overflow-auto p-2 ${focusMode ? \"opacity-90\" : \"\"}`}\n                        data-testid=\"matches-grid\"\n                      >\n                        {paginatedMatches.map((m: any) => (\n                          <div\n                            key={m.id}\n                            className=\"group relative p-5 rounded-xl border border-white/5 bg-gradient-to-br from-slate-800/80 to-slate-900/80 hover:from-slate-800 hover:to-slate-900 transform transition-transform duration-150 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-indigo-500/10 flex flex-col gap-4 h-24\"\n                            data-testid={`match-${m.id}`}\n                          >\n                            <div className=\"flex items-start justify-between\">\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"flex items-center gap-3\">\n                                  {!focusMode && (\n                                    <div className=\"w-9 h-9 rounded-full bg-indigo-500/10 flex items-center justify-center border border-indigo-500/20 group-hover:border-indigo-500/40 transition-colors text-xs font-bold\">\n                                      {m.createdBy\n                                        ? (m.createdBy || \"U\")\n                                            .substring(0, 2)\n                                            .toUpperCase()\n                                        : (m.creatorName || \"U\")\n                                            .substring(0, 2)\n                                            .toUpperCase()}\n                                    </div>\n                                  )}\n                                  <div className=\"min-w-0\">\n                                    <div className=\"font-bold text-white group-hover:text-indigo-300 transition-colors truncate\">\n                                      {m.game}\n                                    </div>\n                                    <div className=\"text-xs text-white/50 flex items-center gap-1\">\n                                      <Clock className=\"w-3 h-3\" />\n                                      {new Date(m.createdAt).toLocaleTimeString(\n                                        [],\n                                        { hour: \"2-digit\", minute: \"2-digit\" },\n                                      )}\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                              {m.roomName && (\n                                <div className=\"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded bg-white/5 border border-white/10 text-white/60\">\n                                  {m.roomName}\n                                </div>\n                              )}\n                            </div>\n\n                            <div className=\"flex flex-col gap-1 text-sm text-white/70 bg-black/20 p-2 rounded-lg\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"px-1.5 py-0.5 rounded bg-white/10 text-xs font-medium\">\n                                  {m.modeType === \"bestof\"\n                                    ? \"Best Of\"\n                                    : \"First To\"}\n                                </span>\n                                <span className=\"font-mono text-indigo-300\">\n                                  {m.legs}\n                                </span>\n                                <span>legs</span>\n                                {m.startingScore && (\n                                  <>\n                                    <span className=\"w-1 h-1 rounded-full bg-white/20\" />\n                                    <span className=\"font-mono text-amber-300\">\n                                      {m.startingScore}\n                                    </span>\n                                  </>\n                                )}\n                              </div>\n                              {!focusMode && (\n                                <div className=\"text-xs text-white/40 flex items-center gap-1 mt-1\">\n                                  <Users className=\"w-3 h-3\" />\n                                  Created by:{\" \"}\n                                  <span className=\"text-white/60\">\n                                    {m.createdBy || m.creatorName || \"Unknown\"}\n                                  </span>\n                                </div>\n                              )}\n                            </div>\n\n                            <div className=\"flex items-center justify-between mt-auto pt-2 border-t border-white/5\">\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                {!focusMode && (\n                                  <div className=\"flex items-center gap-3 min-w-0\">\n                                    <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white\">\n                                      {(m.createdBy || m.creatorName || \"U\")\n                                        .substring(0, 2)\n                                        .toUpperCase()}\n                                    </div>\n                                    <span className=\"text-xs text-white/60 truncate max-w-[120px]\">\n                                      {m.createdBy || m.creatorName}\n                                    </span>\n                                  </div>\n                                )}\n                              </div>\n\n                              <div className=\"flex items-center justify-end\">\n                                <button\n                                  className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-lg shadow-indigo-500/20 px-4\"\n                                  onClick={() => requestJoin(m)}\n                                >\n                                  Join ‚öîÔ∏è\n                                </button>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Pagination Controls */}\n                  {totalPages > 1 && (\n                    <div className=\"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5\">\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === 1}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.max(1, p - 1))\n                        }\n                      >\n                        <ChevronDown className=\"w-4 h-4 rotate-90\" />\n                        Previous\n                      </button>\n                      <div className=\"flex items-center gap-1\">\n                        {Array.from(\n                          { length: Math.min(5, totalPages) },\n                          (_, i) => {\n                            // Logic to show window of pages around current\n                            let p = i + 1;\n                            if (totalPages > 5) {\n                              if (currentPage > 3) p = currentPage - 2 + i;\n                              if (p > totalPages) p = totalPages - 4 + i;\n                            }\n                            return (\n                              <button\n                                key={p}\n                                className={`w-8 h-8 rounded-lg text-xs font-bold transition-all ${\n                                  currentPage === p\n                                    ? \"bg-indigo-500 text-white shadow-lg shadow-indigo-500/25\"\n                                    : \"bg-white/5 text-white/60 hover:bg-white/10\"\n                                }`}\n                                onClick={() => setCurrentPage(p)}\n                              >\n                                {p}\n                              </button>\n                            );\n                          },\n                        )}\n                      </div>\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === totalPages}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.min(totalPages, p + 1))\n                        }\n                      >\n                        Next\n                        <ChevronDown className=\"w-4 h-4 -rotate-90\" />\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n              {/* World Lobby removed: combined matches are displayed above */}\n            </div>\n          </div>\n        </div>\n\n        {/* Create Match modal */}\n        <CreateMatchModal\n          open={showCreateModal}\n          onClose={() => setShowCreateModal(false)}\n          onCreate={(p) => {\n            handleCreateMatch(p);\n            setShowCreateModal(false);\n          }}\n        />\n\n        {/* Join Modal (simplified) */}\n        {joinMatch && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"join-heading\"\n            tabIndex={-1}\n            className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4\"\n          >\n            <div className=\"bg-slate-800 rounded-2xl p-6 max-w-md w-full\">\n              <div id=\"join-heading\" className=\"text-lg font-bold mb-2\">\n                Join Match ‚öîÔ∏è\n              </div>\n              <div className=\"mb-3\">\n                {joinMatch.game} - {joinMatch.modeType} ¬∑ {joinMatch.legs} legs\n              </div>\n              <div className=\"text-sm opacity-80 mb-3\">\n                Created by {joinMatch.createdBy}\n              </div>\n              <div className=\"mb-3\">\n                <GameCalibrationStatus gameMode={joinMatch.game} compact />\n              </div>\n              {joinMatch.startingScore && (\n                <div className=\"mb-3\">\n                  Starting score:{\" \"}\n                  <span className=\"font-mono\">{joinMatch.startingScore}</span>\n                </div>\n              )}\n              {/* Match start showcase overlay */}\n              <MatchStartShowcase\n                open={showStartShowcase}\n                players={players as any}\n                user={user}\n                onRequestClose={() => {}}\n                onDone={() => {}}\n              />\n              <div className=\"mb-3\">\n                Timer: <span className=\"font-mono\">{joinTimer}s</span>\n              </div>\n              {(joinTimer <= 15 || (joinMatch as any)?.prestartEndsAt) && (\n                <div className=\"mb-3\">\n                  Choose:{\" \"}\n                  <div className=\"flex gap-2\">\n                    <button\n                      className={`btn ${joinChoice === \"bull\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"bull\")}\n                    >\n                      Bull Up\n                    </button>\n                    <button\n                      className={`btn ${joinChoice === \"skip\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"skip\")}\n                    >\n                      Skip\n                    </button>\n                  </div>\n                  <div className=\"text-xs opacity-70 mt-2\">\n                    {joinChoice\n                      ? `You chose: ${joinChoice}`\n                      : \"Please choose Bull Up or Skip before accepting\"}\n                  </div>\n                  {Object.keys(remoteChoices).length > 0 && (\n                    <div\n                      className=\"text-xs opacity-70 mt-2\"\n                      role=\"status\"\n                      aria-live=\"polite\"\n                    >\n                      {Object.entries(remoteChoices).map(([pid, choice]) => (\n                        <div key={pid}>\n                          {participants[pid] || pid} chose: {choice}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  {joinChoice === \"skip\" && (\n                    <div className=\"text-xs opacity-70 mt-2\">\n                      Skip requires both players to click Skip. Waiting for\n                      other player‚Ä¶\n                    </div>\n                  )}\n                  {joinChoice === \"skip\" &&\n                    Object.values(remoteChoices).some((c) => c === \"skip\") && (\n                      <div className=\"text-sm font-semibold mt-2\">\n                        Both players skipped ‚Äî Left player throws first\n                      </div>\n                    )}\n                  {bullActive && (\n                    <div className=\"text-xs opacity-70 mt-2\">\n                      Bull Up active ‚Äî\n                      {bullThrown\n                        ? ` you threw ${bullLocalThrow ?? 50}`\n                        : \" throw to win the bull!\"}\n                    </div>\n                  )}\n                  {bullActive && !bullThrown && (\n                    <div className=\"flex items-center gap-2 mt-2\">\n                      <input\n                        className=\"input input-sm\"\n                        aria-label=\"bull-throw\"\n                        type=\"number\"\n                        min={0}\n                        max={50}\n                        value={bullThrow ?? 50}\n                        onChange={(e) =>\n                          setBullThrow(\n                            Math.max(\n                              0,\n                              Math.min(50, Number(e.target.value || 0)),\n                            ),\n                          )\n                        }\n                      />\n                      <button\n                        className=\"btn btn-primary\"\n                        onClick={() => {\n                          try {\n                            if (wsGlobal?.connected && joinMatch?.id)\n                              wsGlobal.send({\n                                type: \"prestart-bull-throw\",\n                                roomId: joinMatch.id,\n                                score: bullThrow ?? 50,\n                              });\n                          } catch {}\n                          setBullLocalThrow(bullThrow ?? 50);\n                          setBullThrown(true);\n                        }}\n                      >\n                        Throw Bull\n                      </button>\n                    </div>\n                  )}\n                  {bullThrown && (\n                    <div className=\"text-sm font-semibold mt-2 animate-pulse\">\n                      You threw: {bullLocalThrow ?? 50}\n                    </div>\n                  )}\n                  {bullWinner && (\n                    <div className=\"text-sm font-semibold mt-2\">\n                      Bull winner: {bullWinner}\n                    </div>\n                  )}\n                </div>\n              )}\n              <div className=\"flex items-center gap-2\">\n                <button\n                  ref={joinAcceptRef}\n                  aria-label=\"Accept invitation\"\n                  className=\"btn btn-primary\"\n                  onClick={handleJoinAccept}\n                  disabled={joinTimer <= 15 && !joinChoice}\n                >\n                  Accept\n                </button>\n                <button\n                  className=\"btn btn-ghost\"\n                  onClick={() => {\n                    setJoinMatch(null);\n                  }}\n                >\n                  Cancel\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":["CreateMatchModal","open","onClose","onCreate","portalEl","useState","game","setGame","modeType","setModeType","legs","setLegs","legsRef","useRef","avgChoice","setAvgChoice","startingScore","setStartingScore","getStartOptionsForGame","user","useUserSettings","useLayoutEffect","onKey","e","handleCreate","createPortal","jsxs","jsx","v","opts","allGames","g","opt","prev","base","OnlinePlayClean","username","currentRoomIdx","setCurrentRoomIdx","rooms","setRooms","wsGlobal","useWS","serverMatches","setServerMatches","inProgress","useMatch","s","players","focusMode","setFocusMode","matchesRef","useEffect","onDocClick","showStartShowcase","setShowStartShowcase","startedShowcasedRef","React","onQuit","showCreateModal","setShowCreateModal","joinMatch","setJoinMatch","joinAcceptRef","_selfId","setSelfId","participants","setParticipants","joinTimer","setJoinTimer","serverPrestartRef","joinChoice","setJoinChoice","remoteChoices","setRemoteChoices","bullActive","setBullActive","bullThrow","setBullThrow","bullWinner","setBullWinner","bullLocalThrow","setBullLocalThrow","bullThrown","setBullThrown","searchQuery","setSearchQuery","filterGame","setFilterGame","filterMode","setFilterMode","sortBy","setSortBy","currentPage","setCurrentPage","itemsPerPage","currentRoom","maxMatchesPerRoom","worldLobby","useMemo","r","m","combinedMatches","local","ids","others","all","q","mt","target","a","b","tA","tB","totalPages","paginatedMatches","handleQuickJoin","requestJoin","handleCreateMatch","payload","newMatch","idx","newRoom","id","newRooms","msg","endsAt","roomId","playerId","choice","handleJoinAccept","sendPrestartChoice","MatchStartShowcase","Trophy","Search","Zap","Filter","Users","Target","Clock","Fragment","p","ChevronDown","_","i","GameCalibrationStatus","pid","c"],"mappings":"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"}
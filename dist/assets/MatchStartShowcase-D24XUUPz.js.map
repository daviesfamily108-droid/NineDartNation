{"version":3,"file":"MatchStartShowcase-D24XUUPz.js","sources":["../../src/components/ui/MatchStartShowcase.tsx"],"sourcesContent":["import { useEffect, useMemo, useState, useRef } from 'react'\r\nimport { createPortal } from 'react-dom'\r\nimport { getAllTimeAvg, getAllTimeFirstNineAvg, getAllTimeBestCheckout, getAllTimeBestLeg, getAllTime, getAllTime180s } from '../../store/profileStats'\r\nimport type { Player } from '../../store/match'\r\nimport { useCalibration } from '../../store/calibration'\r\n\r\nfunction StatBlock({ label, value, className = '', scale = 1 }: { label: string; value: string | number; className?: string; scale?: number }) {\r\n  return (\r\n    <div className={`flex flex-col items-center gap-1 ${className}`}>\r\n      <div className=\"text-xs opacity-70\">{label}</div>\r\n      <div className=\"text-2xl sm:text-3xl font-bold transform transition-transform duration-200 ease-out\" style={{ transform: `scale(${scale})` }}>{value}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction PlayerCalibrationPreview({ player, user, playerCalibrations }: { player: Player; user?: any; playerCalibrations: {[playerName: string]: any} }) {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null)\r\n  const calib = playerCalibrations[player.name]\r\n  const isCalibrated = !!calib\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current\r\n    if (!canvas) return\r\n    const ctx = canvas.getContext('2d')\r\n    if (!ctx) return\r\n\r\n    // Clear canvas\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n\r\n    // Draw a simple dartboard circle\r\n    const centerX = canvas.width / 2\r\n    const centerY = canvas.height / 2\r\n    const radius = Math.min(centerX, centerY) - 2\r\n\r\n    // Outer circle\r\n    ctx.strokeStyle = '#fff'\r\n    ctx.lineWidth = 1\r\n    ctx.beginPath()\r\n    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI)\r\n    ctx.stroke()\r\n\r\n    // Bullseye\r\n    ctx.fillStyle = '#f00'\r\n    ctx.beginPath()\r\n    ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI)\r\n    ctx.fill()\r\n\r\n    // If calibrated, draw calibration points\r\n    if (isCalibrated) {\r\n      ctx.fillStyle = '#0f0'\r\n      // Draw some sample points (simplified)\r\n      const points = [\r\n        [centerX - radius * 0.5, centerY],\r\n        [centerX + radius * 0.5, centerY],\r\n        [centerX, centerY - radius * 0.5],\r\n        [centerX, centerY + radius * 0.5]\r\n      ]\r\n      points.forEach(([x, y]) => {\r\n        ctx.beginPath()\r\n        ctx.arc(x, y, 2, 0, 2 * Math.PI)\r\n        ctx.fill()\r\n      })\r\n    }\r\n  }, [isCalibrated])\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 mt-1\">\r\n      <canvas ref={canvasRef} width={40} height={40} className=\"border border-white/20 rounded\" />\r\n      <span className={`text-xs ${isCalibrated ? 'text-green-400' : 'text-gray-400'}`}>\r\n        {isCalibrated ? 'Calibrated' : 'Not Calibrated'}\r\n      </span>\r\n    </div>\r\n  )\r\n}\r\n\r\nimport FocusLock from 'react-focus-lock'\r\nexport default function MatchStartShowcase({ players, user, onDone, initialSeconds = 15, roomId, onChoice, choices = {}, bullActive = false, onBullThrow }: { players: Player[]; user?: any; onDone?: () => void; initialSeconds?: number; roomId?: string; onChoice?: (choice: 'bull'|'skip') => void; choices?: Record<string, string>; bullActive?: boolean; onBullThrow?: (score: number) => void }) {\r\n  const [seconds, setSeconds] = useState(initialSeconds || 15)\r\n  const [scaleState, setScaleState] = useState(1)\r\n  const [visible, setVisible] = useState(true)\r\n  const [showCalibration, setShowCalibration] = useState(false)\r\n  const [calibrationSkipped, setCalibrationSkipped] = useState<{[playerId: string]: boolean}>({})\r\n  const [playerCalibrations, setPlayerCalibrations] = useState<{[playerName: string]: any}>({})\r\n  const hostRef = useRef<HTMLDivElement | null>(null)\r\n  const startNowRef = useRef<HTMLButtonElement | null>(null)\r\n  const closeRef = useRef<HTMLButtonElement | null>(null)\r\n  const prevActiveElement = useRef<HTMLElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (!visible) return\r\n    // Ensure initial focus is on the Start Now button for convenience\r\n    try { setTimeout(() => { try { startNowRef.current?.focus() } catch {} }, 0) } catch {}\r\n  // remember previous active element so we can restore on close\r\n  try { prevActiveElement.current = document.activeElement as HTMLElement } catch {}\r\n    // Hide app content from screen readers while overlay is open\r\n    const appRoot = document.getElementById('root')\r\n    const prevAria: string | null = appRoot ? (appRoot.getAttribute('aria-hidden')) : null\r\n    try { if (appRoot) appRoot.setAttribute('aria-hidden', 'true') } catch {}\r\n  const t = allPlayersSkipped ? setInterval(() => setSeconds(s => s - 1), 1000) : null\r\n  const onKey = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        e.preventDefault()\r\n        setVisible(false)\r\n        try { onDone?.() } catch {}\r\n        try { prevActiveElement.current?.focus() } catch {}\r\n      }\r\n    }\r\n  document.addEventListener('keydown', onKey)\r\n    // Cleanup and restore aria-hidden\r\n    return () => {\r\n      try {\r\n        if (appRoot && prevAria === null) { appRoot.setAttribute('aria-hidden', 'false') }\r\n        else if (appRoot && prevAria !== null) { appRoot.setAttribute('aria-hidden', prevAria) }\r\n      } catch {}\r\n      if (t) clearInterval(t)\r\n      document.removeEventListener('keydown', onKey)\r\n    }\r\n  }, [visible, onDone])\r\n\r\n  const allPlayersSkipped = players.every(p => calibrationSkipped[p.id])\r\n  const canStartMatch = allPlayersSkipped\r\n\r\n  useEffect(() => {\r\n    if (!visible) return\r\n  // Show calibration popup immediately when countdown starts\r\n  if (seconds === (initialSeconds || 15) && !showCalibration) {\r\n      setShowCalibration(true)\r\n      // Fetch calibrations for all players\r\n      const fetchCalibrations = async () => {\r\n        const calibs: {[playerName: string]: any} = {}\r\n        for (const player of players) {\r\n          if (user?.username && player.name === user.username) {\r\n            // Local user: use store\r\n            const { H, imageSize, locked } = useCalibration.getState()\r\n            if (H && locked) calibs[player.name] = { H, imageSize, locked }\r\n          } else {\r\n            // Remote user: fetch from server\r\n            try {\r\n              const res = await fetch(`/api/users/${encodeURIComponent(player.name)}/calibration`)\r\n              if (res.ok) {\r\n                const data = await res.json()\r\n                if (data.calibration) calibs[player.name] = data.calibration\r\n              }\r\n            } catch (err) {\r\n              console.warn('Failed to fetch calibration for', player.name, err)\r\n            }\r\n          }\r\n        }\r\n        setPlayerCalibrations(calibs)\r\n      }\r\n      fetchCalibrations()\r\n    }\r\n    // Only start countdown when all players have skipped calibration\r\n    if (allPlayersSkipped) {\r\n      if (seconds <= 3 && seconds > 0) {\r\n        setScaleState(s => s + 0.4)\r\n      }\r\n      if (seconds <= 0) {\r\n        // Done; small delay to let the \"Game On\" message show\r\n        setTimeout(() => {\r\n          setVisible(false)\r\n          try { onDone?.() } catch {}\r\n          // Return focus to previous element\r\n          try { prevActiveElement.current?.focus() } catch {}\r\n        }, 1000)\r\n      }\r\n    }\r\n  }, [seconds, onDone, visible, showCalibration, allPlayersSkipped, players, user])\r\n\r\n  const stats = useMemo(() => players.map(p => {\r\n    const avg3 = getAllTimeAvg(p.name)\r\n    const best9 = getAllTimeFirstNineAvg(p.name)\r\n    const bestCheckout = getAllTimeBestCheckout(p.name)\r\n    const bestLeg = getAllTimeBestLeg(p.name)\r\n    const all = getAllTime(p.name)\r\n    const career180s = getAllTime180s(p.name)\r\n    // Count match 180s for the provided player\r\n    let match180s = 0\r\n    try {\r\n      for (const L of (p.legs || [])) {\r\n        for (const v of (L.visits || [])) {\r\n          if (Number(v.score || 0) === 180) match180s += 1\r\n        }\r\n      }\r\n    } catch {}\r\n    const one80s = `${match180s}/${career180s}`\r\n    return { id: p.id, name: p.name, avg3: avg3.toFixed(1), best9: best9.toFixed(1), bestCheckout, bestLeg, one80s }\r\n  }), [players])\r\n\r\n  if (!visible) return null\r\n\r\n  const CalibrationPopup = () => {\r\n    const skippedPlayers = players.filter(p => calibrationSkipped[p.id])\r\n    const remainingPlayers = players.filter(p => !calibrationSkipped[p.id])\r\n    \r\n    return (\r\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/90 p-4\">\r\n      <div className=\"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full\">\r\n        <h3 className=\"text-xl font-bold mb-4 text-center\">Calibration Check</h3>\r\n        <p className=\"text-sm opacity-70 mb-6 text-center\">\r\n          Check your dartboard calibration before the match starts. Both players must skip or confirm to begin.\r\n        </p>\r\n        \r\n        {skippedPlayers.length > 0 && remainingPlayers.length > 0 && (\r\n          <div className=\"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg\">\r\n            <p className=\"text-sm text-blue-200\">\r\n              {skippedPlayers.map(p => p.name).join(', ')} {skippedPlayers.length === 1 ? 'has' : 'have'} chosen to skip. \r\n              {remainingPlayers.map(p => p.name).join(', ')}, would you like to skip as well?\r\n            </p>\r\n          </div>\r\n        )}\r\n        \r\n        <div className=\"space-y-4\">\r\n          {players.map(player => {\r\n            const skipped = calibrationSkipped[player.id]\r\n            return (\r\n              <div key={player.id} className=\"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white\">\r\n                    {player.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)}\r\n                  </div>\r\n                  <div className=\"flex flex-col\">\r\n                    <span className=\"font-medium\">{player.name}</span>\r\n                    {/* Show a tiny calibration preview if local calibration exists (remote calibs require server support) */}\r\n                    <PlayerCalibrationPreview player={player} user={user} playerCalibrations={playerCalibrations} />\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                          <button \r\n                            className=\"btn btn-sm btn-ghost\"\r\n                            onClick={() => {\r\n                              // Send bull choice to server\r\n                              try { if (onChoice) onChoice('bull') } catch {}\r\n                            }}\r\n                          >\r\n                            Bull Up\r\n                          </button>\r\n                  <button \r\n                    className={`btn btn-sm ${skipped ? 'bg-emerald-600' : 'btn-primary'}`}\r\n                    onClick={() => {\r\n                      setCalibrationSkipped(prev => ({ ...prev, [player.id]: true }))\r\n                      try { if (onChoice) onChoice('skip') } catch {}\r\n                    }}\r\n                    disabled={skipped}\r\n                  >\r\n                    {skipped ? 'Skipped âœ“' : 'Skip'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n        <div className=\"mt-6 flex justify-center gap-4\">\r\n          <button \r\n            className={`btn ${canStartMatch ? 'btn-primary' : 'btn-ghost opacity-50 cursor-not-allowed'}`}\r\n            onClick={() => {\r\n              if (canStartMatch) {\r\n                setShowCalibration(false)\r\n                try { if (onChoice) onChoice('skip') } catch {}\r\n              }\r\n            }}\r\n            disabled={!canStartMatch}\r\n          >\r\n            Start Match ({remainingPlayers.length} remaining)\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )}\r\n\r\n  const getScaleFor = (s: number) => {\r\n    if (s <= 0) return 1.8\r\n    if (s === 1) return 1.6\r\n    if (s === 2) return 1.4\r\n    if (s === 3) return 1.2\r\n    return 1\r\n  }\r\n\r\n  const overlay = (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4\">\r\n          <div role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"match-start-heading\" tabIndex={-1}>\r\n        <FocusLock returnFocus={true}>\r\n          <div ref={hostRef}>\r\n        <div className=\"bg-white/5 border border-white/10 rounded-3xl p-8 md:p-12 max-w-7xl w-full backdrop-blur-sm shadow-2xl\">\r\n            <div className=\"flex items-center justify-between mb-8\">\r\n            <div id=\"match-start-heading\" className=\"text-2xl font-bold opacity-90\">Match Starting Soon</div>\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"text-6xl font-extrabold text-emerald-400\" aria-live=\"polite\">{seconds > 0 ? seconds : 'GO'}</div>\r\n              <div className=\"flex flex-col gap-2\">\r\n                <button ref={startNowRef} className=\"btn btn-lg\" onClick={() => { setVisible(false); try{ onDone?.() } catch{} }} aria-label=\"Start match now\">Start Now</button>\r\n                <button ref={closeRef} className=\"btn btn-ghost btn-sm\" onClick={() => { setVisible(false); try{ onDone?.() } catch{} }} aria-label=\"Close match start showcase\">Close</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\r\n          {stats.map(st => (\r\n            <div key={st.id} className=\"p-6 rounded-2xl bg-white/8 border border-white/12 flex flex-col items-center shadow-xl\">\r\n              <div className=\"w-20 h-20 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-2xl font-bold text-white mb-4 shadow-lg\">\r\n                {st.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)}\r\n              </div>\r\n              <div className=\"text-xl font-semibold mb-4 text-center\">{st.name}</div>\r\n              <div className=\"grid grid-cols-2 gap-4 w-full\">\r\n                <StatBlock label=\"3-Dart Avg\" value={st.avg3} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"First-9 Avg\" value={st.best9} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"Best Checkout\" value={st.bestCheckout || 'â€”'} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"Best Leg\" value={st.bestLeg || 'â€”'} scale={getScaleFor(seconds)} />\r\n              </div>\r\n              <div className=\"mt-4 opacity-70 text-sm\">180s (match / career): {st.one80s}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n          <div className=\"text-center\">\r\n          {seconds <= 1 ? (\r\n            <div className=\"text-3xl font-bold text-emerald-400\">Good luck â€” Game on! ðŸŽ¯</div>\r\n          ) : (\r\n            <div className=\"text-lg opacity-70\">{players.map(p=>p.name).join(' vs ')}</div>\r\n          )}\r\n        </div>\r\n        {bullActive && (\r\n          <div className=\"mt-6 flex items-center justify-center gap-4\">\r\n            <div className=\"text-sm opacity-70\">Bull-up round: indicate result</div>\r\n            <div className=\"flex gap-3\">\r\n              <button className=\"btn btn-primary\" onClick={() => { try { if (onBullThrow) onBullThrow(50) } catch {} }}>Hit (Bull 50)</button>\r\n              <button className=\"btn btn-ghost\" onClick={() => { try { if (onBullThrow) onBullThrow(0) } catch {} }}>Miss</button>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div className=\"mt-4 text-sm text-center opacity-80\">\r\n          {bullActive ? 'Bull-up active â€” throw to win the tie!' : ''}\r\n          {Object.keys(choices || {}).length > 0 && (\r\n            <div className=\"mt-2\">Choices: {Object.entries(choices).map(([id, choice]) => `${id}:${choice}`).join(', ')}</div>\r\n          )}\r\n        </div>\r\n          </div>\r\n          </div>\r\n  </FocusLock>\r\n      </div>\r\n    </div>\r\n  )\r\n  return createPortal(\r\n    <>\r\n      {showCalibration && <CalibrationPopup />}\r\n      {overlay}\r\n    </>,\r\n    document.body\r\n  )\r\n}\r\n"],"names":["StatBlock","label","value","className","scale","jsxs","jsx","PlayerCalibrationPreview","player","user","playerCalibrations","canvasRef","useRef","isCalibrated","useEffect","canvas","ctx","centerX","centerY","radius","x","y","MatchStartShowcase","players","onDone","initialSeconds","roomId","onChoice","choices","bullActive","onBullThrow","seconds","setSeconds","useState","scaleState","setScaleState","visible","setVisible","showCalibration","setShowCalibration","calibrationSkipped","setCalibrationSkipped","setPlayerCalibrations","hostRef","startNowRef","closeRef","prevActiveElement","appRoot","prevAria","t","allPlayersSkipped","s","onKey","e","p","canStartMatch","calibs","H","imageSize","locked","useCalibration","res","data","err","stats","useMemo","avg3","getAllTimeAvg","best9","getAllTimeFirstNineAvg","bestCheckout","getAllTimeBestCheckout","bestLeg","getAllTimeBestLeg","getAllTime","career180s","getAllTime180s","match180s","L","v","one80s","CalibrationPopup","skippedPlayers","remainingPlayers","skipped","prev","getScaleFor","overlay","FocusLock","st","n","id","choice","createPortal","Fragment"],"mappings":"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"}
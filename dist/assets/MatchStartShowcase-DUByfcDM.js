import{V as de,W as Se,X as Pe,Y as Te,Z as $e,_ as Ee,j as e,$ as Fe,a0 as ge,u as V,a as ve,a1 as Re,b as Ie,O as Ue,a2 as Le,a3 as Oe,g as Be,a4 as Ae,a5 as De,r as Me}from"./index-C9Fg5ycR.js";import{N as he,O as be,R as we,Z as ye,Q as We,r as c}from"./ui-TGGq-Ewx.js";function lt({gameMode:r,compact:a=!1,onRecalibrate:i}){const{H:d,errorPx:m,confidence:x}=de(),h=Se(r,m),p=Pe(r,m),{text:f}=Te(r,m),n=$e(r),o=Fe[r],N=typeof x=="number"?x:Ee(m),y=typeof N=="number"&&Math.abs(N-h)>=.5,C=!!d;if(!C)return a?e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30",children:[e.jsx(he,{className:"w-3 h-3"}),"Not calibrated âŒ"]}):e.jsxs("div",{className:"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-red-300",children:"Calibration Required âš ï¸"}),e.jsxs("div",{className:"text-xs opacity-80",children:["Please calibrate before playing ",r]})]}),i&&e.jsx("button",{className:"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700",onClick:i,children:"Calibrate ðŸ“"})]});if(C&&(m==null||Number.isNaN(m)))return a?e.jsxs("div",{className:"text-xs px-2 py-1 rounded inline-flex items-center gap-1 border bg-emerald-500/20 border-emerald-600/30 text-emerald-300",children:[e.jsx(be,{className:"w-3 h-3"}),"Calibrated âœ…"]}):e.jsx("div",{className:"px-3 py-2 rounded border bg-emerald-500/20 border-emerald-600/30 space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-emerald-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-emerald-300",children:["Calibration for ",r]}),e.jsx("div",{className:"text-xs opacity-80",children:"Calibrated (quality pending) â³"})]})]})});const j=f.includes("Perfect"),P=j?"bg-indigo-500/20 border-indigo-600/30":p?"bg-emerald-500/20 border-emerald-600/30":"bg-amber-500/20 border-amber-600/30",k=j?"text-indigo-300":p?"text-emerald-300":"text-amber-300",$=j?ye:p?be:he;return a?e.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${P} ${k}`,children:[we.createElement($,{className:"w-3 h-3"}),e.jsxs("span",{className:"flex flex-wrap gap-x-1",children:[e.jsx("span",{children:f}),typeof N=="number"&&e.jsxs("span",{children:["Â· Raw ",N.toFixed(1),"%"]}),y&&e.jsx("span",{children:`Â· ${r}: ${h.toFixed(1)}%`})]}),!p&&n&&e.jsx("span",{className:"w-3 h-3 cursor-help",title:n,children:e.jsx(We,{className:"w-3 h-3 inline"})})]}):e.jsxs("div",{className:`px-3 py-2 rounded border ${P} space-y-1`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[we.createElement($,{className:`w-4 h-4 ${j?"text-indigo-400":p?"text-emerald-400":"text-amber-400"} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`font-medium ${j?"text-indigo-300":p?"text-emerald-300":"text-amber-300"}`,children:["Calibration for ",r]}),e.jsxs("div",{className:"text-xs opacity-80 flex flex-wrap gap-x-2 gap-y-1",children:[e.jsxs("span",{children:["Error: ",m!==null?`${m.toFixed(2)}px`:"Unknown"]}),e.jsx("span",{children:f}),typeof N=="number"&&e.jsxs("span",{children:["Raw: ",N.toFixed(1),"%"]}),y&&e.jsx("span",{children:`${r}: ${h.toFixed(1)}%`})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 rounded bg-black/30 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${j?"bg-indigo-500":p?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Math.min(100,h)}%`}})}),e.jsxs("span",{className:"text-xs font-mono",children:[h.toFixed(1),"%"]})]}),o&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{children:["Tolerance: Â±",o.tolerancePx,"px | Min:"," ",o.minConfidence,"%"]})}),e.jsxs("div",{className:"space-y-1",children:[!p&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3 flex-shrink-0"}),"Calibration quality is below minimum for ",r]}),n&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3 flex-shrink-0"}),n]})]}),!p&&i&&e.jsxs("button",{className:"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700",onClick:i,children:["Recalibrate for ",r]})]})}function He({players:r,playerCalibrations:a,calibrationSkipped:i,onSkip:d,onOpenCalibrator:m,onClose:x}){const h=r.filter(n=>i[n.id]),p=r.filter(n=>!i[n.id]),f=p.length===0;return e.jsx("div",{className:"fixed inset-0 z-60 overflow-y-auto bg-black/90 backdrop-blur-sm py-8 px-4",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full mx-auto shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"Calibration Check ðŸŽ¯"}),e.jsx("p",{className:"text-sm opacity-70 mb-6 text-center",children:"Check your dartboard calibration before the match starts ðŸŽ¯. Both players must skip or confirm to begin ðŸŽ¯."}),h.length>0&&p.length>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[h.map(n=>n.name).join(", ")," ",h.length===1?"has":"have"," chosen to skip ðŸŽ¯."," ",p.map(n=>n.name).join(", "),", would you like to skip as well ðŸŽ¯?"]})}),e.jsx("div",{className:"space-y-4",children:r.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:n.name.split(" ").map(o=>o[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:n.name}),e.jsx("div",{className:"text-xs text-slate-400",children:a[n.name]?"Calibrated âœ…":"Needs calibration"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>m(n.id),children:"Bull Up ðŸŽ¯"}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>d(n.id),disabled:!!i[n.id],children:i[n.id]?"Skipped âœ“":"Skip ðŸŽ¯"})]})]},n.id))}),e.jsx("div",{className:"mt-6 flex justify-center gap-4",children:e.jsx("button",{className:`btn ${f?"btn-primary":"btn-ghost opacity-50 cursor-not-allowed"}`,disabled:!f,onClick:x,children:"Start Match ðŸŽ¯"})})]})})}async function Ve(){const r=[];try{const a=await _e();for(const i of a){const d=await qe(i,[80,8080,8787,8788,3e3,5e3]);for(const m of d){const x=await Qe(m.ip,m.port);x&&r.push(x)}}}catch(a){console.error("Network discovery failed:",a)}return r}async function _e(){const r=[];try{const a=new RTCPeerConnection({iceServers:[]});a.createDataChannel("");const i=await a.createOffer();return await a.setLocalDescription(i),new Promise(d=>{const m=setTimeout(()=>{a.close(),d(r)},5e3);a.onicecandidate=x=>{if(x.candidate){const p=x.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(p&&p[1]&&!r.includes(p[1])){const f=p[1];Ge(f)&&r.push(f)}}else clearTimeout(m),a.close(),d(r)}})}catch(a){return console.error("Failed to get local IPs:",a),["192.168.1.0"]}}function Ge(r){const a=r.split(".").map(Number);return a[0]===10||a[0]===172&&a[1]>=16&&a[1]<=31||a[0]===192&&a[1]===168}async function qe(r,a){const i=[],d=r.split(".").slice(0,3).join("."),m=[];for(let h=1;h<=254;h++){const p=`${d}.${h}`;for(const f of a)m.push(Je(p,f))}return(await Promise.allSettled(m)).forEach((h,p)=>{if(h.status==="fulfilled"&&h.value){const f=p%a.length,n=Math.floor(p/a.length),o=`${d}.${n+1}`;i.push({ip:o,port:a[f]})}}),i}async function Je(r,a){try{const i=await fetch(`http://${r}:${a}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(2e3)});return!0}catch{return!1}}async function Qe(r,a){try{const i=["/","/api/info","/api/status","/camera","/stream"];for(const d of i)try{const m=await fetch(`http://${r}:${a}${d}`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(m.ok){const x=m.headers.get("content-type")||"",h=await m.text();if(h.includes("OMNI")||h.includes("omni")||d.includes("omni"))return{id:`omni-${r}-${a}`,name:`OMNI Camera (${r})`,ip:r,port:a,type:"omni",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(h.includes("VERT")||h.includes("vert")||d.includes("vert"))return{id:`vert-${r}-${a}`,name:`VERT Camera (${r})`,ip:r,port:a,type:"vert",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(x.includes("video")||h.includes("stream")||d==="/stream")return{id:`generic-${r}-${a}`,name:`Network Camera (${r})`,ip:r,port:a,type:"generic",capabilities:["video"],status:"online",connectionType:"wifi"}}}catch{}}catch(i){console.error(`Failed to probe device ${r}:${a}:`,i)}return null}async function Ye(){const r=[];try{if(!("serial"in navigator))return console.warn("Web Serial API not supported in this browser"),r;const a=await navigator.serial.getPorts();for(const i of a){const d=await je(i);d&&r.push(d)}}catch(a){console.error("USB device discovery failed:",a)}return r}async function Ze(){try{if(!("serial"in navigator))return alert("Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge."),null;const r=await navigator.serial.requestPort();return await je(r)}catch(r){return r.name!=="NotFoundError"&&console.error("USB device request failed:",r),null}}async function je(r){try{await r.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none"});const a=r.readable?.getReader();if(a)try{const i=setTimeout(()=>a.cancel(),2e3),{value:d,done:m}=await a.read();if(clearTimeout(i),!m&&d){const x=new TextDecoder().decode(d);if(x.includes("OMNI")||x.includes("omni"))return a.releaseLock(),{id:`usb-omni-${Date.now()}`,name:"OMNI Camera (USB)",type:"omni",capabilities:["video","calibration"],status:"online",port:r};if(x.includes("VERT")||x.includes("vert"))return a.releaseLock(),{id:`usb-vert-${Date.now()}`,name:"VERT Camera (USB)",type:"vert",capabilities:["video","calibration"],status:"online",port:r}}}catch{}finally{try{a.releaseLock()}catch{}}return{id:`usb-generic-${Date.now()}`,name:"USB Scoring Device",type:"generic",capabilities:["video"],status:"online",port:r}}catch(a){return console.error("Failed to probe USB device:",a),null}}async function Xe(r){try{const a=`http://${r.ip}:${r.port}/stream`,i=document.createElement("video");return i.src=a,i.crossOrigin="anonymous",new Promise((d,m)=>{i.onloadeddata=()=>{const x=document.createElement("canvas"),h=x.getContext("2d");x.width=i.videoWidth,x.height=i.videoHeight;const p=x.captureStream(30),f=()=>{i.readyState>=2&&h.drawImage(i,0,0),requestAnimationFrame(f)};f(),d(p)},i.onerror=()=>m(new Error("Failed to load video stream")),i.load()})}catch(a){return console.error("Failed to connect to network device:",a),null}}async function Ke(r){try{if(!r.port)throw new Error("No serial port available");return console.log("USB device connection not fully implemented yet"),null}catch(a){return console.error("Failed to connect to USB device:",a),null}}function ze({label:r,autoStart:a,forceAutoStart:i=!1,scale:d,className:m,aspect:x="inherit",style:h,fill:p=!1,tileFitModeOverride:f}){const n=c.useRef(null),o=ge(),[N,y]=c.useState(!1),[C,j]=c.useState(null),[P,k]=c.useState(null),[$,_]=c.useState(null),q=c.useRef(null);c.useEffect(()=>()=>{},[o]);const B=c.useCallback((t,l="local")=>{try{t?(o.setMediaStream(t),n.current,o.setMode(l),o.setStreaming(!0),q.current=l):q.current&&q.current!=="phone"&&(o.setStreaming(!1),o.setMediaStream(null),q.current=null)}catch(u){console.warn("[CameraTile] Failed to register stream with camera session:",u)}},[o]),G=c.useCallback(async()=>{try{const t=o.getMediaStream();if(!t)return console.log("[CameraTile] attachExistingStream: No existing stream found"),!1;if(!n.current)return console.log("[CameraTile] attachExistingStream: No video ref"),!1;n.current.srcObject!==t&&(console.log("[CameraTile] Attaching existing stream to video element",t.id),n.current.srcObject=t),n.current.muted=!0,n.current.playsInline=!0;try{await n.current.play(),console.log("[CameraTile] Video playing")}catch(l){console.warn("[CameraTile] Play failed:",l)}return y(!0),!0}catch(t){return console.warn("[CameraTile] Failed to reuse global camera stream",t),!1}},[o]),R=V(t=>t.preferredCameraLabel),[T,A]=c.useState(()=>R==="Phone Camera"?"phone":localStorage.getItem("ndn:camera:mode")||"local"),[,Y]=c.useState(null),[,Z]=c.useState(!1),[X,te]=c.useState(null),[D,ae]=c.useState(null),[se,U]=c.useState(!0),[ne,K]=c.useState([]),[me,s]=c.useState(!1),[w,v]=c.useState([]),[S,I]=c.useState(!1),L=V(t=>t.autoscoreProvider),M=V(t=>t.cameraEnabled),W=V(t=>t.setPreferredCameraLocked),ie=V(t=>t.preferredCameraLocked),z=V(t=>t.setPreferredCamera),ce=V(t=>t.preferredCameraId);if(L==="manual"&&!i){const l=[p?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",m].filter(Boolean).join(" ").trim(),u={...h||{}};return!p&&u.aspectRatio===void 0&&u.height===void 0&&u.minHeight===void 0&&(u.aspectRatio="4 / 3"),e.jsx("div",{className:l,style:u,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}c.useEffect(()=>{const t=window.location.hostname;(t==="localhost"||t==="127.0.0.1")&&ve("/api/hosts").then(l=>l.json()).then(l=>{const u=Array.isArray(l?.hosts)&&l.hosts.find(b=>b);u&&te(u)}).catch(()=>{}),ve("/api/https-info").then(l=>l.json()).then(l=>{l&&typeof l.https=="boolean"&&ae({https:!!l.https,port:Number(l.port)||8788})}).catch(()=>{})},[]);const ue=c.useMemo(()=>{const t=P||"____",l="ws://localhost:8787";if(l.length>0)try{const F=new URL(l);return`${`${F.protocol==="wss:"?"https":"http"}://${F.host}${F.pathname.endsWith("/ws")?"":F.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${t}`}catch{}const u=X||window.location.hostname,b=!!D?.https,re=b?D?.port||8788:8787;return`${b?"https":"http"}://${u}:${re}/mobile-cam.html?code=${t}`},[P,X,D]);c.useEffect(()=>{localStorage.setItem("ndn:camera:mode",T)},[T]),c.useEffect(()=>{o.isStreaming&&G()},[o.isStreaming,G]);const[J,oe]=c.useState(null);c.useEffect(()=>{V.getState().ignorePreferredCameraSync||J&&Date.now()-J<3e4||R==="Phone Camera"&&T!=="phone"&&A("phone")},[R,T,J]),c.useEffect(()=>{const t=async()=>{try{if(!(R==="Phone Camera"&&(!J||Date.now()-J>=3e4)||T==="phone"))return;const Q=o.getMediaStream(),F=n.current;if(!F||!Q)return;F.srcObject!==Q&&(F.srcObject=Q),F.muted=!0,F.playsInline=!0;try{await F.play()}catch{}return y(!0),!0}catch{}return!1};let l=!1,u=null;const b=re=>{if(re&&u&&!l){l=!0;try{clearInterval(u)}catch{}}};return Promise.resolve(t()).then(b).catch(()=>{}),u=setInterval(()=>{Promise.resolve(t()).then(b).catch(()=>{})},800),()=>{try{u&&clearInterval(u)}catch{}}},[R,T,o,o.isStreaming]);const O=c.useCallback(async()=>{if(console.log("[CameraTile] start() invoked with mode=",T),await G()){console.log("[CameraTile] Reused calibrated global stream");return}if(T==="wifi")return ee();if(console.log("[CameraTile] Attempting to attach global stream for phone mode..."),R==="Phone Camera"||T==="phone"){const t=o.getMediaStream();if(t&&n.current)try{n.current.srcObject=t,await n.current.play(),y(!0);return}catch{}if(T==="phone")try{await le();return}catch{}}try{const t=o.getMediaStream?.();if(t&&n.current){n.current.srcObject=t,await n.current.play(),y(!0);return}}catch{}},[T,R,o,B,le,ee,G]);c.useEffect(()=>{const t=n.current;if(!t){console.log("[CameraTile] Failsafe: No video ref");return}const l=o.getMediaStream?.();if(l)try{t.srcObject!==l&&(console.log("[CameraTile] Failsafe: Attaching stream",l.id),t.srcObject=l),t.muted=!0,t.playsInline=!0,Promise.resolve(t.play()).then(()=>console.log("[CameraTile] Failsafe: Playing")).catch(u=>console.warn("[CameraTile] Failsafe play error",u)),y(!0);return}catch{}else console.log("[CameraTile] Failsafe: No stream in session");(i||a)&&(console.log("[CameraTile] Failsafe: Triggering start()"),O().catch(()=>{}))},[o,i,a,O,o.isStreaming]);const fe=c.useCallback(()=>{if(n.current&&n.current.srcObject){try{n.current.srcObject=null}catch{}y(!1);try{B(null)}catch{}}},[B]);c.useEffect(()=>{if(!(!i&&(!M||L&&L!=="built-in"&&L!=="external-ws"))&&!(a===void 0&&!i)){if(a||i){let t=!1;const l=R||"default",u=window.setTimeout(()=>{t||N||O().catch(b=>console.warn(`[CameraTile] Auto-start failed for ${l}:`,b))},200);return()=>{t=!0,window.clearTimeout(u)}}fe()}},[a,i,N,M,L,R,O,fe]);async function ee(){s(!0);try{const t=await Ve();K(t),t.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(t){console.error("Wifi device discovery failed:",t),alert("Failed to discover wifi devices. Please check your network connection.")}finally{s(!1)}}async function g(t){try{K(u=>u.map(b=>b.id===t.id?{...b,status:"connecting"}:b));const l=await Xe(t);if(l&&n.current)n.current.srcObject=l,await n.current.play(),y(!0),B(l,"wifi"),K(u=>u.map(b=>b.id===t.id?{...b,status:"online"}:b));else throw new Error("Failed to get video stream")}catch(l){console.error("Failed to connect to wifi device:",l),alert(`Failed to connect to ${t.name}. Please check the device and try again.`),K(u=>u.map(b=>b.id===t.id?{...b,status:"offline"}:b))}}async function E(){I(!0);try{const t=await Ye();v(t);const l=await Ze();l&&v(u=>[...u,l]),t.length===0&&!l&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(t){console.error("USB device discovery failed:",t),alert("Failed to discover USB devices. Please check device connections.")}finally{I(!1)}}async function H(t){try{v(u=>u.map(b=>b.id===t.id?{...b,status:"connecting"}:b));const l=await Ke(t);if(l&&n.current)n.current.srcObject=l,await n.current.play(),y(!0),A("wifi"),B(l,"wifi"),v(u=>u.map(b=>b.id===t.id?{...b,status:"online"}:b));else throw new Error("Failed to get video stream")}catch(l){console.error("Failed to connect to USB device:",l),alert(`Failed to connect to ${t.name}. Please check the device and try again.`),v(u=>u.map(b=>b.id===t.id?{...b,status:"offline"}:b))}}const pe=c.useCallback(t=>{try{A(t==="usb"?"wifi":t),oe(Date.now());try{if(t==="local"){try{z(ce,"Local",!0)}catch{}try{W(!0)}catch{}}else if(t==="phone"){try{z(void 0,"Phone Camera",!0)}catch{}try{W(!0)}catch{}}else if(t==="wifi"||t==="usb"){try{z(void 0,"WiFi/USB",!0)}catch{}try{W(!0)}catch{}}}catch{}t==="local"?O().catch(()=>{}):t==="phone"?le():t==="wifi"?ee():t==="usb"&&E()}catch(l){console.warn("[CameraTile] handleModeSelect failed",l)}},[O,le,ee,E,z,W,ce]);c.useEffect(()=>{const t=l=>{try{const u=l&&l.detail&&l.detail.mode;u&&["local","phone","wifi","usb"].includes(u)?(pe(u),O().catch(()=>{})):O().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",t),()=>{window.removeEventListener("ndn:start-camera",t)}},[O,pe]);function Ne(){if(C&&C.readyState===WebSocket.OPEN)return C;const t=Re(),l=new WebSocket(t);return j(l),l}async function le(){A("phone"),Z(!1);const t=Ne();t.readyState===WebSocket.OPEN?t.send(JSON.stringify({type:"cam-create"})):t.onopen=()=>t.send(JSON.stringify({type:"cam-create"})),t.onmessage=async l=>{const u=JSON.parse(l.data);if(u.type==="cam-code")k(u.code),u.expiresAt&&Y(u.expiresAt);else if(u.type==="cam-peer-joined"){Z(!0);const b=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});_(b),b.onicecandidate=Q=>{Q.candidate&&P&&t.send(JSON.stringify({type:"cam-ice",code:P,payload:Q.candidate}))},b.ontrack=Q=>{if(n.current){const F=Q.streams?.[0];F&&(n.current.srcObject=F,n.current.play().catch(()=>{}),y(!0))}};const re=await b.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await b.setLocalDescription(re),P&&t.send(JSON.stringify({type:"cam-offer",code:P,payload:re}))}else if(u.type==="cam-answer")$&&await $.setRemoteDescription(new RTCSessionDescription(u.payload));else if(u.type==="cam-ice"&&$)try{await $.addIceCandidate(u.payload)}catch{}}}function Ce(){k(null),Y(null),Z(!1),C&&C.readyState===WebSocket.OPEN?C.send(JSON.stringify({type:"cam-create"})):le();try{W(!0)}catch{}}function ke(){if(fe(),k(null),Z(!1),Y(null),$){try{$.close()}catch{}_(null)}}return e.jsx(et,{label:r,autoStart:a,start:O,stopAll:ke,startPhonePairing:le,startWifiConnection:ee,startUsbConnection:E,connectToWifiDevice:g,connectToUsbDevice:H,videoRef:n,streaming:N,mode:T,setMode:A,pairCode:P,mobileUrl:ue,regenerateCode:Ce,httpsInfo:D,showTips:se,setShowTips:U,wifiDevices:ne,usbDevices:w,discoveringWifi:me,discoveringUsb:S,scaleOverride:d,tileFitModeOverride:f,className:m,aspect:x,style:h,fill:p,onModeSelect:pe,preferredCameraLocked:ie})}function et(r){const a=ge(),{cameraScale:i,cameraAspect:d}=V(),{label:m,start:x,stopAll:h,startPhonePairing:p,startWifiConnection:f,startUsbConnection:n,connectToWifiDevice:o,connectToUsbDevice:N,videoRef:y,streaming:C,mode:j,setMode:P,onModeSelect:k,pairCode:$,mobileUrl:_,regenerateCode:q,httpsInfo:B,showTips:G,setShowTips:R,wifiDevices:T,usbDevices:A,discoveringWifi:Y,discoveringUsb:Z,scaleOverride:X,tileFitModeOverride:te,className:D,aspect:ae,style:se,fill:U,preferredCameraLocked:ne}=r,K={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},me=c.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{k&&k("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{k&&k("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{k&&k("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{k&&k("usb")}}],[P,x,p,f,n]),[s,w]=c.useState(null),v=c.useRef(null);c.useEffect(()=>()=>{v.current&&window.clearTimeout(v.current)},[]);const{cameraFitMode:S}=V(),I=te||(U?"fill":S||"fill"),L=(()=>{const g=Number(X??i??1),E=Math.max(.5,Math.min(2,g));return I==="fill"?Math.max(1,E):E})(),M=U&&I==="fill"?"free":ae&&ae!=="inherit"?ae:d||"wide",W=M!=="free",ie=W?M==="square"?"aspect-square":M==="portrait"?"aspect-[3/4]":M==="classic"?"aspect-[4/3]":"aspect-video":"",ce=[U?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",D].filter(Boolean).join(" ").trim(),ue={...se||{}},J=U?"relative flex-1 min-h-0 bg-black":"relative w-full bg-black",oe={style:{transform:`scale(${L})`,transformOrigin:"center"}},O=j==="wifi"&&A.some(g=>g.status==="online"),fe=(()=>{const E=I==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return U?W?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${ie}`,children:e.jsx("video",{ref:y,className:E,...oe,autoPlay:!0,playsInline:!0,muted:!0})})}):e.jsx("video",{ref:y,className:E,...oe,autoPlay:!0,playsInline:!0,muted:!0}):W?e.jsx("div",{className:`relative w-full ${ie}`,children:e.jsx("video",{ref:y,className:E,...oe,autoPlay:!0,playsInline:!0,muted:!0})}):e.jsx("div",{className:"relative w-full",children:e.jsx("video",{ref:y,className:E,...oe,autoPlay:!0,playsInline:!0,muted:!0})})})();async function ee(g,E){if(g)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(g);else{const H=document.createElement("textarea");H.value=g,H.style.position="fixed",H.style.opacity="0",document.body.appendChild(H),H.focus(),H.select(),document.execCommand("copy"),document.body.removeChild(H)}w(E),v.current&&window.clearTimeout(v.current),v.current=window.setTimeout(()=>w(null),1500)}catch(H){console.warn("Copy to clipboard failed:",H),w(null)}}return e.jsxs("div",{className:ce,style:ue,children:[e.jsxs("div",{className:J,children:[fe,a.isStreaming&&j==="phone"&&e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{children:"REC"})]})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[e.jsxs("span",{className:"truncate font-medium",children:[m||(C?j==="phone"?"PHONE LIVE":j==="wifi"?"WIFI LIVE":"LIVE":"Camera"),ne&&e.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!C&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${j==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("local"),children:"Local"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${j==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("phone"),children:"Phone"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${j==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("wifi"),children:"WiFi"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${j==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("usb"),children:"USB"})]}),C?e.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:h,children:"Stop"}):null]})]}),j==="phone"&&$&&!C&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>ee(_,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:_}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:s==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:_,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>ee($,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:$}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:s==="code"?"Copied!":"Copy"})]})]}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:q,children:"Regenerate"})}),G&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wi-Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and"," ",B?.https?B.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>R(!1),children:"Hide tips"})})]})]}),j==="wifi"&&!C&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),Y?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):T.length>0?e.jsxs("div",{className:"space-y-1",children:[T.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:g.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[g.ip,":",g.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${g.status==="connecting"?"bg-yellow-600":g.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>o(g),disabled:g.status==="connecting",children:g.status==="connecting"?"...":"Connect"})]},g.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:f,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:f,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),Z?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):A.length>0?e.jsxs("div",{className:"space-y-1",children:[A.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:g.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:g.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${g.status==="connecting"?"bg-yellow-600":g.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>N(g),disabled:g.status==="connecting",children:g.status==="connecting"?"...":"Connect ðŸ”Œ"})]},g.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:n,children:"Rescan USB ðŸ”"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found âŒ"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:n,children:"Scan USB ðŸ”"})]})]})]}),!C&&e.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes âš™ï¸"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera ðŸ”„"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",K[j]||"Local"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:me.map(g=>{const E=g.id==="usb"?O:g.id===j;return e.jsxs("button",{type:"button",onClick:g.action,className:`text-left p-3 rounded-2xl border ${E?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:g.title}),e.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:g.description}),E&&e.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active âœ…"})]},g.id)})})]})]})}const xe=c.memo(function({label:a,value:i,className:d="",scale:m=1}){return e.jsxs("div",{className:`flex flex-col items-center gap-0 ${d}`,children:[e.jsx("div",{className:"text-[8px] opacity-70 uppercase font-bold tracking-tighter leading-none",children:a}),e.jsx("div",{className:"text-sm sm:text-base font-black transform transition-transform duration-200 ease-out leading-none",style:{transform:`scale(${m})`},children:i})]})}),tt=c.memo(function({player:a,user:i,playerCalibrations:d}){const m=c.useRef(null),x=d[a.name],h=de(n=>!!n.H),f=!!(i?.username&&a?.name&&a.name.toLowerCase()===i.username.toLowerCase()||a?.name==="You")?h:!!x;return c.useEffect(()=>{const n=m.current;if(!n)return;const o=n.getContext("2d");if(!o)return;const N=n.width/2,y=n.height/2,C=Math.min(N,y)-2;o.clearRect(0,0,n.width,n.height);try{typeof o.stroke=="function"&&(o.strokeStyle="#fff",o.lineWidth=1,o.beginPath(),o.arc(N,y,C,0,2*Math.PI),o.stroke()),typeof o.fill=="function"&&(o.fillStyle="#f00",o.beginPath(),o.arc(N,y,4,0,2*Math.PI),o.fill())}catch{}if(f)try{typeof o.fill=="function"&&(o.fillStyle="#0f0"),[[N-C*.5,y],[N+C*.5,y],[N,y-C*.5],[N,y+C*.5]].forEach(([P,k])=>{try{typeof o.beginPath=="function"&&o.beginPath(),typeof o.arc=="function"&&o.arc(P,k,2,0,2*Math.PI),typeof o.fill=="function"&&o.fill()}catch{}})}catch{}},[f]),e.jsxs("div",{className:"flex items-center gap-2 mt-1 bg-white/5 p-1.5 rounded-lg border border-white/10",children:[e.jsx("canvas",{ref:m,width:40,height:40,className:"border border-white/20 rounded-md bg-black/60 shadow-inner"}),e.jsx("span",{className:`text-xs font-black tracking-tight ${f?"text-emerald-400":"text-rose-400/70"}`,children:f?"Calibrated âœ…":"Not Calibrated âŒ"})]})}),at=c.memo(function({player:a,limit:i=3}){const d=[];try{const m=a.legs||[];for(let x=m.length-1;x>=0&&d.length<i;x--){const p=m[x].visits||[];for(let f=p.length-1;f>=0&&d.length<i;f--){const n=p[f];d.push({score:Number(n?.score||0),darts:Number(n?.darts||3)})}}}catch{}return d.length?e.jsx("div",{className:"flex gap-1 items-center",children:d.map((m,x)=>e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded-md font-black shadow-sm ${m.score>=100?"bg-emerald-600/70 text-emerald-300 ring-1 ring-emerald-500/50":m.score>=60?"bg-amber-500/60 text-amber-300 ring-1 ring-amber-500/50":"bg-white/20 text-gray-200 ring-1 ring-white/20"}`,children:m.score},x))}):e.jsx("div",{className:"text-[10px] opacity-60",children:"No visits ðŸ“‰"})}),st=c.memo(function({secondsLeft:a,totalSeconds:i,size:d=60,stroke:m=6,color:x="emerald"}){const h=(d-m)/2,p=2*Math.PI*h,f=Math.max(0,Math.min(1,i>0?a/i:0)),n=p*(1-f),o=x==="emerald"?"#34d399":"#f59e0b";return e.jsxs("svg",{width:d,height:d,viewBox:`0 0 ${d} ${d}`,"aria-hidden":!0,children:[e.jsx("defs",{children:e.jsx("filter",{id:"softShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"3",floodColor:"#000",floodOpacity:"0.45"})})}),e.jsx("circle",{cx:d/2,cy:d/2,r:h,fill:"transparent",stroke:"rgba(255,255,255,0.06)",strokeWidth:m}),e.jsx("circle",{cx:d/2,cy:d/2,r:h,fill:"transparent",stroke:o,strokeWidth:m,strokeLinecap:"round",strokeDasharray:p,strokeDashoffset:n,transform:`rotate(-90 ${d/2} ${d/2})`,style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.4))"}}),e.jsx("text",{x:"50%",y:"50%",fill:"white",fontSize:d*.28,fontWeight:900,dominantBaseline:"middle",textAnchor:"middle",children:a>0?a:"GO"})]})});function dt({open:r=!0,players:a,user:i,onDone:d,onRequestClose:m,initialSeconds:x=15,showCalibrationDefault:h=!1,disableEscClose:p=!1}){const[f,n]=c.useState(x||15),o=!!r,N=ge(),y=V.getState().setCameraEnabled,C=de(s=>!!s.H),j=de(s=>!!s.locked),P=de(s=>s.confidence),k=c.useMemo(()=>({hasHomography:C,locked:j,confidence:P}),[C,j,P]),$=N.isStreaming&&k.hasHomography,[_,q]=c.useState(!1),[B,G]=c.useState(()=>{const s={};if(!h)for(const w of a)s[w.id]=!0;return s}),[R,T]=c.useState({}),A=c.useRef(null),Y=c.useRef(null),Z=c.useRef(null),X=c.useRef(null),te=c.useRef(!1);c.useEffect(()=>(te.current=!0,()=>{te.current=!1}),[]),c.useEffect(()=>{h||G(s=>{const w={...s};for(const v of a)w[v.id]||(w[v.id]=!0);return w})},[a,h]);const D=a.every(s=>B[s.id]);c.useEffect(()=>{if(!o)return;try{y(!0)}catch{}try{N.getMediaStream()&&!N.isStreaming&&N.setStreaming(!0),N.setShowOverlay?.(!0)}catch{}try{setTimeout(()=>{try{Y.current?.focus()}catch{}},0)}catch{}try{X.current=document.activeElement}catch{}const s=document.getElementById("root");try{s&&s.setAttribute("aria-hidden","true")}catch{}const w=D?setInterval(()=>n(S=>S<=0?0:S-1),1e3):null,v=S=>{if(te.current&&!p&&(S.key==="Escape"||S.key==="Esc")){S.preventDefault();try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}try{X.current?.focus()}catch{}}};return document.addEventListener("keydown",v),()=>{try{s&&s.removeAttribute("aria-hidden")}catch{}w&&clearInterval(w),document.removeEventListener("keydown",v)}},[o,p,m,D]),c.useEffect(()=>{o&&(h&&f===(x||15)&&!_&&(q(!0),(async()=>{const w={};for(const v of a)if(i?.username&&v.name===i.username){const{H:S,imageSize:I,overlaySize:L,locked:M}=de.getState();S&&(w[v.name]={H:S,imageSize:I,overlaySize:L,locked:M})}else try{const S=await fetch(`/api/users/${encodeURIComponent(v.name)}/calibration`);if(S.ok){const I=await S.json();I.calibration&&(w[v.name]=I.calibration)}}catch(S){console.warn("Failed to fetch calibration for",v.name,S)}T(w)})()),D&&f<=0&&setTimeout(()=>{try{d?.()}catch{}try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}try{X.current?.focus()}catch{}},1e3))},[f,d,o,_,D,a,i]);const ae=c.useMemo(()=>a.map(s=>{try{const w=Ie(s.name),v=Ue(s.name),S=Le(s.name),I=Oe(s.name),L=Be(s.name),M=L.scored||0,W=L.darts||0,ie=Ae(s.name);let z=0;try{for(const ue of s.legs||[])for(const J of ue.visits||[])Number(J.score||0)===180&&(z+=1)}catch{}const ce=`${z}/${ie}`;return{id:s.id,name:s.name,avg3:w.toFixed(1),best9:v.toFixed(1),bestCheckout:S,bestLeg:I,one80s:ce,lifetimeScored:M,lifetimeDarts:W}}catch{return{id:s.id,name:s.name,avg3:"â€”",best9:"â€”",bestCheckout:"â€”",bestLeg:"â€”",one80s:"â€”",lifetimeScored:0,lifetimeDarts:0}}}),[a]),se=c.useRef(typeof document<"u"?document.createElement("div"):null);c.useLayoutEffect(()=>{if(!se.current)return;const s=se.current;s.className="ndn-match-start-portal";try{Array.from(document.querySelectorAll(".ndn-match-start-portal")).forEach(v=>{try{v.parentNode?.removeChild(v)}catch{}})}catch{}return document.body.appendChild(s),()=>{try{s&&s.parentNode&&s.parentNode.removeChild(s)}catch{}}},[]);const U=c.useCallback(s=>s<=0?1.8:s===1?1.6:s===2?1.4:s===3?1.2:1,[]),ne=c.useMemo(()=>{const s=k.confidence;return typeof s=="number"?s:s&&typeof s=="object"&&typeof s.percentage=="number"?s.percentage:null},[k.confidence]),K=$?`Calibrated camera linked${typeof ne=="number"?` â€¢ ${ne.toFixed(0)}% confidence`:""}`:"Calibrate to link this camera feed";if(!o)return null;const me=e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black/90 backdrop-blur-sm",children:e.jsx("div",{className:"min-h-full flex items-center justify-center p-4 sm:p-6 lg:p-8",children:e.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"match-start-heading",tabIndex:-1,className:"w-full max-w-4xl",children:e.jsx(De,{returnFocus:!0,children:e.jsxs("div",{ref:A,className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-indigo-500/20 via-purple-500/20 to-emerald-500/20 rounded-[3rem] blur-3xl -z-10 opacity-50 animate-pulse"}),e.jsxs("div",{className:"bg-[#13111C] border border-white/10 rounded-3xl p-4 md:p-6 w-full shadow-2xl ring-1 ring-white/5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none mix-blend-overlay"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-center justify-between gap-3 mb-4 border-b border-white/5 pb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold text-indigo-400 uppercase tracking-widest mb-0.5",children:"Get Ready ðŸš€"}),e.jsx("div",{id:"match-start-heading",className:"text-2xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/10 tracking-tighter",children:"Match Starting Soon ðŸŽ¯"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500/70 blur-[4rem] rounded-full animate-pulse"}),e.jsxs("div",{className:"relative",children:[e.jsx(st,{secondsLeft:f,totalSeconds:x||15,size:60,stroke:6,color:f>5?"emerald":"amber"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-black text-white tabular-nums",children:f})})]})]})}),e.jsxs("div",{className:"flex flex-col gap-1.5 sm:flex-row",children:[e.jsx("button",{ref:Y,className:"px-4 py-1.5 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40 hover:scale-105 transition-all duration-200 active:scale-95 text-xs",onClick:()=>{try{d?.()}catch{}try{try{document.getElementById("root")?.removeAttribute("aria-hidden")}catch{}setTimeout(()=>{try{m?.()}catch{}},0)}catch{}},"aria-label":"Start match now",children:"Start Now â–¶ï¸"}),e.jsx("button",{ref:Z,className:"px-3 py-1.5 rounded-lg bg-white/5 text-white/70 font-semibold hover:bg-white/10 hover:text-white transition-colors text-xs","aria-label":"Close match start showcase",onClick:()=>{try{m?.()}catch{}},children:"Close âœ–ï¸"})]})]})]}),e.jsxs("div",{className:"relative grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-5 mb-4",children:[e.jsx("div",{className:"hidden md:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-20 w-16 h-16 bg-[#13111C] rounded-full items-center justify-center border-2 border-white/10 shadow-[0_0_30px_rgba(0,0,0,0.8)]",children:e.jsx("span",{className:"text-xl font-black text-white/20 italic tracking-tighter",children:"VS âš”ï¸"})}),ae.map((s,w)=>e.jsxs("div",{className:`group relative p-3 md:p-4 rounded-3xl border border-white/5 flex flex-col items-center shadow-xl transition-all duration-300 hover:border-white/10 hover:bg-white/[0.02] max-h-[80vh] overflow-hidden ${w===0?"bg-gradient-to-br from-indigo-500/5 to-transparent":"bg-gradient-to-bl from-emerald-500/5 to-transparent"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 w-full",children:[e.jsx("div",{className:`w-12 h-12 shrink-0 rounded-xl rotate-3 group-hover:rotate-6 transition-transform duration-300 flex items-center justify-center text-xl font-black text-white shadow-lg ring-2 ring-white/10 ${w===0?"bg-gradient-to-br from-indigo-500 to-purple-600 shadow-indigo-500/50":"bg-gradient-to-br from-emerald-500 to-teal-600 shadow-emerald-500/50"}`,children:s.name.split(" ").map(v=>v[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("div",{className:"text-2xl font-black text-white tracking-tighter truncate",children:s.name}),e.jsx("div",{className:"text-[10px] font-black tracking-tight text-white/60",children:s.one80s}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&i.username===s.name&&e.jsx("div",{className:"text-[0.5rem] font-bold uppercase tracking-wider bg-white/10 text-white/60 px-1.5 py-0.5 rounded-md",children:"You â­"}),e.jsx(tt,{player:a.find(v=>v.id===s.id),user:i,playerCalibrations:R})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 w-full bg-black/50 rounded-xl p-2 border border-white/10 shadow-2xl",children:[e.jsx(xe,{label:"Avg ðŸ“Š",value:s.avg3,scale:U(f)*.7,className:"p-0.5"}),e.jsx(xe,{label:"F9 ðŸ“ˆ",value:s.best9,scale:U(f)*.7,className:"p-0.5"}),e.jsx(xe,{label:"CO ðŸ†",value:s.bestCheckout||"â€”",scale:U(f)*.7,className:"p-0.5"}),e.jsx(xe,{label:"Leg âš¡",value:s.bestLeg||"â€”",scale:U(f)*.7,className:"p-0.5"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full mt-2 text-[0.6rem]",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"tracking-widest uppercase text-white/40",children:"Lifetime pts"}),e.jsx("span",{className:"text-white/90 font-semibold",children:s.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"tracking-widest uppercase text-white/40",children:"Lifetime darts"}),e.jsx("span",{className:"text-white/90 font-semibold",children:s.lifetimeDarts.toLocaleString()})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between w-full px-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/40 font-black",children:[e.jsx("span",{children:"180s ðŸ”¥:"}),e.jsxs("span",{className:"text-white/90",children:[s.one80s," âœ¨"]})]}),e.jsx(at,{player:a.find(v=>v.id===s.id),limit:3})]}),w===0&&e.jsx("div",{className:"w-full mt-2",children:e.jsxs("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/30 relative",children:[e.jsx("div",{className:`absolute top-3 left-3 px-3 py-1 rounded-full text-[0.6rem] font-bold tracking-wide uppercase shadow-lg ${$?"bg-emerald-500/90 text-emerald-50":"bg-rose-500/80 text-white"}`,children:K}),e.jsx("div",{className:"w-full h-[240px] sm:h-[300px] md:h-[360px] flex flex-col",children:e.jsx(ze,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",tileFitModeOverride:"fit",scale:1})})]})})]},s.id))]}),e.jsx("div",{className:"text-center pt-6 border-t border-white/50",children:f<=1?e.jsx("div",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 via-cyan-400 to-blue-400 animate-bounce tracking-tighter py-4",children:"GAME ON! ðŸš€"}):e.jsxs("div",{className:"text-lg font-black text-white/80 uppercase tracking-[1em]",children:[a.map(s=>s.name).join(" vs ")," âš”ï¸"]})})]})]})})})})});return Me.createPortal(e.jsxs(e.Fragment,{children:[_&&e.jsx(He,{players:a,playerCalibrations:R,calibrationSkipped:B,onSkip:s=>G(w=>({...w,[s]:!0})),onOpenCalibrator:s=>{G(w=>({...w,[s]:!1}));try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:"calibrate"}}))}catch{}try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}},onClose:()=>{q(!1)}}),me]}),se.current)}export{ze as C,lt as G,dt as M};
//# sourceMappingURL=MatchStartShowcase-DUByfcDM.js.map

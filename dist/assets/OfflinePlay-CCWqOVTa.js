import{b as Ir,u as et,j as e,c as fi,d as Cl,e as kl,f as Dl,r as Tl,h as Ll,i as Ml,s as Al,k as Ui,l as El,m as sr,R as Cn,F as bi,n as $t,o as pi,B as Ms,p as Rl,q as Il,a as Bl,t as gi,v as vi,w as Pl,x as Ul,y as Ol,z as Fl}from"./index-Dhnedrwu.js";import{r as n}from"./ui-Vpbk6UnN.js";import{G as $l}from"./GameCalibrationStatus-OE67rABQ.js";import{u as Er,a as kn}from"./match-CIGoiTm8.js";import{u as ji,M as Hl}from"./MatchControls-s075LMcm.js";import{M as Vl}from"./MatchStartShowcase-BmrScC4w.js";import"./vendor-D3F3s8fL.js";const Wl=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function _l(s){return s==="DB"?50:Number(s.slice(1))*2}function Kl(s){return Wl.includes(s)?_l(s):32}function zl(s,r="D16"){if(s>170||s<=1)return[];const o={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(o[s])return o[s];const m=Kl(r),l=[];for(const u of[60,57,54,51,48])if(s-u===m){l.push(`T${u/3} ${r}`);break}if(!l.length){for(const u of[20,19,18,17,16,15])if(s-u===m){l.push(`${u} ${r}`);break}}return l}function Ar(s,r,o,m,l){try{const u=window.speechSynthesis;if(!u)return;const f=new SpeechSynthesisUtterance,y=o<=170&&o>0,C=r===180;if(!(!l?.checkoutOnly||y||C))return;if(C?(f.text=`${s}! One eighty!`,f.rate=1.04,f.pitch=1.15):y?(f.text=`${s}, ${o} remaining.`,f.rate=1,f.pitch=1):r===0?(f.text=`${s}, no score.`,f.rate=1,f.pitch=1):(f.text=`${s}, ${r}.`,f.rate=1,f.pitch=1),m){const R=u.getVoices().find(S=>S.name===m);R&&(f.voice=R)}typeof l?.volume=="number"?f.volume=Math.max(0,Math.min(1,l.volume)):f.volume=1;try{u.cancel()}catch{}u.speak(f)}catch{}}function Ni({label:s,autoStart:r,scale:o,className:m,aspect:l="inherit",style:u,fill:f=!1}){const y=n.useRef(null),C=Ir(),[D,R]=n.useState(!1),[S,O]=n.useState(null),[w,E]=n.useState(null),[X,k]=n.useState(null),we=n.useRef(null),je=n.useCallback((x,j="local")=>{try{x?(C.setMediaStream(x),y.current&&C.setVideoElementRef(y.current),C.setMode(j),C.setStreaming(!0),we.current=j):we.current&&we.current!=="phone"&&(C.setStreaming(!1),C.setMediaStream(null),we.current=null)}catch(F){console.warn("[CameraTile] Failed to register stream with camera session:",F)}},[C]),he=et(x=>x.preferredCameraLabel),[T,Y]=n.useState(()=>he==="Phone Camera"?"phone":localStorage.getItem("ndn:camera:mode")||"local"),[,pe]=n.useState(null),[,oe]=n.useState(!1),[Ce,se]=n.useState(null),[ue,xe]=n.useState(null),[$,ce]=n.useState(!0),[p,tt]=n.useState([]),[A,Ke]=n.useState(!1),[Q,Ee]=n.useState([]),[fe,ke]=n.useState(!1),He=et(x=>x.autoscoreProvider),st=et(x=>x.cameraEnabled),me=et(x=>x.setPreferredCameraLocked),De=et(x=>x.preferredCameraLocked),te=et(x=>x.setPreferredCamera),Ve=et(x=>x.preferredCameraId);if(He==="manual"){const j=[f?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",m].filter(Boolean).join(" ").trim(),F={...u||{}};return!f&&F.aspectRatio===void 0&&F.height===void 0&&F.minHeight===void 0&&(F.aspectRatio="4 / 3"),e.jsx("div",{className:j,style:F,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}n.useEffect(()=>{const x=window.location.hostname;(x==="localhost"||x==="127.0.0.1")&&fi("/api/hosts").then(j=>j.json()).then(j=>{const F=Array.isArray(j?.hosts)&&j.hosts.find(v=>v);F&&se(F)}).catch(()=>{}),fi("/api/https-info").then(j=>j.json()).then(j=>{j&&typeof j.https=="boolean"&&xe({https:!!j.https,port:Number(j.port)||8788})}).catch(()=>{})},[]);const ms=n.useMemo(()=>{const x=w||"____",j="ws://localhost:8787";if(j.length>0)try{const J=new URL(j);return`${`${J.protocol==="wss:"?"https":"http"}://${J.host}${J.pathname.endsWith("/ws")?"":J.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${x}`}catch{}const F=Ce||window.location.hostname,v=!!ue?.https,V=v?ue?.port||8788:8787;return`${v?"https":"http"}://${F}:${V}/mobile-cam.html?code=${x}`},[w,Ce,ue]);n.useEffect(()=>{localStorage.setItem("ndn:camera:mode",T)},[T]);const[It,Re]=n.useState(null);n.useEffect(()=>{et.getState().ignorePreferredCameraSync||It&&Date.now()-It<3e4||he==="Phone Camera"&&T!=="phone"&&Y("phone")},[he,T,It]),n.useEffect(()=>{if(!(!st||He&&He!=="built-in"&&He!=="external-ws")&&r!==void 0){if(r){let x=!1;const j=he||"default",F=window.setTimeout(()=>{x||D||ie().catch(v=>console.warn(`[CameraTile] Auto-start failed for ${j}:`,v))},200);return()=>{x=!0,window.clearTimeout(F)}}Xe()}},[r,D,st,He,he,ie,Xe]),n.useEffect(()=>{const x=async()=>{try{if(!(he==="Phone Camera"&&(!It||Date.now()-It>=3e4)||T==="phone"))return;const v=C.getMediaStream(),V=y.current;if(!V||!v)return;V.srcObject!==v&&(V.srcObject=v),V.muted=!0,V.playsInline=!0;try{await V.play()}catch{}R(!0)}catch{}};x();const j=setInterval(x,800);return()=>clearInterval(j)},[he,T,C,C.isStreaming]);const ie=n.useCallback(async()=>{if(T==="wifi")return Fe();if(he==="Phone Camera"||T==="phone"){const x=C.getMediaStream();if(x&&y.current)try{y.current.srcObject=x,await y.current.play(),R(!0);return}catch{}if(T==="phone")try{await ye();return}catch{}}try{const{preferredCameraId:x,setPreferredCamera:j}=et.getState(),F=x?{video:{deviceId:{exact:x}},audio:!1}:{video:!0,audio:!1};let v;try{v=await navigator.mediaDevices.getUserMedia(F)}catch(V){const ee=V&&(V.name||V.code)||"";if(x&&(ee==="OverconstrainedError"||ee==="NotFoundError"))v=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw V}y.current&&(y.current.srcObject=v,await y.current.play(),R(!0),je(v,"local"))}catch{}},[T,he,C,je,ye,Fe]),Xe=n.useCallback(()=>{y.current&&y.current.srcObject&&(y.current.srcObject.getTracks().forEach(j=>j.stop()),y.current.srcObject=null,R(!1),je(null))},[je]);async function Fe(){Ke(!0);try{const x=await Cl();tt(x),x.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(x){console.error("Wifi device discovery failed:",x),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Ke(!1)}}async function ne(x){try{tt(F=>F.map(v=>v.id===x.id?{...v,status:"connecting"}:v));const j=await kl(x);if(j&&y.current)y.current.srcObject=j,await y.current.play(),R(!0),je(j,"wifi"),tt(F=>F.map(v=>v.id===x.id?{...v,status:"online"}:v));else throw new Error("Failed to get video stream")}catch(j){console.error("Failed to connect to wifi device:",j),alert(`Failed to connect to ${x.name}. Please check the device and try again.`),tt(F=>F.map(v=>v.id===x.id?{...v,status:"offline"}:v))}}async function z(){ke(!0);try{const x=await Dl();Ee(x);const j=await Tl();j&&Ee(F=>[...F,j]),x.length===0&&!j&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(x){console.error("USB device discovery failed:",x),alert("Failed to discover USB devices. Please check device connections.")}finally{ke(!1)}}async function de(x){try{Ee(F=>F.map(v=>v.id===x.id?{...v,status:"connecting"}:v));const j=await Ll(x);if(j&&y.current)y.current.srcObject=j,await y.current.play(),R(!0),Y("wifi"),je(j,"wifi"),Ee(F=>F.map(v=>v.id===x.id?{...v,status:"online"}:v));else throw new Error("Failed to get video stream")}catch(j){console.error("Failed to connect to USB device:",j),alert(`Failed to connect to ${x.name}. Please check the device and try again.`),Ee(F=>F.map(v=>v.id===x.id?{...v,status:"offline"}:v))}}const ze=n.useCallback(x=>{try{Y(x==="usb"?"wifi":x),Re(Date.now());try{if(x==="local"){try{te(Ve,"Local",!0)}catch{}try{me(!0)}catch{}}else if(x==="phone"){try{te(void 0,"Phone Camera",!0)}catch{}try{me(!0)}catch{}}else if(x==="wifi"||x==="usb"){try{te(void 0,"WiFi/USB",!0)}catch{}try{me(!0)}catch{}}}catch{}x==="local"?ie().catch(()=>{}):x==="phone"?ye():x==="wifi"?Fe():x==="usb"&&z()}catch(j){console.warn("[CameraTile] handleModeSelect failed",j)}},[ie,ye,Fe,z,te,me,Ve]);n.useEffect(()=>{const x=j=>{try{const F=j&&j.detail&&j.detail.mode;F&&["local","phone","wifi","usb"].includes(F)?(ze(F),ie().catch(()=>{})):ie().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",x),()=>{window.removeEventListener("ndn:start-camera",x)}},[ie,ze]);function Z(){if(S&&S.readyState===WebSocket.OPEN)return S;const x="ws://localhost:8787",j=x.length>0?x.endsWith("/ws")?x:x.replace(/\/$/,"")+"/ws":void 0,F=window.location.protocol==="https:"?"wss":"ws",v=`${F}://${window.location.host}/ws`,V=window.location.hostname,ee=V==="localhost"||V==="127.0.0.1",J=V.endsWith("onrender.com"),Ye="wss://ninedartnation.onrender.com/ws";let Se=j;Se||(ee?Se=`${F}://${V}:8787/ws`:J?Se=v:Se=Ye),Se||(Se=v);const jt=new WebSocket(Se);return O(jt),jt}async function ye(){Y("phone"),oe(!1);const x=Z();x.readyState===WebSocket.OPEN?x.send(JSON.stringify({type:"cam-create"})):x.onopen=()=>x.send(JSON.stringify({type:"cam-create"})),x.onmessage=async j=>{const F=JSON.parse(j.data);if(F.type==="cam-code")E(F.code),F.expiresAt&&pe(F.expiresAt);else if(F.type==="cam-peer-joined"){oe(!0);const v=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});k(v),v.onicecandidate=ee=>{ee.candidate&&w&&x.send(JSON.stringify({type:"cam-ice",code:w,payload:ee.candidate}))},v.ontrack=ee=>{if(y.current){const J=ee.streams?.[0];J&&(y.current.srcObject=J,y.current.play().catch(()=>{}),R(!0))}};const V=await v.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await v.setLocalDescription(V),w&&x.send(JSON.stringify({type:"cam-offer",code:w,payload:V}))}else if(F.type==="cam-answer")X&&await X.setRemoteDescription(new RTCSessionDescription(F.payload));else if(F.type==="cam-ice"&&X)try{await X.addIceCandidate(F.payload)}catch{}}}function Ne(){E(null),pe(null),oe(!1),S&&S.readyState===WebSocket.OPEN?S.send(JSON.stringify({type:"cam-create"})):ye();try{me(!0)}catch{}}function ve(){if(Xe(),E(null),oe(!1),pe(null),X){try{X.close()}catch{}k(null)}}return e.jsx(Gl,{label:s,autoStart:r,start:ie,stopAll:ve,startPhonePairing:ye,startWifiConnection:Fe,startUsbConnection:z,connectToWifiDevice:ne,connectToUsbDevice:de,videoRef:y,streaming:D,mode:T,setMode:Y,pairCode:w,mobileUrl:ms,regenerateCode:Ne,httpsInfo:ue,showTips:$,setShowTips:ce,wifiDevices:p,usbDevices:Q,discoveringWifi:A,discoveringUsb:fe,scaleOverride:o,className:m,aspect:l,style:u,fill:f,onModeSelect:ze,preferredCameraLocked:De})}function Gl(s){const r=Ir(),{cameraScale:o,cameraAspect:m}=et(),{label:l,start:u,stopAll:f,startPhonePairing:y,startWifiConnection:C,startUsbConnection:D,connectToWifiDevice:R,connectToUsbDevice:S,videoRef:O,streaming:w,mode:E,setMode:X,onModeSelect:k,pairCode:we,mobileUrl:je,regenerateCode:he,httpsInfo:T,showTips:Y,setShowTips:pe,wifiDevices:oe,usbDevices:Ce,discoveringWifi:se,discoveringUsb:ue,className:xe,aspect:$,style:ce,fill:p,preferredCameraLocked:tt}=s,A={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},Ke=n.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{k&&k("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{k&&k("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{k&&k("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{k&&k("usb")}}],[X,u,y,C,D]),[Q,Ee]=n.useState(null),fe=n.useRef(null);n.useEffect(()=>()=>{fe.current&&window.clearTimeout(fe.current)},[]);const{cameraFitMode:ke}=et(),He=p?"fill":ke||"fill",st=(()=>{const z=Number(s.scaleOverride??o??1),de=Math.max(.5,Math.min(1.25,z));return He==="fill"?Math.max(1,de):de})(),me=p&&He==="fill"?"free":$&&$!=="inherit"?$:m||"wide",De=me!=="free",te=De?me==="square"?"aspect-square":me==="portrait"?"aspect-[3/4]":me==="classic"?"aspect-[4/3]":"aspect-video":"",ms=[p?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",xe].filter(Boolean).join(" ").trim(),It={...ce||{}},Re=p?"relative flex-1 min-h-[420px] bg-black":"relative w-full bg-black",ie={style:{transform:`scale(${st})`,transformOrigin:"center"}},Xe=E==="wifi"&&Ce.some(z=>z.status==="online"),Fe=(()=>{const de=He==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return p?De?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${te}`,children:e.jsx("video",{ref:O,className:de,...ie})})}):e.jsx("video",{ref:O,className:de,...ie}):De?e.jsx("div",{className:`relative w-full ${te}`,children:e.jsx("video",{ref:O,className:de,...ie})}):e.jsx("div",{className:"relative w-full",children:e.jsx("video",{ref:O,className:de,...ie})})})();async function ne(z,de){if(z)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(z);else{const ze=document.createElement("textarea");ze.value=z,ze.style.position="fixed",ze.style.opacity="0",document.body.appendChild(ze),ze.focus(),ze.select(),document.execCommand("copy"),document.body.removeChild(ze)}Ee(de),fe.current&&window.clearTimeout(fe.current),fe.current=window.setTimeout(()=>Ee(null),1500)}catch(ze){console.warn("Copy to clipboard failed:",ze),Ee(null)}}return e.jsxs("div",{className:ms,style:It,children:[e.jsxs("div",{className:Re,children:[Fe,r.isStreaming&&E==="phone"&&e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{children:"REC"})]})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[e.jsxs("span",{className:"truncate font-medium",children:[l||(w?E==="phone"?"PHONE LIVE":E==="wifi"?"WIFI LIVE":"LIVE":"Camera"),tt&&e.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${E==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("local"),children:"Local"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${E==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("phone"),children:"Phone"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${E==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("wifi"),children:"WiFi"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${E==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("usb"),children:"USB"})]}),w?e.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:f,children:"Stop"}):null]})]}),E==="phone"&&we&&!w&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>ne(je,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:je}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:Q==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:je,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>ne(we,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:we}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:Q==="code"?"Copied!":"Copy"})]})]}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:he,children:"Regenerate"})}),Y&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and"," ",T?.https?T.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>pe(!1),children:"Hide tips"})})]})]}),E==="wifi"&&!w&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),se?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):oe.length>0?e.jsxs("div",{className:"space-y-1",children:[oe.map(z=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:z.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[z.ip,":",z.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${z.status==="connecting"?"bg-yellow-600":z.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>R(z),disabled:z.status==="connecting",children:z.status==="connecting"?"...":"Connect"})]},z.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:C,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:C,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),ue?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):Ce.length>0?e.jsxs("div",{className:"space-y-1",children:[Ce.map(z=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:z.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:z.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${z.status==="connecting"?"bg-yellow-600":z.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>S(z),disabled:z.status==="connecting",children:z.status==="connecting"?"...":"Connect"})]},z.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:D,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:D,children:"Scan USB"})]})]})]}),!w&&e.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",A[E]||"Local"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ke.map(z=>{const de=z.id==="usb"?Xe:z.id===E;return e.jsxs("button",{type:"button",onClick:z.action,className:`text-left p-3 rounded-2xl border ${de?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:z.title}),e.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:z.description}),de&&e.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},z.id)})})]})]})}function wi(s,r){const o=Ml(s,r);return Al(o)}class ql{width=0;height=0;bg=null;lastAcceptTs=0;cooldownMs=600;roiRadius=0;roiCx=0;roiCy=0;initialized=!1;thresh=28;minArea=90;maxArea=6e3;prevTip=null;prevArea=0;stableCount=0;requireStableN=3;constructor(){}setROI(r,o,m){this.roiCx=r,this.roiCy=o,this.roiRadius=Math.max(0,m|0)}reset(r,o){this.width=r,this.height=o,this.bg=new Float32Array(r*o),this.initialized=!1}updateBackground(r,o=.05){const{width:m,height:l,data:u}=r;(!this.bg||m!==this.width||l!==this.height)&&this.reset(m,l);const f=this.bg,y=m*l;for(let C=0,D=0;C<y;C++,D+=4){const R=u[D],S=u[D+1],O=u[D+2],w=.299*R+.587*S+.114*O;this.initialized?f[C]=(1-o)*f[C]+o*w:f[C]=w}this.initialized=!0}inRoi(r,o){if(this.roiRadius<=0)return!0;const m=r-this.roiCx,l=o-this.roiCy;return m*m+l*l<=this.roiRadius*this.roiRadius}detect(r){const m=Date.now()-this.lastAcceptTs<this.cooldownMs,{width:l,height:u,data:f}=r;(!this.bg||l!==this.width||u!==this.height)&&this.reset(l,u);const y=this.bg;if(!this.initialized)return this.updateBackground(r,1),null;const C=l*u,D=new Uint8Array(C),R=new Float32Array(C);let S=0,O=0,w=0;const E=new Uint8Array(C);for(let v=0,V=0;v<C;v++,V+=4){const ee=f[V],J=f[V+1],Ye=f[V+2],Se=Math.max(ee,J,Ye),jt=Math.min(ee,J,Ye),Me=.299*ee+.587*J+.114*Ye,We=Math.abs(Me-y[v]);R[v]=We;const Bt=Math.floor(v/l),ss=v-Bt*l,Zs=Se===0?0:(Se-jt)/Se,Be=Se>=250&&Zs<=.12;Be&&(E[v]=1),this.inRoi(ss,Bt)&&!Be&&(S+=We,O+=We*We,w++)}const X=w?S/w:0,k=w?Math.max(0,O/w-X*X):0,we=Math.sqrt(k),je=Math.max(this.thresh,X+1.2*we);for(let v=0;v<C;v++){if(E[v]){D[v]=0;continue}if(R[v]>je){const V=Math.floor(v/l),ee=v-V*l;D[v]=this.inRoi(ee,V)?1:0}}this._dilate(D,l,u),this._erode(D,l,u);const he=new Uint8Array(C);let T=0,Y=null;for(let v=0;v<C;v++){if(D[v]===0||he[v])continue;const V=[];let ee=0,J=0;const Ye=[v];for(he[v]=1;J<Ye.length;){const Se=Ye[J++];V.push(Se),ee++;const jt=Se/l|0,Me=[Se-1,Se+1,Se-l,Se+l];for(const We of Me)We<0||We>=C||he[We]||(We===Se-1||We===Se+1)&&(We/l|0)!==jt||D[We]&&(he[We]=1,Ye.push(We))}ee>T&&(T=ee,Y=V)}if(!Y||T<this.minArea||T>this.maxArea)return m||this.updateBackground(r,.02),null;let pe=l,oe=u,Ce=0,se=0,ue=0,xe=0;for(const v of Y){const V=v/l|0,ee=v-V*l;ue+=ee,xe+=V,ee<pe&&(pe=ee),ee>Ce&&(Ce=ee),V<oe&&(oe=V),V>se&&(se=V)}ue/=T,xe/=T;let $=0,ce=0,p=0;for(const v of Y){const V=v/l|0,J=v-V*l-ue,Ye=V-xe;$+=J*J,ce+=Ye*Ye,p+=J*Ye}$/=T,ce/=T,p/=T;const tt=$+ce,A=$*ce-p*p,Ke=Math.sqrt(Math.max(0,tt*tt/4-A)),Q=tt/2+Ke;let Ee=p,fe=Q-$;Math.hypot(Ee,fe)<1e-6&&(Ee=Q-ce,fe=p);const ke=Math.hypot(Ee,fe)||1;Ee/=ke,fe/=ke;const He=ue-this.roiCx,st=xe-this.roiCy,me=He*Ee+st*fe>0?1:-1;Ee*=me,fe*=me;const De=Math.hypot(He,st)||1,te=He/De,Ve=st/De,ms=Math.max(-1,Math.min(1,Ee*te+fe*Ve));if(Math.acos(ms)*180/Math.PI>55)return m||this.updateBackground(r,.02),null;let Re=-1/0,ie=ue,Xe=xe;for(const v of Y){const V=v/l|0,ee=v-V*l,J=(ee-ue)*Ee+(V-xe)*fe;J>Re&&(Re=J,ie=ee,Xe=V)}const Fe=ie-this.roiCx,ne=Xe-this.roiCy,z=Fe*Fe+ne*ne,de=Math.max(1,Ce-pe+1),ze=Math.max(1,se-oe+1),Z=de*ze,ye=T/Z,Ne=Math.sqrt(z)/Math.max(1,this.roiRadius);let ve=.5;ye<.45&&(ve+=.2),ye<.25&&(ve+=.15),Ne<1.1&&(ve+=.1);const x=tt-Q;return(Q>0?1-x/Q:0)>.3&&(ve+=.1),ve=Math.max(0,Math.min(1,ve)),!this._isStable({x:ie+.5,y:Xe+.5},T)||m?null:{tip:{x:ie+.5,y:Xe+.5},axis:{x1:ue-Ee*20,y1:xe-fe*20,x2:ue+Ee*20,y2:xe+fe*20},area:T,bbox:{x:pe,y:oe,w:de,h:ze},confidence:ve}}accept(r,o){if(this.lastAcceptTs=Date.now(),this.prevTip=null,this.prevArea=0,this.stableCount=0,!this.bg)return;const{width:m}=r,l=this.bg,{x:u,y:f,w:y,h:C}=o.bbox,D=.5;for(let R=f;R<f+C;R++)for(let S=u;S<u+y;S++){const O=R*m+S,w=O*4,E=r.data[w],X=r.data[w+1],k=r.data[w+2],we=.299*E+.587*X+.114*k;l[O]=(1-D)*l[O]+D*we}}_isStable(r,o){const m=(l,u)=>Math.hypot(l.x-u.x,l.y-u.y)<=6;if(!this.prevTip)return this.prevTip={...r},this.prevArea=o,this.stableCount=1,!1;if(m(this.prevTip,r)&&Math.abs(o-this.prevArea)/Math.max(1,o)<.3)this.prevTip={...r},this.prevArea=o,this.stableCount++;else return this.prevTip={...r},this.prevArea=o,this.stableCount=1,!1;return this.stableCount>=this.requireStableN}_dilate(r,o,m){const l=new Uint8Array(r.length);for(let u=0;u<m;u++)for(let f=0;f<o;f++){let y=0;for(let C=-1;C<=1;C++){for(let D=-1;D<=1;D++){const R=u+C,S=f+D;if(!(R<0||R>=m||S<0||S>=o)&&r[R*o+S]){y=1;break}}if(y)break}l[u*o+f]=y}r.set(l)}_erode(r,o,m){const l=new Uint8Array(r.length);for(let u=0;u<m;u++)for(let f=0;f<o;f++){let y=1;for(let C=-1;C<=1;C++){for(let D=-1;D<=1;D++){const R=u+C,S=f+D;if(!(R<0||R>=m||S<0||S>=o)&&!r[R*o+S]){y=0;break}}if(!y)break}l[u*o+f]=y}r.set(l)}}function Xl(s){try{if(!s||typeof s!="object")return null;if((s.type==="dart"||s.kind==="dart"||s.event==="dart")&&typeof s.value=="number"){const r=yi(s.ring);return Si(s.value,r)}if(typeof s.value=="number"&&s.ring){const r=yi(s.ring);return Si(s.value,r)}if(typeof s.score=="string"){const r=s.score.trim().toUpperCase();if(r==="50"||r==="DBULL"||r==="INNER_BULL")return{value:50,ring:"INNER_BULL",sector:null,mult:0};if(r==="25"||r==="BULL"||r==="OBULL")return{value:25,ring:"BULL",sector:null,mult:0};const o=r.match(/^(S|D|T)(\d{1,2})$/);if(o){const m=o[1]==="S"?1:o[1]==="D"?2:3,l=parseInt(o[2],10);if(l>=1&&l<=20)return{value:l*m,ring:m===1?"SINGLE":m===2?"DOUBLE":"TRIPLE",sector:l,mult:m}}}if(typeof s.sector=="number"&&typeof s.mult=="number"){const r=Math.max(1,Math.min(20,Math.floor(s.sector))),o=s.mult===1?1:s.mult===2?2:3;return{value:r*o,ring:o===1?"SINGLE":o===2?"DOUBLE":"TRIPLE",sector:r,mult:o}}if(s.bull){const r=String(s.bull).toLowerCase()==="inner"||s.bull===!0;return{value:r?50:25,ring:r?"INNER_BULL":"BULL",sector:null,mult:0}}}catch{}return null}function yi(s){const r=String(s||"").toUpperCase();return r.startsWith("TR")?"TRIPLE":r.startsWith("DO")?"DOUBLE":r.startsWith("SI")?"SINGLE":r==="INNER_BULL"||r==="DBULL"||r==="50"||r==="IBULL"?"INNER_BULL":r==="BULL"||r==="25"||r==="OBULL"||r==="OUTER_BULL"?"BULL":r==="MISS"||r==="0"?"MISS":"SINGLE"}function Si(s,r){const o=Math.max(0,Math.min(60,Math.round(Number(s)||0)));return r==="INNER_BULL"?{value:50,ring:r}:r==="BULL"?{value:25,ring:r}:{value:o,ring:r}}function Yl(s,r){let o=null,m=!0,l=null,u=0;const f=400,y=[],C=new Set;function D(S,O){const w=typeof S?.id=="string"||typeof S?.id=="number"?String(S.id):null;if(w){if(C.has(w))return;if(C.add(w),y.push(w),y.length>200){const k=y.shift();k&&C.delete(k)}}const E=`${O.value}|${O.ring}|${O.sector??""}|${O.mult??""}`,X=Date.now();E===l&&X-u<f||(l=E,u=X,r(O))}function R(){if(m)try{o=new WebSocket(s),o.onmessage=S=>{try{const O=JSON.parse(S.data),w=Xl(O);w&&D(O,w)}catch{}},o.onclose=()=>{o=null,setTimeout(R,1500)},o.onerror=()=>{}}catch{setTimeout(R,2e3)}}return R(),{close:()=>{m=!1;try{o?.close()}catch{}}}}function va({storageKey:s,children:r,className:o,defaultWidth:m=640,defaultHeight:l=360,minWidth:u=320,minHeight:f=200,maxWidth:y=1600,maxHeight:C=1200,autoFill:D=!1}){const[R,S]=n.useState(()=>{try{const T=localStorage.getItem(s);if(T)return JSON.parse(T)}catch{}return D?{width:m}:{width:m,height:l}}),O=n.useRef(null),w=n.useRef(null);n.useEffect(()=>{function T(){try{localStorage.removeItem(s)}catch{}S({width:m,height:l})}return window.addEventListener("ndn:layout-reset",T),window.addEventListener("ndn:camera-reset",T),()=>{window.removeEventListener("ndn:layout-reset",T),window.removeEventListener("ndn:camera-reset",T)}},[s,m,l]),n.useEffect(()=>{try{localStorage.setItem(s,JSON.stringify(R))}catch{}},[R,s]);function E(T,Y,pe){return Math.max(Y,Math.min(pe,T))}function X(T,Y){T.preventDefault();const pe=w.current;if(!pe)return;const oe=pe.getBoundingClientRect();O.current={x:T.clientX,y:T.clientY,w:oe.width,h:oe.height,dir:Y},window.addEventListener("mousemove",k),window.addEventListener("mouseup",we)}function k(T){const Y=O.current;if(!Y)return;const pe=T.clientX-Y.x,oe=T.clientY-Y.y;let Ce=Y.w,se=Y.h;Y.dir.includes("e")&&(Ce=E(Y.w+pe,u,y)),!D&&Y.dir.includes("s")&&(se=E(Y.h+oe,f,C)),Y.dir.includes("w")&&(Ce=E(Y.w-pe,u,y)),!D&&Y.dir.includes("n")&&(se=E(Y.h-oe,f,C)),S({width:Math.round(Ce),height:Math.round(se)})}function we(){window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",we),O.current=null}function je(T,Y){const oe=T.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"," "].includes(oe))return;T.preventDefault();const Ce=oe==="ArrowLeft"||oe==="ArrowUp"?-20:20;S(se=>{const ue=se.width||m,xe=se.height||l;let $=ue,ce=xe;return Y.includes("e")&&($=E(ue+Ce,u,y)),Y.includes("w")&&($=E(ue-Ce,u,y)),!D&&Y.includes("s")&&(ce=E(xe+Ce,f,C)),!D&&Y.includes("n")&&(ce=E(xe-Ce,f,C)),{width:Math.round($),height:Math.round(ce)}})}const he={width:D?"100%":R.width?`${R.width}px`:void 0,height:D?"100%":R.height?`${R.height}px`:void 0,maxWidth:"100%",maxHeight:D?"100%":"80vh",position:"relative",...D?{display:"flex",flexDirection:"column",flex:"1 1 auto"}:{}};return e.jsxs("div",{ref:w,className:`${o||""}`,style:he,children:[r,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:T=>X(T,"nw"),role:"button",tabIndex:0,"aria-label":"Resize north-west",onKeyDown:T=>je(T,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:T=>X(T,"ne"),role:"button",tabIndex:0,"aria-label":"Resize north-east",onKeyDown:T=>je(T,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:T=>X(T,"sw"),role:"button",tabIndex:0,"aria-label":"Resize south-west",onKeyDown:T=>je(T,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:T=>X(T,"se"),role:"button",tabIndex:0,"aria-label":"Resize south-east",onKeyDown:T=>je(T,"se")})]})}const Oi=Ui((s,r)=>({samples:[],addSample:o=>s(m=>({samples:[...m.samples,o]})),clear:()=>s({samples:[]}),export:()=>r().samples.slice()})),Jl=Ui(s=>({paused:!1,pauseEndsAt:null,setPaused:(r,o=null)=>s({paused:r,pauseEndsAt:o??null})})),Ql=1,Zl=120,eo=400,to=450,so=5e3,no=.85,ro=6500;function Le({onVisitCommitted:s,showToolbar:r=!0,onAutoDart:o,immediateAutoCommit:m=!1,hideInlinePanels:l=!1,scoringMode:u="x01",onGenericDart:f,onGenericReplace:y,x01DoubleInOverride:C,onAddVisit:D,onEndLeg:R}){const S=n.useRef(null),{preferredCameraId:O,preferredCameraLabel:w,setPreferredCamera:E,autoscoreProvider:X,autoscoreWsUrl:k,cameraAspect:we,cameraFitMode:je,autoCommitMode:he="wait-for-clear",cameraEnabled:T,setCameraEnabled:Y,preferredCameraLocked:pe,hideCameraOverlay:oe,setHideCameraOverlay:Ce}=et(),se=X==="manual",[ue,xe]=n.useState([]),$=n.useRef(null),ce=n.useRef(null),[p,tt]=n.useState(!1),A=Ir(),Ke=w==="Phone Camera",Q=A.getMediaStream?.()||null,Ee=A.isStreaming,fe=Ke&&A.mode==="phone"&&Ee&&!!Q,ke=p||Ee,[He,st]=n.useState(!1),[me,De]=n.useState(null),{H:te,imageSize:Ve,reset:ms,_hydrated:It}=El();n.useEffect(()=>{pe&&!oe&&Ce(!0)},[pe,oe,Ce]);const[Re,ie]=n.useState(""),[Xe,Fe]=n.useState(""),[ne,z]=n.useState(0),[de,ze]=n.useState("MISS"),[Z,ye]=n.useState(0),[Ne,ve]=n.useState(0),[x,j]=n.useState([]),[F,v]=n.useState(0),[V,ee]=n.useState(0),[J,Ye]=n.useState(!1),Se=n.useRef(null),jt=n.useRef(null),Me=!m&&he!=="immediate",[We,Bt]=n.useState(0),[ss,Zs]=n.useState([]),Be=n.useRef(null),Dn=n.useRef([]),As=n.useRef(0),ns=n.useRef(0),hs=n.useRef(!1),Ht=n.useRef(null),Ae=n.useRef(0),[rs,re]=n.useState([]),[q,Es]=n.useState(!1),xs=n.useCallback(()=>{jt.current&&(clearTimeout(jt.current),jt.current=null)},[]),en=n.useCallback(i=>{const d=[...Dn.current.slice(-8),i];Dn.current=d,re(d);try{window.ndnCameraDiagnostics=d}catch{}},[]),Pt=n.useCallback(i=>{const d=Se.current;if(d&&(Se.current=null,xs(),Ye(!1),s))try{s(d.score,d.darts,d.finished)}catch{}},[s,xs]),ot=n.useCallback(i=>{if(s){if(!Me){try{s(i.score,i.darts,i.finished)}catch{}return}Se.current=i,Ye(!0),xs(),jt.current=window.setTimeout(()=>Pt("timeout"),ro)}},[s,Me,xs,Pt]),Rs=n.useCallback(i=>{ye(0),ve(0),j([]),v(0),ee(0),Je(!1);try{window.dispatchEvent(new CustomEvent("ndn:clear-visit-request",{detail:{source:"camera-view",reason:i,ts:Date.now()}}))}catch{}},[]);n.useEffect(()=>{if(!Me)return;const i=()=>Pt("event");return window.addEventListener("ndn:darts-cleared",i),()=>window.removeEventListener("ndn:darts-cleared",i)},[Me,Pt]),n.useEffect(()=>{Me||Pt("timeout")},[Me,Pt]),n.useEffect(()=>()=>Pt("teardown"),[Pt]);const nr=n.useCallback(()=>{Rs("indicator"),Bt(i=>i+1)},[Rs]),rr=n.useCallback(()=>{Z===0&&Ne===0||(Rs("toolbar"),Bt(i=>i+1))},[Rs,Z,Ne]),Is=n.useCallback(()=>{if(!se)try{window.dispatchEvent(new CustomEvent("ndn:open-camera-manager",{detail:{source:"camera-view",ts:Date.now()}}))}catch(i){console.warn("[CameraView] Failed to request camera manager:",i)}},[se]),Tn=et(i=>i.x01DoubleIn),Vt=typeof C=="boolean"?!!C:!!Tn,[tn,fs]=n.useState({}),ge=Er(i=>i),as=ge.players[ge.currentPlayerIdx]?.id,Wt=!!(as&&tn[as]),Br=i=>{as&&fs(d=>({...d,[as]:i}))},ct=ge?.inProgress,Ln=ji(i=>i.setVisit),Mn=ji(i=>i.reset);n.useEffect(()=>{try{Ln(x,Z,Ne)}catch{}},[x,Z,Ne,Ln]),n.useEffect(()=>()=>{try{Mn()}catch{}},[Mn]);const Pr=Er(i=>i.addVisit),An=Er(i=>i.endLeg),is=(i,d,g)=>{try{D?D(i,d,g):Pr(i,d,g)}catch{}},En=i=>{try{R?R(i):An(typeof i=="number"?i:0)}catch{}},Rn=Oi(i=>i.addSample),[bs,ar]=n.useState(""),[Bs,ir]=n.useState(""),[Dt,$e]=n.useState(0),[lr,Tt]=n.useState(!1),[Nt,Je]=n.useState(!1),[In,Ps]=n.useState(!1),Ut=n.useRef(null),[Bn,Gt]=n.useState("auto"),[sn,_t]=n.useState(!1),[or,Us]=n.useState(!1),[Ur,Pn]=n.useState(!1),Or=n.useRef(null),ps=et(i=>i.dartTimerEnabled),Un=et(i=>i.dartTimerSeconds)||10,[qt,Os]=n.useState(null),Lt=n.useRef(null),Fs=Jl(i=>i.paused),gs=n.useRef(null),Xt=n.useRef(null),[On,Fn]=n.useState(0),vs=n.useCallback(()=>{try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{source:"camera-view",ts:Date.now()}}))}catch(i){console.warn("[CameraView] Phone camera reconnect dispatch failed:",i)}},[]);n.useEffect(()=>{const i=()=>{se||Us(!0)};return window.addEventListener("ndn:open-autoscore",i),()=>window.removeEventListener("ndn:open-autoscore",i)},[se]),n.useEffect(()=>()=>{try{Ut.current&&clearTimeout(Ut.current)}catch{}},[]),n.useEffect(()=>{const i=()=>Pn(!0);return window.addEventListener("ndn:open-scoring",i),()=>window.removeEventListener("ndn:open-scoring",i)},[]),n.useEffect(()=>{const i=()=>{Bt(d=>d+1),ye(0),ve(0),j([]),v(0),ee(0),Je(!1)};return window.addEventListener("ndn:darts-cleared",i),()=>window.removeEventListener("ndn:darts-cleared",i)},[]),n.useEffect(()=>{Zs(i=>{if(x.length>i.length){const d=x.length-i.length;return[...i,...Array(d).fill(We)]}return x.length<i.length?i.slice(0,x.length):i})},[x,We]),n.useEffect(()=>{if(Ht.current&&(clearTimeout(Ht.current),Ht.current=null),se){hs.current=!1,ns.current=0,Be.current=null;return}return ke?(ns.current=performance.now(),Be.current=null,hs.current=!1,Ae.current=0,Ht.current=window.setTimeout(()=>{hs.current=!0,Ht.current=null},so)):(ns.current=0,Be.current=null,hs.current=!1,Ae.current=0),()=>{Ht.current&&(clearTimeout(Ht.current),Ht.current=null),hs.current=!1,Ae.current=0}},[ke,se]),n.useEffect(()=>{let i=!0;async function d(){try{if(!navigator?.mediaDevices?.enumerateDevices)return;const g=await navigator.mediaDevices.enumerateDevices();if(!i)return;xe(g.filter(L=>L.kind==="videoinput"))}catch(g){console.warn("[CAMERA] enumerateDevices failed:",g)}}d();try{navigator.mediaDevices.addEventListener("devicechange",d)}catch{try{navigator.mediaDevices.ondevicechange=d}catch{}}return()=>{i=!1;try{navigator.mediaDevices.removeEventListener("devicechange",d)}catch{}}},[]),n.useEffect(()=>{const i=()=>{Gt("manual"),_t(!0)},d=()=>{Gt("auto"),_t(!1)};return window.addEventListener("ndn:open-manual",i),window.addEventListener("ndn:close-manual",d),()=>{window.removeEventListener("ndn:open-manual",i),window.removeEventListener("ndn:close-manual",d)}},[]),n.useEffect(()=>{se&&(Gt("manual"),Us(!1))},[se]),n.useEffect(()=>{try{const i=ge.players[ge.currentPlayerIdx],d=i?.legs?.[i.legs.length-1];if(!i)return;(!d||d.dartsThrown===0)&&fs(g=>({...g,[i.id]:!1}))}catch{}},[ge.currentPlayerIdx,ge.players?.[ge.currentPlayerIdx]?.legs?.length]),n.useEffect(()=>{const i=!!ps&&ct&&!Fs&&Z<3;if(Lt.current&&(clearInterval(Lt.current),Lt.current=null),!i){Os(null);return}return Os(Un),Lt.current=window.setInterval(()=>{Os(d=>{const g=(d??Un)-1;if(g<=0){try{wt(0,"MISS 0","MISS")}catch{}return Lt.current&&(clearInterval(Lt.current),Lt.current=null),0}return g})},1e3),()=>{Lt.current&&(clearInterval(Lt.current),Lt.current=null)}},[ps,Un,Z,ge.currentPlayerIdx,ge?.inProgress,Fs]),n.useEffect(()=>{if(!sn)return;const i=setInterval(()=>{try{const d=S.current,g=Or.current;if(!d||!g)return;const L=d.videoWidth||0,G=d.videoHeight||0;if(!L||!G)return;const _=g.clientWidth||640,W=g.clientHeight||360;g.width!==_&&(g.width=_),g.height!==W&&(g.height=W);const M=g.getContext("2d");if(!M)return;M.imageSmoothingEnabled=!0;const ae=Math.min(_/L,W/G),Qe=Math.round(L*ae),be=Math.round(G*ae),Pe=Math.floor((_-Qe)/2),_e=Math.floor((W-be)/2);M.fillStyle="#000",M.fillRect(0,0,_,W),M.drawImage(d,Pe,_e,Qe,be)}catch(d){console.warn("Manual preview update error:",d)}},120);return()=>clearInterval(i)},[sn]),n.useEffect(()=>()=>$s(),[]);const nn=Ke&&!fe;async function js(){if(!(He||p)){if(Ke&&fe){st(!1);return}st(!0);try{const i=O?{video:{deviceId:{exact:O}},audio:!1}:{video:{facingMode:"environment"},audio:!1};$t("[CAMERA] Using constraints:",i);let d;try{d=await navigator.mediaDevices.getUserMedia(i),$t("[CAMERA] Got stream:",!!d)}catch(g){console.warn("[CAMERA] First attempt failed:",g);const L=g&&(g.name||g.code)||"";if(O&&(L==="OverconstrainedError"||L==="NotFoundError"))$t("[CAMERA] Trying fallback without deviceId"),d=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else if(!O&&(L==="OverconstrainedError"||L==="NotFoundError"||L==="NotSupportedError"))$t("[CAMERA] Trying fallback for facingMode not supported"),d=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw g}if(S.current){$t("[CAMERA] Setting stream to video element"),S.current.srcObject=d,$t("[CAMERA] Stream tracks:",d.getTracks().length,"video tracks:",d.getVideoTracks().length),S.current.addEventListener("loadeddata",()=>$t("[CAMERA] Video loadeddata")),S.current.addEventListener("canplay",()=>$t("[CAMERA] Video canplay")),S.current.addEventListener("play",()=>$t("[CAMERA] Video started playing")),S.current.addEventListener("error",g=>console.error("[CAMERA] Video error:",g));try{S.current.play(),$t("[CAMERA] Play called successfully")}catch(g){console.error("[CAMERA] Video play failed:",g),setTimeout(()=>{try{S.current?.play(),$t("[CAMERA] Retry play called")}catch(L){console.error("[CAMERA] Retry play failed:",L)}},100)}try{A.setVideoElementRef?.(S.current),A.setMediaStream?.(d),A.setMode?.("local"),A.setStreaming?.(!0)}catch(g){console.warn("[CAMERA] Failed to sync camera session with local stream:",g)}}else console.error("[CAMERA] Video element not found");tt(!0);try{const g=await navigator.mediaDevices.enumerateDevices();xe(g.filter(L=>L.kind==="videoinput")),$t("[CAMERA] Found cameras:",g.filter(L=>L.kind==="videoinput").length)}catch(g){console.warn("[CAMERA] Failed to enumerate devices:",g)}}catch(i){console.error("[CAMERA] Camera start failed:",i),alert("Camera permission denied or not available.")}finally{st(!1)}}}function $s(){S.current&&S.current.srcObject&&(S.current.srcObject.getTracks().forEach(d=>d.stop()),S.current.srcObject=null,tt(!1),st(!1))}n.useEffect(()=>{const i=S.current;if(!i)return;const d=A.getMediaStream?.()||null,L=(A.getVideoElementRef?.()||null)?.srcObject||null,G=d||L;if(G){i.srcObject!==G&&(i.srcObject=G),i.muted=!0,i.playsInline=!0;try{i.play?.()}catch{}p||tt(!0)}},[A.mode,A.isStreaming,p,A]);function $n(){try{if(!$.current)return;const i=S.current,d=A.getVideoElementRef?.()||null,g=i&&i.videoWidth>0&&i.videoHeight>0?i:d||i;if(!g)return;const L=g,G=$.current;G.width=L.videoWidth,G.height=L.videoHeight;const _=G.getContext("2d");if(!_)return;_.drawImage(L,0,0,G.width,G.height);const W=G.toDataURL("image/png");De(W)}catch(i){console.warn("Capture error:",i)}}function Hn(){return ue.length?e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs",children:[e.jsx("span",{children:"Cam:"}),e.jsxs("select",{className:"bg-black/20 rounded px-1 py-0.5",value:O||"",onChange:async i=>{if(He)return;const d=i.target.value||void 0,g=ue.find(L=>L.deviceId===d)?.label;E(d,g||"",!0),$s(),await new Promise(L=>setTimeout(L,150));try{await js()}catch(L){console.warn("Failed to start camera after device switch:",L),setTimeout(async()=>{try{await js()}catch(G){console.error("Camera switch failed after retry:",G),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),ue.map(i=>e.jsx("option",{value:i.deviceId,children:i.label||(i.deviceId?`Camera (${i.deviceId.slice(0,6)})`:"Camera")},i.deviceId))]}),e.jsx("button",{className:"btn btn--ghost btn-sm ml-2",onClick:async()=>{try{const i=await navigator.mediaDevices.enumerateDevices();xe(i.filter(d=>d.kind==="videoinput"))}catch(i){console.warn("Rescan failed:",i),alert("Failed to rescan devices. Ensure camera permissions are granted.")}},title:"Rescan connected cameras",children:"Rescan"})]}):null}n.useEffect(()=>{},[te,Ve,ke,se,Ke,pe,oe]),n.useEffect(()=>{if(se||X!=="built-in")return;const i=Ir.getState(),g=et.getState().preferredCameraLabel==="Phone Camera"?i.getVideoElementRef?.()||null:S.current;if(!g||!te||!Ve)return;let L=!1;const G=g,_=$.current;if(!_)return;gs.current||(gs.current=new ql);const W=()=>{if(!L){try{const M=G.videoWidth||0,ae=G.videoHeight||0;if(!M||!ae){Xt.current=requestAnimationFrame(W);return}_.width!==M&&(_.width=M),_.height!==ae&&(_.height=ae);const Qe=_.getContext("2d",{willReadFrequently:!0});if(!Qe){Xt.current=requestAnimationFrame(W);return}Qe.drawImage(G,0,0,M,ae);const be=Qe.getImageData(0,0,M,ae);Ae.current++;const Pe=pi(te,{x:0,y:0}),_e=pi(te,{x:Ms.doubleOuter,y:0}),yt=M/Ve.w,it=ae/Ve.h,rt=Pe.x*yt,Kt=Pe.y*it,Ta=_e.x*yt,Ns=_e.y*it,ws=Math.hypot(Ta-rt,Ns-Kt)*1.08,ls=gs.current;if(On>=0&&ls.setROI(rt,Kt,Math.max(24,Math.min(Math.max(M,ae),ws))),!Fs&&Z<3&&hs.current&&Ae.current>150){const St=ls.detect(be),at=performance.now();if(Be.current&&at-Be.current.firstTs>900&&(Be.current=null),St&&St.confidence>=no){const Ks=ns.current>0&&at-ns.current<to,_n=Rl(_,St.tip,6),os={x:_n.x/yt,y:_n.y/it},Jt=wi(te,os),ft=Jt.ring,zt=Jt.base,dt=`${ft} ${zt>0?zt:""}`.trim(),ys=Jt.sector??null,Ss=Math.max(0,Number(Jt.mult)||0);let zs=!1;ie(dt),z(zt),ze(ft);const Mt=Ge=>{if(Ge.value>0){Je(!0),Ps(!0);try{Ut.current&&clearTimeout(Ut.current)}catch{}Ut.current=window.setTimeout(()=>{Ps(!1),Ut.current=null},1500);try{wt(Ge.value,Ge.label,Ge.ring)}catch{}}else Je(!1);try{o&&o(Ge.value,Ge.ring,{sector:Ge.sector,mult:Ge.mult})}catch{}};if(Ks)Be.current=null,zs=!0;else if(ft==="MISS"||zt<=0){Be.current=null,Je(!1);try{o&&o(zt,ft,{sector:ys,mult:Ss})}catch{}zs=!0}else{const Ge=Be.current;!Ge||Ge.value!==zt||Ge.ring!==ft?Be.current={value:zt,ring:ft,label:dt,sector:ys,mult:Ss,firstTs:at,frames:1}:Be.current={...Ge,label:dt,frames:Ge.frames+1};const qe=Be.current,Ue=at-qe.firstTs,At=qe.frames>=Ql||Ue>=Zl,Ot=at-As.current>=eo;At&&Ot&&(Mt(qe),Be.current=null,As.current=at,zs=!0)}en({ts:at,label:dt,value:zt,ring:ft,confidence:St.confidence,ready:zs,accepted:zs&&zt>0&&ft!=="MISS",warmup:Ks});try{if(zt>0&&ft!=="MISS"){const qe=ce.current;if(qe){const Ue=qe.getContext("2d");if(Ue){const At=_n.x/M*qe.width,Ot=_n.y/ae*qe.height;if(Ue.save(),Ue.beginPath(),Ue.strokeStyle="#f59e0b",Ue.lineWidth=2,Ue.arc(At,Ot,6,0,Math.PI*2),Ue.stroke(),St.axis){const Ie=St.axis,Ze=Ie.x1/M*qe.width,Gs=Ie.y1/ae*qe.height,cs=Ie.x2/M*qe.width,Ft=Ie.y2/ae*qe.height;Ue.beginPath(),Ue.moveTo(Ze,Gs),Ue.lineTo(cs,Ft),Ue.stroke()}if(St.bbox){const Ie=St.bbox.x/M*qe.width,Ze=St.bbox.y/ae*qe.height,Gs=St.bbox.w/M*qe.width,cs=St.bbox.h/ae*qe.height;Ue.strokeStyle="#22d3ee",Ue.strokeRect(Ie,Ze,Gs,cs)}Ue.restore()}}}}catch{}zs&&ls.accept(be,St)}else Be.current&&at-Be.current.firstTs>800&&(Be.current=null)}}catch{}Xt.current=requestAnimationFrame(W)}};return Xt.current=requestAnimationFrame(W),()=>{L=!0,Xt.current&&cancelAnimationFrame(Xt.current),Xt.current=null}},[se,X,ke,te,Ve,Fs,Z,On,en]);const Hs=n.useCallback(async()=>{try{if(Ke){const i=ue.find(d=>d.kind==="videoinput");i?E(i.deviceId,i.label||"",!0):E(void 0,"",!0)}await js()}catch(i){console.warn("[CameraView] Local camera fallback failed:",i)}},[ue,Ke,E]);n.useEffect(()=>{try{kn.getState().setCalibrationStatus({hasHomography:!!te,imageSize:Ve})}catch{}},[te,Ve]),n.useEffect(()=>{if(X!=="external-ws"||!k)return;const i=Yl(k,d=>{if(!(!hs.current||performance.now()-ns.current<5e3))if(o){try{o(d.value,d.ring,{sector:d.sector??null,mult:d.mult??0})}catch{}try{Rn({playerId:ge.players[ge.currentPlayerIdx]?.id??null,sector:d.sector??null,mult:d.mult??0,ring:d.ring,ts:Date.now()})}catch{}}else{const g=d.ring==="INNER_BULL"?"INNER_BULL 50":d.ring==="BULL"?"BULL 25":`${d.ring[0]}${d.value/(d.mult||1)||d.value} ${d.value}`;wt(d.value,g,d.ring);try{Rn({playerId:ge.players[ge.currentPlayerIdx]?.id??null,sector:d.sector??null,mult:d.mult??0,ring:d.ring,ts:Date.now()})}catch{}}});return()=>i.close()},[X,k]);function Vn(i){if(!ce.current||!te||!Ve)return;const d=ce.current.getBoundingClientRect(),g=i.clientX-d.left,L=i.clientY-d.top,G=ce.current.width/Ve.w,_=ce.current.height/Ve.h,W={x:g/G,y:L/_},M=wi(te,W),ae=`${M.ring} ${M.base>0?M.base:""}`.trim();ie(ae),z(M.base),ze(M.ring),Je(!0);try{if(m&&o){o(M.base,M.ring,{sector:M.sector,mult:M.mult});try{Rn({playerId:ge.players[ge.currentPlayerIdx]?.id??null,sector:M.sector??null,mult:M.mult??0,ring:M.ring,ts:Date.now()})}catch{}Je(!1)}}catch{}}function Yt(i){const d=i.trim().toUpperCase();if(!d)return null;const g=d==="BULL"||d==="50"||d==="DBULL"||d==="IBULL",L=d==="25"||d==="OBULL";if(g)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(L)return{label:"BULL 25",value:25,ring:"BULL"};const G=d.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!G)return null;const _=G[1]||"S",W=parseInt(G[2],10);if(W<1||W>20)return null;const M=_==="S"?1:_==="D"?2:3,ae=_==="S"?"SINGLE":_==="D"?"DOUBLE":"TRIPLE";return{label:`${_}${W} ${W*M}`,value:W*M,ring:ae}}function rn(){const i=ge;if(!i.players.length)return i.startingScore;const d=i.players[i.currentPlayerIdx],g=d.legs[d.legs.length-1];return g?g.totalScoreRemaining:i.startingScore}function wt(i,d,g){if(Me&&J){if(!In){Ps(!0);try{Ut.current&&clearTimeout(Ut.current)}catch{}Ut.current=window.setTimeout(()=>{Ps(!1),Ut.current=null},1200)}return}if(u==="custom"){if(f)try{f(i,g,{label:d})}catch{}if(Z>=3){ye(1),ve(i),j([{label:d,value:i,ring:g}]);return}const Pe=Z+1;ye(Pe),ve(_e=>_e+i),j(_e=>[..._e,{label:d,value:i,ring:g}]);return}if(Z>=3){const Pe=Ne,_e=Z;is(Pe,_e,{preOpenDarts:F||0,doubleWindowDarts:V||0,finishedByDouble:!1,visitTotal:Pe});try{const rt=ge.players[ge.currentPlayerIdx]?.name;rt&&sr(rt,_e,Pe)}catch{}const yt=!Vt||Wt||g==="DOUBLE"||g==="INNER_BULL",it=yt?i:0;ye(1),ve(it),j([{label:d,value:it,ring:g}]),v(yt?0:1),ee(0),Vt&&!Wt&&(g==="DOUBLE"||g==="INNER_BULL")&&Br(!0),ot({score:Pe,darts:_e,finished:!1});return}const L=Z+1,_=!Vt||Wt||g==="DOUBLE"||g==="INNER_BULL"?i:0;Vt&&!Wt&&(g==="DOUBLE"||g==="INNER_BULL")&&Br(!0);const W=Ne+_,ae=rn()-W,Qe=ae===0&&(g==="DOUBLE"||g==="INNER_BULL");if(ae<0||ae===1||ae===0&&!Qe){const _e=(F||0)+(Vt&&!Wt&&!(g==="DOUBLE"||g==="INNER_BULL")?1:0),yt=ae,it=ae+_,rt=it>50&&yt<=50||it<=50?1:0,Kt=(V||0)+rt;is(0,L,{preOpenDarts:_e,doubleWindowDarts:Kt,finishedByDouble:!1,visitTotal:0}),ye(0),ve(0),j([]),v(0),ee(0),ot({score:0,darts:L,finished:!1});return}ye(L),ve(W),j(Pe=>[...Pe,{label:d,value:_,ring:g}]),Vt&&!Wt&&!(g==="DOUBLE"||g==="INNER_BULL")&&v(Pe=>(Pe||0)+1);{const Pe=ae,_e=ae+_;(_e>50&&Pe<=50||_e<=50)&&ee(it=>(it||0)+1)}if(Qe){is(W,L,{preOpenDarts:F||0,doubleWindowDarts:V||0,finishedByDouble:!0,visitTotal:W}),En(W),ye(0),ve(0),j([]),v(0),ee(0),ot({score:W,darts:L,finished:!0});return}L>=3&&(is(W,L,{preOpenDarts:F||0,doubleWindowDarts:V||0,finishedByDouble:!1,visitTotal:W}),ye(0),ve(0),j([]),v(0),ee(0),ot({score:W,darts:L,finished:!1}))}function an(){if(!(Me&&J)&&Re){if(o)try{o(ne,de,void 0)}catch{}else wt(ne,Re,de);$e(0),Je(!1)}}function Vs(){if(Me&&J)return;const i=Yt(Xe);if(!i){alert("Enter like T20, D16, 5, 25, 50");return}if(!Nt||!Re||de==="MISS"||ne===0){const d=Dt+1;$e(d),d>=5&&Tt(!0)}else $e(0);wt(i.value,i.label,i.ring),Fe(""),Je(!1)}function ln(){if(Me&&J)return;const i=Yt(Xe);if(!i){alert("Enter like T20, D16, 5, 25, 50");return}if(Z===0||x.length===0){Vs();return}if(u==="custom"){if(!Nt||!Re||de==="MISS"||ne===0){const be=Dt+1;$e(be),be>=5&&Tt(!0)}else $e(0);if(j(be=>[...be.slice(0,-1),{label:i.label,value:i.value,ring:i.ring}]),y)try{y(i.value,i.ring,{label:i.label})}catch{}Fe(""),Je(!1);return}if(!Nt||!Re||de==="MISS"||ne===0){const be=Dt+1;$e(be),be>=5&&Tt(!0)}else $e(0);const d=x[x.length-1],g=Z-1,L=Ne-(d?.value||0),G=rn(),_=L+i.value,W=g+1,M=G-_,ae=M===0&&(i.ring==="DOUBLE"||i.ring==="INNER_BULL");if(M<0||M===1||M===0&&!ae){is(0,W);try{const be=ge.players[ge.currentPlayerIdx]?.name;be&&sr(be,W,0)}catch{}ye(0),ve(0),j([]),ot({score:0,darts:W,finished:!1}),Fe(""),Je(!1);return}if(ye(W),ve(_),j(be=>[...be.slice(0,-1),{label:i.label,value:i.value,ring:i.ring}]),ae){is(_,W),En(_);try{const be=ge.players[ge.currentPlayerIdx]?.name;be&&sr(be,W,_)}catch{}ye(0),ve(0),j([]),ot({score:_,darts:W,finished:!0}),Fe(""),Je(!1);return}if(W>=3){is(_,W);try{const be=ge.players[ge.currentPlayerIdx]?.name;be&&sr(be,W,_)}catch{}ye(0),ve(0),j([]),ot({score:_,darts:W,finished:!1})}Fe(""),Je(!1)}function Ws(){Tt(!1),$e(0);try{window.dispatchEvent(new CustomEvent("ndn:request-calibrate"))}catch{}}function Fr(){ms(),Tt(!1),$e(0)}n.useEffect(()=>{function i(d){try{const L=document.activeElement?.tagName?.toLowerCase();d.key==="m"&&L!=="input"&&L!=="textarea"&&(Gt("manual"),_t(!0))}catch{}}return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[]);function _s(i,d){if(Z>=3||Me&&J)return;const g=i*(d==="S"?1:d==="D"?2:3),L=d==="S"?"SINGLE":d==="D"?"DOUBLE":"TRIPLE";if(!Nt||!Re||de==="MISS"||ne===0){const G=Dt+1;$e(G),G>=5&&Tt(!0)}else $e(0);wt(g,`${d}${i} ${g}`,L),Je(!1)}function Wn(){if(Z===0)return;const i=x[x.length-1];ye(d=>d-1),ve(d=>d-(i?.value||0)),j(d=>d.slice(0,-1))}function cr(){if(Z===0||Me&&J)return;if(u==="custom"){ye(0),ve(0),j([]);return}const i=Ne,d=Z;is(i,d);try{const g=ge.players[ge.currentPlayerIdx]?.name;g&&sr(g,d,i)}catch{}ye(0),ve(0),j([]),ot({score:i,darts:d,finished:!1})}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[r&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!se&&e.jsx("button",{className:`btn px-3 py-1 text-sm ${Bn==="auto"?"tab--active":""}`,onClick:()=>{Gt("auto"),_t(!1),Us(!0)},children:"Autoscore"}),e.jsx("button",{className:`btn px-3 py-1 text-sm ${Bn==="manual"?"tab--active":""}`,onClick:()=>{Gt("manual"),_t(!0)},title:"Open Manual Correction",children:"Manual Correction"}),se&&e.jsx("span",{className:"text-xs opacity-70",children:"Manual scoring mode active"})]})}),!l&&!se?e.jsxs("div",{className:"card relative camera-fullwidth-card lg:col-span-2",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(va,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,autoFill:!0,children:[e.jsx(Hn,{}),(()=>{const i=we||et.getState().cameraAspect||"wide",d=(je||et.getState().cameraFitMode||"fit")==="fit",g=i==="square"?"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black":d?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",L=i==="square"?"relative w-full mx-auto aspect-square bg-black":"relative w-full aspect-[4/3] bg-black",G=()=>e.jsxs("div",{className:L,children:[e.jsx("video",{ref:S,className:g,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:ce,className:"absolute inset-0 w-full h-full",onClick:Vn}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3 cursor-pointer select-none",onDoubleClick:nr,"aria-label":`Visit status: ${x[0]?x[0].value>0?"hit":"miss":"pending"}, ${x[1]?x[1].value>0?"hit":"miss":"pending"}, ${x[2]?x[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(_=>{const W=x[_],M=ss[_],ae=!W,Qe=!!W&&M===We,be=typeof W?.value=="number"?W.value>0:!1,Pe=(W?.ring&&W.ring!=="MISS")??!1,yt=Qe?Qe&&(be||Pe)?"bg-emerald-400":"bg-rose-500":"bg-gray-500/70",it=Qe&&!ae;return e.jsx("span",{className:`visit-dot ${it?"active":"inactive"} ${yt}`},_)}),ps&&qt!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,qt),"s"]})]}),Me&&J?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return Ke?fe?G():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:vs,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{A.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Hs,disabled:!ue.length,children:"Use Local Camera"})]})]})}):G()})()]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsxs("button",{className:"btn btn--ghost px-3 py-1 text-xs font-semibold",onClick:()=>Es(i=>!i),children:[q?"Hide":"Show"," detection log"]}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Recent detections: ",rs.length]})]}),q&&e.jsx("div",{className:"mt-2 rounded-2xl border border-white/15 bg-slate-900/80 p-3 text-xs text-white font-mono max-h-36 overflow-y-auto space-y-1",children:rs.length===0?e.jsx("div",{className:"text-center text-slate-400",children:"No autoscore detections yet."}):rs.slice().reverse().map(i=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"truncate flex-1",title:`Value ${i.value} ${i.ring}`,children:i.label.padEnd(6," ")}),e.jsx("span",{className:"text-slate-400",children:i.confidence.toFixed(2)}),e.jsx("span",{className:`px-2 rounded-full text-[10px] font-semibold ${i.accepted?"bg-emerald-500/80":i.ready?"bg-amber-500/80":"bg-rose-500/80"}`,children:i.accepted?"accepted":i.ready?"queued":"ignored"})]},i.ts))}),ct?e.jsx("div",{className:"absolute top-3 right-3 z-30",children:(()=>{let i="bg-white/90 text-slate-800",d="Manual Correction (M)";Nt&&(!!Re&&de!=="MISS"&&ne>0?(i="bg-emerald-600 text-white",d=`Manual Correction (M) â€” Autoscore: ${Re} (confirmed)`):(i="bg-amber-400 text-black",d=`Manual Correction (M) â€” Autoscore ambiguous: ${Re||"â€”"}`));const g="px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90",L=Nt&&!!Re&&de!=="MISS"&&ne>0,G=In&&L?"ring-4 ring-emerald-400/60 animate-ping":Nt&&!L?"animate-pulse":"";return e.jsx("button",{className:`${g} ${i} ${G}`,onClick:()=>{Gt("manual"),_t(!0)},title:d,children:"Manual"})})()}):null,e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[Ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${fe?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:fe?"ðŸ“± Phone camera stream active":"ðŸ“± Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:vs,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{A.setShowOverlay?.(!A.showOverlay)}catch{}},children:A.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!fe,onClick:()=>{try{A.clearSession?.()}catch{}},children:"Stop Phone Feed"}),nn&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Hs,disabled:!ue.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:p?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:$s,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:js,disabled:He,children:He?"Connecting Camera...":"Connect Camera"})}),!se&&e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:Is,title:"Open phone, WiFi, and USB camera options",children:"Camera Devices"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Ce(!oe),title:"Toggle the board guide overlay",children:oe?"Show board guides":"Hide board guides"}),e.jsx("button",{className:`btn ${T?"bg-rose-600 hover:bg-rose-700 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white"}`,onClick:()=>Y(!T),title:"Toggle whether the camera is used for scoring",children:T?"Disable camera mode":"Enable camera mode"}),e.jsx("button",{className:"btn",onClick:$n,disabled:!ke,children:"Capture Still"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",disabled:!ke,onClick:()=>{gs.current=null,Fn(i=>i+1)},children:"Reset Autoscore Background"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}):null,ct?e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{className:"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg",title:"Open Manual Correction (M)",onClick:()=>{Gt("manual"),_t(!0)},children:"âœï¸"})}):null,!l&&se&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Manual Scoring"}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:"Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{_t(!0),Gt("manual")},children:"Open Manual Correction"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Manage Pending Visit"})]})]}),e.jsx("canvas",{ref:$,className:"hidden"}),or&&!se&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(Cn,{storageKey:"ndn:autoscore:size",className:"w-full max-w-3xl",defaultWidth:720,defaultHeight:520,minWidth:420,minHeight:320,maxWidth:1400,maxHeight:900,initialFitHeight:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Autoscore"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn btn--ghost",onClick:()=>Us(!1),children:"Close"})})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Click the camera overlay to autoscore. Use Manual Correction if the last auto is off."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:Re||"â€”"}),e.jsx("button",{className:"btn",onClick:an,disabled:Z>=3,children:"Add Auto Dart"}),Dt>0&&e.jsxs("span",{className:"text-sm opacity-80",children:["No-registers: ",Dt,"/3"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:Z>=3,onClick:()=>{if(!Nt||!Re||de==="MISS"||ne===0){const i=Dt+1;$e(i),i>=5&&Tt(!0)}else $e(0);wt(25,"BULL 25","BULL"),Je(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:Z>=3,onClick:()=>{if(!Nt||!Re||de==="MISS"||ne===0){const i=Dt+1;$e(i),i>=5&&Tt(!0)}else $e(0);wt(50,"INNER_BULL 50","INNER_BULL"),Je(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"autoscore-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:bs,onChange:i=>ar(i.target.value.toUpperCase()),onKeyDown:i=>{if(i.key==="Enter"){const d=bs.match(/^(S|D|T)(\d{1,2})$/);d&&_s(parseInt(d[2],10),d[1])}}}),e.jsx("datalist",{id:"autoscore-quick-list",children:["D","S","T"].map(i=>Array.from({length:20},(d,g)=>g+1).map(d=>e.jsx("option",{value:`${i}${d}`},`${i}${d}`)))}),e.jsx("button",{className:"btn",disabled:!bs||Z>=3,onClick:()=>{const i=bs.match(/^(S|D|T)(\d{1,2})$/);if(!i)return;const d=i[1],g=parseInt(i[2],10);_s(g,d)},children:"Add"})]})]})]})})}),sn&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex flex-col",children:e.jsxs(bi,{returnFocus:!0,children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{_t(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:Or,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:Re||"â€”"}),e.jsx("button",{className:"btn",onClick:an,disabled:Z>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-[1.2]",placeholder:"Manual (T20, D16, 5, 25, 50)",value:Xe,onChange:i=>Fe(i.target.value),onKeyDown:i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),Vs()),i.key==="Enter"&&i.shiftKey&&(i.preventDefault(),ln())}}),e.jsx("button",{className:"btn btn--ghost",onClick:ln,disabled:Z===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:Vs,disabled:Z>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add Â· Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Number pad"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 max-w-sm",children:[["7","8","9","4","5","6","1","2","3","0"].map(i=>e.jsx("button",{className:"btn text-lg",onClick:()=>{Fe(d=>/^[SDT]/i.test(d)?d+i:(d||"")+i)},children:i},i)),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:()=>Fe(""),children:"Clear"}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 text-white",onClick:()=>Fe(i=>(i||"").slice(0,-1)),children:"âŒ«"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>Vs(),disabled:Z>=3,children:"Enter"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Tap numbers then press Enter to submit. Use D/T prefixes for doubles/trebles (e.g., D16)."})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:Z>=3,onClick:()=>{if(!Nt||!Re||de==="MISS"||ne===0){const i=Dt+1;$e(i),i>=5&&Tt(!0)}else $e(0);wt(25,"BULL 25","BULL"),Je(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:Z>=3,onClick:()=>{if(!Nt||!Re||de==="MISS"||ne===0){const i=Dt+1;$e(i),i>=5&&Tt(!0)}else $e(0);wt(50,"INNER_BULL 50","INNER_BULL"),Je(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:Bs,onChange:i=>ir(i.target.value.toUpperCase()),onKeyDown:i=>{if(i.key==="Enter"){const d=Bs.match(/^(S|D|T)(\d{1,2})$/);d&&_s(parseInt(d[2],10),d[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(i=>Array.from({length:20},(d,g)=>g+1).map(d=>e.jsx("option",{value:`${i}${d}`},`${i}${d}`)))}),e.jsx("button",{className:"btn",disabled:!Bs||Z>=3,onClick:()=>{const i=Bs.match(/^(S|D|T)(\d{1,2})$/);if(!i)return;const d=i[1],g=parseInt(i[2],10);_s(g,d)},children:"Add"})]})]})]})]})})]})})}),Ur&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsx(bi,{returnFocus:!0,children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",role:"dialog","aria-modal":"true",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>Pn(!1),"aria-label":"Close scoring dialog",children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(va,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,children:[e.jsx(Hn,{}),(()=>{const d=(et.getState().cameraFitMode||"fit")==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",g=()=>e.jsxs("div",{className:"relative w-full aspect-[4/3] bg-black",children:[e.jsx("video",{ref:S,className:d,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:ce,className:"absolute inset-0 w-full h-full",onClick:Vn}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${x[0]?x[0].value>0?"hit":"miss":"pending"}, ${x[1]?x[1].value>0?"hit":"miss":"pending"}, ${x[2]?x[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(L=>{const G=x[L],_=!G,W=!!G&&(typeof G.value=="number"?G.value>0:!0),M=_?"bg-gray-500/70":W?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${M}`},L)}),ps&&qt!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,qt),"s"]})]}),Me&&J?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return Ke?fe?g():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:vs,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{A.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Hs,disabled:!ue.length,children:"Use Local Camera"})]})]})}):g()})()]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[Ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${fe?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:fe?"ðŸ“± Phone camera stream active":"ðŸ“± Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:vs,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{A.setShowOverlay?.(!A.showOverlay)}catch{}},children:A.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!fe,onClick:()=>{try{A.clearSession?.()}catch{}},children:"Stop Phone Feed"}),nn&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Hs,disabled:!ue.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:p?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:$s,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:js,children:"Connect Camera"})}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:$n,disabled:!ke,children:"Capture Still"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold",disabled:!ke,onClick:()=>{gs.current=null,Fn(i=>i+1)},children:"Reset Autoscore Background"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[0,1,2].map(i=>{const d=x[i],g=!d,L=!!d&&(typeof d.value=="number"?d.value>0:!0),G=g?"bg-gray-500/70":L?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-2.5 h-2.5 rounded-full shadow ${G}`},i)}),ps&&qt!==null&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold",children:[Math.max(0,qt),"s"]})]}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:x.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):x.map((i,d)=>e.jsx("li",{children:i.label},d))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",Z,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",Ne]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Wn,disabled:Z===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:cr,disabled:Z===0,children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:rr,disabled:Z===0,children:"Clear"})]})]})]})]})})}),lr&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>{Tt(!1),$e(0)},children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-white",children:"Recalibration Recommended"}),e.jsx("div",{className:"mb-4 text-lg font-semibold text-indigo-200",children:"We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Ws,children:"Go to Calibrate"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:Fr,children:"Reset Calibration"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{Tt(!1),$e(0)},children:"Dismiss"})]})]})})]})}function Ci(s,r,o,m){const l=(m-90)*Math.PI/180;return{x:s+o*Math.cos(l),y:r+o*Math.sin(l)}}function ki(s){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(s)*18+9}function ao({width:s=320,height:r=320}){const o=Oi(l=>l.samples),m=n.useRef(null);return n.useEffect(()=>{const l=m.current;if(!l)return;const u=l.getContext("2d");if(!u)return;l.width=s,l.height=r,u.clearRect(0,0,s,r);const f=s/2,y=r/2,C=Math.min(s,r)/(Ms.doubleOuter*2+20),D={bullInner:Ms.bullInner*C,bullOuter:Ms.bullOuter*C,trebleInner:Ms.trebleInner*C,trebleOuter:Ms.trebleOuter*C,doubleInner:Ms.doubleInner*C,doubleOuter:Ms.doubleOuter*C};u.strokeStyle="rgba(255,255,255,0.06)",u.lineWidth=1;const R=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const w of R)u.beginPath(),u.arc(f,y,D[w],0,Math.PI*2),u.stroke();const S=[];for(const w of o){let E=Math.random()*360,X=Math.random()*D.doubleOuter;typeof w.sector=="number"&&w.sector>=1&&w.sector<=20&&(E=ki(w.sector),w.ring==="DOUBLE"?X=(D.doubleInner+D.doubleOuter)/2:w.ring==="TRIPLE"?X=(D.trebleInner+D.trebleOuter)/2:w.ring==="INNER_BULL"?X=D.bullInner*.5:w.ring==="BULL"?X=D.bullOuter*.8:X=(D.trebleOuter+D.doubleInner)/2*(.6+Math.random()*.4));const k=Ci(f,y,X,E);S.push({x:k.x,y:k.y,w:1})}for(const w of S){const E=u.createRadialGradient(w.x,w.y,1,w.x,w.y,60);E.addColorStop(0,"rgba(255,0,0,0.9)"),E.addColorStop(.3,"rgba(255,100,0,0.5)"),E.addColorStop(1,"rgba(255,100,0,0)"),u.fillStyle=E,u.beginPath(),u.arc(w.x,w.y,60,0,Math.PI*2),u.fill()}u.fillStyle="rgba(255,255,255,0.85)",u.font="12px ui-sans-serif";const O={};for(const w of o)w.sector&&(O[w.sector]=(O[w.sector]||0)+1);for(const w of Object.keys(O)){const E=Number(w),X=ki(E),k=Ci(f,y,D.trebleOuter+18,X);u.fillText(String(O[E]),k.x-6,k.y+4)}},[o,s,r]),e.jsx("canvas",{ref:m,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}const Rr=[...Array.from({length:20},(s,r)=>({label:`D${r+1}`,score:(r+1)*2})),{label:"DBULL",score:50,isBull:!0}];function Di(s,r){const o=Rr[r];return!!o&&s===o.score}function Sn(s){const r=s.trim().toUpperCase();if(!r)return null;if(r==="50"||r==="BULL"||r==="DBULL"||r==="IBULL")return 50;if(r==="25"||r==="OBULL")return 25;const o=r.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!o)return null;const m=o[1]||"S",l=parseInt(o[2],10);return l<1||l>20?null:l*(m==="S"?1:m==="D"?2:3)}const Ls=[...Array.from({length:20},(s,r)=>r+1),25,50],ka=[20,19,18,17,16,15,25];function xa(){const s={};return ka.forEach(r=>{s[r]=0}),{marks:s,points:0}}function io(s,r,o,m,l=()=>!1){let u=null,f=0;if(o==="BULL"||o==="INNER_BULL"||r===25||r===50)u=25,f=o==="INNER_BULL"||r===50?2:1;else if(typeof m=="number"&&m>=15&&m<=20)u=m,o==="TRIPLE"?f=3:o==="DOUBLE"?f=2:f=1;else if(r){const w=[20,19,18,17,16,15];for(const E of w){if(r===E){u=E,f=1;break}if(r===E*2){u=E,f=2;break}if(r===E*3){u=E,f=3;break}}!u&&(r===25||r===50)&&(u=25,f=r===50?2:1)}if(!u)return 0;const y=s.marks[u],C=Math.max(0,3-y),D=Math.min(C,f),R=Math.max(0,f-D),S=y+D;s.marks[u]=S>3?3:S;let O=0;return R>0&&!l(u)&&(u===25?o==="INNER_BULL"?O+=50*R:O+=25*R:O+=u*R),s.points+=O,O}function lo(s){return ka.every(r=>(s.marks[r]||0)>=3)}function fa(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function oo(s){return s.round}function co(s,r,o,m){if(s.finished)return 0;const l=oo(s);let u=0;return typeof m=="number"&&m===l?o==="TRIPLE"?(u=l*3,s.turnHits.triples++):o==="DOUBLE"?(u=l*2,s.turnHits.doubles++):o==="SINGLE"&&(u=l*1,s.turnHits.singles++):!m&&(r===l||r===l*2||r===l*3)&&(r===l*3?(u=l*3,s.turnHits.triples++):r===l*2?(u=l*2,s.turnHits.doubles++):r===l&&(u=l,s.turnHits.singles++)),s.score+=u,u}function uo(s){if(!s.finished){if(s.turnHits.singles>0&&s.turnHits.doubles>0&&s.turnHits.triples>0){s.shanghaiAchieved=!0,s.finished=!0;return}const r=s.round+1;r>20?s.finished=!0:s.round=r}s.turnHits={singles:0,doubles:0,triples:0}}function ba(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function Fi(s){return s.targets[s.stage]||null}function mo(s,r,o,m){if(s.finished)return 0;const l=Fi(s);if(!l)return 0;let u=0;switch(l.kind){case"NUMBER":{typeof m=="number"&&m===l.num?o==="TRIPLE"?u=l.num*3:o==="DOUBLE"?u=l.num*2:o==="SINGLE"&&(u=l.num):!m&&(r===l.num||r===l.num*2||r===l.num*3)&&(u=r),u>0&&(s.hitThisRound=!0);break}case"DOUBLE":{(o==="DOUBLE"&&m===l.num||r===l.num*2)&&(u=l.num*2,s.hitThisRound=!0);break}case"TRIPLE":{(o==="TRIPLE"&&m===l.num||r===l.num*3)&&(u=l.num*3,s.hitThisRound=!0);break}case"BULL":{(o==="BULL"||o==="INNER_BULL"||r===25||r===50)&&(u=o==="INNER_BULL"||r===50?50:25,s.hitThisRound=!0);break}case"ANY_NUMBER":{r>0&&(u=r,s.hitThisRound=!0);break}}return s.score+=u,u}function ho(s){s.finished||(s.hitThisRound||(s.score=Math.floor(s.score/2)),s.hitThisRound=!1,s.stage+=1,s.stage>=s.targets.length&&(s.finished=!0))}function pa(){return{round:1,score:0,target:"HIGH",finished:!1}}function xo(s,r,o,m){if(s.finished)return 0;let l=0;if(s.target==="HIGH")if(o==="INNER_BULL")l=50;else if(typeof m=="number"){const f=m*(o==="TRIPLE"?3:o==="DOUBLE"?2:1);m>=20&&(l=f)}else r>=40&&(l=r);else if(typeof m=="number"){const f=m*(o==="TRIPLE"?3:o==="DOUBLE"?2:1);m<=10&&(l=f)}else r>0&&r<=30&&(l=r);return s.score+=l,l}function fo(s){if(!s.finished){if(s.round+=1,s.round>10){s.finished=!0;return}s.target=s.target==="HIGH"?"LOW":"HIGH"}}function bo(s,r=3){return{number:s,lives:r,isKiller:!1,eliminated:!1}}function po(s){const r=Array.from({length:20},(m,l)=>l+1),o={};for(const m of s){const l=Math.floor(Math.random()*r.length),u=r.splice(l,1)[0];o[m]=u}return o}function Ti(s,r,o,m){const l=r[s];if(!l||!m||!o)return{becameKiller:!1};if(!l.isKiller&&o==="DOUBLE"&&m===l.number)return l.isKiller=!0,{becameKiller:!0};if(l.isKiller&&(o==="DOUBLE"||o==="TRIPLE")){const u=Object.keys(r).find(f=>f!==s&&!r[f].eliminated&&r[f].number===m);if(u){const f=r[u],y=o==="TRIPLE"?2:1;return f.lives=Math.max(0,f.lives-y),f.lives===0&&(f.eliminated=!0),{becameKiller:!1,victimId:u,livesRemoved:y}}}return{becameKiller:!1}}function Li(s){const r=Object.entries(s).filter(([,o])=>!o.eliminated&&o.lives>0);return r.length===1?r[0][0]:null}function Mi(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function go(s,r,o,m){if(s.finished)return 0;let l=0;if(typeof m=="number"&&m===s.inning?o==="TRIPLE"?l=3:o==="DOUBLE"?l=2:l=1:!m&&(r===s.inning||r===s.inning*2||r===s.inning*3)&&(l=r===s.inning*3?3:r===s.inning*2?2:1),s.score+=l,s.dartsThisInning+=1,s.dartsThisInning>=3){const u=s.inning+1;u>9?s.finished=!0:(s.inning=u,s.dartsThisInning=0)}return l}const vo={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function Ai(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function jo(s,r,o,m){if(s.finished)return!1;const l=vo[s.hole];if(s.dartsThisHole+=1,typeof m=="number"&&m===l&&(o==="SINGLE"||o==="DOUBLE"||o==="TRIPLE")||!m&&(r===l||r===l*2||r===l*3)){s.strokes+=s.dartsThisHole;const f=s.hole+1;return f>18?s.finished=!0:(s.hole=f,s.dartsThisHole=0),!0}if(s.dartsThisHole>=3){s.strokes+=3;const f=s.hole+1;f>18?s.finished=!0:(s.hole=f,s.dartsThisHole=0)}return!1}const $i={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function Ei(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function No(s){const r=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[o,m,l]of r)if(s[o]&&s[o]===s[m]&&s[o]===s[l])return s[o];return s.every(o=>o)?"Draw":null}function wo(s,r,o,m,l){if(s.finished||s.board[r])return!1;const u=$i[r];let f=!1;if(u.type==="BULL"?f=m==="BULL"||m==="INNER_BULL"||o===25||o===50:u.type==="NUM"&&typeof u.num=="number"&&(typeof l=="number"&&l===u.num||!l&&(o===u.num||o===u.num*2||o===u.num*3))&&(f=!0),!f)return!1;s.board[r]=s.turn;const y=No(s.board);return y?(s.finished=!0,s.winner=y,!0):(s.turn=s.turn==="X"?"O":"X",!0)}function ja(){return{targetIndex:0,darts:0,finished:!1}}const Hi=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25],ga=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","Bull"];function yo(s){return Hi[s.targetIndex]}function Na(s,r,o){if(s.finished)return s;const m=yo(s);if(!(o==="SINGLE"&&r===m||o==="DOUBLE"&&r===m||o==="TRIPLE"&&r===m||o==="INNER_BULL"&&m===25))return s;const u=s.targetIndex+1,f=u>=Hi.length;return{targetIndex:u,darts:s.darts+1,finished:f}}function Ri(s,r){return Na(s,r,"SINGLE")}function So(){return ja()}function wa(s=50){return{score:0,darts:0,finished:!1,target:s}}const Co=[5,10,15,20,25,50];function ko(s){return Co.includes(s)}function ya(s,r,o){if(s.finished)return s;if(!ko(r))return{...s,darts:s.darts+1};const m=s.score+r,l=m>=s.target;return{score:l?s.target:m,darts:s.darts+1,finished:l,target:s.target}}function Ii(s,r){return ya(s,r)}function Do(s=50){return wa(s)}function Sa(s=70){return{score:0,darts:0,finished:!1,target:s}}const To=[7,14,21];function Lo(s){return To.includes(s)}function Ca(s,r,o){if(s.finished)return s;if(!Lo(r))return{...s,darts:s.darts+1};const m=s.score+r,l=m>=s.target;return{score:l?s.target:m,darts:s.darts+1,finished:l,target:s.target}}function Bi(s,r){return Ca(s,r)}function Mo(s=70){return Sa(s)}const Da=[20,19,18,17,16,15,14,13,12,25];function Pi(){const s={};return Da.forEach(r=>{s[r]=0}),{marks:s,points:0}}function Ao(s,r,o,m,l=()=>!1){let u=null,f=0;if(o==="BULL"||o==="INNER_BULL"||r===25||r===50)u=25,f=o==="INNER_BULL"||r===50?2:1;else if(typeof m=="number"&&m>=12&&m<=20)u=m,o==="TRIPLE"?f=3:o==="DOUBLE"?f=2:f=1;else if(r){for(const w of[20,19,18,17,16,15,14,13,12]){if(r===w){u=w,f=1;break}if(r===w*2){u=w,f=2;break}if(r===w*3){u=w,f=3;break}}!u&&(r===25||r===50)&&(u=25,f=r===50?2:1)}if(!u)return 0;const y=s.marks[u],C=Math.max(0,3-y),D=Math.min(C,f),R=Math.max(0,f-D),S=y+D;s.marks[u]=S>3?3:S;let O=0;return R>0&&!l(u)&&(u===25?o==="INNER_BULL"?O+=50*R:O+=25*R:O+=u*R),s.points+=O,O}function Eo(s){return Da.every(r=>(s.marks[r]||0)>=3)}function Ro({left:s,right:r,className:o="",sticky:m=!0}){return e.jsxs("div",{className:`${m?"sticky top-0":""} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${o}`,children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:s}),e.jsx("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:r})]})}function es({gameMode:s,players:r,matchScore:o,gameRules:m}){return!r||r.length===0?null:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:r.map((l,u)=>e.jsxs("div",{className:`rounded-lg border p-3 ${l.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-2 uppercase tracking-wide ${l.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:l.name}),e.jsxs("div",{className:"space-y-1 text-sm",children:[s==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Legs Won",value:`â— ${l.legsWon||0}`,highlight:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0}),e.jsx(le,{label:"Last Score",value:l.lastScore||"0",mono:!0}),e.jsx(le,{label:"C/Out Rate",value:`${l.checkoutRate||0}%`,mono:!0}),e.jsx(le,{label:"Best Leg",value:l.bestLeg||"â€”",mono:!0}),l.matchAvg!==void 0&&l.allTimeAvg!==void 0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[e.jsx(le,{label:"Match Avg",value:l.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:l.matchAvg>0}),e.jsx(Io,{matchAvg:l.matchAvg,allTimeAvg:l.allTimeAvg})]})})]}),(s==="Cricket"||s==="American Cricket")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Closed",value:Bo(l.closed),mono:!0}),e.jsx(le,{label:"Points",value:l.points||0,mono:!0,bold:!0}),e.jsx(le,{label:"Status",value:Po(l),highlight:l.isCurrentTurn})]}),(s==="Shanghai"||s==="Halve It")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:s==="Shanghai"?"Round":"Stage",value:l.round||1,mono:!0}),e.jsx(le,{label:"Target",value:l.target||"â€”",mono:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Killer"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Target #",value:l.number||"â€”",mono:!0,bold:!0}),e.jsx(le,{label:"Lives",value:l.lives||0,mono:!0,bold:!0}),l.eliminated&&e.jsx(le,{label:"Status",value:"ELIMINATED",highlight:!1})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Round",value:l.round||1,mono:!0}),e.jsx(le,{label:"Target",value:l.target||"High",mono:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),(s==="Double Practice"||s==="Treble Practice"||s==="Around the Clock")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Target",value:l.target||"â€”",mono:!0,bold:!0}),e.jsx(le,{label:"Hits",value:l.hits||0,mono:!0,bold:!0}),l.totalNeeded&&e.jsx(le,{label:"Progress",value:`${l.hits||0} / ${l.totalNeeded}`,mono:!0})]}),(s==="Count-Up"||s==="High Score"||s==="Low Score")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Round",value:l.round||1,mono:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0}),s==="High Score"&&e.jsx(le,{label:"Best",value:l.bestScore||0,mono:!0})]}),(s==="Checkout 170"||s==="Checkout 121")&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Remaining",value:l.remaining||0,mono:!0,bold:!0}),e.jsx(le,{label:"Attempts",value:l.attempts||0,mono:!0}),e.jsx(le,{label:"Successes",value:l.successes||0,mono:!0})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Target",value:`D${l.target||1}`,mono:!0,bold:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Inning",value:l.inning||1,mono:!0}),e.jsx(le,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Hole",value:l.hole||1,mono:!0}),e.jsx(le,{label:"Strokes",value:l.strokes||0,mono:!0,bold:!0})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{label:"Turn",value:l.turn||1,mono:!0}),l.winner&&e.jsx(le,{label:"Result",value:"WINNER!",highlight:!0})]}),o&&(s==="X01"||s==="Cricket"||s==="American Cricket")&&u===1&&e.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:e.jsx(le,{label:"Match",value:o,mono:!0,bold:!0,highlight:!0})})]})]},u))})}function le({label:s,value:r,mono:o=!1,bold:m=!1,highlight:l=!1}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"opacity-70",children:[s,":"]}),e.jsx("span",{className:`${o?"font-mono":""} ${m?"font-semibold":""} ${l?"text-emerald-300":""}`,children:r})]})}function Io({matchAvg:s,allTimeAvg:r}){const o=s-r,m=o>0,l=Math.abs(o)<.01;let u="",f="text-slate-300";return l?(u="= All-time",f="text-slate-300"):m?(u=`+${o.toFixed(2)} vs avg`,f="text-emerald-400"):(u=`${o.toFixed(2)} vs avg`,f="text-orange-400"),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-70",children:"AVG vs Avg:"}),e.jsx("span",{className:`font-mono font-semibold ${f}`,children:u})]})}function Bo(s){return!s||Object.keys(s).length===0?"â€”":Object.entries(s).filter(([o,m])=>m===3).map(([o])=>o==="25"?"B":o).join(",")||"â€”"}function Po(s){if(!s.closed)return"Starting";const r=Object.values(s.closed).filter(o=>o===3).length;return r===0?"No marks":r<7?`${r}/7`:"Closing in"}function Rt(s){return(r,o)=>{s(r)}}function Uo(s){const{match:r,commitManualVisitTotal:o,endTurn:m}=s;return{addVisit:(l,u=3,f)=>{if(o){o(l);return}try{r.addVisit(l,u,f)}catch{r.addVisit(l,u)}},undoVisit:()=>{r.undoVisit()},nextPlayer:()=>{if(m)try{m(0)}catch{r.nextPlayer()}else r.nextPlayer()},endLeg:l=>{typeof l=="number"?r.endLeg(l):r.endLeg(0)},endGame:()=>{r.endGame()}}}function Qs(s,r,o,m,l,u,f,y,C,D,R,S,O,w,E,X,k,we,je,he,T,Y,pe,oe,Ce,se,ue){return n.useMemo(()=>{const xe=[];if(s==="X01"){let $=0,ce=0,p=0;if(we&&we.length>0){for(const ke of we)ke.dartsThrown&&ke.totalScored&&(ce+=ke.dartsThrown,p+=ke.totalScored);ce>0&&($=p/ce*3)}const fe=(S??0)>0?y??0:D??null??(u??0);if(xe.push({name:"You",isCurrentTurn:!!je,legsWon:m||0,score:r||0,lastScore:fe,checkoutRate:E&&E>0?Math.round((w||0)/E*100):0,bestLeg:we&&we.length>0?`${Math.min(...we.map(ke=>ke.doubleDarts+(ke.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:$,allTimeAvg:Il("You")||0}),he&&he!=="None"){const te=(O??0)>0?C??0:R??null??(f??0);xe.push({name:`${he} AI`,isCurrentTurn:!je,legsWon:l||0,score:o||0,lastScore:te,checkoutRate:k&&k>0?Math.round((X||0)/k*100):0,bestLeg:"â€”"})}}return s==="Cricket"&&(xe.push({name:"You",isCurrentTurn:!!je,closed:Y?.marks||{},points:Y?.points||0}),he&&he!=="None"&&xe.push({name:`${he} AI`,isCurrentTurn:!je,closed:{},points:0})),s==="Shanghai"&&(xe.push({name:"You",isCurrentTurn:!!je,round:pe?.round||1,target:pe?.target||1,score:pe?.score||0}),he&&he!=="None"&&xe.push({name:`${he} AI`,isCurrentTurn:!je,round:pe?.round||1,target:pe?.target||1,score:0})),s==="Killer"&&oe&&oe.length>0&&oe.forEach(($,ce)=>{const p=Ce?.[$.id];xe.push({name:$.name,isCurrentTurn:ce===ue,number:se?.[$.id],lives:p?.lives||0,eliminated:p?.eliminated||!1})}),xe},[s,r,o,m,l,u,f,y,C,D,R,S,O,w,E,X,k,we,je,he,Y,pe,oe,Ce,se,ue])}const Oo=["Easy","Medium","Hardened"];function ts(s,r,o){return Math.max(r,Math.min(o,s))}const Fo=6500;function $o(s,r){let o=0;if(r==="Easy"){const m=[22,26,41,45,60];o=m[Math.floor(Math.random()*m.length)]}else r==="Medium"?o=Math.round(ts(60+(Math.random()*30-15),30,100)):o=Math.round(ts(80+(Math.random()*20-10),50,120));return s<=0?0:o>s?[100,85,81,60,57,45,41,26,22,20,1].find(l=>l<=s)??0:o}function Ho({onClose:s}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:s,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const Vo="http://localhost:8787";function ec({user:s}){const{offlineLayout:r,favoriteDouble:o,callerEnabled:m,callerVoice:l,callerVolume:u,speakCheckoutOnly:f,rememberLastOffline:y,setLastOffline:C,autoStartOffline:D,cameraScale:R,setCameraScale:S,cameraAspect:O="wide",setCameraAspect:w,cameraFitMode:E="fill",setCameraFitMode:X,cameraEnabled:k,textSize:we,boxSize:je,autoscoreProvider:he,autoCommitMode:T="wait-for-clear",matchType:Y="singles",setMatchType:pe,teamAName:oe="Team A",setTeamAName:Ce,teamBName:se="Team B",setTeamBName:ue}=et(),xe=he==="manual",$=k&&!xe,ce=k&&!xe&&T!=="immediate",[p,tt]=n.useState("X01"),[A,Ke]=n.useState(501),[Q,Ee]=n.useState("None"),[fe,ke]=n.useState(!1),[He,st]=n.useState(!1),[me,De]=n.useState(A),[te,Ve]=n.useState(A),[ms,It]=n.useState(!1),[Re,ie]=n.useState(!1),[Xe,Fe]=n.useState(1),[ne,z]=n.useState(0),de=Er(),[ze,Z]=n.useState(!1),ye=n.useRef(!1),[Ne,ve]=n.useState(0),[x,j]=n.useState(null),[F,v]=n.useState(1),[V,ee]=n.useState(1),[J,Ye]=n.useState([]),[Se,jt]=n.useState(2e3),Me=Bl(),[We,Bt]=n.useState(!1),[ss,Zs]=n.useState(r==="modern"),[Be,Dn]=n.useState(r==="modern");n.useEffect(()=>{Zs(r==="modern"),Dn(r==="modern")},[r]),n.useEffect(()=>{E!=="fit"&&X("fit")},[E,X]);const[As,ns]=n.useState(1),[hs,Ht]=n.useState(!1),[Ae,rs]=n.useState(!0);n.useEffect(()=>{const t=()=>fn(!0);return window.addEventListener("ndn:open-camera-manager",t),()=>window.removeEventListener("ndn:open-camera-manager",t)},[]);const[re,q]=n.useState(0),[Es,xs]=n.useState(0),[en,Pt]=n.useState(0),[ot,Rs]=n.useState(0),[nr,rr]=n.useState(0),[Is,Tn]=n.useState(xa()),[Vt,tn]=n.useState(fa()),[fs,ge]=n.useState(ba()),[as,Wt]=n.useState(pa()),[Br,ct]=n.useState(0),[Ln,Mn]=n.useState(1),[Pr,An]=n.useState(27),[is,En]=n.useState(0),[Rn,bs]=n.useState(0),[ar,Bs]=n.useState(!1),[ir,Dt]=n.useState(1),[$e,lr]=n.useState(0),[Tt,Nt]=n.useState(0),Je=8,[In,Ps]=n.useState(1),[Ut,Bn]=n.useState(0),[Gt,sn]=n.useState(0),_t=10,[or,Us]=n.useState(1),[Ur,Pn]=n.useState(0),[Or,ps]=n.useState(0),Un=10,[qt,Os]=n.useState(170),[Lt,Fs]=n.useState(0),[gs,Xt]=n.useState(0),[On,Fn]=n.useState(0),[vs,nn]=n.useState(121),[js,$s]=n.useState(0),[$n,Hn]=n.useState(0),[Hs,Vn]=n.useState(0),[Yt,rn]=n.useState(20),[wt,an]=n.useState(0),[Vs,ln]=n.useState(0),[Ws,Fr]=n.useState(30),[_s,Wn]=n.useState(!1),[cr,i]=n.useState(Mi()),[d,g]=n.useState(Ai()),[L,G]=n.useState(Ei()),[_,W]=n.useState(Pi()),[M,ae]=n.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[Qe,be]=n.useState({}),[Pe,_e]=n.useState({}),[yt,it]=n.useState(!1),[rt,Kt]=n.useState(0),[Ta,Ns]=n.useState(0),[ws,ls]=n.useState(null),[St,at]=n.useState(""),[Ks,_n]=n.useState(ja()),[os,Jt]=n.useState(ja()),[ft,zt]=n.useState(wa(50)),[dt,ys]=n.useState(wa(50)),[Ss,zs]=n.useState(Sa(70)),[Mt,Ge]=n.useState(Sa(70)),[qe,Ue]=n.useState(0),[At,Ot]=n.useState(0),[Ie,Ze]=n.useState(0),[Gs,cs]=n.useState(A),[Ft,Ct]=n.useState(0),[on,ds]=n.useState(null),[dr,bt]=n.useState(0),qs=n.useRef(0),Vi=n.useRef(0),ut=n.useRef(me),mt=n.useRef(Ie),pt=n.useRef(Ft),Xs=n.useRef(Gs),ht=n.useRef(dr);n.useEffect(()=>{ut.current=me},[me]),n.useEffect(()=>{mt.current=Ie},[Ie]),n.useEffect(()=>{pt.current=Ft},[Ft]),n.useEffect(()=>{Xs.current=Gs},[Gs]),n.useEffect(()=>{ht.current=dr},[dr]);const[Wi,Kn]=n.useState(0);n.useRef(null);const[ur,$r]=n.useState(0),[Ys,mr]=n.useState(0),[cn,Js]=n.useState(0),[dn,us]=n.useState(0),[un,mn]=n.useState(null),[Hr,hn]=n.useState(0),[zn,Gn]=n.useState(0),[Vr,hr]=n.useState(0),[qn,La]=n.useState(0),[Wr,Ma]=n.useState(0),[Xn,xn]=n.useState(0),[Yn,Aa]=n.useState(0),[_r,Jn]=n.useState(0),[Kr,Ea]=n.useState(0),[Ra,xr]=n.useState(0),[_i,fr]=n.useState(0),[Ki,br]=n.useState(0),[Ia,zr]=n.useState(0),[zi,Gr]=n.useState(0),[Gi,qr]=n.useState(0),[qi,pr]=n.useState(0),[Xi,Ba]=n.useState(0),[Yi,Xr]=n.useState(!1),[xt,lt]=n.useState(""),[Yr,Qn]=n.useState(""),[Wo,_o]=n.useState(""),[Pa,Ua]=n.useState(""),[Oa,Jr]=n.useState(""),[Fa,Qr]=n.useState(""),[gr,Zr]=n.useState(null),[Ji,fn]=n.useState(!1),[Qi,$a]=n.useState({}),[Zi,Zn]=n.useState(!1),Cs=n.useRef(null),ea=n.useRef(null),Qt=n.useCallback(()=>{const t=ea.current;t&&(clearTimeout(t),ea.current=null)},[]),vr=n.useCallback(t=>{if(!m)return;const a=s?.username||"Player";try{Ar(a,t.visitTotal,Math.max(t.remaining,0),l,{volume:u,checkoutOnly:f})}catch{}},[m,l,u,f,s?.username]),jr=n.useCallback((t,a)=>{Zn(!1);const{visitTotal:c,darts:h,preRemaining:b,remaining:P,doubleAttempts:B,finished:K,doubleWindow:I,highestCheckout:U}=t;K?(De(0),ut.current=0,typeof U=="number"&&U>0&&pr(N=>Math.max(N,U))):(De(P),ut.current=P),ds(c),c===180?xr(N=>N+1):c>=140?fr(N=>N+1):c>=100&&br(N=>N+1),I&&B>0&&(Gn(N=>N+B),K&&hr(N=>N+1)),t.announced||vr(t);try{kn.getState().recordVisit("offline-x01",h,c,{preRemaining:b,postRemaining:K?0:P,finish:K,bust:!1})}catch{}K&&(j("player"),ie(!0)),wn(K?0:P),Ct(0),pt.current=0,Ze(0),mt.current=0,bt(0),ht.current=0},[wn,pr,j,De,ds,Ct,Ze,bt,ie,xr,fr,br,Gn,hr,vr]),bn=n.useCallback(t=>{const a=Cs.current;a&&(Cs.current=null,Qt(),jr(a,t))},[Qt,jr]),Ha=n.useCallback(t=>{vr(t),Cs.current={...t,announced:!0},Zn(!0),Qt(),ea.current=setTimeout(()=>bn("timeout"),Fo)},[Qt,bn,vr]);n.useEffect(()=>{if(!ce)return;const t=()=>bn("event");return window.addEventListener("ndn:darts-cleared",t),()=>window.removeEventListener("ndn:darts-cleared",t)},[ce,bn]),n.useEffect(()=>{ce||bn("timeout")},[ce,bn]),n.useEffect(()=>()=>Qt(),[Qt]),n.useEffect(()=>{if(Ie===0){try{window.dispatchEvent(new CustomEvent("ndn:darts-cleared",{detail:{source:"offline-play",ts:Date.now()}}))}catch{}qs.current=0}Vi.current=Ie},[Ie]);const ks=s?.username||"Player 1",pn=Q==="None"?"Player 2":Q,Nr=Qs("X01",me,te,ne,Ne,At,Ys,Ft,cn,on,un,Ie,dn,Vr,zn,Wr,qn,J,Ae,Q),el=Qs("Cricket",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Is),tl=Qs("Shanghai",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ae,Q,void 0,Is,Vt),sl=Qs("Killer",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,M,Qe,Pe,rt),nl=Qs("Scam"),rl=Qs("Fives"),al=Qs("Sevens"),wr=n.useMemo(()=>{const t=Nr||[],a=Ie>0?Ft:on??At,c=dn>0?cn:un??Ys;return t.length===0?{name:Ae?ks:pn,isCurrentTurn:!0,legsWon:Ae?ne:Ne,score:Ae?me:te,lastScore:Ae?a:c}:t.find(h=>h.isCurrentTurn)??t[0]},[Nr,Ae,ks,pn,ne,Ne,me,te,Ie,Ft,on,At,cn,un,Ys,dn]),Va=n.useMemo(()=>{if(!wr)return[];const{matchAvg:t,allTimeAvg:a,...c}=wr;return[{...c,matchAvg:void 0,allTimeAvg:void 0}]},[wr]),il=Ae?pn:ks,ll=wr?.name??(Ae?ks:pn),ol=Ae?me:te,cl=Ae?Ie>0?Ft:on??At:dn>0?cn:un??Ys,Te=n.useCallback((t,a=1)=>{!t||a<=0||$a(c=>({...c,[t]:(c[t]||0)+a}))},[]),Oe=n.useCallback(t=>{t&&$a(a=>a[t]===void 0?a:{...a,[t]:0})},[]);Qi[p];const dl=t=>{if(!t.trim())return null;const a=Number(t);return Number.isFinite(a)?ts(Math.round(a),0,A):null},ul=t=>{if(!t.trim())return null;const a=Number(t);return Number.isFinite(a)?Math.max(0,Math.round(a)):null},Wa=n.useCallback(()=>{Cs.current&&(Cs.current=null),Qt(),Zn(!1)},[Qt]);n.useCallback(t=>{const a=ts(t,0,A);Wa(),De(a),ut.current=a;const c=a===0?A:a;cs(c),Xs.current=c,Ct(0),pt.current=0,Ze(0),mt.current=0,bt(0),ht.current=0,ds(null),Ot(0),q(0),qs.current=0,a===0?(j("player"),ie(!0)):(j(null),ie(!1))},[Wa,De,A,cs,Ct,Ze,bt,ds,Ot,q,j,ie]);const _a=t=>{const c=dl(Pa);if(c===null){Me(`Enter a number between 0 and ${A}`,{type:"error",timeout:2500});return}Ve(c),Js(0),us(0),mn(null),hn(0),mr(0),Ua(""),j(null),ie(!1)},Ka=n.useCallback((t,a)=>{t==="player"?(z(a),Jr("")):(ve(a),Qr("")),j(null),ie(!1)},[ve,Qr,Jr,j,z,ie]),yr=t=>{const c=ul(t==="player"?Oa:Fa);if(c===null){Me("Enter a non-negative whole number for legs",{type:"error",timeout:2500});return}Zr({target:t,value:c,stage:1})},ml=n.useCallback(()=>{Zr(t=>t&&(t.stage===1?{...t,stage:2}:(Ka(t.target,t.value),null)))},[Ka]),er=n.useCallback(()=>{Zr(null)},[]);n.useEffect(()=>{if(!gr)return;const t=a=>{a.key==="Escape"&&(a.preventDefault(),er())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[er,gr]);const Ds=(t=>{switch(t){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(we),gn=n.useRef(null),vn=n.useRef(null),ta=n.useRef(null),[jn,sa]=n.useState("first"),[Sr,za]=n.useState(1),hl=n.useRef(null);n.useEffect(()=>{const t=Math.max(1,Math.floor(Number(Sr)||1)),a=jn==="first"?t:Math.max(1,Math.ceil(t/2));Fe(a)},[jn,Sr]),n.useEffect(()=>{if(!Be){ns(1),Ht(!1);return}const t=()=>{const h=gn.current,b=vn.current;if(!h||!b)return;const P=ta.current?ta.current.getBoundingClientRect().height:0,B=Math.max(0,h.clientHeight-P-6),K=Math.max(0,h.clientWidth-8),I=b.getBoundingClientRect(),U=As||1,N=I.height/U,H=I.width/U,vt=B>0?B/N:1,Zt=K>0?K/H:1,Ts=Math.min(1,Math.max(.5,Math.min(vt,Zt))),kt=N*Ts,nt=B>0&&kt-B>1;Ht(nt),ns(Ts)};t();const a=window.ResizeObserver,c=a?new a(()=>t()):null;return c&&gn.current&&c.observe(gn.current),c&&vn.current&&c.observe(vn.current),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t);try{c&&gn.current&&c.unobserve(gn.current)}catch{}try{c&&vn.current&&c.unobserve(vn.current)}catch{}}},[Be,As]),n.useEffect(()=>{const t=a=>{const c=a?.detail?.mode;c&&(tt(c),Nn())};return window.addEventListener("ndn:auto-start",t),()=>window.removeEventListener("ndn:auto-start",t)},[]),n.useEffect(()=>{const t=a=>{const c=a?.detail?.formatType,h=a?.detail?.formatCount,b=a?.detail?.startScore;(c==="first"||c==="best")&&sa(c),typeof h=="number"&&isFinite(h)&&za(Math.max(1,Math.floor(h))),typeof b=="number"&&isFinite(b)&&Ke(Math.max(1,Math.floor(b)))};return window.addEventListener("ndn:offline-format",t),()=>window.removeEventListener("ndn:offline-format",t)},[]),n.useEffect(()=>{if(!D)return;const t=setTimeout(()=>Nn(),50);return()=>clearTimeout(t)},[D]),n.useEffect(()=>{if(!We||Ae||Q==="None"||Wi<=0)return;let t,a=performance.now();const c=h=>{const b=h-a;a=h,Kn(P=>{const B=P-b;if(B<=0){let K=0,I=0,U=te;for(us(0);K<3&&U>0;){const N=$o(U,Q),H=ts(N-K*20,0,Math.min(60,U)),vt=U-H;if(mr(H),$r(kt=>kt+1),Aa(kt=>kt+1),vt<0){U=te,Js(0),hn(0),I=0,mn(0),us(0);break}I+=H,Js(kt=>kt+H),Ea(kt=>kt+H);const Zt=U,Ts=vt;if(Zt>50&&Ts<=50?hn(1):Zt<=50&&hn(kt=>kt+1),U=vt,K+=1,us(K),U===0)break}if(Ve(U),U===0){I===180?zr(H=>H+1):I>=140?Gr(H=>H+1):I>=100&&qr(H=>H+1);const N=te;N<=170&&Ba(H=>Math.max(H,N)),te<=50&&(La(H=>H+(Hr>0?Hr:1)),Ma(H=>H+1)),mn(I),Js(0),hn(0),us(0),j("ai"),ie(!0)}return U>0&&K>=3&&(I===180?zr(N=>N+1):I>=140?Gr(N=>N+1):I>=100&&qr(N=>N+1),mn(I),Js(0),hn(0),us(0)),us(0),rs(!0),0}return B}),t=requestAnimationFrame(c)};return t=requestAnimationFrame(c),()=>cancelAnimationFrame(t)},[We,Ae,Q,te]),n.useEffect(()=>{de.inProgress&&(ye.current||(Z(!0),ye.current=!0))},[de.inProgress]);function Nn(){st(!0),De(A),ut.current=A,Ve(A),It(!1),Bt(!0),rs(!0),q(0),Ue(0),Ot(0),Ze(0),mt.current=0,cs(A),Ct(0),ds(null),bt(0),Kn(0),$r(0),mr(0),Js(0),us(0),mn(null),j(null),z(0),ve(0),Ye([]),an(0),ln(0),Wn(!1),xn(0),Aa(0),Jn(0),Ea(0),xr(0),fr(0),br(0),zr(0),Gr(0),qr(0),pr(0),Ba(0),Gn(0),hr(0),La(0),Ma(0),Oe("X01");const t=Math.max(1,Math.floor(Number(Sr)||1));if(Fe(jn==="first"?t:Math.max(1,Math.ceil(t/2))),y)try{C({mode:p,x01Start:A,firstTo:Xe,aiLevel:Q})}catch{}}function xl(){De(A),ut.current=A,Ve(A),It(!1),Bt(!0),rs(!0),q(0),Ue(0),Ot(0),Ze(0),mt.current=0,cs(A),Ct(0),Xs.current=A,pt.current=0,ds(null),bt(0),ht.current=0,ht.current=0,Kn(0),$r(0),mr(0),Js(0),us(0),mn(null),j(null)}function wn(t){Ze(0),mt.current=0,cs(t===0?A:t),Xs.current=t===0?A:t,bt(0),ht.current=0,Q!=="None"?(rs(!1),Kn(Se)):(Kn(0),rs(!0))}function yn(t){if(ce&&Cs.current){Zi||Zn(!0),Me("Remove your darts before starting the next throw",{type:"info",timeout:1800});return}Te("X01");const a=ut.current,c=mt.current,h=pt.current,b=Xs.current,P=ht.current,B=a-t,K=c+1;if(Ot(t),Ue(nt=>nt+1),xn(nt=>nt+1),B<0){try{const nt=a,ha=b;kn.getState().recordVisit("offline-x01",K,0,{preRemaining:nt,postRemaining:ha,bust:!0,finish:!1})}catch{}if(De(b),ut.current=b,a<=50){const nt=(P||0)+1;Gn(ha=>ha+nt)}if(m)try{Ar(s?.username||"Player",0,Math.max(b,0),l,{volume:u,checkoutOnly:f})}catch{}ds(0),q(0),Ct(0),pt.current=0,bt(0),ht.current=0,wn(b);return}De(B),ut.current=B,Ze(K),mt.current=K;const I=h+t;Ct(I),pt.current=I,Jn(nt=>nt+t),q(0);const U=a,N=B,H=U>50&&N<=50,vt=U<=50;H?(bt(1),ht.current=1):vt&&(bt(nt=>nt+1),ht.current=(P||0)+1);const Zt=ht.current||0,Ts=U<=50,kt=Ts?Math.max(Zt,Math.min(K,3)):0;if(B===0){const nt={visitTotal:I,darts:K,preRemaining:a,remaining:0,doubleAttempts:kt,finished:!0,doubleWindow:Ts,highestCheckout:b<=170?b:null};ce?Ha(nt):jr(nt,"immediate");return}if(K>=3){const nt={visitTotal:I,darts:K,preRemaining:a,remaining:B,doubleAttempts:kt,finished:!1,doubleWindow:Ts,highestCheckout:null};ce?Ha(nt):jr(nt,"immediate");return}}function Cr(){const t=ts(Math.round(Number(re)||0),0,60);yn(t)}function gt(t){if(!Number.isFinite(t))return!1;const a=Xs.current,c=ut.current,h=mt.current,b=pt.current,P=h>0||b>0;P&&(De(a),ut.current=a,Ze(0),mt.current=0,Ct(0),pt.current=0,bt(0),ht.current=0,Ot(0),q(0),Ue(N=>Math.max(0,N-h)),xn(N=>Math.max(0,N-h)),Jn(N=>Math.max(0,N-b)),qs.current=0);const B=P?a:c,K=B<=170?170:180,I=ts(Math.round(t),0,K);Te("X01",3),Ue(N=>N+3),xn(N=>N+3),Ze(3),mt.current=3,Ct(I),pt.current=I,ds(I),I===180?xr(N=>N+1):I>=140?fr(N=>N+1):I>=100&&br(N=>N+1);const U=B-I;if(U<0){if(m)try{Ar(ks,0,Math.max(a,0),l,{volume:u,checkoutOnly:f})}catch{}try{kn.getState().recordVisit("offline-x01",3,0,{preRemaining:B,postRemaining:a,bust:!0,finish:!1})}catch{}return De(a),ut.current=a,ds(0),Ct(0),pt.current=0,Ze(0),mt.current=0,bt(0),ht.current=0,wn(a),!0}if(De(U),ut.current=U,Jn(N=>N+I),m)try{Ar(ks,I,Math.max(U,0),l,{volume:u,checkoutOnly:f})}catch{}if(B<=50&&(Gn(N=>N+3),U===0&&hr(N=>N+1)),U===0){B<=170&&pr(N=>Math.max(N,B));try{kn.getState().recordVisit("offline-x01",3,I,{preRemaining:B,postRemaining:0,finish:!0,bust:!1})}catch{}return j("player"),ie(!0),Ze(0),mt.current=0,Ct(0),pt.current=0,bt(0),ht.current=0,!0}try{kn.getState().recordVisit("offline-x01",3,I,{preRemaining:B,postRemaining:U,finish:!1,bust:!1})}catch{}return wn(U),Ct(0),pt.current=0,Ze(0),mt.current=0,bt(0),ht.current=0,!0}const Et=Uo({match:de,commitManualVisitTotal:gt,endTurn:wn}),[kr,Dr]=n.useState(""),Ga=t=>{if(!t){Dr("");return}const a=t.replace(/[^0-9]/g,"");if(!a){Dr("");return}const c=Number(a);if(!Number.isFinite(c))return;const h=ut.current<=170?170:180,b=ts(Math.round(c),0,h);Dr(String(b))};function Tr(){if(!kr){alert("Enter a number 0â€“180 for visit total");return}const t=Number(kr);if(!Number.isFinite(t)){alert("Enter a number 0â€“180 for visit total");return}const a=ut.current<=170?170:180,c=ts(Math.round(t),0,a);t>a&&Me(`Visit totals cannot exceed ${a}.`,{type:"info",timeout:2200}),gt(c)&&Dr("")}const na=n.useCallback(()=>{Cs.current&&(Cs.current=null,Qt(),Zn(!1));const t=mt.current,a=pt.current,c=Xs.current;t===0&&a===0||(De(c),ut.current=c,Ze(0),mt.current=0,Ct(0),pt.current=0,bt(0),ht.current=0,Ot(0),q(0),Ue(h=>Math.max(0,h-t)),xn(h=>Math.max(0,h-t)),Jn(h=>Math.max(0,h-a)),qs.current=0)},[Qt]);n.useEffect(()=>{const t=a=>{const c=a?.detail;!c||c?.source==="offline-play"||na()};return window.addEventListener("ndn:clear-visit-request",t),()=>window.removeEventListener("ndn:clear-visit-request",t)},[na]);function qa(t){Te("Double Practice");const a=ts(Math.round(t||0),0,60);if(Ot(a),Ue(c=>c+1),xn(c=>c+1),Di(a,Es)){const c=en+1;Pt(c),xs(h=>Math.min(20,h+1)),c>=21&&(j("player"),ie(!0))}q(0)}function Xa(){qa(Number(re))}function Ya(){const t=Sn(xt);if(t==null){alert("Enter like D16, 50, 25, T20");return}qa(t),lt("")}function Ja(t,a,c){if(ar)return;Te("Bob's 27");const h=Ln,b=a==="DOUBLE"&&c===h||!a&&t===h*2;b&&bs(P=>P+1),En(P=>{const B=P+1;if(B>=3){const K=Rn+(b?1:0);K>0?An(U=>U+K*h*2):An(U=>U-h*2);const I=h+1;return Mn(I),bs(0),I>20&&Bs(!0),0}return B})}function Qa(){Ja(Math.max(0,re|0)),q(0)}function Za(){Mn(1),An(27),En(0),bs(0),Bs(!1),Oe("Bob's 27")}function ra(t){Te("Count-Up"),lr(a=>a+Math.max(0,t|0)),Nt(a=>{const c=a+1;return c>=3?(Dt(h=>h+1),0):c})}function aa(t){Te("High Score"),Bn(a=>a+Math.max(0,t|0)),sn(a=>{const c=a+1;return c>=3?(Ps(h=>h+1),0):c})}function ia(t){Te("Low Score"),Pn(a=>a+Math.max(0,t|0)),ps(a=>{const c=a+1;return c>=3?(Us(h=>h+1),0):c})}function ei(t,a,c,h,b,P,B,K){const I=t-B;if(!(I<0))if(I===0){if(K==="DOUBLE"||K==="INNER_BULL"){P(U=>U+1),b(U=>U+1),h(()=>0),a(t);return}a(I)}else a(I);h(U=>{const N=U+1;return N>=3?(b(H=>H+1),0):N})}function ti(t,a){Te("Checkout 170"),ei(qt,Os,Lt,Fs,Xt,Fn,t,a),Lt+1>=3&&Os(170)}function si(t,a){Te("Checkout 121"),ei(vs,nn,js,$s,Hn,Vn,t,a),js+1>=3&&nn(121)}function Lr(t){const a=Sn(xt);if(a==null){alert("Enter like T20, D16, 25, 50");return}const c=xt.trim().toUpperCase(),h=c.startsWith("D")||c==="50"||c==="BULL"||c==="DBULL"||c==="IBULL"||c.includes("INNER");t?ti(a,h?"DOUBLE":void 0):si(a,h?"DOUBLE":void 0),lt("")}function fl(){Os(170),Fs(0),Xt(0),Fn(0),Oe("Checkout 170")}function bl(){nn(121),$s(0),Hn(0),Vn(0),Oe("Checkout 121")}function la(t,a,c){if(_s)return;Te("Treble Practice"),(a==="TRIPLE"&&c===Yt||!a&&t===Yt*3)&&an(b=>b+1),ln(b=>{const P=b+1;if(P%3===0&&[20,19,18].includes(Yt)){const B=[20,19,18],K=B.indexOf(Yt),I=B[(K+1)%B.length];rn(I)}return Ws>0&&P>=Ws&&Wn(!0),P})}function ni(){an(0),ln(0),Wn(!1),Oe("Treble Practice")}function pl(t,a,c){Te("Baseball"),i(h=>{const b={...h};return go(b,t,a,c),b})}function gl(){i(Mi()),Oe("Baseball")}function vl(t,a,c){Te("Golf"),g(h=>{const b={...h};return jo(b,t,a,c),b})}function jl(){g(Ai()),Oe("Golf")}function Nl(t,a,c,h){Te("Tic Tac Toe"),G(b=>{const P={...b,board:[...b.board]};return wo(P,t,a,c,h),P})}function wl(){G(Ei()),Oe("Tic Tac Toe")}function yl(t,a,c){Te("American Cricket"),W(h=>{const b={...h,marks:{...h.marks}};return Ao(b,t,a,c,()=>!1),b})}function ri(){W(Pi()),Oe("American Cricket")}function oa(t,a,c){Te("Around the Clock");const h=Ls[ot];let b=!1;if(typeof c=="number"&&c===h&&(a==="SINGLE"||a==="DOUBLE"||a==="TRIPLE")&&(b=!0),h===25&&(a==="BULL"||t===25)&&(b=!0),h===50&&(a==="INNER_BULL"||t===50)&&(b=!0),b||(t===h||t===h*2||t===h*3)&&(b=!0),b){const P=nr+1;rr(P),Rs(B=>B+1)}}function ai(){oa(Math.max(0,re|0)),q(0)}function ii(){const t=Sn(xt);if(t==null){alert("Enter like T20, D5, 25, 50");return}oa(t),lt("")}function ca(t,a,c){Te("Cricket"),Tn(h=>{const b={...h,marks:{...h.marks}};return io(b,t,a,c,()=>!1),b}),ct(h=>{const b=h+1;return b>=3?0:b})}function li(){ca(Math.max(0,re|0)),q(0)}function da(t,a,c){Te("Shanghai"),tn(h=>{const b={...h,turnHits:{...h.turnHits}};return co(b,t,a,c),b}),ct(h=>{const b=h+1;return b>=3?(tn(P=>{const B={...P,turnHits:{...P.turnHits}};return uo(B),B}),0):b})}function oi(){da(Math.max(0,re|0)),q(0)}function ci(t,a,c){Te("Halve It"),ge(h=>{const b={...h,targets:[...h.targets]};return mo(b,t,a,c),b}),ct(h=>{const b=h+1;return b>=3?(ge(P=>{const B={...P,targets:[...P.targets]};return ho(B),B}),0):b})}function di(){ci(Math.max(0,re|0)),q(0)}function ui(t,a,c){Te("High-Low"),Wt(h=>{const b={...h};return xo(b,t,a,c),b}),ct(h=>{const b=h+1;return b>=3?(Wt(P=>{const B={...P};return fo(B),B}),0):b})}function mi(){ui(Math.max(0,re|0)),q(0)}function hi(){const t=xt.trim().toUpperCase();if(!t)return null;if(t==="50"||t==="BULL"||t==="DBULL"||t==="IBULL")return 50;if(t==="25"||t==="OBULL")return 25;const a=t.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!a)return null;const c=a[1]||"S",h=parseInt(a[2],10);return h<1||h>20?null:h*(c==="S"?1:c==="D"?2:3)}function tr(){const t=hi();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}yn(t),lt("")}function xi(){const t=Yr.trim().split(`
`).map(a=>a.trim()).filter(a=>a);if(t.length!==0){for(const a of t){const c=Sn(a);if(c==null){alert(`Invalid score: ${a}`);return}yn(c)}Qn("")}}function ua(){Ie!==0&&(De(t=>t+At),Ze(t=>Math.max(0,t-1)))}function Mr(){const t=hi();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}if(Ie===0){tr();return}const a=At;De(c=>c+a),Ze(c=>Math.max(0,c-1)),setTimeout(()=>yn(t),0),lt("")}function Sl(){const t=x??"player",a=t==="player"?dr||void 0:Hr||void 0,c=1,h=t==="player"?qe:ur;Ye([...J,{winner:t,doubleDarts:F,checkoutDarts:V,winnerDarts:h,doublesAtt:a,doublesHit:c}]),ie(!1);let b=ne,P=Ne;if(x==="player"?b+=1:x==="ai"&&(P+=1),z(b),ve(P),j(null),b>=Xe||P>=Xe){try{Fl(p,t==="player")}catch{}Bt(!1),st(!1),De(A),Ve(A),Xr(!0);return}xl()}const ma=!vi.includes(p)&&!(s?.fullAccess||s?.admin);return e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[ze&&e.jsx(Vl,{players:de.players||[],onDone:()=>Z(!1)}),e.jsxs("h2",{className:"text-3xl font-bold text-brand-700 mb-4",children:["Offline Mode"," ",r==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"ndn-shell-body",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsxs("select",{className:"input w-full",value:p,onChange:t=>tt(t.target.value),children:[vi.map(t=>e.jsx("option",{value:t,children:t},t)),Pl.map(t=>e.jsxs("option",{value:t,disabled:!(s?.fullAccess||s?.admin),children:[t," ",s?.fullAccess||s?.admin?"":"(Premium)"]},t))]}),e.jsx($l,{gameMode:p,compact:!0}),p==="Treble Practice"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"font-semibold",children:"Throws per game"}),e.jsx("input",{className:"input w-full",type:"number",min:3,step:3,value:Ws,onChange:t=>Fr(Math.max(3,Math.floor(Number(t.target.value)||30)))})]}),e.jsx("div",{className:"sm:col-span-2 text-xs text-slate-300",children:"Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws."})]}),!s?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),p==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:A,onChange:t=>Ke(Number(t.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{className:"input w-full",value:Q,onChange:t=>Ee(t.target.value),children:[e.jsx("option",{value:"None",children:"None"}),Oo.map(t=>e.jsx("option",{value:t,children:t},t))]}),Q!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:Se/1e3,onChange:t=>jt(Math.round(Number(t.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>ke(!0),children:"X01 Rules & Regulations!"})]}),p==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply."})]}),!He&&e.jsx("button",{className:"btn",disabled:ma,title:ma?"PREMIUM required for this mode":"",onClick:Nn,children:"Start Match"}),We&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${ss?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(Cn,{storageKey:"ndn:modal:offline-match",className:`${ss?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:ss,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:"scroll"},ref:t=>{gn.current=t},children:[e.jsx("div",{ref:t=>{ta.current=t},children:e.jsx(Ro,{left:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[p,p==="X01"?` / ${A}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",Xe," Â· Legs ",ne,"-",Ne]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${r==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:r==="modern"?"Modern layout":"Classic layout"})]}),right:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>S(Math.max(.5,Math.round((R-.05)*100)/100)),title:"Decrease camera size",children:"âˆ’"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(R*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>S(Math.min(1.25,Math.round((R+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:Be?"Actual Size":"Fit All",onClick:()=>Dn(t=>!t),children:Be?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:ss?"Restore":"Maximize",onClick:()=>Zs(t=>!t),children:ss?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Nn()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{Bt(!1),st(!1)},children:"Quit"})]})})}),e.jsxs("div",{ref:t=>{vn.current=t},className:"will-change-transform",style:Be?{transform:`scale(${As})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,As))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:p==="X01"?"X01 Match":p}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",p]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",A]}),e.jsxs("div",{ref:hl,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const t=me!==A||te!==A||Ie>0,a=`px-2 py-0.5 rounded border text-xs ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${a} ${jn==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||sa("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${a} ${jn==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||sa("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${t?"opacity-50":""}`,type:"number",min:1,step:1,value:Sr,onChange:c=>za(Math.max(1,Math.floor(Number(c.target.value)||1))),disabled:t,title:jn==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",ne,"â€“",Ne]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Match"}),e.jsxs("select",{className:`btn ${Ds}`,value:Y,onChange:t=>pe(t.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${Ds} w-[7.5rem]`,value:oe,onChange:t=>Ce(t.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${Ds} w-[7.5rem]`,value:se,onChange:t=>ue(t.target.value),placeholder:"Team B"})]})]}),p!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[p==="Double Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Rr[Es]?.label||"â€”"})]})}),p==="Around the Clock"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Ls[ot]===25?"25 (Outer Bull)":Ls[ot]===50?"50 (Inner Bull)":Ls[ot]||"â€”"})]})}),p==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket â€” Close 20â€“15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:ka.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,Is.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points:"," ",e.jsx("span",{className:"font-semibold",children:Is.points})]}),lo(Is)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Tn(xa()),ct(0),Oe("Cricket")},children:"Reset"})]})]}),p==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Vt.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Vt.score]}),Vt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{tn(fa()),ct(0),Oe("Shanghai")},children:"Reset"})]})]}),p==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[fs.stage+1,"/",fs.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target:"," ",e.jsx("span",{className:"font-semibold",children:(()=>{const t=Fi(fs);return t?t.kind==="ANY_NUMBER"?"Any":t.kind==="BULL"?"Bull":t.kind==="DOUBLE"||t.kind==="TRIPLE"||t.kind==="NUMBER"?`${t.kind} ${t.num}`:"â€”":"â€”"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",fs.score]}),fs.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ge(ba()),ct(0),Oe("Halve It")},children:"Reset"})]})]}),p==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",as.round," Â· Target ",as.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",as.score]}),as.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Wt(pa()),ct(0),Oe("High-Low")},children:"Reset"})]})]}),p==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",Ln]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Pr]}),ar&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:Za,children:"Reset"})]})]}),p==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",ir,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",$e]})]}),p==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",In,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ut]})]}),p==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",or,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ur]})]}),p==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:qt}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",gs," Â· Successes:"," ",On]})]}),p==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:vs}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",$n," Â· Successes:"," ",Hs]})]}),p==="Treble Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",Yt]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",wt]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("div",{className:"inline-flex items-center gap-1",children:[20,19,18].map(t=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${Yt===t?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>rn(t),children:["T",t]},`tpick-header-${t}`))}),e.jsx("span",{className:"opacity-60 text-xs",children:"or"}),e.jsx("select",{className:"input w-24",value:Yt,onChange:t=>rn(parseInt(t.target.value,10)),children:Array.from({length:20},(t,a)=>a+1).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ni,children:"Reset"})]})]})}),p==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:cr.inning}),e.jsxs("div",{className:"text-sm",children:["Score:"," ",e.jsx("span",{className:"font-semibold",children:cr.score})]})]}),p==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:d.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes:"," ",e.jsx("span",{className:"font-semibold",children:d.strokes})]})]}),p==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:L.turn}),L.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",L.winner||"â€”"]})]}),p==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Target"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ga[Ks.targetIndex]}),e.jsxs("div",{className:"text-sm",children:["Progress:"," ",e.jsxs("span",{className:"font-semibold",children:[Ks.targetIndex+1,"/",ga.length]})]}),Ks.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["ðŸŽ‰ Finished in ",Ks.darts," darts!"]})]}),p==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[ft.score,"/",ft.target]}),e.jsxs("div",{className:"text-sm",children:["Darts:"," ",e.jsx("span",{className:"font-semibold",children:ft.darts})]}),ft.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",ft.target,"!"]})]}),p==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Ss.score,"/",Ss.target]}),e.jsxs("div",{className:"text-sm",children:["Darts:"," ",e.jsx("span",{className:"font-semibold",children:Ss.darts})]}),Ss.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",Ss.target,"!"]})]}),p==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20â€“12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:Da.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,_.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points:"," ",e.jsx("span",{className:"font-semibold",children:_.points})]}),Eo(_)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:ri,children:"Reset"})]})]}),p==="Killer"&&e.jsx(e.Fragment,{children:yt?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:M[rt]?.name||"â€”"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ws?`${M.find(t=>t.id===ws)?.name||"Winner"} Wins`:St||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):r==="modern"?e.jsx("div",{className:"space-y-3 mb-2",children:xe?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${Ds}`,onClick:()=>S(Math.max(.5,Math.round((R-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${Ds} min-w-[2.5rem] text-center`,children:[Math.round(R*100),"%"]}),e.jsx("button",{className:`btn ${Ds}`,onClick:()=>S(Math.min(1.25,Math.round((R+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Ds}`,title:"Toggle fit/fill",onClick:()=>X(E==="fill"?"fit":"fill"),children:E==="fill"?"Fill":"Fit"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Ds}`,title:"Toggle camera aspect",onClick:()=>w(O==="square"?"wide":"square"),children:O==="square"?"Square":"Wide"})]})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6",children:[e.jsx("div",{className:"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]",children:e.jsx(Le,{scoringMode:"x01",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{yn(t)}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Current Shooter"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-white",children:ll}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Remaining"}),e.jsx("div",{className:"font-mono text-lg text-white",children:ol})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Last Dart"}),e.jsx("div",{className:"font-mono text-lg text-white",children:cl||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Match Legs"}),e.jsxs("div",{className:"font-semibold text-white",children:[ne,"-",Ne]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Next Up"}),e.jsx("div",{className:"font-medium text-white",children:il})]})]})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(es,{gameMode:p,players:Va,matchScore:`${ne}-${Ne}`})})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(es,{gameMode:p,players:Va,matchScore:`${ne}-${Ne}`})}),p==="X01"&&e.jsxs("div",{className:"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Manual Scoreboard Override"}),e.jsxs("p",{className:"mt-1 text-xs text-white/40",children:["Adjust the live totals if a dart was misread. Values are clamped between 0 and"," ",A,"."]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:ks}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Commit Visit"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx(Hl,{inProgress:!0,startingScore:A,onAddVisit:Rt(gt),quickButtons:[180,140,100,60],onNextPlayer:()=>Et?.nextPlayer(),onEndLeg:()=>{},onUndo:()=>{},showDartsSelect:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:Oa,onChange:t=>Jr(t.target.value),onKeyDown:t=>{t.key==="Enter"&&yr("player")},placeholder:`${ne}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>yr("player"),children:"Set"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:pn}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Three Dart Edit"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:A,value:Pa,onChange:t=>Ua(t.target.value),onKeyDown:t=>{t.key==="Enter"&&_a()},placeholder:`${te}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>_a(),children:"Set"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:Fa,onChange:t=>Qr(t.target.value),onKeyDown:t=>{t.key==="Enter"&&yr("ai")},placeholder:`${Ne}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>yr("ai"),children:"Set"})]})]})]})]})]})]})]})})]})}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),Ae?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:me}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-me/A)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart:"," ",e.jsx("span",{className:"font-semibold",children:At})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score:"," ",e.jsx("span",{className:"font-semibold",children:Ie>0?Ft:on??At})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg:"," ",e.jsx("span",{className:"font-semibold",children:Xn>0?(_r/Xn*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",qe]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(t=>e.jsx("span",{className:`w-2 h-2 rounded-full ${t<Ie?"bg-emerald-400":"bg-white/20"}`},t))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles:"," ",e.jsxs("span",{className:"font-semibold",children:["Att ",zn," Â· Hit ",Vr]})]}),me<=170&&me>0&&(()=>{const a=zl(me,o)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:a})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall",children:e.jsx(va,{storageKey:"ndn:camera:tile:offline:center:v4",className:"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card",defaultWidth:0,defaultHeight:0,minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:1200,autoFill:!0,children:e.jsx(Ni,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic",fill:!0})})}),e.jsxs("div",{className:`mt-2 ${je==="small"?"p-2":je==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${we==="small"?"text-xs":we==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const t=Ae?s?.username||"You":Q==="None"?"â€”":`${Q} AI`,a=Ae?me:Q==="None"?0:te,c=Ae?Ie>0?Ft:on??At:dn>0?cn:un??Ys,h=Ae?qe:ur,b=A-(Ae?me:Q==="None"?A:te),P=h>0?b/h*3:0,B=`${ne}-${Ne}`,K=J.length>0?`${Math.min(...J.map(I=>I.doubleDarts+(I.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:B}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:t}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:a}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:P.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:c}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:K})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[Q==="None"?"Opponent":`${Q} AI`," Remain"]}),Ae?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Q!=="None"?te:"N/A"}),Q!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-te/A)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart:"," ",e.jsx("span",{className:"font-semibold",children:Q==="None"?0:Ys})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score:"," ",e.jsx("span",{className:"font-semibold",children:Q==="None"?"â€”":dn>0?cn:un??Ys})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg:"," ",e.jsx("span",{className:"font-semibold",children:Q!=="None"?Yn>0?(Kr/Yn*3).toFixed(1):"0.0":"â€”"})]}),Q!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",ur]}),Q!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles:"," ",e.jsxs("span",{className:"font-semibold",children:["Att ",qn," Â· Hit ",Wr]})]})]})]})}),p!=="X01"?e.jsxs("div",{className:"space-y-2",children:[p==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Rr[Es]?.label||"â€”"})]}),k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,onAutoDart:(t,a)=>{if((a==="DOUBLE"||a==="INNER_BULL")&&Di(t,Es)){const h=en+1,b=Es+1;Pt(h),xs(b),h>=Rr.length&&setTimeout(()=>{Pt(0),xs(0)},250)}},immediateAutoCommit:!0,onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Xa()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Xa,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Ya()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ya,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",en," of 21"]})]}),p==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Ls[ot]===25?"25 (Outer Bull)":Ls[ot]===50?"50 (Inner Bull)":Ls[ot]||"â€”"})]}),k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{oa(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&ai()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ai,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ii()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ii,children:"Add"})]}),nr>=Ls.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{rr(0),Rs(0),Oe("Around the Clock")},children:"Reset"})]})]}),p==="Cricket"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{ca(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&li()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:li,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Tn(xa()),ct(0),Oe("Cricket")},children:"Reset"})]})]}),p==="Shanghai"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{da(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&oi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:oi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{tn(fa()),ct(0),Oe("Shanghai")},children:"Reset"})]})]}),p==="Halve It"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{ci(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&di()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:di,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ge(ba()),ct(0),Oe("Halve It")},children:"Reset"})]})]}),p==="High-Low"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{ui(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&mi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:mi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Wt(pa()),ct(0),Oe("High-Low")},children:"Reset"})]})]}),p==="Bob's 27"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{Ja(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Qa()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Qa,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Za,children:"Reset"})]})]}),p==="Count-Up"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:t=>ra(t),onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ra(re),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ra(re),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Dt(1),lr(0),Nt(0),Oe("Count-Up")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",ir,"/",Je]})]}),p==="High Score"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:t=>aa(t),onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(aa(re),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{aa(re),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ps(1),Bn(0),sn(0),Oe("High Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",In,"/",_t]})]}),p==="Low Score"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:t=>ia(t),onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ia(re),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ia(re),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Us(1),Pn(0),ps(0),Oe("Low Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",or,"/",Un]})]}),p==="Checkout 170"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a)=>ti(t,a==="MISS"?void 0:a),onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Lr(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Lr(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:fl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",qt," Â· Attempts: ",gs," Â· Successes: ",On]})]}),p==="Checkout 121"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a)=>si(t,a==="MISS"?void 0:a),onAddVisit:Rt(gt),onEndLeg:t=>Et.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Lr(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Lr(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:bl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",vs," Â· Attempts: ",$n," Â· Successes: ",Hs]})]}),p==="Treble Practice"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{la(t,a==="MISS"?void 0:a,c?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const a=Sn(xt);a!=null&&la(a,void 0,void 0),lt("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const t=Sn(xt);t!=null&&la(t,void 0,void 0),lt("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",wt," Â· Misses:"," ",Math.max(0,Vs-wt)," Â· Darts:"," ",Vs,Ws>0?`/${Ws}`:""]}),_s&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:ni,children:"Reset"})]})]}),p==="Baseball"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{pl(t,a==="MISS"?void 0:a,c?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:gl,children:"Reset"})})]}),p==="Golf"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{vl(t,a==="MISS"?void 0:a,c?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:jl,children:"Reset"})})]}),p==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(t,a)=>a).map(t=>e.jsx("button",{className:`h-16 rounded-xl border ${L.board[t]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(L.finished||L.board[t])return;const a=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),c=a%3===0?"TRIPLE":a%2===0?"DOUBLE":"SINGLE",h=t,b=$i[h],P=b.type==="BULL"?null:b.num||null;Nl(h,a,c,P)},children:L.board[t]||""},t))}),k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:wl,children:"Reset"})})]}),p==="American Cricket"&&e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{yl(t,a==="MISS"?void 0:a,c?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:ri,children:"Reset"})})]}),p==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:ga[os.targetIndex]})]}),k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{const h=a==="MISS"?void 0:a;Te("Scam"),Jt(Na(os,t,h))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:1,max:25,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(Te("Scam"),Jt(Ri(os,re)),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Te("Scam"),Jt(Ri(os,re)),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Jt(So()),Oe("Scam")},children:"Reset"})]}),os.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["ðŸŽ‰ Finished in ",os.darts," darts!"]})]}),p==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[dt.score,"/",dt.target]})]}),k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{Te("Fives"),ys(ya(dt,t))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:5,max:50,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(Te("Fives"),ys(Ii(dt,re)),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Te("Fives"),ys(Ii(dt,re)),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ys(Do(dt.target)),Oe("Fives")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:"," ",dt.darts]}),dt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",dt.target," in"," ",dt.darts," darts!"]})]}),p==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[Mt.score,"/",Mt.target]})]}),k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{Te("Sevens"),Ge(Ca(Mt,t))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:7,max:21,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(Te("Sevens"),Ge(Bi(Mt,re)),q(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Te("Sevens"),Ge(Bi(Mt,re)),q(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ge(Mo(Mt.target)),Oe("Sevens")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 7, 14, 21 Â· Darts:"," ",Mt.darts]}),Mt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",Mt.target," in"," ",Mt.darts," darts!"]})]}),p==="Killer"&&e.jsx(e.Fragment,{children:yt?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:M.map(t=>{const a=Qe[t.id],c=Pe[t.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${a?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${a?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:a?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number:"," ",e.jsx("span",{className:"font-semibold",children:c})]}),e.jsxs("div",{className:"text-sm",children:["Lives:"," ",e.jsx("span",{className:"font-semibold",children:a?.lives??0})]})]},t.id)})}),k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{if(ws)return;const h=a==="MISS"?void 0:a,b=c?.sector??null,P=M[rt];P&&(be(B=>{const K={};Object.keys(B).forEach(N=>K[N]={...B[N]});const I=Ti(P.id,K,h,b);if(I.becameKiller)at(`${P.name} became a Killer`);else if(I.victimId){const N=M.find(H=>H.id===I.victimId);at(`${P.name} hit ${N?.name}'s ${Pe[I.victimId]} (${I.livesRemoved} life${(I.livesRemoved||0)>1?"s":""})`)}else at("No effect");const U=Li(K);return U&&ls(U),K}),Ns(B=>{const K=B+1;if(K>=3){let I=rt;for(let U=1;U<=M.length;U++){const N=(rt+U)%M.length,H=M[N].id,vt=Qe[H];if(vt&&!vt.eliminated&&vt.lives>0){I=N;break}}return Kt(I),0}return K}))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){if(ws)return;const c=xt.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!c){lt("");return}const h=c[1]||"S",b=parseInt(c[2],10),P=h==="D"?"DOUBLE":h==="T"?"TRIPLE":"SINGLE",B=M[rt];be(K=>{const I={};Object.keys(K).forEach(H=>I[H]={...K[H]});const U=Ti(B.id,I,P,b);if(U.becameKiller)at(`${B.name} became a Killer`);else if(U.victimId){const H=M.find(vt=>vt.id===U.victimId);at(`${B.name} hit ${H?.name}'s ${Pe[U.victimId]} (${U.livesRemoved} life${(U.livesRemoved||0)>1?"s":""})`)}else at("No effect");const N=Li(I);return N&&ls(N),I}),lt(""),Ns(K=>{const I=K+1;if(I>=3){let U=rt;for(let N=1;N<=M.length;N++){const H=(rt+N)%M.length,vt=M[H].id,Zt=Qe[vt];if(Zt&&!Zt.eliminated&&Zt.lives>0){U=H;break}}return Kt(U),0}return I})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let t=rt;for(let a=1;a<=M.length;a++){const c=(rt+a)%M.length,h=M[c].id,b=Qe[h];if(b&&!b.eliminated&&b.lives>0){t=c;break}}Kt(t),Ns(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{be({}),_e({}),it(!1),Kt(0),Ns(0),ls(null),at("")},children:"Reset"})]}),ws&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner:"," ",M.find(t=>t.id===ws)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{be({}),_e({}),it(!1),Kt(0),Ns(0),ls(null),at("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:M.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:t.name,onChange:c=>{const h=c.target.value;ae(b=>b.map((P,B)=>B===a?{...P,name:h}:P))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>ae(c=>c.filter((h,b)=>b!==a)),disabled:M.length<=2,children:"Remove"})]},t.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>ae(t=>{const a=`p${t.length+1}`;return[...t,{id:a,name:`Player ${t.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(M.length<2){alert("Need at least 2 players");return}const t=M.map(h=>h.id),a=po(t),c={};t.forEach(h=>{c[h]=bo(a[h])}),_e(a),be(c),Kt(0),Ns(0),ls(null),at("Assigned numbers"),it(!0)},children:"Assign Numbers & Start"})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-3 min-h-0 flex-1 text-[14px]",children:[e.jsxs("div",{className:"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm",children:[e.jsx("div",{className:"text-sm font-semibold opacity-80",children:"Scoreboard"}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(es,{gameMode:p,players:Nr,matchScore:`${ne}-${Ne}`})}),Ae&&e.jsxs("div",{className:"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h4",{className:"text-sm font-semibold tracking-wide uppercase text-indigo-200",children:"Manual Scoring"}),e.jsx("span",{className:"text-xs text-white/60",children:"Override a visit or enter dart-by-dart scores."})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Single Dart"}),e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:60,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?ua():Cr())},placeholder:"60"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Cr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Three Dart Edit"}),e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:me<=170?170:180,value:kr,onChange:t=>Ga(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Tr()},placeholder:"100"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Tr,children:"Commit Visit"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:ua,children:"Undo Visit"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Manual"}),e.jsx("input",{className:"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Mr():tr())},placeholder:"T20"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:tr,children:"Apply"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Mr,disabled:Ie===0,children:"Replace Last"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Multi-entry (one per line)"}),e.jsx("textarea",{className:"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30",rows:3,value:Yr,onChange:t=>Qn(t.target.value),placeholder:`T20
D16
25`}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:xi,children:"Apply All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Qn(""),children:"Clear"})]})]}),e.jsx("div",{className:"pt-2 border-t border-white/10 mt-3",children:e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:na,disabled:Ie===0&&Ft===0,children:"Clear Current Visit"})})]})]})]}),k&&e.jsx("div",{className:"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a)=>{const c=a??"MISS",h=Number.isFinite(t)?Math.max(0,t):0,b=Date.now();if(h<=0){if(c!=="MISS"||b-(qs.current||0)<1200)return;qs.current=b}else qs.current=0;yn(h)}})})]}),p==="X01"&&!k&&e.jsx(e.Fragment,{children:e.jsx(es,{gameMode:p,players:Nr,matchScore:`${ne}-${Ne}`})}),p==="Cricket"&&e.jsx(e.Fragment,{children:e.jsx(es,{gameMode:"Cricket",players:el})}),p==="Cricket"&&k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&ca(t,a==="MISS"?void 0:a,c?.sector??null)}})}),p==="Shanghai"&&e.jsx(e.Fragment,{children:e.jsx(es,{gameMode:"Shanghai",players:tl})}),p==="Shanghai"&&k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&da(t,a==="MISS"?void 0:a,c?.sector??null)}})}),p==="Killer"&&e.jsx(e.Fragment,{children:e.jsx(es,{gameMode:"Killer",players:sl})}),p==="Scam"&&e.jsx(e.Fragment,{children:e.jsx(es,{gameMode:"Scam",players:nl})}),p==="Scam"&&k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&Jt(Na(os,t,a))}})}),p==="Fives"&&e.jsx(e.Fragment,{children:e.jsx(es,{gameMode:"Fives",players:rl})}),p==="Fives"&&k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&ys(ya(dt,t))}})}),p==="Sevens"&&e.jsx(e.Fragment,{children:e.jsx(es,{gameMode:"Sevens",players:al})}),p==="Sevens"&&k&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&Ge(Ca(Mt,t))}})}),e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:re,onChange:t=>q(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?ua():Cr())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Cr,title:"Add a single dart (0â€“60)",children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,max:me<=170?170:180,placeholder:"Visit total (0â€“180)",value:kr,onChange:t=>Ga(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Tr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Tr,title:"Commit a full 3-dart total like 93",children:"Commit Visit"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Mr():tr())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Mr,disabled:Ie===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:tr,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:Yr,onChange:t=>Qn(t.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:xi,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Qn(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add Â· Shift+Enter to Replace Last"})]}),e.jsx("div",{className:"h-1"})]})]})})}),fe&&e.jsx(Ho,{onClose:()=>ke(!1)}),ma&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const a=await(await fetch(`${Vo}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s?.email})})).json();a.ok&&a.url?(window.location.href=a.url,a.development&&Me("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):a.error==="STRIPE_NOT_CONFIGURED"?Me("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):Me("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{Me("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â·"," ",Ul(Ol(),5)]})]})]}),Ji&&typeof document<"u"?gi.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4",onClick:()=>fn(!1),children:e.jsx(Cn,{storageKey:"ndn:modal:offline-camera-manager",className:"relative",defaultWidth:640,defaultHeight:520,minWidth:480,minHeight:420,maxWidth:1200,maxHeight:900,initialFitHeight:!0,onClose:()=>fn(!1),children:e.jsxs("div",{className:"space-y-3",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Camera Devices"}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Manage Offline Camera Feeds"})]}),e.jsx("button",{className:"btn bg-slate-800 hover:bg-slate-700 text-white",onClick:()=>fn(!1),children:"Close"})]}),e.jsx(Ni,{fill:!0,user:s,playerScore:me,aiScore:te,x01Score:A,inMatch:He,showWinPopup:Re,pendingLegWinner:x,playerDartsThrown:qe,aiDartsThrown:ur,totalPlayerDarts:Xn,totalAiDarts:Yn,totalPlayerPoints:_r,totalAiPoints:Kr,player180s:Ra,player140s:_i,player100s:Ki,ai180s:Ia,ai140s:zi,ai100s:Gi,playerHighestCheckout:qi,aiHighestCheckout:Xi,onClose:()=>fn(!1),onOpen:()=>fn(!0),layout:r})]})})}),document.body):null,gr&&typeof document<"u"?gi.createPortal((()=>{const{target:t,value:a,stage:c}=gr,h=t==="player"?ks:pn,b=t==="player"?ne:Ne;return e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4",onClick:er,children:e.jsx(Cn,{storageKey:"ndn:modal:offline-leg-override",className:"relative",defaultWidth:360,defaultHeight:240,minWidth:280,minHeight:200,maxWidth:420,maxHeight:360,initialFitHeight:!0,onClose:er,children:e.jsxs("div",{className:"space-y-3 max-w-[18rem] mx-auto",onClick:P=>P.stopPropagation(),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide text-white/50",children:["Step ",c," of 2"]}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Override legs?"})]}),e.jsx("div",{className:"text-sm text-slate-200 leading-relaxed",children:c===1?e.jsxs(e.Fragment,{children:["Set ",h,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:a}),"? Confirm to continue."]}):e.jsxs(e.Fragment,{children:["Final confirmation: set ",h,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:a}),". Select"," ",e.jsx("span",{className:"font-semibold text-emerald-200",children:"Yes"})," ","to apply immediately."]})}),e.jsxs("div",{className:"rounded-xl bg-black/40 border border-white/10 p-3 text-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50 mb-1",children:"Current legs"}),e.jsx("div",{className:"text-base font-semibold text-white",children:b})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:er,children:"No"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:ml,children:"Yes"})]})]})})})})(),document.body):null,Re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(Cn,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${F===t?"bg-brand-600":""}`,onClick:()=>v(t),children:t},t))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${V===t?"bg-brand-600":""}`,onClick:()=>ee(t),children:t},t))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:Sl,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{ie(!1),Nn()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{ie(!1),Bt(!1),st(!1)},children:"Back to Menu"})]})]})}),Yi&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(Cn,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[p," Â· ",A," start Â· First to ",Xe]}),(()=>{const t=Xn>0?_r/Xn*3:0,a=t*3,c=(()=>{const N=J.filter(H=>H.winner==="player"&&typeof H.winnerDarts=="number").map(H=>H.winnerDarts);return N.length?`${Math.min(...N)} darts`:"â€”"})(),h=(()=>{const N=J.filter(H=>H.winner==="player"&&typeof H.winnerDarts=="number").map(H=>H.winnerDarts);return N.length?`${Math.max(...N)} darts`:"â€”"})(),b=zn>0?Math.round(Vr/zn*100):0,P=Yn>0?Kr/Yn*3:0,B=P*3,K=(()=>{const N=J.filter(H=>H.winner==="ai"&&typeof H.winnerDarts=="number").map(H=>H.winnerDarts);return N.length?`${Math.min(...N)} darts`:"â€”"})(),I=(()=>{const N=J.filter(H=>H.winner==="ai"&&typeof H.winnerDarts=="number").map(H=>H.winnerDarts);return N.length?`${Math.max(...N)} darts`:"â€”"})(),U=qn>0?Math.round(Wr/qn*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:s?.username||"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:ne}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:t.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:a.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:zn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[b,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:c})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:h})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Ra})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[ne," â€“ ",Ne]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:Q==="None"?"Opponent":`${Q} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:Ne}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:P.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:B.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:qn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[U,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:K})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:I})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Ia})]})]})]})]})})(),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:J.map((t,a)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${t.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",a+1,":"," ",t.winner==="player"?"You":Q==="None"?"Opp":"AI"," ","Â· Dbl ",t.doubleDarts," Â· CO ",t.checkoutDarts]},a))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(ao,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>Xr(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{Xr(!1),Nn()},children:"Rematch"})]})]})}),J.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:J.map((t,a)=>e.jsxs("li",{children:["Leg ",a+1,": Double darts: ",t.doubleDarts,", Checkout darts:"," ",t.checkoutDarts]},a))})]})]})]})}export{ec as default};
//# sourceMappingURL=OfflinePlay-CCWqOVTa.js.map

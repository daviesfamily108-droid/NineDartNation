import{Q as ue,S as Ce,U as Se,V as Pe,W as $e,X as Ee,j as e,Y as Fe,Z as be,u as G,a as ge,_ as Te,b as Re,L as Ue,$ as Ae,a0 as Ie,g as Le,a1 as Be,a2 as Oe,r as De}from"./index-jnU-qcsE.js";import{J as de,K as pe,R as ve,Z as we,N as Me,r as l}from"./ui-C3zlW9wh.js";function ot({gameMode:a,compact:t=!1,onRecalibrate:c}){const{H:d,errorPx:m,confidence:p}=ue(),h=Ce(a,m),x=Se(a,m),{text:r}=Pe(a,m),i=$e(a),w=Fe[a],y=typeof p=="number"?p:Ee(m),N=typeof y=="number"&&Math.abs(y-h)>=.5,S=!!d;if(!S)return t?e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30",children:[e.jsx(de,{className:"w-3 h-3"}),"Not calibrated âŒ"]}):e.jsxs("div",{className:"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-red-300",children:"Calibration Required âš ï¸"}),e.jsxs("div",{className:"text-xs opacity-80",children:["Please calibrate before playing ",a]})]}),c&&e.jsx("button",{className:"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700",onClick:c,children:"Calibrate ðŸ“"})]});if(S&&(m==null||Number.isNaN(m)))return t?e.jsxs("div",{className:"text-xs px-2 py-1 rounded inline-flex items-center gap-1 border bg-emerald-500/20 border-emerald-600/30 text-emerald-300",children:[e.jsx(pe,{className:"w-3 h-3"}),"Calibrated âœ…"]}):e.jsx("div",{className:"px-3 py-2 rounded border bg-emerald-500/20 border-emerald-600/30 space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-emerald-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-emerald-300",children:["Calibration for ",a]}),e.jsx("div",{className:"text-xs opacity-80",children:"Calibrated (quality pending) â³"})]})]})});const g=r.includes("Perfect"),R=g?"bg-indigo-500/20 border-indigo-600/30":x?"bg-emerald-500/20 border-emerald-600/30":"bg-amber-500/20 border-amber-600/30",k=g?"text-indigo-300":x?"text-emerald-300":"text-amber-300",U=g?we:x?pe:de;return t?e.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${R} ${k}`,children:[ve.createElement(U,{className:"w-3 h-3"}),e.jsxs("span",{className:"flex flex-wrap gap-x-1",children:[e.jsx("span",{children:r}),typeof y=="number"&&e.jsxs("span",{children:["Â· Raw ",y.toFixed(1),"%"]}),N&&e.jsx("span",{children:`Â· ${a}: ${h.toFixed(1)}%`})]}),!x&&i&&e.jsx("span",{className:"w-3 h-3 cursor-help",title:i,children:e.jsx(Me,{className:"w-3 h-3 inline"})})]}):e.jsxs("div",{className:`px-3 py-2 rounded border ${R} space-y-1`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ve.createElement(U,{className:`w-4 h-4 ${g?"text-indigo-400":x?"text-emerald-400":"text-amber-400"} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`font-medium ${g?"text-indigo-300":x?"text-emerald-300":"text-amber-300"}`,children:["Calibration for ",a]}),e.jsxs("div",{className:"text-xs opacity-80 flex flex-wrap gap-x-2 gap-y-1",children:[e.jsxs("span",{children:["Error: ",m!==null?`${m.toFixed(2)}px`:"Unknown"]}),e.jsx("span",{children:r}),typeof y=="number"&&e.jsxs("span",{children:["Raw: ",y.toFixed(1),"%"]}),N&&e.jsx("span",{children:`${a}: ${h.toFixed(1)}%`})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 rounded bg-black/30 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${g?"bg-indigo-500":x?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Math.min(100,h)}%`}})}),e.jsxs("span",{className:"text-xs font-mono",children:[h.toFixed(1),"%"]})]}),w&&e.jsx("div",{className:"text-xs opacity-75",children:e.jsxs("div",{children:["Tolerance: Â±",w.tolerancePx,"px | Min:"," ",w.minConfidence,"%"]})}),e.jsxs("div",{className:"space-y-1",children:[!x&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3 flex-shrink-0"}),"Calibration quality is below minimum for ",a]}),i&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1",children:[e.jsx(we,{className:"w-3 h-3 flex-shrink-0"}),i]})]}),!x&&c&&e.jsxs("button",{className:"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700",onClick:c,children:["Recalibrate for ",a]})]})}function We({players:a,playerCalibrations:t,calibrationSkipped:c,onSkip:d,onOpenCalibrator:m,onClose:p}){const h=a.filter(i=>c[i.id]),x=a.filter(i=>!c[i.id]),r=x.length===0;return e.jsx("div",{className:"fixed inset-0 z-60 overflow-y-auto bg-black/90 backdrop-blur-sm py-8 px-4",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full mx-auto shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"Calibration Check ðŸŽ¯"}),e.jsx("p",{className:"text-sm opacity-70 mb-6 text-center",children:"Check your dartboard calibration before the match starts ðŸŽ¯. Both players must skip or confirm to begin ðŸŽ¯."}),h.length>0&&x.length>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[h.map(i=>i.name).join(", ")," ",h.length===1?"has":"have"," chosen to skip ðŸŽ¯."," ",x.map(i=>i.name).join(", "),", would you like to skip as well ðŸŽ¯?"]})}),e.jsx("div",{className:"space-y-4",children:a.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:i.name.split(" ").map(w=>w[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.name}),e.jsx("div",{className:"text-xs text-slate-400",children:t[i.name]?"Calibrated âœ…":"Needs calibration"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>m(i.id),children:"Bull Up ðŸŽ¯"}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>d(i.id),disabled:!!c[i.id],children:c[i.id]?"Skipped âœ“":"Skip ðŸŽ¯"})]})]},i.id))}),e.jsx("div",{className:"mt-6 flex justify-center gap-4",children:e.jsx("button",{className:`btn ${r?"btn-primary":"btn-ghost opacity-50 cursor-not-allowed"}`,disabled:!r,onClick:p,children:"Start Match ðŸŽ¯"})})]})})}async function He(){const a=[];try{const t=await Ve();for(const c of t){const d=await Ge(c,[80,8080,8787,8788,3e3,5e3]);for(const m of d){const p=await Je(m.ip,m.port);p&&a.push(p)}}}catch(t){console.error("Network discovery failed:",t)}return a}async function Ve(){const a=[];try{const t=new RTCPeerConnection({iceServers:[]});t.createDataChannel("");const c=await t.createOffer();return await t.setLocalDescription(c),new Promise(d=>{const m=setTimeout(()=>{t.close(),d(a)},5e3);t.onicecandidate=p=>{if(p.candidate){const x=p.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(x&&x[1]&&!a.includes(x[1])){const r=x[1];_e(r)&&a.push(r)}}else clearTimeout(m),t.close(),d(a)}})}catch(t){return console.error("Failed to get local IPs:",t),["192.168.1.0"]}}function _e(a){const t=a.split(".").map(Number);return t[0]===10||t[0]===172&&t[1]>=16&&t[1]<=31||t[0]===192&&t[1]===168}async function Ge(a,t){const c=[],d=a.split(".").slice(0,3).join("."),m=[];for(let h=1;h<=254;h++){const x=`${d}.${h}`;for(const r of t)m.push(qe(x,r))}return(await Promise.allSettled(m)).forEach((h,x)=>{if(h.status==="fulfilled"&&h.value){const r=x%t.length,i=Math.floor(x/t.length),w=`${d}.${i+1}`;c.push({ip:w,port:t[r]})}}),c}async function qe(a,t){try{const c=await fetch(`http://${a}:${t}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(2e3)});return!0}catch{return!1}}async function Je(a,t){try{const c=["/","/api/info","/api/status","/camera","/stream"];for(const d of c)try{const m=await fetch(`http://${a}:${t}${d}`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(m.ok){const p=m.headers.get("content-type")||"",h=await m.text();if(h.includes("OMNI")||h.includes("omni")||d.includes("omni"))return{id:`omni-${a}-${t}`,name:`OMNI Camera (${a})`,ip:a,port:t,type:"omni",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(h.includes("VERT")||h.includes("vert")||d.includes("vert"))return{id:`vert-${a}-${t}`,name:`VERT Camera (${a})`,ip:a,port:t,type:"vert",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(p.includes("video")||h.includes("stream")||d==="/stream")return{id:`generic-${a}-${t}`,name:`Network Camera (${a})`,ip:a,port:t,type:"generic",capabilities:["video"],status:"online",connectionType:"wifi"}}}catch{}}catch(c){console.error(`Failed to probe device ${a}:${t}:`,c)}return null}async function Qe(){const a=[];try{if(!("serial"in navigator))return console.warn("Web Serial API not supported in this browser"),a;const t=await navigator.serial.getPorts();for(const c of t){const d=await ye(c);d&&a.push(d)}}catch(t){console.error("USB device discovery failed:",t)}return a}async function Ye(){try{if(!("serial"in navigator))return alert("Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge."),null;const a=await navigator.serial.requestPort();return await ye(a)}catch(a){return a.name!=="NotFoundError"&&console.error("USB device request failed:",a),null}}async function ye(a){try{await a.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none"});const t=a.readable?.getReader();if(t)try{const c=setTimeout(()=>t.cancel(),2e3),{value:d,done:m}=await t.read();if(clearTimeout(c),!m&&d){const p=new TextDecoder().decode(d);if(p.includes("OMNI")||p.includes("omni"))return t.releaseLock(),{id:`usb-omni-${Date.now()}`,name:"OMNI Camera (USB)",type:"omni",capabilities:["video","calibration"],status:"online",port:a};if(p.includes("VERT")||p.includes("vert"))return t.releaseLock(),{id:`usb-vert-${Date.now()}`,name:"VERT Camera (USB)",type:"vert",capabilities:["video","calibration"],status:"online",port:a}}}catch{}finally{try{t.releaseLock()}catch{}}return{id:`usb-generic-${Date.now()}`,name:"USB Scoring Device",type:"generic",capabilities:["video"],status:"online",port:a}}catch(t){return console.error("Failed to probe USB device:",t),null}}async function Ze(a){try{const t=`http://${a.ip}:${a.port}/stream`,c=document.createElement("video");return c.src=t,c.crossOrigin="anonymous",new Promise((d,m)=>{c.onloadeddata=()=>{const p=document.createElement("canvas"),h=p.getContext("2d");p.width=c.videoWidth,p.height=c.videoHeight;const x=p.captureStream(30),r=()=>{c.readyState>=2&&h.drawImage(c,0,0),requestAnimationFrame(r)};r(),d(x)},c.onerror=()=>m(new Error("Failed to load video stream")),c.load()})}catch(t){return console.error("Failed to connect to network device:",t),null}}async function Ke(a){try{if(!a.port)throw new Error("No serial port available");return console.log("USB device connection not fully implemented yet"),null}catch(t){return console.error("Failed to connect to USB device:",t),null}}function Xe({label:a,autoStart:t,scale:c,className:d,aspect:m="inherit",style:p,fill:h=!1,tileFitModeOverride:x}){const r=l.useRef(null),i=be(),[w,y]=l.useState(!1),[N,S]=l.useState(null),[g,R]=l.useState(null),[k,U]=l.useState(null),O=l.useRef(null),q=l.useCallback((s,o="local")=>{try{s?(i.setMediaStream(s),r.current&&i.setVideoElementRef(r.current),i.setMode(o),i.setStreaming(!0),O.current=o):O.current&&O.current!=="phone"&&(i.setStreaming(!1),i.setMediaStream(null),O.current=null)}catch(u){console.warn("[CameraTile] Failed to register stream with camera session:",u)}},[i]),J=l.useCallback(async()=>{try{const s=i.getMediaStream();if(!s||!r.current)return!1;r.current.srcObject!==s&&(r.current.srcObject=s),r.current.muted=!0,r.current.playsInline=!0;try{await r.current.play()}catch{}return y(!0),!0}catch(s){return console.warn("[CameraTile] Failed to reuse global camera stream",s),!1}},[i]),E=G(s=>s.preferredCameraLabel),[$,L]=l.useState(()=>E==="Phone Camera"?"phone":localStorage.getItem("ndn:camera:mode")||"local"),[,D]=l.useState(null),[,M]=l.useState(!1),[ae,K]=l.useState(null),[W,re]=l.useState(null),[X,ce]=l.useState(!0),[n,v]=l.useState([]),[j,C]=l.useState(!1),[H,F]=l.useState([]),[V,ne]=l.useState(!1),_=G(s=>s.autoscoreProvider),z=G(s=>s.cameraEnabled),B=G(s=>s.setPreferredCameraLocked),ee=G(s=>s.preferredCameraLocked),Q=G(s=>s.setPreferredCamera),fe=G(s=>s.preferredCameraId);if(_==="manual"){const o=[h?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",d].filter(Boolean).join(" ").trim(),u={...p||{}};return!h&&u.aspectRatio===void 0&&u.height===void 0&&u.minHeight===void 0&&(u.aspectRatio="4 / 3"),e.jsx("div",{className:o,style:u,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}l.useEffect(()=>{const s=window.location.hostname;(s==="localhost"||s==="127.0.0.1")&&ge("/api/hosts").then(o=>o.json()).then(o=>{const u=Array.isArray(o?.hosts)&&o.hosts.find(f=>f);u&&K(u)}).catch(()=>{}),ge("/api/https-info").then(o=>o.json()).then(o=>{o&&typeof o.https=="boolean"&&re({https:!!o.https,port:Number(o.port)||8788})}).catch(()=>{})},[]);const he=l.useMemo(()=>{const s=g||"____",o="ws://localhost:8787";if(o.length>0)try{const Z=new URL(o);return`${`${Z.protocol==="wss:"?"https":"http"}://${Z.host}${Z.pathname.endsWith("/ws")?"":Z.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${s}`}catch{}const u=ae||window.location.hostname,f=!!W?.https,P=f?W?.port||8788:8787;return`${f?"https":"http"}://${u}:${P}/mobile-cam.html?code=${s}`},[g,ae,W]);l.useEffect(()=>{localStorage.setItem("ndn:camera:mode",$)},[$]),l.useEffect(()=>{i.isStreaming&&J()},[i.isStreaming,J]);const[te,xe]=l.useState(null);l.useEffect(()=>{G.getState().ignorePreferredCameraSync||te&&Date.now()-te<3e4||E==="Phone Camera"&&$!=="phone"&&L("phone")},[E,$,te]),l.useEffect(()=>{const s=async()=>{try{if(!(E==="Phone Camera"&&(!te||Date.now()-te>=3e4)||$==="phone"))return;const f=i.getMediaStream(),P=r.current;if(!P||!f)return;P.srcObject!==f&&(P.srcObject=f),P.muted=!0,P.playsInline=!0;try{await P.play()}catch{}y(!0)}catch{}};s();const o=setInterval(s,800);return()=>clearInterval(o)},[E,$,i,i.isStreaming]);const A=l.useCallback(async()=>{if(!await J()){if($==="wifi")return se();if(E==="Phone Camera"||$==="phone"){const s=i.getMediaStream();if(s&&r.current)try{r.current.srcObject=s,await r.current.play(),y(!0);return}catch{}if($==="phone")try{await ie();return}catch{}}try{const{preferredCameraId:s,setPreferredCamera:o}=G.getState(),u=s?{video:{deviceId:{exact:s}},audio:!1}:{video:!0,audio:!1};let f;try{f=await navigator.mediaDevices.getUserMedia(u)}catch(P){const Y=P&&(P.name||P.code)||"";if(s&&(Y==="OverconstrainedError"||Y==="NotFoundError"))f=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw P}r.current&&(r.current.srcObject=f,await r.current.play(),y(!0),q(f,"local"))}catch{}}},[$,E,i,q,ie,se,J]),oe=l.useCallback(()=>{r.current&&r.current.srcObject&&(r.current.srcObject.getTracks().forEach(o=>o.stop()),r.current.srcObject=null,y(!1),q(null))},[q]);l.useEffect(()=>{if(!(!z||_&&_!=="built-in"&&_!=="external-ws")&&t!==void 0){if(t){let s=!1;const o=E||"default",u=window.setTimeout(()=>{s||w||A().catch(f=>console.warn(`[CameraTile] Auto-start failed for ${o}:`,f))},200);return()=>{s=!0,window.clearTimeout(u)}}oe()}},[t,w,z,_,E,A,oe]);async function se(){C(!0);try{const s=await He();v(s),s.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(s){console.error("Wifi device discovery failed:",s),alert("Failed to discover wifi devices. Please check your network connection.")}finally{C(!1)}}async function le(s){try{v(u=>u.map(f=>f.id===s.id?{...f,status:"connecting"}:f));const o=await Ze(s);if(o&&r.current)r.current.srcObject=o,await r.current.play(),y(!0),q(o,"wifi"),v(u=>u.map(f=>f.id===s.id?{...f,status:"online"}:f));else throw new Error("Failed to get video stream")}catch(o){console.error("Failed to connect to wifi device:",o),alert(`Failed to connect to ${s.name}. Please check the device and try again.`),v(u=>u.map(f=>f.id===s.id?{...f,status:"offline"}:f))}}async function b(){ne(!0);try{const s=await Qe();F(s);const o=await Ye();o&&F(u=>[...u,o]),s.length===0&&!o&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(s){console.error("USB device discovery failed:",s),alert("Failed to discover USB devices. Please check device connections.")}finally{ne(!1)}}async function T(s){try{F(u=>u.map(f=>f.id===s.id?{...f,status:"connecting"}:f));const o=await Ke(s);if(o&&r.current)r.current.srcObject=o,await r.current.play(),y(!0),L("wifi"),q(o,"wifi"),F(u=>u.map(f=>f.id===s.id?{...f,status:"online"}:f));else throw new Error("Failed to get video stream")}catch(o){console.error("Failed to connect to USB device:",o),alert(`Failed to connect to ${s.name}. Please check the device and try again.`),F(u=>u.map(f=>f.id===s.id?{...f,status:"offline"}:f))}}const I=l.useCallback(s=>{try{L(s==="usb"?"wifi":s),xe(Date.now());try{if(s==="local"){try{Q(fe,"Local",!0)}catch{}try{B(!0)}catch{}}else if(s==="phone"){try{Q(void 0,"Phone Camera",!0)}catch{}try{B(!0)}catch{}}else if(s==="wifi"||s==="usb"){try{Q(void 0,"WiFi/USB",!0)}catch{}try{B(!0)}catch{}}}catch{}s==="local"?A().catch(()=>{}):s==="phone"?ie():s==="wifi"?se():s==="usb"&&b()}catch(o){console.warn("[CameraTile] handleModeSelect failed",o)}},[A,ie,se,b,Q,B,fe]);l.useEffect(()=>{const s=o=>{try{const u=o&&o.detail&&o.detail.mode;u&&["local","phone","wifi","usb"].includes(u)?(I(u),A().catch(()=>{})):A().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",s),()=>{window.removeEventListener("ndn:start-camera",s)}},[A,I]);function je(){if(N&&N.readyState===WebSocket.OPEN)return N;const s=Te(),o=new WebSocket(s);return S(o),o}async function ie(){L("phone"),M(!1);const s=je();s.readyState===WebSocket.OPEN?s.send(JSON.stringify({type:"cam-create"})):s.onopen=()=>s.send(JSON.stringify({type:"cam-create"})),s.onmessage=async o=>{const u=JSON.parse(o.data);if(u.type==="cam-code")R(u.code),u.expiresAt&&D(u.expiresAt);else if(u.type==="cam-peer-joined"){M(!0);const f=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});U(f),f.onicecandidate=Y=>{Y.candidate&&g&&s.send(JSON.stringify({type:"cam-ice",code:g,payload:Y.candidate}))},f.ontrack=Y=>{if(r.current){const Z=Y.streams?.[0];Z&&(r.current.srcObject=Z,r.current.play().catch(()=>{}),y(!0))}};const P=await f.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await f.setLocalDescription(P),g&&s.send(JSON.stringify({type:"cam-offer",code:g,payload:P}))}else if(u.type==="cam-answer")k&&await k.setRemoteDescription(new RTCSessionDescription(u.payload));else if(u.type==="cam-ice"&&k)try{await k.addIceCandidate(u.payload)}catch{}}}function Ne(){R(null),D(null),M(!1),N&&N.readyState===WebSocket.OPEN?N.send(JSON.stringify({type:"cam-create"})):ie();try{B(!0)}catch{}}function ke(){if(oe(),R(null),M(!1),D(null),k){try{k.close()}catch{}U(null)}}return e.jsx(ze,{label:a,autoStart:t,start:A,stopAll:ke,startPhonePairing:ie,startWifiConnection:se,startUsbConnection:b,connectToWifiDevice:le,connectToUsbDevice:T,videoRef:r,streaming:w,mode:$,setMode:L,pairCode:g,mobileUrl:he,regenerateCode:Ne,httpsInfo:W,showTips:X,setShowTips:ce,wifiDevices:n,usbDevices:H,discoveringWifi:j,discoveringUsb:V,scaleOverride:c,tileFitModeOverride:x,className:d,aspect:m,style:p,fill:h,onModeSelect:I,preferredCameraLocked:ee})}function ze(a){const t=be(),{cameraScale:c,cameraAspect:d}=G(),{label:m,start:p,stopAll:h,startPhonePairing:x,startWifiConnection:r,startUsbConnection:i,connectToWifiDevice:w,connectToUsbDevice:y,videoRef:N,streaming:S,mode:g,setMode:R,onModeSelect:k,pairCode:U,mobileUrl:O,regenerateCode:q,httpsInfo:J,showTips:E,setShowTips:$,wifiDevices:L,usbDevices:D,discoveringWifi:M,discoveringUsb:ae,scaleOverride:K,tileFitModeOverride:W,className:re,aspect:X,style:ce,fill:n,preferredCameraLocked:v}=a,j={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},C=l.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{k&&k("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{k&&k("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{k&&k("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{k&&k("usb")}}],[R,p,x,r,i]),[H,F]=l.useState(null),V=l.useRef(null);l.useEffect(()=>()=>{V.current&&window.clearTimeout(V.current)},[]);const{cameraFitMode:ne}=G(),_=W||(n?"fill":ne||"fill"),z=(()=>{const b=Number(K??c??1),T=Math.max(.5,Math.min(2,b));return _==="fill"?Math.max(1,T):T})(),B=n&&_==="fill"?"free":X&&X!=="inherit"?X:d||"wide",ee=B!=="free",Q=ee?B==="square"?"aspect-square":B==="portrait"?"aspect-[3/4]":B==="classic"?"aspect-[4/3]":"aspect-video":"",he=[n?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",re].filter(Boolean).join(" ").trim(),te={...ce||{}},xe=n?"relative flex-1 min-h-0 bg-black":"relative w-full bg-black",A={style:{transform:`scale(${z})`,transformOrigin:"center"}},oe=g==="wifi"&&D.some(b=>b.status==="online"),se=(()=>{const T=_==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return n?ee?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${Q}`,children:e.jsx("video",{ref:N,className:T,...A})})}):e.jsx("video",{ref:N,className:T,...A}):ee?e.jsx("div",{className:`relative w-full ${Q}`,children:e.jsx("video",{ref:N,className:T,...A})}):e.jsx("div",{className:"relative w-full",children:e.jsx("video",{ref:N,className:T,...A})})})();async function le(b,T){if(b)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(b);else{const I=document.createElement("textarea");I.value=b,I.style.position="fixed",I.style.opacity="0",document.body.appendChild(I),I.focus(),I.select(),document.execCommand("copy"),document.body.removeChild(I)}F(T),V.current&&window.clearTimeout(V.current),V.current=window.setTimeout(()=>F(null),1500)}catch(I){console.warn("Copy to clipboard failed:",I),F(null)}}return e.jsxs("div",{className:he,style:te,children:[e.jsxs("div",{className:xe,children:[se,t.isStreaming&&g==="phone"&&e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{children:"REC"})]})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[e.jsxs("span",{className:"truncate font-medium",children:[m||(S?g==="phone"?"PHONE LIVE":g==="wifi"?"WIFI LIVE":"LIVE":"Camera"),v&&e.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!S&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${g==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("local"),children:"Local"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${g==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("phone"),children:"Phone"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${g==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("wifi"),children:"WiFi"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${g==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>k("usb"),children:"USB"})]}),S?e.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:h,children:"Stop"}):null]})]}),g==="phone"&&U&&!S&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>le(O,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:O}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:H==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:O,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>le(U,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:U}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:H==="code"?"Copied!":"Copy"})]})]}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:q,children:"Regenerate"})}),E&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wi-Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and"," ",J?.https?J.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>$(!1),children:"Hide tips"})})]})]}),g==="wifi"&&!S&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),M?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):L.length>0?e.jsxs("div",{className:"space-y-1",children:[L.map(b=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:b.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[b.ip,":",b.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${b.status==="connecting"?"bg-yellow-600":b.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>w(b),disabled:b.status==="connecting",children:b.status==="connecting"?"...":"Connect"})]},b.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:r,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:r,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),ae?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):D.length>0?e.jsxs("div",{className:"space-y-1",children:[D.map(b=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:b.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:b.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${b.status==="connecting"?"bg-yellow-600":b.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>y(b),disabled:b.status==="connecting",children:b.status==="connecting"?"...":"Connect ðŸ”Œ"})]},b.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:i,children:"Rescan USB ðŸ”"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found âŒ"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:i,children:"Scan USB ðŸ”"})]})]})]}),!S&&e.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes âš™ï¸"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera ðŸ”„"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",j[g]||"Local"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:C.map(b=>{const T=b.id==="usb"?oe:b.id===g;return e.jsxs("button",{type:"button",onClick:b.action,className:`text-left p-3 rounded-2xl border ${T?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:b.title}),e.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:b.description}),T&&e.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active âœ…"})]},b.id)})})]})]})}function me({label:a,value:t,className:c="",scale:d=1}){return e.jsxs("div",{className:`flex flex-col items-center gap-0 ${c}`,children:[e.jsx("div",{className:"text-[8px] opacity-70 uppercase font-bold tracking-tighter leading-none",children:a}),e.jsx("div",{className:"text-sm sm:text-base font-black transform transition-transform duration-200 ease-out leading-none",style:{transform:`scale(${d})`},children:t})]})}function et({player:a,user:t,playerCalibrations:c}){const d=l.useRef(null),m=c[a.name],p=ue(r=>!!r.H),x=!!(t?.username&&a?.name&&a.name.toLowerCase()===t.username.toLowerCase()||a?.name==="You")?p:!!m;return l.useEffect(()=>{const r=d.current;if(!r)return;const i=r.getContext("2d");if(!i)return;const w=r.width/2,y=r.height/2,N=Math.min(w,y)-2;i.clearRect(0,0,r.width,r.height);try{typeof i.stroke=="function"&&(i.strokeStyle="#fff",i.lineWidth=1,i.beginPath(),i.arc(w,y,N,0,2*Math.PI),i.stroke()),typeof i.fill=="function"&&(i.fillStyle="#f00",i.beginPath(),i.arc(w,y,4,0,2*Math.PI),i.fill())}catch{}if(x)try{typeof i.fill=="function"&&(i.fillStyle="#0f0"),[[w-N*.5,y],[w+N*.5,y],[w,y-N*.5],[w,y+N*.5]].forEach(([g,R])=>{try{typeof i.beginPath=="function"&&i.beginPath(),typeof i.arc=="function"&&i.arc(g,R,2,0,2*Math.PI),typeof i.fill=="function"&&i.fill()}catch{}})}catch{}},[x]),e.jsxs("div",{className:"flex items-center gap-2 mt-1 bg-white/5 p-1.5 rounded-lg border border-white/10",children:[e.jsx("canvas",{ref:d,width:40,height:40,className:"border border-white/20 rounded-md bg-black/60 shadow-inner"}),e.jsx("span",{className:`text-xs font-black tracking-tight ${x?"text-emerald-400":"text-rose-400/70"}`,children:x?"Calibrated âœ…":"Not Calibrated âŒ"})]})}function tt({player:a,limit:t=3}){const c=[];try{const d=a.legs||[];for(let m=d.length-1;m>=0&&c.length<t;m--){const h=d[m].visits||[];for(let x=h.length-1;x>=0&&c.length<t;x--){const r=h[x];c.push({score:Number(r?.score||0),darts:Number(r?.darts||3)})}}}catch{}return c.length?e.jsx("div",{className:"flex gap-1 items-center",children:c.map((d,m)=>e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded-md font-black shadow-sm ${d.score>=100?"bg-emerald-600/70 text-emerald-300 ring-1 ring-emerald-500/50":d.score>=60?"bg-amber-500/60 text-amber-300 ring-1 ring-amber-500/50":"bg-white/20 text-gray-200 ring-1 ring-white/20"}`,children:d.score},m))}):e.jsx("div",{className:"text-[10px] opacity-60",children:"No visits ðŸ“‰"})}function st({secondsLeft:a,totalSeconds:t,size:c=60,stroke:d=6,color:m="emerald"}){const p=(c-d)/2,h=2*Math.PI*p,x=Math.max(0,Math.min(1,t>0?a/t:0)),r=h*(1-x),i=m==="emerald"?"#34d399":"#f59e0b";return e.jsxs("svg",{width:c,height:c,viewBox:`0 0 ${c} ${c}`,"aria-hidden":!0,children:[e.jsx("defs",{children:e.jsx("filter",{id:"softShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"3",floodColor:"#000",floodOpacity:"0.45"})})}),e.jsx("circle",{cx:c/2,cy:c/2,r:p,fill:"transparent",stroke:"rgba(255,255,255,0.06)",strokeWidth:d}),e.jsx("circle",{cx:c/2,cy:c/2,r:p,fill:"transparent",stroke:i,strokeWidth:d,strokeLinecap:"round",strokeDasharray:h,strokeDashoffset:r,transform:`rotate(-90 ${c/2} ${c/2})`,style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.4))"}}),e.jsx("text",{x:"50%",y:"50%",fill:"white",fontSize:c*.28,fontWeight:900,dominantBaseline:"middle",textAnchor:"middle",children:a>0?a:"GO! ðŸš€"})]})}function lt({open:a=!0,players:t,user:c,onDone:d,onRequestClose:m,initialSeconds:p=15,showCalibrationDefault:h=!1,disableEscClose:x=!1}){const[r,i]=l.useState(p||15),w=!!a,y=be(),N=ue(n=>({hasHomography:!!n.H,locked:!!n.locked,confidence:n.confidence})),S=y.isStreaming&&N.hasHomography,[g,R]=l.useState(!1),[k,U]=l.useState(()=>{const n={};if(!h)for(const v of t)n[v.id]=!0;return n}),[O,q]=l.useState({}),J=l.useRef(null),E=l.useRef(null),$=l.useRef(null),L=l.useRef(null),D=l.useRef(!1);l.useEffect(()=>(D.current=!0,()=>{D.current=!1}),[]),l.useEffect(()=>{h||U(n=>{const v={...n};for(const j of t)v[j.id]||(v[j.id]=!0);return v})},[t,h]);const M=t.every(n=>k[n.id]);l.useEffect(()=>{if(!w)return;try{setTimeout(()=>{try{E.current?.focus()}catch{}},0)}catch{}try{L.current=document.activeElement}catch{}const n=document.getElementById("root");try{n&&n.setAttribute("aria-hidden","true")}catch{}const v=M?setInterval(()=>i(C=>C-1),1e3):null,j=C=>{if(D.current&&!x&&(C.key==="Escape"||C.key==="Esc")){C.preventDefault();try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}try{L.current?.focus()}catch{}}};return document.addEventListener("keydown",j),()=>{try{n&&n.removeAttribute("aria-hidden")}catch{}v&&clearInterval(v),document.removeEventListener("keydown",j)}},[w,d,M]),l.useEffect(()=>{w&&(h&&r===(p||15)&&!g&&(R(!0),(async()=>{const v={};for(const j of t)if(c?.username&&j.name===c.username){const{H:C,imageSize:H,overlaySize:F,locked:V}=ue.getState();C&&(v[j.name]={H:C,imageSize:H,overlaySize:F,locked:V})}else try{const C=await fetch(`/api/users/${encodeURIComponent(j.name)}/calibration`);if(C.ok){const H=await C.json();H.calibration&&(v[j.name]=H.calibration)}}catch(C){console.warn("Failed to fetch calibration for",j.name,C)}q(v)})()),M&&r<=0&&setTimeout(()=>{try{d?.()}catch{}try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}try{L.current?.focus()}catch{}},1e3))},[r,d,w,g,M,t,c]);const ae=l.useMemo(()=>t.map(n=>{try{const v=Re(n.name),j=Ue(n.name),C=Ae(n.name),H=Ie(n.name),F=Le(n.name),V=F.scored||0,ne=F.darts||0,_=Be(n.name);let z=0;try{for(const ee of n.legs||[])for(const Q of ee.visits||[])Number(Q.score||0)===180&&(z+=1)}catch{}const B=`${z}/${_}`;return{id:n.id,name:n.name,avg3:v.toFixed(1),best9:j.toFixed(1),bestCheckout:C,bestLeg:H,one80s:B,lifetimeScored:V,lifetimeDarts:ne}}catch{return{id:n.id,name:n.name,avg3:"â€”",best9:"â€”",bestCheckout:"â€”",bestLeg:"â€”",one80s:"â€”",lifetimeScored:0,lifetimeDarts:0}}}),[t]),K=l.useRef(typeof document<"u"?document.createElement("div"):null);if(l.useLayoutEffect(()=>{if(!K.current)return;const n=K.current;n.className="ndn-match-start-portal";try{Array.from(document.querySelectorAll(".ndn-match-start-portal")).forEach(j=>{try{j.parentNode?.removeChild(j)}catch{}})}catch{}return document.body.appendChild(n),()=>{try{n&&n.parentNode&&n.parentNode.removeChild(n)}catch{}}},[]),!w)return null;const W=n=>n<=0?1.8:n===1?1.6:n===2?1.4:n===3?1.2:1,re=l.useMemo(()=>{const n=N.confidence;return typeof n=="number"?n:n&&typeof n=="object"&&typeof n.percentage=="number"?n.percentage:null},[N.confidence]),X=S?`Calibrated camera linked${typeof re=="number"?` â€¢ ${re.toFixed(0)}% confidence`:""}`:"Calibrate to link this camera feed",ce=e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black/90 backdrop-blur-sm",children:e.jsx("div",{className:"min-h-full flex items-center justify-center p-4 sm:p-6 lg:p-8",children:e.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"match-start-heading",tabIndex:-1,className:"w-full max-w-4xl",children:e.jsx(Oe,{returnFocus:!0,children:e.jsxs("div",{ref:J,className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-indigo-500/20 via-purple-500/20 to-emerald-500/20 rounded-[3rem] blur-3xl -z-10 opacity-50 animate-pulse"}),e.jsxs("div",{className:"bg-[#13111C] border border-white/10 rounded-3xl p-4 md:p-6 w-full shadow-2xl ring-1 ring-white/5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none mix-blend-overlay"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-center justify-between gap-3 mb-4 border-b border-white/5 pb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold text-indigo-400 uppercase tracking-widest mb-0.5",children:"Get Ready ðŸš€"}),e.jsx("div",{id:"match-start-heading",className:"text-2xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/10 tracking-tighter",children:"Match Starting Soon ðŸŽ¯"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500/70 blur-[4rem] rounded-full animate-pulse"}),e.jsxs("div",{className:"relative",children:[e.jsx(st,{secondsLeft:r,totalSeconds:p||15,size:60,stroke:6,color:r>5?"emerald":"amber"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-black text-white tabular-nums",children:r})})]})]})}),e.jsxs("div",{className:"flex flex-col gap-1.5 sm:flex-row",children:[e.jsx("button",{ref:E,className:"px-4 py-1.5 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40 hover:scale-105 transition-all duration-200 active:scale-95 text-xs",onClick:()=>{try{d?.()}catch{}try{try{document.getElementById("root")?.removeAttribute("aria-hidden")}catch{}setTimeout(()=>{try{m?.()}catch{}},0)}catch{}},"aria-label":"Start match now",children:"Start Now â–¶ï¸"}),e.jsx("button",{ref:$,className:"px-3 py-1.5 rounded-lg bg-white/5 text-white/70 font-semibold hover:bg-white/10 hover:text-white transition-colors text-xs",onClick:()=>{try{m?.()}catch{}},children:"Close âœ–ï¸"})]})]})]}),e.jsxs("div",{className:"relative grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-5 mb-4",children:[e.jsx("div",{className:"hidden md:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-20 w-16 h-16 bg-[#13111C] rounded-full items-center justify-center border-2 border-white/10 shadow-[0_0_30px_rgba(0,0,0,0.8)]",children:e.jsx("span",{className:"text-xl font-black text-white/20 italic tracking-tighter",children:"VS âš”ï¸"})}),ae.map((n,v)=>e.jsxs("div",{className:`group relative p-3 md:p-4 rounded-3xl border border-white/5 flex flex-col items-center shadow-xl transition-all duration-300 hover:border-white/10 hover:bg-white/[0.02] max-h-[80vh] overflow-hidden ${v===0?"bg-gradient-to-br from-indigo-500/5 to-transparent":"bg-gradient-to-bl from-emerald-500/5 to-transparent"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 w-full",children:[e.jsx("div",{className:`w-12 h-12 shrink-0 rounded-xl rotate-3 group-hover:rotate-6 transition-transform duration-300 flex items-center justify-center text-xl font-black text-white shadow-lg ring-2 ring-white/10 ${v===0?"bg-gradient-to-br from-indigo-500 to-purple-600 shadow-indigo-500/50":"bg-gradient-to-br from-emerald-500 to-teal-600 shadow-emerald-500/50"}`,children:n.name.split(" ").map(j=>j[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsxs("div",{className:"text-2xl font-black text-white tracking-tighter truncate",children:[n.name," ðŸ‘¤"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&c.username===n.name&&e.jsx("div",{className:"text-[0.5rem] font-bold uppercase tracking-wider bg-white/10 text-white/60 px-1.5 py-0.5 rounded-md",children:"You â­"}),e.jsx(et,{player:t.find(j=>j.id===n.id),user:c,playerCalibrations:O})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 w-full bg-black/50 rounded-xl p-2 border border-white/10 shadow-2xl",children:[e.jsx(me,{label:"Avg ðŸ“Š",value:n.avg3,scale:W(r)*.7,className:"p-0.5"}),e.jsx(me,{label:"F9 ðŸ“ˆ",value:n.best9,scale:W(r)*.7,className:"p-0.5"}),e.jsx(me,{label:"CO ðŸ†",value:n.bestCheckout||"â€”",scale:W(r)*.7,className:"p-0.5"}),e.jsx(me,{label:"Leg âš¡",value:n.bestLeg||"â€”",scale:W(r)*.7,className:"p-0.5"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full mt-2 text-[0.6rem]",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"tracking-widest uppercase text-white/40",children:"Lifetime pts"}),e.jsx("span",{className:"text-white/90 font-semibold",children:n.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"tracking-widest uppercase text-white/40",children:"Lifetime darts"}),e.jsx("span",{className:"text-white/90 font-semibold",children:n.lifetimeDarts.toLocaleString()})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between w-full px-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/40 font-black",children:[e.jsx("span",{children:"180s ðŸ”¥:"}),e.jsxs("span",{className:"text-white/90",children:[n.one80s," âœ¨"]})]}),e.jsx(tt,{player:t.find(j=>j.id===n.id),limit:3})]}),v===0&&e.jsx("div",{className:"w-full mt-2",children:e.jsxs("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/30 relative",children:[e.jsx("div",{className:`absolute top-3 left-3 px-3 py-1 rounded-full text-[0.6rem] font-bold tracking-wide uppercase shadow-lg ${S?"bg-emerald-500/90 text-emerald-50":"bg-rose-500/80 text-white"}`,children:X}),e.jsx("div",{className:"w-full h-[200px] sm:h-[250px] md:h-[320px] flex flex-col",children:e.jsx(Xe,{autoStart:!0,fill:!0,aspect:"wide",tileFitModeOverride:"fit",scale:1})})]})})]},n.id))]}),e.jsx("div",{className:"text-center pt-6 border-t border-white/50",children:r<=1?e.jsx("div",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 via-cyan-400 to-blue-400 animate-bounce tracking-tighter py-4",children:"GAME ON! ðŸš€"}):e.jsxs("div",{className:"text-lg font-black text-white/80 uppercase tracking-[1em]",children:[t.map(n=>n.name).join(" vs ")," âš”ï¸"]})})]})]})})})})});return De.createPortal(e.jsxs(e.Fragment,{children:[g&&e.jsx(We,{players:t,playerCalibrations:O,calibrationSkipped:k,onSkip:n=>U(v=>({...v,[n]:!0})),onOpenCalibrator:n=>{U(v=>({...v,[n]:!1}));try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:"calibrate"}}))}catch{}try{setTimeout(()=>{try{m?.()}catch{}},0)}catch{}},onClose:()=>{R(!1)}}),ce]}),K.current)}export{Xe as C,ot as G,lt as M};
//# sourceMappingURL=MatchStartShowcase-4KbOzekC.js.map

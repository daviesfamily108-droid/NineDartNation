{"version":3,"file":"OnlinePlay.clean-0FOoiYSq.js","sources":["../../src/components/ui/CreateMatchModal.tsx","../../src/components/ui/MatchPrestart.tsx","../../src/components/OnlinePlay.clean.tsx"],"sourcesContent":["import React, { useLayoutEffect, useState, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport {\n  allGames,\n  type GameKey,\n  gameConfig,\n  getStartOptionsForGame,\n  getExtraFieldsForGame,\n  getValueLabelForGame,\n  getDefaultExtraValues,\n  getGameDisplay,\n  type ModeKey,\n} from \"../../utils/games.js\";\nimport { useUserSettings } from \"../../store/userSettings.js\";\n\ntype Props = {\n  open: boolean;\n  onClose: () => void;\n  onCreate: (payload: any) => void;\n};\n\nexport default function CreateMatchModal({ open, onClose, onCreate }: Props) {\n  const [portalEl] = useState(() => document.createElement(\"div\"));\n  const [game, setGame] = useState<GameKey>(\"X01\");\n  const [modeType, setModeType] = useState<\"bestof\" | \"firstto\">(\"bestof\");\n  const [legs, setLegs] = useState<number>(3);\n  const legsRef = useRef<HTMLInputElement | null>(null);\n  const [avgChoice, setAvgChoice] = useState<number>(0);\n  const [startingScore, setStartingScore] = useState<number | undefined>(() => {\n    const opts = getStartOptionsForGame(game);\n    return opts?.[0];\n  });\n  const [extraValues, setExtraValues] = useState<Record<string, number>>(() =>\n    getDefaultExtraValues(game),\n  );\n  const user = (useUserSettings() as any).username || \"Anonymous\";\n\n  // When game changes, reset mode/start/extras to match the selected game's config\n  function onGameChange(g: GameKey) {\n    setGame(g);\n    const opts = getStartOptionsForGame(g);\n    setStartingScore(opts?.[0]);\n    setExtraValues(getDefaultExtraValues(g));\n    const cfg = gameConfig[g];\n    if (cfg?.modeOptions?.length) {\n      const validMode = cfg.modeOptions.includes(modeType as ModeKey)\n        ? modeType\n        : cfg.modeOptions[0];\n      setModeType(validMode as any);\n    }\n  }\n\n  useLayoutEffect(() => {\n    portalEl.className = \"ndn-create-match-portal\";\n    document.body.appendChild(portalEl);\n    return () => {\n      try {\n        portalEl && portalEl.remove();\n      } catch {}\n    };\n  }, [portalEl]);\n\n  // Close modal on Escape key\n  useLayoutEffect(() => {\n    function onKey(e: KeyboardEvent) {\n      if (e.key === \"Escape\") onClose();\n    }\n    if (open) document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [open, onClose]);\n\n  const extraFields = getExtraFieldsForGame(game);\n  const valueLabel = getValueLabelForGame(game, modeType as ModeKey);\n  const display = getGameDisplay(game);\n\n  const handleCreate = () => {\n    const payload = {\n      createdBy: user,\n      game,\n      modeType,\n      legs,\n      avgChoice,\n      startingScore,\n      ...extraValues,\n    };\n    onCreate(payload);\n    onClose();\n  };\n\n  if (!open) return null;\n\n  if (!portalEl) return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-2 sm:p-6\">\n      {/* A dedicated, accessible button covers the backdrop to capture clicks and keyboard input */}\n      <button\n        aria-label=\"Close dialog\"\n        className=\"absolute inset-0 w-full h-full bg-transparent\"\n        onClick={onClose}\n      />\n      <div\n        className=\"rounded-2xl p-5 sm:p-6 max-w-lg w-full relative text-white shadow-2xl border border-indigo-500/30 max-h-[85vh] overflow-y-auto\"\n        style={{ background: \"var(--ndn-card-bg, #0f172a)\" }}\n        role=\"dialog\"\n      >\n        <button\n          aria-label=\"Close\"\n          className=\"absolute top-3 right-3 w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors\"\n          onClick={onClose}\n        >\n          âœ•\n        </button>\n        <h2 className=\"text-base sm:text-lg font-bold tracking-tight mb-3\">\n          {display.emoji} Create Match\n        </h2>\n        <div className=\"grid grid-cols-1 gap-3\">\n          <div>\n            <div className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n              Created By\n            </div>\n            <div className=\"p-2 rounded-lg border border-indigo-500/20 bg-indigo-500/10 text-sm text-white\">\n              {user}\n            </div>\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-game\"\n            >\n              Game\n            </label>\n            <select\n              id=\"match-game\"\n              className=\"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white\"\n              value={game}\n              onChange={(e) => onGameChange(e.target.value as GameKey)}\n              onPointerDown={(e) => {\n                (e as any).stopPropagation();\n              }}\n              onMouseDown={(e) => {\n                e.stopPropagation();\n              }}\n              onTouchStart={(e) => {\n                (e as any).stopPropagation?.();\n              }}\n            >\n              {allGames.map((g) => {\n                const d = getGameDisplay(g);\n                return (\n                  <option key={g} value={g} className=\"bg-slate-900 text-white\">\n                    {d.emoji} {g}\n                  </option>\n                );\n              })}\n            </select>\n            {display.tagline && (\n              <div\n                className=\"text-[10px] mt-0.5 px-0.5\"\n                style={{ color: display.color }}\n              >\n                {display.tagline}\n              </div>\n            )}\n          </div>\n          {getStartOptionsForGame(game).length > 0 ? (\n            <div>\n              <label\n                className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n                htmlFor=\"match-start\"\n              >\n                {`${game} Starting Score`}\n              </label>\n              <select\n                id=\"match-start\"\n                className=\"p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white w-full\"\n                value={startingScore}\n                onChange={(e) => setStartingScore(Number(e.target.value))}\n                onPointerDown={(e) => {\n                  (e as any).stopPropagation();\n                }}\n                onMouseDown={(e) => {\n                  e.stopPropagation();\n                }}\n                onTouchStart={(e) => {\n                  (e as any).stopPropagation?.();\n                }}\n              >\n                {getStartOptionsForGame(game).map((opt) => (\n                  <option\n                    key={opt}\n                    value={opt}\n                    className=\"bg-slate-900 text-white\"\n                  >\n                    {opt}\n                  </option>\n                ))}\n              </select>\n            </div>\n          ) : null}\n          {/* Per-game extra config fields */}\n          {extraFields.length > 0 && (\n            <div className=\"space-y-2\">\n              {extraFields.map((f) => (\n                <div key={f.key}>\n                  <label\n                    className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n                    htmlFor={`match-extra-${f.key}`}\n                  >\n                    {f.label}\n                  </label>\n                  {f.type === \"select\" && f.options ? (\n                    <select\n                      id={`match-extra-${f.key}`}\n                      className=\"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white\"\n                      value={extraValues[f.key] ?? f.defaultValue}\n                      onChange={(e) =>\n                        setExtraValues((prev) => ({\n                          ...prev,\n                          [f.key]: Number(e.target.value),\n                        }))\n                      }\n                      onPointerDown={(e) => {\n                        (e as any).stopPropagation();\n                      }}\n                      onMouseDown={(e) => {\n                        e.stopPropagation();\n                      }}\n                      onTouchStart={(e) => {\n                        (e as any).stopPropagation?.();\n                      }}\n                    >\n                      {f.options.map((o) => (\n                        <option\n                          key={o}\n                          value={o}\n                          className=\"bg-slate-900 text-white\"\n                        >\n                          {o}\n                        </option>\n                      ))}\n                    </select>\n                  ) : (\n                    <input\n                      id={`match-extra-${f.key}`}\n                      type=\"number\"\n                      min={f.min ?? 1}\n                      max={f.max}\n                      step={f.step ?? 1}\n                      value={extraValues[f.key] ?? f.defaultValue}\n                      onChange={(e) =>\n                        setExtraValues((prev) => ({\n                          ...prev,\n                          [f.key]: Number(e.target.value),\n                        }))\n                      }\n                      className=\"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white\"\n                    />\n                  )}\n                  {f.hint && (\n                    <div className=\"text-[10px] text-slate-400 mt-0.5 px-0.5\">\n                      {f.hint}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n          <div>\n            <div className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n              Mode\n            </div>\n            <div className=\"flex gap-2 mt-1 justify-center flex-wrap\">\n              {(gameConfig[game]?.modeOptions ?? [\"bestof\", \"firstto\"]).map(\n                (m) => (\n                  <label\n                    key={m}\n                    className={`btn ${modeType === m ? \"btn-primary\" : \"btn-ghost\"}`}\n                  >\n                    <input\n                      type=\"radio\"\n                      name=\"mode\"\n                      value={m}\n                      checked={modeType === m}\n                      onChange={() => {\n                        setModeType(m as any);\n                        if (m === \"bestof\") {\n                          setLegs((prev) => {\n                            const base = Math.max(1, prev || 3);\n                            return base % 2 === 1 ? base : base + 1;\n                          });\n                        } else {\n                          setLegs((prev) => Math.max(1, prev || 3));\n                        }\n                        setTimeout(() => legsRef.current?.focus(), 0);\n                      }}\n                      className=\"sr-only\"\n                    />{\" \"}\n                    {m === \"bestof\"\n                      ? \"Best Of\"\n                      : m === \"firstto\"\n                        ? \"First To\"\n                        : m === \"innings\"\n                          ? \"Innings\"\n                          : m === \"holes\"\n                            ? \"Holes\"\n                            : m === \"rounds\"\n                              ? \"Rounds\"\n                              : m === \"practice\"\n                                ? \"Practice\"\n                                : m}\n                  </label>\n                ),\n              )}\n            </div>\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-legs\"\n            >\n              {valueLabel}\n            </label>\n            <input\n              id=\"match-legs\"\n              type=\"number\"\n              min={1}\n              value={legs}\n              onChange={(e) =>\n                setLegs(Math.max(1, Number(e.target.value || 1)))\n              }\n              ref={legsRef}\n              className=\"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white\"\n            />\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-avg\"\n            >\n              Average Choice (Â±)\n            </label>\n            <input\n              id=\"match-avg\"\n              type=\"number\"\n              value={avgChoice}\n              onChange={(e) => setAvgChoice(Number(e.target.value || 0))}\n              className=\"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white\"\n            />\n          </div>\n        </div>\n        <div className=\"flex gap-2 mt-4 pt-3 border-t border-indigo-500/20\">\n          <button className=\"flex-1 btn btn-ghost text-xs\" onClick={onClose}>\n            Cancel\n          </button>\n          <button className=\"flex-1 btn text-xs\" onClick={handleCreate}>\n            Create Match\n          </button>\n        </div>\n      </div>\n    </div>,\n    portalEl,\n  );\n}\n","import React, {\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  useCallback,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport CameraTile from \"../CameraTile.js\";\nimport {\n  getAllTimeAvg,\n  getAllTimeFirstNineAvg,\n  getAllTimeBestCheckout,\n  getAllTimeBestLeg,\n  getAllTime,\n  getAllTime180s,\n  getHeadToHeadLegDiff,\n} from \"../../store/profileStats.js\";\nimport {\n  Target,\n  Trophy,\n  Zap,\n  Crown,\n  Timer,\n  ArrowRight,\n  X,\n  BarChart2,\n  Camera,\n} from \"lucide-react\";\n\n/* â”€â”€ Board constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst BOARD_SIZE = 400;\nconst CX = BOARD_SIZE / 2;\nconst CY = BOARD_SIZE / 2;\nconst BULL_INNER_R = 6.35;\nconst BULL_OUTER_R = 15.9;\nconst TREBLE_INNER_R = 99;\nconst TREBLE_OUTER_R = 107;\nconst DOUBLE_INNER_R = 162;\nconst DOUBLE_OUTER_R = 170;\nconst SCALE = (BOARD_SIZE / 2 - 15) / DOUBLE_OUTER_R;\n\nconst SECTOR_ORDER = [\n  20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5,\n];\n\nconst SECTOR_COLORS: Record<number, { dark: string; light: string }> = {};\nSECTOR_ORDER.forEach((s, i) => {\n  SECTOR_COLORS[s] =\n    i % 2 === 0\n      ? { dark: \"#1a1a2e\", light: \"#c0392b\" }\n      : { dark: \"#f0e6d3\", light: \"#27ae60\" };\n});\n\n/* â”€â”€ Types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nexport type MatchPrestartProps = {\n  open: boolean;\n  matchInfo: {\n    id: string;\n    game: string;\n    modeType: string;\n    legs: number;\n    startingScore?: number;\n    createdBy?: string;\n    creatorName?: string;\n  } | null;\n  localUser: { username: string; email?: string; [k: string]: any } | null;\n  opponentName: string;\n  opponentStats?: {\n    avg3?: string;\n    best9?: string;\n    bestCheckout?: string | number;\n    bestLeg?: string | number;\n    career180s?: number;\n  } | null;\n  countdown?: number;\n  onChoice: (choice: \"bull\" | \"skip\") => void;\n  onBullThrow: (distanceMm: number) => void;\n  onAccept: () => void;\n  onCancel: () => void;\n  /** Remote player's choice */\n  remoteChoice?: \"bull\" | \"skip\" | null;\n  /** Whether the bull-up phase is active (server confirmed both chose bull) */\n  bullActive?: boolean;\n  /** Winner of the bull-up (username) */\n  bullWinner?: string | null;\n  /** Whether the bull-up tied (another round) */\n  bullTied?: boolean;\n};\n\n/* â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction getPlayerStats(name: string) {\n  try {\n    const avg3 = getAllTimeAvg(name).toFixed(1);\n    const best9 = getAllTimeFirstNineAvg(name).toFixed(1);\n    const bestCheckout = getAllTimeBestCheckout(name);\n    const bestLeg = getAllTimeBestLeg(name);\n    const all = getAllTime(name);\n    const career180s = getAllTime180s(name);\n    return {\n      avg3,\n      best9,\n      bestCheckout: bestCheckout || \"â€“\",\n      bestLeg: bestLeg || \"â€“\",\n      lifetimeScored: all.scored || 0,\n      lifetimeDarts: all.darts || 0,\n      career180s: career180s || 0,\n    };\n  } catch {\n    return {\n      avg3: \"0.0\",\n      best9: \"0.0\",\n      bestCheckout: \"â€“\",\n      bestLeg: \"â€“\",\n      lifetimeScored: 0,\n      lifetimeDarts: 0,\n      career180s: 0,\n    };\n  }\n}\n\nfunction polarToXY(cx: number, cy: number, r: number, angleDeg: number) {\n  const rad = ((angleDeg - 90) * Math.PI) / 180;\n  return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };\n}\n\nfunction distFromBull(x: number, y: number): number {\n  const dx = x - CX;\n  const dy = y - CY;\n  return Math.sqrt(dx * dx + dy * dy) / SCALE;\n}\n\n/* â”€â”€ Stat pill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction StatPill({\n  label,\n  value,\n  highlight,\n}: {\n  label: string;\n  value: string | number;\n  highlight?: boolean;\n}) {\n  return (\n    <div\n      className={`flex flex-col items-center px-1.5 py-1 rounded-lg ${highlight ? \"bg-indigo-500/20 ring-1 ring-indigo-500/30\" : \"bg-white/5\"}`}\n    >\n      <span className=\"text-[7px] sm:text-[8px] uppercase tracking-wider font-bold text-white/50\">\n        {label}\n      </span>\n      <span\n        className={`text-xs sm:text-sm font-black ${highlight ? \"text-indigo-300\" : \"text-white\"}`}\n      >\n        {value}\n      </span>\n    </div>\n  );\n}\n\n/* â”€â”€ Interactive dartboard SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction DartboardBullUp({\n  onSelect,\n  selectedPoint,\n  disabled,\n  label,\n}: {\n  onSelect: (x: number, y: number, distMm: number) => void;\n  selectedPoint: { x: number; y: number } | null;\n  disabled?: boolean;\n  label?: string;\n}) {\n  const svgRef = useRef<SVGSVGElement>(null);\n\n  const coordsFromEvent = useCallback((clientX: number, clientY: number) => {\n    const svg = svgRef.current;\n    if (!svg) return null;\n    const rect = svg.getBoundingClientRect();\n    const x = ((clientX - rect.left) / rect.width) * BOARD_SIZE;\n    const y = ((clientY - rect.top) / rect.height) * BOARD_SIZE;\n    const dist = distFromBull(x, y);\n    return { x, y, dist: Math.round(dist * 10) / 10 };\n  }, []);\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent<SVGSVGElement>) => {\n      if (disabled) return;\n      const c = coordsFromEvent(e.clientX, e.clientY);\n      if (c) onSelect(c.x, c.y, c.dist);\n    },\n    [onSelect, disabled, coordsFromEvent],\n  );\n\n  const handleTouch = useCallback(\n    (e: React.TouchEvent<SVGSVGElement>) => {\n      if (disabled) return;\n      e.preventDefault();\n      const touch = e.changedTouches[0];\n      if (!touch) return;\n      const c = coordsFromEvent(touch.clientX, touch.clientY);\n      if (c) onSelect(c.x, c.y, c.dist);\n    },\n    [onSelect, disabled, coordsFromEvent],\n  );\n\n  // Build sector paths\n  const sectorPaths = useMemo(() => {\n    const paths: React.ReactNode[] = [];\n    const degPerSector = 18;\n\n    for (let i = 0; i < 20; i++) {\n      const sector = SECTOR_ORDER[i];\n      const startAngle = i * degPerSector - degPerSector / 2;\n      const endAngle = startAngle + degPerSector;\n      const colors = SECTOR_COLORS[sector];\n\n      // Each sector has: outer single, double, inner single, treble\n      const rings = [\n        {\n          inner: TREBLE_OUTER_R,\n          outer: DOUBLE_INNER_R,\n          fill: colors.dark,\n        },\n        {\n          inner: DOUBLE_INNER_R,\n          outer: DOUBLE_OUTER_R,\n          fill: colors.light,\n        },\n        {\n          inner: BULL_OUTER_R,\n          outer: TREBLE_INNER_R,\n          fill: colors.dark,\n        },\n        {\n          inner: TREBLE_INNER_R,\n          outer: TREBLE_OUTER_R,\n          fill: colors.light,\n        },\n      ];\n\n      rings.forEach((ring, ri) => {\n        const r1 = ring.inner * SCALE;\n        const r2 = ring.outer * SCALE;\n        const p1 = polarToXY(CX, CY, r1, startAngle);\n        const p2 = polarToXY(CX, CY, r2, startAngle);\n        const p3 = polarToXY(CX, CY, r2, endAngle);\n        const p4 = polarToXY(CX, CY, r1, endAngle);\n        const largeArc = degPerSector > 180 ? 1 : 0;\n        const d = [\n          `M ${p1.x} ${p1.y}`,\n          `L ${p2.x} ${p2.y}`,\n          `A ${r2} ${r2} 0 ${largeArc} 1 ${p3.x} ${p3.y}`,\n          `L ${p4.x} ${p4.y}`,\n          `A ${r1} ${r1} 0 ${largeArc} 0 ${p1.x} ${p1.y}`,\n          \"Z\",\n        ].join(\" \");\n        paths.push(\n          <path\n            key={`s${sector}-r${ri}`}\n            d={d}\n            fill={ring.fill}\n            stroke=\"rgba(255,255,255,0.08)\"\n            strokeWidth={0.5}\n            opacity={0.85}\n          />,\n        );\n      });\n\n      // Number label\n      const labelPos = polarToXY(\n        CX,\n        CY,\n        (DOUBLE_OUTER_R + 12) * SCALE,\n        i * degPerSector,\n      );\n      paths.push(\n        <text\n          key={`label-${sector}`}\n          x={labelPos.x}\n          y={labelPos.y}\n          textAnchor=\"middle\"\n          dominantBaseline=\"central\"\n          fill=\"rgba(255,255,255,0.8)\"\n          fontSize=\"11\"\n          fontWeight=\"bold\"\n          fontFamily=\"system-ui, sans-serif\"\n        >\n          {sector}\n        </text>,\n      );\n    }\n\n    return paths;\n  }, []);\n\n  return (\n    <div className=\"relative\">\n      {label && (\n        <div className=\"text-center mb-2\">\n          <span\n            className={`text-xs font-bold uppercase tracking-widest ${\n              disabled && selectedPoint ? \"text-emerald-400\" : \"text-white/50\"\n            }`}\n          >\n            {label}\n          </span>\n        </div>\n      )}\n      <svg\n        ref={svgRef}\n        viewBox={`0 0 ${BOARD_SIZE} ${BOARD_SIZE}`}\n        className={`w-full h-full touch-none select-none ${\n          disabled ? \"pointer-events-none\" : \"cursor-crosshair\"\n        }`}\n        style={{ opacity: disabled && !selectedPoint ? 0.5 : 1 }}\n        onClick={handleClick}\n        onTouchEnd={handleTouch}\n      >\n        {/* Background */}\n        <circle cx={CX} cy={CY} r={CX} fill=\"#0a0a1a\" />\n\n        {/* Sector paths */}\n        {sectorPaths}\n\n        {/* Wire rings for realism */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={TREBLE_INNER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={TREBLE_OUTER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={DOUBLE_INNER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={DOUBLE_OUTER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={1}\n        />\n\n        {/* Bull outer (green) */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={BULL_OUTER_R * SCALE}\n          fill=\"#27ae60\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={0.8}\n        />\n        {/* Bull inner (red) */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={BULL_INNER_R * SCALE}\n          fill=\"#c0392b\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={0.8}\n        />\n\n        {/* Pulsing bullseye guide when no dart placed */}\n        {!selectedPoint && !disabled && (\n          <circle\n            cx={CX}\n            cy={CY}\n            r={BULL_OUTER_R * SCALE * 1.8}\n            fill=\"none\"\n            stroke=\"rgba(234,179,8,0.4)\"\n            strokeWidth={1.5}\n            strokeDasharray=\"4,4\"\n          >\n            <animate\n              attributeName=\"r\"\n              values={`${BULL_OUTER_R * SCALE * 1.5};${BULL_OUTER_R * SCALE * 2.2};${BULL_OUTER_R * SCALE * 1.5}`}\n              dur=\"2s\"\n              repeatCount=\"indefinite\"\n            />\n            <animate\n              attributeName=\"opacity\"\n              values=\"0.5;0.15;0.5\"\n              dur=\"2s\"\n              repeatCount=\"indefinite\"\n            />\n          </circle>\n        )}\n\n        {/* Crosshair at center */}\n        <line\n          x1={CX - 6}\n          y1={CY}\n          x2={CX + 6}\n          y2={CY}\n          stroke=\"rgba(255,255,255,0.25)\"\n          strokeWidth={0.5}\n        />\n        <line\n          x1={CX}\n          y1={CY - 6}\n          x2={CX}\n          y2={CY + 6}\n          stroke=\"rgba(255,255,255,0.25)\"\n          strokeWidth={0.5}\n        />\n\n        {/* Selected dart position */}\n        {selectedPoint && (\n          <>\n            {/* Line from bull to dart */}\n            <line\n              x1={CX}\n              y1={CY}\n              x2={selectedPoint.x}\n              y2={selectedPoint.y}\n              stroke={disabled ? \"rgba(34,197,94,0.6)\" : \"rgba(234,179,8,0.5)\"}\n              strokeWidth={1}\n              strokeDasharray=\"3,3\"\n            />\n            {/* Dart shadow */}\n            <circle\n              cx={selectedPoint.x + 1}\n              cy={selectedPoint.y + 1}\n              r={6}\n              fill=\"rgba(0,0,0,0.4)\"\n            />\n            {/* Dart marker - green when locked, yellow when editable */}\n            <circle\n              cx={selectedPoint.x}\n              cy={selectedPoint.y}\n              r={6}\n              fill={disabled ? \"#22c55e\" : \"#eab308\"}\n              stroke=\"#fff\"\n              strokeWidth={2}\n              className=\"drop-shadow-lg\"\n            />\n            <circle\n              cx={selectedPoint.x}\n              cy={selectedPoint.y}\n              r={2.5}\n              fill=\"#fff\"\n            />\n            {/* Lock icon indicator when locked */}\n            {disabled && (\n              <text\n                x={selectedPoint.x}\n                y={selectedPoint.y - 14}\n                textAnchor=\"middle\"\n                fill=\"#22c55e\"\n                fontSize=\"10\"\n                fontWeight=\"bold\"\n              >\n                ğŸ”’\n              </text>\n            )}\n          </>\n        )}\n      </svg>\n    </div>\n  );\n}\n\n/* â”€â”€ Player Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction PlayerCard({\n  name,\n  stats,\n  isLocal,\n  showCamera,\n  isWinner,\n  legDiff,\n}: {\n  name: string;\n  stats: ReturnType<typeof getPlayerStats>;\n  isLocal: boolean;\n  showCamera?: boolean;\n  isWinner?: boolean;\n  legDiff?: number | null;\n}) {\n  const legDiffValue =\n    typeof legDiff === \"number\" ? `${legDiff > 0 ? \"+\" : \"\"}${legDiff}` : null;\n  return (\n    <div\n      className={`relative rounded-xl border p-2 sm:p-3 transition-all duration-500 ${\n        isWinner\n          ? \"border-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/5 shadow-xl shadow-amber-500/10 ring-1 ring-amber-400/30\"\n          : \"border-white/10 bg-white/5\"\n      }`}\n    >\n      {isWinner && (\n        <div className=\"absolute -top-2.5 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-amber-500 text-black text-[9px] font-black uppercase tracking-widest rounded-full shadow-lg\">\n          <Crown className=\"w-2.5 h-2.5 inline mr-0.5\" />\n          Throws First\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"flex items-center gap-2 mb-2\">\n        <div\n          className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-black ${\n            isLocal\n              ? \"bg-gradient-to-br from-indigo-500 to-purple-600 text-white\"\n              : \"bg-gradient-to-br from-rose-500 to-orange-500 text-white\"\n          }`}\n        >\n          {name.substring(0, 2).toUpperCase()}\n        </div>\n        <div>\n          <div className=\"font-bold text-white text-sm sm:text-base tracking-tight\">\n            {name}\n          </div>\n          <div className=\"text-[9px] text-white/50 font-semibold uppercase tracking-wider\">\n            {isLocal ? \"You\" : \"Opponent\"}\n          </div>\n        </div>\n      </div>\n\n      {/* Stats grid */}\n      <div className=\"grid grid-cols-4 gap-1 mb-2\">\n        <StatPill label=\"Avg\" value={stats.avg3} highlight />\n        <StatPill label=\"F9\" value={stats.best9} />\n        <StatPill label=\"CO\" value={String(stats.bestCheckout)} />\n        <StatPill label=\"Leg Diff\" value={legDiffValue ?? \"0\"} />\n      </div>\n\n      <div className=\"grid grid-cols-3 gap-1 text-[9px]\">\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">180s</span>\n          <span className=\"font-bold text-white\">{stats.career180s}</span>\n        </div>\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">Scored</span>\n          <span className=\"font-bold text-white\">\n            {stats.lifetimeScored.toLocaleString()}\n          </span>\n        </div>\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">Darts</span>\n          <span className=\"font-bold text-white\">\n            {stats.lifetimeDarts.toLocaleString()}\n          </span>\n        </div>\n      </div>\n\n      {/* Camera preview */}\n      {showCamera && (\n        <div className=\"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/40\">\n          <div className=\"px-2 py-1 flex items-center gap-1.5 text-[9px] text-white/60 border-b border-white/5\">\n            <Camera className=\"w-2.5 h-2.5\" />\n            <span className=\"font-semibold uppercase tracking-wider\">\n              {isLocal ? \"Your Camera\" : \"Opponent Camera\"}\n            </span>\n            <span className=\"ml-auto text-emerald-400 font-bold\">â— Live</span>\n          </div>\n          <div className=\"aspect-video relative bg-black\">\n            {isLocal ? (\n              <CameraTile\n                autoStart\n                forceAutoStart\n                fill\n                aspect=\"free\"\n                tileFitModeOverride=\"fit\"\n                scale={1}\n              />\n            ) : (\n              <div className=\"w-full h-full flex items-center justify-center text-white/30 text-[10px]\">\n                <div className=\"text-center\">\n                  <Camera className=\"w-6 h-6 mx-auto mb-1 opacity-30\" />\n                  Waiting for opponent's feedâ€¦\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n/* â”€â”€ Main Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nexport default function MatchPrestart({\n  open,\n  matchInfo,\n  localUser,\n  opponentName,\n  opponentStats,\n  countdown = 15,\n  onChoice,\n  onBullThrow,\n  onAccept,\n  onCancel,\n  remoteChoice,\n  bullActive,\n  bullWinner,\n  bullTied,\n}: MatchPrestartProps) {\n  const [seconds, setSeconds] = useState(countdown);\n  const [phase, setPhase] = useState<\n    \"preview\" | \"choice\" | \"bull\" | \"result\" | \"go\"\n  >(\"preview\");\n  const [localChoice, setLocalChoice] = useState<\"bull\" | \"skip\" | null>(null);\n  const [dartPoint, setDartPoint] = useState<{ x: number; y: number } | null>(\n    null,\n  );\n  const [dartDistMm, setDartDistMm] = useState<number | null>(null);\n  const [dartLocked, setDartLocked] = useState(false); // Lock dart position after first tap\n  const [dartSubmitted, setDartSubmitted] = useState(false);\n  const portalElRef = useRef<HTMLElement | null>(\n    typeof document !== \"undefined\" ? document.createElement(\"div\") : null,\n  );\n\n  const localStats = useMemo(\n    () => getPlayerStats(localUser?.username || \"\"),\n    [localUser?.username],\n  );\n  const oppStats = useMemo(() => {\n    if (opponentStats) {\n      return {\n        avg3: opponentStats.avg3 || \"0.0\",\n        best9: opponentStats.best9 || \"0.0\",\n        bestCheckout: opponentStats.bestCheckout || \"â€“\",\n        bestLeg: opponentStats.bestLeg || \"â€“\",\n        career180s: opponentStats.career180s || 0,\n        lifetimeScored: 0,\n        lifetimeDarts: 0,\n      };\n    }\n    return getPlayerStats(opponentName);\n  }, [opponentName, opponentStats]);\n\n  // Portal\n  useEffect(() => {\n    const el = portalElRef.current;\n    if (!el || typeof document === \"undefined\") return;\n    el.className = \"ndn-match-prestart-portal\";\n    document.body.appendChild(el);\n    return () => {\n      try {\n        el.parentNode?.removeChild(el);\n      } catch {}\n    };\n  }, []);\n\n  // Countdown timer\n  useEffect(() => {\n    if (!open) return;\n    setSeconds(countdown);\n    setPhase(\"preview\");\n    setLocalChoice(null);\n    setDartPoint(null);\n    setDartDistMm(null);\n    setDartLocked(false);\n    setDartSubmitted(false);\n  }, [open, countdown]);\n\n  useEffect(() => {\n    if (!open || phase === \"result\" || phase === \"go\") return;\n    const id = window.setInterval(() => {\n      setSeconds((s) => {\n        const next = s - 1;\n        if (next <= 0) {\n          window.clearInterval(id);\n          // Auto-transition based on phase\n          if (phase === \"preview\") {\n            setPhase(\"choice\");\n            return countdown;\n          }\n          if (phase === \"choice\" && !localChoice) {\n            // Time ran out without choosing â†’ auto-skip\n            setLocalChoice(\"skip\");\n            onChoice(\"skip\");\n          }\n          return 0;\n        }\n        // After 5 seconds of preview, move to choice automatically\n        if (phase === \"preview\" && countdown - next >= 5) {\n          setPhase(\"choice\");\n        }\n        return next;\n      });\n    }, 1000);\n    return () => window.clearInterval(id);\n  }, [open, phase, countdown, localChoice, onChoice]);\n\n  // React to bull-up activation from server\n  useEffect(() => {\n    if (bullActive) {\n      setPhase(\"bull\");\n      setDartPoint(null);\n      setDartDistMm(null);\n      setDartLocked(false);\n      setDartSubmitted(false);\n    }\n  }, [bullActive]);\n\n  // React to bull winner\n  useEffect(() => {\n    if (bullWinner) {\n      setPhase(\"result\");\n      // After 3 seconds, show \"GO\"\n      const t = setTimeout(() => setPhase(\"go\"), 3000);\n      return () => clearTimeout(t);\n    }\n  }, [bullWinner]);\n\n  // React to bull tied â€” reset for another round\n  useEffect(() => {\n    if (bullTied) {\n      setDartPoint(null);\n      setDartDistMm(null);\n      setDartLocked(false);\n      setDartSubmitted(false);\n      setPhase(\"bull\");\n    }\n  }, [bullTied]);\n\n  // When both skip, go directly\n  useEffect(() => {\n    if (localChoice === \"skip\" && remoteChoice === \"skip\") {\n      setPhase(\"result\");\n      const t = setTimeout(() => setPhase(\"go\"), 2000);\n      return () => clearTimeout(t);\n    }\n  }, [localChoice, remoteChoice]);\n\n  // Auto-accept when \"go\" phase completes\n  useEffect(() => {\n    if (phase !== \"go\") return;\n    const t = setTimeout(() => {\n      onAccept();\n    }, 1500);\n    return () => clearTimeout(t);\n  }, [phase, onAccept]);\n\n  const handleDartSelect = useCallback(\n    (x: number, y: number, distMm: number) => {\n      // Once a dart is placed, lock it - no further changes allowed\n      if (dartLocked) return;\n      setDartPoint({ x, y });\n      setDartDistMm(distMm);\n      setDartLocked(true); // Lock immediately after first placement\n    },\n    [dartLocked],\n  );\n\n  const handleSubmitDart = useCallback(() => {\n    if (dartDistMm == null) return;\n    setDartSubmitted(true);\n    onBullThrow(dartDistMm);\n  }, [dartDistMm, onBullThrow]);\n\n  const handleChoice = useCallback(\n    (c: \"bull\" | \"skip\") => {\n      setLocalChoice(c);\n      onChoice(c);\n    },\n    [onChoice],\n  );\n\n  const localName = localUser?.username || \"You\";\n  const headToHead = useMemo(\n    () => getHeadToHeadLegDiff(localName, opponentName),\n    [localName, opponentName],\n  );\n  const localLegDiff = headToHead.played ? headToHead.diffA : null;\n  const opponentLegDiff = headToHead.played ? headToHead.diffB : null;\n\n  if (!open || !portalElRef.current || !matchInfo) return null;\n\n  const isLocalWinner = bullWinner === localName;\n  const isOpponentWinner = bullWinner === opponentName;\n  const bothSkipped = localChoice === \"skip\" && remoteChoice === \"skip\";\n\n  const overlay = (\n    <div\n      className=\"fixed inset-0 z-[9998] bg-black/95 backdrop-blur-xl flex flex-col\"\n      style={{ height: \"100dvh\", maxHeight: \"100dvh\", overflow: \"hidden\" }}\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Match pre-start\"\n    >\n      {/* Decorative background */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[120px]\" />\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px]\" />\n        <div className=\"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent\" />\n      </div>\n\n      <div className=\"flex-1 flex items-center justify-center p-2 sm:p-4 min-h-0\">\n        <div className=\"relative w-full max-w-5xl max-h-full flex flex-col\">\n          {/* Close button */}\n          <button\n            className=\"absolute -top-2 -right-2 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition-all border border-white/10\"\n            onClick={onCancel}\n            aria-label=\"Cancel match\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n\n          {/* Match info header */}\n          <div className=\"text-center mb-2 sm:mb-4 flex-shrink-0\">\n            <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] sm:text-[11px] font-bold uppercase tracking-widest text-white/60 mb-2\">\n              <Target className=\"w-3 h-3\" />\n              {matchInfo.game} Â·{\" \"}\n              {matchInfo.modeType === \"bestof\" ? \"Best Of\" : \"First To\"}{\" \"}\n              {matchInfo.legs} Â· {matchInfo.startingScore || 501}\n            </div>\n\n            {phase === \"preview\" && (\n              <div className=\"animate-in fade-in duration-500\">\n                <h2 className=\"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tighter\">\n                  Match Found\n                </h2>\n                <p className=\"text-xs sm:text-sm text-white/50 mt-0.5\">\n                  Reviewing opponent statsâ€¦\n                </p>\n              </div>\n            )}\n\n            {phase === \"choice\" && (\n              <div className=\"animate-in fade-in duration-500\">\n                <h2 className=\"text-2xl sm:text-3xl font-black text-white tracking-tighter\">\n                  Who Throws First?\n                </h2>\n                <p className=\"text-xs sm:text-sm text-white/50 mt-0.5\">\n                  Bull up to decide, or skip and let the creator go first\n                </p>\n              </div>\n            )}\n\n            {phase === \"bull\" && (\n              <div className=\"animate-in fade-in duration-500\">\n                <h2 className=\"text-2xl sm:text-3xl font-black text-amber-300 tracking-tighter\">\n                  ğŸ¯ Bull Up!\n                </h2>\n                <p className=\"text-[10px] sm:text-xs text-white/50 mt-0.5\">\n                  Throw your dart at the bullseye, then tap where it landed on\n                  the board\n                </p>\n                <p className=\"text-[9px] text-white/30\">\n                  Both players mark their throw â€” closest to the bull throws\n                  first\n                </p>\n              </div>\n            )}\n\n            {phase === \"result\" && (\n              <div className=\"animate-in fade-in zoom-in-95 duration-700\">\n                {bullWinner ? (\n                  <>\n                    <h2 className=\"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-amber-500 tracking-tighter\">\n                      ğŸ‰ {bullWinner} Wins the Bull!\n                    </h2>\n                    <p className=\"text-xs sm:text-sm text-white/50 mt-1\">\n                      {bullWinner} throws first\n                    </p>\n                  </>\n                ) : bothSkipped ? (\n                  <>\n                    <h2 className=\"text-2xl sm:text-3xl font-black text-white tracking-tighter\">\n                      Both Players Skipped\n                    </h2>\n                    <p className=\"text-xs sm:text-sm text-white/50 mt-0.5\">\n                      {matchInfo.createdBy ||\n                        matchInfo.creatorName ||\n                        localName}{\" \"}\n                      throws first\n                    </p>\n                  </>\n                ) : null}\n              </div>\n            )}\n\n            {phase === \"go\" && (\n              <div className=\"animate-in fade-in zoom-in-50 duration-300\">\n                <h2 className=\"text-5xl sm:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500 tracking-tighter\">\n                  GO!\n                </h2>\n              </div>\n            )}\n          </div>\n\n          {/* Timer bar */}\n          {phase !== \"result\" && phase !== \"go\" && (\n            <div className=\"mb-2 sm:mb-4 flex-shrink-0\">\n              <div className=\"flex items-center justify-center gap-2 mb-1\">\n                <Timer className=\"w-3 h-3 sm:w-4 sm:h-4 text-white/40\" />\n                <span className=\"text-xl sm:text-2xl font-black text-white tabular-nums\">\n                  {seconds}\n                </span>\n                <span className=\"text-[10px] sm:text-xs text-white/40 font-semibold\">\n                  seconds\n                </span>\n              </div>\n              <div className=\"h-0.5 sm:h-1 bg-white/5 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000 ease-linear\"\n                  style={{\n                    width: `${(seconds / countdown) * 100}%`,\n                  }}\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Player cards + VS */}\n          {(phase === \"preview\" ||\n            phase === \"choice\" ||\n            phase === \"result\") && (\n            <div className=\"grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-2 sm:gap-4 items-start mb-2 sm:mb-4 flex-shrink-0\">\n              <PlayerCard\n                name={localName}\n                stats={localStats}\n                isLocal\n                showCamera={phase === \"preview\"}\n                legDiff={localLegDiff}\n                isWinner={\n                  phase === \"result\" &&\n                  (isLocalWinner ||\n                    (bothSkipped &&\n                      (matchInfo.createdBy === localName ||\n                        matchInfo.creatorName === localName)))\n                }\n              />\n\n              {/* VS divider */}\n              <div className=\"hidden md:flex flex-col items-center justify-center py-8\">\n                <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-indigo-500/30 ring-2 ring-white/10\">\n                  VS\n                </div>\n                <div className=\"w-px h-12 bg-gradient-to-b from-indigo-500/30 to-transparent mt-2\" />\n              </div>\n              <div className=\"flex md:hidden items-center justify-center py-2\">\n                <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-xl shadow-indigo-500/30\">\n                  VS\n                </div>\n              </div>\n\n              <PlayerCard\n                name={opponentName}\n                stats={oppStats}\n                isLocal={false}\n                showCamera={phase === \"preview\"}\n                legDiff={opponentLegDiff}\n                isWinner={\n                  phase === \"result\" &&\n                  (isOpponentWinner ||\n                    (bothSkipped &&\n                      (matchInfo.createdBy === opponentName ||\n                        matchInfo.creatorName === opponentName)))\n                }\n              />\n            </div>\n          )}\n\n          {/* Choice phase */}\n          {phase === \"choice\" && !localChoice && (\n            <div className=\"flex flex-col items-center gap-3 animate-in fade-in slide-in-from-bottom-4 duration-500 flex-shrink-0\">\n              <div className=\"flex gap-3\">\n                <button\n                  className=\"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 text-white font-black text-base sm:text-lg hover:shadow-xl hover:shadow-amber-500/30 hover:scale-105 transition-all duration-200 border border-amber-400/30\"\n                  onClick={() => handleChoice(\"bull\")}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    <Target className=\"w-5 h-5\" />\n                    <span>Bull Up</span>\n                  </div>\n                  <div className=\"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-80\">\n                    Throw at the bullseye to decide\n                  </div>\n                </button>\n\n                <button\n                  className=\"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-white/5 border border-white/10 text-white font-bold text-base sm:text-lg hover:bg-white/10 hover:border-white/20 hover:scale-105 transition-all duration-200\"\n                  onClick={() => handleChoice(\"skip\")}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    <ArrowRight className=\"w-5 h-5\" />\n                    <span>Skip</span>\n                  </div>\n                  <div className=\"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-50\">\n                    Creator throws first\n                  </div>\n                </button>\n              </div>\n            </div>\n          )}\n\n          {/* Choice made â€” waiting */}\n          {phase === \"choice\" && localChoice && !bullActive && (\n            <div className=\"text-center animate-in fade-in duration-300\">\n              <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-white/70\">\n                <Zap className=\"w-4 h-4 text-amber-400\" />\n                You chose{\" \"}\n                <span className=\"font-bold text-white\">\n                  {localChoice === \"bull\" ? \"Bull Up\" : \"Skip\"}\n                </span>\n                {remoteChoice ? (\n                  <>\n                    {\" \"}\n                    Â· Opponent chose{\" \"}\n                    <span className=\"font-bold text-white\">\n                      {remoteChoice === \"bull\" ? \"Bull Up\" : \"Skip\"}\n                    </span>\n                  </>\n                ) : (\n                  <>\n                    {\" \"}\n                    Â· Waiting for opponent\n                    <span className=\"animate-pulse\">â€¦</span>\n                  </>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Bull-up phase â€” camera feed + dartboard */}\n          {phase === \"bull\" && (\n            <div className=\"flex flex-col items-center gap-2 sm:gap-3 animate-in fade-in zoom-in-95 duration-500 flex-1 min-h-0 overflow-hidden\">\n              {/* Live camera feed so the player can see their dart on the board */}\n              <div className=\"w-full max-w-[280px] sm:max-w-sm mx-auto rounded-xl border border-white/10 bg-black/60 overflow-hidden shadow-xl shadow-black/40 flex-shrink-0\">\n                <div className=\"relative aspect-[16/10]\">\n                  <CameraTile\n                    autoStart\n                    forceAutoStart\n                    fill\n                    aspect=\"free\"\n                    className=\"w-full h-full\"\n                  />\n                  <div className=\"absolute top-1 left-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-black/60 backdrop-blur-sm border border-white/10\">\n                    <Camera className=\"w-2.5 h-2.5 text-emerald-400\" />\n                    <span className=\"text-[9px] font-bold text-white/80 uppercase tracking-wider\">\n                      Live Feed\n                    </span>\n                  </div>\n                  <div className=\"absolute top-1 right-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30\">\n                    <span className=\"text-[9px] font-bold text-emerald-400\">\n                      â— LIVE\n                    </span>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-1.5 text-[10px] sm:text-xs text-white/50 flex-shrink-0\">\n                <Target className=\"w-3 h-3 text-amber-400\" />\n                <span>\n                  See your dart above, then tap the board below where it landed\n                </span>\n              </div>\n\n              {/* Interactive dartboard for marking position */}\n              <div className=\"w-full max-w-[240px] sm:max-w-[280px] md:max-w-xs mx-auto rounded-xl border border-white/10 bg-black/40 p-2 sm:p-3 shadow-2xl shadow-black/50 flex-1 min-h-0\">\n                <DartboardBullUp\n                  onSelect={handleDartSelect}\n                  selectedPoint={dartPoint}\n                  disabled={dartLocked || dartSubmitted}\n                  label={\n                    dartLocked\n                      ? \"Dart position locked\"\n                      : \"Tap where your dart landed\"\n                  }\n                />\n              </div>\n\n              {/* Distance readout + button row */}\n              <div className=\"flex flex-wrap items-center justify-center gap-2 sm:gap-3 flex-shrink-0\">\n                {dartDistMm != null && (\n                  <div className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-xl bg-white/5 border border-white/10 animate-in fade-in duration-300\">\n                    <Target className=\"w-4 h-4 text-amber-400\" />\n                    <span className=\"text-xl font-black text-white tabular-nums\">\n                      {dartDistMm.toFixed(1)}\n                    </span>\n                    <span className=\"text-sm text-white/50\">mm</span>\n                  </div>\n                )}\n\n                {/* Confirm / Waiting */}\n                {!dartSubmitted ? (\n                  <button\n                    className=\"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-emerald-500/30 hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:pointer-events-none border border-emerald-400/30\"\n                    disabled={dartDistMm == null}\n                    onClick={handleSubmitDart}\n                  >\n                    âœ… Confirm\n                  </button>\n                ) : (\n                  <div className=\"flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-xs text-white/70\">\n                    <div className=\"w-3 h-3 border-2 border-amber-400/30 border-t-amber-400 rounded-full animate-spin\" />\n                    Waiting for opponentâ€¦\n                  </div>\n                )}\n              </div>\n\n              {bullTied && (\n                <div className=\"text-xs text-amber-300 font-bold animate-bounce px-3 py-1.5 rounded-lg bg-amber-500/10 border border-amber-500/20 flex-shrink-0\">\n                  ğŸ”„ It's a tie! Throw again.\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Accept / Cancel row (for preview phase) */}\n          {phase === \"preview\" && (\n            <div className=\"flex items-center justify-center gap-2 sm:gap-3 mt-2 sm:mt-4 flex-shrink-0\">\n              <button\n                className=\"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-indigo-500/30 hover:scale-105 transition-all\"\n                onClick={() => setPhase(\"choice\")}\n              >\n                Ready â€” Continue\n              </button>\n              <button\n                className=\"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-white/5 border border-white/10 text-white/70 font-semibold text-sm sm:text-base hover:bg-white/10 transition-all\"\n                onClick={onCancel}\n              >\n                Cancel\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n\n  return createPortal(overlay, portalElRef.current);\n}\n","import React, { useState, useMemo, useEffect, useRef } from \"react\";\nimport {\n  Search,\n  Zap,\n  Target,\n  Trophy,\n  Users,\n  Clock,\n  ChevronDown,\n} from \"lucide-react\";\nimport { getGameDisplay } from \"../utils/games.js\";\nimport CreateMatchModal from \"./ui/CreateMatchModal.js\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase.js\";\nimport MatchPrestart from \"./ui/MatchPrestart.js\";\nimport InGameShell from \"./InGameShell.js\";\nimport { useMatch } from \"../store/match.js\";\nimport { useMatchControl } from \"../store/matchControl.js\";\nimport { useWS } from \"./WSProvider.js\";\nimport { launchInPlayDemo } from \"../utils/inPlayDemo.js\";\nimport { openMatchWindow } from \"../utils/matchWindow.js\";\n\nexport default function OnlinePlayClean({ user }: { user?: any }) {\n  const username = user?.username || \"You\";\n  const [currentPageIdx, setCurrentPageIdx] = useState(0);\n  const [pages, setPages] = useState(() => [\n    { id: 1, name: \"page-1\", matches: [] as any[] },\n  ]);\n  const wsGlobal = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  const [serverMatches, setServerMatches] = useState<any[]>([]);\n  const inProgress = useMatch((s) => s.inProgress);\n  const matchContext = useMatch((s) => s.matchContext);\n  const players = useMatch((s) => s.players);\n  const [focusMode, setFocusMode] = useState(false);\n  const matchesRef = useRef<HTMLDivElement | null>(null);\n  const showDemoControls =\n    (import.meta as any).env?.DEV ||\n    String(user?.email || \"\").toLowerCase() === \"daviesfamily108@gmail.com\";\n\n  useEffect(() => {\n    if (!focusMode) return;\n    function onDocClick(e: MouseEvent) {\n      try {\n        if (!matchesRef.current) return;\n        if (!matchesRef.current.contains(e.target as Node)) {\n          setFocusMode(false);\n        }\n      } catch {}\n    }\n    document.addEventListener(\"mousedown\", onDocClick);\n    return () => document.removeEventListener(\"mousedown\", onDocClick);\n  }, [focusMode]);\n  const [showStartShowcase, setShowStartShowcase] = useState<boolean>(false);\n  const startedShowcasedRef = React.useRef(false);\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"online\") {\n      startedShowcasedRef.current = false;\n      setShowStartShowcase(false);\n      return;\n    }\n    if (startedShowcasedRef.current) return;\n    // Only show the showcase if the match hasn't progressed yet\n    const st = useMatch.getState();\n    const hasVisits = (st.players || []).some((p: any) =>\n      (p.legs || []).some((L: any) => (L.visits || []).length > 0),\n    );\n    if (hasVisits) return;\n    startedShowcasedRef.current = true;\n    setShowStartShowcase(true);\n  }, [inProgress, matchContext]);\n\n  // Auto-open the dedicated match window for online X01 matches.\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"online\") return;\n    try {\n      const st = useMatch.getState();\n      const game = ((st as any)?.game || \"X01\") as string;\n      if (game !== \"X01\") return;\n      if (!st.roomId) return;\n\n      const flagKey = `ndn:matchWindowOpened:${st.roomId}`;\n      if (window.sessionStorage.getItem(flagKey) === \"1\") return;\n      window.sessionStorage.setItem(flagKey, \"1\");\n      openMatchWindow();\n    } catch {}\n  }, [inProgress, matchContext]);\n\n  // Allow the overlay to show again the next time a match starts.\n  useEffect(() => {\n    if (inProgress && matchContext === \"online\") return;\n    startedShowcasedRef.current = false;\n  }, [inProgress, matchContext]);\n\n  // Announce presence to server so it knows our username\n  useEffect(() => {\n    if (wsGlobal?.connected && user?.username) {\n      try {\n        wsGlobal.send({\n          type: \"presence\",\n          username: user.username,\n          email: user.email || \"\",\n        });\n      } catch {}\n    }\n  }, [wsGlobal?.connected, user]);\n\n  // Signal to App.tsx that OnlinePlay is mounted so it doesn't double-dispatch\n  // invite/prestart events (OnlinePlay's own WS listener handles them directly)\n  useEffect(() => {\n    (window as any).__ndn_online_mounted = true;\n    return () => {\n      (window as any).__ndn_online_mounted = false;\n    };\n  }, []);\n\n  // Global quit handler (from CameraView Quit / Pause modal)\n  useEffect(() => {\n    const onQuit = () => {\n      try {\n        useMatch.getState().endGame();\n      } catch (e) {}\n      // Clear all prestart / invite state to prevent phantom popups\n      setPendingInvite(null);\n      setWaitingForCreator(null);\n      setJoinMatch(null);\n      setJoinChoice(null);\n      setOpponentQuitName(null);\n      pendingMatchRef.current = null;\n      try {\n        (window as any).__ndn_pending_invite = null;\n      } catch {}\n    };\n    try {\n      window.addEventListener(\"ndn:match-quit\" as any, onQuit as any);\n    } catch {}\n    return () => {\n      try {\n        window.removeEventListener(\"ndn:match-quit\" as any, onQuit as any);\n      } catch {}\n    };\n  }, []);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [joinMatch, setJoinMatch] = useState<any | null>(null);\n  const joinAcceptRef = React.useRef<HTMLButtonElement | null>(null);\n  // Incoming invite popup: shown to the creator when a joiner wants to join\n  const [pendingInvite, setPendingInvite] = useState<any | null>(null);\n  // Waiting state: shown to the joiner while waiting for the creator to accept\n  const [waitingForCreator, setWaitingForCreator] = useState<string | null>(\n    null,\n  );\n  // Preserve match info across handleJoinAccept â†’ match-start gap\n  // (handleJoinAccept clears joinMatch before the server sends match-start)\n  const pendingMatchRef = useRef<any | null>(null);\n  const [_selfId, setSelfId] = useState<string | null>(null);\n  const [participants, setParticipants] = useState<Record<string, string>>({});\n  const [joinTimer, setJoinTimer] = useState(30);\n  // Keep latest matches in a ref so the WS listener can update synchronously\n  // for tests (avoids a stale closure / async state timing issue).\n  const serverMatchesRef = useRef<any[]>([]);\n  useEffect(() => {\n    serverMatchesRef.current = serverMatches || [];\n  }, [serverMatches]);\n  // Keep pendingMatchRef in sync with joinMatch so the WS listener\n  // (which has a stale closure over joinMatch) can always read current data.\n  useEffect(() => {\n    if (joinMatch) pendingMatchRef.current = { ...joinMatch };\n  }, [joinMatch]);\n  const serverPrestartRef = React.useRef(false);\n  const [joinChoice, setJoinChoice] = useState<null | \"bull\" | \"skip\">(null);\n  const [remoteChoices, setRemoteChoices] = useState<\n    Record<string, \"bull\" | \"skip\">\n  >({});\n  const [bullActive, setBullActive] = useState(false);\n  const [bullThrow, setBullThrow] = useState<number | null>(null);\n  const [bullWinner, setBullWinner] = useState<string | null>(null);\n  const [bullLocalThrow, setBullLocalThrow] = useState<number | null>(null);\n  const [bullThrown, setBullThrown] = useState(false);\n  const [bullTied, setBullTied] = useState(false);\n  // Opponent quit notification â€” shown when the remote player leaves mid-match\n  const [opponentQuitName, setOpponentQuitName] = useState<string | null>(null);\n  // Track the active game mode for the current match (e.g. 'X01', 'Cricket', 'Around the Clock')\n  const [currentGame, setCurrentGame] = useState<string>(\"X01\");\n  // Opponent camera frame (base64 JPEG snapshot relayed via WS)\n  const [opponentFrame, setOpponentFrame] = useState<string | null>(null);\n\n  // Filter & Sort State\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filterGame, setFilterGame] = useState<\n    \"all\" | \"x01\" | \"cricket\" | \"bermuda\" | \"gotcha\"\n  >(\"all\");\n  const [filterMode, setFilterMode] = useState<\"all\" | \"first_to\" | \"best_of\">(\n    \"all\",\n  );\n  const [sortBy, setSortBy] = useState<\"newest\" | \"oldest\">(\"newest\");\n\n  // Pagination State\n  const [currentPage, setCurrentPage] = useState(1);\n  const itemsPerPage = 12;\n\n  const currentPage_ = pages[currentPageIdx];\n  // NOTE: This is a *UX* hint for when to show a \"page is full\" message.\n  // We do not hard-cap rendering at this number (tests and pagination rely on\n  // the full list being renderable).\n  const maxMatchesPerPage = 999;\n\n  const normalizeMatch = React.useCallback((m: any) => {\n    if (!m) return m;\n    const modeType = m.modeType || m.mode || \"\";\n    const legs = m.legs ?? m.value ?? m.bestOf ?? m.sets ?? m.games ?? 1;\n    const createdBy = m.createdBy || m.creatorName || m.creator || m.host || \"\";\n    const createdAt = m.createdAt || m.ts || Date.now();\n\n    return {\n      ...m,\n      modeType,\n      mode: modeType || m.mode,\n      legs,\n      value: typeof m.value === \"number\" ? m.value : legs,\n      createdBy,\n      creatorName: m.creatorName || createdBy,\n      createdAt,\n    };\n  }, []);\n\n  const filterMatches = useMemo(() => {\n    return (list: any[] = []) =>\n      (list || [])\n        .map(normalizeMatch)\n        .filter(\n          (m: any) =>\n            !(\n              m?.isTest ||\n              m?.test ||\n              m?.migrated ||\n              m?.isMigration ||\n              m?.migration ||\n              m?.seeded ||\n              m?.status === \"completed\" ||\n              m?.status === \"played\" ||\n              (m?.declineCount && m.declineCount >= 3) ||\n              (typeof m?.createdBy === \"string\" &&\n                m.createdBy.toLowerCase().includes(\"test\")) ||\n              (typeof m?.creatorName === \"string\" &&\n                m.creatorName.toLowerCase().includes(\"test\")) ||\n              (typeof m?.createdBy === \"string\" &&\n                /^(alice-|host-|demo|dummy|sample)/i.test(m.createdBy)) ||\n              (typeof m?.creatorName === \"string\" &&\n                /^(alice-|host-|demo|dummy|sample)/i.test(m.creatorName)) ||\n              !(m?.game && m?.modeType && m?.legs)\n            ),\n        );\n    // NOTE: do NOT hard-cap here; tests and pagination expect the full\n    // list to render (page size controls how many are visible).\n  }, [normalizeMatch]);\n\n  // NOTE: worldLobby was previously used for an alternate lobby view; keep the\n  // computation removed to avoid unused-vars warnings.\n\n  // Combined matches: show only current page, filtered\n  const combinedMatches = useMemo(() => {\n    let all = filterMatches(currentPage_?.matches || []);\n\n    // In WS-driven mode, serverMatches is the canonical list. Fall back to it\n    // if the current room hasn't been hydrated yet.\n    if ((all?.length || 0) === 0 && (serverMatches?.length || 0) > 0) {\n      all = filterMatches(serverMatches);\n    }\n\n    // Last-resort fallback for test environments where state updates are\n    // async and the memo can run before serverMatches is visible.\n    if (\n      (all?.length || 0) === 0 &&\n      (serverMatchesRef.current?.length || 0) > 0\n    ) {\n      all = filterMatches(serverMatchesRef.current);\n    }\n\n    // 1. Search\n    if (searchQuery.trim()) {\n      const q = searchQuery.toLowerCase();\n      all = all.filter(\n        (m: any) =>\n          (m.game || \"\").toLowerCase().includes(q) ||\n          (m.createdBy || m.creatorName || \"\").toLowerCase().includes(q) ||\n          (m.id || \"\").toLowerCase().includes(q),\n      );\n    }\n\n    // 2. Filter Game\n    if (filterGame !== \"all\") {\n      all = all.filter((m: any) => (m.game || \"\").toLowerCase() === filterGame);\n    }\n\n    // 3. Filter Mode\n    if (filterMode !== \"all\") {\n      // normalize modeType. Some might be 'first_to' or 'bestof'\n      all = all.filter((m: any) => {\n        const mt = (m.modeType || \"\").replace(\"_\", \"\").toLowerCase(); // 'firstto', 'bestof'\n        const target = filterMode.replace(\"_\", \"\").toLowerCase();\n        return mt.includes(target);\n      });\n    }\n\n    // 4. Sort\n    all = (all || []).slice();\n    all.sort((a: any, b: any) => {\n      const tA = a.createdAt || 0;\n      const tB = b.createdAt || 0;\n      return sortBy === \"newest\" ? tB - tA : tA - tB;\n    });\n\n    return all.slice(0, maxMatchesPerPage);\n  }, [\n    currentPage_,\n    serverMatches,\n    filterMatches,\n    searchQuery,\n    filterGame,\n    filterMode,\n    sortBy,\n    maxMatchesPerPage,\n  ]);\n\n  // Reset page when filters change\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [searchQuery, filterGame, filterMode, sortBy, currentPageIdx]);\n\n  const totalPages = Math.ceil(combinedMatches.length / itemsPerPage);\n  const paginatedMatches = combinedMatches.slice(\n    (currentPage - 1) * itemsPerPage,\n    currentPage * itemsPerPage,\n  );\n\n  const handleQuickJoin = () => {\n    if (combinedMatches.length > 0) {\n      requestJoin(combinedMatches[0]);\n    }\n  };\n\n  const handleCreateMatch = (payload: any) => {\n    const newMatch = {\n      id: `m-${Date.now()}`,\n      createdBy: payload.createdBy || username,\n      game: payload.game,\n      modeType: payload.modeType,\n      legs: payload.legs,\n      startingScore: payload.startingScore,\n      createdAt: Date.now(),\n    };\n\n    // Only add optimistically if we are NOT connected to the server\n    // Otherwise, we wait for the server to broadcast the new match to avoid duplicates\n    if (!wsGlobal?.connected) {\n      setPages((prev) =>\n        prev.map((r, idx) =>\n          idx === currentPageIdx\n            ? { ...r, matches: [newMatch, ...r.matches] }\n            : r,\n        ),\n      );\n    }\n\n    // If we have a server WS connection, send a create-match message\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before creating match to guarantee correct attribution\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n\n        wsGlobal.send({\n          type: \"create-match\",\n          game: payload.game,\n          mode: payload.modeType,\n          value: payload.legs,\n          startingScore: payload.startingScore,\n          creatorAvg: payload.avgChoice || 0,\n        });\n      }\n    } catch {}\n  };\n\n  const newPage = () => {\n    setServerMatches([]);\n    setPages((prev) => {\n      const id = prev.length + 1;\n      const newPages = [...prev, { id, name: `page-${id}`, matches: [] }];\n      setCurrentPageIdx(newPages.length - 1);\n      return newPages;\n    });\n  };\n\n  // Shared handler for invite / prestart messages\n  const handleInviteOrPrestart = React.useCallback(\n    (msg: any) => {\n      try {\n        console.log(\"[OnlinePlay] handleInviteOrPrestart:\", msg?.type, msg);\n        if (msg?.type === \"invite\") {\n          // Creator receives an invite â€” show accept/decline popup\n          const inviteData = {\n            id: msg.matchId,\n            game: msg.game,\n            mode: msg.mode || \"firstto\",\n            value: msg.value || 1,\n            startingScore: msg.startingScore || 501,\n            fromName: msg.fromName || \"Opponent\",\n            fromId: msg.fromId,\n          };\n          setPendingInvite(inviteData);\n          // Play a notification sound if available\n          try {\n            const audio = new Audio(\"/sounds/notify.mp3\");\n            audio.volume = 0.5;\n            audio.play().catch(() => {});\n          } catch {}\n        }\n        if (msg?.type === \"invite-waiting\") {\n          // Joiner is waiting for the creator to accept\n          setWaitingForCreator(msg.creatorName || \"Creator\");\n        }\n        if (msg?.type === \"match-prestart\") {\n          // Ignore if a match is already running (prevents phantom prestart\n          // after quitting a match while a stale server message arrives)\n          if (useMatch.getState().inProgress) return;\n          // Both players enter prestart after creator accepted the invite\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          const m = normalizeMatch(msg.match || null);\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\n          // Determine if the local user is the creator so we can set the\n          // correct opponent name and send the right toId in handleJoinAccept\n          if (m) {\n            const localName = (user?.username || \"\").toLowerCase();\n            const creatorLower = (\n              m.creatorName ||\n              m.createdBy ||\n              \"\"\n            ).toLowerCase();\n            if (localName && creatorLower === localName) {\n              m._isCreatorView = true;\n            }\n          }\n          try {\n            if (m?.creatorId && m?.creatorName)\n              setParticipants((prev) => ({\n                ...prev,\n                [m.creatorId]: m.creatorName,\n              }));\n          } catch {}\n          serverPrestartRef.current = true;\n          setJoinMatch(m);\n          const endsAt = msg.prestartEndsAt || Date.now();\n          setJoinTimer(\n            Math.max(\n              0,\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\n            ),\n          );\n          setTimeout(() => {\n            serverPrestartRef.current = false;\n          }, 0);\n          setJoinChoice(null);\n          setRemoteChoices({});\n          setBullActive(false);\n          setBullThrow(null);\n          setBullWinner(null);\n          setBullTied(false);\n        }\n        if (msg?.type === \"invite-expired\") {\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          setJoinMatch((prev: any) =>\n            prev && msg.matchId === prev.id ? null : prev,\n          );\n        }\n        if (msg?.type === \"declined\") {\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          setJoinMatch((prev: any) =>\n            prev && msg.matchId === prev.id ? null : prev,\n          );\n        }\n      } catch {}\n    },\n    [normalizeMatch, user],\n  );\n\n  // Shared handler for match-start messages (used by WS listener and forwarded events)\n  const handleMatchStart = React.useCallback(\n    (msg: any) => {\n      if (msg?.type !== \"match-start\") return;\n      // Prevent double-init if match is already running\n      if (useMatch.getState().inProgress) return;\n\n      const serverMatch = msg.match || {};\n      const saved = pendingMatchRef.current || {};\n      const roomId = msg.roomId || saved.id || \"\";\n      const startScore =\n        serverMatch.startingScore || saved.startingScore || 501;\n      const localName = username;\n      const creatorName =\n        serverMatch.creatorName || saved.creatorName || saved.createdBy || \"\";\n      const joinerName = serverMatch.joinerName || saved.joinerName || \"\";\n\n      // Determine player order: first thrower goes first\n      // Dev server sends firstPlayerId, deployed server sends firstThrowerId\n      const firstId = msg.firstThrowerId || msg.firstPlayerId || null;\n      const isLocalCreator =\n        saved._isCreatorView ||\n        creatorName.toLowerCase() === localName.toLowerCase();\n      const opponentName = isLocalCreator\n        ? joinerName || \"Opponent\"\n        : creatorName || \"Opponent\";\n\n      let localGoesFirst: boolean;\n      if (firstId) {\n        const creatorId = serverMatch.creatorId || saved.creatorId;\n        localGoesFirst = isLocalCreator\n          ? firstId === creatorId\n          : firstId !== creatorId;\n      } else {\n        localGoesFirst = isLocalCreator;\n      }\n\n      const playerNames = localGoesFirst\n        ? [localName, opponentName]\n        : [opponentName, localName];\n\n      // Initialize the match in the store â€” sets inProgress = true\n      try {\n        useMatch.getState().newMatch(playerNames, startScore, roomId, \"online\");\n      } catch (e) {\n        console.error(\"[OnlinePlay] newMatch failed:\", e);\n      }\n\n      // Track the game mode for this match\n      const gameMode = serverMatch.game || saved.game || \"X01\";\n      setCurrentGame(gameMode);\n\n      // Join the WS room so we receive real-time score updates\n      try {\n        if (wsGlobal?.connected) {\n          wsGlobal.send({ type: \"join\", roomId });\n        }\n      } catch {}\n\n      // Clean up prestart state\n      pendingMatchRef.current = null;\n      setJoinMatch(null);\n      setJoinChoice(null);\n      setRemoteChoices({});\n    },\n    [username, wsGlobal],\n  );\n\n  // WS: subscribe to lobby and prestart events\n  useEffect(() => {\n    if (!wsGlobal) return;\n    if (wsGlobal.connected) wsGlobal.send({ type: \"list-matches\" });\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg?.type === \"joined\") {\n          if (msg.id) setSelfId(msg.id);\n        }\n        if (msg?.type === \"presence\") {\n          // presence carries id and username\n          try {\n            if (msg.id)\n              setParticipants((prev) => ({\n                ...prev,\n                [msg.id]: msg.username || msg.name || msg.id,\n              }));\n          } catch {}\n        }\n        if (msg?.type === \"matches\") {\n          const filtered = filterMatches(msg.matches || []);\n          setServerMatches(filtered);\n          serverMatchesRef.current = filtered;\n          setPages((prev) =>\n            prev.map((r, idx) =>\n              idx === currentPageIdx ? { ...r, matches: filtered } : r,\n            ),\n          );\n        }\n        // Invite / prestart / expired / declined\n        handleInviteOrPrestart(msg);\n\n        if (msg?.type === \"match-start\") {\n          handleMatchStart(msg);\n        }\n        if (msg?.type === \"prestart-choice-notify\") {\n          const { roomId, playerId, choice } = msg;\n          if (!roomId || !choice) return;\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\n        }\n        if (msg?.type === \"prestart-bull\") {\n          setBullActive(true);\n          setBullThrown(false);\n          setBullLocalThrow(null);\n        }\n        if (msg?.type === \"prestart-bull-winner\") {\n          setBullWinner(msg.winnerName || msg.winnerId || null);\n          setBullActive(false);\n          setBullThrown(false);\n          setBullTied(false);\n        }\n        if (msg?.type === \"prestart-bull-tie\") {\n          // reset to allow another round\n          setBullWinner(null);\n          setBullActive(false);\n          setBullThrown(false);\n          setBullTied(true);\n          // Auto-reset tied state after 2s so the dartboard reappears\n          setTimeout(() => setBullTied(false), 2000);\n        }\n        // Opponent quit â€” show overlay so this player can leave gracefully\n        if (msg?.type === \"opponent-quit\") {\n          setOpponentQuitName(msg.quitterName || \"Opponent\");\n        }\n        // Opponent paused â€” sync pause state locally\n        if (msg?.type === \"opponent-paused\") {\n          try {\n            useMatchControl\n              .getState()\n              .setPaused(true, null, msg.pauserName || \"Opponent\");\n          } catch {}\n        }\n        // Opponent resumed â€” sync unpause state locally\n        if (msg?.type === \"opponent-unpaused\") {\n          try {\n            useMatchControl.getState().setPaused(false, null);\n          } catch {}\n        }\n        // Incoming match state from opponent â€” sync scores/turns\n        if (msg?.type === \"state\" && msg.payload) {\n          try {\n            useMatch.getState().importState(msg.payload);\n          } catch {}\n        }\n        // Opponent camera frame snapshot\n        if (msg?.type === \"camera-frame\" && msg.frame) {\n          setOpponentFrame(msg.frame);\n        }\n      } catch (err) {}\n    });\n    return unsub;\n  }, [\n    wsGlobal,\n    joinChoice,\n    filterMatches,\n    currentPageIdx,\n    handleInviteOrPrestart,\n    handleMatchStart,\n  ]);\n\n  // Listen for forwarded invite/prestart/match-start events from App.tsx (global listener)\n  // This fires when the user is on a different tab and App.tsx switches to\n  // the online tab + dispatches the WS message via a CustomEvent.\n  // Also check for a stashed pending message on mount (the event may have fired\n  // before this component mounted).\n  useEffect(() => {\n    // Check for a pending message stashed by App.tsx before we mounted\n    try {\n      const pending = (window as any).__ndn_pending_invite;\n      if (pending) {\n        (window as any).__ndn_pending_invite = null;\n        if (pending.type === \"match-start\") {\n          handleMatchStart(pending);\n        } else {\n          handleInviteOrPrestart(pending);\n        }\n      }\n    } catch {}\n\n    const onInviteEvent = (e: Event) => {\n      try {\n        const msg = (e as CustomEvent).detail;\n        if (!msg) return;\n        if (msg.type === \"match-start\") {\n          handleMatchStart(msg);\n        } else {\n          handleInviteOrPrestart(msg);\n        }\n      } catch {}\n    };\n    window.addEventListener(\"ndn:match-invite\", onInviteEvent);\n    return () => window.removeEventListener(\"ndn:match-invite\", onInviteEvent);\n  }, [handleInviteOrPrestart, handleMatchStart]);\n\n  // Join timer\n  useEffect(() => {\n    if (!joinMatch) return;\n    if (serverPrestartRef.current) return;\n    // If a server-supplied prestart exists, do not override joinTimer\n    if ((joinMatch as any).prestartEndsAt) return;\n    setJoinTimer(30);\n    setJoinChoice(null);\n    setRemoteChoices({});\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\n    return () => clearInterval(t);\n  }, [joinMatch]);\n\n  // Focus the accept button when the join modal is shown\n  useEffect(() => {\n    if (!joinMatch) return;\n    setTimeout(() => joinAcceptRef.current?.focus(), 0);\n  }, [joinMatch]);\n\n  const handleJoinAccept = () => {\n    // Show the pre-game overlay immediately for snappy UX.\n    setShowStartShowcase(true);\n    // Save match info so the match-start handler can use it after joinMatch is cleared\n    if (joinMatch) {\n      pendingMatchRef.current = { ...joinMatch };\n    }\n    // Send accept (invite-response) to server\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        // If the local user is the creator accepting an invite, toId is the joiner\n        // If the local user is the joiner, toId is the creator\n        const isCreatorAccepting = !!joinMatch._isCreatorView;\n        wsGlobal.send({\n          type: \"invite-response\",\n          matchId: joinMatch.id,\n          accept: true,\n          toId: isCreatorAccepting ? joinMatch.joinerId : joinMatch.creatorId,\n        });\n      }\n    } catch {}\n    setJoinMatch(null);\n  };\n\n  const requestJoin = (m: any) => {\n    setJoinMatch(m);\n    // MatchPrestart overlay handles the pre-game flow now; MatchStartShowcase\n    // is shown later when the user accepts via handleJoinAccept.\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before joining\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n        wsGlobal.send({ type: \"join-match\", matchId: m.id, calibrated: true });\n      }\n    } catch {}\n  };\n\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\n    setJoinChoice(choice);\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"prestart-choice\",\n          roomId: joinMatch.id,\n          choice,\n        });\n      }\n    } catch {}\n  };\n\n  // No local state for the start showcase; MatchStartShowcase reads from `match.inProgress` directly\n\n  const sendState = React.useCallback(() => {\n    try {\n      if (wsGlobal?.connected) {\n        const st = useMatch.getState();\n        wsGlobal.send({ type: \"state\", payload: st });\n      }\n    } catch {}\n  }, [wsGlobal]);\n\n  // Periodically capture local camera frames and send to opponent via WS\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"online\") return;\n    if (!wsGlobal?.connected) return;\n    const iv = setInterval(() => {\n      try {\n        const dbg = (window as any).__ndn_camera_debug;\n        const video = dbg?.videoEl?.() as HTMLVideoElement | null;\n        if (!video || !video.videoWidth || !video.videoHeight) return;\n        const w = 320;\n        const h = Math.round((video.videoHeight / video.videoWidth) * w) || 180;\n        const c = document.createElement(\"canvas\");\n        c.width = w;\n        c.height = h;\n        const ctx = c.getContext(\"2d\");\n        if (!ctx) return;\n        ctx.drawImage(video, 0, 0, w, h);\n        const frame = c.toDataURL(\"image/jpeg\", 0.4);\n        wsGlobal.send({ type: \"camera-frame\", frame });\n      } catch {}\n    }, 1500);\n    return () => clearInterval(iv);\n  }, [inProgress, matchContext, wsGlobal]);\n\n  // Clear opponent frame when match ends\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"online\") {\n      setOpponentFrame(null);\n    }\n  }, [inProgress, matchContext]);\n\n  const runOnlineInPlayDemo = () => {\n    launchInPlayDemo({\n      players: [username, \"Opponent\"],\n      startingScore: 501,\n      roomId: \"online-demo\",\n      visits: [{ score: 60 }, { score: 85 }, { score: 100 }],\n    });\n  };\n\n  // â”€â”€ When a match is in progress, render the full in-game shell â”€â”€\n  // Only show InGameShell if the match was started from OnlinePlay (context === 'online').\n  // This prevents offline or tournament matches from falsely rendering here.\n  if (inProgress && matchContext === \"online\") {\n    const matchState = useMatch.getState();\n    const localIdx = (matchState.players || []).findIndex(\n      (p: any) => p?.name && p.name.toLowerCase() === username.toLowerCase(),\n    );\n    return (\n      <>\n        <InGameShell\n          user={user}\n          showStartShowcase={showStartShowcase}\n          onShowStartShowcaseChange={setShowStartShowcase}\n          onCommitVisit={(score, _darts, _meta) => {\n            try {\n              const m = useMatch.getState();\n              const p = m.players[m.currentPlayerIdx];\n              const leg = p?.legs?.[p.legs.length - 1];\n              const preRem = leg ? leg.totalScoreRemaining : m.startingScore;\n              const postRem = Math.max(0, preRem - score);\n              const attempts = preRem <= 50 ? 3 : postRem <= 50 ? 1 : 0;\n              const finished = postRem === 0;\n              m.addVisit(score, 3, {\n                preOpenDarts: 0,\n                doubleWindowDarts: attempts,\n                finishedByDouble: finished,\n                visitTotal: score,\n              });\n              if (leg && leg.totalScoreRemaining === 0) {\n                m.endLeg(score);\n              } else {\n                m.nextPlayer();\n              }\n            } catch {\n              useMatch.getState().addVisit(score, 3);\n              useMatch.getState().nextPlayer();\n            }\n            sendState();\n          }}\n          onQuit={() => {\n            try {\n              useMatch.getState().endGame();\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-quit\" });\n              }\n            } catch {}\n            // Clear any stale prestart / invite state so popups don't reappear\n            setPendingInvite(null);\n            setWaitingForCreator(null);\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setOpponentQuitName(null);\n            pendingMatchRef.current = null;\n            try {\n              (window as any).__ndn_pending_invite = null;\n            } catch {}\n            sendState();\n            try {\n              window.dispatchEvent(new Event(\"ndn:match-quit\"));\n            } catch {}\n          }}\n          onPause={() => {\n            try {\n              useMatchControl.getState().setPaused(true, null, username);\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-pause\" });\n              }\n            } catch {}\n          }}\n          onResume={() => {\n            try {\n              useMatchControl.getState().setPaused(false, null);\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-unpause\" });\n              }\n            } catch {}\n          }}\n          onStateChange={sendState}\n          localPlayerIndexOverride={localIdx >= 0 ? localIdx : undefined}\n          gameModeOverride={currentGame}\n          isOnline={true}\n          remoteFrame={opponentFrame}\n        />\n        {/* Opponent quit overlay */}\n        {opponentQuitName && (\n          <div className=\"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm\">\n            <div className=\"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl\">\n              <div className=\"text-4xl mb-3\">ğŸšª</div>\n              <h3 className=\"text-lg font-bold text-white mb-2\">\n                {opponentQuitName} left the match\n              </h3>\n              <p className=\"text-sm text-white/60 mb-5\">\n                Your opponent has quit. You can leave the match now.\n              </p>\n              <button\n                className=\"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all\"\n                onClick={() => {\n                  try {\n                    useMatch.getState().endGame();\n                  } catch {}\n                  setOpponentQuitName(null);\n                  setPendingInvite(null);\n                  setWaitingForCreator(null);\n                  setJoinMatch(null);\n                  setJoinChoice(null);\n                  pendingMatchRef.current = null;\n                  try {\n                    (window as any).__ndn_pending_invite = null;\n                  } catch {}\n                  try {\n                    window.dispatchEvent(new Event(\"ndn:match-quit\"));\n                  } catch {}\n                }}\n              >\n                Leave Match\n              </button>\n            </div>\n          </div>\n        )}\n      </>\n    );\n  }\n\n  return (\n    <div\n      className=\"flex-1 min-h-0 ndn-page\"\n      style={{ position: \"relative\", marginTop: 0 }}\n    >\n      <div className=\"card ndn-game-shell relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col\">\n        {showStartShowcase && (\n          <MatchStartShowcase\n            players={(players || []) as any}\n            user={user}\n            onDone={() => setShowStartShowcase(false)}\n            onRequestClose={() => setShowStartShowcase(false)}\n          />\n        )}\n        <h2 className=\"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title\">\n          Online Lobby ğŸŒ\n        </h2>\n        <div className=\"ndn-shell-body flex-1 overflow-hidden p-3 pb-0\">\n          <div className=\"h-full flex flex-col gap-3\">\n            {/* Top row: Page, New Page, Create Match */}\n            <div className=\"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap\">\n              <div className=\"flex items-center gap-3 flex-wrap\">\n                <div className=\"text-sm text-white/70\">Page</div>\n                <div className=\"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium\">\n                  Page {currentPage_?.id}\n                </div>\n                <button\n                  className=\"btn btn-ghost btn-sm rounded-lg\"\n                  onClick={newPage}\n                >\n                  New Page\n                </button>\n              </div>\n              <div className=\"shrink-0 flex items-center gap-2\">\n                <button\n                  className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg\"\n                  onClick={() => setShowCreateModal(true)}\n                  disabled={\n                    (currentPage_?.matches?.length || 0) >= maxMatchesPerPage\n                  }\n                >\n                  <Trophy className=\"w-4 h-4\" />\n                  Create Match +\n                </button>\n                {showDemoControls && (\n                  <button\n                    className=\"btn btn-sm btn-ghost rounded-lg\"\n                    onClick={runOnlineInPlayDemo}\n                  >\n                    Demo In-Play\n                  </button>\n                )}\n                {(currentPage_?.matches?.length || 0) >= maxMatchesPerPage && (\n                  <div className=\"text-xs text-rose-400\">\n                    Page full â€” create a new page\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Filters & Controls */}\n            {!inProgress && (\n              <div className=\"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3\">\n                <div className=\"ndn-filterbar\">\n                  <div className=\"flex-1 min-w-[240px] relative\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40\" />\n                    <input\n                      type=\"text\"\n                      placeholder=\"Search matches, players...\"\n                      className=\"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={filterGame}\n                      onChange={(e) => setFilterGame(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Games</option>\n                      <option value=\"x01\">\n                        {getGameDisplay(\"X01\").emoji} X01\n                      </option>\n                      <option value=\"cricket\">\n                        {getGameDisplay(\"Cricket\").emoji} Cricket\n                      </option>\n                      <option value=\"bermuda\">\n                        {getGameDisplay(\"Bermuda\").emoji} Bermuda\n                      </option>\n                      <option value=\"gotcha\">\n                        {getGameDisplay(\"Gotcha\").emoji} Gotcha\n                      </option>\n                    </select>\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={filterMode}\n                      onChange={(e) => setFilterMode(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Modes</option>\n                      <option value=\"first_to\">First To</option>\n                      <option value=\"best_of\">Best Of</option>\n                    </select>\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={sortBy}\n                      onChange={(e) => setSortBy(e.target.value as any)}\n                    >\n                      <option value=\"newest\">Newest First</option>\n                      <option value=\"oldest\">Oldest First</option>\n                    </select>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className={`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${focusMode ? \"bg-red-600 text-white border-red-500\" : \"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900\"}`}\n                      onClick={() => setFocusMode((s) => !s)}\n                      aria-pressed={focusMode}\n                      title=\"Toggle focus mode: hide small details and show focused view\"\n                    >\n                      {focusMode ? \"Exit Focus\" : \"Focus Mode\"}\n                    </button>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg\"\n                      onClick={handleQuickJoin}\n                      disabled={combinedMatches.length === 0}\n                    >\n                      <Zap className=\"w-4 h-4 fill-current\" />\n                      Quick Join\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex-1 overflow-auto flex flex-col\">\n              <h3 className=\"font-semibold text-lg mb-3 flex items-center gap-2\">\n                <Users className=\"w-5 h-5 text-indigo-400\" />\n                Active Matches ï¿½ï¸\n              </h3>\n              <div className=\"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col\">\n                <div className=\"flex-1 overflow-auto\">\n                  {(combinedMatches.length || 0) === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-12 text-center opacity-60\">\n                      <div className=\"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4\">\n                        <Target className=\"w-8 h-8 text-white/20\" />\n                      </div>\n                      <p className=\"text-lg font-medium mb-1\">\n                        No matches found\n                      </p>\n                      <p className=\"text-sm max-w-xs mx-auto\">\n                        Create a new match to get started or try adjusting your\n                        filters.\n                      </p>\n                    </div>\n                  ) : null}\n\n                  {(combinedMatches.length || 0) !== 0 && (\n                    <div className=\"relative\">\n                      {focusMode && (\n                        <div className=\"absolute inset-0 z-10 flex items-center justify-center pointer-events-none\">\n                          <div className=\"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out\">\n                            <button\n                              onClick={() => setFocusMode(false)}\n                              className=\"w-full text-center\"\n                            >\n                              FOCUS MODE â€” Click to exit\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                      <div\n                        ref={matchesRef}\n                        className={`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 max-h-[28rem] overflow-auto p-1 ${focusMode ? \"opacity-90\" : \"\"}`}\n                        data-testid=\"matches-grid\"\n                      >\n                        {paginatedMatches.map((m: any) => (\n                          <div\n                            key={m.id}\n                            className=\"group relative p-4 rounded-lg border border-slate-700/30 bg-slate-950/40 hover:border-indigo-500/50 hover:bg-slate-900/50 transition-all duration-150 shadow-sm hover:shadow-[0_8px_24px_-12px_rgba(99,102,241,0.4)] flex flex-col gap-3 min-h-[6.5rem]\"\n                            data-testid={`match-${m.id}`}\n                          >\n                            <div className=\"flex items-start justify-between\">\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"flex items-center gap-3\">\n                                  {!focusMode && (\n                                    <div\n                                      className=\"w-9 h-9 rounded-full flex items-center justify-center border group-hover:border-opacity-60 transition-colors text-sm\"\n                                      style={{\n                                        backgroundColor: `${getGameDisplay(m.game).color}15`,\n                                        borderColor: `${getGameDisplay(m.game).color}30`,\n                                      }}\n                                    >\n                                      {getGameDisplay(m.game).emoji}\n                                    </div>\n                                  )}\n                                  <div className=\"min-w-0\">\n                                    <div\n                                      className=\"font-bold group-hover:text-indigo-300 transition-colors truncate\"\n                                      style={{\n                                        color: getGameDisplay(m.game).color,\n                                      }}\n                                    >\n                                      {getGameDisplay(m.game).emoji} {m.game}\n                                    </div>\n                                    <div className=\"text-xs text-white/50 flex items-center gap-1\">\n                                      <Clock className=\"w-3 h-3\" />\n                                      {new Date(m.createdAt).toLocaleTimeString(\n                                        [],\n                                        { hour: \"2-digit\", minute: \"2-digit\" },\n                                      )}\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                              {m.roomName && (\n                                <div className=\"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-none bg-slate-950 border border-slate-850 text-white/70\">\n                                  {m.roomName}\n                                </div>\n                              )}\n                            </div>\n\n                            <div className=\"flex flex-col gap-1 text-sm text-white/70 bg-transparent border-t border-slate-850 pt-2\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"px-1.5 py-0.5 rounded-none bg-white/5 text-xs font-medium border border-slate-850\">\n                                  {m.modeType === \"bestof\"\n                                    ? \"Best Of\"\n                                    : \"First To\"}\n                                </span>\n                                <span className=\"font-mono text-indigo-300\">\n                                  {m.legs}\n                                </span>\n                                <span>legs</span>\n                                {m.startingScore && (\n                                  <>\n                                    <span className=\"w-1 h-1 rounded-full bg-white/20\" />\n                                    <span className=\"font-mono text-amber-300\">\n                                      {m.startingScore}\n                                    </span>\n                                  </>\n                                )}\n                              </div>\n                              {!focusMode && (\n                                <div className=\"text-xs text-white/40 flex items-center gap-1 mt-1\">\n                                  <Users className=\"w-3 h-3\" />\n                                  Created by:{\" \"}\n                                  <span className=\"text-white/60\">\n                                    {m.createdBy || m.creatorName || \"Unknown\"}\n                                  </span>\n                                </div>\n                              )}\n                            </div>\n\n                            <div className=\"flex items-center justify-between mt-auto pt-2 border-t border-white/5\">\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                {!focusMode && (\n                                  <div className=\"flex items-center gap-3 min-w-0\">\n                                    <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white\">\n                                      {(m.createdBy || m.creatorName || \"U\")\n                                        .substring(0, 2)\n                                        .toUpperCase()}\n                                    </div>\n                                    <span className=\"text-xs text-white/60 truncate max-w-[120px]\">\n                                      {m.createdBy || m.creatorName}\n                                    </span>\n                                  </div>\n                                )}\n                              </div>\n\n                              <div className=\"flex items-center justify-end\">\n                                <button\n                                  className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-4 rounded-none\"\n                                  onClick={() => requestJoin(m)}\n                                >\n                                  Join\n                                </button>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Pagination Controls */}\n                  {totalPages > 1 && (\n                    <div className=\"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5\">\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === 1}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.max(1, p - 1))\n                        }\n                      >\n                        <ChevronDown className=\"w-4 h-4 rotate-90\" />\n                        Previous\n                      </button>\n                      <div className=\"flex items-center gap-1\">\n                        {Array.from(\n                          { length: Math.min(5, totalPages) },\n                          (_, i) => {\n                            // Logic to show window of pages around current\n                            let p = i + 1;\n                            if (totalPages > 5) {\n                              if (currentPage > 3) p = currentPage - 2 + i;\n                              if (p > totalPages) p = totalPages - 4 + i;\n                            }\n                            return (\n                              <button\n                                key={p}\n                                className={`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${\n                                  currentPage === p\n                                    ? \"bg-indigo-600 text-white shadow-sm\"\n                                    : \"bg-slate-950 text-white/70 hover:bg-slate-900\"\n                                }`}\n                                onClick={() => setCurrentPage(p)}\n                              >\n                                {p}\n                              </button>\n                            );\n                          },\n                        )}\n                      </div>\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === totalPages}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.min(totalPages, p + 1))\n                        }\n                      >\n                        Next\n                        <ChevronDown className=\"w-4 h-4 -rotate-90\" />\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n              {/* World Lobby removed: combined matches are displayed above */}\n            </div>\n          </div>\n        </div>\n\n        {/* Create Match modal */}\n        <CreateMatchModal\n          open={showCreateModal}\n          onClose={() => setShowCreateModal(false)}\n          onCreate={(p) => {\n            handleCreateMatch(p);\n            setShowCreateModal(false);\n          }}\n        />\n\n        {/* â”€â”€ Incoming invite popup (creator sees this) â”€â”€ */}\n        {pendingInvite && (\n          <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200\">\n            <div className=\"relative w-full max-w-md mx-4 p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-indigo-500/30 shadow-2xl shadow-indigo-500/20\">\n              {/* Glow accent */}\n              <div className=\"absolute -top-12 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none\" />\n\n              <div className=\"relative z-10\">\n                <div className=\"flex items-center gap-3 mb-4\">\n                  <div className=\"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 ring-2 ring-indigo-500/30\">\n                    <Zap className=\"w-6 h-6\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-xl font-black text-white\">\n                      Match Invite!\n                    </h3>\n                    <p className=\"text-sm text-white/60\">\n                      Someone wants to play\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"p-4 rounded-xl bg-white/5 border border-white/10 mb-5\">\n                  <div className=\"flex items-center gap-3 mb-3\">\n                    <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold text-sm\">\n                      {(pendingInvite.fromName || \"?\")\n                        .substring(0, 2)\n                        .toUpperCase()}\n                    </div>\n                    <div>\n                      <div className=\"font-bold text-white text-lg\">\n                        {pendingInvite.fromName || \"Opponent\"}\n                      </div>\n                      <div className=\"text-xs text-white/50\">\n                        wants to join your match\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2 flex-wrap text-sm text-white/70\">\n                    <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-medium\">\n                      {pendingInvite.game || \"X01\"}\n                    </span>\n                    <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10\">\n                      {pendingInvite.mode === \"bestof\" ? \"Best Of\" : \"First To\"}{\" \"}\n                      {pendingInvite.value || 1}\n                    </span>\n                    <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-mono text-amber-300\">\n                      {pendingInvite.startingScore || 501}\n                    </span>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-3\">\n                  <button\n                    className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all hover:scale-[1.02] active:scale-95\"\n                    onClick={() => {\n                      // Send invite-accept to start prestart for both\n                      try {\n                        if (wsGlobal?.connected && pendingInvite?.id) {\n                          wsGlobal.send({\n                            type: \"invite-accept\",\n                            matchId: pendingInvite.id,\n                          });\n                        }\n                      } catch {}\n                      setPendingInvite(null);\n                    }}\n                  >\n                    âœ… Accept\n                  </button>\n                  <button\n                    className=\"flex-1 py-3 rounded-xl bg-white/5 hover:bg-rose-600/80 text-white/80 hover:text-white font-bold text-lg border border-white/10 hover:border-rose-500/50 transition-all hover:scale-[1.02] active:scale-95\"\n                    onClick={() => {\n                      // Send invite-decline\n                      try {\n                        if (wsGlobal?.connected && pendingInvite?.id) {\n                          wsGlobal.send({\n                            type: \"invite-decline\",\n                            matchId: pendingInvite.id,\n                          });\n                        }\n                      } catch {}\n                      setPendingInvite(null);\n                    }}\n                  >\n                    âŒ Decline\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* â”€â”€ Waiting for creator (joiner sees this) â”€â”€ */}\n        {waitingForCreator && !joinMatch && (\n          <div className=\"fixed inset-0 z-[9998] flex items-center justify-center bg-black/70 backdrop-blur-sm\">\n            <div className=\"w-full max-w-sm mx-4 p-6 rounded-2xl bg-slate-900 border border-slate-700/50 text-center\">\n              <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-indigo-500/10 flex items-center justify-center\">\n                <Clock className=\"w-8 h-8 text-indigo-400 animate-pulse\" />\n              </div>\n              <h3 className=\"text-xl font-bold text-white mb-2\">\n                Waiting for {waitingForCreator}\n              </h3>\n              <p className=\"text-sm text-white/50 mb-5\">\n                The match creator needs to accept your requestâ€¦\n              </p>\n              <button\n                className=\"px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 transition-all text-sm font-medium\"\n                onClick={() => setWaitingForCreator(null)}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Modern join / prestart overlay */}\n        <MatchPrestart\n          open={!!joinMatch}\n          matchInfo={joinMatch}\n          localUser={user}\n          opponentName={(() => {\n            if (!joinMatch) return \"Opponent\";\n            const localName = (user?.username || \"\").toLowerCase();\n            const creatorName =\n              joinMatch.createdBy || joinMatch.creatorName || \"\";\n            // If local user is the creator, opponent is the joiner\n            if (\n              joinMatch._isCreatorView ||\n              creatorName.toLowerCase() === localName\n            ) {\n              return (\n                joinMatch.joinerName ||\n                (joinMatch.joinerId\n                  ? participants[joinMatch.joinerId] || joinMatch.joinerId\n                  : \"Opponent\")\n              );\n            }\n            // Otherwise, local user is the joiner â€” opponent is the creator\n            return (\n              creatorName ||\n              (joinMatch.creatorId\n                ? participants[joinMatch.creatorId] || joinMatch.creatorId\n                : \"Opponent\")\n            );\n          })()}\n          countdown={15}\n          onChoice={sendPrestartChoice}\n          onBullThrow={(distanceMm: number) => {\n            try {\n              if (wsGlobal?.connected && joinMatch?.id) {\n                wsGlobal.send({\n                  type: \"prestart-bull-throw\",\n                  roomId: joinMatch.id,\n                  score: distanceMm,\n                });\n              }\n            } catch {}\n            setBullLocalThrow(distanceMm);\n            setBullThrown(true);\n          }}\n          onAccept={handleJoinAccept}\n          onCancel={() => {\n            // If the creator cancels during prestart, notify the server\n            try {\n              if (\n                wsGlobal?.connected &&\n                joinMatch?.id &&\n                joinMatch._isCreatorView\n              ) {\n                wsGlobal.send({\n                  type: \"invite-decline\",\n                  matchId: joinMatch.id,\n                });\n              }\n            } catch {}\n            setJoinMatch(null);\n          }}\n          remoteChoice={Object.values(remoteChoices)[0] || null}\n          bullActive={bullActive}\n          bullWinner={bullWinner}\n          bullTied={bullTied}\n        />\n      </div>\n    </div>\n  );\n}\n"],"names":["CreateMatchModal","open","onClose","onCreate","portalEl","useState","game","setGame","modeType","setModeType","legs","setLegs","legsRef","useRef","avgChoice","setAvgChoice","startingScore","setStartingScore","getStartOptionsForGame","extraValues","setExtraValues","getDefaultExtraValues","user","useUserSettings","onGameChange","g","opts","cfg","gameConfig","validMode","useLayoutEffect","onKey","e","extraFields","getExtraFieldsForGame","valueLabel","getValueLabelForGame","display","getGameDisplay","handleCreate","payload","createPortal","jsxs","jsx","allGames","opt","f","prev","o","m","base","BOARD_SIZE","CX","CY","BULL_INNER_R","BULL_OUTER_R","TREBLE_INNER_R","TREBLE_OUTER_R","DOUBLE_INNER_R","DOUBLE_OUTER_R","SCALE","SECTOR_ORDER","SECTOR_COLORS","s","getPlayerStats","name","avg3","getAllTimeAvg","best9","getAllTimeFirstNineAvg","bestCheckout","getAllTimeBestCheckout","bestLeg","getAllTimeBestLeg","all","getAllTime","career180s","getAllTime180s","polarToXY","cx","cy","r","angleDeg","rad","distFromBull","x","y","dx","dy","StatPill","label","value","highlight","DartboardBullUp","onSelect","selectedPoint","disabled","svgRef","coordsFromEvent","useCallback","clientX","clientY","svg","rect","dist","handleClick","c","handleTouch","touch","sectorPaths","useMemo","paths","i","sector","startAngle","endAngle","colors","ring","ri","r1","r2","p1","p2","p3","p4","largeArc","d","labelPos","Fragment","PlayerCard","stats","isLocal","showCamera","isWinner","legDiff","legDiffValue","Crown","Camera","CameraTile","MatchPrestart","matchInfo","localUser","opponentName","opponentStats","countdown","onChoice","onBullThrow","onAccept","onCancel","remoteChoice","bullActive","bullWinner","bullTied","seconds","setSeconds","phase","setPhase","localChoice","setLocalChoice","dartPoint","setDartPoint","dartDistMm","setDartDistMm","dartLocked","setDartLocked","dartSubmitted","setDartSubmitted","portalElRef","localStats","oppStats","useEffect","el","id","next","t","handleDartSelect","distMm","handleSubmitDart","handleChoice","localName","headToHead","getHeadToHeadLegDiff","localLegDiff","opponentLegDiff","isLocalWinner","isOpponentWinner","bothSkipped","overlay","X","Target","Timer","ArrowRight","Zap","OnlinePlayClean","username","currentPageIdx","setCurrentPageIdx","pages","setPages","wsGlobal","useWS","serverMatches","setServerMatches","inProgress","useMatch","matchContext","players","focusMode","setFocusMode","matchesRef","showDemoControls","onDocClick","showStartShowcase","setShowStartShowcase","startedShowcasedRef","React","p","L","st","flagKey","openMatchWindow","onQuit","setPendingInvite","setWaitingForCreator","setJoinMatch","setJoinChoice","setOpponentQuitName","pendingMatchRef","showCreateModal","setShowCreateModal","joinMatch","joinAcceptRef","pendingInvite","waitingForCreator","_selfId","setSelfId","participants","setParticipants","joinTimer","setJoinTimer","serverMatchesRef","serverPrestartRef","joinChoice","remoteChoices","setRemoteChoices","setBullActive","bullThrow","setBullThrow","setBullWinner","bullLocalThrow","setBullLocalThrow","bullThrown","setBullThrown","setBullTied","opponentQuitName","currentGame","setCurrentGame","opponentFrame","setOpponentFrame","searchQuery","setSearchQuery","filterGame","setFilterGame","filterMode","setFilterMode","sortBy","setSortBy","currentPage","setCurrentPage","itemsPerPage","currentPage_","maxMatchesPerPage","normalizeMatch","createdBy","createdAt","filterMatches","list","combinedMatches","q","mt","target","a","b","tA","tB","totalPages","paginatedMatches","handleQuickJoin","requestJoin","handleCreateMatch","newMatch","idx","newPage","newPages","handleInviteOrPrestart","msg","inviteData","audio","creatorLower","endsAt","handleMatchStart","serverMatch","saved","roomId","startScore","creatorName","joinerName","firstId","isLocalCreator","localGoesFirst","creatorId","playerNames","gameMode","filtered","playerId","choice","useMatchControl","pending","onInviteEvent","v","handleJoinAccept","isCreatorAccepting","sendPrestartChoice","sendState","iv","video","w","h","ctx","frame","runOnlineInPlayDemo","launchInPlayDemo","localIdx","InGameShell","score","_darts","_meta","leg","preRem","postRem","attempts","finished","MatchStartShowcase","Trophy","Search","Users","Clock","ChevronDown","_","distanceMm"],"mappings":"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"}
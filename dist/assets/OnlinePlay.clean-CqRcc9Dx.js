import{D as Ze,u as ke,r as jt,j as e,E as Et,F as Lt,x as yt,b as It,H as Dt,I as Rt,J as Bt,g as Pt,K as At,i as X,k as ue,L as Ot,n as nt,l as xt,M as Nt,N as _t,C as $t,O as Ft,G as mt,P as Wt,m as ut,o as Vt,A as Ut}from"./index-CYB6fMZr.js";import{r,X as Gt,p as Ye,I as zt,J as Ht,Z as ct,C as dt,o as Yt,R as Me,T as qt,K as Xt,U as ht,v as pt,h as bt}from"./ui-Cl5S-Tv0.js";import{A as Ae,a as Qt,P as Jt}from"./aroundTheClock-DNqF4Ni4.js";import{o as Kt,l as Zt}from"./matchWindow-C1AeyUId.js";import"./vendor-D3F3s8fL.js";function es({open:c,onClose:l,onCreate:p}){const[b]=r.useState(()=>document.createElement("div")),[v,N]=r.useState("X01"),[i,A]=r.useState("bestof"),[W,w]=r.useState(3),k=r.useRef(null),[g,d]=r.useState(0),[j,O]=r.useState(()=>Ze(v)?.[0]),R=ke().username||"Anonymous";r.useLayoutEffect(()=>(b.className="ndn-create-match-portal",document.body.appendChild(b),()=>{try{b&&b.remove()}catch{}}),[b]),r.useLayoutEffect(()=>{function o(S){S.key==="Escape"&&l()}return c&&document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[c,l]);const h=()=>{p({createdBy:R,game:v,modeType:i,legs:W,avgChoice:g,startingScore:j}),l()};return!c||!b?null:jt.createPortal(e.jsxs("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-2 sm:p-6",children:[e.jsx("button",{"aria-label":"Close dialog",className:"absolute inset-0 w-full h-full bg-transparent",onClick:l}),e.jsxs("div",{className:"rounded-2xl p-5 sm:p-6 max-w-lg w-full relative text-white shadow-2xl border border-indigo-500/30 max-h-[85vh] overflow-y-auto",style:{background:"var(--ndn-card-bg, #0f172a)"},role:"dialog",children:[e.jsx("button",{"aria-label":"Close",className:"absolute top-3 right-3 w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors",onClick:l,children:"‚úï"}),e.jsx("h2",{className:"text-base sm:text-lg font-bold tracking-tight mb-3",children:"üéØ Create Match"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Created By"}),e.jsx("div",{className:"p-2 rounded-lg border border-indigo-500/20 bg-indigo-500/10 text-sm text-white",children:R})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-game",children:"Game"}),e.jsx("select",{id:"match-game",className:"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white",value:v,onChange:o=>{const S=o.target.value;N(S);const G=Ze(S);O(G?.[0])},onPointerDown:o=>{o.stopPropagation()},onMouseDown:o=>{o.stopPropagation()},onTouchStart:o=>{o.stopPropagation?.()},children:Et.map(o=>e.jsx("option",{value:o,className:"bg-slate-900 text-white",children:o},o))})]}),Ze(v).length>0?e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-start",children:`${v} Starting Score`}),e.jsx("select",{id:"match-start",className:"p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white w-full",value:j,onChange:o=>O(Number(o.target.value)),onPointerDown:o=>{o.stopPropagation()},onMouseDown:o=>{o.stopPropagation()},onTouchStart:o=>{o.stopPropagation?.()},children:Ze(v).map(o=>e.jsx("option",{value:o,className:"bg-slate-900 text-white",children:o},o))})]}):null,e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Mode"}),e.jsxs("div",{className:"flex gap-2 mt-1 justify-center",children:[e.jsxs("label",{className:`btn ${i==="bestof"?"btn-primary":"btn-ghost"}`,children:[e.jsx("input",{type:"radio",name:"mode",value:"bestof",checked:i==="bestof",onChange:()=>{A("bestof"),w(o=>{const S=Math.max(1,o||3);return S%2===1?S:S+1}),setTimeout(()=>k.current?.focus(),0)},className:"sr-only"})," ","Best Of"]}),e.jsxs("label",{className:`btn ${i==="firstto"?"btn-primary":"btn-ghost"}`,children:[e.jsx("input",{type:"radio",name:"mode",value:"firstto",checked:i==="firstto",onChange:()=>{A("firstto"),w(o=>Math.max(1,o||3)),setTimeout(()=>k.current?.focus(),0)},className:"sr-only"})," ","First To"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-legs",children:i==="bestof"?"Best Of":"First To"}),e.jsx("input",{id:"match-legs",type:"number",min:1,value:W,onChange:o=>w(Math.max(1,Number(o.target.value||1))),ref:k,className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block",htmlFor:"match-avg",children:"Average Choice (¬±)"}),e.jsx("input",{id:"match-avg",type:"number",value:g,onChange:o=>d(Number(o.target.value||0)),className:"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-3 border-t border-indigo-500/20",children:[e.jsx("button",{className:"flex-1 btn btn-ghost text-xs",onClick:l,children:"Cancel"}),e.jsx("button",{className:"flex-1 btn text-xs",onClick:h,children:"Create Match"})]})]})]}),b)}const Ee=400,P=Ee/2,F=Ee/2,ts=6.35,Pe=15.9,lt=99,it=107,ot=162,tt=170,re=(Ee/2-15)/tt,kt=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5],St={};kt.forEach((c,l)=>{St[c]=l%2===0?{dark:"#1a1a2e",light:"#c0392b"}:{dark:"#f0e6d3",light:"#27ae60"}});function ft(c){try{const l=It(c).toFixed(1),p=Dt(c).toFixed(1),b=Rt(c),v=Bt(c),N=Pt(c),i=At(c);return{avg3:l,best9:p,bestCheckout:b||"‚Äì",bestLeg:v||"‚Äì",lifetimeScored:N.scored||0,lifetimeDarts:N.darts||0,career180s:i||0}}catch{return{avg3:"0.0",best9:"0.0",bestCheckout:"‚Äì",bestLeg:"‚Äì",lifetimeScored:0,lifetimeDarts:0,career180s:0}}}function He(c,l,p,b){const v=(b-90)*Math.PI/180;return{x:c+p*Math.cos(v),y:l+p*Math.sin(v)}}function ss(c,l){const p=c-P,b=l-F;return Math.sqrt(p*p+b*b)/re}function et({label:c,value:l,highlight:p}){return e.jsxs("div",{className:`flex flex-col items-center px-1.5 py-1 rounded-lg ${p?"bg-indigo-500/20 ring-1 ring-indigo-500/30":"bg-white/5"}`,children:[e.jsx("span",{className:"text-[7px] sm:text-[8px] uppercase tracking-wider font-bold text-white/50",children:c}),e.jsx("span",{className:`text-xs sm:text-sm font-black ${p?"text-indigo-300":"text-white"}`,children:l})]})}function as({onSelect:c,selectedPoint:l,disabled:p,label:b}){const v=r.useRef(null),N=r.useCallback((w,k)=>{const g=v.current;if(!g)return null;const d=g.getBoundingClientRect(),j=(w-d.left)/d.width*Ee,O=(k-d.top)/d.height*Ee,R=ss(j,O);return{x:j,y:O,dist:Math.round(R*10)/10}},[]),i=r.useCallback(w=>{if(p)return;const k=N(w.clientX,w.clientY);k&&c(k.x,k.y,k.dist)},[c,p,N]),A=r.useCallback(w=>{if(p)return;w.preventDefault();const k=w.changedTouches[0];if(!k)return;const g=N(k.clientX,k.clientY);g&&c(g.x,g.y,g.dist)},[c,p,N]),W=r.useMemo(()=>{const w=[];for(let g=0;g<20;g++){const d=kt[g],j=g*18-18/2,O=j+18,R=St[d];[{inner:it,outer:ot,fill:R.dark},{inner:ot,outer:tt,fill:R.light},{inner:Pe,outer:lt,fill:R.dark},{inner:lt,outer:it,fill:R.light}].forEach((S,G)=>{const m=S.inner*re,u=S.outer*re,T=He(P,F,m,j),M=He(P,F,u,j),f=He(P,F,u,O),C=He(P,F,m,O),y=0,V=[`M ${T.x} ${T.y}`,`L ${M.x} ${M.y}`,`A ${u} ${u} 0 ${y} 1 ${f.x} ${f.y}`,`L ${C.x} ${C.y}`,`A ${m} ${m} 0 ${y} 0 ${T.x} ${T.y}`,"Z"].join(" ");w.push(e.jsx("path",{d:V,fill:S.fill,stroke:"rgba(255,255,255,0.08)",strokeWidth:.5,opacity:.85},`s${d}-r${G}`))});const o=He(P,F,(tt+12)*re,g*18);w.push(e.jsx("text",{x:o.x,y:o.y,textAnchor:"middle",dominantBaseline:"central",fill:"rgba(255,255,255,0.8)",fontSize:"11",fontWeight:"bold",fontFamily:"system-ui, sans-serif",children:d},`label-${d}`))}return w},[]);return e.jsxs("div",{className:"relative",children:[b&&e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${p&&l?"text-emerald-400":"text-white/50"}`,children:b})}),e.jsxs("svg",{ref:v,viewBox:`0 0 ${Ee} ${Ee}`,className:`w-full h-full touch-none select-none ${p?"pointer-events-none":"cursor-crosshair"}`,style:{opacity:p&&!l?.5:1},onClick:i,onTouchEnd:A,children:[e.jsx("circle",{cx:P,cy:F,r:P,fill:"#0a0a1a"}),W,e.jsx("circle",{cx:P,cy:F,r:lt*re,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:P,cy:F,r:it*re,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:P,cy:F,r:ot*re,fill:"none",stroke:"rgba(192,192,192,0.15)",strokeWidth:.8}),e.jsx("circle",{cx:P,cy:F,r:tt*re,fill:"none",stroke:"rgba(192,192,192,0.2)",strokeWidth:1}),e.jsx("circle",{cx:P,cy:F,r:Pe*re,fill:"#27ae60",stroke:"rgba(192,192,192,0.2)",strokeWidth:.8}),e.jsx("circle",{cx:P,cy:F,r:ts*re,fill:"#c0392b",stroke:"rgba(192,192,192,0.2)",strokeWidth:.8}),!l&&!p&&e.jsxs("circle",{cx:P,cy:F,r:Pe*re*1.8,fill:"none",stroke:"rgba(234,179,8,0.4)",strokeWidth:1.5,strokeDasharray:"4,4",children:[e.jsx("animate",{attributeName:"r",values:`${Pe*re*1.5};${Pe*re*2.2};${Pe*re*1.5}`,dur:"2s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",values:"0.5;0.15;0.5",dur:"2s",repeatCount:"indefinite"})]}),e.jsx("line",{x1:P-6,y1:F,x2:P+6,y2:F,stroke:"rgba(255,255,255,0.25)",strokeWidth:.5}),e.jsx("line",{x1:P,y1:F-6,x2:P,y2:F+6,stroke:"rgba(255,255,255,0.25)",strokeWidth:.5}),l&&e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:P,y1:F,x2:l.x,y2:l.y,stroke:p?"rgba(34,197,94,0.6)":"rgba(234,179,8,0.5)",strokeWidth:1,strokeDasharray:"3,3"}),e.jsx("circle",{cx:l.x+1,cy:l.y+1,r:6,fill:"rgba(0,0,0,0.4)"}),e.jsx("circle",{cx:l.x,cy:l.y,r:6,fill:p?"#22c55e":"#eab308",stroke:"#fff",strokeWidth:2,className:"drop-shadow-lg"}),e.jsx("circle",{cx:l.x,cy:l.y,r:2.5,fill:"#fff"}),p&&e.jsx("text",{x:l.x,y:l.y-14,textAnchor:"middle",fill:"#22c55e",fontSize:"10",fontWeight:"bold",children:"üîí"})]})]})]})}function gt({name:c,stats:l,isLocal:p,showCamera:b,isWinner:v,legDiff:N}){const i=typeof N=="number"?`${N>0?"+":""}${N}`:null;return e.jsxs("div",{className:`relative rounded-xl border p-2 sm:p-3 transition-all duration-500 ${v?"border-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/5 shadow-xl shadow-amber-500/10 ring-1 ring-amber-400/30":"border-white/10 bg-white/5"}`,children:[v&&e.jsxs("div",{className:"absolute -top-2.5 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-amber-500 text-black text-[9px] font-black uppercase tracking-widest rounded-full shadow-lg",children:[e.jsx(Yt,{className:"w-2.5 h-2.5 inline mr-0.5"}),"Throws First"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-black ${p?"bg-gradient-to-br from-indigo-500 to-purple-600 text-white":"bg-gradient-to-br from-rose-500 to-orange-500 text-white"}`,children:c.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-sm sm:text-base tracking-tight",children:c}),e.jsx("div",{className:"text-[9px] text-white/50 font-semibold uppercase tracking-wider",children:p?"You":"Opponent"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 mb-2",children:[e.jsx(et,{label:"Avg",value:l.avg3,highlight:!0}),e.jsx(et,{label:"F9",value:l.best9}),e.jsx(et,{label:"CO",value:String(l.bestCheckout)}),e.jsx(et,{label:i!==null?"Leg Œî":"Leg",value:i??String(l.bestLeg)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[9px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"180s"}),e.jsx("span",{className:"font-bold text-white",children:l.career180s})]}),e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Scored"}),e.jsx("span",{className:"font-bold text-white",children:l.lifetimeScored.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx("span",{className:"text-white/50",children:"Darts"}),e.jsx("span",{className:"font-bold text-white",children:l.lifetimeDarts.toLocaleString()})]})]}),b&&e.jsxs("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/40",children:[e.jsxs("div",{className:"px-2 py-1 flex items-center gap-1.5 text-[9px] text-white/60 border-b border-white/5",children:[e.jsx(dt,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-semibold uppercase tracking-wider",children:p?"Your Camera":"Opponent Camera"}),e.jsx("span",{className:"ml-auto text-emerald-400 font-bold",children:"‚óè Live"})]}),e.jsx("div",{className:"aspect-video relative bg-black",children:p?e.jsx(yt,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",tileFitModeOverride:"fit",scale:1}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/30 text-[10px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(dt,{className:"w-6 h-6 mx-auto mb-1 opacity-30"}),"Waiting for opponent's feed‚Ä¶"]})})})]})]})}function rs({open:c,matchInfo:l,localUser:p,opponentName:b,opponentStats:v,countdown:N=15,onChoice:i,onBullThrow:A,onAccept:W,onCancel:w,remoteChoice:k,bullActive:g,bullWinner:d,bullTied:j}){const[O,R]=r.useState(N),[h,o]=r.useState("preview"),[S,G]=r.useState(null),[m,u]=r.useState(null),[T,M]=r.useState(null),[f,C]=r.useState(!1),[y,V]=r.useState(!1),ie=r.useRef(typeof document<"u"?document.createElement("div"):null),ee=r.useMemo(()=>ft(p?.username||""),[p?.username]),Y=r.useMemo(()=>v?{avg3:v.avg3||"0.0",best9:v.best9||"0.0",bestCheckout:v.bestCheckout||"‚Äì",bestLeg:v.bestLeg||"‚Äì",career180s:v.career180s||0,lifetimeScored:0,lifetimeDarts:0}:ft(b),[b,v]);r.useEffect(()=>{const I=ie.current;if(!(!I||typeof document>"u"))return I.className="ndn-match-prestart-portal",document.body.appendChild(I),()=>{try{I.parentNode?.removeChild(I)}catch{}}},[]),r.useEffect(()=>{c&&(R(N),o("preview"),G(null),u(null),M(null),C(!1),V(!1))},[c,N]),r.useEffect(()=>{if(!c||h==="result"||h==="go")return;const I=window.setInterval(()=>{R(Se=>{const pe=Se-1;return pe<=0?(window.clearInterval(I),h==="preview"?(o("choice"),N):(h==="choice"&&!S&&(G("skip"),i("skip")),0)):(h==="preview"&&N-pe>=5&&o("choice"),pe)})},1e3);return()=>window.clearInterval(I)},[c,h,N,S,i]),r.useEffect(()=>{g&&(o("bull"),u(null),M(null),C(!1),V(!1))},[g]),r.useEffect(()=>{if(d){o("result");const I=setTimeout(()=>o("go"),3e3);return()=>clearTimeout(I)}},[d]),r.useEffect(()=>{j&&(u(null),M(null),C(!1),V(!1),o("bull"))},[j]),r.useEffect(()=>{if(S==="skip"&&k==="skip"){o("result");const I=setTimeout(()=>o("go"),2e3);return()=>clearTimeout(I)}},[S,k]),r.useEffect(()=>{if(h!=="go")return;const I=setTimeout(()=>{W()},1500);return()=>clearTimeout(I)},[h,W]);const B=r.useCallback((I,Se,pe)=>{f||(u({x:I,y:Se}),M(pe),C(!0))},[f]),z=r.useCallback(()=>{T!=null&&(V(!0),A(T))},[T,A]),oe=r.useCallback(I=>{G(I),i(I)},[i]),_=p?.username||"You",Q=r.useMemo(()=>Lt(_,b),[_,b]),Oe=Q.played?Q.diffA:null,te=Q.played?Q.diffB:null;if(!c||!ie.current||!l)return null;const _e=d===_,he=d===b,ge=S==="skip"&&k==="skip",ne=e.jsxs("div",{className:"fixed inset-0 z-[9998] bg-black/95 backdrop-blur-xl flex flex-col",style:{height:"100dvh",maxHeight:"100dvh",overflow:"hidden"},role:"dialog","aria-modal":"true","aria-label":"Match pre-start",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px]"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-2 sm:p-4 min-h-0",children:e.jsxs("div",{className:"relative w-full max-w-5xl max-h-full flex flex-col",children:[e.jsx("button",{className:"absolute -top-2 -right-2 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition-all border border-white/10",onClick:w,"aria-label":"Cancel match",children:e.jsx(Gt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-2 sm:mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] sm:text-[11px] font-bold uppercase tracking-widest text-white/60 mb-2",children:[e.jsx(Ye,{className:"w-3 h-3"}),l.game," ¬∑"," ",l.modeType==="bestof"?"Best Of":"First To"," ",l.legs," ¬∑ ",l.startingScore||501]}),h==="preview"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tighter",children:"Match Found"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:"Reviewing opponent stats‚Ä¶"})]}),h==="choice"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white tracking-tighter",children:"Who Throws First?"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:"Bull up to decide, or skip and let the creator go first"})]}),h==="bull"&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-amber-300 tracking-tighter",children:"üéØ Bull Up!"}),e.jsx("p",{className:"text-[10px] sm:text-xs text-white/50 mt-0.5",children:"Throw your dart at the bullseye, then tap where it landed on the board"}),e.jsx("p",{className:"text-[9px] text-white/30",children:"Both players mark their throw ‚Äî closest to the bull throws first"})]}),h==="result"&&e.jsx("div",{className:"animate-in fade-in zoom-in-95 duration-700",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-amber-500 tracking-tighter",children:["üéâ ",d," Wins the Bull!"]}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/50 mt-1",children:[d," throws first"]})]}):ge?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white tracking-tighter",children:"Both Players Skipped"}),e.jsxs("p",{className:"text-xs sm:text-sm text-white/50 mt-0.5",children:[l.createdBy||l.creatorName||_," ","throws first"]})]}):null}),h==="go"&&e.jsx("div",{className:"animate-in fade-in zoom-in-50 duration-300",children:e.jsx("h2",{className:"text-5xl sm:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500 tracking-tighter",children:"GO!"})})]}),h!=="result"&&h!=="go"&&e.jsxs("div",{className:"mb-2 sm:mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(zt,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white/40"}),e.jsx("span",{className:"text-xl sm:text-2xl font-black text-white tabular-nums",children:O}),e.jsx("span",{className:"text-[10px] sm:text-xs text-white/40 font-semibold",children:"seconds"})]}),e.jsx("div",{className:"h-0.5 sm:h-1 bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000 ease-linear",style:{width:`${O/N*100}%`}})})]}),(h==="preview"||h==="choice"||h==="result")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-2 sm:gap-4 items-start mb-2 sm:mb-4 flex-shrink-0",children:[e.jsx(gt,{name:_,stats:ee,isLocal:!0,showCamera:h==="preview",legDiff:Oe,isWinner:h==="result"&&(_e||ge&&(l.createdBy===_||l.creatorName===_))}),e.jsxs("div",{className:"hidden md:flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-indigo-500/30 ring-2 ring-white/10",children:"VS"}),e.jsx("div",{className:"w-px h-12 bg-gradient-to-b from-indigo-500/30 to-transparent mt-2"})]}),e.jsx("div",{className:"flex md:hidden items-center justify-center py-2",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-xl shadow-indigo-500/30",children:"VS"})}),e.jsx(gt,{name:b,stats:Y,isLocal:!1,showCamera:h==="preview",legDiff:te,isWinner:h==="result"&&(he||ge&&(l.createdBy===b||l.creatorName===b))})]}),h==="choice"&&!S&&e.jsx("div",{className:"flex flex-col items-center gap-3 animate-in fade-in slide-in-from-bottom-4 duration-500 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{className:"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 text-white font-black text-base sm:text-lg hover:shadow-xl hover:shadow-amber-500/30 hover:scale-105 transition-all duration-200 border border-amber-400/30",onClick:()=>oe("bull"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Bull Up"})]}),e.jsx("div",{className:"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-80",children:"Throw at the bullseye to decide"})]}),e.jsxs("button",{className:"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-white/5 border border-white/10 text-white font-bold text-base sm:text-lg hover:bg-white/10 hover:border-white/20 hover:scale-105 transition-all duration-200",onClick:()=>oe("skip"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"w-5 h-5"}),e.jsx("span",{children:"Skip"})]}),e.jsx("div",{className:"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-50",children:"Creator throws first"})]})]})}),h==="choice"&&S&&!g&&e.jsx("div",{className:"text-center animate-in fade-in duration-300",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-white/70",children:[e.jsx(ct,{className:"w-4 h-4 text-amber-400"}),"You chose"," ",e.jsx("span",{className:"font-bold text-white",children:S==="bull"?"Bull Up":"Skip"}),k?e.jsxs(e.Fragment,{children:[" ","¬∑ Opponent chose"," ",e.jsx("span",{className:"font-bold text-white",children:k==="bull"?"Bull Up":"Skip"})]}):e.jsxs(e.Fragment,{children:[" ","¬∑ Waiting for opponent",e.jsx("span",{className:"animate-pulse",children:"‚Ä¶"})]})]})}),h==="bull"&&e.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-3 animate-in fade-in zoom-in-95 duration-500 flex-1 min-h-0 overflow-hidden",children:[e.jsx("div",{className:"w-full max-w-[280px] sm:max-w-sm mx-auto rounded-xl border border-white/10 bg-black/60 overflow-hidden shadow-xl shadow-black/40 flex-shrink-0",children:e.jsxs("div",{className:"relative aspect-[16/10]",children:[e.jsx(yt,{autoStart:!0,forceAutoStart:!0,fill:!0,aspect:"free",className:"w-full h-full"}),e.jsxs("div",{className:"absolute top-1 left-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-black/60 backdrop-blur-sm border border-white/10",children:[e.jsx(dt,{className:"w-2.5 h-2.5 text-emerald-400"}),e.jsx("span",{className:"text-[9px] font-bold text-white/80 uppercase tracking-wider",children:"Live Feed"})]}),e.jsx("div",{className:"absolute top-1 right-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30",children:e.jsx("span",{className:"text-[9px] font-bold text-emerald-400",children:"‚óè LIVE"})})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] sm:text-xs text-white/50 flex-shrink-0",children:[e.jsx(Ye,{className:"w-3 h-3 text-amber-400"}),e.jsx("span",{children:"See your dart above, then tap the board below where it landed"})]}),e.jsx("div",{className:"w-full max-w-[240px] sm:max-w-[280px] md:max-w-xs mx-auto rounded-xl border border-white/10 bg-black/40 p-2 sm:p-3 shadow-2xl shadow-black/50 flex-1 min-h-0",children:e.jsx(as,{onSelect:B,selectedPoint:m,disabled:f||y,label:f?"Dart position locked":"Tap where your dart landed"})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-3 flex-shrink-0",children:[T!=null&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-xl bg-white/5 border border-white/10 animate-in fade-in duration-300",children:[e.jsx(Ye,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-xl font-black text-white tabular-nums",children:T.toFixed(1)}),e.jsx("span",{className:"text-sm text-white/50",children:"mm"})]}),y?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-xs text-white/70",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-amber-400/30 border-t-amber-400 rounded-full animate-spin"}),"Waiting for opponent‚Ä¶"]}):e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-emerald-500/30 hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:pointer-events-none border border-emerald-400/30",disabled:T==null,onClick:z,children:"‚úÖ Confirm"})]}),j&&e.jsx("div",{className:"text-xs text-amber-300 font-bold animate-bounce px-3 py-1.5 rounded-lg bg-amber-500/10 border border-amber-500/20 flex-shrink-0",children:"üîÑ It's a tie! Throw again."})]}),h==="preview"&&e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 mt-2 sm:mt-4 flex-shrink-0",children:[e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-indigo-500/30 hover:scale-105 transition-all",onClick:()=>o("choice"),children:"Ready ‚Äî Continue"}),e.jsx("button",{className:"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-white/5 border border-white/10 text-white/70 font-semibold text-sm sm:text-base hover:bg-white/10 transition-all",onClick:w,children:"Cancel"})]})]})})]});return jt.createPortal(ne,ie.current)}const ns=[...Ae].reverse();function wt(c){return c===25?"Outer Bull":c===50?"Inner Bull":String(c)}function vt({direction:c,onPickDirection:l,currentTargetIndex:p,isUsersTurn:b,onTurnComplete:v,onDartHit:N,completed:i,playerName:A}){const W=c==="bull-to-1"?ns:Ae,w=W.length,k=p>=w,[g,d]=r.useState([null,null,null]),j=g.filter(f=>f!==null).length,O=g.filter(f=>f==="hit").length,[R,h]=r.useState([]),o=p,S=W[o]??null,G=r.useCallback(()=>{d([null,null,null]),h([])},[]),m=r.useCallback(f=>{if(j>=3||k)return;const C=[...g];C[j]=f,d(C);let y=0;if(f==="hit"&&(y=W[o]??0,h(ie=>[...ie,y]),N()),j+1>=3){const ie=C.filter(Y=>Y==="hit").length,ee=f==="hit"?[...R,y].reduce((Y,B)=>Y+B,0):R.reduce((Y,B)=>Y+B,0);setTimeout(()=>{v(ie,ee),G()},350)}},[g,j,k,W,o,R,N,v,G]);if(!c)return e.jsxs("div",{className:"relative w-full rounded-2xl border-2 border-dashed border-indigo-400/40 bg-indigo-500/5 p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"text-indigo-300/70 text-xs sm:text-sm uppercase tracking-widest font-semibold mb-4",children:"Choose Direction"}),e.jsx("p",{className:"text-white/70 text-sm mb-6",children:"The first thrower picks the order for both players."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs("button",{type:"button",className:"px-6 py-4 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 active:scale-95 transition-all text-center",onClick:()=>l("1-to-bull"),children:[e.jsx("div",{className:"font-bold text-emerald-200 text-lg",children:"1 ‚Üí Bull"}),e.jsx("div",{className:"text-emerald-300/60 text-xs mt-1",children:"Start at 1, finish on Bullseye"})]}),e.jsxs("button",{type:"button",className:"px-6 py-4 rounded-2xl border border-amber-400/40 bg-amber-500/10 hover:bg-amber-500/20 active:scale-95 transition-all text-center",onClick:()=>l("bull-to-1"),children:[e.jsx("div",{className:"font-bold text-amber-200 text-lg",children:"Bull ‚Üí 1"}),e.jsx("div",{className:"text-amber-300/60 text-xs mt-1",children:"Start at Bullseye, finish on 1"})]})]})]});if(k&&j===0)return e.jsxs("div",{className:"relative w-full rounded-2xl border border-emerald-400/30 bg-emerald-500/10 p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"üéØ"}),e.jsx("div",{className:"font-bold text-emerald-200 text-xl",children:"Around the Clock Complete!"}),e.jsxs("div",{className:"text-emerald-300/60 text-sm mt-2",children:["All ",w," targets hit"]})]});const u=w>0?Math.round(i/w*100):0,T=W.slice(o+1,o+6),M=j>=3;return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider text-slate-400 font-semibold",children:"Progress"}),e.jsxs("span",{className:"text-xs text-slate-400 tabular-nums font-medium",children:[i," / ",w," (",u,"%)"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-white/10 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-300",style:{width:`${u}%`}})}),e.jsxs("div",{className:"mt-2 text-[10px] text-slate-500",children:["Direction:"," ",c==="1-to-bull"?"1 ‚Üí 20 ‚Üí Bull":"Bull ‚Üí 20 ‚Üí 1"]})]}),b&&e.jsx("div",{className:"flex items-center justify-center gap-3",children:g.map((f,C)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"text-[9px] uppercase tracking-wider text-slate-500 font-semibold",children:["Dart ",C+1]}),e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold border-2 transition-all ${f==="hit"?"bg-emerald-500/20 border-emerald-400/60 text-emerald-300":f==="miss"?"bg-rose-500/20 border-rose-400/60 text-rose-300":C===j?"bg-white/10 border-white/30 text-white/60 animate-pulse":"bg-white/5 border-white/10 text-white/20"}`,children:f==="hit"?"‚úì":f==="miss"?"‚úó":"‚Ä¢"})]},C))}),e.jsxs("div",{className:`relative w-full rounded-2xl border-2 p-6 sm:p-8 text-center transition-all ${b&&!M?"border-emerald-400/40 bg-emerald-500/5":b&&M?"border-amber-400/40 bg-amber-500/5":"border-white/10 bg-white/5 opacity-60"}`,children:[A&&e.jsx("div",{className:"text-[10px] uppercase tracking-widest text-slate-400 mb-1",children:b?"Your target":`${A}'s target`}),e.jsx("div",{className:"text-emerald-300/60 text-xs sm:text-sm uppercase tracking-widest font-semibold mb-2",children:M?"Turn Complete":`Current Target ‚Äî Dart ${j+1} of 3`}),e.jsx("div",{className:"font-mono text-6xl sm:text-7xl font-black text-white leading-none mb-4",children:k?"‚úì":S!=null?wt(S):"‚Äî"}),b&&!M&&!k&&e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{type:"button",className:"flex-1 max-w-[10rem] py-4 rounded-2xl text-lg font-bold bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border border-emerald-400/30 text-white shadow-lg shadow-emerald-600/30 transition-all active:scale-95",onClick:()=>m("hit"),children:"‚úì Hit"}),e.jsx("button",{type:"button",className:"flex-1 max-w-[10rem] py-4 rounded-2xl text-lg font-bold bg-rose-600/80 hover:bg-rose-500 active:bg-rose-400 border border-rose-400/30 text-white shadow-lg shadow-rose-600/20 transition-all active:scale-95",onClick:()=>m("miss"),children:"‚úó Miss"})]}),b&&M&&e.jsx("div",{className:"text-sm text-amber-200/70 mt-2 animate-pulse",children:"Submitting turn‚Ä¶"}),!b&&e.jsx("div",{className:"text-sm text-white/40 mt-2",children:"Waiting for opponent‚Ä¶"})]}),b&&j>0&&e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-emerald-300 font-semibold",children:["Hits: ",O]}),e.jsxs("span",{className:"text-rose-300 font-semibold",children:["Misses: ",j-O]})]}),T.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wider text-slate-500 font-semibold whitespace-nowrap",children:"Next:"}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:T.map((f,C)=>e.jsx("span",{className:"px-2.5 py-1 rounded-lg bg-white/5 border border-white/10 text-xs text-white/60 font-medium tabular-nums",children:wt(f)},C))})]})]})}function ls({user:c,showStartShowcase:l,onShowStartShowcaseChange:p,onCommitVisit:b,onQuit:v,onPause:N,onResume:i,onPauseDurationSelected:A,onStateChange:W,localPlayerIndexOverride:w,gameModeOverride:k,isOnline:g}){const d=X();ke(a=>a.hideInGameSidebar??!0),ue(a=>a.setPaused),ue(),Ot();const[j,O]=r.useState(null),[R]=r.useState(null),h=ke(a=>a.lastOffline?.x01Start||501),o=ke(a=>a.user),S=nt(c,"")||nt(o,"")||c?.email?.split("@")[0]||o?.email?.split("@")[0]||"You",G=typeof w=="number"&&w>=0?w:(d.players||[]).findIndex(a=>a?.name&&a.name===S),m=G>=0?G:0,u=(d.currentPlayerIdx??0)===m,T=d.players?.[m],M=T?.legs?.[T.legs.length-1],f=M?.totalScoreRemaining??d.startingScore??h,C=(d.players||[]).findIndex((a,x)=>x!==m),y=(d.players||[])[C>=0?C:0],V=y?.legs?.[y.legs.length-1],ie=V?.totalScoreRemaining??d.startingScore??h,ee=r.useMemo(()=>{const a=x=>{if(!x)return{lastVisit:0,avg3:0};let q=0,D=0;for(const $ of x.legs||[])q+=($.totalScoreStart??0)-($.totalScoreRemaining??0),D+=($.visits||[]).reduce((K,Z)=>K+(Z.darts||0)-(Z.preOpenDarts||0),0);const L=(x.legs?.[x.legs.length-1]?.visits||[]).slice(-1)[0];return{lastVisit:L?.score??L?.visitTotal??0,avg3:D>0?q/D*3:0}};return{local:a(T),away:a(y)}},[T,y,M?.visits?.length,V?.visits?.length]),Y=u?f:ie,B=k||d?.game||"X01",z=B==="X01",oe=Qt(B,d),_=B==="Around the Clock",[Q,Oe]=r.useState(null),[te,_e]=r.useState({});Q==="bull-to-1"?[...Ae].reverse():Ae;const he=te[m]??0,ge=te[C>=0?C:1]??0,ne=r.useMemo(()=>{const a=(x,q)=>{const D=oe[q];if(z){const L=x?.legs?.[x.legs.length-1];return{primary:String(L?.totalScoreRemaining??d.startingScore??h),primaryLabel:"Remaining"}}if(B==="Around the Clock"){const L=q===0?m:C>=0?C:1,$=te[L]??0,K=Q==="bull-to-1"?[...Ae].reverse():Ae,Z=K[$],Ue=$>=K.length?"Done!":Z===25?"Outer Bull":Z===50?"Inner Bull":String(Z);return{primary:$>=K.length?"‚úì":Ue,primaryLabel:$>=K.length?"Complete":`Target ${$+1}/${K.length}`}}if(B==="Cricket"||B==="American Cricket")return{primary:String(D?.points??0),primaryLabel:"Points"};if(B==="Killer"){const L=D?.lives??0;return{primary:D?.eliminated?"OUT":String(L),primaryLabel:D?.eliminated?"Eliminated":"Lives"}}return{primary:String(D?.score??D?.points??0),primaryLabel:"Score"}};return{local:a(T,m),away:a(y,C>=0?C:0)}},[z,B,oe,T,y,m,C,d.startingScore,h,te,Q]),I=ke(a=>a.callerEnabled),Se=ke(a=>a.callerVoice),pe=ke(a=>a.callerVolume),$e=ke(a=>a.speakCheckoutOnly),[st,Ce]=r.useState(!1),Fe=ue(a=>a.setPaused),we=ue(a=>a.paused),We=ue(a=>a.pauseEndsAt);ue(a=>a.pauseInitiator);const[Ve,qe]=r.useState(Date.now());r.useEffect(()=>(document.documentElement.setAttribute("data-ndn-ingame","true"),()=>{document.documentElement.removeAttribute("data-ndn-ingame")}),[]),r.useEffect(()=>{if(!we||!We)return;const a=setInterval(()=>{const x=Date.now();qe(x),x>=We&&Fe(!1,null)},250);return()=>clearInterval(a)},[we,We,Fe]);const ve=r.useMemo(()=>{if(!z||f>170||f<=0)return null;const a=xt(f);return a&&a.length>0?a:null},[z,f]),Xe=r.useMemo(()=>{if(!z||Y>170||Y<=0)return null;const a=xt(Y);return a&&a.length>0?a:null},[z,Y]),de=z?180:999,be=r.useMemo(()=>(d.players||[]).map(x=>({name:x.name||"Player",legsWon:x.legsWon||0})),[d.players]),at=r.useMemo(()=>(d.players||[]).some(a=>(a.legs||[]).some(x=>(x.visits||[]).length>0)),[d.players]),je=typeof l=="boolean"?l&&!at:!1,Qe=a=>{p?.(a)},[xe,ce]=r.useState(!1),[U,J]=r.useState(""),se=r.useRef(null);r.useEffect(()=>{xe&&se.current&&se.current.focus()},[xe]);const[ye,Le]=r.useState(null),[Ie,Te]=r.useState(0);r.useEffect(()=>{u?(Le(null),Te(0)):Le(Date.now())},[u]),r.useEffect(()=>{if(!ye)return;const a=setInterval(()=>{Te(Math.floor((Date.now()-ye)/1e3))},1e3);return()=>clearInterval(a)},[ye]);const le=(a,x,q)=>{if(b){b(a,x,q);return}const D=d.players?.[d.currentPlayerIdx],L=D?.legs?.[D.legs.length-1],$=L?L.totalScoreRemaining:d.startingScore,K=typeof a=="number"?a:0;let Z=$-K;if((!Number.isFinite(Z)||Z<0)&&(Z=0),I){const Ue=D?.name||nt(c,"Player");try{Vt(Ue,K,Z,Se,{volume:pe,checkoutOnly:$e})}catch{}}d.addVisit(K,x,q??{visitTotal:K}),Z===0?d.endLeg(K):d.nextPlayer(),W?.()},Ne=r.useCallback(()=>{const a=d.currentPlayerIdx??m;_e(x=>({...x,[a]:(x[a]??0)+1}))},[d.currentPlayerIdx,m]),fe=r.useCallback((a,x)=>{le(x,3,{visitTotal:x,atcHit:a>0,atcHits:a})},[]),me=r.useCallback(()=>{try{const a=[];if((d.players||[]).forEach(D=>{(D.legs||[]).forEach(L=>{if(L?.finished){const $=(L.visits||[]).slice(-1)[0];a.push({ts:L.endTime||Date.now(),visit:$,player:D})}})}),!a.length)return null;const x=a.sort((D,L)=>L.ts-D.ts)[0],q=(x.visit?.entries||[]).slice(-1)[0];if(q?.label)return q.label;if(q?.ring==="DOUBLE"&&typeof q?.value=="number")return`Double ${q.value/2}`;if(typeof x.visit?.visitTotal=="number")return`Checkout ${x.visit.visitTotal}`}catch{}return null},[d.players]);return r.useEffect(()=>{if(d.inProgress){O(null);return}if(!j?.label){const a=me();a&&O(x=>({...x,label:a}))}},[d.inProgress,me,j?.label]),e.jsxs("div",{className:"card ndn-game-shell ndn-page ndn-ingame-active relative overflow-hidden md:overflow-hidden overflow-y-auto pb-20",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-32 -left-32 w-96 h-96 rounded-full bg-indigo-600/10 blur-[120px]"}),e.jsx("div",{className:"absolute -bottom-32 -right-32 w-96 h-96 rounded-full bg-amber-500/8 blur-[120px]"})]}),je&&e.jsx(Nt,{open:je,players:d.players||[],onDone:()=>{Qe(!1)},onRequestClose:()=>{Qe(!1)},showCalibrationDefault:!0}),e.jsx("div",{className:"sticky top-0 z-20 mb-3",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-2 px-3 sm:px-5 py-2.5 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-lg",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-r from-indigo-500/10 via-transparent to-amber-500/10"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm leading-none z-10",children:[g&&e.jsx("span",{className:"px-2.5 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-[10px] sm:text-xs font-semibold tracking-wide",children:"üåê Online"}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-xs font-semibold tracking-wide",children:[B,z?` / ${d.startingScore||h}`:""]}),be.length>=2&&e.jsxs("span",{className:"font-bold text-white/90 text-sm tabular-nums",children:["Legs: ",be[0].legsWon," ‚Äì ",be[1].legsWon]})]}),e.jsxs("div",{className:"flex items-center gap-2 z-10",children:[e.jsx(_t,{}),e.jsx("button",{className:"px-4 py-1.5 rounded-xl text-sm font-semibold bg-rose-600/90 hover:bg-rose-500 text-white border border-rose-400/30 shadow-lg shadow-rose-500/20 transition-all",onClick:()=>Ce(!0),children:"‚è∏ Quit / Pause"})]})]})}),e.jsxs("div",{className:"relative mb-4 rounded-2xl border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-950/80 via-slate-900/90 to-amber-950/80"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(255,255,255,0.03),transparent_70%)]"}),e.jsxs("div",{className:"relative grid grid-cols-[minmax(0,1fr)_minmax(120px,auto)_minmax(0,1fr)] items-center py-4 sm:py-6 px-3 sm:px-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`text-xs sm:text-sm font-bold uppercase tracking-widest ${u?"text-emerald-400":"text-slate-400"}`,children:T?.name||"You"}),e.jsx("div",{className:"text-[10px] sm:text-xs uppercase tracking-wider text-slate-500 font-medium",children:ne.local.primaryLabel}),e.jsx("div",{className:`font-mono text-5xl sm:text-7xl md:text-8xl font-black tabular-nums leading-none ${u?"text-white":"text-white/60"}`,children:ne.local.primary}),u?e.jsx("div",{className:"mt-1 px-3 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/40 text-emerald-300 text-[10px] sm:text-xs font-semibold uppercase tracking-wider animate-pulse",children:"‚óè Throwing"}):e.jsx("div",{className:"mt-1 px-3 py-0.5 text-[10px] sm:text-xs invisible","aria-hidden":!0,children:"‚óè ¬†"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[z&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-400 tabular-nums",children:["Legs: ",T?.legsWon||0]}),ee.local.avg3>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-400 tabular-nums",children:["Avg: ",ee.local.avg3.toFixed(1)]}),ee.local.lastVisit>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-500 tabular-nums",children:["Last: ",ee.local.lastVisit]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 px-2 sm:px-4 min-w-[120px]",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-px h-6 sm:h-10 bg-gradient-to-b from-transparent via-white/20 to-transparent"}),e.jsx("div",{className:"text-xs sm:text-lg font-black text-white/30 tracking-widest",children:"VS"}),e.jsx("div",{className:"w-px h-6 sm:h-10 bg-gradient-to-b from-transparent via-white/20 to-transparent"})]}),g&&!_&&e.jsxs("button",{type:"button",className:`w-full rounded-xl border px-3 py-2 text-center transition-all ${u?"bg-emerald-500/15 border-emerald-400/30 text-emerald-100 hover:bg-emerald-500/25":"bg-white/5 border-white/10 text-white/40 cursor-not-allowed"}`,onClick:()=>{u&&(J(""),ce(!0))},disabled:!u,children:[e.jsx("div",{className:"text-[9px] sm:text-[10px] uppercase tracking-widest font-semibold opacity-80",children:u?"Enter Score":"Waiting"}),e.jsx("div",{className:"font-mono text-2xl sm:text-3xl font-black tabular-nums",children:u?"Tap":"‚Äî"}),e.jsx("div",{className:"text-[9px] sm:text-[10px] uppercase tracking-wider opacity-70",children:u?"Open Numpad":"Opponent Turn"})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`text-xs sm:text-sm font-bold uppercase tracking-widest ${u?"text-slate-400":"text-amber-400"}`,children:y?.name||"Opponent"}),e.jsx("div",{className:"text-[10px] sm:text-xs uppercase tracking-wider text-slate-500 font-medium",children:ne.away.primaryLabel}),e.jsx("div",{className:`font-mono text-5xl sm:text-7xl md:text-8xl font-black tabular-nums leading-none ${u?"text-white/60":"text-white"}`,children:ne.away.primary}),u?e.jsx("div",{className:"mt-1 px-3 py-0.5 text-[10px] sm:text-xs invisible","aria-hidden":!0,children:"‚óè ¬†"}):e.jsx("div",{className:"mt-1 px-3 py-0.5 rounded-full bg-amber-500/20 border border-amber-400/40 text-amber-300 text-[10px] sm:text-xs font-semibold uppercase tracking-wider animate-pulse",children:"‚óè Throwing"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[z&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-400 tabular-nums",children:["Legs: ",y?.legsWon||0]}),ee.away.avg3>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-400 tabular-nums",children:["Avg: ",ee.away.avg3.toFixed(1)]}),ee.away.lastVisit>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-slate-500 tabular-nums",children:["Last: ",ee.away.lastVisit]})]})]})]}),Xe&&e.jsxs("div",{className:`relative border-t px-4 py-2 flex items-center gap-3 ${u?"border-emerald-400/20 bg-emerald-500/10":"border-amber-400/20 bg-amber-500/10"}`,children:[e.jsxs("span",{className:`text-[10px] sm:text-xs uppercase tracking-wider font-semibold whitespace-nowrap ${u?"text-emerald-300/80":"text-amber-300/80"}`,children:["Checkout ",Y,":"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Xe.map((a,x)=>e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs sm:text-sm font-medium ${u?"bg-emerald-500/20 border border-emerald-400/20 text-emerald-100":"bg-amber-500/20 border border-amber-400/20 text-amber-100"}`,children:a},x))})]})]}),e.jsxs("div",{className:"ndn-shell-body",children:[!u&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-400 shadow-lg shadow-amber-400/50 animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-white/80",children:"Board Camera"})]}),e.jsxs("span",{className:"text-[10px] sm:text-xs font-medium text-amber-300",children:["Waiting for ",y?.name||"opponent","‚Ä¶"]})]}),e.jsxs("div",{className:"relative min-h-[12rem] max-h-[50vh] bg-black",children:[e.jsx($t,{hideInlinePanels:!0,forceAutoStart:!0}),z&&e.jsx(Ft,{checkoutRemaining:f,away:{side:"Away",name:y?.name||"Away",legsWon:y?.legsWon||0,remaining:ie},home:{side:"Home",name:T?.name||"Home",legsWon:T?.legsWon||0,remaining:f}})]})]}),e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-3 sm:p-4 overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-br from-white/[0.02] to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm sm:text-base font-bold text-white/90 tracking-wide",children:"Scoreboard"}),e.jsxs("div",{className:"px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold bg-amber-500/20 border border-amber-400/30 text-amber-300",children:[y?.name||"Opponent","'s turn"]})]}),e.jsx(mt,{gameMode:B,players:oe})]}),_&&Q&&e.jsx(vt,{direction:Q,onPickDirection:()=>{},currentTargetIndex:ge,isUsersTurn:!1,onTurnComplete:()=>{},onDartHit:()=>{},completed:ge,playerName:y?.name||"Opponent"})]}),u&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-3 sm:p-4 overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-br from-emerald-500/[0.03] to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm sm:text-base font-bold text-white/90 tracking-wide",children:"Scoreboard"}),e.jsx("div",{className:"px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold bg-emerald-500/20 border border-emerald-400/30 text-emerald-300 animate-pulse",children:"‚óè Your turn"})]}),e.jsx(mt,{gameMode:B,players:oe})]}),_&&e.jsx(vt,{direction:Q,onPickDirection:a=>Oe(a),currentTargetIndex:he,isUsersTurn:u,onTurnComplete:fe,onDartHit:Ne,completed:he,playerName:T?.name||"You"}),!_&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"relative w-full rounded-2xl border-2 border-dashed border-emerald-400/40 bg-emerald-500/5 hover:bg-emerald-500/10 active:scale-[0.98] transition-all p-6 sm:p-8 text-center group cursor-pointer focus:outline-none focus:ring-2 focus:ring-emerald-400/50",onClick:()=>{J(""),ce(!0)},children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-br from-emerald-500/[0.05] to-transparent"}),e.jsx("div",{className:"text-emerald-300/60 text-xs sm:text-sm uppercase tracking-widest font-semibold mb-2",children:"Enter Score"}),e.jsx("div",{className:"font-mono text-4xl sm:text-5xl font-black text-emerald-200 group-hover:text-emerald-100 transition-colors",children:ne.local.primary}),e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 text-sm font-semibold",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),e.jsx("path",{d:"M8 8h.01M12 8h.01M16 8h.01M8 12h.01M12 12h.01M16 12h.01M8 16h.01M12 16h.01M16 16h.01",strokeLinecap:"round"})]}),"Tap to enter score"]}),ve&&e.jsx("div",{className:"mt-3 flex flex-wrap justify-center gap-1.5",children:ve.map((a,x)=>e.jsx("span",{className:"px-2 py-0.5 rounded-lg bg-emerald-500/20 border border-emerald-400/20 text-emerald-100 text-xs font-medium",children:a},x))})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:(z?[180,140,100,85,60,45,26,0]:[100,80,60,45,26,20,10,0]).map(a=>e.jsx("button",{className:"px-4 py-2.5 rounded-xl text-sm font-bold bg-white/5 hover:bg-white/10 active:bg-white/15 border border-white/10 text-white/90 transition-all active:scale-95",onClick:()=>le(a,3,{visitTotal:a}),children:a},a))})]}),j?.label&&e.jsxs("div",{className:"rounded-2xl border border-emerald-400/30 bg-emerald-500/10 px-4 py-3 text-center",children:[e.jsx("span",{className:"text-xs text-emerald-400/70 uppercase tracking-wider font-semibold",children:z?"Winning Double":"Winning Shot"}),e.jsx("div",{className:"text-lg font-bold text-emerald-200 mt-0.5",children:j.label})]})]})]}),xe&&!_&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",onClick:()=>ce(!1),onKeyDown:a=>{a.key==="Escape"&&ce(!1)},children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full max-w-sm mx-auto mb-0 sm:mb-0 rounded-t-3xl sm:rounded-3xl border border-white/10 bg-slate-900/95 backdrop-blur-xl shadow-2xl p-4 sm:p-6 animate-[slideUp_0.2s_ease-out]",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"mb-4 rounded-2xl bg-black/40 border border-white/10 p-4 text-center",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-widest text-slate-400 mb-1",children:"Score"}),e.jsx("input",{ref:se,type:"number",inputMode:"numeric",pattern:"[0-9]*",className:"w-full bg-transparent font-mono text-5xl sm:text-6xl font-black text-white tabular-nums min-h-[3.5rem] leading-none text-center outline-none border-none [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none placeholder:text-white/20",placeholder:"0",value:U,onChange:a=>{const x=a.target.value.replace(/[^0-9]/g,"");(x===""||Number(x)<=de)&&J(x)},onKeyDown:a=>{if(a.key==="Enter"){a.preventDefault();const x=Math.max(0,Math.min(de,Number(U)||0));le(x,3,{visitTotal:x}),J(""),ce(!1)}}}),U&&ve&&Number(U)===f&&e.jsx("div",{className:"mt-2 text-xs text-emerald-300 font-semibold",children:"‚úì Checkout!"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx("button",{className:"py-3.5 rounded-xl text-xl font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white transition-all active:scale-95",onClick:()=>{const x=U+String(a);Number(x)<=de&&J(x),se.current?.focus()},children:a},a)),e.jsx("button",{className:"py-3.5 rounded-xl text-lg font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white/60 transition-all active:scale-95",onClick:()=>{J(a=>a.slice(0,-1)),se.current?.focus()},children:"‚å´"}),e.jsx("button",{className:"py-3.5 rounded-xl text-xl font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white transition-all active:scale-95",onClick:()=>{const a=U+"0";Number(a)<=de&&J(a),se.current?.focus()},children:"0"}),e.jsx("button",{className:"py-3.5 rounded-xl text-lg font-bold bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border border-emerald-400/30 text-white shadow-lg shadow-emerald-600/30 transition-all active:scale-95",onClick:()=>{const a=Math.max(0,Math.min(de,Number(U)||0));le(a,3,{visitTotal:a}),J(""),ce(!1)},children:"‚úì"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center mb-3",children:(z?[180,140,100,85,60,45,26,0]:[100,80,60,45,26,20,10,0]).map(a=>e.jsx("button",{className:"px-3 py-1.5 rounded-lg text-xs font-bold bg-white/5 hover:bg-white/10 border border-white/10 text-white/80 transition-all active:scale-95",onClick:()=>{le(a,3,{visitTotal:a}),J(""),ce(!1)},children:a},a))}),e.jsx("button",{className:"w-full py-2.5 rounded-xl text-sm font-semibold text-white/50 hover:text-white/80 hover:bg-white/5 transition-all",onClick:()=>ce(!1),children:"Cancel"})]})]}),!_&&!xe&&!st&&!we&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-30 bg-slate-900/95 backdrop-blur-xl border-t border-white/10 px-3 py-2 safe-bottom",children:e.jsxs("div",{className:"flex items-center gap-2 max-w-lg mx-auto",children:[e.jsx("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",className:`flex-1 border rounded-xl px-4 py-3 font-mono text-xl font-bold text-center outline-none [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none placeholder:text-white/30 ${u?"bg-white/5 border-white/15 text-white focus:border-emerald-400/50 focus:ring-1 focus:ring-emerald-400/30":"bg-white/3 border-white/10 text-white/50"}`,placeholder:u?"Type score...":"Waiting for opponent...",value:U,disabled:!u,onChange:a=>{const x=a.target.value.replace(/[^0-9]/g,"");(x===""||Number(x)<=de)&&J(x)},onKeyDown:a=>{if(a.key==="Enter"){a.preventDefault();const x=Math.max(0,Math.min(de,Number(U)||0));U!==""&&(le(x,3,{visitTotal:x}),J(""))}}}),e.jsx("button",{className:`px-5 py-3 rounded-xl text-sm font-bold text-white border transition-all active:scale-95 whitespace-nowrap ${u&&U!==""?"bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border-emerald-400/30 shadow-lg shadow-emerald-600/20":"bg-slate-700 border-white/10 opacity-50 cursor-not-allowed"}`,disabled:!u||U==="",onClick:()=>{const a=Math.max(0,Math.min(de,Number(U)||0));le(a,3,{visitTotal:a}),J("")},children:"Submit"}),u&&e.jsx("button",{className:"px-3 py-3 rounded-xl text-sm font-semibold bg-white/5 hover:bg-white/10 text-white/70 border border-white/10 transition-all",onClick:()=>{J(""),ce(!0)},children:"‚å®"})]})}),st&&e.jsx(Wt,{onClose:()=>Ce(!1),onQuit:()=>{if(Ce(!1),v)v();else{try{d.endGame()}catch{}try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}}},onPause:()=>{try{Fe(!0,null,S)}catch{}try{ut({type:"pause",pauseStartedAt:Date.now(),pauseInitiator:S})}catch{}N&&N(),Ce(!1)}}),e.jsx(Jt,{localPlayerName:S,onResume:()=>{Fe(!1,null);try{ut({type:"unpause"})}catch{}i&&i()},onDurationSelected:(a,x)=>{A&&A(a,x)}})]})}function ms({user:c}){const l=c?.username||"You",[p,b]=r.useState(0),[v,N]=r.useState(()=>[{id:1,name:"room-1",matches:[]}]),i=(()=>{try{return Ut()}catch{return null}})(),[A,W]=r.useState([]),w=X(t=>t.inProgress),k=X(t=>t.players),[g,d]=r.useState(!1),j=r.useRef(null),O=String(c?.email||"").toLowerCase()==="daviesfamily108@gmail.com";r.useEffect(()=>{if(!g)return;function t(s){try{if(!j.current)return;j.current.contains(s.target)||d(!1)}catch{}}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[g]);const[R,h]=r.useState(!1),o=Me.useRef(!1);r.useEffect(()=>{if(!w){o.current=!1,h(!1);return}o.current||(X.getState().players||[]).some(n=>(n.legs||[]).some(E=>(E.visits||[]).length>0))||(o.current=!0,h(!0))},[w]),r.useEffect(()=>{if(w)try{const t=X.getState();if((t?.game||"X01")!=="X01"||!t.roomId)return;const n=`ndn:matchWindowOpened:${t.roomId}`;if(window.sessionStorage.getItem(n)==="1")return;window.sessionStorage.setItem(n,"1"),Kt()}catch{}},[w]),r.useEffect(()=>{w||(o.current=!1)},[w]),r.useEffect(()=>{if(i?.connected&&c?.username)try{i.send({type:"presence",username:c.username,email:c.email||""})}catch{}},[i?.connected,c]),r.useEffect(()=>(window.__ndn_online_mounted=!0,()=>{window.__ndn_online_mounted=!1}),[]),r.useEffect(()=>{const t=()=>{try{X.getState().endGame()}catch{}f(null),y(null),u(null),te(null),ve(null),V.current=null;try{window.__ndn_pending_invite=null}catch{}};try{window.addEventListener("ndn:match-quit",t)}catch{}return()=>{try{window.removeEventListener("ndn:match-quit",t)}catch{}}},[]);const[S,G]=r.useState(!1),[m,u]=r.useState(null),T=Me.useRef(null),[M,f]=r.useState(null),[C,y]=r.useState(null),V=r.useRef(null),[ie,ee]=r.useState(null),[Y,B]=r.useState({}),[z,oe]=r.useState(30),_=r.useRef([]);r.useEffect(()=>{_.current=A||[]},[A]),r.useEffect(()=>{m&&(V.current={...m})},[m]);const Q=Me.useRef(!1),[Oe,te]=r.useState(null),[_e,he]=r.useState({}),[ge,ne]=r.useState(!1),[I,Se]=r.useState(null),[pe,$e]=r.useState(null),[st,Ce]=r.useState(null),[Fe,we]=r.useState(!1),[We,Ve]=r.useState(!1),[qe,ve]=r.useState(null),[Xe,de]=r.useState("X01"),[be,at]=r.useState(""),[je,Qe]=r.useState("all"),[xe,ce]=r.useState("all"),[U,J]=r.useState("newest"),[se,ye]=r.useState(1),Le=12,Ie=v[p],Te=999,le=Me.useCallback(t=>{if(!t)return t;const s=t.modeType||t.mode||"",n=t.legs??t.value??t.bestOf??t.sets??t.games??1,E=t.createdBy||t.creatorName||t.creator||t.host||"",H=t.createdAt||t.ts||Date.now();return{...t,modeType:s,mode:s||t.mode,legs:n,value:typeof t.value=="number"?t.value:n,createdBy:E,creatorName:t.creatorName||E,createdAt:H}},[]),Ne=r.useMemo(()=>(t=[])=>(t||[]).map(le).filter(s=>!(s?.isTest||s?.test||s?.migrated||s?.isMigration||s?.migration||s?.seeded||s?.status==="completed"||s?.status==="played"||s?.declineCount&&s.declineCount>=3||typeof s?.createdBy=="string"&&s.createdBy.toLowerCase().includes("test")||typeof s?.creatorName=="string"&&s.creatorName.toLowerCase().includes("test")||typeof s?.createdBy=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(s.createdBy)||typeof s?.creatorName=="string"&&/^(alice-|host-|demo|dummy|sample)/i.test(s.creatorName)||!(s?.game&&s?.modeType&&s?.legs))),[le]),fe=r.useMemo(()=>{let t=Ne(Ie?.matches||[]);if((t?.length||0)===0&&(A?.length||0)>0&&(t=Ne(A)),(t?.length||0)===0&&(_.current?.length||0)>0&&(t=Ne(_.current)),be.trim()){const s=be.toLowerCase();t=t.filter(n=>(n.game||"").toLowerCase().includes(s)||(n.createdBy||n.creatorName||"").toLowerCase().includes(s)||(n.id||"").toLowerCase().includes(s))}return je!=="all"&&(t=t.filter(s=>(s.game||"").toLowerCase()===je)),xe!=="all"&&(t=t.filter(s=>{const n=(s.modeType||"").replace("_","").toLowerCase(),E=xe.replace("_","").toLowerCase();return n.includes(E)})),t=(t||[]).slice(),t.sort((s,n)=>{const E=s.createdAt||0,H=n.createdAt||0;return U==="newest"?H-E:E-H}),t.slice(0,Te)},[Ie,A,Ne,be,je,xe,U,Te]);r.useEffect(()=>{ye(1)},[be,je,xe,U,p]);const me=Math.ceil(fe.length/Le),a=fe.slice((se-1)*Le,se*Le),x=()=>{fe.length>0&&Z(fe[0])},q=t=>{const s={id:`m-${Date.now()}`,createdBy:t.createdBy||l,game:t.game,modeType:t.modeType,legs:t.legs,startingScore:t.startingScore,createdAt:Date.now()};i?.connected||N(n=>n.map((E,H)=>H===p?{...E,matches:[s,...E.matches]}:E));try{i?.connected&&(c?.username&&i.send({type:"presence",username:c.username,email:c.email||""}),i.send({type:"create-match",game:t.game,mode:t.modeType,value:t.legs,startingScore:t.startingScore,creatorAvg:t.avgChoice||0}))}catch{}},D=()=>{W([]),N(t=>{const s=t.length+1,n=[...t,{id:s,name:`room-${s}`,matches:[]}];return b(n.length-1),n})},L=Me.useCallback(t=>{try{if(console.log("[OnlinePlay] handleInviteOrPrestart:",t?.type,t),t?.type==="invite"){const s={id:t.matchId,game:t.game,mode:t.mode||"firstto",value:t.value||1,startingScore:t.startingScore||501,fromName:t.fromName||"Opponent",fromId:t.fromId};f(s);try{const n=new Audio("/sounds/notify.mp3");n.volume=.5,n.play().catch(()=>{})}catch{}}if(t?.type==="invite-waiting"&&y(t.creatorName||"Creator"),t?.type==="match-prestart"){if(X.getState().inProgress)return;f(null),y(null);const s=le(t.match||null);if(s&&(s.prestartEndsAt=t.prestartEndsAt),s){const E=(c?.username||"").toLowerCase(),H=(s.creatorName||s.createdBy||"").toLowerCase();E&&H===E&&(s._isCreatorView=!0)}try{s?.creatorId&&s?.creatorName&&B(E=>({...E,[s.creatorId]:s.creatorName}))}catch{}Q.current=!0,u(s);const n=t.prestartEndsAt||Date.now();oe(Math.max(0,Math.ceil(((n||Date.now())-Date.now())/1e3))),setTimeout(()=>{Q.current=!1},0),te(null),he({}),ne(!1),Se(null),$e(null),Ve(!1)}t?.type==="invite-expired"&&(f(null),y(null),u(s=>s&&t.matchId===s.id?null:s)),t?.type==="declined"&&(f(null),y(null),u(s=>s&&t.matchId===s.id?null:s))}catch{}},[le,c]),$=Me.useCallback(t=>{if(t?.type!=="match-start"||X.getState().inProgress)return;const s=t.match||{},n=V.current||{},E=t.roomId||n.id||"",H=s.startingScore||n.startingScore||501,ae=l,Ge=s.creatorName||n.creatorName||n.createdBy||"",De=s.joinerName||n.joinerName||"",Re=t.firstThrowerId||t.firstPlayerId||null,Be=n._isCreatorView||Ge.toLowerCase()===ae.toLowerCase(),Je=Be?De||"Opponent":Ge||"Opponent";let ze;if(Re){const Ke=s.creatorId||n.creatorId;ze=Be?Re===Ke:Re!==Ke}else ze=Be;const Tt=ze?[ae,Je]:[Je,ae];try{X.getState().newMatch(Tt,H,E)}catch(Ke){console.error("[OnlinePlay] newMatch failed:",Ke)}const Mt=s.game||n.game||"X01";de(Mt);try{i?.connected&&i.send({type:"join",roomId:E})}catch{}V.current=null,u(null),te(null),he({})},[l,i]);r.useEffect(()=>i?(i.connected&&i.send({type:"list-matches"}),i.addListener(s=>{try{if(s?.type==="joined"&&s.id&&ee(s.id),s?.type==="presence")try{s.id&&B(n=>({...n,[s.id]:s.username||s.name||s.id}))}catch{}if(s?.type==="matches"){const n=Ne(s.matches||[]);W(n),_.current=n,N(E=>E.map((H,ae)=>ae===p?{...H,matches:n}:H))}if(L(s),s?.type==="match-start"&&$(s),s?.type==="prestart-choice-notify"){const{roomId:n,playerId:E,choice:H}=s;if(!n||!H)return;he(ae=>({...ae||{},[E]:H}))}if(s?.type==="prestart-bull"&&(ne(!0),we(!1),Ce(null)),s?.type==="prestart-bull-winner"&&($e(s.winnerName||s.winnerId||null),ne(!1),we(!1),Ve(!1)),s?.type==="prestart-bull-tie"&&($e(null),ne(!1),we(!1),Ve(!0),setTimeout(()=>Ve(!1),2e3)),s?.type==="opponent-quit"&&ve(s.quitterName||"Opponent"),s?.type==="opponent-paused")try{ue.getState().setPaused(!0,null,s.pauserName||"Opponent")}catch{}if(s?.type==="opponent-unpaused")try{ue.getState().setPaused(!1,null)}catch{}}catch{}})):void 0,[i,Oe,Ne,p,L,$]),r.useEffect(()=>{try{const s=window.__ndn_pending_invite;s&&(window.__ndn_pending_invite=null,s.type==="match-start"?$(s):L(s))}catch{}const t=s=>{try{const n=s.detail;if(!n)return;n.type==="match-start"?$(n):L(n)}catch{}};return window.addEventListener("ndn:match-invite",t),()=>window.removeEventListener("ndn:match-invite",t)},[L,$]),r.useEffect(()=>{if(!m||Q.current||m.prestartEndsAt)return;oe(30),te(null),he({});const t=setInterval(()=>oe(s=>Math.max(0,s-1)),1e3);return()=>clearInterval(t)},[m]),r.useEffect(()=>{m&&setTimeout(()=>T.current?.focus(),0)},[m]);const K=()=>{h(!0),m&&(V.current={...m});try{if(i?.connected&&m?.id){const t=!!m._isCreatorView;i.send({type:"invite-response",matchId:m.id,accept:!0,toId:t?m.joinerId:m.creatorId})}}catch{}u(null)},Z=t=>{u(t);try{i?.connected&&(c?.username&&i.send({type:"presence",username:c.username,email:c.email||""}),i.send({type:"join-match",matchId:t.id,calibrated:!0}))}catch{}},Ue=t=>{te(t);try{i?.connected&&m?.id&&i.send({type:"prestart-choice",roomId:m.id,choice:t})}catch{}},rt=Me.useCallback(()=>{try{if(i?.connected){const t=X.getState();i.send({type:"state",payload:t})}}catch{}},[i]),Ct=()=>{Zt({players:[l,"Opponent"],startingScore:501,roomId:"online-demo",visits:[{score:60},{score:85},{score:100}]})};if(w){const s=(X.getState().players||[]).findIndex(n=>n?.name&&n.name.toLowerCase()===l.toLowerCase());return e.jsxs(e.Fragment,{children:[e.jsx(ls,{user:c,showStartShowcase:R,onShowStartShowcaseChange:h,onCommitVisit:(n,E,H)=>{try{const ae=X.getState(),Ge=ae.players[ae.currentPlayerIdx],De=Ge?.legs?.[Ge.legs.length-1],Re=De?De.totalScoreRemaining:ae.startingScore,Be=Math.max(0,Re-n),Je=Re<=50?3:Be<=50?1:0,ze=Be===0;ae.addVisit(n,3,{preOpenDarts:0,doubleWindowDarts:Je,finishedByDouble:ze,visitTotal:n}),De&&De.totalScoreRemaining===0?ae.endLeg(n):ae.nextPlayer()}catch{X.getState().addVisit(n,3),X.getState().nextPlayer()}rt()},onQuit:()=>{try{X.getState().endGame()}catch{}try{i?.connected&&i.send({type:"match-quit"})}catch{}f(null),y(null),u(null),te(null),ve(null),V.current=null;try{window.__ndn_pending_invite=null}catch{}rt();try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},onPause:()=>{try{ue.getState().setPaused(!0,null,l)}catch{}try{i?.connected&&i.send({type:"match-pause"})}catch{}},onResume:()=>{try{ue.getState().setPaused(!1,null)}catch{}try{i?.connected&&i.send({type:"match-unpause"})}catch{}},onStateChange:rt,localPlayerIndexOverride:s>=0?s:void 0,gameModeOverride:Xe,isOnline:!0}),qe&&e.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl",children:[e.jsx("div",{className:"text-4xl mb-3",children:"üö™"}),e.jsxs("h3",{className:"text-lg font-bold text-white mb-2",children:[qe," left the match"]}),e.jsx("p",{className:"text-sm text-white/60 mb-5",children:"Your opponent has quit. You can leave the match now."}),e.jsx("button",{className:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all",onClick:()=>{try{X.getState().endGame()}catch{}ve(null),f(null),y(null),u(null),te(null),V.current=null;try{window.__ndn_pending_invite=null}catch{}try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},children:"Leave Match"})]})})]})}return e.jsx("div",{className:"flex-1 min-h-0 ndn-page",style:{position:"relative",marginTop:0},children:e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col",children:[R&&e.jsx(Nt,{players:k||[],user:c,onDone:()=>h(!1),onRequestClose:()=>h(!1)}),e.jsx("h2",{className:"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title",children:"Online Lobby üåê"}),e.jsx("div",{className:"ndn-shell-body flex-1 overflow-hidden p-3 pb-0",children:e.jsxs("div",{className:"h-full flex flex-col gap-3",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"text-sm text-white/70",children:"Room"}),e.jsxs("div",{className:"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium",children:["Room (",Ie?.id,")"]}),e.jsx("button",{className:"btn btn-ghost btn-sm rounded-lg",onClick:D,children:"New Room"})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg",onClick:()=>G(!0),disabled:(Ie?.matches?.length||0)>=Te,children:[e.jsx(qt,{className:"w-4 h-4"}),"Create Match +"]}),O&&e.jsx("button",{className:"btn btn-sm btn-ghost rounded-lg",onClick:Ct,children:"Demo In-Play"}),(Ie?.matches?.length||0)>=Te&&e.jsx("div",{className:"text-xs text-rose-400",children:"Room full ‚Äî create a new room"})]})]}),!w&&e.jsx("div",{className:"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3",children:e.jsxs("div",{className:"ndn-filterbar",children:[e.jsxs("div",{className:"flex-1 min-w-[240px] relative",children:[e.jsx(Xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",placeholder:"Search matches, players...",className:"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all",value:be,onChange:t=>at(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:je,onChange:t=>Qe(t.target.value),children:[e.jsx("option",{value:"all",children:"All Games"}),e.jsx("option",{value:"x01",children:"X01"}),e.jsx("option",{value:"cricket",children:"Cricket"}),e.jsx("option",{value:"bermuda",children:"Bermuda"}),e.jsx("option",{value:"gotcha",children:"Gotcha"})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:xe,onChange:t=>ce(t.target.value),children:[e.jsx("option",{value:"all",children:"All Modes"}),e.jsx("option",{value:"first_to",children:"First To"}),e.jsx("option",{value:"best_of",children:"Best Of"})]}),e.jsxs("select",{className:"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg",value:U,onChange:t=>J(t.target.value),children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${g?"bg-red-600 text-white border-red-500":"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900"}`,onClick:()=>d(t=>!t),"aria-pressed":g,title:"Toggle focus mode: hide small details and show focused view",children:g?"Exit Focus":"Focus Mode"})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg",onClick:x,disabled:fe.length===0,children:[e.jsx(ct,{className:"w-4 h-4 fill-current"}),"Quick Join"]})})]})}),e.jsxs("div",{className:"flex-1 overflow-auto flex flex-col",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(ht,{className:"w-5 h-5 text-indigo-400"}),"Active Matches ÔøΩÔ∏è"]}),e.jsx("div",{className:"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col",children:e.jsxs("div",{className:"flex-1 overflow-auto",children:[(fe.length||0)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center opacity-60",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4",children:e.jsx(Ye,{className:"w-8 h-8 text-white/20"})}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No matches found"}),e.jsx("p",{className:"text-sm max-w-xs mx-auto",children:"Create a new match to get started or try adjusting your filters."})]}):null,(fe.length||0)!==0&&e.jsxs("div",{className:"relative",children:[g&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out",children:e.jsx("button",{onClick:()=>d(!1),className:"w-full text-center",children:"FOCUS MODE ‚Äî Click to exit"})})}),e.jsx("div",{ref:j,className:`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 max-h-[28rem] overflow-auto p-1 ${g?"opacity-90":""}`,"data-testid":"matches-grid",children:a.map(t=>e.jsxs("div",{className:"group relative p-4 rounded-lg border border-slate-700/30 bg-slate-950/40 hover:border-indigo-500/50 hover:bg-slate-900/50 transition-all duration-150 shadow-sm hover:shadow-[0_8px_24px_-12px_rgba(99,102,241,0.4)] flex flex-col gap-3 min-h-[6.5rem]","data-testid":`match-${t.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[!g&&e.jsx("div",{className:"w-9 h-9 rounded-full bg-indigo-500/10 flex items-center justify-center border border-indigo-500/20 group-hover:border-indigo-500/40 transition-colors text-xs font-bold",children:t.createdBy?(t.createdBy||"U").substring(0,2).toUpperCase():(t.creatorName||"U").substring(0,2).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-bold text-white group-hover:text-indigo-300 transition-colors truncate",children:t.game}),e.jsxs("div",{className:"text-xs text-white/50 flex items-center gap-1",children:[e.jsx(pt,{className:"w-3 h-3"}),new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})}),t.roomName&&e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-none bg-slate-950 border border-slate-850 text-white/70",children:t.roomName})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm text-white/70 bg-transparent border-t border-slate-850 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 rounded-none bg-white/5 text-xs font-medium border border-slate-850",children:t.modeType==="bestof"?"Best Of":"First To"}),e.jsx("span",{className:"font-mono text-indigo-300",children:t.legs}),e.jsx("span",{children:"legs"}),t.startingScore&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-white/20"}),e.jsx("span",{className:"font-mono text-amber-300",children:t.startingScore})]})]}),!g&&e.jsxs("div",{className:"text-xs text-white/40 flex items-center gap-1 mt-1",children:[e.jsx(ht,{className:"w-3 h-3"}),"Created by:"," ",e.jsx("span",{className:"text-white/60",children:t.createdBy||t.creatorName||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2 border-t border-white/5",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:!g&&e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white",children:(t.createdBy||t.creatorName||"U").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-xs text-white/60 truncate max-w-[120px]",children:t.createdBy||t.creatorName})]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{className:"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-4 rounded-none",onClick:()=>Z(t),children:"Join"})})]})]},t.id))})]}),me>1&&e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5",children:[e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:se===1,onClick:()=>ye(t=>Math.max(1,t-1)),children:[e.jsx(bt,{className:"w-4 h-4 rotate-90"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,me)},(t,s)=>{let n=s+1;return me>5&&(se>3&&(n=se-2+s),n>me&&(n=me-4+s)),e.jsx("button",{className:`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${se===n?"bg-indigo-600 text-white shadow-sm":"bg-slate-950 text-white/70 hover:bg-slate-900"}`,onClick:()=>ye(n),children:n},n)})}),e.jsxs("button",{className:"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30",disabled:se===me,onClick:()=>ye(t=>Math.min(me,t+1)),children:["Next",e.jsx(bt,{className:"w-4 h-4 -rotate-90"})]})]})]})})]})]})}),e.jsx(es,{open:S,onClose:()=>G(!1),onCreate:t=>{q(t),G(!1)}}),M&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative w-full max-w-md mx-4 p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-indigo-500/30 shadow-2xl shadow-indigo-500/20",children:[e.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 ring-2 ring-indigo-500/30",children:e.jsx(ct,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-white",children:"Match Invite!"}),e.jsx("p",{className:"text-sm text-white/60",children:"Someone wants to play"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold text-sm",children:(M.fromName||"?").substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white text-lg",children:M.fromName||"Opponent"}),e.jsx("div",{className:"text-xs text-white/50",children:"wants to join your match"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-sm text-white/70",children:[e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-medium",children:M.game||"X01"}),e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10",children:[M.mode==="bestof"?"Best Of":"First To"," ",M.value||1]}),e.jsx("span",{className:"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-mono text-amber-300",children:M.startingScore||501})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{i?.connected&&M?.id&&i.send({type:"invite-accept",matchId:M.id})}catch{}f(null)},children:"‚úÖ Accept"}),e.jsx("button",{className:"flex-1 py-3 rounded-xl bg-white/5 hover:bg-rose-600/80 text-white/80 hover:text-white font-bold text-lg border border-white/10 hover:border-rose-500/50 transition-all hover:scale-[1.02] active:scale-95",onClick:()=>{try{i?.connected&&M?.id&&i.send({type:"invite-decline",matchId:M.id})}catch{}f(null)},children:"‚ùå Decline"})]})]})]})}),C&&!m&&e.jsx("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-sm mx-4 p-6 rounded-2xl bg-slate-900 border border-slate-700/50 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-indigo-500/10 flex items-center justify-center",children:e.jsx(pt,{className:"w-8 h-8 text-indigo-400 animate-pulse"})}),e.jsxs("h3",{className:"text-xl font-bold text-white mb-2",children:["Waiting for ",C]}),e.jsx("p",{className:"text-sm text-white/50 mb-5",children:"The match creator needs to accept your request‚Ä¶"}),e.jsx("button",{className:"px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 transition-all text-sm font-medium",onClick:()=>y(null),children:"Cancel"})]})}),e.jsx(rs,{open:!!m,matchInfo:m,localUser:c,opponentName:(()=>{if(!m)return"Opponent";const t=(c?.username||"").toLowerCase(),s=m.createdBy||m.creatorName||"";return m._isCreatorView||s.toLowerCase()===t?m.joinerName||(m.joinerId?Y[m.joinerId]||m.joinerId:"Opponent"):s||(m.creatorId?Y[m.creatorId]||m.creatorId:"Opponent")})(),countdown:15,onChoice:Ue,onBullThrow:t=>{try{i?.connected&&m?.id&&i.send({type:"prestart-bull-throw",roomId:m.id,score:t})}catch{}Ce(t),we(!0)},onAccept:K,onCancel:()=>{try{i?.connected&&m?.id&&m._isCreatorView&&i.send({type:"invite-decline",matchId:m.id})}catch{}u(null)},remoteChoice:Object.values(_e)[0]||null,bullActive:ge,bullWinner:pe,bullTied:We})]})})}export{ms as default};
//# sourceMappingURL=OnlinePlay.clean-CqRcc9Dx.js.map

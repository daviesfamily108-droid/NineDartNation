import{b as Rr,u as Je,j as e,c as fi,d as Cl,e as kl,f as Dl,r as Tl,h as Ll,i as Ml,s as Al,k as Ui,l as El,m as Jn,R as kn,F as bi,n as Ot,o as pi,B as Cs,p as Rl,q as Il,a as Bl,t as gi,v as vi,w as Pl,x as Ul,y as Ol,z as Fl}from"./index-BO6zAvtV.js";import{r as n}from"./ui-Vpbk6UnN.js";import{G as $l}from"./GameCalibrationStatus-CQwqEqw3.js";import{u as Ar,a as Dn}from"./match-BBhqR8yP.js";import{u as ji,M as Hl}from"./MatchControls-DHsPBfZp.js";import{M as Vl}from"./MatchStartShowcase-Cpv2IgAi.js";import"./vendor-D3F3s8fL.js";const Wl=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function _l(s){return s==="DB"?50:Number(s.slice(1))*2}function Kl(s){return Wl.includes(s)?_l(s):32}function zl(s,r="D16"){if(s>170||s<=1)return[];const o={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(o[s])return o[s];const m=Kl(r),l=[];for(const u of[60,57,54,51,48])if(s-u===m){l.push(`T${u/3} ${r}`);break}if(!l.length){for(const u of[20,19,18,17,16,15])if(s-u===m){l.push(`${u} ${r}`);break}}return l}function Mr(s,r,o,m,l){try{const u=window.speechSynthesis;if(!u)return;const x=new SpeechSynthesisUtterance,S=o<=170&&o>0,k=r===180;if(!(!l?.checkoutOnly||S||k))return;if(k?(x.text=`${s}! One eighty!`,x.rate=1.04,x.pitch=1.15):S?(x.text=`${s}, ${o} remaining.`,x.rate=1,x.pitch=1):r===0?(x.text=`${s}, no score.`,x.rate=1,x.pitch=1):(x.text=`${s}, ${r}.`,x.rate=1,x.pitch=1),m){const I=u.getVoices().find(C=>C.name===m);I&&(x.voice=I)}typeof l?.volume=="number"?x.volume=Math.max(0,Math.min(1,l.volume)):x.volume=1;try{u.cancel()}catch{}u.speak(x)}catch{}}function Ni({label:s,autoStart:r,scale:o,className:m,aspect:l="inherit",style:u,fill:x=!1}){const S=n.useRef(null),k=Rr(),[T,I]=n.useState(!1),[C,F]=n.useState(null),[y,E]=n.useState(null),[Y,D]=n.useState(null),we=n.useRef(null),Ne=n.useCallback((b,j="local")=>{try{b?(k.setMediaStream(b),S.current&&k.setVideoElementRef(S.current),k.setMode(j),k.setStreaming(!0),we.current=j):we.current&&we.current!=="phone"&&(k.setStreaming(!1),k.setMediaStream(null),we.current=null)}catch(N){console.warn("[CameraTile] Failed to register stream with camera session:",N)}},[k]),he=Je(b=>b.preferredCameraLabel),[L,J]=n.useState(()=>he==="Phone Camera"?"phone":localStorage.getItem("ndn:camera:mode")||"local"),[,pe]=n.useState(null),[,ie]=n.useState(!1),[Se,re]=n.useState(null),[ce,xe]=n.useState(null),[$,le]=n.useState(!0),[p,et]=n.useState([]),[A,ze]=n.useState(!1),[Z,Me]=n.useState([]),[fe,Ce]=n.useState(!1),$e=Je(b=>b.autoscoreProvider),tt=Je(b=>b.cameraEnabled),de=Je(b=>b.setPreferredCameraLocked),ke=Je(b=>b.preferredCameraLocked),ne=Je(b=>b.setPreferredCamera),He=Je(b=>b.preferredCameraId);if($e==="manual"){const j=[x?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",m].filter(Boolean).join(" ").trim(),N={...u||{}};return!x&&N.aspectRatio===void 0&&N.height===void 0&&N.minHeight===void 0&&(N.aspectRatio="4 / 3"),e.jsx("div",{className:j,style:N,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active â€” camera feeds are disabled."})})}n.useEffect(()=>{const b=window.location.hostname;(b==="localhost"||b==="127.0.0.1")&&fi("/api/hosts").then(j=>j.json()).then(j=>{const N=Array.isArray(j?.hosts)&&j.hosts.find(v=>v);N&&re(N)}).catch(()=>{}),fi("/api/https-info").then(j=>j.json()).then(j=>{j&&typeof j.https=="boolean"&&xe({https:!!j.https,port:Number(j.port)||8788})}).catch(()=>{})},[]);const ms=n.useMemo(()=>{const b=y||"____",j="ws://localhost:8787";if(j.length>0)try{const se=new URL(j);return`${`${se.protocol==="wss:"?"https":"http"}://${se.host}${se.pathname.endsWith("/ws")?"":se.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${b}`}catch{}const N=Se||window.location.hostname,v=!!ce?.https,K=v?ce?.port||8788:8787;return`${v?"https":"http"}://${N}:${K}/mobile-cam.html?code=${b}`},[y,Se,ce]);n.useEffect(()=>{localStorage.setItem("ndn:camera:mode",L)},[L]);const[kt,Kt]=n.useState(null);n.useEffect(()=>{Je.getState().ignorePreferredCameraSync||kt&&Date.now()-kt<3e4||he==="Phone Camera"&&L!=="phone"&&J("phone")},[he,L,kt]),n.useEffect(()=>{if(!(!tt||$e&&$e!=="built-in"&&$e!=="external-ws")&&r!==void 0){if(r){let b=!1;const j=he||"default",N=window.setTimeout(()=>{b||T||ue().catch(v=>console.warn(`[CameraTile] Auto-start failed for ${j}:`,v))},200);return()=>{b=!0,window.clearTimeout(N)}}be()}},[r,T,tt,$e,he,ue,be]),n.useEffect(()=>{const b=async()=>{try{if(!(he==="Phone Camera"&&(!kt||Date.now()-kt>=3e4)||L==="phone"))return;const v=k.getMediaStream(),K=S.current;if(!K||!v)return;K.srcObject!==v&&(K.srcObject=v),K.muted=!0,K.playsInline=!0;try{await K.play()}catch{}I(!0)}catch{}};b();const j=setInterval(b,800);return()=>clearInterval(j)},[he,L,k,k.isStreaming]);const ue=n.useCallback(async()=>{if(L==="wifi")return ot();if(he==="Phone Camera"||L==="phone"){const b=k.getMediaStream();if(b&&S.current)try{S.current.srcObject=b,await S.current.play(),I(!0);return}catch{}if(L==="phone")try{await ft();return}catch{}}try{const{preferredCameraId:b,setPreferredCamera:j}=Je.getState(),N=b?{video:{deviceId:{exact:b}},audio:!1}:{video:!0,audio:!1};let v;try{v=await navigator.mediaDevices.getUserMedia(N)}catch(K){const te=K&&(K.name||K.code)||"";if(b&&(te==="OverconstrainedError"||te==="NotFoundError"))v=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw K}S.current&&(S.current.srcObject=v,await S.current.play(),I(!0),Ne(v,"local"))}catch{}},[L,he,k,Ne,ft,ot]),be=n.useCallback(()=>{S.current&&S.current.srcObject&&(S.current.srcObject.getTracks().forEach(j=>j.stop()),S.current.srcObject=null,I(!1),Ne(null))},[Ne]);async function ot(){ze(!0);try{const b=await Cl();et(b),b.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(b){console.error("Wifi device discovery failed:",b),alert("Failed to discover wifi devices. Please check your network connection.")}finally{ze(!1)}}async function De(b){try{et(N=>N.map(v=>v.id===b.id?{...v,status:"connecting"}:v));const j=await kl(b);if(j&&S.current)S.current.srcObject=j,await S.current.play(),I(!0),Ne(j,"wifi"),et(N=>N.map(v=>v.id===b.id?{...v,status:"online"}:v));else throw new Error("Failed to get video stream")}catch(j){console.error("Failed to connect to wifi device:",j),alert(`Failed to connect to ${b.name}. Please check the device and try again.`),et(N=>N.map(v=>v.id===b.id?{...v,status:"offline"}:v))}}async function H(){Ce(!0);try{const b=await Dl();Me(b);const j=await Tl();j&&Me(N=>[...N,j]),b.length===0&&!j&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(b){console.error("USB device discovery failed:",b),alert("Failed to discover USB devices. Please check device connections.")}finally{Ce(!1)}}async function oe(b){try{Me(N=>N.map(v=>v.id===b.id?{...v,status:"connecting"}:v));const j=await Ll(b);if(j&&S.current)S.current.srcObject=j,await S.current.play(),I(!0),J("wifi"),Ne(j,"wifi"),Me(N=>N.map(v=>v.id===b.id?{...v,status:"online"}:v));else throw new Error("Failed to get video stream")}catch(j){console.error("Failed to connect to USB device:",j),alert(`Failed to connect to ${b.name}. Please check the device and try again.`),Me(N=>N.map(v=>v.id===b.id?{...v,status:"offline"}:v))}}const Ge=n.useCallback(b=>{try{J(b==="usb"?"wifi":b),Kt(Date.now());try{if(b==="local"){try{ne(He,"Local",!0)}catch{}try{de(!0)}catch{}}else if(b==="phone"){try{ne(void 0,"Phone Camera",!0)}catch{}try{de(!0)}catch{}}else if(b==="wifi"||b==="usb"){try{ne(void 0,"WiFi/USB",!0)}catch{}try{de(!0)}catch{}}}catch{}b==="local"?ue().catch(()=>{}):b==="phone"?ft():b==="wifi"?ot():b==="usb"&&H()}catch(j){console.warn("[CameraTile] handleModeSelect failed",j)}},[ue,ft,ot,H,ne,de,He]);n.useEffect(()=>{const b=j=>{try{const N=j&&j.detail&&j.detail.mode;N&&["local","phone","wifi","usb"].includes(N)?(Ge(N),ue().catch(()=>{})):ue().catch(()=>{})}catch{}};return window.addEventListener("ndn:start-camera",b),()=>{window.removeEventListener("ndn:start-camera",b)}},[ue,Ge]);function st(){if(C&&C.readyState===WebSocket.OPEN)return C;const b="ws://localhost:8787",j=b.length>0?b.endsWith("/ws")?b:b.replace(/\/$/,"")+"/ws":void 0,N=window.location.protocol==="https:"?"wss":"ws",v=`${N}://${window.location.host}/ws`,K=window.location.hostname,te=K==="localhost"||K==="127.0.0.1",se=K.endsWith("onrender.com"),Ee="wss://ninedartnation.onrender.com/ws";let me=j;me||(te?me=`${N}://${K}:8787/ws`:se?me=v:me=Ee),me||(me=v);const Rt=new WebSocket(me);return F(Rt),Rt}async function ft(){J("phone"),ie(!1);const b=st();b.readyState===WebSocket.OPEN?b.send(JSON.stringify({type:"cam-create"})):b.onopen=()=>b.send(JSON.stringify({type:"cam-create"})),b.onmessage=async j=>{const N=JSON.parse(j.data);if(N.type==="cam-code")E(N.code),N.expiresAt&&pe(N.expiresAt);else if(N.type==="cam-peer-joined"){ie(!0);const v=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});D(v),v.onicecandidate=te=>{te.candidate&&y&&b.send(JSON.stringify({type:"cam-ice",code:y,payload:te.candidate}))},v.ontrack=te=>{if(S.current){const se=te.streams?.[0];se&&(S.current.srcObject=se,S.current.play().catch(()=>{}),I(!0))}};const K=await v.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await v.setLocalDescription(K),y&&b.send(JSON.stringify({type:"cam-offer",code:y,payload:K}))}else if(N.type==="cam-answer")Y&&await Y.setRemoteDescription(new RTCSessionDescription(N.payload));else if(N.type==="cam-ice"&&Y)try{await Y.addIceCandidate(N.payload)}catch{}}}function V(){E(null),pe(null),ie(!1),C&&C.readyState===WebSocket.OPEN?C.send(JSON.stringify({type:"cam-create"})):ft();try{de(!0)}catch{}}function ve(){if(be(),E(null),ie(!1),pe(null),Y){try{Y.close()}catch{}D(null)}}return e.jsx(Gl,{label:s,autoStart:r,start:ue,stopAll:ve,startPhonePairing:ft,startWifiConnection:ot,startUsbConnection:H,connectToWifiDevice:De,connectToUsbDevice:oe,videoRef:S,streaming:T,mode:L,setMode:J,pairCode:y,mobileUrl:ms,regenerateCode:V,httpsInfo:ce,showTips:$,setShowTips:le,wifiDevices:p,usbDevices:Z,discoveringWifi:A,discoveringUsb:fe,scaleOverride:o,className:m,aspect:l,style:u,fill:x,onModeSelect:Ge,preferredCameraLocked:ke})}function Gl(s){const r=Rr(),{cameraScale:o,cameraAspect:m}=Je(),{label:l,start:u,stopAll:x,startPhonePairing:S,startWifiConnection:k,startUsbConnection:T,connectToWifiDevice:I,connectToUsbDevice:C,videoRef:F,streaming:y,mode:E,setMode:Y,onModeSelect:D,pairCode:we,mobileUrl:Ne,regenerateCode:he,httpsInfo:L,showTips:J,setShowTips:pe,wifiDevices:ie,usbDevices:Se,discoveringWifi:re,discoveringUsb:ce,className:xe,aspect:$,style:le,fill:p,preferredCameraLocked:et}=s,A={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},ze=n.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{D&&D("local")}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{D&&D("phone")}},{id:"wifi",title:"Wi-Fi/USB",description:"Connect to scoring devices on your local network.",action:()=>{D&&D("wifi")}},{id:"usb",title:"USB",description:"Connect a USB capture device (treated like WiFi mode).",action:()=>{D&&D("usb")}}],[Y,u,S,k,T]),[Z,Me]=n.useState(null),fe=n.useRef(null);n.useEffect(()=>()=>{fe.current&&window.clearTimeout(fe.current)},[]);const{cameraFitMode:Ce}=Je(),$e=p?"fill":Ce||"fill",tt=(()=>{const H=Number(s.scaleOverride??o??1),oe=Math.max(.5,Math.min(1.25,H));return $e==="fill"?Math.max(1,oe):oe})(),de=p&&$e==="fill"?"free":$&&$!=="inherit"?$:m||"wide",ke=de!=="free",ne=ke?de==="square"?"aspect-square":de==="portrait"?"aspect-[3/4]":de==="classic"?"aspect-[4/3]":"aspect-video":"",ms=[p?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",xe].filter(Boolean).join(" ").trim(),kt={...le||{}},Kt=p?"relative flex-1 min-h-[420px] bg-black":"relative w-full bg-black",ue={style:{transform:`scale(${tt})`,transformOrigin:"center"}},be=E==="wifi"&&Se.some(H=>H.status==="online"),ot=(()=>{const oe=$e==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return p?ke?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${ne}`,children:e.jsx("video",{ref:F,className:oe,...ue})})}):e.jsx("video",{ref:F,className:oe,...ue}):ke?e.jsx("div",{className:`relative w-full ${ne}`,children:e.jsx("video",{ref:F,className:oe,...ue})}):e.jsx("div",{className:"relative w-full",children:e.jsx("video",{ref:F,className:oe,...ue})})})();async function De(H,oe){if(H)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(H);else{const Ge=document.createElement("textarea");Ge.value=H,Ge.style.position="fixed",Ge.style.opacity="0",document.body.appendChild(Ge),Ge.focus(),Ge.select(),document.execCommand("copy"),document.body.removeChild(Ge)}Me(oe),fe.current&&window.clearTimeout(fe.current),fe.current=window.setTimeout(()=>Me(null),1500)}catch(Ge){console.warn("Copy to clipboard failed:",Ge),Me(null)}}return e.jsxs("div",{className:ms,style:kt,children:[e.jsxs("div",{className:Kt,children:[ot,r.isStreaming&&E==="phone"&&e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{children:"REC"})]})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[e.jsxs("span",{className:"truncate font-medium",children:[l||(y?E==="phone"?"PHONE LIVE":E==="wifi"?"WIFI LIVE":"LIVE":"Camera"),et&&e.jsx("span",{className:"ml-2 text-xs opacity-80",children:"ðŸ”’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!y&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${E==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>D("local"),children:"Local"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${E==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>D("phone"),children:"Phone"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${E==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>D("wifi"),children:"WiFi"}),e.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${E==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>D("usb"),children:"USB"})]}),y?e.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:x,children:"Stop"}):null]})]}),E==="phone"&&we&&!y&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>De(Ne,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:Ne}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:Z==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:Ne,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>De(we,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:we}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:Z==="code"?"Copied!":"Copy"})]})]}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:he,children:"Regenerate"})}),J&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wiâ€‘Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and"," ",L?.https?L.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>pe(!1),children:"Hide tips"})})]})]}),E==="wifi"&&!y&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),re?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):ie.length>0?e.jsxs("div",{className:"space-y-1",children:[ie.map(H=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:H.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[H.ip,":",H.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${H.status==="connecting"?"bg-yellow-600":H.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>I(H),disabled:H.status==="connecting",children:H.status==="connecting"?"...":"Connect"})]},H.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:k,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:k,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),ce?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):Se.length>0?e.jsxs("div",{className:"space-y-1",children:[Se.map(H=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:H.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:H.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${H.status==="connecting"?"bg-yellow-600":H.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>C(H),disabled:H.status==="connecting",children:H.status==="connecting"?"...":"Connect"})]},H.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:T,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:T,children:"Scan USB"})]})]})]}),!y&&e.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",A[E]||"Local"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ze.map(H=>{const oe=H.id==="usb"?be:H.id===E;return e.jsxs("button",{type:"button",onClick:H.action,className:`text-left p-3 rounded-2xl border ${oe?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:H.title}),e.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:H.description}),oe&&e.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},H.id)})})]})]})}function wi(s,r){const o=Ml(s,r);return Al(o)}class ql{width=0;height=0;bg=null;lastAcceptTs=0;cooldownMs=600;roiRadius=0;roiCx=0;roiCy=0;initialized=!1;thresh=18;minArea=60;maxArea=6e3;angMaxDeg=70;prevTip=null;prevArea=0;stableCount=0;requireStableN=3;constructor(r){r?.thresh!==void 0&&(this.thresh=r.thresh),r?.minArea!==void 0&&(this.minArea=r.minArea),r?.maxArea!==void 0&&(this.maxArea=r.maxArea),r?.requireStableN!==void 0&&(this.requireStableN=r.requireStableN),r?.angMaxDeg!==void 0&&(this.angMaxDeg=r.angMaxDeg)}setROI(r,o,m){this.roiCx=r,this.roiCy=o,this.roiRadius=Math.max(0,m|0)}reset(r,o){this.width=r,this.height=o,this.bg=new Float32Array(r*o),this.initialized=!1}updateBackground(r,o=.05){const{width:m,height:l,data:u}=r;(!this.bg||m!==this.width||l!==this.height)&&this.reset(m,l);const x=this.bg,S=m*l;for(let k=0,T=0;k<S;k++,T+=4){const I=u[T],C=u[T+1],F=u[T+2],y=.299*I+.587*C+.114*F;this.initialized?x[k]=(1-o)*x[k]+o*y:x[k]=y}this.initialized=!0}inRoi(r,o){if(this.roiRadius<=0)return!0;const m=r-this.roiCx,l=o-this.roiCy;return m*m+l*l<=this.roiRadius*this.roiRadius}detect(r){const m=Date.now()-this.lastAcceptTs<this.cooldownMs,{width:l,height:u,data:x}=r;(!this.bg||l!==this.width||u!==this.height)&&this.reset(l,u);const S=this.bg;if(!this.initialized)return this.updateBackground(r,1),null;const k=l*u,T=new Uint8Array(k),I=new Float32Array(k);let C=0,F=0,y=0;const E=new Uint8Array(k);for(let v=0,K=0;v<k;v++,K+=4){const te=x[K],se=x[K+1],Ee=x[K+2],me=Math.max(te,se,Ee),Rt=Math.min(te,se,Ee),ct=.299*te+.587*se+.114*Ee,Be=Math.abs(ct-S[v]);I[v]=Be;const Pe=Math.floor(v/l),Ft=v-Pe*l,hs=me===0?0:(me-Rt)/me,zt=me>=250&&hs<=.12;zt&&(E[v]=1),this.inRoi(Ft,Pe)&&!zt&&(C+=Be,F+=Be*Be,y++)}const Y=y?C/y:0,D=y?Math.max(0,F/y-Y*Y):0,we=Math.sqrt(D),Ne=Math.max(this.thresh,Y+1.2*we);for(let v=0;v<k;v++){if(E[v]){T[v]=0;continue}if(I[v]>Ne){const K=Math.floor(v/l),te=v-K*l;T[v]=this.inRoi(te,K)?1:0}}this._dilate(T,l,u),this._erode(T,l,u);const he=new Uint8Array(k);let L=0,J=null;for(let v=0;v<k;v++){if(T[v]===0||he[v])continue;const K=[];let te=0,se=0;const Ee=[v];for(he[v]=1;se<Ee.length;){const me=Ee[se++];K.push(me),te++;const Rt=me/l|0,ct=[me-1,me+1,me-l,me+l];for(const Be of ct)Be<0||Be>=k||he[Be]||(Be===me-1||Be===me+1)&&(Be/l|0)!==Rt||T[Be]&&(he[Be]=1,Ee.push(Be))}te>L&&(L=te,J=K)}if(!J||L<this.minArea||L>this.maxArea)return m||this.updateBackground(r,.02),null;let pe=l,ie=u,Se=0,re=0,ce=0,xe=0;for(const v of J){const K=v/l|0,te=v-K*l;ce+=te,xe+=K,te<pe&&(pe=te),te>Se&&(Se=te),K<ie&&(ie=K),K>re&&(re=K)}ce/=L,xe/=L;let $=0,le=0,p=0;for(const v of J){const K=v/l|0,se=v-K*l-ce,Ee=K-xe;$+=se*se,le+=Ee*Ee,p+=se*Ee}$/=L,le/=L,p/=L;const et=$+le,A=$*le-p*p,ze=Math.sqrt(Math.max(0,et*et/4-A)),Z=et/2+ze;let Me=p,fe=Z-$;Math.hypot(Me,fe)<1e-6&&(Me=Z-le,fe=p);const Ce=Math.hypot(Me,fe)||1;Me/=Ce,fe/=Ce;const $e=ce-this.roiCx,tt=xe-this.roiCy,de=$e*Me+tt*fe>0?1:-1;Me*=de,fe*=de;const ke=Math.hypot($e,tt)||1,ne=$e/ke,He=tt/ke,ms=Math.max(-1,Math.min(1,Me*ne+fe*He));if(Math.acos(ms)*180/Math.PI>this.angMaxDeg)return m||this.updateBackground(r,.02),null;let Kt=-1/0,ue=ce,be=xe;for(const v of J){const K=v/l|0,te=v-K*l,se=(te-ce)*Me+(K-xe)*fe;se>Kt&&(Kt=se,ue=te,be=K)}const ot=ue-this.roiCx,De=be-this.roiCy,H=ot*ot+De*De,oe=Math.max(1,Se-pe+1),Ge=Math.max(1,re-ie+1),st=oe*Ge,ft=L/st,V=Math.sqrt(H)/Math.max(1,this.roiRadius);let ve=.5;ft<.45&&(ve+=.2),ft<.25&&(ve+=.15),V<1.1&&(ve+=.1);const b=et-Z;return(Z>0?1-b/Z:0)>.3&&(ve+=.1),ve=Math.max(0,Math.min(1,ve)),!this._isStable({x:ue+.5,y:be+.5},L)||m?null:{tip:{x:ue+.5,y:be+.5},axis:{x1:ce-Me*20,y1:xe-fe*20,x2:ce+Me*20,y2:xe+fe*20},area:L,bbox:{x:pe,y:ie,w:oe,h:Ge},confidence:ve}}accept(r,o){if(this.lastAcceptTs=Date.now(),this.prevTip=null,this.prevArea=0,this.stableCount=0,!this.bg)return;const{width:m}=r,l=this.bg,{x:u,y:x,w:S,h:k}=o.bbox,T=.5;for(let I=x;I<x+k;I++)for(let C=u;C<u+S;C++){const F=I*m+C,y=F*4,E=r.data[y],Y=r.data[y+1],D=r.data[y+2],we=.299*E+.587*Y+.114*D;l[F]=(1-T)*l[F]+T*we}}_isStable(r,o){const m=(l,u)=>Math.hypot(l.x-u.x,l.y-u.y)<=6;if(!this.prevTip)return this.prevTip={...r},this.prevArea=o,this.stableCount=1,!1;if(m(this.prevTip,r)&&Math.abs(o-this.prevArea)/Math.max(1,o)<.3)this.prevTip={...r},this.prevArea=o,this.stableCount++;else return this.prevTip={...r},this.prevArea=o,this.stableCount=1,!1;return this.stableCount>=this.requireStableN}_dilate(r,o,m){const l=new Uint8Array(r.length);for(let u=0;u<m;u++)for(let x=0;x<o;x++){let S=0;for(let k=-1;k<=1;k++){for(let T=-1;T<=1;T++){const I=u+k,C=x+T;if(!(I<0||I>=m||C<0||C>=o)&&r[I*o+C]){S=1;break}}if(S)break}l[u*o+x]=S}r.set(l)}_erode(r,o,m){const l=new Uint8Array(r.length);for(let u=0;u<m;u++)for(let x=0;x<o;x++){let S=1;for(let k=-1;k<=1;k++){for(let T=-1;T<=1;T++){const I=u+k,C=x+T;if(!(I<0||I>=m||C<0||C>=o)&&!r[I*o+C]){S=0;break}}if(!S)break}l[u*o+x]=S}r.set(l)}}function Xl(s){try{if(!s||typeof s!="object")return null;if((s.type==="dart"||s.kind==="dart"||s.event==="dart")&&typeof s.value=="number"){const r=yi(s.ring);return Si(s.value,r)}if(typeof s.value=="number"&&s.ring){const r=yi(s.ring);return Si(s.value,r)}if(typeof s.score=="string"){const r=s.score.trim().toUpperCase();if(r==="50"||r==="DBULL"||r==="INNER_BULL")return{value:50,ring:"INNER_BULL",sector:null,mult:0};if(r==="25"||r==="BULL"||r==="OBULL")return{value:25,ring:"BULL",sector:null,mult:0};const o=r.match(/^(S|D|T)(\d{1,2})$/);if(o){const m=o[1]==="S"?1:o[1]==="D"?2:3,l=parseInt(o[2],10);if(l>=1&&l<=20)return{value:l*m,ring:m===1?"SINGLE":m===2?"DOUBLE":"TRIPLE",sector:l,mult:m}}}if(typeof s.sector=="number"&&typeof s.mult=="number"){const r=Math.max(1,Math.min(20,Math.floor(s.sector))),o=s.mult===1?1:s.mult===2?2:3;return{value:r*o,ring:o===1?"SINGLE":o===2?"DOUBLE":"TRIPLE",sector:r,mult:o}}if(s.bull){const r=String(s.bull).toLowerCase()==="inner"||s.bull===!0;return{value:r?50:25,ring:r?"INNER_BULL":"BULL",sector:null,mult:0}}}catch{}return null}function yi(s){const r=String(s||"").toUpperCase();return r.startsWith("TR")?"TRIPLE":r.startsWith("DO")?"DOUBLE":r.startsWith("SI")?"SINGLE":r==="INNER_BULL"||r==="DBULL"||r==="50"||r==="IBULL"?"INNER_BULL":r==="BULL"||r==="25"||r==="OBULL"||r==="OUTER_BULL"?"BULL":r==="MISS"||r==="0"?"MISS":"SINGLE"}function Si(s,r){const o=Math.max(0,Math.min(60,Math.round(Number(s)||0)));return r==="INNER_BULL"?{value:50,ring:r}:r==="BULL"?{value:25,ring:r}:{value:o,ring:r}}function Yl(s,r){let o=null,m=!0,l=null,u=0;const x=400,S=[],k=new Set;function T(C,F){const y=typeof C?.id=="string"||typeof C?.id=="number"?String(C.id):null;if(y){if(k.has(y))return;if(k.add(y),S.push(y),S.length>200){const D=S.shift();D&&k.delete(D)}}const E=`${F.value}|${F.ring}|${F.sector??""}|${F.mult??""}`,Y=Date.now();E===l&&Y-u<x||(l=E,u=Y,r(F))}function I(){if(m)try{o=new WebSocket(s),o.onmessage=C=>{try{const F=JSON.parse(C.data),y=Xl(F);y&&T(F,y)}catch{}},o.onclose=()=>{o=null,setTimeout(I,1500)},o.onerror=()=>{}}catch{setTimeout(I,2e3)}}return I(),{close:()=>{m=!1;try{o?.close()}catch{}}}}function ga({storageKey:s,children:r,className:o,defaultWidth:m=640,defaultHeight:l=360,minWidth:u=320,minHeight:x=200,maxWidth:S=1600,maxHeight:k=1200,autoFill:T=!1}){const[I,C]=n.useState(()=>{try{const L=localStorage.getItem(s);if(L)return JSON.parse(L)}catch{}return T?{width:m}:{width:m,height:l}}),F=n.useRef(null),y=n.useRef(null);n.useEffect(()=>{function L(){try{localStorage.removeItem(s)}catch{}C({width:m,height:l})}return window.addEventListener("ndn:layout-reset",L),window.addEventListener("ndn:camera-reset",L),()=>{window.removeEventListener("ndn:layout-reset",L),window.removeEventListener("ndn:camera-reset",L)}},[s,m,l]),n.useEffect(()=>{try{localStorage.setItem(s,JSON.stringify(I))}catch{}},[I,s]);function E(L,J,pe){return Math.max(J,Math.min(pe,L))}function Y(L,J){L.preventDefault();const pe=y.current;if(!pe)return;const ie=pe.getBoundingClientRect();F.current={x:L.clientX,y:L.clientY,w:ie.width,h:ie.height,dir:J},window.addEventListener("mousemove",D),window.addEventListener("mouseup",we)}function D(L){const J=F.current;if(!J)return;const pe=L.clientX-J.x,ie=L.clientY-J.y;let Se=J.w,re=J.h;J.dir.includes("e")&&(Se=E(J.w+pe,u,S)),!T&&J.dir.includes("s")&&(re=E(J.h+ie,x,k)),J.dir.includes("w")&&(Se=E(J.w-pe,u,S)),!T&&J.dir.includes("n")&&(re=E(J.h-ie,x,k)),C({width:Math.round(Se),height:Math.round(re)})}function we(){window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",we),F.current=null}function Ne(L,J){const ie=L.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"," "].includes(ie))return;L.preventDefault();const Se=ie==="ArrowLeft"||ie==="ArrowUp"?-20:20;C(re=>{const ce=re.width||m,xe=re.height||l;let $=ce,le=xe;return J.includes("e")&&($=E(ce+Se,u,S)),J.includes("w")&&($=E(ce-Se,u,S)),!T&&J.includes("s")&&(le=E(xe+Se,x,k)),!T&&J.includes("n")&&(le=E(xe-Se,x,k)),{width:Math.round($),height:Math.round(le)}})}const he={width:T?"100%":I.width?`${I.width}px`:void 0,height:T?"100%":I.height?`${I.height}px`:void 0,maxWidth:"100%",maxHeight:T?"100%":"80vh",position:"relative",...T?{display:"flex",flexDirection:"column",flex:"1 1 auto"}:{}};return e.jsxs("div",{ref:y,className:`${o||""}`,style:he,children:[r,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:L=>Y(L,"nw"),role:"button",tabIndex:0,"aria-label":"Resize north-west",onKeyDown:L=>Ne(L,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:L=>Y(L,"ne"),role:"button",tabIndex:0,"aria-label":"Resize north-east",onKeyDown:L=>Ne(L,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:L=>Y(L,"sw"),role:"button",tabIndex:0,"aria-label":"Resize south-west",onKeyDown:L=>Ne(L,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:L=>Y(L,"se"),role:"button",tabIndex:0,"aria-label":"Resize south-east",onKeyDown:L=>Ne(L,"se")})]})}const Oi=Ui((s,r)=>({samples:[],addSample:o=>s(m=>({samples:[...m.samples,o]})),clear:()=>s({samples:[]}),export:()=>r().samples.slice()})),Jl=Ui(s=>({paused:!1,pauseEndsAt:null,setPaused:(r,o=null)=>s({paused:r,pauseEndsAt:o??null})})),Ql=1,Zl=120,eo=400,to=450,so=5e3,no=.85,ro=6500;function Le({onVisitCommitted:s,showToolbar:r=!0,onAutoDart:o,immediateAutoCommit:m=!1,hideInlinePanels:l=!1,scoringMode:u="x01",onGenericDart:x,onGenericReplace:S,x01DoubleInOverride:k,onAddVisit:T,onEndLeg:I}){const C=n.useRef(null),{preferredCameraId:F,preferredCameraLabel:y,setPreferredCamera:E,autoscoreProvider:Y,autoscoreWsUrl:D,cameraAspect:we,cameraFitMode:Ne,autoCommitMode:he="wait-for-clear",cameraEnabled:L,setCameraEnabled:J,preferredCameraLocked:pe,hideCameraOverlay:ie,setHideCameraOverlay:Se}=Je();Je(i=>i.preserveCalibrationOverlay);const re=Y==="manual",[ce,xe]=n.useState([]),$=n.useRef(null),le=n.useRef(null),[p,et]=n.useState(!1),A=Rr(),ze=y==="Phone Camera",Z=A.getMediaStream?.()||null,Me=A.isStreaming,fe=ze&&A.mode==="phone"&&Me&&!!Z,Ce=p||Me,[$e,tt]=n.useState(!1),[de,ke]=n.useState(null),{H:ne,imageSize:He,overlaySize:ms,reset:kt,_hydrated:Kt,locked:ue}=El();n.useEffect(()=>{pe&&!ie&&Se(!0)},[pe,ie,Se]);const[be,ot]=n.useState(""),[De,H]=n.useState(""),[oe,Ge]=n.useState(0),[st,ft]=n.useState("MISS"),[V,ve]=n.useState(0),[b,j]=n.useState(0),[N,v]=n.useState([]),[K,te]=n.useState(0),[se,Ee]=n.useState(0),[me,Rt]=n.useState(!1),ct=n.useRef(null),Be=n.useRef(null),Pe=!m&&he!=="immediate",[Ft,hs]=n.useState(0),[zt,Qn]=n.useState([]),qe=n.useRef(null),Tn=n.useRef([]),Ir=n.useRef(0),as=n.useRef(0),ye=n.useRef(!1),jt=n.useRef(null),ee=n.useRef(0),[X,ks]=n.useState([]),[zs,Ln]=n.useState(!1),xs=n.useCallback(()=>{Be.current&&(clearTimeout(Be.current),Be.current=null)},[]),Gt=n.useCallback(i=>{const d=[...Tn.current.slice(-8),i];Tn.current=d,ks(d);try{window.ndnCameraDiagnostics=d}catch{}},[]),$t=n.useCallback(i=>{const d=ct.current;if(d&&(ct.current=null,xs(),Rt(!1),s))try{s(d.score,d.darts,d.finished)}catch{}},[s,xs]),Ht=n.useCallback(i=>{if(s){if(!Pe){try{s(i.score,i.darts,i.finished)}catch{}return}ct.current=i,Rt(!0),xs(),Be.current=window.setTimeout(()=>$t("timeout"),ro)}},[s,Pe,xs,$t]),Ds=n.useCallback(i=>{ve(0),j(0),v([]),te(0),Ee(0),Xe(!1);try{window.dispatchEvent(new CustomEvent("ndn:clear-visit-request",{detail:{source:"camera-view",reason:i,ts:Date.now()}}))}catch{}},[]);n.useEffect(()=>{if(!Pe)return;const i=()=>$t("event");return window.addEventListener("ndn:darts-cleared",i),()=>window.removeEventListener("ndn:darts-cleared",i)},[Pe,$t]),n.useEffect(()=>{Pe||$t("timeout")},[Pe,$t]),n.useEffect(()=>()=>$t("teardown"),[$t]);const Ts=n.useCallback(()=>{Ds("indicator"),hs(i=>i+1)},[Ds]),Mn=n.useCallback(()=>{V===0&&b===0||(Ds("toolbar"),hs(i=>i+1))},[Ds,V,b]),Gs=n.useCallback(()=>{if(!re)try{window.dispatchEvent(new CustomEvent("ndn:open-camera-manager",{detail:{source:"camera-view",ts:Date.now()}}))}catch(i){console.warn("[CameraView] Failed to request camera manager:",i)}},[re]),qs=Je(i=>i.x01DoubleIn),It=typeof k=="boolean"?!!k:!!qs,[Xs,Ls]=n.useState({}),ge=Ar(i=>i),An=ge.players[ge.currentPlayerIdx]?.id,nt=!!(An&&Xs[An]),En=i=>{An&&Ls(d=>({...d,[An]:i}))},Ys=ge?.inProgress,Zn=ji(i=>i.setVisit),Js=ji(i=>i.reset);n.useEffect(()=>{try{Zn(N,V,b)}catch{}},[N,V,b,Zn]),n.useEffect(()=>()=>{try{Js()}catch{}},[Js]);const Da=Ar(i=>i.addVisit),er=Ar(i=>i.endLeg),qt=(i,d,g)=>{try{T?T(i,d,g):Da(i,d,g)}catch{}},Qs=i=>{try{I?I(i):er(typeof i=="number"?i:0)}catch{}},Zs=Oi(i=>i.addSample),[Ms,tr]=n.useState(""),[As,Br]=n.useState(""),[Dt,Ve]=n.useState(0),[sr,Nt]=n.useState(!1),[wt,Xe]=n.useState(!1),[nr,Es]=n.useState(!1),Vt=n.useRef(null),[Rn,Wt]=n.useState("auto"),[en,Bt]=n.useState(!1),[Pr,Rs]=n.useState(!1),[Ta,In]=n.useState(!1),rr=n.useRef(null),is=Je(i=>i.dartTimerEnabled),Is=Je(i=>i.dartTimerSeconds)||10,[ls,tn]=n.useState(null),Tt=n.useRef(null),Bs=Jl(i=>i.paused),fs=n.useRef(null),Xt=n.useRef(null),[sn,nn]=n.useState(0),Ps=n.useCallback(()=>{try{window.dispatchEvent(new CustomEvent("ndn:phone-camera-reconnect",{detail:{source:"camera-view",ts:Date.now()}}))}catch(i){console.warn("[CameraView] Phone camera reconnect dispatch failed:",i)}},[]);n.useEffect(()=>{const i=()=>{re||Rs(!0)};return window.addEventListener("ndn:open-autoscore",i),()=>window.removeEventListener("ndn:open-autoscore",i)},[re]),n.useEffect(()=>()=>{try{Vt.current&&clearTimeout(Vt.current)}catch{}},[]),n.useEffect(()=>{const i=()=>In(!0);return window.addEventListener("ndn:open-scoring",i),()=>window.removeEventListener("ndn:open-scoring",i)},[]),n.useEffect(()=>{const i=()=>{hs(d=>d+1),ve(0),j(0),v([]),te(0),Ee(0),Xe(!1)};return window.addEventListener("ndn:darts-cleared",i),()=>window.removeEventListener("ndn:darts-cleared",i)},[]),n.useEffect(()=>{Qn(i=>{if(N.length>i.length){const d=N.length-i.length;return[...i,...Array(d).fill(Ft)]}return N.length<i.length?i.slice(0,N.length):i})},[N,Ft]),n.useEffect(()=>{if(jt.current&&(clearTimeout(jt.current),jt.current=null),re){ye.current=!1,as.current=0,qe.current=null;return}return Ce?(as.current=performance.now(),qe.current=null,ye.current=!1,ee.current=0,jt.current=window.setTimeout(()=>{ye.current=!0,jt.current=null},so)):(as.current=0,qe.current=null,ye.current=!1,ee.current=0),()=>{jt.current&&(clearTimeout(jt.current),jt.current=null),ye.current=!1,ee.current=0}},[Ce,re]),n.useEffect(()=>{let i=!0;async function d(){try{if(!navigator?.mediaDevices?.enumerateDevices)return;const g=await navigator.mediaDevices.enumerateDevices();if(!i)return;xe(g.filter(R=>R.kind==="videoinput"))}catch(g){console.warn("[CAMERA] enumerateDevices failed:",g)}}d();try{navigator.mediaDevices.addEventListener("devicechange",d)}catch{try{navigator.mediaDevices.ondevicechange=d}catch{}}return()=>{i=!1;try{navigator.mediaDevices.removeEventListener("devicechange",d)}catch{}}},[]),n.useEffect(()=>{const i=()=>{Wt("manual"),Bt(!0)},d=()=>{Wt("auto"),Bt(!1)};return window.addEventListener("ndn:open-manual",i),window.addEventListener("ndn:close-manual",d),()=>{window.removeEventListener("ndn:open-manual",i),window.removeEventListener("ndn:close-manual",d)}},[]),n.useEffect(()=>{re&&(Wt("manual"),Rs(!1))},[re]),n.useEffect(()=>{try{const i=ge.players[ge.currentPlayerIdx],d=i?.legs?.[i.legs.length-1];if(!i)return;(!d||d.dartsThrown===0)&&Ls(g=>({...g,[i.id]:!1}))}catch{}},[ge.currentPlayerIdx,ge.players?.[ge.currentPlayerIdx]?.legs?.length]),n.useEffect(()=>{const i=!!is&&Ys&&!Bs&&V<3;if(Tt.current&&(clearInterval(Tt.current),Tt.current=null),!i){tn(null);return}return tn(Is),Tt.current=window.setInterval(()=>{tn(d=>{const g=(d??Is)-1;if(g<=0){try{Lt(0,"MISS 0","MISS")}catch{}return Tt.current&&(clearInterval(Tt.current),Tt.current=null),0}return g})},1e3),()=>{Tt.current&&(clearInterval(Tt.current),Tt.current=null)}},[is,Is,V,ge.currentPlayerIdx,ge?.inProgress,Bs]),n.useEffect(()=>{if(!en)return;const i=setInterval(()=>{try{const d=C.current,g=rr.current;if(!d||!g)return;const R=d.videoWidth||0,q=d.videoHeight||0;if(!R||!q)return;const M=g.clientWidth||640,W=g.clientHeight||360;g.width!==M&&(g.width=M),g.height!==W&&(g.height=W);const z=g.getContext("2d");if(!z)return;z.imageSmoothingEnabled=!0;const Q=Math.min(M/R,W/q),We=Math.round(R*Q),je=Math.round(q*Q),Ue=Math.floor((M-We)/2),_e=Math.floor((W-je)/2);z.fillStyle="#000",z.fillRect(0,0,M,W),z.drawImage(d,Ue,_e,We,je)}catch(d){console.warn("Manual preview update error:",d)}},120);return()=>clearInterval(i)},[en]),n.useEffect(()=>()=>Us(),[]);const Bn=ze&&!fe;async function bs(){if(!($e||p)){if(ze&&fe){tt(!1);return}tt(!0);try{const i=F?{video:{deviceId:{exact:F}},audio:!1}:{video:{facingMode:"environment"},audio:!1};Ot("[CAMERA] Using constraints:",i);let d;try{d=await navigator.mediaDevices.getUserMedia(i),Ot("[CAMERA] Got stream:",!!d)}catch(g){console.warn("[CAMERA] First attempt failed:",g);const R=g&&(g.name||g.code)||"";if(F&&(R==="OverconstrainedError"||R==="NotFoundError"))Ot("[CAMERA] Trying fallback without deviceId"),d=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else if(!F&&(R==="OverconstrainedError"||R==="NotFoundError"||R==="NotSupportedError"))Ot("[CAMERA] Trying fallback for facingMode not supported"),d=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw g}if(C.current){Ot("[CAMERA] Setting stream to video element"),C.current.srcObject=d,Ot("[CAMERA] Stream tracks:",d.getTracks().length,"video tracks:",d.getVideoTracks().length),C.current.addEventListener("loadeddata",()=>Ot("[CAMERA] Video loadeddata")),C.current.addEventListener("canplay",()=>Ot("[CAMERA] Video canplay")),C.current.addEventListener("play",()=>Ot("[CAMERA] Video started playing")),C.current.addEventListener("error",g=>console.error("[CAMERA] Video error:",g));try{C.current.play(),Ot("[CAMERA] Play called successfully")}catch(g){console.error("[CAMERA] Video play failed:",g),setTimeout(()=>{try{C.current?.play(),Ot("[CAMERA] Retry play called")}catch(R){console.error("[CAMERA] Retry play failed:",R)}},100)}try{A.setVideoElementRef?.(C.current),A.setMediaStream?.(d),A.setMode?.("local"),A.setStreaming?.(!0)}catch(g){console.warn("[CAMERA] Failed to sync camera session with local stream:",g)}}else console.error("[CAMERA] Video element not found");et(!0);try{const g=await navigator.mediaDevices.enumerateDevices();xe(g.filter(R=>R.kind==="videoinput")),Ot("[CAMERA] Found cameras:",g.filter(R=>R.kind==="videoinput").length)}catch(g){console.warn("[CAMERA] Failed to enumerate devices:",g)}}catch(i){console.error("[CAMERA] Camera start failed:",i),alert("Camera permission denied or not available.")}finally{tt(!1)}}}function Us(){C.current&&C.current.srcObject&&(C.current.srcObject.getTracks().forEach(d=>d.stop()),C.current.srcObject=null,et(!1),tt(!1))}n.useEffect(()=>{const i=C.current;if(!i)return;const d=A.getMediaStream?.()||null,R=(A.getVideoElementRef?.()||null)?.srcObject||null,q=d||R;if(q){i.srcObject!==q&&(i.srcObject=q),i.muted=!0,i.playsInline=!0;try{i.play?.()}catch{}p||et(!0)}},[A.mode,A.isStreaming,p,A]);function Pn(){try{if(!$.current)return;const i=C.current,d=A.getVideoElementRef?.()||null,g=i&&i.videoWidth>0&&i.videoHeight>0?i:d||i;if(!g)return;const R=g,q=$.current;q.width=R.videoWidth,q.height=R.videoHeight;const M=q.getContext("2d");if(!M)return;M.drawImage(R,0,0,q.width,q.height);const W=q.toDataURL("image/png");ke(W)}catch(i){console.warn("Capture error:",i)}}function Un(){return ce.length?e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs",children:[e.jsx("span",{children:"Cam:"}),e.jsxs("select",{className:"bg-black/20 rounded px-1 py-0.5",value:F||"",onChange:async i=>{if($e)return;const d=i.target.value||void 0,g=ce.find(R=>R.deviceId===d)?.label;E(d,g||"",!0),Us(),await new Promise(R=>setTimeout(R,150));try{await bs()}catch(R){console.warn("Failed to start camera after device switch:",R),setTimeout(async()=>{try{await bs()}catch(q){console.error("Camera switch failed after retry:",q),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),ce.map(i=>e.jsx("option",{value:i.deviceId,children:i.label||(i.deviceId?`Camera (${i.deviceId.slice(0,6)})`:"Camera")},i.deviceId))]}),e.jsx("button",{className:"btn btn--ghost btn-sm ml-2",onClick:async()=>{try{const i=await navigator.mediaDevices.enumerateDevices();xe(i.filter(d=>d.kind==="videoinput"))}catch(i){console.warn("Rescan failed:",i),alert("Failed to rescan devices. Ensure camera permissions are granted.")}},title:"Rescan connected cameras",children:"Rescan"})]}):null}n.useEffect(()=>{},[ne,He,Ce,re,ze,pe,ie]),n.useEffect(()=>{if(re||Y!=="built-in")return;const i=Rr.getState(),g=Je.getState().preferredCameraLabel==="Phone Camera"?i.getVideoElementRef?.()||null:C.current;if(!g||!ne||!He)return;let R=!1;const q=g,M=$.current;if(!M)return;if(!fs.current){let z=60,Q=18,We=3;vw>0&&vh>0&&vw*vh<1280*720&&(z=40,Q=16,We=2),fs.current=new ql({minArea:z,thresh:Q,requireStableN:We,angMaxDeg:70})}const W=()=>{if(!R){try{const z=q.videoWidth||0,Q=q.videoHeight||0;if(!z||!Q){Xt.current=requestAnimationFrame(W);return}M.width!==z&&(M.width=z),M.height!==Q&&(M.height=Q);const We=M.getContext("2d",{willReadFrequently:!0});if(!We){Xt.current=requestAnimationFrame(W);return}We.drawImage(q,0,0,z,Q);const je=We.getImageData(0,0,z,Q);ee.current++;const Ue=pi(ne,{x:0,y:0}),_e=pi(ne,{x:Cs.doubleOuter,y:0}),Ke=z/He.w,Qe=Q/He.h,ps=Ue.x*Ke,_t=Ue.y*Qe,gs=_e.x*Ke,Fs=_e.y*Qe,Ur=Math.hypot(gs-ps,Fs-_t)*1.08,Mt=fs.current;if(sn>=0&&Mt.setROI(ps,_t,Math.max(24,Math.min(Math.max(z,Q),Ur))),!Bs&&V<3&&ye.current&&ee.current>150){const it=Mt.detect(je),os=performance.now();if(qe.current&&os-qe.current.firstTs>900&&(qe.current=null),it&&it.confidence>=no){const Jt=as.current>0&&os-as.current<to,Qt=Rl(M,it.tip,6),$s={x:Qt.x/Ke,y:Qt.y/Qe},Fn=wi(ne,$s),Ye=Fn.ring,dt=Fn.base,Zt=`${Ye} ${dt>0?dt:""}`.trim(),Or=Fn.sector??null,yt=Math.max(0,Number(Fn.mult)||0);let Ut=!1;ot(Zt),Ge(dt),ft(Ye);const cn=Oe=>{if(Oe.value>0){Xe(!0),Es(!0);try{Vt.current&&clearTimeout(Vt.current)}catch{}Vt.current=window.setTimeout(()=>{Es(!1),Vt.current=null},1500);try{Lt(Oe.value,Oe.label,Oe.ring)}catch{}}else Xe(!1);try{o&&o(Oe.value,Oe.ring,{sector:Oe.sector,mult:Oe.mult})}catch{}};if(Jt)qe.current=null,Ut=!0;else if(Ye==="MISS"||dt<=0){qe.current=null,Xe(!1);try{o&&o(dt,Ye,{sector:Or,mult:yt})}catch{}Ut=!0}else{const Oe=qe.current;!Oe||Oe.value!==dt||Oe.ring!==Ye?qe.current={value:dt,ring:Ye,label:Zt,sector:Or,mult:yt,firstTs:os,frames:1}:qe.current={...Oe,label:Zt,frames:Oe.frames+1};const Ae=qe.current,Re=os-Ae.firstTs,Fe=Ae.frames>=Ql||Re>=Zl,Ze=os-Ir.current>=eo;Fe&&Ze&&(cn(Ae),qe.current=null,Ir.current=os,Ut=!0)}Gt({ts:os,label:Zt,value:dt,ring:Ye,confidence:it.confidence,ready:Ut,accepted:Ut&&dt>0&&Ye!=="MISS",warmup:Jt});try{if(dt>0&&Ye!=="MISS"){const Ae=le.current;if(Ae){const Re=Ae.getContext("2d");if(Re){const Fe=Qt.x/z*Ae.width,Ze=Qt.y/Q*Ae.height;if(Re.save(),Re.beginPath(),Re.strokeStyle="#f59e0b",Re.lineWidth=2,Re.arc(Fe,Ze,6,0,Math.PI*2),Re.stroke(),it.axis){const es=it.axis,cs=es.x1/z*Ae.width,St=es.y1/Q*Ae.height,at=es.x2/z*Ae.width,vs=es.y2/Q*Ae.height;Re.beginPath(),Re.moveTo(cs,St),Re.lineTo(at,vs),Re.stroke()}if(it.bbox){const es=it.bbox.x/z*Ae.width,cs=it.bbox.y/Q*Ae.height,St=it.bbox.w/z*Ae.width,at=it.bbox.h/Q*Ae.height;Re.strokeStyle="#22d3ee",Re.strokeRect(es,cs,St,at)}Re.restore()}}}}catch{}Ut&&Mt.accept(je,it)}else qe.current&&os-qe.current.firstTs>800&&(qe.current=null)}}catch{}Xt.current=requestAnimationFrame(W)}};return Xt.current=requestAnimationFrame(W),()=>{R=!0,Xt.current&&cancelAnimationFrame(Xt.current),Xt.current=null}},[re,Y,Ce,ne,He,Bs,V,sn,Gt]);const Pt=n.useCallback(async()=>{try{if(ze){const i=ce.find(d=>d.kind==="videoinput");i?E(i.deviceId,i.label||"",!0):E(void 0,"",!0)}await bs()}catch(i){console.warn("[CameraView] Local camera fallback failed:",i)}},[ce,ze,E]);n.useEffect(()=>{try{Dn.getState().setCalibrationStatus({hasHomography:!!ne,imageSize:He,overlaySize:ms})}catch{}},[ne,He]),n.useEffect(()=>{if(Y!=="external-ws"||!D)return;const i=Yl(D,d=>{if(!(!ye.current||performance.now()-as.current<5e3))if(o){try{o(d.value,d.ring,{sector:d.sector??null,mult:d.mult??0})}catch{}try{Zs({playerId:ge.players[ge.currentPlayerIdx]?.id??null,sector:d.sector??null,mult:d.mult??0,ring:d.ring,ts:Date.now()})}catch{}}else{const g=d.ring==="INNER_BULL"?"INNER_BULL 50":d.ring==="BULL"?"BULL 25":`${d.ring[0]}${d.value/(d.mult||1)||d.value} ${d.value}`;Lt(d.value,g,d.ring);try{Zs({playerId:ge.players[ge.currentPlayerIdx]?.id??null,sector:d.sector??null,mult:d.mult??0,ring:d.ring,ts:Date.now()})}catch{}}});return()=>i.close()},[Y,D]);function rn(i){if(!le.current||!ne||!He)return;const d=le.current.getBoundingClientRect(),g=i.clientX-d.left,R=i.clientY-d.top,q=le.current.width/He.w,M=le.current.height/He.h,W={x:g/q,y:R/M},z=wi(ne,W),Q=`${z.ring} ${z.base>0?z.base:""}`.trim();ot(Q),Ge(z.base),ft(z.ring),Xe(!0);try{if(m&&o){o(z.base,z.ring,{sector:z.sector,mult:z.mult});try{Zs({playerId:ge.players[ge.currentPlayerIdx]?.id??null,sector:z.sector??null,mult:z.mult??0,ring:z.ring,ts:Date.now()})}catch{}Xe(!1)}}catch{}}function an(i){const d=i.trim().toUpperCase();if(!d)return null;const g=d==="BULL"||d==="50"||d==="DBULL"||d==="IBULL",R=d==="25"||d==="OBULL";if(g)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(R)return{label:"BULL 25",value:25,ring:"BULL"};const q=d.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!q)return null;const M=q[1]||"S",W=parseInt(q[2],10);if(W<1||W>20)return null;const z=M==="S"?1:M==="D"?2:3,Q=M==="S"?"SINGLE":M==="D"?"DOUBLE":"TRIPLE";return{label:`${M}${W} ${W*z}`,value:W*z,ring:Q}}function ln(){const i=ge;if(!i.players.length)return i.startingScore;const d=i.players[i.currentPlayerIdx],g=d.legs[d.legs.length-1];return g?g.totalScoreRemaining:i.startingScore}function Lt(i,d,g){if(Pe&&me){if(!nr){Es(!0);try{Vt.current&&clearTimeout(Vt.current)}catch{}Vt.current=window.setTimeout(()=>{Es(!1),Vt.current=null},1200)}return}if(u==="custom"){if(x)try{x(i,g,{label:d})}catch{}if(V>=3){ve(1),j(i),v([{label:d,value:i,ring:g}]);return}const Ue=V+1;ve(Ue),j(_e=>_e+i),v(_e=>[..._e,{label:d,value:i,ring:g}]);return}if(V>=3){const Ue=b,_e=V;qt(Ue,_e,{preOpenDarts:K||0,doubleWindowDarts:se||0,finishedByDouble:!1,visitTotal:Ue});try{const ps=ge.players[ge.currentPlayerIdx]?.name;ps&&Jn(ps,_e,Ue)}catch{}const Ke=!It||nt||g==="DOUBLE"||g==="INNER_BULL",Qe=Ke?i:0;ve(1),j(Qe),v([{label:d,value:Qe,ring:g}]),te(Ke?0:1),Ee(0),It&&!nt&&(g==="DOUBLE"||g==="INNER_BULL")&&En(!0),Ht({score:Ue,darts:_e,finished:!1});return}const R=V+1,M=!It||nt||g==="DOUBLE"||g==="INNER_BULL"?i:0;It&&!nt&&(g==="DOUBLE"||g==="INNER_BULL")&&En(!0);const W=b+M,Q=ln()-W,We=Q===0&&(g==="DOUBLE"||g==="INNER_BULL");if(Q<0||Q===1||Q===0&&!We){const _e=(K||0)+(It&&!nt&&!(g==="DOUBLE"||g==="INNER_BULL")?1:0),Ke=Q,Qe=Q+M,ps=Qe>50&&Ke<=50||Qe<=50?1:0,_t=(se||0)+ps;qt(0,R,{preOpenDarts:_e,doubleWindowDarts:_t,finishedByDouble:!1,visitTotal:0}),ve(0),j(0),v([]),te(0),Ee(0),Ht({score:0,darts:R,finished:!1});return}ve(R),j(W),v(Ue=>[...Ue,{label:d,value:M,ring:g}]),It&&!nt&&!(g==="DOUBLE"||g==="INNER_BULL")&&te(Ue=>(Ue||0)+1);{const Ue=Q,_e=Q+M;(_e>50&&Ue<=50||_e<=50)&&Ee(Qe=>(Qe||0)+1)}if(We){qt(W,R,{preOpenDarts:K||0,doubleWindowDarts:se||0,finishedByDouble:!0,visitTotal:W}),Qs(W),ve(0),j(0),v([]),te(0),Ee(0),Ht({score:W,darts:R,finished:!0});return}R>=3&&(qt(W,R,{preOpenDarts:K||0,doubleWindowDarts:se||0,finishedByDouble:!1,visitTotal:W}),ve(0),j(0),v([]),te(0),Ee(0),Ht({score:W,darts:R,finished:!1}))}function on(){if(!(Pe&&me)&&be){if(o)try{o(oe,st,void 0)}catch{}else Lt(oe,be,st);Ve(0),Xe(!1)}}function Yt(){if(Pe&&me)return;const i=an(De);if(!i){alert("Enter like T20, D16, 5, 25, 50");return}if(!wt||!be||st==="MISS"||oe===0){const d=Dt+1;Ve(d),d>=5&&Nt(!0)}else Ve(0);Lt(i.value,i.label,i.ring),H(""),Xe(!1)}function ar(){if(Pe&&me)return;const i=an(De);if(!i){alert("Enter like T20, D16, 5, 25, 50");return}if(V===0||N.length===0){Yt();return}if(u==="custom"){if(!wt||!be||st==="MISS"||oe===0){const je=Dt+1;Ve(je),je>=5&&Nt(!0)}else Ve(0);if(v(je=>[...je.slice(0,-1),{label:i.label,value:i.value,ring:i.ring}]),S)try{S(i.value,i.ring,{label:i.label})}catch{}H(""),Xe(!1);return}if(!wt||!be||st==="MISS"||oe===0){const je=Dt+1;Ve(je),je>=5&&Nt(!0)}else Ve(0);const d=N[N.length-1],g=V-1,R=b-(d?.value||0),q=ln(),M=R+i.value,W=g+1,z=q-M,Q=z===0&&(i.ring==="DOUBLE"||i.ring==="INNER_BULL");if(z<0||z===1||z===0&&!Q){qt(0,W);try{const je=ge.players[ge.currentPlayerIdx]?.name;je&&Jn(je,W,0)}catch{}ve(0),j(0),v([]),Ht({score:0,darts:W,finished:!1}),H(""),Xe(!1);return}if(ve(W),j(M),v(je=>[...je.slice(0,-1),{label:i.label,value:i.value,ring:i.ring}]),Q){qt(M,W),Qs(M);try{const je=ge.players[ge.currentPlayerIdx]?.name;je&&Jn(je,W,M)}catch{}ve(0),j(0),v([]),Ht({score:M,darts:W,finished:!0}),H(""),Xe(!1);return}if(W>=3){qt(M,W);try{const je=ge.players[ge.currentPlayerIdx]?.name;je&&Jn(je,W,M)}catch{}ve(0),j(0),v([]),Ht({score:M,darts:W,finished:!1})}H(""),Xe(!1)}function ir(){Nt(!1),Ve(0);try{window.dispatchEvent(new CustomEvent("ndn:request-calibrate"))}catch{}}function On(){kt(),Nt(!1),Ve(0)}n.useEffect(()=>{function i(d){try{const R=document.activeElement?.tagName?.toLowerCase();d.key==="m"&&R!=="input"&&R!=="textarea"&&(Wt("manual"),Bt(!0))}catch{}}return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[]);function Os(i,d){if(V>=3||Pe&&me)return;const g=i*(d==="S"?1:d==="D"?2:3),R=d==="S"?"SINGLE":d==="D"?"DOUBLE":"TRIPLE";if(!wt||!be||st==="MISS"||oe===0){const q=Dt+1;Ve(q),q>=5&&Nt(!0)}else Ve(0);Lt(g,`${d}${i} ${g}`,R),Xe(!1)}function lr(){if(V===0)return;const i=N[N.length-1];ve(d=>d-1),j(d=>d-(i?.value||0)),v(d=>d.slice(0,-1))}function or(){if(V===0||Pe&&me)return;if(u==="custom"){ve(0),j(0),v([]);return}const i=b,d=V;qt(i,d);try{const g=ge.players[ge.currentPlayerIdx]?.name;g&&Jn(g,d,i)}catch{}ve(0),j(0),v([]),Ht({score:i,darts:d,finished:!1})}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[r&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!re&&e.jsx("button",{className:`btn px-3 py-1 text-sm ${Rn==="auto"?"tab--active":""}`,onClick:()=>{Wt("auto"),Bt(!1),Rs(!0)},children:"Autoscore"}),e.jsx("button",{className:`btn px-3 py-1 text-sm ${Rn==="manual"?"tab--active":""}`,onClick:()=>{Wt("manual"),Bt(!0)},title:"Open Manual Correction",children:"Manual Correction"}),re&&e.jsx("span",{className:"text-xs opacity-70",children:"Manual scoring mode active"})]})}),!l&&!re?e.jsxs("div",{className:"card relative camera-fullwidth-card lg:col-span-2",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(ga,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,autoFill:!0,children:[e.jsx(Un,{}),(()=>{const i=we||Je.getState().cameraAspect||"wide",d=(Ne||Je.getState().cameraFitMode||"fit")==="fit",g=i==="square"?"absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black":d?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",R=i==="square"?"relative w-full mx-auto aspect-square bg-black":"relative w-full aspect-[4/3] bg-black",q=()=>e.jsxs("div",{className:R,children:[e.jsx("video",{ref:C,className:g,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:le,className:"absolute inset-0 w-full h-full",onClick:rn}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3 cursor-pointer select-none",onDoubleClick:Ts,"aria-label":`Visit status: ${N[0]?N[0].value>0?"hit":"miss":"pending"}, ${N[1]?N[1].value>0?"hit":"miss":"pending"}, ${N[2]?N[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(M=>{const W=N[M],z=zt[M],Q=!W,We=!!W&&z===Ft,je=typeof W?.value=="number"?W.value>0:!1,Ue=(W?.ring&&W.ring!=="MISS")??!1,Ke=We?We&&(je||Ue)?"bg-emerald-400":"bg-rose-500":"bg-gray-500/70",Qe=We&&!Q;return e.jsx("span",{className:`visit-dot ${Qe?"active":"inactive"} ${Ke}`},M)}),is&&ls!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,ls),"s"]})]}),Pe&&me?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return ze?fe?q():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Ps,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{A.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Pt,disabled:!ce.length,children:"Use Local Camera"})]})]})}):q()})()]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsxs("button",{className:"btn btn--ghost px-3 py-1 text-xs font-semibold",onClick:()=>Ln(i=>!i),children:[zs?"Hide":"Show"," detection log"]}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Recent detections: ",X.length]})]}),zs&&e.jsx("div",{className:"mt-2 rounded-2xl border border-white/15 bg-slate-900/80 p-3 text-xs text-white font-mono max-h-36 overflow-y-auto space-y-1",children:X.length===0?e.jsx("div",{className:"text-center text-slate-400",children:"No autoscore detections yet."}):X.slice().reverse().map(i=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"truncate flex-1",title:`Value ${i.value} ${i.ring}`,children:i.label.padEnd(6," ")}),e.jsx("span",{className:"text-slate-400",children:i.confidence.toFixed(2)}),e.jsx("span",{className:`px-2 rounded-full text-[10px] font-semibold ${i.accepted?"bg-emerald-500/80":i.ready?"bg-amber-500/80":"bg-rose-500/80"}`,children:i.accepted?"accepted":i.ready?"queued":"ignored"})]},i.ts))}),Ys?e.jsx("div",{className:"absolute top-3 right-3 z-30",children:(()=>{let i="bg-white/90 text-slate-800",d="Manual Correction (M)";wt&&(!!be&&st!=="MISS"&&oe>0?(i="bg-emerald-600 text-white",d=`Manual Correction (M) â€” Autoscore: ${be} (confirmed)`):(i="bg-amber-400 text-black",d=`Manual Correction (M) â€” Autoscore ambiguous: ${be||"â€”"}`));const g="px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90",R=wt&&!!be&&st!=="MISS"&&oe>0,q=nr&&R?"ring-4 ring-emerald-400/60 animate-ping":wt&&!R?"animate-pulse":"";return e.jsx("button",{className:`${g} ${i} ${q}`,onClick:()=>{Wt("manual"),Bt(!0)},title:d,children:"Manual"})})()}):null,e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[ze?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${fe?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:fe?"ðŸ“± Phone camera stream active":"ðŸ“± Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Ps,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{A.setShowOverlay?.(!A.showOverlay)}catch{}},children:A.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!fe,onClick:()=>{try{A.clearSession?.()}catch{}},children:"Stop Phone Feed"}),Bn&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Pt,disabled:!ce.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:p?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:Us,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:bs,disabled:$e,children:$e?"Connecting Camera...":"Connect Camera"})}),!re&&e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:Gs,title:"Open phone, WiFi, and USB camera options",children:"Camera Devices"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Se(!ie),title:"Toggle the board guide overlay",children:ie?"Show board guides":"Hide board guides"}),e.jsx("button",{className:`btn ${L?"bg-rose-600 hover:bg-rose-700 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white"}`,onClick:()=>J(!L),title:"Toggle whether the camera is used for scoring",children:L?"Disable camera mode":"Enable camera mode"}),e.jsx("button",{className:"btn",onClick:Pn,disabled:!Ce,children:"Capture Still"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",disabled:!Ce,onClick:()=>{fs.current=null,nn(i=>i+1)},children:"Reset Autoscore Background"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}):null,Ys?e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{className:"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg",title:"Open Manual Correction (M)",onClick:()=>{Wt("manual"),Bt(!0)},children:"âœï¸"})}):null,!l&&re&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Manual Scoring"}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:"Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{Bt(!0),Wt("manual")},children:"Open Manual Correction"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Manage Pending Visit"})]})]}),e.jsx("canvas",{ref:$,className:"hidden"}),Pr&&!re&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(kn,{storageKey:"ndn:autoscore:size",className:"w-full max-w-3xl",defaultWidth:720,defaultHeight:520,minWidth:420,minHeight:320,maxWidth:1400,maxHeight:900,initialFitHeight:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Autoscore"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn btn--ghost",onClick:()=>Rs(!1),children:"Close"})})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Click the camera overlay to autoscore. Use Manual Correction if the last auto is off."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:be||"â€”"}),e.jsx("button",{className:"btn",onClick:on,disabled:V>=3,children:"Add Auto Dart"}),Dt>0&&e.jsxs("span",{className:"text-sm opacity-80",children:["No-registers: ",Dt,"/3"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:V>=3,onClick:()=>{if(!wt||!be||st==="MISS"||oe===0){const i=Dt+1;Ve(i),i>=5&&Nt(!0)}else Ve(0);Lt(25,"BULL 25","BULL"),Xe(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:V>=3,onClick:()=>{if(!wt||!be||st==="MISS"||oe===0){const i=Dt+1;Ve(i),i>=5&&Nt(!0)}else Ve(0);Lt(50,"INNER_BULL 50","INNER_BULL"),Xe(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"autoscore-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:Ms,onChange:i=>tr(i.target.value.toUpperCase()),onKeyDown:i=>{if(i.key==="Enter"){const d=Ms.match(/^(S|D|T)(\d{1,2})$/);d&&Os(parseInt(d[2],10),d[1])}}}),e.jsx("datalist",{id:"autoscore-quick-list",children:["D","S","T"].map(i=>Array.from({length:20},(d,g)=>g+1).map(d=>e.jsx("option",{value:`${i}${d}`},`${i}${d}`)))}),e.jsx("button",{className:"btn",disabled:!Ms||V>=3,onClick:()=>{const i=Ms.match(/^(S|D|T)(\d{1,2})$/);if(!i)return;const d=i[1],g=parseInt(i[2],10);Os(g,d)},children:"Add"})]})]})]})})}),en&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex flex-col",children:e.jsxs(bi,{returnFocus:!0,children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{Bt(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:rr,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:be||"â€”"}),e.jsx("button",{className:"btn",onClick:on,disabled:V>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-[1.2]",placeholder:"Manual (T20, D16, 5, 25, 50)",value:De,onChange:i=>H(i.target.value),onKeyDown:i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),Yt()),i.key==="Enter"&&i.shiftKey&&(i.preventDefault(),ar())}}),e.jsx("button",{className:"btn btn--ghost",onClick:ar,disabled:V===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:Yt,disabled:V>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add Â· Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Number pad"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 max-w-sm",children:[["7","8","9","4","5","6","1","2","3","0"].map(i=>e.jsx("button",{className:"btn text-lg",onClick:()=>{H(d=>/^[SDT]/i.test(d)?d+i:(d||"")+i)},children:i},i)),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:()=>H(""),children:"Clear"}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 text-white",onClick:()=>H(i=>(i||"").slice(0,-1)),children:"âŒ«"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>Yt(),disabled:V>=3,children:"Enter"})]}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Tap numbers then press Enter to submit. Use D/T prefixes for doubles/trebles (e.g., D16)."})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:V>=3,onClick:()=>{if(!wt||!be||st==="MISS"||oe===0){const i=Dt+1;Ve(i),i>=5&&Nt(!0)}else Ve(0);Lt(25,"BULL 25","BULL"),Xe(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:V>=3,onClick:()=>{if(!wt||!be||st==="MISS"||oe===0){const i=Dt+1;Ve(i),i>=5&&Nt(!0)}else Ve(0);Lt(50,"INNER_BULL 50","INNER_BULL"),Xe(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:As,onChange:i=>Br(i.target.value.toUpperCase()),onKeyDown:i=>{if(i.key==="Enter"){const d=As.match(/^(S|D|T)(\d{1,2})$/);d&&Os(parseInt(d[2],10),d[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(i=>Array.from({length:20},(d,g)=>g+1).map(d=>e.jsx("option",{value:`${i}${d}`},`${i}${d}`)))}),e.jsx("button",{className:"btn",disabled:!As||V>=3,onClick:()=>{const i=As.match(/^(S|D|T)(\d{1,2})$/);if(!i)return;const d=i[1],g=parseInt(i[2],10);Os(g,d)},children:"Add"})]})]})]})]})})]})})}),Ta&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsx(bi,{returnFocus:!0,children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",role:"dialog","aria-modal":"true",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>In(!1),"aria-label":"Close scoring dialog",children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(ga,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:360,minHeight:270,maxWidth:800,maxHeight:600,children:[e.jsx(Un,{}),(()=>{const d=(Je.getState().cameraFitMode||"fit")==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-black":"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black",g=()=>e.jsxs("div",{className:"relative w-full aspect-[4/3] bg-black",children:[e.jsx("video",{ref:C,className:d,playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:le,className:"absolute inset-0 w-full h-full",onClick:rn}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3","aria-label":`Visit status: ${N[0]?N[0].value>0?"hit":"miss":"pending"}, ${N[1]?N[1].value>0?"hit":"miss":"pending"}, ${N[2]?N[2].value>0?"hit":"miss":"pending"}`,children:[[0,1,2].map(R=>{const q=N[R],M=!q,W=!!q&&(typeof q.value=="number"?q.value>0:!0),z=M?"bg-gray-500/70":W?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-3 h-3 rounded-full shadow ${z}`},R)}),is&&ls!==null&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold",children:[Math.max(0,ls),"s"]})]}),Pe&&me?e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20 bg-black/70 text-amber-200 text-xs font-semibold px-3 py-1 rounded-full shadow",children:"Remove darts to continue"}):null]});return ze?fe?g():e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50",children:e.jsxs("div",{className:"text-center space-y-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“±"}),e.jsx("div",{className:"text-lg font-semibold text-blue-100",children:"Phone camera selected"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Start streaming from the Calibrator tab or reconnect below."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Ps,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{A.setShowOverlay?.(!0)}catch{}},children:"Show Overlay"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Pt,disabled:!ce.length,children:"Use Local Camera"})]})]})}):g()})()]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[ze?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm px-3 py-2 rounded border flex-1 min-w-[200px] ${fe?"bg-emerald-500/10 border-emerald-400/40 text-emerald-100":"bg-amber-500/10 border-amber-400/40 text-amber-100"}`,children:fe?"ðŸ“± Phone camera stream active":"ðŸ“± Waiting for phone camera stream"}),e.jsx("button",{className:"btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 text-sm",onClick:Ps,children:"Reconnect Phone"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 text-white px-3 py-1 text-sm",onClick:()=>{try{A.setShowOverlay?.(!A.showOverlay)}catch{}},children:A.showOverlay?"Hide Overlay":"Show Overlay"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 text-sm",disabled:!fe,onClick:()=>{try{A.clearSession?.()}catch{}},children:"Stop Phone Feed"}),Bn&&e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 text-sm",onClick:Pt,disabled:!ce.length,children:"Use Local Camera"})]}):e.jsx(e.Fragment,{children:p?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:Us,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:bs,children:"Connect Camera"})}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:Pn,disabled:!Ce,children:"Capture Still"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold",disabled:!Ce,onClick:()=>{fs.current=null,nn(i=>i+1)},children:"Reset Autoscore Background"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[0,1,2].map(i=>{const d=N[i],g=!d,R=!!d&&(typeof d.value=="number"?d.value>0:!0),q=g?"bg-gray-500/70":R?"bg-emerald-400":"bg-rose-500";return e.jsx("span",{className:`w-2.5 h-2.5 rounded-full shadow ${q}`},i)}),is&&ls!==null&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold",children:[Math.max(0,ls),"s"]})]}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:N.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):N.map((i,d)=>e.jsx("li",{children:i.label},d))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",V,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",b]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:lr,disabled:V===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:or,disabled:V===0,children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:Mn,disabled:V===0,children:"Clear"})]})]})]})]})})}),sr&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>{Nt(!1),Ve(0)},children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-white",children:"Recalibration Recommended"}),e.jsx("div",{className:"mb-4 text-lg font-semibold text-indigo-200",children:"We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:ir,children:"Go to Calibrate"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:On,children:"Reset Calibration"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{Nt(!1),Ve(0)},children:"Dismiss"})]})]})})]})}function Ci(s,r,o,m){const l=(m-90)*Math.PI/180;return{x:s+o*Math.cos(l),y:r+o*Math.sin(l)}}function ki(s){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(s)*18+9}function ao({width:s=320,height:r=320}){const o=Oi(l=>l.samples),m=n.useRef(null);return n.useEffect(()=>{const l=m.current;if(!l)return;const u=l.getContext("2d");if(!u)return;l.width=s,l.height=r,u.clearRect(0,0,s,r);const x=s/2,S=r/2,k=Math.min(s,r)/(Cs.doubleOuter*2+20),T={bullInner:Cs.bullInner*k,bullOuter:Cs.bullOuter*k,trebleInner:Cs.trebleInner*k,trebleOuter:Cs.trebleOuter*k,doubleInner:Cs.doubleInner*k,doubleOuter:Cs.doubleOuter*k};u.strokeStyle="rgba(255,255,255,0.06)",u.lineWidth=1;const I=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const y of I)u.beginPath(),u.arc(x,S,T[y],0,Math.PI*2),u.stroke();const C=[];for(const y of o){let E=Math.random()*360,Y=Math.random()*T.doubleOuter;typeof y.sector=="number"&&y.sector>=1&&y.sector<=20&&(E=ki(y.sector),y.ring==="DOUBLE"?Y=(T.doubleInner+T.doubleOuter)/2:y.ring==="TRIPLE"?Y=(T.trebleInner+T.trebleOuter)/2:y.ring==="INNER_BULL"?Y=T.bullInner*.5:y.ring==="BULL"?Y=T.bullOuter*.8:Y=(T.trebleOuter+T.doubleInner)/2*(.6+Math.random()*.4));const D=Ci(x,S,Y,E);C.push({x:D.x,y:D.y,w:1})}for(const y of C){const E=u.createRadialGradient(y.x,y.y,1,y.x,y.y,60);E.addColorStop(0,"rgba(255,0,0,0.9)"),E.addColorStop(.3,"rgba(255,100,0,0.5)"),E.addColorStop(1,"rgba(255,100,0,0)"),u.fillStyle=E,u.beginPath(),u.arc(y.x,y.y,60,0,Math.PI*2),u.fill()}u.fillStyle="rgba(255,255,255,0.85)",u.font="12px ui-sans-serif";const F={};for(const y of o)y.sector&&(F[y.sector]=(F[y.sector]||0)+1);for(const y of Object.keys(F)){const E=Number(y),Y=ki(E),D=Ci(x,S,T.trebleOuter+18,Y);u.fillText(String(F[E]),D.x-6,D.y+4)}},[o,s,r]),e.jsx("canvas",{ref:m,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}const Er=[...Array.from({length:20},(s,r)=>({label:`D${r+1}`,score:(r+1)*2})),{label:"DBULL",score:50,isBull:!0}];function Di(s,r){const o=Er[r];return!!o&&s===o.score}function Cn(s){const r=s.trim().toUpperCase();if(!r)return null;if(r==="50"||r==="BULL"||r==="DBULL"||r==="IBULL")return 50;if(r==="25"||r==="OBULL")return 25;const o=r.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!o)return null;const m=o[1]||"S",l=parseInt(o[2],10);return l<1||l>20?null:l*(m==="S"?1:m==="D"?2:3)}const Ss=[...Array.from({length:20},(s,r)=>r+1),25,50],Ca=[20,19,18,17,16,15,25];function ha(){const s={};return Ca.forEach(r=>{s[r]=0}),{marks:s,points:0}}function io(s,r,o,m,l=()=>!1){let u=null,x=0;if(o==="BULL"||o==="INNER_BULL"||r===25||r===50)u=25,x=o==="INNER_BULL"||r===50?2:1;else if(typeof m=="number"&&m>=15&&m<=20)u=m,o==="TRIPLE"?x=3:o==="DOUBLE"?x=2:x=1;else if(r){const y=[20,19,18,17,16,15];for(const E of y){if(r===E){u=E,x=1;break}if(r===E*2){u=E,x=2;break}if(r===E*3){u=E,x=3;break}}!u&&(r===25||r===50)&&(u=25,x=r===50?2:1)}if(!u)return 0;const S=s.marks[u],k=Math.max(0,3-S),T=Math.min(k,x),I=Math.max(0,x-T),C=S+T;s.marks[u]=C>3?3:C;let F=0;return I>0&&!l(u)&&(u===25?o==="INNER_BULL"?F+=50*I:F+=25*I:F+=u*I),s.points+=F,F}function lo(s){return Ca.every(r=>(s.marks[r]||0)>=3)}function xa(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function oo(s){return s.round}function co(s,r,o,m){if(s.finished)return 0;const l=oo(s);let u=0;return typeof m=="number"&&m===l?o==="TRIPLE"?(u=l*3,s.turnHits.triples++):o==="DOUBLE"?(u=l*2,s.turnHits.doubles++):o==="SINGLE"&&(u=l*1,s.turnHits.singles++):!m&&(r===l||r===l*2||r===l*3)&&(r===l*3?(u=l*3,s.turnHits.triples++):r===l*2?(u=l*2,s.turnHits.doubles++):r===l&&(u=l,s.turnHits.singles++)),s.score+=u,u}function uo(s){if(!s.finished){if(s.turnHits.singles>0&&s.turnHits.doubles>0&&s.turnHits.triples>0){s.shanghaiAchieved=!0,s.finished=!0;return}const r=s.round+1;r>20?s.finished=!0:s.round=r}s.turnHits={singles:0,doubles:0,triples:0}}function fa(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function Fi(s){return s.targets[s.stage]||null}function mo(s,r,o,m){if(s.finished)return 0;const l=Fi(s);if(!l)return 0;let u=0;switch(l.kind){case"NUMBER":{typeof m=="number"&&m===l.num?o==="TRIPLE"?u=l.num*3:o==="DOUBLE"?u=l.num*2:o==="SINGLE"&&(u=l.num):!m&&(r===l.num||r===l.num*2||r===l.num*3)&&(u=r),u>0&&(s.hitThisRound=!0);break}case"DOUBLE":{(o==="DOUBLE"&&m===l.num||r===l.num*2)&&(u=l.num*2,s.hitThisRound=!0);break}case"TRIPLE":{(o==="TRIPLE"&&m===l.num||r===l.num*3)&&(u=l.num*3,s.hitThisRound=!0);break}case"BULL":{(o==="BULL"||o==="INNER_BULL"||r===25||r===50)&&(u=o==="INNER_BULL"||r===50?50:25,s.hitThisRound=!0);break}case"ANY_NUMBER":{r>0&&(u=r,s.hitThisRound=!0);break}}return s.score+=u,u}function ho(s){s.finished||(s.hitThisRound||(s.score=Math.floor(s.score/2)),s.hitThisRound=!1,s.stage+=1,s.stage>=s.targets.length&&(s.finished=!0))}function ba(){return{round:1,score:0,target:"HIGH",finished:!1}}function xo(s,r,o,m){if(s.finished)return 0;let l=0;if(s.target==="HIGH")if(o==="INNER_BULL")l=50;else if(typeof m=="number"){const x=m*(o==="TRIPLE"?3:o==="DOUBLE"?2:1);m>=20&&(l=x)}else r>=40&&(l=r);else if(typeof m=="number"){const x=m*(o==="TRIPLE"?3:o==="DOUBLE"?2:1);m<=10&&(l=x)}else r>0&&r<=30&&(l=r);return s.score+=l,l}function fo(s){if(!s.finished){if(s.round+=1,s.round>10){s.finished=!0;return}s.target=s.target==="HIGH"?"LOW":"HIGH"}}function bo(s,r=3){return{number:s,lives:r,isKiller:!1,eliminated:!1}}function po(s){const r=Array.from({length:20},(m,l)=>l+1),o={};for(const m of s){const l=Math.floor(Math.random()*r.length),u=r.splice(l,1)[0];o[m]=u}return o}function Ti(s,r,o,m){const l=r[s];if(!l||!m||!o)return{becameKiller:!1};if(!l.isKiller&&o==="DOUBLE"&&m===l.number)return l.isKiller=!0,{becameKiller:!0};if(l.isKiller&&(o==="DOUBLE"||o==="TRIPLE")){const u=Object.keys(r).find(x=>x!==s&&!r[x].eliminated&&r[x].number===m);if(u){const x=r[u],S=o==="TRIPLE"?2:1;return x.lives=Math.max(0,x.lives-S),x.lives===0&&(x.eliminated=!0),{becameKiller:!1,victimId:u,livesRemoved:S}}}return{becameKiller:!1}}function Li(s){const r=Object.entries(s).filter(([,o])=>!o.eliminated&&o.lives>0);return r.length===1?r[0][0]:null}function Mi(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function go(s,r,o,m){if(s.finished)return 0;let l=0;if(typeof m=="number"&&m===s.inning?o==="TRIPLE"?l=3:o==="DOUBLE"?l=2:l=1:!m&&(r===s.inning||r===s.inning*2||r===s.inning*3)&&(l=r===s.inning*3?3:r===s.inning*2?2:1),s.score+=l,s.dartsThisInning+=1,s.dartsThisInning>=3){const u=s.inning+1;u>9?s.finished=!0:(s.inning=u,s.dartsThisInning=0)}return l}const vo={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function Ai(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function jo(s,r,o,m){if(s.finished)return!1;const l=vo[s.hole];if(s.dartsThisHole+=1,typeof m=="number"&&m===l&&(o==="SINGLE"||o==="DOUBLE"||o==="TRIPLE")||!m&&(r===l||r===l*2||r===l*3)){s.strokes+=s.dartsThisHole;const x=s.hole+1;return x>18?s.finished=!0:(s.hole=x,s.dartsThisHole=0),!0}if(s.dartsThisHole>=3){s.strokes+=3;const x=s.hole+1;x>18?s.finished=!0:(s.hole=x,s.dartsThisHole=0)}return!1}const $i={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function Ei(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function No(s){const r=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[o,m,l]of r)if(s[o]&&s[o]===s[m]&&s[o]===s[l])return s[o];return s.every(o=>o)?"Draw":null}function wo(s,r,o,m,l){if(s.finished||s.board[r])return!1;const u=$i[r];let x=!1;if(u.type==="BULL"?x=m==="BULL"||m==="INNER_BULL"||o===25||o===50:u.type==="NUM"&&typeof u.num=="number"&&(typeof l=="number"&&l===u.num||!l&&(o===u.num||o===u.num*2||o===u.num*3))&&(x=!0),!x)return!1;s.board[r]=s.turn;const S=No(s.board);return S?(s.finished=!0,s.winner=S,!0):(s.turn=s.turn==="X"?"O":"X",!0)}function va(){return{targetIndex:0,darts:0,finished:!1}}const Hi=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25],pa=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","Bull"];function yo(s){return Hi[s.targetIndex]}function ja(s,r,o){if(s.finished)return s;const m=yo(s);if(!(o==="SINGLE"&&r===m||o==="DOUBLE"&&r===m||o==="TRIPLE"&&r===m||o==="INNER_BULL"&&m===25))return s;const u=s.targetIndex+1,x=u>=Hi.length;return{targetIndex:u,darts:s.darts+1,finished:x}}function Ri(s,r){return ja(s,r,"SINGLE")}function So(){return va()}function Na(s=50){return{score:0,darts:0,finished:!1,target:s}}const Co=[5,10,15,20,25,50];function ko(s){return Co.includes(s)}function wa(s,r,o){if(s.finished)return s;if(!ko(r))return{...s,darts:s.darts+1};const m=s.score+r,l=m>=s.target;return{score:l?s.target:m,darts:s.darts+1,finished:l,target:s.target}}function Ii(s,r){return wa(s,r)}function Do(s=50){return Na(s)}function ya(s=70){return{score:0,darts:0,finished:!1,target:s}}const To=[7,14,21];function Lo(s){return To.includes(s)}function Sa(s,r,o){if(s.finished)return s;if(!Lo(r))return{...s,darts:s.darts+1};const m=s.score+r,l=m>=s.target;return{score:l?s.target:m,darts:s.darts+1,finished:l,target:s.target}}function Bi(s,r){return Sa(s,r)}function Mo(s=70){return ya(s)}const ka=[20,19,18,17,16,15,14,13,12,25];function Pi(){const s={};return ka.forEach(r=>{s[r]=0}),{marks:s,points:0}}function Ao(s,r,o,m,l=()=>!1){let u=null,x=0;if(o==="BULL"||o==="INNER_BULL"||r===25||r===50)u=25,x=o==="INNER_BULL"||r===50?2:1;else if(typeof m=="number"&&m>=12&&m<=20)u=m,o==="TRIPLE"?x=3:o==="DOUBLE"?x=2:x=1;else if(r){for(const y of[20,19,18,17,16,15,14,13,12]){if(r===y){u=y,x=1;break}if(r===y*2){u=y,x=2;break}if(r===y*3){u=y,x=3;break}}!u&&(r===25||r===50)&&(u=25,x=r===50?2:1)}if(!u)return 0;const S=s.marks[u],k=Math.max(0,3-S),T=Math.min(k,x),I=Math.max(0,x-T),C=S+T;s.marks[u]=C>3?3:C;let F=0;return I>0&&!l(u)&&(u===25?o==="INNER_BULL"?F+=50*I:F+=25*I:F+=u*I),s.points+=F,F}function Eo(s){return ka.every(r=>(s.marks[r]||0)>=3)}function Ro({left:s,right:r,className:o="",sticky:m=!0}){return e.jsxs("div",{className:`${m?"sticky top-0":""} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${o}`,children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:s}),e.jsx("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:r})]})}function ns({gameMode:s,players:r,matchScore:o,gameRules:m}){return!r||r.length===0?null:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:r.map((l,u)=>e.jsxs("div",{className:`rounded-lg border p-3 ${l.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-2 uppercase tracking-wide ${l.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:l.name}),e.jsxs("div",{className:"space-y-1 text-sm",children:[s==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Legs Won",value:`â— ${l.legsWon||0}`,highlight:!0}),e.jsx(ae,{label:"Score",value:l.score||0,mono:!0,bold:!0}),e.jsx(ae,{label:"Last Score",value:l.lastScore||"0",mono:!0}),e.jsx(ae,{label:"C/Out Rate",value:`${l.checkoutRate||0}%`,mono:!0}),e.jsx(ae,{label:"Best Leg",value:l.bestLeg||"â€”",mono:!0}),l.matchAvg!==void 0&&l.allTimeAvg!==void 0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[e.jsx(ae,{label:"Match Avg",value:l.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:l.matchAvg>0}),e.jsx(Io,{matchAvg:l.matchAvg,allTimeAvg:l.allTimeAvg})]})})]}),(s==="Cricket"||s==="American Cricket")&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Closed",value:Bo(l.closed),mono:!0}),e.jsx(ae,{label:"Points",value:l.points||0,mono:!0,bold:!0}),e.jsx(ae,{label:"Status",value:Po(l),highlight:l.isCurrentTurn})]}),(s==="Shanghai"||s==="Halve It")&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:s==="Shanghai"?"Round":"Stage",value:l.round||1,mono:!0}),e.jsx(ae,{label:"Target",value:l.target||"â€”",mono:!0}),e.jsx(ae,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Killer"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Target #",value:l.number||"â€”",mono:!0,bold:!0}),e.jsx(ae,{label:"Lives",value:l.lives||0,mono:!0,bold:!0}),l.eliminated&&e.jsx(ae,{label:"Status",value:"ELIMINATED",highlight:!1})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Round",value:l.round||1,mono:!0}),e.jsx(ae,{label:"Target",value:l.target||"High",mono:!0}),e.jsx(ae,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),(s==="Double Practice"||s==="Treble Practice"||s==="Around the Clock")&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Target",value:l.target||"â€”",mono:!0,bold:!0}),e.jsx(ae,{label:"Hits",value:l.hits||0,mono:!0,bold:!0}),l.totalNeeded&&e.jsx(ae,{label:"Progress",value:`${l.hits||0} / ${l.totalNeeded}`,mono:!0})]}),(s==="Count-Up"||s==="High Score"||s==="Low Score")&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Round",value:l.round||1,mono:!0}),e.jsx(ae,{label:"Score",value:l.score||0,mono:!0,bold:!0}),s==="High Score"&&e.jsx(ae,{label:"Best",value:l.bestScore||0,mono:!0})]}),(s==="Checkout 170"||s==="Checkout 121")&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Remaining",value:l.remaining||0,mono:!0,bold:!0}),e.jsx(ae,{label:"Attempts",value:l.attempts||0,mono:!0}),e.jsx(ae,{label:"Successes",value:l.successes||0,mono:!0})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Target",value:`D${l.target||1}`,mono:!0,bold:!0}),e.jsx(ae,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Inning",value:l.inning||1,mono:!0}),e.jsx(ae,{label:"Score",value:l.score||0,mono:!0,bold:!0})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Hole",value:l.hole||1,mono:!0}),e.jsx(ae,{label:"Strokes",value:l.strokes||0,mono:!0,bold:!0})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:"Turn",value:l.turn||1,mono:!0}),l.winner&&e.jsx(ae,{label:"Result",value:"WINNER!",highlight:!0})]}),o&&(s==="X01"||s==="Cricket"||s==="American Cricket")&&u===1&&e.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:e.jsx(ae,{label:"Match",value:o,mono:!0,bold:!0,highlight:!0})})]})]},u))})}function ae({label:s,value:r,mono:o=!1,bold:m=!1,highlight:l=!1}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"opacity-70",children:[s,":"]}),e.jsx("span",{className:`${o?"font-mono":""} ${m?"font-semibold":""} ${l?"text-emerald-300":""}`,children:r})]})}function Io({matchAvg:s,allTimeAvg:r}){const o=s-r,m=o>0,l=Math.abs(o)<.01;let u="",x="text-slate-300";return l?(u="= All-time",x="text-slate-300"):m?(u=`+${o.toFixed(2)} vs avg`,x="text-emerald-400"):(u=`${o.toFixed(2)} vs avg`,x="text-orange-400"),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"opacity-70",children:"AVG vs Avg:"}),e.jsx("span",{className:`font-mono font-semibold ${x}`,children:u})]})}function Bo(s){return!s||Object.keys(s).length===0?"â€”":Object.entries(s).filter(([o,m])=>m===3).map(([o])=>o==="25"?"B":o).join(",")||"â€”"}function Po(s){if(!s.closed)return"Starting";const r=Object.values(s.closed).filter(o=>o===3).length;return r===0?"No marks":r<7?`${r}/7`:"Closing in"}function Et(s){return(r,o)=>{s(r)}}function Uo(s){const{match:r,commitManualVisitTotal:o,endTurn:m}=s;return{addVisit:(l,u=3,x)=>{if(o){o(l);return}try{r.addVisit(l,u,x)}catch{r.addVisit(l,u)}},undoVisit:()=>{r.undoVisit()},nextPlayer:()=>{if(m)try{m(0)}catch{r.nextPlayer()}else r.nextPlayer()},endLeg:l=>{typeof l=="number"?r.endLeg(l):r.endLeg(0)},endGame:()=>{r.endGame()}}}function Ks(s,r,o,m,l,u,x,S,k,T,I,C,F,y,E,Y,D,we,Ne,he,L,J,pe,ie,Se,re,ce){return n.useMemo(()=>{const xe=[];if(s==="X01"){let $=0,le=0,p=0;if(we&&we.length>0){for(const Ce of we)Ce.dartsThrown&&Ce.totalScored&&(le+=Ce.dartsThrown,p+=Ce.totalScored);le>0&&($=p/le*3)}const fe=(C??0)>0?S??0:T??null??(u??0);if(xe.push({name:"You",isCurrentTurn:!!Ne,legsWon:m||0,score:r||0,lastScore:fe,checkoutRate:E&&E>0?Math.round((y||0)/E*100):0,bestLeg:we&&we.length>0?`${Math.min(...we.map(Ce=>Ce.doubleDarts+(Ce.checkoutDarts||0)))||0} darts`:"â€”",matchAvg:$,allTimeAvg:Il("You")||0}),he&&he!=="None"){const ne=(F??0)>0?k??0:I??null??(x??0);xe.push({name:`${he} AI`,isCurrentTurn:!Ne,legsWon:l||0,score:o||0,lastScore:ne,checkoutRate:D&&D>0?Math.round((Y||0)/D*100):0,bestLeg:"â€”"})}}return s==="Cricket"&&(xe.push({name:"You",isCurrentTurn:!!Ne,closed:J?.marks||{},points:J?.points||0}),he&&he!=="None"&&xe.push({name:`${he} AI`,isCurrentTurn:!Ne,closed:{},points:0})),s==="Shanghai"&&(xe.push({name:"You",isCurrentTurn:!!Ne,round:pe?.round||1,target:pe?.target||1,score:pe?.score||0}),he&&he!=="None"&&xe.push({name:`${he} AI`,isCurrentTurn:!Ne,round:pe?.round||1,target:pe?.target||1,score:0})),s==="Killer"&&ie&&ie.length>0&&ie.forEach(($,le)=>{const p=Se?.[$.id];xe.push({name:$.name,isCurrentTurn:le===ce,number:re?.[$.id],lives:p?.lives||0,eliminated:p?.eliminated||!1})}),xe},[s,r,o,m,l,u,x,S,k,T,I,C,F,y,E,Y,D,we,Ne,he,J,pe,ie,Se,re,ce])}const Oo=["Easy","Medium","Hardened"];function rs(s,r,o){return Math.max(r,Math.min(o,s))}const Fo=6500;function $o(s,r){let o=0;if(r==="Easy"){const m=[22,26,41,45,60];o=m[Math.floor(Math.random()*m.length)]}else r==="Medium"?o=Math.round(rs(60+(Math.random()*30-15),30,100)):o=Math.round(rs(80+(Math.random()*20-10),50,120));return s<=0?0:o>s?[100,85,81,60,57,45,41,26,22,20,1].find(l=>l<=s)??0:o}function Ho({onClose:s}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:s,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const Vo="http://localhost:8787";function ec({user:s}){const{offlineLayout:r,favoriteDouble:o,callerEnabled:m,callerVoice:l,callerVolume:u,speakCheckoutOnly:x,rememberLastOffline:S,setLastOffline:k,autoStartOffline:T,cameraScale:I,setCameraScale:C,cameraAspect:F="wide",setCameraAspect:y,cameraFitMode:E="fill",setCameraFitMode:Y,cameraEnabled:D,textSize:we,boxSize:Ne,autoscoreProvider:he,autoCommitMode:L="wait-for-clear",matchType:J="singles",setMatchType:pe,teamAName:ie="Team A",setTeamAName:Se,teamBName:re="Team B",setTeamBName:ce}=Je(),xe=he==="manual",$=D&&!xe,le=D&&!xe&&L!=="immediate",[p,et]=n.useState("X01"),[A,ze]=n.useState(501),[Z,Me]=n.useState("None"),[fe,Ce]=n.useState(!1),[$e,tt]=n.useState(!1),[de,ke]=n.useState(A),[ne,He]=n.useState(A),[ms,kt]=n.useState(!1),[Kt,ue]=n.useState(!1),[be,ot]=n.useState(1),[De,H]=n.useState(0),oe=Ar(),[Ge,st]=n.useState(!1),ft=n.useRef(!1),[V,ve]=n.useState(0),[b,j]=n.useState(null),[N,v]=n.useState(1),[K,te]=n.useState(1),[se,Ee]=n.useState([]),[me,Rt]=n.useState(2e3),ct=Bl(),[Be,Pe]=n.useState(!1),[Ft,hs]=n.useState(r==="modern"),[zt,Qn]=n.useState(r==="modern");n.useEffect(()=>{hs(r==="modern"),Qn(r==="modern")},[r]),n.useEffect(()=>{E!=="fit"&&Y("fit")},[E,Y]);const[qe,Tn]=n.useState(1),[Ir,as]=n.useState(!1),[ye,jt]=n.useState(!0);n.useEffect(()=>{const t=()=>bn(!0);return window.addEventListener("ndn:open-camera-manager",t),()=>window.removeEventListener("ndn:open-camera-manager",t)},[]);const[ee,X]=n.useState(0),[ks,zs]=n.useState(0),[Ln,xs]=n.useState(0),[Gt,$t]=n.useState(0),[Ht,Ds]=n.useState(0),[Ts,Mn]=n.useState(ha()),[Gs,qs]=n.useState(xa()),[It,Xs]=n.useState(fa()),[Ls,ge]=n.useState(ba()),[An,nt]=n.useState(0),[En,Ys]=n.useState(1),[Zn,Js]=n.useState(27),[Da,er]=n.useState(0),[qt,Qs]=n.useState(0),[Zs,Ms]=n.useState(!1),[tr,As]=n.useState(1),[Br,Dt]=n.useState(0),[Ve,sr]=n.useState(0),Nt=8,[wt,Xe]=n.useState(1),[nr,Es]=n.useState(0),[Vt,Rn]=n.useState(0),Wt=10,[en,Bt]=n.useState(1),[Pr,Rs]=n.useState(0),[Ta,In]=n.useState(0),rr=10,[is,Is]=n.useState(170),[ls,tn]=n.useState(0),[Tt,Bs]=n.useState(0),[fs,Xt]=n.useState(0),[sn,nn]=n.useState(121),[Ps,Bn]=n.useState(0),[bs,Us]=n.useState(0),[Pn,Un]=n.useState(0),[Pt,rn]=n.useState(20),[an,ln]=n.useState(0),[Lt,on]=n.useState(0),[Yt,ar]=n.useState(30),[ir,On]=n.useState(!1),[Os,lr]=n.useState(Mi()),[or,i]=n.useState(Ai()),[d,g]=n.useState(Ei()),[R,q]=n.useState(Pi()),[M,W]=n.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[z,Q]=n.useState({}),[We,je]=n.useState({}),[Ue,_e]=n.useState(!1),[Ke,Qe]=n.useState(0),[ps,_t]=n.useState(0),[gs,Fs]=n.useState(null),[Ur,Mt]=n.useState(""),[it,os]=n.useState(va()),[Jt,Qt]=n.useState(va()),[$s,Fn]=n.useState(Na(50)),[Ye,dt]=n.useState(Na(50)),[Zt,Or]=n.useState(ya(70)),[yt,Ut]=n.useState(ya(70)),[cn,Oe]=n.useState(0),[Ae,Re]=n.useState(0),[Fe,Ze]=n.useState(0),[es,cs]=n.useState(A),[St,at]=n.useState(0),[vs,ds]=n.useState(null),[cr,bt]=n.useState(0),Hs=n.useRef(0),Vi=n.useRef(0),ut=n.useRef(de),mt=n.useRef(Fe),pt=n.useRef(St),Vs=n.useRef(es),ht=n.useRef(cr);n.useEffect(()=>{ut.current=de},[de]),n.useEffect(()=>{mt.current=Fe},[Fe]),n.useEffect(()=>{pt.current=St},[St]),n.useEffect(()=>{Vs.current=es},[es]),n.useEffect(()=>{ht.current=cr},[cr]);const[Wi,$n]=n.useState(0);n.useRef(null);const[dr,Fr]=n.useState(0),[Ws,ur]=n.useState(0),[dn,_s]=n.useState(0),[un,us]=n.useState(0),[mn,hn]=n.useState(null),[$r,xn]=n.useState(0),[Hn,Vn]=n.useState(0),[Hr,mr]=n.useState(0),[Wn,La]=n.useState(0),[Vr,Ma]=n.useState(0),[_n,fn]=n.useState(0),[Kn,Aa]=n.useState(0),[Wr,zn]=n.useState(0),[_r,Ea]=n.useState(0),[Ra,hr]=n.useState(0),[_i,xr]=n.useState(0),[Ki,fr]=n.useState(0),[Ia,Kr]=n.useState(0),[zi,zr]=n.useState(0),[Gi,Gr]=n.useState(0),[qi,br]=n.useState(0),[Xi,Ba]=n.useState(0),[Yi,qr]=n.useState(!1),[xt,lt]=n.useState(""),[Xr,Gn]=n.useState(""),[Wo,_o]=n.useState(""),[Pa,Ua]=n.useState(""),[Oa,Yr]=n.useState(""),[Fa,Jr]=n.useState(""),[pr,Qr]=n.useState(null),[Ji,bn]=n.useState(!1),[Qi,$a]=n.useState({}),[Zi,qn]=n.useState(!1),js=n.useRef(null),Zr=n.useRef(null),ts=n.useCallback(()=>{const t=Zr.current;t&&(clearTimeout(t),Zr.current=null)},[]),gr=n.useCallback(t=>{if(!m)return;const a=s?.username||"Player";try{Mr(a,t.visitTotal,Math.max(t.remaining,0),l,{volume:u,checkoutOnly:x})}catch{}},[m,l,u,x,s?.username]),vr=n.useCallback((t,a)=>{qn(!1);const{visitTotal:c,darts:h,preRemaining:f,remaining:U,doubleAttempts:P,finished:G,doubleWindow:B,highestCheckout:O}=t;G?(ke(0),ut.current=0,typeof O=="number"&&O>0&&br(w=>Math.max(w,O))):(ke(U),ut.current=U),ds(c),c===180?hr(w=>w+1):c>=140?xr(w=>w+1):c>=100&&fr(w=>w+1),B&&P>0&&(Vn(w=>w+P),G&&mr(w=>w+1)),t.announced||gr(t);try{Dn.getState().recordVisit("offline-x01",h,c,{preRemaining:f,postRemaining:G?0:U,finish:G,bust:!1})}catch{}G&&(j("player"),ue(!0)),yn(G?0:U),at(0),pt.current=0,Ze(0),mt.current=0,bt(0),ht.current=0},[yn,br,j,ke,ds,at,Ze,bt,ue,hr,xr,fr,Vn,mr,gr]),pn=n.useCallback(t=>{const a=js.current;a&&(js.current=null,ts(),vr(a,t))},[ts,vr]),Ha=n.useCallback(t=>{gr(t),js.current={...t,announced:!0},qn(!0),ts(),Zr.current=setTimeout(()=>pn("timeout"),Fo)},[ts,pn,gr]);n.useEffect(()=>{if(!le)return;const t=()=>pn("event");return window.addEventListener("ndn:darts-cleared",t),()=>window.removeEventListener("ndn:darts-cleared",t)},[le,pn]),n.useEffect(()=>{le||pn("timeout")},[le,pn]),n.useEffect(()=>()=>ts(),[ts]),n.useEffect(()=>{if(Fe===0){try{window.dispatchEvent(new CustomEvent("ndn:darts-cleared",{detail:{source:"offline-play",ts:Date.now()}}))}catch{}Hs.current=0}Vi.current=Fe},[Fe]);const Ns=s?.username||"Player 1",gn=Z==="None"?"Player 2":Z,jr=Ks("X01",de,ne,De,V,Ae,Ws,St,dn,vs,mn,Fe,un,Hr,Hn,Vr,Wn,se,ye,Z),el=Ks("Cricket",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ts),tl=Ks("Shanghai",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,ye,Z,void 0,Ts,Gs),sl=Ks("Killer",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,M,z,We,Ke),nl=Ks("Scam"),rl=Ks("Fives"),al=Ks("Sevens"),Nr=n.useMemo(()=>{const t=jr||[],a=Fe>0?St:vs??Ae,c=un>0?dn:mn??Ws;return t.length===0?{name:ye?Ns:gn,isCurrentTurn:!0,legsWon:ye?De:V,score:ye?de:ne,lastScore:ye?a:c}:t.find(h=>h.isCurrentTurn)??t[0]},[jr,ye,Ns,gn,De,V,de,ne,Fe,St,vs,Ae,dn,mn,Ws,un]),Va=n.useMemo(()=>{if(!Nr)return[];const{matchAvg:t,allTimeAvg:a,...c}=Nr;return[{...c,matchAvg:void 0,allTimeAvg:void 0}]},[Nr]),il=ye?gn:Ns,ll=Nr?.name??(ye?Ns:gn),ol=ye?de:ne,cl=ye?Fe>0?St:vs??Ae:un>0?dn:mn??Ws,Te=n.useCallback((t,a=1)=>{!t||a<=0||$a(c=>({...c,[t]:(c[t]||0)+a}))},[]),Ie=n.useCallback(t=>{t&&$a(a=>a[t]===void 0?a:{...a,[t]:0})},[]);Qi[p];const dl=t=>{if(!t.trim())return null;const a=Number(t);return Number.isFinite(a)?rs(Math.round(a),0,A):null},ul=t=>{if(!t.trim())return null;const a=Number(t);return Number.isFinite(a)?Math.max(0,Math.round(a)):null},Wa=n.useCallback(()=>{js.current&&(js.current=null),ts(),qn(!1)},[ts]);n.useCallback(t=>{const a=rs(t,0,A);Wa(),ke(a),ut.current=a;const c=a===0?A:a;cs(c),Vs.current=c,at(0),pt.current=0,Ze(0),mt.current=0,bt(0),ht.current=0,ds(null),Re(0),X(0),Hs.current=0,a===0?(j("player"),ue(!0)):(j(null),ue(!1))},[Wa,ke,A,cs,at,Ze,bt,ds,Re,X,j,ue]);const _a=t=>{const c=dl(Pa);if(c===null){ct(`Enter a number between 0 and ${A}`,{type:"error",timeout:2500});return}He(c),_s(0),us(0),hn(null),xn(0),ur(0),Ua(""),j(null),ue(!1)},Ka=n.useCallback((t,a)=>{t==="player"?(H(a),Yr("")):(ve(a),Jr("")),j(null),ue(!1)},[ve,Jr,Yr,j,H,ue]),wr=t=>{const c=ul(t==="player"?Oa:Fa);if(c===null){ct("Enter a non-negative whole number for legs",{type:"error",timeout:2500});return}Qr({target:t,value:c,stage:1})},ml=n.useCallback(()=>{Qr(t=>t&&(t.stage===1?{...t,stage:2}:(Ka(t.target,t.value),null)))},[Ka]),Xn=n.useCallback(()=>{Qr(null)},[]);n.useEffect(()=>{if(!pr)return;const t=a=>{a.key==="Escape"&&(a.preventDefault(),Xn())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Xn,pr]);const ws=(t=>{switch(t){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(we),vn=n.useRef(null),jn=n.useRef(null),ea=n.useRef(null),[Nn,ta]=n.useState("first"),[yr,za]=n.useState(1),hl=n.useRef(null);n.useEffect(()=>{const t=Math.max(1,Math.floor(Number(yr)||1)),a=Nn==="first"?t:Math.max(1,Math.ceil(t/2));ot(a)},[Nn,yr]),n.useEffect(()=>{if(!zt){Tn(1),as(!1);return}const t=()=>{const h=vn.current,f=jn.current;if(!h||!f)return;const U=ea.current?ea.current.getBoundingClientRect().height:0,P=Math.max(0,h.clientHeight-U-6),G=Math.max(0,h.clientWidth-8),B=f.getBoundingClientRect(),O=qe||1,w=B.height/O,_=B.width/O,vt=P>0?P/w:1,ss=G>0?G/_:1,ys=Math.min(1,Math.max(.5,Math.min(vt,ss))),Ct=w*ys,rt=P>0&&Ct-P>1;as(rt),Tn(ys)};t();const a=window.ResizeObserver,c=a?new a(()=>t()):null;return c&&vn.current&&c.observe(vn.current),c&&jn.current&&c.observe(jn.current),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t);try{c&&vn.current&&c.unobserve(vn.current)}catch{}try{c&&jn.current&&c.unobserve(jn.current)}catch{}}},[zt,qe]),n.useEffect(()=>{const t=a=>{const c=a?.detail?.mode;c&&(et(c),wn())};return window.addEventListener("ndn:auto-start",t),()=>window.removeEventListener("ndn:auto-start",t)},[]),n.useEffect(()=>{const t=a=>{const c=a?.detail?.formatType,h=a?.detail?.formatCount,f=a?.detail?.startScore;(c==="first"||c==="best")&&ta(c),typeof h=="number"&&isFinite(h)&&za(Math.max(1,Math.floor(h))),typeof f=="number"&&isFinite(f)&&ze(Math.max(1,Math.floor(f)))};return window.addEventListener("ndn:offline-format",t),()=>window.removeEventListener("ndn:offline-format",t)},[]),n.useEffect(()=>{if(!T)return;const t=setTimeout(()=>wn(),50);return()=>clearTimeout(t)},[T]),n.useEffect(()=>{if(!Be||ye||Z==="None"||Wi<=0)return;let t,a=performance.now();const c=h=>{const f=h-a;a=h,$n(U=>{const P=U-f;if(P<=0){let G=0,B=0,O=ne;for(us(0);G<3&&O>0;){const w=$o(O,Z),_=rs(w-G*20,0,Math.min(60,O)),vt=O-_;if(ur(_),Fr(Ct=>Ct+1),Aa(Ct=>Ct+1),vt<0){O=ne,_s(0),xn(0),B=0,hn(0),us(0);break}B+=_,_s(Ct=>Ct+_),Ea(Ct=>Ct+_);const ss=O,ys=vt;if(ss>50&&ys<=50?xn(1):ss<=50&&xn(Ct=>Ct+1),O=vt,G+=1,us(G),O===0)break}if(He(O),O===0){B===180?Kr(_=>_+1):B>=140?zr(_=>_+1):B>=100&&Gr(_=>_+1);const w=ne;w<=170&&Ba(_=>Math.max(_,w)),ne<=50&&(La(_=>_+($r>0?$r:1)),Ma(_=>_+1)),hn(B),_s(0),xn(0),us(0),j("ai"),ue(!0)}return O>0&&G>=3&&(B===180?Kr(w=>w+1):B>=140?zr(w=>w+1):B>=100&&Gr(w=>w+1),hn(B),_s(0),xn(0),us(0)),us(0),jt(!0),0}return P}),t=requestAnimationFrame(c)};return t=requestAnimationFrame(c),()=>cancelAnimationFrame(t)},[Be,ye,Z,ne]),n.useEffect(()=>{oe.inProgress&&(ft.current||(st(!0),ft.current=!0))},[oe.inProgress]);function wn(){tt(!0),ke(A),ut.current=A,He(A),kt(!1),Pe(!0),jt(!0),X(0),Oe(0),Re(0),Ze(0),mt.current=0,cs(A),at(0),ds(null),bt(0),$n(0),Fr(0),ur(0),_s(0),us(0),hn(null),j(null),H(0),ve(0),Ee([]),ln(0),on(0),On(!1),fn(0),Aa(0),zn(0),Ea(0),hr(0),xr(0),fr(0),Kr(0),zr(0),Gr(0),br(0),Ba(0),Vn(0),mr(0),La(0),Ma(0),Ie("X01");const t=Math.max(1,Math.floor(Number(yr)||1));if(ot(Nn==="first"?t:Math.max(1,Math.ceil(t/2))),S)try{k({mode:p,x01Start:A,firstTo:be,aiLevel:Z})}catch{}}function xl(){ke(A),ut.current=A,He(A),kt(!1),Pe(!0),jt(!0),X(0),Oe(0),Re(0),Ze(0),mt.current=0,cs(A),at(0),Vs.current=A,pt.current=0,ds(null),bt(0),ht.current=0,ht.current=0,$n(0),Fr(0),ur(0),_s(0),us(0),hn(null),j(null)}function yn(t){Ze(0),mt.current=0,cs(t===0?A:t),Vs.current=t===0?A:t,bt(0),ht.current=0,Z!=="None"?(jt(!1),$n(me)):($n(0),jt(!0))}function Sn(t){if(le&&js.current){Zi||qn(!0),ct("Remove your darts before starting the next throw",{type:"info",timeout:1800});return}Te("X01");const a=ut.current,c=mt.current,h=pt.current,f=Vs.current,U=ht.current,P=a-t,G=c+1;if(Re(t),Oe(rt=>rt+1),fn(rt=>rt+1),P<0){try{const rt=a,ma=f;Dn.getState().recordVisit("offline-x01",G,0,{preRemaining:rt,postRemaining:ma,bust:!0,finish:!1})}catch{}if(ke(f),ut.current=f,a<=50){const rt=(U||0)+1;Vn(ma=>ma+rt)}if(m)try{Mr(s?.username||"Player",0,Math.max(f,0),l,{volume:u,checkoutOnly:x})}catch{}ds(0),X(0),at(0),pt.current=0,bt(0),ht.current=0,yn(f);return}ke(P),ut.current=P,Ze(G),mt.current=G;const B=h+t;at(B),pt.current=B,zn(rt=>rt+t),X(0);const O=a,w=P,_=O>50&&w<=50,vt=O<=50;_?(bt(1),ht.current=1):vt&&(bt(rt=>rt+1),ht.current=(U||0)+1);const ss=ht.current||0,ys=O<=50,Ct=ys?Math.max(ss,Math.min(G,3)):0;if(P===0){const rt={visitTotal:B,darts:G,preRemaining:a,remaining:0,doubleAttempts:Ct,finished:!0,doubleWindow:ys,highestCheckout:f<=170?f:null};le?Ha(rt):vr(rt,"immediate");return}if(G>=3){const rt={visitTotal:B,darts:G,preRemaining:a,remaining:P,doubleAttempts:Ct,finished:!1,doubleWindow:ys,highestCheckout:null};le?Ha(rt):vr(rt,"immediate");return}}function Sr(){const t=rs(Math.round(Number(ee)||0),0,60);Sn(t)}function gt(t){if(!Number.isFinite(t))return!1;const a=Vs.current,c=ut.current,h=mt.current,f=pt.current,U=h>0||f>0;U&&(ke(a),ut.current=a,Ze(0),mt.current=0,at(0),pt.current=0,bt(0),ht.current=0,Re(0),X(0),Oe(w=>Math.max(0,w-h)),fn(w=>Math.max(0,w-h)),zn(w=>Math.max(0,w-f)),Hs.current=0);const P=U?a:c,G=P<=170?170:180,B=rs(Math.round(t),0,G);Te("X01",3),Oe(w=>w+3),fn(w=>w+3),Ze(3),mt.current=3,at(B),pt.current=B,ds(B),B===180?hr(w=>w+1):B>=140?xr(w=>w+1):B>=100&&fr(w=>w+1);const O=P-B;if(O<0){if(m)try{Mr(Ns,0,Math.max(a,0),l,{volume:u,checkoutOnly:x})}catch{}try{Dn.getState().recordVisit("offline-x01",3,0,{preRemaining:P,postRemaining:a,bust:!0,finish:!1})}catch{}return ke(a),ut.current=a,ds(0),at(0),pt.current=0,Ze(0),mt.current=0,bt(0),ht.current=0,yn(a),!0}if(ke(O),ut.current=O,zn(w=>w+B),m)try{Mr(Ns,B,Math.max(O,0),l,{volume:u,checkoutOnly:x})}catch{}if(P<=50&&(Vn(w=>w+3),O===0&&mr(w=>w+1)),O===0){P<=170&&br(w=>Math.max(w,P));try{Dn.getState().recordVisit("offline-x01",3,B,{preRemaining:P,postRemaining:0,finish:!0,bust:!1})}catch{}return j("player"),ue(!0),Ze(0),mt.current=0,at(0),pt.current=0,bt(0),ht.current=0,!0}try{Dn.getState().recordVisit("offline-x01",3,B,{preRemaining:P,postRemaining:O,finish:!1,bust:!1})}catch{}return yn(O),at(0),pt.current=0,Ze(0),mt.current=0,bt(0),ht.current=0,!0}const At=Uo({match:oe,commitManualVisitTotal:gt,endTurn:yn}),[Cr,kr]=n.useState(""),Ga=t=>{if(!t){kr("");return}const a=t.replace(/[^0-9]/g,"");if(!a){kr("");return}const c=Number(a);if(!Number.isFinite(c))return;const h=ut.current<=170?170:180,f=rs(Math.round(c),0,h);kr(String(f))};function Dr(){if(!Cr){alert("Enter a number 0â€“180 for visit total");return}const t=Number(Cr);if(!Number.isFinite(t)){alert("Enter a number 0â€“180 for visit total");return}const a=ut.current<=170?170:180,c=rs(Math.round(t),0,a);t>a&&ct(`Visit totals cannot exceed ${a}.`,{type:"info",timeout:2200}),gt(c)&&kr("")}const sa=n.useCallback(()=>{js.current&&(js.current=null,ts(),qn(!1));const t=mt.current,a=pt.current,c=Vs.current;t===0&&a===0||(ke(c),ut.current=c,Ze(0),mt.current=0,at(0),pt.current=0,bt(0),ht.current=0,Re(0),X(0),Oe(h=>Math.max(0,h-t)),fn(h=>Math.max(0,h-t)),zn(h=>Math.max(0,h-a)),Hs.current=0)},[ts]);n.useEffect(()=>{const t=a=>{const c=a?.detail;!c||c?.source==="offline-play"||sa()};return window.addEventListener("ndn:clear-visit-request",t),()=>window.removeEventListener("ndn:clear-visit-request",t)},[sa]);function qa(t){Te("Double Practice");const a=rs(Math.round(t||0),0,60);if(Re(a),Oe(c=>c+1),fn(c=>c+1),Di(a,ks)){const c=Ln+1;xs(c),zs(h=>Math.min(20,h+1)),c>=21&&(j("player"),ue(!0))}X(0)}function Xa(){qa(Number(ee))}function Ya(){const t=Cn(xt);if(t==null){alert("Enter like D16, 50, 25, T20");return}qa(t),lt("")}function Ja(t,a,c){if(Zs)return;Te("Bob's 27");const h=En,f=a==="DOUBLE"&&c===h||!a&&t===h*2;f&&Qs(U=>U+1),er(U=>{const P=U+1;if(P>=3){const G=qt+(f?1:0);G>0?Js(O=>O+G*h*2):Js(O=>O-h*2);const B=h+1;return Ys(B),Qs(0),B>20&&Ms(!0),0}return P})}function Qa(){Ja(Math.max(0,ee|0)),X(0)}function Za(){Ys(1),Js(27),er(0),Qs(0),Ms(!1),Ie("Bob's 27")}function na(t){Te("Count-Up"),Dt(a=>a+Math.max(0,t|0)),sr(a=>{const c=a+1;return c>=3?(As(h=>h+1),0):c})}function ra(t){Te("High Score"),Es(a=>a+Math.max(0,t|0)),Rn(a=>{const c=a+1;return c>=3?(Xe(h=>h+1),0):c})}function aa(t){Te("Low Score"),Rs(a=>a+Math.max(0,t|0)),In(a=>{const c=a+1;return c>=3?(Bt(h=>h+1),0):c})}function ei(t,a,c,h,f,U,P,G){const B=t-P;if(!(B<0))if(B===0){if(G==="DOUBLE"||G==="INNER_BULL"){U(O=>O+1),f(O=>O+1),h(()=>0),a(t);return}a(B)}else a(B);h(O=>{const w=O+1;return w>=3?(f(_=>_+1),0):w})}function ti(t,a){Te("Checkout 170"),ei(is,Is,ls,tn,Bs,Xt,t,a),ls+1>=3&&Is(170)}function si(t,a){Te("Checkout 121"),ei(sn,nn,Ps,Bn,Us,Un,t,a),Ps+1>=3&&nn(121)}function Tr(t){const a=Cn(xt);if(a==null){alert("Enter like T20, D16, 25, 50");return}const c=xt.trim().toUpperCase(),h=c.startsWith("D")||c==="50"||c==="BULL"||c==="DBULL"||c==="IBULL"||c.includes("INNER");t?ti(a,h?"DOUBLE":void 0):si(a,h?"DOUBLE":void 0),lt("")}function fl(){Is(170),tn(0),Bs(0),Xt(0),Ie("Checkout 170")}function bl(){nn(121),Bn(0),Us(0),Un(0),Ie("Checkout 121")}function ia(t,a,c){if(ir)return;Te("Treble Practice"),(a==="TRIPLE"&&c===Pt||!a&&t===Pt*3)&&ln(f=>f+1),on(f=>{const U=f+1;if(U%3===0&&[20,19,18].includes(Pt)){const P=[20,19,18],G=P.indexOf(Pt),B=P[(G+1)%P.length];rn(B)}return Yt>0&&U>=Yt&&On(!0),U})}function ni(){ln(0),on(0),On(!1),Ie("Treble Practice")}function pl(t,a,c){Te("Baseball"),lr(h=>{const f={...h};return go(f,t,a,c),f})}function gl(){lr(Mi()),Ie("Baseball")}function vl(t,a,c){Te("Golf"),i(h=>{const f={...h};return jo(f,t,a,c),f})}function jl(){i(Ai()),Ie("Golf")}function Nl(t,a,c,h){Te("Tic Tac Toe"),g(f=>{const U={...f,board:[...f.board]};return wo(U,t,a,c,h),U})}function wl(){g(Ei()),Ie("Tic Tac Toe")}function yl(t,a,c){Te("American Cricket"),q(h=>{const f={...h,marks:{...h.marks}};return Ao(f,t,a,c,()=>!1),f})}function ri(){q(Pi()),Ie("American Cricket")}function la(t,a,c){Te("Around the Clock");const h=Ss[Gt];let f=!1;if(typeof c=="number"&&c===h&&(a==="SINGLE"||a==="DOUBLE"||a==="TRIPLE")&&(f=!0),h===25&&(a==="BULL"||t===25)&&(f=!0),h===50&&(a==="INNER_BULL"||t===50)&&(f=!0),f||(t===h||t===h*2||t===h*3)&&(f=!0),f){const U=Ht+1;Ds(U),$t(P=>P+1)}}function ai(){la(Math.max(0,ee|0)),X(0)}function ii(){const t=Cn(xt);if(t==null){alert("Enter like T20, D5, 25, 50");return}la(t),lt("")}function oa(t,a,c){Te("Cricket"),Mn(h=>{const f={...h,marks:{...h.marks}};return io(f,t,a,c,()=>!1),f}),nt(h=>{const f=h+1;return f>=3?0:f})}function li(){oa(Math.max(0,ee|0)),X(0)}function ca(t,a,c){Te("Shanghai"),qs(h=>{const f={...h,turnHits:{...h.turnHits}};return co(f,t,a,c),f}),nt(h=>{const f=h+1;return f>=3?(qs(U=>{const P={...U,turnHits:{...U.turnHits}};return uo(P),P}),0):f})}function oi(){ca(Math.max(0,ee|0)),X(0)}function ci(t,a,c){Te("Halve It"),Xs(h=>{const f={...h,targets:[...h.targets]};return mo(f,t,a,c),f}),nt(h=>{const f=h+1;return f>=3?(Xs(U=>{const P={...U,targets:[...U.targets]};return ho(P),P}),0):f})}function di(){ci(Math.max(0,ee|0)),X(0)}function ui(t,a,c){Te("High-Low"),ge(h=>{const f={...h};return xo(f,t,a,c),f}),nt(h=>{const f=h+1;return f>=3?(ge(U=>{const P={...U};return fo(P),P}),0):f})}function mi(){ui(Math.max(0,ee|0)),X(0)}function hi(){const t=xt.trim().toUpperCase();if(!t)return null;if(t==="50"||t==="BULL"||t==="DBULL"||t==="IBULL")return 50;if(t==="25"||t==="OBULL")return 25;const a=t.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!a)return null;const c=a[1]||"S",h=parseInt(a[2],10);return h<1||h>20?null:h*(c==="S"?1:c==="D"?2:3)}function Yn(){const t=hi();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}Sn(t),lt("")}function xi(){const t=Xr.trim().split(`
`).map(a=>a.trim()).filter(a=>a);if(t.length!==0){for(const a of t){const c=Cn(a);if(c==null){alert(`Invalid score: ${a}`);return}Sn(c)}Gn("")}}function da(){Fe!==0&&(ke(t=>t+Ae),Ze(t=>Math.max(0,t-1)))}function Lr(){const t=hi();if(t==null){alert("Enter like T20, D16, 5, 25, 50");return}if(Fe===0){Yn();return}const a=Ae;ke(c=>c+a),Ze(c=>Math.max(0,c-1)),setTimeout(()=>Sn(t),0),lt("")}function Sl(){const t=b??"player",a=t==="player"?cr||void 0:$r||void 0,c=1,h=t==="player"?cn:dr;Ee([...se,{winner:t,doubleDarts:N,checkoutDarts:K,winnerDarts:h,doublesAtt:a,doublesHit:c}]),ue(!1);let f=De,U=V;if(b==="player"?f+=1:b==="ai"&&(U+=1),H(f),ve(U),j(null),f>=be||U>=be){try{Fl(p,t==="player")}catch{}Pe(!1),tt(!1),ke(A),He(A),qr(!0);return}xl()}const ua=!vi.includes(p)&&!(s?.fullAccess||s?.admin);return e.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[Ge&&e.jsx(Vl,{players:oe.players||[],onDone:()=>st(!1)}),e.jsxs("h2",{className:"text-3xl font-bold text-brand-700 mb-4",children:["Offline Mode"," ",r==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"ndn-shell-body",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsxs("select",{className:"input w-full",value:p,onChange:t=>et(t.target.value),children:[vi.map(t=>e.jsx("option",{value:t,children:t},t)),Pl.map(t=>e.jsxs("option",{value:t,disabled:!(s?.fullAccess||s?.admin),children:[t," ",s?.fullAccess||s?.admin?"":"(Premium)"]},t))]}),e.jsx($l,{gameMode:p,compact:!0}),p==="Treble Practice"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"font-semibold",children:"Throws per game"}),e.jsx("input",{className:"input w-full",type:"number",min:3,step:3,value:Yt,onChange:t=>ar(Math.max(3,Math.floor(Number(t.target.value)||30)))})]}),e.jsx("div",{className:"sm:col-span-2 text-xs text-slate-300",children:"Target cycles T20â†’T19â†’T18 every 3 darts. Game ends after the selected number of throws."})]}),!s?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),p==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:A,onChange:t=>ze(Number(t.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{className:"input w-full",value:Z,onChange:t=>Me(t.target.value),children:[e.jsx("option",{value:"None",children:"None"}),Oo.map(t=>e.jsx("option",{value:t,children:t},t))]}),Z!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:me/1e3,onChange:t=>Rt(Math.round(Number(t.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>Ce(!0),children:"X01 Rules & Regulations!"})]}),p==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 â†’ D20 â†’ DBULL in as few darts as possible. AI and X01 settings donâ€™t apply."})]}),!$e&&e.jsx("button",{className:"btn",disabled:ua,title:ua?"PREMIUM required for this mode":"",onClick:wn,children:"Start Match"}),Be&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${Ft?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(kn,{storageKey:"ndn:modal:offline-match",className:`${Ft?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:Ft,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:"scroll"},ref:t=>{vn.current=t},children:[e.jsx("div",{ref:t=>{ea.current=t},children:e.jsx(Ro,{left:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[p,p==="X01"?` / ${A}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",be," Â· Legs ",De,"-",V]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${r==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:r==="modern"?"Modern layout":"Classic layout"})]}),right:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>C(Math.max(.5,Math.round((I-.05)*100)/100)),title:"Decrease camera size",children:"âˆ’"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(I*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>C(Math.min(1.25,Math.round((I+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:zt?"Actual Size":"Fit All",onClick:()=>Qn(t=>!t),children:zt?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:Ft?"Restore":"Maximize",onClick:()=>hs(t=>!t),children:Ft?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{wn()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{Pe(!1),tt(!1)},children:"Quit"})]})})}),e.jsxs("div",{ref:t=>{jn.current=t},className:"will-change-transform",style:zt?{transform:`scale(${qe})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,qe))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:p==="X01"?"X01 Match":p}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",p]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",A]}),e.jsxs("div",{ref:hl,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const t=de!==A||ne!==A||Fe>0,a=`px-2 py-0.5 rounded border text-xs ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${a} ${Nn==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||ta("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${a} ${Nn==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{t||ta("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${t?"opacity-50":""}`,type:"number",min:1,step:1,value:yr,onChange:c=>za(Math.max(1,Math.floor(Number(c.target.value)||1))),disabled:t,title:Nn==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",De,"â€“",V]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"opacity-70",children:"Match"}),e.jsxs("select",{className:`btn ${ws}`,value:J,onChange:t=>pe(t.target.value),children:[e.jsx("option",{value:"singles",children:"Singles"}),e.jsx("option",{value:"doubles",children:"Doubles"})]}),e.jsx("input",{className:`input ${ws} w-[7.5rem]`,value:ie,onChange:t=>Se(t.target.value),placeholder:"Team A"}),e.jsx("span",{className:"opacity-50",children:"vs"}),e.jsx("input",{className:`input ${ws} w-[7.5rem]`,value:re,onChange:t=>ce(t.target.value),placeholder:"Team B"})]})]}),p!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[p==="Double Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Er[ks]?.label||"â€”"})]})}),p==="Around the Clock"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Ss[Gt]===25?"25 (Outer Bull)":Ss[Gt]===50?"50 (Inner Bull)":Ss[Gt]||"â€”"})]})}),p==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket â€” Close 20â€“15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:Ca.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,Ts.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points:"," ",e.jsx("span",{className:"font-semibold",children:Ts.points})]}),lo(Ts)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Mn(ha()),nt(0),Ie("Cricket")},children:"Reset"})]})]}),p==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Gs.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Gs.score]}),Gs.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{qs(xa()),nt(0),Ie("Shanghai")},children:"Reset"})]})]}),p==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[It.stage+1,"/",It.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target:"," ",e.jsx("span",{className:"font-semibold",children:(()=>{const t=Fi(It);return t?t.kind==="ANY_NUMBER"?"Any":t.kind==="BULL"?"Bull":t.kind==="DOUBLE"||t.kind==="TRIPLE"||t.kind==="NUMBER"?`${t.kind} ${t.num}`:"â€”":"â€”"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",It.score]}),It.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Xs(fa()),nt(0),Ie("Halve It")},children:"Reset"})]})]}),p==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Ls.round," Â· Target ",Ls.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ls.score]}),Ls.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ge(ba()),nt(0),Ie("High-Low")},children:"Reset"})]})]}),p==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",En]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Zn]}),Zs&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:Za,children:"Reset"})]})]}),p==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",tr,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Br]})]}),p==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",wt,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",nr]})]}),p==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",en,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Pr]})]}),p==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:is}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",Tt," Â· Successes:"," ",fs]})]}),p==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:sn}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",bs," Â· Successes:"," ",Pn]})]}),p==="Treble Practice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",Pt]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",an]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("div",{className:"inline-flex items-center gap-1",children:[20,19,18].map(t=>e.jsxs("button",{className:`btn px-2 py-0.5 text-xs ${Pt===t?"bg-emerald-600/30 border border-emerald-400/30":""}`,onClick:()=>rn(t),children:["T",t]},`tpick-header-${t}`))}),e.jsx("span",{className:"opacity-60 text-xs",children:"or"}),e.jsx("select",{className:"input w-24",value:Pt,onChange:t=>rn(parseInt(t.target.value,10)),children:Array.from({length:20},(t,a)=>a+1).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ni,children:"Reset"})]})]})}),p==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Os.inning}),e.jsxs("div",{className:"text-sm",children:["Score:"," ",e.jsx("span",{className:"font-semibold",children:Os.score})]})]}),p==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:or.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes:"," ",e.jsx("span",{className:"font-semibold",children:or.strokes})]})]}),p==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:d.turn}),d.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",d.winner||"â€”"]})]}),p==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Target"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:pa[it.targetIndex]}),e.jsxs("div",{className:"text-sm",children:["Progress:"," ",e.jsxs("span",{className:"font-semibold",children:[it.targetIndex+1,"/",pa.length]})]}),it.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["ðŸŽ‰ Finished in ",it.darts," darts!"]})]}),p==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[$s.score,"/",$s.target]}),e.jsxs("div",{className:"text-sm",children:["Darts:"," ",e.jsx("span",{className:"font-semibold",children:$s.darts})]}),$s.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",$s.target,"!"]})]}),p==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Score"}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Zt.score,"/",Zt.target]}),e.jsxs("div",{className:"text-sm",children:["Darts:"," ",e.jsx("span",{className:"font-semibold",children:Zt.darts})]}),Zt.finished&&e.jsxs("div",{className:"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200",children:["âœ“ Reached ",Zt.target,"!"]})]}),p==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20â€“12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:ka.map(t=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:t===25?"Bull":t}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,R.marks?.[t]||0)," / 3"]})]},t))}),e.jsxs("div",{className:"text-sm",children:["Points:"," ",e.jsx("span",{className:"font-semibold",children:R.points})]}),Eo(R)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:ri,children:"Reset"})]})]}),p==="Killer"&&e.jsx(e.Fragment,{children:Ue?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:M[Ke]?.name||"â€”"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:gs?`${M.find(t=>t.id===gs)?.name||"Winner"} Wins`:Ur||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):r==="modern"?e.jsx("div",{className:"space-y-3 mb-2",children:xe?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${ws}`,onClick:()=>C(Math.max(.5,Math.round((I-.05)*100)/100)),children:"âˆ’"}),e.jsxs("span",{className:`btn ${ws} min-w-[2.5rem] text-center`,children:[Math.round(I*100),"%"]}),e.jsx("button",{className:`btn ${ws}`,onClick:()=>C(Math.min(1.25,Math.round((I+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${ws}`,title:"Toggle fit/fill",onClick:()=>Y(E==="fill"?"fit":"fill"),children:E==="fill"?"Fill":"Fit"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${ws}`,title:"Toggle camera aspect",onClick:()=>y(F==="square"?"wide":"square"),children:F==="square"?"Square":"Wide"})]})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row-reverse md:items-start md:gap-6",children:[e.jsx("div",{className:"w-full h-[260px] rounded-2xl overflow-hidden bg-black shadow-xl md:w-[48%] md:min-h-[420px]",children:e.jsx(Le,{scoringMode:"x01",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{Sn(t)}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-[minmax(0,1fr)_300px] md:items-start md:gap-4",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Current Shooter"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-white",children:ll}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-sm text-white/80",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Remaining"}),e.jsx("div",{className:"font-mono text-lg text-white",children:ol})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Last Dart"}),e.jsx("div",{className:"font-mono text-lg text-white",children:cl||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Match Legs"}),e.jsxs("div",{className:"font-semibold text-white",children:[De,"-",V]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/40",children:"Next Up"}),e.jsx("div",{className:"font-medium text-white",children:il})]})]})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ns,{gameMode:p,players:Va,matchScore:`${De}-${V}`})})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(ns,{gameMode:p,players:Va,matchScore:`${De}-${V}`})}),p==="X01"&&e.jsxs("div",{className:"mt-3 md:mt-4 rounded-2xl bg-slate-900/60 border border-white/10 p-4 text-slate-100 shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Manual Scoreboard Override"}),e.jsxs("p",{className:"mt-1 text-xs text-white/40",children:["Adjust the live totals if a dart was misread. Values are clamped between 0 and"," ",A,"."]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:Ns}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Commit Visit"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx(Hl,{inProgress:!0,startingScore:A,onAddVisit:Et(gt),quickButtons:[180,140,100,60],onNextPlayer:()=>At?.nextPlayer(),onEndLeg:()=>{},onUndo:()=>{},showDartsSelect:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:Oa,onChange:t=>Yr(t.target.value),onKeyDown:t=>{t.key==="Enter"&&wr("player")},placeholder:`${De}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>wr("player"),children:"Set"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:gn}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Three Dart Edit"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:A,value:Pa,onChange:t=>Ua(t.target.value),onKeyDown:t=>{t.key==="Enter"&&_a()},placeholder:`${ne}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>_a(),children:"Set"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/50",children:"Legs Override"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,value:Fa,onChange:t=>Jr(t.target.value),onKeyDown:t=>{t.key==="Enter"&&wr("ai")},placeholder:`${V}`}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>wr("ai"),children:"Set"})]})]})]})]})]})]})]})})]})}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:minmax(0,0.75fr)_minmax(0,3fr)_minmax(0,0.75fr)] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),ye?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:de}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-de/A)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart:"," ",e.jsx("span",{className:"font-semibold",children:Ae})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score:"," ",e.jsx("span",{className:"font-semibold",children:Fe>0?St:vs??Ae})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg:"," ",e.jsx("span",{className:"font-semibold",children:_n>0?(Wr/_n*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",cn]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(t=>e.jsx("span",{className:`w-2 h-2 rounded-full ${t<Fe?"bg-emerald-400":"bg-white/20"}`},t))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles:"," ",e.jsxs("span",{className:"font-semibold",children:["Att ",Hn," Â· Hit ",Hr]})]}),de<=170&&de>0&&(()=>{const a=zl(de,o)[0]||"â€”";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:a})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-center md:justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall",children:e.jsx(ga,{storageKey:"ndn:camera:tile:offline:center:v4",className:"relative rounded-2xl overflow-hidden bg-black w-full camera-fullwidth-card",defaultWidth:0,defaultHeight:0,minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:1200,autoFill:!0,children:e.jsx(Ni,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",aspect:"classic",fill:!0})})}),e.jsxs("div",{className:`mt-2 ${Ne==="small"?"p-2":Ne==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${we==="small"?"text-xs":we==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const t=ye?s?.username||"You":Z==="None"?"â€”":`${Z} AI`,a=ye?de:Z==="None"?0:ne,c=ye?Fe>0?St:vs??Ae:un>0?dn:mn??Ws,h=ye?cn:dr,f=A-(ye?de:Z==="None"?A:ne),U=h>0?f/h*3:0,P=`${De}-${V}`,G=se.length>0?`${Math.min(...se.map(B=>B.doubleDarts+(B.checkoutDarts||0)))||0} darts`:"â€”";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:P}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:t}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:a}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:U.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:c}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:G})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[Z==="None"?"Opponent":`${Z} AI`," Remain"]}),ye?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Z!=="None"?ne:"N/A"}),Z!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-ne/A)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart:"," ",e.jsx("span",{className:"font-semibold",children:Z==="None"?0:Ws})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["Last score:"," ",e.jsx("span",{className:"font-semibold",children:Z==="None"?"â€”":un>0?dn:mn??Ws})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg:"," ",e.jsx("span",{className:"font-semibold",children:Z!=="None"?Kn>0?(_r/Kn*3).toFixed(1):"0.0":"â€”"})]}),Z!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",dr]}),Z!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles:"," ",e.jsxs("span",{className:"font-semibold",children:["Att ",Wn," Â· Hit ",Vr]})]})]})]})}),p!=="X01"?e.jsxs("div",{className:"space-y-2",children:[p==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Er[ks]?.label||"â€”"})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,onAutoDart:(t,a)=>{if((a==="DOUBLE"||a==="INNER_BULL")&&Di(t,ks)){const h=Ln+1,f=ks+1;xs(h),zs(f),h>=Er.length&&setTimeout(()=>{xs(0),zs(0)},250)}},immediateAutoCommit:!0,onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Xa()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Xa,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Ya()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ya,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",Ln," of 21"]})]}),p==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Ss[Gt]===25?"25 (Outer Bull)":Ss[Gt]===50?"50 (Inner Bull)":Ss[Gt]||"â€”"})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{la(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&ai()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ai,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ii()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ii,children:"Add"})]}),Ht>=Ss.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Ds(0),$t(0),Ie("Around the Clock")},children:"Reset"})]})]}),p==="Cricket"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{oa(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&li()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:li,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Mn(ha()),nt(0),Ie("Cricket")},children:"Reset"})]})]}),p==="Shanghai"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{ca(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&oi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:oi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{qs(xa()),nt(0),Ie("Shanghai")},children:"Reset"})]})]}),p==="Halve It"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{ci(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&di()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:di,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Xs(fa()),nt(0),Ie("Halve It")},children:"Reset"})]})]}),p==="High-Low"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{ui(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&mi()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:mi,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ge(ba()),nt(0),Ie("High-Low")},children:"Reset"})]})]}),p==="Bob's 27"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{Ja(t,a==="MISS"?void 0:a,c?.sector??null)},onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&Qa()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Qa,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Za,children:"Reset"})]})]}),p==="Count-Up"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:t=>na(t),onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(na(ee),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{na(ee),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{As(1),Dt(0),sr(0),Ie("Count-Up")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",tr,"/",Nt]})]}),p==="High Score"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:t=>ra(t),onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(ra(ee),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ra(ee),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Xe(1),Es(0),Rn(0),Ie("High Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",wt,"/",Wt]})]}),p==="Low Score"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:t=>aa(t),onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(aa(ee),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{aa(ee),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Bt(1),Rs(0),In(0),Ie("Low Score")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",en,"/",rr]})]}),p==="Checkout 170"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a)=>ti(t,a==="MISS"?void 0:a),onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Tr(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Tr(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:fl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",is," Â· Attempts: ",Tt," Â· Successes: ",fs]})]}),p==="Checkout 121"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a)=>si(t,a==="MISS"?void 0:a),onAddVisit:Et(gt),onEndLeg:t=>At.endLeg(t)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Tr(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Tr(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:bl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",sn," Â· Attempts: ",bs," Â· Successes: ",Pn]})]}),p==="Treble Practice"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{ia(t,a==="MISS"?void 0:a,c?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const a=Cn(xt);a!=null&&ia(a,void 0,void 0),lt("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const t=Cn(xt);t!=null&&ia(t,void 0,void 0),lt("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",an," Â· Misses:"," ",Math.max(0,Lt-an)," Â· Darts:"," ",Lt,Yt>0?`/${Yt}`:""]}),ir&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed!"," ",e.jsx("button",{className:"ml-2 underline",onClick:ni,children:"Reset"})]})]}),p==="Baseball"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{pl(t,a==="MISS"?void 0:a,c?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:gl,children:"Reset"})})]}),p==="Golf"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{vl(t,a==="MISS"?void 0:a,c?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:jl,children:"Reset"})})]}),p==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(t,a)=>a).map(t=>e.jsx("button",{className:`h-16 rounded-xl border ${d.board[t]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(d.finished||d.board[t])return;const a=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),c=a%3===0?"TRIPLE":a%2===0?"DOUBLE":"SINGLE",h=t,f=$i[h],U=f.type==="BULL"?null:f.num||null;Nl(h,a,c,U)},children:d.board[t]||""},t))}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:wl,children:"Reset"})})]}),p==="American Cricket"&&e.jsxs(e.Fragment,{children:[D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{yl(t,a==="MISS"?void 0:a,c?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:ri,children:"Reset"})})]}),p==="Scam"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target:"," ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:pa[Jt.targetIndex]})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{const h=a==="MISS"?void 0:a;Te("Scam"),Qt(ja(Jt,t,h))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:1,max:25,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(Te("Scam"),Qt(Ri(Jt,ee)),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Te("Scam"),Qt(Ri(Jt,ee)),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Qt(So()),Ie("Scam")},children:"Reset"})]}),Jt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["ðŸŽ‰ Finished in ",Jt.darts," darts!"]})]}),p==="Fives"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[Ye.score,"/",Ye.target]})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{Te("Fives"),dt(wa(Ye,t))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:5,max:50,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(Te("Fives"),dt(Ii(Ye,ee)),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Te("Fives"),dt(Ii(Ye,ee)),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{dt(Do(Ye.target)),Ie("Fives")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 5, 10, 15, 20, 25, 50 Â· Darts:"," ",Ye.darts]}),Ye.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",Ye.target," in"," ",Ye.darts," darts!"]})]}),p==="Sevens"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Score:"," ",e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[yt.score,"/",yt.target]})]}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{Te("Sevens"),Ut(Sa(yt,t))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:7,max:21,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(Te("Sevens"),Ut(Bi(yt,ee)),X(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{Te("Sevens"),Ut(Bi(yt,ee)),X(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Ut(Mo(yt.target)),Ie("Sevens")},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid scores: 7, 14, 21 Â· Darts:"," ",yt.darts]}),yt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["âœ“ Reached ",yt.target," in"," ",yt.darts," darts!"]})]}),p==="Killer"&&e.jsx(e.Fragment,{children:Ue?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:M.map(t=>{const a=z[t.id],c=We[t.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${a?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${a?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:a?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number:"," ",e.jsx("span",{className:"font-semibold",children:c})]}),e.jsxs("div",{className:"text-sm",children:["Lives:"," ",e.jsx("span",{className:"font-semibold",children:a?.lives??0})]})]},t.id)})}),D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{if(gs)return;const h=a==="MISS"?void 0:a,f=c?.sector??null,U=M[Ke];U&&(Q(P=>{const G={};Object.keys(P).forEach(w=>G[w]={...P[w]});const B=Ti(U.id,G,h,f);if(B.becameKiller)Mt(`${U.name} became a Killer`);else if(B.victimId){const w=M.find(_=>_.id===B.victimId);Mt(`${U.name} hit ${w?.name}'s ${We[B.victimId]} (${B.livesRemoved} life${(B.livesRemoved||0)>1?"s":""})`)}else Mt("No effect");const O=Li(G);return O&&Fs(O),G}),_t(P=>{const G=P+1;if(G>=3){let B=Ke;for(let O=1;O<=M.length;O++){const w=(Ke+O)%M.length,_=M[w].id,vt=z[_];if(vt&&!vt.eliminated&&vt.lives>0){B=w;break}}return Qe(B),0}return G}))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){if(gs)return;const c=xt.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!c){lt("");return}const h=c[1]||"S",f=parseInt(c[2],10),U=h==="D"?"DOUBLE":h==="T"?"TRIPLE":"SINGLE",P=M[Ke];Q(G=>{const B={};Object.keys(G).forEach(_=>B[_]={...G[_]});const O=Ti(P.id,B,U,f);if(O.becameKiller)Mt(`${P.name} became a Killer`);else if(O.victimId){const _=M.find(vt=>vt.id===O.victimId);Mt(`${P.name} hit ${_?.name}'s ${We[O.victimId]} (${O.livesRemoved} life${(O.livesRemoved||0)>1?"s":""})`)}else Mt("No effect");const w=Li(B);return w&&Fs(w),B}),lt(""),_t(G=>{const B=G+1;if(B>=3){let O=Ke;for(let w=1;w<=M.length;w++){const _=(Ke+w)%M.length,vt=M[_].id,ss=z[vt];if(ss&&!ss.eliminated&&ss.lives>0){O=_;break}}return Qe(O),0}return B})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let t=Ke;for(let a=1;a<=M.length;a++){const c=(Ke+a)%M.length,h=M[c].id,f=z[h];if(f&&!f.eliminated&&f.lives>0){t=c;break}}Qe(t),_t(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Q({}),je({}),_e(!1),Qe(0),_t(0),Fs(null),Mt("")},children:"Reset"})]}),gs&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner:"," ",M.find(t=>t.id===gs)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Q({}),je({}),_e(!1),Qe(0),_t(0),Fs(null),Mt("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:M.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:t.name,onChange:c=>{const h=c.target.value;W(f=>f.map((U,P)=>P===a?{...U,name:h}:U))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>W(c=>c.filter((h,f)=>f!==a)),disabled:M.length<=2,children:"Remove"})]},t.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>W(t=>{const a=`p${t.length+1}`;return[...t,{id:a,name:`Player ${t.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(M.length<2){alert("Need at least 2 players");return}const t=M.map(h=>h.id),a=po(t),c={};t.forEach(h=>{c[h]=bo(a[h])}),je(a),Q(c),Qe(0),_t(0),Fs(null),Mt("Assigned numbers"),_e(!0)},children:"Assign Numbers & Start"})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-3 min-h-0 flex-1 text-[14px]",children:[e.jsxs("div",{className:"basis-1/2 shrink-0 min-w-0 flex flex-col gap-2 overflow-y-auto pr-2 text-sm",children:[e.jsx("div",{className:"text-sm font-semibold opacity-80",children:"Scoreboard"}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ns,{gameMode:p,players:jr,matchScore:`${De}-${V}`})}),ye&&e.jsxs("div",{className:"p-4 rounded-2xl bg-slate-900/60 border border-white/10 text-slate-100 shadow-lg backdrop-blur-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h4",{className:"text-sm font-semibold tracking-wide uppercase text-indigo-200",children:"Manual Scoring"}),e.jsx("span",{className:"text-xs text-white/60",children:"Override a visit or enter dart-by-dart scores."})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Single Dart"}),e.jsx("input",{className:"input w-20 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:60,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?da():Sr())},placeholder:"60"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Sr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Three Dart Edit"}),e.jsx("input",{className:"input w-24 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",type:"number",min:0,max:de<=170?170:180,value:Cr,onChange:t=>Ga(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Dr()},placeholder:"100"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Dr,children:"Commit Visit"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:da,children:"Undo Visit"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Manual"}),e.jsx("input",{className:"input w-28 bg-white/5 border border-white/10 text-white placeholder-white/40 focus:border-emerald-400/60 focus:ring-emerald-500/40",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Lr():Yn())},placeholder:"T20"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Yn,children:"Apply"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Lr,disabled:Fe===0,children:"Replace Last"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-wide text-white/60",children:"Multi-entry (one per line)"}),e.jsx("textarea",{className:"mt-2 w-full rounded-xl bg-slate-950/70 border border-white/10 text-sm text-slate-100 placeholder-white/40 p-3 focus:outline-none focus:border-emerald-400/60 focus:ring-2 focus:ring-emerald-500/30",rows:3,value:Xr,onChange:t=>Gn(t.target.value),placeholder:`T20
D16
25`}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:xi,children:"Apply All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Gn(""),children:"Clear"})]})]}),e.jsx("div",{className:"pt-2 border-t border-white/10 mt-3",children:e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:sa,disabled:Fe===0&&St===0,children:"Clear Current Visit"})})]})]})]}),D&&e.jsx("div",{className:"basis-1/2 shrink-0 min-w-0 rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a)=>{const c=a??"MISS",h=Number.isFinite(t)?Math.max(0,t):0,f=Date.now();if(h<=0){if(c!=="MISS"||f-(Hs.current||0)<1200)return;Hs.current=f}else Hs.current=0;Sn(h)}})})]}),p==="X01"&&!D&&e.jsx(e.Fragment,{children:e.jsx(ns,{gameMode:p,players:jr,matchScore:`${De}-${V}`})}),p==="Cricket"&&e.jsx(e.Fragment,{children:e.jsx(ns,{gameMode:"Cricket",players:el})}),p==="Cricket"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&oa(t,a==="MISS"?void 0:a,c?.sector??null)}})}),p==="Shanghai"&&e.jsx(e.Fragment,{children:e.jsx(ns,{gameMode:"Shanghai",players:tl})}),p==="Shanghai"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&ca(t,a==="MISS"?void 0:a,c?.sector??null)}})}),p==="Killer"&&e.jsx(e.Fragment,{children:e.jsx(ns,{gameMode:"Killer",players:sl})}),p==="Scam"&&e.jsx(e.Fragment,{children:e.jsx(ns,{gameMode:"Scam",players:nl})}),p==="Scam"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&Qt(ja(Jt,t,a))}})}),p==="Fives"&&e.jsx(e.Fragment,{children:e.jsx(ns,{gameMode:"Fives",players:rl})}),p==="Fives"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&dt(wa(Ye,t))}})}),p==="Sevens"&&e.jsx(e.Fragment,{children:e.jsx(ns,{gameMode:"Sevens",players:al})}),p==="Sevens"&&D&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Le,{scoringMode:"custom",showToolbar:$,immediateAutoCommit:!0,onAutoDart:(t,a,c)=>{t>0&&Ut(Sa(yt,t))}})}),e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:ee,onChange:t=>X(Number(t.target.value||0)),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?da():Sr())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Sr,title:"Add a single dart (0â€“60)",children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,max:de<=170?170:180,placeholder:"Visit total (0â€“180)",value:Cr,onChange:t=>Ga(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Dr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Dr,title:"Commit a full 3-dart total like 93",children:"Commit Visit"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:xt,onChange:t=>lt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.shiftKey?Lr():Yn())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:Lr,disabled:Fe===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Yn,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:Xr,onChange:t=>Gn(t.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:xi,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>Gn(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add Â· Shift+Enter to Replace Last"})]}),e.jsx("div",{className:"h-1"})]})]})})}),fe&&e.jsx(Ho,{onClose:()=>Ce(!1)}),ua&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const a=await(await fetch(`${Vo}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s?.email})})).json();a.ok&&a.url?(window.location.href=a.url,a.development&&ct("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):a.error==="STRIPE_NOT_CONFIGURED"?ct("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):ct("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{ct("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM Â·"," ",Ul(Ol(),5)]})]})]}),Ji&&typeof document<"u"?gi.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[200] flex items-center justify-center p-4",onClick:()=>bn(!1),children:e.jsx(kn,{storageKey:"ndn:modal:offline-camera-manager",className:"relative",defaultWidth:640,defaultHeight:520,minWidth:480,minHeight:420,maxWidth:1200,maxHeight:900,initialFitHeight:!0,onClose:()=>bn(!1),children:e.jsxs("div",{className:"space-y-3",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:"Camera Devices"}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Manage Offline Camera Feeds"})]}),e.jsx("button",{className:"btn bg-slate-800 hover:bg-slate-700 text-white",onClick:()=>bn(!1),children:"Close"})]}),e.jsx(Ni,{fill:!0,user:s,playerScore:de,aiScore:ne,x01Score:A,inMatch:$e,showWinPopup:Kt,pendingLegWinner:b,playerDartsThrown:cn,aiDartsThrown:dr,totalPlayerDarts:_n,totalAiDarts:Kn,totalPlayerPoints:Wr,totalAiPoints:_r,player180s:Ra,player140s:_i,player100s:Ki,ai180s:Ia,ai140s:zi,ai100s:Gi,playerHighestCheckout:qi,aiHighestCheckout:Xi,onClose:()=>bn(!1),onOpen:()=>bn(!0),layout:r})]})})}),document.body):null,pr&&typeof document<"u"?gi.createPortal((()=>{const{target:t,value:a,stage:c}=pr,h=t==="player"?Ns:gn,f=t==="player"?De:V;return e.jsx("div",{className:"fixed inset-0 bg-black/75 z-[240] flex items-center justify-center p-4",onClick:Xn,children:e.jsx(kn,{storageKey:"ndn:modal:offline-leg-override",className:"relative",defaultWidth:360,defaultHeight:240,minWidth:280,minHeight:200,maxWidth:420,maxHeight:360,initialFitHeight:!0,onClose:Xn,children:e.jsxs("div",{className:"space-y-3 max-w-[18rem] mx-auto",onClick:U=>U.stopPropagation(),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide text-white/50",children:["Step ",c," of 2"]}),e.jsx("div",{className:"text-xl font-semibold text-white mt-1",children:"Override legs?"})]}),e.jsx("div",{className:"text-sm text-slate-200 leading-relaxed",children:c===1?e.jsxs(e.Fragment,{children:["Set ",h,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:a}),"? Confirm to continue."]}):e.jsxs(e.Fragment,{children:["Final confirmation: set ",h,"'s legs to"," ",e.jsx("span",{className:"font-semibold text-white",children:a}),". Select"," ",e.jsx("span",{className:"font-semibold text-emerald-200",children:"Yes"})," ","to apply immediately."]})}),e.jsxs("div",{className:"rounded-xl bg-black/40 border border-white/10 p-3 text-sm",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50 mb-1",children:"Current legs"}),e.jsx("div",{className:"text-base font-semibold text-white",children:f})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 text-white",onClick:Xn,children:"No"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-white",onClick:ml,children:"Yes"})]})]})})})})(),document.body):null,Kt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(kn,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${N===t?"bg-brand-600":""}`,onClick:()=>v(t),children:t},t))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(t=>e.jsx("button",{className:`btn ${K===t?"bg-brand-600":""}`,onClick:()=>te(t),children:t},t))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:Sl,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{ue(!1),wn()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{ue(!1),Pe(!1),tt(!1)},children:"Back to Menu"})]})]})}),Yi&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(kn,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,initialFitHeight:!0,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[p," Â· ",A," start Â· First to ",be]}),(()=>{const t=_n>0?Wr/_n*3:0,a=t*3,c=(()=>{const w=se.filter(_=>_.winner==="player"&&typeof _.winnerDarts=="number").map(_=>_.winnerDarts);return w.length?`${Math.min(...w)} darts`:"â€”"})(),h=(()=>{const w=se.filter(_=>_.winner==="player"&&typeof _.winnerDarts=="number").map(_=>_.winnerDarts);return w.length?`${Math.max(...w)} darts`:"â€”"})(),f=Hn>0?Math.round(Hr/Hn*100):0,U=Kn>0?_r/Kn*3:0,P=U*3,G=(()=>{const w=se.filter(_=>_.winner==="ai"&&typeof _.winnerDarts=="number").map(_=>_.winnerDarts);return w.length?`${Math.min(...w)} darts`:"â€”"})(),B=(()=>{const w=se.filter(_=>_.winner==="ai"&&typeof _.winnerDarts=="number").map(_=>_.winnerDarts);return w.length?`${Math.max(...w)} darts`:"â€”"})(),O=Wn>0?Math.round(Vr/Wn*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:s?.username||"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:De}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:t.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:a.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:Hn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[f,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:c})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:h})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Ra})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[De," â€“ ",V]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:Z==="None"?"Opponent":`${Z} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:V}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 3DA"}),e.jsx("div",{className:"font-semibold",children:U.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Final 9DA"}),e.jsx("div",{className:"font-semibold",children:P.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Darts At Double"}),e.jsx("div",{className:"font-semibold",children:Wn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Double %"}),e.jsxs("div",{className:"font-semibold",children:[O,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Best Dart Leg"}),e.jsx("div",{className:"font-semibold",children:G})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Worst Dart Leg"}),e.jsx("div",{className:"font-semibold",children:B})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180's Hit"}),e.jsx("div",{className:"font-semibold",children:Ia})]})]})]})]})})(),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:se.map((t,a)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${t.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",a+1,":"," ",t.winner==="player"?"You":Z==="None"?"Opp":"AI"," ","Â· Dbl ",t.doubleDarts," Â· CO ",t.checkoutDarts]},a))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(ao,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>qr(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{qr(!1),wn()},children:"Rematch"})]})]})}),se.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:se.map((t,a)=>e.jsxs("li",{children:["Leg ",a+1,": Double darts: ",t.doubleDarts,", Checkout darts:"," ",t.checkoutDarts]},a))})]})]})]})}export{ec as default};
//# sourceMappingURL=OfflinePlay-hQJ45ysr.js.map

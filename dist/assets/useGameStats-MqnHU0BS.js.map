{"version":3,"file":"useGameStats-MqnHU0BS.js","sources":["../../src/components/CameraTile.tsx","../../src/utils/checkout.ts","../../src/components/GameCalibrationStatus.tsx","../../src/components/ui/GameHeaderBar.tsx","../../src/game/types.ts","../../src/game/aroundTheClock.ts","../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/americanCricket.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/game/ticTacToe.ts","../../src/components/scoreboards/GameScoreboard.tsx","../../src/components/scoreboards/useGameStats.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo, useRef, useState, type CSSProperties } from 'react'\r\nimport { makeQrDataUrlWithLogo } from '../utils/qr'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCameraSession, type CameraStreamMode } from '../store/cameraSession'\r\nimport { discoverNetworkDevices, connectToNetworkDevice, type NetworkDevice, discoverUSBDevices, requestUSBDevice, connectToUSBDevice, type USBDevice } from '../utils/networkDevices'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype CameraTileProps = {\r\n  label?: string\r\n  autoStart?: boolean\r\n  scale?: number\r\n  className?: string\r\n  aspect?: 'inherit' | 'wide' | 'square' | 'portrait' | 'classic' | 'free'\r\n  style?: CSSProperties\r\n  fill?: boolean\r\n  // Offline mode props\r\n  user?: any\r\n  playerScore?: number\r\n  aiScore?: number\r\n  x01Score?: number\r\n  inMatch?: boolean\r\n  showWinPopup?: boolean\r\n  pendingLegWinner?: \"player\" | \"ai\" | null\r\n  playerDartsThrown?: number\r\n  aiDartsThrown?: number\r\n  totalPlayerDarts?: number\r\n  totalAiDarts?: number\r\n  totalPlayerPoints?: number\r\n  totalAiPoints?: number\r\n  player180s?: number\r\n  player140s?: number\r\n  player100s?: number\r\n  ai180s?: number\r\n  ai140s?: number\r\n  ai100s?: number\r\n  playerHighestCheckout?: number\r\n  aiHighestCheckout?: number\r\n  onClose?: () => void\r\n  onOpen?: () => void\r\n  layout?: \"classic\" | \"modern\"\r\n}\r\n\r\nexport default function CameraTile({\r\n  label,\r\n  autoStart,\r\n  scale: scaleOverride,\r\n  className,\r\n  aspect = 'inherit',\r\n  style,\r\n  fill = false,\r\n}: CameraTileProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null)\r\n  const cameraSession = useCameraSession()\r\n  const [streaming, setStreaming] = useState(false)\r\n  const [ws, setWs] = useState<WebSocket | null>(null)\r\n  const [pairCode, setPairCode] = useState<string | null>(null)\r\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null)\r\n  const lastRegisteredModeRef = useRef<CameraStreamMode | null>(null)\r\n  const registerStream = useCallback((stream: MediaStream | null, modeOverride: CameraStreamMode = 'local') => {\r\n    try {\r\n      if (stream) {\r\n        cameraSession.setMediaStream(stream)\r\n        if (videoRef.current) {\r\n          cameraSession.setVideoElementRef(videoRef.current)\r\n        }\r\n        cameraSession.setMode(modeOverride)\r\n        cameraSession.setStreaming(true)\r\n        lastRegisteredModeRef.current = modeOverride\r\n      } else if (lastRegisteredModeRef.current && lastRegisteredModeRef.current !== 'phone') {\r\n        cameraSession.setStreaming(false)\r\n        cameraSession.setMediaStream(null)\r\n        lastRegisteredModeRef.current = null\r\n      }\r\n    } catch (err) {\r\n      console.warn('[CameraTile] Failed to register stream with camera session:', err)\r\n    }\r\n  }, [cameraSession])\r\n  \r\n  // Initialize mode: prioritize phone camera if preferred, otherwise use localStorage\r\n  const preferredCameraLabel = useUserSettings(s => s.preferredCameraLabel)\r\n  const [mode, setMode] = useState<'local'|'phone'|'wifi'>(() => {\r\n    // If phone camera is selected, start in phone mode\r\n    if (preferredCameraLabel === 'Phone Camera') {\r\n      console.log('[CAMERATILE] Initializing mode to phone (from preferred camera selection)')\r\n      return 'phone'\r\n    }\r\n    // Otherwise use saved mode or default to local\r\n    const saved = localStorage.getItem('ndn:camera:mode') as any\r\n    console.log('[CAMERATILE] Initializing mode to', saved || 'local', '(from localStorage)')\r\n    return saved || 'local'\r\n  })\r\n  \r\n  const [expiresAt, setExpiresAt] = useState<number | null>(null)\r\n  const [now, setNow] = useState<number>(Date.now())\r\n  const [paired, setPaired] = useState<boolean>(false)\r\n  const [lanHost, setLanHost] = useState<string | null>(null)\r\n  const [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null)\r\n  const [showTips, setShowTips] = useState<boolean>(true)\r\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([])\r\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false)\r\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([])\r\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false)\r\n  const autoscoreProvider = useUserSettings(s => s.autoscoreProvider) as ('built-in' | 'external-ws' | 'manual' | undefined)\r\n  const cameraEnabledSetting = useUserSettings(s => s.cameraEnabled)\r\n  const setPreferredCameraLocked = useUserSettings(s => s.setPreferredCameraLocked)\r\n  const preferredCameraLocked = useUserSettings(s => s.preferredCameraLocked)\r\n  const setPreferredCamera = useUserSettings(s => s.setPreferredCamera)\r\n  const preferredCameraId = useUserSettings(s => s.preferredCameraId)\r\n\r\n  if (autoscoreProvider === 'manual') {\r\n    const fallbackBase = fill ? 'rounded-2xl overflow-hidden bg-black w-full flex flex-col' : 'rounded-2xl overflow-hidden bg-black w-full mx-auto'\r\n    const fallbackClass = [fallbackBase, className].filter(Boolean).join(' ').trim()\r\n    const fallbackStyle: CSSProperties = { ...(style || {}) }\r\n    if (!fill && fallbackStyle.aspectRatio === undefined && fallbackStyle.height === undefined && fallbackStyle.minHeight === undefined) {\r\n      fallbackStyle.aspectRatio = '4 / 3'\r\n    }\r\n    return (\r\n      <div className={fallbackClass} style={fallbackStyle}>\r\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\r\n          Manual scoring mode active â€” camera feeds are disabled.\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n  useEffect(() => {\r\n    const h = window.location.hostname\r\n    if (h === 'localhost' || h === '127.0.0.1') {\r\n      apiFetch(`/api/hosts`).then(r => r.json()).then(j => {\r\n        const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x)\r\n        if (ip) setLanHost(ip)\r\n      }).catch(()=>{})\r\n    }\r\n    // Detect HTTPS support for the phone link\r\n    apiFetch(`/api/https-info`).then(r=>r.json()).then(j=>{\r\n      if (j && typeof j.https === 'boolean') setHttpsInfo({ https: !!j.https, port: Number(j.port)||8788 })\r\n    }).catch(()=>{})\r\n  }, [])\r\n  const mobileUrl = useMemo(() => {\r\n    const code = pairCode || '____'\r\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    if (envUrl && envUrl.length > 0) {\r\n      try {\r\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\r\n        const u = new URL(envUrl)\r\n        const isSecure = u.protocol === 'wss:'\r\n        const origin = `${isSecure ? 'https' : 'http'}://${u.host}${u.pathname.endsWith('/ws') ? '' : u.pathname}`\r\n        const base = origin.replace(/\\/?ws$/i, '')\r\n        return `${base}/mobile-cam.html?code=${code}`\r\n      } catch {}\r\n    }\r\n    // Fallback to local development: prefer LAN host if detected\r\n    const host = (lanHost || window.location.hostname)\r\n    const useHttps = !!httpsInfo?.https\r\n    const port = useHttps ? (httpsInfo?.port || 8788) : 8787\r\n    const proto = useHttps ? 'https' : 'http'\r\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`\r\n  }, [pairCode, lanHost, httpsInfo])\r\n  useEffect(() => { \r\n    console.log('[CAMERATILE] Mode changed to:', mode, '- persisting to localStorage')\r\n    localStorage.setItem('ndn:camera:mode', mode) \r\n  }, [mode])\r\n  \r\n  // Sync phone camera selection from Calibrator into CameraTile mode state\r\n  // When user locks in phone camera in Calibrator, it updates preferredCameraLabel\r\n  // This effect ensures CameraTile's UI reflects that selection\r\n  useEffect(() => {\r\n    const ignore = useUserSettings.getState().ignorePreferredCameraSync\r\n    console.log('[CAMERATILE] Checking camera selection sync: preferredCameraLabel=', preferredCameraLabel, 'mode=', mode, 'ignoreSync=', ignore, 'manualModeSetAt=', manualModeSetAt)\r\n    if (ignore) return\r\n    // If user manually changed mode recently, avoid auto-syncing preferred camera\r\n    if (manualModeSetAt && Date.now() - manualModeSetAt < 30_000) return\r\n    if (preferredCameraLabel === 'Phone Camera' && mode !== 'phone') {\r\n      console.log('[CAMERATILE] Syncing mode to phone from Calibrator selection')\r\n      setMode('phone')\r\n    }\r\n  }, [preferredCameraLabel, mode, manualModeSetAt])\r\n  \r\n  const [qrDataUrl, setQrDataUrl] = useState<string>('')\r\n  const [manualModeSetAt, setManualModeSetAt] = useState<number | null>(null)\r\n  useEffect(() => {\r\n    if (!pairCode) { setQrDataUrl(''); return }\r\n    const logoPath = (import.meta as any).env?.VITE_QR_LOGO_URL || '/dart-thrower.svg'\r\n    makeQrDataUrlWithLogo(mobileUrl, {\r\n      width: 160,\r\n      margin: 1,\r\n      errorCorrectionLevel: 'H',\r\n      color: { dark: '#000000', light: '#ffffff' },\r\n      logo: { logoUrl: logoPath, logoScale: 0.2, mask: true, shape: 'circle' }\r\n    }).then(setQrDataUrl).catch(() => setQrDataUrl(''))\r\n  }, [mobileUrl, pairCode])\r\n  useEffect(() => {\r\n    if (!expiresAt) return\r\n    const t = setInterval(() => setNow(Date.now()), 1000)\r\n    return () => clearInterval(t)\r\n  }, [expiresAt])\r\n  const ttl = useMemo(() => expiresAt ? Math.max(0, Math.ceil((expiresAt - now)/1000)) : null, [expiresAt, now])\r\n  // Intentionally disabled automatic regeneration of phone pairing codes.\r\n  // Codes will only be created when the user explicitly requests it (button click).\r\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\r\n\r\n  useEffect(() => {\r\n    if (!cameraEnabledSetting || autoscoreProvider === 'manual') return\r\n    if (autoStart === undefined) return\r\n    if (autoStart) {\r\n      let cancelled = false\r\n      const desiredLabel = preferredCameraLabel || 'default'\r\n      const timer = window.setTimeout(() => {\r\n        if (cancelled || streaming) return\r\n        start().catch(err => console.warn(`[CameraTile] Auto-start failed for ${desiredLabel}:`, err))\r\n      }, 200)\r\n      return () => {\r\n        cancelled = true\r\n        window.clearTimeout(timer)\r\n      }\r\n    }\r\n    stop()\r\n  }, [autoStart, streaming, cameraEnabledSetting, autoscoreProvider, preferredCameraLabel, start, stop])\r\n\r\n  // If the user selected Phone Camera, bind the global stream into this tile\r\n  useEffect(() => {\r\n    const apply = async () => {\r\n      try {\r\n        const allowPhoneAttach = (preferredCameraLabel === 'Phone Camera' && (!manualModeSetAt || Date.now() - manualModeSetAt >= 30_000)) || mode === 'phone'\r\n        if (!allowPhoneAttach) return\r\n        const s = cameraSession.getMediaStream()\r\n        const v = videoRef.current\r\n        if (!v || !s) return\r\n        if (v.srcObject !== s) {\r\n          v.srcObject = s\r\n        }\r\n        v.muted = true\r\n        ;(v as any).playsInline = true\r\n        try { await v.play() } catch {}\r\n        setStreaming(true)\r\n      } catch {}\r\n    }\r\n    // Try immediately and poll briefly to catch late-arriving stream\r\n    apply()\r\n    const t = setInterval(apply, 800)\r\n    return () => clearInterval(t)\r\n  }, [preferredCameraLabel, mode, cameraSession, cameraSession.isStreaming])\r\n\r\n  async function start() {\r\n      console.log('[CameraTile] start() invoked with mode=', mode)\r\n    if (mode === 'wifi') {\r\n      return startWifiConnection()\r\n    }\r\n  console.log('[CameraTile] Attempting to attach global stream for phone mode...')\r\n\r\n    // If phone camera is selected and paired, don't try to start local camera\r\n    if (preferredCameraLabel === 'Phone Camera' || mode === 'phone') {\r\n      const s = cameraSession.getMediaStream()\r\n      if (s && videoRef.current) {\r\n        try {\r\n          videoRef.current.srcObject = s\r\n          await videoRef.current.play()\r\n          setStreaming(true)\r\n          return\r\n        } catch {}\r\n      }\r\n      // If no global stream yet, for phone mode we should attempt pairing\r\n      if (mode === 'phone') {\r\n        try { await startPhonePairing(); return } catch {}\r\n      }\r\n    }\r\n\r\n    try {\r\n      // Prefer saved camera if available\r\n      const { preferredCameraId, setPreferredCamera } = useUserSettings.getState()\r\n      const constraints: MediaStreamConstraints = preferredCameraId ? { video: { deviceId: { exact: preferredCameraId } }, audio: false } : { video: true, audio: false }\r\n      let stream: MediaStream\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints)\r\n      } catch (err: any) {\r\n        const name = (err && (err.name || err.code)) || ''\r\n        if (preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError')) {\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else {\r\n          throw err\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        registerStream(stream, 'local')\r\n      }\r\n      // Camera started successfully - no automatic preference updates\r\n    } catch {}\r\n  }\r\n  function stop() {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n      tracks.forEach(t => t.stop())\r\n      videoRef.current.srcObject = null\r\n      setStreaming(false)\r\n      registerStream(null)\r\n    }\r\n  }\r\n\r\n  async function startWifiConnection() {\r\n    setDiscoveringWifi(true)\r\n    try {\r\n      const devices = await discoverNetworkDevices()\r\n      setWifiDevices(devices)\r\n      if (devices.length === 0) {\r\n        alert('No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.')\r\n      }\r\n    } catch (error) {\r\n      console.error('Wifi device discovery failed:', error)\r\n      alert('Failed to discover wifi devices. Please check your network connection.')\r\n    } finally {\r\n      setDiscoveringWifi(false)\r\n    }\r\n  }\r\n\r\n  async function connectToWifiDevice(device: NetworkDevice) {\r\n    try {\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n\r\n      const stream = await connectToNetworkDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        registerStream(stream, 'wifi')\r\n        setWifiDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to wifi device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  async function startUsbConnection() {\r\n    setDiscoveringUsb(true)\r\n    try {\r\n      // First try to get already paired devices\r\n      const devices = await discoverUSBDevices()\r\n      setUsbDevices(devices)\r\n\r\n      // Then request user to select a new device\r\n      const newDevice = await requestUSBDevice()\r\n      if (newDevice) {\r\n        setUsbDevices(prev => [...prev, newDevice])\r\n      }\r\n\r\n      if (devices.length === 0 && !newDevice) {\r\n        alert('No USB scoring devices found. Please connect a device and try again.')\r\n      }\r\n    } catch (error) {\r\n      console.error('USB device discovery failed:', error)\r\n      alert('Failed to discover USB devices. Please check device connections.')\r\n    } finally {\r\n      setDiscoveringUsb(false)\r\n    }\r\n  }\r\n\r\n  // Listen for global event to start local camera from other UI components\r\n  useEffect(() => {\r\n    const onStart = (ev: any) => {\r\n      try {\r\n        const modeFromEvent = ev && ev.detail && ev.detail.mode\r\n        if (modeFromEvent && ['local', 'phone', 'wifi', 'usb'].includes(modeFromEvent)) {\r\n          // Respect explicit mode requests and treat as manual selection\r\n          handleModeSelect(modeFromEvent)\r\n          // Ensure start is invoked after selection is applied\r\n          start().catch(() => {})\r\n        } else {\r\n          // No explicit mode provided â€” just try to start current mode\r\n          start().catch(() => {})\r\n        }\r\n      } catch {}\r\n    }\r\n    window.addEventListener('ndn:start-camera' as any, onStart as any)\r\n    return () => { window.removeEventListener('ndn:start-camera' as any, onStart as any) }\r\n  }, [start, handleModeSelect])\r\n\r\n  async function connectToUsbDevice(device: USBDevice) {\r\n    try {\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n      const stream = await connectToUSBDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        setMode('wifi') // Using wifi mode for USB devices too\r\n        registerStream(stream, 'wifi')\r\n        setUsbDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to USB device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  const handleModeSelect = useCallback((newMode: 'local'|'phone'|'wifi'|'usb') => {\r\n    try {\r\n      setMode(newMode === 'usb' ? 'wifi' : newMode)\r\n      setManualModeSetAt(Date.now())\r\n      // Persist the user's selection and lock it to avoid auto-switching\r\n      try {\r\n        if (newMode === 'local') {\r\n          try { setPreferredCamera(preferredCameraId, 'Local', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        } else if (newMode === 'phone') {\r\n          try { setPreferredCamera(undefined, 'Phone Camera', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        } else if (newMode === 'wifi' || newMode === 'usb') {\r\n          try { setPreferredCamera(undefined, 'WiFi/USB', true) } catch {}\r\n          try { setPreferredCameraLocked(true) } catch {}\r\n        }\r\n      } catch {}\r\n      if (newMode === 'local') {\r\n        start().catch(() => {})\r\n      } else if (newMode === 'phone') {\r\n        startPhonePairing()\r\n      } else if (newMode === 'wifi') {\r\n        startWifiConnection()\r\n      } else if (newMode === 'usb') {\r\n        startUsbConnection()\r\n      }\r\n    } catch (err) { console.warn('[CameraTile] handleModeSelect failed', err) }\r\n  }, [start, startPhonePairing, startWifiConnection, startUsbConnection, setPreferredCamera, setPreferredCameraLocked, preferredCameraId])\r\n\r\n  // Phone pairing via WebRTC\r\n  function ensureWS() {\r\n    if (ws && ws.readyState === WebSocket.OPEN) return ws\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    const normalizedEnv = envUrl && envUrl.length > 0\r\n      ? (envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws')\r\n      : undefined\r\n    const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n    const sameOrigin = `${proto}://${window.location.host}/ws`\r\n    const host = window.location.hostname\r\n    const isLocalhost = host === 'localhost' || host === '127.0.0.1'\r\n    const isRenderHost = host.endsWith('onrender.com')\r\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\r\n    const renderWS = `wss://ninedartnation.onrender.com/ws`\r\n    let url = normalizedEnv\r\n    if (!url) {\r\n      if (isLocalhost) {\r\n        url = `${proto}://${host}:8787/ws`\r\n      } else if (isRenderHost) {\r\n        url = sameOrigin\r\n      } else {\r\n        url = renderWS\r\n      }\r\n    }\r\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\r\n    if (!url) url = sameOrigin\r\n    const socket = new WebSocket(url)\r\n    setWs(socket)\r\n    return socket\r\n  }\r\n  async function startPhonePairing() {\r\n    setMode('phone')\r\n    setPaired(false)\r\n    const socket = ensureWS()\r\n    if (socket.readyState === WebSocket.OPEN) {\r\n      socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      socket.onopen = () => socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    }\r\n    socket.onmessage = async (ev) => {\r\n      const data = JSON.parse(ev.data)\r\n      if (data.type === 'cam-code') {\r\n        setPairCode(data.code)\r\n        if (data.expiresAt) setExpiresAt(data.expiresAt)\r\n      } else if (data.type === 'cam-peer-joined') {\r\n        setPaired(true)\r\n        // Create offer to the phone\r\n        const peer = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] })\r\n        setPc(peer)\r\n        peer.onicecandidate = (e) => {\r\n          if (e.candidate && pairCode) socket.send(JSON.stringify({ type: 'cam-ice', code: pairCode, payload: e.candidate }))\r\n        }\r\n        peer.ontrack = (ev) => {\r\n          if (videoRef.current) {\r\n            const inbound = ev.streams?.[0]\r\n            if (inbound) {\r\n              videoRef.current.srcObject = inbound\r\n              videoRef.current.play().catch(()=>{})\r\n              setStreaming(true)\r\n            }\r\n          }\r\n        }\r\n        const offer = await peer.createOffer({ offerToReceiveAudio: false, offerToReceiveVideo: true })\r\n        await peer.setLocalDescription(offer)\r\n        if (pairCode) socket.send(JSON.stringify({ type: 'cam-offer', code: pairCode, payload: offer }))\r\n      } else if (data.type === 'cam-answer') {\r\n        if (pc) await pc.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n      } else if (data.type === 'cam-ice') {\r\n        if (pc) try { await pc.addIceCandidate(data.payload) } catch {}\r\n      }\r\n    }\r\n  }\r\n  function regenerateCode() {\r\n    setPairCode(null)\r\n    setExpiresAt(null)\r\n    setPaired(false)\r\n    if (ws && ws.readyState === WebSocket.OPEN) {\r\n      ws.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      startPhonePairing()\r\n    }\r\n    try { setPreferredCameraLocked(true) } catch {}\r\n  }\r\n\r\n  function stopAll() {\r\n    stop()\r\n    setPairCode(null)\r\n    setPaired(false)\r\n    setExpiresAt(null)\r\n    if (pc) { try { pc.close() } catch {}; setPc(null) }\r\n  }\r\n  return (\r\n  <CameraFrame \r\n      label={label} \r\n      autoStart={autoStart} \r\n      start={start} \r\n      stopAll={stopAll} \r\n      startPhonePairing={startPhonePairing} \r\n      startWifiConnection={startWifiConnection}\r\n      startUsbConnection={startUsbConnection}\r\n      connectToWifiDevice={connectToWifiDevice}\r\n      connectToUsbDevice={connectToUsbDevice}\r\n      videoRef={videoRef} \r\n      streaming={streaming} \r\n      mode={mode} \r\n      setMode={setMode} \r\n      pairCode={pairCode} \r\n      mobileUrl={mobileUrl} \r\n      ttl={ttl} \r\n      qrDataUrl={qrDataUrl} \r\n      regenerateCode={regenerateCode} \r\n      httpsInfo={httpsInfo} \r\n      showTips={showTips} \r\n      setShowTips={setShowTips} \r\n      wifiDevices={wifiDevices}\r\n      usbDevices={usbDevices}\r\n      discoveringWifi={discoveringWifi}\r\n      discoveringUsb={discoveringUsb}\r\n      scaleOverride={scaleOverride} \r\n      className={className}\r\n      aspect={aspect}\r\n      style={style}\r\n      fill={fill}\r\n        onModeSelect={handleModeSelect}\r\n      />\r\n  )\r\n}\r\n\r\nfunction CameraFrame(props: any) {\r\n  const cameraSession = useCameraSession()\r\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings()\r\n  const {\r\n    label,\r\n    start,\r\n    stopAll,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n  startUsbConnection,\r\n    connectToWifiDevice,\r\n    connectToUsbDevice,\r\n    videoRef,\r\n    streaming,\r\n  mode,\r\n    setMode,\r\n  onModeSelect,\r\n    pairCode,\r\n    mobileUrl,\r\n    ttl,\r\n    qrDataUrl,\r\n    regenerateCode,\r\n    httpsInfo,\r\n    showTips,\r\n    setShowTips,\r\n    wifiDevices,\r\n    usbDevices,\r\n    discoveringWifi,\r\n    discoveringUsb,\r\n    className,\r\n    aspect,\r\n    style,\r\n    fill,\r\n  } = props\r\n\r\n  const modeDisplayName: Record<string, string> = {\r\n    local: 'Local',\r\n    phone: 'PhoneCam',\r\n    wifi: 'Wi-Fi/USB',\r\n  }\r\n\r\n  const reconnectOptions = useMemo(() => {\r\n    return [\r\n      {\r\n        id: 'local',\r\n        title: 'Local camera',\r\n        description: 'Use the desktop webcam or capture card.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('local')\r\n          },\r\n      },\r\n      {\r\n        id: 'phone',\r\n        title: 'PhoneCam',\r\n        description: 'Stream from your phone via the mobile link.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('phone')\r\n          },\r\n      },\r\n      {\r\n        id: 'wifi',\r\n        title: 'Wi-Fi/USB',\r\n        description: 'Connect to scoring devices on your local network.',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('wifi')\r\n          },\r\n      },\r\n      {\r\n        id: 'usb',\r\n        title: 'USB',\r\n        description: 'Connect a USB capture device (treated like WiFi mode).',\r\n        action: () => {\r\n            if (onModeSelect) onModeSelect('usb')\r\n          },\r\n      },\r\n    ]\r\n  }, [setMode, start, startPhonePairing, startWifiConnection, startUsbConnection])\r\n\r\n  const [copyFeedback, setCopyFeedback] = useState<'link' | 'code' | null>(null)\r\n  const copyTimeoutRef = useRef<number | null>(null)\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n    }\r\n  }, [])\r\n\r\n  // Respect stored aspect unless we're explicitly in full-bleed fill mode,\r\n  // in which case drop the aspect box so the video can truly cover the area.\r\n  const { cameraFitMode: globalFitMode } = useUserSettings()\r\n  const effectiveFitMode: 'fit' | 'fill' = fill ? 'fill' : (globalFitMode || 'fill')\r\n  // In fill mode we guarantee no black bars: never allow downscaling below 1.0\r\n  const scale = (() => {\r\n    const raw = Number(props.scaleOverride ?? cameraScale ?? 1)\r\n    const clamped = Math.max(0.5, Math.min(1.25, raw))\r\n    return effectiveFitMode === 'fill' ? Math.max(1, clamped) : clamped\r\n  })()\r\n  const aspectChoice: 'wide' | 'square' | 'portrait' | 'classic' | 'free' = (fill && effectiveFitMode === 'fill')\r\n    ? 'free'\r\n    : (aspect && aspect !== 'inherit')\r\n      ? aspect\r\n      : ((storedAspect as any) || 'wide')\r\n\r\n  const shouldMaintainAspect = aspectChoice !== 'free'\r\n  const aspectClass = shouldMaintainAspect\r\n    ? aspectChoice === 'square'\r\n      ? 'aspect-square'\r\n      : aspectChoice === 'portrait'\r\n        ? 'aspect-[3/4]'\r\n        : aspectChoice === 'classic'\r\n          ? 'aspect-[4/3]'\r\n          : 'aspect-video'\r\n    : ''\r\n\r\n  const containerBase = fill\r\n    ? 'rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30'\r\n    : 'rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30'\r\n  const containerClass = [containerBase, className].filter(Boolean).join(' ').trim()\r\n  const containerStyle: CSSProperties = { ...(style || {}) }\r\n\r\n  const viewportClass = fill ? 'relative flex-1 min-h-[420px] bg-black' : 'relative w-full bg-black'\r\n\r\n  const commonVideoProps = {\r\n    style: { transform: `scale(${scale})`, transformOrigin: 'center' as const },\r\n  }\r\n\r\n  const usbActive = mode === 'wifi' && usbDevices.some(d => d.status === 'online')\r\n\r\n  const videoElement = (() => {\r\n    // Apply Fit/Fill preference (fill prop hard-overrides to full-bleed)\r\n    const isFit = effectiveFitMode === 'fit'\r\n    const baseVideoClass = isFit\r\n      // Fit: preserve entire frame (may letterbox)\r\n      ? 'absolute inset-0 w-full h-full object-contain object-center bg-transparent'\r\n      // Fill: guarantee full coverage with object-cover so there are no black bars\r\n      : 'absolute inset-0 w-full h-full object-cover object-center bg-transparent'\r\n    if (fill) {\r\n      if (shouldMaintainAspect) {\r\n        return (\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div className={`relative w-full max-w-full max-h-full ${aspectClass}`}>\r\n              <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n      return <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n    }\r\n    if (shouldMaintainAspect) {\r\n      return (\r\n        <div className={`relative w-full ${aspectClass}`}>\r\n          <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n        </div>\r\n      )\r\n    }\r\n    return <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n  })()\r\n\r\n  async function copyValue(value: string | null | undefined, type: 'link' | 'code') {\r\n    if (!value) return\r\n    try {\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        await navigator.clipboard.writeText(value)\r\n      } else {\r\n        const textarea = document.createElement('textarea')\r\n        textarea.value = value\r\n        textarea.style.position = 'fixed'\r\n        textarea.style.opacity = '0'\r\n        document.body.appendChild(textarea)\r\n        textarea.focus()\r\n        textarea.select()\r\n        document.execCommand('copy')\r\n        document.body.removeChild(textarea)\r\n      }\r\n      setCopyFeedback(type)\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n      copyTimeoutRef.current = window.setTimeout(() => setCopyFeedback(null), 1500)\r\n    } catch (err) {\r\n      console.warn('Copy to clipboard failed:', err)\r\n      setCopyFeedback(null)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={containerClass} style={containerStyle}>\r\n      <div className={viewportClass}>\r\n        {videoElement}\r\n        {(cameraSession.isStreaming && (mode==='phone')) && (\r\n          <div className=\"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg\">\r\n            <span className=\"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse\" />\r\n            <span>REC</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n  <div className=\"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50\">\r\n  <span className=\"truncate font-medium\">{label || (streaming ? (mode==='phone' ? 'PHONE LIVE' : mode==='wifi' ? 'WIFI LIVE' : 'LIVE') : 'Camera')}{preferredCameraLocked && <span className=\"ml-2 text-xs opacity-80\">ðŸ”’</span>}</span>\r\n        <div className=\"flex items-center gap-2\">\r\n          {!streaming && (\r\n            <>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='local'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => (onModeSelect||handleModeSelect)('local')}>Local</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='phone'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => (onModeSelect||handleModeSelect)('phone')}>Phone</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='wifi'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => (onModeSelect||handleModeSelect)('wifi')}>WiFi</button>\r\n              <button className={`px-2 py-1 rounded-md text-xs font-semibold transition-all ${mode==='wifi'?'bg-emerald-500 text-white':'bg-slate-700 text-slate-200 hover:bg-slate-600'}`} onClick={() => (onModeSelect||handleModeSelect)('usb')}>USB</button>\r\n            </>\r\n          )}\r\n          {streaming ? (\r\n            <button className=\"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all\" onClick={stopAll}>Stop</button>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n      {mode==='phone' && pairCode && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\r\n          <button\r\n            type=\"button\"\r\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\r\n            onClick={() => copyValue(mobileUrl, 'link')}\r\n            title=\"Copy mobile camera link\"\r\n          >\r\n            <span className=\"flex-1 min-w-0 font-mono break-all\">{mobileUrl}</span>\r\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'link' ? 'Copied!' : 'Copy'}</span>\r\n          </button>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <a\r\n              href={mobileUrl}\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\r\n            >\r\n              Open link\r\n            </a>\r\n            <button\r\n              type=\"button\"\r\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n              onClick={() => copyValue(pairCode, 'code')}\r\n              title=\"Copy pairing code\"\r\n            >\r\n              <span className=\"font-mono tracking-[0.3em] text-sm\">{pairCode}</span>\r\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'code' ? 'Copied!' : 'Copy'}</span>\r\n            </button>\r\n          </div>\r\n          {qrDataUrl && <img className=\"mt-1 w-[160px] h-[160px] bg-white rounded\" alt=\"Scan to open\" src={qrDataUrl} />}\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            {ttl !== null && <span>Expires in {ttl}s</span>}\r\n            <button className=\"px-1 py-0.5 rounded bg-slate-700\" onClick={regenerateCode}>Regenerate</button>\r\n          </div>\r\n          {showTips && (\r\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\r\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\r\n              <ul className=\"list-disc pl-4 space-y-1\">\r\n                <li>Phone and desktop must be on the same Wiâ€‘Fi network.</li>\r\n                <li>Allow the server through your firewall (ports 8787 and {httpsInfo?.https ? httpsInfo.port : 8788}).</li>\r\n                <li>On iPhone, use HTTPS links (QR will prefer https when enabled).</li>\r\n              </ul>\r\n              <div className=\"mt-2 text-right\"><button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={()=>setShowTips(false)}>Hide tips</button></div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      {mode==='wifi' && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\r\n          \r\n          {/* WiFi Devices */}\r\n          <div className=\"mb-3\">\r\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\r\n            {discoveringWifi ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning network...</span>\r\n              </div>\r\n            ) : wifiDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {wifiDevices.map((device: NetworkDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.ip}:{device.port}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToWifiDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Rescan WiFi</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Scan WiFi</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n\r\n          {/* USB Devices */}\r\n          <div>\r\n            <div className=\"font-medium mb-1\">USB Devices</div>\r\n            {discoveringUsb ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning USB...</span>\r\n              </div>\r\n            ) : usbDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {usbDevices.map((device: USBDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.type.toUpperCase()}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToUsbDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Rescan USB</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Scan USB</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {!streaming && (\r\n        <div className=\"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div>\r\n              <div className=\"text-[10px] uppercase tracking-wide text-slate-500\">Camera modes</div>\r\n              <div className=\"text-sm font-semibold text-slate-900\">Reconnect camera</div>\r\n            </div>\r\n            <span className=\"text-xs text-slate-500\">Current: {modeDisplayName[mode] || 'Local'}</span>\r\n          </div>\r\n          <p className=\"text-xs text-slate-500 mb-2\">Tap a mode to restart the feed or switch inputs.</p>\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {reconnectOptions.map(option => {\r\n              const isActive = option.id === 'usb'\r\n                ? usbActive\r\n                : option.id === mode\r\n              return (\r\n                <button\r\n                  key={option.id}\r\n                  type=\"button\"\r\n                  onClick={option.action}\r\n                  className={`text-left p-3 rounded-2xl border ${isActive ? 'border-emerald-500 bg-emerald-50 shadow' : 'border-slate-200 bg-white/80 hover:bg-slate-50'} transition`}\r\n                >\r\n                  <div className=\"text-xs font-semibold uppercase tracking-wide text-slate-500\">{option.title}</div>\r\n                  <div className=\"text-[11px] text-slate-600 mt-1\">{option.description}</div>\r\n                  {isActive && <div className=\"text-[10px] text-emerald-500 mt-2\">Active</div>}\r\n                </button>\r\n              )\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}","// Very lightweight checkout suggestions. For proper coverage consider a full table.\r\n// Returns up to a few route strings like \"T20 T20 D20\" for a given remaining.\r\n\r\nconst doubles = [\r\n  'D1','D2','D3','D4','D5','D6','D7','D8','D9','D10','D11','D12','D13','D14','D15','D16','D17','D18','D19','D20','DB'\r\n]\r\n\r\nfunction dVal(tag: string): number { if (tag === 'DB') return 50; const n = Number(tag.slice(1)); return n*2 }\r\n\r\nfunction prefsDoubleScore(fav: string): number {\r\n  if (!doubles.includes(fav)) return 32 // default D16\r\n  return dVal(fav)\r\n}\r\n\r\nexport function suggestCheckouts(remaining: number, favoriteDouble: string = 'D16'): string[] {\r\n  if (remaining > 170 || remaining <= 1) return []\r\n  // Simple known highest routes for popular numbers, then fall back to greedy towards favourite double\r\n  const hardcoded: Record<number, string[]> = {\r\n    170: ['T20 T20 DB'], 167: ['T20 T19 DB'], 164: ['T20 T18 DB'], 161: ['T20 T17 DB'], 160: ['T20 T20 D20'],\r\n    158: ['T20 T20 D19'], 157: ['T20 T19 D20'], 156: ['T20 T20 D18'], 155: ['T20 T19 D19'], 154: ['T20 T18 D20'],\r\n    153: ['T20 T19 D18'], 152: ['T20 T20 D16'], 151: ['T20 T17 D20'], 150: ['T20 T18 D18'], 149: ['T20 T19 D16'],\r\n    148: ['T20 T16 D20'], 147: ['T20 T17 D18'], 146: ['T20 T18 D16'], 145: ['T20 T15 D20'], 144: ['T20 T20 D12'],\r\n    141: ['T20 T19 D12'], 140: ['T20 T20 D10'], 137: ['T20 T19 D10'], 136: ['T20 T20 D8'], 132: ['BULL T14 D20','T20 T12 D8'],\r\n    130: ['T20 T20 D5','T20 T18 D8'], 129: ['T19 T16 D12'], 128: ['T18 T14 D16'], 127: ['T20 T17 D8'], 126: ['T19 T19 D6'],\r\n    121: ['T20 11 D20','T20 T15 D8'], 120: ['T20 20 D20','T20 S20 D20'], 110: ['T20 10 D20'], 100: ['T20 D20'], 99: ['T19 10 D16','T19 S10 D16'], 97: ['T19 D20'],\r\n    96: ['T20 D18'], 95: ['T19 D19'], 94: ['T18 D20'], 92: ['T20 D16'], 90: ['T18 D18','T20 D15'], 86: ['T18 D16'], 84: ['T20 D12','T16 D18'],\r\n    82: ['BULL D16','T14 D20'], 81: ['T19 D12'], 80: ['T20 D10','D20 D20'], 78: ['T18 D12'], 76: ['T20 D8','T16 D14'], 74: ['T14 D16','T18 D10'],\r\n    72: ['T16 D12','T20 D6'], 70: ['T18 D8','S20 BULL'], 68: ['T20 D4','T16 D10'], 66: ['T10 D18','T14 D12'], 64: ['T16 D8','D16 D16'],\r\n    62: ['T10 D16','T12 D13'], 60: ['20 D20','S20 D20'], 58: ['18 D20','S18 D20'], 56: ['16 D20','S16 D20'], 54: ['14 D20','S14 D20'],\r\n    52: ['20 D16','S20 D16'], 50: ['BULL','10 D20'], 48: ['16 D16','S16 D16'], 46: ['14 D16'], 44: ['12 D16'], 42: ['10 D16'],\r\n    40: ['D20'], 38: ['D19'], 36: ['D18'], 34: ['D17'], 32: ['D16'], 30: ['D15'], 28: ['D14'], 26: ['D13'], 24: ['D12'], 22: ['D11'], 20: ['D10'], 18: ['D9'], 16: ['D8'], 14: ['D7'], 12: ['D6'], 10: ['D5'], 8: ['D4'], 6: ['D3'], 4: ['D2'], 2: ['D1']\r\n  }\r\n  if (hardcoded[remaining]) return hardcoded[remaining]\r\n  // Greedy fallback: aim to leave favourite double if possible in two darts\r\n  const target = prefsDoubleScore(favoriteDouble)\r\n  const routes: string[] = []\r\n  // Try to hit a treble/big single that leaves the fav double\r\n  for (const t of [60, 57, 54, 51, 48]) { // T20..T16\r\n    const left = remaining - t\r\n    if (left === target) { routes.push(`T${t/3} ${favoriteDouble}`); break }\r\n  }\r\n  if (!routes.length) {\r\n    for (const s of [20, 19, 18, 17, 16, 15]) {\r\n      const left = remaining - s\r\n      if (left === target) { routes.push(`${s} ${favoriteDouble}`); break }\r\n    }\r\n  }\r\n  return routes\r\n}\r\n\r\nexport function sayScore(name: string, scored: number, remaining: number, voiceName?: string, opts?: { volume?: number; checkoutOnly?: boolean }) {\r\n  try {\r\n    const synth = window.speechSynthesis\r\n    if (!synth) return\r\n    const msg = new SpeechSynthesisUtterance()\r\n    const isCheckout = remaining <= 170 && remaining > 0\r\n    const isOneEighty = scored === 180\r\n    const shouldAnnounce = !opts?.checkoutOnly || isCheckout || isOneEighty\r\n    if (!shouldAnnounce) return\r\n\r\n    if (isOneEighty) {\r\n      msg.text = `${name}! One eighty!`\r\n      msg.rate = 1.04\r\n      msg.pitch = 1.15\r\n    } else if (isCheckout) {\r\n      msg.text = `${name}, ${remaining} remaining.`\r\n      msg.rate = 1.0\r\n      msg.pitch = 1.0\r\n    } else if (scored === 0) {\r\n      msg.text = `${name}, no score.`\r\n      msg.rate = 1.0\r\n      msg.pitch = 1.0\r\n    } else {\r\n      msg.text = `${name}, ${scored}.`\r\n      msg.rate = 1.0\r\n      msg.pitch = 1.0\r\n    }\r\n    if (voiceName) {\r\n      const v = synth.getVoices().find(v => v.name === voiceName)\r\n      if (v) msg.voice = v\r\n    }\r\n    if (typeof opts?.volume === 'number') msg.volume = Math.max(0, Math.min(1, opts.volume))\r\n    else msg.volume = 1\r\n    try { synth.cancel() } catch {}\r\n    synth.speak(msg)\r\n  } catch {}\r\n}\r\n","import React from 'react'\r\nimport { AlertTriangle, CheckCircle, AlertCircle, Zap } from 'lucide-react'\r\nimport { useCalibration } from '../store/calibration'\r\nimport {\r\n  getCalibrationConfidenceForGame,\r\n  isCalibrationSuitableForGame,\r\n  getCalibrationQualityText,\r\n  getRecalibrationRecommendation,\r\n  GAME_CALIBRATION_REQUIREMENTS\r\n} from '../utils/gameCalibrationRequirements'\r\n\r\ninterface GameCalibrationStatusProps {\r\n  gameMode: string\r\n  compact?: boolean // Show minimal version\r\n  onRecalibrate?: () => void // Optional callback for recalibrate button\r\n}\r\n\r\nexport default function GameCalibrationStatus({\r\n  gameMode,\r\n  compact = false,\r\n  onRecalibrate\r\n}: GameCalibrationStatusProps) {\r\n  const { H, errorPx } = useCalibration()\r\n\r\n  const confidence = getCalibrationConfidenceForGame(gameMode, errorPx)\r\n  const suitable = isCalibrationSuitableForGame(gameMode, errorPx)\r\n  const { quality, text } = getCalibrationQualityText(gameMode, errorPx)\r\n  const recommendation = getRecalibrationRecommendation(gameMode)\r\n  const requirement = GAME_CALIBRATION_REQUIREMENTS[gameMode]\r\n\r\n  // Not calibrated\r\n  if (!H || !errorPx) {\r\n    if (compact) {\r\n      return (\r\n        <div className=\"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30\">\r\n          <AlertTriangle className=\"w-3 h-3\" />\r\n          Not calibrated\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className=\"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2\">\r\n        <AlertTriangle className=\"w-4 h-4 text-red-400 flex-shrink-0\" />\r\n        <div className=\"flex-1\">\r\n          <div className=\"font-medium text-red-300\">Calibration Required</div>\r\n          <div className=\"text-xs opacity-80\">Please calibrate before playing {gameMode}</div>\r\n        </div>\r\n        {onRecalibrate && (\r\n          <button\r\n            className=\"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700\"\r\n            onClick={onRecalibrate}\r\n          >\r\n            Calibrate\r\n          </button>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Determine colors based on suitability\r\n  const bgColor = suitable\r\n    ? 'bg-emerald-500/20 border-emerald-600/30'\r\n    : 'bg-amber-500/20 border-amber-600/30'\r\n\r\n  const textColor = suitable ? 'text-emerald-300' : 'text-amber-300'\r\n  const icon = suitable ? CheckCircle : AlertTriangle\r\n\r\n  if (compact) {\r\n    return (\r\n      <div className={`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${bgColor} ${textColor}`}>\r\n        {React.createElement(icon, { className: 'w-3 h-3' })}\r\n        <span>{text}</span>\r\n        {!suitable && recommendation && (\r\n          <span className=\"w-3 h-3 cursor-help\" title={recommendation}>\r\n            <AlertCircle className=\"w-3 h-3 inline\" />\r\n          </span>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Full version\r\n  return (\r\n    <div className={`px-3 py-2 rounded border ${bgColor} space-y-1`}>\r\n      <div className=\"flex items-center gap-2\">\r\n        {React.createElement(icon, {\r\n          className: `w-4 h-4 ${suitable ? 'text-emerald-400' : 'text-amber-400'} flex-shrink-0`\r\n        })}\r\n        <div className=\"flex-1\">\r\n          <div className={`font-medium ${suitable ? 'text-emerald-300' : 'text-amber-300'}`}>\r\n            Calibration for {gameMode}\r\n          </div>\r\n          <div className=\"text-xs opacity-80\">Error: {Math.round(errorPx)}px | {text}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Confidence bar */}\r\n      <div className=\"flex items-center gap-2\">\r\n        <div className=\"flex-1 h-1.5 rounded bg-black/30 overflow-hidden\">\r\n          <div\r\n            className={`h-full transition-all ${\r\n              suitable ? 'bg-emerald-500' : 'bg-amber-500'\r\n            }`}\r\n            style={{ width: `${Math.min(100, confidence)}%` }}\r\n          />\r\n        </div>\r\n        <span className=\"text-xs font-mono\">{Math.round(confidence)}%</span>\r\n      </div>\r\n\r\n      {/* Requirements */}\r\n      {requirement && (\r\n        <div className=\"text-xs opacity-75\">\r\n          <div>Tolerance: Â±{requirement.tolerancePx}px | Min: {requirement.minConfidence}%</div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Warning and recommendation */}\r\n      <div className=\"space-y-1\">\r\n        {!suitable && (\r\n          <div className=\"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1\">\r\n            <AlertTriangle className=\"w-3 h-3 flex-shrink-0\" />\r\n            Calibration quality is below minimum for {gameMode}\r\n          </div>\r\n        )}\r\n\r\n        {recommendation && (\r\n          <div className=\"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1\">\r\n            <Zap className=\"w-3 h-3 flex-shrink-0\" />\r\n            {recommendation}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {!suitable && onRecalibrate && (\r\n        <button\r\n          className=\"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700\"\r\n          onClick={onRecalibrate}\r\n        >\r\n          Recalibrate for {gameMode}\r\n        </button>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","import type { ReactNode } from 'react'\r\n\r\n// Glassy sticky header bar used across Offline and Online match UIs for visual parity\r\nexport default function GameHeaderBar({\r\n  left,\r\n  right,\r\n  className = '',\r\n  sticky = true,\r\n}: {\r\n  left: ReactNode\r\n  right?: ReactNode\r\n  className?: string\r\n  sticky?: boolean\r\n}) {\r\n  return (\r\n    <div className={`${sticky ? 'sticky top-0' : ''} card relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${className}`}>\r\n      <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent\" />\r\n      <div className=\"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap\">\r\n        {left}\r\n      </div>\r\n      <div className=\"flex items-center gap-1 flex-wrap justify-end\">\r\n        {right}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","export type DartMult = 'S' | 'D' | 'T'\r\nexport type Dart = { mult: DartMult; num: number } | { bull: 25 | 50 }\r\n\r\nexport type DoublePracticeState = {\r\n\ttargetIndex: number // 0..20 for D1..D20 then 21 for DBULL\r\n\tcompleted: boolean\r\n}\r\n\r\nexport const DOUBLE_PRACTICE_TARGETS: Array<{ label: string; score: number; isBull?: boolean }>[] = [] as any\r\n\r\nexport const DOUBLE_PRACTICE_ORDER: { label: string; score: number; isBull?: boolean }[] = [\r\n\t...Array.from({ length: 20 }, (_, i) => ({ label: `D${i + 1}` , score: (i + 1) * 2 })),\r\n\t{ label: 'DBULL', score: 50, isBull: true },\r\n]\r\n\r\nexport function isDoubleHit(value: number, targetIdx: number): boolean {\r\n\tconst t = DOUBLE_PRACTICE_ORDER[targetIdx]\r\n\treturn !!t && value === t.score\r\n}\r\n\r\nexport function parseManualDart(input: string): number | null {\r\n\tconst t = input.trim().toUpperCase()\r\n\tif (!t) return null\r\n\tif (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL') return 50\r\n\tif (t === '25' || t === 'OBULL') return 25\r\n\tconst m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n\tif (!m) return null\r\n\tconst mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n\tconst num = parseInt(m[2],10)\r\n\tif (num < 1 || num > 20) return null\r\n\tconst multVal = mult==='S'?1:mult==='D'?2:3\r\n\treturn num * multVal\r\n}\r\n\r\n// Parse a detailed dart string like \"T20\", \"D16\", \"S5\", \"25\", \"50\", \"BULL\", returning a structured Dart.\r\nexport function parseDartDetailed(input: string): Dart | null {\r\n\tconst t = input.trim().toUpperCase()\r\n\tif (!t) return null\r\n\tif (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL' || t === 'INNER BULL' || t === 'INNER_BULL') return { bull: 50 }\r\n\tif (t === '25' || t === 'OBULL' || t === 'OUTER BULL' || t === 'BULL25') return { bull: 25 }\r\n\tconst m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n\tif (!m) return null\r\n\tconst mult = (m[1] || 'S') as DartMult\r\n\tconst num = parseInt(m[2], 10)\r\n\tif (num < 1 || num > 20) return null\r\n\treturn { mult, num }\r\n}\r\n\r\n// Convert autoscore ring+sector data into a structured Dart\r\n// ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n// sector: 1..20 for numbered segments; null/undefined for bull/miss\r\nexport function ringSectorToDart(ring?: string, sector?: number | null): Dart | null {\r\n\tif (!ring || ring === 'MISS') return null\r\n\tif (ring === 'BULL') return { bull: 25 }\r\n\tif (ring === 'INNER_BULL') return { bull: 50 }\r\n\tif (typeof sector === 'number' && sector >= 1 && sector <= 20) {\r\n\t\tconst mult: DartMult = ring === 'DOUBLE' ? 'D' : ring === 'TRIPLE' ? 'T' : 'S'\r\n\t\treturn { mult, num: sector }\r\n\t}\r\n\treturn null\r\n}\r\n","export type ATCState = {\r\n\ttarget: number // 1..20 then 25 (outer bull) then 50 (inner)\r\n\tfinished: boolean\r\n}\r\n\r\nexport const ATC_ORDER: number[] = [\r\n\t...Array.from({ length: 20 }, (_, i) => i + 1),\r\n\t25,\r\n\t50,\r\n]\r\n\r\nexport function nextTarget(current: number): number | null {\r\n\tconst idx = ATC_ORDER.indexOf(current)\r\n\tif (idx < 0) return ATC_ORDER[0]\r\n\tif (idx >= ATC_ORDER.length - 1) return null\r\n\treturn ATC_ORDER[idx + 1]\r\n}\r\n\r\nexport function isCorrectHit(value: number, target: number): boolean {\r\n\treturn value === target\r\n}\r\n\r\n","export type CricketMark = 0 | 1 | 2 | 3\r\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25 // 25 is bull (outer+inner)\r\n\r\nexport type CricketState = {\r\n\t// marks per number\r\n\tmarks: Record<CricketNumber, CricketMark>\r\n\t// accumulated points when opponent hasn't closed a number\r\n\tpoints: number\r\n}\r\n\r\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25]\r\n\r\nexport function createCricketState(): CricketState {\r\n\tconst marks: any = {}\r\n\tCRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n\treturn { marks, points: 0 }\r\n}\r\n\r\n// Apply a single dart to a player's cricket state\r\n// Returns deltaPoints scored on this dart\r\nexport function applyCricketDart(state: CricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: CricketNumber) => boolean = () => false): number {\r\n\t// Map autoscore terms to logical hits\r\n\tlet num: CricketNumber | null = null\r\n\tlet hits = 0\r\n\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n\t\tnum = 25\r\n\t\thits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n\t} else if (typeof sector === 'number' && (sector as number) >= 15 && (sector as number) <= 20) {\r\n\t\tnum = sector as CricketNumber\r\n\t\tif (ring === 'TRIPLE') hits = 3\r\n\t\telse if (ring === 'DOUBLE') hits = 2\r\n\t\telse hits = 1\r\n\t} else if (value) {\r\n\t\t// Fallback when only numeric score provided (manual): infer by divisibility\r\n\t\tconst cand: CricketNumber[] = [20,19,18,17,16,15]\r\n\t\tfor (const c of cand) {\r\n\t\t\tif (value === c) { num = c; hits = 1; break }\r\n\t\t\tif (value === c*2) { num = c; hits = 2; break }\r\n\t\t\tif (value === c*3) { num = c; hits = 3; break }\r\n\t\t}\r\n\t\tif (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n\t}\r\n\tif (!num) return 0\r\n\r\n\tconst before = state.marks[num]\r\n\tlet remainToClose = Math.max(0, 3 - before)\r\n\tconst toApply = Math.min(remainToClose, hits)\r\n\tconst overflow = Math.max(0, hits - toApply)\r\n\t// Increase marks up to 3\r\n\tconst after = (before + toApply) as CricketMark\r\n\tstate.marks[num] = after > 3 ? 3 : after\r\n\r\n\t// Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\r\n\tlet points = 0\r\n\tif (overflow > 0 && !opponentClosed(num)) {\r\n\t\tif (num === 25) {\r\n\t\t\t// Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\r\n\t\t\tif (ring === 'INNER_BULL') points += 50 * overflow\r\n\t\t\telse points += 25 * overflow\r\n\t\t} else {\r\n\t\t\tpoints += num * overflow\r\n\t\t}\r\n\t}\r\n\r\n\tstate.points += points\r\n\treturn points\r\n}\r\n\r\nexport function hasClosedAll(state: CricketState): boolean {\r\n\treturn CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n\r\nexport function cricketWinner(self: CricketState, opponents: CricketState[]): boolean {\r\n\t// Win when all closed and you have >= opponents' points\r\n\tif (!hasClosedAll(self)) return false\r\n\tconst maxOppPoints = Math.max(0, ...opponents.map(o => o.points))\r\n\treturn self.points >= maxOppPoints\r\n}\r\n","export type ShanghaiRound = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20\r\n\r\nexport type ShanghaiState = {\r\n\tround: ShanghaiRound\r\n\tscore: number\r\n\tfinished: boolean\r\n\tshanghaiAchieved: boolean // single+double+triple of target in same 3-dart turn\r\n\tturnHits: { singles: number; doubles: number; triples: number }\r\n}\r\n\r\nexport function createShanghaiState(): ShanghaiState {\r\n\treturn { round: 1, score: 0, finished: false, shanghaiAchieved: false, turnHits: { singles: 0, doubles: 0, triples: 0 } }\r\n}\r\n\r\nexport function getRoundTarget(state: ShanghaiState): number { return state.round }\r\n\r\n// Apply one dart; returns points scored on this dart\r\nexport function applyShanghaiDart(state: ShanghaiState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst target = getRoundTarget(state)\r\n\tlet points = 0\r\n\tif (typeof sector === 'number' && sector === target) {\r\n\t\tif (ring === 'TRIPLE') { points = target * 3; state.turnHits.triples++ }\r\n\t\telse if (ring === 'DOUBLE') { points = target * 2; state.turnHits.doubles++ }\r\n\t\telse if (ring === 'SINGLE') { points = target * 1; state.turnHits.singles++ }\r\n\t} else if (!sector && (value === target || value === target*2 || value === target*3)) {\r\n\t\t// manual numeric entry fallback\r\n\t\tif (value === target*3) { points = target*3; state.turnHits.triples++ }\r\n\t\telse if (value === target*2) { points = target*2; state.turnHits.doubles++ }\r\n\t\telse if (value === target) { points = target; state.turnHits.singles++ }\r\n\t}\r\n\tstate.score += points\r\n\treturn points\r\n}\r\n\r\n// Call at end of 3-dart turn; advances round and checks Shanghai\r\nexport function endShanghaiTurn(state: ShanghaiState) {\r\n\tif (!state.finished) {\r\n\t\tif (state.turnHits.singles>0 && state.turnHits.doubles>0 && state.turnHits.triples>0) {\r\n\t\t\tstate.shanghaiAchieved = true\r\n\t\t\tstate.finished = true\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst next = (state.round + 1) as ShanghaiRound\r\n\t\tif (next > 20) { state.finished = true } else { state.round = next }\r\n\t}\r\n\t// reset per-turn hits\r\n\tstate.turnHits = { singles: 0, doubles: 0, triples: 0 }\r\n}\r\n","export type HalveItTarget =\r\n\t| { kind: 'ANY_NUMBER' }\r\n\t| { kind: 'DOUBLE'; num: number }\r\n\t| { kind: 'TRIPLE'; num: number }\r\n\t| { kind: 'BULL' }\r\n\t| { kind: 'NUMBER'; num: number }\r\n\r\nexport type HalveItState = {\r\n\tstage: number\r\n\ttargets: HalveItTarget[]\r\n\tscore: number\r\n\tfinished: boolean\r\n\thitThisRound: boolean\r\n}\r\n\r\nexport function createDefaultHalveIt(): HalveItState {\r\n\tconst targets: HalveItTarget[] = [\r\n\t\t{ kind: 'NUMBER', num: 20 },\r\n\t\t{ kind: 'DOUBLE', num: 16 },\r\n\t\t{ kind: 'TRIPLE', num: 14 },\r\n\t\t{ kind: 'NUMBER', num: 19 },\r\n\t\t{ kind: 'BULL' },\r\n\t\t{ kind: 'ANY_NUMBER' },\r\n\t]\r\n\treturn { stage: 0, targets, score: 0, finished: false, hitThisRound: false }\r\n}\r\n\r\nexport function getCurrentHalveTarget(state: HalveItState): HalveItTarget | null {\r\n\treturn state.targets[state.stage] || null\r\n}\r\n\r\nexport function applyHalveItDart(state: HalveItState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst t = getCurrentHalveTarget(state)\r\n\tif (!t) return 0\r\n\tlet scored = 0\r\n\tswitch (t.kind) {\r\n\t\tcase 'NUMBER': {\r\n\t\t\tif (typeof sector === 'number' && sector === t.num) {\r\n\t\t\t\tif (ring === 'TRIPLE') scored = t.num * 3\r\n\t\t\t\telse if (ring === 'DOUBLE') scored = t.num * 2\r\n\t\t\t\telse if (ring === 'SINGLE') scored = t.num\r\n\t\t\t} else if (!sector && (value === t.num || value === t.num*2 || value === t.num*3)) {\r\n\t\t\t\tscored = value\r\n\t\t\t}\r\n\t\t\tif (scored > 0) state.hitThisRound = true\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'DOUBLE': {\r\n\t\t\tif ((ring === 'DOUBLE' && sector === t.num) || value === t.num*2) { scored = t.num*2; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'TRIPLE': {\r\n\t\t\tif ((ring === 'TRIPLE' && sector === t.num) || value === t.num*3) { scored = t.num*3; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'BULL': {\r\n\t\t\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) { scored = (ring === 'INNER_BULL' || value === 50) ? 50 : 25; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'ANY_NUMBER': {\r\n\t\t\t// any valid score counts\r\n\t\t\tif (value > 0) { scored = value; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHalveItTurn(state: HalveItState) {\r\n\tif (state.finished) return\r\n\tif (!state.hitThisRound) {\r\n\t\tstate.score = Math.floor(state.score / 2)\r\n\t}\r\n\tstate.hitThisRound = false\r\n\tstate.stage += 1\r\n\tif (state.stage >= state.targets.length) state.finished = true\r\n}\r\n","export type HighLowState = {\r\n\tround: number\r\n\tscore: number\r\n\ttarget: 'HIGH' | 'LOW'\r\n\tfinished: boolean\r\n}\r\n\r\nexport function createHighLow(): HighLowState {\r\n\treturn { round: 1, score: 0, target: 'HIGH', finished: false }\r\n}\r\n\r\nexport function applyHighLowDart(state: HighLowState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\t// For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\r\n\t// When LOW, count only scores <= 10 (any ring) and bull does not count\r\n\tlet scored = 0\r\n\tif (state.target === 'HIGH') {\r\n\t\tif (ring === 'INNER_BULL') scored = 50\r\n\t\telse if (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector >= 20) scored = v\r\n\t\t} else {\r\n\t\t\t// manual numeric fallback\r\n\t\t\tif (value >= 40) scored = value\r\n\t\t}\r\n\t} else {\r\n\t\tif (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector <= 10) scored = v\r\n\t\t} else {\r\n\t\t\tif (value > 0 && value <= 30) scored = value\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHighLowTurn(state: HighLowState) {\r\n\tif (state.finished) return\r\n\tstate.round += 1\r\n\tif (state.round > 10) { state.finished = true; return }\r\n\tstate.target = state.target === 'HIGH' ? 'LOW' : 'HIGH'\r\n}\r\n","export type KillerState = {\r\n  number: number // assigned sector 1..20\r\n  lives: number // start with 3\r\n  isKiller: boolean // became killer by hitting own double\r\n  eliminated: boolean\r\n}\r\n\r\nexport function createKillerState(assigned: number, lives = 3): KillerState {\r\n  return { number: assigned, lives, isKiller: false, eliminated: false }\r\n}\r\n\r\n// Assign unique random numbers (1..20) to each player id\r\nexport function assignKillerNumbers<T extends string>(playerIds: T[]): Record<T, number> {\r\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1)\r\n  const res: any = {}\r\n  for (const id of playerIds) {\r\n    // pick a random remaining number\r\n    const idx = Math.floor(Math.random() * pool.length)\r\n    const num = pool.splice(idx, 1)[0]\r\n    res[id] = num\r\n  }\r\n  return res\r\n}\r\n\r\n// Apply a single dart in Killer context.\r\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\r\nexport function applyKillerDart(\r\n  selfId: string,\r\n  states: Record<string, KillerState>,\r\n  ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL',\r\n  sector?: number | null\r\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\r\n  const me = states[selfId]\r\n  if (!me || !sector || !ring) return { becameKiller: false }\r\n  // Becoming killer: hit your own DOUBLE only\r\n  if (!me.isKiller && ring === 'DOUBLE' && sector === me.number) {\r\n    me.isKiller = true\r\n    return { becameKiller: true }\r\n  }\r\n  // If already killer, hitting opponents' doubles/triples removes lives\r\n  if (me.isKiller && (ring === 'DOUBLE' || ring === 'TRIPLE')) {\r\n    const victimId = Object.keys(states).find(pid => pid !== selfId && !states[pid].eliminated && states[pid].number === sector)\r\n    if (victimId) {\r\n      const victim = states[victimId]\r\n      const delta = ring === 'TRIPLE' ? 2 : 1\r\n      victim.lives = Math.max(0, victim.lives - delta)\r\n      if (victim.lives === 0) victim.eliminated = true\r\n      return { becameKiller: false, victimId, livesRemoved: delta }\r\n    }\r\n  }\r\n  return { becameKiller: false }\r\n}\r\n\r\nexport function killerWinner(states: Record<string, KillerState>): string | null {\r\n  const alive = Object.entries(states).filter(([,st]) => !st.eliminated && st.lives > 0)\r\n  if (alive.length === 1) return alive[0][0]\r\n  return null\r\n}\r\n","export type AmCricketMark = 0 | 1 | 2 | 3\r\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25\r\n\r\nexport type AmCricketState = {\r\n  marks: Record<AmCricketNumber, AmCricketMark>\r\n  points: number\r\n}\r\n\r\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [20, 19, 18, 17, 16, 15, 14, 13, 12, 25]\r\n\r\nexport function createAmCricketState(): AmCricketState {\r\n  const marks: any = {}\r\n  AM_CRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n  return { marks, points: 0 }\r\n}\r\n\r\nexport function applyAmCricketDart(state: AmCricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: AmCricketNumber) => boolean = () => false): number {\r\n  let num: AmCricketNumber | null = null\r\n  let hits = 0\r\n  if (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n    num = 25\r\n    hits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n  } else if (typeof sector === 'number' && sector >= 12 && sector <= 20) {\r\n    num = sector as AmCricketNumber\r\n    if (ring === 'TRIPLE') hits = 3\r\n    else if (ring === 'DOUBLE') hits = 2\r\n    else hits = 1\r\n  } else if (value) {\r\n    for (const c of [20,19,18,17,16,15,14,13,12] as AmCricketNumber[]) {\r\n      if (value === c) { num = c; hits = 1; break }\r\n      if (value === c*2) { num = c; hits = 2; break }\r\n      if (value === c*3) { num = c; hits = 3; break }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n  }\r\n  if (!num) return 0\r\n\r\n  const before = state.marks[num]\r\n  const toClose = Math.max(0, 3 - before)\r\n  const toApply = Math.min(toClose, hits)\r\n  const overflow = Math.max(0, hits - toApply)\r\n  const after = (before + toApply) as AmCricketMark\r\n  state.marks[num] = after > 3 ? 3 : after\r\n\r\n  let points = 0\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      if (ring === 'INNER_BULL') points += 50 * overflow\r\n      else points += 25 * overflow\r\n    } else {\r\n      points += (num as number) * overflow\r\n    }\r\n  }\r\n  state.points += points\r\n  return points\r\n}\r\n\r\nexport function hasClosedAllAm(state: AmCricketState): boolean {\r\n  return AM_CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n","export type BaseballInning = 1|2|3|4|5|6|7|8|9\r\n\r\nexport type BaseballState = {\r\n  inning: BaseballInning\r\n  score: number\r\n  dartsThisInning: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createBaseball(): BaseballState {\r\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false }\r\n}\r\n\r\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\r\nexport function applyBaseballDart(state: BaseballState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): number {\r\n  if (state.finished) return 0\r\n  let runs = 0\r\n  if (typeof sector === 'number' && sector === state.inning) {\r\n    if (ring === 'TRIPLE') runs = 3\r\n    else if (ring === 'DOUBLE') runs = 2\r\n    else runs = 1\r\n  } else if (!sector && (value === state.inning || value === state.inning*2 || value === state.inning*3)) {\r\n    runs = value === state.inning*3 ? 3 : value === state.inning*2 ? 2 : 1\r\n  }\r\n  state.score += runs\r\n  state.dartsThisInning += 1\r\n  if (state.dartsThisInning >= 3) {\r\n    const next = (state.inning + 1) as BaseballInning\r\n    if (next > 9) state.finished = true\r\n    else { state.inning = next; state.dartsThisInning = 0 }\r\n  }\r\n  return runs\r\n}\r\n","export type GolfHole = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18\r\n\r\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\r\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\r\n\r\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\r\n  1: 5, 2: 20, 3: 1, 4: 18, 5: 4, 6: 13, 7: 6, 8: 10, 9: 15,\r\n  10: 2, 11: 17, 12: 3, 13: 19, 14: 7, 15: 16, 16: 8, 17: 11, 18: 14,\r\n}\r\n\r\nexport type GolfState = {\r\n  hole: GolfHole\r\n  strokes: number\r\n  dartsThisHole: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createGolf(): GolfState {\r\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false }\r\n}\r\n\r\nexport function applyGolfDart(state: GolfState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): boolean {\r\n  if (state.finished) return false\r\n  const target = GOLF_TARGETS[state.hole]\r\n  state.dartsThisHole += 1\r\n  const hit = (typeof sector === 'number' && sector === target && (ring==='SINGLE'||ring==='DOUBLE'||ring==='TRIPLE')) || (!sector && (value===target || value===target*2 || value===target*3))\r\n  if (hit) {\r\n    state.strokes += state.dartsThisHole\r\n    // advance to next hole\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n    return true\r\n  }\r\n  // If not finished and took 3 darts, score 3 and advance hole\r\n  if (state.dartsThisHole >= 3) {\r\n    state.strokes += 3\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n  }\r\n  return false\r\n}\r\n","export type TicCell = 0|1|2|3|4|5|6|7|8\r\n\r\n// Map grid cells to targets: center uses Bull; edges/corners use numbers.\r\nexport const TTT_TARGETS: Record<TicCell, { type: 'NUM'|'BULL'; num?: number }> = {\r\n  0: { type: 'NUM', num: 20 }, 1: { type: 'NUM', num: 19 }, 2: { type: 'NUM', num: 18 },\r\n  3: { type: 'NUM', num: 17 }, 4: { type: 'BULL' }, 5: { type: 'NUM', num: 16 },\r\n  6: { type: 'NUM', num: 15 }, 7: { type: 'NUM', num: 14 }, 8: { type: 'NUM', num: 13 },\r\n}\r\n\r\nexport type TicTacToeState = {\r\n  board: Array<'X'|'O'|null>\r\n  turn: 'X'|'O'\r\n  finished: boolean\r\n  winner: 'X'|'O'|'Draw'|null\r\n}\r\n\r\nexport function createTicTacToe(): TicTacToeState {\r\n  return { board: Array(9).fill(null), turn: 'X', finished: false, winner: null }\r\n}\r\n\r\nfunction checkWin(board: Array<'X'|'O'|null>): 'X'|'O'|'Draw'|null {\r\n  const lines = [ [0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6] ]\r\n  for (const [a,b,c] of lines) { if (board[a] && board[a]===board[b] && board[a]===board[c]) return board[a] as 'X'|'O' }\r\n  if (board.every(c => c)) return 'Draw'\r\n  return null\r\n}\r\n\r\nexport function tryClaimCell(state: TicTacToeState, cell: TicCell, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): boolean {\r\n  if (state.finished || state.board[cell]) return false\r\n  const tgt = TTT_TARGETS[cell]\r\n  let ok = false\r\n  if (tgt.type === 'BULL') ok = (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50)\r\n  else if (tgt.type === 'NUM' && typeof tgt.num === 'number') {\r\n    if (typeof sector === 'number' && sector === tgt.num) ok = true\r\n    else if (!sector && (value===tgt.num || value===tgt.num*2 || value===tgt.num*3)) ok = true\r\n  }\r\n  if (!ok) return false\r\n  state.board[cell] = state.turn\r\n  const w = checkWin(state.board)\r\n  if (w) { state.finished = true; state.winner = w; return true }\r\n  state.turn = state.turn === 'X' ? 'O' : 'X'\r\n  return true\r\n}\r\n","/**\r\n * Universal Game Scoreboard Component\r\n * Displays game-specific stats based on the game mode and current game state\r\n * Works for Online, Offline, and Tournament modes\r\n */\r\n\r\nimport React from 'react';\r\n\r\nexport type GameMode = 'X01' | 'Cricket' | 'Shanghai' | 'Killer' | 'High-Low' | 'Halve It' | \r\n                       'Around the Clock' | 'Double Practice' | 'Treble Practice' | \r\n                       'Count-Up' | 'High Score' | 'Low Score' | 'Checkout 170' | 'Checkout 121' |\r\n                       'American Cricket' | 'Baseball' | 'Golf' | 'Tic Tac Toe' | \"Bob's 27\" |\r\n                       'Scam' | 'Fives' | 'Sevens';\r\n\r\nexport interface PlayerStats {\r\n  name: string;\r\n  isCurrentTurn: boolean;\r\n  legsWon?: number;\r\n  score?: number;\r\n  lastScore?: number;\r\n  checkoutRate?: number; // 0-100\r\n  bestLeg?: number | string;\r\n  // Cricket-specific\r\n  closed?: Record<number, number>; // { 20: 3, 19: 2, etc }\r\n  points?: number;\r\n  // Shanghai-specific\r\n  round?: number;\r\n  target?: number;\r\n  // Killer-specific\r\n  number?: number;\r\n  lives?: number;\r\n  eliminated?: boolean;\r\n  // Match statistics\r\n  matchAvg?: number; // Current match 3-dart average\r\n  allTimeAvg?: number; // Player's all-time 3-dart average\r\n  // Other generics\r\n  [key: string]: any;\r\n}\r\n\r\ninterface GameScoreboardProps {\r\n  gameMode: GameMode;\r\n  players: PlayerStats[];\r\n  matchScore?: string; // e.g., \"3-1\"\r\n  gameRules?: any; // Additional rules/config for the game\r\n}\r\n\r\nexport default function GameScoreboard({ gameMode, players, matchScore, gameRules }: GameScoreboardProps) {\r\n  if (!players || players.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3\">\r\n      {players.map((player, idx) => (\r\n        <div\r\n          key={idx}\r\n          className={`rounded-lg border p-3 ${\r\n            player.isCurrentTurn\r\n              ? 'border-emerald-500/40 bg-emerald-500/10'\r\n              : 'border-slate-500/40 bg-slate-500/10'\r\n          }`}\r\n        >\r\n          <div className={`text-sm font-semibold mb-2 uppercase tracking-wide ${\r\n            player.isCurrentTurn ? 'text-emerald-300' : 'text-slate-300'\r\n          }`}>\r\n            {player.name}\r\n          </div>\r\n\r\n          <div className=\"space-y-1 text-sm\">\r\n            {/* X01 specific */}\r\n            {gameMode === 'X01' && (\r\n              <>\r\n                <ScoreRow label=\"Legs Won\" value={`â— ${player.legsWon || 0}`} highlight />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n                <ScoreRow label=\"Last Score\" value={player.lastScore || '0'} mono />\r\n                <ScoreRow label=\"C/Out Rate\" value={`${player.checkoutRate || 0}%`} mono />\r\n                <ScoreRow label=\"Best Leg\" value={player.bestLeg || 'â€”'} mono />\r\n                {/* AVG +/- feature */}\r\n                {player.matchAvg !== undefined && player.allTimeAvg !== undefined && (\r\n                  <>\r\n                    <div className=\"border-t border-white/20 pt-1 mt-1\">\r\n                      <ScoreRow label=\"Match Avg\" value={player.matchAvg.toFixed(2)} mono bold highlight={player.matchAvg > 0} />\r\n                      <AvgDifferenceRow matchAvg={player.matchAvg} allTimeAvg={player.allTimeAvg} />\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Cricket & American Cricket specific */}\r\n            {(gameMode === 'Cricket' || gameMode === 'American Cricket') && (\r\n              <>\r\n                <ScoreRow label=\"Closed\" value={formatCricketClosed(player.closed)} mono />\r\n                <ScoreRow label=\"Points\" value={player.points || 0} mono bold />\r\n                <ScoreRow label=\"Status\" value={getCricketStatus(player)} highlight={player.isCurrentTurn} />\r\n              </>\r\n            )}\r\n\r\n            {/* Shanghai & Halve It - Round-based */}\r\n            {(gameMode === 'Shanghai' || gameMode === 'Halve It') && (\r\n              <>\r\n                <ScoreRow label={gameMode === 'Shanghai' ? 'Round' : 'Stage'} value={player.round || 1} mono />\r\n                <ScoreRow label=\"Target\" value={player.target || 'â€”'} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Killer specific */}\r\n            {gameMode === 'Killer' && (\r\n              <>\r\n                <ScoreRow label=\"Target #\" value={player.number || 'â€”'} mono bold />\r\n                <ScoreRow label=\"Lives\" value={player.lives || 0} mono bold />\r\n                {player.eliminated && (\r\n                  <ScoreRow label=\"Status\" value=\"ELIMINATED\" highlight={false} />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* High-Low specific */}\r\n            {gameMode === 'High-Low' && (\r\n              <>\r\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\r\n                <ScoreRow label=\"Target\" value={player.target || 'High'} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Practice games */}\r\n            {(gameMode === 'Double Practice' || gameMode === 'Treble Practice' || gameMode === 'Around the Clock') && (\r\n              <>\r\n                <ScoreRow label=\"Target\" value={player.target || 'â€”'} mono bold />\r\n                <ScoreRow label=\"Hits\" value={player.hits || 0} mono bold />\r\n                {player.totalNeeded && (\r\n                  <ScoreRow label=\"Progress\" value={`${player.hits || 0} / ${player.totalNeeded}`} mono />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Count-Up, High Score, Low Score */}\r\n            {(gameMode === 'Count-Up' || gameMode === 'High Score' || gameMode === 'Low Score') && (\r\n              <>\r\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n                {gameMode === 'High Score' && (\r\n                  <ScoreRow label=\"Best\" value={player.bestScore || 0} mono />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Checkout challenges */}\r\n            {(gameMode === 'Checkout 170' || gameMode === 'Checkout 121') && (\r\n              <>\r\n                <ScoreRow label=\"Remaining\" value={player.remaining || 0} mono bold />\r\n                <ScoreRow label=\"Attempts\" value={player.attempts || 0} mono />\r\n                <ScoreRow label=\"Successes\" value={player.successes || 0} mono />\r\n              </>\r\n            )}\r\n\r\n            {/* Bob's 27 */}\r\n            {gameMode === \"Bob's 27\" && (\r\n              <>\r\n                <ScoreRow label=\"Target\" value={`D${player.target || 1}`} mono bold />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Baseball & Golf */}\r\n            {gameMode === 'Baseball' && (\r\n              <>\r\n                <ScoreRow label=\"Inning\" value={player.inning || 1} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {gameMode === 'Golf' && (\r\n              <>\r\n                <ScoreRow label=\"Hole\" value={player.hole || 1} mono />\r\n                <ScoreRow label=\"Strokes\" value={player.strokes || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Tic Tac Toe */}\r\n            {gameMode === 'Tic Tac Toe' && (\r\n              <>\r\n                <ScoreRow label=\"Turn\" value={player.turn || 1} mono />\r\n                {player.winner && (\r\n                  <ScoreRow label=\"Result\" value=\"WINNER!\" highlight />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Match score display for competitive games */}\r\n            {matchScore && (gameMode === 'X01' || gameMode === 'Cricket' || gameMode === 'American Cricket') && idx === 1 && (\r\n              <div className=\"border-t border-white/10 pt-1 mt-1\">\r\n                <ScoreRow label=\"Match\" value={matchScore} mono bold highlight />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Helper component for consistent score row display\r\nfunction ScoreRow({ \r\n  label, \r\n  value, \r\n  mono = false, \r\n  bold = false, \r\n  highlight = false \r\n}: { \r\n  label: string; \r\n  value: string | number; \r\n  mono?: boolean;\r\n  bold?: boolean;\r\n  highlight?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"flex justify-between\">\r\n      <span className=\"opacity-70\">{label}:</span>\r\n      <span className={`${mono ? 'font-mono' : ''} ${bold ? 'font-semibold' : ''} ${\r\n        highlight ? 'text-emerald-300' : ''\r\n      }`}>\r\n        {value}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// AVG +/- component showing difference from all-time average\r\nfunction AvgDifferenceRow({ matchAvg, allTimeAvg }: { matchAvg: number; allTimeAvg: number }) {\r\n  const diff = matchAvg - allTimeAvg;\r\n  const isPositive = diff > 0;\r\n  const isNeutral = Math.abs(diff) < 0.01;\r\n  \r\n  let diffText = '';\r\n  let diffColor = 'text-slate-300';\r\n  \r\n  if (isNeutral) {\r\n    diffText = '= All-time';\r\n    diffColor = 'text-slate-300';\r\n  } else if (isPositive) {\r\n    diffText = `+${diff.toFixed(2)} vs avg`;\r\n    diffColor = 'text-emerald-400';\r\n  } else {\r\n    diffText = `${diff.toFixed(2)} vs avg`;\r\n    diffColor = 'text-orange-400';\r\n  }\r\n  \r\n  return (\r\n    <div className=\"flex justify-between\">\r\n      <span className=\"opacity-70\">AVG vs Avg:</span>\r\n      <span className={`font-mono font-semibold ${diffColor}`}>\r\n        {diffText}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Cricket helpers\r\nfunction formatCricketClosed(closed?: Record<number, number>): string {\r\n  if (!closed || Object.keys(closed).length === 0) return 'â€”';\r\n  const closedNumbers = Object.entries(closed)\r\n    .filter(([_, count]) => count === 3)\r\n    .map(([num]) => num === '25' ? 'B' : num)\r\n    .join(',');\r\n  return closedNumbers || 'â€”';\r\n}\r\n\r\nfunction getCricketStatus(player: PlayerStats): string {\r\n  if (!player.closed) return 'Starting';\r\n  const closedCount = Object.values(player.closed).filter(c => c === 3).length;\r\n  if (closedCount === 0) return 'No marks';\r\n  if (closedCount < 7) return `${closedCount}/7`;\r\n  return 'Closing in';\r\n}\r\n","/**\r\n * Hook to convert OfflinePlay game state to GameScoreboard format\r\n */\r\n\r\nimport { useMemo } from 'react';\r\nimport type { PlayerStats } from './GameScoreboard';\r\nimport type { GameMode } from './GameScoreboard';\r\nimport { getAllTimeAvg } from '../../store/profileStats';\r\n\r\nexport function useOfflineGameStats(\r\n  gameMode: GameMode,\r\n  // X01 state\r\n  playerScore?: number,\r\n  aiScore?: number,\r\n  playerLegs?: number,\r\n  aiLegs?: number,\r\n  playerLastDart?: number,\r\n  aiLastDart?: number,\r\n  playerVisitSum?: number,\r\n  aiVisitSum?: number,\r\n  playerLastVisitScore?: number | null,\r\n  aiLastVisitScore?: number | null,\r\n  playerVisitDartCount?: number,\r\n  aiVisitDartCount?: number,\r\n  playerDoublesHit?: number,\r\n  playerDoublesAtt?: number,\r\n  aiDoublesHit?: number,\r\n  aiDoublesAtt?: number,\r\n  legStats?: Array<any>,\r\n  isPlayerTurn?: boolean,\r\n  ai?: string,\r\n  x01Score?: number,\r\n  // Cricket state\r\n  cricket?: any,\r\n  // Shanghai state\r\n  shanghai?: any,\r\n  // Killer state\r\n  killerPlayers?: Array<any>,\r\n  killerStates?: Record<string, any>,\r\n  killerAssigned?: Record<string, number>,\r\n  killerTurnIdx?: number\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (gameMode === 'X01') {\r\n      // Calculate player match average\r\n      let playerMatchAvg = 0;\r\n      let playerDarts = 0;\r\n      let playerScored = 0;\r\n      if (legStats && legStats.length > 0) {\r\n        for (const leg of legStats) {\r\n          if (leg.dartsThrown && leg.totalScored) {\r\n            playerDarts += leg.dartsThrown;\r\n            playerScored += leg.totalScored;\r\n          }\r\n        }\r\n        if (playerDarts > 0) {\r\n          playerMatchAvg = (playerScored / playerDarts) * 3;\r\n        }\r\n      }\r\n\r\n      // Player card\r\n      const playerVisitDarts = playerVisitDartCount ?? 0\r\n      const playerCurrentVisitActive = playerVisitDarts > 0\r\n      const playerCurrentVisitSum = playerVisitSum ?? 0\r\n      const playerLastVisitTotal = playerLastVisitScore ?? null\r\n      const playerLastDartValue = playerLastDart ?? 0\r\n      const resolvedPlayerLastScore = playerCurrentVisitActive\r\n        ? playerCurrentVisitSum\r\n        : (playerLastVisitTotal ?? playerLastDartValue)\r\n\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        legsWon: playerLegs || 0,\r\n        score: playerScore || 0,\r\n        lastScore: resolvedPlayerLastScore,\r\n        checkoutRate: playerDoublesAtt && playerDoublesAtt > 0 \r\n          ? Math.round((playerDoublesHit || 0) / playerDoublesAtt * 100)\r\n          : 0,\r\n        bestLeg: legStats && legStats.length > 0 \r\n          ? `${Math.min(...legStats.map(l => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\r\n          : 'â€”',\r\n        matchAvg: playerMatchAvg,\r\n        allTimeAvg: getAllTimeAvg('You') || 0\r\n      });\r\n\r\n      // AI card (if playing against AI)\r\n      if (ai && ai !== 'None') {\r\n        const aiVisitDarts = aiVisitDartCount ?? 0\r\n        const aiCurrentVisitActive = aiVisitDarts > 0\r\n        const aiCurrentVisitSum = aiVisitSum ?? 0\r\n        const aiLastVisitTotal = aiLastVisitScore ?? null\r\n        const aiLastDartValue = aiLastDart ?? 0\r\n        const resolvedAiLastScore = aiCurrentVisitActive\r\n          ? aiCurrentVisitSum\r\n          : (aiLastVisitTotal ?? aiLastDartValue)\r\n\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          legsWon: aiLegs || 0,\r\n          score: aiScore || 0,\r\n          lastScore: resolvedAiLastScore,\r\n          checkoutRate: aiDoublesAtt && aiDoublesAtt > 0 \r\n            ? Math.round((aiDoublesHit || 0) / aiDoublesAtt * 100)\r\n            : 0,\r\n          bestLeg: 'â€”'\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Cricket') {\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        closed: cricket?.marks || {},\r\n        points: cricket?.points || 0\r\n      });\r\n\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          closed: {},\r\n          points: 0\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Shanghai') {\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        round: shanghai?.round || 1,\r\n        target: shanghai?.target || 1,\r\n        score: shanghai?.score || 0\r\n      });\r\n\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          round: shanghai?.round || 1,\r\n          target: shanghai?.target || 1,\r\n          score: 0\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Killer' && killerPlayers && killerPlayers.length > 0) {\r\n      killerPlayers.forEach((p, idx) => {\r\n        const state = killerStates?.[p.id];\r\n        players.push({\r\n          name: p.name,\r\n          isCurrentTurn: idx === killerTurnIdx,\r\n          number: killerAssigned?.[p.id],\r\n          lives: state?.lives || 0,\r\n          eliminated: state?.eliminated || false\r\n        });\r\n      });\r\n    }\r\n\r\n    return players;\r\n  }, [\r\n    gameMode,\r\n    playerScore, aiScore,\r\n    playerLegs, aiLegs,\r\n    playerLastDart, aiLastDart,\r\n  playerVisitSum, aiVisitSum,\r\n  playerLastVisitScore, aiLastVisitScore,\r\n  playerVisitDartCount, aiVisitDartCount,\r\n    playerDoublesHit, playerDoublesAtt,\r\n    aiDoublesHit, aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn, ai,\r\n    cricket,\r\n    shanghai,\r\n    killerPlayers, killerStates, killerAssigned, killerTurnIdx\r\n  ]);\r\n}\r\n\r\nexport function useOnlineGameStats(\r\n  gameMode: GameMode,\r\n  matchState?: any, // From useMatch() store\r\n  participants?: string[]\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (!matchState || !matchState.players || matchState.players.length === 0) {\r\n      return players;\r\n    }\r\n\r\n    matchState.players.forEach((player: any, idx: number) => {\r\n      const isCurrentTurn = idx === matchState.currentPlayerIdx;\r\n      \r\n      if (gameMode === 'X01') {\r\n        // Calculate match average for this player\r\n        let matchAvg = 0;\r\n        let totalDarts = 0;\r\n        let totalScored = 0;\r\n\r\n        if (player.legs && player.legs.length > 0) {\r\n          for (const leg of player.legs) {\r\n            if (leg.finished) {\r\n              const legDarts = leg.dartsThrown || 0;\r\n              const legScored = Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining) || 0;\r\n              totalDarts += legDarts;\r\n              totalScored += legScored;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (totalDarts > 0) {\r\n          matchAvg = (totalScored / totalDarts) * 3;\r\n        }\r\n\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          legsWon: player.legsWon || 0,\r\n          score: player.score || 0,\r\n          lastScore: player.lastVisitScore || 0,\r\n          checkoutRate: player.doublesAttempted > 0 \r\n            ? Math.round((player.doublesHit / player.doublesAttempted) * 100)\r\n            : 0,\r\n          bestLeg: player.bestLegDarts ? `${player.bestLegDarts} darts` : 'â€”',\r\n          matchAvg: matchAvg,\r\n          allTimeAvg: player.name ? getAllTimeAvg(player.name) : 0\r\n        });\r\n      }\r\n\r\n      if (gameMode === 'Cricket') {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          closed: player.cricket?.marks || {},\r\n          points: player.cricket?.points || 0\r\n        });\r\n      }\r\n\r\n      if (gameMode === 'Killer') {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          number: player.killerNumber || null,\r\n          lives: player.killerLives || 3,\r\n          eliminated: player.killerEliminated || false\r\n        });\r\n      }\r\n    });\r\n\r\n    return players;\r\n  }, [gameMode, matchState, participants]);\r\n}\r\n"],"names":["CameraTile","label","autoStart","scaleOverride","className","aspect","style","fill","videoRef","useRef","cameraSession","useCameraSession","streaming","setStreaming","useState","ws","setWs","pairCode","setPairCode","pc","setPc","lastRegisteredModeRef","registerStream","useCallback","stream","modeOverride","err","preferredCameraLabel","useUserSettings","s","mode","setMode","saved","expiresAt","setExpiresAt","now","setNow","paired","setPaired","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","cameraEnabledSetting","setPreferredCameraLocked","setPreferredCamera","preferredCameraId","fallbackClass","fallbackStyle","jsx","useEffect","h","apiFetch","r","j","ip","x","mobileUrl","useMemo","code","envUrl","u","host","useHttps","port","ignore","manualModeSetAt","qrDataUrl","setQrDataUrl","setManualModeSetAt","logoPath","__vite_import_meta_env__","makeQrDataUrlWithLogo","t","ttl","cancelled","desiredLabel","timer","start","stop","apply","v","startWifiConnection","startPhonePairing","constraints","name","devices","discoverNetworkDevices","error","connectToWifiDevice","device","d","connectToNetworkDevice","startUsbConnection","discoverUSBDevices","newDevice","requestUSBDevice","prev","onStart","ev","modeFromEvent","handleModeSelect","connectToUsbDevice","connectToUSBDevice","newMode","ensureWS","normalizedEnv","proto","sameOrigin","isLocalhost","isRenderHost","renderWS","url","socket","data","peer","e","inbound","offer","regenerateCode","stopAll","CameraFrame","props","cameraScale","storedAspect","onModeSelect","modeDisplayName","reconnectOptions","copyFeedback","setCopyFeedback","copyTimeoutRef","globalFitMode","effectiveFitMode","scale","raw","clamped","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","usbActive","videoElement","baseVideoClass","copyValue","value","type","textarea","jsxs","Fragment","option","isActive","doubles","dVal","tag","prefsDoubleScore","fav","suggestCheckouts","remaining","favoriteDouble","hardcoded","target","routes","sayScore","scored","voiceName","opts","synth","msg","isCheckout","isOneEighty","GameCalibrationStatus","gameMode","compact","onRecalibrate","H","errorPx","useCalibration","confidence","getCalibrationConfidenceForGame","suitable","isCalibrationSuitableForGame","quality","text","getCalibrationQualityText","recommendation","getRecalibrationRecommendation","requirement","GAME_CALIBRATION_REQUIREMENTS","AlertTriangle","bgColor","textColor","icon","CheckCircle","React","AlertCircle","Zap","GameHeaderBar","left","right","sticky","DOUBLE_PRACTICE_ORDER","_","i","isDoubleHit","targetIdx","parseManualDart","input","m","mult","num","ATC_ORDER","CRICKET_NUMBERS","createCricketState","marks","applyCricketDart","state","ring","sector","opponentClosed","hits","cand","c","before","remainToClose","toApply","overflow","after","points","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","endShanghaiTurn","next","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","endHalveItTurn","createHighLow","applyHighLowDart","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","res","id","idx","applyKillerDart","selfId","states","me","victimId","pid","victim","delta","killerWinner","alive","st","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","TTT_TARGETS","createTicTacToe","checkWin","board","lines","a","b","tryClaimCell","cell","tgt","ok","w","GameScoreboard","players","matchScore","gameRules","player","ScoreRow","AvgDifferenceRow","formatCricketClosed","getCricketStatus","mono","bold","highlight","matchAvg","allTimeAvg","diff","isPositive","isNeutral","diffText","diffColor","closed","count","closedCount","useOfflineGameStats","playerScore","aiScore","playerLegs","aiLegs","playerLastDart","aiLastDart","playerVisitSum","aiVisitSum","playerLastVisitScore","aiLastVisitScore","playerVisitDartCount","aiVisitDartCount","playerDoublesHit","playerDoublesAtt","aiDoublesHit","aiDoublesAtt","legStats","isPlayerTurn","ai","x01Score","cricket","shanghai","killerPlayers","killerStates","killerAssigned","killerTurnIdx","playerMatchAvg","playerDarts","playerScored","leg","resolvedPlayerLastScore","l","getAllTimeAvg","resolvedAiLastScore","p","useOnlineGameStats","matchState","participants","isCurrentTurn","totalDarts","totalScored","legDarts","legScored"],"mappings":"gQA0CA,SAAwBA,GAAW,CACjC,MAAAC,EACA,UAAAC,EACA,MAAOC,EACP,UAAAC,EACA,OAAAC,EAAS,UACT,MAAAC,EACA,KAAAC,EAAO,EACT,EAAoB,CAClB,MAAMC,EAAWC,EAAAA,OAAyB,IAAI,EACxCC,EAAgBC,GAAA,EAChB,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAS,EAAK,EAC1C,CAACC,EAAIC,CAAK,EAAIF,EAAAA,SAA2B,IAAI,EAC7C,CAACG,EAAUC,CAAW,EAAIJ,EAAAA,SAAwB,IAAI,EACtD,CAACK,EAAIC,CAAK,EAAIN,EAAAA,SAAmC,IAAI,EACrDO,EAAwBZ,EAAAA,OAAgC,IAAI,EAC5Da,EAAiBC,EAAAA,YAAY,CAACC,EAA4BC,EAAiC,UAAY,CAC3G,GAAI,CACED,GACFd,EAAc,eAAec,CAAM,EAC/BhB,EAAS,SACXE,EAAc,mBAAmBF,EAAS,OAAO,EAEnDE,EAAc,QAAQe,CAAY,EAClCf,EAAc,aAAa,EAAI,EAC/BW,EAAsB,QAAUI,GACvBJ,EAAsB,SAAWA,EAAsB,UAAY,UAC5EX,EAAc,aAAa,EAAK,EAChCA,EAAc,eAAe,IAAI,EACjCW,EAAsB,QAAU,KAEpC,OAASK,EAAK,CACZ,QAAQ,KAAK,8DAA+DA,CAAG,CACjF,CACF,EAAG,CAAChB,CAAa,CAAC,EAGZiB,EAAuBC,EAAgBC,GAAKA,EAAE,oBAAoB,EAClE,CAACC,EAAMC,CAAO,EAAIjB,EAAAA,SAAiC,IAAM,CAE7D,GAAIa,IAAyB,eAC3B,eAAQ,IAAI,2EAA2E,EAChF,QAGT,MAAMK,EAAQ,aAAa,QAAQ,iBAAiB,EACpD,eAAQ,IAAI,oCAAqCA,GAAS,QAAS,qBAAqB,EACjFA,GAAS,OAClB,CAAC,EAEK,CAACC,EAAWC,CAAY,EAAIpB,EAAAA,SAAwB,IAAI,EACxD,CAACqB,EAAKC,CAAM,EAAItB,EAAAA,SAAiB,KAAK,KAAK,EAC3C,CAACuB,EAAQC,CAAS,EAAIxB,EAAAA,SAAkB,EAAK,EAC7C,CAACyB,EAASC,CAAU,EAAI1B,EAAAA,SAAwB,IAAI,EACpD,CAAC2B,EAAWC,EAAY,EAAI5B,EAAAA,SAAkD,IAAI,EAClF,CAAC6B,EAAUC,EAAW,EAAI9B,EAAAA,SAAkB,EAAI,EAChD,CAAC+B,GAAaC,CAAc,EAAIhC,EAAAA,SAA0B,CAAA,CAAE,EAC5D,CAACiC,EAAiBC,CAAkB,EAAIlC,EAAAA,SAAkB,EAAK,EAC/D,CAACmC,GAAYC,CAAa,EAAIpC,EAAAA,SAAsB,CAAA,CAAE,EACtD,CAACqC,GAAgBC,CAAiB,EAAItC,EAAAA,SAAkB,EAAK,EAC7DuC,EAAoBzB,EAAgBC,GAAKA,EAAE,iBAAiB,EAC5DyB,GAAuB1B,EAAgBC,GAAKA,EAAE,aAAa,EAC3D0B,GAA2B3B,EAAgBC,GAAKA,EAAE,wBAAwB,EAClDD,EAAgBC,GAAKA,EAAE,qBAAqB,EAC1E,MAAM2B,GAAqB5B,EAAgBC,GAAKA,EAAE,kBAAkB,EAC9D4B,GAAoB7B,EAAgBC,GAAKA,EAAE,iBAAiB,EAElE,GAAIwB,IAAsB,SAAU,CAElC,MAAMK,EAAgB,CADDnD,EAAO,4DAA8D,sDACrDH,CAAS,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,EAAE,KAAA,EACpEuD,EAA+B,CAAE,GAAIrD,GAAS,EAAC,EACrD,MAAI,CAACC,GAAQoD,EAAc,cAAgB,QAAaA,EAAc,SAAW,QAAaA,EAAc,YAAc,SACxHA,EAAc,YAAc,eAG3B,MAAA,CAAI,UAAWD,EAAe,MAAOC,EACpC,SAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,4GAA4G,SAAA,yDAAA,CAE3H,EACF,CAEJ,CACAC,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAI,OAAO,SAAS,UACtBA,IAAM,aAAeA,IAAM,cAC7BC,GAAS,YAAY,EAAE,KAAKC,GAAKA,EAAE,KAAA,CAAM,EAAE,KAAKC,GAAK,CACnD,MAAMC,EAAK,MAAM,QAAQD,GAAG,KAAK,GAAKA,EAAE,MAAM,KAAME,GAAcA,CAAC,EAC/DD,KAAeA,CAAE,CACvB,CAAC,EAAE,MAAM,IAAI,CAAC,CAAC,EAGjBH,GAAS,iBAAiB,EAAE,KAAKC,GAAGA,EAAE,KAAA,CAAM,EAAE,KAAKC,GAAG,CAChDA,GAAK,OAAOA,EAAE,OAAU,WAAWvB,GAAa,CAAE,MAAO,CAAC,CAACuB,EAAE,MAAO,KAAM,OAAOA,EAAE,IAAI,GAAG,KAAM,CACtG,CAAC,EAAE,MAAM,IAAI,CAAC,CAAC,CACjB,EAAG,CAAA,CAAE,EACL,MAAMG,GAAYC,EAAAA,QAAQ,IAAM,CAC9B,MAAMC,EAAOrD,GAAY,OAEnBsD,EAAU,sBAChB,GAAcA,EAAO,OAAS,EAC5B,GAAI,CAEF,MAAMC,EAAI,IAAI,IAAID,CAAM,EAIxB,MAAO,GAFQ,GADEC,EAAE,WAAa,OACH,QAAU,MAAM,MAAMA,EAAE,IAAI,GAAGA,EAAE,SAAS,SAAS,KAAK,EAAI,GAAKA,EAAE,QAAQ,GACpF,QAAQ,UAAW,EAAE,CAC3B,yBAAyBF,CAAI,EAC7C,MAAQ,CAAC,CAGX,MAAMG,EAAQlC,GAAW,OAAO,SAAS,SACnCmC,EAAW,CAAC,CAACjC,GAAW,MACxBkC,EAAOD,EAAYjC,GAAW,MAAQ,KAAQ,KAEpD,MAAO,GADOiC,EAAW,QAAU,MACpB,MAAMD,CAAI,IAAIE,CAAI,yBAAyBL,CAAI,EAChE,EAAG,CAACrD,EAAUsB,EAASE,CAAS,CAAC,EACjCoB,EAAAA,UAAU,IAAM,CACd,QAAQ,IAAI,gCAAiC/B,EAAM,8BAA8B,EACjF,aAAa,QAAQ,kBAAmBA,CAAI,CAC9C,EAAG,CAACA,CAAI,CAAC,EAKT+B,EAAAA,UAAU,IAAM,CACd,MAAMe,EAAShD,EAAgB,SAAA,EAAW,0BAC1C,QAAQ,IAAI,qEAAsED,EAAsB,QAASG,EAAM,cAAe8C,EAAQ,mBAAoBC,CAAe,EAC7K,CAAAD,IAEAC,GAAmB,KAAK,IAAA,EAAQA,EAAkB,KAClDlD,IAAyB,gBAAkBG,IAAS,UACtD,QAAQ,IAAI,8DAA8D,EAC1EC,EAAQ,OAAO,GAEnB,EAAG,CAACJ,EAAsBG,EAAM+C,CAAe,CAAC,EAEhD,KAAM,CAACC,GAAWC,EAAY,EAAIjE,EAAAA,SAAiB,EAAE,EAC/C,CAAC+D,EAAiBG,EAAkB,EAAIlE,EAAAA,SAAwB,IAAI,EAC1E+C,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC5C,EAAU,CAAE8D,GAAa,EAAE,EAAG,MAAO,CAC1C,MAAME,EAAYC,IAAyB,kBAAoB,oBAC/DC,GAAsBf,GAAW,CAC/B,MAAO,IACP,OAAQ,EACR,qBAAsB,IACtB,MAAO,CAAE,KAAM,UAAW,MAAO,SAAA,EACjC,KAAM,CAAE,QAASa,EAAU,UAAW,GAAK,KAAM,GAAM,MAAO,QAAA,CAAS,CACxE,EAAE,KAAKF,EAAY,EAAE,MAAM,IAAMA,GAAa,EAAE,CAAC,CACpD,EAAG,CAACX,GAAWnD,CAAQ,CAAC,EACxB4C,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC5B,EAAW,OAChB,MAAMmD,EAAI,YAAY,IAAMhD,EAAO,KAAK,IAAA,CAAK,EAAG,GAAI,EACpD,MAAO,IAAM,cAAcgD,CAAC,CAC9B,EAAG,CAACnD,CAAS,CAAC,EACd,MAAMoD,EAAMhB,EAAAA,QAAQ,IAAMpC,EAAY,KAAK,IAAI,EAAG,KAAK,MAAMA,EAAYE,GAAK,GAAI,CAAC,EAAI,KAAM,CAACF,EAAWE,CAAG,CAAC,EAK7G0B,EAAAA,UAAU,IAAM,CACd,GAAI,GAACP,IAAwBD,IAAsB,WAC/CnD,IAAc,OAClB,IAAIA,EAAW,CACb,IAAIoF,EAAY,GAChB,MAAMC,EAAe5D,GAAwB,UACvC6D,EAAQ,OAAO,WAAW,IAAM,CAChCF,GAAa1E,GACjB6E,IAAQ,MAAM/D,GAAO,QAAQ,KAAK,sCAAsC6D,CAAY,IAAK7D,CAAG,CAAC,CAC/F,EAAG,GAAG,EACN,MAAO,IAAM,CACX4D,EAAY,GACZ,OAAO,aAAaE,CAAK,CAC3B,CACF,CACAE,EAAA,EACF,EAAG,CAACxF,EAAWU,EAAW0C,GAAsBD,EAAmB1B,EAAsB8D,EAAOC,CAAI,CAAC,EAGrG7B,EAAAA,UAAU,IAAM,CACd,MAAM8B,EAAQ,SAAY,CACxB,GAAI,CAEF,GAAI,EADsBhE,IAAyB,iBAAmB,CAACkD,GAAmB,KAAK,IAAA,EAAQA,GAAmB,MAAY/C,IAAS,SACxH,OACvB,MAAMD,EAAInB,EAAc,eAAA,EAClBkF,EAAIpF,EAAS,QACnB,GAAI,CAACoF,GAAK,CAAC/D,EAAG,OACV+D,EAAE,YAAc/D,IAClB+D,EAAE,UAAY/D,GAEhB+D,EAAE,MAAQ,GACRA,EAAU,YAAc,GAC1B,GAAI,CAAE,MAAMA,EAAE,KAAA,CAAO,MAAQ,CAAC,CAC9B/E,EAAa,EAAI,CACnB,MAAQ,CAAC,CACX,EAEA8E,EAAA,EACA,MAAMP,EAAI,YAAYO,EAAO,GAAG,EAChC,MAAO,IAAM,cAAcP,CAAC,CAC9B,EAAG,CAACzD,EAAsBG,EAAMpB,EAAeA,EAAc,WAAW,CAAC,EAEzE,eAAe+E,GAAQ,CAErB,GADE,QAAQ,IAAI,0CAA2C3D,CAAI,EACzDA,IAAS,OACX,OAAO+D,GAAA,EAKT,GAHF,QAAQ,IAAI,mEAAmE,EAGzElE,IAAyB,gBAAkBG,IAAS,QAAS,CAC/D,MAAMD,EAAInB,EAAc,eAAA,EACxB,GAAImB,GAAKrB,EAAS,QAChB,GAAI,CACFA,EAAS,QAAQ,UAAYqB,EAC7B,MAAMrB,EAAS,QAAQ,KAAA,EACvBK,EAAa,EAAI,EACjB,MACF,MAAQ,CAAC,CAGX,GAAIiB,IAAS,QACX,GAAI,CAAE,MAAMgE,GAAA,EAAqB,MAAO,MAAQ,CAAC,CAErD,CAEA,GAAI,CAEF,KAAM,CAAE,kBAAArC,EAAmB,mBAAAD,CAAAA,EAAuB5B,EAAgB,SAAA,EAC5DmE,EAAsCtC,EAAoB,CAAE,MAAO,CAAE,SAAU,CAAE,MAAOA,CAAAA,CAAkB,EAAK,MAAO,IAAU,CAAE,MAAO,GAAM,MAAO,EAAA,EAC5J,IAAIjC,EACJ,GAAI,CACFA,EAAS,MAAM,UAAU,aAAa,aAAauE,CAAW,CAChE,OAASrE,EAAU,CACjB,MAAMsE,EAAQtE,IAAQA,EAAI,MAAQA,EAAI,OAAU,GAChD,GAAI+B,IAAsBuC,IAAS,wBAA0BA,IAAS,iBACpExE,EAAS,MAAM,UAAU,aAAa,aAAa,CAAE,MAAO,GAAM,MAAO,GAAO,MAEhF,OAAME,CAEV,CACIlB,EAAS,UACXA,EAAS,QAAQ,UAAYgB,EAC7B,MAAMhB,EAAS,QAAQ,KAAA,EACvBK,EAAa,EAAI,EACjBS,EAAeE,EAAQ,OAAO,EAGlC,MAAQ,CAAC,CACX,CACA,SAASkE,GAAO,CACVlF,EAAS,SAAWA,EAAS,QAAQ,YACvBA,EAAS,QAAQ,UAA0B,UAAA,EACpD,QAAQ4E,GAAKA,EAAE,MAAM,EAC5B5E,EAAS,QAAQ,UAAY,KAC7BK,EAAa,EAAK,EAClBS,EAAe,IAAI,EAEvB,CAEA,eAAeuE,IAAsB,CACnC7C,EAAmB,EAAI,EACvB,GAAI,CACF,MAAMiD,EAAU,MAAMC,GAAA,EACtBpD,EAAemD,CAAO,EAClBA,EAAQ,SAAW,GACrB,MAAM,oHAAoH,CAE9H,OAASE,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,EACpD,MAAM,wEAAwE,CAChF,QAAA,CACEnD,EAAmB,EAAK,CAC1B,CACF,CAEA,eAAeoD,GAAoBC,EAAuB,CACxD,GAAI,CACFvD,KAA0BmD,EAAQ,IAAIK,GACpCA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,cAA0BA,CAAA,CAChE,EAED,MAAM9E,EAAS,MAAM+E,GAAuBF,CAAM,EAClD,GAAI7E,GAAUhB,EAAS,QACrBA,EAAS,QAAQ,UAAYgB,EAC7B,MAAMhB,EAAS,QAAQ,KAAA,EACvBK,EAAa,EAAI,EACjBS,EAAeE,EAAQ,MAAM,EAC7BsB,KAA0BmD,EAAQ,IAAIK,GACpCA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,UAAsBA,CAAA,CAC5D,MAED,OAAM,IAAI,MAAM,4BAA4B,CAEhD,OAASH,EAAO,CACd,QAAQ,MAAM,oCAAqCA,CAAK,EACxD,MAAM,wBAAwBE,EAAO,IAAI,0CAA0C,EACnFvD,KAA0BmD,EAAQ,IAAIK,GACpCA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,WAAuBA,CAAA,CAC7D,CACH,CACF,CAEA,eAAeE,IAAqB,CAClCpD,EAAkB,EAAI,EACtB,GAAI,CAEF,MAAM6C,EAAU,MAAMQ,GAAA,EACtBvD,EAAc+C,CAAO,EAGrB,MAAMS,EAAY,MAAMC,GAAA,EACpBD,GACFxD,EAAc0D,GAAQ,CAAC,GAAGA,EAAMF,CAAS,CAAC,EAGxCT,EAAQ,SAAW,GAAK,CAACS,GAC3B,MAAM,sEAAsE,CAEhF,OAASP,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,EACnD,MAAM,kEAAkE,CAC1E,QAAA,CACE/C,EAAkB,EAAK,CACzB,CACF,CAGAS,EAAAA,UAAU,IAAM,CACd,MAAMgD,EAAWC,GAAY,CAC3B,GAAI,CACF,MAAMC,EAAgBD,GAAMA,EAAG,QAAUA,EAAG,OAAO,KAC/CC,GAAiB,CAAC,QAAS,QAAS,OAAQ,KAAK,EAAE,SAASA,CAAa,GAE3EC,GAAiBD,CAAa,EAE9BtB,EAAA,EAAQ,MAAM,IAAM,CAAC,CAAC,GAGtBA,EAAA,EAAQ,MAAM,IAAM,CAAC,CAAC,CAE1B,MAAQ,CAAC,CACX,EACA,cAAO,iBAAiB,mBAA2BoB,CAAc,EAC1D,IAAM,CAAE,OAAO,oBAAoB,mBAA2BA,CAAc,CAAE,CACvF,EAAG,CAACpB,EAAOuB,EAAgB,CAAC,EAE5B,eAAeC,GAAmBZ,EAAmB,CACnD,GAAI,CACFnD,KAAyB+C,EAAQ,IAAIK,GACnCA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,cAA0BA,CAAA,CAChE,EACD,MAAM9E,EAAS,MAAM0F,GAAmBb,CAAM,EAC9C,GAAI7E,GAAUhB,EAAS,QACrBA,EAAS,QAAQ,UAAYgB,EAC7B,MAAMhB,EAAS,QAAQ,KAAA,EACvBK,EAAa,EAAI,EACjBkB,EAAQ,MAAM,EACdT,EAAeE,EAAQ,MAAM,EAC7B0B,KAAyB+C,EAAQ,IAAIK,GACnCA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,UAAsBA,CAAA,CAC5D,MAED,OAAM,IAAI,MAAM,4BAA4B,CAEhD,OAASH,EAAO,CACd,QAAQ,MAAM,mCAAoCA,CAAK,EACvD,MAAM,wBAAwBE,EAAO,IAAI,0CAA0C,EACnFnD,KAAyB+C,EAAQ,IAAIK,GACnCA,EAAE,KAAOD,EAAO,GAAK,CAAE,GAAGC,EAAG,OAAQ,WAAuBA,CAAA,CAC7D,CACH,CACF,CAEA,MAAMU,GAAmBzF,cAAa4F,GAA0C,CAC9E,GAAI,CACFpF,EAAQoF,IAAY,MAAQ,OAASA,CAAO,EAC5CnC,GAAmB,KAAK,KAAK,EAE7B,GAAI,CACF,GAAImC,IAAY,QAAS,CACvB,GAAI,CAAE3D,GAAmBC,GAAmB,QAAS,EAAI,CAAE,MAAQ,CAAC,CACpE,GAAI,CAAEF,GAAyB,EAAI,CAAE,MAAQ,CAAC,CAChD,SAAW4D,IAAY,QAAS,CAC9B,GAAI,CAAE3D,GAAmB,OAAW,eAAgB,EAAI,CAAE,MAAQ,CAAC,CACnE,GAAI,CAAED,GAAyB,EAAI,CAAE,MAAQ,CAAC,CAChD,SAAW4D,IAAY,QAAUA,IAAY,MAAO,CAClD,GAAI,CAAE3D,GAAmB,OAAW,WAAY,EAAI,CAAE,MAAQ,CAAC,CAC/D,GAAI,CAAED,GAAyB,EAAI,CAAE,MAAQ,CAAC,CAChD,CACF,MAAQ,CAAC,CACL4D,IAAY,QACd1B,EAAA,EAAQ,MAAM,IAAM,CAAC,CAAC,EACb0B,IAAY,QACrBrB,GAAA,EACSqB,IAAY,OACrBtB,GAAA,EACSsB,IAAY,OACrBX,GAAA,CAEJ,OAAS9E,EAAK,CAAE,QAAQ,KAAK,uCAAwCA,CAAG,CAAE,CAC5E,EAAG,CAAC+D,EAAOK,GAAmBD,GAAqBW,GAAoBhD,GAAoBD,GAA0BE,EAAiB,CAAC,EAGvI,SAAS2D,IAAW,CAClB,GAAIrG,GAAMA,EAAG,aAAe,UAAU,KAAM,OAAOA,EACnD,MAAMwD,EAAU,sBACV8C,EAA0B9C,EAAO,OAAS,EAC3CA,EAAO,SAAS,KAAK,EAAIA,EAASA,EAAO,QAAQ,MAAO,EAAE,EAAI,MAC/D,OACE+C,EAAS,OAAO,SAAS,WAAa,SAAW,MAAQ,KACzDC,EAAa,GAAGD,CAAK,MAAM,OAAO,SAAS,IAAI,MAC/C7C,EAAO,OAAO,SAAS,SACvB+C,EAAc/C,IAAS,aAAeA,IAAS,YAC/CgD,EAAehD,EAAK,SAAS,cAAc,EAE3CiD,GAAW,uCACjB,IAAIC,EAAMN,EACLM,IACCH,EACFG,EAAM,GAAGL,CAAK,MAAM7C,CAAI,WACfgD,EACTE,EAAMJ,EAENI,EAAMD,IAILC,IAAKA,EAAMJ,GAChB,MAAMK,GAAS,IAAI,UAAUD,CAAG,EAChC,OAAA3G,EAAM4G,EAAM,EACLA,EACT,CACA,eAAe9B,IAAoB,CACjC/D,EAAQ,OAAO,EACfO,EAAU,EAAK,EACf,MAAMsF,EAASR,GAAA,EACXQ,EAAO,aAAe,UAAU,KAClCA,EAAO,KAAK,KAAK,UAAU,CAAE,KAAM,YAAA,CAAc,CAAC,EAElDA,EAAO,OAAS,IAAMA,EAAO,KAAK,KAAK,UAAU,CAAE,KAAM,YAAA,CAAc,CAAC,EAE1EA,EAAO,UAAY,MAAOd,GAAO,CAC/B,MAAMe,EAAO,KAAK,MAAMf,EAAG,IAAI,EAC/B,GAAIe,EAAK,OAAS,WAChB3G,EAAY2G,EAAK,IAAI,EACjBA,EAAK,WAAW3F,EAAa2F,EAAK,SAAS,UACtCA,EAAK,OAAS,kBAAmB,CAC1CvF,EAAU,EAAI,EAEd,MAAMwF,EAAO,IAAI,kBAAkB,CAAE,WAAY,CAAC,CAAE,KAAM,8BAAA,CAAgC,EAAG,EAC7F1G,EAAM0G,CAAI,EACVA,EAAK,eAAkBC,GAAM,CACvBA,EAAE,WAAa9G,GAAU2G,EAAO,KAAK,KAAK,UAAU,CAAE,KAAM,UAAW,KAAM3G,EAAU,QAAS8G,EAAE,SAAA,CAAW,CAAC,CACpH,EACAD,EAAK,QAAWhB,GAAO,CACrB,GAAItG,EAAS,QAAS,CACpB,MAAMwH,EAAUlB,EAAG,UAAU,CAAC,EAC1BkB,IACFxH,EAAS,QAAQ,UAAYwH,EAC7BxH,EAAS,QAAQ,KAAA,EAAO,MAAM,IAAI,CAAC,CAAC,EACpCK,EAAa,EAAI,EAErB,CACF,EACA,MAAMoH,EAAQ,MAAMH,EAAK,YAAY,CAAE,oBAAqB,GAAO,oBAAqB,GAAM,EAC9F,MAAMA,EAAK,oBAAoBG,CAAK,EAChChH,GAAU2G,EAAO,KAAK,KAAK,UAAU,CAAE,KAAM,YAAa,KAAM3G,EAAU,QAASgH,CAAA,CAAO,CAAC,CACjG,SAAWJ,EAAK,OAAS,aACnB1G,SAAUA,EAAG,qBAAqB,IAAI,sBAAsB0G,EAAK,OAAO,CAAC,UACpEA,EAAK,OAAS,WACnB1G,EAAI,GAAI,CAAE,MAAMA,EAAG,gBAAgB0G,EAAK,OAAO,CAAE,MAAQ,CAAC,CAElE,CACF,CACA,SAASK,IAAiB,CACxBhH,EAAY,IAAI,EAChBgB,EAAa,IAAI,EACjBI,EAAU,EAAK,EACXvB,GAAMA,EAAG,aAAe,UAAU,KACpCA,EAAG,KAAK,KAAK,UAAU,CAAE,KAAM,YAAA,CAAc,CAAC,EAE9C+E,GAAA,EAEF,GAAI,CAAEvC,GAAyB,EAAI,CAAE,MAAQ,CAAC,CAChD,CAEA,SAAS4E,IAAU,CAKjB,GAJAzC,EAAA,EACAxE,EAAY,IAAI,EAChBoB,EAAU,EAAK,EACfJ,EAAa,IAAI,EACbf,EAAI,CAAE,GAAI,CAAEA,EAAG,MAAA,CAAQ,MAAQ,CAAC,CAAGC,EAAM,IAAI,CAAE,CACrD,CACA,OACAwC,EAAAA,IAACwE,GAAA,CACG,MAAAnI,EACA,UAAAC,EACA,MAAAuF,EACA,QAAA0C,GACA,kBAAArC,GACA,oBAAAD,GACA,mBAAAW,GACA,oBAAAJ,GACA,mBAAAa,GACA,SAAAzG,EACA,UAAAI,EACA,KAAAkB,EACA,QAAAC,EACA,SAAAd,EACA,UAAAmD,GACA,IAAAiB,EACA,UAAAP,GACA,eAAAoD,GACA,UAAAzF,EACA,SAAAE,EACA,YAAAC,GACA,YAAAC,GACA,WAAAI,GACA,gBAAAF,EACA,eAAAI,GACA,cAAAhD,EACA,UAAAC,EACA,OAAAC,EACA,MAAAC,EACA,KAAAC,EACE,aAAcyG,EAAAA,CAAA,CAGtB,CAEA,SAASoB,GAAYC,EAAY,CAC/B,MAAM3H,EAAgBC,GAAA,EAChB,CAAE,YAAA2H,EAAa,aAAcC,CAAA,EAAiB3G,EAAA,EAC9C,CACJ,MAAA3B,EACA,MAAAwF,EACA,QAAA0C,EACA,kBAAArC,EACA,oBAAAD,EACF,mBAAAW,EACE,oBAAAJ,EACA,mBAAAa,EACA,SAAAzG,EACA,UAAAI,EACF,KAAAkB,EACE,QAAAC,EACF,aAAAyG,EACE,SAAAvH,EACA,UAAAmD,EACA,IAAAiB,EACA,UAAAP,EACA,eAAAoD,EACA,UAAAzF,EACA,SAAAE,EACA,YAAAC,EACA,YAAAC,EACA,WAAAI,EACA,gBAAAF,EACA,eAAAI,EACA,UAAA/C,EACA,OAAAC,EACA,MAAAC,GACA,KAAAC,CAAA,EACE8H,EAEEI,GAA0C,CAC9C,MAAO,QACP,MAAO,WACP,KAAM,WAAA,EAGFC,GAAmBrE,EAAAA,QAAQ,IACxB,CACL,CACE,GAAI,QACJ,MAAO,eACP,YAAa,0CACb,OAAQ,IAAM,CACNmE,KAA2B,OAAO,CACxC,CAAA,EAEJ,CACE,GAAI,QACJ,MAAO,WACP,YAAa,8CACb,OAAQ,IAAM,CACNA,KAA2B,OAAO,CACxC,CAAA,EAEJ,CACE,GAAI,OACJ,MAAO,YACP,YAAa,oDACb,OAAQ,IAAM,CACNA,KAA2B,MAAM,CACvC,CAAA,EAEJ,CACE,GAAI,MACJ,MAAO,MACP,YAAa,yDACb,OAAQ,IAAM,CACNA,KAA2B,KAAK,CACtC,CAAA,CACJ,EAED,CAACzG,EAAS0D,EAAOK,EAAmBD,EAAqBW,CAAkB,CAAC,EAEzE,CAACmC,EAAcC,CAAe,EAAI9H,EAAAA,SAAiC,IAAI,EACvE+H,EAAiBpI,EAAAA,OAAsB,IAAI,EAEjDoD,EAAAA,UAAU,IACD,IAAM,CACPgF,EAAe,SAAS,OAAO,aAAaA,EAAe,OAAO,CACxE,EACC,CAAA,CAAE,EAIL,KAAM,CAAE,cAAeC,EAAA,EAAkBlH,EAAA,EACnCmH,EAAmCxI,EAAO,OAAUuI,IAAiB,OAErEE,IAAS,IAAM,CACnB,MAAMC,EAAM,OAAOZ,EAAM,eAAiBC,GAAe,CAAC,EACpDY,EAAU,KAAK,IAAI,GAAK,KAAK,IAAI,KAAMD,CAAG,CAAC,EACjD,OAAOF,IAAqB,OAAS,KAAK,IAAI,EAAGG,CAAO,EAAIA,CAC9D,GAAA,EACMC,EAAqE5I,GAAQwI,IAAqB,OACpG,OACC1I,GAAUA,IAAW,UACpBA,EACEkI,GAAwB,OAE1Ba,EAAuBD,IAAiB,OACxCE,GAAcD,EAChBD,IAAiB,SACf,gBACAA,IAAiB,WACf,eACAA,IAAiB,UACf,eACA,eACN,GAKEG,GAAiB,CAHD/I,EAClB,wGACA,gHACmCH,CAAS,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,EAAE,KAAA,EACtEmJ,GAAgC,CAAE,GAAIjJ,IAAS,EAAC,EAEhDkJ,GAAgBjJ,EAAO,yCAA2C,2BAElEkJ,GAAmB,CACvB,MAAO,CAAE,UAAW,SAAST,EAAK,IAAK,gBAAiB,QAAA,CAAkB,EAGtEU,GAAY5H,IAAS,QAAUmB,EAAW,KAAKqD,GAAKA,EAAE,SAAW,QAAQ,EAEzEqD,GAAgB,IAAM,CAG1B,MAAMC,EADQb,IAAqB,MAG/B,6EAEA,2EACJ,OAAIxI,EACE6I,QAEC,MAAA,CAAI,UAAU,oDACb,SAAAxF,EAAAA,IAAC,MAAA,CAAI,UAAW,yCAAyCyF,EAAW,GAClE,SAAAzF,EAAAA,IAAC,QAAA,CAAM,IAAKpD,EAAU,UAAWoJ,EAAiB,GAAGH,GAAkB,CAAA,CACzE,CAAA,CACF,QAGI,QAAA,CAAM,IAAKjJ,EAAU,UAAWoJ,EAAiB,GAAGH,GAAkB,EAE5EL,QAEC,MAAA,CAAI,UAAW,mBAAmBC,EAAW,GAC5C,SAAAzF,EAAAA,IAAC,QAAA,CAAM,IAAKpD,EAAU,UAAWoJ,EAAiB,GAAGH,EAAA,CAAkB,EACzE,QAGI,QAAA,CAAM,IAAKjJ,EAAU,UAAWoJ,EAAiB,GAAGH,GAAkB,CAChF,GAAA,EAEA,eAAeI,GAAUC,EAAkCC,EAAuB,CAChF,GAAKD,EACL,GAAI,CACF,GAAI,UAAU,WAAa,UAAU,UAAU,UAC7C,MAAM,UAAU,UAAU,UAAUA,CAAK,MACpC,CACL,MAAME,EAAW,SAAS,cAAc,UAAU,EAClDA,EAAS,MAAQF,EACjBE,EAAS,MAAM,SAAW,QAC1BA,EAAS,MAAM,QAAU,IACzB,SAAS,KAAK,YAAYA,CAAQ,EAClCA,EAAS,MAAA,EACTA,EAAS,OAAA,EACT,SAAS,YAAY,MAAM,EAC3B,SAAS,KAAK,YAAYA,CAAQ,CACpC,CACApB,EAAgBmB,CAAI,EAChBlB,EAAe,SAAS,OAAO,aAAaA,EAAe,OAAO,EACtEA,EAAe,QAAU,OAAO,WAAW,IAAMD,EAAgB,IAAI,EAAG,IAAI,CAC9E,OAASlH,EAAK,CACZ,QAAQ,KAAK,4BAA6BA,CAAG,EAC7CkH,EAAgB,IAAI,CACtB,CACF,CAEA,cACG,MAAA,CAAI,UAAWU,GAAgB,MAAOC,GACrC,SAAA,CAAAU,EAAAA,KAAC,MAAA,CAAI,UAAWT,GACb,SAAA,CAAAG,EACCjJ,EAAc,aAAgBoB,IAAO,gBACpC,MAAA,CAAI,UAAU,gLACb,SAAA,CAAA8B,EAAAA,IAAC,OAAA,CAAK,UAAU,kEAAkE,EAClFA,EAAAA,IAAC,QAAK,SAAA,MAAG,CAAA,EACX,CAAA,EAEJ,EACJqG,EAAAA,KAAC,MAAA,CAAI,UAAU,qJACf,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,uBAAwB,SAAA,CAAAhK,IAAUW,EAAakB,IAAO,QAAU,aAAeA,IAAO,OAAS,YAAc,OAAU,UAAW,6BAA0B,OAAA,CAAK,UAAU,0BAA0B,SAAA,KAAE,CAAA,EAAQ,EACzNmI,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAA,CAACrJ,GACAqJ,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,OAAC,SAAA,CAAO,UAAW,6DAA6DpI,IAAO,QAAQ,4BAA4B,gDAAgD,GAAI,QAAS,KAAO0G,GAAc,kBAAkB,OAAO,EAAG,SAAA,QAAK,QAC7O,SAAA,CAAO,UAAW,6DAA6D1G,IAAO,QAAQ,4BAA4B,gDAAgD,GAAI,QAAS,KAAO0G,GAAc,kBAAkB,OAAO,EAAG,SAAA,QAAK,QAC7O,SAAA,CAAO,UAAW,6DAA6D1G,IAAO,OAAO,4BAA4B,gDAAgD,GAAI,QAAS,KAAO0G,GAAc,kBAAkB,MAAM,EAAG,SAAA,OAAI,QAC1O,SAAA,CAAO,UAAW,6DAA6D1G,IAAO,OAAO,4BAA4B,gDAAgD,GAAI,QAAS,KAAO0G,GAAc,kBAAkB,KAAK,EAAG,SAAA,MAAG,CAAA,EAC3O,EAED5H,QACE,SAAA,CAAO,UAAU,qGAAqG,QAASuH,EAAS,gBAAI,EAC3I,IAAA,EACN,CAAA,EACF,EACCrG,IAAO,SAAWb,GAAY,CAACL,UAC7B,MAAA,CAAI,UAAU,yCACb,SAAA,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,yBAAsB,EAC1DqJ,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,UAAU,iIACV,QAAS,IAAMJ,GAAUzF,EAAW,MAAM,EAC1C,MAAM,0BAEN,SAAA,OAAC,OAAA,CAAK,UAAU,qCAAsC,SAAAA,EAAU,QAC/D,OAAA,CAAK,UAAU,wEAAyE,SAAAuE,IAAiB,OAAS,UAAY,MAAA,CAAO,CAAA,CAAA,CAAA,EAExIsB,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAArG,EAAAA,IAAC,IAAA,CACC,KAAMQ,EACN,OAAO,SACP,IAAI,aACJ,UAAU,kGACX,SAAA,WAAA,CAAA,EAGD6F,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,UAAU,4IACV,QAAS,IAAMJ,GAAU5I,EAAU,MAAM,EACzC,MAAM,oBAEN,SAAA,OAAC,OAAA,CAAK,UAAU,qCAAsC,SAAAA,EAAS,QAC9D,OAAA,CAAK,UAAU,wEAAyE,SAAA0H,IAAiB,OAAS,UAAY,MAAA,CAAO,CAAA,CAAA,CAAA,CACxI,EACF,EACC7D,SAAc,MAAA,CAAI,UAAU,4CAA4C,IAAI,eAAe,IAAKA,EAAW,EAC5GmF,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACZ,SAAA,CAAA5E,IAAQ,aAAS,OAAA,CAAK,SAAA,CAAA,cAAYA,EAAI,GAAA,EAAC,QACvC,SAAA,CAAO,UAAU,mCAAmC,QAAS6C,EAAgB,SAAA,YAAA,CAAU,CAAA,EAC1F,EACCvF,GACCsH,EAAAA,KAAC,MAAA,CAAI,UAAU,6EACb,SAAA,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,kBAAe,EACnDA,EAAAA,KAAC,KAAA,CAAG,UAAU,2BACZ,SAAA,CAAArG,EAAAA,IAAC,MAAG,SAAA,uDAAoD,SACvD,KAAA,CAAG,SAAA,CAAA,0DAAwDnB,GAAW,MAAQA,EAAU,KAAO,KAAK,IAAA,EAAE,EACvGmB,EAAAA,IAAC,MAAG,SAAA,kEAA+D,CAAA,EACrE,EACAA,EAAAA,IAAC,MAAA,CAAI,UAAU,kBAAkB,eAAC,SAAA,CAAO,UAAU,mCAAmC,QAAS,IAAIhB,EAAY,EAAK,EAAG,qBAAS,EAAS,CAAA,EAC3I,CAAA,EAEJ,EAEDd,IAAO,QAAU,CAAClB,UAChB,MAAA,CAAI,UAAU,yCACb,SAAA,OAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,kBAAe,EAGnDqJ,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,OAAC,MAAA,CAAI,UAAU,mBAAmB,SAAA,eAAY,EAC7ClH,EACCkH,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAArG,EAAAA,IAAC,MAAA,CAAI,UAAU,4DAA4D,EAC3EA,EAAAA,IAAC,QAAK,SAAA,sBAAmB,CAAA,EAC3B,EACEf,EAAY,OAAS,EACvBoH,OAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAApH,EAAY,IAAKwD,UACf,MAAA,CAAoB,UAAU,gEAC7B,SAAA,CAAA4D,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAArG,EAAAA,IAAC,MAAA,CAAI,UAAU,uBAAwB,SAAAyC,EAAO,KAAK,EACnD4D,EAAAA,KAAC,MAAA,CAAI,UAAU,wBAAyB,SAAA,CAAA5D,EAAO,GAAG,IAAEA,EAAO,IAAA,EAAK,CAAA,EAClE,EACAzC,EAAAA,IAAC,SAAA,CACC,UAAW,kCACTyC,EAAO,SAAW,aAAe,gBACjCA,EAAO,SAAW,SAAW,eAAiB,aAChD,GACA,QAAS,IAAMD,EAAoBC,CAAM,EACzC,SAAUA,EAAO,SAAW,aAE3B,SAAAA,EAAO,SAAW,aAAe,MAAQ,SAAA,CAAA,CAC5C,GAdQA,EAAO,EAejB,CACD,QACA,MAAA,CAAI,UAAU,mBACb,SAAAzC,EAAAA,IAAC,SAAA,CAAO,UAAU,8CAA8C,QAASiC,EAAqB,SAAA,aAAA,CAAW,EAC3G,CAAA,CAAA,CACF,EAEAoE,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,OAAC,MAAA,CAAI,UAAU,kBAAkB,SAAA,wBAAqB,QACrD,SAAA,CAAO,UAAU,8CAA8C,QAASpE,EAAqB,SAAA,WAAA,CAAS,CAAA,EACzG,CAAA,EAEJ,SAIC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,mBAAmB,SAAA,cAAW,EAC5C1C,EACC8G,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAArG,EAAAA,IAAC,MAAA,CAAI,UAAU,4DAA4D,EAC3EA,EAAAA,IAAC,QAAK,SAAA,kBAAe,CAAA,EACvB,EACEX,EAAW,OAAS,EACtBgH,OAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAAhH,EAAW,IAAKoD,UACd,MAAA,CAAoB,UAAU,gEAC7B,SAAA,CAAA4D,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAArG,EAAAA,IAAC,MAAA,CAAI,UAAU,uBAAwB,SAAAyC,EAAO,KAAK,QAClD,MAAA,CAAI,UAAU,wBAAyB,SAAAA,EAAO,KAAK,aAAY,CAAE,CAAA,EACpE,EACAzC,EAAAA,IAAC,SAAA,CACC,UAAW,kCACTyC,EAAO,SAAW,aAAe,gBACjCA,EAAO,SAAW,SAAW,eAAiB,aAChD,GACA,QAAS,IAAMY,EAAmBZ,CAAM,EACxC,SAAUA,EAAO,SAAW,aAE3B,SAAAA,EAAO,SAAW,aAAe,MAAQ,SAAA,CAAA,CAC5C,GAdQA,EAAO,EAejB,CACD,QACA,MAAA,CAAI,UAAU,mBACb,SAAAzC,EAAAA,IAAC,SAAA,CAAO,UAAU,8CAA8C,QAAS4C,EAAoB,SAAA,YAAA,CAAU,EACzG,CAAA,CAAA,CACF,EAEAyD,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,OAAC,MAAA,CAAI,UAAU,kBAAkB,SAAA,uBAAoB,QACpD,SAAA,CAAO,UAAU,8CAA8C,QAASzD,EAAoB,SAAA,UAAA,CAAQ,CAAA,EACvG,CAAA,EAEJ,CAAA,EACF,EAED,CAAC5F,GACAqJ,EAAAA,KAAC,MAAA,CAAI,UAAU,iFACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,OAAC,MAAA,CAAI,UAAU,qDAAqD,SAAA,eAAY,QAC/E,MAAA,CAAI,UAAU,uCAAuC,SAAA,mBAAgB,CAAA,EACxE,EACAA,EAAAA,KAAC,OAAA,CAAK,UAAU,yBAAyB,SAAA,CAAA,YAAUxB,GAAgB3G,CAAI,GAAK,OAAA,EAAQ,CAAA,EACtF,QACC,IAAA,CAAE,UAAU,8BAA8B,SAAA,mDAAgD,QAC1F,MAAA,CAAI,UAAU,yBACZ,SAAA4G,GAAiB,IAAIyB,GAAU,CAC9B,MAAMC,EAAWD,EAAO,KAAO,MAC3BT,GACAS,EAAO,KAAOrI,EAClB,OACEmI,EAAAA,KAAC,SAAA,CAEC,KAAK,SACL,QAASE,EAAO,OAChB,UAAW,oCAAoCC,EAAW,0CAA4C,gDAAgD,cAEtJ,SAAA,CAAAxG,EAAAA,IAAC,MAAA,CAAI,UAAU,+DAAgE,SAAAuG,EAAO,MAAM,EAC5FvG,EAAAA,IAAC,MAAA,CAAI,UAAU,kCAAmC,WAAO,YAAY,EACpEwG,SAAa,MAAA,CAAI,UAAU,oCAAoC,SAAA,SAAM,CAAA,CAAA,EAPjED,EAAO,EAAA,CAUlB,CAAC,EACH,CAAA,EACF,CAAA,EAEJ,CAEJ,CCn7BA,MAAME,GAAU,CACd,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IACjH,EAEA,SAASC,GAAKC,EAAqB,CAAE,OAAIA,IAAQ,KAAa,GAAc,OAAOA,EAAI,MAAM,CAAC,CAAC,EAAY,CAAE,CAE7G,SAASC,GAAiBC,EAAqB,CAC7C,OAAKJ,GAAQ,SAASI,CAAG,EAClBH,GAAKG,CAAG,EADoB,EAErC,CAEO,SAASC,GAAiBC,EAAmBC,EAAyB,MAAiB,CAC5F,GAAID,EAAY,KAAOA,GAAa,QAAU,CAAA,EAE9C,MAAME,EAAsC,CAC1C,IAAK,CAAC,YAAY,EAAG,IAAK,CAAC,YAAY,EAAG,IAAK,CAAC,YAAY,EAAG,IAAK,CAAC,YAAY,EAAG,IAAK,CAAC,aAAa,EACvG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAC3G,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAC3G,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAC3G,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,YAAY,EAAG,IAAK,CAAC,eAAe,YAAY,EACxH,IAAK,CAAC,aAAa,YAAY,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,aAAa,EAAG,IAAK,CAAC,YAAY,EAAG,IAAK,CAAC,YAAY,EACrH,IAAK,CAAC,aAAa,YAAY,EAAG,IAAK,CAAC,aAAa,aAAa,EAAG,IAAK,CAAC,YAAY,EAAG,IAAK,CAAC,SAAS,EAAG,GAAI,CAAC,aAAa,aAAa,EAAG,GAAI,CAAC,SAAS,EAC5J,GAAI,CAAC,SAAS,EAAG,GAAI,CAAC,SAAS,EAAG,GAAI,CAAC,SAAS,EAAG,GAAI,CAAC,SAAS,EAAG,GAAI,CAAC,UAAU,SAAS,EAAG,GAAI,CAAC,SAAS,EAAG,GAAI,CAAC,UAAU,SAAS,EACxI,GAAI,CAAC,WAAW,SAAS,EAAG,GAAI,CAAC,SAAS,EAAG,GAAI,CAAC,UAAU,SAAS,EAAG,GAAI,CAAC,SAAS,EAAG,GAAI,CAAC,SAAS,SAAS,EAAG,GAAI,CAAC,UAAU,SAAS,EAC3I,GAAI,CAAC,UAAU,QAAQ,EAAG,GAAI,CAAC,SAAS,UAAU,EAAG,GAAI,CAAC,SAAS,SAAS,EAAG,GAAI,CAAC,UAAU,SAAS,EAAG,GAAI,CAAC,SAAS,SAAS,EACjI,GAAI,CAAC,UAAU,SAAS,EAAG,GAAI,CAAC,SAAS,SAAS,EAAG,GAAI,CAAC,SAAS,SAAS,EAAG,GAAI,CAAC,SAAS,SAAS,EAAG,GAAI,CAAC,SAAS,SAAS,EAChI,GAAI,CAAC,SAAS,SAAS,EAAG,GAAI,CAAC,OAAO,QAAQ,EAAG,GAAI,CAAC,SAAS,SAAS,EAAG,GAAI,CAAC,QAAQ,EAAG,GAAI,CAAC,QAAQ,EAAG,GAAI,CAAC,QAAQ,EACxH,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,KAAK,EAAG,GAAI,CAAC,IAAI,EAAG,GAAI,CAAC,IAAI,EAAG,GAAI,CAAC,IAAI,EAAG,GAAI,CAAC,IAAI,EAAG,GAAI,CAAC,IAAI,EAAG,EAAG,CAAC,IAAI,EAAG,EAAG,CAAC,IAAI,EAAG,EAAG,CAAC,IAAI,EAAG,EAAG,CAAC,IAAI,CAAA,EAEtP,GAAIA,EAAUF,CAAS,EAAG,OAAOE,EAAUF,CAAS,EAEpD,MAAMG,EAASN,GAAiBI,CAAc,EACxCG,EAAmB,CAAA,EAEzB,UAAW3F,IAAK,CAAC,GAAI,GAAI,GAAI,GAAI,EAAE,EAEjC,GADauF,EAAYvF,IACZ0F,EAAQ,CAAEC,EAAO,KAAK,IAAI3F,EAAE,CAAC,IAAIwF,CAAc,EAAE,EAAG,KAAM,CAEzE,GAAI,CAACG,EAAO,QACV,UAAWlJ,IAAK,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAErC,GADa8I,EAAY9I,IACZiJ,EAAQ,CAAEC,EAAO,KAAK,GAAGlJ,CAAC,IAAI+I,CAAc,EAAE,EAAG,KAAM,EAGxE,OAAOG,CACT,CAEO,SAASC,GAAShF,EAAciF,EAAgBN,EAAmBO,EAAoBC,EAAoD,CAChJ,GAAI,CACF,MAAMC,EAAQ,OAAO,gBACrB,GAAI,CAACA,EAAO,OACZ,MAAMC,EAAM,IAAI,yBACVC,EAAaX,GAAa,KAAOA,EAAY,EAC7CY,EAAcN,IAAW,IAE/B,GAAI,EADmB,CAACE,GAAM,cAAgBG,GAAcC,GACvC,OAmBrB,GAjBIA,GACFF,EAAI,KAAO,GAAGrF,CAAI,gBAClBqF,EAAI,KAAO,KACXA,EAAI,MAAQ,MACHC,GACTD,EAAI,KAAO,GAAGrF,CAAI,KAAK2E,CAAS,cAChCU,EAAI,KAAO,EACXA,EAAI,MAAQ,GACHJ,IAAW,GACpBI,EAAI,KAAO,GAAGrF,CAAI,cAClBqF,EAAI,KAAO,EACXA,EAAI,MAAQ,IAEZA,EAAI,KAAO,GAAGrF,CAAI,KAAKiF,CAAM,IAC7BI,EAAI,KAAO,EACXA,EAAI,MAAQ,GAEVH,EAAW,CACb,MAAMtF,EAAIwF,EAAM,YAAY,KAAKxF,GAAKA,EAAE,OAASsF,CAAS,EACtDtF,MAAO,MAAQA,EACrB,CACI,OAAOuF,GAAM,QAAW,WAAc,OAAS,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,EAAK,MAAM,CAAC,IAC9E,OAAS,EAClB,GAAI,CAAEC,EAAM,OAAA,CAAS,MAAQ,CAAC,CAC9BA,EAAM,MAAMC,CAAG,CACjB,MAAQ,CAAC,CACX,CCrEA,SAAwBG,GAAsB,CAC5C,SAAAC,EACA,QAAAC,EAAU,GACV,cAAAC,CACF,EAA+B,CAC7B,KAAM,CAAE,EAAAC,EAAG,QAAAC,CAAA,EAAYC,GAAA,EAEjBC,EAAaC,GAAgCP,EAAUI,CAAO,EAC9DI,EAAWC,GAA6BT,EAAUI,CAAO,EACzD,CAAE,QAAAM,EAAS,KAAAC,CAAA,EAASC,GAA0BZ,EAAUI,CAAO,EAC/DS,EAAiBC,GAA+Bd,CAAQ,EACxDe,EAAcC,GAA8BhB,CAAQ,EAG1D,GAAI,CAACG,GAAK,CAACC,EACT,OAAIH,EAEAzB,EAAAA,KAAC,MAAA,CAAI,UAAU,qHACb,SAAA,CAAArG,EAAAA,IAAC8I,GAAA,CAAc,UAAU,SAAA,CAAU,EAAE,gBAAA,EAEvC,EAKFzC,EAAAA,KAAC,MAAA,CAAI,UAAU,mFACb,SAAA,CAAArG,EAAAA,IAAC8I,GAAA,CAAc,UAAU,oCAAA,CAAqC,EAC9DzC,EAAAA,KAAC,MAAA,CAAI,UAAU,SACb,SAAA,CAAArG,EAAAA,IAAC,MAAA,CAAI,UAAU,2BAA2B,SAAA,uBAAoB,EAC9DqG,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,mCAAiCwB,CAAA,CAAA,CAAS,CAAA,EAChF,EACCE,GACC/H,EAAAA,IAAC,SAAA,CACC,UAAU,oDACV,QAAS+H,EACV,SAAA,WAAA,CAAA,CAED,EAEJ,EAKJ,MAAMgB,EAAUV,EACZ,0CACA,sCAEEW,EAAYX,EAAW,mBAAqB,iBAC5CY,EAAOZ,EAAWa,GAAcJ,GAEtC,OAAIhB,SAEC,MAAA,CAAI,UAAW,mEAAmEiB,CAAO,IAAIC,CAAS,GACpG,SAAA,CAAAG,GAAM,cAAcF,EAAM,CAAE,UAAW,UAAW,EACnDjJ,EAAAA,IAAC,QAAM,SAAAwI,CAAA,CAAK,EACX,CAACH,GAAYK,GACZ1I,EAAAA,IAAC,OAAA,CAAK,UAAU,sBAAsB,MAAO0I,EAC3C,SAAA1I,EAAAA,IAACoJ,GAAA,CAAY,UAAU,iBAAiB,CAAA,CAC1C,CAAA,EAEJ,EAMF/C,EAAAA,KAAC,MAAA,CAAI,UAAW,4BAA4B0C,CAAO,aACjD,SAAA,CAAA1C,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAA8C,GAAM,cAAcF,EAAM,CACzB,UAAW,WAAWZ,EAAW,mBAAqB,gBAAgB,gBAAA,CACvE,EACDhC,EAAAA,KAAC,MAAA,CAAI,UAAU,SACb,SAAA,CAAAA,OAAC,OAAI,UAAW,eAAegC,EAAW,mBAAqB,gBAAgB,GAAI,SAAA,CAAA,mBAChER,CAAA,EACnB,EACAxB,EAAAA,KAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,CAAA,UAAQ,KAAK,MAAM4B,CAAO,EAAE,QAAMO,CAAA,CAAA,CAAK,CAAA,CAAA,CAC7E,CAAA,EACF,EAGAnC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAArG,EAAAA,IAAC,MAAA,CAAI,UAAU,mDACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAW,yBACTqI,EAAW,iBAAmB,cAChC,GACA,MAAO,CAAE,MAAO,GAAG,KAAK,IAAI,IAAKF,CAAU,CAAC,GAAA,CAAI,CAAA,EAEpD,EACA9B,EAAAA,KAAC,OAAA,CAAK,UAAU,oBAAqB,SAAA,CAAA,KAAK,MAAM8B,CAAU,EAAE,GAAA,CAAA,CAAC,CAAA,EAC/D,EAGCS,GACC5I,EAAAA,IAAC,MAAA,CAAI,UAAU,qBACb,gBAAC,MAAA,CAAI,SAAA,CAAA,eAAa4I,EAAY,YAAY,aAAWA,EAAY,cAAc,GAAA,CAAA,CAAC,CAAA,CAClF,EAIFvC,EAAAA,KAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAA,CAACgC,GACAhC,EAAAA,KAAC,MAAA,CAAI,UAAU,8GACb,SAAA,CAAArG,EAAAA,IAAC8I,GAAA,CAAc,UAAU,uBAAA,CAAwB,EAAE,4CACTjB,CAAA,EAC5C,EAGDa,GACCrC,EAAAA,KAAC,MAAA,CAAI,UAAU,2GACb,SAAA,CAAArG,EAAAA,IAACqJ,GAAA,CAAI,UAAU,uBAAA,CAAwB,EACtCX,CAAA,CAAA,CACH,CAAA,EAEJ,EAEC,CAACL,GAAYN,GACZ1B,EAAAA,KAAC,SAAA,CACC,UAAU,oEACV,QAAS0B,EACV,SAAA,CAAA,mBACkBF,CAAA,CAAA,CAAA,CACnB,EAEJ,CAEJ,CC7IA,SAAwByB,GAAc,CACpC,KAAAC,EACA,MAAAC,EACA,UAAAhN,EAAY,GACZ,OAAAiN,EAAS,EACX,EAKG,CACD,OACEpD,OAAC,OAAI,UAAW,GAAGoD,EAAS,eAAiB,EAAE,qKAAqKjN,CAAS,GAC3N,SAAA,CAAAwD,EAAAA,IAAC,MAAA,CAAI,UAAU,yGAAA,CAA0G,EACzHA,EAAAA,IAAC,MAAA,CAAI,UAAU,oEACZ,SAAAuJ,EACH,EACAvJ,EAAAA,IAAC,MAAA,CAAI,UAAU,gDACZ,SAAAwJ,CAAA,CACH,CAAA,EACF,CAEJ,CCfO,MAAME,GAA8E,CAC1F,GAAG,MAAM,KAAK,CAAE,OAAQ,EAAA,EAAM,CAACC,EAAGC,KAAO,CAAE,MAAO,IAAIA,EAAI,CAAC,GAAK,OAAQA,EAAI,GAAK,GAAI,EACrF,CAAE,MAAO,QAAS,MAAO,GAAI,OAAQ,EAAA,CACtC,EAEO,SAASC,GAAY3D,EAAe4D,EAA4B,CACtE,MAAMtI,EAAIkI,GAAsBI,CAAS,EACzC,MAAO,CAAC,CAACtI,GAAK0E,IAAU1E,EAAE,KAC3B,CAEO,SAASuI,GAAgBC,EAA8B,CAC7D,MAAMxI,EAAIwI,EAAM,KAAA,EAAO,YAAA,EACvB,GAAI,CAACxI,EAAG,OAAO,KACf,GAAIA,IAAM,MAAQA,IAAM,QAAUA,IAAM,SAAWA,IAAM,QAAS,MAAO,IACzE,GAAIA,IAAM,MAAQA,IAAM,QAAS,MAAO,IACxC,MAAMyI,EAAIzI,EAAE,MAAM,wBAAwB,EAC1C,GAAI,CAACyI,EAAG,OAAO,KACf,MAAMC,EAAQD,EAAE,CAAC,GAAK,IAChBE,EAAM,SAASF,EAAE,CAAC,EAAE,EAAE,EAC5B,OAAIE,EAAM,GAAKA,EAAM,GAAW,KAEzBA,GADSD,IAAO,IAAI,EAAEA,IAAO,IAAI,EAAE,EAE3C,CC3BO,MAAME,GAAsB,CAClC,GAAG,MAAM,KAAK,CAAE,OAAQ,IAAM,CAACT,EAAGC,IAAMA,EAAI,CAAC,EAC7C,GACA,EACD,ECCaS,GAAmC,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAEpE,SAASC,IAAmC,CAClD,MAAMC,EAAa,CAAA,EACnB,OAAAF,GAAgB,QAAQ,GAAK,CAAEE,EAAM,CAAC,EAAI,CAAE,CAAC,EACtC,CAAE,MAAAA,EAAO,OAAQ,CAAA,CACzB,CAIO,SAASC,GAAiBC,EAAqBvE,EAAewE,EAAuDC,EAAwBC,EAAgD,IAAM,GAAe,CAExN,IAAIT,EAA4B,KAC5BU,EAAO,EACX,GAAIH,IAAS,QAAUA,IAAS,cAAgBxE,IAAU,IAAMA,IAAU,GACzEiE,EAAM,GACNU,EAAQH,IAAS,cAAgBxE,IAAU,GAAM,EAAI,UAC3C,OAAOyE,GAAW,UAAaA,GAAqB,IAAOA,GAAqB,GAC1FR,EAAMQ,EACFD,IAAS,SAAUG,EAAO,EACrBH,IAAS,SAAUG,EAAO,EAC9BA,EAAO,UACF3E,EAAO,CAEjB,MAAM4E,EAAwB,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,EAChD,UAAWC,KAAKD,EAAM,CACrB,GAAI5E,IAAU6E,EAAG,CAAEZ,EAAMY,EAAGF,EAAO,EAAG,KAAM,CAC5C,GAAI3E,IAAU6E,EAAE,EAAG,CAAEZ,EAAMY,EAAGF,EAAO,EAAG,KAAM,CAC9C,GAAI3E,IAAU6E,EAAE,EAAG,CAAEZ,EAAMY,EAAGF,EAAO,EAAG,KAAM,CAC/C,CACI,CAACV,IAAQjE,IAAU,IAAMA,IAAU,MAAOiE,EAAM,GAAIU,EAAQ3E,IAAU,GAAM,EAAI,EACrF,CACA,GAAI,CAACiE,EAAK,MAAO,GAEjB,MAAMa,EAASP,EAAM,MAAMN,CAAG,EAC9B,IAAIc,EAAgB,KAAK,IAAI,EAAG,EAAID,CAAM,EAC1C,MAAME,EAAU,KAAK,IAAID,EAAeJ,CAAI,EACtCM,EAAW,KAAK,IAAI,EAAGN,EAAOK,CAAO,EAErCE,EAASJ,EAASE,EACxBT,EAAM,MAAMN,CAAG,EAAIiB,EAAQ,EAAI,EAAIA,EAGnC,IAAIC,EAAS,EACb,OAAIF,EAAW,GAAK,CAACP,EAAeT,CAAG,IAClCA,IAAQ,GAEPO,IAAS,aAAcW,GAAU,GAAKF,KAC3B,GAAKA,EAEpBE,GAAUlB,EAAMgB,GAIlBV,EAAM,QAAUY,EACTA,CACR,CAEO,SAASC,GAAab,EAA8B,CAC1D,OAAOJ,GAAgB,MAAM,IAAMI,EAAM,MAAM,CAAC,GAAK,IAAM,CAAC,CAC7D,CC5DO,SAASc,IAAqC,CACpD,MAAO,CAAE,MAAO,EAAG,MAAO,EAAG,SAAU,GAAO,iBAAkB,GAAO,SAAU,CAAE,QAAS,EAAG,QAAS,EAAG,QAAS,EAAE,CACvH,CAEO,SAASC,GAAef,EAA8B,CAAE,OAAOA,EAAM,KAAM,CAG3E,SAASgB,GAAkBhB,EAAsBvE,EAAewE,EAAuDC,EAAgC,CAC7J,GAAIF,EAAM,SAAU,MAAO,GAC3B,MAAMvD,EAASsE,GAAef,CAAK,EACnC,IAAIY,EAAS,EACb,OAAI,OAAOV,GAAW,UAAYA,IAAWzD,EACxCwD,IAAS,UAAYW,EAASnE,EAAS,EAAGuD,EAAM,SAAS,WACpDC,IAAS,UAAYW,EAASnE,EAAS,EAAGuD,EAAM,SAAS,WACzDC,IAAS,WAAYW,EAASnE,EAAS,EAAGuD,EAAM,SAAS,WACxD,CAACE,IAAWzE,IAAUgB,GAAUhB,IAAUgB,EAAO,GAAKhB,IAAUgB,EAAO,KAE7EhB,IAAUgB,EAAO,GAAKmE,EAASnE,EAAO,EAAGuD,EAAM,SAAS,WACnDvE,IAAUgB,EAAO,GAAKmE,EAASnE,EAAO,EAAGuD,EAAM,SAAS,WACxDvE,IAAUgB,IAAUmE,EAASnE,EAAQuD,EAAM,SAAS,YAE9DA,EAAM,OAASY,EACRA,CACR,CAGO,SAASK,GAAgBjB,EAAsB,CACrD,GAAI,CAACA,EAAM,SAAU,CACpB,GAAIA,EAAM,SAAS,QAAQ,GAAKA,EAAM,SAAS,QAAQ,GAAKA,EAAM,SAAS,QAAQ,EAAG,CACrFA,EAAM,iBAAmB,GACzBA,EAAM,SAAW,GACjB,MACD,CACA,MAAMkB,EAAQlB,EAAM,MAAQ,EACxBkB,EAAO,GAAMlB,EAAM,SAAW,GAAcA,EAAM,MAAQkB,CAC/D,CAEAlB,EAAM,SAAW,CAAE,QAAS,EAAG,QAAS,EAAG,QAAS,CAAA,CACrD,CCjCO,SAASmB,IAAqC,CASpD,MAAO,CAAE,MAAO,EAAG,QARc,CAChC,CAAE,KAAM,SAAU,IAAK,EAAA,EACvB,CAAE,KAAM,SAAU,IAAK,EAAA,EACvB,CAAE,KAAM,SAAU,IAAK,EAAA,EACvB,CAAE,KAAM,SAAU,IAAK,EAAA,EACvB,CAAE,KAAM,MAAA,EACR,CAAE,KAAM,YAAA,CAAa,EAEM,MAAO,EAAG,SAAU,GAAO,aAAc,EAAA,CACtE,CAEO,SAASC,GAAsBpB,EAA2C,CAChF,OAAOA,EAAM,QAAQA,EAAM,KAAK,GAAK,IACtC,CAEO,SAASqB,GAAiBrB,EAAqBvE,EAAewE,EAAuDC,EAAgC,CAC3J,GAAIF,EAAM,SAAU,MAAO,GAC3B,MAAMjJ,EAAIqK,GAAsBpB,CAAK,EACrC,GAAI,CAACjJ,EAAG,MAAO,GACf,IAAI6F,EAAS,EACb,OAAQ7F,EAAE,KAAA,CACT,IAAK,SAAU,CACV,OAAOmJ,GAAW,UAAYA,IAAWnJ,EAAE,IAC1CkJ,IAAS,SAAUrD,EAAS7F,EAAE,IAAM,EAC/BkJ,IAAS,SAAUrD,EAAS7F,EAAE,IAAM,EACpCkJ,IAAS,WAAUrD,EAAS7F,EAAE,KAC7B,CAACmJ,IAAWzE,IAAU1E,EAAE,KAAO0E,IAAU1E,EAAE,IAAI,GAAK0E,IAAU1E,EAAE,IAAI,KAC9E6F,EAASnB,GAENmB,EAAS,IAAGoD,EAAM,aAAe,IACrC,KACD,CACA,IAAK,SAAU,EACTC,IAAS,UAAYC,IAAWnJ,EAAE,KAAQ0E,IAAU1E,EAAE,IAAI,KAAK6F,EAAS7F,EAAE,IAAI,EAAGiJ,EAAM,aAAe,IAC3G,KACD,CACA,IAAK,SAAU,EACTC,IAAS,UAAYC,IAAWnJ,EAAE,KAAQ0E,IAAU1E,EAAE,IAAI,KAAK6F,EAAS7F,EAAE,IAAI,EAAGiJ,EAAM,aAAe,IAC3G,KACD,CACA,IAAK,OAAQ,EACRC,IAAS,QAAUA,IAAS,cAAgBxE,IAAU,IAAMA,IAAU,MAAMmB,EAAUqD,IAAS,cAAgBxE,IAAU,GAAM,GAAK,GAAIuE,EAAM,aAAe,IACjK,KACD,CACA,IAAK,aAAc,CAEdvE,EAAQ,IAAKmB,EAASnB,EAAOuE,EAAM,aAAe,IACtD,KACD,CAAA,CAED,OAAAA,EAAM,OAASpD,EACRA,CACR,CAEO,SAAS0E,GAAetB,EAAqB,CAC/CA,EAAM,WACLA,EAAM,eACVA,EAAM,MAAQ,KAAK,MAAMA,EAAM,MAAQ,CAAC,GAEzCA,EAAM,aAAe,GACrBA,EAAM,OAAS,EACXA,EAAM,OAASA,EAAM,QAAQ,WAAc,SAAW,IAC3D,CCvEO,SAASuB,IAA8B,CAC7C,MAAO,CAAE,MAAO,EAAG,MAAO,EAAG,OAAQ,OAAQ,SAAU,EAAA,CACxD,CAEO,SAASC,GAAiBxB,EAAqBvE,EAAewE,EAAuDC,EAAgC,CAC3J,GAAIF,EAAM,SAAU,MAAO,GAG3B,IAAIpD,EAAS,EACb,GAAIoD,EAAM,SAAW,OACpB,GAAIC,IAAS,aAAcrD,EAAS,WAC3B,OAAOsD,GAAW,SAAU,CAEpC,MAAM3I,EAAI2I,GADGD,IAAS,SAAW,EAAIA,IAAS,SAAW,EAAI,GAEzDC,GAAU,KAAItD,EAASrF,EAC5B,MAEKkE,GAAS,KAAImB,EAASnB,WAGvB,OAAOyE,GAAW,SAAU,CAE/B,MAAM3I,EAAI2I,GADGD,IAAS,SAAW,EAAIA,IAAS,SAAW,EAAI,GAEzDC,GAAU,KAAItD,EAASrF,EAC5B,MACKkE,EAAQ,GAAKA,GAAS,KAAImB,EAASnB,GAGzC,OAAAuE,EAAM,OAASpD,EACRA,CACR,CAEO,SAAS6E,GAAezB,EAAqB,CACnD,GAAI,CAAAA,EAAM,SAEV,IADAA,EAAM,OAAS,EACXA,EAAM,MAAQ,GAAI,CAAEA,EAAM,SAAW,GAAM,MAAO,CACtDA,EAAM,OAASA,EAAM,SAAW,OAAS,MAAQ,OAClD,CCrCO,SAAS0B,GAAkBC,EAAkBC,EAAQ,EAAgB,CAC1E,MAAO,CAAE,OAAQD,EAAU,MAAAC,EAAO,SAAU,GAAO,WAAY,EAAA,CACjE,CAGO,SAASC,GAAsCC,EAAmC,CACvF,MAAMC,EAAO,MAAM,KAAK,CAAE,OAAQ,EAAA,EAAM,CAAC7C,EAAGC,IAAMA,EAAI,CAAC,EACjD6C,EAAW,CAAA,EACjB,UAAWC,KAAMH,EAAW,CAE1B,MAAMI,EAAM,KAAK,MAAM,KAAK,OAAA,EAAWH,EAAK,MAAM,EAC5CrC,EAAMqC,EAAK,OAAOG,EAAK,CAAC,EAAE,CAAC,EACjCF,EAAIC,CAAE,EAAIvC,CACZ,CACA,OAAOsC,CACT,CAIO,SAASG,GACdC,EACAC,EACApC,EACAC,EACqE,CACrE,MAAMoC,EAAKD,EAAOD,CAAM,EACxB,GAAI,CAACE,GAAM,CAACpC,GAAU,CAACD,EAAM,MAAO,CAAE,aAAc,EAAA,EAEpD,GAAI,CAACqC,EAAG,UAAYrC,IAAS,UAAYC,IAAWoC,EAAG,OACrD,OAAAA,EAAG,SAAW,GACP,CAAE,aAAc,EAAA,EAGzB,GAAIA,EAAG,WAAarC,IAAS,UAAYA,IAAS,UAAW,CAC3D,MAAMsC,EAAW,OAAO,KAAKF,CAAM,EAAE,QAAYG,IAAQJ,GAAU,CAACC,EAAOG,CAAG,EAAE,YAAcH,EAAOG,CAAG,EAAE,SAAWtC,CAAM,EAC3H,GAAIqC,EAAU,CACZ,MAAME,EAASJ,EAAOE,CAAQ,EACxBG,EAAQzC,IAAS,SAAW,EAAI,EACtC,OAAAwC,EAAO,MAAQ,KAAK,IAAI,EAAGA,EAAO,MAAQC,CAAK,EAC3CD,EAAO,QAAU,IAAGA,EAAO,WAAa,IACrC,CAAE,aAAc,GAAO,SAAAF,EAAU,aAAcG,CAAA,CACxD,CACF,CACA,MAAO,CAAE,aAAc,EAAA,CACzB,CAEO,SAASC,GAAaN,EAAoD,CAC/E,MAAMO,EAAQ,OAAO,QAAQP,CAAM,EAAE,OAAO,CAAC,CAAA,CAAEQ,CAAE,IAAM,CAACA,EAAG,YAAcA,EAAG,MAAQ,CAAC,EACrF,OAAID,EAAM,SAAW,EAAUA,EAAM,CAAC,EAAE,CAAC,EAClC,IACT,CCjDO,MAAME,GAAwC,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAErF,SAASC,IAAuC,CACrD,MAAMjD,EAAa,CAAA,EACnB,OAAAgD,GAAmB,QAAQ,GAAK,CAAEhD,EAAM,CAAC,EAAI,CAAE,CAAC,EACzC,CAAE,MAAAA,EAAO,OAAQ,CAAA,CAC1B,CAEO,SAASkD,GAAmBhD,EAAuBvE,EAAewE,EAAuDC,EAAwBC,EAAkD,IAAM,GAAe,CAC7N,IAAIT,EAA8B,KAC9BU,EAAO,EACX,GAAIH,IAAS,QAAUA,IAAS,cAAgBxE,IAAU,IAAMA,IAAU,GACxEiE,EAAM,GACNU,EAAQH,IAAS,cAAgBxE,IAAU,GAAM,EAAI,UAC5C,OAAOyE,GAAW,UAAYA,GAAU,IAAMA,GAAU,GACjER,EAAMQ,EACFD,IAAS,SAAUG,EAAO,EACrBH,IAAS,SAAUG,EAAO,EAC9BA,EAAO,UACH3E,EAAO,CAChB,UAAW6E,IAAK,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,EAAwB,CACjE,GAAI7E,IAAU6E,EAAG,CAAEZ,EAAMY,EAAGF,EAAO,EAAG,KAAM,CAC5C,GAAI3E,IAAU6E,EAAE,EAAG,CAAEZ,EAAMY,EAAGF,EAAO,EAAG,KAAM,CAC9C,GAAI3E,IAAU6E,EAAE,EAAG,CAAEZ,EAAMY,EAAGF,EAAO,EAAG,KAAM,CAChD,CACI,CAACV,IAAQjE,IAAU,IAAMA,IAAU,MAAOiE,EAAM,GAAIU,EAAQ3E,IAAU,GAAM,EAAI,EACtF,CACA,GAAI,CAACiE,EAAK,MAAO,GAEjB,MAAMa,EAASP,EAAM,MAAMN,CAAG,EACxBuD,EAAU,KAAK,IAAI,EAAG,EAAI1C,CAAM,EAChCE,EAAU,KAAK,IAAIwC,EAAS7C,CAAI,EAChCM,EAAW,KAAK,IAAI,EAAGN,EAAOK,CAAO,EACrCE,EAASJ,EAASE,EACxBT,EAAM,MAAMN,CAAG,EAAIiB,EAAQ,EAAI,EAAIA,EAEnC,IAAIC,EAAS,EACb,OAAIF,EAAW,GAAK,CAACP,EAAeT,CAAG,IACjCA,IAAQ,GACNO,IAAS,aAAcW,GAAU,GAAKF,KAC3B,GAAKA,EAEpBE,GAAWlB,EAAiBgB,GAGhCV,EAAM,QAAUY,EACTA,CACT,CAEO,SAASsC,GAAelD,EAAgC,CAC7D,OAAO8C,GAAmB,MAAM,IAAM9C,EAAM,MAAM,CAAC,GAAK,IAAM,CAAC,CACjE,CClDO,SAASmD,IAAgC,CAC9C,MAAO,CAAE,OAAQ,EAAG,MAAO,EAAG,gBAAiB,EAAG,SAAU,EAAA,CAC9D,CAGO,SAASC,GAAkBpD,EAAsBvE,EAAewE,EAAmCC,EAAgC,CACxI,GAAIF,EAAM,SAAU,MAAO,GAC3B,IAAIqD,EAAO,EAUX,GATI,OAAOnD,GAAW,UAAYA,IAAWF,EAAM,OAC7CC,IAAS,SAAUoD,EAAO,EACrBpD,IAAS,SAAUoD,EAAO,EAC9BA,EAAO,EACH,CAACnD,IAAWzE,IAAUuE,EAAM,QAAUvE,IAAUuE,EAAM,OAAO,GAAKvE,IAAUuE,EAAM,OAAO,KAClGqD,EAAO5H,IAAUuE,EAAM,OAAO,EAAI,EAAIvE,IAAUuE,EAAM,OAAO,EAAI,EAAI,GAEvEA,EAAM,OAASqD,EACfrD,EAAM,iBAAmB,EACrBA,EAAM,iBAAmB,EAAG,CAC9B,MAAMkB,EAAQlB,EAAM,OAAS,EACzBkB,EAAO,EAAGlB,EAAM,SAAW,IACxBA,EAAM,OAASkB,EAAMlB,EAAM,gBAAkB,EACtD,CACA,OAAOqD,CACT,CC3BO,MAAMC,GAAyC,CACpD,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,GACvD,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,EAClE,EASO,SAASC,IAAwB,CACtC,MAAO,CAAE,KAAM,EAAG,QAAS,EAAG,cAAe,EAAG,SAAU,EAAA,CAC5D,CAEO,SAASC,GAAcxD,EAAkBvE,EAAewE,EAAmCC,EAAiC,CACjI,GAAIF,EAAM,SAAU,MAAO,GAC3B,MAAMvD,EAAS6G,GAAatD,EAAM,IAAI,EAGtC,GAFAA,EAAM,eAAiB,EACV,OAAOE,GAAW,UAAYA,IAAWzD,IAAWwD,IAAO,UAAUA,IAAO,UAAUA,IAAO,WAAe,CAACC,IAAWzE,IAAQgB,GAAUhB,IAAQgB,EAAO,GAAKhB,IAAQgB,EAAO,GACjL,CACPuD,EAAM,SAAWA,EAAM,cAEvB,MAAMkB,EAAQlB,EAAM,KAAO,EAC3B,OAAIkB,EAAO,GAAIlB,EAAM,SAAW,IACzBA,EAAM,KAAOkB,EAAMlB,EAAM,cAAgB,GACzC,EACT,CAEA,GAAIA,EAAM,eAAiB,EAAG,CAC5BA,EAAM,SAAW,EACjB,MAAMkB,EAAQlB,EAAM,KAAO,EACvBkB,EAAO,GAAIlB,EAAM,SAAW,IACzBA,EAAM,KAAOkB,EAAMlB,EAAM,cAAgB,EAClD,CACA,MAAO,EACT,CCvCO,MAAMyD,GAAqE,CAChF,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EAAM,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EAAM,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACjF,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EAAM,EAAG,CAAE,KAAM,MAAA,EAAU,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EACzE,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EAAM,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,EAAM,EAAG,CAAE,KAAM,MAAO,IAAK,EAAA,CACnF,EASO,SAASC,IAAkC,CAChD,MAAO,CAAE,MAAO,MAAM,CAAC,EAAE,KAAK,IAAI,EAAG,KAAM,IAAK,SAAU,GAAO,OAAQ,IAAA,CAC3E,CAEA,SAASC,GAASC,EAAiD,CACjE,MAAMC,EAAQ,CAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAE,EAChF,SAAW,CAACC,EAAEC,EAAEzD,CAAC,IAAKuD,EAAS,GAAID,EAAME,CAAC,GAAKF,EAAME,CAAC,IAAIF,EAAMG,CAAC,GAAKH,EAAME,CAAC,IAAIF,EAAMtD,CAAC,EAAG,OAAOsD,EAAME,CAAC,EACzG,OAAIF,EAAM,MAAMtD,GAAKA,CAAC,EAAU,OACzB,IACT,CAEO,SAAS0D,GAAahE,EAAuBiE,EAAexI,EAAewE,EAAuDC,EAAiC,CACxK,GAAIF,EAAM,UAAYA,EAAM,MAAMiE,CAAI,EAAG,MAAO,GAChD,MAAMC,EAAMT,GAAYQ,CAAI,EAC5B,IAAIE,EAAK,GAMT,GALID,EAAI,OAAS,OAAQC,EAAMlE,IAAS,QAAUA,IAAS,cAAgBxE,IAAU,IAAMA,IAAU,GAC5FyI,EAAI,OAAS,OAAS,OAAOA,EAAI,KAAQ,WAC5C,OAAOhE,GAAW,UAAYA,IAAWgE,EAAI,KACxC,CAAChE,IAAWzE,IAAQyI,EAAI,KAAOzI,IAAQyI,EAAI,IAAI,GAAKzI,IAAQyI,EAAI,IAAI,MAAIC,EAAK,IAEpF,CAACA,EAAI,MAAO,GAChBnE,EAAM,MAAMiE,CAAI,EAAIjE,EAAM,KAC1B,MAAMoE,EAAIT,GAAS3D,EAAM,KAAK,EAC9B,OAAIoE,GAAKpE,EAAM,SAAW,GAAMA,EAAM,OAASoE,EAAU,KACzDpE,EAAM,KAAOA,EAAM,OAAS,IAAM,IAAM,IACjC,GACT,CCIA,SAAwBqE,GAAe,CAAE,SAAAjH,EAAU,QAAAkH,EAAS,WAAAC,EAAY,UAAAC,GAAkC,CACxG,MAAI,CAACF,GAAWA,EAAQ,SAAW,EAAU,KAG3C/O,MAAC,OAAI,UAAU,6CACZ,WAAQ,IAAI,CAACkP,EAAQvC,IACpBtG,EAAAA,KAAC,MAAA,CAEC,UAAW,yBACT6I,EAAO,cACH,0CACA,qCACN,GAEA,SAAA,CAAAlP,EAAAA,IAAC,MAAA,CAAI,UAAW,sDACdkP,EAAO,cAAgB,mBAAqB,gBAC9C,GACG,SAAAA,EAAO,IAAA,CACV,EAEA7I,EAAAA,KAAC,MAAA,CAAI,UAAU,oBAEZ,SAAA,CAAAwB,IAAa,OACZxB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,WAAW,MAAO,KAAKD,EAAO,SAAW,CAAC,GAAI,UAAS,EAAA,CAAC,EACxElP,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,EAC5DlP,EAAAA,IAACmP,GAAS,MAAM,aAAa,MAAOD,EAAO,WAAa,IAAK,KAAI,EAAA,CAAC,EAClElP,EAAAA,IAACmP,EAAA,CAAS,MAAM,aAAa,MAAO,GAAGD,EAAO,cAAgB,CAAC,IAAK,KAAI,EAAA,CAAC,EACzElP,EAAAA,IAACmP,GAAS,MAAM,WAAW,MAAOD,EAAO,SAAW,IAAK,KAAI,EAAA,CAAC,EAE7DA,EAAO,WAAa,QAAaA,EAAO,aAAe,QACtDlP,EAAAA,IAAAsG,EAAAA,SAAA,CACE,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,qCACb,SAAA,CAAArG,MAACmP,GAAS,MAAM,YAAY,MAAOD,EAAO,SAAS,QAAQ,CAAC,EAAG,KAAI,GAAC,KAAI,GAAC,UAAWA,EAAO,SAAW,EAAG,QACxGE,GAAA,CAAiB,SAAUF,EAAO,SAAU,WAAYA,EAAO,UAAA,CAAY,CAAA,CAAA,CAC9E,CAAA,CACF,CAAA,EAEJ,GAIArH,IAAa,WAAaA,IAAa,qBACvCxB,OAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,SAAS,MAAOE,GAAoBH,EAAO,MAAM,EAAG,KAAI,EAAA,CAAC,EACzElP,EAAAA,IAACmP,EAAA,CAAS,MAAM,SAAS,MAAOD,EAAO,QAAU,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,EAC9DlP,EAAAA,IAACmP,EAAA,CAAS,MAAM,SAAS,MAAOG,GAAiBJ,CAAM,EAAG,UAAWA,EAAO,aAAA,CAAe,CAAA,EAC7F,GAIArH,IAAa,YAAcA,IAAa,aACxCxB,OAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAOtH,IAAa,WAAa,QAAU,QAAS,MAAOqH,EAAO,OAAS,EAAG,KAAI,EAAA,CAAC,EAC7FlP,EAAAA,IAACmP,GAAS,MAAM,SAAS,MAAOD,EAAO,QAAU,IAAK,KAAI,EAAA,CAAC,EAC3DlP,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,CAAA,EAC9D,EAIDrH,IAAa,UACZxB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,WAAW,MAAOD,EAAO,QAAU,IAAK,KAAI,GAAC,KAAI,EAAA,CAAC,EAClElP,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,EAC3DA,EAAO,YACNlP,MAACmP,EAAA,CAAS,MAAM,SAAS,MAAM,aAAa,UAAW,EAAA,CAAO,CAAA,EAElE,EAIDtH,IAAa,YACZxB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,EAAA,CAAC,EACvDlP,EAAAA,IAACmP,GAAS,MAAM,SAAS,MAAOD,EAAO,QAAU,OAAQ,KAAI,EAAA,CAAC,EAC9DlP,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,CAAA,EAC9D,GAIArH,IAAa,mBAAqBA,IAAa,mBAAqBA,IAAa,qBACjFxB,EAAAA,KAAAC,WAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,SAAS,MAAOD,EAAO,QAAU,IAAK,KAAI,GAAC,KAAI,EAAA,CAAC,EAChElP,EAAAA,IAACmP,EAAA,CAAS,MAAM,OAAO,MAAOD,EAAO,MAAQ,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,EACzDA,EAAO,aACNlP,MAACmP,EAAA,CAAS,MAAM,WAAW,MAAO,GAAGD,EAAO,MAAQ,CAAC,MAAMA,EAAO,WAAW,GAAI,KAAI,EAAA,CAAC,CAAA,EAE1F,GAIArH,IAAa,YAAcA,IAAa,cAAgBA,IAAa,cACrExB,EAAAA,KAAAC,WAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,EAAA,CAAC,EACvDlP,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,EAC3DrH,IAAa,cACZ7H,EAAAA,IAACmP,EAAA,CAAS,MAAM,OAAO,MAAOD,EAAO,WAAa,EAAG,KAAI,EAAA,CAAC,CAAA,EAE9D,GAIArH,IAAa,gBAAkBA,IAAa,iBAC5CxB,OAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,YAAY,MAAOD,EAAO,WAAa,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,EACpElP,EAAAA,IAACmP,GAAS,MAAM,WAAW,MAAOD,EAAO,UAAY,EAAG,KAAI,EAAA,CAAC,EAC7DlP,EAAAA,IAACmP,GAAS,MAAM,YAAY,MAAOD,EAAO,WAAa,EAAG,KAAI,EAAA,CAAC,CAAA,EACjE,EAIDrH,IAAa,YACZxB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,SAAS,MAAO,IAAID,EAAO,QAAU,CAAC,GAAI,KAAI,GAAC,KAAI,GAAC,EACpElP,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,CAAA,EAC9D,EAIDrH,IAAa,YACZxB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,SAAS,MAAOD,EAAO,QAAU,EAAG,KAAI,EAAA,CAAC,EACzDlP,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOD,EAAO,OAAS,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,CAAA,EAC9D,EAGDrH,IAAa,QACZxB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,OAAO,MAAOD,EAAO,MAAQ,EAAG,KAAI,EAAA,CAAC,EACrDlP,EAAAA,IAACmP,EAAA,CAAS,MAAM,UAAU,MAAOD,EAAO,SAAW,EAAG,KAAI,GAAC,KAAI,EAAA,CAAC,CAAA,EAClE,EAIDrH,IAAa,eACZxB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAtG,EAAAA,IAACmP,EAAA,CAAS,MAAM,OAAO,MAAOD,EAAO,MAAQ,EAAG,KAAI,EAAA,CAAC,EACpDA,EAAO,QACNlP,MAACmP,EAAA,CAAS,MAAM,SAAS,MAAM,UAAU,UAAS,EAAA,CAAC,CAAA,EAEvD,EAIDH,IAAenH,IAAa,OAASA,IAAa,WAAaA,IAAa,qBAAuB8E,IAAQ,GAC1G3M,EAAAA,IAAC,MAAA,CAAI,UAAU,qCACb,SAAAA,EAAAA,IAACmP,EAAA,CAAS,MAAM,QAAQ,MAAOH,EAAY,KAAI,GAAC,KAAI,GAAC,UAAS,EAAA,CAAC,CAAA,CACjE,CAAA,CAAA,CAEJ,CAAA,CAAA,EA9IKrC,CAAA,CAgJR,EACH,CAEJ,CAGA,SAASwC,EAAS,CAChB,MAAA9S,EACA,MAAA6J,EACA,KAAAqJ,EAAO,GACP,KAAAC,EAAO,GACP,UAAAC,EAAY,EACd,EAMG,CACD,OACEpJ,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,aAAc,SAAA,CAAAhK,EAAM,GAAA,EAAC,QACpC,OAAA,CAAK,UAAW,GAAGkT,EAAO,YAAc,EAAE,IAAIC,EAAO,gBAAkB,EAAE,IACxEC,EAAY,mBAAqB,EACnC,GACG,SAAAvJ,CAAA,CACH,CAAA,EACF,CAEJ,CAGA,SAASkJ,GAAiB,CAAE,SAAAM,EAAU,WAAAC,GAAwD,CAC5F,MAAMC,EAAOF,EAAWC,EAClBE,EAAaD,EAAO,EACpBE,EAAY,KAAK,IAAIF,CAAI,EAAI,IAEnC,IAAIG,EAAW,GACXC,EAAY,iBAEhB,OAAIF,GACFC,EAAW,aACXC,EAAY,kBACHH,GACTE,EAAW,IAAIH,EAAK,QAAQ,CAAC,CAAC,UAC9BI,EAAY,qBAEZD,EAAW,GAAGH,EAAK,QAAQ,CAAC,CAAC,UAC7BI,EAAY,mBAIZ3J,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAArG,EAAAA,IAAC,OAAA,CAAK,UAAU,aAAa,SAAA,cAAW,QACvC,OAAA,CAAK,UAAW,2BAA2BgQ,CAAS,GAClD,SAAAD,CAAA,CACH,CAAA,EACF,CAEJ,CAGA,SAASV,GAAoBY,EAAyC,CACpE,MAAI,CAACA,GAAU,OAAO,KAAKA,CAAM,EAAE,SAAW,EAAU,IAClC,OAAO,QAAQA,CAAM,EACxC,OAAO,CAAC,CAACtG,EAAGuG,CAAK,IAAMA,IAAU,CAAC,EAClC,IAAI,CAAC,CAAC/F,CAAG,IAAMA,IAAQ,KAAO,IAAMA,CAAG,EACvC,KAAK,GAAG,GACa,GAC1B,CAEA,SAASmF,GAAiBJ,EAA6B,CACrD,GAAI,CAACA,EAAO,OAAQ,MAAO,WAC3B,MAAMiB,EAAc,OAAO,OAAOjB,EAAO,MAAM,EAAE,OAAOnE,GAAKA,IAAM,CAAC,EAAE,OACtE,OAAIoF,IAAgB,EAAU,WAC1BA,EAAc,EAAU,GAAGA,CAAW,KACnC,YACT,CCzQO,SAASC,GACdvI,EAEAwI,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAEAC,EAEAC,EAEAC,EACAC,EACAC,EACAC,EACe,CACf,OAAOrR,EAAAA,QAAQ,IAAM,CACnB,MAAMsO,EAAyB,CAAA,EAE/B,GAAIlH,IAAa,MAAO,CAEtB,IAAIkK,EAAiB,EACjBC,EAAc,EACdC,EAAe,EACnB,GAAIZ,GAAYA,EAAS,OAAS,EAAG,CACnC,UAAWa,KAAOb,EACZa,EAAI,aAAeA,EAAI,cACzBF,GAAeE,EAAI,YACnBD,GAAgBC,EAAI,aAGpBF,EAAc,IAChBD,EAAkBE,EAAeD,EAAe,EAEpD,CAQA,MAAMG,GALmBpB,GAAwB,GACG,EACtBJ,GAAkB,EACnBE,GAAwB,OACzBJ,GAAkB,GAsB9C,GAjBA1B,EAAQ,KAAK,CACX,KAAM,MACN,cAAe,CAAC,CAACuC,EACjB,QAASf,GAAc,EACvB,MAAOF,GAAe,EACtB,UAAW8B,EACX,aAAcjB,GAAoBA,EAAmB,EACjD,KAAK,OAAOD,GAAoB,GAAKC,EAAmB,GAAG,EAC3D,EACJ,QAASG,GAAYA,EAAS,OAAS,EACnC,GAAG,KAAK,IAAI,GAAGA,EAAS,IAAIe,GAAKA,EAAE,aAAeA,EAAE,eAAiB,EAAE,CAAC,GAAK,CAAC,SAC9E,IACJ,SAAUL,EACV,WAAYM,GAAc,KAAK,GAAK,CAAA,CACrC,EAGGd,GAAMA,IAAO,OAAQ,CAMvB,MAAMe,GALetB,GAAoB,GACG,EAClBJ,GAAc,EACfE,GAAoB,OACrBJ,GAAc,GAKtC3B,EAAQ,KAAK,CACX,KAAM,GAAGwC,CAAE,MACX,cAAe,CAACD,EAChB,QAASd,GAAU,EACnB,MAAOF,GAAW,EAClB,UAAWgC,EACX,aAAclB,GAAgBA,EAAe,EACzC,KAAK,OAAOD,GAAgB,GAAKC,EAAe,GAAG,EACnD,EACJ,QAAS,GAAA,CACV,CACH,CACF,CAEA,OAAIvJ,IAAa,YACfkH,EAAQ,KAAK,CACX,KAAM,MACN,cAAe,CAAC,CAACuC,EACjB,OAAQG,GAAS,OAAS,CAAA,EAC1B,OAAQA,GAAS,QAAU,CAAA,CAC5B,EAEGF,GAAMA,IAAO,QACfxC,EAAQ,KAAK,CACX,KAAM,GAAGwC,CAAE,MACX,cAAe,CAACD,EAChB,OAAQ,CAAA,EACR,OAAQ,CAAA,CACT,GAIDzJ,IAAa,aACfkH,EAAQ,KAAK,CACX,KAAM,MACN,cAAe,CAAC,CAACuC,EACjB,MAAOI,GAAU,OAAS,EAC1B,OAAQA,GAAU,QAAU,EAC5B,MAAOA,GAAU,OAAS,CAAA,CAC3B,EAEGH,GAAMA,IAAO,QACfxC,EAAQ,KAAK,CACX,KAAM,GAAGwC,CAAE,MACX,cAAe,CAACD,EAChB,MAAOI,GAAU,OAAS,EAC1B,OAAQA,GAAU,QAAU,EAC5B,MAAO,CAAA,CACR,GAID7J,IAAa,UAAY8J,GAAiBA,EAAc,OAAS,GACnEA,EAAc,QAAQ,CAACY,EAAG5F,IAAQ,CAChC,MAAMlC,EAAQmH,IAAeW,EAAE,EAAE,EACjCxD,EAAQ,KAAK,CACX,KAAMwD,EAAE,KACR,cAAe5F,IAAQmF,EACvB,OAAQD,IAAiBU,EAAE,EAAE,EAC7B,MAAO9H,GAAO,OAAS,EACvB,WAAYA,GAAO,YAAc,EAAA,CAClC,CACH,CAAC,EAGIsE,CACT,EAAG,CACDlH,EACAwI,EAAaC,EACbC,EAAYC,EACZC,EAAgBC,EAClBC,EAAgBC,EAChBC,EAAsBC,EACtBC,EAAsBC,EACpBC,EAAkBC,EAClBC,EAAcC,EACdC,EACAC,EAAcC,EACdE,EACAC,EACAC,EAAeC,EAAcC,EAAgBC,CAAA,CAC9C,CACH,CAEO,SAASU,GACd3K,EACA4K,EACAC,EACe,CACf,OAAOjS,EAAAA,QAAQ,IAAM,CACnB,MAAMsO,EAAyB,CAAA,EAE/B,MAAI,CAAC0D,GAAc,CAACA,EAAW,SAAWA,EAAW,QAAQ,SAAW,GAIxEA,EAAW,QAAQ,QAAQ,CAACvD,EAAavC,IAAgB,CACvD,MAAMgG,EAAgBhG,IAAQ8F,EAAW,iBAEzC,GAAI5K,IAAa,MAAO,CAEtB,IAAI6H,EAAW,EACXkD,EAAa,EACbC,EAAc,EAElB,GAAI3D,EAAO,MAAQA,EAAO,KAAK,OAAS,GACtC,UAAWgD,KAAOhD,EAAO,KACvB,GAAIgD,EAAI,SAAU,CAChB,MAAMY,EAAWZ,EAAI,aAAe,EAC9Ba,EAAY,KAAK,IAAI,EAAGb,EAAI,gBAAkBA,EAAI,mBAAmB,GAAK,EAChFU,GAAcE,EACdD,GAAeE,CACjB,EAIAH,EAAa,IACflD,EAAYmD,EAAcD,EAAc,GAG1C7D,EAAQ,KAAK,CACX,KAAMG,EAAO,MAAQ,UAAUvC,EAAM,CAAC,GACtC,cAAAgG,EACA,QAASzD,EAAO,SAAW,EAC3B,MAAOA,EAAO,OAAS,EACvB,UAAWA,EAAO,gBAAkB,EACpC,aAAcA,EAAO,iBAAmB,EACpC,KAAK,MAAOA,EAAO,WAAaA,EAAO,iBAAoB,GAAG,EAC9D,EACJ,QAASA,EAAO,aAAe,GAAGA,EAAO,YAAY,SAAW,IAChE,SAAAQ,EACA,WAAYR,EAAO,KAAOmD,GAAcnD,EAAO,IAAI,EAAI,CAAA,CACxD,CACH,CAEIrH,IAAa,WACfkH,EAAQ,KAAK,CACX,KAAMG,EAAO,MAAQ,UAAUvC,EAAM,CAAC,GACtC,cAAAgG,EACA,OAAQzD,EAAO,SAAS,OAAS,CAAA,EACjC,OAAQA,EAAO,SAAS,QAAU,CAAA,CACnC,EAGCrH,IAAa,UACfkH,EAAQ,KAAK,CACX,KAAMG,EAAO,MAAQ,UAAUvC,EAAM,CAAC,GACtC,cAAAgG,EACA,OAAQzD,EAAO,cAAgB,KAC/B,MAAOA,EAAO,aAAe,EAC7B,WAAYA,EAAO,kBAAoB,EAAA,CACxC,CAEL,CAAC,EAEMH,CACT,EAAG,CAAClH,EAAU4K,EAAYC,CAAY,CAAC,CACzC"}
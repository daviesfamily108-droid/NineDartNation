import{r as wr,a as co,g as da}from"./vendor-D3F3s8fL.js";import{r as m,S as On,L as Rl,M as jn,a as Ll,U as mr,T as sa,C as mo,P as Ol,R as Bl,b as Ca,c as oi,d as Ul,e as $l,G as Fl,V as _l,E as uo,f as Hl,g as ho,h as fo,i as Wl,j as zl,k as ql,X as Vl}from"./ui-Dx22kTqm.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();var Ea={exports:{}},Pn={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var li;function Gl(){if(li)return Pn;li=1;var t=wr(),a=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function l(o,d,c){var f,u={},x=null,p=null;c!==void 0&&(x=""+c),d.key!==void 0&&(x=""+d.key),d.ref!==void 0&&(p=d.ref);for(f in d)i.call(d,f)&&!r.hasOwnProperty(f)&&(u[f]=d[f]);if(o&&o.defaultProps)for(f in d=o.defaultProps,d)u[f]===void 0&&(u[f]=d[f]);return{$$typeof:a,type:o,key:x,ref:p,props:u,_owner:n.current}}return Pn.Fragment=s,Pn.jsx=l,Pn.jsxs=l,Pn}var ci;function Jl(){return ci||(ci=1,Ea.exports=Gl()),Ea.exports}var e=Jl(),Qn={},di;function Kl(){if(di)return Qn;di=1;var t=co();return Qn.createRoot=t.createRoot,Qn.hydrateRoot=t.hydrateRoot,Qn}var Yl=Kl();const Xl=da(Yl);var ur=co();const Ql=da(ur),xo=t=>`ndn_online_quota_${t}`;function na(t=new Date){const a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),s=a.getUTCDay()||7;a.setUTCDate(a.getUTCDate()+4-s);const i=new Date(Date.UTC(a.getUTCFullYear(),0,1)),n=Math.ceil(((a.getTime()-i.getTime())/864e5+1)/7),r=String(n).padStart(2,"0");return`${a.getUTCFullYear()}-${r}`}function po(t){try{const a=localStorage.getItem(xo(t));if(!a)return{week:na(),used:0};const s=JSON.parse(a),i=na();return!s.week||s.week!==i?{week:i,used:0}:{week:String(s.week),used:Number(s.used)||0}}catch{return{week:na(),used:0}}}function Zl(t,a){try{localStorage.setItem(xo(t),JSON.stringify(a))}catch{}}function mi(t,a=3){const s=na(),i=po(t),n={week:s,used:(i.week===s?i.used:0)+1};return Zl(t,n),n}function bo(t,a=3){const s=po(t);return Math.max(0,a-(s.used||0))}const go={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8787",VITE_WS_URL:"ws://localhost:8787"},yo="ndn:isAdmin:v1";function vo(){try{const t=localStorage.getItem(yo);return t?JSON.parse(t):{}}catch{return{}}}function ec(t,a){try{const s=vo();s[(t||"").toLowerCase()]={v:a,ts:Date.now()},localStorage.setItem(yo,JSON.stringify(s))}catch{}}async function tc(t){const a=String(t||"").toLowerCase();if(!a)return!1;try{const n=String(go?.VITE_OWNER_EMAIL||"").toLowerCase();if(n&&a===n)return!0}catch{}if(a==="daviesfamily108@gmail.com")return!0;try{const n=localStorage.getItem("ndn:forceAdmin");if(n==="1"||n==="true")return!0}catch{}const i=vo()[a];if(i&&Date.now()-i.ts<300*1e3)return!!i.v;try{const l=!!(await(await fetch(`/api/admins/check?email=${encodeURIComponent(a)}`)).json().catch(()=>({})))?.isAdmin;return ec(a,l),l}catch{return!!i?.v}}function jo(t){const a=String(t||"").toLowerCase(),[s,i]=m.useState(!1);return m.useEffect(()=>{let n=!0;if(!a){i(!1);return}try{const r=String(go?.VITE_OWNER_EMAIL||"").toLowerCase(),l=(()=>{try{const o=localStorage.getItem("ndn:forceAdmin");return o==="1"||o==="true"}catch{return!1}})();if(r&&a===r){i(!0);return}if(l){i(!0);return}}catch{}if(a==="daviesfamily108@gmail.com"){i(!0);return}return tc(a).then(r=>{n&&i(!!r)}),()=>{n=!1}},[a]),s}const sc={},nc=5,ac={GBP:1,EUR:1.16,USD:1.26,AUD:1.92,NZD:2.08,CAD:1.73};function No(t,a=nc){const s=(t||"GBP").toUpperCase(),i=ac[s]??1,n=a*i;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s}).format(n)}catch{return`${s} ${n.toFixed(2)}`}}function wo(){try{const t=new Intl.NumberFormat().resolvedOptions(),a=String(t.locale).toLowerCase();return a.includes("-gb")?"GBP":a.includes("-ie")||a.includes("-de")||a.includes("-fr")||a.includes("-es")||a.includes("-it")||a.includes("-nl")?"EUR":a.includes("-us")?"USD":a.includes("-au")?"AUD":a.includes("-nz")?"NZD":a.includes("-ca")?"CAD":"GBP"}catch{return"GBP"}}const rc=sc?.VITE_DISCORD_INVITE_URL||"https://discord.gg/nCfT4hJz";let Bs=null;function ic(){if(Bs)return Bs;const t="http://localhost:8787".trim();if(t)return Bs=t.replace(/\/$/,""),Bs;if(typeof window<"u"){const{protocol:a,host:s,hostname:i}=window.location,n=`${a}//${s}`;return i.endsWith("onrender.com")||i==="localhost"||i==="127.0.0.1"?Bs=n.replace(/\/$/,""):Bs="https://ninedartnation.onrender.com",Bs}return Bs="https://ninedartnation.onrender.com",Bs}function oc(t){if(/^https?:\/\//i.test(t))return t;const a=ic(),s=t.startsWith("/")?t:`/${t}`;return`${a}${s}`}function aa(t){return oc(t)}function kt(t,a){const s=aa(t);return fetch(s,a)}function lc(){if(typeof window>"u"||typeof window.fetch!="function")return;const t=window;if(t.__ndnApiPatched)return;const a=window.fetch.bind(window);window.fetch=(s,i)=>{try{if(typeof s=="string")return s.startsWith("/")?a(aa(s),i):a(s,i);if(s instanceof Request){const n=s.url.startsWith("/")?aa(s.url):s.url;if(n===s.url)return a(s,i);const r=new Request(n,s);return a(r,i)}if(s instanceof URL){const n=s.href.startsWith("/")?aa(s.href):s.href;return a(n,i)}}catch(n){console.warn("[API] Interceptor failed, falling back to original fetch",n)}return a(s,i)},t.__ndnApiPatched=!0}function cc(t){const a=[{key:"score",label:"Home",icon:Ll},{key:"online",label:"Online",icon:mr},{key:"offline",label:"Offline",icon:sa},{key:"tournaments",label:"Tournaments",icon:sa},{key:"friends",label:"Friends",icon:mr},{key:"stats",label:"Stats",icon:sa},{key:"calibrate",label:"Calibrate",icon:mo},{key:"settings",label:"Settings",icon:On}];return t?.fullAccess||a.push({key:"fullaccess",label:"PREMIUM £€$",icon:Ol}),a}function So({active:t,onChange:a,user:s,className:i}){const n=cc(s),r=jo(s?.email);if(r&&!n.some(p=>p.key==="admin")){const p=n.findIndex(S=>S.key==="settings"),g={key:"admin",label:"Admin",icon:On};p>=0?n.splice(p,0,g):n.push(g)}const[l,o]=m.useState(!1),[d,c]=m.useState(!1),f=s?.username&&!s?.fullAccess?bo(s.username):1/0,[u,x]=m.useState({friendRequests:0,messages:0,tournaments:0});return m.useEffect(()=>{if(!s?.email)return;const p=async()=>{try{const[S,M]=await Promise.all([kt(`/api/friends/requests?email=${encodeURIComponent(s.email)}`),kt(`/api/friends/messages?email=${encodeURIComponent(s.email)}`)]),I=S.ok?await S.json():{requests:[]},E=(M.ok?await M.json():{messages:[]}).messages?.filter(A=>!A.read).length||0;x({friendRequests:I.requests?.length||0,messages:E,tournaments:0})}catch(S){console.error("Failed to fetch notifications:",S)}};p();const g=setInterval(p,3e4);return()=>clearInterval(g)},[s?.email]),m.useEffect(()=>{if(!l)return;const p=g=>{(g.key==="Escape"||g.key==="Enter")&&o(!1)};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[l]),e.jsxs("aside",{className:`${s?.fullAccess?"premium-sidebar":""} sidebar glass ${i?"":"w-60"} p-2 sm:p-4 rounded-2xl ${i??"hidden sm:flex"} flex-col gap-2 overflow-y-auto overflow-x-hidden ${i?"":"fixed top-2 bottom-2 sm:top-4 sm:bottom-4"}`,children:[n.map(({key:p,label:g,icon:S})=>p==="admin"&&!r?null:e.jsxs("button",{className:`tab whitespace-nowrap flex items-center justify-start gap-3 ${t===p?"tab--active":"tab--inactive"} `,onClick:()=>a(p),title:g,style:{fontWeight:700,fontSize:"1.1rem",color:t===p?"#fff":"#E5E7EB",letterSpacing:"0.02em"},children:[e.jsx(S,{className:"w-6 h-6"}),e.jsxs("span",{className:"flex items-center gap-2",children:[g,p==="online"&&!s?.fullAccess&&f<=0&&e.jsxs("span",{title:"Weekly free games used",className:"inline-flex items-center gap-1 text-[0.65rem] px-2 py-0.5 rounded-full bg-rose-600 text-white",children:[e.jsx(Rl,{className:"w-3 h-3"}),"Locked"]}),p==="friends"&&u.friendRequests>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:u.friendRequests>9?"9+":u.friendRequests}),p==="score"&&(u.messages>0||u.tournaments>0)&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full",children:u.messages+u.tournaments>9?"9+":u.messages+u.tournaments})]})]},p)),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-2",onClick:()=>o(!0),title:"BullseyeDartsLeague",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(jn,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"BullseyeDartsLeague"})]}),e.jsxs("button",{className:"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-1",onClick:()=>c(!0),title:"NineDartNation",style:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"0.02em"},children:[e.jsx(jn,{className:"w-6 h-6"}),e.jsx("span",{className:"truncate",children:"NineDartNation"})]}),l&&ur.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>o(!1),onTouchStart:()=>o(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>o(!1),children:"✕"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(jn,{className:"w-6 h-6"})," BullseyeDartsLeague"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join this fantastic Online Darts League with divisions and other cool stuff included"}),e.jsx("a",{href:rc,target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body),d&&ur.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>c(!1),onTouchStart:()=>c(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"card max-w-md w-full relative text-left p-6 rounded-xl",children:[e.jsx("button",{className:"absolute -top-3 -right-3 btn px-3 py-1","aria-label":"Close",onClick:()=>c(!1),children:"✕"}),e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]",children:[e.jsx(jn,{className:"w-6 h-6"})," NineDartNation"]}),e.jsx("div",{className:"mb-4 text-lg font-semibold",children:"Join the NineDartNation Discord community"}),e.jsx("a",{href:"https://discord.gg/Q33J5FTVve",target:"_blank",rel:"noopener noreferrer nofollow",className:"btn bg-[#5865F2] text-white w-full font-bold text-lg",children:"Join Discord"})]})})]}),document.body)]})}const dc={},ui=t=>{let a;const s=new Set,i=(f,u)=>{const x=typeof f=="function"?f(a):f;if(!Object.is(x,a)){const p=a;a=u??(typeof x!="object"||x===null)?x:Object.assign({},a,x),s.forEach(g=>g(a,p))}},n=()=>a,d={setState:i,getState:n,getInitialState:()=>c,subscribe:f=>(s.add(f),()=>s.delete(f)),destroy:()=>{(dc?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},c=a=t(i,n,d);return d},mc=t=>t?ui(t):ui;var Ta={exports:{}},Ia={},Da={exports:{}},Ma={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hi;function uc(){if(hi)return Ma;hi=1;var t=wr();function a(u,x){return u===x&&(u!==0||1/u===1/x)||u!==u&&x!==x}var s=typeof Object.is=="function"?Object.is:a,i=t.useState,n=t.useEffect,r=t.useLayoutEffect,l=t.useDebugValue;function o(u,x){var p=x(),g=i({inst:{value:p,getSnapshot:x}}),S=g[0].inst,M=g[1];return r(function(){S.value=p,S.getSnapshot=x,d(S)&&M({inst:S})},[u,p,x]),n(function(){return d(S)&&M({inst:S}),u(function(){d(S)&&M({inst:S})})},[u]),l(p),p}function d(u){var x=u.getSnapshot;u=u.value;try{var p=x();return!s(u,p)}catch{return!0}}function c(u,x){return x()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return Ma.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:f,Ma}var fi;function hc(){return fi||(fi=1,Da.exports=uc()),Da.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xi;function fc(){if(xi)return Ia;xi=1;var t=wr(),a=hc();function s(c,f){return c===f&&(c!==0||1/c===1/f)||c!==c&&f!==f}var i=typeof Object.is=="function"?Object.is:s,n=a.useSyncExternalStore,r=t.useRef,l=t.useEffect,o=t.useMemo,d=t.useDebugValue;return Ia.useSyncExternalStoreWithSelector=function(c,f,u,x,p){var g=r(null);if(g.current===null){var S={hasValue:!1,value:null};g.current=S}else S=g.current;g=o(function(){function I(k){if(!N){if(N=!0,E=k,k=x(k),p!==void 0&&S.hasValue){var b=S.value;if(p(b,k))return A=b}return A=k}if(b=A,i(E,k))return b;var y=x(k);return p!==void 0&&p(b,y)?(E=k,b):(E=k,A=y)}var N=!1,E,A,D=u===void 0?null:u;return[function(){return I(f())},D===null?void 0:function(){return I(D())}]},[f,u,x,p]);var M=n(c,g[0],g[1]);return l(function(){S.hasValue=!0,S.value=M},[M]),d(M),M},Ia}var pi;function xc(){return pi||(pi=1,Ta.exports=fc()),Ta.exports}var pc=xc();const bc=da(pc),ko={},{useDebugValue:gc}=Bl,{useSyncExternalStoreWithSelector:yc}=bc;let bi=!1;const vc=t=>t;function jc(t,a=vc,s){(ko?"production":void 0)!=="production"&&s&&!bi&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),bi=!0);const i=yc(t.subscribe,t.getState,t.getServerState||t.getInitialState,a,s);return gc(i),i}const gi=t=>{(ko?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof t=="function"?mc(t):t,s=(i,n)=>jc(a,i,n);return Object.assign(s,a),s},on=t=>t?gi(t):gi;let Nc=1;const hr=on(t=>({toasts:[],push:(a,s)=>t(i=>{const n=Nc++,r={id:n,message:a,type:s?.type||"info",timeout:s?.timeout??3e3};return r.timeout&&r.timeout>0&&setTimeout(()=>{t(l=>({toasts:l.toasts.filter(o=>o.id!==n)}))},r.timeout),{toasts:[...i.toasts,r]}}),remove:a=>t(s=>({toasts:s.toasts.filter(i=>i.id!==a)})),clear:()=>t({toasts:[]})}));function wn(){return hr(a=>a.push)}function xt(t){return(t??0).toFixed(2)}const wc=t=>`ndn_stats_${t}`,Co=t=>`ndn_stats_ts_${t}`;function os(t){try{const a=localStorage.getItem(wc(t));if(!a)return{darts:0,scored:0};const s=JSON.parse(a);return{darts:Number(s.darts)||0,scored:Number(s.scored)||0,fnDarts:Number(s.fnDarts)||0,fnScored:Number(s.fnScored)||0,best3:typeof s.best3=="number"?s.best3:0,worst3:typeof s.worst3=="number"?s.worst3:0,bestLegDarts:typeof s.bestLegDarts=="number"?s.bestLegDarts:0,bestCheckout:typeof s.bestCheckout=="number"?s.bestCheckout:0,worstLegDarts:typeof s.worstLegDarts=="number"?s.worstLegDarts:0,bestFNAvg:typeof s.bestFNAvg=="number"?s.bestFNAvg:0,worstFNAvg:typeof s.worstFNAvg=="number"?s.worstFNAvg:0}}catch{return{darts:0,scored:0}}}function Ys(t){const{darts:a,scored:s}=os(t);return a?s/a*3:0}function Aa(t){const{fnDarts:a=0,fnScored:s=0}=os(t);return a?s/a*3:0}const Eo="ndn_game_mode_stats";function Sr(t){let a={};try{const s=localStorage.getItem(Eo);s&&(a=JSON.parse(s))}catch{}if(Array.isArray(t))for(const s of t)a[s]||(a[s]={played:0,won:0});return a}function Sc(t){try{localStorage.setItem(Eo,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{gameModes:!0}}))}catch{}}function kc(t,a){const s=Sr(),i=s[t]||{played:0,won:0};i.played+=1,a&&(i.won+=1),s[t]=i,Sc(s)}function ma(t){try{const a=localStorage.getItem(Co(t));if(!a)return[];const s=JSON.parse(a);return Array.isArray(s)?s.map(i=>({t:Number(i.t)||0,darts:Number(i.darts)||0,scored:Number(i.scored)||0,fnDarts:Number(i.fnDarts)||0,fnScored:Number(i.fnScored)||0})).filter(i=>i.t>0):[]}catch{return[]}}function Cc(t,a){try{localStorage.setItem(Co(t),JSON.stringify(a)),window.dispatchEvent(new CustomEvent("ndn:stats-updated",{detail:{name:t}}))}catch{}}function Ec(t,a){const s=Date.now();return t.filter(i=>s-i.t<=a)}function an(t,a,s,i=Date.now(),n,r){if(a<=0)return;const l=ma(t),o=Ec([...l,{t:i,darts:a,scored:s,fnDarts:n,fnScored:r}],1e3*60*60*24*30);Cc(t,o)}function Tc(t,a=1e3*60*60*24){const s=ma(t);if(!s.length)return 0;const i=Date.now();let n=0,r=0;for(const l of s)i-l.t<=a&&(n+=l.darts,r+=l.scored);return n<=0?0:r/n*3}function Ic(t,a=1e3*60*60*24*30){const s=ma(t);if(!s.length)return 0;const i=Date.now();let n=0,r=0;for(const l of s)i-l.t<=a&&(n+=l.fnDarts||0,r+=l.fnScored||0);return n<=0?0:r/n*3}function Pa(t){const s=ma(t);if(!s.length)return 0;const i=Date.now(),n=s.filter(c=>i-c.t<=2592e6),r=n.filter(c=>typeof c.fnDarts=="number"),l=r.length?r:n;let o=0,d=0;for(const c of l)o+=c.darts,d+=c.scored;return o<=0?0:d/o*3}function Ra(t){return Ic(t,2592e6)}const To="ndn_user_settings";function fr(){try{const t=localStorage.getItem(To);if(!t)return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,cameraEnabled:!0,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",textSize:"medium",boxSize:"medium"};const a=JSON.parse(t);return{favoriteDouble:a.favoriteDouble||"D16",callerEnabled:typeof a.callerEnabled=="boolean"?a.callerEnabled:!0,callerVoice:a.callerVoice||"",callerVolume:typeof a.callerVolume=="number"?Math.max(0,Math.min(1,a.callerVolume)):1,speakCheckoutOnly:!!a.speakCheckoutOnly,avgMode:a.avgMode==="24h"?"24h":"all-time",autoStartOffline:!!a.autoStartOffline,rememberLastOffline:typeof a.rememberLastOffline=="boolean"?a.rememberLastOffline:!0,lastOffline:a.lastOffline&&typeof a.lastOffline=="object"?{mode:a.lastOffline.mode||"X01",x01Start:Number(a.lastOffline.x01Start)||501,firstTo:Number(a.lastOffline.firstTo)||1,aiLevel:a.lastOffline.aiLevel||"None"}:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!!a.reducedMotion,compactHeader:!!a.compactHeader,allowSpectate:typeof a.allowSpectate=="boolean"?a.allowSpectate:!0,cameraScale:typeof a.cameraScale=="number"&&isFinite(a.cameraScale)?Math.max(.5,Math.min(1.25,a.cameraScale)):1,cameraAspect:a.cameraAspect==="square"?"square":"wide",autoscoreProvider:a.autoscoreProvider==="external-ws"?"external-ws":a.autoscoreProvider==="manual"?"manual":"built-in",autoscoreWsUrl:typeof a.autoscoreWsUrl=="string"?a.autoscoreWsUrl:"",calibrationGuide:typeof a.calibrationGuide=="boolean"?a.calibrationGuide:!0,preferredCameraId:typeof a.preferredCameraId=="string"?a.preferredCameraId:void 0,preferredCameraLabel:typeof a.preferredCameraLabel=="string"?a.preferredCameraLabel:void 0,preferredCameraLocked:typeof a.preferredCameraLocked=="boolean"?a.preferredCameraLocked:!1,cameraEnabled:typeof a.cameraEnabled=="boolean"?a.cameraEnabled:!0,offlineLayout:a.offlineLayout==="classic"?"classic":"modern",textSize:a.textSize==="small"||a.textSize==="large"?a.textSize:"medium",boxSize:a.boxSize==="small"||a.boxSize==="large"?a.boxSize:"medium"}}catch{return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preferredCameraLocked:!1,cameraEnabled:!0,offlineLayout:"modern",autoscoreProvider:"built-in",autoscoreWsUrl:"",textSize:"medium",boxSize:"medium"}}}function St(t){try{const a=fr();localStorage.setItem(To,JSON.stringify({...a,...t}))}catch{}}const ls=on((t,a)=>({...fr(),setFavoriteDouble:s=>{St({favoriteDouble:s}),t({favoriteDouble:s})},setCallerEnabled:s=>{St({callerEnabled:s}),t({callerEnabled:s})},setCallerVoice:s=>{St({callerVoice:s}),t({callerVoice:s})},setAvgMode:s=>{St({avgMode:s}),t({avgMode:s})},setCallerVolume:s=>{const i=Math.max(0,Math.min(1,s));St({callerVolume:i}),t({callerVolume:i})},setSpeakCheckoutOnly:s=>{St({speakCheckoutOnly:s}),t({speakCheckoutOnly:s})},setAutoStartOffline:s=>{St({autoStartOffline:s}),t({autoStartOffline:s})},setRememberLastOffline:s=>{St({rememberLastOffline:s}),t({rememberLastOffline:s})},setLastOffline:s=>{const n={...fr().lastOffline,...s};St({lastOffline:n}),t({lastOffline:n})},setReducedMotion:s=>{St({reducedMotion:s}),t({reducedMotion:s})},setCompactHeader:s=>{St({compactHeader:s}),t({compactHeader:s})},setAllowSpectate:s=>{St({allowSpectate:s}),t({allowSpectate:s})},setCameraScale:s=>{const i=Math.max(.5,Math.min(1.25,s));St({cameraScale:i}),t({cameraScale:i})},setCameraAspect:s=>{const i=s==="square"?"square":"wide";St({cameraAspect:i}),t({cameraAspect:i})},setAutoscoreProvider:s=>{St({autoscoreProvider:s}),t({autoscoreProvider:s})},setAutoscoreWsUrl:s=>{St({autoscoreWsUrl:s}),t({autoscoreWsUrl:s})},setCalibrationGuide:s=>{St({calibrationGuide:s}),t({calibrationGuide:s})},setPreferredCamera:(s,i,n=!1)=>{try{if(a().preferredCameraLocked&&!n)return}catch{}St({preferredCameraId:s,preferredCameraLabel:i}),t({preferredCameraId:s,preferredCameraLabel:i})},setPreferredCameraLocked:s=>{St({preferredCameraLocked:s}),t({preferredCameraLocked:s})},setCameraEnabled:s=>{St({cameraEnabled:s}),t({cameraEnabled:s})},setOfflineLayout:s=>{St({offlineLayout:s}),t({offlineLayout:s})},setTextSize:s=>{St({textSize:s}),t({textSize:s})},setBoxSize:s=>{St({boxSize:s}),t({boxSize:s})}}));function Zn(t){try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:t}}))}catch{}}const Dc="http://localhost:8787";function Mc({user:t}){const[a,s]=m.useState(!1),[i,n]=m.useState(!1),[r,l]=m.useState(""),{lastOffline:o}=ls(),d=wn();return m.useEffect(()=>{const c=["The fastest televised 9-darter took roughly 25 seconds!","A perfect leg (501) can be finished in nine darts.","The inner bull is worth 50; the outer bull is 25.","Standard dartboards are made from compressed sisal fibers.","Doubles and trebles are the thin outer and middle rings.","Professional oche (throw line) distance is 7 ft 9¼ in (2.37 m).","“Dartitis” is a real condition affecting a player’s throwing motion.","Phil Taylor holds a record number of World Championship titles.","Checkout routes often end on a double—classic “double-out”.","The highest 3-dart score is 180 (triple 20, triple 20, triple 20)."],f=Math.floor(Math.random()*c.length);l(c[f])},[]),e.jsxs("div",{className:`${t?.fullAccess?"premium-main":""} relative min-h-[600px] flex flex-col items-center justify-center overflow-hidden`,children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-700 via-indigo-500 to-blue-600 opacity-60 blur-2xl"}),e.jsx("div",{className:"absolute top-20 left-1/4 w-40 h-40 bg-pink-400 rounded-full opacity-30 blur-2xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-10 right-1/4 w-32 h-32 bg-blue-400 rounded-full opacity-30 blur-2xl animate-pulse"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-6xl mx-auto bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 lg:p-10 flex flex-col items-center",children:[e.jsx("h2",{className:"text-2xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-400 to-blue-400 mb-2 sm:mb-3 md:mb-4 drop-shadow-xl text-center leading-tight",children:"Welcome to Nine Dart Nation"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl lg:text-2xl text-white/80 mb-2 font-semibold text-center px-2",children:"Your home for competitive darts, stats, and online play."}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg text-white/60 mb-3 sm:mb-4 italic text-center px-2",children:'"Where every dart counts and every player matters."'}),r&&e.jsx("div",{className:"w-full mb-4 sm:mb-6 px-2 sm:px-0",children:e.jsxs("div",{className:"mx-auto max-w-xs sm:max-w-xl rounded-full px-3 sm:px-5 py-2 text-center text-indigo-100 bg-gradient-to-r from-indigo-600/80 to-fuchsia-600/80 shadow-md",children:[e.jsx("span",{className:"font-semibold text-sm sm:text-base",children:"Did you know?"})," ",e.jsx("span",{className:"opacity-90 text-sm sm:text-base",children:r})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4 md:gap-6 justify-center mb-6 md:mb-8 w-full max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>{Zn("offline");try{window.dispatchEvent(new CustomEvent("ndn:offline-format",{detail:{formatType:"first",formatCount:Number(o?.firstTo)||1,startScore:Number(o?.x01Start)||501}}))}catch{}try{setTimeout(()=>{window.dispatchEvent(new CustomEvent("ndn:auto-start",{detail:{mode:o?.mode||"X01"}}))},50)}catch{}},className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"🎯"})," Start New Match"]}),e.jsxs("button",{onClick:()=>Zn("stats"),className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"📊"})," View Stats"]}),e.jsxs("button",{onClick:()=>Zn("online"),className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-green-500 to-blue-400 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"🏆"})," Join Online League"]}),e.jsxs("button",{onClick:()=>{Zn("offline");try{window.dispatchEvent(new CustomEvent("ndn:auto-start",{detail:{mode:"Double Practice"}}))}catch{}},className:"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-pink-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation",children:[e.jsx("span",{"aria-hidden":!0,children:"💡"})," Practice Doubles"]})]}),(()=>{const c=t?.username||"Player 1",f=os(c),u=!!t?.fullAccess,x="grid grid-cols-[120px,1fr,1fr] sm:grid-cols-[160px,1fr,1fr]",p=({label:g,left:S,right:M,lock:I})=>e.jsxs("div",{className:`relative ${x} gap-2 items-center p-2 rounded-lg ${I?"bg-white/5 border border-white/10 overflow-hidden":"bg-indigo-500/10 border border-indigo-500/40"} mb-2`,children:[e.jsx("div",{className:"text-[12px] opacity-80 pl-2 text-left",children:g}),e.jsx("div",{className:`text-sm font-semibold text-center ${I?"opacity-50 blur-[0.5px]":""}`,children:S}),e.jsx("div",{className:`text-sm font-semibold text-center ${I?"opacity-50 blur-[0.5px]":""}`,children:M}),I&&e.jsx("button",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-slate-900/35 hover:bg-slate-900/45 transition",onClick:async()=>{try{const E=await(await fetch(`${Dc}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})})).json();E.ok&&E.url?window.location.href=E.url:E.error==="STRIPE_NOT_CONFIGURED"?d("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):d("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{d("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},title:"Unlock with PREMIUM",children:e.jsx("span",{className:"text-[12px] font-semibold",children:"Unlock PREMIUM"})})]});return e.jsxs("div",{className:"w-full mt-2 rounded-2xl p-2 sm:p-3 bg-white/5 border border-white/10 overflow-x-auto",children:[e.jsxs("div",{className:`${x} gap-2 mb-2 px-1 items-center min-w-[280px] sm:min-w-0`,children:[e.jsx("div",{className:"text-[12px] opacity-0 select-none",children:"label"}),e.jsx("div",{className:"text-[12px] font-semibold text-center",children:"BEST"}),e.jsx("div",{className:"text-[12px] font-semibold text-center",children:"WORST"})]}),e.jsx(p,{label:"3-dart avg",left:xt(f.best3||0),right:xt(f.worst3||0)}),e.jsx(p,{label:"9-dart avg",left:xt(f.bestFNAvg||0),right:xt(f.worstFNAvg||0),lock:!u}),e.jsx(p,{label:"Leg (darts)",left:String(f.bestLegDarts||0),right:String(f.worstLegDarts||0),lock:!u}),e.jsx(p,{label:"Checkout",left:String(f.bestCheckout||0),right:"—",lock:!u})]})})(),e.jsx("button",{className:"mt-6 sm:mt-8 md:mt-10 px-6 sm:px-8 md:px-10 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 text-base sm:text-lg md:text-xl touch-manipulation",onClick:()=>n(!0),children:"How to Play / Getting Started"})]}),e.jsx("footer",{className:"w-full py-2 md:py-2 text-center text-white/80 text-xs md:text-sm font-medium absolute bottom-0 left-0 z-20 flex items-center justify-center gap-1 md:gap-2",children:e.jsxs("button",{className:"flex items-center gap-1 md:gap-2 hover:text-white transition",onClick:()=>s(!0),children:[e.jsx("span",{children:"©"}),e.jsx("span",{style:{letterSpacing:"0.05em"},children:"NINEDARTNATION"})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>s(!1),children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Legal Information"}),e.jsxs("ul",{className:"list-disc pl-5 mb-2",children:[e.jsx("li",{children:"Terms & Conditions: All users must follow fair play and site rules."}),e.jsx("li",{children:"Privacy Policy: Your data is protected and never shared without consent."}),e.jsxs("li",{children:["Copyright © ",new Date().getFullYear()," NINEDARTNATION. All rights reserved."]}),e.jsx("li",{children:"Contact: support@ninedartnation.com"})]}),e.jsx("p",{className:"text-sm text-purple-200",children:"For full legal details, please contact us or visit our legal page."})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>n(!1),children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Getting Started"}),e.jsxs("ul",{className:"list-disc pl-5 mb-2",children:[e.jsx("li",{children:"Choose a game mode and invite friends or play solo."}),e.jsx("li",{children:"Track your stats and progress in the Stats tab."}),e.jsx("li",{children:"Join the BullseyeDartsLeague for online competition."}),e.jsx("li",{children:"Upgrade to PREMIUM for advanced features and modes."}),e.jsx("li",{children:"Need help? Visit the Settings tab for support and tips."})]}),e.jsx("p",{className:"text-sm text-purple-200",children:'Ready to play? Hit "Start New Match" and let the darts fly!'})]})})]})}function Ds({children:t,className:a,style:s}){const i=m.useRef(null);return m.useEffect(()=>{let n=0;const r=()=>{const d=i.current;if(!d)return;const c=document.getElementById("ndn-header");if(!c){d.style.clipPath="";return}const f=document.getElementById("ndn-main-scroll"),u=f?f.scrollTop:window.scrollY||0,x=c.getBoundingClientRect().height,p=u>0?x:0;d.style.marginTop=p>0?`${p}px`:"0px"};r();const l=()=>{n&&cancelAnimationFrame(n),n=requestAnimationFrame(r)},o=document.getElementById("ndn-main-scroll");return o?.addEventListener("scroll",l,{passive:!0}),window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l),()=>{o?.removeEventListener("scroll",l),window.removeEventListener("scroll",l),window.removeEventListener("resize",l),n&&cancelAnimationFrame(n)}},[]),e.jsx("div",{ref:i,className:a,style:s,children:t})}const Ac=({calibrationComplete:t})=>{const[a,s]=m.useState(!1),[i,n]=m.useState(!1);return m.useEffect(()=>{t?(s(!0),setTimeout(()=>n(!0),1200)):(s(!1),n(!1))},[t]),e.jsxs("div",{className:`flex flex-col items-center justify-center w-full h-full transition-opacity duration-700 ${i?"opacity-0":"opacity-100"}`,style:{pointerEvents:"none",position:"absolute",inset:0,zIndex:10},children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("svg",{width:"80",height:"80",viewBox:"0 0 80 80",className:`animate-spin-slow ${a?"opacity-0":"opacity-100"} transition-opacity duration-500`,style:{transition:"opacity 0.5s"},children:e.jsxs("g",{children:[e.jsx("rect",{x:"36",y:"10",width:"8",height:"40",rx:"3",fill:"#a78bfa"}),e.jsx("polygon",{points:"40,10 44,22 36,22",fill:"#f472b6"}),e.jsx("rect",{x:"36",y:"50",width:"8",height:"18",rx:"2",fill:"#22d3ee"}),e.jsx("polygon",{points:"36,68 44,68 40,78",fill:"#10b981"})]})}),a&&e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",className:"absolute",style:{left:0,top:0},children:[e.jsx("circle",{cx:"40",cy:"40",r:"32",fill:"none",stroke:"#10b981",strokeWidth:"6"}),e.jsx("polyline",{points:"28,44 38,54 54,30",fill:"none",stroke:"#10b981",strokeWidth:"6",strokeLinecap:"round",strokeLinejoin:"round"})]})]}),e.jsx("div",{className:"mt-4 text-lg font-semibold text-indigo-200",children:a?"Calibration Complete!":"Initializing Camera..."})]})};var vn={},La,yi;function Pc(){return yi||(yi=1,La=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),La}var Oa={},zs={},vi;function ln(){if(vi)return zs;vi=1;let t;const a=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return zs.getSymbolSize=function(i){if(!i)throw new Error('"version" cannot be null or undefined');if(i<1||i>40)throw new Error('"version" should be in range from 1 to 40');return i*4+17},zs.getSymbolTotalCodewords=function(i){return a[i]},zs.getBCHDigit=function(s){let i=0;for(;s!==0;)i++,s>>>=1;return i},zs.setToSJISFunction=function(i){if(typeof i!="function")throw new Error('"toSJISFunc" is not a valid function.');t=i},zs.isKanjiModeEnabled=function(){return typeof t<"u"},zs.toSJIS=function(i){return t(i)},zs}var Ba={},ji;function kr(){return ji||(ji=1,(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function a(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+s)}}t.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},t.from=function(i,n){if(t.isValid(i))return i;try{return a(i)}catch{return n}}})(Ba)),Ba}var Ua,Ni;function Rc(){if(Ni)return Ua;Ni=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(a){const s=Math.floor(a/8);return(this.buffer[s]>>>7-a%8&1)===1},put:function(a,s){for(let i=0;i<s;i++)this.putBit((a>>>s-i-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(a){const s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),a&&(this.buffer[s]|=128>>>this.length%8),this.length++}},Ua=t,Ua}var $a,wi;function Lc(){if(wi)return $a;wi=1;function t(a){if(!a||a<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=a,this.data=new Uint8Array(a*a),this.reservedBit=new Uint8Array(a*a)}return t.prototype.set=function(a,s,i,n){const r=a*this.size+s;this.data[r]=i,n&&(this.reservedBit[r]=!0)},t.prototype.get=function(a,s){return this.data[a*this.size+s]},t.prototype.xor=function(a,s,i){this.data[a*this.size+s]^=i},t.prototype.isReserved=function(a,s){return this.reservedBit[a*this.size+s]},$a=t,$a}var Fa={},Si;function Oc(){return Si||(Si=1,(function(t){const a=ln().getSymbolSize;t.getRowColCoords=function(i){if(i===1)return[];const n=Math.floor(i/7)+2,r=a(i),l=r===145?26:Math.ceil((r-13)/(2*n-2))*2,o=[r-7];for(let d=1;d<n-1;d++)o[d]=o[d-1]-l;return o.push(6),o.reverse()},t.getPositions=function(i){const n=[],r=t.getRowColCoords(i),l=r.length;for(let o=0;o<l;o++)for(let d=0;d<l;d++)o===0&&d===0||o===0&&d===l-1||o===l-1&&d===0||n.push([r[o],r[d]]);return n}})(Fa)),Fa}var _a={},ki;function Bc(){if(ki)return _a;ki=1;const t=ln().getSymbolSize,a=7;return _a.getPositions=function(i){const n=t(i);return[[0,0],[n-a,0],[0,n-a]]},_a}var Ha={},Ci;function Uc(){return Ci||(Ci=1,(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const a={N1:3,N2:3,N3:40,N4:10};t.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7},t.from=function(n){return t.isValid(n)?parseInt(n,10):void 0},t.getPenaltyN1=function(n){const r=n.size;let l=0,o=0,d=0,c=null,f=null;for(let u=0;u<r;u++){o=d=0,c=f=null;for(let x=0;x<r;x++){let p=n.get(u,x);p===c?o++:(o>=5&&(l+=a.N1+(o-5)),c=p,o=1),p=n.get(x,u),p===f?d++:(d>=5&&(l+=a.N1+(d-5)),f=p,d=1)}o>=5&&(l+=a.N1+(o-5)),d>=5&&(l+=a.N1+(d-5))}return l},t.getPenaltyN2=function(n){const r=n.size;let l=0;for(let o=0;o<r-1;o++)for(let d=0;d<r-1;d++){const c=n.get(o,d)+n.get(o,d+1)+n.get(o+1,d)+n.get(o+1,d+1);(c===4||c===0)&&l++}return l*a.N2},t.getPenaltyN3=function(n){const r=n.size;let l=0,o=0,d=0;for(let c=0;c<r;c++){o=d=0;for(let f=0;f<r;f++)o=o<<1&2047|n.get(c,f),f>=10&&(o===1488||o===93)&&l++,d=d<<1&2047|n.get(f,c),f>=10&&(d===1488||d===93)&&l++}return l*a.N3},t.getPenaltyN4=function(n){let r=0;const l=n.data.length;for(let d=0;d<l;d++)r+=n.data[d];return Math.abs(Math.ceil(r*100/l/5)-10)*a.N4};function s(i,n,r){switch(i){case t.Patterns.PATTERN000:return(n+r)%2===0;case t.Patterns.PATTERN001:return n%2===0;case t.Patterns.PATTERN010:return r%3===0;case t.Patterns.PATTERN011:return(n+r)%3===0;case t.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2===0;case t.Patterns.PATTERN101:return n*r%2+n*r%3===0;case t.Patterns.PATTERN110:return(n*r%2+n*r%3)%2===0;case t.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}t.applyMask=function(n,r){const l=r.size;for(let o=0;o<l;o++)for(let d=0;d<l;d++)r.isReserved(d,o)||r.xor(d,o,s(n,d,o))},t.getBestMask=function(n,r){const l=Object.keys(t.Patterns).length;let o=0,d=1/0;for(let c=0;c<l;c++){r(c),t.applyMask(c,n);const f=t.getPenaltyN1(n)+t.getPenaltyN2(n)+t.getPenaltyN3(n)+t.getPenaltyN4(n);t.applyMask(c,n),f<d&&(d=f,o=c)}return o}})(Ha)),Ha}var ea={},Ei;function Io(){if(Ei)return ea;Ei=1;const t=kr(),a=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return ea.getBlocksCount=function(n,r){switch(r){case t.L:return a[(n-1)*4+0];case t.M:return a[(n-1)*4+1];case t.Q:return a[(n-1)*4+2];case t.H:return a[(n-1)*4+3];default:return}},ea.getTotalCodewordsCount=function(n,r){switch(r){case t.L:return s[(n-1)*4+0];case t.M:return s[(n-1)*4+1];case t.Q:return s[(n-1)*4+2];case t.H:return s[(n-1)*4+3];default:return}},ea}var Wa={},Rn={},Ti;function $c(){if(Ti)return Rn;Ti=1;const t=new Uint8Array(512),a=new Uint8Array(256);return(function(){let i=1;for(let n=0;n<255;n++)t[n]=i,a[i]=n,i<<=1,i&256&&(i^=285);for(let n=255;n<512;n++)t[n]=t[n-255]})(),Rn.log=function(i){if(i<1)throw new Error("log("+i+")");return a[i]},Rn.exp=function(i){return t[i]},Rn.mul=function(i,n){return i===0||n===0?0:t[a[i]+a[n]]},Rn}var Ii;function Fc(){return Ii||(Ii=1,(function(t){const a=$c();t.mul=function(i,n){const r=new Uint8Array(i.length+n.length-1);for(let l=0;l<i.length;l++)for(let o=0;o<n.length;o++)r[l+o]^=a.mul(i[l],n[o]);return r},t.mod=function(i,n){let r=new Uint8Array(i);for(;r.length-n.length>=0;){const l=r[0];for(let d=0;d<n.length;d++)r[d]^=a.mul(n[d],l);let o=0;for(;o<r.length&&r[o]===0;)o++;r=r.slice(o)}return r},t.generateECPolynomial=function(i){let n=new Uint8Array([1]);for(let r=0;r<i;r++)n=t.mul(n,new Uint8Array([1,a.exp(r)]));return n}})(Wa)),Wa}var za,Di;function _c(){if(Di)return za;Di=1;const t=Fc();function a(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}return a.prototype.initialize=function(i){this.degree=i,this.genPoly=t.generateECPolynomial(this.degree)},a.prototype.encode=function(i){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(i.length+this.degree);n.set(i);const r=t.mod(n,this.genPoly),l=this.degree-r.length;if(l>0){const o=new Uint8Array(this.degree);return o.set(r,l),o}return r},za=a,za}var qa={},Va={},Ga={},Mi;function Do(){return Mi||(Mi=1,Ga.isValid=function(a){return!isNaN(a)&&a>=1&&a<=40}),Ga}var Ms={},Ai;function Mo(){if(Ai)return Ms;Ai=1;const t="[0-9]+",a="[A-Z $%*+\\-./:]+";let s="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";s=s.replace(/u/g,"\\u");const i="(?:(?![A-Z0-9 $%*+\\-./:]|"+s+`)(?:.|[\r
]))+`;Ms.KANJI=new RegExp(s,"g"),Ms.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Ms.BYTE=new RegExp(i,"g"),Ms.NUMERIC=new RegExp(t,"g"),Ms.ALPHANUMERIC=new RegExp(a,"g");const n=new RegExp("^"+s+"$"),r=new RegExp("^"+t+"$"),l=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Ms.testKanji=function(d){return n.test(d)},Ms.testNumeric=function(d){return r.test(d)},Ms.testAlphanumeric=function(d){return l.test(d)},Ms}var Pi;function cn(){return Pi||(Pi=1,(function(t){const a=Do(),s=Mo();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(r,l){if(!r.ccBits)throw new Error("Invalid mode: "+r);if(!a.isValid(l))throw new Error("Invalid version: "+l);return l>=1&&l<10?r.ccBits[0]:l<27?r.ccBits[1]:r.ccBits[2]},t.getBestModeForData=function(r){return s.testNumeric(r)?t.NUMERIC:s.testAlphanumeric(r)?t.ALPHANUMERIC:s.testKanji(r)?t.KANJI:t.BYTE},t.toString=function(r){if(r&&r.id)return r.id;throw new Error("Invalid mode")},t.isValid=function(r){return r&&r.bit&&r.ccBits};function i(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+n)}}t.from=function(r,l){if(t.isValid(r))return r;try{return i(r)}catch{return l}}})(Va)),Va}var Ri;function Hc(){return Ri||(Ri=1,(function(t){const a=ln(),s=Io(),i=kr(),n=cn(),r=Do(),l=7973,o=a.getBCHDigit(l);function d(x,p,g){for(let S=1;S<=40;S++)if(p<=t.getCapacity(S,g,x))return S}function c(x,p){return n.getCharCountIndicator(x,p)+4}function f(x,p){let g=0;return x.forEach(function(S){const M=c(S.mode,p);g+=M+S.getBitsLength()}),g}function u(x,p){for(let g=1;g<=40;g++)if(f(x,g)<=t.getCapacity(g,p,n.MIXED))return g}t.from=function(p,g){return r.isValid(p)?parseInt(p,10):g},t.getCapacity=function(p,g,S){if(!r.isValid(p))throw new Error("Invalid QR Code version");typeof S>"u"&&(S=n.BYTE);const M=a.getSymbolTotalCodewords(p),I=s.getTotalCodewordsCount(p,g),N=(M-I)*8;if(S===n.MIXED)return N;const E=N-c(S,p);switch(S){case n.NUMERIC:return Math.floor(E/10*3);case n.ALPHANUMERIC:return Math.floor(E/11*2);case n.KANJI:return Math.floor(E/13);case n.BYTE:default:return Math.floor(E/8)}},t.getBestVersionForData=function(p,g){let S;const M=i.from(g,i.M);if(Array.isArray(p)){if(p.length>1)return u(p,M);if(p.length===0)return 1;S=p[0]}else S=p;return d(S.mode,S.getLength(),M)},t.getEncodedBits=function(p){if(!r.isValid(p)||p<7)throw new Error("Invalid QR Code version");let g=p<<12;for(;a.getBCHDigit(g)-o>=0;)g^=l<<a.getBCHDigit(g)-o;return p<<12|g}})(qa)),qa}var Ja={},Li;function Wc(){if(Li)return Ja;Li=1;const t=ln(),a=1335,s=21522,i=t.getBCHDigit(a);return Ja.getEncodedBits=function(r,l){const o=r.bit<<3|l;let d=o<<10;for(;t.getBCHDigit(d)-i>=0;)d^=a<<t.getBCHDigit(d)-i;return(o<<10|d)^s},Ja}var Ka={},Ya,Oi;function zc(){if(Oi)return Ya;Oi=1;const t=cn();function a(s){this.mode=t.NUMERIC,this.data=s.toString()}return a.getBitsLength=function(i){return 10*Math.floor(i/3)+(i%3?i%3*3+1:0)},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(i){let n,r,l;for(n=0;n+3<=this.data.length;n+=3)r=this.data.substr(n,3),l=parseInt(r,10),i.put(l,10);const o=this.data.length-n;o>0&&(r=this.data.substr(n),l=parseInt(r,10),i.put(l,o*3+1))},Ya=a,Ya}var Xa,Bi;function qc(){if(Bi)return Xa;Bi=1;const t=cn(),a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(i){this.mode=t.ALPHANUMERIC,this.data=i}return s.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(n){let r;for(r=0;r+2<=this.data.length;r+=2){let l=a.indexOf(this.data[r])*45;l+=a.indexOf(this.data[r+1]),n.put(l,11)}this.data.length%2&&n.put(a.indexOf(this.data[r]),6)},Xa=s,Xa}var Qa,Ui;function Vc(){if(Ui)return Qa;Ui=1;const t=cn();function a(s){this.mode=t.BYTE,typeof s=="string"?this.data=new TextEncoder().encode(s):this.data=new Uint8Array(s)}return a.getBitsLength=function(i){return i*8},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(s){for(let i=0,n=this.data.length;i<n;i++)s.put(this.data[i],8)},Qa=a,Qa}var Za,$i;function Gc(){if($i)return Za;$i=1;const t=cn(),a=ln();function s(i){this.mode=t.KANJI,this.data=i}return s.getBitsLength=function(n){return n*13},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(i){let n;for(n=0;n<this.data.length;n++){let r=a.toSJIS(this.data[n]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);r=(r>>>8&255)*192+(r&255),i.put(r,13)}},Za=s,Za}var er={exports:{}},Fi;function Jc(){return Fi||(Fi=1,(function(t){var a={single_source_shortest_paths:function(s,i,n){var r={},l={};l[i]=0;var o=a.PriorityQueue.make();o.push(i,0);for(var d,c,f,u,x,p,g,S,M;!o.empty();){d=o.pop(),c=d.value,u=d.cost,x=s[c]||{};for(f in x)x.hasOwnProperty(f)&&(p=x[f],g=u+p,S=l[f],M=typeof l[f]>"u",(M||S>g)&&(l[f]=g,o.push(f,g),r[f]=c))}if(typeof n<"u"&&typeof l[n]>"u"){var I=["Could not find a path from ",i," to ",n,"."].join("");throw new Error(I)}return r},extract_shortest_path_from_predecessor_list:function(s,i){for(var n=[],r=i;r;)n.push(r),s[r],r=s[r];return n.reverse(),n},find_path:function(s,i,n){var r=a.single_source_shortest_paths(s,i,n);return a.extract_shortest_path_from_predecessor_list(r,n)},PriorityQueue:{make:function(s){var i=a.PriorityQueue,n={},r;s=s||{};for(r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);return n.queue=[],n.sorter=s.sorter||i.default_sorter,n},default_sorter:function(s,i){return s.cost-i.cost},push:function(s,i){var n={value:s,cost:i};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=a})(er)),er.exports}var _i;function Kc(){return _i||(_i=1,(function(t){const a=cn(),s=zc(),i=qc(),n=Vc(),r=Gc(),l=Mo(),o=ln(),d=Jc();function c(I){return unescape(encodeURIComponent(I)).length}function f(I,N,E){const A=[];let D;for(;(D=I.exec(E))!==null;)A.push({data:D[0],index:D.index,mode:N,length:D[0].length});return A}function u(I){const N=f(l.NUMERIC,a.NUMERIC,I),E=f(l.ALPHANUMERIC,a.ALPHANUMERIC,I);let A,D;return o.isKanjiModeEnabled()?(A=f(l.BYTE,a.BYTE,I),D=f(l.KANJI,a.KANJI,I)):(A=f(l.BYTE_KANJI,a.BYTE,I),D=[]),N.concat(E,A,D).sort(function(b,y){return b.index-y.index}).map(function(b){return{data:b.data,mode:b.mode,length:b.length}})}function x(I,N){switch(N){case a.NUMERIC:return s.getBitsLength(I);case a.ALPHANUMERIC:return i.getBitsLength(I);case a.KANJI:return r.getBitsLength(I);case a.BYTE:return n.getBitsLength(I)}}function p(I){return I.reduce(function(N,E){const A=N.length-1>=0?N[N.length-1]:null;return A&&A.mode===E.mode?(N[N.length-1].data+=E.data,N):(N.push(E),N)},[])}function g(I){const N=[];for(let E=0;E<I.length;E++){const A=I[E];switch(A.mode){case a.NUMERIC:N.push([A,{data:A.data,mode:a.ALPHANUMERIC,length:A.length},{data:A.data,mode:a.BYTE,length:A.length}]);break;case a.ALPHANUMERIC:N.push([A,{data:A.data,mode:a.BYTE,length:A.length}]);break;case a.KANJI:N.push([A,{data:A.data,mode:a.BYTE,length:c(A.data)}]);break;case a.BYTE:N.push([{data:A.data,mode:a.BYTE,length:c(A.data)}])}}return N}function S(I,N){const E={},A={start:{}};let D=["start"];for(let k=0;k<I.length;k++){const b=I[k],y=[];for(let $=0;$<b.length;$++){const Y=b[$],O=""+k+$;y.push(O),E[O]={node:Y,lastCount:0},A[O]={};for(let _=0;_<D.length;_++){const T=D[_];E[T]&&E[T].node.mode===Y.mode?(A[T][O]=x(E[T].lastCount+Y.length,Y.mode)-x(E[T].lastCount,Y.mode),E[T].lastCount+=Y.length):(E[T]&&(E[T].lastCount=Y.length),A[T][O]=x(Y.length,Y.mode)+4+a.getCharCountIndicator(Y.mode,N))}}D=y}for(let k=0;k<D.length;k++)A[D[k]].end=0;return{map:A,table:E}}function M(I,N){let E;const A=a.getBestModeForData(I);if(E=a.from(N,A),E!==a.BYTE&&E.bit<A.bit)throw new Error('"'+I+'" cannot be encoded with mode '+a.toString(E)+`.
 Suggested mode is: `+a.toString(A));switch(E===a.KANJI&&!o.isKanjiModeEnabled()&&(E=a.BYTE),E){case a.NUMERIC:return new s(I);case a.ALPHANUMERIC:return new i(I);case a.KANJI:return new r(I);case a.BYTE:return new n(I)}}t.fromArray=function(N){return N.reduce(function(E,A){return typeof A=="string"?E.push(M(A,null)):A.data&&E.push(M(A.data,A.mode)),E},[])},t.fromString=function(N,E){const A=u(N,o.isKanjiModeEnabled()),D=g(A),k=S(D,E),b=d.find_path(k.map,"start","end"),y=[];for(let $=1;$<b.length-1;$++)y.push(k.table[b[$]].node);return t.fromArray(p(y))},t.rawSplit=function(N){return t.fromArray(u(N,o.isKanjiModeEnabled()))}})(Ka)),Ka}var Hi;function Yc(){if(Hi)return Oa;Hi=1;const t=ln(),a=kr(),s=Rc(),i=Lc(),n=Oc(),r=Bc(),l=Uc(),o=Io(),d=_c(),c=Hc(),f=Wc(),u=cn(),x=Kc();function p(k,b){const y=k.size,$=r.getPositions(b);for(let Y=0;Y<$.length;Y++){const O=$[Y][0],_=$[Y][1];for(let T=-1;T<=7;T++)if(!(O+T<=-1||y<=O+T))for(let H=-1;H<=7;H++)_+H<=-1||y<=_+H||(T>=0&&T<=6&&(H===0||H===6)||H>=0&&H<=6&&(T===0||T===6)||T>=2&&T<=4&&H>=2&&H<=4?k.set(O+T,_+H,!0,!0):k.set(O+T,_+H,!1,!0))}}function g(k){const b=k.size;for(let y=8;y<b-8;y++){const $=y%2===0;k.set(y,6,$,!0),k.set(6,y,$,!0)}}function S(k,b){const y=n.getPositions(b);for(let $=0;$<y.length;$++){const Y=y[$][0],O=y[$][1];for(let _=-2;_<=2;_++)for(let T=-2;T<=2;T++)_===-2||_===2||T===-2||T===2||_===0&&T===0?k.set(Y+_,O+T,!0,!0):k.set(Y+_,O+T,!1,!0)}}function M(k,b){const y=k.size,$=c.getEncodedBits(b);let Y,O,_;for(let T=0;T<18;T++)Y=Math.floor(T/3),O=T%3+y-8-3,_=($>>T&1)===1,k.set(Y,O,_,!0),k.set(O,Y,_,!0)}function I(k,b,y){const $=k.size,Y=f.getEncodedBits(b,y);let O,_;for(O=0;O<15;O++)_=(Y>>O&1)===1,O<6?k.set(O,8,_,!0):O<8?k.set(O+1,8,_,!0):k.set($-15+O,8,_,!0),O<8?k.set(8,$-O-1,_,!0):O<9?k.set(8,15-O-1+1,_,!0):k.set(8,15-O-1,_,!0);k.set($-8,8,1,!0)}function N(k,b){const y=k.size;let $=-1,Y=y-1,O=7,_=0;for(let T=y-1;T>0;T-=2)for(T===6&&T--;;){for(let H=0;H<2;H++)if(!k.isReserved(Y,T-H)){let ae=!1;_<b.length&&(ae=(b[_]>>>O&1)===1),k.set(Y,T-H,ae),O--,O===-1&&(_++,O=7)}if(Y+=$,Y<0||y<=Y){Y-=$,$=-$;break}}}function E(k,b,y){const $=new s;y.forEach(function(H){$.put(H.mode.bit,4),$.put(H.getLength(),u.getCharCountIndicator(H.mode,k)),H.write($)});const Y=t.getSymbolTotalCodewords(k),O=o.getTotalCodewordsCount(k,b),_=(Y-O)*8;for($.getLengthInBits()+4<=_&&$.put(0,4);$.getLengthInBits()%8!==0;)$.putBit(0);const T=(_-$.getLengthInBits())/8;for(let H=0;H<T;H++)$.put(H%2?17:236,8);return A($,k,b)}function A(k,b,y){const $=t.getSymbolTotalCodewords(b),Y=o.getTotalCodewordsCount(b,y),O=$-Y,_=o.getBlocksCount(b,y),T=$%_,H=_-T,ae=Math.floor($/_),P=Math.floor(O/_),Z=P+1,se=ae-P,ze=new d(se);let ye=0;const Me=new Array(_),lt=new Array(_);let Ke=0;const ge=new Uint8Array(k.buffer);for(let le=0;le<_;le++){const Be=le<H?P:Z;Me[le]=ge.slice(ye,ye+Be),lt[le]=ze.encode(Me[le]),ye+=Be,Ke=Math.max(Ke,Be)}const Re=new Uint8Array($);let ct=0,Je,Ne;for(Je=0;Je<Ke;Je++)for(Ne=0;Ne<_;Ne++)Je<Me[Ne].length&&(Re[ct++]=Me[Ne][Je]);for(Je=0;Je<se;Je++)for(Ne=0;Ne<_;Ne++)Re[ct++]=lt[Ne][Je];return Re}function D(k,b,y,$){let Y;if(Array.isArray(k))Y=x.fromArray(k);else if(typeof k=="string"){let ae=b;if(!ae){const P=x.rawSplit(k);ae=c.getBestVersionForData(P,y)}Y=x.fromString(k,ae||40)}else throw new Error("Invalid data");const O=c.getBestVersionForData(Y,y);if(!O)throw new Error("The amount of data is too big to be stored in a QR Code");if(!b)b=O;else if(b<O)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+O+`.
`);const _=E(b,y,Y),T=t.getSymbolSize(b),H=new i(T);return p(H,b),g(H),S(H,b),I(H,y,0),b>=7&&M(H,b),N(H,_),isNaN($)&&($=l.getBestMask(H,I.bind(null,H,y))),l.applyMask($,H),I(H,y,$),{modules:H,version:b,errorCorrectionLevel:y,maskPattern:$,segments:Y}}return Oa.create=function(b,y){if(typeof b>"u"||b==="")throw new Error("No input text");let $=a.M,Y,O;return typeof y<"u"&&($=a.from(y.errorCorrectionLevel,a.M),Y=c.from(y.version),O=l.from(y.maskPattern),y.toSJISFunc&&t.setToSJISFunction(y.toSJISFunc)),D(b,Y,$,O)},Oa}var tr={},sr={},Wi;function Ao(){return Wi||(Wi=1,(function(t){function a(s){if(typeof s=="number"&&(s=s.toString()),typeof s!="string")throw new Error("Color should be defined as hex string");let i=s.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+s);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(r){return[r,r]}))),i.length===6&&i.push("F","F");const n=parseInt(i.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+i.slice(0,6).join("")}}t.getOptions=function(i){i||(i={}),i.color||(i.color={});const n=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,r=i.width&&i.width>=21?i.width:void 0,l=i.scale||4;return{width:r,scale:r?4:l,margin:n,color:{dark:a(i.color.dark||"#000000ff"),light:a(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},t.getScale=function(i,n){return n.width&&n.width>=i+n.margin*2?n.width/(i+n.margin*2):n.scale},t.getImageWidth=function(i,n){const r=t.getScale(i,n);return Math.floor((i+n.margin*2)*r)},t.qrToImageData=function(i,n,r){const l=n.modules.size,o=n.modules.data,d=t.getScale(l,r),c=Math.floor((l+r.margin*2)*d),f=r.margin*d,u=[r.color.light,r.color.dark];for(let x=0;x<c;x++)for(let p=0;p<c;p++){let g=(x*c+p)*4,S=r.color.light;if(x>=f&&p>=f&&x<c-f&&p<c-f){const M=Math.floor((x-f)/d),I=Math.floor((p-f)/d);S=u[o[M*l+I]?1:0]}i[g++]=S.r,i[g++]=S.g,i[g++]=S.b,i[g]=S.a}}})(sr)),sr}var zi;function Xc(){return zi||(zi=1,(function(t){const a=Ao();function s(n,r,l){n.clearRect(0,0,r.width,r.height),r.style||(r.style={}),r.height=l,r.width=l,r.style.height=l+"px",r.style.width=l+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(r,l,o){let d=o,c=l;typeof d>"u"&&(!l||!l.getContext)&&(d=l,l=void 0),l||(c=i()),d=a.getOptions(d);const f=a.getImageWidth(r.modules.size,d),u=c.getContext("2d"),x=u.createImageData(f,f);return a.qrToImageData(x.data,r,d),s(u,c,f),u.putImageData(x,0,0),c},t.renderToDataURL=function(r,l,o){let d=o;typeof d>"u"&&(!l||!l.getContext)&&(d=l,l=void 0),d||(d={});const c=t.render(r,l,d),f=d.type||"image/png",u=d.rendererOpts||{};return c.toDataURL(f,u.quality)}})(tr)),tr}var nr={},qi;function Qc(){if(qi)return nr;qi=1;const t=Ao();function a(n,r){const l=n.a/255,o=r+'="'+n.hex+'"';return l<1?o+" "+r+'-opacity="'+l.toFixed(2).slice(1)+'"':o}function s(n,r,l){let o=n+r;return typeof l<"u"&&(o+=" "+l),o}function i(n,r,l){let o="",d=0,c=!1,f=0;for(let u=0;u<n.length;u++){const x=Math.floor(u%r),p=Math.floor(u/r);!x&&!c&&(c=!0),n[u]?(f++,u>0&&x>0&&n[u-1]||(o+=c?s("M",x+l,.5+p+l):s("m",d,0),d=0,c=!1),x+1<r&&n[u+1]||(o+=s("h",f),f=0)):d++}return o}return nr.render=function(r,l,o){const d=t.getOptions(l),c=r.modules.size,f=r.modules.data,u=c+d.margin*2,x=d.color.light.a?"<path "+a(d.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",p="<path "+a(d.color.dark,"stroke")+' d="'+i(f,c,d.margin)+'"/>',g='viewBox="0 0 '+u+" "+u+'"',M='<svg xmlns="http://www.w3.org/2000/svg" '+(d.width?'width="'+d.width+'" height="'+d.width+'" ':"")+g+' shape-rendering="crispEdges">'+x+p+`</svg>
`;return typeof o=="function"&&o(null,M),M},nr}var Vi;function Zc(){if(Vi)return vn;Vi=1;const t=Pc(),a=Yc(),s=Xc(),i=Qc();function n(r,l,o,d,c){const f=[].slice.call(arguments,1),u=f.length,x=typeof f[u-1]=="function";if(!x&&!t())throw new Error("Callback required as last argument");if(x){if(u<2)throw new Error("Too few arguments provided");u===2?(c=o,o=l,l=d=void 0):u===3&&(l.getContext&&typeof c>"u"?(c=d,d=void 0):(c=d,d=o,o=l,l=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(o=l,l=d=void 0):u===2&&!l.getContext&&(d=o,o=l,l=void 0),new Promise(function(p,g){try{const S=a.create(o,d);p(r(S,l,d))}catch(S){g(S)}})}try{const p=a.create(o,d);c(null,r(p,l,d))}catch(p){c(p)}}return vn.create=a.create,vn.toCanvas=n.bind(null,s.render),vn.toDataURL=n.bind(null,s.renderToDataURL),vn.toString=n.bind(null,function(r,l,o){return i.render(r,o)}),vn}var ed=Zc();const Po=da(ed),td={};function Ro(t,a){let s;try{s=t()}catch{return}return{getItem:n=>{var r;const l=d=>d===null?null:JSON.parse(d,void 0),o=(r=s.getItem(n))!=null?r:null;return o instanceof Promise?o.then(l):l(o)},setItem:(n,r)=>s.setItem(n,JSON.stringify(r,void 0)),removeItem:n=>s.removeItem(n)}}const Wn=t=>a=>{try{const s=t(a);return s instanceof Promise?s:{then(i){return Wn(i)(s)},catch(i){return this}}}catch(s){return{then(i){return this},catch(i){return Wn(i)(s)}}}},sd=(t,a)=>(s,i,n)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:M=>M,version:0,merge:(M,I)=>({...I,...M}),...a},l=!1;const o=new Set,d=new Set;let c;try{c=r.getStorage()}catch{}if(!c)return t((...M)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...M)},i,n);const f=Wn(r.serialize),u=()=>{const M=r.partialize({...i()});let I;const N=f({state:M,version:r.version}).then(E=>c.setItem(r.name,E)).catch(E=>{I=E});if(I)throw I;return N},x=n.setState;n.setState=(M,I)=>{x(M,I),u()};const p=t((...M)=>{s(...M),u()},i,n);let g;const S=()=>{var M;if(!c)return;l=!1,o.forEach(N=>N(i()));const I=((M=r.onRehydrateStorage)==null?void 0:M.call(r,i()))||void 0;return Wn(c.getItem.bind(c))(r.name).then(N=>{if(N)return r.deserialize(N)}).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==r.version){if(r.migrate)return r.migrate(N.state,N.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return N.state}).then(N=>{var E;return g=r.merge(N,(E=i())!=null?E:p),s(g,!0),u()}).then(()=>{I?.(g,void 0),l=!0,d.forEach(N=>N(g))}).catch(N=>{I?.(void 0,N)})};return n.persist={setOptions:M=>{r={...r,...M},M.getStorage&&(c=M.getStorage())},clearStorage:()=>{c?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>S(),hasHydrated:()=>l,onHydrate:M=>(o.add(M),()=>{o.delete(M)}),onFinishHydration:M=>(d.add(M),()=>{d.delete(M)})},S(),g||p},nd=(t,a)=>(s,i,n)=>{let r={storage:Ro(()=>localStorage),partialize:S=>S,version:0,merge:(S,M)=>({...M,...S}),...a},l=!1;const o=new Set,d=new Set;let c=r.storage;if(!c)return t((...S)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...S)},i,n);const f=()=>{const S=r.partialize({...i()});return c.setItem(r.name,{state:S,version:r.version})},u=n.setState;n.setState=(S,M)=>{u(S,M),f()};const x=t((...S)=>{s(...S),f()},i,n);n.getInitialState=()=>x;let p;const g=()=>{var S,M;if(!c)return;l=!1,o.forEach(N=>{var E;return N((E=i())!=null?E:x)});const I=((M=r.onRehydrateStorage)==null?void 0:M.call(r,(S=i())!=null?S:x))||void 0;return Wn(c.getItem.bind(c))(r.name).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==r.version){if(r.migrate)return[!0,r.migrate(N.state,N.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,N.state];return[!1,void 0]}).then(N=>{var E;const[A,D]=N;if(p=r.merge(D,(E=i())!=null?E:x),s(p,!0),A)return f()}).then(()=>{I?.(p,void 0),p=i(),l=!0,d.forEach(N=>N(p))}).catch(N=>{I?.(void 0,N)})};return n.persist={setOptions:S=>{r={...r,...S},S.storage&&(c=S.storage)},clearStorage:()=>{c?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>g(),hasHydrated:()=>l,onHydrate:S=>(o.add(S),()=>{o.delete(S)}),onFinishHydration:S=>(d.add(S),()=>{d.delete(S)})},r.skipHydration||g(),p||x},ad=(t,a)=>"getStorage"in a||"serialize"in a||"deserialize"in a?((td?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),sd(t,a)):nd(t,a),rd=ad,Cr=on()(rd((t,a)=>({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1,_hydrated:!1,setCalibration:s=>t(i=>({...i,...s})),reset:()=>t({H:null,createdAt:null,errorPx:null,imageSize:null,anchors:null,locked:!1})}),{name:"ndn-calibration-v1",storage:Ro(()=>localStorage),onRehydrateStorage:()=>(t,a)=>{if(!(a||!t))try{if(t&&!t.H){const s=localStorage.getItem("ndn:calibration:v1");if(s){const i=JSON.parse(s);i&&(i.H||i.imageSize)&&t.setCalibration({H:i.H??null,createdAt:i.createdAt??null,errorPx:i.errorPx??null,imageSize:i.imageSize??null,anchors:i.anchors??null,locked:!!i.locked})}}t._hydrated=!0}catch{}}})),Ge={bullInner:6.35,bullOuter:15.9,trebleInner:99,trebleOuter:107,doubleInner:162,doubleOuter:170},id=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];function ua(t,a){const s=a.x,i=a.y,n=t[6]*s+t[7]*i+t[8],r=(t[0]*s+t[1]*i+t[2])/n,l=(t[3]*s+t[4]*i+t[5])/n;return{x:r,y:l}}function od(t,a,s){return[a*t[0],a*t[1],a*t[2],s*t[3],s*t[4],s*t[5],t[6],t[7],t[8]]}function ld(t){const a=t,s=a[0],i=a[1],n=a[2],r=a[3],l=a[4],o=a[5],d=a[6],c=a[7],f=a[8],u=l*f-o*c,x=n*c-i*f,p=i*o-n*l,g=o*d-r*f,S=s*f-n*d,M=n*r-s*o,I=r*c-l*d,N=i*d-s*c,E=s*l-i*r,A=s*u+i*g+n*I;if(Math.abs(A)<1e-12)throw new Error("Singular homography");return[u/A,x/A,p/A,g/A,S/A,M/A,I/A,N/A,E/A]}function xr(t,a){if(t.length<4||a.length<4)throw new Error("Need at least 4 correspondences");if(t.length!==a.length)throw new Error("Correspondences must have equal length");const s=[],i=[];for(let l=0;l<t.length;l++){const{x:o,y:d}=t[l],{x:c,y:f}=a[l];s.push([o,d,1,0,0,0,-c*o,-c*d]),i.push(c),s.push([0,0,0,o,d,1,-f*o,-f*d]),i.push(f)}const n=cd(s,i);return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],1]}function cd(t,a){const s=t.length,i=t[0].length,n=Array.from({length:i},()=>new Array(i).fill(0)),r=new Array(i).fill(0);for(let l=0;l<s;l++)for(let o=0;o<i;o++){r[o]+=t[l][o]*a[l];for(let d=0;d<i;d++)n[o][d]+=t[l][o]*t[l][d]}return dd(n,r)}function dd(t,a){const s=a.length,i=t.map((r,l)=>r.concat([a[l]]));for(let r=0;r<s;r++){let l=r;for(let o=r+1;o<s;o++)Math.abs(i[o][r])>Math.abs(i[l][r])&&(l=o);if(Math.abs(i[l][r])<1e-12)throw new Error("Singular matrix");if(l!==r){const o=i[r];i[r]=i[l],i[l]=o}for(let o=r+1;o<s;o++){const d=i[o][r]/i[r][r];for(let c=r;c<=s;c++)i[o][c]-=d*i[r][c]}}const n=new Array(s).fill(0);for(let r=s-1;r>=0;r--){let l=i[r][s];for(let o=r+1;o<s;o++)l-=i[r][o]*n[o];n[r]=l/i[r][r]}return n}function Ln(){const t=Ge.doubleOuter;return[{x:0,y:-t},{x:t,y:0},{x:0,y:t},{x:-t,y:0},{x:0,y:0},{x:0,y:-15.9}]}function Lo(t,a,s=256){const i=[];for(let n=0;n<s;n++){const r=n/s*Math.PI*2,l=ua(t,{x:a*Math.cos(r),y:a*Math.sin(r)});i.push(l)}return i}function pr(t,a,s){let i=0;for(let n=0;n<a.length;n++){const r=ua(t,a[n]),l=r.x-s[n].x,o=r.y-s[n].y;i+=l*l+o*o}return Math.sqrt(i/a.length)}function md(t,a){const s=ld(t);return ua(s,a)}function ud(t){const a=Math.hypot(t.x,t.y);let i=Math.atan2(t.y,t.x)*180/Math.PI;i=(i+360+90)%360;const n=id[Math.floor((360-i)%360/18)];return a<=Ge.bullInner?{base:50,ring:"INNER_BULL",sector:25,mult:2}:a<=Ge.bullOuter?{base:25,ring:"BULL",sector:25,mult:1}:a>=Ge.doubleOuter?{base:0,ring:"MISS",sector:null,mult:0}:a>=Ge.doubleInner?{base:n*2,ring:"DOUBLE",sector:n,mult:2}:a>=Ge.trebleOuter?{base:n,ring:"SINGLE",sector:n,mult:1}:a>=Ge.trebleInner?{base:n*3,ring:"TRIPLE",sector:n,mult:3}:{base:n,ring:"SINGLE",sector:n,mult:1}}function Oo(t,a,s="#10b981",i=2){if(a.length){t.save(),t.strokeStyle=s,t.lineWidth=i,t.beginPath(),t.moveTo(a[0].x,a[0].y);for(let n=1;n<a.length;n++)t.lineTo(a[n].x,a[n].y);t.closePath(),t.stroke(),t.restore()}}function hd(t,a,s="#f59e0b"){t.save(),t.strokeStyle=s,t.lineWidth=2,t.beginPath(),t.moveTo(a.x-8,a.y),t.lineTo(a.x+8,a.y),t.moveTo(a.x,a.y-8),t.lineTo(a.x,a.y+8),t.stroke(),t.restore()}function ia(t,a,s){return Math.max(a,Math.min(s,t))}function fd(t,a,s){const{width:i,data:n}=t,r=[[-1,0,1],[-2,0,2],[-1,0,1]],l=[[-1,-2,-1],[0,0,0],[1,2,1]];let o=0,d=0;for(let c=-1;c<=1;c++)for(let f=-1;f<=1;f++){const u=ia(a+f,0,i-1),p=(ia(s+c,0,t.height-1)*i+u)*4,g=n[p],S=n[p+1],M=n[p+2],I=.299*g+.587*S+.114*M;o+=I*r[c+1][f+1],d+=I*l[c+1][f+1]}return Math.hypot(o,d)}function xd(t,a,s=6){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),r=ia(Math.round(a.x),1,t.width-2),l=ia(Math.round(a.y),1,t.height-2);let o={x:r,y:l,mag:-1};for(let d=l-s;d<=l+s;d++)for(let c=r-s;c<=r+s;c++){if(c<=0||d<=0||c>=t.width-1||d>=t.height-1)continue;const f=fd(n,c,d);f>o.mag&&(o={x:c,y:d,mag:f})}return{x:o.x,y:o.y}}function pd(t,a,s=6){return a.map(i=>xd(t,i,s))}var ar,Gi;function Bo(){if(Gi)return ar;Gi=1;var t=t||{};return t.Image=function(a,s,i){this.width=a||0,this.height=s||0,this.data=i||[]},t.grayscale=function(a,s){for(var i=a.data,n=s.data,r=i.length,l=0,o=0;l<r;l+=4)n[o++]=i[l]*.299+i[l+1]*.587+i[l+2]*.114+.5&255;return s.width=a.width,s.height=a.height,s},t.threshold=function(a,s,i){var n=a.data,r=s.data,l=n.length,o=[],d;for(d=0;d<256;++d)o[d]=d<=i?0:255;for(d=0;d<l;++d)r[d]=o[n[d]];return s.width=a.width,s.height=a.height,s},t.adaptiveThreshold=function(a,s,i,n){var r=a.data,l=s.data,o=r.length,d=[],c;for(t.stackBoxBlur(a,s,i),c=0;c<768;++c)d[c]=c-255<=-n?255:0;for(c=0;c<o;++c)l[c]=d[r[c]-l[c]+255];return s.width=a.width,s.height=a.height,s},t.otsu=function(a){var s=a.data,i=s.length,n=[],r=0,l=0,o=0,d=0,c=0,f=0,u,x,p;for(p=0;p<256;++p)n[p]=0;for(p=0;p<i;++p)n[s[p]]++;for(p=0;p<256;++p)l+=n[p]*p;for(p=0;p<256;++p)if(d+=n[p],d!==0){if(c=i-d,c===0)break;o+=n[p]*p,u=o/d-(l-o)/c,x=d*c*u*u,x>f&&(f=x,r=p)}return r},t.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265],t.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13],t.BlurStack=function(){this.color=0,this.next=null},t.stackBoxBlur=function(a,s,i){var n=a.data,r=s.data,l=a.height,o=a.width,d=l-1,c=o-1,f=i+i+1,u=i+1,x=t.stackBoxBlurMult[i],p=t.stackBoxBlurShift[i],g,S,M,I,N,E,A,D,k,b;for(g=S=new t.BlurStack,b=1;b<f;++b)g=g.next=new t.BlurStack;for(g.next=S,N=0,k=0;k<l;++k){for(E=N,M=n[N],I=u*M,g=S,b=0;b<u;++b)g.color=M,g=g.next;for(b=1;b<u;++b)g.color=n[N+b],I+=g.color,g=g.next;for(g=S,D=0;D<o;++D)r[N++]=I*x>>>p,A=D+u,A=E+(A<c?A:c),I-=g.color-n[A],g.color=n[A],g=g.next}for(D=0;D<o;++D){for(N=D,E=N+o,M=r[N],I=u*M,g=S,b=0;b<u;++b)g.color=M,g=g.next;for(b=1;b<u;++b)g.color=r[E],I+=g.color,g=g.next,E+=o;for(g=S,k=0;k<l;++k)r[N]=I*x>>>p,A=k+u,A=D+(A<d?A:d)*o,I-=g.color-r[A],g.color=r[A],g=g.next,N+=o}return s},t.gaussianBlur=function(a,s,i,n){var r=t.gaussianKernel(n);return s.width=a.width,s.height=a.height,i.width=a.width,i.height=a.height,t.gaussianBlurFilter(a,i,r,!0),t.gaussianBlurFilter(i,s,r,!1),s},t.gaussianBlurFilter=function(a,s,i,n){var r=a.data,l=s.data,o=a.height,d=a.width,c=0,f=i.length>>1,u,x,p,g,S;for(p=0;p<o;++p)for(g=0;g<d;++g){for(x=0,S=-f;S<=f;++S)n?(u=c+S,(g+S<0||g+S>=d)&&(u=c)):(u=c+S*d,(p+S<0||p+S>=o)&&(u=c)),x+=i[f+S]*r[u];l[c++]=n?x:x+.5&255}return s},t.gaussianKernel=function(a){var s=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],i=[],n,r,l,o,d,c;if(a<=7&&a%2===1)i=s[a>>1];else{for(n=(a-1)*.5,r=.8+.3*(n-1),l=-.5/(r*r),o=0,c=0;c<a;++c)d=c-n,o+=i[c]=Math.exp(l*d*d);for(o=1/o,c=0;c<a;++c)i[c]*=o}return i},t.findContours=function(a,s){var i=a.width,n=a.height,r=[],l,o,d,c,f,u,x,p,g;for(l=t.binaryBorder(a,s),o=t.neighborhoodDeltas(i+2),d=i+3,f=1,p=0;p<n;++p,d+=2)for(g=0;g<i;++g,++d)c=l[d],c!==0&&(u=x=!1,c===1&&l[d-1]===0?u=!0:c>=1&&l[d+1]===0&&(x=!0),(u||x)&&(++f,r.push(t.borderFollowing(l,d,f,{x:g,y:p},x,o))));return r},t.borderFollowing=function(a,s,i,n,r,l){var o=[],d,c,f,u,x;o.hole=r,u=x=r?0:4;do if(u=u-1&7,d=s+l[u],a[d]!==0)break;while(u!==x);if(u===x)a[s]=-i,o.push({x:n.x,y:n.y});else for(c=s;;){x=u;do f=c+l[++u];while(a[f]===0);if(u&=7,u-1>>>0<x>>>0?a[c]=-i:a[c]===1&&(a[c]=i),o.push({x:n.x,y:n.y}),n.x+=t.neighborhood[u][0],n.y+=t.neighborhood[u][1],f===s&&c===d)break;c=f,u=u+4&7}return o},t.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],t.neighborhoodDeltas=function(a){for(var s=[],i=t.neighborhood.length,n=0;n<i;++n)s[n]=t.neighborhood[n][0]+t.neighborhood[n][1]*a;return s.concat(s)},t.approxPolyDP=function(a,s){var i={start_index:0,end_index:0},n={start_index:0,end_index:0},r=[],l=[],o=a.length,d,c,f,u,x,p,g,S,M,I,N;for(s*=s,N=0,M=0;M<3;++M)for(x=0,N=(N+n.start_index)%o,c=a[N],++N===o&&(N=0),I=1;I<o;++I)d=a[N],++N===o&&(N=0),g=d.x-c.x,S=d.y-c.y,u=g*g+S*S,u>x&&(x=u,n.start_index=I);for(x<=s?r.push({x:c.x,y:c.y}):(i.start_index=N,i.end_index=n.start_index+=i.start_index,n.start_index-=n.start_index>=o?o:0,n.end_index=i.start_index,n.end_index<n.start_index&&(n.end_index+=o),l.push({start_index:n.start_index,end_index:n.end_index}),l.push({start_index:i.start_index,end_index:i.end_index}));l.length!==0;){if(i=l.pop(),f=a[i.end_index%o],c=a[N=i.start_index%o],++N===o&&(N=0),i.end_index<=i.start_index+1)p=!0;else{for(x=0,g=f.x-c.x,S=f.y-c.y,M=i.start_index+1;M<i.end_index;++M)d=a[N],++N===o&&(N=0),u=Math.abs((d.y-c.y)*g-(d.x-c.x)*S),u>x&&(x=u,n.start_index=M);p=x*x<=s*(g*g+S*S)}p?r.push({x:c.x,y:c.y}):(n.end_index=i.end_index,i.end_index=n.start_index,l.push({start_index:n.start_index,end_index:n.end_index}),l.push({start_index:i.start_index,end_index:i.end_index}))}return r},t.warp=function(a,s,i,n){var r=a.data,l=s.data,o=a.width,d=a.height,c=0,f,u,x,p,g,S,M,I,N,E,A,D,k,b,y,$,Y,O,_,T,H,ae,P;for(k=t.getPerspectiveTransform(i,n-1),b=k[8],y=k[2],$=k[5],ae=0;ae<n;++ae)for(b+=k[7],y+=k[1],$+=k[4],Y=b,O=y,_=$,P=0;P<n;++P)Y+=k[6],O+=k[0],_+=k[3],T=O/Y,H=_/Y,f=T>>>0,u=f===o-1?f:f+1,x=T-f,p=1-x,g=H>>>0,S=g===d-1?g:g+1,M=H-g,I=1-M,N=E=g*o,A=D=S*o,l[c++]=I*(p*r[N+f]+x*r[E+u])+M*(p*r[A+f]+x*r[D+u])&255;return s.width=n,s.height=n,s},t.getPerspectiveTransform=function(a,s){var i=t.square2quad(a);return i[0]/=s,i[1]/=s,i[3]/=s,i[4]/=s,i[6]/=s,i[7]/=s,i},t.square2quad=function(a){var s=[],i,n,r,l,o,d,c;return i=a[0].x-a[1].x+a[2].x-a[3].x,n=a[0].y-a[1].y+a[2].y-a[3].y,i===0&&n===0?(s[0]=a[1].x-a[0].x,s[1]=a[2].x-a[1].x,s[2]=a[0].x,s[3]=a[1].y-a[0].y,s[4]=a[2].y-a[1].y,s[5]=a[0].y,s[6]=0,s[7]=0,s[8]=1):(r=a[1].x-a[2].x,l=a[3].x-a[2].x,o=a[1].y-a[2].y,d=a[3].y-a[2].y,c=r*d-l*o,s[6]=(i*d-l*n)/c,s[7]=(r*n-i*o)/c,s[8]=1,s[0]=a[1].x-a[0].x+s[6]*a[1].x,s[1]=a[3].x-a[0].x+s[7]*a[3].x,s[2]=a[0].x,s[3]=a[1].y-a[0].y+s[6]*a[1].y,s[4]=a[3].y-a[0].y+s[7]*a[3].y,s[5]=a[0].y),s},t.isContourConvex=function(a){var s=0,i=!0,n=a.length,r=0,l=0,o,d,c,f,u,x,p,g;for(d=a[n-1],o=a[0],u=o.x-d.x,x=o.y-d.y;r<n;++r){if(++l===n&&(l=0),d=o,o=a[l],p=o.x-d.x,g=o.y-d.y,c=p*x,f=g*u,s|=f>c?1:f<c?2:3,s===3){i=!1;break}u=p,x=g}return i},t.perimeter=function(a){for(var s=a.length,i=0,n=s-1,r=0,l,o;i<s;n=i++)l=a[i].x-a[n].x,o=a[i].y-a[n].y,r+=Math.sqrt(l*l+o*o);return r},t.minEdgeLength=function(a){for(var s=a.length,i=0,n=s-1,r=1/0,l,o,d;i<s;n=i++)o=a[i].x-a[n].x,d=a[i].y-a[n].y,l=o*o+d*d,l<r&&(r=l);return Math.sqrt(r)},t.countNonZero=function(a,s){var i=a.data,n=s.height,r=s.width,l=s.x+s.y*a.width,o=a.width-r,d=0,c,f;for(c=0;c<n;++c){for(f=0;f<r;++f)i[l++]!==0&&++d;l+=o}return d},t.binaryBorder=function(a,s){var i=a.data,n=a.height,r=a.width,l=0,o=0,d,c;for(c=-2;c<r;++c)s[o++]=0;for(d=0;d<n;++d){for(s[o++]=0,c=0;c<r;++c)s[o++]=i[l++]===0?0:1;s[o++]=0}for(c=-2;c<r;++c)s[o++]=0;return s},ar=t,ar}var rr,Ji;function bd(){if(Ji)return rr;Ji=1;var t=Bo(),a=a||{};return a.Marker=function(s,i){this.id=s,this.corners=i},a.Detector=function(){this.grey=new t.Image,this.thres=new t.Image,this.homography=new t.Image,this.binary=[],this.contours=[],this.polys=[],this.candidates=[]},a.Detector.prototype.detect=function(s){return t.grayscale(s,this.grey),t.adaptiveThreshold(this.grey,this.thres,2,7),this.contours=t.findContours(this.thres,this.binary),this.candidates=this.findCandidates(this.contours,s.width*.2,.05,10),this.candidates=this.clockwiseCorners(this.candidates),this.candidates=this.notTooNear(this.candidates,10),this.findMarkers(this.grey,this.candidates,49)},a.Detector.prototype.findCandidates=function(s,i,n,r){var l=[],o=s.length,d,c,f;for(this.polys=[],f=0;f<o;++f)d=s[f],d.length>=i&&(c=t.approxPolyDP(d,d.length*n),this.polys.push(c),c.length===4&&t.isContourConvex(c)&&t.minEdgeLength(c)>=r&&l.push(c));return l},a.Detector.prototype.clockwiseCorners=function(s){var i=s.length,n,r,l,o,d,c;for(c=0;c<i;++c)n=s[c][1].x-s[c][0].x,l=s[c][1].y-s[c][0].y,r=s[c][2].x-s[c][0].x,o=s[c][2].y-s[c][0].y,n*o-l*r<0&&(d=s[c][1],s[c][1]=s[c][3],s[c][3]=d);return s},a.Detector.prototype.notTooNear=function(s,i){var n=[],r=s.length,l,o,d,c,f,u;for(c=0;c<r;++c)for(f=c+1;f<r;++f){for(l=0,u=0;u<4;++u)o=s[c][u].x-s[f][u].x,d=s[c][u].y-s[f][u].y,l+=o*o+d*d;l/4<i*i&&(t.perimeter(s[c])<t.perimeter(s[f])?s[c].tooNear=!0:s[f].tooNear=!0)}for(c=0;c<r;++c)s[c].tooNear||n.push(s[c]);return n},a.Detector.prototype.findMarkers=function(s,i,n){var r=[],l=i.length,o,d,c;for(c=0;c<l;++c)o=i[c],t.warp(s,this.homography,o,n),t.threshold(this.homography,this.homography,t.otsu(this.homography)),d=this.getMarker(this.homography,o),d&&r.push(d);return r},a.Detector.prototype.getMarker=function(s,i){var n=s.width/7>>>0,r=n*n>>1,l=[],o=[],d=[],c,f,u,x,p;for(x=0;x<7;++x)for(u=x===0||x===6?1:6,p=0;p<7;p+=u)if(c={x:p*n,y:x*n,width:n,height:n},t.countNonZero(s,c)>r)return null;for(x=0;x<5;++x)for(l[x]=[],p=0;p<5;++p)c={x:(p+1)*n,y:(x+1)*n,width:n,height:n},l[x][p]=t.countNonZero(s,c)>r?1:0;for(o[0]=l,d[0]=this.hammingDistance(o[0]),f={first:d[0],second:0},x=1;x<4;++x)o[x]=this.rotate(o[x-1]),d[x]=this.hammingDistance(o[x]),d[x]<f.first&&(f.first=d[x],f.second=x);return f.first!==0?null:new a.Marker(this.mat2id(o[f.second]),this.rotate2(i,4-f.second))},a.Detector.prototype.hammingDistance=function(s){var i=[[1,0,0,0,0],[1,0,1,1,1],[0,1,0,0,1],[0,1,1,1,0]],n=0,r,l,o,d,c;for(o=0;o<5;++o){for(l=1/0,d=0;d<4;++d){for(r=0,c=0;c<5;++c)r+=s[o][c]===i[d][c]?0:1;r<l&&(l=r)}n+=l}return n},a.Detector.prototype.mat2id=function(s){var i=0,n;for(n=0;n<5;++n)i<<=1,i|=s[n][1],i<<=1,i|=s[n][3];return i},a.Detector.prototype.rotate=function(s){var i=[],n=s.length,r,l;for(r=0;r<n;++r)for(i[r]=[],l=0;l<s[r].length;++l)i[r][l]=s[s[r].length-l-1][r];return i},a.Detector.prototype.rotate2=function(s,i){var n=[],r=s.length,l;for(l=0;l<r;++l)n[l]=s[(i+l)%r];return n},rr=a,rr}var ir,Ki;function Er(){if(Ki)return ir;Ki=1;var t=t||{};return t.svdcmp=function(a,s,i,n,r){var l,o,d,c,f,u,x,p,g=0,S,M,I=0,N,E,A=0,D,k,b,y=[];for(o=0;o<i;++o){if(x=o+1,y[o]=A*I,I=E=A=0,o<s){for(u=o;u<s;++u)A+=Math.abs(a[u][o]);if(A!==0){for(u=o;u<s;++u)a[u][o]/=A,E+=a[u][o]*a[u][o];for(M=a[o][o],I=-t.sign(Math.sqrt(E),M),N=M*I-E,a[o][o]=M-I,c=x;c<i;++c){for(E=0,u=o;u<s;++u)E+=a[u][o]*a[u][c];for(M=E/N,u=o;u<s;++u)a[u][c]+=M*a[u][o]}for(u=o;u<s;++u)a[u][o]*=A}}if(n[o]=A*I,I=E=A=0,o<s&&o!==i-1){for(u=x;u<i;++u)A+=Math.abs(a[o][u]);if(A!==0){for(u=x;u<i;++u)a[o][u]/=A,E+=a[o][u]*a[o][u];for(M=a[o][x],I=-t.sign(Math.sqrt(E),M),N=M*I-E,a[o][x]=M-I,u=x;u<i;++u)y[u]=a[o][u]/N;for(c=x;c<s;++c){for(E=0,u=x;u<i;++u)E+=a[c][u]*a[o][u];for(u=x;u<i;++u)a[c][u]+=E*y[u]}for(u=x;u<i;++u)a[o][u]*=A}}g=Math.max(g,Math.abs(n[o])+Math.abs(y[o]))}for(o=i-1;o>=0;--o){if(o<i-1){if(I!==0){for(c=x;c<i;++c)r[c][o]=a[o][c]/a[o][x]/I;for(c=x;c<i;++c){for(E=0,u=x;u<i;++u)E+=a[o][u]*r[u][c];for(u=x;u<i;++u)r[u][c]+=E*r[u][o]}}for(c=x;c<i;++c)r[o][c]=r[c][o]=0}r[o][o]=1,I=y[o],x=o}for(o=Math.min(i,s)-1;o>=0;--o){for(x=o+1,I=n[o],c=x;c<i;++c)a[o][c]=0;if(I!==0){for(I=1/I,c=x;c<i;++c){for(E=0,u=x;u<s;++u)E+=a[u][o]*a[u][c];for(M=E/a[o][o]*I,u=o;u<s;++u)a[u][c]+=M*a[u][o]}for(c=o;c<s;++c)a[c][o]*=I}else for(c=o;c<s;++c)a[c][o]=0;++a[o][o]}for(u=i-1;u>=0;--u)for(d=1;d<=30;++d){for(l=!0,x=u;x>=0;--x){if(p=x-1,Math.abs(y[x])+g===g){l=!1;break}if(Math.abs(n[p])+g===g)break}if(l)for(S=0,E=1,o=x;o<=u&&(M=E*y[o],Math.abs(M)+g!==g);++o)for(I=n[o],N=t.pythag(M,I),n[o]=N,N=1/N,S=I*N,E=-M*N,c=1;c<=s;++c)k=a[c][p],b=a[c][o],a[c][p]=k*S+b*E,a[c][o]=b*S-k*E;if(b=n[u],x===u){if(b<0)for(n[u]=-b,c=0;c<i;++c)r[c][u]=-r[c][u];break}if(d===30)return!1;for(D=n[x],p=u-1,k=n[p],I=y[p],N=y[u],M=((k-b)*(k+b)+(I-N)*(I+N))/(2*N*k),I=t.pythag(M,1),M=((D-b)*(D+b)+N*(k/(M+t.sign(I,M))-N))/D,S=E=1,c=x;c<=p;++c){for(o=c+1,I=y[o],k=n[o],N=E*I,I=S*I,b=t.pythag(M,N),y[c]=b,S=M/b,E=N/b,M=D*S+I*E,I=I*S-D*E,N=k*E,k*=S,f=0;f<i;++f)D=r[f][c],b=r[f][o],r[f][c]=D*S+b*E,r[f][o]=b*S-D*E;for(b=t.pythag(M,N),n[c]=b,b!==0&&(b=1/b,S=M*b,E=N*b),M=S*I+E*k,D=S*k-E*I,f=0;f<s;++f)k=a[f][c],b=a[f][o],a[f][c]=k*S+b*E,a[f][o]=b*S-k*E}y[x]=0,y[u]=M,n[u]=D}return!0},t.pythag=function(a,s){var i=Math.abs(a),n=Math.abs(s),r;return i>n?(r=n/i,i*Math.sqrt(1+r*r)):n===0?0:(r=i/n,n*Math.sqrt(1+r*r))},t.sign=function(a,s){return s>=0?Math.abs(a):-Math.abs(a)},ir=t,ir}var or,Yi;function gd(){if(Yi)return or;Yi=1;var t=Er(),a=a||{};return a.Posit=function(s,i){this.objectPoints=this.buildModel(s),this.focalLength=i,this.objectVectors=[],this.objectNormal=[],this.objectMatrix=[[],[],[]],this.init()},a.Posit.prototype.buildModel=function(s){var i=s/2;return[[-i,i,0],[i,i,0],[i,-i,0],[-i,-i,0]]},a.Posit.prototype.init=function(){var s=this.objectPoints.length,i=[],n=[],r=0,l=2,o;for(o=0;o<s;++o)this.objectVectors[o]=[this.objectPoints[o][0]-this.objectPoints[0][0],this.objectPoints[o][1]-this.objectPoints[0][1],this.objectPoints[o][2]-this.objectPoints[0][2]],i[o]=[this.objectVectors[o][0],this.objectVectors[o][1],this.objectVectors[o][2]];for(;r===0;)n[0]=this.objectVectors[1][1]*this.objectVectors[l][2]-this.objectVectors[1][2]*this.objectVectors[l][1],n[1]=this.objectVectors[1][2]*this.objectVectors[l][0]-this.objectVectors[1][0]*this.objectVectors[l][2],n[2]=this.objectVectors[1][0]*this.objectVectors[l][1]-this.objectVectors[1][1]*this.objectVectors[l][0],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),++l;for(o=0;o<3;++o)this.objectNormal[o]=n[o]/r;a.pseudoInverse(i,s,this.objectMatrix)},a.Posit.prototype.pose=function(s){var i=[[],[],[]],n=[[],[],[]],r=[],l=[[],[],[]],o=[[],[],[]],d=[],c=[],f,u,x,p,g,S;for(this.pos(s,i,n,r),x=this.isValid(i,r),x?f=this.iterate(s,i,r,l,d):f={euclidean:-1,pixels:-1,maximum:-1},p=this.isValid(n,r),p?u=this.iterate(s,n,r,o,c):u={euclidean:-1,pixels:-1,maximum:-1},g=0;g<3;++g)for(S=0;S<3;++S)x&&(d[g]-=l[g][S]*this.objectPoints[0][S]),p&&(c[g]-=o[g][S]*this.objectPoints[0][S]);return f.euclidean<u.euclidean?new a.Pose(f.pixels,l,d,u.pixels,o,c):new a.Pose(u.pixels,o,c,f.pixels,l,d)},a.Posit.prototype.pos=function(s,i,n,r){var l=this.objectPoints.length,o=[],d=[],c=[],f=[],u=[],x=[],p=[],g=[],S,M,I,N,E,A,D,k,b,y;for(b=0;b<l;++b)o[b]=[s[b].x-s[0].x,s[b].y-s[0].y];for(b=0;b<3;++b)for(d[b]=0,c[b]=0,y=0;y<l;++y)d[b]+=this.objectMatrix[b][y]*o[y][0],c[b]+=this.objectMatrix[b][y]*o[y][1];for(S=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],M=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],I=d[0]*c[0]+d[1]*c[1]+d[2]*c[2],N=(M-S)*(M-S)+4*(I*I),M-S>=0?E=(M-S+Math.sqrt(N))/2:E=(M-S-Math.sqrt(N))/2,E>=0?(A=Math.sqrt(E),A===0?D=0:D=-I/A):(A=Math.sqrt(-(I*I)/E),A===0?D=Math.sqrt(S-M):D=-I/A),b=0;b<3;++b)f[b]=d[b]+A*this.objectNormal[b],u[b]=c[b]+D*this.objectNormal[b];for(k=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),b=0;b<3;++b)x[b]=f[b]/k,p[b]=u[b]/k;for(g[0]=x[1]*p[2]-x[2]*p[1],g[1]=x[2]*p[0]-x[0]*p[2],g[2]=x[0]*p[1]-x[1]*p[0],b=0;b<3;++b)i[0][b]=x[b],i[1][b]=p[b],i[2][b]=g[b];for(b=0;b<3;++b)f[b]=d[b]-A*this.objectNormal[b],u[b]=c[b]-D*this.objectNormal[b];for(b=0;b<3;++b)x[b]=f[b]/k,p[b]=u[b]/k;for(g[0]=x[1]*p[2]-x[2]*p[1],g[1]=x[2]*p[0]-x[0]*p[2],g[2]=x[0]*p[1]-x[1]*p[0],b=0;b<3;++b)n[0][b]=x[b],n[1][b]=p[b],n[2][b]=g[b];r[0]=s[0].x/k,r[1]=s[0].y/k,r[2]=this.focalLength/k},a.Posit.prototype.isValid=function(s,i){for(var n=this.objectPoints.length,r=1/0,l=0,o;l<n;++l)o=i[2]+(s[2][0]*this.objectVectors[l][0]+s[2][1]*this.objectVectors[l][1]+s[2][2]*this.objectVectors[l][2]),o<r&&(r=o);return r>=0},a.Posit.prototype.iterate=function(s,i,n,r,l){var o=this.objectPoints.length,d=[],c=[],f=[[],[],[]],u=[[],[],[]],x=[],p=[],g=!1,S=0,M,I,N,E,A,D,k,b,y;for(b=0;b<o;++b)d[b]={x:s[b].x,y:s[b].y};for(b=0;b<3;++b){for(y=0;y<3;++y)r[b][y]=i[b][y];l[b]=n[b]}for(b=0;b<o;++b){for(N=0,y=0;y<3;++y)N+=this.objectVectors[b][y]*r[2][y]/l[2];c[b]={x:(1+N)*s[b].x,y:(1+N)*s[b].y}}for(I=0,b=0;b<o;++b)I+=Math.abs(c[b].x-d[b].x),I+=Math.abs(c[b].y-d[b].y);for(b=0;b<3;++b)x[b]=l[b]-(r[b][0]*this.objectPoints[0][0]+r[b][1]*this.objectPoints[0][1]+r[b][2]*this.objectPoints[0][2]);for(E=A=this.error(s,r,x),g=A.pixels===0||I<.01;S++<100&&!g;){for(b=0;b<o;++b)d[b].x=c[b].x,d[b].y=c[b].y;for(this.pos(c,f,u,l),b=0;b<3;++b)x[b]=l[b]-(f[b][0]*this.objectPoints[0][0]+f[b][1]*this.objectPoints[0][1]+f[b][2]*this.objectPoints[0][2]),p[b]=l[b]-(u[b][0]*this.objectPoints[0][0]+u[b][1]*this.objectPoints[0][1]+u[b][2]*this.objectPoints[0][2]);if(A=this.error(s,f,x),D=this.error(s,u,p),A.euclidean>=0&&D.euclidean>=0)if(D.euclidean<A.euclidean)for(E=D,b=0;b<3;++b)for(y=0;y<3;++y)r[b][y]=u[b][y];else for(E=A,b=0;b<3;++b)for(y=0;y<3;++y)r[b][y]=f[b][y];if(A.euclidean<0&&D.euclidean>=0)for(E=D,b=0;b<3;++b)for(y=0;y<3;++y)r[b][y]=u[b][y];if(D.euclidean<0&&A.euclidean>=0)for(E=A,b=0;b<3;++b)for(y=0;y<3;++y)r[b][y]=f[b][y];for(b=0;b<o;++b){for(N=0,y=0;y<3;++y)N+=this.objectVectors[b][y]*r[2][y]/l[2];c[b].x=(1+N)*s[b].x,c[b].y=(1+N)*s[b].y}for(M=I,I=0,b=0;b<o;++b)I+=Math.abs(c[b].x-d[b].x),I+=Math.abs(c[b].y-d[b].y);k=Math.abs(I-M),g=E.pixels===0||k<.01}return E},a.Posit.prototype.error=function(s,i,n){var r=this.objectPoints.length,l=[],o=[],d=[],c=0,f=0,u=0,x,p,g;if(!this.isValid(i,n))return{euclidean:-1,pixels:-1,maximum:-1};for(x=0;x<r;++x)for(l[x]=[],p=0;p<3;++p)l[x][p]=n[p];for(x=0;x<r;++x)for(p=0;p<3;++p)for(g=0;g<3;++g)l[x][p]+=i[p][g]*this.objectPoints[x][g];for(x=0;x<r;++x)for(o[x]=[],p=0;p<2;++p)o[x][p]=this.focalLength*l[x][p]/l[x][2];for(x=0;x<r;++x)d[x]=[o[x][0]-s[x].x,o[x][1]-s[x].y];for(x=0;x<r;++x)c+=Math.sqrt(d[x][0]*d[x][0]+d[x][1]*d[x][1]),f+=Math.abs(Math.round(o[x][0])-Math.round(s[x].x))+Math.abs(Math.round(o[x][1])-Math.round(s[x].y)),Math.abs(d[x][0])>u&&(u=Math.abs(d[x][0])),Math.abs(d[x][1])>u&&(u=Math.abs(d[x][1]));return{euclidean:c/r,pixels:f,maximum:u}},a.pseudoInverse=function(s,i,n){var r=[],l=[[],[],[]],o=[[],[],[]],d=0,c=0,f,u,x;for(t.svdcmp(s,i,3,r,l),f=0;f<3;++f)r[f]>d&&(d=r[f]);for(d*=.01,f=0;f<3;++f)r[f]<d&&(r[f]=0);for(u=0;u<3;++u)if(r[u]===0)for(++c,x=u;x<2;++x){for(f=0;f<i;++f)s[f][x]=s[f][x+1];for(f=0;f<3;++f)l[f][x]=l[f][x+1]}for(u=0;u<2;++u)r[u]===0&&(r[u]=r[u+1]);for(f=0;f<3;++f)for(u=0;u<3-c;++u)o[f][u]=l[f][u]/r[u];for(f=0;f<3;++f)for(u=0;u<i;++u)for(n[f][u]=0,x=0;x<3-c;++x)n[f][u]+=o[f][x]*s[u][x]},a.Pose=function(s,i,n,r,l,o){this.bestError=s,this.bestRotation=i,this.bestTranslation=n,this.alternativeError=r,this.alternativeRotation=l,this.alternativeTranslation=o},or=a,or}var lr,Xi;function yd(){if(Xi)return lr;Xi=1;var t=Er(),a=a||{};a.Posit=function(n,r){this.model=this.buildModel(n),this.focalLength=r,this.init()},a.Posit.prototype.buildModel=function(n){var r=n/2;return[new s(-r,r,0),new s(r,r,0),new s(r,-r,0),new s(-r,-r,0)]},a.Posit.prototype.init=function(){var n=new s,r=new i,l;this.modelVectors=i.fromRows(s.sub(this.model[1],this.model[0]),s.sub(this.model[2],this.model[0]),s.sub(this.model[3],this.model[0])),l=i.clone(this.modelVectors),t.svdcmp(l.m,3,3,n.v,r.m),this.modelPseudoInverse=i.mult(i.mult(r,i.fromDiagonal(s.inverse(n))),i.transpose(l)),this.modelNormal=r.column(n.minIndex())},a.Posit.prototype.pose=function(n){var r=new s(1,1,1),l=new i,o=new i,d=new s,c=new s,f,u;return this.pos(n,r,l,o,d,c),f=this.iterate(n,l,d),u=this.iterate(n,o,c),f<u?new a.Pose(f,l.m,d.v,u,o.m,c.v):new a.Pose(u,o.m,c.v,f,l.m,d.v)},a.Posit.prototype.pos=function(n,r,l,o,d,c){var f=new s(n[1].x,n[2].x,n[3].x),u=new s(n[1].y,n[2].y,n[3].y),x=s.addScalar(s.mult(f,r),-n[0].x),p=s.addScalar(s.mult(u,r),-n[0].y),g=i.multVector(this.modelPseudoInverse,x),S=i.multVector(this.modelPseudoInverse,p),M=S.square()-g.square(),I=s.dot(g,S),N=0,E=0,A,D,k,b,y,$,Y,O,_;M===0?(N=Math.sqrt(Math.abs(2*I)),E=-Math.PI/2*(I<0?-1:I>0?1:0)):(N=Math.sqrt(Math.sqrt(M*M+4*I*I)),E=Math.atan(-2*I/M),M<0&&(E+=Math.PI),E/=2),O=N*Math.cos(E),_=N*Math.sin(E),A=s.add(g,s.multScalar(this.modelNormal,O)),D=s.add(S,s.multScalar(this.modelNormal,_)),b=A.normalize(),y=D.normalize(),k=s.cross(A,D),l.copy(i.fromRows(A,D,k)),$=(b+y)/2,Y=i.multVector(l,this.model[0]),d.v=[n[0].x/$-Y.v[0],n[0].y/$-Y.v[1],this.focalLength/$],A=s.sub(g,s.multScalar(this.modelNormal,O)),D=s.sub(S,s.multScalar(this.modelNormal,_)),b=A.normalize(),y=D.normalize(),k=s.cross(A,D),o.copy(i.fromRows(A,D,k)),$=(b+y)/2,Y=i.multVector(o,this.model[0]),c.v=[n[0].x/$-Y.v[0],n[0].y/$-Y.v[1],this.focalLength/$]},a.Posit.prototype.iterate=function(n,r,l){for(var o=1/0,d=new i,c=new i,f=new s,u=new s,x=0,p,g,S,M;x<100&&(p=s.addScalar(s.multScalar(i.multVector(this.modelVectors,r.row(2)),1/l.v[2]),1),this.pos(n,p,d,c,f,u),S=this.getError(n,d,f),M=this.getError(n,c,u),S<M?(r.copy(d),l.copy(f),g=S):(r.copy(c),l.copy(u),g=M),!(g<=2||g>o));++x)o=g;return g},a.Posit.prototype.getError=function(n,r,l){var o=s.add(i.multVector(r,this.model[0]),l),d=s.add(i.multVector(r,this.model[1]),l),c=s.add(i.multVector(r,this.model[2]),l),f=s.add(i.multVector(r,this.model[3]),l),u,x,p,g,S,M,I,N,E;return o=o.v,d=d.v,c=c.v,f=f.v,o[0]*=this.focalLength/o[2],o[1]*=this.focalLength/o[2],d[0]*=this.focalLength/d[2],d[1]*=this.focalLength/d[2],c[0]*=this.focalLength/c[2],c[1]*=this.focalLength/c[2],f[0]*=this.focalLength/f[2],f[1]*=this.focalLength/f[2],u=[{x:o[0],y:o[1]},{x:d[0],y:d[1]},{x:c[0],y:c[1]},{x:f[0],y:f[1]}],x=this.angle(n[0],n[1],n[3]),p=this.angle(n[1],n[2],n[0]),g=this.angle(n[2],n[3],n[1]),S=this.angle(n[3],n[0],n[2]),M=this.angle(u[0],u[1],u[3]),I=this.angle(u[1],u[2],u[0]),N=this.angle(u[2],u[3],u[1]),E=this.angle(u[3],u[0],u[2]),(Math.abs(x-M)+Math.abs(p-I)+Math.abs(g-N)+Math.abs(S-E))/4},a.Posit.prototype.angle=function(n,r,l){var o=r.x-n.x,d=r.y-n.y,c=l.x-n.x,f=l.y-n.y;return Math.acos((o*c+d*f)/(Math.sqrt(o*o+d*d)*Math.sqrt(c*c+f*f)))*180/Math.PI},a.Pose=function(n,r,l,o,d,c){this.bestError=n,this.bestRotation=r,this.bestTranslation=l,this.alternativeError=o,this.alternativeRotation=d,this.alternativeTranslation=c};var s=function(n,r,l){this.v=[n||0,r||0,l||0]};s.prototype.copy=function(n){var r=this.v;return n=n.v,r[0]=n[0],r[1]=n[1],r[2]=n[2],this},s.add=function(n,r){var l=new s,o=l.v;return n=n.v,r=r.v,o[0]=n[0]+r[0],o[1]=n[1]+r[1],o[2]=n[2]+r[2],l},s.sub=function(n,r){var l=new s,o=l.v;return n=n.v,r=r.v,o[0]=n[0]-r[0],o[1]=n[1]-r[1],o[2]=n[2]-r[2],l},s.mult=function(n,r){var l=new s,o=l.v;return n=n.v,r=r.v,o[0]=n[0]*r[0],o[1]=n[1]*r[1],o[2]=n[2]*r[2],l},s.addScalar=function(n,r){var l=new s,o=l.v;return n=n.v,o[0]=n[0]+r,o[1]=n[1]+r,o[2]=n[2]+r,l},s.multScalar=function(n,r){var l=new s,o=l.v;return n=n.v,o[0]=n[0]*r,o[1]=n[1]*r,o[2]=n[2]*r,l},s.dot=function(n,r){return n=n.v,r=r.v,n[0]*r[0]+n[1]*r[1]+n[2]*r[2]},s.cross=function(n,r){return n=n.v,r=r.v,new s(n[1]*r[2]-n[2]*r[1],n[2]*r[0]-n[0]*r[2],n[0]*r[1]-n[1]*r[0])},s.prototype.normalize=function(){var n=this.v,r=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return r>0&&(n[0]/=r,n[1]/=r,n[2]/=r),r},s.inverse=function(n){var r=new s,l=r.v;return n=n.v,n[0]!==0&&(l[0]=1/n[0]),n[1]!==0&&(l[1]=1/n[1]),n[2]!==0&&(l[2]=1/n[2]),r},s.prototype.square=function(){var n=this.v;return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},s.prototype.minIndex=function(){var n=this.v;return n[0]<n[1]?n[0]<n[2]?0:2:n[1]<n[2]?1:2};var i=function(){this.m=[[0,0,0],[0,0,0],[0,0,0]]};return i.clone=function(n){var r=new i,l=r.m;return n=n.m,l[0][0]=n[0][0],l[0][1]=n[0][1],l[0][2]=n[0][2],l[1][0]=n[1][0],l[1][1]=n[1][1],l[1][2]=n[1][2],l[2][0]=n[2][0],l[2][1]=n[2][1],l[2][2]=n[2][2],r},i.prototype.copy=function(n){var r=this.m;return n=n.m,r[0][0]=n[0][0],r[0][1]=n[0][1],r[0][2]=n[0][2],r[1][0]=n[1][0],r[1][1]=n[1][1],r[1][2]=n[1][2],r[2][0]=n[2][0],r[2][1]=n[2][1],r[2][2]=n[2][2],this},i.fromRows=function(n,r,l){var o=new i,d=o.m;return n=n.v,r=r.v,l=l.v,d[0][0]=n[0],d[0][1]=n[1],d[0][2]=n[2],d[1][0]=r[0],d[1][1]=r[1],d[1][2]=r[2],d[2][0]=l[0],d[2][1]=l[1],d[2][2]=l[2],o},i.fromDiagonal=function(n){var r=new i,l=r.m;return n=n.v,l[0][0]=n[0],l[1][1]=n[1],l[2][2]=n[2],r},i.transpose=function(n){var r=new i,l=r.m;return n=n.m,l[0][0]=n[0][0],l[0][1]=n[1][0],l[0][2]=n[2][0],l[1][0]=n[0][1],l[1][1]=n[1][1],l[1][2]=n[2][1],l[2][0]=n[0][2],l[2][1]=n[1][2],l[2][2]=n[2][2],r},i.mult=function(n,r){var l=new i,o=l.m;return n=n.m,r=r.m,o[0][0]=n[0][0]*r[0][0]+n[0][1]*r[1][0]+n[0][2]*r[2][0],o[0][1]=n[0][0]*r[0][1]+n[0][1]*r[1][1]+n[0][2]*r[2][1],o[0][2]=n[0][0]*r[0][2]+n[0][1]*r[1][2]+n[0][2]*r[2][2],o[1][0]=n[1][0]*r[0][0]+n[1][1]*r[1][0]+n[1][2]*r[2][0],o[1][1]=n[1][0]*r[0][1]+n[1][1]*r[1][1]+n[1][2]*r[2][1],o[1][2]=n[1][0]*r[0][2]+n[1][1]*r[1][2]+n[1][2]*r[2][2],o[2][0]=n[2][0]*r[0][0]+n[2][1]*r[1][0]+n[2][2]*r[2][0],o[2][1]=n[2][0]*r[0][1]+n[2][1]*r[1][1]+n[2][2]*r[2][1],o[2][2]=n[2][0]*r[0][2]+n[2][1]*r[1][2]+n[2][2]*r[2][2],l},i.multVector=function(n,r){return n=n.m,r=r.v,new s(n[0][0]*r[0]+n[0][1]*r[1]+n[0][2]*r[2],n[1][0]*r[0]+n[1][1]*r[1]+n[1][2]*r[2],n[2][0]*r[0]+n[2][1]*r[1]+n[2][2]*r[2])},i.prototype.column=function(n){var r=this.m;return new s(r[0][n],r[1][n],r[2][n])},i.prototype.row=function(n){var r=this.m;return new s(r[n][0],r[n][1],r[n][2])},lr=a,lr}var cr,Qi;function vd(){return Qi||(Qi=1,cr={CV:Bo(),AR:bd(),SVD:Er(),POS1:gd(),POS2:yd()}),cr}var jd=vd();const Zi=["top","right","bottom","left"],ps={top:0,right:1,bottom:2,left:3};let dr=null;function Nd(){return dr||(dr=new jd.AR.Detector),dr}function wd(t){const a=t.reduce((i,n)=>({x:i.x+n.x,y:i.y+n.y}),{x:0,y:0}),s=t.length||1;return{x:a.x/s,y:a.y/s}}function Sd(t){try{const s=Nd().detect(t)||[],i={},n=[];for(const u of s){const x=wd(u.corners);n.push({id:u.id,center:x});const p=Object.keys(ps).find(g=>ps[g]===u.id);p&&(i[p]={id:u.id,center:x})}const r=Object.keys(ps).filter(u=>!i[u]);if(r.length>0)return{success:!1,points:[],missing:r,markersFound:n,assignments:i,homography:null,errorPx:null,message:"Not all calibration markers were detected."};const l=[i.top.center,i.right.center,i.bottom.center,i.left.center],d=Ln().slice(0,4),c=xr(d,l),f=pr(c,d,l);return{success:!0,points:l,missing:[],markersFound:n,assignments:i,homography:c,errorPx:f}}catch(a){return{success:!1,points:[],missing:Object.keys(ps),markersFound:[],assignments:{},homography:null,errorPx:null,message:a instanceof Error?a.message:"Marker detection failed"}}}function kd(t){const a=t.getContext("2d");if(!a)return{success:!1,points:[],missing:Object.keys(ps),markersFound:[],assignments:{},homography:null,errorPx:null,message:"Canvas context unavailable for marker detection."};const s=a.getImageData(0,0,t.width,t.height);return Sd(s)}const Cd={"0,0":[1,0,0,0,0],"0,1":[1,0,1,1,1],"1,0":[0,1,0,0,1],"1,1":[0,1,1,1,0]};function Ed(t){const a=new Array(5);let s=t>>>0;for(let n=4;n>=0;n--){const r=s&1;s>>=1;const l=s&1;s>>=1;const o=Cd[`${l},${r}`];if(!o)throw new Error(`Unsupported marker id pattern for row ${n}`);a[n]=o.slice()}const i=Array.from({length:7},()=>new Array(7).fill(0));for(let n=0;n<5;n++)for(let r=0;r<5;r++)i[n+1][r+1]=a[n][r];return i}async function Uo(){const t=[];try{const a=await Td();for(const s of a){const i=await Dd(s,[80,8080,8787,8788,3e3,5e3]);for(const n of i){const r=await Ad(n.ip,n.port);r&&t.push(r)}}}catch(a){console.error("Network discovery failed:",a)}return t}async function Td(){const t=[];try{const a=new RTCPeerConnection({iceServers:[]});a.createDataChannel("");const s=await a.createOffer();return await a.setLocalDescription(s),new Promise(i=>{const n=setTimeout(()=>{a.close(),i(t)},5e3);a.onicecandidate=r=>{if(r.candidate){const o=r.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(o&&o[1]&&!t.includes(o[1])){const d=o[1];Id(d)&&t.push(d)}}else clearTimeout(n),a.close(),i(t)}})}catch(a){return console.error("Failed to get local IPs:",a),["192.168.1.0"]}}function Id(t){const a=t.split(".").map(Number);return a[0]===10||a[0]===172&&a[1]>=16&&a[1]<=31||a[0]===192&&a[1]===168}async function Dd(t,a){const s=[],i=t.split(".").slice(0,3).join("."),n=[];for(let l=1;l<=254;l++){const o=`${i}.${l}`;for(const d of a)n.push(Md(o,d))}return(await Promise.allSettled(n)).forEach((l,o)=>{if(l.status==="fulfilled"&&l.value){const d=o%a.length,c=Math.floor(o/a.length),f=`${i}.${c+1}`;s.push({ip:f,port:a[d]})}}),s}async function Md(t,a){try{const s=await fetch(`http://${t}:${a}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(2e3)});return!0}catch{return!1}}async function Ad(t,a){try{const s=["/","/api/info","/api/status","/camera","/stream"];for(const i of s)try{const n=await fetch(`http://${t}:${a}${i}`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(n.ok){const r=n.headers.get("content-type")||"",l=await n.text();if(l.includes("OMNI")||l.includes("omni")||i.includes("omni"))return{id:`omni-${t}-${a}`,name:`OMNI Camera (${t})`,ip:t,port:a,type:"omni",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(l.includes("VERT")||l.includes("vert")||i.includes("vert"))return{id:`vert-${t}-${a}`,name:`VERT Camera (${t})`,ip:t,port:a,type:"vert",capabilities:["video","calibration"],status:"online",connectionType:"wifi"};if(r.includes("video")||l.includes("stream")||i==="/stream")return{id:`generic-${t}-${a}`,name:`Network Camera (${t})`,ip:t,port:a,type:"generic",capabilities:["video"],status:"online",connectionType:"wifi"}}}catch{}}catch(s){console.error(`Failed to probe device ${t}:${a}:`,s)}return null}async function Pd(){const t=[];try{if(!("serial"in navigator))return console.warn("Web Serial API not supported in this browser"),t;const a=await navigator.serial.getPorts();for(const s of a){const i=await $o(s);i&&t.push(i)}}catch(a){console.error("USB device discovery failed:",a)}return t}async function Rd(){try{if(!("serial"in navigator))return alert("Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge."),null;const t=await navigator.serial.requestPort();return await $o(t)}catch(t){return t.name!=="NotFoundError"&&console.error("USB device request failed:",t),null}}async function $o(t){try{await t.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none"});const a=t.readable?.getReader();if(a)try{const s=setTimeout(()=>a.cancel(),2e3),{value:i,done:n}=await a.read();if(clearTimeout(s),!n&&i){const r=new TextDecoder().decode(i);if(r.includes("OMNI")||r.includes("omni"))return a.releaseLock(),{id:`usb-omni-${Date.now()}`,name:"OMNI Camera (USB)",type:"omni",capabilities:["video","calibration"],status:"online",port:t};if(r.includes("VERT")||r.includes("vert"))return a.releaseLock(),{id:`usb-vert-${Date.now()}`,name:"VERT Camera (USB)",type:"vert",capabilities:["video","calibration"],status:"online",port:t}}}catch{}finally{try{a.releaseLock()}catch{}}return{id:`usb-generic-${Date.now()}`,name:"USB Scoring Device",type:"generic",capabilities:["video"],status:"online",port:t}}catch(a){return console.error("Failed to probe USB device:",a),null}}async function Fo(t){try{const a=`http://${t.ip}:${t.port}/stream`,s=document.createElement("video");return s.src=a,s.crossOrigin="anonymous",new Promise((i,n)=>{s.onloadeddata=()=>{const r=document.createElement("canvas"),l=r.getContext("2d");r.width=s.videoWidth,r.height=s.videoHeight;const o=r.captureStream(30),d=()=>{s.readyState>=2&&l.drawImage(s,0,0),requestAnimationFrame(d)};d(),i(o)},s.onerror=()=>n(new Error("Failed to load video stream")),s.load()})}catch(a){return console.error("Failed to connect to network device:",a),null}}async function Ld(t){try{if(!t.port)throw new Error("No serial port available");return console.log("USB device connection not fully implemented yet"),null}catch(a){return console.error("Failed to connect to USB device:",a),null}}function Od(){const t=m.useRef(null),a=m.useRef(null),s=m.useRef(null),i=m.useRef(null),[n,r]=m.useState(!1),[l,o]=m.useState(!1),[d,c]=m.useState("camera"),[f,u]=m.useState(()=>localStorage.getItem("ndn:cal:mode")||"local"),[x,p]=m.useState([]),[g,S]=m.useState(!1),[M,I]=m.useState(null),[N,E]=m.useState(1),[A,D]=m.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("ndn:cal:forceDesktop")==="1"}catch{return!1}}),[k,b]=m.useState(()=>typeof navigator>"u"?!1:/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)),{H:y,setCalibration:$,reset:Y,errorPx:O,locked:_}=Cr(),{calibrationGuide:T,setCalibrationGuide:H,preferredCameraId:ae,cameraEnabled:P,setCameraEnabled:Z,preferredCameraLocked:se,setPreferredCameraLocked:ze,setPreferredCamera:ye}=ls(),[Me,lt]=m.useState(null),[Ke,ge]=m.useState(!1),[Re,ct]=m.useState(0),[Je,Ne]=m.useState(null),le=m.useCallback((B,J=480)=>{if(typeof document>"u")throw new Error("Marker rendering only available in browser context");const X=Ed(B),z=document.createElement("canvas");z.width=J,z.height=J;const G=z.getContext("2d");if(!G)throw new Error("Unable to create marker canvas context");G.imageSmoothingEnabled=!1,G.fillStyle="#ffffff",G.fillRect(0,0,J,J);const Ae=J*.08,he=X.length,He=(J-Ae*2)/he,dt=Ae;for(let Oe=0;Oe<he;Oe++)for(let It=0;It<he;It++){const Pt=X[Oe][It];G.fillStyle=Pt===1?"#000000":"#ffffff",G.fillRect(dt+It*He,dt+Oe*He,He,He)}return G.strokeStyle="#000000",G.lineWidth=Math.max(2,He*.08),G.strokeRect(dt,dt,He*he,He*he),z.toDataURL("image/png")},[]);m.useCallback(()=>{try{const B=Zi.map(z=>{const G=ps[z];return{key:z,id:G,dataUrl:le(G)}}),J=window.open("","_blank","width=900,height=1200");if(!J)throw new Error("Popup blocked by browser");const X=`<!DOCTYPE html>
			<html>
			<head>
				<meta charset="utf-8" />
				<title>Nine Dart Nation – Marker Sheet</title>
				<style>
					body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 24px; color: #0f172a; }
					h1 { font-size: 20px; margin-bottom: 4px; }
					p { margin-top: 0; opacity: 0.7; }
					.grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 32px; margin-top: 24px; }
					.marker { text-align: center; }
					.marker h2 { font-size: 16px; margin: 12px 0 8px; }
					.marker img { width: 100%; max-width: 360px; border: 1px solid #0f172a; }
					footer { margin-top: 24px; font-size: 12px; opacity: 0.6; }
				</style>
			</head>
			<body>
				<h1>Marker sheet</h1>
				<p>Print at 100% scale on letter/A4 paper. Cut out and tape each marker so it is flush with the outer double ring.</p>
				<div class="grid">
					${B.map(z=>`
						<div class="marker">
							<h2>${z.key.toUpperCase()} • ID ${z.id}</h2>
							<img src="${z.dataUrl}" alt="Marker ${z.key}" />
						</div>
					`).join("")}
				</div>
				<footer>Tip: Keep markers flat, smooth, and unobstructed for best detection results.</footer>
			</body>
			</html>`;J.document.write(X),J.document.close()}catch(B){console.error("Marker sheet generation failed",B),alert(`Unable to open marker sheet: ${B?.message||B}`)}},[le]);const[Be,we]=m.useState(null),ke=m.useRef(!1),[ce,de]=m.useState(null),Ee=m.useRef(null),jt=m.useCallback(B=>{Ee.current=B,de(B)},[de]),[Ue,re]=m.useState(null),[ue,fe]=m.useState(Date.now()),[me,qe]=m.useState(!1),Le=m.useRef(null),[et,yt]=m.useState(""),[ht,C]=m.useState(null),[ee,Ct]=m.useState(null),[Ye,Ut]=m.useState(!0),[At,Et]=m.useState([]),[$e,Vt]=m.useState(!1),[Nt,pt]=m.useState(null),wt=m.useRef(null);m.useEffect(()=>{const B=window.location.hostname;(B==="localhost"||B==="127.0.0.1")&&kt("/api/hosts").then(J=>J.json()).then(J=>{const X=Array.isArray(J?.hosts)&&J.hosts.find(z=>z);X&&C(X)}).catch(()=>{}),kt("/api/https-info").then(J=>J.json()).then(J=>{J&&typeof J.https=="boolean"&&Ct({https:!!J.https,port:Number(J.port)||8788})}).catch(()=>{})},[]);const vt=m.useMemo(()=>{const B=ce||"____",J="ws://localhost:8787";if(J.length>0)try{const he=new URL(J);return`${`${he.protocol==="wss:"?"https":"http"}://${he.host}${he.pathname.endsWith("/ws")?"":he.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${B}`}catch{}const X=ht||window.location.hostname,z=!!ee?.https,G=z?ee?.port||8788:8787;return`${z?"https":"http"}://${X}:${G}/mobile-cam.html?code=${B}`},[ce,ht,ee]),Ft=m.useMemo(()=>{if(!vt)return null;try{const B=new URL(vt);return B.searchParams.delete("code"),B.toString().replace(/\?$/,"")}catch{return typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html"}},[vt]);m.useEffect(()=>{localStorage.setItem("ndn:cal:mode",f)},[f]),m.useEffect(()=>{if(!(typeof window>"u"))try{A?window.localStorage.setItem("ndn:cal:forceDesktop","1"):window.localStorage.removeItem("ndn:cal:forceDesktop")}catch{}},[A]),m.useEffect(()=>{if(typeof window>"u")return;const B=window.matchMedia("(pointer: coarse)"),J=()=>{const X=typeof navigator<"u"&&/Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent),z=typeof B.matches=="boolean"?B.matches:!1,G=window.innerWidth<=820;b(X||z||G)};J();try{typeof B.addEventListener=="function"?B.addEventListener("change",J):typeof B.addListener=="function"&&B.addListener(J)}catch{}return window.addEventListener("resize",J),()=>{try{typeof B.removeEventListener=="function"?B.removeEventListener("change",J):typeof B.removeListener=="function"&&B.removeListener(J)}catch{}window.removeEventListener("resize",J)}},[]),m.useEffect(()=>{if(!ce){yt("");return}Po.toDataURL(vt,{width:160,margin:1,color:{dark:"#000000",light:"#ffffff"}}).then(yt).catch(()=>yt(""))},[vt,ce]),m.useEffect(()=>{if(!Ue)return;const B=setInterval(()=>fe(Date.now()),1e3);return()=>clearInterval(B)},[Ue]);const Qt=m.useMemo(()=>Ue?Math.max(0,Math.ceil((Ue-ue)/1e3)):null,[Ue,ue]);m.useEffect(()=>()=>{wt.current&&window.clearTimeout(wt.current)},[]);const F=m.useCallback(async(B,J)=>{if(B)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(B);else{const X=document.createElement("textarea");X.value=B,X.style.position="fixed",X.style.opacity="0",document.body.appendChild(X),X.focus(),X.select(),document.execCommand("copy"),document.body.removeChild(X)}pt(J),wt.current&&window.clearTimeout(wt.current),wt.current=window.setTimeout(()=>pt(null),1500)}catch(X){console.warn("[Calibrator] Copy failed:",X),pt(null)}},[]);m.useEffect(()=>{async function B(){try{if(console.log("[Calibrator] Requesting camera permission on load..."),await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),console.log("[Calibrator] Camera permission granted"),navigator.mediaDevices){const J=await navigator.mediaDevices.enumerateDevices();console.log("[Calibrator] Found devices:",J.filter(X=>X.kind==="videoinput").length,"cameras")}}catch(J){const X=J&&(J.name||J.code)||"";X==="NotAllowedError"?console.warn("[Calibrator] Camera permission denied by user"):X==="NotFoundError"||X==="NotAvailable"?console.warn("[Calibrator] No camera device found"):console.warn("[Calibrator] Camera permission request failed:",J)}}B()},[]),m.useEffect(()=>()=>ne(),[]);function xe(){if(Be&&Be.readyState===WebSocket.OPEN)return Be;const B="ws://localhost:8787",J=B.length>0?B.endsWith("/ws")?B:B.replace(/\/$/,"")+"/ws":void 0,z=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws`,G=window.location.hostname,he=J||(G.endsWith("onrender.com")?z:"wss://ninedartnation.onrender.com/ws");console.log("[Calibrator] Connecting WebSocket to:",he);let _e=new WebSocket(he);return we(_e),_e}async function nt(){u("phone"),ne(!1),Ie();try{Z(!0)}catch{}const B=xe();B.readyState===WebSocket.OPEN?B.send(JSON.stringify({type:"cam-create"})):B.onopen=()=>B.send(JSON.stringify({type:"cam-create"})),B.onerror=J=>{console.error("WebSocket connection error:",J),alert("Failed to connect to camera pairing service. Please check your internet connection and try again.")},B.onclose=J=>{if(console.log("WebSocket closed:",J.code,J.reason),Le.current){try{Le.current.close()}catch{}Le.current=null}jt(null),re(null),qe(!1),J.code!==1e3&&(alert("Camera pairing connection lost. Please try pairing again."),f==="phone"&&u("local"))},B.onmessage=async J=>{const X=JSON.parse(J.data);if(X.type==="cam-code")jt(X.code),X.expiresAt&&re(X.expiresAt);else if(X.type==="cam-peer-joined"){!Ee.current&&X.code&&jt(X.code),qe(!0);const z=Ee.current||X.code||null;z&&(Ee.current=z);try{if(_&&z){const Ae=a.current?{w:a.current.width,h:a.current.height}:null,he={H:y,imageSize:Ae,errorPx:O??null,createdAt:Date.now()};B.send(JSON.stringify({type:"cam-calibration",code:z,payload:he})),console.log("[Calibrator] Sent calibration to joined phone for code",z)}}catch(Ae){console.warn("[Calibrator] Failed to send calibration on peer join",Ae)}const G=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceCandidatePoolSize:10});Le.current=G,G.onconnectionstatechange=()=>{console.log("WebRTC connection state:",G.connectionState),G.connectionState==="failed"||G.connectionState==="disconnected"?(console.error("WebRTC connection failed"),alert("Camera connection lost. Please try pairing again."),ne()):G.connectionState==="connected"&&console.log("WebRTC connection established")},G.onicecandidate=Ae=>{Ae.candidate&&z&&B.send(JSON.stringify({type:"cam-ice",code:z,payload:Ae.candidate}))},G.ontrack=Ae=>{if(console.log("[Calibrator] WebRTC ontrack received:",Ae.streams?.length,"streams, track kind:",Ae.track?.kind),t.current){const he=Ae.streams?.[0];he?(console.log("[Calibrator] Assigning video stream (tracks:",he.getTracks().length,") to video element"),S(!1),setTimeout(()=>{t.current&&(console.log("[Calibrator] Setting srcObject and attempting play"),t.current.srcObject&&t.current.srcObject.getTracks().forEach(He=>He.stop()),t.current.srcObject=he,t.current.muted=!0,t.current.playsInline=!0,t.current.play().then(()=>{console.log("[Calibrator] Video playback started successfully"),r(!0),c("capture");try{ye(void 0,"Phone Camera",!0)}catch{}if(!se)try{ze(!0),ke.current=!0}catch{}try{Z(!0)}catch{}o(!1)}).catch(_e=>{console.error("[Calibrator] Video play failed:",_e),o(!0),console.warn("[Calibrator] video play blocked — prompting user interaction")}))},100)):console.error("[Calibrator] No inbound stream received in ontrack")}else console.error("[Calibrator] Video element not available")};try{const Ae=await G.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await G.setLocalDescription(Ae),console.log("[Calibrator] Sending cam-offer for code:",z),z?B.send(JSON.stringify({type:"cam-offer",code:z,payload:Ae})):console.warn("[Calibrator] Missing pairing code when sending offer")}catch(Ae){console.error("Failed to create WebRTC offer:",Ae),alert("Failed to establish camera connection. Please try again."),ne()}}else if(X.type==="cam-answer"){console.log("[Calibrator] Received cam-answer");const z=Le.current;if(z)try{await z.setRemoteDescription(new RTCSessionDescription(X.payload)),console.log("[Calibrator] Remote description set (answer)")}catch(G){console.error("Failed to set remote description:",G),alert("Camera pairing failed. Please try again."),ne()}else console.warn("[Calibrator] Received cam-answer but no peer connection exists")}else if(X.type==="cam-ice"){console.log("[Calibrator] Received cam-ice");const z=Le.current;if(z)try{await z.addIceCandidate(X.payload),console.log("[Calibrator] ICE candidate added")}catch(G){console.error("Failed to add ICE candidate:",G)}else console.warn("[Calibrator] Received ICE candidate but no peer connection exists")}else if(X.type==="cam-error")console.error("Camera pairing error:",X.code),alert(X.code==="EXPIRED"?"Code expired. Generate a new code.":`Camera error: ${X.code||"Unknown error"}`),ne();else if(X.type==="cam-calibration"){console.log("[Calibrator] Received calibration from peer:",X.payload);try{X.payload&&X.payload.H&&Array.isArray(X.payload.H)&&($({H:X.payload.H,createdAt:X.payload.createdAt||Date.now(),errorPx:X.payload.errorPx,imageSize:X.payload.imageSize,locked:!0}),console.log("[Calibrator] Applied received calibration"))}catch(z){console.error("[Calibrator] Failed to apply received calibration",z)}}}}async function Tt(){Vt(!0);try{const B=await Uo();Et(B),B.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(B){console.error("Wifi device discovery failed:",B),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Vt(!1)}c("camera")}async function U(B){try{Et(X=>X.map(z=>z.id===B.id?{...z,status:"connecting"}:z));const J=await Fo(B);if(J&&t.current)t.current.srcObject&&t.current.srcObject.getTracks().forEach(z=>z.stop()),t.current.srcObject=J,await t.current.play(),r(!0),c("capture"),Et(X=>X.map(z=>z.id===B.id?{...z,status:"online"}:z));else throw new Error("Failed to get video stream")}catch(J){console.error("Failed to connect to wifi device:",J),alert(`Failed to connect to ${B.name}. Please check the device and try again.`),Et(X=>X.map(z=>z.id===B.id?{...z,status:"offline"}:z))}}async function V(){if(f==="phone")return nt();if(f==="wifi")return Tt();try{console.log("[Calibrator] Attempting camera access...");const B={video:ae?{deviceId:{exact:ae}}:{facingMode:"environment"},audio:!1};console.log("[Calibrator] Camera constraints:",B);let J;try{J=await navigator.mediaDevices.getUserMedia(B),console.log("[Calibrator] Camera stream obtained:",J)}catch(X){const z=X&&(X.name||X.code)||"";if(console.warn("[Calibrator] Preferred camera not available:",X),ae&&(z==="OverconstrainedError"||z==="NotFoundError"||z==="NotAllowedError"))J=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),console.log("[Calibrator] Fallback camera stream obtained:",J);else throw X}if(t.current)t.current.srcObject&&t.current.srcObject.getTracks().forEach(z=>z.stop()),t.current.srcObject=J,await t.current.play(),console.log("[Calibrator] Video playback started"),r(!0),c("capture");else throw console.warn("[Calibrator] videoRef.current is null - cannot display camera"),J.getTracks().forEach(X=>X.stop()),new Error("Camera element not available")}catch(B){console.error("[Calibrator] Camera access failed:",B),alert(`Camera access failed: ${B instanceof Error?B.message:"Unknown error"}. Try refreshing the page or check camera permissions.`)}}function ne(B=!0){if(t.current&&t.current.srcObject&&(t.current.srcObject.getTracks().forEach(X=>X.stop()),t.current.srcObject=null,r(!1)),Le.current){try{Le.current.close()}catch{}Le.current=null}if(jt(null),re(null),qe(!1),Ne(null),ke.current){try{ze(!1)}catch{}ke.current=!1}B&&(f==="phone"||f==="wifi")&&u("local")}function je(){Be&&Be.readyState===WebSocket.OPEN?Be.send(JSON.stringify({type:"cam-create"})):nt(),Ie()}function Ie(){try{se?ke.current:(ze(!0),ke.current=!0)}catch{}}function at(){try{i.current?.click()}catch{}}function Te(B){const J=B.target.files?.[0];if(!J)return;const X=new Image;X.onload=()=>{try{if(!a.current)return;const z=a.current;z.width=X.naturalWidth,z.height=X.naturalHeight,z.getContext("2d").drawImage(X,0,0,z.width,z.height),S(!0),I({w:z.width,h:z.height}),c("select"),p([]),Ne(null),ne()}catch{}},X.onerror=()=>{alert("Could not load image. Please try a different photo.")},X.src=URL.createObjectURL(J);try{B.target.value=""}catch{}}function pe(){if(!t.current||!a.current)return;const B=t.current,J=a.current;J.width=B.videoWidth,J.height=B.videoHeight,J.getContext("2d").drawImage(B,0,0,J.width,J.height),S(!0),I({w:J.width,h:J.height}),c("select"),p([]),Ne(null),Ke&&setTimeout(()=>{Qs()},0)}function mt(B=x,J=null){if(!a.current||!s.current)return;const X=a.current,z=s.current;z.width=X.width,z.height=X.height;const G=z.getContext("2d");G.clearRect(0,0,z.width,z.height);const Ae=J||y;if(Ae){const he=[Ge.bullInner,Ge.bullOuter,Ge.trebleInner,Ge.trebleOuter,Ge.doubleInner,Ge.doubleOuter];for(const _e of he){const He=_?"#10b981":_e===Ge.doubleOuter?"#22d3ee":"#a78bfa",dt=_||_e===Ge.doubleOuter?3:2,Oe=Lo(Ae,_e,360);Oo(G,Oe,He,dt)}}if(!Ae&&Me){const he=(_e,He,dt=2)=>{G.save(),G.strokeStyle=He,G.lineWidth=dt,G.beginPath(),G.arc(Me.cx,Me.cy,_e,0,Math.PI*2),G.stroke(),G.restore()};he(Me.doubleOuter,"#22d3ee",3),he(Me.doubleInner,"#22d3ee",2),he(Me.trebleOuter,"#fde047",2),he(Me.trebleInner,"#fde047",2),he(Me.bullOuter,"#34d399",2),he(Me.bullInner,"#10b981",3)}if(B.length<6&&Ae){G.save(),G.strokeStyle="rgba(255,193,7,0.4)",G.lineWidth=2,G.setLineDash([4,4]);const he=Ln();for(let _e=B.length;_e<6&&_e<he.length;_e++)try{const He=ua(Ae,he[_e]);G.beginPath(),G.arc(He.x,He.y,12,0,Math.PI*2),G.stroke()}catch{}G.restore()}if(B.forEach((he,_e)=>{hd(G,he,"#f472b6"),G.save(),G.fillStyle="#f472b6",G.font="14px sans-serif",G.fillText(String(_e+1),he.x+6,he.y-6),G.restore()}),T&&!_){G.save(),G.fillStyle="rgba(59,130,246,0.10)";const he=Math.round(Math.min(z.width,z.height)*.08),_e=z.width-he*2,He=z.height-he*2;G.fillRect(he,he,_e,He),G.strokeStyle="rgba(34,197,94,0.9)",G.lineWidth=2,G.beginPath(),G.moveTo(he,z.height/2),G.lineTo(z.width-he,z.height/2),G.stroke(),G.beginPath(),G.moveTo(z.width/2,he),G.lineTo(z.width/2,z.height-he),G.stroke(),G.strokeStyle="rgba(234,179,8,0.9)",G.setLineDash([6,4]);const dt=he+30,Oe=he+30;G.beginPath(),G.moveTo(dt,Oe+30),G.lineTo(dt+60,Oe),G.stroke(),G.beginPath(),G.moveTo(z.width-dt,Oe+30),G.lineTo(z.width-dt-60,Oe),G.stroke(),G.restore(),G.save(),G.scale(1/N,1/N),G.fillStyle="rgba(255,255,255,0.85)",G.font="12px sans-serif",G.fillText("Tip: Frame board centered, edges parallel; slight top-down is okay. Keep bull near center.",he*N,(he+18)*N),G.restore()}}function _t(B){if(d!=="select")return;const J=B.target,X=J.getBoundingClientRect(),z=B.clientX-X.left,G=B.clientY-X.top,Ae=J.width>0?J.width/X.width:1,he=J.height>0?J.height/X.height:1,_e=z*Ae,He=G*he,dt=[...x,{x:_e,y:He}];dt.length<=6&&(p(dt),mt(dt))}function Fe(){const B=x.slice(0,-1);p(B),mt(B)}function Us(){if(!a.current||x.length===0)return;const B=pd(a.current,x,8);p(B),mt(B)}function As(){if(!a.current)return;if(x.length<4)return alert("Please click at least 4 points on the board.");if(x.length<6)return alert("For best accuracy, click all 6 calibration points: TOP, RIGHT, BOTTOM, LEFT of double rim, plus BULLSEYE center and OUTER BULL top.");const B=Ln(),J=xr(B,x);mt(x,J);const X=pr(J,B,x);$({H:J,createdAt:Date.now(),errorPx:X,imageSize:{w:a.current.width,h:a.current.height},anchors:{src:B,dst:x}}),c("computed")}function $s(){p([]),S(!1),c("camera"),mt([]),Ne(null),Y()}async function Qs(){if(!a.current)return alert("Load a photo or capture a frame first.");Ne(null);const B=a.current,X=Math.min(1,800/B.width),z=Math.max(1,Math.round(B.width*X)),G=Math.max(1,Math.round(B.height*X)),Ae=document.createElement("canvas");Ae.width=z,Ae.height=G;const he=Ae.getContext("2d");he.drawImage(B,0,0,z,G);const _e=he.getImageData(0,0,z,G),He=new Float32Array(z*G);for(let Pe=0,tt=0;Pe<_e.data.length;Pe+=4,tt++){const rt=_e.data[Pe],be=_e.data[Pe+1],bt=_e.data[Pe+2];He[tt]=.299*rt+.587*be+.114*bt}const dt=new Float32Array(z*G),Oe=new Float32Array(z*G);for(let Pe=1;Pe<G-1;Pe++)for(let tt=1;tt<z-1;tt++){const rt=Pe*z+tt,be=He[rt-z-1],bt=He[rt-z],gt=He[rt-z+1],ut=He[rt-1],Mt=He[rt+1],Yt=He[rt+z-1],us=He[rt+z],Ps=He[rt+z+1];dt[rt]=-be-2*ut-Yt+(gt+2*Mt+Ps),Oe[rt]=-be-2*bt-gt+(Yt+2*us+Ps)}const It=new Float32Array(z*G);let Pt=1;for(let Pe=0;Pe<It.length;Pe++){const tt=Math.hypot(dt[Pe],Oe[Pe]);It[Pe]=tt,tt>Pt&&(Pt=tt)}const Lt=Math.floor(z/2),cs=Math.floor(G/2),Ht=Math.floor(Math.min(z,G)*.35),bs=Math.floor(Math.min(z,G)*.52);let Ot={score:-1,cx:Lt,cy:cs,r:Math.floor((Ht+bs)/2)};const gs=Math.max(2,Math.floor(Math.min(z,G)*.01)),ot=Math.max(2,Math.floor(Math.min(z,G)*.01));for(let Pe=cs-Math.floor(G*.08);Pe<=cs+Math.floor(G*.08);Pe+=gs)for(let tt=Lt-Math.floor(z*.08);tt<=Lt+Math.floor(z*.08);tt+=gs)for(let rt=Ht;rt<=bs;rt+=ot){let be=0;const bt=360;for(let gt=0;gt<bt;gt++){const ut=gt*Math.PI/180,Mt=Math.round(tt+rt*Math.cos(ut)),Yt=Math.round(Pe+rt*Math.sin(ut));Mt<=0||Mt>=z-1||Yt<=0||Yt>=G-1||(be+=It[Yt*z+Mt])}be>Ot.score&&(Ot={score:be,cx:tt,cy:Pe,r:rt})}const Zt=1/X,Se=Ot.cx*Zt,ss=Ot.cy*Zt,Fs=Ot.r*Zt;function ys(Pe){let tt=0;const rt=Pe*X,be=360;for(let bt=0;bt<be;bt++){const gt=bt*Math.PI/180,ut=Math.round(Ot.cx+rt*Math.cos(gt)),Mt=Math.round(Ot.cy+rt*Math.sin(gt));ut<=0||ut>=z-1||Mt<=0||Mt>=G-1||(tt+=It[Mt*z+ut])}return tt}const Jt={bullInner:Ge.bullInner/Ge.doubleOuter,bullOuter:Ge.bullOuter/Ge.doubleOuter,trebleInner:Ge.trebleInner/Ge.doubleOuter,trebleOuter:Ge.trebleOuter/Ge.doubleOuter,doubleInner:Ge.doubleInner/Ge.doubleOuter};function Rt(Pe,tt=.08){const rt=Math.max(1,Math.floor(Pe*(1-tt))),be=Math.max(rt+1,Math.floor(Pe*(1+tt)));let bt=rt,gt=-1;for(let ut=rt;ut<=be;ut++){const Mt=ys(ut);Mt>gt&&(gt=Mt,bt=ut)}return bt}const qt=Fs,ft=Rt(qt*Jt.doubleInner),vs=Rt(qt*Jt.trebleOuter),ds=Rt(qt*Jt.trebleInner),Kt=Rt(qt*Jt.bullOuter),Ts=Rt(qt*Jt.bullInner);lt({cx:Se,cy:ss,bullInner:Ts,bullOuter:Kt,trebleInner:ds,trebleOuter:vs,doubleInner:ft,doubleOuter:qt});const Dt=Pe=>{let rt=0;for(let be=0;be<180;be++){const bt=be*Math.PI/90,gt=Math.round(Ot.cx+Pe*X*Math.cos(bt)),ut=Math.round(Ot.cy+Pe*X*Math.sin(bt));gt<=0||gt>=z-1||ut<=0||ut>=G-1||(rt+=It[ut*z+gt])}return rt/180},Is=(Dt(Ot.r)+Dt(vs)+Dt(ds)+Dt(ft)+Dt(Kt)+Dt(Ts))/(Pt*6),es=Math.max(0,Math.min(1,Is)),is=Math.min(es,Math.min(Dt(Ot.r)/Pt,Dt(vs)/Pt,Dt(ds)/Pt,Dt(ft)/Pt,Dt(Kt)/Pt,Dt(Ts)/Pt));ct(Math.round(is*100));const js=[{x:Se,y:ss-qt},{x:Se+qt,y:ss},{x:Se,y:ss+qt},{x:Se-qt,y:ss},{x:Se,y:ss},{x:Se,y:ss-Kt}];p(js),mt(js);try{const Pe=Ln(),tt=xr(Pe,js);mt(js,tt);const rt=pr(tt,Pe,js);$({H:tt,createdAt:Date.now(),errorPx:rt,imageSize:{w:a.current.width,h:a.current.height},anchors:{src:Pe,dst:js}}),c("computed")}catch(Pe){console.error("[Calibrator] Auto-detect compute failed:",Pe)}const ms=is>=.95;$({locked:ms})}function Es(){if(!a.current)return alert("Capture a frame or upload a photo first.");const B=kd(a.current);if(Ne(B),!B.success||!B.homography){const G=B.missing.length?` Missing markers: ${B.missing.map(Ae=>`${Ae.toUpperCase()} (ID ${ps[Ae]})`).join(", ")}`:"";alert(B.message?`${B.message}${G}`:`Marker detection failed.${G}`);return}lt(null),p(B.points),mt(B.points,B.homography);const J=Ln(),X={w:a.current.width,h:a.current.height},z=(B.errorPx??Number.POSITIVE_INFINITY)<=1.2;$({H:B.homography,createdAt:Date.now(),errorPx:B.errorPx??null,imageSize:X,anchors:{src:J,dst:B.points},locked:z?!0:_}),c("computed")}m.useEffect(()=>{mt()},[g,y]),m.useEffect(()=>{if(!Ke||!n)return;let B=0;const J=()=>{try{pe()}catch{}B=requestAnimationFrame(J)};return B=requestAnimationFrame(J),()=>cancelAnimationFrame(B)},[Ke,n]),m.useEffect(()=>{(async()=>{try{if(!_||!ce)return;const B=a.current?{w:a.current.width,h:a.current.height}:null,J=JSON.stringify({H:y,anchors:null,imageSize:B,errorPx:O??null});try{await kt(`/cam/calibration/${ce}`,{method:"POST",headers:{"Content-Type":"application/json"},body:J}),console.log("[Calibrator] Posted calibration for code",ce)}catch(X){console.warn("[Calibrator] Upload calibration failed",X)}try{const X=localStorage.getItem("authToken");X&&(await kt("/api/user/calibration",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${X}`},body:J}),console.log("[Calibrator] Synced calibration to user account"))}catch(X){console.warn("[Calibrator] User calibration sync failed",X)}}catch{}})()},[_,ce]);function Zs(){const{preferredCameraId:B,preferredCameraLabel:J,setPreferredCamera:X,cameraEnabled:z,setCameraEnabled:G,preferredCameraLocked:Ae,setPreferredCameraLocked:he}=ls(),[_e,He]=m.useState([]),[dt,Oe]=m.useState(""),[It,Pt]=m.useState(!1),Lt=m.useRef(null),cs=document.getElementById("dropdown-portal-root")||(()=>{const ot=document.createElement("div");return ot.id="dropdown-portal-root",document.body.appendChild(ot),ot})();async function Ht(){Oe("");try{try{await navigator.mediaDevices.getUserMedia({video:!0})}catch{}const Zt=(await navigator.mediaDevices.enumerateDevices()).filter(Se=>Se.kind==="videoinput");He(Zt)}catch{Oe("Unable to list cameras. Grant camera permission in your browser.")}}m.useEffect(()=>{Ht()},[]),m.useEffect(()=>{function ot(Zt){Lt.current&&!Lt.current.contains(Zt.target)&&Pt(!1)}return document.addEventListener("mousedown",ot),()=>document.removeEventListener("mousedown",ot)},[]);const bs=_e.find(ot=>ot.deviceId===B),Ot=bs?`${bs.label||"Camera"}`:B?"Camera (unavailable)":"Auto (browser default)",gs=B&&!bs;return e.jsxs("div",{className:"mt-3 p-3 rounded-lg border border-indigo-500/30 bg-indigo-500/5",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Select camera device"}),dt&&e.jsx("div",{className:"text-rose-400 text-sm mb-2",children:dt}),gs&&e.jsxs("div",{className:"text-amber-400 text-sm mb-2",children:["Selected camera is no longer available.",e.jsx("button",{className:"underline ml-1",onClick:()=>X(void 0,"",!0),disabled:n,children:"Use auto-selection"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ae?e.jsx("div",{className:"text-xs text-emerald-400",children:"🔒 Camera selection locked"}):e.jsx("div",{className:"text-xs text-slate-400",children:"Camera selection unlocked"}),e.jsx("button",{className:"btn btn--ghost px-2 py-0.5 text-xs ml-2",onClick:()=>{ke.current=!1,he(!Ae)},children:Ae?"Unlock":"Lock"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled-calibrator",checked:z,onChange:ot=>G(ot.target.checked),className:"w-4 h-4",disabled:n}),e.jsx("label",{htmlFor:"cameraEnabled-calibrator",className:"text-sm",children:"Enable camera for scoring"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center text-sm",children:[e.jsxs("div",{className:"col-span-2 relative",ref:Lt,children:[e.jsxs("div",{className:"input w-full flex items-center justify-between cursor-pointer",onClick:()=>Pt(!It),children:[e.jsx("span",{className:"truncate",children:Ot}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${It?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),It&&Ql.createPortal(e.jsx("div",{className:"fixed left-0 top-0 w-full h-full z-[9999]",style:{pointerEvents:"none"},children:e.jsx("div",{className:"absolute",style:{left:Lt.current?.getBoundingClientRect().left||0,top:Lt.current?.getBoundingClientRect().bottom||0,width:Lt.current?.offsetWidth||240,pointerEvents:"auto"},children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:[e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm",onClick:()=>{X(void 0,"",!0)},children:"Auto (browser default)"}),_e.map(ot=>{const Zt=`${ot.label||"Camera"}`;return e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm",onClick:()=>{X(ot.deviceId,ot.label||"",!0)},children:Zt},ot.deviceId)}),e.jsx("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-sm text-indigo-400",onClick:()=>{u("phone"),c("camera"),r(!1),S(!1)},children:"📱 Phone Camera"},"phone-camera"),e.jsx("div",{className:"px-3 py-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>Pt(!1),children:"Close"})})]})})}),cs)]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn px-2 py-1",onClick:Ht,disabled:n,children:"Refresh"})})]}),J&&e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["Selected: ",J]}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Tip: All camera technology is supported for autoscoring needs—select your camera here and then open Calibrator to align."})]})}if(k&&!A){const B=Ft??(typeof window<"u"?`${window.location.origin.replace(/\/$/,"")}/mobile-cam.html`:"/mobile-cam.html");return e.jsxs("div",{className:"mx-auto flex min-h-[calc(100vh-140px)] w-full max-w-xl flex-col justify-center gap-6 p-6",children:[e.jsxs("div",{className:"space-y-5 rounded-3xl border border-indigo-400/30 bg-slate-900/70 p-6 text-slate-100 shadow-xl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-indigo-300",children:"Mobile camera"}),e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-white",children:"This device is ready to stream as your dartboard camera"}),e.jsx("p",{className:"text-sm text-slate-200/80",children:"Open the lightweight mobile camera page to stream video to your desktop calibrator. You can still come back here if you need the full desktop tools."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:B,className:"btn w-full justify-center px-4 py-2 text-base",children:"Open mobile camera"}),e.jsx("button",{type:"button",className:"btn btn--ghost w-full justify-center px-4 py-2 text-sm",onClick:()=>F(B,"link"),children:Nt==="link"?"Link copied!":"Copy link"})]}),e.jsxs("p",{className:"text-xs text-slate-300/70",children:["On a desktop, open Calibrator and generate a pairing code. Then tap ",e.jsx("span",{className:"font-semibold",children:"Pair with Desktop"})," from the mobile camera page to connect this device."]})]}),e.jsx("button",{type:"button",className:"self-center text-xs font-medium text-indigo-200 underline decoration-dotted decoration-indigo-300/70 transition hover:text-indigo-100",onClick:()=>D(!0),children:"Continue to desktop calibrator"})]})}return e.jsxs("div",{className:"space-y-6",children:[k&&A&&e.jsx("div",{className:"rounded-2xl border border-indigo-400/30 bg-indigo-500/10 p-4 text-sm text-indigo-100",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"leading-relaxed",children:"Using a phone? Switch back to the streamlined mobile camera interface for an easier pairing flow."}),e.jsx("button",{type:"button",className:"btn btn--ghost px-3 py-1 text-xs",onClick:()=>D(!1),children:"Open mobile camera mode"})]})}),e.jsxs("div",{className:"card space-y-6 p-6",children:[e.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-indigo-300",children:"Marker calibration"}),e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-white",children:"Align your board with the autoscoring overlay"}),e.jsx("p",{className:"max-w-2xl text-sm opacity-80",children:"Place the printable fiducial markers around the double ring, capture a clear frame, and let the calibrator compute a precise homography."})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 text-xs font-medium",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-indigo-400/50 bg-indigo-500/10 px-3 py-1",children:[e.jsx("span",{className:"opacity-60",children:"Mode"}),e.jsx("span",{children:f==="local"?"Desktop camera":f==="phone"?"Phone camera":"Wifi device"})]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 ${n?"border-emerald-400/60 bg-emerald-500/10 text-emerald-100":"border-white/20 bg-white/5 text-slate-200"}`,children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${n?"bg-emerald-400":"bg-slate-400"}`}),n?"Live stream active":"Stream idle"]}),_?e.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-emerald-400/60 bg-emerald-500/10 px-3 py-1 text-emerald-100",children:e.jsxs("span",{children:["Locked • ",O!=null?`${O.toFixed(2)}px error`:"ready"]})}):e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-amber-400/40 bg-amber-500/10 px-3 py-1 text-amber-100",children:[e.jsx("span",{children:"Not locked"}),O!=null&&e.jsxs("span",{children:["• ",O.toFixed(2),"px"]})]})]})]}),e.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(320px,1fr)]",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4 rounded-2xl border border-white/10 bg-black/40 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"uppercase tracking-wide opacity-60",children:"Video source"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:`btn px-3 py-1 ${f==="local"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{u("local"),ne(!1)},title:"Use local camera",children:"Local"}),e.jsx("button",{className:`btn px-3 py-1 ${f==="phone"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{u("phone"),ne(!1)},title:"Pair phone camera",children:"Phone"}),e.jsx("button",{className:`btn px-3 py-1 ${f==="wifi"?"bg-emerald-600 hover:bg-emerald-700":"bg-slate-700 hover:bg-slate-600"}`,onClick:()=>{u("wifi"),ne(!1),Tt()},title:"Discover wifi/USB autoscoring devices",children:"Wifi"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-70",children:"Zoom"}),e.jsx("input",{type:"range",min:50,max:200,step:5,value:Math.round((N||1)*100),onChange:B=>E(Math.max(.5,Math.min(2,Number(B.target.value)/100)))}),e.jsxs("span",{className:"w-12 text-right",children:[Math.round((N||1)*100),"%"]})]}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>E(1),children:"Actual"})]})]}),e.jsxs("div",{className:"relative w-full overflow-hidden rounded-2xl border border-indigo-400/30 bg-black",style:{aspectRatio:M?`${M.w} / ${M.h}`:"16 / 9"},children:[(!n||!me)&&e.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-gradient-to-br from-black/40 to-black/10",children:e.jsx(Ac,{calibrationComplete:d==="computed"})}),e.jsxs("div",{className:"absolute inset-0",style:{transform:`scale(${N||1})`,transformOrigin:"center center"},children:[e.jsx("video",{ref:t,onLoadedMetadata:B=>{try{const J=B.currentTarget;J.videoWidth&&J.videoHeight&&I({w:J.videoWidth,h:J.videoHeight})}catch{}},className:`absolute inset-0 h-full w-full object-cover transition-opacity duration-300 ${g?"opacity-0 -z-10":"opacity-100 z-10"}`,autoPlay:!0,playsInline:!0,muted:!0,controls:!1}),l&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur",children:e.jsx("button",{className:"rounded-lg bg-white px-4 py-2 font-semibold text-slate-900 shadow-lg",onClick:async()=>{try{await t.current?.play(),o(!1),r(!0),c("capture")}catch(B){console.warn("Tap-to-play retry failed",B),alert("Tap to enable video failed. Please check browser settings or reload the page.")}},children:"Tap to allow video"})}),e.jsx("canvas",{ref:a,className:`absolute inset-0 h-full w-full transition-opacity duration-300 ${g?"opacity-100 z-10":"opacity-0 -z-10"}`}),e.jsx("canvas",{ref:s,onClick:_t,className:"absolute inset-0 z-30 h-full w-full cursor-crosshair"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",className:"accent-indigo-600",checked:T,onChange:B=>H(B.target.checked)}),"Show preferred-view guide overlay"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Phase"}),e.jsx("div",{className:"text-sm font-semibold capitalize",children:d})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Points selected"}),e.jsxs("div",{className:"text-sm font-semibold",children:[x.length," / 6"]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("div",{className:"uppercase tracking-wide opacity-60",children:"Fit error"}),e.jsx("div",{className:"text-sm font-semibold",children:O!=null?`${O.toFixed(2)} px`:"—"})]})]})]}),e.jsxs("aside",{className:"space-y-4",children:[e.jsx(Zs,{}),f==="phone"&&e.jsxs("section",{className:"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white",children:[e.jsx("div",{className:"font-semibold",children:"Phone pairing"}),e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>F(vt,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all text-[11px]",children:vt}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:Nt==="link"?"Copied!":"Copy link"})]}),e.jsx("div",{className:"flex items-center gap-2 text-[11px]",children:e.jsx("a",{href:vt,target:"_blank",rel:"noreferrer",className:"underline decoration-dotted text-indigo-200 hover:text-indigo-100 transition",children:"Open link in new tab"})}),e.jsxs("div",{className:"opacity-80",children:["WS: ",Be?Be.readyState===1?"open":Be.readyState===0?"connecting":Be.readyState===2?"closing":"closed":"not started"," · ",ee?.https?"HTTPS on":"HTTP only"]}),ce&&e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>F(ce,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:ce}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:Nt==="code"?"Copied!":"Copy code"})]}),et&&e.jsx("img",{className:"mt-1 h-40 w-40 rounded bg-white",alt:"Scan to open",src:et}),e.jsxs("div",{className:"flex items-center gap-2",children:[Qt!==null&&e.jsxs("span",{children:["Expires in ",Qt,"s"]}),e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:je,children:"Regenerate"})]}),Ye&&e.jsxs("div",{className:"space-y-2 rounded-lg border border-slate-700/50 bg-slate-900/60 p-3 text-slate-200",children:[e.jsx("div",{className:"font-semibold",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc space-y-1 pl-4",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wi‑Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",ee?.https?ee.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer HTTPS when enabled)."})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>Ut(!1),children:"Hide tips"})})]})]}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 1 · Capture image"}),e.jsx("p",{className:"text-xs opacity-70",children:"Start your preferred camera or upload a static photo of the board."})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>ne(!0),children:"Stop camera"}),e.jsx("button",{className:"btn",onClick:pe,disabled:!n,children:"Capture frame"})]}):e.jsxs(e.Fragment,{children:[f==="local"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",onClick:V,title:"Click to enable camera (will request permission if needed)",children:"Enable camera"}),e.jsx("button",{className:"btn btn--ghost text-xs",onClick:async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),console.log("[Calibrator] Camera permission granted via button")}catch{alert("Camera permission denied. Please enable camera access in your browser settings.")}},children:"Request permission"})]}),f==="phone"&&e.jsx("button",{className:"btn",onClick:nt,children:"Pair phone camera"}),f==="wifi"&&e.jsx("button",{className:"btn",onClick:Tt,children:"Connect wifi camera"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("input",{ref:i,type:"file",accept:"image/*",className:"hidden",onChange:Te}),e.jsx("button",{className:"btn",onClick:at,children:"Upload photo"})]})]}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 2 · Detect markers"}),e.jsx("p",{className:"text-xs opacity-70",children:"Use fiducials or auto-detect to seed the rim points."})]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] ${Re>=85?"border-emerald-400/60 bg-emerald-500/10 text-emerald-100":"border-white/20 bg-white/5 text-slate-200"}`,children:[e.jsx("span",{className:"opacity-70",children:"Confidence"}),e.jsxs("span",{children:[Re,"%"]})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",className:"accent-indigo-600",checked:Ke,onChange:B=>ge(B.target.checked)}),"Live auto-detect while streaming"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:!g,onClick:Qs,children:"Auto detect"}),e.jsx("button",{className:"btn",disabled:!g,onClick:Es,children:"Detect markers"})]}),Je&&e.jsx("div",{className:`rounded-lg border px-3 py-2 text-xs ${Je.success?"bg-emerald-500/10 border-emerald-500/30 text-emerald-100":"bg-rose-500/10 border-rose-500/30 text-rose-100"}`,children:Je.success?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Detected markers → board anchors:"," ",Zi.map(B=>{const J=Je.assignments?.[B];return`${B.toUpperCase()}→${J?`ID ${J.id}`:"—"}`}).join(", ")]}),Je.errorPx!=null&&e.jsxs("div",{children:["RMS error: ",Je.errorPx.toFixed(2)," px"]}),e.jsxs("div",{className:"opacity-80",children:["Markers correspond to IDs TOP ",ps.top,", RIGHT ",ps.right,", BOTTOM ",ps.bottom,", LEFT ",ps.left,"."]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:Je.message||"Unable to detect all markers."}),Je.missing.length>0&&e.jsxs("div",{children:["Missing: ",Je.missing.map(B=>`${B.toUpperCase()} (ID ${ps[B]})`).join(", ")]})]})})]}),e.jsxs("section",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Step 3 · Align & lock"}),e.jsx("p",{className:"text-xs opacity-70",children:"Click 6 points in order: ① TOP ② RIGHT ③ BOTTOM ④ LEFT of double rim, then ⑤ BULLSEYE center ⑥ outer bull top. Refine edges, then lock."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:x.length<4,onClick:As,children:"Compute"}),e.jsx("button",{className:`btn ${_?"bg-emerald-600 hover:bg-emerald-700":""}`,onClick:()=>$({locked:!_}),children:_?"Unlock":"Lock in"})]}),_&&e.jsxs("div",{className:"text-xs opacity-75",children:["Calibration saved ",O!=null?`· error ${O.toFixed(2)} px`:""]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:x.length===0,onClick:Fe,children:"Undo"}),e.jsx("button",{className:"btn",disabled:x.length===0,onClick:Us,children:"Refine points"}),e.jsx("button",{className:"btn",onClick:$s,children:"Reset"})]})]})]})]}),f==="wifi"&&!n&&e.jsxs("div",{className:"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white",children:[e.jsx("div",{className:"font-semibold",children:"Wifi scoring devices"}),$e?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-white"}),e.jsx("span",{children:"Scanning network for devices…"})]}):At.length>0?e.jsxs("div",{className:"space-y-2",children:[At.map(B=>e.jsxs("div",{className:"flex items-center justify-between rounded border border-slate-700/50 bg-slate-900/60 p-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:B.name}),e.jsxs("div",{className:"opacity-70",children:[B.ip,":",B.port," · ",B.type.toUpperCase()]}),e.jsxs("div",{className:"opacity-70 text-xs",children:["Capabilities: ",B.capabilities.join(", ")]})]}),e.jsx("button",{className:`btn px-2 py-1 text-xs ${B.status==="connecting"?"bg-yellow-600":B.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>U(B),disabled:B.status==="connecting",children:B.status==="connecting"?"Connecting…":"Connect"})]},B.id)),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:Tt,children:"Rescan network"})})]}):e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("div",{children:"No wifi scoring devices found."}),e.jsx("div",{className:"opacity-70",children:"Ensure your wifi cameras are powered on and on the same network."}),e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:Tt,children:"Scan again"})]})]})]})]})}const Bd=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function Ud(t){return t==="DB"?50:Number(t.slice(1))*2}function $d(t){return Bd.includes(t)?Ud(t):32}function oa(t,a="D16"){if(t>170||t<=1)return[];const s={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(s[t])return s[t];const i=$d(a),n=[];for(const r of[60,57,54,51,48])if(t-r===i){n.push(`T${r/3} ${a}`);break}if(!n.length){for(const r of[20,19,18,17,16,15])if(t-r===i){n.push(`${r} ${a}`);break}}return n}function ra(t,a,s,i,n){try{const r=window.speechSynthesis;if(!r)return;const l=new SpeechSynthesisUtterance,o=s<=170&&s>0;if(n?.checkoutOnly&&!o)return;if(l.text=o?`${t}, you have ${s} remaining.`:`${a}`,i){const d=r.getVoices().find(c=>c.name===i);d&&(l.voice=d)}typeof n?.volume=="number"&&(l.volume=Math.max(0,Math.min(1,n.volume))),l.rate=1,l.pitch=1,r.speak(l)}catch{}}function la({label:t,autoStart:a=!1,scale:s,className:i,aspect:n="inherit",style:r,fill:l=!1}){const o=m.useRef(null),[d,c]=m.useState(!1),[f,u]=m.useState(null),[x,p]=m.useState(null),[g,S]=m.useState(null),[M,I]=m.useState(()=>localStorage.getItem("ndn:camera:mode")||"local"),[N,E]=m.useState(null),[A,D]=m.useState(Date.now()),[k,b]=m.useState(!1),[y,$]=m.useState(null),[Y,O]=m.useState(null),[_,T]=m.useState(!0),[H,ae]=m.useState([]),[P,Z]=m.useState(!1),[se,ze]=m.useState([]),[ye,Me]=m.useState(!1),lt=ls(re=>re.autoscoreProvider),Ke=ls(re=>re.setPreferredCameraLocked);if(lt==="manual"){const ue=[l?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",i].filter(Boolean).join(" ").trim(),fe={...r||{}};return!l&&fe.aspectRatio===void 0&&fe.height===void 0&&fe.minHeight===void 0&&(fe.aspectRatio="4 / 3"),e.jsx("div",{className:ue,style:fe,children:e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active — camera feeds are disabled."})})}m.useEffect(()=>{const re=window.location.hostname;(re==="localhost"||re==="127.0.0.1")&&kt("/api/hosts").then(ue=>ue.json()).then(ue=>{const fe=Array.isArray(ue?.hosts)&&ue.hosts.find(me=>me);fe&&$(fe)}).catch(()=>{}),kt("/api/https-info").then(ue=>ue.json()).then(ue=>{ue&&typeof ue.https=="boolean"&&O({https:!!ue.https,port:Number(ue.port)||8788})}).catch(()=>{})},[]);const ge=m.useMemo(()=>{const re=x||"____",ue="ws://localhost:8787";if(ue.length>0)try{const et=new URL(ue);return`${`${et.protocol==="wss:"?"https":"http"}://${et.host}${et.pathname.endsWith("/ws")?"":et.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${re}`}catch{}const fe=y||window.location.hostname,me=!!Y?.https,qe=me?Y?.port||8788:8787;return`${me?"https":"http"}://${fe}:${qe}/mobile-cam.html?code=${re}`},[x,y,Y]);m.useEffect(()=>{localStorage.setItem("ndn:camera:mode",M)},[M]);const[Re,ct]=m.useState("");m.useEffect(()=>{if(!x){ct("");return}Po.toDataURL(ge,{width:160,margin:1,color:{dark:"#000000",light:"#ffffff"}}).then(ct).catch(()=>ct(""))},[ge,x]),m.useEffect(()=>{if(!N)return;const re=setInterval(()=>D(Date.now()),1e3);return()=>clearInterval(re)},[N]);const Je=m.useMemo(()=>N?Math.max(0,Math.ceil((N-A)/1e3)):null,[N,A]);m.useEffect(()=>{a?Ne().catch(()=>{}):le()},[a]);async function Ne(){if(M==="wifi")return Be();try{const{preferredCameraId:re,setPreferredCamera:ue}=ls.getState(),fe=re?{video:{deviceId:{exact:re}},audio:!1}:{video:!0,audio:!1};let me;try{me=await navigator.mediaDevices.getUserMedia(fe)}catch(qe){const Le=qe&&(qe.name||qe.code)||"";if(re&&(Le==="OverconstrainedError"||Le==="NotFoundError"))me=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw qe}o.current&&(o.current.srcObject=me,await o.current.play(),c(!0))}catch{}}function le(){o.current&&o.current.srcObject&&(o.current.srcObject.getTracks().forEach(ue=>ue.stop()),o.current.srcObject=null,c(!1))}async function Be(){Z(!0);try{const re=await Uo();ae(re),re.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(re){console.error("Wifi device discovery failed:",re),alert("Failed to discover wifi devices. Please check your network connection.")}finally{Z(!1)}}async function we(re){try{ae(fe=>fe.map(me=>me.id===re.id?{...me,status:"connecting"}:me));const ue=await Fo(re);if(ue&&o.current)o.current.srcObject=ue,await o.current.play(),c(!0),ae(fe=>fe.map(me=>me.id===re.id?{...me,status:"online"}:me));else throw new Error("Failed to get video stream")}catch(ue){console.error("Failed to connect to wifi device:",ue),alert(`Failed to connect to ${re.name}. Please check the device and try again.`),ae(fe=>fe.map(me=>me.id===re.id?{...me,status:"offline"}:me))}}async function ke(){Me(!0);try{const re=await Pd();ze(re);const ue=await Rd();ue&&ze(fe=>[...fe,ue]),re.length===0&&!ue&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(re){console.error("USB device discovery failed:",re),alert("Failed to discover USB devices. Please check device connections.")}finally{Me(!1)}}async function ce(re){try{ze(fe=>fe.map(me=>me.id===re.id?{...me,status:"connecting"}:me));const ue=await Ld(re);if(ue&&o.current)o.current.srcObject=ue,await o.current.play(),c(!0),I("wifi"),ze(fe=>fe.map(me=>me.id===re.id?{...me,status:"online"}:me));else throw new Error("Failed to get video stream")}catch(ue){console.error("Failed to connect to USB device:",ue),alert(`Failed to connect to ${re.name}. Please check the device and try again.`),ze(fe=>fe.map(me=>me.id===re.id?{...me,status:"offline"}:me))}}function de(){if(f&&f.readyState===WebSocket.OPEN)return f;const re="ws://localhost:8787",ue=re.length>0?re.endsWith("/ws")?re:re.replace(/\/$/,"")+"/ws":void 0,fe=window.location.protocol==="https:"?"wss":"ws",me=`${fe}://${window.location.host}/ws`,qe=window.location.hostname,Le=qe==="localhost"||qe==="127.0.0.1",et=qe.endsWith("onrender.com"),yt="wss://ninedartnation.onrender.com/ws";let ht=ue;ht||(Le?ht=`${fe}://${qe}:8787/ws`:et?ht=me:ht=yt),ht||(ht=me);const C=new WebSocket(ht);return u(C),C}async function Ee(){I("phone"),b(!1);const re=de();re.readyState===WebSocket.OPEN?re.send(JSON.stringify({type:"cam-create"})):re.onopen=()=>re.send(JSON.stringify({type:"cam-create"})),re.onmessage=async ue=>{const fe=JSON.parse(ue.data);if(fe.type==="cam-code")p(fe.code),fe.expiresAt&&E(fe.expiresAt);else if(fe.type==="cam-peer-joined"){b(!0);const me=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});S(me),me.onicecandidate=Le=>{Le.candidate&&x&&re.send(JSON.stringify({type:"cam-ice",code:x,payload:Le.candidate}))},me.ontrack=Le=>{if(o.current){const et=Le.streams?.[0];et&&(o.current.srcObject=et,o.current.play().catch(()=>{}),c(!0))}};const qe=await me.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await me.setLocalDescription(qe),x&&re.send(JSON.stringify({type:"cam-offer",code:x,payload:qe}))}else if(fe.type==="cam-answer")g&&await g.setRemoteDescription(new RTCSessionDescription(fe.payload));else if(fe.type==="cam-ice"&&g)try{await g.addIceCandidate(fe.payload)}catch{}}}function jt(){p(null),E(null),b(!1),f&&f.readyState===WebSocket.OPEN?f.send(JSON.stringify({type:"cam-create"})):Ee();try{Ke(!0)}catch{}}function Ue(){if(le(),p(null),b(!1),E(null),g){try{g.close()}catch{}S(null)}}return e.jsx(Fd,{label:t,autoStart:a,start:Ne,stopAll:Ue,startPhonePairing:Ee,startWifiConnection:Be,startUsbConnection:ke,connectToWifiDevice:we,connectToUsbDevice:ce,videoRef:o,streaming:d,mode:M,setMode:I,pairCode:x,mobileUrl:ge,ttl:Je,qrDataUrl:Re,regenerateCode:jt,httpsInfo:Y,showTips:_,setShowTips:T,wifiDevices:H,usbDevices:se,discoveringWifi:P,discoveringUsb:ye,scaleOverride:s,className:i,aspect:n,style:r,fill:l})}function Fd(t){const{cameraScale:a,cameraAspect:s}=ls(),i=Math.max(.5,Math.min(1.25,Number(t.scaleOverride??a??1))),{label:n,start:r,stopAll:l,startPhonePairing:o,startWifiConnection:d,startUsbConnection:c,connectToWifiDevice:f,connectToUsbDevice:u,videoRef:x,streaming:p,mode:g,setMode:S,pairCode:M,mobileUrl:I,ttl:N,qrDataUrl:E,regenerateCode:A,httpsInfo:D,showTips:k,setShowTips:b,wifiDevices:y,usbDevices:$,discoveringWifi:Y,discoveringUsb:O,className:_,aspect:T,style:H,fill:ae}=t,[P,Z]=m.useState(null),se=m.useRef(null);m.useEffect(()=>()=>{se.current&&window.clearTimeout(se.current)},[]);const ze=T&&T!=="inherit"?T:s||"wide",ye=ze!=="free",Me=ye?ze==="square"?"aspect-square":ze==="portrait"?"aspect-[3/4]":ze==="classic"?"aspect-[4/3]":"aspect-video":"",Ke=[ae?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto flex flex-col",_].filter(Boolean).join(" ").trim(),ge={...H||{}},Re=ae?"relative flex-1 min-h-[220px] bg-black":"relative w-full bg-black",ct={style:{transform:`scale(${i})`,transformOrigin:"center"}},Je=(()=>{const le="absolute inset-0 w-full h-full object-contain object-center bg-black";return ae?ye?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`relative w-full max-w-full max-h-full ${Me}`,children:e.jsx("video",{ref:x,className:le,...ct})})}):e.jsx("video",{ref:x,className:le,...ct}):ye?e.jsx("div",{className:`relative w-full ${Me}`,children:e.jsx("video",{ref:x,className:le,...ct})}):e.jsx("video",{ref:x,className:"w-full h-full object-contain object-center bg-black",...ct})})();async function Ne(le,Be){if(le)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(le);else{const we=document.createElement("textarea");we.value=le,we.style.position="fixed",we.style.opacity="0",document.body.appendChild(we),we.focus(),we.select(),document.execCommand("copy"),document.body.removeChild(we)}Z(Be),se.current&&window.clearTimeout(se.current),se.current=window.setTimeout(()=>Z(null),1500)}catch(we){console.warn("Copy to clipboard failed:",we),Z(null)}}return e.jsxs("div",{className:Ke,style:ge,children:[e.jsx("div",{className:Re,children:Je}),e.jsxs("div",{className:"p-1 flex items-center justify-between bg-black/60 text-white text-[10px] gap-1",children:[e.jsx("span",{className:"truncate",children:n||(p?g==="phone"?"PHONE LIVE":g==="wifi"?"WIFI LIVE":"LIVE":"Camera")}),e.jsxs("div",{className:"flex items-center gap-1",children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-1 py-0.5 rounded ${g==="local"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{S("local"),r()},children:"Local"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${g==="phone"?"bg-emerald-600":"bg-slate-700"}`,onClick:o,children:"Phone"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${g==="wifi"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{S("wifi"),d()},children:"Wifi"}),e.jsx("button",{className:`px-1 py-0.5 rounded ${g==="wifi"?"bg-emerald-600":"bg-slate-700"}`,onClick:()=>{S("wifi"),c()},children:"USB"})]}),p?e.jsx("button",{className:"px-1 py-0.5 rounded bg-rose-600",onClick:l,children:"Stop"}):null]})]}),g==="phone"&&M&&!p&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),e.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>Ne(I,"link"),title:"Copy mobile camera link",children:[e.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:I}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:P==="link"?"Copied!":"Copy"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("a",{href:I,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),e.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>Ne(M,"code"),title:"Copy pairing code",children:[e.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:M}),e.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:P==="code"?"Copied!":"Copy"})]})]}),E&&e.jsx("img",{className:"mt-1 w-[160px] h-[160px] bg-white rounded",alt:"Scan to open",src:E}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[N!==null&&e.jsxs("span",{children:["Expires in ",N,"s"]}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:A,children:"Regenerate"})]}),k&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Phone and desktop must be on the same Wi‑Fi network."}),e.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",D?.https?D.port:8788,")."]}),e.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>b(!1),children:"Hide tips"})})]})]}),g==="wifi"&&!p&&e.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),Y?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning network..."})]}):y.length>0?e.jsxs("div",{className:"space-y-1",children:[y.map(le=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:le.name}),e.jsxs("div",{className:"opacity-70 text-[9px]",children:[le.ip,":",le.port]})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${le.status==="connecting"?"bg-yellow-600":le.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>f(le),disabled:le.status==="connecting",children:le.status==="connecting"?"...":"Connect"})]},le.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:d,children:"Rescan WiFi"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:d,children:"Scan WiFi"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),O?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),e.jsx("span",{children:"Scanning USB..."})]}):$.length>0?e.jsxs("div",{className:"space-y-1",children:[$.map(le=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:le.name}),e.jsx("div",{className:"opacity-70 text-[9px]",children:le.type.toUpperCase()})]}),e.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${le.status==="connecting"?"bg-yellow-600":le.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>u(le),disabled:le.status==="connecting",children:le.status==="connecting"?"...":"Connect"})]},le.id)),e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:c,children:"Rescan USB"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),e.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:c,children:"Scan USB"})]})]})]})]})}function _d(t){return t.dartsThrown===0?0:(t.totalScoreStart-t.totalScoreRemaining)/t.dartsThrown*3}function Hd(t){const a=_d(t),s=t.finished;return{avg:a,isCompleted:s,darts:t.dartsThrown,checkout:t.checkoutScore??0}}function Wd(t){if(t.legs.length===0)return;const a=[];let s,i=t.bestCheckout??0;for(const n of t.legs){if(!n.finished)continue;const r=Hd(n);a.push(r.avg),(!s||r.darts<s.darts||r.darts===s.darts&&(n.endTime??0)<s.timestamp)&&(s={darts:r.darts,timestamp:n.endTime??Date.now()}),r.checkout>i&&(i=r.checkout)}a.length&&(t.bestThreeDartAvg=Math.max(...a),t.worstThreeDartAvg=Math.min(...a)),s&&(t.bestNineDart=s),t.bestCheckout=i}const Bn=on((t,a)=>({roomId:"",players:[],currentPlayerIdx:0,startingScore:501,inProgress:!1,newMatch:(s,i,n="")=>t(()=>({players:s.map((l,o)=>({id:`${o}`,name:l,legsWon:0,legs:[]})),currentPlayerIdx:0,startingScore:i,inProgress:!0,roomId:n,bestLegThisMatch:void 0})),addVisit:(s,i)=>t(n=>{if(!n.inProgress)return n;const r=n.players[n.currentPlayerIdx];let l=r.legs[r.legs.length-1];return(!l||l.finished)&&(l={visits:[],totalScoreStart:n.startingScore,totalScoreRemaining:n.startingScore,dartsThrown:0,finished:!1,checkoutScore:null,startTime:Date.now()},r.legs.push(l)),l.visits.push({darts:i,score:s}),l.dartsThrown+=i,l.totalScoreRemaining=Math.max(0,l.totalScoreRemaining-s),{...n}}),undoVisit:()=>t(s=>{const i=s.players[s.currentPlayerIdx],n=i.legs[i.legs.length-1];if(!n||n.finished||n.visits.length===0)return s;const r=n.visits.pop();return n.dartsThrown-=r.darts,n.totalScoreRemaining+=r.score,{...s}}),endLeg:s=>t(i=>{const n=i.players[i.currentPlayerIdx],r=n.legs[n.legs.length-1];if(!r||r.finished)return i;if(r.finished=!0,r.checkoutScore=s,r.endTime=Date.now(),r.totalScoreRemaining===0){n.legsWon+=1;const l=i.bestLegThisMatch;(!l||r.dartsThrown<l.darts)&&(i.bestLegThisMatch={playerId:n.id,darts:r.dartsThrown,timestamp:r.endTime})}return{...i}}),nextPlayer:()=>t(s=>({...s,currentPlayerIdx:(s.currentPlayerIdx+1)%s.players.length})),endGame:()=>t(s=>{for(const i of s.players)Wd(i);return{...s,inProgress:!1}}),importState:s=>t(()=>({...s}))}));function zd(t,a){const s=md(t,a);return ud(s)}function qd(t){try{if(!t||typeof t!="object")return null;if((t.type==="dart"||t.kind==="dart"||t.event==="dart")&&typeof t.value=="number"){const a=eo(t.ring);return to(t.value,a)}if(typeof t.value=="number"&&t.ring){const a=eo(t.ring);return to(t.value,a)}if(typeof t.score=="string"){const a=t.score.trim().toUpperCase();if(a==="50"||a==="DBULL"||a==="INNER_BULL")return{value:50,ring:"INNER_BULL",sector:null,mult:0};if(a==="25"||a==="BULL"||a==="OBULL")return{value:25,ring:"BULL",sector:null,mult:0};const s=a.match(/^(S|D|T)(\d{1,2})$/);if(s){const i=s[1]==="S"?1:s[1]==="D"?2:3,n=parseInt(s[2],10);if(n>=1&&n<=20)return{value:n*i,ring:i===1?"SINGLE":i===2?"DOUBLE":"TRIPLE",sector:n,mult:i}}}if(typeof t.sector=="number"&&typeof t.mult=="number"){const a=Math.max(1,Math.min(20,Math.floor(t.sector))),s=t.mult===1?1:t.mult===2?2:3;return{value:a*s,ring:s===1?"SINGLE":s===2?"DOUBLE":"TRIPLE",sector:a,mult:s}}if(t.bull){const a=String(t.bull).toLowerCase()==="inner"||t.bull===!0;return{value:a?50:25,ring:a?"INNER_BULL":"BULL",sector:null,mult:0}}}catch{}return null}function eo(t){const a=String(t||"").toUpperCase();return a.startsWith("TR")?"TRIPLE":a.startsWith("DO")?"DOUBLE":a.startsWith("SI")?"SINGLE":a==="INNER_BULL"||a==="DBULL"||a==="50"||a==="IBULL"?"INNER_BULL":a==="BULL"||a==="25"||a==="OBULL"||a==="OUTER_BULL"?"BULL":a==="MISS"||a==="0"?"MISS":"SINGLE"}function to(t,a){const s=Math.max(0,Math.min(60,Math.round(Number(t)||0)));return a==="INNER_BULL"?{value:50,ring:a}:a==="BULL"?{value:25,ring:a}:{value:s,ring:a}}function Vd(t,a){let s=null,i=!0;function n(){if(i)try{s=new WebSocket(t),s.onmessage=r=>{try{const l=JSON.parse(r.data),o=qd(l);o&&a(o)}catch{}},s.onclose=()=>{s=null,setTimeout(n,1500)},s.onerror=()=>{}}catch{setTimeout(n,2e3)}}return n(),{close:()=>{i=!1;try{s?.close()}catch{}}}}function so({storageKey:t,children:a,className:s,defaultWidth:i=640,defaultHeight:n=360,minWidth:r=320,minHeight:l=200,maxWidth:o=1600,maxHeight:d=1200}){const[c,f]=m.useState(()=>{try{const N=localStorage.getItem(t);if(N)return JSON.parse(N)}catch{}return{width:i,height:n}}),u=m.useRef(null),x=m.useRef(null);m.useEffect(()=>{function N(){try{localStorage.removeItem(t)}catch{}f({width:i,height:n})}return window.addEventListener("ndn:layout-reset",N),window.addEventListener("ndn:camera-reset",N),()=>{window.removeEventListener("ndn:layout-reset",N),window.removeEventListener("ndn:camera-reset",N)}},[t,i,n]),m.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(c))}catch{}},[c,t]);function p(N,E,A){return Math.max(E,Math.min(A,N))}function g(N,E){N.preventDefault();const A=x.current;if(!A)return;const D=A.getBoundingClientRect();u.current={x:N.clientX,y:N.clientY,w:D.width,h:D.height,dir:E},window.addEventListener("mousemove",S),window.addEventListener("mouseup",M)}function S(N){const E=u.current;if(!E)return;const A=N.clientX-E.x,D=N.clientY-E.y;let k=E.w,b=E.h;E.dir.includes("e")&&(k=p(E.w+A,r,o)),E.dir.includes("s")&&(b=p(E.h+D,l,d)),E.dir.includes("w")&&(k=p(E.w-A,r,o)),E.dir.includes("n")&&(b=p(E.h-D,l,d)),f({width:Math.round(k),height:Math.round(b)})}function M(){window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",M),u.current=null}const I={width:c.width?`${c.width}px`:void 0,height:c.height?`${c.height}px`:void 0,maxWidth:"100%",maxHeight:"80vh",position:"relative"};return e.jsxs("div",{ref:x,className:`${s||""}`,style:I,children:[a,e.jsx("div",{className:"resizer resizer-nw",onMouseDown:N=>g(N,"nw")}),e.jsx("div",{className:"resizer resizer-ne",onMouseDown:N=>g(N,"ne")}),e.jsx("div",{className:"resizer resizer-sw",onMouseDown:N=>g(N,"sw")}),e.jsx("div",{className:"resizer resizer-se",onMouseDown:N=>g(N,"se")})]})}function Xs({storageKey:t,children:a,className:s,defaultWidth:i=520,defaultHeight:n,minWidth:r=360,minHeight:l=200,maxWidth:o=1100,maxHeight:d=900,fullScreen:c=!1,initialFitHeight:f=!1}){const[u,x]=m.useState(()=>{if(!c){try{const D=localStorage.getItem(t);if(D)return JSON.parse(D)}catch{}return{width:i,height:n}}return{}}),p=m.useRef(null);m.useEffect(()=>{if(c)return;function D(){try{localStorage.removeItem(t)}catch{}if(f&&N.current?.parentElement){const k=N.current.parentElement,b=window.getComputedStyle(k),y=parseFloat(b.paddingTop||"0")||0,$=parseFloat(b.paddingBottom||"0")||0,Y=Math.max(0,k.clientHeight-y-$),O=Math.max(l,Math.min(d,Math.round(Y)));x({width:i,height:O});return}x({width:i,height:n})}return window.addEventListener("ndn:layout-reset",D),()=>window.removeEventListener("ndn:layout-reset",D)},[t,i,n,c]),m.useEffect(()=>{if(!c)try{localStorage.setItem(t,JSON.stringify(u))}catch{}},[u,t,c]),m.useEffect(()=>{if(c||!f)return;const D=N.current?.parentElement;if(!D)return;const k=window.getComputedStyle(D),b=parseFloat(k.paddingTop||"0")||0,y=parseFloat(k.paddingBottom||"0")||0,$=Math.max(0,D.clientHeight-b-y),Y=Math.max(l,Math.min(d,Math.round($)));try{const O=localStorage.getItem(t);if(O){const T=JSON.parse(O)?.height||0;(!T||T<Y)&&x(H=>({...H,height:Y}));return}}catch{}x(O=>({...O,height:Y}))},[f,c,t,l,d]);function g(D,k,b){return Math.max(k,Math.min(b,D))}function S(D,k){D.preventDefault();const b=N.current;if(!b)return;const y=b.getBoundingClientRect();p.current={x:D.clientX,y:D.clientY,w:y.width,h:y.height,dir:k},window.addEventListener("mousemove",M),window.addEventListener("mouseup",I)}function M(D){const k=p.current;if(!k)return;const b=D.clientX-k.x,y=D.clientY-k.y,$=k.dir;let Y=k.w,O=k.h,_=1/0;const T=N.current?.parentElement;if(T){const ae=window.getComputedStyle(T),P=parseFloat(ae.paddingTop||"0")||0,Z=parseFloat(ae.paddingBottom||"0")||0;_=Math.max(0,T.clientHeight-P-Z)}const H=Math.min(d,isFinite(_)?_:d);$.includes("e")&&(Y=g(k.w+b,r,o)),$.includes("s")&&(O=g(k.h+y,l,H)),$.includes("w")&&(Y=g(k.w-b,r,o)),$.includes("n")&&(O=g(k.h-y,l,H)),x({width:Math.round(Y),height:Math.round(O)})}function I(){window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",I),p.current=null}const N=m.useRef(null),E=c?{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%"}:{width:u.width?`${u.width}px`:void 0,height:u.height?`${u.height}px`:void 0,maxWidth:`${o}px`,maxHeight:"100%"},A=c?"card relative ndn-modal-full":"card relative";return e.jsxs("div",{ref:N,className:`${A} ${s||""}`,style:E,children:[a,!c&&e.jsx("div",{className:"resizer resizer-nw",onMouseDown:D=>S(D,"nw")}),!c&&e.jsx("div",{className:"resizer resizer-ne",onMouseDown:D=>S(D,"ne")}),!c&&e.jsx("div",{className:"resizer resizer-sw",onMouseDown:D=>S(D,"sw")}),!c&&e.jsx("div",{className:"resizer resizer-se",onMouseDown:D=>S(D,"se")}),!c&&e.jsx("div",{className:"resizer-edge resizer-s",onMouseDown:D=>S(D,"s")})]})}const _o=on((t,a)=>({samples:[],addSample:s=>t(i=>({samples:[...i.samples,s]})),clear:()=>t({samples:[]}),export:()=>a().samples.slice()}));function Ze({onVisitCommitted:t,showToolbar:a=!0,onAutoDart:s,immediateAutoCommit:i=!1,hideInlinePanels:n=!1,scoringMode:r="x01",onGenericDart:l,onGenericReplace:o}){const d=m.useRef(null),{preferredCameraId:c,setPreferredCamera:f,autoscoreProvider:u,autoscoreWsUrl:x}=ls(),p=u==="manual",[g,S]=m.useState([]),M=m.useRef(null),I=m.useRef(null),[N,E]=m.useState(!1),[A,D]=m.useState(!1),[k,b]=m.useState(null),{H:y,imageSize:$,reset:Y,_hydrated:O}=Cr(),[_,T]=m.useState(""),[H,ae]=m.useState(""),[P,Z]=m.useState(0),[se,ze]=m.useState("MISS"),[ye,Me]=m.useState(0),[lt,Ke]=m.useState(0),[ge,Re]=m.useState([]),ct=Bn(U=>U.addVisit),Je=Bn(U=>U.endLeg),Ne=Bn(U=>U),le=_o(U=>U.addSample),[Be,we]=m.useState(""),[ke,ce]=m.useState(""),[de,Ee]=m.useState(0),[jt,Ue]=m.useState(!1),[re,ue]=m.useState(!1),[fe,me]=m.useState("auto"),[qe,Le]=m.useState(!1),[et,yt]=m.useState(!1),[ht,C]=m.useState(!1),ee=m.useRef(null);m.useEffect(()=>{const U=()=>{p||yt(!0)};return window.addEventListener("ndn:open-autoscore",U),()=>window.removeEventListener("ndn:open-autoscore",U)},[p]),m.useEffect(()=>{const U=()=>C(!0);return window.addEventListener("ndn:open-scoring",U),()=>window.removeEventListener("ndn:open-scoring",U)},[]),m.useEffect(()=>{const U=()=>{me("manual"),Le(!0)},V=()=>{me("auto"),Le(!1)};return window.addEventListener("ndn:open-manual",U),window.addEventListener("ndn:close-manual",V),()=>{window.removeEventListener("ndn:open-manual",U),window.removeEventListener("ndn:close-manual",V)}},[]),m.useEffect(()=>{p&&(me("manual"),yt(!1))},[p]),m.useEffect(()=>{if(!qe)return;const U=setInterval(()=>{try{const V=d.current,ne=ee.current;if(!V||!ne)return;const je=V.videoWidth||0,Ie=V.videoHeight||0;if(!je||!Ie)return;const at=ne.clientWidth||640,Te=ne.clientHeight||360;ne.width!==at&&(ne.width=at),ne.height!==Te&&(ne.height=Te);const pe=ne.getContext("2d");if(!pe)return;pe.imageSmoothingEnabled=!0;const mt=Math.min(at/je,Te/Ie),_t=Math.round(je*mt),Fe=Math.round(Ie*mt),Us=Math.floor((at-_t)/2),As=Math.floor((Te-Fe)/2);pe.fillStyle="#000",pe.fillRect(0,0,at,Te),pe.drawImage(V,Us,As,_t,Fe)}catch(V){console.warn("Manual preview update error:",V)}},120);return()=>clearInterval(U)},[qe]),m.useEffect(()=>()=>Ye(),[]);async function Ct(){if(!(A||N)){D(!0),console.log("[CAMERA] Starting camera...");try{const U=c?{video:{deviceId:{exact:c}},audio:!1}:{video:{facingMode:"environment"},audio:!1};console.log("[CAMERA] Using constraints:",U);let V;try{V=await navigator.mediaDevices.getUserMedia(U),console.log("[CAMERA] Got stream:",!!V)}catch(ne){console.warn("[CAMERA] First attempt failed:",ne);const je=ne&&(ne.name||ne.code)||"";if(c&&(je==="OverconstrainedError"||je==="NotFoundError"))console.log("[CAMERA] Trying fallback without deviceId"),V=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else if(!c&&(je==="OverconstrainedError"||je==="NotFoundError"||je==="NotSupportedError"))console.log("[CAMERA] Trying fallback for facingMode not supported"),V=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw ne}if(d.current){console.log("[CAMERA] Setting stream to video element"),d.current.srcObject=V,console.log("[CAMERA] Stream tracks:",V.getTracks().length,"video tracks:",V.getVideoTracks().length),d.current.addEventListener("loadeddata",()=>console.log("[CAMERA] Video loadeddata")),d.current.addEventListener("canplay",()=>console.log("[CAMERA] Video canplay")),d.current.addEventListener("play",()=>console.log("[CAMERA] Video started playing")),d.current.addEventListener("error",ne=>console.error("[CAMERA] Video error:",ne));try{d.current.play(),console.log("[CAMERA] Play called successfully")}catch(ne){console.error("[CAMERA] Video play failed:",ne),setTimeout(()=>{try{d.current?.play(),console.log("[CAMERA] Retry play called")}catch(je){console.error("[CAMERA] Retry play failed:",je)}},100)}}else console.error("[CAMERA] Video element not found");E(!0);try{const ne=await navigator.mediaDevices.enumerateDevices();S(ne.filter(je=>je.kind==="videoinput")),console.log("[CAMERA] Found cameras:",ne.filter(je=>je.kind==="videoinput").length)}catch(ne){console.warn("[CAMERA] Failed to enumerate devices:",ne)}}catch(U){console.error("[CAMERA] Camera start failed:",U),alert("Camera permission denied or not available.")}finally{D(!1)}}}function Ye(){d.current&&d.current.srcObject&&(d.current.srcObject.getTracks().forEach(V=>V.stop()),d.current.srcObject=null,E(!1),D(!1))}function Ut(){try{if(!d.current||!M.current)return;const U=d.current,V=M.current;V.width=U.videoWidth,V.height=U.videoHeight;const ne=V.getContext("2d");if(!ne)return;ne.drawImage(U,0,0,V.width,V.height);const je=V.toDataURL("image/png");b(je)}catch(U){console.warn("Capture error:",U)}}function At(){return g.length?e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs",children:[e.jsx("span",{children:"Cam:"}),e.jsxs("select",{className:"bg-black/20 rounded px-1 py-0.5",value:c||"",onChange:async U=>{if(A)return;const V=U.target.value||void 0,ne=g.find(je=>je.deviceId===V)?.label;f(V,ne||"",!0),Ye(),await new Promise(je=>setTimeout(je,100));try{await Ct()}catch(je){console.warn("Failed to start camera after device switch:",je),setTimeout(async()=>{try{await Ct()}catch(Ie){console.error("Camera switch failed after retry:",Ie),alert("Failed to switch camera. Please try again or refresh the page.")}},500)}},children:[e.jsx("option",{value:"",children:"Auto"}),g.map(U=>e.jsx("option",{value:U.deviceId,children:U.label||"Camera"},U.deviceId))]})]}):null}function Et(){try{if(!I.current||!d.current||!y||!$)return;const U=I.current,V=d.current,ne=V.clientWidth,je=V.clientHeight;U.width=ne,U.height=je;const Ie=U.getContext("2d");if(!Ie)return;Ie.clearRect(0,0,ne,je);const at=ne/$.w,Te=je/$.h,pe=od(y,at,Te),mt=[Ge.bullInner,Ge.bullOuter,Ge.trebleInner,Ge.trebleOuter,Ge.doubleInner,Ge.doubleOuter];for(const _t of mt){const Fe=Lo(pe,_t,360);Oo(Ie,Fe,_t===Ge.doubleOuter?"#22d3ee":"#a78bfa",_t===Ge.doubleOuter?3:2)}}catch(U){console.warn("Overlay drawing error:",U)}}m.useEffect(()=>{if(p)return;const U=setInterval(Et,250);return()=>clearInterval(U)},[y,$,N,p]),m.useEffect(()=>{if(u!=="external-ws"||!x)return;const U=Vd(x,V=>{if(s){try{s(V.value,V.ring,{sector:V.sector??null,mult:V.mult??0})}catch{}try{le({playerId:Ne.players[Ne.currentPlayerIdx]?.id??null,sector:V.sector??null,mult:V.mult??0,ring:V.ring,ts:Date.now()})}catch{}}else{const ne=V.ring==="INNER_BULL"?"INNER_BULL 50":V.ring==="BULL"?"BULL 25":`${V.ring[0]}${V.value/(V.mult||1)||V.value} ${V.value}`;pt(V.value,ne,V.ring);try{le({playerId:Ne.players[Ne.currentPlayerIdx]?.id??null,sector:V.sector??null,mult:V.mult??0,ring:V.ring,ts:Date.now()})}catch{}}});return()=>U.close()},[u,x]);function $e(U){if(!I.current||!y||!$)return;const V=I.current.getBoundingClientRect(),ne=U.clientX-V.left,je=U.clientY-V.top,Ie=I.current.width/$.w,at=I.current.height/$.h,Te={x:ne/Ie,y:je/at},pe=zd(y,Te),mt=`${pe.ring} ${pe.base>0?pe.base:""}`.trim();T(mt),Z(pe.base),ze(pe.ring),ue(!0);try{if(i&&s){s(pe.base,pe.ring,{sector:pe.sector,mult:pe.mult});try{le({playerId:Ne.players[Ne.currentPlayerIdx]?.id??null,sector:pe.sector??null,mult:pe.mult??0,ring:pe.ring,ts:Date.now()})}catch{}ue(!1)}}catch{}}function Vt(U){const V=U.trim().toUpperCase();if(!V)return null;const ne=V==="BULL"||V==="50"||V==="DBULL"||V==="IBULL",je=V==="25"||V==="OBULL";if(ne)return{label:"INNER_BULL 50",value:50,ring:"INNER_BULL"};if(je)return{label:"BULL 25",value:25,ring:"BULL"};const Ie=V.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!Ie)return null;const at=Ie[1]||"S",Te=parseInt(Ie[2],10);if(Te<1||Te>20)return null;const pe=at==="S"?1:at==="D"?2:3,mt=at==="S"?"SINGLE":at==="D"?"DOUBLE":"TRIPLE";return{label:`${at}${Te} ${Te*pe}`,value:Te*pe,ring:mt}}function Nt(){const U=Ne;if(!U.players.length)return U.startingScore;const V=U.players[U.currentPlayerIdx],ne=V.legs[V.legs.length-1];return ne?ne.totalScoreRemaining:U.startingScore}function pt(U,V,ne){if(r==="custom"){if(l)try{l(U,ne,{label:V})}catch{}if(ye>=3)return;const _t=ye+1;Me(_t),Ke(Fe=>Fe+U),Re(Fe=>[...Fe,{label:V,value:U,ring:ne}]);return}if(ye>=3)return;const je=ye+1,Ie=lt+U,Te=Nt()-Ie,pe=Te===0&&(ne==="DOUBLE"||ne==="INNER_BULL");if(Te<0||Te===1||Te===0&&!pe){ct(0,je),Me(0),Ke(0),Re([]),t&&t(0,je,!1);return}if(Me(je),Ke(Ie),Re(_t=>[..._t,{label:V,value:U,ring:ne}]),pe){ct(Ie,je),Je(Ie),Me(0),Ke(0),Re([]),t&&t(Ie,je,!0);return}je>=3&&(ct(Ie,je),Me(0),Ke(0),Re([]),t&&t(Ie,je,!1))}function wt(){if(_){if(s)try{s(P,se,void 0)}catch{}else pt(P,_,se);Ee(0),ue(!1)}}function vt(){const U=Vt(H);if(!U){alert("Enter like T20, D16, 5, 25, 50");return}if(!re||!_||se==="MISS"||P===0){const V=de+1;Ee(V),V>=3&&Ue(!0)}else Ee(0);pt(U.value,U.label,U.ring),ae(""),ue(!1)}function Ft(){const U=Vt(H);if(!U){alert("Enter like T20, D16, 5, 25, 50");return}if(ye===0||ge.length===0){vt();return}if(r==="custom"){if(!re||!_||se==="MISS"||P===0){const Fe=de+1;Ee(Fe),Fe>=3&&Ue(!0)}else Ee(0);if(Re(Fe=>[...Fe.slice(0,-1),{label:U.label,value:U.value,ring:U.ring}]),o)try{o(U.value,U.ring,{label:U.label})}catch{}ae(""),ue(!1);return}if(!re||!_||se==="MISS"||P===0){const Fe=de+1;Ee(Fe),Fe>=3&&Ue(!0)}else Ee(0);const V=ge[ge.length-1],ne=ye-1,je=lt-(V?.value||0),Ie=Nt(),at=je+U.value,Te=ne+1,pe=Ie-at,mt=pe===0&&(U.ring==="DOUBLE"||U.ring==="INNER_BULL");if(pe<0||pe===1||pe===0&&!mt){ct(0,Te);try{const Fe=Ne.players[Ne.currentPlayerIdx]?.name;Fe&&an(Fe,Te,0)}catch{}Me(0),Ke(0),Re([]),t&&t(0,Te,!1),ae(""),ue(!1);return}if(Me(Te),Ke(at),Re(Fe=>[...Fe.slice(0,-1),{label:U.label,value:U.value,ring:U.ring}]),mt){ct(at,Te),Je(at);try{const Fe=Ne.players[Ne.currentPlayerIdx]?.name;Fe&&an(Fe,Te,at)}catch{}Me(0),Ke(0),Re([]),t&&t(at,Te,!0),ae(""),ue(!1);return}if(Te>=3){ct(at,Te);try{const Fe=Ne.players[Ne.currentPlayerIdx]?.name;Fe&&an(Fe,Te,at)}catch{}Me(0),Ke(0),Re([]),t&&t(at,Te,!1)}ae(""),ue(!1)}function Qt(){Ue(!1),Ee(0);try{window.dispatchEvent(new CustomEvent("ndn:request-calibrate"))}catch{}}function F(){Y(),Ue(!1),Ee(0)}function xe(U,V){if(ye>=3)return;const ne=U*(V==="S"?1:V==="D"?2:3),je=V==="S"?"SINGLE":V==="D"?"DOUBLE":"TRIPLE";if(!re||!_||se==="MISS"||P===0){const Ie=de+1;Ee(Ie),Ie>=3&&Ue(!0)}else Ee(0);pt(ne,`${V}${U} ${ne}`,je),ue(!1)}function nt(){if(ye===0)return;const U=ge[ge.length-1];Me(V=>V-1),Ke(V=>V-(U?.value||0)),Re(V=>V.slice(0,-1))}function Tt(){if(ye!==0){if(r==="custom"){Me(0),Ke(0),Re([]);return}ct(lt,ye);try{const U=Ne.players[Ne.currentPlayerIdx]?.name;U&&an(U,ye,lt)}catch{}Me(0),Ke(0),Re([]),t&&t(lt,ye,!1)}}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!p&&e.jsx("button",{className:`btn px-3 py-1 text-sm ${fe==="auto"?"tab--active":""}`,onClick:()=>{me("auto"),Le(!1),yt(!0)},children:"Autoscore"}),e.jsx("button",{className:`btn px-3 py-1 text-sm ${fe==="manual"?"tab--active":""}`,onClick:()=>{me("manual"),Le(!0)},title:"Open Manual Correction",children:"Manual Correction"}),p&&e.jsx("span",{className:"text-xs opacity-70",children:"Manual scoring mode active"})]})}),!n&&!p?e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Camera"}),e.jsxs(so,{storageKey:"ndn:camera:size",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:320,minHeight:240,maxWidth:1600,maxHeight:900,children:[e.jsx(At,{}),e.jsx("video",{ref:d,className:"w-full h-full object-cover",playsInline:!0,"webkit-playsinline":"true",muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:I,className:"absolute inset-0 w-full h-full",onClick:$e})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[N?e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:Ye,children:"Stop Camera"}):e.jsx("button",{className:"btn",onClick:Ct,disabled:A,children:A?"Connecting Camera...":"Connect Camera"}),e.jsx("button",{className:"btn",onClick:Ut,disabled:!N,children:"Capture Still"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}):null,!n&&p&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Manual Scoring"}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:"Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>{Le(!0),me("manual")},children:"Open Manual Correction"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Manage Pending Visit"})]})]}),e.jsx("canvas",{ref:M,className:"hidden"}),et&&!p&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(Xs,{storageKey:"ndn:autoscore:size",className:"w-full max-w-3xl",defaultWidth:720,defaultHeight:520,minWidth:420,minHeight:320,maxWidth:1400,maxHeight:900,initialFitHeight:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Autoscore"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn btn--ghost",onClick:()=>yt(!1),children:"Close"})})]}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Click the camera overlay to autoscore. Use Manual Correction if the last auto is off."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:_||"—"}),e.jsx("button",{className:"btn",onClick:wt,disabled:ye>=3,children:"Add Auto Dart"}),de>0&&e.jsxs("span",{className:"text-sm opacity-80",children:["No-registers: ",de,"/3"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:ye>=3,onClick:()=>{if(!re||!_||se==="MISS"||P===0){const U=de+1;Ee(U),U>=3&&Ue(!0)}else Ee(0);pt(25,"BULL 25","BULL"),ue(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:ye>=3,onClick:()=>{if(!re||!_||se==="MISS"||P===0){const U=de+1;Ee(U),U>=3&&Ue(!0)}else Ee(0);pt(50,"INNER_BULL 50","INNER_BULL"),ue(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"autoscore-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:Be,onChange:U=>we(U.target.value.toUpperCase()),onKeyDown:U=>{if(U.key==="Enter"){const V=Be.match(/^(S|D|T)(\d{1,2})$/);V&&xe(parseInt(V[2],10),V[1])}}}),e.jsx("datalist",{id:"autoscore-quick-list",children:["D","S","T"].map(U=>Array.from({length:20},(V,ne)=>ne+1).map(V=>e.jsx("option",{value:`${U}${V}`},`${U}${V}`)))}),e.jsx("button",{className:"btn",disabled:!Be||ye>=3,onClick:()=>{const U=Be.match(/^(S|D|T)(\d{1,2})$/);if(!U)return;const V=U[1],ne=parseInt(U[2],10);xe(ne,V)},children:"Add"})]})]})]})})}),qe&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100]",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-semibold",children:"Manual Correction"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{Le(!1)},children:"Close"})})]}),e.jsx("div",{className:"flex-1 p-3 md:p-4",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card relative flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Live Preview"}),e.jsx("div",{className:"relative flex-1 rounded-2xl overflow-hidden bg-black",children:e.jsx("canvas",{ref:ee,className:"absolute inset-0 w-full h-full"})})]}),e.jsxs("div",{className:"card flex flex-col",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Type a correction or replace the last dart. The preview updates live."}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Last auto:"}),e.jsx("span",{children:_||"—"}),e.jsx("button",{className:"btn",onClick:wt,disabled:ye>=3,children:"Add Auto Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Manual (T20, D16, 5, 25, 50)",value:H,onChange:U=>ae(U.target.value),onKeyDown:U=>{U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),vt()),U.key==="Enter"&&U.shiftKey&&(U.preventDefault(),Ft())}}),e.jsx("button",{className:"btn btn--ghost",onClick:Ft,disabled:ye===0,children:"Replace Last"}),e.jsx("button",{className:"btn",onClick:vt,disabled:ye>=3,children:"Add"})]}),e.jsx("div",{className:"text-xs opacity-70 mb-4",children:"Press Enter to Add · Shift+Enter to Replace Last"}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Quick entry"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("button",{className:"btn",disabled:ye>=3,onClick:()=>{if(!re||!_||se==="MISS"||P===0){const U=de+1;Ee(U),U>=3&&Ue(!0)}else Ee(0);pt(25,"BULL 25","BULL"),ue(!1)},children:"25"}),e.jsx("button",{className:"btn",disabled:ye>=3,onClick:()=>{if(!re||!_||se==="MISS"||P===0){const U=de+1;Ee(U),U>=3&&Ue(!0)}else Ee(0);pt(50,"INNER_BULL 50","INNER_BULL"),ue(!1)},children:"50"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{className:"input w-full max-w-sm",list:"manual-quick-list",placeholder:"Type or select (e.g., D16, T20, S5)",value:ke,onChange:U=>ce(U.target.value.toUpperCase()),onKeyDown:U=>{if(U.key==="Enter"){const V=ke.match(/^(S|D|T)(\d{1,2})$/);V&&xe(parseInt(V[2],10),V[1])}}}),e.jsx("datalist",{id:"manual-quick-list",children:["D","S","T"].map(U=>Array.from({length:20},(V,ne)=>ne+1).map(V=>e.jsx("option",{value:`${U}${V}`},`${U}${V}`)))}),e.jsx("button",{className:"btn",disabled:!ke||ye>=3,onClick:()=>{const U=ke.match(/^(S|D|T)(\d{1,2})$/);if(!U)return;const V=U[1],ne=parseInt(U[2],10);xe(ne,V)},children:"Add"})]})]})]})]})})]})}),ht&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center",children:e.jsxs("div",{className:"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>C(!1),children:"Close"}),e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:"Scoring"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Camera"}),e.jsxs(so,{storageKey:"ndn:camera:size:modal",className:"relative rounded-2xl overflow-hidden bg-black",defaultWidth:480,defaultHeight:360,minWidth:320,minHeight:240,maxWidth:1600,maxHeight:900,children:[e.jsx(At,{}),e.jsx("video",{ref:d,className:"w-full h-full object-cover",playsInline:!0,"webkit-playsinline":"true",muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:I,className:"absolute inset-0 w-full h-full",onClick:$e})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[N?e.jsx("button",{className:"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold",onClick:Ye,children:"Stop Camera"}):e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Ct,children:"Connect Camera"}),e.jsx("button",{className:"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold",onClick:Ut,disabled:!N,children:"Capture Still"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{try{window.dispatchEvent(new Event("ndn:camera-reset"))}catch{}},children:"Reset Camera Size"})]})]}),e.jsxs("div",{className:"bg-black/30 rounded-2xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:ge.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):ge.map((U,V)=>e.jsx("li",{children:U.label},V))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",ye,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",lt]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:nt,disabled:ye===0,children:"Undo Dart"}),e.jsx("button",{className:"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold",onClick:Tt,disabled:ye===0,children:"Commit Visit"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{Me(0),Ke(0),Re([])},disabled:ye===0,children:"Clear"})]})]})]})]})}),jt&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold",onClick:()=>{Ue(!1),Ee(0)},children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2 flex items-center gap-2 text-white",children:"Recalibration Recommended"}),e.jsx("div",{className:"mb-4 text-lg font-semibold text-indigo-200",children:"We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold",onClick:Qt,children:"Go to Calibrate"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:F,children:"Reset Calibration"}),e.jsx("button",{className:"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold",onClick:()=>{Ue(!1),Ee(0)},children:"Dismiss"})]})]})}),n?null:e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Pending Visit"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Up to 3 darts per visit."}),e.jsx("ul",{className:"text-sm mb-2 list-disc pl-5",children:ge.length===0?e.jsx("li",{className:"opacity-60",children:"No darts yet"}):ge.map((U,V)=>e.jsx("li",{children:U.label},V))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Darts: ",ye,"/3"]}),e.jsxs("div",{className:"font-semibold",children:["Total: ",lt]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:nt,disabled:ye===0,children:"Undo Dart"}),e.jsx("button",{className:"btn",onClick:Tt,disabled:ye===0,children:"Commit Visit"}),e.jsx("button",{className:"btn",onClick:()=>{Me(0),Ke(0),Re([])},disabled:ye===0,children:"Clear"})]})]})]})}function no(t,a,s,i){const n=(i-90)*Math.PI/180;return{x:t+s*Math.cos(n),y:a+s*Math.sin(n)}}function ao(t){return[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5].indexOf(t)*18+9}function Gd({width:t=320,height:a=320}){const s=_o(n=>n.samples),i=m.useRef(null);return m.useEffect(()=>{const n=i.current;if(!n)return;const r=n.getContext("2d");if(!r)return;n.width=t,n.height=a,r.clearRect(0,0,t,a);const l=t/2,o=a/2,d=Math.min(t,a)/(Ge.doubleOuter*2+20),c={bullInner:Ge.bullInner*d,bullOuter:Ge.bullOuter*d,trebleInner:Ge.trebleInner*d,trebleOuter:Ge.trebleOuter*d,doubleInner:Ge.doubleInner*d,doubleOuter:Ge.doubleOuter*d};r.strokeStyle="rgba(255,255,255,0.06)",r.lineWidth=1;const f=["doubleOuter","doubleInner","trebleOuter","trebleInner","bullOuter","bullInner"];for(const p of f)r.beginPath(),r.arc(l,o,c[p],0,Math.PI*2),r.stroke();const u=[];for(const p of s){let g=Math.random()*360,S=Math.random()*c.doubleOuter;typeof p.sector=="number"&&p.sector>=1&&p.sector<=20&&(g=ao(p.sector),p.ring==="DOUBLE"?S=(c.doubleInner+c.doubleOuter)/2:p.ring==="TRIPLE"?S=(c.trebleInner+c.trebleOuter)/2:p.ring==="INNER_BULL"?S=c.bullInner*.5:p.ring==="BULL"?S=c.bullOuter*.8:S=(c.trebleOuter+c.doubleInner)/2*(.6+Math.random()*.4));const M=no(l,o,S,g);u.push({x:M.x,y:M.y,w:1})}for(const p of u){const g=r.createRadialGradient(p.x,p.y,1,p.x,p.y,60);g.addColorStop(0,"rgba(255,0,0,0.9)"),g.addColorStop(.3,"rgba(255,100,0,0.5)"),g.addColorStop(1,"rgba(255,100,0,0)"),r.fillStyle=g,r.beginPath(),r.arc(p.x,p.y,60,0,Math.PI*2),r.fill()}r.fillStyle="rgba(255,255,255,0.85)",r.font="12px ui-sans-serif";const x={};for(const p of s)p.sector&&(x[p.sector]=(x[p.sector]||0)+1);for(const p of Object.keys(x)){const g=Number(p),S=ao(g),M=no(l,o,c.trebleOuter+18,S);r.fillText(String(x[g]),M.x-6,M.y+4)}},[s,t,a]),e.jsx("canvas",{ref:i,style:{width:"100%",height:"auto",borderRadius:8,background:"#081018"}})}const xs=[...Array.from({length:20},(t,a)=>({label:`D${a+1}`,score:(a+1)*2})),{label:"DBULL",score:50,isBull:!0}];function br(t,a){const s=xs[a];return!!s&&t===s.score}function Vs(t){const a=t.trim().toUpperCase();if(!a)return null;if(a==="50"||a==="BULL"||a==="DBULL"||a==="IBULL")return 50;if(a==="25"||a==="OBULL")return 25;const s=a.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!s)return null;const i=s[1]||"S",n=parseInt(s[2],10);return n<1||n>20?null:n*(i==="S"?1:i==="D"?2:3)}const Bt=[...Array.from({length:20},(t,a)=>a+1),25,50],zn=[20,19,18,17,16,15,25];function rn(){const t={};return zn.forEach(a=>{t[a]=0}),{marks:t,points:0}}function Ho(t,a,s,i,n=()=>!1){let r=null,l=0;if(s==="BULL"||s==="INNER_BULL"||a===25||a===50)r=25,l=s==="INNER_BULL"||a===50?2:1;else if(typeof i=="number"&&i>=15&&i<=20)r=i,s==="TRIPLE"?l=3:s==="DOUBLE"?l=2:l=1;else if(a){const p=[20,19,18,17,16,15];for(const g of p){if(a===g){r=g,l=1;break}if(a===g*2){r=g,l=2;break}if(a===g*3){r=g,l=3;break}}!r&&(a===25||a===50)&&(r=25,l=a===50?2:1)}if(!r)return 0;const o=t.marks[r];let d=Math.max(0,3-o);const c=Math.min(d,l),f=Math.max(0,l-c),u=o+c;t.marks[r]=u>3?3:u;let x=0;return f>0&&!n(r)&&(r===25?s==="INNER_BULL"?x+=50*f:x+=25*f:x+=r*f),t.points+=x,x}function Jd(t){return zn.every(a=>(t.marks[a]||0)>=3)}function Gs(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function Kd(t){return t.round}function Wo(t,a,s,i){if(t.finished)return 0;const n=Kd(t);let r=0;return typeof i=="number"&&i===n?s==="TRIPLE"?(r=n*3,t.turnHits.triples++):s==="DOUBLE"?(r=n*2,t.turnHits.doubles++):s==="SINGLE"&&(r=n*1,t.turnHits.singles++):!i&&(a===n||a===n*2||a===n*3)&&(a===n*3?(r=n*3,t.turnHits.triples++):a===n*2?(r=n*2,t.turnHits.doubles++):a===n&&(r=n,t.turnHits.singles++)),t.score+=r,r}function zo(t){if(!t.finished){if(t.turnHits.singles>0&&t.turnHits.doubles>0&&t.turnHits.triples>0){t.shanghaiAchieved=!0,t.finished=!0;return}const a=t.round+1;a>20?t.finished=!0:t.round=a}t.turnHits={singles:0,doubles:0,triples:0}}function Js(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function ca(t){return t.targets[t.stage]||null}function qo(t,a,s,i){if(t.finished)return 0;const n=ca(t);if(!n)return 0;let r=0;switch(n.kind){case"NUMBER":{typeof i=="number"&&i===n.num?s==="TRIPLE"?r=n.num*3:s==="DOUBLE"?r=n.num*2:s==="SINGLE"&&(r=n.num):!i&&(a===n.num||a===n.num*2||a===n.num*3)&&(r=a),r>0&&(t.hitThisRound=!0);break}case"DOUBLE":{(s==="DOUBLE"&&i===n.num||a===n.num*2)&&(r=n.num*2,t.hitThisRound=!0);break}case"TRIPLE":{(s==="TRIPLE"&&i===n.num||a===n.num*3)&&(r=n.num*3,t.hitThisRound=!0);break}case"BULL":{(s==="BULL"||s==="INNER_BULL"||a===25||a===50)&&(r=s==="INNER_BULL"||a===50?50:25,t.hitThisRound=!0);break}case"ANY_NUMBER":{a>0&&(r=a,t.hitThisRound=!0);break}}return t.score+=r,r}function Vo(t){t.finished||(t.hitThisRound||(t.score=Math.floor(t.score/2)),t.hitThisRound=!1,t.stage+=1,t.stage>=t.targets.length&&(t.finished=!0))}function Ks(){return{round:1,score:0,target:"HIGH",finished:!1}}function Go(t,a,s,i){if(t.finished)return 0;let n=0;if(t.target==="HIGH")if(s==="INNER_BULL")n=50;else if(typeof i=="number"){const l=i*(s==="TRIPLE"?3:s==="DOUBLE"?2:1);i>=20&&(n=l)}else a>=40&&(n=a);else if(typeof i=="number"){const l=i*(s==="TRIPLE"?3:s==="DOUBLE"?2:1);i<=10&&(n=l)}else a>0&&a<=30&&(n=a);return t.score+=n,n}function Jo(t){if(!t.finished){if(t.round+=1,t.round>10){t.finished=!0;return}t.target=t.target==="HIGH"?"LOW":"HIGH"}}function Ko(t,a=3){return{number:t,lives:a,isKiller:!1,eliminated:!1}}function Yd(t){const a=Array.from({length:20},(i,n)=>n+1),s={};for(const i of t){const n=Math.floor(Math.random()*a.length),r=a.splice(n,1)[0];s[i]=r}return s}function gr(t,a,s,i){const n=a[t];if(!n||!i||!s)return{becameKiller:!1};if(!n.isKiller&&s==="DOUBLE"&&i===n.number)return n.isKiller=!0,{becameKiller:!0};if(n.isKiller&&(s==="DOUBLE"||s==="TRIPLE")){const r=Object.keys(a).find(l=>l!==t&&!a[l].eliminated&&a[l].number===i);if(r){const l=a[r],o=s==="TRIPLE"?2:1;return l.lives=Math.max(0,l.lives-o),l.lives===0&&(l.eliminated=!0),{becameKiller:!1,victimId:r,livesRemoved:o}}}return{becameKiller:!1}}function yr(t){const a=Object.entries(t).filter(([,s])=>!s.eliminated&&s.lives>0);return a.length===1?a[0][0]:null}function Un(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function Yo(t,a,s,i){if(t.finished)return 0;let n=0;if(typeof i=="number"&&i===t.inning?s==="TRIPLE"?n=3:s==="DOUBLE"?n=2:n=1:!i&&(a===t.inning||a===t.inning*2||a===t.inning*3)&&(n=a===t.inning*3?3:a===t.inning*2?2:1),t.score+=n,t.dartsThisInning+=1,t.dartsThisInning>=3){const r=t.inning+1;r>9?t.finished=!0:(t.inning=r,t.dartsThisInning=0)}return n}const Xo={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function $n(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function Qo(t,a,s,i){if(t.finished)return!1;const n=Xo[t.hole];if(t.dartsThisHole+=1,typeof i=="number"&&i===n&&(s==="SINGLE"||s==="DOUBLE"||s==="TRIPLE")||!i&&(a===n||a===n*2||a===n*3)){t.strokes+=t.dartsThisHole;const l=t.hole+1;return l>18?t.finished=!0:(t.hole=l,t.dartsThisHole=0),!0}if(t.dartsThisHole>=3){t.strokes+=3;const l=t.hole+1;l>18?t.finished=!0:(t.hole=l,t.dartsThisHole=0)}return!1}const Fn={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function vr(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function Xd(t){const a=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[s,i,n]of a)if(t[s]&&t[s]===t[i]&&t[s]===t[n])return t[s];return t.every(s=>s)?"Draw":null}function Zo(t,a,s,i,n){if(t.finished||t.board[a])return!1;const r=Fn[a];let l=!1;if(r.type==="BULL"?l=i==="BULL"||i==="INNER_BULL"||s===25||s===50:r.type==="NUM"&&typeof r.num=="number"&&(typeof n=="number"&&n===r.num||!n&&(s===r.num||s===r.num*2||s===r.num*3))&&(l=!0),!l)return!1;t.board[a]=t.turn;const o=Xd(t.board);return o?(t.finished=!0,t.winner=o,!0):(t.turn=t.turn==="X"?"O":"X",!0)}const ha=[20,19,18,17,16,15,14,13,12,25];function _n(){const t={};return ha.forEach(a=>{t[a]=0}),{marks:t,points:0}}function el(t,a,s,i,n=()=>!1){let r=null,l=0;if(s==="BULL"||s==="INNER_BULL"||a===25||a===50)r=25,l=s==="INNER_BULL"||a===50?2:1;else if(typeof i=="number"&&i>=12&&i<=20)r=i,s==="TRIPLE"?l=3:s==="DOUBLE"?l=2:l=1;else if(a){for(const p of[20,19,18,17,16,15,14,13,12]){if(a===p){r=p,l=1;break}if(a===p*2){r=p,l=2;break}if(a===p*3){r=p,l=3;break}}!r&&(a===25||a===50)&&(r=25,l=a===50?2:1)}if(!r)return 0;const o=t.marks[r],d=Math.max(0,3-o),c=Math.min(d,l),f=Math.max(0,l-c),u=o+c;t.marks[r]=u>3?3:u;let x=0;return f>0&&!n(r)&&(r===25?s==="INNER_BULL"?x+=50*f:x+=25*f:x+=r*f),t.points+=x,x}function Qd(t){return ha.every(a=>(t.marks[a]||0)>=3)}const ro=["X01","Double Practice"],Zd=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice"],em=["Easy","Medium","Hardened"];function Hn(t,a,s){return Math.max(a,Math.min(s,t))}function tm(t,a){let s=0;if(a==="Easy"){const i=[22,26,41,45,60];s=i[Math.floor(Math.random()*i.length)]}else a==="Medium"?s=Math.round(Hn(60+(Math.random()*30-15),30,100)):s=Math.round(Hn(80+(Math.random()*20-10),50,120));return t<=0?0:s>t?[100,85,81,60,57,45,41,26,22,20,1].find(n=>n<=t)??0:s}function sm({onClose:t}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 btn px-2 py-1",onClick:t,children:"Close"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"X01 Rules & Regulations"}),e.jsxs("ul",{className:"list-disc pl-5 text-left mb-2",children:[e.jsx("li",{children:"Double In: Start scoring only after hitting a double."}),e.jsx("li",{children:"Double Out: Finish the game by hitting a double to reach exactly zero."}),e.jsx("li",{children:"Best Of: Play a set number of legs, winner is first to reach majority."}),e.jsx("li",{children:"First To: Play until a player reaches a set number of legs."}),e.jsx("li",{children:"No Cheating: All scores must be valid, no manual score changes mid-leg."}),e.jsx("li",{children:"Competitive Standard: Follow latest WDF/PDC rules for match play."})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"For full details, see official darts governing body rules."})]})})}const nm="http://localhost:8787";function am({user:t}){const{offlineLayout:a}=ls(),[s,i]=m.useState("X01"),[n,r]=m.useState(501),[l,o]=m.useState("None"),[d,c]=m.useState(!1),[f,u]=m.useState(!1),[x,p]=m.useState(n),[g,S]=m.useState(n),[M,I]=m.useState(!1),[N,E]=m.useState(!1),[A,D]=m.useState(1),[k,b]=m.useState(0),[y,$]=m.useState(0),[Y,O]=m.useState(null),[_,T]=m.useState(1),[H,ae]=m.useState(1),[P,Z]=m.useState([]),[se,ze]=m.useState(2e3),ye=wn(),[Me,lt]=m.useState(!1),[Ke,ge]=m.useState(a==="modern"),[Re,ct]=m.useState(a==="modern");m.useEffect(()=>{ge(a==="modern"),ct(a==="modern")},[a]);const[Je,Ne]=m.useState(1),[le,Be]=m.useState(!0),[we,ke]=m.useState(0),[ce,de]=m.useState(0),[Ee,jt]=m.useState(0),[Ue,re]=m.useState(0),[ue,fe]=m.useState(0),[me,qe]=m.useState(rn()),[Le,et]=m.useState(Gs()),[yt,ht]=m.useState(Js()),[C,ee]=m.useState(Ks()),[Ct,Ye]=m.useState(0),[Ut,At]=m.useState(1),[Et,$e]=m.useState(27),[Vt,Nt]=m.useState(0),[pt,wt]=m.useState(0),[vt,Ft]=m.useState(!1),[Qt,F]=m.useState(1),[xe,nt]=m.useState(0),[Tt,U]=m.useState(0),V=8,[ne,je]=m.useState(1),[Ie,at]=m.useState(0),[Te,pe]=m.useState(0),mt=10,[_t,Fe]=m.useState(1),[Us,As]=m.useState(0),[$s,Qs]=m.useState(0),Es=10,[Zs,Gt]=m.useState(170),[B,J]=m.useState(0),[X,z]=m.useState(0),[G,Ae]=m.useState(0),[he,_e]=m.useState(121),[He,dt]=m.useState(0),[Oe,It]=m.useState(0),[Pt,Lt]=m.useState(0),[cs,Ht]=m.useState(20),[bs,Ot]=m.useState(0),[gs,ot]=m.useState(0),[Zt,Se]=m.useState(Un()),[ss,Fs]=m.useState($n()),[ys,Jt]=m.useState(vr()),[Rt,qt]=m.useState(_n()),[ft,vs]=m.useState([{id:"p1",name:"Player 1"},{id:"p2",name:"Player 2"}]),[ds,Kt]=m.useState({}),[Ts,Dt]=m.useState({}),[dn,Is]=m.useState(!1),[es,is]=m.useState(0),[js,ms]=m.useState(0),[Pe,tt]=m.useState(null),[rt,be]=m.useState(""),[bt,gt]=m.useState(0),[ut,Mt]=m.useState(0),[Yt,us]=m.useState(0),[Ps,mn]=m.useState(n),[it,Rs]=m.useState(0),[en,Ns]=m.useState(0),[_s,Hs]=m.useState(0);m.useRef(null);const[ws,un]=m.useState(0),[tn,Sn]=m.useState(0),[ns,hs]=m.useState(0),[Ls,Ss]=m.useState(0),[Os,kn]=m.useState(0),[hn,Cn]=m.useState(0),[sn,En]=m.useState(0),[Ws,qn]=m.useState(0),[fn,Tn]=m.useState(0),[h,j]=m.useState(0),[w,R]=m.useState(0),[Q,ie]=m.useState(0),[oe,W]=m.useState(0),[Qe,Wt]=m.useState(0),[as,rs]=m.useState(0),[We,In]=m.useState(0),[Ir,Dn]=m.useState(0),[ks,Mn]=m.useState(0),[ol,Dr]=m.useState(0),[ll,Mr]=m.useState(0),[cl,xa]=m.useState(!1),[ts,Xt]=m.useState(""),[Ar,pa]=m.useState(""),{favoriteDouble:Pr,callerEnabled:dl,callerVoice:ml,callerVolume:ul,speakCheckoutOnly:hl,rememberLastOffline:fl,setLastOffline:xl,autoStartOffline:Rr,cameraScale:xn,setCameraScale:Vn,cameraAspect:Lr="wide",setCameraAspect:pl,cameraEnabled:zt,textSize:An,boxSize:Gn,autoscoreProvider:bl}=ls(),gl=bl==="manual",Jn=(v=>{switch(v){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(An),pn=m.useRef(null),bn=m.useRef(null),ba=m.useRef(null),[gn,ga]=m.useState("first"),[Kn,Or]=m.useState(1),yl=m.useRef(null);m.useEffect(()=>{const v=Math.max(1,Math.floor(Number(Kn)||1)),L=gn==="first"?v:Math.max(1,Math.ceil(v/2));D(L)},[gn,Kn]),m.useEffect(()=>{if(!Re){Ne(1);return}const v=()=>{const K=pn.current,te=bn.current;if(!K||!te)return;const Ve=ba.current?ba.current.getBoundingClientRect().height:0,Xe=Math.max(0,K.clientHeight-Ve-6),Ce=Math.max(0,K.clientWidth-8),ve=te.getBoundingClientRect(),De=Je||1,st=ve.height/De,$t=ve.width/De,fs=Xe>0?Xe/st:1,nn=Ce>0?Ce/$t:1,Cs=Math.min(1,Math.max(.5,Math.min(fs,nn)));Ne(Cs)};v();const L=window.ResizeObserver,q=L?new L(()=>v()):null;return q&&pn.current&&q.observe(pn.current),q&&bn.current&&q.observe(bn.current),window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v);try{q&&pn.current&&q.unobserve(pn.current)}catch{}try{q&&bn.current&&q.unobserve(bn.current)}catch{}}},[Re,Je]),m.useEffect(()=>{const v=L=>{const q=L?.detail?.mode;q&&(i(q),yn())};return window.addEventListener("ndn:auto-start",v),()=>window.removeEventListener("ndn:auto-start",v)},[]),m.useEffect(()=>{const v=L=>{const q=L?.detail?.formatType,K=L?.detail?.formatCount,te=L?.detail?.startScore;(q==="first"||q==="best")&&ga(q),typeof K=="number"&&isFinite(K)&&Or(Math.max(1,Math.floor(K))),typeof te=="number"&&isFinite(te)&&r(Math.max(1,Math.floor(te)))};return window.addEventListener("ndn:offline-format",v),()=>window.removeEventListener("ndn:offline-format",v)},[]),m.useEffect(()=>{if(!Rr)return;const v=setTimeout(()=>yn(),50);return()=>clearTimeout(v)},[Rr]),m.useEffect(()=>{if(!Me||le||l==="None"||_s<=0)return;let v,L=performance.now();const q=K=>{const te=K-L;L=K,Hs(Ve=>{const Xe=Ve-te;if(Xe<=0){let Ce=0,ve=g;for(;Ce<3&&ve>0;){const De=tm(ve,l),st=Hn(De-Ce*20,0,Math.min(60,ve)),$t=ve-st;if(Sn(st),un(Cs=>Cs+1),j(Cs=>Cs+1),$t<0){ve=g,hs(0),Ss(0);break}hs(Cs=>Cs+st),ie(Cs=>Cs+st);const fs=ve,nn=$t;if(fs>50&&nn<=50?Ss(1):fs<=50&&Ss(Cs=>Cs+1),ve=$t,Ce+=1,ve===0)break}if(S(ve),ve===0){ns===180?In(st=>st+1):ns>=140?Dn(st=>st+1):ns>=100&&Mn(st=>st+1);const De=g;De<=170&&Mr(st=>Math.max(st,De)),g<=50&&(En(st=>st+(Ls>0?Ls:1)),qn(st=>st+1)),hs(0),Ss(0),O("ai"),E(!0)}return ve>0&&Ce>=3&&(ns===180?In(De=>De+1):ns>=140?Dn(De=>De+1):ns>=100&&Mn(De=>De+1),hs(0),Ss(0)),Be(!0),0}return Xe}),_s>0&&(v=requestAnimationFrame(q))};return v=requestAnimationFrame(q),()=>cancelAnimationFrame(v)},[Me,le,l,_s,g]);function yn(){u(!0),p(n),S(n),I(!1),lt(!0),Be(!0),ke(0),gt(0),Mt(0),us(0),mn(n),Rs(0),Ns(0),Hs(0),un(0),Sn(0),hs(0),O(null),b(0),$(0),Z([]),Tn(0),j(0),R(0),ie(0),W(0),Wt(0),rs(0),In(0),Dn(0),Mn(0),Dr(0),Mr(0),kn(0),Cn(0),En(0),qn(0);const v=Math.max(1,Math.floor(Number(Kn)||1));if(D(gn==="first"?v:Math.max(1,Math.ceil(v/2))),fl)try{xl({mode:s,x01Start:n,firstTo:A,aiLevel:l})}catch{}}function vl(){p(n),S(n),I(!1),lt(!0),Be(!0),ke(0),gt(0),Mt(0),us(0),mn(n),Rs(0),Ns(0),Hs(0),un(0),Sn(0),hs(0),O(null)}function Br(v){us(0),mn(v===0?n:x),Ns(0),l!=="None"?(Be(!1),Hs(se)):Be(!1)}function Yn(v){const L=x-v,q=Yt+1;if(Mt(v),gt(Ce=>Ce+1),Tn(Ce=>Ce+1),L<0){p(Ps),Br(Ps),ke(0),Rs(0),Ns(0);return}p(L),dl&&ra(t?.username||"Player",v,Math.max(L,0),ml,{volume:ul,checkoutOnly:hl}),us(q),Rs(Ce=>Ce+v),R(Ce=>Ce+v),ke(0);const K=x,te=L,Ve=K>50&&te<=50,Xe=K<=50;if(Ve?Ns(1):Xe&&Ns(Ce=>Ce+1),L===0){it+v===180?W(ve=>ve+1):it+v>=140?Wt(ve=>ve+1):it+v>=100&&rs(ve=>ve+1);const Ce=Ps;Ce<=170&&Dr(ve=>Math.max(ve,Ce)),K<=50&&(kn(ve=>ve+(en>0?en:1)),Cn(ve=>ve+1)),O("player"),E(!0);return}q>=3&&(it+v===180?W(Ce=>Ce+1):it+v>=140?Wt(Ce=>Ce+1):it+v>=100&&rs(Ce=>Ce+1),Br(L),Rs(0),Ns(0))}function Ur(){const v=Hn(Math.round(Number(we)||0),0,60);Yn(v)}function $r(v){const L=Hn(Math.round(v||0),0,60);if(Mt(L),gt(q=>q+1),Tn(q=>q+1),br(L,ce)){const q=Ee+1;jt(q),de(K=>Math.min(20,K+1)),q>=21&&(O("player"),E(!0))}ke(0)}function Fr(){$r(Number(we))}function _r(){const v=Vs(ts);if(v==null){alert("Enter like D16, 50, 25, T20");return}$r(v),Xt("")}function Hr(v,L,q){if(vt)return;const K=Ut,te=L==="DOUBLE"&&q===K||!L&&v===K*2;te&&wt(Ve=>Ve+1),Nt(Ve=>{const Xe=Ve+1;if(Xe>=3){const Ce=pt+(te?1:0);Ce>0?$e(De=>De+Ce*K*2):$e(De=>De-K*2);const ve=K+1;return At(ve),wt(0),ve>20&&Ft(!0),0}return Xe})}function Wr(){Hr(Math.max(0,we|0)),ke(0)}function zr(){At(1),$e(27),Nt(0),wt(0),Ft(!1)}function ya(v){nt(L=>L+Math.max(0,v|0)),U(L=>{const q=L+1;return q>=3?(F(K=>K+1),0):q})}function va(v){at(L=>L+Math.max(0,v|0)),pe(L=>{const q=L+1;return q>=3?(je(K=>K+1),0):q})}function ja(v){As(L=>L+Math.max(0,v|0)),Qs(L=>{const q=L+1;return q>=3?(Fe(K=>K+1),0):q})}function qr(v,L,q,K,te,Ve,Xe,Ce){const ve=v-Xe;if(!(ve<0))if(ve===0){if(Ce==="DOUBLE"||Ce==="INNER_BULL"){Ve(De=>De+1),te(De=>De+1),K(()=>0),L(v);return}}else L(ve);K(De=>{const st=De+1;return st>=3?(te($t=>$t+1),0):st})}function Vr(v,L){qr(Zs,Gt,B,J,z,Ae,v,L),B+1>=3&&Gt(170)}function Gr(v,L){qr(he,_e,He,dt,It,Lt,v,L),He+1>=3&&_e(121)}function Xn(v){const L=Vs(ts);if(L==null){alert("Enter like T20, D16, 25, 50");return}const q=ts.trim().toUpperCase(),K=q.startsWith("D")||q==="50"||q==="BULL"||q==="DBULL"||q==="IBULL"||q.includes("INNER");v?Vr(L,K?"DOUBLE":void 0):Gr(L,K?"DOUBLE":void 0),Xt("")}function jl(){Gt(170),J(0),z(0),Ae(0)}function Nl(){_e(121),dt(0),It(0),Lt(0)}function Na(v,L,q){L==="TRIPLE"&&q===cs?Ot(K=>K+1):!L&&v===cs*3&&Ot(K=>K+1),ot(K=>K+1)}function wl(){Ot(0),ot(0)}function Sl(v,L,q){Se(K=>{const te={...K};return Yo(te,v,L,q),te})}function kl(){Se(Un())}function Cl(v,L,q){Fs(K=>{const te={...K};return Qo(te,v,L,q),te})}function El(){Fs($n())}function Tl(v,L,q,K){Jt(te=>{const Ve={...te,board:[...te.board]};return Zo(Ve,v,L,q,K),Ve})}function Il(){Jt(vr())}function Dl(v,L,q){qt(K=>{const te={...K,marks:{...K.marks}};return el(te,v,L,q,()=>!1),te})}function Jr(){qt(_n())}function wa(v,L,q){const K=Bt[Ue];let te=!1;if(typeof q=="number"&&q===K&&(L==="SINGLE"||L==="DOUBLE"||L==="TRIPLE")&&(te=!0),K===25&&(L==="BULL"||v===25)&&(te=!0),K===50&&(L==="INNER_BULL"||v===50)&&(te=!0),te||(v===K||v===K*2||v===K*3)&&(te=!0),te){const Ve=ue+1;fe(Ve),re(Xe=>Xe+1)}}function Kr(){wa(Math.max(0,we|0)),ke(0)}function Yr(){const v=Vs(ts);if(v==null){alert("Enter like T20, D5, 25, 50");return}wa(v),Xt("")}function Xr(v,L,q){qe(K=>{const te={...K,marks:{...K.marks}};return Ho(te,v,L,q,()=>!1),te}),Ye(K=>{const te=K+1;return te>=3?0:te})}function Qr(){Xr(Math.max(0,we|0)),ke(0)}function Zr(v,L,q){et(K=>{const te={...K,turnHits:{...K.turnHits}};return Wo(te,v,L,q),te}),Ye(K=>{const te=K+1;return te>=3?(et(Ve=>{const Xe={...Ve,turnHits:{...Ve.turnHits}};return zo(Xe),Xe}),0):te})}function ei(){Zr(Math.max(0,we|0)),ke(0)}function ti(v,L,q){ht(K=>{const te={...K,targets:[...K.targets]};return qo(te,v,L,q),te}),Ye(K=>{const te=K+1;return te>=3?(ht(Ve=>{const Xe={...Ve,targets:[...Ve.targets]};return Vo(Xe),Xe}),0):te})}function si(){ti(Math.max(0,we|0)),ke(0)}function ni(v,L,q){ee(K=>{const te={...K};return Go(te,v,L,q),te}),Ye(K=>{const te=K+1;return te>=3?(ee(Ve=>{const Xe={...Ve};return Jo(Xe),Xe}),0):te})}function ai(){ni(Math.max(0,we|0)),ke(0)}function ri(){const v=ts.trim().toUpperCase();if(!v)return null;if(v==="50"||v==="BULL"||v==="DBULL"||v==="IBULL")return 50;if(v==="25"||v==="OBULL")return 25;const L=v.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!L)return null;const q=L[1]||"S",K=parseInt(L[2],10);return K<1||K>20?null:K*(q==="S"?1:q==="D"?2:3)}function Sa(){const v=ri();if(v==null){alert("Enter like T20, D16, 5, 25, 50");return}Yn(v),Xt("")}function Ml(){const v=Ar.trim().split(`
`).map(L=>L.trim()).filter(L=>L);if(v.length!==0){for(const L of v){const q=Vs(L);if(q==null){alert(`Invalid score: ${L}`);return}Yn(q)}pa("")}}function Al(){Yt!==0&&(p(v=>v+ut),us(v=>Math.max(0,v-1)))}function ii(){const v=ri();if(v==null){alert("Enter like T20, D16, 5, 25, 50");return}if(Yt===0){Sa();return}const L=ut;p(q=>q+L),us(q=>Math.max(0,q-1)),setTimeout(()=>Yn(v),0),Xt("")}function Pl(){const v=Y??"player",L=v==="player"?en||void 0:Ls||void 0;Z([...P,{winner:v,doubleDarts:_,checkoutDarts:H,doublesAtt:L,doublesHit:1}]),E(!1);let K=k,te=y;if(Y==="player"?K+=1:Y==="ai"&&(te+=1),b(K),$(te),O(null),K>=A||te>=A){try{kc(s,v==="player")}catch{}lt(!1),u(!1),p(n),S(n),xa(!0);return}vl()}const ka=!ro.includes(s)&&!(t?.fullAccess||t?.admin);return e.jsxs("div",{className:"card relative overflow-hidden",children:[e.jsxs("h2",{className:"text-2xl font-bold text-brand-700 mb-4",children:["Offline Game Modes ",a==="classic"?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle",children:"Classic layout"}):e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle",children:"Modern layout"})]}),e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsx("label",{className:"font-semibold",children:"Select game mode:"}),e.jsxs("select",{className:"input w-full",value:s,onChange:v=>i(v.target.value),children:[ro.map(v=>e.jsx("option",{value:v,children:v},v)),Zd.map(v=>e.jsxs("option",{value:v,disabled:!(t?.fullAccess||t?.admin),children:[v," ",t?.fullAccess||t?.admin?"":"(Premium)"]},v))]}),!t?.fullAccess&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2",children:[e.jsx("span",{children:"🔒"}),e.jsx("span",{children:"Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM."})]}),s==="X01"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"font-semibold mt-2",children:"Enter starting score (1-1001):"}),e.jsx("input",{className:"input w-full",type:"number",min:1,max:1001,value:n,onChange:v=>r(Number(v.target.value))}),e.jsx("label",{className:"font-semibold mt-2",children:"Play against AI bot?"}),e.jsxs("select",{className:"input w-full",value:l,onChange:v=>o(v.target.value),children:[e.jsx("option",{value:"None",children:"None"}),em.map(v=>e.jsx("option",{value:v,children:v},v))]}),l!=="None"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"font-semibold",children:"AI throw delay (seconds)"}),e.jsx("input",{className:"input w-full",type:"number",min:.5,max:10,step:.5,value:se/1e3,onChange:v=>ze(Math.round(Number(v.target.value)*1e3))})]}),e.jsx("div",{className:"text-sm text-slate-300",children:"Controls how long the AI waits before its visit."})]}),e.jsx("button",{className:"btn mt-2",onClick:()=>c(!0),children:"X01 Rules & Regulations!"})]}),s==="Double Practice"&&e.jsx("div",{className:"mt-2 text-brand-600",children:"Hit doubles D1 → D20 → DBULL in as few darts as possible. AI and X01 settings don’t apply."})]}),!f&&e.jsx("button",{className:"btn",disabled:ka,title:ka?"PREMIUM required for this mode":"",onClick:yn,children:"Start Match"}),Me&&e.jsx("div",{className:`absolute inset-0 z-[1000] ${Ke?"":"flex items-center justify-center p-3 sm:p-4"}`,children:e.jsx(Xs,{storageKey:"ndn:modal:offline-match",className:`${Ke?"w-full h-full ndn-modal-tight":""} relative flex flex-col overflow-hidden`,fullScreen:Ke,defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsxs("div",{className:"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2",style:{overflowY:Re?"hidden":"auto"},ref:v=>{pn.current=v},children:[e.jsxs("div",{ref:v=>{ba.current=v},className:"sticky top-0 relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:[e.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),e.jsxs("span",{className:"font-medium whitespace-nowrap",children:[s,s==="X01"?` / ${n}`:""]}),e.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["First to ",A," · Legs ",k,"-",y]}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${a==="modern"?"bg-emerald-500/15 text-emerald-200 border-emerald-400/30":"bg-white/10 text-white/70 border-white/20"}`,children:a==="modern"?"Modern layout":"Classic layout"})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:[e.jsxs("div",{className:"hidden items-center gap-2 mr-2 text-xs",children:[e.jsx("span",{className:"opacity-80",children:"Cam"}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>Vn(Math.max(.5,Math.round((xn-.05)*100)/100)),title:"Decrease camera size",children:"−"}),e.jsxs("span",{className:"w-9 text-center",children:[Math.round(xn*100),"%"]}),e.jsx("button",{className:"btn btn--ghost px-2 py-1",onClick:()=>Vn(Math.min(1.25,Math.round((xn+.05)*100)/100)),title:"Increase camera size",children:"+"})]}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:Re?"Actual Size":"Fit All",onClick:()=>ct(v=>!v),children:Re?"Actual Size":"Fit All"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:Ke?"Restore":"Maximize",onClick:()=>ge(v=>!v),children:Ke?"Restore":"Maximize"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{yn()},children:"Restart"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm",onClick:()=>{lt(!1),u(!1)},children:"Quit"})]})]}),e.jsxs("div",{ref:v=>{bn.current=v},className:"will-change-transform",style:Re?{transform:`scale(${Je})`,transformOrigin:"top left",width:"100%",fontSize:`${Math.max(.8,Math.min(1,Je))}em`}:void 0,children:[e.jsx("h3",{className:"text-xl font-bold mb-2 mt-1 leading-tight",children:s==="X01"?"X01 Match":s}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Mode: ",s]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Start: ",n]}),e.jsxs("div",{ref:yl,className:"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx("span",{children:"Format:"}),(()=>{const v=x!==n||g!==n||Yt>0,L=`px-2 py-0.5 rounded border text-xs ${v?"opacity-50 cursor-not-allowed":"cursor-pointer"} `;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:`${L} ${gn==="first"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{v||ga("first")},title:"First to N",children:"First to"}),e.jsx("button",{type:"button",className:`${L} ${gn==="best"?"bg-indigo-500/20 text-indigo-100 border-indigo-400/30":"bg-white/10 text-white/80 border-white/20"}`,onClick:()=>{v||ga("best")},title:"Best of N (wins = ceil(N/2)",children:"Best of"})]}),e.jsx("input",{className:`input w-16 text-center ${v?"opacity-50":""}`,type:"number",min:1,step:1,value:Kn,onChange:q=>Or(Math.max(1,Math.floor(Number(q.target.value)||1))),disabled:v,title:gn==="first"?"First to N":"Best of N (wins = ceil(N/2))"})]})})()]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:["Legs: ",k,"–",y]})]}),s!=="X01"?e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2",children:[s==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:xs[ce]?.label||"—"})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[Ee," / 21"]})]}),s==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"Current Target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:Bt[Ue]===25?"25 (Outer Bull)":Bt[Ue]===50?"50 (Inner Bull)":Bt[Ue]||"—"})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:[ue," / ",Bt.length]})]}),s==="Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Cricket — Close 20–15 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-[11px] mb-2",children:zn.map(v=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:v===25?"Bull":v}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,me.marks?.[v]||0)," / 3"]})]},v))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:me.points})]}),Jd(me)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{qe(rn()),Ye(0)},children:"Reset"})]})]}),s==="Shanghai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Le.round})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Le.score]}),Le.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{et(Gs()),Ye(0)},children:"Reset"})]})]}),s==="Halve It"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[yt.stage+1,"/",yt.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const v=ca(yt);return v?v.kind==="ANY_NUMBER"?"Any":v.kind==="BULL"?"Bull":v.kind==="DOUBLE"||v.kind==="TRIPLE"||v.kind==="NUMBER"?`${v.kind} ${v.num}`:"—":"—"})()})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",yt.score]}),yt.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ht(Js()),Ye(0)},children:"Reset"})]})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",C.round," · Target ",C.target]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",C.score]}),C.finished&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{ee(Ks()),Ye(0)},children:"Reset"})]})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Target"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold",children:["D",Ut]})]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Et]}),vt&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:zr,children:"Reset"})]})]}),s==="Count-Up"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",Qt,"/8"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",xe]})]}),s==="High Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",ne,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Ie]})]}),s==="Low Score"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Round ",_t,"/10"]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Score: ",Us]})]}),s==="Checkout 170"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Zs}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",X," · Successes: ",G]})]}),s==="Checkout 121"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Remaining"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:he}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Attempts: ",Oe," · Successes: ",Pt]})]}),s==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600",children:["Treble Target: T",cs]}),e.jsxs("div",{className:"text-3xl font-extrabold tracking-tight",children:["Hits: ",bs]})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Inning"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Zt.inning}),e.jsxs("div",{className:"text-sm",children:["Score: ",e.jsx("span",{className:"font-semibold",children:Zt.score})]})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Hole"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ss.hole}),e.jsxs("div",{className:"text-sm",children:["Strokes: ",e.jsx("span",{className:"font-semibold",children:ss.strokes})]})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Turn"}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:ys.turn}),ys.finished&&e.jsxs("div",{className:"mt-1 text-xs",children:["Winner: ",ys.winner||"—"]})]}),s==="American Cricket"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Close 20–12 and Bull; overflow scores points"}),e.jsx("div",{className:"grid grid-cols-10 gap-1 text-center text-[11px] mb-2",children:ha.map(v=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:v===25?"Bull":v}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,Rt.marks?.[v]||0)," / 3"]})]},v))}),e.jsxs("div",{className:"text-sm",children:["Points: ",e.jsx("span",{className:"font-semibold",children:Rt.points})]}),Qd(Rt)&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:Jr,children:"Reset"})]})]}),s==="Killer"&&e.jsx(e.Fragment,{children:dn?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{children:"Turn"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:ft[es]?.name||"—"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:Pe?`${ft.find(v=>v.id===Pe)?.name||"Winner"} Wins`:rt||"Ready"})]}):e.jsx("div",{className:"text-xs text-slate-600",children:"Setup players and assign numbers"})})]}):a==="modern"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-2 items-stretch",children:[e.jsxs("div",{className:"flex flex-col gap-2 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),le?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:x}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-x/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:ut})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:bt>0?((n-x)/bt*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",bt]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(v=>e.jsx("span",{className:`w-2 h-2 rounded-full ${v<Yt?"bg-emerald-400":"bg-white/20"}`},v))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",Os," · Hit ",hn]})]}),x<=170&&x>0&&(()=>{const L=oa(x,Pr)[0]||"—";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:L})]})})()]}),e.jsxs("div",{className:`${Gn==="small"?"p-2":Gn==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${An==="small"?"text-xs":An==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const v=le?t?.username||"You":l==="None"?"—":`${l} AI`,L=le?x:l==="None"?0:g,q=le?ut:tn,K=le?it:ns,te=le?bt:ws,Ve=n-(le?x:l==="None"?n:g),Xe=te>0?Ve/te*3:0,Ce=`${k}-${y}`,ve=P.length>0?`${Math.min(...P.map(De=>De.doubleDarts+(De.checkoutDarts||0)))||0} darts`:"—";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:Ce}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:v}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:L}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:Xe.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:K||q}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:ve})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[l==="None"?"Opponent":`${l} AI`," Remain"]}),le?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:l!=="None"?g:"N/A"}),l!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-g/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:l==="None"?0:tn})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:l!=="None"?ws>0?((n-g)/ws*3).toFixed(1):"0.0":"—"})]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",ws]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",sn," · Hit ",Ws]})]})]})]}),e.jsx("div",{className:"md:col-span-2 min-w-0 space-y-2",children:gl?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Manual scoring active"}),e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews are disabled. Use the manual entry controls below to record your turn."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-1.5 mt-1",children:e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[10px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${Jn}`,onClick:()=>Vn(Math.max(.5,Math.round((xn-.05)*100)/100)),children:"−"}),e.jsxs("span",{className:`btn ${Jn} min-w-[2.5rem] text-center`,children:[Math.round(xn*100),"%"]}),e.jsx("button",{className:`btn ${Jn}`,onClick:()=>Vn(Math.min(1.25,Math.round((xn+.05)*100)/100)),children:"+"}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("button",{className:`btn ${Jn}`,title:"Toggle camera aspect",onClick:()=>pl(Lr==="square"?"wide":"square"),children:Lr==="square"?"Square":"Wide"})]})}),e.jsx("div",{className:"flex items-stretch justify-end min-w-0 md:min-h-[45vh]",children:e.jsx(la,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",style:{minHeight:"45vh"},fill:!0})})]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:[grid-template-columns:1fr_1.2fr_1fr] gap-2 mb-2 items-stretch min-w-0",children:e.jsxs("div",{className:"flex items-stretch justify-center md:px-3 min-w-0",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80",children:"You Remain"}),le?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:x}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70",style:{width:`${Math.max(0,Math.min(100,(1-x/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:ut})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:bt>0?((n-x)/bt*3).toFixed(1):"0.0"})]}),e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-2",children:[e.jsxs("span",{children:["Darts thrown: ",bt]}),e.jsx("span",{className:"inline-flex items-center gap-1","aria-label":"Visit darts",children:[0,1,2].map(v=>e.jsx("span",{className:`w-2 h-2 rounded-full ${v<Yt?"bg-emerald-400":"bg-white/20"}`},v))})]}),e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",Os," · Hit ",hn]})]}),x<=170&&x>0&&(()=>{const L=oa(x,Pr)[0]||"—";return e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Checkout"}),e.jsx("span",{className:"font-semibold",children:L})]})})()]}),e.jsx("div",{className:"flex items-stretch justify-end md:px-3 min-w-0 md:min-h-[45vh]",children:e.jsx(la,{label:"Your Board",autoStart:!0,className:"min-w-0 h-full",style:{minHeight:"45vh"},fill:!0})}),e.jsxs("div",{className:`mt-2 ${Gn==="small"?"p-2":Gn==="large"?"p-4":"p-3"} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${An==="small"?"text-xs":An==="large"?"text-base":"text-sm"}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),(()=>{const v=le?t?.username||"You":l==="None"?"—":`${l} AI`,L=le?x:l==="None"?0:g,q=le?ut:tn,K=le?it:ns,te=le?bt:ws,Ve=n-(le?x:l==="None"?n:g),Xe=te>0?Ve/te*3:0,Ce=`${k}-${y}`,ve=P.length>0?`${Math.min(...P.map(De=>De.doubleDarts+(De.checkoutDarts||0)))||0} darts`:"—";return e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:Ce}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold text-lg",children:v}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-xl",children:L}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:Xe.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:K||q}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:ve})]})})()]}),e.jsxs("div",{className:"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs flex items-center justify-between opacity-80",children:[e.jsxs("span",{children:[l==="None"?"Opponent":`${l} AI`," Remain"]}),le?e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold",children:"WAITING TO THROW"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold",children:"THROWING"})]}),e.jsx("div",{className:"text-3xl font-extrabold tracking-tight",children:l!=="None"?g:"N/A"}),l!=="None"&&e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-400/70",style:{width:`${Math.max(0,Math.min(100,(1-g/n)*100))}%`}})}),e.jsxs("div",{className:"text-sm mt-1 opacity-90",children:["Last dart: ",e.jsx("span",{className:"font-semibold",children:l==="None"?0:tn})]}),e.jsxs("div",{className:"text-sm opacity-90",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:l!=="None"?ws>0?((n-g)/ws*3).toFixed(1):"0.0":"—"})]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-70",children:["Darts thrown: ",ws]}),l!=="None"&&e.jsxs("div",{className:"text-xs opacity-80 mt-1",children:["Doubles: ",e.jsxs("span",{className:"font-semibold",children:["Att ",sn," · Hit ",Ws]})]})]})]})}),s!=="X01"?e.jsxs("div",{className:"space-y-2",children:[s==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:xs[ce]?.label||"—"})]}),zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,onAutoDart:(v,L)=>{if((L==="DOUBLE"||L==="INNER_BULL")&&br(v,ce)){const K=Ee+1,te=ce+1;jt(K),de(te),K>=xs.length&&setTimeout(()=>{jt(0),de(0)},250)}},immediateAutoCommit:!0})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Fr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Fr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:ts,onChange:v=>Xt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&_r()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:_r,children:"Add"})]})]}),e.jsxs("div",{className:"text-xs text-slate-300",children:["Progress: ",Ee," of 21"]})]}),s==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["Target: ",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10",children:Bt[Ue]===25?"25 (Outer Bull)":Bt[Ue]===50?"50 (Inner Bull)":Bt[Ue]||"—"})]}),zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{wa(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Kr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Kr,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D5, 25, 50)",value:ts,onChange:v=>Xt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&Yr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Yr,children:"Add"})]}),ue>=Bt.length&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Completed! ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{fe(0),re(0)},children:"Reset"})]})]}),s==="Cricket"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{Xr(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Qr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Qr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{qe(rn()),Ye(0)},children:"Reset"})]})]}),s==="Shanghai"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{Zr(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&ei()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ei,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{et(Gs()),Ye(0)},children:"Reset"})]})]}),s==="Halve It"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{ti(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&si()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:si,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ht(Js()),Ye(0)},children:"Reset"})]})]}),s==="High-Low"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{ni(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&ai()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:ai,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{ee(Ks()),Ye(0)},children:"Reset"})]})]}),s==="Bob's 27"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{Hr(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&Wr()}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Wr,children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:zr,children:"Reset"})]})]}),s==="Count-Up"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:v=>ya(v)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&(ya(we),ke(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ya(we),ke(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{F(1),nt(0),U(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",Qt,"/",V]})]}),s==="High Score"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:v=>va(v)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&(va(we),ke(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{va(we),ke(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{je(1),at(0),pe(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",ne,"/",mt]})]}),s==="Low Score"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:v=>ja(v)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&(ja(we),ke(0))}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ja(we),ke(0)},children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Fe(1),As(0),Qs(0)},children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Round ",_t,"/",Es]})]}),s==="Checkout 170"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L)=>Vr(v,L==="MISS"?void 0:L)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:ts,onChange:v=>Xt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&Xn(!0)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Xn(!0),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:jl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",Zs," · Attempts: ",X," · Successes: ",G]})]}),s==="Checkout 121"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L)=>Gr(v,L==="MISS"?void 0:L)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (D16, T20)",value:ts,onChange:v=>Xt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&Xn(!1)}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Xn(!1),children:"Add Dart"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Nl,children:"Reset"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Remaining: ",he," · Attempts: ",Oe," · Successes: ",Pt]})]}),s==="Treble Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Target"}),e.jsx("select",{className:"input w-24",value:cs,onChange:v=>Ht(parseInt(v.target.value,10)),children:Array.from({length:20},(v,L)=>L+1).map(v=>e.jsx("option",{value:v,children:v},v))}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:wl,children:"Reset"})]}),zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{Na(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"text",placeholder:"Manual (T20)",value:ts,onChange:v=>Xt(v.target.value),onKeyDown:v=>{if(v.key==="Enter"){const L=Vs(ts);L!=null&&Na(L,void 0,void 0),Xt("")}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const v=Vs(ts);v!=null&&Na(v,void 0,void 0),Xt("")},children:"Add Dart"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Hits: ",bs," · Darts: ",gs]})]}),s==="Baseball"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{Sl(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:kl,children:"Reset"})})]}),s==="Golf"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{Cl(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:El,children:"Reset"})})]}),s==="Tic Tac Toe"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(v,L)=>L).map(v=>e.jsx("button",{className:`h-16 rounded-xl border ${ys.board[v]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(ys.finished||ys.board[v])return;const L=Number(prompt("Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)")||0),q=L%3===0?"TRIPLE":L%2===0?"DOUBLE":"SINGLE",K=v,te=Fn[K],Ve=te.type==="BULL"?null:te.num||null;Tl(K,L,q,Ve)},children:ys.board[v]||""},v))}),zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Il,children:"Reset"})})]}),s==="American Cricket"&&e.jsxs(e.Fragment,{children:[zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{Dl(v,L==="MISS"?void 0:L,q?.sector??null)}})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:Jr,children:"Reset"})})]}),s==="Killer"&&e.jsx(e.Fragment,{children:dn?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:ft.map(v=>{const L=ds[v.id],q=Ts[v.id];return e.jsxs("div",{className:`p-2 rounded-xl border ${L?.eliminated?"opacity-50 border-red-500/40 bg-red-500/10":"border-slate-700/50 bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("div",{className:"font-semibold",children:v.name}),e.jsx("div",{className:`text-[10px] px-1.5 py-0.5 rounded ${L?.isKiller?"bg-purple-500/20 text-purple-200 border border-purple-400/30":"bg-slate-600/30 text-slate-300"}`,children:L?.isKiller?"Killer":"Not Killer"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Number: ",e.jsx("span",{className:"font-semibold",children:q})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:L?.lives??0})]})]},v.id)})}),zt&&e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(v,L,q)=>{if(Pe)return;const K=L==="MISS"?void 0:L,te=q?.sector??null,Ve=ft[es];Ve&&(Kt(Xe=>{const Ce={};Object.keys(Xe).forEach(st=>Ce[st]={...Xe[st]});const ve=gr(Ve.id,Ce,K,te);if(ve.becameKiller)be(`${Ve.name} became a Killer`);else if(ve.victimId){const st=ft.find($t=>$t.id===ve.victimId);be(`${Ve.name} hit ${st?.name}'s ${Ts[ve.victimId]} (${ve.livesRemoved} life${(ve.livesRemoved||0)>1?"s":""})`)}else be("No effect");const De=yr(Ce);return De&&tt(De),Ce}),ms(Xe=>{const Ce=Xe+1;if(Ce>=3){let ve=es;for(let De=1;De<=ft.length;De++){const st=(es+De)%ft.length,$t=ft[st].id,fs=ds[$t];if(fs&&!fs.eliminated&&fs.lives>0){ve=st;break}}return is(ve),0}return Ce}))}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40",placeholder:"Manual (D16, T5)",value:ts,onChange:v=>Xt(v.target.value),onKeyDown:v=>{if(v.key==="Enter"){if(Pe)return;const q=ts.trim().toUpperCase().match(/^(S|D|T)?\s*(\d{1,2})$/);if(!q){Xt("");return}const K=q[1]||"S",te=parseInt(q[2],10),Ve=K==="D"?"DOUBLE":K==="T"?"TRIPLE":"SINGLE",Xe=ft[es];Kt(Ce=>{const ve={};Object.keys(Ce).forEach($t=>ve[$t]={...Ce[$t]});const De=gr(Xe.id,ve,Ve,te);if(De.becameKiller)be(`${Xe.name} became a Killer`);else if(De.victimId){const $t=ft.find(fs=>fs.id===De.victimId);be(`${Xe.name} hit ${$t?.name}'s ${Ts[De.victimId]} (${De.livesRemoved} life${(De.livesRemoved||0)>1?"s":""})`)}else be("No effect");const st=yr(ve);return st&&tt(st),ve}),Xt(""),ms(Ce=>{const ve=Ce+1;if(ve>=3){let De=es;for(let st=1;st<=ft.length;st++){const $t=(es+st)%ft.length,fs=ft[$t].id,nn=ds[fs];if(nn&&!nn.eliminated&&nn.lives>0){De=$t;break}}return is(De),0}return ve})}}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{let v=es;for(let L=1;L<=ft.length;L++){const q=(es+L)%ft.length,K=ft[q].id,te=ds[K];if(te&&!te.eliminated&&te.lives>0){v=q;break}}is(v),ms(0)},children:"Next Player"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>{Kt({}),Dt({}),Is(!1),is(0),ms(0),tt(null),be("")},children:"Reset"})]}),Pe&&e.jsxs("div",{className:"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block",children:["Winner: ",ft.find(v=>v.id===Pe)?.name," ",e.jsx("button",{className:"ml-2 underline",onClick:()=>{Kt({}),Dt({}),Is(!1),is(0),ms(0),tt(null),be("")},children:"Play Again"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("div",{className:"space-y-1",children:ft.map((v,L)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input",value:v.name,onChange:q=>{const K=q.target.value;vs(te=>te.map((Ve,Xe)=>Xe===L?{...Ve,name:K}:Ve))}}),e.jsx("button",{className:"btn px-2 py-1",onClick:()=>vs(q=>q.filter((K,te)=>te!==L)),disabled:ft.length<=2,children:"Remove"})]},v.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-2 py-1",onClick:()=>vs(v=>{const L=`p${v.length+1}`;return[...v,{id:L,name:`Player ${v.length+1}`}]}),children:"Add Player"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1",onClick:()=>{if(ft.length<2){alert("Need at least 2 players");return}const v=ft.map(K=>K.id),L=Yd(v),q={};v.forEach(K=>{q[K]=Ko(L[K])}),Dt(L),Kt(q),is(0),ms(0),tt(null),be("Assigned numbers"),Is(!0)},children:"Assign Numbers & Start"})]})]})})]}):le?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Your Turn"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-24",type:"number",min:0,max:60,value:we,onChange:v=>ke(Number(v.target.value||0)),onKeyDown:v=>{v.key==="Enter"&&(v.shiftKey?Al():Ur())}}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ur,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (T20, D16, 5, 25, 50)",value:ts,onChange:v=>Xt(v.target.value),onKeyDown:v=>{v.key==="Enter"&&(v.shiftKey?ii():Sa())}}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:ii,disabled:Yt===0,children:"Replace Last"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Sa,children:"Add"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"input w-full h-24 resize-none",placeholder:`Type scores manually (one per line, e.g. T20
D16
5
25
50) - No camera needed!`,value:Ar,onChange:v=>pa(v.target.value)}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:Ml,children:"Add All Scores"}),e.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",onClick:()=>pa(""),children:"Clear"})]})]})]}),e.jsx("div",{className:"text-xs text-slate-300",children:"Tip: Enter to Add · Shift+Enter to Replace Last"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"font-semibold",children:[l==="None"?"Opponent":`${l} AI`," Turn"]}),l!=="None"?e.jsxs("div",{className:"text-sm text-slate-300",children:["Throwing in ",Math.ceil(_s/1e3),"s..."]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"btn",onClick:()=>Be(!0),children:"Switch Back to You"})})]}),e.jsx("div",{className:"h-1"})]})]})})}),d&&e.jsx(sm,{onClose:()=>c(!1)}),ka&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"🔒"}),e.jsx("div",{className:"font-semibold",children:"Premium mode locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more."}),e.jsxs("button",{onClick:async()=>{try{const L=await(await fetch(`${nm}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t?.email})})).json();L.ok&&L.url?(window.location.href=L.url,L.development&&ye("Opened Stripe test checkout (development mode)",{type:"info",timeout:3e3})):L.error==="STRIPE_NOT_CONFIGURED"?ye("Premium purchases are not available in this development environment. Please visit the production site to upgrade.",{type:"error",timeout:4e3}):ye("Failed to create checkout session. Please try again.",{type:"error",timeout:4e3})}catch{ye("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM · ",No(wo(),5)]})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs(Xs,{storageKey:"ndn:modal:offline-win",className:"w-full relative",defaultWidth:420,defaultHeight:360,minWidth:360,minHeight:300,maxWidth:800,maxHeight:700,children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leg Won!"}),e.jsx("label",{className:"block mb-1",children:"Darts to hit double:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(v=>e.jsx("button",{className:`btn ${_===v?"bg-brand-600":""}`,onClick:()=>T(v),children:v},v))}),e.jsx("label",{className:"block mb-1",children:"Darts for checkout:"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3].map(v=>e.jsx("button",{className:`btn ${H===v?"bg-brand-600":""}`,onClick:()=>ae(v),children:v},v))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx("button",{className:"btn w-full",onClick:Pl,children:"Submit"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 w-full",onClick:()=>{E(!1),yn()},children:"Rematch"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 w-full",onClick:()=>{E(!1),lt(!1),u(!1)},children:"Back to Menu"})]})]})}),cl&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",children:e.jsxs(Xs,{storageKey:"ndn:modal:offline-summary",className:"w-full relative",defaultWidth:820,defaultHeight:520,minWidth:600,minHeight:400,maxWidth:1400,maxHeight:1e3,children:[e.jsx("h3",{className:"text-xl font-extrabold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[s," · ",n," start · First to ",A]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"You"}),e.jsx("div",{className:"text-3xl font-extrabold",children:k}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"3-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:fn>0?(w/fn*3).toFixed(1):"0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"1-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:fn>0?(w/fn).toFixed(2):"0.00"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180s"}),e.jsx("div",{className:"font-semibold",children:oe})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"140+"}),e.jsx("div",{className:"font-semibold",children:Qe})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"100+"}),e.jsx("div",{className:"font-semibold",children:as})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"High Checkout"}),e.jsx("div",{className:"font-semibold",children:ol||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Att"}),e.jsx("div",{className:"font-semibold",children:Os})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Hit"}),e.jsx("div",{className:"font-semibold",children:hn})]})]})]}),e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"text-4xl font-black",children:[k," – ",y]})}),e.jsxs("div",{className:"p-3 rounded-2xl glass border border-white/10",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:l==="None"?"Opponent":`${l} AI`}),e.jsx("div",{className:"text-3xl font-extrabold",children:y}),e.jsx("div",{className:"text-xs opacity-80",children:"Legs Won"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"3-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:h>0?(Q/h*3).toFixed(1):"0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"1-Dart Avg"}),e.jsx("div",{className:"font-semibold",children:h>0?(Q/h).toFixed(2):"0.00"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"180s"}),e.jsx("div",{className:"font-semibold",children:We})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"140+"}),e.jsx("div",{className:"font-semibold",children:Ir})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"100+"}),e.jsx("div",{className:"font-semibold",children:ks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"High Checkout"}),e.jsx("div",{className:"font-semibold",children:ll||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Att"}),e.jsx("div",{className:"font-semibold",children:sn})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Dbl Hit"}),e.jsx("div",{className:"font-semibold",children:Ws})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Legs Timeline"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map((v,L)=>e.jsxs("div",{className:`px-3 py-1 rounded-full border text-xs ${v.winner==="player"?"bg-emerald-500/15 border-emerald-400/30":"bg-fuchsia-500/15 border-fuchsia-400/30"}`,children:["Leg ",L+1,": ",v.winner==="player"?"You":l==="None"?"Opp":"AI"," · Dbl ",v.doubleDarts," · CO ",v.checkoutDarts]},L))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Shot Heat Map"}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black p-3",children:e.jsx(Gd,{})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>xa(!1),children:"Close"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{xa(!1),yn()},children:"Rematch"})]})]})}),P.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leg Stats"}),e.jsx("ul",{children:P.map((v,L)=>e.jsxs("li",{children:["Leg ",L+1,": Double darts: ",v.doubleDarts,", Checkout darts: ",v.checkoutDarts]},L))})]})]})}const tl="ndn:messages:inbox",sl="ndn:messages:unread";function rm(){try{const t=localStorage.getItem(tl),a=t?JSON.parse(t):[],s=Number(localStorage.getItem(sl)||"0")||0;return{inbox:Array.isArray(a)?a.filter(n=>n&&typeof n.id=="string").slice(0,200):[],unread:s}}catch{return{inbox:[],unread:0}}}function ta(t,a){try{localStorage.setItem(tl,JSON.stringify(t))}catch{}try{localStorage.setItem(sl,String(a))}catch{}}const io=rm(),jr=on((t,a)=>({inbox:io.inbox,unread:io.unread,inGame:!1,setInGame:s=>t({inGame:s}),add:s=>t(i=>{const n=i.inbox.some(o=>o.id===s.id&&o.ts===s.ts),r=n?i.inbox:[s,...i.inbox].slice(0,200),l=i.unread+(n?0:1);return ta(r,l),{inbox:r,unread:l}}),load:s=>t(i=>{const n=[...s].sort((r,l)=>l.ts-r.ts).slice(0,200);return ta(n,i.unread),{inbox:n,unread:i.unread}}),markAllRead:()=>{const s=a();ta(s.inbox,0),t({unread:0})},remove:s=>t(i=>{const n=i.inbox.filter(l=>l.id!==s),r=i.unread;return ta(n,r),{inbox:n,unread:r}})})),nl=[/\b(f+[\W_]*u+[\W_]*c+[\W_]*k+)\b/gi,/\b(s+[\W_]*h+[\W_]*i+[\W_]*t+)\b/gi,/\b(b+[\W_]*i+[\W_]*t+[\W_]*c+[\W_]*h+)\b/gi,/\b(a+[\W_]*s+[\W_]*s+[\W_]*h+[\W_]*o+[\W_]*l+[\W_]*e+)\b/gi,/\b(d+[\W_]*a+[\W_]*m+[\W_]*n+)\b/gi,/\b(c+[\W_]*r+[\W_]*a+[\W_]*p+)\b/gi,/\b(p+[\W_]*i+[\W_]*s+[\W_]*s+)\b/gi];function im(t){return t.replace(/[\p{L}\p{N}]/gu,"*")}function al(t){if(!t)return t;let a=t;for(const s of nl)a=a.replace(s,i=>im(i));return a}function om(t){return t?nl.some(a=>a.test(t)):!1}function fa({tabs:t,active:a,onChange:s,className:i}){return e.jsxs("div",{className:`relative ${i||""}`,children:[e.jsx("div",{className:"absolute inset-0 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 pointer-events-none"}),e.jsx("div",{className:"relative overflow-x-auto no-scrollbar py-1 px-1",children:e.jsx("div",{className:"flex items-center gap-2 min-w-max",children:t.map(n=>{const r=n.key===a;return e.jsx("button",{type:"button",onClick:()=>s(n.key),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98]
                  ${r?"bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white shadow-indigo-500/30":"bg-white/10 text-slate-100 hover:bg-white/15"}
                `,"aria-pressed":r,children:n.label},n.key)})})}),e.jsx("style",{children:`
        /* Hide scrollbars on WebKit/Firefox for a cleaner pill row */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})}function lm(t){if(!t)return"";const a=Math.floor((Date.now()-t)/1e3);if(a<60)return`${a}s ago`;const s=Math.floor(a/60);if(s<60)return`${s}m ago`;const i=Math.floor(s/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`}function cm({user:t}){const a=wn(),s=String(t?.email||"").toLowerCase(),[i,n]=m.useState([]),[r,l]=m.useState([]),[o,d]=m.useState([]),[c,f]=m.useState(""),[u,x]=m.useState("all"),[p,g]=m.useState(!1),S=jr(),[M,I]=m.useState([]),[N,E]=m.useState([]),[A,D]=m.useState({show:!1});async function k(){if(s)try{const[T,H,ae,P]=await Promise.all([fetch(`/api/friends/list?email=${encodeURIComponent(s)}`).then(Z=>Z.json()),fetch(`/api/friends/suggested?email=${encodeURIComponent(s)}`).then(Z=>Z.json()),fetch(`/api/friends/requests?email=${encodeURIComponent(s)}`).then(Z=>Z.json()),fetch(`/api/friends/outgoing?email=${encodeURIComponent(s)}`).then(Z=>Z.json())]);n(T.friends||[]),l(H.suggestions||[]),I(ae.requests||[]),E(P.requests||[])}catch{}}m.useEffect(()=>{k()},[s]);async function b(T){if(f(T),!T){d([]);return}try{const ae=await(await fetch(`/api/friends/search?q=${encodeURIComponent(T)}`)).json();d(ae.results||[])}catch{}}async function y(T){if(!(!s||!T)){g(!0);try{await fetch("/api/friends/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:T})}),await k(),f(""),d([]),a("Friend added",{type:"success"})}finally{g(!1)}}}async function $(T){if(!(!s||!T)){g(!0);try{await fetch("/api/friends/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:T})}),await k(),a("Friend removed",{type:"info"})}finally{g(!1)}}}const Y=m.useMemo(()=>u==="all"?i:i.filter(T=>(T.status||"offline")===u),[i,u]);async function O(T){if(!T){a("Room unavailable",{type:"error"});return}try{const H=new CustomEvent("ndn:spectate-request",{detail:{roomId:T}});window.dispatchEvent(H),a("Opening spectator view…",{type:"info"})}catch{}}const _=M.length+N.length;return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Friends"}),e.jsx("p",{className:"mb-2 text-brand-600",children:"Manage your friends. See who’s online, in-game, or offline; find new teammates; and invite people to play."}),e.jsxs("div",{className:"text-xs opacity-70 mb-3",children:["Online: ",i.filter(T=>T.status==="online").length," · In-game: ",i.filter(T=>T.status==="ingame").length," · Offline: ",i.filter(T=>!T.status||T.status==="offline").length]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"md:col-span-2 p-3 rounded-2xl bg-black/30 border border-white/10",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"font-semibold text-white/90",children:"Your Friends"})}),e.jsx(fa,{tabs:[{key:"all",label:"All"},{key:"online",label:"Online"},{key:"ingame",label:"In-Game"},{key:"offline",label:"Offline"},{key:"requests",label:`Requests ${_>0?"("+_+")":""}`}],active:u,onChange:T=>x(T),className:"mb-3"}),u==="requests"?e.jsx("ul",{className:"space-y-2",children:_>0?e.jsxs(e.Fragment,{children:[M.length>0&&M.map(T=>e.jsxs("li",{className:"p-3 rounded bg-black/20 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:T.fromUsername||T.fromEmail||"Unknown User"}),e.jsx("span",{className:"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded",children:"Incoming"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{g(!0);try{if((await fetch("/api/friends/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requester:T.fromEmail})})).ok){I(P=>P.filter(Z=>Z.id!==T.id));const ae={email:T.fromEmail,username:T.fromUsername,status:"offline"};n(P=>[...P,ae]),E(P=>P.filter(Z=>Z.toEmail!==T.fromEmail)),a("Friend request accepted",{type:"success"}),setTimeout(()=>k(),100)}else a("Failed to accept request",{type:"error"})}catch{a("Error accepting request",{type:"error"})}finally{g(!1)}},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:async()=>{g(!0);try{(await fetch("/api/friends/decline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,requester:T.fromEmail})})).ok?(I(ae=>ae.filter(P=>P.id!==T.id)),E(ae=>ae.filter(P=>P.toEmail!==T.fromEmail)),a("Friend request declined",{type:"info"}),setTimeout(()=>k(),100)):a("Failed to decline request",{type:"error"})}finally{g(!1)}},children:"Decline"})]})]},`incoming-${T.id||T.fromEmail}`)),N.length>0&&N.map(T=>e.jsxs("li",{className:"p-3 rounded bg-black/20 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:T.toUsername||T.toEmail||"Unknown User"}),e.jsx("span",{className:"text-xs bg-amber-600/20 text-amber-400 px-2 py-1 rounded",children:"Pending"})]}),e.jsx("button",{className:"btn bg-slate-600 hover:bg-slate-700 self-start",onClick:async()=>{g(!0);try{(await fetch("/api/friends/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,friend:T.toEmail})})).ok?(E(ae=>ae.filter(P=>P.id!==T.id)),a("Friend request cancelled",{type:"info"}),setTimeout(()=>k(),100)):a("Failed to cancel request",{type:"error"})}finally{g(!1)}},children:"Cancel"})]},`outgoing-${T.id||T.toEmail}`))]}):e.jsx("li",{className:"text-sm opacity-70",children:"No friend requests yet."})}):e.jsxs("ul",{className:"space-y-2",children:[Y.map(T=>e.jsxs("li",{className:"p-2 rounded bg-black/20 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${T.status==="online"?"bg-emerald-400":T.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{className:"font-semibold",children:T.username||T.email}),e.jsxs("span",{className:"text-xs opacity-70",children:[T.status||"offline",T.status!=="online"&&T.lastSeen?` · ${lm(T.lastSeen)}`:""]}),T.status==="ingame"&&T.match&&e.jsxs("span",{className:"text-[10px] opacity-70 px-2 py-0.5 rounded bg-indigo-500/20 border border-indigo-600/30",children:[T.match.game," ",T.match.mode==="firstto"?"FT":"BO"," ",T.match.value,T.match.game==="X01"&&T.match.startingScore?` · ${T.match.startingScore}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T.status==="ingame"&&T.roomId&&e.jsx("button",{className:"btn",onClick:()=>O(T.roomId),children:"Spectate"}),e.jsx("button",{className:"btn",disabled:p||T.status!=="online"&&T.status!=="ingame",onClick:async()=>{g(!0);try{(await(await fetch("/api/friends/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:T.email,game:"X01",mode:"bestof",value:3,startingScore:501})})).json().catch(()=>({})))?.delivered?a("Invite sent",{type:"success"}):a("Friend is offline; invite queued",{type:"info"})}finally{g(!1)}},children:"Invite"}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>D({show:!0,toUser:T.username||T.email,toEmail:T.email}),children:"Message"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:p,onClick:()=>$(T.email),children:"Remove"})]})]},T.email)),Y.length===0&&e.jsxs("li",{className:"text-sm opacity-70",children:["No friends ",u!=="all"?`in ${u}`:""," yet."]})]})]}),e.jsxs("div",{className:"p-3 rounded-2xl bg-black/20 border border-white/10",children:[e.jsx("div",{className:"font-semibold mb-2 text-white/90",children:"Find Friends"}),e.jsx("input",{className:"input w-full mb-2",placeholder:"Search by name or email",value:c,onChange:T=>b(T.target.value)}),e.jsxs("ul",{className:"space-y-1 mb-3 max-h-48 overflow-auto",children:[o.map(T=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${T.status==="online"?"bg-emerald-400":T.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{children:T.username||T.email})]}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>y(T.email),children:"Add"})]},T.email)),o.length===0&&e.jsx("li",{className:"text-xs opacity-60",children:"Type to search…"})]}),e.jsx("div",{className:"font-semibold mb-1 text-white/90",children:"Suggested"}),e.jsxs("ul",{className:"space-y-1 max-h-48 overflow-auto",children:[r.map(T=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${T.status==="online"?"bg-emerald-400":T.status==="ingame"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{children:T.username||T.email})]}),e.jsx("button",{className:"btn",disabled:p,onClick:()=>y(T.email),children:"Add"})]},T.email)),r.length===0&&e.jsx("li",{className:"text-xs opacity-60",children:"No suggestions right now."})]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>S.markAllRead(),children:"Mark all read"})]}),S.inbox.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No messages yet."}):e.jsx("ul",{className:"space-y-2 max-h-72 overflow-auto",children:S.inbox.map(T=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:T.from})," ",e.jsxs("span",{className:"opacity-70 text-xs",children:["· ",new Date(T.ts).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn px-2 py-1 text-xs",onClick:()=>D({show:!0,toUser:T.from,toEmail:T.from,replyTo:T.from}),children:"Reply"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-2 py-1 text-xs",title:"Delete this message",onClick:()=>S.remove(T.id),children:"Delete"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 px-2 py-1 text-xs",onClick:async()=>{const H=prompt("Report reason (what happened)?");if(H)try{await fetch("/api/friends/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reporterEmail:s,offenderEmail:T.from,reason:H,messageId:T.id})}),a("Report sent to admin",{type:"info"})}catch{}},children:"Report"})]})]}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap break-words",children:al(T.message)})]},T.id))})]}),A.show&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("div",{className:"text-center mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Type Message To ",A.toUser]})}),e.jsx("textarea",{className:"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none",placeholder:"Type your message here...",id:"message-input",autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{className:"flex-1 btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const H=document.getElementById("message-input")?.value?.trim();if(H){g(!0);try{await fetch("/api/friends/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromEmail:s,toEmail:A.toEmail,message:H})}),a("Message sent",{type:"success"}),D({show:!1})}catch{a("Failed to send message",{type:"error"})}finally{g(!1)}}},disabled:p,children:"Send"}),e.jsx("button",{className:"flex-1 btn bg-slate-600 hover:bg-slate-700",onClick:()=>D({show:!1}),children:"Cancel"})]})]})})]})}function dm(){const t=hr(s=>s.toasts),a=hr(s=>s.remove);return t.length?e.jsxs(e.Fragment,{children:[t.filter(s=>s.type==="success").map(s=>e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50",children:e.jsx("div",{className:"p-4 rounded-lg shadow-lg border text-sm bg-emerald-700/90 border-emerald-500/60 text-white max-w-sm text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("span",{className:"flex-1 font-semibold",children:s.message})})})},s.id)),t.filter(s=>s.type!=="success").length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 sm:right-4 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 w-[calc(100%-1.5rem)] sm:w-auto max-w-sm",children:t.filter(s=>s.type!=="success").map(s=>e.jsx("div",{className:`p-3 rounded-lg shadow-lg border text-sm ${s.type==="error"?"bg-rose-700/80 border-rose-500/60 text-white":"bg-black/70 border-slate-700 text-slate-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex-1",children:s.message}),e.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>a(s.id),children:"Dismiss"})]})},s.id))})]}):null}function Nr({data:t,height:a=220,barWidth:s=28,gap:i=6,showValues:n=!1}){const r=Math.max(1,...t.map(o=>o.value)),l=t.length*(s+i);return e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"relative",style:{height:a,width:Math.max(600,l)},children:e.jsx("div",{className:"absolute inset-0 flex items-end",children:t.map((o,d)=>{const c=Math.round(o.value/r*(a-40));return e.jsxs("div",{className:"flex flex-col items-center justify-end",style:{width:s,marginRight:i},children:[e.jsx("div",{className:"w-full rounded-t-md bg-gradient-to-b from-indigo-400 to-fuchsia-500 shadow-sm",style:{height:c},title:`${o.label}: ${o.value}`}),n&&e.jsx("div",{className:"text-[10px] mt-1 opacity-80",children:o.value}),e.jsx("div",{className:"text-[10px] mt-1 opacity-70 select-none",children:o.label})]},d)})})})})}const mm=["X01","Double Practice"],qs=["Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer","Bob's 27","Count-Up","High Score","Low Score","Checkout 170","Checkout 121","Treble Practice","Baseball","Golf","Tic Tac Toe","American Cricket"],Nn=[...mm,...qs],um="daviesfamily108@gmail.com";function hm({user:t}){const[a,s]=m.useState([]),[i,n]=m.useState(""),[r,l]=m.useState(null),[o,d]=m.useState(""),[c,f]=m.useState(!1),[u,x]=m.useState([]),[p,g]=m.useState([]),[S,M]=m.useState(""),[I,N]=m.useState([]),[E,A]=m.useState({title:"Official Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:30,capacity:16,prizeType:"premium",prizeAmount:3,currency:"GBP",prizeNotes:""}),[D,k]=m.useState({reset:{},reminder:{},confirmEmail:{},changed:{}}),[b,y]=m.useState({open:!1}),[$,Y]=m.useState("general"),O=t?.email?.toLowerCase()===um,[_,T]=m.useState([]),[H,ae]=m.useState([]),[P,Z]=m.useState([]),[se,ze]=m.useState(null),[ye,Me]=m.useState(0);m.useEffect(()=>{const C=()=>Me(ee=>ee+1);return window.addEventListener("ndn:stats-updated",C),()=>window.removeEventListener("ndn:stats-updated",C)},[]);const lt=m.useMemo(()=>Sr(Nn),[ye]),Ke=m.useMemo(()=>Nn.map(C=>({label:C,value:lt[C]?.played||0,won:lt[C]?.won||0})),[lt]);async function ge(){try{const ee=await(await fetch("/api/admins")).json();if(s(Array.isArray(ee.admins)?ee.admins:[]),O){const Ct=await fetch(`/api/admin/status?requesterEmail=${encodeURIComponent(t?.email||"")}`);Ct.ok&&l(await Ct.json());const Ye=await fetch(`/api/admin/tournaments?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Ye.ok){const $e=await Ye.json();x(Array.isArray($e.tournaments)?$e.tournaments:[])}const Ut=await fetch(`/api/admin/reports?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Ut.ok){const $e=await Ut.json();ae(Array.isArray($e.reports)?$e.reports:[])}const At=await fetch(`/api/admin/premium-winners?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(At.ok){const $e=await At.json();T(Array.isArray($e.winners)?$e.winners:[])}const Et=await fetch(`/api/admin/wallet/withdrawals?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(Et.ok){const $e=await Et.json();g(Array.isArray($e.withdrawals)?$e.withdrawals:[])}}}catch{}}m.useEffect(()=>{ge()},[]);async function Re(){i&&(await fetch("/api/admins/grant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,requesterEmail:t?.email})}),n(""),ge())}async function ct(C){await fetch("/api/admins/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:C,requesterEmail:t?.email})}),ge()}async function Je(C,ee){C&&(await fetch("/api/admin/premium/grant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:C,days:ee,requesterEmail:t?.email})}),await ge())}async function Ne(C){await fetch("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:C,requesterEmail:t?.email})}),await ge()}async function le(C){f(!0);try{await fetch("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:C,requesterEmail:t?.email})}),await ge()}finally{f(!1)}}async function Be(){if(o.trim()){f(!0);try{await fetch("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o,requesterEmail:t?.email})}),d(""),await ge()}finally{f(!1)}}}async function we(){if(S.trim())try{const C=await fetch(`/api/admin/users/search?q=${encodeURIComponent(S)}&requesterEmail=${encodeURIComponent(t?.email||"")}`);if(C.ok){const ee=await C.json();N(Array.isArray(ee.users)?ee.users:[])}}catch(C){console.error("Search failed:",C)}}async function ke(C){try{await fetch("/api/admin/users/ban",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:C,requesterEmail:t?.email})}),await we()}catch(ee){console.error("Ban failed:",ee)}}async function ce(C){try{await fetch("/api/admin/users/unban",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:C,requesterEmail:t?.email})}),await we()}catch(ee){console.error("Unban failed:",ee)}}async function de(){f(!0);try{const C=new Date(E.startAt).getTime();await fetch("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:E.title,game:E.game,mode:E.mode,value:Number(E.value),description:E.description,startAt:C,checkinMinutes:Number(E.checkinMinutes),capacity:Number(E.capacity),creatorEmail:t?.email,creatorName:t?.username,requesterEmail:t?.email,official:!0,prizeType:E.prizeType,prizeAmount:Number(E.prizeAmount||0),currency:E.currency,prizeNotes:E.prizeNotes})}),await ge()}finally{f(!1)}}async function Ee(C,ee){f(!0);try{await fetch("/api/admin/tournaments/winner",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:C,winnerEmail:ee,requesterEmail:t?.email})}),await ge()}finally{f(!1)}}async function jt(C){f(!0);try{await fetch("/api/admin/tournaments/mark-paid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:C,requesterEmail:t?.email})}),await ge()}finally{f(!1)}}async function Ue(C){f(!0);try{await fetch("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:C,requesterEmail:t?.email})}),await ge()}finally{f(!1)}}async function re(){f(!0);try{await fetch("/api/admin/tournaments/reseed-weekly",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requesterEmail:t?.email})}),await ge()}finally{f(!1)}}async function ue(C,ee){f(!0);try{await fetch("/api/admin/wallet/withdrawals/decide",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:C,approve:ee,requesterEmail:t?.email})}),await ge()}finally{f(!1)}}async function fe(C){f(!0);try{await fetch("/api/admin/matches/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matchId:C,requesterEmail:t?.email})}),await ge()}finally{f(!1)}}async function me(){try{const C=await fetch(`/api/admin/logs?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(C.ok){const ee=await C.json();ee?.ok&&Z(ee.logs||[])}}catch(C){console.error("Failed to fetch logs:",C)}}async function qe(){try{const C=await fetch(`/api/admin/system-health?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(C.ok){const ee=await C.json();ee?.ok&&ze(ee.health)}}catch(C){console.error("Failed to fetch system health:",C)}}async function Le(){try{const C=await fetch(`/api/admin/email-copy?requesterEmail=${encodeURIComponent(t?.email||"")}`);if(C.ok){const ee=await C.json();ee?.ok&&k(ee.copy||D)}}catch{}}m.useEffect(()=>{O&&Le()},[O]),m.useEffect(()=>{O&&($==="general"||$==="maintenance")&&(me(),qe())},[O,$]);async function et(C,ee){await fetch("/api/admin/email-copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requesterEmail:t?.email,kind:C,...ee})}),await Le()}async function yt(C){try{const Ct=await(await fetch(`/api/email/preview?kind=${encodeURIComponent(C)}&requesterEmail=${encodeURIComponent(t?.email||"")}`)).text();y({open:!0,kind:C,html:Ct})}catch{y({open:!0,kind:C,html:'<!doctype html><html><body style="font-family:sans-serif;padding:16px">Failed to load preview.</body></html>'})}}m.useEffect(()=>{if(!b.open)return;function C(ee){ee.key==="Escape"&&y({open:!1})}return document.addEventListener("keydown",C),()=>document.removeEventListener("keydown",C)},[b.open]);function ht({kind:C,label:ee}){const Ye=D?.[C==="confirm-email"?"confirmEmail":C==="changed"?"changed":C]||{title:"",intro:"",buttonLabel:""},[Ut,At]=m.useState(Ye.title||""),[Et,$e]=m.useState(Ye.intro||""),[Vt,Nt]=m.useState(Ye.buttonLabel||"");return m.useEffect(()=>{At(Ye.title||""),$e(Ye.intro||""),Nt(Ye.buttonLabel||"")},[Ye.title,Ye.intro,Ye.buttonLabel]),e.jsxs("div",{className:"p-2 rounded bg-black/20 space-y-2",children:[e.jsx("div",{className:"font-semibold",children:ee}),e.jsx("input",{className:"input w-full",placeholder:"Title (optional)",value:Ut,onChange:pt=>At(pt.target.value)}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Intro line (optional)",value:Et,onChange:pt=>$e(pt.target.value)}),e.jsx("input",{className:"input w-full",placeholder:"Button label (optional)",value:Vt,onChange:pt=>Nt(pt.target.value)}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("a",{className:"btn",href:`/api/email/preview?kind=${encodeURIComponent(C)}&requesterEmail=${encodeURIComponent(t?.email||"")}`,target:"_blank",rel:"noreferrer",children:"Preview"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>yt(C),children:"Popup"}),e.jsx("button",{className:"btn",onClick:()=>et(C,{title:Ut,intro:Et,buttonLabel:Vt}),children:"Save"})]})]})}return O?e.jsxs("div",{className:"space-y-4",children:[O&&e.jsx(fa,{tabs:[{key:"general",label:"General"},{key:"maintenance",label:"Maintenance"},{key:"premium",label:"Premium"}],active:$,onChange:C=>Y(C),className:"mb-4"}),$==="general"&&e.jsxs(e.Fragment,{children:[O&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Game Usage"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Bar height shows total plays per mode. Wins are listed under each label. This helps decide which modes to keep or iterate on."}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(Nr,{data:Ke.map(C=>({label:C.label,value:C.value}))}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:Ke.map((C,ee)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:C.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",C.value," · Won ",C.won]})]},ee))})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Admin to trusted users. Only the owner can perform these actions."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:i,onChange:C=>n(C.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:Re,children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>ct(i),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Current Admins:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:a.map(C=>e.jsx("div",{className:"px-2 py-1 rounded bg-indigo-600/20 border border-indigo-500/40 text-sm",children:C},C))}),e.jsx("hr",{className:"border-indigo-500/20 my-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Premium Access Control"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke Premium subscription access to users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:i,onChange:C=>n(C.target.value)}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c||!i.trim(),onClick:()=>Je(i,30),children:"Grant Premium"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>Ne(i),children:"Revoke Premium"})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Premium grants provide 30 days of unlimited access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tournament Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Users who have won premium prizes in tournaments and need access granted."}),e.jsxs("div",{className:"space-y-2",children:[u.filter(C=>C.status==="completed"&&C.winnerEmail&&C.prizeType==="premium").map(C=>{const ee=_.find(Ye=>Ye.email===C.winnerEmail),Ct=ee&&!ee.expired;return e.jsxs("div",{className:"p-3 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:C.title}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(C.startAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:C.winnerEmail}),e.jsxs("div",{className:"text-xs opacity-70",children:["Prize: ",C.prizeAmount," month",C.prizeAmount>1?"s":""," PREMIUM"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:Ct?e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Access Granted"}):e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700 text-xs",disabled:c,onClick:()=>Je(C.winnerEmail,C.prizeAmount*30*24*60*60*1e3),children:"Grant Access"})})]})]},C.id)}),u.filter(C=>C.status==="completed"&&C.winnerEmail&&C.prizeType==="premium").length===0&&e.jsx("div",{className:"text-center py-4 text-sm opacity-60",children:"No completed premium tournaments."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Announcements"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Send a message to all users. This will appear as a toast notification."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Announcement message...",value:o,onChange:C=>d(C.target.value)}),e.jsx("button",{className:"btn",disabled:c||!o.trim(),onClick:Be,children:"Send"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Search"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Search for users by email or name."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"Search users...",value:S,onChange:C=>M(C.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:we,children:"Search"})]}),I.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),I.map(C=>e.jsx("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:C.name||"No name"}),e.jsx("div",{className:"opacity-70",children:C.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(C.createdAt).toLocaleDateString()]})]})},C.email))]})]}),O&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Tournaments Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Create Official"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"input w-full",placeholder:"Title",value:E.title,onChange:C=>A(ee=>({...ee,title:C.target.value}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("select",{className:"input",value:E.game,onChange:C=>A(ee=>({...ee,game:C.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low"].map(C=>e.jsx("option",{value:C,children:C},C))}),e.jsxs("select",{className:"input",value:E.mode,onChange:C=>A(ee=>({...ee,mode:C.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]}),e.jsx("input",{className:"input",type:"number",min:1,value:E.value,onChange:C=>A(ee=>({...ee,value:Number(C.target.value)}))})]}),e.jsx("textarea",{className:"input w-full",rows:2,placeholder:"Description",value:E.description,onChange:C=>A(ee=>({...ee,description:C.target.value}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{className:"input",type:"datetime-local",value:E.startAt,onChange:C=>A(ee=>({...ee,startAt:C.target.value}))}),e.jsx("input",{className:"input",type:"number",min:0,value:E.checkinMinutes,onChange:C=>A(ee=>({...ee,checkinMinutes:Number(C.target.value)}))})]}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,value:E.capacity,onChange:C=>A(ee=>({...ee,capacity:Number(C.target.value)}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[e.jsxs("select",{className:"input",value:E.prizeType,onChange:C=>{const ee=C.target.value;A(Ct=>({...Ct,prizeType:ee,prizeAmount:ee==="premium"?3:0}))},children:[e.jsx("option",{value:"premium",children:"PREMIUM"}),e.jsx("option",{value:"cash",children:"Cash"})]}),E.prizeType==="premium"?e.jsxs("select",{className:"input",value:E.prizeAmount,onChange:C=>A(ee=>({...ee,prizeAmount:Number(C.target.value)})),children:[e.jsx("option",{value:1,children:"1 month"}),e.jsx("option",{value:3,children:"3 months"})]}):e.jsx("input",{className:"input",type:"number",min:0,value:E.prizeAmount,onChange:C=>A(ee=>({...ee,prizeAmount:Number(C.target.value)}))}),e.jsxs("select",{className:"input",disabled:E.prizeType!=="cash",value:E.currency,onChange:C=>A(ee=>({...ee,currency:C.target.value})),children:[e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"CAD",children:"CAD"}),e.jsx("option",{value:"AUD",children:"AUD"})]})]}),e.jsx("input",{className:"input w-full",placeholder:"Prize notes (optional)",value:E.prizeNotes,onChange:C=>A(ee=>({...ee,prizeNotes:C.target.value}))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn",disabled:c,onClick:de,children:"Create"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Existing"}),e.jsxs("ul",{className:"space-y-2",children:[u.map(C=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:C.title}),e.jsx("div",{className:"opacity-70",children:C.status})]}),e.jsxs("div",{className:"opacity-80",children:[C.game," · ",C.mode==="firstto"?"FT":"BO"," ",C.value," · ",new Date(C.startAt).toLocaleString()," · ",C.capacity," cap"]}),C.prize&&e.jsxs("div",{className:"text-xs mt-1",children:["Prize: ",C.prizeType==="cash"&&C.prizeAmount?`${C.currency||"USD"} ${C.prizeAmount}`:`${C.prizeAmount||3} month${(C.prizeAmount||3)>1?"s":""} PREMIUM`," ",C.prizeType==="cash"&&C.status==="completed"&&C.payoutStatus&&e.jsx("span",{className:`ml-2 px-1.5 py-0.5 rounded ${C.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:C.payoutStatus})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn",disabled:c||C.status!=="scheduled",onClick:()=>Ee(C.id,prompt("Winner email?")||""),children:"Set Winner"}),C.prizeType==="cash"&&C.status==="completed"&&C.payoutStatus!=="paid"&&e.jsx("button",{className:"btn",disabled:c,onClick:()=>jt(C.id),children:"Mark Paid"})]})]},C.id)),u.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{className:"btn",disabled:c,onClick:re,children:"Reseed Weekly Giveaway"})})]})]})]}),O&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Email Templates"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Customize titles, intro lines, and button text. Previews open in a new tab or as a popup."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(ht,{kind:"reset",label:"Password reset"}),e.jsx(ht,{kind:"reminder",label:"Password reset reminder"}),e.jsx(ht,{kind:"confirm-email",label:"Confirm new email"}),e.jsx(ht,{kind:"changed",label:"Password changed notice"})]})]})]}),$==="maintenance"&&O&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"User Management"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Ban or unban users. Use with caution."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:S,onChange:C=>M(C.target.value)}),e.jsx("button",{className:"btn",disabled:c,onClick:we,children:"Search"})]}),I.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Results:"}),I.map(C=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:C.name||"No name"}),e.jsx("div",{className:"opacity-70",children:C.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Joined ",new Date(C.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",onClick:()=>ke(C.email),children:"Ban"}),e.jsx("button",{className:"btn bg-green-600 hover:bg-green-700 text-xs",onClick:()=>ce(C.email),children:"Unban"})]})]},C.email))]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Withdrawals"}),e.jsxs("ul",{className:"space-y-2",children:[p.map(C=>e.jsxs("li",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:C.id}),e.jsxs("div",{children:[C.email," · ",C.currency," ",(C.amountCents/100).toFixed(2)]}),e.jsxs("div",{className:"opacity-70",children:[C.status," · ",new Date(C.requestedAt).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2",children:C.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c,onClick:()=>ue(C.id,!0),children:"Approve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>ue(C.id,!1),children:"Reject"})]})})]},C.id)),p.length===0&&e.jsx("li",{className:"opacity-60",children:"No withdrawal requests."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),se?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${se.database?"bg-emerald-600":"bg-red-600"}`,children:se.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${se.websocket?"bg-emerald-600":"bg-red-600"}`,children:se.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${se.https?"bg-emerald-600":"bg-amber-600"}`,children:se.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${se.maintenance?"bg-red-600":"bg-emerald-600"}`,children:se.maintenance?"Active":"Normal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(se.uptime/3600),"h ",Math.floor(se.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",Math.round(se.memory.heapUsed/1024/1024),"MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",se.version]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:qe,children:"Refresh"})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:qe,children:"Load Health Status"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"User Reports"}),e.jsxs("ul",{className:"space-y-2",children:[H.map(C=>e.jsx("li",{className:"p-2 rounded bg-black/20 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-xs",children:C.id}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:C.reporter})," → ",e.jsx("span",{className:"font-semibold",children:C.offender})," · ",new Date(C.ts).toLocaleString()]}),e.jsxs("div",{className:"opacity-80",children:["Reason: ",C.reason]}),C.messageId&&e.jsxs("div",{className:"opacity-60 text-xs",children:["Message ID: ",C.messageId]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${C.status==="open"?"bg-amber-600":"bg-emerald-600"}`,children:C.status}),C.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",disabled:c,onClick:async()=>{await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:C.id,action:"resolved",requesterEmail:t?.email})}),await ge()},children:"Resolve"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:async()=>{const ee=prompt("Enter notes for action taken (e.g., warning, block):")||"";await fetch("/api/admin/reports/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:C.id,action:"actioned",notes:ee,requesterEmail:t?.email})}),await ge()},children:"Action"})]})]})]})},C.id)),H.length===0&&e.jsx("li",{className:"opacity-60",children:"No reports."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"System Health"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Current status of system components and services."}),se?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${se.database?"bg-emerald-600":"bg-red-600"}`,children:se.database?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"WebSocket"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${se.websocket?"bg-emerald-600":"bg-red-600"}`,children:se.websocket?"Ready":"Down"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"HTTPS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${se.https?"bg-emerald-600":"bg-amber-600"}`,children:se.https?"Enabled":"HTTP Only"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maintenance Mode"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${se.maintenance?"bg-red-600":"bg-emerald-600"}`,children:se.maintenance?"Active":"Normal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Uptime:"})," ",Math.floor(se.uptime/3600),"h ",Math.floor(se.uptime%3600/60),"m"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Memory:"})," ",Math.round(se.memory.heapUsed/1024/1024),"MB used"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Version:"})," ",se.version]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{className:"btn",onClick:qe,children:"Refresh"})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-sm opacity-60 mb-2",children:"Loading system health..."}),e.jsx("button",{className:"btn",onClick:qe,children:"Load Health Status"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Open Matches"}),e.jsxs("ul",{className:"space-y-1",children:[(r?.matches||[]).map(C=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded bg-black/20 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs",children:C.id}),e.jsx("span",{className:"opacity-80",children:C.creatorName}),e.jsxs("span",{className:"opacity-60",children:[C.game," ",C.mode==="firstto"?"FT":"BO"," ",C.value," ",C.game==="X01"?`/${C.startingScore}`:""]})]}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>fe(C.id),children:"Remove"})]},C.id)),(!r?.matches||r.matches.length===0)&&e.jsx("li",{className:"text-sm opacity-60",children:"No open matches."})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Dangerous Operations"}),e.jsx("div",{className:"text-sm opacity-80 mb-3 text-red-400",children:"⚠️ These operations can cause data loss or service disruption. Use with extreme caution."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"Tournament Deletion"}),e.jsxs("ul",{className:"space-y-2",children:[u.map(C=>e.jsxs("li",{className:"p-2 rounded bg-red-900/20 border border-red-500/40 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:C.title}),e.jsx("div",{className:"opacity-70",children:C.status})]}),e.jsxs("div",{className:"opacity-80",children:[C.game," · ",C.mode==="firstto"?"FT":"BO"," ",C.value]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"btn bg-red-600 hover:bg-red-700 text-xs",disabled:c,onClick:()=>Ue(C.id),children:"Delete Tournament"})})]},C.id)),u.length===0&&e.jsx("li",{className:"opacity-60",children:"No tournaments."})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-red-400",children:"System Maintenance"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"p-3 rounded bg-red-900/20 border border-red-500/40",children:[e.jsx("div",{className:"font-semibold text-red-400 mb-2",children:"Maintenance Mode"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Put the entire site into maintenance mode. Users won't be able to access games or create matches."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${r?.maintenance?"bg-red-600":"bg-green-600"}`,children:r?.maintenance?"MAINTENANCE ACTIVE":"NORMAL OPERATION"}),e.jsx("button",{className:`btn ${r?.maintenance?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:c,onClick:()=>le(!r?.maintenance),children:r?.maintenance?"Disable":"Enable"})]})]})})]})]})]})]}),$==="premium"&&O&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Subscription Grants"}),e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Grant or revoke premium subscriptions for users (grants 30 days)."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"input flex-1",placeholder:"user@example.com",value:i,onChange:C=>n(C.target.value)}),e.jsx("button",{className:"btn",disabled:c||!i.trim(),onClick:()=>Je(i,30),children:"Grant"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",disabled:c,onClick:()=>Ne(i),children:"Revoke"})]}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Premium users get 30 days of access to all features."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Winners"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Users who have won premium through tournaments."}),e.jsxs("div",{className:"space-y-2",children:[_.map(C=>e.jsxs("div",{className:"p-2 rounded bg-black/20 text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:C.name||"No name"}),e.jsx("div",{className:"opacity-70",children:C.email}),e.jsxs("div",{className:"opacity-60 text-xs",children:["Expires ",new Date(C.expiresAt).toLocaleDateString()]})]}),e.jsx("div",{className:"flex gap-2",children:C.expired?e.jsx("span",{className:"px-2 py-1 rounded bg-amber-600 text-xs",children:"Premium Expired"}):e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-600 text-xs",children:"Premium Active"})})]},C.email)),_.length===0&&e.jsx("div",{className:"opacity-60",children:"No premium winners."})]})]})]}),b.open&&e.jsxs("div",{className:"fixed inset-0 z-[1000]",onClick:()=>y({open:!1}),children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsx("div",{className:"absolute inset-0 p-4 md:p-8 overflow-auto flex items-start md:items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-3xl bg-[#0b1020] rounded-2xl border border-indigo-500/40 shadow-2xl",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20",children:[e.jsxs("div",{className:"font-semibold",children:["Preview: ",b.kind]}),e.jsx("button",{className:"btn",onClick:()=>y({open:!1}),children:"Close"})]}),e.jsx("div",{className:"p-0 bg-black/30",children:e.jsx("iframe",{title:"Email Preview",style:{width:"100%",height:"70vh",border:"0",background:"transparent"},srcDoc:b.html||""})}),e.jsx("div",{className:"px-4 py-3 border-t border-indigo-500/20 text-xs opacity-70",children:"Click outside this panel or press Esc to close."})]})})]})]}):e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Admin"}),e.jsx("div",{className:"text-sm opacity-80",children:"You don’t have permission to manage admins."})]})}function fm({user:t}){const{favoriteDouble:a,callerEnabled:s,callerVoice:i,callerVolume:n,speakCheckoutOnly:r,avgMode:l,autoStartOffline:o,rememberLastOffline:d,reducedMotion:c,compactHeader:f,allowSpectate:u,cameraScale:x,cameraAspect:p,autoscoreProvider:g,autoscoreWsUrl:S,calibrationGuide:M,preferredCameraId:I,preferredCameraLabel:N,cameraEnabled:E,offlineLayout:A,textSize:D,boxSize:k,setFavoriteDouble:b,setCallerEnabled:y,setCallerVoice:$,setCallerVolume:Y,setSpeakCheckoutOnly:O,setAvgMode:_,setAutoStartOffline:T,setRememberLastOffline:H,setReducedMotion:ae,setCompactHeader:P,setAllowSpectate:Z,setCameraScale:se,setCameraAspect:ze,setAutoscoreProvider:ye,setAutoscoreWsUrl:Me,setCalibrationGuide:lt,setPreferredCamera:Ke,setCameraEnabled:ge,setOfflineLayout:Re,setTextSize:ct,setBoxSize:Je}=ls(),[Ne,le]=m.useState([{key:"first180",label:"First 180",unlocked:!1,icon:"🎯",desc:"Score 180 in a match."},{key:"hundredGames",label:"100 Games Played",unlocked:!1,icon:"🏅",desc:"Play 100 games."},{key:"tournamentWin",label:"Tournament Winner",unlocked:!1,icon:"🥇",desc:"Win a tournament."},{key:"bestLeg",label:"Best Leg",unlocked:!1,icon:"⚡",desc:"Finish a leg in 12 darts or less."},{key:"comeback",label:"Comeback",unlocked:!1,icon:"🔥",desc:"Win after trailing by 3 legs."}]);m.useEffect(()=>{const F=t?.username||"";F&&le(xe=>xe.map(nt=>({...nt,unlocked:!!localStorage.getItem(`ndn:achieve:${nt.key}:${F}`)})))},[t?.username]);const[Be,we]=m.useState(!1),[ke,ce]=m.useState(""),[de,Ee]=m.useState(""),[jt,Ue]=m.useState(""),[re,ue]=m.useState(""),[fe,me]=m.useState(""),[qe,Le]=m.useState(!0),[et,yt]=m.useState(null),[ht,C]=m.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[ee,Ct]=m.useState("");m.useEffect(()=>{const F=t?.username||"";if(F)try{ce(localStorage.getItem(`ndn:bio:favPlayer:${F}`)||""),Ee(localStorage.getItem(`ndn:bio:favTeam:${F}`)||""),Ue(localStorage.getItem(`ndn:bio:favDarts:${F}`)||""),ue(localStorage.getItem(`ndn:bio:bio:${F}`)||""),me(localStorage.getItem(`ndn:bio:profilePhoto:${F}`)||""),Le(localStorage.getItem(`ndn:settings:allowAnalytics:${F}`)!=="false")}catch{}},[t?.username]),m.useEffect(()=>{t?.email&&kt(`/api/subscription?email=${encodeURIComponent(t.email)}`).then(F=>F.json()).then(yt).catch(()=>{})},[t?.email]);const Ye=()=>{const F=t?.username||"";if(F)try{localStorage.setItem(`ndn:bio:favPlayer:${F}`,ke),localStorage.setItem(`ndn:bio:favTeam:${F}`,de),localStorage.setItem(`ndn:bio:favDarts:${F}`,jt),localStorage.setItem(`ndn:bio:bio:${F}`,re),localStorage.setItem(`ndn:bio:profilePhoto:${F}`,fe);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:F,avatar:fe}}))}catch{}localStorage.setItem(`ndn:settings:allowAnalytics:${F}`,qe.toString()),we(!1)}catch{}},Ut=F=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:F}}))}catch(xe){console.error("Navigation failed:",xe)}},At=F=>{const xe=F.toLowerCase();return xe.includes("username")||xe.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:xe.includes("premium")||xe.includes("upgrade")||xe.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:xe.includes("calibrat")||xe.includes("camera")||xe.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:xe.includes("voice")||xe.includes("caller")||xe.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:xe.includes("friend")||xe.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:xe.includes("stat")||xe.includes("score")||xe.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:xe.includes("setting")||xe.includes("customiz")||xe.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:xe.includes("tournament")||xe.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:xe.includes("help")||xe.includes("support")||xe.includes("faq")?{text:"You're already in the help section! Check the Support section above for more resources.",links:[{text:"Scroll to Support",tab:"settings"}]}:xe.includes("how to play")||xe.includes("game")||xe.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},Et=()=>{if(!ee.trim())return;const F=ee.toLowerCase();C(nt=>[...nt,{text:ee,isUser:!0}]),Ct("");const xe=At(F);setTimeout(()=>{C(nt=>[...nt,{text:xe,isUser:!1}])},500)},[$e,Vt]=m.useState(""),[Nt,pt]=m.useState(!1),[wt,vt]=m.useState(""),[Ft,Qt]=m.useState([]);return m.useEffect(()=>{const F=()=>{const xe=speechSynthesis.getVoices();Qt(xe.filter(nt=>nt.lang.startsWith("en")))};F(),speechSynthesis.onvoiceschanged=F},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-black",children:[e.jsx(Ca,{className:"w-5 h-5"})," Account"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("ndn:logout")),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Logout"})}),e.jsxs("div",{className:"border-t border-red-500/20 pt-3",children:[e.jsxs("div",{className:"font-medium mb-2 text-black",children:["Change Username (",(()=>{const F=t?.usernameChangeCount||0;return F<2?`${2-F} free changes remaining`:"£2 per change"})(),")"]}),e.jsx("div",{className:"text-sm text-black mb-2",children:"You can change your username up to 2 times for free. Additional changes cost £2 each."}),t?.usernameChangeCount>=2&&!$e.trim()?e.jsx("div",{className:"text-amber-400 text-sm mb-2",children:"⚠️ Additional username changes cost £2"}):null,e.jsx("input",{className:"input w-full mb-2",type:"text",placeholder:"New username",value:$e,onChange:F=>Vt(F.target.value),disabled:Nt}),wt&&e.jsx("div",{className:"text-red-400 text-sm mb-2",children:wt}),e.jsx("button",{onClick:async()=>{if(vt(""),!$e.trim()){vt("Username required");return}if($e.length<3||$e.length>20){vt("Username must be 3-20 characters");return}(t?.usernameChangeCount||0)<2?(localStorage.setItem("pendingUsernameChange",$e.trim()),window.location.href="/?username-change=free"):window.location.href="https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02"},disabled:Nt||!$e.trim(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:Nt?"Processing...":(t?.usernameChangeCount||0)<2?"Change Username (FREE)":"Change Username (£2)"})]})]})]})}),et&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-black",children:[e.jsx(oi,{className:"w-5 h-5"})," Premium"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:["Status: ",et.fullAccess?"Active":"Inactive"]}),et.source&&e.jsxs("div",{className:"text-xs opacity-80",children:["Source: ",et.source]}),et.expiresAt&&e.jsxs("div",{className:"text-xs opacity-80",children:["Expires: ",new Date(et.expiresAt).toLocaleDateString()]}),et.renewalWarning&&e.jsxs("div",{className:"text-amber-600 text-xs mt-2 p-2 bg-amber-100 rounded",children:["⚠️ ",et.renewalWarning]})]}),et.source==="tournament"&&e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:async()=>{if(confirm("Are you sure you want to cancel your premium subscription? You will lose access to premium features."))try{await kt("/api/admin/premium/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,requesterEmail:t.email})});const F=await kt(`/api/subscription?email=${encodeURIComponent(t.email)}`);yt(await F.json())}catch{alert("Failed to cancel premium. Please try again.")}},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:"Cancel Premium"})})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Ca,{className:"w-5 h-5 text-brand-400"})," Profile Bio"]}),Be?e.jsxs("button",{onClick:Ye,className:"flex items-center gap-2 px-3 py-1 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400 text-sm transition-colors",children:[e.jsx($l,{className:"w-4 h-4"})," Save"]}):e.jsxs("button",{onClick:()=>we(!0),className:"flex items-center gap-2 px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400 text-sm transition-colors",children:[e.jsx(Ul,{className:"w-4 h-4"})," Edit"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Player:"}),Be?e.jsx("input",{className:"input w-full",type:"text",value:ke,onChange:F=>ce(F.target.value),placeholder:"e.g. Michael van Gerwen"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:ke||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Football Team:"}),Be?e.jsx("input",{className:"input w-full",type:"text",value:de,onChange:F=>Ee(F.target.value),placeholder:"e.g. Manchester United"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:de||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Favourite Darts:"}),Be?e.jsx("input",{className:"input w-full",type:"text",value:jt,onChange:F=>Ue(F.target.value),placeholder:"e.g. Unicorn Phase 5, 24g"}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[2.5rem] flex items-center",children:jt||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Short Bio / Quote:"}),Be?e.jsx("textarea",{className:"input w-full",value:re,onChange:F=>ue(F.target.value),placeholder:"Write something about yourself...",rows:3}):e.jsx("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg text-slate-300 min-h-[4rem] flex items-start",children:re||"No bio set"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10",children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Ca,{className:"w-5 h-5 text-cyan-400"})," Profile Photo"]}),e.jsxs("div",{children:[fe&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:fe,alt:"Profile",className:"w-16 h-16 rounded-full object-cover"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:F=>{const xe=F.target.files?.[0];if(xe){const nt=new FileReader;nt.onload=Tt=>{const U=Tt.target?.result;me(U);const V=t?.username||"";V&&localStorage.setItem(`ndn:bio:profilePhoto:${V}`,U);try{window.dispatchEvent(new CustomEvent("ndn:avatar-updated",{detail:{username:V,avatar:U}}))}catch{}},nt.readAsDataURL(xe)}},className:"hidden",id:"profile-photo-upload"}),e.jsx("label",{htmlFor:"profile-photo-upload",className:"btn bg-cyan-600 hover:bg-cyan-700 cursor-pointer",children:fe?"Change Photo":"Upload Photo"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-green-500/40 bg-green-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Fl,{className:"w-5 h-5 text-green-400"})," Game Preferences"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Favourite Double:"}),e.jsxs("select",{className:"input w-full",value:a,onChange:F=>b(F.target.value),children:[e.jsx("option",{value:"any",children:"Any Double"}),e.jsx("option",{value:"D20",children:"Double 20"}),e.jsx("option",{value:"D19",children:"Double 19"}),e.jsx("option",{value:"D18",children:"Double 18"}),e.jsx("option",{value:"D17",children:"Double 17"}),e.jsx("option",{value:"D16",children:"Double 16"}),e.jsx("option",{value:"D15",children:"Double 15"}),e.jsx("option",{value:"D14",children:"Double 14"}),e.jsx("option",{value:"D13",children:"Double 13"}),e.jsx("option",{value:"D12",children:"Double 12"}),e.jsx("option",{value:"D11",children:"Double 11"}),e.jsx("option",{value:"D10",children:"Double 10"}),e.jsx("option",{value:"D9",children:"Double 9"}),e.jsx("option",{value:"D8",children:"Double 8"}),e.jsx("option",{value:"D7",children:"Double 7"}),e.jsx("option",{value:"D6",children:"Double 6"}),e.jsx("option",{value:"D5",children:"Double 5"}),e.jsx("option",{value:"D4",children:"Double 4"}),e.jsx("option",{value:"D3",children:"Double 3"}),e.jsx("option",{value:"D2",children:"Double 2"}),e.jsx("option",{value:"D1",children:"Double 1"}),e.jsx("option",{value:"DB",children:"Bullseye"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Average Display Mode:"}),e.jsxs("select",{className:"input w-full",value:l,onChange:F=>_(F.target.value),children:[e.jsx("option",{value:"all-time",children:"All Time Average"}),e.jsx("option",{value:"24h",children:"24 Hour Average"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"autoStartOffline",checked:o,onChange:F=>T(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoStartOffline",className:"text-sm",children:"Auto-start offline games"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"rememberLastOffline",checked:d,onChange:F=>H(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"rememberLastOffline",className:"text-sm",children:"Remember last offline game settings"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Offline Game Layout:"}),e.jsxs("select",{className:"input w-full",value:A||"classic",onChange:F=>Re(F.target.value),children:[e.jsx("option",{value:"classic",children:"Classic Layout"}),e.jsx("option",{value:"modern",children:"Modern Layout"})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(_l,{className:"w-5 h-5 text-purple-400"})," Audio & Voice"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"callerEnabled",checked:s,onChange:F=>y(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"callerEnabled",className:"text-sm font-medium",children:"Enable Voice Caller"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Voice:"}),e.jsx("select",{className:"input w-full",value:i,onChange:F=>$(F.target.value),children:Ft.map(F=>e.jsxs("option",{value:F.name,children:[F.name," (",F.lang,")"]},F.name))}),e.jsx("button",{onClick:()=>{const F=new SpeechSynthesisUtterance("Test voice: 180 scored!");F.voice=Ft.find(xe=>xe.name===i)||null,F.volume=n,speechSynthesis.speak(F)},className:"btn bg-blue-600 hover:bg-blue-700 mt-2",children:"Test Voice"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Volume: ",Math.round(n*100),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:n,onChange:F=>Y(parseFloat(F.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"speakCheckoutOnly",checked:r,onChange:F=>O(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"speakCheckoutOnly",className:"text-sm",children:"Only announce checkouts"})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(mo,{className:"w-5 h-5 text-blue-400"})," Camera & Vision"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"cameraEnabled",checked:E,onChange:F=>ge(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"cameraEnabled",className:"text-sm",children:"Enable camera for scoring"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium",children:["Camera Scale: ",x.toFixed(2),"x"]}),e.jsx("input",{type:"range",min:"0.5",max:"1.25",step:"0.05",value:x,onChange:F=>se(parseFloat(F.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Camera Aspect Ratio:"}),e.jsxs("select",{className:"input w-full",value:p||"wide",onChange:F=>ze(F.target.value),children:[e.jsx("option",{value:"wide",children:"Wide (16:9)"}),e.jsx("option",{value:"square",children:"Square (1:1)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Text Size:"}),e.jsxs("select",{className:"input w-full",value:D,onChange:F=>ct(F.target.value),children:[e.jsx("option",{value:"small",children:"Small"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"large",children:"Large"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Box Size:"}),e.jsxs("select",{className:"input w-full",value:k,onChange:F=>Je(F.target.value),children:[e.jsx("option",{value:"small",children:"Small"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"large",children:"Large"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"calibrationGuide",checked:M,onChange:F=>lt(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"calibrationGuide",className:"text-sm",children:"Show calibration guide"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Autoscore Provider:"}),e.jsxs("select",{className:"input w-full",value:g||"built-in",onChange:F=>ye(F.target.value),children:[e.jsx("option",{value:"built-in",children:"Built-in Vision"}),e.jsx("option",{value:"manual",children:"Manual scoring only"}),e.jsx("option",{value:"external-ws",children:"External WebSocket"})]})]}),g==="manual"&&e.jsx("div",{className:"text-xs opacity-70",children:"Camera previews and autoscore overlays are hidden while manual scoring is selected. Use the score inputs or keyboard shortcuts to record each visit."}),g==="external-ws"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"External WebSocket URL:"}),e.jsx("input",{className:"input w-full",type:"url",value:S||"",onChange:F=>Me(F.target.value),placeholder:"ws://localhost:8080"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-orange-500/40 bg-orange-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(uo,{className:"w-5 h-5 text-orange-400"})," UI & Accessibility"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"reducedMotion",checked:c,onChange:F=>ae(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"reducedMotion",className:"text-sm",children:"Reduce motion/animations"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"compactHeader",checked:f,onChange:F=>P(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"compactHeader",className:"text-sm",children:"Compact header layout"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-pink-500/40 bg-pink-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Hl,{className:"w-5 h-5 text-pink-400"})," Online & Social"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowSpectate",checked:u,onChange:F=>Z(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowSpectate",className:"text-sm",children:"Allow others to spectate my games"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2 text-yellow-700",children:[e.jsx(On,{className:"w-5 h-5"})," Achievements & Badges"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Ne.map(F=>e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-xl border ${F.unlocked?"border-emerald-400 bg-emerald-500/10":"border-slate-400 bg-slate-700/10"}`,children:[e.jsx("div",{className:"text-3xl mb-2",children:F.icon}),e.jsx("div",{className:`font-bold mb-1 text-center ${F.unlocked?"text-emerald-400":"text-slate-400"}`,children:F.label}),e.jsx("div",{className:"text-xs text-slate-300 text-center mb-2",children:F.desc}),!F.unlocked&&e.jsx("div",{className:"text-xs text-amber-400 font-medium",children:"🔒 Locked"}),F.unlocked&&e.jsx("div",{className:"text-xs text-emerald-400 font-medium",children:"✅ Unlocked!"})]},F.key))})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-gray-500/40 bg-gray-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(On,{className:"w-5 h-5 text-gray-400"})," Data & Privacy"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"allowAnalytics",checked:qe,onChange:F=>Le(F.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"allowAnalytics",className:"text-sm",children:"Allow anonymous usage analytics"})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{const F={username:t?.username,email:t?.email,favPlayer:ke,favTeam:de,favDarts:jt,bio:re,profilePhoto:fe,settings:{favoriteDouble:a,avgMode:l,autoStartOffline:o,rememberLastOffline:d,reducedMotion:c,compactHeader:f,allowSpectate:u,cameraScale:x,cameraAspect:p,autoscoreProvider:g,autoscoreWsUrl:S,calibrationGuide:M,callerEnabled:s,callerVoice:i,callerVolume:n,speakCheckoutOnly:r,textSize:D}},xe=new Blob([JSON.stringify(F,null,2)],{type:"application/json"}),nt=URL.createObjectURL(xe),Tt=document.createElement("a");Tt.href=nt,Tt.download="ninedartnation-data.json",Tt.click(),URL.revokeObjectURL(nt)},className:"btn bg-blue-600 hover:bg-blue-700",children:"Export My Data"})}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete your account? This action cannot be undone.")&&alert("Account deletion not yet implemented. Please contact support.")},className:"btn bg-red-600 hover:bg-red-700",children:"Delete Account"})})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-red-500/40 bg-red-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(oi,{className:"w-5 h-5 text-red-400"})," Privacy & Copyright Notice"]}),e.jsx("div",{className:"space-y-3 text-sm text-slate-300",children:e.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-red-300 mb-2",children:"⚠️ IMPORTANT LEGAL NOTICE"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Copyright Protection:"})," All code, assets, and intellectual property in Nine Dart Nation are protected by copyright law. Unauthorized copying, modification, or distribution of this software is strictly prohibited."]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Legal Consequences:"})," Any attempt to edit, reverse-engineer, or redistribute this code will result in immediate legal action, including but not limited to copyright infringement lawsuits and potential criminal charges."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Privacy:"})," Your personal data and gameplay information are protected. Any unauthorized access or data collection violates privacy laws and will be prosecuted to the full extent of the law."]})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-teal-500/40 bg-teal-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(On,{className:"w-5 h-5 text-teal-400"})," Support & Help"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-300 mb-2",children:"Need help? Contact us:"}),e.jsx("a",{href:"mailto:support@ninedartnation.com",className:"btn bg-teal-600 hover:bg-teal-700",children:"Email Support"})]})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10",children:[e.jsxs("div",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ho,{className:"w-5 h-5 text-blue-400"})," Help Assistant"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-slate-800 rounded-lg p-4 max-h-96 overflow-y-auto space-y-3",children:ht.map((F,xe)=>e.jsx("div",{className:`flex ${F.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${F.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof F.text=="string"?F.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:F.text.text}),F.text.links&&e.jsx("div",{className:"space-y-1",children:F.text.links.map((nt,Tt)=>e.jsx("button",{onClick:()=>Ut(nt.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:nt.text},Tt))})]})})},xe))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:ee,onChange:F=>Ct(F.target.value),onKeyPress:F=>F.key==="Enter"&&Et(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:Et,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(fo,{className:"w-4 h-4"})})]})]})]})})]})}const xm={};function pm({onAuth:t}){const[a,s]=m.useState("signin"),[i,n]=m.useState(""),[r,l]=m.useState(""),[o,d]=m.useState(""),[c,f]=m.useState(""),[u,x]=m.useState(""),[p,g]=m.useState(!1),[S,M]=m.useState(!1),I="http://localhost:8787";async function N(k){if(k.preventDefault(),x(""),M(!0),!r||!o){x("Username and password required."),M(!1);return}try{const b=await fetch(`${I}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:o})}),y=await b.json();b.ok&&y?.user&&y?.token?(localStorage.setItem("authToken",y.token),t(y.user)):x(y?.error||"Invalid username or password.")}catch{x("Network error.")}finally{M(!1)}}async function E(k){if(k.preventDefault(),x(""),M(!0),!i||!r||!o){x("Email, username, and password required."),M(!1);return}try{const b=await fetch(`${I}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,username:r,password:o})}),y=await b.json();b.ok&&y?.user&&y?.token?(localStorage.setItem("authToken",y.token),t(y.user)):x(y?.error||"Signup failed.")}catch{x("Network error.")}finally{M(!1)}}async function A(k){if(k.preventDefault(),x(""),M(!0),!i||!i.includes("@")){x("Enter your email address."),M(!1);return}try{const y=await(await fetch(`${I}/api/auth/send-reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i})})).json();if(!y?.ok)throw new Error(y?.error||"Failed to send reset email");x("Password reset link sent to your email.")}catch(b){x(b?.message||"Failed to send reset email")}finally{M(!1)}}async function D(k){if(k.preventDefault(),x(""),M(!0),!i||!i.includes("@")){x("Enter your email address."),M(!1);return}try{const y=await(await fetch(`${I}/api/auth/send-username`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i})})).json();if(!y?.ok)throw new Error(y?.error||"Failed to send username email");x("Your username has been emailed to you.")}catch(b){x(b?.message||"Failed to send username email")}finally{M(!1)}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsxs("div",{className:"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsxs("form",{className:"card w-full space-y-4",onSubmit:a==="signin"?N:a==="signup"?E:A,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:[e.jsx("h1",{className:"logo text-center",children:"NINE-DART-NATION 🎯"}),e.jsx("span",{className:"badge",children:"Welcome"})]}),e.jsx("h2",{className:"text-2xl font-bold",children:a==="signin"?"Sign In":a==="signup"?"Create Account":"Reset Password"}),(a==="signup"||a==="reset")&&e.jsx("input",{className:"input w-full",type:"email",placeholder:"Email",value:i,onChange:k=>n(k.target.value),required:!0}),a!=="reset"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Username",value:r,onChange:k=>l(k.target.value),required:!0}),a!=="reset"&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input w-full pr-10",type:p?"text":"password",placeholder:"Password",value:o,onChange:k=>d(k.target.value),autoComplete:"current-password",required:!0,onFocus:()=>g(!1),onBlur:()=>g(!1)}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white",tabIndex:-1,onMouseDown:k=>{k.preventDefault(),g(!0)},onMouseUp:k=>{k.preventDefault(),g(!1)},onMouseLeave:()=>g(!1),onTouchStart:k=>{k.preventDefault(),g(!0)},onTouchEnd:k=>{k.preventDefault(),g(!1)},"aria-label":"Toggle password visibility",children:p?e.jsx(Wl,{className:"w-5 h-5"}):e.jsx(uo,{className:"w-5 h-5"})})]}),a==="signup"&&e.jsx("input",{className:"input w-full",type:"text",placeholder:"Password Reminder (optional)",value:c,onChange:k=>f(k.target.value)}),u&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:u}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:S,children:S?"Signing In...":a==="signin"?"Sign In":a==="signup"?"Sign Up":"Send Reset Link"}),a==="reset"&&e.jsx("button",{className:"btn w-full mt-2 bg-white/10 hover:bg-white/20",type:"button",onClick:D,disabled:S,children:"Email me my username"}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("button",{type:"button",className:"underline",onClick:()=>s(a==="signin"?"signup":"signin"),disabled:S,children:a==="signin"?"Need an account? Sign Up":"Already have an account? Sign In"}),e.jsx("button",{type:"button",className:"underline",onClick:()=>s("reset"),disabled:S,children:"Forgot password?"})]}),e.jsx("div",{className:"text-xs text-slate-200/80",children:"Tip: Use the admin demo credentials to explore admin features."})]}),e.jsxs("aside",{className:"card w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:"What’s inside"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(mr,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Online & Friends"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Challenge friends, chat, and join leagues."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(zl,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Deep Stats"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Track 3-dart averages, best legs, and more."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(sa,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Game Modes"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Start with 3 free online games upon signup. After that, PREMIUM is required to play all games."})]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(ql,{className:"w-5 h-5 text-indigo-300 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Premium Perks"}),e.jsx("div",{className:"text-sm text-slate-200/90",children:"Polished UI, upcoming features, and early access."})]})]})]}),e.jsxs("a",{href:xm?.VITE_DISCORD_INVITE_URL||"https://discord.gg/8GtbZ6RU",target:"_blank",rel:"noopener noreferrer",className:"btn mt-4 flex items-center justify-center gap-2",children:[e.jsx(jn,{className:"w-5 h-5"})," Join BullseyeDartsLeague"]})]})]})]})}const bm=m.createContext({theme:"default",setTheme:t=>{}}),oo="ndn_theme";function gm({children:t}){const[a,s]=m.useState("default");return m.useEffect(()=>{try{const i=localStorage.getItem(oo);i&&s(i)}catch{}},[]),m.useEffect(()=>{try{localStorage.setItem(oo,a)}catch{}},[a]),e.jsx(bm.Provider,{value:{theme:a,setTheme:s},children:e.jsx("div",{className:`theme-${a}`,children:t})})}const rl=m.createContext(null);function ym({children:t}){const[a,s]=m.useState(!1),[i,n]=m.useState("connecting"),r=m.useRef(null),l=m.useRef(new Set),o=m.useRef(!0),d=m.useRef(0),c=m.useRef(null),f=m.useRef(null),u=m.useRef(null),x=m.useRef(0),p=()=>{if(u.current)return u.current;const A="ws://localhost:8787";if(A.length>0){const $=A.endsWith("/ws")?A:A.replace(/\/$/,"")+"/ws";return u.current=[$],u.current}const D=window.location.protocol==="https:"?"wss":"ws",k=window.location.hostname,y=[`${D}://${window.location.host}`+"/ws",`${D}://${k}/ws`,`${D}://${k}:8787/ws`,`${D}://${k}:3000/ws`];return u.current=Array.from(new Set(y)),u.current},g=()=>{const A=p();return x.current=(x.current+1)%A.length,A[x.current]},S=()=>{const A=p();return A[x.current]||A[0]},M=m.useCallback(()=>{if(r.current&&(r.current.readyState===WebSocket.OPEN||r.current.readyState===WebSocket.CONNECTING))return;n("connecting");const D=`${S()}`,k=new WebSocket(D);r.current=k,k.onopen=()=>{s(!0),n("connected"),d.current=0,f.current&&clearInterval(f.current),f.current=setInterval(()=>{try{r.current?.readyState===WebSocket.OPEN&&r.current?.send(JSON.stringify({type:"ping",t:Date.now()}))}catch{}},2e4)},k.onmessage=b=>{try{const y=JSON.parse(b.data);l.current.forEach($=>{try{$(y)}catch{}})}catch{}},k.onerror=()=>{},k.onclose=()=>{if(s(!1),n("disconnected"),f.current&&(clearInterval(f.current),f.current=null),!o.current)return;const b=(d.current||0)+1;d.current=b,b%2===0&&g();const y=1e3*Math.pow(2,b-1),$=Math.floor(Math.random()*1e3);let Y=Math.min(3e4,y+$);b===1&&(Y=0),c.current&&clearTimeout(c.current),Y===0?M():c.current=setTimeout(M,Y)}},[]);m.useEffect(()=>{o.current=!0,M();const A=()=>{o.current=!1;try{r.current?.close()}catch{}};window.addEventListener("beforeunload",A);const D=()=>{document.visibilityState==="visible"&&(a||M())};return document.addEventListener("visibilitychange",D),window.addEventListener("online",M),()=>{o.current=!1,c.current&&clearTimeout(c.current),f.current&&clearInterval(f.current);try{r.current?.close()}catch{}document.removeEventListener("visibilitychange",D),window.removeEventListener("online",M),window.removeEventListener("beforeunload",A)}},[M]);const I=m.useCallback(A=>{try{r.current&&r.current.readyState===WebSocket.OPEN&&r.current.send(typeof A=="string"?A:JSON.stringify(A))}catch{}},[]),N=m.useCallback(A=>(l.current.add(A),()=>{l.current.delete(A)}),[]),E=m.useMemo(()=>({connected:a,status:i,send:I,addListener:N}),[a,i,I,N]);return e.jsx(rl.Provider,{value:E,children:t})}function Tr(){const t=m.useContext(rl);if(!t)throw new Error("useWS must be used within WSProvider");return t}function vm({status:t,title:a,size:s=12}){const i=s;return t==="connecting"?e.jsx("span",{role:"img","aria-label":"Connecting",title:a||"Connecting…",className:"inline-flex items-center justify-center",style:{width:i,height:i},children:e.jsxs("svg",{width:i,height:i,viewBox:"0 0 24 24",className:"animate-spin","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#A7F3D0",strokeWidth:"3",fill:"none",opacity:"0.35"}),e.jsx("path",{d:"M22 12a10 10 0 0 0-10-10",stroke:"#34D399",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]})}):t==="connected"?e.jsx("span",{role:"img","aria-label":"Connected",title:a||"Connected",className:"inline-flex items-center justify-center",style:{width:i,height:i},children:e.jsx("svg",{width:i,height:i,viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#34D399"})})}):e.jsx("span",{role:"img","aria-label":"Disconnected",title:a||"Not connected",className:"inline-flex items-center justify-center",style:{width:i,height:i},children:e.jsxs("svg",{width:i,height:i,viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#F87171",opacity:"0.15"}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"#F87171",strokeWidth:"2",fill:"none"}),e.jsx("rect",{x:"6",y:"11",width:"12",height:"2",rx:"1",fill:"#F87171"})]})})}const il="ndn:blocked:v1";function jm(){try{const t=localStorage.getItem(il);return t?JSON.parse(t):{}}catch{return{}}}function lo(t){try{localStorage.setItem(il,JSON.stringify(t))}catch{}}const Nm=on((t,a)=>({blocked:jm(),isBlocked:s=>!!a().blocked[(s||"").toLowerCase()],block:s=>t(i=>{const n={...i.blocked};return n[(s||"").toLowerCase()]=Date.now(),lo(n),{blocked:n}}),unblock:s=>t(i=>{const n={...i.blocked};return delete n[(s||"").toLowerCase()],lo(n),{blocked:n}}),all:()=>Object.keys(a().blocked)}));function wm({user:t}){const a="http://localhost:8787",s=wn(),i=(()=>{try{return Tr()}catch{return null}})(),n=Nm(),[r,l]=m.useState("room-1"),[o,d]=m.useState(!1),[c,f]=m.useState([]),[u,x]=m.useState(!1),[p,g]=m.useState(!1),S=m.useRef(null),[M,I]=m.useState(null),N=m.useRef(null),E=m.useRef(0),A=m.useRef(null),D=m.useRef(!0),k=m.useRef(0),b=m.useRef(!1),y=Bn(),$=jr(),{favoriteDouble:Y,callerEnabled:O,callerVoice:_,callerVolume:T,speakCheckoutOnly:H,allowSpectate:ae,cameraScale:P,setCameraScale:Z,cameraEnabled:se,textSize:ze,boxSize:ye,autoscoreProvider:Me}=ls(),lt=Me==="manual",ge=(h=>{switch(h){case"small":return"px-1.5 py-0.5 text-xs";case"large":return"px-3 py-1 text-sm";default:return"px-2 py-0.5 text-sm"}})(ze),[Re,ct]=m.useState(2),[Je,Ne]=m.useState(!1),[le,Be]=m.useState([]),[we,ke]=m.useState(0),[ce,de]=m.useState(0),[Ee,jt]=m.useState(0),[Ue,re]=m.useState(0),[ue,fe]=m.useState(""),[me,qe]=m.useState(0),[Le,et]=m.useState(0),[yt,ht]=m.useState(""),[C,ee]=m.useState(null),[Ct,Ye]=m.useState(null),Ut=m.useRef(null),[At,Et]=m.useState(""),[$e,Vt]=m.useState({}),[Nt,pt]=m.useState({}),[wt,vt]=m.useState({}),[Ft,Qt]=m.useState({}),[F,xe]=m.useState({}),[nt,Tt]=m.useState({}),[U,V]=m.useState({}),[ne,je]=m.useState({}),[Ie,at]=m.useState(()=>vr()),[Te,pe]=m.useState(0),[mt,_t]=m.useState(()=>{try{const h=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(h)}catch{return!1}}),[Fe,Us]=m.useState(null),As=m.useRef(null),$s=m.useRef(null);function Qs(){try{if(!$s.current){const h=window.AudioContext||window.webkitAudioContext;h&&($s.current=new h)}$s.current?.resume?.().catch(()=>{})}catch{}}function Es(h,j,w=0,R=.05){const Q=$s.current;if(!Q)return;const ie=Q.createOscillator(),oe=Q.createGain();ie.type="square",ie.frequency.value=h,oe.gain.value=R,ie.connect(oe),oe.connect(Q.destination);const W=Q.currentTime+w;ie.start(W),ie.stop(W+j/1e3)}function Zs(h){Qs(),$s.current&&(h==="180"?(Es(880,110,0,.06),Es(1175,110,.06,.06),Es(1568,140,.12,.06)):(Es(659,140,0,.07),Es(784,140,.08,.07),Es(987,200,.16,.07)))}function Gt(h,j){const w=Date.now(),R=As.current;R&&R.kind===h&&R.by===j&&w-R.ts<500||(As.current={kind:h,by:j,ts:w},Us({kind:h,by:j,turnIdx:y.currentPlayerIdx,ts:w}),Zs(h))}const[B,J]=m.useState(!1),[X,z]=m.useState([]),[G,Ae]=m.useState("bestof"),[he,_e]=m.useState(5),[He,dt]=m.useState(501),[Oe,It]=m.useState(null),[Pt,Lt]=m.useState("");function cs(h){Lt(h),setTimeout(()=>Lt(""),4e3);try{s(h||"Stripe checkout failed",{type:"error"})}catch{}}const[Ht,bs]=m.useState(null),[Ot,gs]=m.useState(null),[ot,Zt]=m.useState("X01"),[Se,ss]=m.useState("X01"),[Fs,ys]=m.useState(!1),Jt=t?.username&&!t?.fullAccess?bo(t.username):1/0,Rt=!t?.fullAccess&&Jt<=0,[qt,ft]=m.useState("all"),[vs,ds]=m.useState("all"),[Kt,Ts]=m.useState("all"),[Dt,dn]=m.useState(!1),[Is,es]=m.useState(10),{H:is}=Cr(),js=t?.username?Ys(t.username):0,ms=jr(h=>h.unread),Pe=(X||[]).filter(h=>!(qt!=="all"&&h.mode!==qt||vs!=="all"&&Number(h.startingScore)!==Number(vs)||Kt!=="all"&&h.game!==Kt||Dt&&(!js||!h.creatorAvg||Math.abs(Number(h.creatorAvg)-Number(js))>Is)));m.useEffect(()=>{const h=j=>{const w=j?.detail||{};w.game&&Zt(w.game),(w.mode==="bestof"||w.mode==="firstto")&&Ae(w.mode),typeof w.value=="number"&&isFinite(w.value)&&_e(Math.max(1,Math.floor(w.value))),typeof w.start=="number"&&isFinite(w.start)&&dt(Math.max(1,Math.floor(w.start))),J(!0)};return window.addEventListener("ndn:online-demo",h),()=>window.removeEventListener("ndn:online-demo",h)},[]),m.useEffect(()=>{const h=String(t?.email||"").toLowerCase();h&&kt(`/api/friends/messages?email=${encodeURIComponent(h)}`).then(j=>j.json()).then(j=>{j?.ok&&Array.isArray(j.messages)&&$.load(j.messages)}).catch(()=>{})},[t?.email]),m.useEffect(()=>{const h=j=>{try{const w=j?.detail||{},R=Number(w.start||501);y.newMatch([t?.username||"You","Opponent"],R,r),y.addVisit(60,3),y.nextPlayer(),y.addVisit(85,3),y.nextPlayer(),y.addVisit(100,3),ss("X01"),Ne(!0)}catch{}};return window.addEventListener("ndn:online-match-demo",h),()=>window.removeEventListener("ndn:online-match-demo",h)},[]),m.useEffect(()=>(D.current=!0,tt(),()=>{D.current=!1,A.current&&clearTimeout(A.current);try{N.current?.close()}catch{}}),[]),m.useEffect(()=>{$.setInGame(y.inProgress)},[y.inProgress]),m.useEffect(()=>{Fe&&y.currentPlayerIdx!==Fe.turnIdx&&Us(null)},[y.currentPlayerIdx,Fe?.turnIdx]),m.useEffect(()=>{try{i&&i.connected?i.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae}):N.current&&N.current.readyState===WebSocket.OPEN&&N.current.send(JSON.stringify({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae}))}catch{}},[ae,i?.connected]),m.useEffect(()=>{const h=j=>{const w=j?.detail?.roomId;w&&(l(w),i?i.send({type:"spectate",roomId:w}):N.current?.send(JSON.stringify({type:"spectate",roomId:w})),Ne(!0),J(!1))};return window.addEventListener("ndn:spectate-room",h),()=>window.removeEventListener("ndn:spectate-room",h)},[i]);function tt(){if(i){i.connected&&(i.send({type:"join",roomId:r}),i.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae}),i.send({type:"list-matches"}),d(!0));return}try{if(N.current&&(N.current.readyState===WebSocket.OPEN||N.current.readyState===WebSocket.CONNECTING))return}catch{}const h="ws://localhost:8787",j=window.location.protocol==="https:"?"wss":"ws",w=window.location.hostname,R=`${j}://${w}${window.location.port?"":":8787"}`,Q=h.length>0?h:R,ie=new WebSocket(Q);N.current=ie,ie.onopen=()=>{d(!0),E.current=0,b.current?s("Reconnected to lobby",{type:"success"}):(s("Connected to lobby",{type:"success"}),b.current=!0),ie.send(JSON.stringify({type:"join",roomId:r})),ie.send(JSON.stringify({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae})),ie.send(JSON.stringify({type:"list-matches"}))},ie.onmessage=oe=>{const W=JSON.parse(oe.data);if(W.type==="state"){y.importState(W.payload);const Qe=Number(W.payload._dpIndex),Wt=Number(W.payload._dpHits);Number.isFinite(Qe)&&jt(Math.max(0,Qe)),Number.isFinite(Wt)&&re(Math.max(0,Wt));const as=Number(W.payload._atcIndex),rs=Number(W.payload._atcHits);Number.isFinite(as)&&qe(Math.max(0,as)),Number.isFinite(rs)&&et(Math.max(0,rs));try{const We=W.payload._cricketById;We&&typeof We=="object"&&Vt(We)}catch{}try{const We=W.payload._shanghaiById;We&&typeof We=="object"&&pt(We)}catch{}try{const We=W.payload._halveById;We&&typeof We=="object"&&vt(We)}catch{}try{const We=W.payload._highlowById;We&&typeof We=="object"&&Qt(We)}catch{}try{const We=W.payload._killerById;We&&typeof We=="object"&&xe(We)}catch{}try{const We=W.payload._amCricketById;We&&typeof We=="object"&&Tt(We)}catch{}try{const We=W.payload._baseballById;We&&typeof We=="object"&&V(We)}catch{}try{const We=W.payload._golfById;We&&typeof We=="object"&&je(We)}catch{}try{const We=W.payload._tttState;We&&typeof We=="object"&&at(We)}catch{}try{const We=Number(W.payload._turnDarts);Number.isFinite(We)&&pe(Math.max(0,We))}catch{}}else if(W.type==="joined")W.id&&I(W.id);else if(W.type==="presence"||W.type==="peer-joined")Be(Qe=>{const Wt=new Set(Qe);return W.id&&Wt.add(W.id),Array.from(Wt)});else if(W.type==="chat"){const Qe=!!(W.from&&M&&W.from===M),Wt=Qe?t?.username||"me":W.from||"peer",as=String(W.from||"");if(!Qe&&as&&n.isBlocked(as))return;if(Qe&&S.current&&String(W.message||"")===S.current.text){S.current=null;return}f(rs=>[...rs,{from:Wt,message:W.message,fromId:as||void 0}])}else if(W.type==="matches")z(Array.isArray(W.matches)?W.matches:[]);else if(W.type==="invite")It({matchId:W.matchId,fromId:W.fromId,fromName:W.fromName,calibrated:!!W.calibrated,boardPreview:W.boardPreview||null,game:W.game,mode:W.mode,value:W.value,startingScore:W.startingScore});else if(W.type==="match-start")l(W.roomId),ie.send(JSON.stringify({type:"join",roomId:W.roomId})),Ne(!0),J(!1),W.match?.game&&ss(W.match.game),t?.username&&!t?.fullAccess&&mi(t.username);else if(W.type==="declined")s("Invite declined",{type:"info"});else if(W.type==="error"){const Qe=typeof W.message=="string"?W.message:"Action not allowed";if(Lt(Qe),W.code==="SPECTATE_NOT_ALLOWED")try{s("This player has spectating turned off.",{type:"error"})}catch{}W.code==="NOT_FOUND"&&Ht&&gs({game:Ht.game,mode:Ht.mode,value:Ht.value,startingScore:Ht.startingScore}),setTimeout(()=>Lt(""),3500)}else if(W.type==="friend-invite")confirm(`${W.fromName||W.fromEmail} invited you to play ${W.game||"X01"} (${W.mode==="firstto"?"First To":"Best Of"} ${W.value||1}). Accept?`)?ie.send(JSON.stringify({type:"start-friend-match",toEmail:W.fromEmail,game:W.game,mode:W.mode,value:W.value,startingScore:W.startingScore})):s("Invite declined",{type:"info"});else if(W.type==="friend-message")$.add({id:W.id||`${W.ts}-${W.from}`,from:W.from,message:W.message,ts:W.ts||Date.now()}),y.inProgress||s(`${W.from}: ${W.message}`,{type:"info"});else if(W.type==="celebration"){const Qe=W.by||"Player",Wt=W.kind==="leg"?"leg":"180";Gt(Wt,Qe)}else if(W.type==="cam-code")console.log("Received cam-code:",W.code),ee(W.code),s(`Pairing code: ${W.code}`,{type:"info"});else if(W.type==="cam-peer-joined")console.log("Mobile peer joined for code:",W.code),Tn(W.code);else if(W.type==="cam-answer"){console.log("Received cam-answer");const Qe=window.mobilePC;Qe&&Qe.setRemoteDescription(new RTCSessionDescription(W.payload))}else if(W.type==="cam-ice"){console.log("Received cam-ice");const Qe=window.mobilePC;Qe&&Qe.addIceCandidate(W.payload)}},ie.onclose=()=>{if(d(!1),!D.current)return;const oe=(E.current||0)+1;E.current=oe;const W=Math.min(3e4,1e3*Math.pow(2,oe-1)),Qe=Date.now();Qe-k.current>4e3&&(s(`Disconnected. Reconnecting in ${Math.round(W/1e3)}s...`,{type:"error"}),k.current=Qe),A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{tt()},W)}}function rt(){const h=y.players||[],j=y.currentPlayerIdx||0,w=h[j],R=w?.legs?.[w?.legs?.length-1],Q=R?R.totalScoreRemaining:y.startingScore,ie=R?.dartsThrown||0,oe=R?R.totalScoreStart-R.totalScoreRemaining:0,W=ie>0?oe/ie*3:0,Qe=R?.visits?.[R.visits.length-1]?.score??0;let Wt="ÔÇö";h.length===2?Wt=`${h[0]?.legsWon||0}-${h[1]?.legsWon||0}`:h.length>2&&(Wt=h.map(ks=>`${ks.name}:${ks.legsWon||0}`).join(" = "));const as=y.bestLegThisMatch,rs=as?`${as.darts} darts${(()=>{const ks=h.find(Mn=>Mn.id===as.playerId);return ks?` (${ks.name})`:""})()}`:"-",In=(ks=>{switch(ks){case"small":return"text-xs";case"large":return"text-base";default:return"text-sm"}})(ze),Dn=(ks=>{switch(ks){case"small":return"p-2";case"large":return"p-4";default:return"p-3"}})(ye);return e.jsxs("div",{className:`${Dn} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${In}`,children:[e.jsx("div",{className:"font-semibold mb-2",children:"Match Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"opacity-80",children:"Current score"}),e.jsx("div",{className:"font-mono text-right",children:Wt}),e.jsx("div",{className:"opacity-80",children:"Current thrower"}),e.jsx("div",{className:"text-right font-semibold",children:w?.name||"ÔÇö"}),e.jsx("div",{className:"opacity-80",children:"Score remaining"}),e.jsx("div",{className:"text-right font-mono font-bold text-lg",children:Q}),e.jsx("div",{className:"opacity-80",children:"3-dart avg"}),e.jsx("div",{className:"text-right font-mono",children:W.toFixed(1)}),e.jsx("div",{className:"opacity-80",children:"Last score"}),e.jsx("div",{className:"text-right font-mono",children:Qe}),e.jsx("div",{className:"opacity-80",children:"Best leg"}),e.jsx("div",{className:"text-right",children:rs})]})]})}m.useEffect(()=>{if(!i)return;d(i.connected);const h=i.addListener(j=>{try{if(j.type==="state"){y.importState(j.payload);try{const w=Number(j.payload._dpIndex),R=Number(j.payload._dpHits);Number.isFinite(w)&&jt(Math.max(0,w)),Number.isFinite(R)&&re(Math.max(0,R))}catch{}try{const w=Number(j.payload._atcIndex),R=Number(j.payload._atcHits);Number.isFinite(w)&&qe(Math.max(0,w)),Number.isFinite(R)&&et(Math.max(0,R))}catch{}try{const w=j.payload._cricketById;w&&typeof w=="object"&&Vt(w)}catch{}try{const w=j.payload._shanghaiById;w&&typeof w=="object"&&pt(w)}catch{}try{const w=j.payload._halveById;w&&typeof w=="object"&&vt(w)}catch{}try{const w=j.payload._highlowById;w&&typeof w=="object"&&Qt(w)}catch{}try{const w=j.payload._killerById;w&&typeof w=="object"&&xe(w)}catch{}try{const w=j.payload._amCricketById;w&&typeof w=="object"&&Tt(w)}catch{}try{const w=j.payload._baseballById;w&&typeof w=="object"&&V(w)}catch{}try{const w=j.payload._golfById;w&&typeof w=="object"&&je(w)}catch{}try{const w=j.payload._tttState;w&&typeof w=="object"&&at(w)}catch{}try{const w=Number(j.payload._turnDarts);Number.isFinite(w)&&pe(Math.max(0,w))}catch{}}else if(j.type==="joined")j.id&&I(j.id);else if(j.type==="presence"||j.type==="peer-joined")Be(w=>Array.from(new Set([...w||[],j.id].filter(Boolean))));else if(j.type==="chat"){const w=!!(j.from&&M&&j.from===M),R=w?t?.username||"me":j.from||"peer",Q=String(j.from||"");if(!w&&Q&&n.isBlocked(Q))return;f(ie=>[...ie,{from:R,message:j.message,fromId:Q||void 0}])}else if(j.type==="matches")z(Array.isArray(j.matches)?j.matches:[]);else if(j.type==="invite")It({matchId:j.matchId,fromId:j.fromId,fromName:j.fromName,calibrated:!!j.calibrated,boardPreview:j.boardPreview||null,game:j.game,mode:j.mode,value:j.value,startingScore:j.startingScore});else if(j.type==="match-start")l(j.roomId),i.send({type:"join",roomId:j.roomId}),Ne(!0),J(!1),j.match?.game&&ss(j.match.game),t?.username&&!t?.fullAccess&&mi(t.username);else if(j.type==="declined")s("Invite declined",{type:"info"});else if(j.type==="error"){const w=typeof j.message=="string"?j.message:"Action not allowed";if(Lt(w),j.code==="SPECTATE_NOT_ALLOWED")try{s("This player has spectating turned off.",{type:"error"})}catch{}j.code==="NOT_FOUND"&&Ht&&gs({game:Ht.game,mode:Ht.mode,value:Ht.value,startingScore:Ht.startingScore}),setTimeout(()=>Lt(""),3500)}else if(j.type==="friend-invite")confirm(`${j.fromName||j.fromEmail} invited you to play ${j.game||"X01"} (${j.mode==="firstto"?"First To":"Best Of"} ${j.value||1}). Accept?`)?i.send({type:"start-friend-match",toEmail:j.fromEmail,game:j.game,mode:j.mode,value:j.value,startingScore:j.startingScore}):s("Invite declined",{type:"info"});else if(j.type==="friend-message")$.add({id:j.id||`${j.ts}-${j.from}`,from:j.from,message:j.message,ts:j.ts||Date.now()}),y.inProgress||s(`${j.from}: ${j.message}`,{type:"info"});else if(j.type==="celebration"){const w=j.by||"Player",R=j.kind==="leg"?"leg":"180";Gt(R,w)}}catch{}});return i.connected&&(i.send({type:"join",roomId:r}),i.send({type:"presence",username:t?.username||"guest",email:(t?.email||"").toLowerCase(),allowSpectate:ae}),i.send({type:"list-matches"})),()=>{h()}},[i?.connected]);function be(){if(i){i.send({type:"state",payload:{...y,_turnIdx:we,_participants:le,_dpIndex:Ee,_dpHits:Ue,_atcIndex:me,_atcHits:Le,_cricketById:$e,_shanghaiById:Nt,_halveById:wt,_highlowById:Ft,_killerById:F,_amCricketById:nt,_baseballById:U,_golfById:ne,_tttState:Ie,_turnDarts:Te}});return}const h=N.current;!h||h.readyState!==WebSocket.OPEN||h.send(JSON.stringify({type:"state",payload:{...y,_turnIdx:we,_participants:le,_dpIndex:Ee,_dpHits:Ue,_atcIndex:me,_atcHits:Le,_cricketById:$e,_shanghaiById:Nt,_halveById:wt,_highlowById:Ft,_killerById:F,_amCricketById:nt,_baseballById:U,_golfById:ne,_tttState:Ie,_turnDarts:Te}}))}function bt(h){const j=t?.username||"me";if(f(R=>[...R,{from:j,message:h,fromId:M||"self"}]),S.current={text:h,ts:Date.now()},i){i.send({type:"chat",message:h});return}const w=N.current;!w||w.readyState!==WebSocket.OPEN||w.send(JSON.stringify({type:"chat",message:h}))}function gt(h){if(br(h,Ee)){const w=Ue+1,R=Ee+1;re(w),jt(R);try{if(w>=xs.length){const Q=y.players[y.currentPlayerIdx]?.name||"Player";Gt("leg",Q),re(0),jt(0)}}catch{}}be()}function ut(){const h=Math.max(0,Math.floor(ce|0));gt(h),de(0)}function Mt(){const h=Vs(ue);h!=null&&(gt(h),fe(""))}function Yt(h,j,w){const R=Bt[me];return R==null?!1:typeof w=="number"&&w>=1&&w<=20&&w===R&&(j==="SINGLE"||j==="DOUBLE"||j==="TRIPLE")?!0:R===25?j==="BULL"||h===25:R===50?j==="INNER_BULL"||h===50:h===R||h===R*2||h===R*3}function us(h,j,w){if(Yt(h,j,w)){const R=Le+1,Q=me+1;et(R),qe(Q);try{if(R>=Bt.length){const ie=y.players[y.currentPlayerIdx]?.name||"Player";Gt("leg",ie),et(0),qe(0)}}catch{}}be()}function Ps(){const h=Math.max(0,Math.floor(ce|0));us(h),de(0)}function mn(){const h=Vs(yt);h!=null&&(us(h),ht(""))}function it(){return y.players[y.currentPlayerIdx]?.id??String(y.currentPlayerIdx)}function Rs(h){$e[h]||Vt(j=>({...j,[h]:rn()}))}function en(h){Nt[h]||pt(j=>({...j,[h]:Gs()}))}function Ns(h){wt[h]||vt(j=>({...j,[h]:Js()}))}function _s(h){Ft[h]||Qt(j=>({...j,[h]:Ks()}))}function Hs(h){if(!F[h]){const j=new Set(Object.values(F||{}).map(Q=>Q.number)),w=[];for(let Q=1;Q<=20;Q++)j.has(Q)||w.push(Q);const R=w.length>0?w[Math.floor(Math.random()*w.length)]:20;xe(Q=>({...Q,[h]:Ko(R,3)}))}}function ws(h){nt[h]||Tt(j=>({...j,[h]:_n()}))}function un(h){U[h]||V(j=>({...j,[h]:Un()}))}function tn(h){ne[h]||je(j=>({...j,[h]:$n()}))}m.useEffect(()=>{pe(0)},[y.currentPlayerIdx,Se]);function Sn(h,j){const w=y.players.filter(R=>R.id!==j);return w.length===0?!1:w.every(R=>($e[R.id]?.marks?.[h]||0)>=3)}function ns(h,j,w){const R=it();Rs(R),Vt(ie=>{const oe={...ie},W={...oe[R]||rn()};return Ho(W,h,j,w,Qe=>Sn(Qe,R)),oe[R]=W,oe});const Q=Te+1;pe(Q),Q>=3&&(pe(0),y.nextPlayer()),be()}function hs(h,j,w){const R=it();en(R),pt(ie=>{const oe={...ie},W={...oe[R]||Gs()};return Wo(W,h,j,w),oe[R]=W,oe});const Q=Te+1;pe(Q),Q>=3&&(pt(ie=>{const oe={...ie},W={...oe[R]||Gs()};return zo(W),oe[R]=W,oe}),pe(0),y.nextPlayer()),be()}function Ls(h,j,w){const R=it();Ns(R),vt(ie=>{const oe={...ie},W={...oe[R]||Js()};return qo(W,h,j,w),oe[R]=W,oe});const Q=Te+1;pe(Q),Q>=3&&(vt(ie=>{const oe={...ie},W={...oe[R]||Js()};return Vo(W),oe[R]=W,oe}),pe(0),y.nextPlayer()),be()}function Ss(h,j,w){const R=it();_s(R),Qt(ie=>{const oe={...ie},W={...oe[R]||Ks()};return Go(W,h,j,w),oe[R]=W,oe});const Q=Te+1;pe(Q),Q>=3&&(Qt(ie=>{const oe={...ie},W={...oe[R]||Ks()};return Jo(W),oe[R]=W,oe}),pe(0),y.nextPlayer()),be()}function Os(h,j){const w=it();y.players.forEach(Q=>Hs(Q.id)),xe(Q=>{const ie={};for(const[W,Qe]of Object.entries(Q))ie[W]={...Qe};gr(w,ie,h,j);const oe=yr(ie);if(oe)try{Gt("leg",y.players.find(W=>W.id===oe)?.name||"Player")}catch{}return ie});const R=Te+1;pe(R),R>=3&&(pe(0),y.nextPlayer()),be()}function kn(h,j,w){const R=it();ws(R),Tt(ie=>{const oe={...ie},Qe={...oe[R]||_n()};return el(Qe,h,j,w,as=>y.players.filter(rs=>rs.id!==R).every(rs=>(nt[rs.id]?.marks?.[as]||0)>=3)),oe[R]=Qe,oe});const Q=Te+1;pe(Q),Q>=3&&(pe(0),y.nextPlayer()),be()}function hn(h,j,w){const R=it();un(R),V(ie=>{const oe={...ie},W={...oe[R]||Un()};return Yo(W,h,j,w),oe[R]=W,oe});const Q=Te+1;pe(Q),Q>=3&&(pe(0),y.nextPlayer()),be()}function Cn(h,j,w){const R=it();tn(R),je(ie=>{const oe={...ie},W={...oe[R]||$n()};return Qo(W,h,j,w),oe[R]=W,oe});const Q=Te+1;pe(Q),Q>=3&&(pe(0),y.nextPlayer()),be()}function sn(h,j,w,R){at(ie=>{const oe={...ie,board:[...ie.board]};return Zo(oe,h,j,w,R),oe});const Q=Te+1;pe(Q),Q>=3&&(pe(0),y.nextPlayer()),be()}function En(){try{window.dispatchEvent(new Event("ndn:open-manual"))}catch{}}function Ws(h){const j=Math.max(0,h|0);y.addVisit(j,3),de(0);const w=y.players[y.currentPlayerIdx],R=w.legs[w.legs.length-1];try{j===180&&Gt("180",w?.name||"Player"),R&&R.totalScoreRemaining===0&&Gt("leg",w?.name||"Player")}catch{}if(R&&R.totalScoreRemaining===0?y.endLeg(j):y.nextPlayer(),O){const Q=R?R.totalScoreRemaining:y.startingScore;ra(t?.username||"Player",j,Math.max(0,Q),_,{volume:T,checkoutOnly:H})}t?.username&&w?.name===t.username&&an(t.username,3,j),be()}function qn(h,j){const w={type:"report",offenderId:h,reason:"Inappropriate language",message:j};try{i?i.send(w):N.current?.send(JSON.stringify(w))}catch{}try{s("Report submitted",{type:"info"})}catch{}}async function fn(){try{const h=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),j=h.getVideoTracks?.()[0],w=document.createElement("video");w.srcObject=h,await w.play().catch(()=>{}),await new Promise(Qe=>setTimeout(Qe,120));const R=Math.min(320,w.videoWidth||320),Q=Math.max(1,Math.floor((w.videoHeight||180)*(R/Math.max(1,w.videoWidth||320)))),ie=document.createElement("canvas");ie.width=R,ie.height=Q,ie.getContext("2d").drawImage(w,0,0,R,Q);const W=ie.toDataURL("image/jpeg",.7);try{j&&j.stop()}catch{}try{h.getTracks?.().forEach(Qe=>Qe.stop())}catch{}return W}catch{return null}}const Tn=async h=>{console.log("Starting WebRTC for code:",h);try{const j=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});j.ontrack=R=>{console.log("Received track:",R.streams[0]),Ye(R.streams[0]),Ut.current&&(Ut.current.srcObject=R.streams[0],console.log("Set video srcObject"))},j.onicecandidate=R=>{R.candidate&&(console.log("Sending ICE candidate"),i?i.send({type:"cam-ice",code:h,payload:R.candidate}):N.current&&N.current.readyState===WebSocket.OPEN&&N.current.send(JSON.stringify({type:"cam-ice",code:h,payload:R.candidate})))},j.onconnectionstatechange=()=>console.log("Connection state:",j.connectionState);const w=await j.createOffer();if(await j.setLocalDescription(w),console.log("Sending offer"),i)console.log("Sending offer via wsGlobal"),i.send({type:"cam-offer",code:h,payload:w});else if(N.current&&N.current.readyState===WebSocket.OPEN)console.log("Sending offer via wsRef"),N.current.send(JSON.stringify({type:"cam-offer",code:h,payload:w}));else{console.log("WS not available, POSTing offer to /cam/signal");try{await kt(`/cam/signal/${h}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"cam-offer",payload:w,source:"desktop"})})}catch(R){console.warn("REST offer failed",R)}}window.mobilePC=j}catch(j){console.error("WebRTC error:",j),s("Failed to start mobile camera",{type:"error"})}};return e.jsxs("div",{className:"card flex flex-col min-h-[85vh] relative overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Online Play"}),ms>0&&!y.inProgress&&e.jsxs("div",{className:"mb-3 text-sm px-3 py-2 rounded bg-amber-600/30 border border-amber-500/40",children:["You have ",ms," unread message",ms>1?"s":"",". Check the Friends tab."]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs opacity-70 shrink-0",children:"Room"}),e.jsx("input",{className:"input w-28",value:r,onChange:h=>l(h.target.value),placeholder:"room-1"})]}),o?e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0",children:"Connected"}):e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 shrink-0",onClick:tt,children:"Connect"}),e.jsx("button",{className:"btn shrink-0",onClick:be,disabled:!o,children:"Sync"}),e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40 shrink-0",title:"Open a simulated online match demo",onClick:()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch{}},children:"DEMO"}),o&&e.jsx("button",{className:"btn shrink-0",onClick:()=>Ne(!0),disabled:Rt,title:Rt?"Weekly free games used":"",children:"Open Match"})]})}),e.jsx("div",{className:`mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end ${!o||Rt?"opacity-60 cursor-not-allowed":"cursor-pointer"}`,role:"button",title:o?Rt?"Weekly free games used":"Create a new match":"Connect to the lobby first",onClick:()=>{!o||Rt||(J(!0),i?i.send({type:"list-matches"}):N.current?.send(JSON.stringify({type:"list-matches"})))},children:e.jsx("button",{className:"btn",disabled:!o||Rt,children:"Create Match +"})}),e.jsx("p",{className:"text-sm text-slate-600 mt-3",children:"Open this app on another device and join the same Room ID to sync scores."}),!t?.fullAccess&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Weekly free online games remaining: ",Jt===1/0?"ÔÇö":Jt]}),!t?.fullAccess&&Jt!==1/0&&Jt<=0&&e.jsx("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm",children:"You've used your 3 free online games this week. PREMIUM required to continue."}),Pt&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"material-icons text-rose-300",children:"error_outline"}),Pt]}),Ot&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-700/30 border border-indigo-600/40 text-indigo-100 text-sm flex items-center justify-between gap-2",children:[e.jsx("div",{children:"That room is full or no longer available. Create a new clean room with the same settings?"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{const{game:h,mode:j,value:w,startingScore:R}=Ot,Q=t?.username?Ys(t.username):0;i?(i.send({type:"create-match",game:h,mode:j,value:w,startingScore:R||501,creatorAvg:Q}),i.send({type:"list-matches"})):(N.current?.send(JSON.stringify({type:"create-match",game:h,mode:j,value:w,startingScore:R||501,creatorAvg:Q})),N.current?.send(JSON.stringify({type:"list-matches"}))),gs(null)},children:"Create New Match"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm",onClick:()=>gs(null),children:"Dismiss"})]})]}),o&&e.jsxs("div",{className:"mt-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10 flex-1 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"World Lobby"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs opacity-80",children:["Matches: ",Pe.length]}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>i?i.send({type:"list-matches"}):N.current?.send(JSON.stringify({type:"list-matches"})),children:"Refresh"}),e.jsx("button",{className:"btn px-3 py-1 text-sm",title:o?Rt?"Weekly free games used":"Create a new match":"Connect to the lobby first",disabled:!o||Rt,onClick:()=>{!o||Rt||(J(!0),i?i.send({type:"list-matches"}):N.current?.send(JSON.stringify({type:"list-matches"})))},children:"Create Match +"})]})]}),e.jsxs("div",{className:"space-y-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Mode"}),e.jsx(fa,{tabs:[{key:"all",label:"All"},{key:"bestof",label:"Best of"},{key:"firstto",label:"First to"}],active:qt,onChange:h=>ft(h)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Game"}),e.jsxs("select",{className:"input w-full",value:Kt,onChange:h=>Ts(h.target.value),children:[e.jsx("option",{value:"all",children:"All"}),Nn.map(h=>e.jsx("option",{value:h,children:h},h))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Starting Score"}),e.jsxs("select",{className:"input w-full",value:vs,onChange:h=>{const j=h.target.value;ds(j==="all"?"all":Number(j))},disabled:Kt!=="all"&&Kt!=="X01",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"301",children:"301"}),e.jsx("option",{value:"501",children:"501"}),e.jsx("option",{value:"701",children:"701"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Opponent near my avg"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"nearavg",type:"checkbox",className:"accent-purple-500",checked:Dt,onChange:h=>dn(h.target.checked),disabled:!js}),e.jsx("label",{htmlFor:"nearavg",className:"cursor-pointer text-sm",children:"Near my average"}),e.jsx("input",{className:"input w-24",type:"number",min:5,max:40,step:1,value:Is,onChange:h=>es(parseInt(h.target.value||"10")),disabled:!Dt})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 max-w-sm",children:[e.jsx("label",{className:`block text-xs opacity-70 mb-1 ${Dt?"":"opacity-40"}`,children:"Avg tolerance (±)"}),e.jsx("input",{className:"w-full",type:"range",min:1,max:50,value:Is,onChange:h=>es(parseInt(h.target.value||"10")),disabled:!Dt}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["± ",Is]})]}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>{ft("all"),Ts("all"),ds("all"),dn(!1),es(10)},children:"Reset"})]})]}),Pe.length===0?e.jsx("div",{className:"text-sm text-slate-300",children:"No games waiting. Create one!"}):e.jsx("div",{className:"space-y-2",children:Pe.map(h=>e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 flex items-center justify-between relative",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[h.game||"X01"," ",h.game==="X01"?` ${h.startingScore}`:""," - ",h.mode==="bestof"?`Best Of ${h.value}`:`First To ${h.value}`," - Created by ",h.creatorName]}),h.requireCalibration&&e.jsx("div",{className:"text-[11px] inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-600/30 mt-1",children:"Calibration required"}),h.creatorAvg?e.jsxs("div",{className:"text-xs opacity-70",children:["Creator avg: ",Number(h.creatorAvg).toFixed(1)]}):null,e.jsxs("div",{className:"text-xs opacity-70",children:["ID: ",h.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn px-3 py-1 text-sm bg-green-600 hover:bg-green-700",disabled:Rt||!t?.fullAccess&&qs.includes(h.game)||!!h.requireCalibration&&!is,title:!t?.fullAccess&&qs.includes(h.game)?"PREMIUM game":Rt?"Weekly free games used":h.requireCalibration&&!is?"Calibration required":"",onClick:async()=>{bs({game:h.game,mode:h.mode,value:h.value,startingScore:h.startingScore});const j=!!is,w=await fn();try{i?i.send({type:"join-match",matchId:h.id,calibrated:j,boardPreview:w}):N.current?.send(JSON.stringify({type:"join-match",matchId:h.id,calibrated:j,boardPreview:w}))}catch(R){cs(R?.message||"Failed to create Stripe checkout session. Please try again later.")}},children:"Join Now!"}),M&&h.creatorId===M&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Close this match",onClick:()=>{i?i.send({type:"cancel-match",matchId:h.id}):N.current?.send(JSON.stringify({type:"cancel-match",matchId:h.id}))},"aria-label":"Close match",children:"×"})]})]},h.id))})]}),!t?.fullAccess&&Jt!==1/0&&Jt<=0&&e.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-slate-900/40"}),e.jsxs("div",{className:"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"­ƒöÆ"}),e.jsx("div",{className:"font-semibold",children:"Online play locked"}),e.jsx("div",{className:"text-sm text-slate-200/80",children:"YouÔÇÖve used your 3 free online games this week. Upgrade to PREMIUM to play all modes."}),e.jsxs("button",{onClick:async()=>{try{const j=await(await fetch(`${a}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t?.email})})).json();j.ok&&j.url?window.location.href=j.url:alert("Failed to create payment session: "+(j.error||"Unknown error"))}catch{alert("Network error")}},className:"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold",children:["Upgrade to PREMIUM = ",No(wo(),5)]})]})]}),Je&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[e.jsxs("div",{className:"p-2 md:p-3 flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:"Online Match"})}),e.jsx("button",{className:"btn px-3 py-1",onClick:()=>Ne(!1),children:"Close"})]}),e.jsx("div",{className:"relative flex-1 overflow-hidden p-2 md:p-3",children:e.jsxs("div",{className:"card w-full h-full overflow-hidden relative p-2.5 md:p-3",children:[Fe&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-start justify-center pt-8 z-20",children:[e.jsxs("div",{className:`px-4 py-2 rounded-full text-lg font-bold shadow ${Fe.kind==="leg"?"bg-indigo-500/20 border border-indigo-400/40 text-indigo-100":"bg-emerald-500/20 border border-emerald-400/40 text-emerald-100"}`,children:[Fe.kind==="leg"?"­ƒÅü LEG WON ÔÇö ":"­ƒÄ» ONE HUNDRED AND EIGHTY! ÔÇö ",Fe.by]}),Fe.kind==="leg"&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:"@keyframes ndn-confetti-fall{0%{transform:translateY(-10%) rotate(0deg);opacity:1}100%{transform:translateY(120%) rotate(360deg);opacity:0}}"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(24)].map((h,j)=>{const w=Math.random()*100,R=Math.random()*.2,Q=1.2+Math.random()*.8,ie=6+Math.random()*6,oe=Math.floor(Math.random()*360);return e.jsx("span",{style:{position:"absolute",top:0,left:w+"%",width:ie,height:ie,background:`hsl(${oe} 90% 60%)`,borderRadius:2,animation:`ndn-confetti-fall ${Q}s ease-out ${R}s forwards`}},j)})})]})]}),e.jsxs("div",{className:"mb-1.5 text-xs md:text-sm flex items-center justify-between gap-2",children:[e.jsxs("span",{children:["Participants: ",le.length||1]}),e.jsx("button",{className:"text-[11px] px-2 py-0.5 rounded-full bg-slate-700/50 hover:bg-slate-700 border border-slate-600",onClick:()=>_t(h=>!h),title:mt?"Switch to full multi-player view":"Switch to compact player-by-player view",children:mt?"Full view":"Compact view"})]}),mt?e.jsxs("div",{className:"mb-3",children:[(()=>{const h=y.currentPlayerIdx,j=y.players[h];if(!j)return null;const w=j.legs[j.legs.length-1],R=w?w.totalScoreRemaining:y.startingScore,Q=t?.username&&j.name===t.username,ie=w&&w.visits.length?w.visits[w.visits.length-1].score:0,oe=w?w.dartsThrown:0,W=oe>0?((w?.totalScoreStart??y.startingScore)-R)/oe*3:0;return Se==="X01"?e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${h===y.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${h===y.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:h===y.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-4xl font-extrabold",children:R}),e.jsxs("div",{className:"text-sm mt-1",children:["Last score: ",e.jsx("span",{className:"font-semibold",children:ie})]}),e.jsxs("div",{className:"text-sm",children:["3-Dart Avg: ",e.jsx("span",{className:"font-semibold",children:W.toFixed(1)})]}),Q&&h===y.currentPlayerIdx&&R<=170&&R>0&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",Y,"): ",oa(R,Y).join("  ÔÇó  ")||"ÔÇö"]})]}):e.jsxs("div",{className:`p-4 rounded-xl bg-brand-50 text-black ${h===y.currentPlayerIdx?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"text-xs text-slate-600 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:j.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${h===y.currentPlayerIdx?"bg-emerald-500/20 text-emerald-300":"bg-slate-500/20 text-slate-300"} text-xs font-bold`,children:h===y.currentPlayerIdx?"THROWING":"WAITING TO THROW"})]}),e.jsx("div",{className:"text-sm opacity-80",children:Se}),Se==="Double Practice"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:xs[Ee]?.label||"ÔÇö"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[Ue," / ",xs.length]})]}),Se==="Around the Clock"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Bt[me]===25?"25 (Outer Bull)":Bt[me]===50?"50 (Inner Bull)":Bt[me]||"ÔÇö"})]}),e.jsxs("div",{className:"text-3xl font-extrabold",children:[Le," / ",Bt.length]})]})]})})(),y.players.length>1&&e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Next up: ",y.players[(y.currentPlayerIdx+1)%y.players.length]?.name]})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-3 flex flex-wrap items-center gap-2",children:y.players.map((h,j)=>{const w=h.legs[h.legs.length-1],R=w?w.totalScoreRemaining:y.startingScore;return e.jsxs("div",{className:`px-2 py-1 rounded bg-black/20 border border-slate-700/40 text-xs ${j===y.currentPlayerIdx?"ring-1 ring-brand-400":""}`,children:[e.jsx("span",{className:"font-semibold",children:h.name}),Se==="X01"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:R})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-70",children:" = "}),e.jsx("span",{className:"font-mono",children:Se==="Double Practice"?`${Ue}/${xs.length}`:Se==="Around the Clock"?`${Le}/${Bt.length}`:Se==="Cricket"?`${$e[h.id]?.points||0} pts`:Se==="Shanghai"?`${Nt[h.id]?.score||0} pts = R${Nt[h.id]?.round||1}`:Se==="Halve It"?`${wt[h.id]?.score||0} pts = S${(wt[h.id]?.stage||0)+1}`:Se==="High-Low"?`${Ft[h.id]?.score||0} pts = ${Ft[h.id]?.target||"HIGH"}`:Se==="Killer"?(()=>{const Q=F[h.id];return Q?`#${Q.number} = ${Q.lives}ÔØñ ${Q.isKiller?"= K":""}`:"ÔÇö"})():Se==="American Cricket"?`${nt[h.id]?.points||0} pts`:Se==="Baseball"?(()=>{const Q=U[h.id];return Q?`R${Q.score} = I${Q.inning}`:"ÔÇö"})():Se==="Golf"?(()=>{const Q=ne[h.id];return Q?`S${Q.strokes} = H${Q.hole}`:"ÔÇö"})():Se==="Tic Tac Toe"?(()=>{const Q=(Ie.board||[]).filter(oe=>oe==="X").length,ie=(Ie.board||[]).filter(oe=>oe==="O").length;return`X${Q}-O${ie}`})():Se})]})]},`strip-${h.id}`)})})}),mt?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("button",{className:`btn ${ge}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${ge}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${ge}`,onClick:En,children:"Manual Correction"}),!lt&&e.jsx("button",{className:`btn ${ge}`,onClick:()=>{console.log("Sending cam-create"),i?i.send({type:"cam-create"}):N.current&&N.current.readyState===WebSocket.OPEN?N.current.send(JSON.stringify({type:"cam-create"})):s("Not connected to server",{type:"error"})},children:"Pair Phone"}),!lt&&C&&e.jsxs("div",{className:"ml-2 text-sm bg-blue-900/50 p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Mobile pairing code: "}),e.jsx("span",{className:"font-mono font-bold text-lg",children:C})]}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["On your phone, go to: ",e.jsxs("a",{href:`/mobile-cam.html?code=${C}`,target:"_blank",className:"underline",children:[window.location.origin,"/mobile-cam.html?code=",C]})]})]}),!lt&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-[11px]",children:[e.jsx("span",{className:"opacity-70",children:"Cam size"}),e.jsx("button",{className:`btn ${ge}`,onClick:()=>Z(Math.max(.5,Math.round((P-.05)*100)/100)),children:"−"}),e.jsxs("span",{className:`btn ${ge} min-w-[2.5rem] text-center`,children:[Math.round(P*100),"%"]}),e.jsx("button",{className:`btn ${ge}`,onClick:()=>Z(Math.min(1.25,Math.round((P+.05)*100)/100)),children:"+"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 items-start",children:[e.jsx("div",{className:"order-1",children:e.jsx(rt,{})}),e.jsx("div",{className:"order-2",children:se?e.jsxs("div",{className:"min-w-[260px] relative z-10 overflow-hidden",style:{maxHeight:"min(50vh, 400px)"},children:[e.jsx(la,{label:"Your Board",autoStart:t?.username&&y.players[y.currentPlayerIdx]?.name===t.username}),Ct&&e.jsxs("div",{className:"mt-2",children:[e.jsx("video",{ref:Ut,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto max-h-32 object-cover rounded border"}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Mobile Camera"})]})]}):e.jsx("div",{className:"text-xs opacity-60",children:"Camera disabled in settings"})})]}),e.jsxs("div",{className:"font-semibold",children:["Current: ",y.players[y.currentPlayerIdx]?.name||"ÔÇö"]}),Se==="X01"&&se&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(h,j,w)=>{if(O){const Q=y.players[y.currentPlayerIdx],ie=Q?.legs[Q.legs.length-1],oe=ie?ie.totalScoreRemaining:y.startingScore;ra(t?.username||"Player",h,Math.max(0,oe),_,{volume:T,checkoutOnly:H})}const R=y.players[y.currentPlayerIdx];t?.username&&R?.name===t.username&&an(t.username,j,h);try{h===180&&Gt("180",R?.name||"Player"),w&&Gt("leg",R?.name||"Player")}catch{}w||y.nextPlayer(),be()}}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>Ws(ce),children:"Submit Visit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{y.undoVisit(),be()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-1.5 text-xs",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(h=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>Ws(h),children:h},h))]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 mb-2",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>g(!0),children:"Messages"})]})]}):Se==="Double Practice"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:xs[Ee]?.label||"ÔÇö"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Ue," / ",xs.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j)=>{(j==="DOUBLE"||j==="INNER_BULL")&&gt(h)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&ut()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:ut,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (D16, 50, 25, T20)",value:ue,onChange:h=>fe(h.target.value),onKeyDown:h=>{h.key==="Enter"&&Mt()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Mt,children:"Add"})]})]}):Se==="Around the Clock"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Around the Clock ÔÇö Hit 1ÔåÆ20 then 25 (outer) and 50 (inner)"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:Bt[me]===25?"25 (Outer Bull)":Bt[me]===50?"50 (Inner Bull)":Bt[me]||"ÔÇö"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Le," / ",Bt.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{us(h,j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&Ps()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:Ps,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Manual (T20, D5, 25, 50)",value:yt,onChange:h=>ht(h.target.value),onKeyDown:h=>{h.key==="Enter"&&mn()}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:mn,children:"Add"})]})]}):Se==="Cricket"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Cricket ÔÇö Close 15-20 and Bull; overflow scores points"}),(()=>{const h=it();Rs(h);const j=$e[h]||rn();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:zn.map(w=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:w===25?"Bull":w}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[w]||0)," / 3"]})]},w))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:$e[it()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{ns(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(ns(Math.max(0,ce|0)),de(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{ns(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="Shanghai"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();en(h);const j=Nt[h]||Gs();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Shanghai ÔÇö Hit only the round's number; Single/Double/Triple score"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j.round})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{hs(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(hs(Math.max(0,ce|0)),de(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{hs(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="Halve It"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();Ns(h);const j=wt[h]||Js(),w=ca(j);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Halve It ÔÇö Hit the target each round or your score halves"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Stage"}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:[j.stage+1,"/",j.targets.length]})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const R=w;return R?R.kind==="ANY_NUMBER"?"Any":R.kind==="BULL"?"Bull":R.kind==="DOUBLE"||R.kind==="TRIPLE"||R.kind==="NUMBER"?`${R.kind} ${R.num}`:"ÔÇö":"ÔÇö"})()})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Ls(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Ls(Math.max(0,ce|0)),de(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Ls(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="High-Low"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();_s(h);const j=Ft[h]||Ks();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"High-Low ÔÇö Alternate aiming for high then low segments"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Round"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j.round})]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:j.target})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:["Score: ",j.score]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Ss(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Ss(Math.max(0,ce|0)),de(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Ss(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="American Cricket"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"American Cricket ÔÇö Close 12-20 and Bull; overflow scores"}),(()=>{const h=it();ws(h);const j=nt[h]||_n();return e.jsx("div",{className:"mb-2 grid grid-cols-5 gap-1 text-center text-[11px]",children:ha.map(w=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:w===25?"Bull":w}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[w]||0)," / 3"]})]},w))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:nt[it()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{kn(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{kn(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="Baseball"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();un(h);const j=U[h]||Un();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Baseball ÔÇö Inning ",j.inning," ÔÇó Runs ",j.score]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{hn(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{hn(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="Golf"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();tn(h);const j=ne[h]||$n();return e.jsxs("div",{className:"text-xs mb-1.5",children:["Golf ÔÇö Hole ",j.hole," (target ",Xo[j.hole],") ÔÇó Strokes ",j.strokes]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Cn(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Cn(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="Tic Tac Toe"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Tic Tac Toe ÔÇö Tap a cell to claim by hitting its target"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:Array.from({length:9},(h,j)=>j).map(h=>e.jsx("button",{className:`h-12 rounded-xl border ${Ie.board[h]?"bg-emerald-500/20 border-emerald-400/30":"bg-slate-800/50 border-slate-700/50"}`,onClick:()=>{if(Ie.finished||Ie.board[h])return;const j=Fn[h],w=Number(At||0),R=w%3===0?"TRIPLE":w%2===0?"DOUBLE":"SINGLE",Q=j.type==="BULL"?null:j.num||null;sn(h,w,R,Q),Et("")},children:Ie.board[h]||""},h))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-40 text-sm",placeholder:"Enter dart score (e.g. 20, 40, 60, 25, 50)",value:At,onChange:h=>Et(h.target.value),onKeyDown:h=>{if(h.key==="Enter"){const j=Array.from({length:9},(w,R)=>R).find(w=>!Ie.board[w]&&!Ie.finished);if(j!==void 0){const w=Fn[j],R=Number(At||0),Q=R%3===0?"TRIPLE":R%2===0?"DOUBLE":"SINGLE",ie=w.type==="BULL"?null:w.num||null;sn(j,R,Q,ie),Et("")}}}}),e.jsx("button",{className:"btn",onClick:()=>{const h=Array.from({length:9},(j,w)=>w).find(j=>!Ie.board[j]&&!Ie.finished);if(h!==void 0){const j=Fn[h],w=Number(At||0),R=w%3===0?"TRIPLE":w%2===0?"DOUBLE":"SINGLE",Q=j.type==="BULL"?null:j.num||null;sn(h,w,R,Q),Et("")}},children:"Claim Cell"})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{}})})]}):Se==="Killer"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:(()=>{const h=it();return y.players.forEach(j=>Hs(j.id)),F[h]?.number||"ÔÇö"})()})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:(()=>{const h=it();return F[h]?.lives??"ÔÇö"})()})," ",(()=>{const h=it();return F[h]?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null})()]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Os(j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&(Os("SINGLE",Math.max(0,ce|0)),de(0))}}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{Os("SINGLE",Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-xs mb-1.5",children:[Se," (online) ÔÇö manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{className:"input w-24 text-sm",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const h=Math.max(0,ce|0);y.addVisit(h,3),de(0),y.nextPlayer(),be()},children:"Submit"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800",onClick:()=>{y.undoVisit(),be()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>g(!0),children:"Messages"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsx(rt,{})}),e.jsxs("div",{className:`md:col-span-${Re} space-y-1.5 relative`,children:[e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("button",{className:`btn ${ge}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-autoscore"))}catch{}},children:"Autoscore"}),e.jsx("button",{className:`btn ${ge}`,onClick:()=>{try{window.dispatchEvent(new Event("ndn:open-scoring"))}catch{}},children:"Scoring"}),e.jsx("button",{className:`btn ${ge}`,onClick:En,children:"Manual Correction"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[e.jsx("span",{className:"text-xs opacity-70",children:"Cam"}),e.jsx("button",{className:`btn ${ge}`,onClick:()=>Z(Math.max(.5,Math.round((P-.05)*100)/100)),children:"−"}),e.jsxs("span",{className:`btn ${ge} bg-transparent border-slate-600 text-center min-w-[3rem]`,children:[Math.round(P*100),"%"]}),e.jsx("button",{className:`btn ${ge}`,onClick:()=>Z(Math.min(1.25,Math.round((P+.05)*100)/100)),children:"+"}),e.jsx("button",{className:`btn ${ge}`,onClick:()=>ct(Re===2?3:2),title:Re===2?"Expand camera":"Shrink camera",children:Re===2?"↔":"↙"})]})]}),e.jsxs("div",{className:"mt-2 relative",children:[e.jsx("div",{className:"w-full max-w-full",children:e.jsx(la,{label:"Your Board",autoStart:t?.username&&y.players[y.currentPlayerIdx]?.name===t.username})}),Re<3&&e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-slate-600/20 hover:bg-slate-600/40 transition-colors flex items-center justify-center group",onMouseDown:h=>{h.preventDefault();const j=h.clientX,w=Re,R=ie=>{ie.clientX-j>50&&w===2&&ct(3)},Q=()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",Q)};document.addEventListener("mousemove",R),document.addEventListener("mouseup",Q)},children:e.jsx("div",{className:"w-0.5 h-8 bg-slate-400 group-hover:bg-slate-300 transition-colors"})})]}),e.jsxs("div",{className:"font-semibold text-sm md:text-base",children:["Current: ",y.players[y.currentPlayerIdx]?.name||"ÔÇö"]}),Se==="X01"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{hideInlinePanels:!0,showToolbar:!1,onVisitCommitted:(h,j,w)=>{if(O){const Q=y.players[y.currentPlayerIdx],ie=Q?.legs[Q.legs.length-1],oe=ie?ie.totalScoreRemaining:y.startingScore;ra(t?.username||"Player",h,Math.max(0,oe),_,{volume:T,checkoutOnly:H})}const R=y.players[y.currentPlayerIdx];t?.username&&R?.name===t.username&&an(t.username,j,h);try{h===180&&Gt("180",R?.name||"Player"),w&&Gt("leg",R?.name||"Player")}catch{}w||y.nextPlayer(),be()}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>Ws(ce),children:"Submit Visit (Manual)"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{y.undoVisit(),be()},children:"Undo"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 text-sm",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),[180,140,100,60].map(h=>e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>Ws(h),children:h},h))]}),(()=>{const h=y.players[y.currentPlayerIdx],j=h?.legs?.[h.legs?.length-1],w=j?j.totalScoreRemaining:y.startingScore;return w>0&&w<=170?e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm",children:["Checkout suggestions (fav ",Y,"): ",oa(w,Y).join("  ÔÇó  ")||"ÔÇö"]}):null})()]}):Se==="Double Practice"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL"}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Current target"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:xs[Ee]?.label||"ÔÇö"})]}),e.jsxs("div",{className:"text-2xl font-extrabold mb-2",children:[Ue," / ",xs.length]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j)=>{(j==="DOUBLE"||j==="INNER_BULL")&&gt(h)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0")),onKeyDown:h=>{h.key==="Enter"&&ut()}}),e.jsx("button",{className:"btn",onClick:ut,children:"Add Dart"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[e.jsx("input",{className:"input w-44",placeholder:"Manual (D16, 50, 25, T20)",value:ue,onChange:h=>fe(h.target.value),onKeyDown:h=>{h.key==="Enter"&&Mt()}}),e.jsx("button",{className:"btn",onClick:Mt,children:"Add"})]})]}):Se==="Cricket"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsx("div",{className:"text-sm mb-2",children:"Cricket ÔÇö Close 15-20 and Bull; overflow scores points"}),(()=>{const h=it();Rs(h);const j=$e[h]||rn();return e.jsx("div",{className:"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]",children:zn.map(w=>e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50",children:[e.jsx("div",{className:"opacity-70",children:w===25?"Bull":w}),e.jsxs("div",{className:"font-semibold",children:[Math.min(3,j.marks?.[w]||0)," / 3"]})]},w))})})(),e.jsxs("div",{className:"text-sm mb-2",children:["Points: ",e.jsx("span",{className:"font-semibold",children:$e[it()]?.points||0})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{ns(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{ns(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="Shanghai"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();en(h);const j=Nt[h]||Gs();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["Shanghai ÔÇö Round ",j.round," ÔÇó Score ",j.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{hs(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{hs(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="Halve It"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();Ns(h);const j=wt[h]||Js(),w=ca(j);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm mb-2",children:["Halve It ÔÇö Stage ",j.stage+1,"/",j.targets.length," ÔÇó Score ",j.score]}),e.jsxs("div",{className:"text-sm",children:["Target: ",e.jsx("span",{className:"font-semibold",children:(()=>{const R=w;return R?R.kind==="ANY_NUMBER"?"Any":R.kind==="BULL"?"Bull":R.kind==="DOUBLE"||R.kind==="TRIPLE"||R.kind==="NUMBER"?`${R.kind} ${R.num}`:"ÔÇö":"ÔÇö"})()})]})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Ls(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Ls(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="High-Low"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();_s(h);const j=Ft[h]||Ks();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-sm mb-2",children:["High-Low ÔÇö Round ",j.round," ÔÇó Target ",j.target," ÔÇó Score ",j.score]})})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Ss(h,j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Ss(Math.max(0,ce|0)),de(0)},children:"Add Dart"})]})]}):Se==="Killer"&&t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[(()=>{const h=it();y.players.forEach(w=>Hs(w.id));const j=F[h];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs mb-1.5",children:"Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples."}),e.jsxs("div",{className:"mb-1 text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Your number"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold",children:j?.number||"ÔÇö"})]}),e.jsxs("div",{className:"text-sm",children:["Lives: ",e.jsx("span",{className:"font-semibold",children:j?.lives??"ÔÇö"})," ",j?.isKiller?e.jsx("span",{className:"ml-2 text-emerald-300",children:"KILLER"}):null]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 gap-1 text-[11px]",children:y.players.map(w=>{const R=F[w.id];return e.jsxs("div",{className:"p-1 rounded bg-slate-800/50 border border-slate-700/50 flex items-center justify-between",children:[e.jsx("span",{className:"opacity-80 truncate",children:w.name}),e.jsx("span",{className:"font-mono",children:R?`#${R.number} = ${R.lives}ÔØñ${R.isKiller?" = K":""}`:"ÔÇö"})]},w.id)})})]})})(),e.jsx("div",{className:"rounded-2xl overflow-hidden bg-black/60 border border-white/10 my-2",children:e.jsx(Ze,{scoringMode:"custom",showToolbar:!1,immediateAutoCommit:!0,onAutoDart:(h,j,w)=>{Os(j==="MISS"?void 0:j,w?.sector??null)}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{Os("SINGLE",Math.max(0,ce|0)),de(0)},children:"Add Dart"})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Tip: Only doubles/triples on the opponentsÔÇÖ numbers remove lives. To become Killer, hit your own double."})]}):t?.username&&y.players[y.currentPlayerIdx]?.name===t.username?e.jsxs("div",{className:"p-3 rounded-xl bg-black/20",children:[e.jsxs("div",{className:"text-sm mb-2",children:[Se," (online) ÔÇö manual turn entry"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input w-28",type:"number",min:0,value:ce,onChange:h=>de(parseInt(h.target.value||"0"))}),e.jsx("button",{className:"btn",onClick:()=>{const h=Math.max(0,ce|0);y.addVisit(h,3),de(0),y.nextPlayer(),be()},children:"Submit"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>{y.undoVisit(),be()},children:"Undo"})]})]}):e.jsx("div",{className:"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold",children:"WAITING TO THROW"})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>x(!0),children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>g(!0),children:"Messages"})]})})]})]})})]})]}),B&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50",children:e.jsx("div",{className:"w-full h-full flex items-stretch justify-stretch p-0",children:e.jsxs(Xs,{storageKey:"ndn:modal:create-match",className:"w-full h-full rounded-none !border-0 !shadow-none relative",fullScreen:!0,children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-slate-900/80 backdrop-blur border-b border-slate-700 z-10 px-2 py-2",children:e.jsx("h3",{className:"text-xl font-bold",children:"Create Match"})}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 overflow-auto px-2",style:{maxHeight:"calc(100vh - 120px)"},children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:ot,onChange:h=>Zt(h.target.value),children:Nn.map(h=>e.jsxs("option",{value:h,disabled:!t?.fullAccess&&qs.includes(h),children:[h," ",!t?.fullAccess&&qs.includes(h)?"(PREMIUM)":""]},h))})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:G,onChange:h=>Ae(h.target.value),children:[e.jsx("option",{value:"bestof",children:"Best Of"}),e.jsx("option",{value:"firstto",children:"First To"})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Value"}),ot==="X01"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:[101,201,301,401,501].map(h=>e.jsx("button",{className:`btn px-2 py-1 text-xs ${he===h?"bg-purple-600 hover:bg-purple-700":""}`,onClick:()=>_e(h),children:h},h))}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:he,onChange:h=>_e(parseInt(h.target.value||"1")),placeholder:"Or enter custom value"})]}):e.jsx("input",{className:"input w-full",type:"number",min:1,value:he,onChange:h=>_e(parseInt(h.target.value||"1"))}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Example: Best Of 5 — first to 3"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Starting Score"}),ot==="X01"?e.jsx("select",{className:"input w-full",value:He,onChange:h=>dt(parseInt(h.target.value||"501")),children:[301,501,701].map(h=>e.jsx("option",{value:h,children:h},h))}):e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"Starting score applies to X01 only"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1",children:"Require Calibration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"calibreq",type:"checkbox",className:"accent-purple-500",checked:Fs,onChange:h=>ys(h.target.checked)}),e.jsx("label",{htmlFor:"calibreq",className:"text-sm opacity-80",children:"Players must be calibrated"})]})]}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg bg-black/20 border border-slate-700/40",children:[e.jsx("div",{className:"text-xs text-slate-300 uppercase tracking-wide mb-1",children:"Summary"}),e.jsxs("div",{className:"text-sm font-semibold",children:[ot," — ",G==="bestof"?`Best Of ${he}`:`First To ${he}`," ",ot==="X01"?`— ${He}`:""]}),!t?.fullAccess&&qs.includes(ot)&&e.jsx("div",{className:"text-xs text-rose-300 mt-1",children:"PREMIUM required"})]})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-900/80 backdrop-blur border-t border-slate-700 z-10 px-2 py-2",children:[e.jsx("button",{className:"btn w-full",disabled:!t?.fullAccess&&qs.includes(ot),title:!t?.fullAccess&&qs.includes(ot)?"PREMIUM game":"",onClick:()=>{const h=t?.username?Ys(t.username):0;i?(i.send({type:"create-match",game:ot,mode:G,value:he,startingScore:He,creatorAvg:h,requireCalibration:Fs}),J(!1),i.send({type:"list-matches"})):(N.current?.send(JSON.stringify({type:"create-match",game:ot,mode:G,value:he,startingScore:He,creatorAvg:h,requireCalibration:Fs})),J(!1),N.current?.send(JSON.stringify({type:"list-matches"})))},children:"START GAME!"}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx("button",{className:"btn px-2 py-1",onClick:()=>J(!1),children:"Close"})})]})]})})}),Oe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(Xs,{storageKey:"ndn:modal:invite",className:"w-full relative",defaultWidth:620,defaultHeight:420,minWidth:520,minHeight:320,maxWidth:1e3,maxHeight:800,children:[e.jsx("h3",{className:"text-xl font-bold mb-1",children:"Incoming Match Request"}),e.jsxs("div",{className:"text-sm mb-2",children:[e.jsx("span",{className:"font-semibold",children:Oe.fromName})," wants to join your match.",e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${Oe.calibrated?"bg-emerald-500/20 text-emerald-300 border border-emerald-600/30":"bg-amber-500/20 text-amber-200 border border-amber-600/30"}`,children:Oe.calibrated?"Calibrated":"Not calibrated"})]}),(Oe.game||Oe.mode)&&e.jsxs("div",{className:"text-xs opacity-80 mb-3",children:[Oe.game||"X01"," ÔÇó ",Oe.mode==="firstto"?`First To ${Oe.value}`:`Best Of ${Oe.value}`," ",Oe.game==="X01"&&Oe.startingScore?`ÔÇó ${Oe.startingScore}`:""]}),Oe.boardPreview?e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:Oe.boardPreview,alt:"Board preview",className:"rounded-lg w-full max-h-64 object-contain bg-black/40 border border-slate-700"})}):e.jsx("div",{className:"mb-3 text-xs opacity-60",children:"No camera preview provided."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{i?i.send({type:"invite-response",matchId:Oe.matchId,accept:!0,toId:Oe.fromId}):N.current?.send(JSON.stringify({type:"invite-response",matchId:Oe.matchId,accept:!0,toId:Oe.fromId})),It(null)},children:"Accept"}),e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>{i?i.send({type:"invite-response",matchId:Oe.matchId,accept:!1,toId:Oe.fromId}):N.current?.send(JSON.stringify({type:"invite-response",matchId:Oe.matchId,accept:!1,toId:Oe.fromId})),It(null)},children:"Decline"})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(Xs,{storageKey:"ndn:modal:quick-chat",className:"w-full relative",defaultWidth:520,defaultHeight:280,minWidth:360,minHeight:220,maxWidth:900,maxHeight:700,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Chat"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>x(!1),children:"Close"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["Good luck!","Good game!","Nice darts!","Well played!","Ready?"].map(h=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>{bt(h),x(!1)},disabled:!o,children:h},h))})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsxs(Xs,{storageKey:"ndn:modal:messages",className:"w-full relative",defaultWidth:560,defaultHeight:360,minWidth:380,minHeight:260,maxWidth:1e3,maxHeight:800,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Messages"}),e.jsx("button",{className:"btn px-2 py-1 text-sm",onClick:()=>g(!1),children:"Close"})]}),e.jsx(Sm,{items:c.slice(-30).filter(h=>!n.isBlocked(String(h.fromId||""))).map((h,j)=>({key:String(j),from:h.from,id:String(h.fromId||h.from),text:h.message})),onDelete:h=>f(j=>j.filter((w,R)=>R!==h)),onReport:h=>{const w=c.slice(-30).filter(R=>!n.isBlocked(String(R.fromId||"")))[h];w&&qn(null,w.message)},onBlock:h=>{const w=c.slice(-30).filter(R=>!n.isBlocked(String(R.fromId||"")))[h];if(w){try{n.block(String(w.fromId||w.from))}catch{}f(R=>R.filter(Q=>String(Q.fromId||Q.from)!==String(w.fromId||w.from)));try{s(`${w.from} blocked`,{type:"info"})}catch{}}}})]})})]})}function Sm({items:t,onDelete:a,onReport:s,onBlock:i}){const n=(()=>{try{const c=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(c)}catch{return!1}})(),[r,l]=m.useState(null),[o,d]=m.useState(null);return e.jsx("div",{className:"h-24 overflow-auto text-sm divide-y divide-slate-700/40",children:t.length===0?e.jsx("div",{className:"opacity-60 py-1",children:"No messages yet."}):t.map((c,f)=>{const u=al(c.text),x=om(c.text);return e.jsxs("div",{className:"relative group px-1 py-1 flex items-start gap-2",onTouchStart:n?p=>{const g=p.touches[0];l({x:g.clientX,y:g.clientY,i:f,t:Date.now()})}:void 0,onTouchMove:n?p=>{if(!r||r.i!==f)return;p.touches[0].clientX-r.x<-40&&d(f)}:void 0,onTouchEnd:n?()=>{const p=r?Date.now()-r.t:0;(o===f||p>600)&&(a(f),d(null)),l(null)}:void 0,children:[e.jsxs("span",{className:"text-slate-400 shrink-0",children:["[",c.from,"]"]}),e.jsx("span",{className:"text-white break-words whitespace-pre-wrap flex-1",children:u}),!n&&e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 ml-2",children:[e.jsx("button",{className:"w-5 h-5 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center",title:"Delete message","aria-label":"Delete message",onClick:()=>a(f),children:"├ù"}),i&&e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-slate-700 hover:bg-slate-800 text-slate-100 text-[11px]",onClick:()=>i(f),title:"Block sender",children:"Block"}),e.jsx("button",{className:"px-1.5 py-0.5 rounded bg-amber-600/40 hover:bg-amber-600/60 text-amber-100 text-[11px]",onClick:()=>s(f),title:"Report message",children:"Report"})]}),x&&e.jsx("span",{className:"ml-2 text-[10px] px-1 rounded bg-rose-600/30 text-rose-200 border border-rose-600/40",children:"Filtered"})]},c.key)})})}function km({user:t}){const{players:a,inProgress:s,startingScore:i,newMatch:n}=Bn(),[r,l]=m.useState("x01"),[o,d]=m.useState("Player 1, Player 2"),[c,f]=m.useState(501),[u,x]=m.useState([]),[p,g]=m.useState(""),[S,M]=m.useState(!1),[I,N]=m.useState(""),[E,A]=m.useState([]),[D,k]=m.useState(!1),b=String(t?.email||"").toLowerCase();m.useEffect(()=>{let O=!1;async function _(){try{if(!b)return;const ae=await(await fetch(`/api/friends/list?email=${encodeURIComponent(b)}`)).json().catch(()=>({friends:[]}));O||x(ae.friends||[])}catch{}}_();const T=setInterval(_,2e4);return()=>{O=!0,clearInterval(T)}},[b]),m.useEffect(()=>{try{const O=b?`ndn:stats:opponent:${b}`:"ndn:stats:opponent",_=localStorage.getItem(O);_&&g(_)}catch{}},[b]),m.useEffect(()=>{try{const O=b?`ndn:stats:opponent:${b}`:"ndn:stats:opponent";p?localStorage.setItem(O,p):localStorage.removeItem(O)}catch{}},[p,b]);async function y(O){if(N(O),!O.trim()){A([]);return}k(!0);try{const T=await(await fetch(`/api/friends/search?q=${encodeURIComponent(O)}`)).json().catch(()=>({results:[]}));A(T.results||[])}finally{k(!1)}}const $=m.useMemo(()=>{const O=new Map;if(r==="x01")for(const T of a)for(const H of T.legs)for(const ae of H.visits){const P=Math.max(0,Math.min(180,ae.score));O.set(P,(O.get(P)??0)+1)}const _=Array.from(O.entries()).sort((T,H)=>T[0]-H[0]);return _.length===0&&r==="x01"?([0,26,41,60,81,100,120,140,160,180].forEach(T=>O.set(T,0)),Array.from(O.entries()).sort((T,H)=>T[0]-H[0]).map(([T,H])=>({label:T,value:H}))):_.map(([T,H])=>({label:T,value:H}))},[a,r]),Y=m.useMemo(()=>{const O=Sr(Nn);return Nn.map(_=>{const T=O[_]||{played:0,won:0};return{label:_,value:T.played,extra:T.won}})},[r]);return m.useEffect(()=>{const O=()=>l(_=>_);return window.addEventListener("ndn:stats-updated",O),()=>window.removeEventListener("ndn:stats-updated",O)},[]),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Match Stats"}),e.jsx("span",{className:"text-xs opacity-70",children:"View"})]}),e.jsx(fa,{tabs:[{key:"x01",label:"X01"},{key:"other",label:"Other Modes"}],active:r,onChange:O=>l(O)})]}),a.length===0&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-2",children:"No match data yet"}),e.jsx("div",{className:"text-sm opacity-80 mb-2",children:"Start a quick X01 match to generate stats. Stats like Best/Worst 3-dart are finalized when you end the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-300 mb-1",children:"Players (comma separated)"}),e.jsx("input",{className:"input w-full",value:o,onChange:O=>d(O.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-300 mb-1",children:"Starting Score"}),e.jsx("input",{className:"input w-full",type:"number",value:c,onChange:O=>f(parseInt(O.target.value||"501"))})]}),e.jsx("div",{children:e.jsx("button",{className:"btn w-full",onClick:()=>{const O=o.split(",").map(_=>_.trim()).filter(Boolean);if(!O.length)return alert("Enter at least one player");n(O,c)},children:"Start Match"})})]})]}),s&&e.jsx("div",{className:"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200",children:"Note: Detailed leg stats are finalized at the end of the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.map((O,_)=>e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:_===1&&!p?O.name||"Opponent":_===1&&p?p:O.name}),_===1&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10",onClick:()=>M(T=>!T),title:"Search user to compare",children:"Select Friend"}),u.slice(0,6).map(T=>{const H=T.username||T.email,ae=p===H;return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${ae?"bg-indigo-500/30 border-indigo-400/50":"bg-white/5 border-white/10 hover:bg-white/10"}`,onClick:()=>g(H),title:`Compare vs ${H}`,children:H},T.email)}),u.length===0&&e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10",disabled:!0,children:"Find friends to compare"})]})]}),_===1&&S&&e.jsxs("div",{className:"mb-2 p-2 rounded-lg bg-black/20 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1 py-1",placeholder:"Search by name or email",value:I,onChange:T=>y(T.target.value)}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>y(I),disabled:D,children:"Search"})]}),e.jsxs("ul",{className:"max-h-40 overflow-auto space-y-1",children:[E.map(T=>{const H=T.username||T.email;return e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm",onClick:()=>{g(H),M(!1)},children:H})},T.email)}),!E.length&&e.jsx("li",{className:"text-xs opacity-70",children:I.trim()?"No results":"Type to search…"})]})]}),_===1&&p?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:xt(os(p).best3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:xt(os(p).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const T=os(p);return T.bestLegDarts?`${T.bestLegDarts} darts`:"—"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:os(p).bestCheckout||"—"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",xt(Ys(p))," · ",xt(Pa(p))]}),e.jsxs("span",{children:["First 9: ",xt(Aa(p))," · ",xt(Ra(p))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const T=os(p);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",xt(T.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",xt(T.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",T.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",T.bestCheckout||0]})]})})()]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:xt(O.bestThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:xt(O.worstThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:O.bestNineDart?`${O.bestNineDart.darts} darts`:"—"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:O.bestCheckout??"—"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",xt(Ys(O.name))," · ",xt(Pa(O.name))]}),e.jsxs("span",{children:["First 9: ",xt(Aa(O.name))," · ",xt(Ra(O.name))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const T=os(O.name);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",xt(T.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",xt(T.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",T.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",T.bestCheckout||0]})]})})()]})]})]},O.id)),a.length<=1&&e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Opponent"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[u.slice(0,6).map(O=>{const _=O.username||O.email,T=p===(O.username||O.email);return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${T?"bg-indigo-500/30 border-indigo-400/50":"bg-white/5 border-white/10 hover:bg-white/10"}`,onClick:()=>g(_),title:`Compare vs ${_}`,children:_},O.email)}),u.length===0&&e.jsx("span",{className:"text-xs opacity-70",children:"Add friends to compare stats."})]})]}),p?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Comparing to"}),e.jsx("div",{className:"font-semibold",children:p})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:xt(Ys(p))})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:xt(os(p).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const O=os(p);return O.bestLegDarts?`${O.bestLegDarts} darts`:"—"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:os(p).bestCheckout||"—"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",xt(Ys(p))," · ",xt(Pa(p))]}),e.jsxs("span",{children:["First 9: ",xt(Aa(p))," · ",xt(Ra(p))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const O=os(p);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",xt(O.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",xt(O.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",O.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",O.bestCheckout||0]})]})})()]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Select a friend above to compare."})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Score Distribution (",r.toUpperCase(),"): Visits by scored points"]}),e.jsx("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:e.jsx(Nr,{data:$,showValues:!1})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-2 text-sm opacity-80",children:"Other Modes: games played (bar height) with wins shown beneath each label"}),e.jsxs("div",{className:"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3",children:[e.jsx(Nr,{data:Y.map(O=>({label:O.label,value:O.value})),showValues:!1}),e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80",children:Y.map((O,_)=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10",children:[e.jsx("span",{className:"truncate mr-2",children:O.label}),e.jsxs("span",{className:"whitespace-nowrap",children:["Played ",O.value," · Won ",O.extra]})]},_))})]})]})]})}function Cm({user:t}){const a=wn(),s=(()=>{try{return Tr()}catch{return null}})(),[i,n]=m.useState([]),[r,l]=m.useState(!1),[o,d]=m.useState(""),[c,f]=m.useState(null),[u,x]=m.useState(!1),[p,g]=m.useState({open:!1,t:null}),[S,M]=m.useState({open:!1,t:null}),[I,N]=m.useState({title:"Community X01 Tournament",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date(Date.now()+7200*1e3).toISOString().slice(0,16),checkinMinutes:15,capacity:8,startingScore:501}),E=(()=>{try{return"ontouchstart"in window||(navigator.maxTouchPoints||0)>0}catch{return!1}})();async function A(){try{const Z=await(await kt("/api/tournaments")).json();n(Array.isArray(Z.tournaments)?Z.tournaments:[])}catch{}}m.useEffect(()=>{A()},[]),m.useEffect(()=>{if(!s)return;const P=s.addListener(Z=>{try{Z.type==="tournaments"&&n(Z.tournaments||[]),Z.type==="tournament-win"&&Z.message&&a(Z.message,{type:"success",timeout:1e4})}catch{}});return()=>{P()}},[s?.connected]);const D=String(t?.email||"").toLowerCase();m.useEffect(()=>{let P=!1;async function Z(){if(!D){f(null);return}try{const ze=await(await kt(`/api/subscription?email=${encodeURIComponent(D)}`)).json();P||(ze?.source==="tournament"&&typeof ze.expiresAt=="number"&&ze.expiresAt>Date.now()?f(ze.expiresAt):f(null))}catch{P||f(null)}}return Z(),()=>{P=!0}},[D]);function k(P){return!!P.participants?.some(Z=>Z.email===D)}async function b(P){D&&M({open:!0,t:P})}async function y(){const P=S.t;if(!(!P||!D)){M({open:!1,t:null}),l(!0);try{let Z=await kt("/api/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:P.id,requesterEmail:D})});if(!Z.ok&&Z.status===403&&String(D)==="daviesfamily108@gmail.com"&&(Z=await kt("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:P.id,requesterEmail:D})})),!Z.ok){let se="Delete failed";try{const ze=await Z.json();ze?.error&&(se=`Delete failed: ${String(ze.error)}`)}catch{}a(se,{type:"error"});return}a("Tournament deleted",{type:"success"}),await A()}finally{l(!1)}}}async function $(P){if(D){l(!0);try{const Z=await kt("/api/tournaments/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:P.id,email:D,username:t?.username})});if(!Z.ok){let se={};try{se=await Z.json()}catch{}se?.error==="WINNER_COOLDOWN"&&typeof se.until=="number"?(d(`You're a recent NDN tournament winner. You can re-enter after ${ae(se.until)}.`),setTimeout(()=>d(""),6e3),a("Join blocked: winner cooldown active",{type:"error"})):se?.error==="ALREADY_IN_TOURNAMENT"?(d(String(se.message||"You can only join one tournament at a time.")),setTimeout(()=>d(""),6e3),a("Join blocked: already in another tournament",{type:"error"})):se?.error&&(d(String(se.error)),setTimeout(()=>d(""),3500),a(`Join failed: ${String(se.error)}`,{type:"error"}));return}a("Joined tournament",{type:"success"}),await A()}finally{l(!1)}}}async function Y(P){if(D){l(!0);try{const Z=await kt("/api/tournaments/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:P.id,email:D})});if(!Z.ok){let se={};try{se=await Z.json()}catch{}se?.error?a(`Leave failed: ${String(se.error)}`,{type:"error"}):Z.status===404?a("Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.",{type:"error"}):a("Leave failed. Please try again.",{type:"error"});return}a("Left tournament",{type:"success"}),n(se=>se.map(ze=>ze.id===P.id?{...ze,participants:(ze.participants||[]).filter(ye=>ye.email!==D)}:ze)),await A()}finally{l(!1)}}}async function O(){l(!0);try{const P=new Date(I.startAt).getTime();await kt("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:I.title,game:I.game,mode:I.mode,value:Number(I.value),description:I.description,startAt:P,checkinMinutes:Number(I.checkinMinutes),capacity:Number(I.capacity),startingScore:I.game==="X01"?Number(I.startingScore||501):void 0,creatorEmail:t?.email,creatorName:t?.username})}),x(!1),a("Tournament created",{type:"success"}),await A()}finally{l(!1)}}m.useEffect(()=>{if(!u)return;const P=Z=>{Z.key==="Escape"&&x(!1)};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[u]);const _=m.useMemo(()=>i.filter(P=>P.official),[i]),T=m.useMemo(()=>i.filter(P=>!P.official),[i]),H=m.useMemo(()=>_.filter(Z=>Z.status==="scheduled").sort((Z,se)=>Z.startAt-se.startAt)[0]||null,[_]);function ae(P){return new Date(P).toLocaleString()}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Tournaments"})}),e.jsx("div",{className:"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end",children:e.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Create Tournament +"})}),e.jsx("div",{className:"mb-2 text-sm font-semibold text-slate-300",children:"World Lobby"}),H&&e.jsx("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm uppercase tracking-wide text-indigo-300 font-semibold",children:"Weekly Official Tournament"}),e.jsx("div",{className:"font-bold",children:H.title}),e.jsxs("div",{className:"text-sm opacity-80",children:[H.game,H.game==="X01"&&H.startingScore?`/${H.startingScore}`:""," · ",H.mode==="firstto"?"First to":"Best of"," ",H.value," · Starts ",ae(H.startAt)," · Cap ",H.capacity," · Joined ",H.participants.length]}),H.prize&&e.jsxs("div",{className:"text-xs mt-1",children:["Prize: ",H.prizeType==="cash"&&H.prizeAmount?`${H.currency||"USD"} ${H.prizeAmount}`:"3 months PREMIUM"]}),H.status!=="scheduled"&&e.jsxs("div",{className:"text-xs",children:["Status: ",H.status]}),c&&c>Date.now()&&e.jsxs("div",{className:"text-xs text-rose-300",children:["Recent winners can re-enter after ",ae(c),"."]})]}),e.jsx("div",{className:"shrink-0",children:e.jsx("button",{className:`btn ${k(H)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:k(H)?"Double-click to leave this tournament":H.official&&c&&c>Date.now()?`Recent winners can re-enter after ${ae(c)}`:"",disabled:r||H.status!=="scheduled"||!k(H)&&(H.participants.length>=H.capacity||!!c&&c>Date.now()),onClick:()=>{k(H)?E&&g({open:!0,t:H}):$(H)},onDoubleClick:()=>{!E&&k(H)&&g({open:!0,t:H})},"aria-label":k(H)?"Already Joined":"Join Now",children:k(H)?"Already Joined!":"Join Now"})})]})}),o&&e.jsx("div",{className:"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm",children:o}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("section",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Official"}),e.jsx("div",{className:"text-xs opacity-70 mb-2",children:c&&c>Date.now()?e.jsxs(e.Fragment,{children:["You’re a recent NDN tournament winner — to keep it fair, you can re-enter after ",ae(c),"."]}):e.jsx(e.Fragment,{children:"Note: Weekly winners can re-enter once their 3 months of PREMIUM ends."})}),e.jsxs("ul",{className:"space-y-2",children:[_.map(P=>e.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"font-semibold",children:[P.title," ",P.prize&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 align-middle",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-amber-500 text-black",children:"Prize"}),e.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help",title:P.prizeType==="cash"?"Official cash prize tournament — payout handled by admin.":"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.","aria-label":"Prize info",children:"i"})]})]}),e.jsxs("div",{className:"text-sm opacity-80",children:[P.game,P.game==="X01"&&P.startingScore?`/${P.startingScore}`:""," · ",P.mode==="firstto"?"First to":"Best of"," ",P.value," · ",ae(P.startAt)," · Cap ",P.capacity," · Joined ",P.participants.length]}),P.prize&&e.jsxs("div",{className:"text-xs",children:["Prize: ",P.prizeType==="cash"&&P.prizeAmount?`${P.currency||"USD"} ${P.prizeAmount}`:"3 months PREMIUM",P.status==="completed"&&P.prizeType==="cash"&&P.payoutStatus&&e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded ${P.payoutStatus==="paid"?"bg-emerald-600":"bg-amber-600"}`,children:P.payoutStatus==="paid"?"Paid":"Pending"})]}),P.status!=="scheduled"&&e.jsxs("div",{className:"text-xs",children:["Status: ",P.status]}),k(P)&&e.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"}),P.official&&c&&c>Date.now()&&e.jsxs("div",{className:"text-xs text-rose-300",children:["Cooldown active until ",ae(c),"."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`btn ${k(P)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:k(P)?"Double-click to leave this tournament":P.official&&c&&c>Date.now()?`Recent winners can re-enter after ${ae(c)}`:"",disabled:r||P.status!=="scheduled"||!k(P)&&(P.participants.length>=P.capacity||P.official&&!!c&&c>Date.now()),onClick:()=>{k(P)?E&&g({open:!0,t:P}):$(P)},onDoubleClick:()=>{!E&&k(P)&&g({open:!0,t:P})},"aria-label":k(P)?"Already Joined":"Join Now",children:k(P)?"Already Joined!":"Join Now"}),P.status==="scheduled"&&D&&P.creatorEmail&&String(P.creatorEmail).toLowerCase()===D&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>b(P),"aria-label":"Delete tournament",children:"×"})]})]},P.id)),_.length===0&&e.jsx("li",{className:"text-sm opacity-60",children:"No official tournaments yet."})]})]}),e.jsxs("section",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Community"}),e.jsxs("ul",{className:"space-y-2",children:[T.map(P=>e.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-semibold",children:P.title}),e.jsxs("div",{className:"text-sm opacity-80",children:[P.game,P.game==="X01"&&P.startingScore?`/${P.startingScore}`:""," · ",P.mode==="firstto"?"First to":"Best of"," ",P.value," · ",ae(P.startAt)," · Cap ",P.capacity," · Joined ",P.participants.length]}),P.description&&e.jsx("div",{className:"text-xs opacity-80",children:P.description}),k(P)&&e.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",title:k(P)?"Double-click to leave this tournament":"",disabled:r||P.status!=="scheduled"||!k(P)&&P.participants.length>=P.capacity,onClick:()=>{k(P)?E&&g({open:!0,t:P}):$(P)},onDoubleClick:()=>{!E&&k(P)&&g({open:!0,t:P})},children:k(P)?"Already Joined":"Join Now"}),P.status==="scheduled"&&D&&P.creatorEmail&&String(P.creatorEmail).toLowerCase()===D&&e.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>b(P),"aria-label":"Delete tournament",children:"×"})]})]},P.id)),T.length===0&&e.jsx("li",{className:"text-sm opacity-60",children:"No community tournaments yet."})]})]})]}),u&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"card relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Create Tournament"}),e.jsx("button",{className:"btn",onClick:()=>x(!1),children:"Close"})]}),e.jsxs("div",{className:"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 pr-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Title"}),e.jsx("input",{className:"input w-full",value:I.title,onChange:P=>N(Z=>({...Z,title:P.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Game"}),e.jsx("select",{className:"input w-full",value:I.game,onChange:P=>N(Z=>({...Z,game:P.target.value})),children:["X01","Around the Clock","Cricket","Halve It","Shanghai","High-Low","Killer"].map(P=>e.jsx("option",{value:P,children:P},P))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Mode"}),e.jsxs("select",{className:"input w-full",value:I.mode,onChange:P=>N(Z=>({...Z,mode:P.target.value})),children:[e.jsx("option",{value:"bestof",children:"Best of"}),e.jsx("option",{value:"firstto",children:"First to"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Number"}),e.jsx("input",{className:"input w-full",type:"number",min:1,value:I.value,onChange:P=>N(Z=>({...Z,value:Number(P.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Description"}),e.jsx("textarea",{className:"input w-full",rows:5,value:I.description,onChange:P=>N(Z=>({...Z,description:P.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Start time"}),e.jsx("input",{className:"input w-full",type:"datetime-local",value:I.startAt,onChange:P=>N(Z=>({...Z,startAt:P.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Check-in reminder (min)"}),e.jsx("input",{className:"input w-full",type:"number",min:0,value:I.checkinMinutes,onChange:P=>N(Z=>({...Z,checkinMinutes:Number(P.target.value)}))})]})]}),I.game==="X01"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"X01 Starting Score"}),e.jsx("select",{className:"input w-full",value:String(I.startingScore),onChange:P=>N(Z=>({...Z,startingScore:Number(P.target.value)})),children:[301,501,701].map(P=>e.jsx("option",{value:P,children:P},P))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Capacity"}),e.jsx("input",{className:"input w-full",type:"number",min:6,max:64,value:I.capacity,onChange:P=>N(Z=>({...Z,capacity:Number(P.target.value)}))})]}),e.jsx("div",{className:"text-xs opacity-70",children:"Note: community tournaments do not award prizes."}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"btn",disabled:r,onClick:O,children:"Create"})})]})]})}),p.open&&p.t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>g({open:!1,t:null})}),e.jsxs("div",{className:"relative card p-4 w-[360px] max-w-[90vw]",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Leave tournament?"}),e.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Are you sure you want to remove yourself from “",p.t.title,"”?"]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>g({open:!1,t:null}),children:"Decline"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const P=p.t;g({open:!1,t:null}),await Y(P)},children:"Accept"})]})]})]}),S.open&&S.t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold mb-4 text-white",children:"Delete Tournament"}),e.jsxs("div",{className:"text-slate-300 mb-6",children:["Are you sure you want to delete ",e.jsxs("span",{className:"font-semibold text-white",children:['"',S.t.title,'"']}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-sm text-slate-400",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",onClick:()=>M({open:!1,t:null}),children:"Decline"}),e.jsx("button",{className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",onClick:y,children:"Continue"})]})]})})})]})}function Em({user:t}){const[a,s]=m.useState(null),[i,n]=m.useState(!0),[r,l]=m.useState(null),o="http://localhost:8787",d=wn();if(m.useEffect(()=>{(async()=>{try{const u=t?.email?`?email=${encodeURIComponent(t.email)}`:"",x=await fetch(`${o}/api/subscription`+u);if(!x.ok)throw new Error("Failed to fetch subscription");const p=await x.json();s(p)}catch(u){l(u instanceof Error?u.message:"Something went wrong")}finally{n(!1)}})()},[t?.email]),i)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-4"}),e.jsx("p",{children:"Loading subscription..."})]})});if(r)return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-300 mb-2",children:"Subscription Error"}),e.jsx("p",{className:"mb-4 text-red-200",children:r}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn bg-red-600 hover:bg-red-700",children:"Retry"})]});const c=a?.fullAccess;return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-300 mb-2",children:c?"PREMIUM Active":"PREMIUM"}),c?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 text-green-300 font-semibold mb-2",children:"✅ PREMIUM Access Active"}),e.jsx("p",{className:"text-green-200 text-sm",children:"You have full access to all premium features!"}),a?.source&&e.jsxs("p",{className:"text-green-200 text-xs mt-1",children:["Source: ",a.source,a?.expiresAt&&` (expires: ${new Date(a.expiresAt).toLocaleDateString()})`]})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-indigo-200",children:"Your Benefits:"})]}):e.jsx("p",{className:"mb-2 text-indigo-200",children:"Unlock every game mode known to darts, advanced stats, and premium features."}),e.jsxs("ul",{className:"mb-4",children:[e.jsx("li",{children:"All game modes (including paid/advanced)"}),e.jsx("li",{children:"Online play with all rules and variations"}),e.jsx("li",{children:"Advanced analytics and leaderboards"}),e.jsx("li",{children:"Premium camera modes and autoscoring"})]}),!c&&e.jsx("button",{onClick:async()=>{try{const u=await(await fetch(`${o}/api/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})})).json();u.ok&&u.url?window.location.href=u.url:u.error==="STRIPE_NOT_CONFIGURED"?d("Premium purchases are not available. Payment link not configured.",{type:"error",timeout:4e3}):d("Failed to get payment link. Please try again.",{type:"error",timeout:4e3})}catch{d("Error creating checkout. Please try again.",{type:"error",timeout:4e3})}},className:"btn bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold shadow-lg hover:scale-105 transition",children:"Subscribe to PREMIUM"})]})}function Tm({open:t,onClose:a,width:s=700,title:i,footer:n,children:r,side:l="right"}){return m.useEffect(()=>{function o(d){d.key==="Escape"&&a()}return t&&document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t,a]),e.jsxs("div",{className:`fixed inset-0 z-50 ${t?"":"pointer-events-none"}`,"aria-hidden":!t,children:[e.jsx("div",{className:`absolute inset-0 bg-black/60 transition-opacity ${t?"opacity-100":"opacity-0"}`,onClick:a}),e.jsxs("div",{className:`absolute top-0 ${l==="right"?"right-0 border-l":"left-0 border-r"} h-full bg-slate-900 border-slate-700 shadow-2xl w-full sm:w-auto flex flex-col transition-transform duration-200 ${t?"translate-x-0":l==="right"?"translate-x-full":"-translate-x-full"}`,style:{width:typeof s=="number"?`${s}px`:s},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-700 sticky top-0 bg-slate-900 z-10",children:[e.jsx("div",{className:"text-lg font-semibold",children:i}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:a,children:"Close"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:r}),n&&e.jsx("div",{className:"px-4 py-3 border-t border-slate-700 sticky bottom-0 bg-slate-900 z-10",children:n})]})]})}function Im({user:t}){const a=jo(t?.email),[s,i]=m.useState(null),[n,r]=m.useState(""),[l,o]=m.useState("");async function d(){try{const u=await kt("/readyz");i(await u.json())}catch{}}if(m.useEffect(()=>{d();const u=setInterval(d,5e3);return()=>clearInterval(u)},[]),!a)return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Ops"}),e.jsx("div",{children:"Restricted"})]});async function c(u){o("");try{const x=await kt("/api/admin/maintenance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:u,requesterEmail:t?.email})}),p=await x.json();!x.ok||!p?.ok?o(p?.error||"Failed"):o(`Maintenance ${u?"enabled":"disabled"}`)}catch{o("Network error")}}async function f(){o("");const u=n.trim();if(u)try{const x=await kt("/api/admin/announce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:u,requesterEmail:t?.email})}),p=await x.json();!x.ok||!p?.ok?o(p?.error||"Failed"):o("Announcement broadcasted"),r("")}catch{o("Network error")}}return e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-700 mb-2",children:"Ops"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Readiness"}),e.jsxs("div",{className:"text-sm",children:["HTTP: ",e.jsx("span",{className:`font-semibold ${s?.ok?"text-emerald-300":"text-rose-300"}`,children:String(!!s?.ok)})]}),e.jsxs("div",{className:"text-sm",children:["WS: ",e.jsx("span",{className:`font-semibold ${s?.ws?"text-emerald-300":"text-rose-300"}`,children:String(!!s?.ws)})]}),e.jsxs("div",{className:"text-sm",children:["Clients: ",e.jsx("span",{className:"font-semibold",children:s?.clients??0})]}),e.jsxs("div",{className:"text-sm",children:["Rooms: ",e.jsx("span",{className:"font-semibold",children:s?.rooms??0})]}),e.jsxs("div",{className:"text-sm",children:["Heap Used: ",e.jsxs("span",{className:"font-semibold",children:[s?.mem?Math.round(s.mem.heapUsed/1024/1024):0," MB"]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Maintenance"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>c(!0),children:"Enable"}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>c(!1),children:"Disable"})]})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Announcement"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Message to broadcast",value:n,onChange:u=>r(u.target.value)}),e.jsx("button",{className:"btn",onClick:f,children:"Send"})]})]})]}),l&&e.jsx("div",{className:"text-xs mt-2",children:l}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"✅ Clustering enabled! For 1.5k+ concurrent users, deploy behind a reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets. Set NODE_WORKERS environment variable to control worker count."})]})}function Dm({}){const[t,a]=m.useState(!1),[s,i]=m.useState([{text:"Hi! I'm your Nine Dart Nation assistant. How can I help you today?",isUser:!1}]),[n,r]=m.useState(""),l=c=>{try{window.dispatchEvent(new CustomEvent("ndn:change-tab",{detail:{tab:c}})),a(!1)}catch(f){console.error("Navigation failed:",f)}},o=c=>{const f=c.toLowerCase();return f.includes("username")||f.includes("change name")?{text:"You can change your username once for free.",links:[{text:"Go to Settings > Account",tab:"settings"}]}:f.includes("premium")||f.includes("upgrade")||f.includes("subscription")?{text:"Premium unlocks all game modes and features.",links:[{text:"Go to Online Play",tab:"online"}]}:f.includes("calibrat")||f.includes("camera")||f.includes("vision")?{text:"Set up your camera properly in Settings.",links:[{text:"Go to Settings > Camera & Vision",tab:"settings"}]}:f.includes("voice")||f.includes("caller")||f.includes("audio")?{text:"Enable voice calling in Settings.",links:[{text:"Go to Settings > Audio & Voice",tab:"settings"}]}:f.includes("friend")||f.includes("play together")?{text:"Add friends to play together.",links:[{text:"Go to Friends",tab:"friends"}]}:f.includes("stat")||f.includes("score")||f.includes("performance")?{text:"View your statistics and performance.",links:[{text:"Go to Stats",tab:"stats"}]}:f.includes("setting")||f.includes("customiz")||f.includes("configur")?{text:"Customize your experience.",links:[{text:"Go to Settings",tab:"settings"}]}:f.includes("tournament")||f.includes("competition")?{text:"Check out tournaments and competitions.",links:[{text:"Go to Tournaments",tab:"tournaments"}]}:f.includes("help")||f.includes("support")||f.includes("faq")?{text:"You're already in the help section! Check Settings for more resources.",links:[{text:"Go to Settings > Support",tab:"settings"}]}:f.includes("how to play")||f.includes("game")||f.includes("start")?{text:"To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.",links:[{text:"Play Online",tab:"online"},{text:"Play Offline",tab:"offline"}]}:{text:"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings."}},d=()=>{if(!n.trim())return;const c=n.toLowerCase();i(u=>[...u,{text:n,isUser:!0}]),r("");const f=o(c);setTimeout(()=>{i(u=>[...u,{text:f,isUser:!1}])},500)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-colors",title:"Help Assistant",children:e.jsx(ho,{className:"w-6 h-6"})}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-end p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsxs("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-md h-96 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(jn,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"font-semibold",children:"Help Assistant"})]}),e.jsx("button",{onClick:()=>a(!1),className:"text-slate-400 hover:text-white",children:e.jsx(Vl,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:s.map((c,f)=>e.jsx("div",{className:`flex ${c.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg ${c.isUser?"bg-blue-600 text-white":"bg-slate-700 text-slate-200"}`,children:typeof c.text=="string"?c.text:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:c.text.text}),c.text.links&&e.jsx("div",{className:"space-y-1",children:c.text.links.map((u,x)=>e.jsx("button",{onClick:()=>l(u.tab),className:"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm",children:u.text},x))})]})})},f))}),e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:c=>r(c.target.value),onKeyPress:c=>c.key==="Enter"&&d(),placeholder:"Ask me anything...",className:"flex-1 input"}),e.jsx("button",{onClick:d,className:"btn bg-blue-600 hover:bg-blue-700",children:e.jsx(fo,{className:"w-4 h-4"})})]})})]})]})]})}function Mm(){const t=m.useRef(null),[a,s]=m.useState(""),[i,n]=m.useState(!1),[r,l]=m.useState(null),o=(()=>{try{return Tr()}catch{return null}})(),[d,c]=m.useState("score"),[f,u]=m.useState(!1),[x,p]=m.useState(!1),[g,S]=m.useState(null),[M,I]=m.useState(0),{avgMode:N}=ls();m.useEffect(()=>{const D=localStorage.getItem("authToken");D&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${D}`}}).then(b=>b.json()).then(b=>{b?.user?(S(b.user),E(b.user)):localStorage.removeItem("authToken")}).catch(()=>{})},[]),m.useEffect(()=>{const D=()=>{try{localStorage.removeItem("mockUser"),localStorage.removeItem("authToken")}catch{}S(null),c("score")};return window.addEventListener("ndn:logout",D),()=>window.removeEventListener("ndn:logout",D)},[]),m.useEffect(()=>{if(!g?.username)return;const D=()=>I(N==="24h"?Tc(g.username):Ys(g.username));D();const k=()=>D();return window.addEventListener("ndn:stats-updated",k),()=>window.removeEventListener("ndn:stats-updated",k)},[g?.username,N]),m.useEffect(()=>{if(!g?.username){s("");return}const D=localStorage.getItem(`ndn:bio:profilePhoto:${g.username}`);s(D||"")},[g?.username]),m.useEffect(()=>{const D=$=>{$.key?.startsWith("ndn:bio:profilePhoto:")&&g?.username&&$.key.endsWith(g.username)&&s($.newValue||"")},k=$=>{if($.detail?.username===g?.username&&s($.detail?.avatar||""),g?.username){const Y=localStorage.getItem(`ndn:bio:profilePhoto:${g.username}`);s(Y||"")}},b=()=>{if(!document.hidden&&g?.username){const $=localStorage.getItem(`ndn:bio:profilePhoto:${g.username}`);s($||"")}},y=setInterval(()=>{if(g?.username){const $=localStorage.getItem(`ndn:bio:profilePhoto:${g.username}`);$&&$!==a&&s($)}},2e3);return window.addEventListener("storage",D),window.addEventListener("ndn:avatar-updated",k),document.addEventListener("visibilitychange",b),()=>{window.removeEventListener("storage",D),window.removeEventListener("ndn:avatar-updated",k),document.removeEventListener("visibilitychange",b),clearInterval(y)}},[g?.username,a]),m.useEffect(()=>{const D=new URLSearchParams(window.location.search),k=D.get("paid"),b=D.get("username-change");if(k==="1"||k==="username-change"||b==="free"){const y=localStorage.getItem("pendingUsernameChange");y&&g?.email&&fetch("http://localhost:8787/api/change-username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:g.email,newUsername:y})}).then(Y=>Y.json()).then(Y=>{Y.ok?(alert("Username changed successfully!"),localStorage.removeItem("pendingUsernameChange"),Y.token&&localStorage.setItem("authToken",Y.token),Y.user&&S(Y.user),window.history.replaceState({},document.title,window.location.pathname)):alert("Failed to change username: "+(Y.error||"Unknown error"))}).catch(()=>{alert("Network error while changing username")})}},[g?.email]),m.useEffect(()=>{new URLSearchParams(window.location.search).get("subscription")==="success"&&g?.email&&fetch("http://localhost:8787/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}).then(y=>y.json()).then(y=>{y?.user&&(S(y.user),alert("Premium subscription activated successfully!"),window.history.replaceState({},document.title,window.location.pathname))}).catch(()=>{alert("Subscription activated, but failed to refresh user data. Please refresh the page.")})},[g?.email]),m.useEffect(()=>{const D=()=>{const y=window.innerWidth,$=window.matchMedia("(max-width: 768px)").matches,Y=window.matchMedia("(max-width: 1024px) and (min-width: 769px)").matches,O=/Mobi|Android|iPhone|iPad|iPod|Mobile|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent||""),_=/iPad|Android(?=.*\bMobile\b)|Tablet|PlayBook|Silk/i.test(navigator.userAgent||""),T="ontouchstart"in window||navigator.maxTouchPoints>0,H=y<769,ae=Y&&T||_||y>=769&&y<=1024&&T,Z=$||O||H||y<769&&T||ae;u(Z)};D(),window.addEventListener("resize",D),window.addEventListener("orientationchange",D);const k=window.matchMedia("(max-width: 768px)"),b=window.matchMedia("(max-width: 1024px) and (min-width: 769px)");try{k.addEventListener("change",D),b.addEventListener("change",D)}catch{}return()=>{window.removeEventListener("resize",D),window.removeEventListener("orientationchange",D);try{k.removeEventListener("change",D),b.removeEventListener("change",D)}catch{}}},[]),m.useEffect(()=>{const D=()=>{try{localStorage.removeItem("ndn:avatar")}catch{}S(null),c("score")};return window.addEventListener("ndn:logout",D),()=>window.removeEventListener("ndn:logout",D)},[]),m.useEffect(()=>{const D=k=>{try{const b=String(k?.detail?.username||"").trim();if(!b)return;S(y=>y&&{...y,username:b});try{const y=(g?.email||"").toLowerCase();o&&b&&y&&o.send({type:"presence",username:b,email:y})}catch{}}catch{}};return window.addEventListener("ndn:username-changed",D),()=>window.removeEventListener("ndn:username-changed",D)},[o,g?.email]),m.useEffect(()=>{const D=k=>{try{const b=String(k?.detail?.tab||"").trim();b&&["score","offline","online","stats","settings","admin","tournaments","friends"].includes(b)&&c(b)}catch{}};return window.addEventListener("ndn:change-tab",D),()=>window.removeEventListener("ndn:change-tab",D)},[]);async function E(D){try{const k=D?.email?`?email=${encodeURIComponent(D.email)}`:"",b=await fetch("/api/subscription"+k);if(!b.ok)return;const y=await b.json();S({...D,fullAccess:!!y?.fullAccess})}catch{}}if(!g)return e.jsx(pm,{onAuth:D=>{S(D),E(D)}});const A=`https://ui-avatars.com/api/?name=${encodeURIComponent(g.username||"NDN")}&background=8F43EE&color=fff&bold=true&rounded=true&size=64`;return e.jsxs(gm,{children:[e.jsxs("div",{ref:t,className:`${g?.fullAccess?"premium-body":""} h-screen overflow-hidden p-1 xs:p-2 sm:p-3 md:p-4`,children:[e.jsx(dm,{}),e.jsxs("div",{className:"max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-[auto,1fr] gap-2 xs:gap-3 sm:gap-4 h-full overflow-hidden",children:[!f&&e.jsx("div",{className:"relative hidden lg:block",style:{width:240},children:e.jsx(So,{active:d,onChange:D=>{c(D)},user:g})}),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"pt-1 xs:pt-2",children:e.jsxs("header",{id:"ndn-header",className:"header glass flex-col xs:flex-col sm:flex-row gap-2 xs:gap-2 sm:gap-3",children:[e.jsx("div",{className:"flex items-center gap-2 order-1",children:e.jsx("h1",{className:"text-lg xs:text-xl sm:text-xl md:text-2xl font-bold text-brand-700 whitespace-nowrap cursor-pointer select-none",onClick:()=>{f&&c("score")},title:f?"Go Home":void 0,children:"NINE-DART-NATION 🎯"})}),e.jsxs("div",{className:"order-3 xs:order-3 sm:order-2 w-full sm:w-auto flex-1 flex flex-col items-center justify-center text-center sm:text-left !text-black",children:[e.jsxs("span",{className:"text-sm xs:text-base sm:text-base md:text-lg font-semibold flex items-center gap-2 max-w-full truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[e.jsx("span",{className:"hidden xs:inline !text-black",children:"Welcome"}),e.jsx("img",{src:a||A,alt:"avatar",className:"w-5 h-5 xs:w-6 xs:h-6 sm:w-6 sm:h-6 md:w-7 md:h-7 rounded-full ring-2 ring-white/20"}),e.jsxs("span",{className:"truncate !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:[g.username,"🎯"]})]}),e.jsxs("span",{className:"hidden xs:inline text-xs xs:text-xs sm:text-xs md:text-sm !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:["All-time 3-dart avg: ",e.jsx("span",{className:"font-semibold !text-black",style:{color:"#000000",WebkitTextFillColor:"#000000"},children:M.toFixed(2)})]}),f&&e.jsx("button",{className:"btn px-3 py-1 xs:px-3 xs:py-1 sm:px-3 sm:py-1 mt-1 text-sm xs:text-sm","aria-label":"Open navigation",onClick:()=>p(!0),children:"☰ Menu"})]}),e.jsxs("div",{className:"order-2 md:order-3 ml-0 md:ml-auto flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"px-3 py-1 text-sm rounded-full bg-white/5 hover:bg-white/10 border border-white/10",onClick:()=>{const D=t.current;D&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):D.requestFullscreen().catch(()=>{}))},title:i?"Exit Full Screen":"Enter Full Screen",children:i?"Exit Full Screen":"Full Screen"}),d==="online"&&e.jsx("button",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40",title:"Open a simulated online match",onClick:()=>{setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("ndn:online-match-demo",{detail:{game:"X01",start:501}}))}catch{}},40)},children:"ONLINE DEMO"}),o?e.jsx("span",{className:"ml-0 md:ml-2",children:e.jsx(vm,{status:o.status})}):null,r?.https?e.jsx("span",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/40",title:`Phone HTTPS active on :${r.port}`,children:"HTTPS READY"}):e.jsx("span",{className:"text-[10px] md:text-xs px-3 py-1 rounded-full bg-slate-600/30 text-slate-300 border border-slate-400/30",title:"Enable HTTPS for iPhone camera pairing",children:"HTTP ONLY"})]})]})}),f&&e.jsx(Am,{open:x,onClose:()=>p(!1),active:d,onChange:D=>{c(D),p(!1)},user:g}),e.jsxs("main",{id:"ndn-main-scroll",className:"space-y-4 flex-1 overflow-y-auto pr-1",children:[d==="settings"&&e.jsx(Ds,{children:e.jsx(fm,{user:g})}),d==="score"&&e.jsx(Ds,{children:e.jsx(Mc,{user:g})}),d==="online"&&e.jsx(Ds,{children:e.jsx(wm,{user:g})}),d==="offline"&&e.jsx(Ds,{children:e.jsx(am,{user:g})}),d==="calibrate"&&e.jsx(Ds,{children:e.jsx(Od,{})}),d==="friends"&&e.jsx(Ds,{children:e.jsx(cm,{user:g})}),d==="stats"&&e.jsx(Ds,{children:e.jsx(km,{user:g})}),d==="tournaments"&&e.jsx(Ds,{children:e.jsx(Cm,{user:g})}),d==="admin"&&e.jsx(Ds,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(hm,{user:g}),e.jsx(Im,{user:g})]})}),d==="fullaccess"&&e.jsx(Ds,{children:e.jsx(Em,{user:g})})]})]})]})]}),e.jsx(Dm,{})]})}function Am({open:t,onClose:a,active:s,onChange:i,user:n}){return e.jsx(Tm,{open:t,onClose:a,width:320,side:"left",title:"Navigate",children:e.jsx("div",{className:"mt-2",children:e.jsx(So,{active:s,onChange:i,user:n,className:"flex relative static max-h-[80vh] w-full"})})})}function Pm(t){return t.length>=10&&/\d/.test(t)&&/[^A-Za-z0-9]/.test(t)}function Rm(){const[t,a]=m.useState(""),[s,i]=m.useState(""),[n,r]=m.useState(""),[l,o]=m.useState(""),[d,c]=m.useState("");m.useEffect(()=>{try{const x=new URLSearchParams(window.location.search).get("token")||"";a(x)}catch{}},[]);async function f(u){if(u.preventDefault(),o(""),c(""),!t){o("Missing or invalid reset token.");return}if(!s||s!==n){o("Passwords do not match.");return}if(!Pm(s)){o("Password must be at least 10 chars and include a number and symbol.");return}try{const p=await(await fetch("/api/auth/confirm-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,newPassword:s})})).json();if(!p?.ok)throw new Error(p?.error||"Reset failed");c("Password changed. You can now sign in.")}catch(x){o(x?.message||"Reset failed")}}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"background-animated"}),e.jsx("div",{className:"relative z-10 w-full max-w-lg mx-auto p-4",children:e.jsxs("form",{className:"card w-full space-y-4",onSubmit:f,children:[e.jsx("div",{className:"flex flex-col items-center justify-center gap-2 mb-2 text-center",children:e.jsx("h1",{className:"logo text-center",children:"Reset your password"})}),!t&&e.jsx("div",{className:"text-red-400",children:"This reset link is missing a token. Please use the link from your email."}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"New password",value:s,onChange:u=>i(u.target.value),required:!0}),e.jsx("input",{className:"input w-full",type:"password",placeholder:"Confirm password",value:n,onChange:u=>r(u.target.value),required:!0}),l&&e.jsx("div",{className:"text-red-400 font-semibold text-sm",children:l}),d&&e.jsx("div",{className:"text-emerald-400 font-semibold text-sm",children:d}),e.jsx("button",{className:"btn w-full",type:"submit",disabled:!t,children:"Change Password"}),e.jsx("a",{className:"underline text-sm text-center",href:"/",children:"Back to sign in"})]})})]})}class Lm extends m.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,message:String(a?.message||a)}}componentDidCatch(a,s){console.error("[ErrorBoundary]",a,s)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"card max-w-lg w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"opacity-80 mb-4",children:"Please refresh the page. If this persists, let us know."}),this.state.message&&e.jsx("pre",{className:"text-xs bg-black/40 rounded p-2 overflow-auto text-left",children:this.state.message}),e.jsx("button",{className:"btn mt-4",onClick:()=>window.location.reload(),children:"Reload"})]})}):this.props.children}}try{window.React=window.React||{}}catch{}lc();Xl.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(Lm,{children:e.jsx(ym,{children:e.jsx(Om,{})})})}));function Om(){return window.location.pathname==="/reset"?e.jsx(Rm,{}):e.jsx(Mm,{})}
//# sourceMappingURL=index-C9daSz3Z.js.map

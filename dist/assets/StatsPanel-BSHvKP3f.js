import{k as se,d as te,K as G,N as re,c as ae,b as N,O as D,Q as le,j as e,T as ie,g as x,S as $,U as B,V as ne}from"./index-CsbjW7wY.js";import{f as i}from"./stats-X3jz_E9o.js";import{r as n}from"./ui-DwoKAdU7.js";import"./vendor-D3F3s8fL.js";function ve({user:W}){const{players:y,inProgress:I,startingScore:de,newMatch:oe}=se(),[m,E]=n.useState("x01"),[ce,he]=n.useState("Player 1, Player 2"),[xe,me]=n.useState(501),[g,q]=n.useState(""),[k,U]=n.useState([]),[l,S]=n.useState(""),[v,F]=n.useState(!1),[A,Y]=n.useState(""),[L,P]=n.useState([]),[z,O]=n.useState(!1),j=n.useRef(null),d=String(W?.email||"").toLowerCase(),Q=["Daily","Monthly","All-Time"],[b,H]=n.useState("Daily");n.useEffect(()=>{if(!v||!d)return;let s=!1;async function r(){try{const h=await(await fetch(`/api/friends/list?email=${encodeURIComponent(d)}`)).json().catch(()=>({friends:[]}));s||U(h.friends||[])}catch{}}r();const t=window.setInterval(r,2e4);return()=>{s=!0,clearInterval(t)}},[d,v]),n.useEffect(()=>{try{const s=d?`ndn:stats:opponent:${d}`:"ndn:stats:opponent",r=localStorage.getItem(s);r&&S(r)}catch{}},[d]),n.useEffect(()=>{try{const s=d?`ndn:stats:opponent:${d}`:"ndn:stats:opponent";l?localStorage.setItem(s,l):localStorage.removeItem(s)}catch{}},[l,d]);const R=n.useCallback(s=>{if(Y(s),!s.trim()){P([]);return}v&&(j.current&&clearTimeout(j.current),j.current=window.setTimeout(async()=>{O(!0);try{const t=await(await fetch(`/api/friends/search?q=${encodeURIComponent(s)}`)).json().catch(()=>({results:[]}));P(t.results||[])}finally{O(!1)}},350))},[v]);n.useEffect(()=>()=>{j.current&&clearTimeout(j.current)},[]);const p=n.useMemo(()=>{const s=new Map;if(m==="x01")for(const t of y)for(const a of t.legs)for(const h of a.visits){const w=Math.max(0,Math.min(180,h.score));s.set(w,(s.get(w)??0)+1)}const r=Array.from(s.entries()).sort((t,a)=>t[0]-a[0]);return r.length===0&&m==="x01"?([0,26,41,60,81,100,120,140,160,180].forEach(t=>s.set(t,0)),Array.from(s.entries()).sort((t,a)=>t[0]-a[0]).map(([t,a])=>({label:t,value:a}))):r.map(([t,a])=>({label:t,value:a}))},[y,m]),C=n.useMemo(()=>{const s=te(G);return G.map(r=>{const t=s[r]||{played:0,won:0};return{label:r,value:t.played,extra:t.won}})},[m]),c=n.useMemo(()=>{if(!p.length)return null;let s=0,r=p[0],t=p[0];for(const a of p)s+=a.value,a.value>r.value&&(r=a),a.value<t.value&&(t=a);return{total:s,most:r,least:t}},[p]),T=n.useMemo(()=>d?re(d):[],[d]),K=n.useMemo(()=>d?ae(d):0,[d]),X=n.useMemo(()=>{if(!d)return 0;switch(b){case"Daily":return le(d);case"Monthly":return D(d);default:return N(d)}},[d,b]),f=n.useMemo(()=>{if(!T.length)return[];const s=Date.now(),r=1e3*60*60*24,t=r*30,a=b==="Daily"?r:b==="Monthly"?t:Number.POSITIVE_INFINITY,h=T.filter(o=>a===Number.POSITIVE_INFINITY||s-o.t<=a).map(o=>({t:o.t,value:o.darts?o.scored/o.darts*3:0})).sort((o,u)=>o.t-u.t);if(!h.length)return[];const M=Math.max(1,Math.floor(h.length/32));return h.filter((o,u)=>u%M===0||u===h.length-1)},[T,b]),V=n.useMemo(()=>{if(!f.length)return"";const s=220,r=40,t=f.map(o=>o.value),a=Math.min(...t),w=Math.max(...t)-a||1,M=f.length;return f.map((o,u)=>{const J=M===1?s/2:u/(M-1)*s,Z=(o.value-a)/w,ee=r-Z*r;return`${J},${ee}`}).join(" ")},[f]),_=n.useMemo(()=>`ndn-stats-sparkline-${Math.random().toString(36).slice(2)}`,[]);return n.useEffect(()=>{const s=()=>E(r=>r);return window.addEventListener("ndn:stats-updated",s),()=>window.removeEventListener("ndn:stats-updated",s)},[]),e.jsxs("div",{className:"card ndn-game-shell ndn-page",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-2xl font-extrabold text-white ndn-section-title",children:"Match Stats ðŸŽ¯"}),e.jsx("span",{className:"text-xs opacity-70",children:"View ðŸŽ¯"})]}),e.jsx(ie,{tabs:[{key:"x01",label:"X01 ðŸŽ¯"},{key:"other",label:"Other Modes ðŸŽ¯"}],active:m,onChange:s=>E(s)})]}),I&&e.jsx("div",{className:"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200",children:"Note: Detailed leg stats are finalized at the end of the game."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[y.map((s,r)=>e.jsxs("div",{className:"p-4 rounded-2xl border border-indigo-500/20 bg-gradient-to-br from-indigo-700/6 to-indigo-900/6 shadow-sm transform transition-transform duration-200 hover:-translate-y-1 hover:shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:r===1&&!l?s.name||"Opponent":r===1&&l?l:s.name}),r===1&&e.jsxs("div",{className:"flex gap-2 items-center overflow-x-auto py-1",children:[e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10",onClick:()=>F(t=>!t),title:"Search user to compare",children:"Select Friend ðŸŽ¯"}),k.slice(0,6).map(t=>{const a=t.username||t.email,h=l===a;return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${h?"bg-indigo-500/30 border-indigo-400/50":"bg-white/6 border-white/8 hover:bg-white/10 transform hover:-translate-y-0.5 transition-all duration-150"}`,onClick:()=>S(a),title:`Compare vs ${a}`,children:a},t.email)}),k.length===0&&e.jsx("button",{className:"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10",disabled:!0,children:"Find friends to compare"})]})]}),r===1&&v&&e.jsxs("div",{className:"mb-2 p-2 rounded-lg bg-black/20 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{className:"input flex-1 py-1",placeholder:"Search by name or email",value:A,onChange:t=>R(t.target.value)}),e.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>R(A),disabled:z,children:"Search ðŸŽ¯"})]}),e.jsxs("ul",{className:"max-h-40 overflow-auto space-y-1",children:[L.map(t=>{const a=t.username||t.email;return e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm",onClick:()=>{S(a),F(!1)},children:a})},t.email)}),!L.length&&e.jsx("li",{className:"text-xs opacity-70",children:A.trim()?"No results":"Type to searchâ€¦"})]})]}),r===1&&l?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:i(x(l).best3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:i(x(l).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const t=x(l);return t.bestLegDarts?`${t.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:x(l).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",i(N(l))," Â·"," ",i(D(l))]}),e.jsxs("span",{children:["First 9: ",i($(l))," Â·"," ",i(B(l))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const t=x(l);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",i(t.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",i(t.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",t.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",t.bestCheckout||0]})]})})()]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:i(s.bestThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:i(s.worstThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:s.bestNineDart?`${s.bestNineDart.darts} darts`:"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:s.bestCheckout??"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",i(N(s.name))," Â·"," ",i(D(s.name))]}),e.jsxs("span",{children:["First 9: ",i($(s.name))," Â·"," ",i(B(s.name))]})]})]}),I&&e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Current 3-Dart (live)"}),e.jsx("div",{className:"font-semibold",children:i(s.currentThreeDartAvg)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const t=x(s.name);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",i(t.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",i(t.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",t.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",t.bestCheckout||0]})]})})()]})]})]},s.id)),y.length<=1&&e.jsxs("div",{className:"p-3 rounded-2xl border border-purple-500/20 bg-gradient-to-r from-purple-800/6 to-pink-800/6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Opponent"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.slice(0,6).map(s=>{const r=s.username||s.email,t=l===(s.username||s.email);return e.jsx("button",{className:`text-[11px] px-3 py-1 rounded-full border ${t?"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-transparent shadow-sm":"bg-gradient-to-r from-purple-500/8 to-pink-500/8 border-white/10 hover:from-purple-500/12 hover:to-pink-500/12"}`,onClick:()=>S(r),title:`Compare vs ${r}`,children:r},s.email)}),k.length===0&&e.jsx("span",{className:"text-xs opacity-70",children:"Add friends to compare stats."})]})]}),l?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Comparing to"}),e.jsx("div",{className:"font-semibold",children:l})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 3-Dart"}),e.jsx("div",{className:"font-semibold",children:i(N(l))})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Worst 3-Dart"}),e.jsx("div",{className:"font-semibold",children:i(x(l).worst3||0)})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best 9-Dart (fewest darts)"}),e.jsx("div",{className:"font-semibold",children:(()=>{const s=x(l);return s.bestLegDarts?`${s.bestLegDarts} darts`:"â€”"})()})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-slate-300",children:"Best Checkout"}),e.jsx("div",{className:"font-semibold",children:x(l).bestCheckout||"â€”"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"Averages (All-time vs Monthly)"}),e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["3-dart: ",i(N(l))," Â·"," ",i(D(l))]}),e.jsxs("span",{children:["First 9: ",i($(l))," Â·"," ",i(B(l))]})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2",children:[e.jsx("div",{className:"text-slate-300",children:"All-time snapshot"}),(()=>{const s=x(l);return e.jsxs("div",{className:"font-semibold flex flex-wrap gap-3 text-[13px]",children:[e.jsxs("span",{children:["Best 3-dart: ",i(s.best3||0)]}),e.jsxs("span",{children:["Worst 3-dart: ",i(s.worst3||0)]}),e.jsxs("span",{children:["Best leg: ",s.bestLegDarts||0," darts"]}),e.jsxs("span",{children:["Best checkout: ",s.bestCheckout||0]})]})})()]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Select a friend above to compare."})]})]}),m!=="other"?e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Score Distribution (",m.toUpperCase(),"): Visits by scored points"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] uppercase tracking-widest text-slate-300",children:[Q.map(s=>e.jsx("button",{className:`px-3 py-1 rounded-full border transition-all duration-200 ${b===s?"bg-white/20 border-white/40 text-white":"bg-white/5 border-white/10 text-slate-200"}`,onClick:()=>H(s),children:s},s)),e.jsx("span",{className:"text-xs opacity-50",children:"sparkline window"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs text-slate-300",children:[e.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 p-3",children:[e.jsx("div",{className:"text-[10px] uppercase opacity-70",children:"Average"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:i(X)}),e.jsx("div",{className:"text-[10px] opacity-50",children:b})]}),e.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 p-3",children:[e.jsx("div",{className:"text-[10px] uppercase opacity-70",children:"Rolling 24h"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:i(K)}),e.jsx("div",{className:"text-[10px] opacity-50",children:"live trend"})]}),e.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 p-3",children:[e.jsx("div",{className:"text-[10px] uppercase opacity-70",children:"Visits"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:c?c.total:0}),e.jsx("div",{className:"text-[10px] opacity-50",children:"Match legs"})]}),e.jsxs("div",{className:"rounded-lg bg-white/5 border border-white/10 p-3",children:[e.jsx("div",{className:"text-[10px] uppercase opacity-70",children:"Range"}),e.jsx("div",{className:"text-[10px] text-slate-200",children:c?`${c.most.label} â†’ ${c.least.label}`:"â€”"}),e.jsx("div",{className:"text-[10px] opacity-50",children:"Most â†’ Least"})]})]}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3",children:V?e.jsxs("svg",{viewBox:"0 0 220 40",className:"w-full h-12",role:"presentation",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:_,x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"#a855f7",stopOpacity:"0.35"}),e.jsx("stop",{offset:"100%",stopColor:"#ec4899",stopOpacity:"0.9"})]})}),e.jsx("polyline",{fill:"none",stroke:`url(#${_})`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",points:V})]}):e.jsx("div",{className:"text-xs text-slate-400",children:"No historical trend data yet. Finish more legs to seed the sparkline."})}),e.jsxs("div",{className:"flex flex-wrap justify-between text-[11px] text-slate-300/80",children:[e.jsxs("span",{children:["Most frequent:"," ",c?`${c.most.label} (${c.most.value})`:"â€”"]}),e.jsxs("span",{children:["Least frequent:"," ",c?`${c.least.label} (${c.least.value})`:"â€”"]})]}),e.jsx("div",{className:"rounded-xl border border-indigo-500/20 p-3 min-h-[220px] transform transition-shadow duration-200 hover:shadow-lg overflow-y-auto",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)",scrollbarColor:"#8F43EE #18122B"},children:e.jsx(ne,{data:p,showValues:!1})})]}):g&&C.find(s=>s.label===g)?e.jsx("div",{className:"mt-6",children:(()=>{const s=C.find(r=>r.label===g);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 text-sm opacity-80",children:["Game Stats for ",s.label]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Games Played"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:s.value})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Games Won"}),e.jsx("div",{className:"text-3xl font-bold text-green-400",children:s.extra})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/10 border border-white/20",children:[e.jsx("div",{className:"text-slate-300 text-sm mb-1",children:"Win Rate"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[s.value>0?(s.extra/s.value*100).toFixed(1):0,"%"]})]})]})]})})()}):null,m==="other"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm opacity-80 mb-3",children:"Other Modes: Click a game to view stats"}),e.jsx("div",{className:"rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar flex-wrap",children:C.map(s=>e.jsxs("button",{onClick:()=>q(s.label),className:`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] ${g===s.label?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gradient-to-r from-slate-700 to-slate-600 text-white hover:from-slate-600 hover:to-slate-500"}`,children:[s.label," ðŸŽ¯"]},s.label))})]}),!g&&e.jsx("div",{className:"rounded-xl border border-indigo-500/20 p-4",style:{background:"linear-gradient(135deg, #393053 0%, #635985 100%)"},children:e.jsx("div",{className:"text-center text-slate-300",children:"Select a game mode above to view detailed stats"})})]})]})}export{ve as default};
//# sourceMappingURL=StatsPanel-BSHvKP3f.js.map

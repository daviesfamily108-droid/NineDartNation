{"version":3,"file":"Scoreboard-DdftkZAu.js","sources":["../../src/components/Scoreboard.tsx"],"sourcesContent":["import { useMatch } from \"../store/match\";\r\nimport { formatAvg } from \"../utils/stats\";\r\n// Icons not used directly in Scoreboard; MatchControls has its own icons\r\nimport MatchControls from \"./MatchControls\";\r\nimport { addMatchToAllTime } from \"../store/profileStats\";\r\nimport { usePendingVisit } from \"../store/pendingVisit\";\r\nimport type { UnifiedMatchActions } from \"../logic/matchActions\";\r\nimport ResizableModal from \"./ui/ResizableModal\";\r\n\r\nexport default function Scoreboard({\r\n  matchActions,\r\n}: { matchActions?: UnifiedMatchActions } = {}) {\r\n  const {\r\n    players,\r\n    currentPlayerIdx,\r\n    addVisit,\r\n    undoVisit,\r\n    endLeg,\r\n    nextPlayer,\r\n    endGame,\r\n    inProgress,\r\n    startingScore,\r\n    bestLegThisMatch,\r\n  } = useMatch();\r\n  const pendingEntries = usePendingVisit((s) => s.entries);\r\n\r\n  function handleEndGame() {\r\n    try {\r\n      const summary = {\r\n        ts: Date.now(),\r\n        players: players.map((p) => {\r\n          const totals = p.legs.reduce(\r\n            (acc, L) => {\r\n              acc.points += L.totalScoreStart - L.totalScoreRemaining;\r\n              const legDarts = (L.visits || []).reduce(\r\n                (a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0),\r\n                0,\r\n              );\r\n              acc.darts += legDarts;\r\n              return acc;\r\n            },\r\n            { points: 0, darts: 0 },\r\n          );\r\n          const dartsThrown = totals.darts;\r\n          const avg = dartsThrown > 0 ? (totals.points / dartsThrown) * 3 : 0;\r\n          return {\r\n            id: p.id,\r\n            name: p.name,\r\n            legsWon: p.legsWon,\r\n            dartsThrown,\r\n            avg: Math.round(avg * 100) / 100,\r\n          };\r\n        }),\r\n        winner: players.reduce(\r\n          (best, p) => (p.legsWon > (best?.legsWon || 0) ? p : best),\r\n          players[0],\r\n        )?.name,\r\n      };\r\n      try {\r\n        localStorage.setItem(\"ndn_last_match\", JSON.stringify(summary));\r\n      } catch {}\r\n    } catch (err) {}\r\n    addMatchToAllTime(players);\r\n    (matchActions?.endGame ?? endGame)();\r\n  }\r\n\r\n  return (\r\n    <ResizableModal\r\n      storageKey=\"ndn:modal:scoreboard\"\r\n      className=\"w-full h-full relative\"\r\n      defaultWidth={1100}\r\n      defaultHeight={720}\r\n      minWidth={720}\r\n      minHeight={480}\r\n      maxWidth={1600}\r\n      maxHeight={1200}\r\n      initialFitHeight\r\n    >\r\n      <div className=\"flex-1 min-h-0 overflow-y-auto p-3\">\r\n        <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-3\">\r\n          <div className=\"col-span-2 card\">\r\n            <h2 className=\"text-lg font-semibold mb-3\">Score Input</h2>\r\n            {inProgress ? (\r\n              <MatchControls\r\n                inProgress={inProgress}\r\n                startingScore={startingScore}\r\n                pendingEntries={pendingEntries}\r\n                onAddVisit={(score, darts) => {\r\n                  // Compute remaining before we update store, to decide auto-advance\r\n                  const p = players[currentPlayerIdx];\r\n                  const leg = p.legs[p.legs.length - 1];\r\n                  const prevRemaining = leg\r\n                    ? leg.totalScoreRemaining\r\n                    : startingScore;\r\n                  const numericScore = typeof score === \"number\" ? score : 0;\r\n                  let newRemaining = prevRemaining - numericScore;\r\n                  if (!Number.isFinite(newRemaining) || newRemaining < 0)\r\n                    newRemaining = 0;\r\n                  // Call provided matchActions.addVisit if available, otherwise the store's addVisit\r\n                  // Call provided matchActions.addVisit if available, otherwise the store's addVisit\r\n                  if (matchActions?.addVisit) {\r\n                    matchActions.addVisit(score, darts);\r\n                  } else {\r\n                    addVisit(score, darts);\r\n                  }\r\n                  if (newRemaining === 0) {\r\n                    if (matchActions?.endLeg) {\r\n                      matchActions.endLeg(score);\r\n                    } else {\r\n                      endLeg(score);\r\n                    }\r\n                  } else {\r\n                    (matchActions?.nextPlayer ?? nextPlayer)();\r\n                  }\r\n                }}\r\n                onUndo={() => (matchActions?.undoVisit ?? undoVisit)()}\r\n                onEndLeg={(score) => {\r\n                  (matchActions?.endLeg ?? endLeg)(score ?? 0);\r\n                }}\r\n                onNextPlayer={() => (matchActions?.nextPlayer ?? nextPlayer)()}\r\n                onEndGame={handleEndGame}\r\n                quickButtons={[180, 140, 100, 60]}\r\n              />\r\n            ) : (\r\n              <p className=\"text-slate-600\">No game in progress.</p>\r\n            )}\r\n\r\n            <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n              {players.map((p, idx) => {\r\n                const currentLeg = p.legs[p.legs.length - 1];\r\n                const remaining = currentLeg\r\n                  ? currentLeg.totalScoreRemaining\r\n                  : startingScore;\r\n                // TV-style 3-dart avg across the entire match (all legs): sum(points)/sum(darts)*3\r\n                const totals = p.legs.reduce(\r\n                  (acc, L) => {\r\n                    acc.points += L.totalScoreStart - L.totalScoreRemaining;\r\n                    const legDarts = (L.visits || []).reduce(\r\n                      (a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0),\r\n                      0,\r\n                    );\r\n                    acc.darts += legDarts;\r\n                    return acc;\r\n                  },\r\n                  { points: 0, darts: 0 },\r\n                );\r\n                const dartsThrown = totals.darts;\r\n                const avg =\r\n                  dartsThrown > 0 ? (totals.points / dartsThrown) * 3 : 0;\r\n\r\n                return (\r\n                  <div\r\n                    key={p.id}\r\n                    className={`card glass transition-shadow transition-all duration-150 ease-out ${idx === currentPlayerIdx ? \"ring-2 ring-brand-400\" : \"\"}`}\r\n                  >\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <h3 className=\"text-base font-semibold\">{p.name}</h3>\r\n                      <span className=\"badge w-32 justify-center\">\r\n                        Legs Won: {p.legsWon}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"mt-2 grid grid-cols-3 gap-2 text-center\">\r\n                      <div className=\"p-2 rounded-xl bg-white/10 border border-white/10 metric-tile\">\r\n                        <div className=\"text-xs text-slate-500\">Remaining</div>\r\n                        <div\r\n                          className={`flex items-center justify-center gap-2 mt-1 h-3 w-full`}\r\n                          aria-hidden\r\n                        >\r\n                          {[0, 1, 2].map((i) => {\r\n                            // Only active/current player's pendingEntries matter; other players get translucent placeholders\r\n                            const e =\r\n                              idx === currentPlayerIdx\r\n                                ? (pendingEntries[i] as any)\r\n                                : null;\r\n                            const isPending = !e;\r\n                            const isHit =\r\n                              !!e &&\r\n                              (typeof e.value === \"number\"\r\n                                ? e.value > 0\r\n                                : true);\r\n                            const color = isPending\r\n                              ? \"bg-gray-400/60\"\r\n                              : isHit\r\n                                ? \"bg-emerald-400\"\r\n                                : \"bg-rose-500\";\r\n                            const active =\r\n                              idx === currentPlayerIdx && !isPending && isHit;\r\n                            const classes = `visit-dot ${active ? \"active\" : \"inactive\"} ${color}`;\r\n                            return <span key={i} className={classes} />;\r\n                          })}\r\n                        </div>\r\n                        <div className=\"text-2xl font-bold\">{remaining}</div>\r\n                        <div className=\"h-1 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                          <div\r\n                            className=\"h-full bg-emerald-400/70 transition-all duration-200 ease-out\"\r\n                            style={{\r\n                              width: `${Math.max(0, Math.min(100, (1 - remaining / startingScore) * 100))}%`,\r\n                            }}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"p-2 rounded-xl bg-white/10 border border-white/10 metric-tile\">\r\n                        <div className=\"text-xs text-slate-500\">Darts</div>\r\n                        <div className=\"text-xl font-bold\">{dartsThrown}</div>\r\n                      </div>\r\n                      <div className=\"p-2 rounded-xl bg-white/10 border border-white/10 metric-tile\">\r\n                        <div className=\"text-xs text-slate-500\">3-Dart Avg</div>\r\n                        <div className=\"text-xl font-bold\">\r\n                          {formatAvg(avg)}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            {bestLegThisMatch && (\r\n              <div className=\"mt-4 p-3 rounded-xl bg-emerald-50 border border-emerald-200\">\r\n                <strong>Best Leg (this match):</strong> Player{\" \"}\r\n                {players.find((p) => p.id === bestLegThisMatch.playerId)?.name}{\" \"}\r\n                in {bestLegThisMatch.darts} darts\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ResizableModal>\r\n  );\r\n}\r\n"],"names":["Scoreboard","matchActions","players","currentPlayerIdx","addVisit","undoVisit","endLeg","nextPlayer","endGame","inProgress","startingScore","bestLegThisMatch","useMatch","pendingEntries","usePendingVisit","handleEndGame","summary","p","totals","acc","L","legDarts","a","v","dartsThrown","avg","best","addMatchToAllTime","jsx","ResizableModal","jsxs","MatchControls","score","darts","leg","newRemaining","idx","currentLeg","remaining","i","e","isPending","isHit","classes","formatAvg"],"mappings":"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"}
{"version":3,"file":"Friends-CZhVQ2-r.js","sources":["../../src/store/messages.ts","../../src/utils/profanity.ts","../../src/components/Friends.tsx"],"sourcesContent":["import { create } from \"zustand\";\r\n\r\nexport type DM = { id: string; from: string; message: string; ts: number };\r\n\r\ntype MessagesState = {\r\n  inbox: DM[];\r\n  unread: number;\r\n  inGame: boolean;\r\n  setInGame: (v: boolean) => void;\r\n  add: (m: DM) => void;\r\n  load: (arr: DM[]) => void;\r\n  markAllRead: () => void;\r\n  remove: (id: string) => void;\r\n};\r\n\r\nconst LS_INBOX = \"ndn:messages:inbox\";\r\nconst LS_UNREAD = \"ndn:messages:unread\";\r\n\r\nfunction loadInitial() {\r\n  try {\r\n    const raw = localStorage.getItem(LS_INBOX);\r\n    const arr = raw ? (JSON.parse(raw) as DM[]) : [];\r\n    const unread = Number(localStorage.getItem(LS_UNREAD) || \"0\") || 0;\r\n    // sanitize\r\n    const inbox = Array.isArray(arr)\r\n      ? arr.filter((m) => m && typeof m.id === \"string\").slice(0, 200)\r\n      : [];\r\n    return { inbox, unread };\r\n  } catch {\r\n    return { inbox: [], unread: 0 };\r\n  }\r\n}\r\n\r\nfunction save(inbox: DM[], unread: number) {\r\n  try {\r\n    localStorage.setItem(LS_INBOX, JSON.stringify(inbox));\r\n  } catch {}\r\n  try {\r\n    localStorage.setItem(LS_UNREAD, String(unread));\r\n  } catch {}\r\n}\r\n\r\nconst initial = loadInitial();\r\n\r\nexport const useMessages = create<MessagesState>((set, get) => ({\r\n  inbox: initial.inbox,\r\n  unread: initial.unread,\r\n  inGame: false,\r\n  setInGame: (v) => set({ inGame: v }),\r\n  add: (m) =>\r\n    set((s) => {\r\n      const exists = s.inbox.some((x) => x.id === m.id && x.ts === m.ts);\r\n      const list = exists ? s.inbox : [m, ...s.inbox].slice(0, 200);\r\n      const unread = s.unread + (exists ? 0 : 1);\r\n      save(list, unread);\r\n      return { inbox: list, unread };\r\n    }),\r\n  load: (arr) =>\r\n    set((s) => {\r\n      const sorted = [...arr].sort((a, b) => b.ts - a.ts).slice(0, 200);\r\n      save(sorted, s.unread);\r\n      return { inbox: sorted, unread: s.unread };\r\n    }),\r\n  markAllRead: () => {\r\n    const s = get();\r\n    save(s.inbox, 0);\r\n    set({ unread: 0 });\r\n  },\r\n  remove: (id) =>\r\n    set((s) => {\r\n      const list = s.inbox.filter((m) => m.id !== id);\r\n      const unread = s.unread; // keep unread count stable on deletion from history\r\n      save(list, unread);\r\n      return { inbox: list, unread };\r\n    }),\r\n}));\r\n","// Simple profanity filter: replaces detected profane words with asterisks of the same length.\r\n// Note: This is a lightweight heuristic and not exhaustive.\r\n\r\nconst patterns: RegExp[] = [\r\n  /\\b(f+[\\W_]*u+[\\W_]*c+[\\W_]*k+)\\b/gi,\r\n  /\\b(s+[\\W_]*h+[\\W_]*i+[\\W_]*t+)\\b/gi,\r\n  /\\b(b+[\\W_]*i+[\\W_]*t+[\\W_]*c+[\\W_]*h+)\\b/gi,\r\n  /\\b(a+[\\W_]*s+[\\W_]*s+[\\W_]*h+[\\W_]*o+[\\W_]*l+[\\W_]*e+)\\b/gi,\r\n  /\\b(d+[\\W_]*a+[\\W_]*m+[\\W_]*n+)\\b/gi,\r\n  /\\b(c+[\\W_]*r+[\\W_]*a+[\\W_]*p+)\\b/gi,\r\n  /\\b(p+[\\W_]*i+[\\W_]*s+[\\W_]*s+)\\b/gi,\r\n];\r\n\r\nfunction starify(match: string) {\r\n  // Preserve whitespace/punct positions; just replace letters/numbers with *\r\n  return match.replace(/[\\p{L}\\p{N}]/gu, \"*\");\r\n}\r\n\r\nexport function censorProfanity(input: string): string {\r\n  if (!input) return input;\r\n  let out = input;\r\n  for (const re of patterns) {\r\n    out = out.replace(re, (m) => starify(m));\r\n  }\r\n  return out;\r\n}\r\n\r\nexport function containsProfanity(input: string): boolean {\r\n  if (!input) return false;\r\n  return patterns.some((re) => re.test(input));\r\n}\r\n","import { useEffect, useMemo, useState } from \"react\";\r\nimport { useToast } from \"../store/toast\";\r\nimport { useMessages } from \"../store/messages\";\r\nimport { censorProfanity } from \"../utils/profanity\";\r\nimport TabPills from \"./ui/TabPills\";\r\nimport { labelForMode } from \"../utils/games\";\r\n\r\ntype Friend = {\r\n  email: string;\r\n  username?: string;\r\n  status?: \"online\" | \"offline\" | \"ingame\";\r\n  lastSeen?: number;\r\n  roomId?: string | null;\r\n  match?: {\r\n    game: string;\r\n    mode: string;\r\n    value: number;\r\n    startingScore?: number;\r\n  } | null;\r\n};\r\n\r\nfunction timeAgo(ts?: number) {\r\n  if (!ts) return \"\";\r\n  const s = Math.floor((Date.now() - ts) / 1000);\r\n  if (s < 60) return `${s}s ago`;\r\n  const m = Math.floor(s / 60);\r\n  if (m < 60) return `${m}m ago`;\r\n  const h = Math.floor(m / 60);\r\n  if (h < 24) return `${h}h ago`;\r\n  const d = Math.floor(h / 24);\r\n  return `${d}d ago`;\r\n}\r\n\r\nexport default function Friends({ user }: { user?: any }) {\r\n  const toast = useToast();\r\n  const email = String(user?.email || \"\").toLowerCase();\r\n  const [friends, setFriends] = useState<Friend[]>([]);\r\n  const [suggested, setSuggested] = useState<Friend[]>([]);\r\n  const [results, setResults] = useState<Friend[]>([]);\r\n  const [q, setQ] = useState(\"\");\r\n  const [filter, setFilter] = useState<\r\n    \"all\" | \"online\" | \"offline\" | \"ingame\" | \"requests\"\r\n  >(\"all\");\r\n  const [loading, setLoading] = useState(false);\r\n  const msgs = useMessages();\r\n  const [requests, setRequests] = useState<\r\n    Array<{\r\n      id: string;\r\n      fromEmail: string;\r\n      fromUsername: string;\r\n      toEmail: string;\r\n      toUsername: string;\r\n      requestedAt: number;\r\n    }>\r\n  >([]);\r\n  const [outgoingRequests, setOutgoingRequests] = useState<\r\n    Array<{\r\n      id: string;\r\n      fromEmail: string;\r\n      fromUsername: string;\r\n      toEmail: string;\r\n      toUsername: string;\r\n      requestedAt: number;\r\n    }>\r\n  >([]);\r\n  const [messagePopup, setMessagePopup] = useState<{\r\n    show: boolean;\r\n    toUser?: string;\r\n    toEmail?: string;\r\n    replyTo?: string;\r\n  }>({ show: false });\r\n\r\n  async function refresh() {\r\n    if (!email) return;\r\n    try {\r\n      const [fl, sg, rq, out] = await Promise.all([\r\n        fetch(`/api/friends/list?email=${encodeURIComponent(email)}`).then(\r\n          (r) => r.json(),\r\n        ),\r\n        fetch(`/api/friends/suggested?email=${encodeURIComponent(email)}`).then(\r\n          (r) => r.json(),\r\n        ),\r\n        fetch(`/api/friends/requests?email=${encodeURIComponent(email)}`).then(\r\n          (r) => r.json(),\r\n        ),\r\n        fetch(`/api/friends/outgoing?email=${encodeURIComponent(email)}`).then(\r\n          (r) => r.json(),\r\n        ),\r\n      ]);\r\n      setFriends(fl.friends || []);\r\n      setSuggested(sg.suggestions || []);\r\n      setRequests(rq.requests || []);\r\n      setOutgoingRequests(out.requests || []);\r\n    } catch {}\r\n  }\r\n\r\n  useEffect(() => {\r\n    refresh();\r\n  }, [email]);\r\n\r\n  async function search(term: string) {\r\n    setQ(term);\r\n    if (!term) {\r\n      setResults([]);\r\n      return;\r\n    }\r\n    try {\r\n      const res = await fetch(\r\n        `/api/friends/search?q=${encodeURIComponent(term)}`,\r\n      );\r\n      const data = await res.json();\r\n      setResults(data.results || []);\r\n    } catch {}\r\n  }\r\n\r\n  async function addFriend(target: string) {\r\n    if (!email || !target) return;\r\n    setLoading(true);\r\n    try {\r\n      await fetch(\"/api/friends/add\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ email, friend: target }),\r\n      });\r\n      await refresh();\r\n      setQ(\"\");\r\n      setResults([]);\r\n      toast(\"Friend added\", { type: \"success\" });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function removeFriend(target: string) {\r\n    if (!email || !target) return;\r\n    setLoading(true);\r\n    try {\r\n      await fetch(\"/api/friends/remove\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ email, friend: target }),\r\n      });\r\n      await refresh();\r\n      toast(\"Friend removed\", { type: \"info\" });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  const filtered = useMemo(() => {\r\n    if (filter === \"all\") return friends;\r\n    return friends.filter((f) => (f.status || \"offline\") === filter);\r\n  }, [friends, filter]);\r\n\r\n  async function spectate(roomId?: string | null) {\r\n    if (!roomId) {\r\n      toast(\"Room unavailable\", { type: \"error\" });\r\n      return;\r\n    }\r\n    try {\r\n      const ev = new CustomEvent(\"ndn:spectate-request\", {\r\n        detail: { roomId },\r\n      });\r\n      window.dispatchEvent(ev);\r\n      toast(\"Opening spectator view…\", { type: \"info\" });\r\n    } catch {}\r\n  }\r\n\r\n  // Friend Requests pill: use real requests data\r\n  const requestsCount = requests.length + outgoingRequests.length;\r\n  return (\r\n    <div className=\"card ndn-game-shell\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Friends</h2>\r\n      <p className=\"mb-2 text-brand-600\">\r\n        Manage your friends. See who’s online, in-game, or offline; find new\r\n        teammates; and invite people to play.\r\n      </p>\r\n      <div className=\"text-xs opacity-70 mb-3\">\r\n        Online: {friends.filter((f) => f.status === \"online\").length} · In-game:{\" \"}\r\n        {friends.filter((f) => f.status === \"ingame\").length} · Offline:{\" \"}\r\n        {friends.filter((f) => !f.status || f.status === \"offline\").length}\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4\">\r\n        <div className=\"md:col-span-2 p-3 rounded-2xl bg-black/30 border border-white/10\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div className=\"font-semibold text-white/90\">Your Friends</div>\r\n          </div>\r\n          <TabPills\r\n            tabs={[\r\n              { key: \"all\", label: \"All\" },\r\n              { key: \"online\", label: \"Online\" },\r\n              { key: \"ingame\", label: \"In-Game\" },\r\n              { key: \"offline\", label: \"Offline\" },\r\n              {\r\n                key: \"requests\",\r\n                label: `Requests ${requestsCount > 0 ? \"(\" + requestsCount + \")\" : \"\"}`,\r\n              },\r\n            ]}\r\n            active={filter}\r\n            onChange={(k) => setFilter(k as any)}\r\n            className=\"mb-3\"\r\n          />\r\n          {filter === \"requests\" ? (\r\n            <ul className=\"space-y-2\">\r\n              {requestsCount > 0 ? (\r\n                <>\r\n                  {/* Incoming requests */}\r\n                  {requests.length > 0 &&\r\n                    requests.map((r) => (\r\n                      <li\r\n                        key={`incoming-${r.id || r.fromEmail}`}\r\n                        className=\"p-3 rounded bg-black/20 flex flex-col gap-2\"\r\n                      >\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"font-semibold text-lg\">\r\n                            {r.fromUsername || r.fromEmail || \"Unknown User\"}\r\n                          </span>\r\n                          <span className=\"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded\">\r\n                            Incoming\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                          <button\r\n                            className=\"btn bg-emerald-600 hover:bg-emerald-700\"\r\n                            onClick={async () => {\r\n                              setLoading(true);\r\n                              try {\r\n                                const res = await fetch(\"/api/friends/accept\", {\r\n                                  method: \"POST\",\r\n                                  headers: {\r\n                                    \"Content-Type\": \"application/json\",\r\n                                  },\r\n                                  body: JSON.stringify({\r\n                                    email,\r\n                                    requester: r.fromEmail,\r\n                                  }),\r\n                                });\r\n                                if (res.ok) {\r\n                                  // Remove from requests and add to friends immediately for better UX\r\n                                  setRequests((prev) =>\r\n                                    prev.filter((req) => req.id !== r.id),\r\n                                  );\r\n                                  // Add to friends list (we'll get the full data on next refresh, but show basic info now)\r\n                                  const newFriend = {\r\n                                    email: r.fromEmail,\r\n                                    username: r.fromUsername,\r\n                                    status: \"offline\" as const,\r\n                                  };\r\n                                  setFriends((prev) => [...prev, newFriend]);\r\n                                  // Also remove from outgoing if it exists\r\n                                  setOutgoingRequests((prev) =>\r\n                                    prev.filter(\r\n                                      (req) => req.toEmail !== r.fromEmail,\r\n                                    ),\r\n                                  );\r\n                                  toast(\"Friend request accepted\", {\r\n                                    type: \"success\",\r\n                                  });\r\n                                  // Refresh in background to get complete data\r\n                                  setTimeout(() => refresh(), 100);\r\n                                } else {\r\n                                  toast(\"Failed to accept request\", {\r\n                                    type: \"error\",\r\n                                  });\r\n                                }\r\n                              } catch (error) {\r\n                                toast(\"Error accepting request\", {\r\n                                  type: \"error\",\r\n                                });\r\n                              } finally {\r\n                                setLoading(false);\r\n                              }\r\n                            }}\r\n                          >\r\n                            Accept\r\n                          </button>\r\n                          <button\r\n                            className=\"btn bg-rose-600 hover:bg-rose-700\"\r\n                            onClick={async () => {\r\n                              setLoading(true);\r\n                              try {\r\n                                const res = await fetch(\r\n                                  \"/api/friends/decline\",\r\n                                  {\r\n                                    method: \"POST\",\r\n                                    headers: {\r\n                                      \"Content-Type\": \"application/json\",\r\n                                    },\r\n                                    body: JSON.stringify({\r\n                                      email,\r\n                                      requester: r.fromEmail,\r\n                                    }),\r\n                                  },\r\n                                );\r\n                                if (res.ok) {\r\n                                  // Remove from requests immediately for better UX\r\n                                  setRequests((prev) =>\r\n                                    prev.filter((req) => req.id !== r.id),\r\n                                  );\r\n                                  // Also remove from outgoing if it exists\r\n                                  setOutgoingRequests((prev) =>\r\n                                    prev.filter(\r\n                                      (req) => req.toEmail !== r.fromEmail,\r\n                                    ),\r\n                                  );\r\n                                  toast(\"Friend request declined\", {\r\n                                    type: \"info\",\r\n                                  });\r\n                                  // Refresh in background to ensure consistency\r\n                                  setTimeout(() => refresh(), 100);\r\n                                } else {\r\n                                  toast(\"Failed to decline request\", {\r\n                                    type: \"error\",\r\n                                  });\r\n                                }\r\n                              } finally {\r\n                                setLoading(false);\r\n                              }\r\n                            }}\r\n                          >\r\n                            Decline\r\n                          </button>\r\n                        </div>\r\n                      </li>\r\n                    ))}\r\n                  {/* Outgoing requests */}\r\n                  {outgoingRequests.length > 0 &&\r\n                    outgoingRequests.map((r) => (\r\n                      <li\r\n                        key={`outgoing-${r.id || r.toEmail}`}\r\n                        className=\"p-3 rounded bg-black/20 flex flex-col gap-2\"\r\n                      >\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"font-semibold text-lg\">\r\n                            {r.toUsername || r.toEmail || \"Unknown User\"}\r\n                          </span>\r\n                          <span className=\"text-xs bg-amber-600/20 text-amber-400 px-2 py-1 rounded\">\r\n                            Pending\r\n                          </span>\r\n                        </div>\r\n                        <button\r\n                          className=\"btn bg-slate-600 hover:bg-slate-700 self-start\"\r\n                          onClick={async () => {\r\n                            setLoading(true);\r\n                            try {\r\n                              const res = await fetch(\"/api/friends/cancel\", {\r\n                                method: \"POST\",\r\n                                headers: { \"Content-Type\": \"application/json\" },\r\n                                body: JSON.stringify({\r\n                                  email,\r\n                                  friend: r.toEmail,\r\n                                }),\r\n                              });\r\n                              if (res.ok) {\r\n                                // Remove from outgoing requests immediately for better UX\r\n                                setOutgoingRequests((prev) =>\r\n                                  prev.filter((req) => req.id !== r.id),\r\n                                );\r\n                                toast(\"Friend request cancelled\", {\r\n                                  type: \"info\",\r\n                                });\r\n                                // Refresh in background to ensure consistency\r\n                                setTimeout(() => refresh(), 100);\r\n                              } else {\r\n                                toast(\"Failed to cancel request\", {\r\n                                  type: \"error\",\r\n                                });\r\n                              }\r\n                            } finally {\r\n                              setLoading(false);\r\n                            }\r\n                          }}\r\n                        >\r\n                          Cancel\r\n                        </button>\r\n                      </li>\r\n                    ))}\r\n                </>\r\n              ) : (\r\n                <li className=\"text-sm opacity-70\">No friend requests yet.</li>\r\n              )}\r\n            </ul>\r\n          ) : (\r\n            <ul className=\"space-y-2\">\r\n              {filtered.map((f) => (\r\n                <li\r\n                  key={f.email}\r\n                  className=\"p-2 rounded bg-black/20 flex items-center justify-between\"\r\n                >\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span\r\n                      className={`inline-block w-2 h-2 rounded-full ${f.status === \"online\" ? \"bg-emerald-400\" : f.status === \"ingame\" ? \"bg-amber-400\" : \"bg-slate-400\"}`}\r\n                    ></span>\r\n                    <span className=\"font-semibold\">\r\n                      {f.username || f.email}\r\n                    </span>\r\n                    <span className=\"text-xs opacity-70\">\r\n                      {f.status || \"offline\"}\r\n                      {f.status !== \"online\" && f.lastSeen\r\n                        ? ` · ${timeAgo(f.lastSeen)}`\r\n                        : \"\"}\r\n                    </span>\r\n                    {f.status === \"ingame\" && f.match && (\r\n                      <span className=\"text-[10px] opacity-70 px-2 py-0.5 rounded bg-indigo-500/20 border border-indigo-600/30\">\r\n                        {f.match.game} {labelForMode(f.match.mode)}{\" \"}\r\n                        {f.match.value}\r\n                        {f.match.game === \"X01\" && f.match.startingScore\r\n                          ? ` · ${f.match.startingScore}`\r\n                          : \"\"}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {f.status === \"ingame\" && f.roomId && (\r\n                      <button\r\n                        className=\"btn\"\r\n                        onClick={() => spectate(f.roomId!)}\r\n                      >\r\n                        Spectate\r\n                      </button>\r\n                    )}\r\n                    <button\r\n                      className=\"btn\"\r\n                      disabled={\r\n                        loading ||\r\n                        (f.status !== \"online\" && f.status !== \"ingame\")\r\n                      }\r\n                      onClick={async () => {\r\n                        setLoading(true);\r\n                        try {\r\n                          const res = await fetch(\"/api/friends/invite\", {\r\n                            method: \"POST\",\r\n                            headers: { \"Content-Type\": \"application/json\" },\r\n                            body: JSON.stringify({\r\n                              fromEmail: email,\r\n                              toEmail: f.email,\r\n                              game: \"X01\",\r\n                              mode: \"bestof\",\r\n                              value: 3,\r\n                              startingScore: 501,\r\n                            }),\r\n                          });\r\n                          const data = await res.json().catch(() => ({}));\r\n                          if (data?.delivered)\r\n                            toast(\"Invite sent\", { type: \"success\" });\r\n                          else\r\n                            toast(\"Friend is offline; invite queued\", {\r\n                              type: \"info\",\r\n                            });\r\n                        } finally {\r\n                          setLoading(false);\r\n                        }\r\n                      }}\r\n                    >\r\n                      Invite\r\n                    </button>\r\n                    <button\r\n                      className=\"btn\"\r\n                      disabled={loading}\r\n                      onClick={() =>\r\n                        setMessagePopup({\r\n                          show: true,\r\n                          toUser: f.username || f.email,\r\n                          toEmail: f.email,\r\n                        })\r\n                      }\r\n                    >\r\n                      Message\r\n                    </button>\r\n                    <button\r\n                      className=\"btn bg-rose-600 hover:bg-rose-700\"\r\n                      disabled={loading}\r\n                      onClick={() => removeFriend(f.email)}\r\n                    >\r\n                      Remove\r\n                    </button>\r\n                  </div>\r\n                </li>\r\n              ))}\r\n              {filtered.length === 0 && (\r\n                <li className=\"text-sm opacity-70\">\r\n                  No friends {filter !== \"all\" ? `in ${filter}` : \"\"} yet.\r\n                </li>\r\n              )}\r\n            </ul>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"p-3 rounded-2xl bg-black/20 border border-white/10\">\r\n          <div className=\"font-semibold mb-2 text-white/90\">Find Friends</div>\r\n          <input\r\n            className=\"input w-full mb-2\"\r\n            placeholder=\"Search by name or email\"\r\n            value={q}\r\n            onChange={(e) => search(e.target.value)}\r\n          />\r\n          <ul className=\"space-y-1 mb-3 max-h-48 overflow-auto\">\r\n            {results.map((r) => (\r\n              <li\r\n                key={r.email}\r\n                className=\"flex items-center justify-between p-2 rounded bg-black/10\"\r\n              >\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span\r\n                    className={`inline-block w-2 h-2 rounded-full ${r.status === \"online\" ? \"bg-emerald-400\" : r.status === \"ingame\" ? \"bg-amber-400\" : \"bg-slate-400\"}`}\r\n                  ></span>\r\n                  <span>{r.username || r.email}</span>\r\n                </div>\r\n                <button\r\n                  className=\"btn\"\r\n                  disabled={loading}\r\n                  onClick={() => addFriend(r.email)}\r\n                >\r\n                  Add\r\n                </button>\r\n              </li>\r\n            ))}\r\n            {results.length === 0 && (\r\n              <li className=\"text-xs opacity-60\">Type to search…</li>\r\n            )}\r\n          </ul>\r\n          <div className=\"font-semibold mb-1 text-white/90\">Suggested</div>\r\n          <ul className=\"space-y-1 max-h-48 overflow-auto\">\r\n            {suggested.map((s) => (\r\n              <li\r\n                key={s.email}\r\n                className=\"flex items-center justify-between p-2 rounded bg-black/10\"\r\n              >\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span\r\n                    className={`inline-block w-2 h-2 rounded-full ${s.status === \"online\" ? \"bg-emerald-400\" : s.status === \"ingame\" ? \"bg-amber-400\" : \"bg-slate-400\"}`}\r\n                  ></span>\r\n                  <span>{s.username || s.email}</span>\r\n                </div>\r\n                <button\r\n                  className=\"btn\"\r\n                  disabled={loading}\r\n                  onClick={() => addFriend(s.email)}\r\n                >\r\n                  Add\r\n                </button>\r\n              </li>\r\n            ))}\r\n            {suggested.length === 0 && (\r\n              <li className=\"text-xs opacity-60\">No suggestions right now.</li>\r\n            )}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Direct Messages */}\r\n      <div className=\"p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <div className=\"font-semibold\">Messages</div>\r\n          <button\r\n            className=\"btn px-3 py-1 text-sm\"\r\n            onClick={() => msgs.markAllRead()}\r\n          >\r\n            Mark all read\r\n          </button>\r\n        </div>\r\n        {msgs.inbox.length === 0 ? (\r\n          <div className=\"text-sm opacity-70\">No messages yet.</div>\r\n        ) : (\r\n          <ul className=\"space-y-2 max-h-72 overflow-auto\">\r\n            {msgs.inbox.map((m) => (\r\n              <li key={m.id} className=\"p-2 rounded bg-black/20 text-sm\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <span className=\"font-semibold\">{m.from}</span>{\" \"}\r\n                    <span className=\"opacity-70 text-xs\">\r\n                      · {new Date(m.ts).toLocaleString()}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex gap-2\">\r\n                    <button\r\n                      className=\"btn px-2 py-1 text-xs\"\r\n                      onClick={() =>\r\n                        setMessagePopup({\r\n                          show: true,\r\n                          toUser: m.from,\r\n                          toEmail: m.from,\r\n                          replyTo: m.from,\r\n                        })\r\n                      }\r\n                    >\r\n                      Reply\r\n                    </button>\r\n                    <button\r\n                      className=\"btn bg-slate-700 hover:bg-slate-800 px-2 py-1 text-xs\"\r\n                      title=\"Delete this message\"\r\n                      onClick={() => msgs.remove(m.id)}\r\n                    >\r\n                      Delete\r\n                    </button>\r\n                    <button\r\n                      className=\"btn bg-rose-600 hover:bg-rose-700 px-2 py-1 text-xs\"\r\n                      onClick={async () => {\r\n                        const reason = prompt(\"Report reason (what happened)?\");\r\n                        if (!reason) return;\r\n                        try {\r\n                          await fetch(\"/api/friends/report\", {\r\n                            method: \"POST\",\r\n                            headers: { \"Content-Type\": \"application/json\" },\r\n                            body: JSON.stringify({\r\n                              reporterEmail: email,\r\n                              offenderEmail: m.from,\r\n                              reason,\r\n                              messageId: m.id,\r\n                            }),\r\n                          });\r\n                          toast(\"Report sent to admin\", { type: \"info\" });\r\n                        } catch {}\r\n                      }}\r\n                    >\r\n                      Report\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"mt-1 whitespace-pre-wrap break-words\">\r\n                  {censorProfanity(m.message)}\r\n                </div>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        )}\r\n      </div>\r\n\r\n      {/* Message Popup */}\r\n      {messagePopup.show && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4\">\r\n            <div className=\"text-center mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-white\">\r\n                Type Message To {messagePopup.toUser}\r\n              </h3>\r\n            </div>\r\n            {/* eslint-disable jsx-a11y/no-autofocus */}\r\n            <textarea\r\n              className=\"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none\"\r\n              placeholder=\"Type your message here...\"\r\n              id=\"message-input\"\r\n              autoFocus\r\n            />\r\n            {/* eslint-enable jsx-a11y/no-autofocus */}\r\n            <div className=\"flex gap-3 mt-4\">\r\n              <button\r\n                className=\"flex-1 btn bg-emerald-600 hover:bg-emerald-700\"\r\n                onClick={async () => {\r\n                  const input = document.getElementById(\r\n                    \"message-input\",\r\n                  ) as HTMLTextAreaElement;\r\n                  const message = input?.value?.trim();\r\n                  if (!message) return;\r\n\r\n                  setLoading(true);\r\n                  try {\r\n                    await fetch(\"/api/friends/message\", {\r\n                      method: \"POST\",\r\n                      headers: { \"Content-Type\": \"application/json\" },\r\n                      body: JSON.stringify({\r\n                        fromEmail: email,\r\n                        toEmail: messagePopup.toEmail,\r\n                        message,\r\n                      }),\r\n                    });\r\n                    toast(\"Message sent\", { type: \"success\" });\r\n                    setMessagePopup({ show: false });\r\n                  } catch (error) {\r\n                    toast(\"Failed to send message\", { type: \"error\" });\r\n                  } finally {\r\n                    setLoading(false);\r\n                  }\r\n                }}\r\n                disabled={loading}\r\n              >\r\n                Send\r\n              </button>\r\n              <button\r\n                className=\"flex-1 btn bg-slate-600 hover:bg-slate-700\"\r\n                onClick={() => setMessagePopup({ show: false })}\r\n              >\r\n                Cancel\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["LS_INBOX","LS_UNREAD","loadInitial","raw","arr","unread","m","save","inbox","initial","useMessages","create","set","get","v","s","exists","x","list","sorted","a","id","patterns","starify","match","censorProfanity","input","out","re","timeAgo","ts","h","Friends","user","toast","useToast","email","friends","setFriends","useState","suggested","setSuggested","results","setResults","q","setQ","filter","setFilter","loading","setLoading","msgs","requests","setRequests","outgoingRequests","setOutgoingRequests","messagePopup","setMessagePopup","refresh","fl","sg","rq","r","useEffect","search","term","data","addFriend","target","removeFriend","filtered","useMemo","f","spectate","roomId","ev","requestsCount","jsxs","jsx","TabPills","k","Fragment","prev","req","newFriend","labelForMode","reason","message"],"mappings":"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"}
{"version":3,"file":"OnlinePlay.clean-Bt3pIMup.js","sources":["../../src/components/ui/CreateMatchModal.tsx","../../src/components/ui/MatchPrestart.tsx","../../src/components/OnlinePlay.clean.tsx"],"sourcesContent":["import React, { useLayoutEffect, useState, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport {\n  allGames,\n  type GameKey,\n  gameConfig,\n  getStartOptionsForGame,\n  getExtraFieldsForGame,\n  getValueLabelForGame,\n  getDefaultExtraValues,\n  getGameDisplay,\n  type ModeKey,\n} from \"../../utils/games.js\";\nimport { useUserSettings } from \"../../store/userSettings.js\";\n\ntype Props = {\n  open: boolean;\n  onClose: () => void;\n  onCreate: (payload: any) => void;\n};\n\nexport default function CreateMatchModal({ open, onClose, onCreate }: Props) {\n  const [portalEl] = useState(() => document.createElement(\"div\"));\n  const [game, setGame] = useState<GameKey>(\"X01\");\n  const [modeType, setModeType] = useState<\"bestof\" | \"firstto\">(\"bestof\");\n  const [legs, setLegs] = useState<number>(3);\n  const legsRef = useRef<HTMLInputElement | null>(null);\n  const [avgChoice, setAvgChoice] = useState<number>(0);\n  const [startingScore, setStartingScore] = useState<number | undefined>(() => {\n    const opts = getStartOptionsForGame(game);\n    return opts?.[0];\n  });\n  const [extraValues, setExtraValues] = useState<Record<string, number>>(() =>\n    getDefaultExtraValues(game),\n  );\n  const user = (useUserSettings() as any).username || \"Anonymous\";\n\n  // When game changes, reset mode/start/extras to match the selected game's config\n  function onGameChange(g: GameKey) {\n    setGame(g);\n    const opts = getStartOptionsForGame(g);\n    setStartingScore(opts?.[0]);\n    setExtraValues(getDefaultExtraValues(g));\n    const cfg = gameConfig[g];\n    if (cfg?.modeOptions?.length) {\n      const validMode = cfg.modeOptions.includes(modeType as ModeKey)\n        ? modeType\n        : cfg.modeOptions[0];\n      setModeType(validMode as any);\n    }\n  }\n\n  useLayoutEffect(() => {\n    portalEl.className = \"ndn-create-match-portal\";\n    document.body.appendChild(portalEl);\n    return () => {\n      try {\n        portalEl && portalEl.remove();\n      } catch {}\n    };\n  }, [portalEl]);\n\n  // Close modal on Escape key\n  useLayoutEffect(() => {\n    function onKey(e: KeyboardEvent) {\n      if (e.key === \"Escape\") onClose();\n    }\n    if (open) document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [open, onClose]);\n\n  const extraFields = getExtraFieldsForGame(game);\n  const valueLabel = getValueLabelForGame(game, modeType as ModeKey);\n  const display = getGameDisplay(game);\n\n  const handleCreate = () => {\n    const payload = {\n      createdBy: user,\n      game,\n      modeType,\n      legs,\n      avgChoice,\n      startingScore,\n      ...extraValues,\n    };\n    onCreate(payload);\n    onClose();\n  };\n\n  if (!open) return null;\n\n  if (!portalEl) return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-2 sm:p-6\">\n      {/* A dedicated, accessible button covers the backdrop to capture clicks and keyboard input */}\n      <button\n        aria-label=\"Close dialog\"\n        className=\"absolute inset-0 w-full h-full bg-transparent\"\n        onClick={onClose}\n      />\n      <div\n        className=\"rounded-2xl p-5 sm:p-6 max-w-lg w-full relative text-white shadow-2xl border border-indigo-500/30 max-h-[85vh] overflow-y-auto\"\n        style={{ background: \"var(--ndn-card-bg, #0f172a)\" }}\n        role=\"dialog\"\n      >\n        <button\n          aria-label=\"Close\"\n          className=\"absolute top-3 right-3 w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors\"\n          onClick={onClose}\n        >\n          âœ•\n        </button>\n        <h2 className=\"text-base sm:text-lg font-bold tracking-tight mb-3\">\n          {display.emoji} Create Match\n        </h2>\n        <div className=\"grid grid-cols-1 gap-3\">\n          <div>\n            <div className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n              Created By\n            </div>\n            <div className=\"p-2 rounded-lg border border-indigo-500/20 bg-indigo-500/10 text-sm text-white\">\n              {user}\n            </div>\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-game\"\n            >\n              Game\n            </label>\n            <select\n              id=\"match-game\"\n              className=\"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white\"\n              value={game}\n              onChange={(e) => onGameChange(e.target.value as GameKey)}\n              onPointerDown={(e) => {\n                (e as any).stopPropagation();\n              }}\n              onMouseDown={(e) => {\n                e.stopPropagation();\n              }}\n              onTouchStart={(e) => {\n                (e as any).stopPropagation?.();\n              }}\n            >\n              {allGames.map((g) => {\n                const d = getGameDisplay(g);\n                return (\n                  <option key={g} value={g} className=\"bg-slate-900 text-white\">\n                    {d.emoji} {g}\n                  </option>\n                );\n              })}\n            </select>\n            {display.tagline && (\n              <div\n                className=\"text-[10px] mt-0.5 px-0.5\"\n                style={{ color: display.color }}\n              >\n                {display.tagline}\n              </div>\n            )}\n          </div>\n          {getStartOptionsForGame(game).length > 0 ? (\n            <div>\n              <label\n                className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n                htmlFor=\"match-start\"\n              >\n                {`${game} Starting Score`}\n              </label>\n              <select\n                id=\"match-start\"\n                className=\"p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white w-full\"\n                value={startingScore}\n                onChange={(e) => setStartingScore(Number(e.target.value))}\n                onPointerDown={(e) => {\n                  (e as any).stopPropagation();\n                }}\n                onMouseDown={(e) => {\n                  e.stopPropagation();\n                }}\n                onTouchStart={(e) => {\n                  (e as any).stopPropagation?.();\n                }}\n              >\n                {getStartOptionsForGame(game).map((opt) => (\n                  <option\n                    key={opt}\n                    value={opt}\n                    className=\"bg-slate-900 text-white\"\n                  >\n                    {opt}\n                  </option>\n                ))}\n              </select>\n            </div>\n          ) : null}\n          {/* Per-game extra config fields */}\n          {extraFields.length > 0 && (\n            <div className=\"space-y-2\">\n              {extraFields.map((f) => (\n                <div key={f.key}>\n                  <label\n                    className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n                    htmlFor={`match-extra-${f.key}`}\n                  >\n                    {f.label}\n                  </label>\n                  {f.type === \"select\" && f.options ? (\n                    <select\n                      id={`match-extra-${f.key}`}\n                      className=\"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white\"\n                      value={extraValues[f.key] ?? f.defaultValue}\n                      onChange={(e) =>\n                        setExtraValues((prev) => ({\n                          ...prev,\n                          [f.key]: Number(e.target.value),\n                        }))\n                      }\n                      onPointerDown={(e) => {\n                        (e as any).stopPropagation();\n                      }}\n                      onMouseDown={(e) => {\n                        e.stopPropagation();\n                      }}\n                      onTouchStart={(e) => {\n                        (e as any).stopPropagation?.();\n                      }}\n                    >\n                      {f.options.map((o) => (\n                        <option\n                          key={o}\n                          value={o}\n                          className=\"bg-slate-900 text-white\"\n                        >\n                          {o}\n                        </option>\n                      ))}\n                    </select>\n                  ) : (\n                    <input\n                      id={`match-extra-${f.key}`}\n                      type=\"number\"\n                      min={f.min ?? 1}\n                      max={f.max}\n                      step={f.step ?? 1}\n                      value={extraValues[f.key] ?? f.defaultValue}\n                      onChange={(e) =>\n                        setExtraValues((prev) => ({\n                          ...prev,\n                          [f.key]: Number(e.target.value),\n                        }))\n                      }\n                      className=\"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white\"\n                    />\n                  )}\n                  {f.hint && (\n                    <div className=\"text-[10px] text-slate-400 mt-0.5 px-0.5\">\n                      {f.hint}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n          <div>\n            <div className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n              Mode\n            </div>\n            <div className=\"flex gap-2 mt-1 justify-center flex-wrap\">\n              {(gameConfig[game]?.modeOptions ?? [\"bestof\", \"firstto\"]).map(\n                (m) => (\n                  <label\n                    key={m}\n                    className={`btn ${modeType === m ? \"btn-primary\" : \"btn-ghost\"}`}\n                  >\n                    <input\n                      type=\"radio\"\n                      name=\"mode\"\n                      value={m}\n                      checked={modeType === m}\n                      onChange={() => {\n                        setModeType(m as any);\n                        if (m === \"bestof\") {\n                          setLegs((prev) => {\n                            const base = Math.max(1, prev || 3);\n                            return base % 2 === 1 ? base : base + 1;\n                          });\n                        } else {\n                          setLegs((prev) => Math.max(1, prev || 3));\n                        }\n                        setTimeout(() => legsRef.current?.focus(), 0);\n                      }}\n                      className=\"sr-only\"\n                    />{\" \"}\n                    {m === \"bestof\"\n                      ? \"Best Of\"\n                      : m === \"firstto\"\n                        ? \"First To\"\n                        : m === \"innings\"\n                          ? \"Innings\"\n                          : m === \"holes\"\n                            ? \"Holes\"\n                            : m === \"rounds\"\n                              ? \"Rounds\"\n                              : m === \"practice\"\n                                ? \"Practice\"\n                                : m}\n                  </label>\n                ),\n              )}\n            </div>\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-legs\"\n            >\n              {valueLabel}\n            </label>\n            <input\n              id=\"match-legs\"\n              type=\"number\"\n              min={1}\n              value={legs}\n              onChange={(e) =>\n                setLegs(Math.max(1, Number(e.target.value || 1)))\n              }\n              ref={legsRef}\n              className=\"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white\"\n            />\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-avg\"\n            >\n              Average Choice (Â±)\n            </label>\n            <input\n              id=\"match-avg\"\n              type=\"number\"\n              value={avgChoice}\n              onChange={(e) => setAvgChoice(Number(e.target.value || 0))}\n              className=\"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white\"\n            />\n          </div>\n        </div>\n        <div className=\"flex gap-2 mt-4 pt-3 border-t border-indigo-500/20\">\n          <button className=\"flex-1 btn btn-ghost text-xs\" onClick={onClose}>\n            Cancel\n          </button>\n          <button className=\"flex-1 btn text-xs\" onClick={handleCreate}>\n            Create Match\n          </button>\n        </div>\n      </div>\n    </div>,\n    portalEl,\n  );\n}\n","import React, {\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  useCallback,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport CameraTile from \"../CameraTile.js\";\nimport {\n  getAllTimeAvg,\n  getAllTimeFirstNineAvg,\n  getAllTimeBestCheckout,\n  getAllTimeBestLeg,\n  getAllTime,\n  getAllTime180s,\n  getHeadToHeadLegDiff,\n} from \"../../store/profileStats.js\";\nimport {\n  Target,\n  Trophy,\n  Zap,\n  Crown,\n  Timer,\n  ArrowRight,\n  X,\n  BarChart2,\n  Camera,\n} from \"lucide-react\";\n\n/* â”€â”€ Board constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst BOARD_SIZE = 400;\nconst CX = BOARD_SIZE / 2;\nconst CY = BOARD_SIZE / 2;\nconst BULL_INNER_R = 6.35;\nconst BULL_OUTER_R = 15.9;\nconst TREBLE_INNER_R = 99;\nconst TREBLE_OUTER_R = 107;\nconst DOUBLE_INNER_R = 162;\nconst DOUBLE_OUTER_R = 170;\nconst SCALE = (BOARD_SIZE / 2 - 15) / DOUBLE_OUTER_R;\n\nconst SECTOR_ORDER = [\n  20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5,\n];\n\nconst SECTOR_COLORS: Record<number, { dark: string; light: string }> = {};\nSECTOR_ORDER.forEach((s, i) => {\n  SECTOR_COLORS[s] =\n    i % 2 === 0\n      ? { dark: \"#1a1a2e\", light: \"#c0392b\" }\n      : { dark: \"#f0e6d3\", light: \"#27ae60\" };\n});\n\n/* â”€â”€ Types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nexport type MatchPrestartProps = {\n  open: boolean;\n  matchInfo: {\n    id: string;\n    game: string;\n    modeType: string;\n    legs: number;\n    startingScore?: number;\n    createdBy?: string;\n    creatorName?: string;\n    firstThrowerId?: string;\n    firstThrowerName?: string;\n  } | null;\n  localUser: { username: string; email?: string; [k: string]: any } | null;\n  opponentName: string;\n  opponentStats?: {\n    avg3?: string;\n    best9?: string;\n    bestCheckout?: string | number;\n    bestLeg?: string | number;\n    career180s?: number;\n  } | null;\n  countdown?: number;\n  onChoice: (choice: \"bull\" | \"skip\") => void;\n  onBullThrow: (distanceMm: number) => void;\n  onAccept: () => void;\n  onCancel: () => void;\n  /** Remote player's choice (legacy â€” unused in RPS flow) */\n  remoteChoice?: \"bull\" | \"skip\" | null;\n  /** Whether the bull-up phase is active (legacy) */\n  bullActive?: boolean;\n  /** Winner of the bull-up (legacy) */\n  bullWinner?: string | null;\n  /** Whether the bull-up tied (legacy) */\n  bullTied?: boolean;\n};\n\n/* â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction getPlayerStats(name: string) {\n  try {\n    const avg3 = getAllTimeAvg(name).toFixed(1);\n    const best9 = getAllTimeFirstNineAvg(name).toFixed(1);\n    const bestCheckout = getAllTimeBestCheckout(name);\n    const bestLeg = getAllTimeBestLeg(name);\n    const all = getAllTime(name);\n    const career180s = getAllTime180s(name);\n    return {\n      avg3,\n      best9,\n      bestCheckout: bestCheckout || \"â€“\",\n      bestLeg: bestLeg || \"â€“\",\n      lifetimeScored: all.scored || 0,\n      lifetimeDarts: all.darts || 0,\n      career180s: career180s || 0,\n    };\n  } catch {\n    return {\n      avg3: \"0.0\",\n      best9: \"0.0\",\n      bestCheckout: \"â€“\",\n      bestLeg: \"â€“\",\n      lifetimeScored: 0,\n      lifetimeDarts: 0,\n      career180s: 0,\n    };\n  }\n}\n\nfunction polarToXY(cx: number, cy: number, r: number, angleDeg: number) {\n  const rad = ((angleDeg - 90) * Math.PI) / 180;\n  return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };\n}\n\nfunction distFromBull(x: number, y: number): number {\n  const dx = x - CX;\n  const dy = y - CY;\n  return Math.sqrt(dx * dx + dy * dy) / SCALE;\n}\n\n/* â”€â”€ Stat pill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction StatPill({\n  label,\n  value,\n  highlight,\n}: {\n  label: string;\n  value: string | number;\n  highlight?: boolean;\n}) {\n  return (\n    <div\n      className={`flex flex-col items-center px-1.5 py-1 rounded-lg ${highlight ? \"bg-indigo-500/20 ring-1 ring-indigo-500/30\" : \"bg-white/5\"}`}\n    >\n      <span className=\"text-[7px] sm:text-[8px] uppercase tracking-wider font-bold text-white/50\">\n        {label}\n      </span>\n      <span\n        className={`text-xs sm:text-sm font-black ${highlight ? \"text-indigo-300\" : \"text-white\"}`}\n      >\n        {value}\n      </span>\n    </div>\n  );\n}\n\n/* â”€â”€ Interactive dartboard SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction DartboardBullUp({\n  onSelect,\n  selectedPoint,\n  disabled,\n  label,\n}: {\n  onSelect: (x: number, y: number, distMm: number) => void;\n  selectedPoint: { x: number; y: number } | null;\n  disabled?: boolean;\n  label?: string;\n}) {\n  const svgRef = useRef<SVGSVGElement>(null);\n\n  const coordsFromEvent = useCallback((clientX: number, clientY: number) => {\n    const svg = svgRef.current;\n    if (!svg) return null;\n    const rect = svg.getBoundingClientRect();\n    const x = ((clientX - rect.left) / rect.width) * BOARD_SIZE;\n    const y = ((clientY - rect.top) / rect.height) * BOARD_SIZE;\n    const dist = distFromBull(x, y);\n    return { x, y, dist: Math.round(dist * 10) / 10 };\n  }, []);\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent<SVGSVGElement>) => {\n      if (disabled) return;\n      const c = coordsFromEvent(e.clientX, e.clientY);\n      if (c) onSelect(c.x, c.y, c.dist);\n    },\n    [onSelect, disabled, coordsFromEvent],\n  );\n\n  const handleTouch = useCallback(\n    (e: React.TouchEvent<SVGSVGElement>) => {\n      if (disabled) return;\n      e.preventDefault();\n      const touch = e.changedTouches[0];\n      if (!touch) return;\n      const c = coordsFromEvent(touch.clientX, touch.clientY);\n      if (c) onSelect(c.x, c.y, c.dist);\n    },\n    [onSelect, disabled, coordsFromEvent],\n  );\n\n  // Build sector paths\n  const sectorPaths = useMemo(() => {\n    const paths: React.ReactNode[] = [];\n    const degPerSector = 18;\n\n    for (let i = 0; i < 20; i++) {\n      const sector = SECTOR_ORDER[i];\n      const startAngle = i * degPerSector - degPerSector / 2;\n      const endAngle = startAngle + degPerSector;\n      const colors = SECTOR_COLORS[sector];\n\n      // Each sector has: outer single, double, inner single, treble\n      const rings = [\n        {\n          inner: TREBLE_OUTER_R,\n          outer: DOUBLE_INNER_R,\n          fill: colors.dark,\n        },\n        {\n          inner: DOUBLE_INNER_R,\n          outer: DOUBLE_OUTER_R,\n          fill: colors.light,\n        },\n        {\n          inner: BULL_OUTER_R,\n          outer: TREBLE_INNER_R,\n          fill: colors.dark,\n        },\n        {\n          inner: TREBLE_INNER_R,\n          outer: TREBLE_OUTER_R,\n          fill: colors.light,\n        },\n      ];\n\n      rings.forEach((ring, ri) => {\n        const r1 = ring.inner * SCALE;\n        const r2 = ring.outer * SCALE;\n        const p1 = polarToXY(CX, CY, r1, startAngle);\n        const p2 = polarToXY(CX, CY, r2, startAngle);\n        const p3 = polarToXY(CX, CY, r2, endAngle);\n        const p4 = polarToXY(CX, CY, r1, endAngle);\n        const largeArc = degPerSector > 180 ? 1 : 0;\n        const d = [\n          `M ${p1.x} ${p1.y}`,\n          `L ${p2.x} ${p2.y}`,\n          `A ${r2} ${r2} 0 ${largeArc} 1 ${p3.x} ${p3.y}`,\n          `L ${p4.x} ${p4.y}`,\n          `A ${r1} ${r1} 0 ${largeArc} 0 ${p1.x} ${p1.y}`,\n          \"Z\",\n        ].join(\" \");\n        paths.push(\n          <path\n            key={`s${sector}-r${ri}`}\n            d={d}\n            fill={ring.fill}\n            stroke=\"rgba(255,255,255,0.08)\"\n            strokeWidth={0.5}\n            opacity={0.85}\n          />,\n        );\n      });\n\n      // Number label\n      const labelPos = polarToXY(\n        CX,\n        CY,\n        (DOUBLE_OUTER_R + 12) * SCALE,\n        i * degPerSector,\n      );\n      paths.push(\n        <text\n          key={`label-${sector}`}\n          x={labelPos.x}\n          y={labelPos.y}\n          textAnchor=\"middle\"\n          dominantBaseline=\"central\"\n          fill=\"rgba(255,255,255,0.8)\"\n          fontSize=\"11\"\n          fontWeight=\"bold\"\n          fontFamily=\"system-ui, sans-serif\"\n        >\n          {sector}\n        </text>,\n      );\n    }\n\n    return paths;\n  }, []);\n\n  return (\n    <div className=\"relative\">\n      {label && (\n        <div className=\"text-center mb-2\">\n          <span\n            className={`text-xs font-bold uppercase tracking-widest ${\n              disabled && selectedPoint ? \"text-emerald-400\" : \"text-white/50\"\n            }`}\n          >\n            {label}\n          </span>\n        </div>\n      )}\n      <svg\n        ref={svgRef}\n        viewBox={`0 0 ${BOARD_SIZE} ${BOARD_SIZE}`}\n        className={`w-full h-full touch-none select-none ${\n          disabled ? \"pointer-events-none\" : \"cursor-crosshair\"\n        }`}\n        style={{ opacity: disabled && !selectedPoint ? 0.5 : 1 }}\n        onClick={handleClick}\n        onTouchEnd={handleTouch}\n      >\n        {/* Background */}\n        <circle cx={CX} cy={CY} r={CX} fill=\"#0a0a1a\" />\n\n        {/* Sector paths */}\n        {sectorPaths}\n\n        {/* Wire rings for realism */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={TREBLE_INNER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={TREBLE_OUTER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={DOUBLE_INNER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={DOUBLE_OUTER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={1}\n        />\n\n        {/* Bull outer (green) */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={BULL_OUTER_R * SCALE}\n          fill=\"#27ae60\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={0.8}\n        />\n        {/* Bull inner (red) */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={BULL_INNER_R * SCALE}\n          fill=\"#c0392b\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={0.8}\n        />\n\n        {/* Pulsing bullseye guide when no dart placed */}\n        {!selectedPoint && !disabled && (\n          <circle\n            cx={CX}\n            cy={CY}\n            r={BULL_OUTER_R * SCALE * 1.8}\n            fill=\"none\"\n            stroke=\"rgba(234,179,8,0.4)\"\n            strokeWidth={1.5}\n            strokeDasharray=\"4,4\"\n          >\n            <animate\n              attributeName=\"r\"\n              values={`${BULL_OUTER_R * SCALE * 1.5};${BULL_OUTER_R * SCALE * 2.2};${BULL_OUTER_R * SCALE * 1.5}`}\n              dur=\"2s\"\n              repeatCount=\"indefinite\"\n            />\n            <animate\n              attributeName=\"opacity\"\n              values=\"0.5;0.15;0.5\"\n              dur=\"2s\"\n              repeatCount=\"indefinite\"\n            />\n          </circle>\n        )}\n\n        {/* Crosshair at center */}\n        <line\n          x1={CX - 6}\n          y1={CY}\n          x2={CX + 6}\n          y2={CY}\n          stroke=\"rgba(255,255,255,0.25)\"\n          strokeWidth={0.5}\n        />\n        <line\n          x1={CX}\n          y1={CY - 6}\n          x2={CX}\n          y2={CY + 6}\n          stroke=\"rgba(255,255,255,0.25)\"\n          strokeWidth={0.5}\n        />\n\n        {/* Selected dart position */}\n        {selectedPoint && (\n          <>\n            {/* Line from bull to dart */}\n            <line\n              x1={CX}\n              y1={CY}\n              x2={selectedPoint.x}\n              y2={selectedPoint.y}\n              stroke={disabled ? \"rgba(34,197,94,0.6)\" : \"rgba(234,179,8,0.5)\"}\n              strokeWidth={1}\n              strokeDasharray=\"3,3\"\n            />\n            {/* Dart shadow */}\n            <circle\n              cx={selectedPoint.x + 1}\n              cy={selectedPoint.y + 1}\n              r={6}\n              fill=\"rgba(0,0,0,0.4)\"\n            />\n            {/* Dart marker - green when locked, yellow when editable */}\n            <circle\n              cx={selectedPoint.x}\n              cy={selectedPoint.y}\n              r={6}\n              fill={disabled ? \"#22c55e\" : \"#eab308\"}\n              stroke=\"#fff\"\n              strokeWidth={2}\n              className=\"drop-shadow-lg\"\n            />\n            <circle\n              cx={selectedPoint.x}\n              cy={selectedPoint.y}\n              r={2.5}\n              fill=\"#fff\"\n            />\n            {/* Lock icon indicator when locked */}\n            {disabled && (\n              <text\n                x={selectedPoint.x}\n                y={selectedPoint.y - 14}\n                textAnchor=\"middle\"\n                fill=\"#22c55e\"\n                fontSize=\"10\"\n                fontWeight=\"bold\"\n              >\n                ğŸ”’\n              </text>\n            )}\n          </>\n        )}\n      </svg>\n    </div>\n  );\n}\n\n/* â”€â”€ Player Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction PlayerCard({\n  name,\n  stats,\n  isLocal,\n  showCamera,\n  isWinner,\n  legDiff,\n}: {\n  name: string;\n  stats: ReturnType<typeof getPlayerStats>;\n  isLocal: boolean;\n  showCamera?: boolean;\n  isWinner?: boolean;\n  legDiff?: number | null;\n}) {\n  const legDiffValue =\n    typeof legDiff === \"number\" ? `${legDiff > 0 ? \"+\" : \"\"}${legDiff}` : null;\n  return (\n    <div\n      className={`relative rounded-xl border p-2 sm:p-3 transition-all duration-500 ${\n        isWinner\n          ? \"border-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/5 shadow-xl shadow-amber-500/10 ring-1 ring-amber-400/30\"\n          : \"border-white/10 bg-white/5\"\n      }`}\n    >\n      {isWinner && (\n        <div className=\"absolute -top-2.5 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-amber-500 text-black text-[9px] font-black uppercase tracking-widest rounded-full shadow-lg\">\n          <Crown className=\"w-2.5 h-2.5 inline mr-0.5\" />\n          Throws First\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"flex items-center gap-2 mb-2\">\n        <div\n          className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-black ${\n            isLocal\n              ? \"bg-gradient-to-br from-indigo-500 to-purple-600 text-white\"\n              : \"bg-gradient-to-br from-rose-500 to-orange-500 text-white\"\n          }`}\n        >\n          {name.substring(0, 2).toUpperCase()}\n        </div>\n        <div>\n          <div className=\"font-bold text-white text-sm sm:text-base tracking-tight\">\n            {name}\n          </div>\n          <div className=\"text-[9px] text-white/50 font-semibold uppercase tracking-wider\">\n            {isLocal ? \"You\" : \"Opponent\"}\n          </div>\n        </div>\n      </div>\n\n      {/* Stats grid */}\n      <div className=\"grid grid-cols-4 gap-1 mb-2\">\n        <StatPill label=\"Avg\" value={stats.avg3} highlight />\n        <StatPill label=\"F9\" value={stats.best9} />\n        <StatPill label=\"CO\" value={String(stats.bestCheckout)} />\n        <StatPill label=\"Leg Diff\" value={legDiffValue ?? \"0\"} />\n      </div>\n\n      <div className=\"grid grid-cols-3 gap-1 text-[9px]\">\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">180s</span>\n          <span className=\"font-bold text-white\">{stats.career180s}</span>\n        </div>\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">Scored</span>\n          <span className=\"font-bold text-white\">\n            {stats.lifetimeScored.toLocaleString()}\n          </span>\n        </div>\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">Darts</span>\n          <span className=\"font-bold text-white\">\n            {stats.lifetimeDarts.toLocaleString()}\n          </span>\n        </div>\n      </div>\n\n      {/* Camera preview */}\n      {showCamera && (\n        <div className=\"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/40\">\n          <div className=\"px-2 py-1 flex items-center gap-1.5 text-[9px] text-white/60 border-b border-white/5\">\n            <Camera className=\"w-2.5 h-2.5\" />\n            <span className=\"font-semibold uppercase tracking-wider\">\n              {isLocal ? \"Your Camera\" : \"Opponent Camera\"}\n            </span>\n            <span className=\"ml-auto text-emerald-400 font-bold\">â— Live</span>\n          </div>\n          <div className=\"aspect-video relative bg-black\">\n            {isLocal ? (\n              <CameraTile\n                autoStart\n                forceAutoStart\n                fill\n                aspect=\"free\"\n                tileFitModeOverride=\"fit\"\n                scale={1}\n              />\n            ) : (\n              <div className=\"w-full h-full flex items-center justify-center text-white/30 text-[10px]\">\n                <div className=\"text-center\">\n                  <Camera className=\"w-6 h-6 mx-auto mb-1 opacity-30\" />\n                  Waiting for opponent's feedâ€¦\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n/* â”€â”€ Main Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nexport default function MatchPrestart({\n  open,\n  matchInfo,\n  localUser,\n  opponentName,\n  opponentStats,\n  countdown = 15,\n  onChoice: _onChoice,\n  onBullThrow: _onBullThrow,\n  onAccept,\n  onCancel,\n  remoteChoice: _remoteChoice,\n  bullActive: _bullActive,\n  bullWinner: _bullWinner,\n  bullTied: _bullTied,\n}: MatchPrestartProps) {\n  const [seconds, setSeconds] = useState(countdown);\n  const [phase, setPhase] = useState<\"preview\" | \"rps\" | \"result\" | \"go\">(\n    \"preview\",\n  );\n  const [rpsStep, setRpsStep] = useState(0); // 0-2 cycling, 3 = revealed\n  const [localRps, setLocalRps] = useState<\"rock\" | \"paper\" | \"scissors\">(\n    \"rock\",\n  );\n  const [opponentRps, setOpponentRps] = useState<\"rock\" | \"paper\" | \"scissors\">(\n    \"rock\",\n  );\n  const [rpsRound, setRpsRound] = useState(0);\n  const [rpsDraw, setRpsDraw] = useState(false);\n  const portalElRef = useRef<HTMLElement | null>(\n    typeof document !== \"undefined\" ? document.createElement(\"div\") : null,\n  );\n\n  const RPS_ICONS: Record<string, string> = {\n    rock: \"âœŠ\",\n    paper: \"âœ‹\",\n    scissors: \"âœŒï¸\",\n  };\n  const RPS_LABELS: Record<string, string> = {\n    rock: \"Rock\",\n    paper: \"Paper\",\n    scissors: \"Scissors\",\n  };\n  const RPS_OPTIONS: Array<\"rock\" | \"paper\" | \"scissors\"> = [\n    \"rock\",\n    \"paper\",\n    \"scissors\",\n  ];\n\n  const localStats = useMemo(\n    () => getPlayerStats(localUser?.username || \"\"),\n    [localUser?.username],\n  );\n  const oppStats = useMemo(() => {\n    if (opponentStats) {\n      return {\n        avg3: opponentStats.avg3 || \"0.0\",\n        best9: opponentStats.best9 || \"0.0\",\n        bestCheckout: opponentStats.bestCheckout || \"â€“\",\n        bestLeg: opponentStats.bestLeg || \"â€“\",\n        career180s: opponentStats.career180s || 0,\n        lifetimeScored: 0,\n        lifetimeDarts: 0,\n      };\n    }\n    return getPlayerStats(opponentName);\n  }, [opponentName, opponentStats]);\n\n  // Pre-compute first thrower so the RPS effect can align the animation\n  const firstThrowerResolved = useMemo(() => {\n    if (!matchInfo) return localUser?.username || \"You\";\n    return (\n      matchInfo.firstThrowerName ||\n      matchInfo.createdBy ||\n      matchInfo.creatorName ||\n      localUser?.username ||\n      \"You\"\n    );\n  }, [matchInfo, localUser?.username]);\n\n  const isLocalFirst = useMemo(\n    () =>\n      firstThrowerResolved.toLowerCase() ===\n      (localUser?.username || \"You\").toLowerCase(),\n    [firstThrowerResolved, localUser?.username],\n  );\n\n  // Portal\n  useEffect(() => {\n    const el = portalElRef.current;\n    if (!el || typeof document === \"undefined\") return;\n    el.className = \"ndn-match-prestart-portal\";\n    document.body.appendChild(el);\n    return () => {\n      try {\n        el.parentNode?.removeChild(el);\n      } catch {}\n    };\n  }, []);\n\n  // Reset on open\n  useEffect(() => {\n    if (!open) return;\n    setSeconds(countdown);\n    setPhase(\"preview\");\n    setRpsStep(0);\n    setRpsRound(0);\n    setRpsDraw(false);\n  }, [open, countdown]);\n\n  // Preview â†’ RPS auto-transition after 4 seconds\n  useEffect(() => {\n    if (!open || phase !== \"preview\") return;\n    const t = setTimeout(() => setPhase(\"rps\"), 4000);\n    return () => clearTimeout(t);\n  }, [open, phase]);\n\n  // RPS cycling animation â€” re-rolls on draw until a winner is determined\n  useEffect(() => {\n    if (!open || phase !== \"rps\") return;\n    setRpsStep(0);\n    setRpsDraw(false);\n    let step = 0;\n    const cycleInterval = setInterval(() => {\n      step++;\n      if (step >= 9) {\n        clearInterval(cycleInterval);\n        const pick1 = RPS_OPTIONS[Math.floor(Math.random() * 3)];\n        const pick2 = RPS_OPTIONS[Math.floor(Math.random() * 3)];\n        if (pick1 === pick2) {\n          // Draw â€” show briefly then re-round\n          setLocalRps(pick1);\n          setOpponentRps(pick2);\n          setRpsStep(3);\n          setRpsDraw(true);\n          setTimeout(() => {\n            setRpsDraw(false);\n            setRpsRound((r) => r + 1);\n          }, 1800);\n        } else {\n          // Determine which pick wins\n          const pick1Wins =\n            (pick1 === \"rock\" && pick2 === \"scissors\") ||\n            (pick1 === \"scissors\" && pick2 === \"paper\") ||\n            (pick1 === \"paper\" && pick2 === \"rock\");\n          // Assign so the winning hand belongs to whoever the server says throws first\n          if (pick1Wins) {\n            setLocalRps(isLocalFirst ? pick1 : pick2);\n            setOpponentRps(isLocalFirst ? pick2 : pick1);\n          } else {\n            setLocalRps(isLocalFirst ? pick2 : pick1);\n            setOpponentRps(isLocalFirst ? pick1 : pick2);\n          }\n          setRpsStep(3);\n          setTimeout(() => setPhase(\"result\"), 1500);\n        }\n      } else {\n        setLocalRps(RPS_OPTIONS[step % 3]);\n        setOpponentRps(RPS_OPTIONS[(step + 1) % 3]);\n        setRpsStep(step);\n      }\n    }, 350);\n    return () => clearInterval(cycleInterval);\n  }, [open, phase, rpsRound, isLocalFirst]);\n\n  // Result â†’ GO transition\n  useEffect(() => {\n    if (phase !== \"result\") return;\n    const t = setTimeout(() => setPhase(\"go\"), 3000);\n    return () => clearTimeout(t);\n  }, [phase]);\n\n  // Auto-accept when \"go\" phase completes\n  useEffect(() => {\n    if (phase !== \"go\") return;\n    const t = setTimeout(() => {\n      onAccept();\n    }, 1500);\n    return () => clearTimeout(t);\n  }, [phase, onAccept]);\n\n  // Countdown timer for preview\n  useEffect(() => {\n    if (!open || phase !== \"preview\") return;\n    const id = window.setInterval(() => {\n      setSeconds((s) => Math.max(0, s - 1));\n    }, 1000);\n    return () => window.clearInterval(id);\n  }, [open, phase]);\n\n  const localName = localUser?.username || \"You\";\n  const headToHead = useMemo(\n    () => getHeadToHeadLegDiff(localName, opponentName),\n    [localName, opponentName],\n  );\n  const localLegDiff = headToHead.played ? headToHead.diffA : null;\n  const opponentLegDiff = headToHead.played ? headToHead.diffB : null;\n\n  if (!open || !portalElRef.current || !matchInfo) return null;\n\n  // Use pre-computed first thrower from useMemo (handles null matchInfo above)\n  const firstThrowerName = firstThrowerResolved;\n  const isLocalWinner = isLocalFirst;\n  const isOpponentWinner = !isLocalFirst;\n\n  const overlay = (\n    <div\n      className=\"fixed inset-0 z-[9998] bg-black/95 backdrop-blur-xl flex flex-col\"\n      style={{ height: \"100dvh\", maxHeight: \"100dvh\", overflow: \"hidden\" }}\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Match pre-start\"\n    >\n      {/* Decorative background */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[120px]\" />\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px]\" />\n        <div className=\"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent\" />\n      </div>\n\n      <div className=\"flex-1 flex items-center justify-center p-2 sm:p-4 min-h-0\">\n        <div className=\"relative w-full max-w-5xl max-h-full flex flex-col\">\n          {/* Close button */}\n          <button\n            className=\"absolute -top-2 -right-2 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition-all border border-white/10\"\n            onClick={onCancel}\n            aria-label=\"Cancel match\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n\n          {/* Match info header */}\n          <div className=\"text-center mb-2 sm:mb-4 flex-shrink-0\">\n            <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] sm:text-[11px] font-bold uppercase tracking-widest text-white/60 mb-2\">\n              <Target className=\"w-3 h-3\" />\n              {matchInfo.game} Â·{\" \"}\n              {matchInfo.modeType === \"bestof\" ? \"Best Of\" : \"First To\"}{\" \"}\n              {matchInfo.legs} Â· {matchInfo.startingScore || 501}\n            </div>\n\n            {phase === \"preview\" && (\n              <div className=\"animate-in fade-in duration-500\">\n                <h2 className=\"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tighter\">\n                  Match Found\n                </h2>\n                <p className=\"text-xs sm:text-sm text-white/50 mt-0.5\">\n                  Reviewing opponent statsâ€¦\n                </p>\n              </div>\n            )}\n\n            {phase === \"rps\" && (\n              <div className=\"animate-in fade-in duration-500\">\n                <h2 className=\"text-2xl sm:text-3xl font-black text-amber-300 tracking-tighter\">\n                  âœŠ Rock Paper Scissors! âœŒï¸\n                </h2>\n                <p className=\"text-xs sm:text-sm text-white/50 mt-0.5\">\n                  Deciding who throws firstâ€¦\n                </p>\n              </div>\n            )}\n\n            {phase === \"result\" && (\n              <div className=\"animate-in fade-in zoom-in-95 duration-700\">\n                <h2 className=\"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-amber-500 tracking-tighter\">\n                  ğŸ‰ {firstThrowerName} Throws First!\n                </h2>\n                <p className=\"text-xs sm:text-sm text-white/50 mt-1\">\n                  {firstThrowerName} won the coin toss\n                </p>\n              </div>\n            )}\n\n            {phase === \"go\" && (\n              <div className=\"animate-in fade-in zoom-in-50 duration-300\">\n                <h2 className=\"text-5xl sm:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500 tracking-tighter\">\n                  GO!\n                </h2>\n              </div>\n            )}\n          </div>\n\n          {/* Timer bar */}\n          {phase === \"preview\" && (\n            <div className=\"mb-2 sm:mb-4 flex-shrink-0\">\n              <div className=\"flex items-center justify-center gap-2 mb-1\">\n                <Timer className=\"w-3 h-3 sm:w-4 sm:h-4 text-white/40\" />\n                <span className=\"text-xl sm:text-2xl font-black text-white tabular-nums\">\n                  {seconds}\n                </span>\n                <span className=\"text-[10px] sm:text-xs text-white/40 font-semibold\">\n                  seconds\n                </span>\n              </div>\n              <div className=\"h-0.5 sm:h-1 bg-white/5 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000 ease-linear\"\n                  style={{\n                    width: `${(seconds / countdown) * 100}%`,\n                  }}\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Player cards + VS */}\n          {(phase === \"preview\" || phase === \"rps\" || phase === \"result\") && (\n            <div className=\"grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-2 sm:gap-4 items-start mb-2 sm:mb-4 flex-shrink-0\">\n              <PlayerCard\n                name={localName}\n                stats={localStats}\n                isLocal\n                showCamera={phase === \"preview\"}\n                legDiff={localLegDiff}\n                isWinner={phase === \"result\" && isLocalWinner}\n              />\n\n              {/* VS divider */}\n              <div className=\"hidden md:flex flex-col items-center justify-center py-8\">\n                <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-indigo-500/30 ring-2 ring-white/10\">\n                  VS\n                </div>\n                <div className=\"w-px h-12 bg-gradient-to-b from-indigo-500/30 to-transparent mt-2\" />\n              </div>\n              <div className=\"flex md:hidden items-center justify-center py-2\">\n                <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-xl shadow-indigo-500/30\">\n                  VS\n                </div>\n              </div>\n\n              <PlayerCard\n                name={opponentName}\n                stats={oppStats}\n                isLocal={false}\n                showCamera={phase === \"preview\"}\n                legDiff={opponentLegDiff}\n                isWinner={phase === \"result\" && isOpponentWinner}\n              />\n            </div>\n          )}\n\n          {/* RPS Animation */}\n          {phase === \"rps\" && (\n            <div className=\"flex flex-col items-center gap-4 animate-in fade-in duration-500 flex-shrink-0\">\n              <div className=\"flex items-center justify-center gap-8 sm:gap-12\">\n                {/* Local player RPS */}\n                <div className=\"text-center\">\n                  <div\n                    className={`text-6xl sm:text-7xl transition-transform duration-200 ${rpsStep < 3 ? \"animate-bounce\" : \"scale-110\"}`}\n                  >\n                    {RPS_ICONS[localRps]}\n                  </div>\n                  <div className=\"text-xs text-white/50 mt-2 font-semibold\">\n                    {localName}\n                  </div>\n                  {rpsStep >= 3 && (\n                    <div className=\"text-[10px] text-white/40 mt-0.5\">\n                      {RPS_LABELS[localRps]}\n                    </div>\n                  )}\n                </div>\n\n                {/* VS */}\n                <div className=\"flex flex-col items-center gap-1\">\n                  <div className=\"text-2xl sm:text-3xl font-black text-white/30\">\n                    VS\n                  </div>\n                  {rpsStep < 3 && (\n                    <div className=\"w-3 h-3 border-2 border-amber-400/30 border-t-amber-400 rounded-full animate-spin\" />\n                  )}\n                </div>\n\n                {/* Opponent RPS */}\n                <div className=\"text-center\">\n                  <div\n                    className={`text-6xl sm:text-7xl transition-transform duration-200 ${rpsStep < 3 ? \"animate-bounce\" : \"scale-110\"}`}\n                  >\n                    {RPS_ICONS[opponentRps]}\n                  </div>\n                  <div className=\"text-xs text-white/50 mt-2 font-semibold\">\n                    {opponentName}\n                  </div>\n                  {rpsStep >= 3 && (\n                    <div className=\"text-[10px] text-white/40 mt-0.5\">\n                      {RPS_LABELS[opponentRps]}\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {rpsStep >= 3 && !rpsDraw && (\n                <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/10 border border-amber-400/30 text-sm text-amber-200 font-semibold animate-in fade-in zoom-in-95 duration-500\">\n                  <Zap className=\"w-4 h-4 text-amber-400\" />\n                  {firstThrowerName} throws first!\n                </div>\n              )}\n              {rpsStep >= 3 && rpsDraw && (\n                <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-rose-500/10 border border-rose-400/30 text-sm text-rose-200 font-semibold animate-in fade-in zoom-in-95 duration-500\">\n                  ğŸ¤ Draw! Going againâ€¦\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Preview cancel button */}\n          {phase === \"preview\" && (\n            <div className=\"flex items-center justify-center mt-2 sm:mt-4 flex-shrink-0\">\n              <button\n                className=\"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-white/5 border border-white/10 text-white/70 font-semibold text-sm sm:text-base hover:bg-white/10 transition-all\"\n                onClick={onCancel}\n              >\n                Cancel\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n\n  return createPortal(overlay, portalElRef.current);\n}\n","import React, { useState, useMemo, useEffect, useRef } from \"react\";\nimport {\n  Search,\n  Zap,\n  Target,\n  Trophy,\n  Users,\n  Clock,\n  ChevronDown,\n} from \"lucide-react\";\nimport { getGameDisplay } from \"../utils/games.js\";\nimport CreateMatchModal from \"./ui/CreateMatchModal.js\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase.js\";\nimport MatchPrestart from \"./ui/MatchPrestart.js\";\nimport InGameShell from \"./InGameShell.js\";\nimport MatchSummaryModal from \"./MatchSummaryModal.js\";\nimport { useMatch } from \"../store/match.js\";\nimport type { Player } from \"../store/match.js\";\nimport { useMatchControl } from \"../store/matchControl.js\";\nimport { useWS } from \"./WSProvider.js\";\nimport { openMatchWindow } from \"../utils/matchWindow.js\";\n\nexport default function OnlinePlayClean({ user }: { user?: any }) {\n  const username = user?.username || \"You\";\n  const [currentPageIdx, setCurrentPageIdx] = useState(0);\n  const [pages, setPages] = useState(() => [\n    { id: 1, name: \"page-1\", pageId: \"default\", matches: [] as any[] },\n  ]);\n  const wsGlobal = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  const [serverMatches, setServerMatches] = useState<any[]>([]);\n  const inProgress = useMatch((s) => s.inProgress);\n  const matchContext = useMatch((s) => s.matchContext);\n  const players = useMatch((s) => s.players);\n  const [focusMode, setFocusMode] = useState(false);\n  const matchesRef = useRef<HTMLDivElement | null>(null);\n\n  // â”€â”€ Match summary modal (shown when an online match ends) â”€â”€\n  const [showMatchSummary, setShowMatchSummary] = useState(false);\n  const [summaryPlayers, setSummaryPlayers] = useState<Player[]>([]);\n  const prevInProgressRef = useRef(false);\n  useEffect(() => {\n    if (prevInProgressRef.current && !inProgress && matchContext === \"online\") {\n      const st = useMatch.getState();\n      if (st.players && st.players.length > 0) {\n        setSummaryPlayers(JSON.parse(JSON.stringify(st.players)));\n        setShowMatchSummary(true);\n      }\n      // Scroll the main container back to the top so the lobby renders correctly\n      try {\n        const scroller = document.getElementById(\"ndn-main-scroll\");\n        if (scroller) scroller.scrollTop = 0;\n      } catch {}\n    }\n    prevInProgressRef.current = inProgress;\n  }, [inProgress, matchContext]);\n  useEffect(() => {\n    if (!focusMode) return;\n    function onDocClick(e: MouseEvent) {\n      try {\n        if (!matchesRef.current) return;\n        if (!matchesRef.current.contains(e.target as Node)) {\n          setFocusMode(false);\n        }\n      } catch {}\n    }\n    document.addEventListener(\"mousedown\", onDocClick);\n    return () => document.removeEventListener(\"mousedown\", onDocClick);\n  }, [focusMode]);\n  const [showStartShowcase, setShowStartShowcase] = useState<boolean>(false);\n  const startedShowcasedRef = React.useRef(false);\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"online\") {\n      startedShowcasedRef.current = false;\n      setShowStartShowcase(false);\n      return;\n    }\n    if (startedShowcasedRef.current) return;\n    // Only show the showcase if the match hasn't progressed yet\n    const st = useMatch.getState();\n    const hasVisits = (st.players || []).some((p: any) =>\n      (p.legs || []).some((L: any) => (L.visits || []).length > 0),\n    );\n    if (hasVisits) return;\n    startedShowcasedRef.current = true;\n    setShowStartShowcase(true);\n  }, [inProgress, matchContext]);\n\n  // Auto-open the dedicated match window for online X01 matches.\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"online\") return;\n    try {\n      const st = useMatch.getState();\n      const game = ((st as any)?.game || \"X01\") as string;\n      if (game !== \"X01\") return;\n      if (!st.roomId) return;\n\n      const flagKey = `ndn:matchWindowOpened:${st.roomId}`;\n      if (window.sessionStorage.getItem(flagKey) === \"1\") return;\n      window.sessionStorage.setItem(flagKey, \"1\");\n      openMatchWindow();\n    } catch {}\n  }, [inProgress, matchContext]);\n\n  // Allow the overlay to show again the next time a match starts.\n  useEffect(() => {\n    if (inProgress && matchContext === \"online\") return;\n    startedShowcasedRef.current = false;\n  }, [inProgress, matchContext]);\n\n  // Announce presence to server so it knows our username\n  useEffect(() => {\n    if (wsGlobal?.connected && user?.username) {\n      try {\n        wsGlobal.send({\n          type: \"presence\",\n          username: user.username,\n          email: user.email || \"\",\n        });\n      } catch {}\n    }\n  }, [wsGlobal?.connected, user]);\n\n  // Signal to App.tsx that OnlinePlay is mounted so it doesn't double-dispatch\n  // invite/prestart events (OnlinePlay's own WS listener handles them directly)\n  useEffect(() => {\n    (window as any).__ndn_online_mounted = true;\n    return () => {\n      (window as any).__ndn_online_mounted = false;\n    };\n  }, []);\n\n  // Global quit handler (from CameraView Quit / Pause modal)\n  useEffect(() => {\n    const onQuit = () => {\n      try {\n        useMatch.getState().endGame();\n      } catch (e) {}\n      // Clear all prestart / invite state to prevent phantom popups\n      setPendingInvite(null);\n      setWaitingForCreator(null);\n      setJoinMatch(null);\n      setJoinChoice(null);\n      setOpponentQuitName(null);\n      pendingMatchRef.current = null;\n      try {\n        (window as any).__ndn_pending_invite = null;\n      } catch {}\n    };\n    try {\n      window.addEventListener(\"ndn:match-quit\" as any, onQuit as any);\n    } catch {}\n    return () => {\n      try {\n        window.removeEventListener(\"ndn:match-quit\" as any, onQuit as any);\n      } catch {}\n    };\n  }, []);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [joinMatch, setJoinMatch] = useState<any | null>(null);\n  const joinAcceptRef = React.useRef<HTMLButtonElement | null>(null);\n  // Incoming invite popup: shown to the creator when a joiner wants to join\n  const [pendingInvite, setPendingInvite] = useState<any | null>(null);\n  // Waiting state: shown to the joiner while waiting for the creator to accept\n  const [waitingForCreator, setWaitingForCreator] = useState<string | null>(\n    null,\n  );\n  // Preserve match info across handleJoinAccept â†’ match-start gap\n  // (handleJoinAccept clears joinMatch before the server sends match-start)\n  const pendingMatchRef = useRef<any | null>(null);\n  const [_selfId, setSelfId] = useState<string | null>(null);\n  const [participants, setParticipants] = useState<Record<string, string>>({});\n  const [joinTimer, setJoinTimer] = useState(30);\n  // Keep latest matches in a ref so the WS listener can update synchronously\n  // for tests (avoids a stale closure / async state timing issue).\n  const serverMatchesRef = useRef<any[]>([]);\n  useEffect(() => {\n    serverMatchesRef.current = serverMatches || [];\n  }, [serverMatches]);\n  // Keep pendingMatchRef in sync with joinMatch so the WS listener\n  // (which has a stale closure over joinMatch) can always read current data.\n  useEffect(() => {\n    if (joinMatch) pendingMatchRef.current = { ...joinMatch };\n  }, [joinMatch]);\n  const serverPrestartRef = React.useRef(false);\n  const [joinChoice, setJoinChoice] = useState<null | \"bull\" | \"skip\">(null);\n  const [remoteChoices, setRemoteChoices] = useState<\n    Record<string, \"bull\" | \"skip\">\n  >({});\n  const [bullActive, setBullActive] = useState(false);\n  const [bullThrow, setBullThrow] = useState<number | null>(null);\n  const [bullWinner, setBullWinner] = useState<string | null>(null);\n  const [bullLocalThrow, setBullLocalThrow] = useState<number | null>(null);\n  const [bullThrown, setBullThrown] = useState(false);\n  const [bullTied, setBullTied] = useState(false);\n  // Opponent quit notification â€” shown when the remote player leaves mid-match\n  const [opponentQuitName, setOpponentQuitName] = useState<string | null>(null);\n  // Track the active game mode for the current match (e.g. 'X01', 'Cricket', 'Around the Clock')\n  const [currentGame, setCurrentGame] = useState<string>(\"X01\");\n  // Opponent camera frame â€” use a ref to avoid React re-renders on every frame\n  const opponentFrameRef = useRef<string | null>(null);\n  const [opponentFrame, setOpponentFrame] = useState<string | null>(null);\n\n  // Filter & Sort State\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filterGame, setFilterGame] = useState<\n    \"all\" | \"x01\" | \"cricket\" | \"bermuda\" | \"gotcha\"\n  >(\"all\");\n  const [filterMode, setFilterMode] = useState<\"all\" | \"first_to\" | \"best_of\">(\n    \"all\",\n  );\n  const [sortBy, setSortBy] = useState<\"newest\" | \"oldest\">(\"newest\");\n\n  // Pagination State\n  const [currentPage, setCurrentPage] = useState(1);\n  const itemsPerPage = 12;\n\n  const currentPage_ = pages[currentPageIdx];\n  // NOTE: This is a *UX* hint for when to show a \"page is full\" message.\n  // We do not hard-cap rendering at this number (tests and pagination rely on\n  // the full list being renderable).\n  const maxMatchesPerPage = 999;\n\n  const normalizeMatch = React.useCallback((m: any) => {\n    if (!m) return m;\n    const modeType = m.modeType || m.mode || \"\";\n    const legs = m.legs ?? m.value ?? m.bestOf ?? m.sets ?? m.games ?? 1;\n    const createdBy = m.createdBy || m.creatorName || m.creator || m.host || \"\";\n    const createdAt = m.createdAt || m.ts || Date.now();\n\n    return {\n      ...m,\n      modeType,\n      mode: modeType || m.mode,\n      legs,\n      value: typeof m.value === \"number\" ? m.value : legs,\n      createdBy,\n      creatorName: m.creatorName || createdBy,\n      createdAt,\n    };\n  }, []);\n\n  const filterMatches = useMemo(() => {\n    return (list: any[] = []) =>\n      (list || [])\n        .map(normalizeMatch)\n        .filter(\n          (m: any) =>\n            !(\n              m?.isTest ||\n              m?.test ||\n              m?.migrated ||\n              m?.isMigration ||\n              m?.migration ||\n              m?.seeded ||\n              m?.status === \"completed\" ||\n              m?.status === \"played\" ||\n              (m?.declineCount && m.declineCount >= 3) ||\n              (typeof m?.createdBy === \"string\" &&\n                m.createdBy.toLowerCase().includes(\"test\")) ||\n              (typeof m?.creatorName === \"string\" &&\n                m.creatorName.toLowerCase().includes(\"test\")) ||\n              (typeof m?.createdBy === \"string\" &&\n                /^(alice-|host-|demo|dummy|sample)/i.test(m.createdBy)) ||\n              (typeof m?.creatorName === \"string\" &&\n                /^(alice-|host-|demo|dummy|sample)/i.test(m.creatorName)) ||\n              !(m?.game && m?.modeType && m?.legs)\n            ),\n        );\n    // NOTE: do NOT hard-cap here; tests and pagination expect the full\n    // list to render (page size controls how many are visible).\n  }, [normalizeMatch]);\n\n  // NOTE: worldLobby was previously used for an alternate lobby view; keep the\n  // computation removed to avoid unused-vars warnings.\n\n  // Combined matches: show only current page, filtered by its pageId\n  const combinedMatches = useMemo(() => {\n    const activePageId = currentPage_?.pageId || \"default\";\n    let all = filterMatches(currentPage_?.matches || []);\n\n    // Fallback: if the page hasn't been hydrated yet (first render before WS\n    // responds), filter serverMatches by this page's pageId.\n    if ((all?.length || 0) === 0 && (serverMatches?.length || 0) > 0) {\n      all = filterMatches(\n        serverMatches.filter(\n          (m: any) => (m.pageId || \"default\") === activePageId,\n        ),\n      );\n    }\n\n    // Last-resort fallback for test environments (same page-scoped filter).\n    if (\n      (all?.length || 0) === 0 &&\n      (serverMatchesRef.current?.length || 0) > 0\n    ) {\n      all = filterMatches(\n        serverMatchesRef.current.filter(\n          (m: any) => (m.pageId || \"default\") === activePageId,\n        ),\n      );\n    }\n\n    // 1. Search\n    if (searchQuery.trim()) {\n      const q = searchQuery.toLowerCase();\n      all = all.filter(\n        (m: any) =>\n          (m.game || \"\").toLowerCase().includes(q) ||\n          (m.createdBy || m.creatorName || \"\").toLowerCase().includes(q) ||\n          (m.id || \"\").toLowerCase().includes(q),\n      );\n    }\n\n    // 2. Filter Game\n    if (filterGame !== \"all\") {\n      all = all.filter((m: any) => (m.game || \"\").toLowerCase() === filterGame);\n    }\n\n    // 3. Filter Mode\n    if (filterMode !== \"all\") {\n      // normalize modeType. Some might be 'first_to' or 'bestof'\n      all = all.filter((m: any) => {\n        const mt = (m.modeType || \"\").replace(\"_\", \"\").toLowerCase(); // 'firstto', 'bestof'\n        const target = filterMode.replace(\"_\", \"\").toLowerCase();\n        return mt.includes(target);\n      });\n    }\n\n    // 4. Sort\n    all = (all || []).slice();\n    all.sort((a: any, b: any) => {\n      const tA = a.createdAt || 0;\n      const tB = b.createdAt || 0;\n      return sortBy === \"newest\" ? tB - tA : tA - tB;\n    });\n\n    return all.slice(0, maxMatchesPerPage);\n  }, [\n    currentPage_,\n    serverMatches,\n    filterMatches,\n    searchQuery,\n    filterGame,\n    filterMode,\n    sortBy,\n    maxMatchesPerPage,\n  ]);\n\n  // Reset page when filters change\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [searchQuery, filterGame, filterMode, sortBy, currentPageIdx]);\n\n  const totalPages = Math.ceil(combinedMatches.length / itemsPerPage);\n  const paginatedMatches = combinedMatches.slice(\n    (currentPage - 1) * itemsPerPage,\n    currentPage * itemsPerPage,\n  );\n\n  const handleQuickJoin = () => {\n    if (combinedMatches.length > 0) {\n      requestJoin(combinedMatches[0]);\n    }\n  };\n\n  const handleCreateMatch = (payload: any) => {\n    const activePageId = currentPage_?.pageId || \"default\";\n    const newMatch = {\n      id: `m-${Date.now()}`,\n      createdBy: payload.createdBy || username,\n      game: payload.game,\n      modeType: payload.modeType,\n      legs: payload.legs,\n      startingScore: payload.startingScore,\n      pageId: activePageId,\n      createdAt: Date.now(),\n    };\n\n    // Only add optimistically if we are NOT connected to the server\n    // Otherwise, we wait for the server to broadcast the new match to avoid duplicates\n    if (!wsGlobal?.connected) {\n      setPages((prev) =>\n        prev.map((r, idx) =>\n          idx === currentPageIdx\n            ? { ...r, matches: [newMatch, ...r.matches] }\n            : r,\n        ),\n      );\n    }\n\n    // If we have a server WS connection, send a create-match message\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before creating match to guarantee correct attribution\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n\n        wsGlobal.send({\n          type: \"create-match\",\n          game: payload.game,\n          mode: payload.modeType,\n          value: payload.legs,\n          startingScore: payload.startingScore,\n          creatorAvg: payload.avgChoice || 0,\n          pageId: activePageId,\n        });\n      }\n    } catch {}\n  };\n\n  const newPage = () => {\n    setPages((prev) => {\n      const id = prev.length + 1;\n      const pageId = `page-${id}-${Date.now()}`;\n      const newPages = [\n        ...prev,\n        { id, name: `page-${id}`, pageId, matches: [] },\n      ];\n      setCurrentPageIdx(newPages.length - 1);\n      return newPages;\n    });\n  };\n\n  // Shared handler for invite / prestart messages\n  const handleInviteOrPrestart = React.useCallback(\n    (msg: any) => {\n      try {\n        console.log(\"[OnlinePlay] handleInviteOrPrestart:\", msg?.type, msg);\n        if (msg?.type === \"invite\") {\n          // Creator receives an invite â€” show accept/decline popup\n          const inviteData = {\n            id: msg.matchId,\n            game: msg.game,\n            mode: msg.mode || \"firstto\",\n            value: msg.value || 1,\n            startingScore: msg.startingScore || 501,\n            fromName: msg.fromName || \"Opponent\",\n            fromId: msg.fromId,\n          };\n          setPendingInvite(inviteData);\n          // Play a notification sound if available\n          try {\n            const audio = new Audio(\"/sounds/notify.mp3\");\n            audio.volume = 0.5;\n            audio.play().catch(() => {});\n          } catch {}\n        }\n        if (msg?.type === \"invite-waiting\") {\n          // Joiner is waiting for the creator to accept\n          setWaitingForCreator(msg.creatorName || \"Creator\");\n        }\n        if (msg?.type === \"match-prestart\") {\n          // Ignore if a match is already running (prevents phantom prestart\n          // after quitting a match while a stale server message arrives)\n          if (useMatch.getState().inProgress) return;\n          // Both players enter prestart after creator accepted the invite\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          const m = normalizeMatch(msg.match || null);\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\n          // Store server-assigned first thrower for RPS reveal\n          if (m) {\n            m.firstThrowerId = msg.firstThrowerId || null;\n            m.firstThrowerName = msg.firstThrowerName || null;\n          }\n          // Determine if the local user is the creator so we can set the\n          // correct opponent name and send the right toId in handleJoinAccept\n          if (m) {\n            const localName = (user?.username || \"\").toLowerCase();\n            const creatorLower = (\n              m.creatorName ||\n              m.createdBy ||\n              \"\"\n            ).toLowerCase();\n            if (localName && creatorLower === localName) {\n              m._isCreatorView = true;\n            }\n          }\n          try {\n            if (m?.creatorId && m?.creatorName)\n              setParticipants((prev) => ({\n                ...prev,\n                [m.creatorId]: m.creatorName,\n              }));\n          } catch {}\n          serverPrestartRef.current = true;\n          setJoinMatch(m);\n          const endsAt = msg.prestartEndsAt || Date.now();\n          setJoinTimer(\n            Math.max(\n              0,\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\n            ),\n          );\n          setTimeout(() => {\n            serverPrestartRef.current = false;\n          }, 0);\n          setJoinChoice(null);\n          setRemoteChoices({});\n          setBullActive(false);\n          setBullThrow(null);\n          setBullWinner(null);\n          setBullTied(false);\n        }\n        if (msg?.type === \"invite-expired\") {\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          setJoinMatch((prev: any) =>\n            prev && msg.matchId === prev.id ? null : prev,\n          );\n        }\n        if (msg?.type === \"declined\") {\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          setJoinMatch((prev: any) =>\n            prev && msg.matchId === prev.id ? null : prev,\n          );\n        }\n      } catch {}\n    },\n    [normalizeMatch, user],\n  );\n\n  // Shared handler for match-start messages (used by WS listener and forwarded events)\n  const handleMatchStart = React.useCallback(\n    (msg: any) => {\n      if (msg?.type !== \"match-start\") return;\n      // Prevent double-init if match is already running\n      if (useMatch.getState().inProgress) return;\n\n      const serverMatch = msg.match || {};\n      const saved = pendingMatchRef.current || {};\n      const roomId = msg.roomId || saved.id || \"\";\n      const startScore =\n        serverMatch.startingScore || saved.startingScore || 501;\n      const localName = username;\n      const creatorName =\n        serverMatch.creatorName || saved.creatorName || saved.createdBy || \"\";\n      const joinerName = serverMatch.joinerName || saved.joinerName || \"\";\n\n      // Determine player order: first thrower goes first\n      // Dev server sends firstPlayerId, deployed server sends firstThrowerId\n      const firstId = msg.firstThrowerId || msg.firstPlayerId || null;\n      const isLocalCreator =\n        saved._isCreatorView ||\n        creatorName.toLowerCase() === localName.toLowerCase();\n      const opponentName = isLocalCreator\n        ? joinerName || \"Opponent\"\n        : creatorName || \"Opponent\";\n\n      let localGoesFirst: boolean;\n      if (firstId) {\n        const creatorId = serverMatch.creatorId || saved.creatorId;\n        localGoesFirst = isLocalCreator\n          ? firstId === creatorId\n          : firstId !== creatorId;\n      } else {\n        localGoesFirst = isLocalCreator;\n      }\n\n      const playerNames = localGoesFirst\n        ? [localName, opponentName]\n        : [opponentName, localName];\n\n      // Compute legsToWin from match format (bestof / firstto)\n      const mode = serverMatch.mode || saved.mode || saved.modeType || \"bestof\";\n      const value = Number(serverMatch.value || saved.value || saved.legs || 1);\n      const legsToWin = mode === \"firstto\" ? value : Math.ceil(value / 2);\n\n      // Initialize the match in the store â€” sets inProgress = true\n      try {\n        useMatch\n          .getState()\n          .newMatch(playerNames, startScore, roomId, \"online\", legsToWin);\n      } catch (e) {\n        console.error(\"[OnlinePlay] newMatch failed:\", e);\n      }\n\n      // Track the game mode for this match\n      const gameMode = serverMatch.game || saved.game || \"X01\";\n      setCurrentGame(gameMode);\n\n      // Join the WS room so we receive real-time score updates\n      try {\n        if (wsGlobal?.connected) {\n          wsGlobal.send({ type: \"join\", roomId });\n        }\n      } catch {}\n\n      // Clean up prestart state\n      pendingMatchRef.current = null;\n      setJoinMatch(null);\n      setJoinChoice(null);\n      setRemoteChoices({});\n    },\n    [username, wsGlobal],\n  );\n\n  // WS: subscribe to lobby and prestart events\n  useEffect(() => {\n    if (!wsGlobal) return;\n    if (wsGlobal.connected) wsGlobal.send({ type: \"list-matches\" });\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg?.type === \"joined\") {\n          if (msg.id) setSelfId(msg.id);\n        }\n        if (msg?.type === \"presence\") {\n          // presence carries id and username\n          try {\n            if (msg.id)\n              setParticipants((prev) => ({\n                ...prev,\n                [msg.id]: msg.username || msg.name || msg.id,\n              }));\n          } catch {}\n        }\n        if (msg?.type === \"matches\") {\n          const filtered = filterMatches(msg.matches || []);\n          setServerMatches(filtered);\n          serverMatchesRef.current = filtered;\n          // Partition matches by pageId into each page\n          setPages((prev) =>\n            prev.map((r) => {\n              const pageMatches = filtered.filter((m: any) => {\n                const mPage = m.pageId || \"default\";\n                return mPage === r.pageId;\n              });\n              return { ...r, matches: pageMatches };\n            }),\n          );\n        }\n        // Invite / prestart / expired / declined\n        handleInviteOrPrestart(msg);\n\n        if (msg?.type === \"match-start\") {\n          handleMatchStart(msg);\n        }\n        if (msg?.type === \"prestart-choice-notify\") {\n          const { roomId, playerId, choice } = msg;\n          if (!roomId || !choice) return;\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\n        }\n        if (msg?.type === \"prestart-bull\") {\n          setBullActive(true);\n          setBullThrown(false);\n          setBullLocalThrow(null);\n        }\n        if (msg?.type === \"prestart-bull-winner\") {\n          setBullWinner(msg.winnerName || msg.winnerId || null);\n          setBullActive(false);\n          setBullThrown(false);\n          setBullTied(false);\n        }\n        if (msg?.type === \"prestart-bull-tie\") {\n          // reset to allow another round\n          setBullWinner(null);\n          setBullActive(false);\n          setBullThrown(false);\n          setBullTied(true);\n          // Auto-reset tied state after 2s so the dartboard reappears\n          setTimeout(() => setBullTied(false), 2000);\n        }\n        // Opponent quit â€” show overlay so this player can leave gracefully\n        if (msg?.type === \"opponent-quit\") {\n          setOpponentQuitName(msg.quitterName || \"Opponent\");\n        }\n        // Opponent paused â€” sync pause state locally\n        if (msg?.type === \"opponent-paused\") {\n          try {\n            useMatchControl\n              .getState()\n              .setPaused(true, null, msg.pauserName || \"Opponent\");\n          } catch {}\n        }\n        // Opponent resumed â€” sync unpause state locally\n        if (msg?.type === \"opponent-unpaused\") {\n          try {\n            useMatchControl.getState().setPaused(false, null);\n          } catch {}\n        }\n        // Incoming match state from opponent â€” sync scores/turns\n        if (msg?.type === \"state\" && msg.payload) {\n          try {\n            useMatch.getState().importState(msg.payload);\n          } catch {}\n        }\n        // Opponent camera frame snapshot â€” update ref directly to bypass React re-renders\n        if (msg?.type === \"camera-frame\" && msg.frame) {\n          opponentFrameRef.current = msg.frame;\n          // Update the img element directly via DOM ref for zero-lag rendering\n          try {\n            const el = document.getElementById(\n              \"ndn-opponent-frame\",\n            ) as HTMLImageElement | null;\n            if (el) el.src = msg.frame;\n          } catch {}\n          // Set state once to signal that frames are arriving (controls visibility)\n          if (!opponentFrame) setOpponentFrame(msg.frame);\n        }\n      } catch (err) {}\n    });\n    return unsub;\n  }, [\n    wsGlobal,\n    joinChoice,\n    filterMatches,\n    currentPageIdx,\n    handleInviteOrPrestart,\n    handleMatchStart,\n  ]);\n\n  // Listen for forwarded invite/prestart/match-start events from App.tsx (global listener)\n  // This fires when the user is on a different tab and App.tsx switches to\n  // the online tab + dispatches the WS message via a CustomEvent.\n  // Also check for a stashed pending message on mount (the event may have fired\n  // before this component mounted).\n  useEffect(() => {\n    // Check for a pending message stashed by App.tsx before we mounted\n    try {\n      const pending = (window as any).__ndn_pending_invite;\n      if (pending) {\n        (window as any).__ndn_pending_invite = null;\n        if (pending.type === \"match-start\") {\n          handleMatchStart(pending);\n        } else {\n          handleInviteOrPrestart(pending);\n        }\n      }\n    } catch {}\n\n    const onInviteEvent = (e: Event) => {\n      try {\n        const msg = (e as CustomEvent).detail;\n        if (!msg) return;\n        if (msg.type === \"match-start\") {\n          handleMatchStart(msg);\n        } else {\n          handleInviteOrPrestart(msg);\n        }\n      } catch {}\n    };\n    window.addEventListener(\"ndn:match-invite\", onInviteEvent);\n    return () => window.removeEventListener(\"ndn:match-invite\", onInviteEvent);\n  }, [handleInviteOrPrestart, handleMatchStart]);\n\n  // Join timer\n  useEffect(() => {\n    if (!joinMatch) return;\n    if (serverPrestartRef.current) return;\n    // If a server-supplied prestart exists, do not override joinTimer\n    if ((joinMatch as any).prestartEndsAt) return;\n    setJoinTimer(30);\n    setJoinChoice(null);\n    setRemoteChoices({});\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\n    return () => clearInterval(t);\n  }, [joinMatch]);\n\n  // Focus the accept button when the join modal is shown\n  useEffect(() => {\n    if (!joinMatch) return;\n    setTimeout(() => joinAcceptRef.current?.focus(), 0);\n  }, [joinMatch]);\n\n  const handleJoinAccept = () => {\n    // Show the pre-game overlay immediately for snappy UX.\n    setShowStartShowcase(true);\n    // Save match info so we can start the match directly\n    const saved = joinMatch ? { ...joinMatch } : null;\n    if (saved) {\n      pendingMatchRef.current = saved;\n    }\n    // Send accept (invite-response) to server\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        // If the local user is the creator accepting an invite, toId is the joiner\n        // If the local user is the joiner, toId is the creator\n        const isCreatorAccepting = !!joinMatch._isCreatorView;\n        wsGlobal.send({\n          type: \"invite-response\",\n          matchId: joinMatch.id,\n          accept: true,\n          toId: isCreatorAccepting ? joinMatch.joinerId : joinMatch.creatorId,\n        });\n      }\n    } catch {}\n    // Start the match directly â€” do not wait for server match-start\n    // (the server will still send match-start, but handleMatchStart\n    // will no-op because inProgress is already true)\n    if (saved) {\n      handleMatchStart({\n        type: \"match-start\",\n        match: saved,\n        roomId: saved.id,\n        firstThrowerId: saved.firstThrowerId || null,\n        firstPlayerId: saved.firstThrowerId || null,\n      });\n    } else {\n      // Fallback: clear joinMatch and hope server sends match-start\n      setJoinMatch(null);\n    }\n  };\n\n  const requestJoin = (m: any) => {\n    // Do NOT set joinMatch here â€” wait for the server's match-prestart after\n    // the creator accepts.  Setting it prematurely opens MatchPrestart and\n    // auto-starts the match before the creator has even accepted.\n    // Show immediate \"Waiting for creator\" feedback instead.\n    setWaitingForCreator(m.creatorName || m.createdBy || \"Creator\");\n    // Stash match info so handleMatchStart has fallback data\n    pendingMatchRef.current = { ...m };\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before joining\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n        wsGlobal.send({ type: \"join-match\", matchId: m.id, calibrated: true });\n      }\n    } catch {}\n  };\n\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\n    setJoinChoice(choice);\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"prestart-choice\",\n          roomId: joinMatch.id,\n          choice,\n        });\n      }\n    } catch {}\n  };\n\n  // No local state for the start showcase; MatchStartShowcase reads from `match.inProgress` directly\n\n  const sendState = React.useCallback(() => {\n    try {\n      if (wsGlobal?.connected) {\n        const st = useMatch.getState();\n        wsGlobal.send({ type: \"state\", payload: st });\n      }\n    } catch {}\n  }, [wsGlobal]);\n\n  // Stream local camera frames to opponent via WS at ~24 FPS for smooth video\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"online\") return;\n    if (!wsGlobal?.connected) return;\n    let alive = true;\n    // Reuse a single off-screen canvas to avoid GC pressure\n    const c = document.createElement(\"canvas\");\n    const ctx = c.getContext(\"2d\");\n    let lastSendTs = 0;\n    const FRAME_INTERVAL = 42; // ~24 FPS\n\n    const loop = () => {\n      if (!alive) return;\n      requestAnimationFrame(loop);\n      const now = performance.now();\n      if (now - lastSendTs < FRAME_INTERVAL) return;\n      try {\n        const dbg = (window as any).__ndn_camera_debug;\n        const video = dbg?.videoEl?.() as HTMLVideoElement | null;\n        if (!video || !video.videoWidth || !video.videoHeight) return;\n        const w = 480;\n        const h = Math.round((video.videoHeight / video.videoWidth) * w) || 270;\n        if (c.width !== w) c.width = w;\n        if (c.height !== h) c.height = h;\n        if (!ctx) return;\n        ctx.drawImage(video, 0, 0, w, h);\n        lastSendTs = now;\n        // Synchronous toDataURL is faster than async toBlob+FileReader for small frames\n        const frame = c.toDataURL(\"image/jpeg\", 0.55);\n        try {\n          wsGlobal.send({ type: \"camera-frame\", frame });\n        } catch {}\n      } catch {}\n    };\n    requestAnimationFrame(loop);\n    return () => {\n      alive = false;\n    };\n  }, [inProgress, matchContext, wsGlobal]);\n\n  // Clear opponent frame when match ends\n  useEffect(() => {\n    if (!inProgress || matchContext !== \"online\") {\n      setOpponentFrame(null);\n    }\n  }, [inProgress, matchContext]);\n\n  // â”€â”€ When a match is in progress, render the full in-game shell â”€â”€\n  // Only show InGameShell if the match was started from OnlinePlay (context === 'online').\n  // This prevents offline or tournament matches from falsely rendering here.\n  if (inProgress && matchContext === \"online\") {\n    const matchState = useMatch.getState();\n    const localIdx = (matchState.players || []).findIndex(\n      (p: any) => p?.name && p.name.toLowerCase() === username.toLowerCase(),\n    );\n    return (\n      <>\n        <InGameShell\n          user={user}\n          showStartShowcase={showStartShowcase}\n          onShowStartShowcaseChange={setShowStartShowcase}\n          onCommitVisit={(score, _darts, _meta) => {\n            try {\n              const m = useMatch.getState();\n              const p = m.players[m.currentPlayerIdx];\n              const leg = p?.legs?.[p.legs.length - 1];\n              const preRem = leg ? leg.totalScoreRemaining : m.startingScore;\n              const postRem = Math.max(0, preRem - score);\n              const attempts = preRem <= 50 ? 3 : postRem <= 50 ? 1 : 0;\n              const finished = postRem === 0;\n              m.addVisit(score, 3, {\n                preOpenDarts: 0,\n                doubleWindowDarts: attempts,\n                finishedByDouble: finished,\n                visitTotal: score,\n              });\n              if (finished && score > 0) {\n                m.endLeg(score);\n              } else {\n                m.nextPlayer();\n              }\n            } catch {\n              useMatch.getState().addVisit(score, 3);\n              useMatch.getState().nextPlayer();\n            }\n            sendState();\n          }}\n          onQuit={() => {\n            try {\n              useMatch.getState().endGame();\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-quit\" });\n              }\n            } catch {}\n            // Clear any stale prestart / invite state so popups don't reappear\n            setPendingInvite(null);\n            setWaitingForCreator(null);\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setOpponentQuitName(null);\n            pendingMatchRef.current = null;\n            try {\n              (window as any).__ndn_pending_invite = null;\n            } catch {}\n            sendState();\n            try {\n              window.dispatchEvent(new Event(\"ndn:match-quit\"));\n            } catch {}\n          }}\n          onPause={() => {\n            try {\n              useMatchControl.getState().setPaused(true, null, username);\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-pause\" });\n              }\n            } catch {}\n          }}\n          onResume={() => {\n            try {\n              useMatchControl.getState().setPaused(false, null);\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-unpause\" });\n              }\n            } catch {}\n          }}\n          onStateChange={sendState}\n          localPlayerIndexOverride={localIdx >= 0 ? localIdx : undefined}\n          gameModeOverride={currentGame}\n          isOnline={true}\n          remoteFrame={opponentFrame}\n        />\n        {/* Opponent quit overlay */}\n        {opponentQuitName && (\n          <div className=\"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm\">\n            <div className=\"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl\">\n              <div className=\"text-4xl mb-3\">ğŸšª</div>\n              <h3 className=\"text-lg font-bold text-white mb-2\">\n                {opponentQuitName} left the match\n              </h3>\n              <p className=\"text-sm text-white/60 mb-5\">\n                Your opponent has quit. You can leave the match now.\n              </p>\n              <button\n                className=\"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all\"\n                onClick={() => {\n                  try {\n                    useMatch.getState().endGame();\n                  } catch {}\n                  setOpponentQuitName(null);\n                  setPendingInvite(null);\n                  setWaitingForCreator(null);\n                  setJoinMatch(null);\n                  setJoinChoice(null);\n                  pendingMatchRef.current = null;\n                  try {\n                    (window as any).__ndn_pending_invite = null;\n                  } catch {}\n                  try {\n                    window.dispatchEvent(new Event(\"ndn:match-quit\"));\n                  } catch {}\n                }}\n              >\n                Leave Match\n              </button>\n            </div>\n          </div>\n        )}\n      </>\n    );\n  }\n\n  return (\n    <div\n      className=\"flex-1 min-h-0 ndn-page\"\n      style={{ position: \"relative\", marginTop: 0 }}\n    >\n      <div className=\"card ndn-game-shell ndn-online-page relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col\">\n        {showStartShowcase && (\n          <MatchStartShowcase\n            players={(players || []) as any}\n            user={user}\n            onDone={() => setShowStartShowcase(false)}\n            onRequestClose={() => setShowStartShowcase(false)}\n          />\n        )}\n        <h2 className=\"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title\">\n          Online Lobby ğŸŒ\n        </h2>\n        <div className=\"ndn-shell-body flex-1 overflow-hidden p-3 pb-0\">\n          <div className=\"h-full flex flex-col gap-3\">\n            {/* Top row: Page, New Page, Create Match */}\n            <div className=\"ndn-page-header p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap\">\n              <div className=\"flex items-center gap-3 flex-wrap\">\n                <div className=\"text-sm text-white/70\">Page</div>\n                <div className=\"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium\">\n                  Page {currentPage_?.id}\n                </div>\n                <button\n                  className=\"ndn-new-page-btn btn btn-ghost btn-sm rounded-lg\"\n                  onClick={newPage}\n                >\n                  New Page\n                </button>\n              </div>\n              <div className=\"shrink-0 flex items-center gap-2\">\n                <button\n                  className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg\"\n                  onClick={() => setShowCreateModal(true)}\n                  disabled={\n                    (currentPage_?.matches?.length || 0) >= maxMatchesPerPage\n                  }\n                >\n                  <Trophy className=\"w-4 h-4\" />\n                  Create Match +\n                </button>\n                {(currentPage_?.matches?.length || 0) >= maxMatchesPerPage && (\n                  <div className=\"text-xs text-rose-400\">\n                    Page full â€” create a new page\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Filters & Controls */}\n            {!inProgress && (\n              <div className=\"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3\">\n                <div className=\"ndn-filterbar\">\n                  <div className=\"flex-1 min-w-[240px] relative\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40\" />\n                    <input\n                      type=\"text\"\n                      placeholder=\"Search matches, players...\"\n                      className=\"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={filterGame}\n                      onChange={(e) => setFilterGame(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Games</option>\n                      <option value=\"x01\">\n                        {getGameDisplay(\"X01\").emoji} X01\n                      </option>\n                      <option value=\"cricket\">\n                        {getGameDisplay(\"Cricket\").emoji} Cricket\n                      </option>\n                      <option value=\"bermuda\">\n                        {getGameDisplay(\"Bermuda\").emoji} Bermuda\n                      </option>\n                      <option value=\"gotcha\">\n                        {getGameDisplay(\"Gotcha\").emoji} Gotcha\n                      </option>\n                    </select>\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={filterMode}\n                      onChange={(e) => setFilterMode(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Modes</option>\n                      <option value=\"first_to\">First To</option>\n                      <option value=\"best_of\">Best Of</option>\n                    </select>\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={sortBy}\n                      onChange={(e) => setSortBy(e.target.value as any)}\n                    >\n                      <option value=\"newest\">Newest First</option>\n                      <option value=\"oldest\">Oldest First</option>\n                    </select>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className={`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${focusMode ? \"bg-red-600 text-white border-red-500\" : \"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900\"}`}\n                      onClick={() => setFocusMode((s) => !s)}\n                      aria-pressed={focusMode}\n                      title=\"Toggle focus mode: hide small details and show focused view\"\n                    >\n                      {focusMode ? \"Exit Focus\" : \"Focus Mode\"}\n                    </button>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg\"\n                      onClick={handleQuickJoin}\n                      disabled={combinedMatches.length === 0}\n                    >\n                      <Zap className=\"w-4 h-4 fill-current\" />\n                      Quick Join\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex-1 overflow-auto flex flex-col\">\n              <h3 className=\"font-semibold text-lg mb-3 flex items-center gap-2\">\n                <Users className=\"w-5 h-5 text-indigo-400\" />\n                Active Matches ï¿½ï¸\n              </h3>\n              <div className=\"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col\">\n                <div className=\"flex-1 overflow-auto\">\n                  {(combinedMatches.length || 0) === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-12 text-center opacity-60\">\n                      <div className=\"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4\">\n                        <Target className=\"w-8 h-8 text-white/20\" />\n                      </div>\n                      <p className=\"text-lg font-medium mb-1\">\n                        No matches found\n                      </p>\n                      <p className=\"text-sm max-w-xs mx-auto\">\n                        Create a new match to get started or try adjusting your\n                        filters.\n                      </p>\n                    </div>\n                  ) : null}\n\n                  {(combinedMatches.length || 0) !== 0 && (\n                    <div className=\"relative\">\n                      {focusMode && (\n                        <div className=\"absolute inset-0 z-10 flex items-center justify-center pointer-events-none\">\n                          <div className=\"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out\">\n                            <button\n                              onClick={() => setFocusMode(false)}\n                              className=\"w-full text-center\"\n                            >\n                              FOCUS MODE â€” Click to exit\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                      <div\n                        ref={matchesRef}\n                        className={`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 max-h-[28rem] overflow-auto p-1 ${focusMode ? \"opacity-90\" : \"\"}`}\n                        data-testid=\"matches-grid\"\n                      >\n                        {paginatedMatches.map((m: any) => (\n                          <div\n                            key={m.id}\n                            className=\"group relative p-2.5 rounded-lg border ndn-lobby-card hover:border-indigo-500/50 transition-all duration-150 shadow-sm hover:shadow-[0_4px_16px_-8px_rgba(99,102,241,0.4)] flex flex-col gap-1.5\"\n                            data-testid={`match-${m.id}`}\n                          >\n                            {/* Row 1: Game icon + name + time + mode/legs/score */}\n                            <div className=\"flex items-center gap-2\">\n                              {!focusMode && (\n                                <div\n                                  className=\"w-7 h-7 shrink-0 rounded-full flex items-center justify-center border group-hover:border-opacity-60 transition-colors text-xs\"\n                                  style={{\n                                    backgroundColor: `${getGameDisplay(m.game).color}15`,\n                                    borderColor: `${getGameDisplay(m.game).color}30`,\n                                  }}\n                                >\n                                  {getGameDisplay(m.game).emoji}\n                                </div>\n                              )}\n                              <div\n                                className=\"text-sm font-bold group-hover:text-indigo-300 transition-colors truncate\"\n                                style={{ color: getGameDisplay(m.game).color }}\n                              >\n                                {m.game}\n                              </div>\n                              <div className=\"text-[10px] text-white/40 flex items-center gap-0.5 shrink-0 ml-auto\">\n                                <Clock className=\"w-2.5 h-2.5\" />\n                                {new Date(m.createdAt).toLocaleTimeString([], {\n                                  hour: \"2-digit\",\n                                  minute: \"2-digit\",\n                                })}\n                              </div>\n                            </div>\n\n                            {/* Row 2: Mode badge + legs + score */}\n                            <div className=\"flex items-center gap-1.5 text-xs text-white/70\">\n                              <span className=\"px-1 py-px rounded-sm bg-white/5 text-[10px] font-medium border border-slate-800\">\n                                {m.modeType === \"bestof\" ? \"BO\" : \"FT\"}\n                              </span>\n                              <span className=\"font-mono text-indigo-300 text-xs\">\n                                {m.legs}\n                              </span>\n                              <span className=\"text-[10px]\">legs</span>\n                              {m.startingScore && (\n                                <>\n                                  <span className=\"w-0.5 h-0.5 rounded-full bg-white/20\" />\n                                  <span className=\"font-mono text-amber-300 text-xs\">\n                                    {m.startingScore}\n                                  </span>\n                                </>\n                              )}\n                            </div>\n\n                            {/* Row 3: Creator + Join button */}\n                            <div className=\"flex items-center justify-between pt-1 border-t border-white/5\">\n                              <div className=\"flex items-center gap-1.5 min-w-0\">\n                                {!focusMode && (\n                                  <>\n                                    <div className=\"w-5 h-5 shrink-0 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[8px] font-bold text-white\">\n                                      {(m.createdBy || m.creatorName || \"U\")\n                                        .substring(0, 2)\n                                        .toUpperCase()}\n                                    </div>\n                                    <span className=\"text-[10px] text-white/50 truncate max-w-[90px]\">\n                                      {m.createdBy || m.creatorName}\n                                    </span>\n                                  </>\n                                )}\n                              </div>\n                              <button\n                                className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-3 py-0.5 text-xs rounded-none\"\n                                onClick={() => requestJoin(m)}\n                              >\n                                Join\n                              </button>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Pagination Controls */}\n                  {totalPages > 1 && (\n                    <div className=\"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5\">\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === 1}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.max(1, p - 1))\n                        }\n                      >\n                        <ChevronDown className=\"w-4 h-4 rotate-90\" />\n                        Previous\n                      </button>\n                      <div className=\"flex items-center gap-1\">\n                        {Array.from(\n                          { length: Math.min(5, totalPages) },\n                          (_, i) => {\n                            // Logic to show window of pages around current\n                            let p = i + 1;\n                            if (totalPages > 5) {\n                              if (currentPage > 3) p = currentPage - 2 + i;\n                              if (p > totalPages) p = totalPages - 4 + i;\n                            }\n                            return (\n                              <button\n                                key={p}\n                                className={`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${\n                                  currentPage === p\n                                    ? \"bg-indigo-600 text-white shadow-sm\"\n                                    : \"bg-slate-950 text-white/70 hover:bg-slate-900\"\n                                }`}\n                                onClick={() => setCurrentPage(p)}\n                              >\n                                {p}\n                              </button>\n                            );\n                          },\n                        )}\n                      </div>\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === totalPages}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.min(totalPages, p + 1))\n                        }\n                      >\n                        Next\n                        <ChevronDown className=\"w-4 h-4 -rotate-90\" />\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n              {/* World Lobby removed: combined matches are displayed above */}\n            </div>\n          </div>\n        </div>\n\n        {/* â”€â”€ Page pagination at bottom of the card â”€â”€ */}\n        <div className=\"ndn-page-tabs flex items-center justify-center gap-2 py-3 mt-auto\">\n          {pages.map((p, idx) => (\n            <button\n              key={p.id}\n              className={`px-3 py-1.5 rounded-lg text-sm font-semibold transition-all ${\n                idx === currentPageIdx\n                  ? \"bg-white/20 text-white border border-white/30\"\n                  : \"text-white/60 hover:text-white hover:bg-white/10\"\n              }`}\n              onClick={() => setCurrentPageIdx(idx)}\n            >\n              {p.id}\n            </button>\n          ))}\n        </div>\n\n        {/* Create Match modal */}\n        <CreateMatchModal\n          open={showCreateModal}\n          onClose={() => setShowCreateModal(false)}\n          onCreate={(p) => {\n            handleCreateMatch(p);\n            setShowCreateModal(false);\n          }}\n        />\n      </div>\n\n      {/* â”€â”€ Incoming invite popup (creator sees this) â”€â”€ */}\n      {pendingInvite && (\n        <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200\">\n          <div className=\"relative w-full max-w-md mx-4 p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-indigo-500/30 shadow-2xl shadow-indigo-500/20\">\n            {/* Glow accent */}\n            <div className=\"absolute -top-12 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none\" />\n\n            <div className=\"relative z-10\">\n              <div className=\"flex items-center gap-3 mb-4\">\n                <div className=\"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 ring-2 ring-indigo-500/30\">\n                  <Zap className=\"w-6 h-6\" />\n                </div>\n                <div>\n                  <h3 className=\"text-xl font-black text-white\">\n                    Match Invite!\n                  </h3>\n                  <p className=\"text-sm text-white/60\">Someone wants to play</p>\n                </div>\n              </div>\n\n              <div className=\"p-4 rounded-xl bg-white/5 border border-white/10 mb-5\">\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold text-sm\">\n                    {(pendingInvite.fromName || \"?\")\n                      .substring(0, 2)\n                      .toUpperCase()}\n                  </div>\n                  <div>\n                    <div className=\"font-bold text-white text-lg\">\n                      {pendingInvite.fromName || \"Opponent\"}\n                    </div>\n                    <div className=\"text-xs text-white/50\">\n                      wants to join your match\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2 flex-wrap text-sm text-white/70\">\n                  <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-medium\">\n                    {pendingInvite.game || \"X01\"}\n                  </span>\n                  <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10\">\n                    {pendingInvite.mode === \"bestof\" ? \"Best Of\" : \"First To\"}{\" \"}\n                    {pendingInvite.value || 1}\n                  </span>\n                  <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-mono text-amber-300\">\n                    {pendingInvite.startingScore || 501}\n                  </span>\n                </div>\n              </div>\n\n              <div className=\"flex gap-3\">\n                <button\n                  className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all hover:scale-[1.02] active:scale-95\"\n                  onClick={() => {\n                    // Send invite-accept to start prestart for both\n                    try {\n                      if (wsGlobal?.connected && pendingInvite?.id) {\n                        wsGlobal.send({\n                          type: \"invite-accept\",\n                          matchId: pendingInvite.id,\n                        });\n                      }\n                    } catch {}\n                    setPendingInvite(null);\n                  }}\n                >\n                  âœ… Accept\n                </button>\n                <button\n                  className=\"flex-1 py-3 rounded-xl bg-white/5 hover:bg-rose-600/80 text-white/80 hover:text-white font-bold text-lg border border-white/10 hover:border-rose-500/50 transition-all hover:scale-[1.02] active:scale-95\"\n                  onClick={() => {\n                    // Send invite-decline\n                    try {\n                      if (wsGlobal?.connected && pendingInvite?.id) {\n                        wsGlobal.send({\n                          type: \"invite-decline\",\n                          matchId: pendingInvite.id,\n                        });\n                      }\n                    } catch {}\n                    setPendingInvite(null);\n                  }}\n                >\n                  âŒ Decline\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* â”€â”€ Waiting for creator (joiner sees this) â”€â”€ */}\n      {waitingForCreator && !joinMatch && (\n        <div className=\"fixed inset-0 z-[9998] flex items-center justify-center bg-black/70 backdrop-blur-sm\">\n          <div className=\"w-full max-w-sm mx-4 p-6 rounded-2xl bg-slate-900 border border-slate-700/50 text-center\">\n            <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-indigo-500/10 flex items-center justify-center\">\n              <Clock className=\"w-8 h-8 text-indigo-400 animate-pulse\" />\n            </div>\n            <h3 className=\"text-xl font-bold text-white mb-2\">\n              Waiting for {waitingForCreator}\n            </h3>\n            <p className=\"text-sm text-white/50 mb-5\">\n              The match creator needs to accept your requestâ€¦\n            </p>\n            <button\n              className=\"px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 transition-all text-sm font-medium\"\n              onClick={() => setWaitingForCreator(null)}\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Modern join / prestart overlay */}\n      <MatchPrestart\n        open={!!joinMatch}\n        matchInfo={joinMatch}\n        localUser={user}\n        opponentName={(() => {\n          if (!joinMatch) return \"Opponent\";\n          const localName = (user?.username || \"\").toLowerCase();\n          const creatorName =\n            joinMatch.createdBy || joinMatch.creatorName || \"\";\n          // If local user is the creator, opponent is the joiner\n          if (\n            joinMatch._isCreatorView ||\n            creatorName.toLowerCase() === localName\n          ) {\n            return (\n              joinMatch.joinerName ||\n              (joinMatch.joinerId\n                ? participants[joinMatch.joinerId] || joinMatch.joinerId\n                : \"Opponent\")\n            );\n          }\n          // Otherwise, local user is the joiner â€” opponent is the creator\n          return (\n            creatorName ||\n            (joinMatch.creatorId\n              ? participants[joinMatch.creatorId] || joinMatch.creatorId\n              : \"Opponent\")\n          );\n        })()}\n        countdown={15}\n        onChoice={sendPrestartChoice}\n        onBullThrow={(distanceMm: number) => {\n          try {\n            if (wsGlobal?.connected && joinMatch?.id) {\n              wsGlobal.send({\n                type: \"prestart-bull-throw\",\n                roomId: joinMatch.id,\n                score: distanceMm,\n              });\n            }\n          } catch {}\n          setBullLocalThrow(distanceMm);\n          setBullThrown(true);\n        }}\n        onAccept={handleJoinAccept}\n        onCancel={() => {\n          // If the creator cancels during prestart, notify the server\n          try {\n            if (\n              wsGlobal?.connected &&\n              joinMatch?.id &&\n              joinMatch._isCreatorView\n            ) {\n              wsGlobal.send({\n                type: \"invite-decline\",\n                matchId: joinMatch.id,\n              });\n            }\n          } catch {}\n          setJoinMatch(null);\n        }}\n        remoteChoice={Object.values(remoteChoices)[0] || null}\n        bullActive={bullActive}\n        bullWinner={bullWinner}\n        bullTied={bullTied}\n      />\n\n      {/* Match Summary Modal */}\n      <MatchSummaryModal\n        open={showMatchSummary}\n        onClose={() => setShowMatchSummary(false)}\n        title=\"Match Summary\"\n        players={summaryPlayers}\n      />\n    </div>\n  );\n}\n"],"names":["CreateMatchModal","open","onClose","onCreate","portalEl","useState","game","setGame","modeType","setModeType","legs","setLegs","legsRef","useRef","avgChoice","setAvgChoice","startingScore","setStartingScore","getStartOptionsForGame","extraValues","setExtraValues","getDefaultExtraValues","user","useUserSettings","onGameChange","g","opts","cfg","gameConfig","validMode","useLayoutEffect","onKey","e","extraFields","getExtraFieldsForGame","valueLabel","getValueLabelForGame","display","getGameDisplay","handleCreate","payload","createPortal","jsxs","jsx","allGames","d","opt","f","prev","o","m","base","getPlayerStats","name","avg3","getAllTimeAvg","best9","getAllTimeFirstNineAvg","bestCheckout","getAllTimeBestCheckout","bestLeg","getAllTimeBestLeg","all","getAllTime","career180s","getAllTime180s","StatPill","label","value","highlight","PlayerCard","stats","isLocal","showCamera","isWinner","legDiff","legDiffValue","Crown","Camera","CameraTile","MatchPrestart","matchInfo","localUser","opponentName","opponentStats","countdown","_onChoice","_onBullThrow","onAccept","onCancel","_remoteChoice","_bullActive","_bullWinner","_bullTied","seconds","setSeconds","phase","setPhase","rpsStep","setRpsStep","localRps","setLocalRps","opponentRps","setOpponentRps","rpsRound","setRpsRound","rpsDraw","setRpsDraw","portalElRef","RPS_ICONS","RPS_LABELS","RPS_OPTIONS","localStats","useMemo","oppStats","firstThrowerResolved","isLocalFirst","useEffect","el","t","step","cycleInterval","pick1","pick2","r","id","s","localName","headToHead","getHeadToHeadLegDiff","localLegDiff","opponentLegDiff","firstThrowerName","isLocalWinner","isOpponentWinner","overlay","X","Target","Timer","Zap","OnlinePlayClean","username","currentPageIdx","setCurrentPageIdx","pages","setPages","wsGlobal","useWS","serverMatches","setServerMatches","inProgress","useMatch","matchContext","players","focusMode","setFocusMode","matchesRef","showMatchSummary","setShowMatchSummary","summaryPlayers","setSummaryPlayers","prevInProgressRef","st","scroller","onDocClick","showStartShowcase","setShowStartShowcase","startedShowcasedRef","React","p","L","flagKey","openMatchWindow","onQuit","setPendingInvite","setWaitingForCreator","setJoinMatch","setJoinChoice","setOpponentQuitName","pendingMatchRef","showCreateModal","setShowCreateModal","joinMatch","joinAcceptRef","pendingInvite","waitingForCreator","_selfId","setSelfId","participants","setParticipants","joinTimer","setJoinTimer","serverMatchesRef","serverPrestartRef","joinChoice","remoteChoices","setRemoteChoices","bullActive","setBullActive","bullThrow","setBullThrow","bullWinner","setBullWinner","bullLocalThrow","setBullLocalThrow","bullThrown","setBullThrown","bullTied","setBullTied","opponentQuitName","currentGame","setCurrentGame","opponentFrameRef","opponentFrame","setOpponentFrame","searchQuery","setSearchQuery","filterGame","setFilterGame","filterMode","setFilterMode","sortBy","setSortBy","currentPage","setCurrentPage","itemsPerPage","currentPage_","maxMatchesPerPage","normalizeMatch","createdBy","createdAt","filterMatches","list","combinedMatches","activePageId","q","mt","target","a","b","tA","tB","totalPages","paginatedMatches","handleQuickJoin","requestJoin","handleCreateMatch","newMatch","idx","newPage","pageId","newPages","handleInviteOrPrestart","msg","inviteData","audio","creatorLower","endsAt","handleMatchStart","serverMatch","saved","roomId","startScore","creatorName","joinerName","firstId","isLocalCreator","localGoesFirst","creatorId","playerNames","mode","legsToWin","gameMode","filtered","pageMatches","playerId","choice","useMatchControl","pending","onInviteEvent","v","handleJoinAccept","isCreatorAccepting","sendPrestartChoice","sendState","alive","c","ctx","lastSendTs","FRAME_INTERVAL","loop","now","video","w","h","frame","localIdx","Fragment","InGameShell","score","_darts","_meta","leg","preRem","postRem","attempts","finished","MatchStartShowcase","Trophy","Search","Users","Clock","ChevronDown","_","i","distanceMm","MatchSummaryModal"],"mappings":"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"}
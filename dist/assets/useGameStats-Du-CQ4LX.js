import{t as ge,u as Q,j as t,n as be,v as ke,w as ye,x as Se,y as Le,z as Ee,A as Re,l as Ue,C as Be,D as Ae,E as Ie,F as $e,G as Oe,m as ve}from"./index-qEtc2rT9.js";import{r as p,m as ce,R as pe,n as Pe,o as He,Z as Fe}from"./ui-CuWypN7C.js";const Me={};function nt({label:e,autoStart:n,scale:r,className:a,aspect:s="inherit",style:i,fill:o=!1}){const d=p.useRef(null),x=ge(),[j,b]=p.useState(!1),[T,w]=p.useState(null),[g,v]=p.useState(null),[D,A]=p.useState(null),k=p.useRef(null),y=p.useCallback((l,m="local")=>{try{l?(x.setMediaStream(l),d.current&&x.setVideoElementRef(d.current),x.setMode(m),x.setStreaming(!0),k.current=m):k.current&&k.current!=="phone"&&(x.setStreaming(!1),x.setMediaStream(null),k.current=null)}catch(u){console.warn("[CameraTile] Failed to register stream with camera session:",u)}},[x]),N=Q(l=>l.preferredCameraLabel),[L,I]=p.useState(()=>{if(N==="Phone Camera")return console.log("[CAMERATILE] Initializing mode to phone (from preferred camera selection)"),"phone";const l=localStorage.getItem("ndn:camera:mode");return console.log("[CAMERATILE] Initializing mode to",l||"local","(from localStorage)"),l||"local"}),[E,H]=p.useState(null),[V,G]=p.useState(Date.now()),[se,S]=p.useState(!1),[$,O]=p.useState(null),[B,K]=p.useState(null),[ne,re]=p.useState(!0),[ie,M]=p.useState([]),[_,U]=p.useState(!1),[ee,q]=p.useState([]),[Y,Z]=p.useState(!1),z=Q(l=>l.autoscoreProvider),de=Q(l=>l.cameraEnabled),ue=Q(l=>l.setPreferredCameraLocked);if(z==="manual"){const m=[o?"rounded-2xl overflow-hidden bg-black w-full flex flex-col":"rounded-2xl overflow-hidden bg-black w-full mx-auto",a].filter(Boolean).join(" ").trim(),u={...i||{}};return!o&&u.aspectRatio===void 0&&u.height===void 0&&u.minHeight===void 0&&(u.aspectRatio="4 / 3"),t.jsx("div",{className:m,style:u,children:t.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center",children:"Manual scoring mode active — camera feeds are disabled."})})}p.useEffect(()=>{const l=window.location.hostname;(l==="localhost"||l==="127.0.0.1")&&be("/api/hosts").then(m=>m.json()).then(m=>{const u=Array.isArray(m?.hosts)&&m.hosts.find(c=>c);u&&O(u)}).catch(()=>{}),be("/api/https-info").then(m=>m.json()).then(m=>{m&&typeof m.https=="boolean"&&K({https:!!m.https,port:Number(m.port)||8788})}).catch(()=>{})},[]);const oe=p.useMemo(()=>{const l=g||"____",m="wss://ninedartnation-1.onrender.com";if(m.length>0)try{const W=new URL(m);return`${`${W.protocol==="wss:"?"https":"http"}://${W.host}${W.pathname.endsWith("/ws")?"":W.pathname}`.replace(/\/?ws$/i,"")}/mobile-cam.html?code=${l}`}catch{}const u=$||window.location.hostname,c=!!B?.https,R=c?B?.port||8788:8787;return`${c?"https":"http"}://${u}:${R}/mobile-cam.html?code=${l}`},[g,$,B]);p.useEffect(()=>{console.log("[CAMERATILE] Mode changed to:",L,"- persisting to localStorage"),localStorage.setItem("ndn:camera:mode",L)},[L]),p.useEffect(()=>{const l=Q.getState().ignorePreferredCameraSync;console.log("[CAMERATILE] Checking camera selection sync: preferredCameraLabel=",N,"mode=",L,"ignoreSync=",l),!l&&N==="Phone Camera"&&L!=="phone"&&(console.log("[CAMERATILE] Syncing mode to phone from Calibrator selection"),I("phone"))},[N,L]);const[me,J]=p.useState("");p.useEffect(()=>{if(!g){J("");return}const l=Me?.VITE_QR_LOGO_URL||"/dart-thrower.svg";ke(oe,{width:160,margin:1,errorCorrectionLevel:"H",color:{dark:"#000000",light:"#ffffff"},logo:{logoUrl:l,logoScale:.2,mask:!0,shape:"circle"}}).then(J).catch(()=>J(""))},[oe,g]),p.useEffect(()=>{if(!E)return;const l=setInterval(()=>G(Date.now()),1e3);return()=>clearInterval(l)},[E]);const le=p.useMemo(()=>E?Math.max(0,Math.ceil((E-V)/1e3)):null,[E,V]);p.useEffect(()=>{if(!(!de||z==="manual")&&n!==void 0){if(n){let l=!1;const m=N||"default",u=window.setTimeout(()=>{l||j||ae().catch(c=>console.warn(`[CameraTile] Auto-start failed for ${m}:`,c))},200);return()=>{l=!0,window.clearTimeout(u)}}te()}},[n,j,de,z,N,ae,te]),p.useEffect(()=>{const l=async()=>{try{if(N!=="Phone Camera"&&L!=="phone")return;const u=x.getMediaStream(),c=d.current;if(!c||!u)return;c.srcObject!==u&&(c.srcObject=u),c.muted=!0,c.playsInline=!0;try{await c.play()}catch{}b(!0)}catch{}};l();const m=setInterval(l,800);return()=>clearInterval(m)},[N,L,x,x.isStreaming]);async function ae(){if(L==="wifi")return f();if(N==="Phone Camera"||L==="phone"){const l=x.getMediaStream();if(l&&d.current)try{d.current.srcObject=l,await d.current.play(),b(!0);return}catch{}}try{const{preferredCameraId:l,setPreferredCamera:m}=Q.getState(),u=l?{video:{deviceId:{exact:l}},audio:!1}:{video:!0,audio:!1};let c;try{c=await navigator.mediaDevices.getUserMedia(u)}catch(R){const F=R&&(R.name||R.code)||"";if(l&&(F==="OverconstrainedError"||F==="NotFoundError"))c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});else throw R}d.current&&(d.current.srcObject=c,await d.current.play(),b(!0),y(c,"local"))}catch{}}function te(){d.current&&d.current.srcObject&&(d.current.srcObject.getTracks().forEach(m=>m.stop()),d.current.srcObject=null,b(!1),y(null))}async function f(){U(!0);try{const l=await ye();M(l),l.length===0&&alert("No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.")}catch(l){console.error("Wifi device discovery failed:",l),alert("Failed to discover wifi devices. Please check your network connection.")}finally{U(!1)}}async function C(l){try{M(u=>u.map(c=>c.id===l.id?{...c,status:"connecting"}:c));const m=await Se(l);if(m&&d.current)d.current.srcObject=m,await d.current.play(),b(!0),y(m,"wifi"),M(u=>u.map(c=>c.id===l.id?{...c,status:"online"}:c));else throw new Error("Failed to get video stream")}catch(m){console.error("Failed to connect to wifi device:",m),alert(`Failed to connect to ${l.name}. Please check the device and try again.`),M(u=>u.map(c=>c.id===l.id?{...c,status:"offline"}:c))}}async function P(){Z(!0);try{const l=await Le();q(l);const m=await Ee();m&&q(u=>[...u,m]),l.length===0&&!m&&alert("No USB scoring devices found. Please connect a device and try again.")}catch(l){console.error("USB device discovery failed:",l),alert("Failed to discover USB devices. Please check device connections.")}finally{Z(!1)}}async function Te(l){try{q(u=>u.map(c=>c.id===l.id?{...c,status:"connecting"}:c));const m=await Re(l);if(m&&d.current)d.current.srcObject=m,await d.current.play(),b(!0),I("wifi"),y(m,"wifi"),q(u=>u.map(c=>c.id===l.id?{...c,status:"online"}:c));else throw new Error("Failed to get video stream")}catch(m){console.error("Failed to connect to USB device:",m),alert(`Failed to connect to ${l.name}. Please check the device and try again.`),q(u=>u.map(c=>c.id===l.id?{...c,status:"offline"}:c))}}function Ne(){if(T&&T.readyState===WebSocket.OPEN)return T;const l="wss://ninedartnation-1.onrender.com",m=l.length>0?l.endsWith("/ws")?l:l.replace(/\/$/,"")+"/ws":void 0,u=window.location.protocol==="https:"?"wss":"ws",c=`${u}://${window.location.host}/ws`,R=window.location.hostname,F=R==="localhost"||R==="127.0.0.1",W=R.endsWith("onrender.com"),xe="wss://ninedartnation.onrender.com/ws";let X=m;X||(F?X=`${u}://${R}:8787/ws`:W?X=c:X=xe),X||(X=c);const fe=new WebSocket(X);return w(fe),fe}async function he(){I("phone"),S(!1);const l=Ne();l.readyState===WebSocket.OPEN?l.send(JSON.stringify({type:"cam-create"})):l.onopen=()=>l.send(JSON.stringify({type:"cam-create"})),l.onmessage=async m=>{const u=JSON.parse(m.data);if(u.type==="cam-code")v(u.code),u.expiresAt&&H(u.expiresAt);else if(u.type==="cam-peer-joined"){S(!0);const c=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});A(c),c.onicecandidate=F=>{F.candidate&&g&&l.send(JSON.stringify({type:"cam-ice",code:g,payload:F.candidate}))},c.ontrack=F=>{if(d.current){const W=F.streams?.[0];W&&(d.current.srcObject=W,d.current.play().catch(()=>{}),b(!0))}};const R=await c.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0});await c.setLocalDescription(R),g&&l.send(JSON.stringify({type:"cam-offer",code:g,payload:R}))}else if(u.type==="cam-answer")D&&await D.setRemoteDescription(new RTCSessionDescription(u.payload));else if(u.type==="cam-ice"&&D)try{await D.addIceCandidate(u.payload)}catch{}}}function De(){v(null),H(null),S(!1),T&&T.readyState===WebSocket.OPEN?T.send(JSON.stringify({type:"cam-create"})):he();try{ue(!0)}catch{}}function Ce(){if(te(),v(null),S(!1),H(null),D){try{D.close()}catch{}A(null)}}return t.jsx(_e,{label:e,autoStart:n,start:ae,stopAll:Ce,startPhonePairing:he,startWifiConnection:f,startUsbConnection:P,connectToWifiDevice:C,connectToUsbDevice:Te,videoRef:d,streaming:j,mode:L,setMode:I,pairCode:g,mobileUrl:oe,ttl:le,qrDataUrl:me,regenerateCode:De,httpsInfo:B,showTips:ne,setShowTips:re,wifiDevices:ie,usbDevices:ee,discoveringWifi:_,discoveringUsb:Y,scaleOverride:r,className:a,aspect:s,style:i,fill:o})}function _e(e){const n=ge(),{cameraScale:r,cameraAspect:a}=Q(),{label:s,start:i,stopAll:o,startPhonePairing:d,startWifiConnection:x,startUsbConnection:j,connectToWifiDevice:b,connectToUsbDevice:T,videoRef:w,streaming:g,mode:v,setMode:D,pairCode:A,mobileUrl:k,ttl:y,qrDataUrl:N,regenerateCode:L,httpsInfo:I,showTips:E,setShowTips:H,wifiDevices:V,usbDevices:G,discoveringWifi:se,discoveringUsb:S,className:$,aspect:O,style:B,fill:K}=e,ne={local:"Local",phone:"PhoneCam",wifi:"Wi-Fi/USB"},re=p.useMemo(()=>[{id:"local",title:"Local camera",description:"Use the desktop webcam or capture card.",action:()=>{D("local"),i()}},{id:"phone",title:"PhoneCam",description:"Stream from your phone via the mobile link.",action:()=>{d()}},{id:"wifi",title:"Wi-Fi",description:"Discover network scoring cameras and connect.",action:()=>{ne[v],re.map(f=>{const C=f.id==="usb"?le:f.id===v;return t.jsxs("button",{type:"button",onClick:f.action,className:`text-left p-3 rounded-2xl border ${C?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:f.title}),t.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:f.description}),C&&t.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},f.id)}),D("wifi"),x()}},{id:"usb",title:"USB",description:"Connect a USB capture device directly.",action:()=>{D("wifi"),j()}}],[D,i,d,x,j]),[ie,M]=p.useState(null),_=p.useRef(null);p.useEffect(()=>()=>{_.current&&window.clearTimeout(_.current)},[]);const{cameraFitMode:U}=Q(),ee=K?"fill":U||"fill",q=(()=>{const f=Number(e.scaleOverride??r??1),C=Math.max(.5,Math.min(1.25,f));return ee==="fill"?Math.max(1,C):C})(),Y=K&&ee==="fill"?"free":O&&O!=="inherit"?O:a||"wide",Z=Y!=="free",z=Z?Y==="square"?"aspect-square":Y==="portrait"?"aspect-[3/4]":Y==="classic"?"aspect-[4/3]":"aspect-video":"",ue=[K?"rounded-3xl overflow-hidden bg-transparent w-full flex flex-col shadow-2xl border border-slate-700/30":"rounded-3xl overflow-hidden bg-transparent w-full mx-auto flex flex-col shadow-2xl border border-slate-700/30",$].filter(Boolean).join(" ").trim(),oe={...B||{}},me=K?"relative flex-1 min-h-[420px] bg-black":"relative w-full bg-black",J={style:{transform:`scale(${q})`,transformOrigin:"center"}},le=v==="wifi"&&G.some(f=>f.status==="online"),ae=(()=>{const C=ee==="fit"?"absolute inset-0 w-full h-full object-contain object-center bg-transparent":"absolute inset-0 w-full h-full object-cover object-center bg-transparent";return K?Z?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:`relative w-full max-w-full max-h-full ${z}`,children:t.jsx("video",{ref:w,className:C,...J})})}):t.jsx("video",{ref:w,className:C,...J}):Z?t.jsx("div",{className:`relative w-full ${z}`,children:t.jsx("video",{ref:w,className:C,...J})}):t.jsx("video",{ref:w,className:C,...J})})();async function te(f,C){if(f)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(f);else{const P=document.createElement("textarea");P.value=f,P.style.position="fixed",P.style.opacity="0",document.body.appendChild(P),P.focus(),P.select(),document.execCommand("copy"),document.body.removeChild(P)}M(C),_.current&&window.clearTimeout(_.current),_.current=window.setTimeout(()=>M(null),1500)}catch(P){console.warn("Copy to clipboard failed:",P),M(null)}}return t.jsxs("div",{className:ue,style:oe,children:[t.jsxs("div",{className:me,children:[ae,n.isStreaming&&v==="phone"&&t.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/70 backdrop-blur border border-rose-500/60 text-xs text-rose-200 font-semibold shadow-lg",children:[t.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full bg-rose-500 animate-pulse"}),t.jsx("span",{children:"REC"})]})]}),t.jsxs("div",{className:"px-3 py-2 flex items-center justify-between bg-gradient-to-r from-slate-900 to-slate-800 text-white text-[11px] gap-2 border-t border-slate-700/50",children:[t.jsx("span",{className:"truncate font-medium",children:s||(g?v==="phone"?"PHONE LIVE":v==="wifi"?"WIFI LIVE":"LIVE":"Camera")}),t.jsxs("div",{className:"flex items-center gap-2",children:[!g&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="local"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>{D("local"),i()},children:"Local"}),t.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="phone"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:d,children:"Phone"}),t.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>{D("wifi"),x()},children:"WiFi"}),t.jsx("button",{className:`px-2 py-1 rounded-md text-xs font-semibold transition-all ${v==="wifi"?"bg-emerald-500 text-white":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,onClick:()=>{D("wifi"),j()},children:"USB"})]}),g?t.jsx("button",{className:"px-2 py-1 rounded-md text-xs font-semibold bg-rose-500 text-white hover:bg-rose-600 transition-all",onClick:o,children:"Stop"}):null]})]}),v==="phone"&&A&&!g&&t.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[t.jsx("div",{className:"text-xs opacity-80",children:"Launch on your mobile:"}),t.jsxs("button",{type:"button",className:"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2",onClick:()=>te(k,"link"),title:"Copy mobile camera link",children:[t.jsx("span",{className:"flex-1 min-w-0 font-mono break-all",children:k}),t.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:ie==="link"?"Copied!":"Copy"})]}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.jsx("a",{href:k,target:"_blank",rel:"noreferrer",className:"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition",children:"Open link"}),t.jsxs("button",{type:"button",className:"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2",onClick:()=>te(A,"code"),title:"Copy pairing code",children:[t.jsx("span",{className:"font-mono tracking-[0.3em] text-sm",children:A}),t.jsx("span",{className:"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200",children:ie==="code"?"Copied!":"Copy"})]})]}),N&&t.jsx("img",{className:"mt-1 w-[160px] h-[160px] bg-white rounded",alt:"Scan to open",src:N}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[y!==null&&t.jsxs("span",{children:["Expires in ",y,"s"]}),t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700",onClick:L,children:"Regenerate"})]}),E&&t.jsxs("div",{className:"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200",children:[t.jsx("div",{className:"font-semibold mb-1",children:"Troubleshooting"}),t.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[t.jsx("li",{children:"Phone and desktop must be on the same Wi‑Fi network."}),t.jsxs("li",{children:["Allow the server through your firewall (ports 8787 and ",I?.https?I.port:8788,")."]}),t.jsx("li",{children:"On iPhone, use HTTPS links (QR will prefer https when enabled)."})]}),t.jsx("div",{className:"mt-2 text-right",children:t.jsx("button",{className:"btn btn--ghost px-2 py-1 text-xs",onClick:()=>H(!1),children:"Hide tips"})})]})]}),v==="wifi"&&!g&&t.jsxs("div",{className:"p-2 text-white text-[10px] bg-black/50",children:[t.jsx("div",{className:"font-semibold mb-2",children:"Scoring Devices"}),t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"font-medium mb-1",children:"WiFi Devices"}),se?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),t.jsx("span",{children:"Scanning network..."})]}):V.length>0?t.jsxs("div",{className:"space-y-1",children:[V.map(f=>t.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium truncate",children:f.name}),t.jsxs("div",{className:"opacity-70 text-[9px]",children:[f.ip,":",f.port]})]}),t.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${f.status==="connecting"?"bg-yellow-600":f.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>b(f),disabled:f.status==="connecting",children:f.status==="connecting"?"...":"Connect"})]},f.id)),t.jsx("div",{className:"text-center mt-2",children:t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:x,children:"Rescan WiFi"})})]}):t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mb-1 opacity-70",children:"No WiFi devices found"}),t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:x,children:"Scan WiFi"})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium mb-1",children:"USB Devices"}),S?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),t.jsx("span",{children:"Scanning USB..."})]}):G.length>0?t.jsxs("div",{className:"space-y-1",children:[G.map(f=>t.jsxs("div",{className:"flex items-center justify-between p-1 rounded bg-slate-900/60",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium truncate",children:f.name}),t.jsx("div",{className:"opacity-70 text-[9px]",children:f.type.toUpperCase()})]}),t.jsx("button",{className:`px-1 py-0.5 rounded text-[9px] ${f.status==="connecting"?"bg-yellow-600":f.status==="online"?"bg-green-600":"bg-blue-600"}`,onClick:()=>T(f),disabled:f.status==="connecting",children:f.status==="connecting"?"...":"Connect"})]},f.id)),t.jsx("div",{className:"text-center mt-2",children:t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:j,children:"Rescan USB"})})]}):t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mb-1 opacity-70",children:"No USB devices found"}),t.jsx("button",{className:"px-1 py-0.5 rounded bg-slate-700 text-[9px]",onClick:j,children:"Scan USB"})]})]})]}),!g&&t.jsxs("div",{className:"mt-3 p-3 rounded-2xl bg-white border border-slate-200 shadow-sm text-slate-900",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Camera modes"}),t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Reconnect camera"})]}),t.jsxs("span",{className:"text-xs text-slate-500",children:["Current: ",ne[v]||"Local"]})]}),t.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Tap a mode to restart the feed or switch inputs."}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:re.map(f=>{const C=f.id==="usb"?le:f.id===v;return t.jsxs("button",{type:"button",onClick:f.action,className:`text-left p-3 rounded-2xl border ${C?"border-emerald-500 bg-emerald-50 shadow":"border-slate-200 bg-white/80 hover:bg-slate-50"} transition`,children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:f.title}),t.jsx("div",{className:"text-[11px] text-slate-600 mt-1",children:f.description}),C&&t.jsx("div",{className:"text-[10px] text-emerald-500 mt-2",children:"Active"})]},f.id)})})]})]})}const We=["D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","DB"];function Ve(e){return e==="DB"?50:Number(e.slice(1))*2}function Ge(e){return We.includes(e)?Ve(e):32}function rt(e,n="D16"){if(e>170||e<=1)return[];const r={170:["T20 T20 DB"],167:["T20 T19 DB"],164:["T20 T18 DB"],161:["T20 T17 DB"],160:["T20 T20 D20"],158:["T20 T20 D19"],157:["T20 T19 D20"],156:["T20 T20 D18"],155:["T20 T19 D19"],154:["T20 T18 D20"],153:["T20 T19 D18"],152:["T20 T20 D16"],151:["T20 T17 D20"],150:["T20 T18 D18"],149:["T20 T19 D16"],148:["T20 T16 D20"],147:["T20 T17 D18"],146:["T20 T18 D16"],145:["T20 T15 D20"],144:["T20 T20 D12"],141:["T20 T19 D12"],140:["T20 T20 D10"],137:["T20 T19 D10"],136:["T20 T20 D8"],132:["BULL T14 D20","T20 T12 D8"],130:["T20 T20 D5","T20 T18 D8"],129:["T19 T16 D12"],128:["T18 T14 D16"],127:["T20 T17 D8"],126:["T19 T19 D6"],121:["T20 11 D20","T20 T15 D8"],120:["T20 20 D20","T20 S20 D20"],110:["T20 10 D20"],100:["T20 D20"],99:["T19 10 D16","T19 S10 D16"],97:["T19 D20"],96:["T20 D18"],95:["T19 D19"],94:["T18 D20"],92:["T20 D16"],90:["T18 D18","T20 D15"],86:["T18 D16"],84:["T20 D12","T16 D18"],82:["BULL D16","T14 D20"],81:["T19 D12"],80:["T20 D10","D20 D20"],78:["T18 D12"],76:["T20 D8","T16 D14"],74:["T14 D16","T18 D10"],72:["T16 D12","T20 D6"],70:["T18 D8","S20 BULL"],68:["T20 D4","T16 D10"],66:["T10 D18","T14 D12"],64:["T16 D8","D16 D16"],62:["T10 D16","T12 D13"],60:["20 D20","S20 D20"],58:["18 D20","S18 D20"],56:["16 D20","S16 D20"],54:["14 D20","S14 D20"],52:["20 D16","S20 D16"],50:["BULL","10 D20"],48:["16 D16","S16 D16"],46:["14 D16"],44:["12 D16"],42:["10 D16"],40:["D20"],38:["D19"],36:["D18"],34:["D17"],32:["D16"],30:["D15"],28:["D14"],26:["D13"],24:["D12"],22:["D11"],20:["D10"],18:["D9"],16:["D8"],14:["D7"],12:["D6"],10:["D5"],8:["D4"],6:["D3"],4:["D2"],2:["D1"]};if(r[e])return r[e];const a=Ge(n),s=[];for(const i of[60,57,54,51,48])if(e-i===a){s.push(`T${i/3} ${n}`);break}if(!s.length){for(const i of[20,19,18,17,16,15])if(e-i===a){s.push(`${i} ${n}`);break}}return s}function it(e,n,r,a,s){try{const i=window.speechSynthesis;if(!i)return;const o=new SpeechSynthesisUtterance,d=r<=170&&r>0,x=n===180;if(!(!s?.checkoutOnly||d||x))return;if(x?(o.text=`${e}! One eighty!`,o.rate=1.04,o.pitch=1.15):d?(o.text=`${e}, ${r} remaining.`,o.rate=1,o.pitch=1):n===0?(o.text=`${e}, no score.`,o.rate=1,o.pitch=1):(o.text=`${e}, ${n}.`,o.rate=1,o.pitch=1),a){const b=i.getVoices().find(T=>T.name===a);b&&(o.voice=b)}typeof s?.volume=="number"?o.volume=Math.max(0,Math.min(1,s.volume)):o.volume=1;try{i.cancel()}catch{}i.speak(o)}catch{}}function ot({gameMode:e,compact:n=!1,onRecalibrate:r}){const{H:a,errorPx:s}=Ue(),i=Be(e,s),o=Ae(e,s),{quality:d,text:x}=Ie(e,s),j=$e(e),b=Oe[e];if(!a||!s)return n?t.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30",children:[t.jsx(ce,{className:"w-3 h-3"}),"Not calibrated"]}):t.jsxs("div",{className:"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2",children:[t.jsx(ce,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-red-300",children:"Calibration Required"}),t.jsxs("div",{className:"text-xs opacity-80",children:["Please calibrate before playing ",e]})]}),r&&t.jsx("button",{className:"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700",onClick:r,children:"Calibrate"})]});const T=o?"bg-emerald-500/20 border-emerald-600/30":"bg-amber-500/20 border-amber-600/30",w=o?"text-emerald-300":"text-amber-300",g=o?Pe:ce;return n?t.jsxs("div",{className:`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${T} ${w}`,children:[pe.createElement(g,{className:"w-3 h-3"}),t.jsx("span",{children:x}),!o&&j&&t.jsx("span",{className:"w-3 h-3 cursor-help",title:j,children:t.jsx(He,{className:"w-3 h-3 inline"})})]}):t.jsxs("div",{className:`px-3 py-2 rounded border ${T} space-y-1`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[pe.createElement(g,{className:`w-4 h-4 ${o?"text-emerald-400":"text-amber-400"} flex-shrink-0`}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:`font-medium ${o?"text-emerald-300":"text-amber-300"}`,children:["Calibration for ",e]}),t.jsxs("div",{className:"text-xs opacity-80",children:["Error: ",Math.round(s),"px | ",x]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-1 h-1.5 rounded bg-black/30 overflow-hidden",children:t.jsx("div",{className:`h-full transition-all ${o?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Math.min(100,i)}%`}})}),t.jsxs("span",{className:"text-xs font-mono",children:[Math.round(i),"%"]})]}),b&&t.jsx("div",{className:"text-xs opacity-75",children:t.jsxs("div",{children:["Tolerance: ±",b.tolerancePx,"px | Min: ",b.minConfidence,"%"]})}),t.jsxs("div",{className:"space-y-1",children:[!o&&t.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1",children:[t.jsx(ce,{className:"w-3 h-3 flex-shrink-0"}),"Calibration quality is below minimum for ",e]}),j&&t.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1",children:[t.jsx(Fe,{className:"w-3 h-3 flex-shrink-0"}),j]})]}),!o&&r&&t.jsxs("button",{className:"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700",onClick:r,children:["Recalibrate for ",e]})]})}function at({left:e,right:n,className:r="",sticky:a=!0}){return t.jsxs("div",{className:`${a?"sticky top-0":""} relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${r}`,children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent"}),t.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap",children:e}),t.jsx("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:n})]})}const Ke=[...Array.from({length:20},(e,n)=>({label:`D${n+1}`,score:(n+1)*2})),{label:"DBULL",score:50,isBull:!0}];function lt(e,n){const r=Ke[n];return!!r&&e===r.score}function ct(e){const n=e.trim().toUpperCase();if(!n)return null;if(n==="50"||n==="BULL"||n==="DBULL"||n==="IBULL")return 50;if(n==="25"||n==="OBULL")return 25;const r=n.match(/^(S|D|T)?\s*(\d{1,2})$/);if(!r)return null;const a=r[1]||"S",s=parseInt(r[2],10);return s<1||s>20?null:s*(a==="S"?1:a==="D"?2:3)}const dt=[...Array.from({length:20},(e,n)=>n+1),25,50],je=[20,19,18,17,16,15,25];function ut(){const e={};return je.forEach(n=>{e[n]=0}),{marks:e,points:0}}function mt(e,n,r,a,s=()=>!1){let i=null,o=0;if(r==="BULL"||r==="INNER_BULL"||n===25||n===50)i=25,o=r==="INNER_BULL"||n===50?2:1;else if(typeof a=="number"&&a>=15&&a<=20)i=a,r==="TRIPLE"?o=3:r==="DOUBLE"?o=2:o=1;else if(n){const g=[20,19,18,17,16,15];for(const v of g){if(n===v){i=v,o=1;break}if(n===v*2){i=v,o=2;break}if(n===v*3){i=v,o=3;break}}!i&&(n===25||n===50)&&(i=25,o=n===50?2:1)}if(!i)return 0;const d=e.marks[i];let x=Math.max(0,3-d);const j=Math.min(x,o),b=Math.max(0,o-j),T=d+j;e.marks[i]=T>3?3:T;let w=0;return b>0&&!s(i)&&(i===25?r==="INNER_BULL"?w+=50*b:w+=25*b:w+=i*b),e.points+=w,w}function ft(e){return je.every(n=>(e.marks[n]||0)>=3)}function ht(){return{round:1,score:0,finished:!1,shanghaiAchieved:!1,turnHits:{singles:0,doubles:0,triples:0}}}function qe(e){return e.round}function xt(e,n,r,a){if(e.finished)return 0;const s=qe(e);let i=0;return typeof a=="number"&&a===s?r==="TRIPLE"?(i=s*3,e.turnHits.triples++):r==="DOUBLE"?(i=s*2,e.turnHits.doubles++):r==="SINGLE"&&(i=s*1,e.turnHits.singles++):!a&&(n===s||n===s*2||n===s*3)&&(n===s*3?(i=s*3,e.turnHits.triples++):n===s*2?(i=s*2,e.turnHits.doubles++):n===s&&(i=s,e.turnHits.singles++)),e.score+=i,i}function bt(e){if(!e.finished){if(e.turnHits.singles>0&&e.turnHits.doubles>0&&e.turnHits.triples>0){e.shanghaiAchieved=!0,e.finished=!0;return}const n=e.round+1;n>20?e.finished=!0:e.round=n}e.turnHits={singles:0,doubles:0,triples:0}}function pt(){return{stage:0,targets:[{kind:"NUMBER",num:20},{kind:"DOUBLE",num:16},{kind:"TRIPLE",num:14},{kind:"NUMBER",num:19},{kind:"BULL"},{kind:"ANY_NUMBER"}],score:0,finished:!1,hitThisRound:!1}}function ze(e){return e.targets[e.stage]||null}function gt(e,n,r,a){if(e.finished)return 0;const s=ze(e);if(!s)return 0;let i=0;switch(s.kind){case"NUMBER":{typeof a=="number"&&a===s.num?r==="TRIPLE"?i=s.num*3:r==="DOUBLE"?i=s.num*2:r==="SINGLE"&&(i=s.num):!a&&(n===s.num||n===s.num*2||n===s.num*3)&&(i=n),i>0&&(e.hitThisRound=!0);break}case"DOUBLE":{(r==="DOUBLE"&&a===s.num||n===s.num*2)&&(i=s.num*2,e.hitThisRound=!0);break}case"TRIPLE":{(r==="TRIPLE"&&a===s.num||n===s.num*3)&&(i=s.num*3,e.hitThisRound=!0);break}case"BULL":{(r==="BULL"||r==="INNER_BULL"||n===25||n===50)&&(i=r==="INNER_BULL"||n===50?50:25,e.hitThisRound=!0);break}case"ANY_NUMBER":{n>0&&(i=n,e.hitThisRound=!0);break}}return e.score+=i,i}function vt(e){e.finished||(e.hitThisRound||(e.score=Math.floor(e.score/2)),e.hitThisRound=!1,e.stage+=1,e.stage>=e.targets.length&&(e.finished=!0))}function jt(){return{round:1,score:0,target:"HIGH",finished:!1}}function wt(e,n,r,a){if(e.finished)return 0;let s=0;if(e.target==="HIGH")if(r==="INNER_BULL")s=50;else if(typeof a=="number"){const o=a*(r==="TRIPLE"?3:r==="DOUBLE"?2:1);a>=20&&(s=o)}else n>=40&&(s=n);else if(typeof a=="number"){const o=a*(r==="TRIPLE"?3:r==="DOUBLE"?2:1);a<=10&&(s=o)}else n>0&&n<=30&&(s=n);return e.score+=s,s}function Tt(e){if(!e.finished){if(e.round+=1,e.round>10){e.finished=!0;return}e.target=e.target==="HIGH"?"LOW":"HIGH"}}function Nt(e,n=3){return{number:e,lives:n,isKiller:!1,eliminated:!1}}function Dt(e){const n=Array.from({length:20},(a,s)=>s+1),r={};for(const a of e){const s=Math.floor(Math.random()*n.length),i=n.splice(s,1)[0];r[a]=i}return r}function Ct(e,n,r,a){const s=n[e];if(!s||!a||!r)return{becameKiller:!1};if(!s.isKiller&&r==="DOUBLE"&&a===s.number)return s.isKiller=!0,{becameKiller:!0};if(s.isKiller&&(r==="DOUBLE"||r==="TRIPLE")){const i=Object.keys(n).find(o=>o!==e&&!n[o].eliminated&&n[o].number===a);if(i){const o=n[i],d=r==="TRIPLE"?2:1;return o.lives=Math.max(0,o.lives-d),o.lives===0&&(o.eliminated=!0),{becameKiller:!1,victimId:i,livesRemoved:d}}}return{becameKiller:!1}}function kt(e){const n=Object.entries(e).filter(([,r])=>!r.eliminated&&r.lives>0);return n.length===1?n[0][0]:null}const we=[20,19,18,17,16,15,14,13,12,25];function yt(){const e={};return we.forEach(n=>{e[n]=0}),{marks:e,points:0}}function St(e,n,r,a,s=()=>!1){let i=null,o=0;if(r==="BULL"||r==="INNER_BULL"||n===25||n===50)i=25,o=r==="INNER_BULL"||n===50?2:1;else if(typeof a=="number"&&a>=12&&a<=20)i=a,r==="TRIPLE"?o=3:r==="DOUBLE"?o=2:o=1;else if(n){for(const g of[20,19,18,17,16,15,14,13,12]){if(n===g){i=g,o=1;break}if(n===g*2){i=g,o=2;break}if(n===g*3){i=g,o=3;break}}!i&&(n===25||n===50)&&(i=25,o=n===50?2:1)}if(!i)return 0;const d=e.marks[i],x=Math.max(0,3-d),j=Math.min(x,o),b=Math.max(0,o-j),T=d+j;e.marks[i]=T>3?3:T;let w=0;return b>0&&!s(i)&&(i===25?r==="INNER_BULL"?w+=50*b:w+=25*b:w+=i*b),e.points+=w,w}function Lt(e){return we.every(n=>(e.marks[n]||0)>=3)}function Et(){return{inning:1,score:0,dartsThisInning:0,finished:!1}}function Rt(e,n,r,a){if(e.finished)return 0;let s=0;if(typeof a=="number"&&a===e.inning?r==="TRIPLE"?s=3:r==="DOUBLE"?s=2:s=1:!a&&(n===e.inning||n===e.inning*2||n===e.inning*3)&&(s=n===e.inning*3?3:n===e.inning*2?2:1),e.score+=s,e.dartsThisInning+=1,e.dartsThisInning>=3){const i=e.inning+1;i>9?e.finished=!0:(e.inning=i,e.dartsThisInning=0)}return s}const Je={1:5,2:20,3:1,4:18,5:4,6:13,7:6,8:10,9:15,10:2,11:17,12:3,13:19,14:7,15:16,16:8,17:11,18:14};function Ut(){return{hole:1,strokes:0,dartsThisHole:0,finished:!1}}function Bt(e,n,r,a){if(e.finished)return!1;const s=Je[e.hole];if(e.dartsThisHole+=1,typeof a=="number"&&a===s&&(r==="SINGLE"||r==="DOUBLE"||r==="TRIPLE")||!a&&(n===s||n===s*2||n===s*3)){e.strokes+=e.dartsThisHole;const o=e.hole+1;return o>18?e.finished=!0:(e.hole=o,e.dartsThisHole=0),!0}if(e.dartsThisHole>=3){e.strokes+=3;const o=e.hole+1;o>18?e.finished=!0:(e.hole=o,e.dartsThisHole=0)}return!1}const Xe={0:{type:"NUM",num:20},1:{type:"NUM",num:19},2:{type:"NUM",num:18},3:{type:"NUM",num:17},4:{type:"BULL"},5:{type:"NUM",num:16},6:{type:"NUM",num:15},7:{type:"NUM",num:14},8:{type:"NUM",num:13}};function At(){return{board:Array(9).fill(null),turn:"X",finished:!1,winner:null}}function Qe(e){const n=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[r,a,s]of n)if(e[r]&&e[r]===e[a]&&e[r]===e[s])return e[r];return e.every(r=>r)?"Draw":null}function It(e,n,r,a,s){if(e.finished||e.board[n])return!1;const i=Xe[n];let o=!1;if(i.type==="BULL"?o=a==="BULL"||a==="INNER_BULL"||r===25||r===50:i.type==="NUM"&&typeof i.num=="number"&&(typeof s=="number"&&s===i.num||!s&&(r===i.num||r===i.num*2||r===i.num*3))&&(o=!0),!o)return!1;e.board[n]=e.turn;const d=Qe(e.board);return d?(e.finished=!0,e.winner=d,!0):(e.turn=e.turn==="X"?"O":"X",!0)}function $t({gameMode:e,players:n,matchScore:r,gameRules:a}){return!n||n.length===0?null:t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:n.map((s,i)=>t.jsxs("div",{className:`rounded-lg border p-3 ${s.isCurrentTurn?"border-emerald-500/40 bg-emerald-500/10":"border-slate-500/40 bg-slate-500/10"}`,children:[t.jsx("div",{className:`text-sm font-semibold mb-2 uppercase tracking-wide ${s.isCurrentTurn?"text-emerald-300":"text-slate-300"}`,children:s.name}),t.jsxs("div",{className:"space-y-1 text-sm",children:[e==="X01"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Legs Won",value:`● ${s.legsWon||0}`,highlight:!0}),t.jsx(h,{label:"Score",value:s.score||0,mono:!0,bold:!0}),t.jsx(h,{label:"Last Score",value:s.lastScore||"0",mono:!0}),t.jsx(h,{label:"C/Out Rate",value:`${s.checkoutRate||0}%`,mono:!0}),t.jsx(h,{label:"Best Leg",value:s.bestLeg||"—",mono:!0}),s.matchAvg!==void 0&&s.allTimeAvg!==void 0&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"border-t border-white/20 pt-1 mt-1",children:[t.jsx(h,{label:"Match Avg",value:s.matchAvg.toFixed(2),mono:!0,bold:!0,highlight:s.matchAvg>0}),t.jsx(Ye,{matchAvg:s.matchAvg,allTimeAvg:s.allTimeAvg})]})})]}),(e==="Cricket"||e==="American Cricket")&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Closed",value:Ze(s.closed),mono:!0}),t.jsx(h,{label:"Points",value:s.points||0,mono:!0,bold:!0}),t.jsx(h,{label:"Status",value:et(s),highlight:s.isCurrentTurn})]}),(e==="Shanghai"||e==="Halve It")&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:e==="Shanghai"?"Round":"Stage",value:s.round||1,mono:!0}),t.jsx(h,{label:"Target",value:s.target||"—",mono:!0}),t.jsx(h,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Killer"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Target #",value:s.number||"—",mono:!0,bold:!0}),t.jsx(h,{label:"Lives",value:s.lives||0,mono:!0,bold:!0}),s.eliminated&&t.jsx(h,{label:"Status",value:"ELIMINATED",highlight:!1})]}),e==="High-Low"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Round",value:s.round||1,mono:!0}),t.jsx(h,{label:"Target",value:s.target||"High",mono:!0}),t.jsx(h,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),(e==="Double Practice"||e==="Treble Practice"||e==="Around the Clock")&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Target",value:s.target||"—",mono:!0,bold:!0}),t.jsx(h,{label:"Hits",value:s.hits||0,mono:!0,bold:!0}),s.totalNeeded&&t.jsx(h,{label:"Progress",value:`${s.hits||0} / ${s.totalNeeded}`,mono:!0})]}),(e==="Count-Up"||e==="High Score"||e==="Low Score")&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Round",value:s.round||1,mono:!0}),t.jsx(h,{label:"Score",value:s.score||0,mono:!0,bold:!0}),e==="High Score"&&t.jsx(h,{label:"Best",value:s.bestScore||0,mono:!0})]}),(e==="Checkout 170"||e==="Checkout 121")&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Remaining",value:s.remaining||0,mono:!0,bold:!0}),t.jsx(h,{label:"Attempts",value:s.attempts||0,mono:!0}),t.jsx(h,{label:"Successes",value:s.successes||0,mono:!0})]}),e==="Bob's 27"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Target",value:`D${s.target||1}`,mono:!0,bold:!0}),t.jsx(h,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Baseball"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Inning",value:s.inning||1,mono:!0}),t.jsx(h,{label:"Score",value:s.score||0,mono:!0,bold:!0})]}),e==="Golf"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Hole",value:s.hole||1,mono:!0}),t.jsx(h,{label:"Strokes",value:s.strokes||0,mono:!0,bold:!0})]}),e==="Tic Tac Toe"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{label:"Turn",value:s.turn||1,mono:!0}),s.winner&&t.jsx(h,{label:"Result",value:"WINNER!",highlight:!0})]}),r&&(e==="X01"||e==="Cricket"||e==="American Cricket")&&i===1&&t.jsx("div",{className:"border-t border-white/10 pt-1 mt-1",children:t.jsx(h,{label:"Match",value:r,mono:!0,bold:!0,highlight:!0})})]})]},i))})}function h({label:e,value:n,mono:r=!1,bold:a=!1,highlight:s=!1}){return t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"opacity-70",children:[e,":"]}),t.jsx("span",{className:`${r?"font-mono":""} ${a?"font-semibold":""} ${s?"text-emerald-300":""}`,children:n})]})}function Ye({matchAvg:e,allTimeAvg:n}){const r=e-n,a=r>0,s=Math.abs(r)<.01;let i="",o="text-slate-300";return s?(i="= All-time",o="text-slate-300"):a?(i=`+${r.toFixed(2)} vs avg`,o="text-emerald-400"):(i=`${r.toFixed(2)} vs avg`,o="text-orange-400"),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"opacity-70",children:"AVG vs Avg:"}),t.jsx("span",{className:`font-mono font-semibold ${o}`,children:i})]})}function Ze(e){return!e||Object.keys(e).length===0?"—":Object.entries(e).filter(([r,a])=>a===3).map(([r])=>r==="25"?"B":r).join(",")||"—"}function et(e){if(!e.closed)return"Starting";const n=Object.values(e.closed).filter(r=>r===3).length;return n===0?"No marks":n<7?`${n}/7`:"Closing in"}function Ot(e,n,r,a,s,i,o,d,x,j,b,T,w,g,v,D,A,k,y,N,L,I,E,H,V,G,se){return p.useMemo(()=>{const S=[];if(e==="X01"){let $=0,O=0,B=0;if(k&&k.length>0){for(const U of k)U.dartsThrown&&U.totalScored&&(O+=U.dartsThrown,B+=U.totalScored);O>0&&($=B/O*3)}const _=(T??0)>0?d??0:j??null??(i??0);if(S.push({name:"You",isCurrentTurn:!!y,legsWon:a||0,score:n||0,lastScore:_,checkoutRate:v&&v>0?Math.round((g||0)/v*100):0,bestLeg:k&&k.length>0?`${Math.min(...k.map(U=>U.doubleDarts+(U.checkoutDarts||0)))||0} darts`:"—",matchAvg:$,allTimeAvg:ve("You")||0}),N&&N!=="None"){const z=(w??0)>0?x??0:b??null??(o??0);S.push({name:`${N} AI`,isCurrentTurn:!y,legsWon:s||0,score:r||0,lastScore:z,checkoutRate:A&&A>0?Math.round((D||0)/A*100):0,bestLeg:"—"})}}return e==="Cricket"&&(S.push({name:"You",isCurrentTurn:!!y,closed:I?.marks||{},points:I?.points||0}),N&&N!=="None"&&S.push({name:`${N} AI`,isCurrentTurn:!y,closed:{},points:0})),e==="Shanghai"&&(S.push({name:"You",isCurrentTurn:!!y,round:E?.round||1,target:E?.target||1,score:E?.score||0}),N&&N!=="None"&&S.push({name:`${N} AI`,isCurrentTurn:!y,round:E?.round||1,target:E?.target||1,score:0})),e==="Killer"&&H&&H.length>0&&H.forEach(($,O)=>{const B=V?.[$.id];S.push({name:$.name,isCurrentTurn:O===se,number:G?.[$.id],lives:B?.lives||0,eliminated:B?.eliminated||!1})}),S},[e,n,r,a,s,i,o,d,x,j,b,T,w,g,v,D,A,k,y,N,I,E,H,V,G,se])}function Pt(e,n,r){return p.useMemo(()=>{const a=[];return!n||!n.players||n.players.length===0||n.players.forEach((s,i)=>{const o=i===n.currentPlayerIdx;if(e==="X01"){let d=0,x=0,j=0;if(s.legs&&s.legs.length>0){for(const b of s.legs)if(b.finished){const T=b.dartsThrown||0,w=Math.max(0,b.totalScoreStart-b.totalScoreRemaining)||0;x+=T,j+=w}}x>0&&(d=j/x*3),a.push({name:s.name||`Player ${i+1}`,isCurrentTurn:o,legsWon:s.legsWon||0,score:s.score||0,lastScore:s.lastVisitScore||0,checkoutRate:s.doublesAttempted>0?Math.round(s.doublesHit/s.doublesAttempted*100):0,bestLeg:s.bestLegDarts?`${s.bestLegDarts} darts`:"—",matchAvg:d,allTimeAvg:s.name?ve(s.name):0})}e==="Cricket"&&a.push({name:s.name||`Player ${i+1}`,isCurrentTurn:o,closed:s.cricket?.marks||{},points:s.cricket?.points||0}),e==="Killer"&&a.push({name:s.name||`Player ${i+1}`,isCurrentTurn:o,number:s.killerNumber||null,lives:s.killerLives||3,eliminated:s.killerEliminated||!1})}),a},[e,n,r])}export{dt as A,St as B,je as C,Ke as D,mt as E,xt as F,ot as G,bt as H,gt as I,vt as J,wt as K,Tt as L,Nt as M,Pt as N,Je as O,Xe as T,ht as a,pt as b,ut as c,jt as d,Et as e,Ut as f,At as g,yt as h,at as i,ft as j,ze as k,Lt as l,we as m,$t as n,rt as o,nt as p,lt as q,ct as r,it as s,Dt as t,Ot as u,Ct as v,kt as w,Rt as x,Bt as y,It as z};
//# sourceMappingURL=useGameStats-Du-CQ4LX.js.map

import{j as t,H as W,e as at,F as st,u as nt,k as b,l as te,M as ge,t as f,J as rt,K as be,i as it,$ as lt,I as ot,x as Be,a as M}from"./index-B57aKmL2.js";import{r as n}from"./ui-Cl5S-Tv0.js";import{o as ct,I as dt,l as mt}from"./matchWindow-CLGQRRUv.js";import"./vendor-D3F3s8fL.js";import"./aroundTheClock-DY6sitx7.js";function ut({t:r,onJoin:p,onLeave:o,joined:_,disabled:ye}){return t.jsxs("li",{className:"p-3 rounded bg-black/10 flex items-center justify-between relative",children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"font-semibold",children:[r.title,r.official&&t.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded bg-amber-500 text-black text-xs",children:"Official"})]}),t.jsxs("div",{className:"text-sm opacity-80",children:[r.game,r.game==="X01"?"/501":""," Â· ",W(r.mode)," ",r.value," Â·"," ",new Date(r.startAt).toLocaleString()," Â· Cap ",r.capacity," Â· Joined"," ",r.participants?.length||0]}),t.jsxs("div",{className:"text-xs opacity-60 mt-1",children:["Created by: ",r.creatorName||r.creatorEmail||"Unknown"]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{className:`btn ${_?"bg-emerald-600 hover:bg-emerald-600":""}`,disabled:ye,onClick:()=>_?o&&o(r):p&&p(r),children:_?"Already Joined! âœ…":"Join Now âš”ï¸"})})]})}const xt=r=>typeof r=="string"?r.toLowerCase().includes("integration"):typeof r=="number"?r.toString().toLowerCase().includes("integration"):!1,ht=r=>r?[r.title,r.description,r.creatorName,r.creatorEmail].some(o=>xt(o)):!1,L=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0);function Pt({user:r}){const p=at(),o=(()=>{try{return st()}catch{return null}})(),{matchType:_="singles",setMatchType:ye,teamAName:pt="Team A",setTeamAName:ft,teamBName:gt="Team B",setTeamBName:bt}=nt(),[je,ae]=n.useState([]),[I,S]=n.useState(!1),[ve,j]=n.useState(""),[yt,se]=n.useState(null),[Ne,we]=n.useState(null),[h,G]=n.useState(null),[ne,A]=n.useState(!1),[qe,Se]=n.useState(!1),[re,ie]=n.useState(!1);n.useRef(!1);const J=b(e=>e.inProgress),le=b(e=>e.matchContext),ze=b(e=>e.roomId);n.useEffect(()=>{if(!(!J||le!=="tournament"))try{const e=b.getState();if((e?.game||"X01")!=="X01"||!e.roomId)return;const s=`ndn:matchWindowOpened:${e.roomId}`;if(window.sessionStorage.getItem(s)==="1")return;window.sessionStorage.setItem(s,"1"),ct()}catch{}},[J,le,ze]);const[i,y]=n.useState({title:"",game:"X01",mode:"bestof",value:3,description:"",startAt:new Date().toISOString().slice(0,16),checkinMinutes:15,capacity:16,startingScore:501,requireCalibration:!1,extras:{}}),[g,$]=n.useState(null),[ke,oe]=n.useState(30),[E,T]=n.useState(null),[Ce,D]=n.useState({}),[jt,F]=n.useState(!1),[vt,U]=n.useState(!1),[Nt,We]=n.useState(null),[wt,ce]=n.useState(null),[Y,v]=n.useState({open:!1,t:null}),[X,de]=n.useState({open:!1,t:null}),[_e,Ge]=n.useState("X01"),[Te,me]=n.useState(null),ue=n.useRef(!1);n.useRef(null);const[Fe,Ue]=n.useState({});n.useEffect(()=>o?o.addListener(a=>{try{if(a?.type==="match-prestart"){const s=a.match||null;s&&(s.prestartEndsAt=a.prestartEndsAt);try{s?.creatorId&&s?.creatorName&&Ue(d=>({...d,[s.creatorId]:s.creatorName}))}catch{}ue.current=!0,$(s);const l=a.prestartEndsAt||Date.now();oe(Math.max(0,Math.ceil(((l||Date.now())-Date.now())/1e3))),setTimeout(()=>{ue.current=!1},0),T(null),D({}),F(!1),U(!1),ce(null)}if(a?.type==="match-start"&&g&&a.roomId===g.id&&($(null),T(null),D({})),a?.type==="tournament-match-start")try{if(b.getState().inProgress)return;const s=String(r?.email||"").toLowerCase(),l=r?.username||"You",d=a.player1||{},m=a.player2||{},q=s&&d.email&&d.email.toLowerCase()===s,P=q?m.username||"Opponent":d.username||"Opponent",Z=q?[l,P]:[P,l],ee=a.startingScore||501,z=a.roomId||"";b.getState().newMatch(Z,ee,z,"tournament"),Ge(a.game||"X01"),o?.connected&&z&&o.send({type:"join",roomId:z}),$(null),T(null),D({})}catch(s){console.error("[Tournaments] tournament-match-start failed:",s)}if(a?.type==="state"&&a.payload)try{b.getState().importState(a.payload)}catch{}if(a?.type==="opponent-quit"&&me(a.quitterName||"Opponent"),a?.type==="opponent-paused")try{te.getState().setPaused(!0,null,a.pauserName||"Opponent")}catch{}if(a?.type==="opponent-unpaused")try{te.getState().setPaused(!1,null)}catch{}if(a?.type==="prestart-choice-notify"){const{roomId:s,playerId:l,choice:d}=a;if(!s||!d)return;D(m=>({...m||{},[l]:d}))}a?.type==="prestart-bull"&&(F(!0),U(!1),We(null)),a?.type==="prestart-bull-winner"&&(ce(a.winnerId||null),F(!1),U(!1)),a?.type==="prestart-bull-tie"&&(ce(null),F(!1),U(!1))}catch{}}):void 0,[o,E,g]),n.useEffect(()=>{if(!g||ue.current||g.prestartEndsAt)return;oe(30),T(null),D({});const e=setInterval(()=>oe(a=>Math.max(0,a-1)),1e3);return()=>clearInterval(e)},[g]);const De=b(e=>({players:e.players,currentPlayerIdx:e.currentPlayerIdx,roomId:e.roomId}));n.useEffect(()=>{J&&ie(!0)},[J]);const Pe=e=>{T(e);try{o?.connected&&g?.id&&o.send({type:"prestart-choice",roomId:g.id,choice:e})}catch{}},xe=n.useCallback(()=>{try{if(o?.connected){const e=b.getState();o.send({type:"state",payload:e})}}catch{}},[o]);async function k(){try{if(Ne&&Date.now()-Ne<3e3)return;const a=await(await M("/api/tournaments")).json(),s=Array.isArray(a.tournaments)?a.tournaments:[];ae(s);try{console.debug("[Tournaments] refresh fetched",s.length,"tournaments"),console.log("[Tournaments] fetched list:",s)}catch{}se(null),we(Date.now())}catch(e){try{typeof window<"u"&&se(String(e?.message||e))}catch{typeof window<"u"&&se("unknown")}}}n.useEffect(()=>{k()},[]),n.useEffect(()=>{try{o?.connected&&k()}catch{}},[o?.connected]),n.useEffect(()=>{if(!o)return;const e=o.addListener(a=>{try{if(a.type==="tournaments"&&(ae(a.tournaments||[]),we(Date.now())),a.type==="tournaments")try{console.debug("[Tournaments] WS tournaments update, num=",(a.tournaments||[]).length)}catch{}a.type==="tournament-win"&&a.message&&p(a.message,{type:"success",timeout:1e4})}catch{}});return()=>{e()}},[o?.connected]),n.useEffect(()=>{try{if(o?.connected){try{o.send({type:"list-tournaments"})}catch{}k()}}catch{}},[o?.connected]),n.useEffect(()=>{let e=null;try{(!o||!o.connected)&&(e=window.setInterval(()=>{k()},1e4))}catch{}return()=>{e&&clearInterval(e)}},[o?.connected]);const x=String(r?.email||"").toLowerCase(),Me=x==="daviesfamily108@gmail.com",Ye=()=>{mt({players:["Tournament A","Tournament B"],startingScore:501,roomId:"tournament-demo",visits:[{score:45},{score:81},{score:140}]})},u=n.useCallback(e=>!e||!x?!1:(Array.isArray(e.participants)?e.participants:[]).some(s=>String(s?.email||"").toLowerCase()===x),[x]),[N,he]=n.useState(null),[Ie,Ae]=n.useState({}),[Xe,Ee]=n.useState(()=>Date.now()),Ve=n.useCallback(e=>{const a=(e.participants||[]).map(m=>m.username||m.email||"Player"),s=Math.max(1,2**Math.ceil(Math.log2(Math.max(1,a.length)))),l=new Array(s).fill("BYE");for(let m=0;m<a.length;m++)l[m]=a[m];const d=[];for(let m=0;m<s/2;m++)d.push([l[m],l[s-1-m]]);return d},[]),Ke=()=>t.jsxs("div",{className:"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"opacity-70",children:"Default match"}),t.jsx("span",{className:"btn py-1 px-2 bg-indigo-500/30 border border-indigo-400/50 text-indigo-100",children:"Singles"}),t.jsx("span",{className:"text-xs opacity-60 ml-2",children:"(tournaments use Singles only)"})]});n.useEffect(()=>{let e=!1;async function a(){if(!x){G(null);return}try{const l=await(await M(`/api/subscription?email=${encodeURIComponent(x)}`)).json();e||(l?.source==="tournament"&&typeof l.expiresAt=="number"&&l.expiresAt>Date.now()?G(l.expiresAt):G(null))}catch{e||G(null)}}return a(),()=>{e=!0}},[x]);async function Oe(e){x&&de({open:!0,t:e})}async function Qe(){const e=X.t;if(!(!e||!x)){de({open:!1,t:null}),S(!0);try{let a=await M("/api/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,requesterEmail:x})});if(!a.ok&&a.status===403&&String(x)==="daviesfamily108@gmail.com"&&(a=await M("/api/admin/tournaments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,requesterEmail:x})})),!a.ok){let s="Delete failed";try{const l=await a.json();l?.error&&(s=`Delete failed: ${String(l.error)}`)}catch{}p(s,{type:"error"});return}p("Tournament deleted",{type:"success"}),await k()}finally{S(!1)}}}async function V(e){if(x){S(!0);try{const a=await M("/api/tournaments/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,email:x,username:r?.username})});if(!a.ok){let s={};try{s=await a.json()}catch{}s?.error==="WINNER_COOLDOWN"&&typeof s.until=="number"?(j(`You're a recent NDN tournament winner. You can re-enter after ${w(s.until)}.`),setTimeout(()=>j(""),6e3),p("Join blocked: winner cooldown active",{type:"error"})):s?.error==="ALREADY_IN_TOURNAMENT"?(j(String(s.message||"You can only join one tournament at a time.")),setTimeout(()=>j(""),6e3),p("Join blocked: already in another tournament",{type:"error"})):s?.error&&(j(String(s.error)),setTimeout(()=>j(""),3500),p(`Join failed: ${String(s.error)}`,{type:"error"}));return}p("Joined tournament",{type:"success"}),await k()}finally{S(!1)}}}async function Le(e){if(x){S(!0);try{const a=await M("/api/tournaments/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tournamentId:e.id,email:x})});if(!a.ok){let s={};try{s=await a.json()}catch{}s?.error?p(`Leave failed: ${String(s.error)}`,{type:"error"}):a.status===404?p("Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.",{type:"error"}):p("Leave failed. Please try again.",{type:"error"});return}p("Left tournament",{type:"success"}),ae(s=>s.map(l=>l.id===e.id?{...l,participants:(l.participants||[]).filter(d=>d.email!==x)}:l)),await k()}finally{S(!1)}}}async function He(){S(!0);try{const e=new Date(i.startAt).getTime(),a=await M("/api/tournaments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i.title,game:i.game,mode:i.mode,value:Number(i.value),description:i.description,startAt:e,checkinMinutes:Number(i.checkinMinutes),capacity:Number(i.capacity),startingScore:i.game==="X01"?Number(i.startingScore||501):void 0,requireCalibration:!!i.requireCalibration,creatorEmail:r?.email,creatorName:r?.username})});if(!a.ok){let s="";try{const d=await a.json();d?.error?s=String(d.error):d?.details&&(s=String(d.details))}catch{}const l=s?`Create failed: ${s}`:"Create failed. Please try again.";j(l),p(l,{type:"error"}),setTimeout(()=>j(""),6e3);return}try{const s=await a.json();if(!s?.ok){const l=s?.error?`Create failed: ${String(s.error)}`:"Create failed. Please try again.";j(l),p(l,{type:"error"}),setTimeout(()=>j(""),6e3);return}}catch{}A(!1),p("Tournament created",{type:"success"}),await k()}finally{S(!1)}}n.useEffect(()=>{if(!ne)return;const e=a=>{a.key==="Escape"&&A(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[ne]);const C=n.useMemo(()=>je.filter(e=>!ht(e)),[je]),K=n.useMemo(()=>C.filter(e=>e.official),[C]),pe=n.useMemo(()=>C.filter(e=>!e.official),[C]),fe=n.useMemo(()=>C.filter(e=>e.status==="scheduled"&&!e.official),[C]);n.useEffect(()=>{const e=()=>{const s=Date.now(),l=C.find(d=>{if(!u(d)||d.status!=="scheduled"||Ie[d.id])return!1;const m=d.startAt-s;return m>0&&m<=300*1e3});he(l??null)};e();const a=window.setInterval(e,15e3);return()=>window.clearInterval(a)},[Ie,u,C]),n.useEffect(()=>{if(!N)return;Ee(Date.now());const e=window.setInterval(()=>Ee(Date.now()),1e3);return()=>window.clearInterval(e)},[N]);const[R,Je]=n.useState(1),O=16,Q=Math.ceil(fe.length/O),Ze=fe.slice((R-1)*O,R*O),[B,$e]=n.useState(1),H=Math.ceil(pe.length/O),et=pe.slice((B-1)*O,B*O),c=n.useMemo(()=>K.filter(a=>a.status==="scheduled").sort((a,s)=>a.startAt-s.startAt)[0]||null,[K]);function w(e){return new Date(e).toLocaleString()}const Re=r?.username||"You";if(J&&le==="tournament"){const a=(b.getState().players||[]).findIndex(s=>s?.name&&s.name.toLowerCase()===Re.toLowerCase());return t.jsxs(t.Fragment,{children:[t.jsx(dt,{user:r,showStartShowcase:re,onShowStartShowcaseChange:ie,onCommitVisit:(s,l,d)=>{try{const m=b.getState(),q=m.players[m.currentPlayerIdx],P=q?.legs?.[q.legs.length-1],Z=P?P.totalScoreRemaining:m.startingScore,ee=Math.max(0,Z-s),z=Z<=50?3:ee<=50?1:0,tt=ee===0;m.addVisit(s,3,{preOpenDarts:0,doubleWindowDarts:z,finishedByDouble:tt,visitTotal:s}),P&&P.totalScoreRemaining===0?m.endLeg(s):m.nextPlayer()}catch{b.getState().addVisit(s,3),b.getState().nextPlayer()}xe()},onQuit:()=>{try{b.getState().endGame()}catch{}try{o?.connected&&o.send({type:"match-quit"})}catch{}me(null),$(null),T(null),D({}),xe();try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},onPause:()=>{try{te.getState().setPaused(!0,null,Re)}catch{}try{o?.connected&&o.send({type:"match-pause"})}catch{}},onResume:()=>{try{te.getState().setPaused(!1,null)}catch{}try{o?.connected&&o.send({type:"match-unpause"})}catch{}},onStateChange:xe,localPlayerIndexOverride:a>=0?a:void 0,gameModeOverride:_e,isOnline:!0}),Te&&t.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl",children:[t.jsx("div",{className:"text-4xl mb-3",children:"ðŸšª"}),t.jsxs("h3",{className:"text-lg font-bold text-white mb-2",children:[Te," left the match"]}),t.jsx("p",{className:"text-sm text-white/60 mb-5",children:"Your opponent has quit. You can leave the match now."}),t.jsx("button",{className:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all",onClick:()=>{try{b.getState().endGame()}catch{}me(null),$(null),T(null),D({});try{window.dispatchEvent(new Event("ndn:match-quit"))}catch{}},children:"Leave Match"})]})})]})}return t.jsxs("div",{className:"card ndn-game-shell ndn-page flex flex-col min-h-0",children:[t.jsx("div",{className:"flex items-center justify-between mb-3",children:t.jsx("h2",{className:"text-2xl font-bold ndn-section-title",children:"Tournaments ðŸŽ¯"})}),t.jsxs("div",{className:"ndn-shell-body overflow-visible flex-1 min-h-0",children:[t.jsxs("div",{className:"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap",children:[t.jsx("div",{className:"min-w-0",children:t.jsx(Ke,{})}),t.jsxs("div",{className:"shrink-0",children:[t.jsx("button",{className:"btn",onClick:()=>A(!0),children:"Create Tournament + ðŸŽ¯"}),Me&&t.jsx("button",{className:"btn btn-ghost ml-2",onClick:()=>Se(!0),children:"Demo Start Showcase ðŸŽ¯"}),Me&&t.jsx("button",{className:"btn btn-ghost ml-2",onClick:Ye,children:"Demo In-Game ðŸŽ®"})]})]}),qe&&t.jsx(ge,{players:[{id:"0",name:"Demo A",legsWon:0,legs:[]},{id:"1",name:"Demo B",legsWon:0,legs:[]}],user:r,onDone:()=>Se(!1)}),re&&t.jsx(ge,{players:De.players||[],user:r,onDone:()=>ie(!1)}),t.jsx("div",{className:"mb-2 text-sm font-semibold text-slate-300",children:"World Lobby"}),t.jsxs("div",{className:"mb-3 p-3 rounded-xl border border-indigo-500/20 bg-indigo-500/5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-semibold",children:"Created Game Lobby"}),t.jsx("div",{className:"text-xs opacity-60",children:"All tournaments created by users and admins"})]}),t.jsxs("ul",{className:"space-y-2",children:[fe.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No created tournaments yet."}),Ze.map(e=>t.jsx(ut,{t:e,onJoin:a=>V(a),onLeave:a=>Le(a),joined:u(e),disabled:I||e.status!=="scheduled"||!u(e)&&e.participants.length>=e.capacity},e.id))]}),Q>1&&t.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm",children:[t.jsx("button",{className:"text-slate-300 hover:text-white transition-colors",onClick:()=>Je(e=>Math.max(e-1,1)),disabled:R===1,children:"â† Previous"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-slate-400",children:["Page ",R," of ",Q]}),t.jsx("button",{className:"text-slate-300 hover:text-white transition-colors",onClick:()=>Je(e=>Math.min(e+1,Q)),disabled:R===Q,children:"Next â†’"})]})]})]}),c&&t.jsx("div",{className:"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10",children:t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm uppercase tracking-wide text-indigo-300 font-semibold",children:"Weekly Official Tournament ðŸŽ¯"}),t.jsx("div",{className:"font-bold",children:c.title}),t.jsxs("div",{className:"text-sm opacity-80",children:[c.game,c.game==="X01"&&c.startingScore?`/${c.startingScore}`:""," ","Â· ",W(c.mode)," ",c.value," Â· Starts ",w(c.startAt)," Â· Cap"," ",c.capacity," Â· Joined"," ",c.participants.length]}),c.prize&&t.jsx("div",{className:"text-xs mt-1",children:"Prize: 3 months PREMIUM"}),c.status!=="scheduled"&&t.jsxs("div",{className:"text-xs",children:["Status: ",c.status]}),h&&h>Date.now()&&t.jsxs("div",{className:"text-xs text-rose-300",children:["Recent winners can re-enter after ",w(h),"."]})]}),t.jsx("div",{className:"shrink-0",children:t.jsx("button",{className:`btn ${u(c)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:u(c)?"Double-click to leave this tournament":c.official&&h&&h>Date.now()?`Recent winners can re-enter after ${w(h)}`:"",disabled:I||c.status!=="scheduled"||!u(c)&&(c.participants.length>=c.capacity||!!h&&h>Date.now()),onClick:()=>{u(c)?L&&v({open:!0,t:c}):V(c)},onDoubleClick:()=>{!L&&u(c)&&v({open:!0,t:c})},"aria-label":u(c)?"Already Joined":"Join Now",children:u(c)?"Already Joined! ðŸŽ¯":"Join Now ðŸŽ¯"})})]})}),ve&&t.jsx("div",{className:"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm",children:ve}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("section",{children:[t.jsx("div",{className:"font-semibold mb-1",children:"Official ðŸŽ¯"}),t.jsx("div",{className:"text-xs opacity-70 mb-2",children:h&&h>Date.now()?t.jsxs(t.Fragment,{children:["Youâ€™re a recent NDN tournament winner â€” to keep it fair, you can re-enter after ",w(h),"."]}):t.jsx(t.Fragment,{children:"Note: Weekly winners can re-enter once their 3 months of PREMIUM ends."})}),t.jsxs("ul",{className:"space-y-2",children:[K.map(e=>t.jsxs("li",{className:"p-3 rounded-lg border flex items-center justify-between relative",style:{backgroundColor:`${f(e.game).color}10`,borderColor:`${f(e.game).color}30`},children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[t.jsxs("span",{className:"px-2 py-0.5 rounded-full text-[10px] sm:text-xs border",style:{backgroundColor:`${f(e.game).color}20`,color:f(e.game).color,borderColor:`${f(e.game).color}50`},children:[f(e.game).emoji," ",e.game]}),e.title," ",e.prize&&t.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 align-middle",children:[t.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-amber-500 text-black",children:"Prize"}),t.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help",title:"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.","aria-label":"Prize info",children:"i"})]})]}),t.jsxs("div",{className:"text-sm opacity-80",children:[e.game,e.game==="X01"&&e.startingScore?`/${e.startingScore}`:""," ","Â· ",W(e.mode)," ",e.value," Â· ",w(e.startAt)," Â· Cap ",e.capacity," Â· Joined ",e.participants.length]}),t.jsx("div",{className:"text-xs opacity-60",children:f(e.game).tagline}),e.prize&&t.jsx("div",{className:"text-xs",children:"Prize: 3 months PREMIUM"}),e.status!=="scheduled"&&t.jsxs("div",{className:"text-xs",children:["Status: ",e.status]}),u(e)&&t.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"}),e.official&&h&&h>Date.now()&&t.jsxs("div",{className:"text-xs text-rose-300",children:["Cooldown active until ",w(h),"."]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:`btn ${u(e)?"bg-emerald-600 hover:bg-emerald-600":""}`,title:u(e)?"Double-click to leave this tournament":e.official&&h&&h>Date.now()?`Recent winners can re-enter after ${w(h)}`:"",disabled:I||e.status!=="scheduled"||!u(e)&&(e.participants.length>=e.capacity||e.official&&!!h&&h>Date.now()),onClick:()=>{u(e)?L&&v({open:!0,t:e}):V(e)},onDoubleClick:()=>{!L&&u(e)&&v({open:!0,t:e})},"aria-label":u(e)?"Already Joined":"Join Now",children:u(e)?"Already Joined! ðŸŽ¯":"Join Now ðŸŽ¯"}),e.status==="scheduled"&&x&&(e.creatorEmail&&String(e.creatorEmail).toLowerCase()===x||x==="daviesfamily108@gmail.com")&&t.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>Oe(e),"aria-label":"Delete tournament",children:"Ã—"})]})]},e.id)),K.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No official tournaments yet."})]})]}),t.jsxs("section",{children:[t.jsx("div",{className:"font-semibold mb-1",children:"Community ðŸŽ¯"}),t.jsxs("ul",{className:"space-y-2",children:[et.map(e=>t.jsxs("li",{className:"p-3 rounded-lg border flex items-center justify-between relative",style:{backgroundColor:`${f(e.game).color}10`,borderColor:`${f(e.game).color}30`},children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[t.jsxs("span",{className:"px-2 py-0.5 rounded-full text-[10px] sm:text-xs border",style:{backgroundColor:`${f(e.game).color}20`,color:f(e.game).color,borderColor:`${f(e.game).color}50`},children:[f(e.game).emoji," ",e.game]}),e.title]}),t.jsxs("div",{className:"text-sm opacity-80",children:[e.game,e.game==="X01"&&e.startingScore?`/${e.startingScore}`:""," ","Â· ",W(e.mode)," ",e.value," Â· ",w(e.startAt)," Â· Cap ",e.capacity," Â· Joined ",e.participants.length]}),t.jsx("div",{className:"text-xs opacity-60",children:f(e.game).tagline}),e.description&&t.jsx("div",{className:"text-xs opacity-80",children:e.description}),u(e)&&t.jsx("div",{className:"text-xs text-emerald-400 font-semibold",children:"Already Joined"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"btn",title:u(e)?"Double-click to leave this tournament":"",disabled:I||e.status!=="scheduled"||!u(e)&&e.participants.length>=e.capacity,onClick:()=>{u(e)?L&&v({open:!0,t:e}):V(e)},onDoubleClick:()=>{!L&&u(e)&&v({open:!0,t:e})},children:u(e)?"Already Joined":"Join Now"}),e.status==="scheduled"&&x&&(e.creatorEmail&&String(e.creatorEmail).toLowerCase()===x||x==="daviesfamily108@gmail.com")&&t.jsx("button",{className:"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow",title:"Delete this tournament",onClick:()=>Oe(e),"aria-label":"Delete tournament",children:"Ã—"})]})]},e.id)),pe.length===0&&t.jsx("li",{className:"text-sm opacity-60",children:"No community tournaments yet."})]}),H>1&&t.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 pt-2 border-t border-white/10",children:[t.jsx("button",{className:"btn btn-sm btn-ghost",disabled:B===1,onClick:()=>$e(e=>Math.max(1,e-1)),children:"Previous"}),t.jsxs("span",{className:"text-sm opacity-70",children:["Page ",B," of ",H]}),t.jsx("button",{className:"btn btn-sm btn-ghost",disabled:B===H,onClick:()=>$e(e=>Math.min(H,e+1)),children:"Next"})]})]})]}),N&&t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"tournament-prestart-heading",className:"fixed inset-0 z-[80] flex items-start justify-center pt-8 bg-black/70 p-4",onClick:e=>{e.target===e.currentTarget&&(Ae(a=>({...a,[N.id]:!0})),he(null))},children:t.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-2xl w-full max-h-[85vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{id:"tournament-prestart-heading",className:"text-xl font-semibold",children:"Bracket Preview"}),t.jsxs("div",{className:"text-sm opacity-70",children:[N.title," starts in"," ",Math.max(0,Math.ceil((N.startAt-Xe)/1e3)),"s"]})]}),t.jsx("button",{className:"btn btn-ghost",onClick:()=>{Ae(e=>({...e,[N.id]:!0})),he(null)},children:"Close"})]}),t.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400 mb-3",children:"Round 1"}),t.jsx("div",{className:"space-y-2",children:Ve(N).map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm",children:[t.jsxs("span",{className:"font-semibold",children:["Match ",a+1]}),t.jsxs("span",{className:"text-slate-200",children:[e[0]," vs ",e[1]]})]},`${N.id}-pair-${a}`))}),t.jsx("div",{className:"mt-4 text-xs text-slate-400",children:"Byes are shown so everyone can see their bracket position."})]})}),ne&&t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"create-tournament-heading",tabIndex:-1,className:"fixed inset-0 z-[70] flex items-start justify-center pt-8 bg-black/80 p-2 sm:p-6",onClick:e=>{e.target===e.currentTarget&&A(!1)},children:t.jsxs("div",{className:"rounded-2xl w-full sm:max-w-2xl max-h-[82vh] flex flex-col shadow-2xl border border-indigo-500/30 overflow-hidden",style:{background:"var(--ndn-card-bg, #0f172a)"},children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20 shrink-0",style:{background:"var(--ndn-card-bg, #0f172a)"},children:[t.jsx("h3",{id:"create-tournament-heading",className:"text-sm sm:text-lg font-bold tracking-tight",children:"ðŸŽ¯ New Tournament"}),t.jsx("button",{className:"w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors",onClick:()=>A(!1),"aria-label":"Close",children:"âœ•"})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3",style:{background:"var(--ndn-card-bg, #0f172a)"},children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Title"}),t.jsx("input",{className:"input w-full text-sm",value:i.title,onChange:e=>y(a=>({...a,title:e.target.value})),placeholder:"e.g. Friday Night 501"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Game Settings"}),t.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[t.jsxs("div",{children:[t.jsx("select",{className:"input w-full text-xs",value:i.game,onChange:e=>{const a=e.target.value,s=be[a],l=s?.modeOptions?.includes(i.mode)?i.mode:s?.modeOptions?.[0]??"bestof";y(d=>({...d,game:a,mode:l,extras:it(a),startingScore:s?.startOptions?.[0]??d.startingScore}))},children:rt.map(e=>t.jsxs("option",{value:e,children:[f(e).emoji," ",e]},e))}),t.jsx("div",{className:"text-[9px] mt-0.5 px-0.5",style:{color:f(i.game).color},children:f(i.game).tagline||"Game"})]}),t.jsxs("div",{children:[t.jsx("select",{className:"input w-full text-xs",value:i.mode,onChange:e=>y(a=>({...a,mode:e.target.value})),children:lt(i.game).filter(e=>e!=="all").map(e=>t.jsx("option",{value:String(e),children:W(String(e))},String(e)))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Mode"})]}),t.jsxs("div",{children:[t.jsx("input",{className:"input w-full text-xs",type:"number",min:1,value:i.value,onChange:e=>y(a=>({...a,value:Number(e.target.value)})),placeholder:"0"}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:ot(i.game,i.mode)})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Description"}),t.jsx("textarea",{className:"input w-full text-xs",rows:2,value:i.description,onChange:e=>y(a=>({...a,description:e.target.value})),placeholder:"Optional detailsâ€¦"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Schedule"}),t.jsxs("div",{className:"space-y-1.5 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-2",children:[t.jsxs("div",{children:[t.jsx("input",{className:"input w-full text-xs",type:"datetime-local",value:i.startAt,onChange:e=>y(a=>({...a,startAt:e.target.value}))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Start time"})]}),t.jsxs("div",{children:[t.jsx("input",{className:"input w-full text-xs",type:"number",min:0,value:i.checkinMinutes,onChange:e=>y(a=>({...a,checkinMinutes:Number(e.target.value)}))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Check-in (min)"})]})]})]}),Be(i.game).length>0&&t.jsxs("div",{children:[t.jsxs("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:[i.game," Settings"]}),t.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:Be(i.game).map(e=>t.jsxs("div",{children:[e.type==="select"&&e.options?t.jsx("select",{className:"input w-full text-xs",value:i.extras[e.key]??e.defaultValue,onChange:a=>y(s=>({...s,extras:{...s.extras,[e.key]:Number(a.target.value)}})),children:e.options.map(a=>t.jsx("option",{value:a,children:a},a))}):t.jsx("input",{className:"input w-full text-xs",type:"number",min:e.min??1,max:e.max,step:e.step??1,value:i.extras[e.key]??e.defaultValue,onChange:a=>y(s=>({...s,extras:{...s.extras,[e.key]:Number(a.target.value)}}))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:e.label})]},e.key))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1",children:"Players"}),t.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[(be[i.game]?.startOptions??[]).length>0?t.jsxs("div",{children:[t.jsx("select",{className:"input w-full text-xs",value:String(i.startingScore),onChange:e=>y(a=>({...a,startingScore:Number(e.target.value)})),children:(be[i.game]?.startOptions??[301,501,701]).map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Starting score"})]}):t.jsx("div",{}),t.jsxs("div",{children:[t.jsx("input",{className:"input w-full text-xs",type:"number",min:6,max:64,value:i.capacity,onChange:e=>y(a=>({...a,capacity:Number(e.target.value)}))}),t.jsx("div",{className:"text-[9px] text-slate-500 mt-0.5 px-0.5",children:"Max players"})]})]})]}),t.jsxs("div",{className:"flex items-center gap-3 rounded-lg bg-indigo-500/10 border border-indigo-500/20 px-3 py-2",children:[t.jsx("input",{type:"checkbox",className:"accent-purple-500 w-4 h-4 shrink-0",checked:!!i.requireCalibration,onChange:e=>y(a=>({...a,requireCalibration:!!e.target.checked})),id:"require-camera"}),t.jsxs("label",{htmlFor:"require-camera",className:"text-xs leading-tight",children:[t.jsx("span",{className:"font-semibold",children:"Require Camera"}),t.jsx("span",{className:"block text-[10px] text-slate-400 mt-0.5",children:"Players must have a camera to join"})]})]}),t.jsx("div",{className:"text-[10px] text-slate-500 text-center pb-1",children:"Community tournaments do not award prizes."})]}),t.jsxs("div",{className:"flex gap-2 px-4 py-3 border-t border-indigo-500/20 shrink-0",style:{background:"var(--ndn-card-bg, #0f172a)"},children:[t.jsx("button",{className:"flex-1 btn btn-ghost text-xs",onClick:()=>A(!1),children:"Cancel"}),t.jsx("button",{className:"flex-1 btn text-xs",disabled:I,onClick:He,children:I?"Creatingâ€¦":"Create Tournament"})]})]})}),g&&t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":"join-heading",tabIndex:-1,className:"fixed inset-0 z-60 flex items-start justify-center pt-8 bg-black/60 p-4",children:t.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full",children:[t.jsx("div",{id:"join-heading",className:"text-lg font-bold mb-2",children:"Match Ready"}),t.jsxs("div",{className:"mb-3",children:[g.game," - ",g.modeType," Â· ",g.legs," legs"]}),t.jsxs("div",{className:"text-sm opacity-80 mb-3",children:["Created by ",g.createdBy]}),g.startingScore&&t.jsxs("div",{className:"mb-3",children:["Starting score:"," ",t.jsx("span",{className:"font-mono",children:g.startingScore})]}),t.jsx(ge,{open:re,players:De.players,user:r,onRequestClose:()=>{},onDone:()=>{}}),t.jsxs("div",{className:"mb-3",children:["Timer: ",t.jsxs("span",{className:"font-mono",children:[ke,"s"]})]}),(ke<=15||g?.prestartEndsAt)&&t.jsxs("div",{className:"mb-3",children:["Choose:"," ",t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:`btn ${E==="bull"?"btn-primary":"btn-ghost"}`,onClick:()=>Pe("bull"),children:"Bull Up"}),t.jsx("button",{className:`btn ${E==="skip"?"btn-primary":"btn-ghost"}`,onClick:()=>Pe("skip"),children:"Skip"})]}),t.jsx("div",{className:"text-xs opacity-70 mt-2",children:E?`You chose: ${E}`:"Please choose Bull Up or Skip before accepting"}),Object.keys(Ce).length>0&&t.jsx("div",{className:"text-xs opacity-70 mt-2",role:"status","aria-live":"polite",children:Object.entries(Ce).map(([e,a])=>t.jsxs("div",{children:[Fe[e]||e," chose: ",a]},e))}),E==="skip"&&t.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Skip requires both players to click Skip. Waiting for opponent..."})]})]})}),Y.open&&Y.t&&t.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-8",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>v({open:!1,t:null})}),t.jsxs("div",{className:"relative card p-4 w-[360px] max-w-[90vw]",children:[t.jsx("div",{className:"text-lg font-semibold mb-2",children:"Leave tournament?"}),t.jsxs("div",{className:"text-sm opacity-80 mb-4",children:["Are you sure you want to remove yourself from â€œ",Y.t.title,"â€?"]}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700",onClick:()=>v({open:!1,t:null}),children:"Decline"}),t.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{const e=Y.t;v({open:!1,t:null}),await Le(e)},children:"Accept"})]})]})]}),X.open&&X.t&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center pt-8 z-50",children:t.jsx("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold mb-4 text-white",children:"Delete Tournament"}),t.jsxs("div",{className:"text-slate-300 mb-6",children:["Are you sure you want to delete"," ",t.jsxs("span",{className:"font-semibold text-white",children:['"',X.t.title,'"']}),"?",t.jsx("br",{}),t.jsx("span",{className:"text-sm text-slate-400",children:"This action cannot be undone."})]}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsx("button",{className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",onClick:()=>de({open:!1,t:null}),children:"Decline"}),t.jsx("button",{className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",onClick:Qe,children:"Continue"})]})]})})})]})]})}export{Pt as default};
//# sourceMappingURL=Tournaments-ByjjkrCP.js.map

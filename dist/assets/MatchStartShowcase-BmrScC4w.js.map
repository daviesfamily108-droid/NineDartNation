{"version":3,"file":"MatchStartShowcase-BmrScC4w.js","sources":["../../src/components/ui/CalibrationPopup.tsx","../../src/components/ui/MatchStartShowcase.tsx"],"sourcesContent":["import React from \"react\";\nimport type { Player } from \"../../store/match\";\n\nexport default function CalibrationPopup({\n  players,\n  playerCalibrations,\n  calibrationSkipped,\n  onSkip,\n  onOpenCalibrator,\n  onClose,\n}: {\n  players: Player[];\n  playerCalibrations: { [k: string]: any };\n  calibrationSkipped: Record<string, boolean>;\n  onSkip: (id: string) => void;\n  onOpenCalibrator: (id: string) => void;\n  onClose: () => void;\n}) {\n  const skippedPlayers = players.filter((p) => calibrationSkipped[p.id]);\n  const remainingPlayers = players.filter((p) => !calibrationSkipped[p.id]);\n  const canStartMatch = remainingPlayers.length === 0;\n\n  return (\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/90 p-4\">\n      <div className=\"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-2xl w-full\">\n        <h3 className=\"text-xl font-bold mb-4 text-center\">\n          Calibration Check\n        </h3>\n        <p className=\"text-sm opacity-70 mb-6 text-center\">\n          Check your dartboard calibration before the match starts. Both players\n          must skip or confirm to begin.\n        </p>\n        {skippedPlayers.length > 0 && remainingPlayers.length > 0 && (\n          <div className=\"mb-4 p-3 bg-blue-900/50 border border-blue-600 rounded-lg\">\n            <p className=\"text-sm text-blue-200\">\n              {skippedPlayers.map((p) => p.name).join(\", \")}{\" \"}\n              {skippedPlayers.length === 1 ? \"has\" : \"have\"} chosen to skip.{\" \"}\n              {remainingPlayers.map((p) => p.name).join(\", \")}, would you like\n              to skip as well?\n            </p>\n          </div>\n        )}\n        <div className=\"space-y-4\">\n          {players.map((player) => (\n            <div\n              key={player.id}\n              className=\"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg\"\n            >\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-lg font-bold text-white\">\n                  {player.name\n                    .split(\" \")\n                    .map((n) => n[0])\n                    .join(\"\")\n                    .toUpperCase()\n                    .slice(0, 2)}\n                </div>\n                <div>\n                  <div className=\"font-medium\">{player.name}</div>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <button\n                  className=\"btn btn-sm btn-ghost\"\n                  onClick={() => onOpenCalibrator(player.id)}\n                >\n                  Bull Up\n                </button>\n                <button\n                  className=\"btn btn-sm btn-primary\"\n                  onClick={() => onSkip(player.id)}\n                  disabled={!!calibrationSkipped[player.id]}\n                >\n                  {calibrationSkipped[player.id] ? \"Skipped âœ“\" : \"Skip\"}\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n        <div className=\"mt-6 flex justify-center gap-4\">\n          <button\n            className={`btn ${canStartMatch ? \"btn-primary\" : \"btn-ghost opacity-50 cursor-not-allowed\"}`}\n            disabled={!canStartMatch}\n            onClick={onClose}\n          >\n            Start Match\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useMemo, useState, useRef, useLayoutEffect } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport {\n  getAllTimeAvg,\n  getAllTimeFirstNineAvg,\n  getAllTimeBestCheckout,\n  getAllTimeBestLeg,\n  getAllTime,\n  getAllTime180s,\n} from \"../../store/profileStats\";\nimport type { Player } from \"../../store/match\";\nimport { useCalibration } from \"../../store/calibration\";\n\nfunction StatBlock({\n  label,\n  value,\n  className = \"\",\n  scale = 1,\n}: {\n  label: string;\n  value: string | number;\n  className?: string;\n  scale?: number;\n}) {\n  return (\n    <div className={`flex flex-col items-center gap-1 ${className}`}>\n      <div className=\"text-xs opacity-70\">{label}</div>\n      <div\n        className=\"text-2xl sm:text-3xl font-bold transform transition-transform duration-200 ease-out\"\n        style={{ transform: `scale(${scale})` }}\n      >\n        {value}\n      </div>\n    </div>\n  );\n}\n\nfunction PlayerCalibrationPreview({\n  player,\n  user,\n  playerCalibrations,\n}: {\n  player: Player;\n  user?: any;\n  playerCalibrations: { [playerName: string]: any };\n}) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const calib = playerCalibrations[player.name];\n  const isCalibrated = !!calib;\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Draw a simple dartboard circle\n    const centerX = canvas.width / 2;\n    const centerY = canvas.height / 2;\n    const radius = Math.min(centerX, centerY) - 2;\n\n    // Outer circle\n    ctx.strokeStyle = \"#fff\";\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\n    ctx.stroke();\n\n    // Bullseye\n    ctx.fillStyle = \"#f00\";\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI);\n    ctx.fill();\n\n    // If calibrated, draw calibration points\n    if (isCalibrated) {\n      ctx.fillStyle = \"#0f0\";\n      // Draw some sample points (simplified)\n      const points = [\n        [centerX - radius * 0.5, centerY],\n        [centerX + radius * 0.5, centerY],\n        [centerX, centerY - radius * 0.5],\n        [centerX, centerY + radius * 0.5],\n      ];\n      points.forEach(([x, y]) => {\n        ctx.beginPath();\n        ctx.arc(x, y, 2, 0, 2 * Math.PI);\n        ctx.fill();\n      });\n    }\n  }, [isCalibrated]);\n\n  return (\n    <div className=\"flex items-center gap-2 mt-1\">\n      <canvas\n        ref={canvasRef}\n        width={40}\n        height={40}\n        className=\"border border-white/20 rounded\"\n      />\n      <span\n        className={`text-xs ${isCalibrated ? \"text-green-400\" : \"text-gray-400\"}`}\n      >\n        {isCalibrated ? \"Calibrated\" : \"Not Calibrated\"}\n      </span>\n    </div>\n  );\n}\n\nimport FocusLock from \"react-focus-lock\";\nimport CalibrationPopup from \"./CalibrationPopup\";\nexport default function MatchStartShowcase({\n  open = true,\n  players,\n  user,\n  onDone,\n  onRequestClose,\n  initialSeconds = 15,\n  roomId,\n  onChoice,\n  choices = {},\n  bullActive = false,\n  onBullThrow,\n  showCalibrationDefault = false,\n  disableEscClose = false,\n}: {\n  open?: boolean;\n  players: Player[];\n  user?: any;\n  onDone?: () => void;\n  onRequestClose?: () => void;\n  initialSeconds?: number;\n  roomId?: string;\n  onChoice?: (choice: \"bull\" | \"skip\") => void;\n  choices?: Record<string, string>;\n  bullActive?: boolean;\n  onBullThrow?: (score: number) => void;\n  showCalibrationDefault?: boolean;\n  disableEscClose?: boolean;\n}) {\n  // Debug logs removed\n  const [seconds, setSeconds] = useState(initialSeconds || 15);\n  const [scaleState, setScaleState] = useState(1);\n  // Overlay visibility is controlled by parent; the component should be controlled using `open` and `onRequestClose`.\n  const visible = !!open;\n  const [showCalibration, setShowCalibration] = useState(false);\n  const [calibrationSkipped, setCalibrationSkipped] = useState<{\n    [playerId: string]: boolean;\n  }>(() => {\n    const map: { [k: string]: boolean } = {};\n    if (!showCalibrationDefault) {\n      for (const p of players) map[p.id] = true;\n    }\n    return map;\n  });\n  const [playerCalibrations, setPlayerCalibrations] = useState<{\n    [playerName: string]: any;\n  }>({});\n  const hostRef = useRef<HTMLDivElement | null>(null);\n  const startNowRef = useRef<HTMLButtonElement | null>(null);\n  const closeRef = useRef<HTMLButtonElement | null>(null);\n  const prevActiveElement = useRef<HTMLElement | null>(null);\n  // mountedRef ensures keyboard events that fire during render/mount don't prematurely close the overlay\n  const mountedRef = useRef(false);\n\n  useEffect(() => {\n    // mark mounted after first paint to ensure early key events don't trigger a close mid-render\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  }, []);\n\n  // If players list widens after mount, ensure new players inherit the skip state\n  useEffect(() => {\n    if (!showCalibrationDefault) {\n      setCalibrationSkipped((prev) => {\n        const next = { ...prev };\n        for (const p of players) if (!next[p.id]) next[p.id] = true;\n        return next;\n      });\n    }\n  }, [players, showCalibrationDefault]);\n\n  const allPlayersSkipped = players.every((p) => calibrationSkipped[p.id]);\n  const canStartMatch = allPlayersSkipped;\n\n  // visibility is controlled by parent via `open` prop\n\n  useEffect(() => {\n    if (!visible) return;\n    // useEffect(visible) entered\n    // Ensure initial focus is on the Start Now button for convenience\n    try {\n      setTimeout(() => {\n        try {\n          startNowRef.current?.focus();\n        } catch {}\n      }, 0);\n    } catch {}\n    // remember previous active element so we can restore on close\n    try {\n      prevActiveElement.current = document.activeElement as HTMLElement;\n    } catch {}\n    // Hide app content from screen readers while overlay is open\n    const appRoot = document.getElementById(\"root\");\n    const prevAria: string | null = appRoot\n      ? appRoot.getAttribute(\"aria-hidden\")\n      : null;\n    try {\n      if (appRoot) appRoot.setAttribute(\"aria-hidden\", \"true\");\n    } catch {}\n    const t = allPlayersSkipped\n      ? setInterval(() => setSeconds((s) => s - 1), 1000)\n      : null;\n    const onKey = (e: KeyboardEvent) => {\n      if (!mountedRef.current) return;\n      if (!disableEscClose && (e.key === \"Escape\" || e.key === \"Esc\")) {\n        e.preventDefault();\n        // Ensure parent handlers are invoked asynchronously so we don't unmount during render\n        try {\n          setTimeout(() => {\n            try {\n              onRequestClose?.();\n            } catch {}\n          }, 0);\n        } catch {}\n        try {\n          prevActiveElement.current?.focus();\n        } catch {}\n      }\n    };\n    document.addEventListener(\"keydown\", onKey);\n    // Cleanup and restore aria-hidden\n    return () => {\n      // useEffect(visible) cleanup\n      try {\n        if (appRoot) {\n          appRoot.removeAttribute(\"aria-hidden\");\n        }\n      } catch {}\n      if (t) clearInterval(t);\n      document.removeEventListener(\"keydown\", onKey);\n    };\n  }, [visible, onDone, allPlayersSkipped]);\n\n  useEffect(() => {\n    if (!visible) return;\n    // Show calibration popup immediately when countdown starts\n    if (\n      showCalibrationDefault &&\n      seconds === (initialSeconds || 15) &&\n      !showCalibration\n    ) {\n      setShowCalibration(true);\n      // Fetch calibrations for all players\n      const fetchCalibrations = async () => {\n        const calibs: { [playerName: string]: any } = {};\n        for (const player of players) {\n          if (user?.username && player.name === user.username) {\n            // Local user: use store\n            const { H, imageSize, locked } = useCalibration.getState();\n            if (H && locked) calibs[player.name] = { H, imageSize, locked };\n          } else {\n            // Remote user: fetch from server\n            try {\n              const res = await fetch(\n                `/api/users/${encodeURIComponent(player.name)}/calibration`,\n              );\n              if (res.ok) {\n                const data = await res.json();\n                if (data.calibration) calibs[player.name] = data.calibration;\n              }\n            } catch (err) {\n              console.warn(\"Failed to fetch calibration for\", player.name, err);\n            }\n          }\n        }\n        setPlayerCalibrations(calibs);\n      };\n      fetchCalibrations();\n    }\n    // Only start countdown when all players have skipped calibration\n    if (allPlayersSkipped) {\n      if (seconds <= 3 && seconds > 0) {\n        setScaleState((s) => s + 0.4);\n      }\n      if (seconds <= 0) {\n        // countdown reached 0, scheduling close\n        // Done; small delay to let the \"Game On\" message show\n        setTimeout(() => {\n          // Do not set local visible state here when controlled; delegate close to parent via onRequestClose/onDone\n          // calling onDone/onRequestClose\n          try {\n            onDone?.();\n          } catch {}\n          try {\n            setTimeout(() => {\n              try {\n                onRequestClose?.();\n              } catch {}\n            }, 0);\n          } catch {}\n          // Return focus to previous element\n          try {\n            prevActiveElement.current?.focus();\n          } catch {}\n        }, 1000);\n      }\n    }\n  }, [\n    seconds,\n    onDone,\n    visible,\n    showCalibration,\n    allPlayersSkipped,\n    players,\n    user,\n  ]);\n\n  const stats = useMemo(\n    () =>\n      players.map((p) => {\n        try {\n          const avg3 = getAllTimeAvg(p.name);\n          const best9 = getAllTimeFirstNineAvg(p.name);\n          const bestCheckout = getAllTimeBestCheckout(p.name);\n          const bestLeg = getAllTimeBestLeg(p.name);\n          const all = getAllTime(p.name);\n          const career180s = getAllTime180s(p.name);\n          // Count match 180s for the provided player\n          let match180s = 0;\n          try {\n            for (const L of p.legs || []) {\n              for (const v of L.visits || []) {\n                if (Number(v.score || 0) === 180) match180s += 1;\n              }\n            }\n          } catch {}\n          const one80s = `${match180s}/${career180s}`;\n          return {\n            id: p.id,\n            name: p.name,\n            avg3: avg3.toFixed(1),\n            best9: best9.toFixed(1),\n            bestCheckout,\n            bestLeg,\n            one80s,\n          };\n        } catch (err) {\n          // Swallow errors computing stats to avoid breaking render in tests\n          return {\n            id: p.id,\n            name: p.name,\n            avg3: \"â€”\",\n            best9: \"â€”\",\n            bestCheckout: \"â€”\",\n            bestLeg: \"â€”\",\n            one80s: \"â€”\",\n          };\n        }\n      }),\n    [players],\n  );\n  // Create and manage a portal container so overlays appended to body are cleaned up and avoid duplicates in tests\n  const portalElRef = useRef<HTMLDivElement | null>(\n    typeof document !== \"undefined\" ? document.createElement(\"div\") : null,\n  );\n  useLayoutEffect(() => {\n    if (!portalElRef.current) return;\n    const el = portalElRef.current;\n    el.className = \"ndn-match-start-portal\";\n    try {\n      const old = Array.from(\n        document.querySelectorAll(\".ndn-match-start-portal\"),\n      );\n      old.forEach((o) => {\n        try {\n          o.parentNode?.removeChild(o);\n        } catch {}\n      });\n    } catch {}\n    document.body.appendChild(el);\n    return () => {\n      try {\n        if (el && el.parentNode) el.parentNode.removeChild(el);\n      } catch {}\n    };\n  }, []);\n\n  if (!visible) return null;\n\n  // Render the extracted CalibrationPopup component, passing required handlers\n\n  const getScaleFor = (s: number) => {\n    if (s <= 0) return 1.8;\n    if (s === 1) return 1.6;\n    if (s === 2) return 1.4;\n    if (s === 3) return 1.2;\n    return 1;\n  };\n\n  const overlay = (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4\">\n      <div\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby=\"match-start-heading\"\n        tabIndex={-1}\n      >\n        <FocusLock returnFocus={true}>\n          <div ref={hostRef}>\n            <div className=\"bg-white/5 border border-white/10 rounded-3xl p-8 md:p-12 max-w-7xl w-full backdrop-blur-sm shadow-2xl\">\n              <div className=\"flex items-center justify-between mb-8\">\n                <div\n                  id=\"match-start-heading\"\n                  className=\"text-2xl font-bold opacity-90\"\n                >\n                  Match Starting Soon\n                </div>\n                <div className=\"flex items-center gap-4\">\n                  <div\n                    className=\"text-6xl font-extrabold text-emerald-400\"\n                    aria-live=\"polite\"\n                  >\n                    {seconds > 0 ? seconds : \"GO\"}\n                  </div>\n                  <div className=\"flex flex-col gap-2\">\n                    <button\n                      ref={startNowRef}\n                      className=\"btn btn-lg\"\n                      onClick={() => {\n                        try {\n                          onDone?.();\n                        } catch {}\n                        try {\n                          try {\n                            document\n                              .getElementById(\"root\")\n                              ?.removeAttribute(\"aria-hidden\");\n                          } catch {}\n                          setTimeout(() => {\n                            try {\n                              onRequestClose?.();\n                            } catch {}\n                          }, 0);\n                        } catch {}\n                      }}\n                      aria-label=\"Start match now\"\n                    >\n                      Start Now\n                    </button>\n                    <button\n                      ref={closeRef}\n                      className=\"btn btn-ghost btn-sm\"\n                      onClick={() => {\n                        try {\n                          onDone?.();\n                        } catch {}\n                        try {\n                          document\n                            .getElementById(\"root\")\n                            ?.removeAttribute(\"aria-hidden\");\n                        } catch {}\n                        try {\n                          setTimeout(() => {\n                            try {\n                              onRequestClose?.();\n                            } catch {}\n                          }, 0);\n                        } catch {}\n                      }}\n                      aria-label=\"Close match start showcase\"\n                    >\n                      Close\n                    </button>\n                  </div>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\n                {stats.map((st) => (\n                  <div\n                    key={st.id}\n                    className=\"p-6 rounded-2xl bg-white/8 border border-white/12 flex flex-col items-center shadow-xl\"\n                  >\n                    <div className=\"w-20 h-20 rounded-full bg-gradient-to-br from-emerald-400 to-blue-500 flex items-center justify-center text-2xl font-bold text-white mb-4 shadow-lg\">\n                      {st.name\n                        .split(\" \")\n                        .map((n) => n[0])\n                        .join(\"\")\n                        .toUpperCase()\n                        .slice(0, 2)}\n                    </div>\n                    <div className=\"text-xl font-semibold mb-4 text-center\">\n                      {st.name}\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4 w-full\">\n                      <StatBlock\n                        label=\"3-Dart Avg\"\n                        value={st.avg3}\n                        scale={getScaleFor(seconds)}\n                      />\n                      <StatBlock\n                        label=\"First-9 Avg\"\n                        value={st.best9}\n                        scale={getScaleFor(seconds)}\n                      />\n                      <StatBlock\n                        label=\"Best Checkout\"\n                        value={st.bestCheckout || \"â€”\"}\n                        scale={getScaleFor(seconds)}\n                      />\n                      <StatBlock\n                        label=\"Best Leg\"\n                        value={st.bestLeg || \"â€”\"}\n                        scale={getScaleFor(seconds)}\n                      />\n                    </div>\n                    <div className=\"mt-4 opacity-70 text-sm\">\n                      180s (match / career): {st.one80s}\n                    </div>\n                  </div>\n                ))}\n              </div>\n              <div className=\"text-center\">\n                {seconds <= 1 ? (\n                  <div className=\"text-3xl font-bold text-emerald-400\">\n                    Good luck â€” Game on! ðŸŽ¯\n                  </div>\n                ) : (\n                  <div className=\"text-lg opacity-70\">\n                    {players.map((p) => p.name).join(\" vs \")}\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </FocusLock>\n      </div>\n    </div>\n  );\n  return createPortal(\n    <>\n      {showCalibration && (\n        <CalibrationPopup\n          players={players}\n          playerCalibrations={playerCalibrations}\n          calibrationSkipped={calibrationSkipped}\n          onSkip={(id: string) =>\n            setCalibrationSkipped((prev) => ({ ...prev, [id]: true }))\n          }\n          onOpenCalibrator={(id: string) => {\n            try {\n              window.dispatchEvent(\n                new CustomEvent(\"ndn:change-tab\", {\n                  detail: { tab: \"calibrate\" },\n                }),\n              );\n            } catch {}\n            // Tell parent to close the overlay so the user can calibrate\n            try {\n              setTimeout(() => {\n                try {\n                  onRequestClose?.();\n                } catch {}\n              }, 0);\n            } catch {}\n          }}\n          onClose={() => {\n            setShowCalibration(false);\n          }}\n        />\n      )}\n      {overlay}\n    </>,\n    portalElRef.current as HTMLDivElement,\n  );\n}\n"],"names":["CalibrationPopup","players","playerCalibrations","calibrationSkipped","onSkip","onOpenCalibrator","onClose","skippedPlayers","p","remainingPlayers","canStartMatch","jsxs","jsx","player","n","StatBlock","label","value","className","scale","MatchStartShowcase","open","user","onDone","onRequestClose","initialSeconds","roomId","onChoice","choices","bullActive","onBullThrow","showCalibrationDefault","disableEscClose","seconds","setSeconds","useState","scaleState","setScaleState","visible","showCalibration","setShowCalibration","setCalibrationSkipped","map","setPlayerCalibrations","hostRef","useRef","startNowRef","closeRef","prevActiveElement","mountedRef","useEffect","prev","next","allPlayersSkipped","appRoot","t","s","onKey","e","calibs","H","imageSize","locked","useCalibration","res","data","err","stats","useMemo","avg3","getAllTimeAvg","best9","getAllTimeFirstNineAvg","bestCheckout","getAllTimeBestCheckout","bestLeg","getAllTimeBestLeg","all","getAllTime","career180s","getAllTime180s","match180s","L","v","one80s","portalElRef","useLayoutEffect","el","o","getScaleFor","overlay","FocusLock","st","createPortal","Fragment","id"],"mappings":"8IAGA,SAAwBA,GAAiB,CACvC,QAAAC,EACA,mBAAAC,EACA,mBAAAC,EACA,OAAAC,EACA,iBAAAC,EACA,QAAAC,CACF,EAOG,CACD,MAAMC,EAAiBN,EAAQ,OAAQO,GAAML,EAAmBK,EAAE,EAAE,CAAC,EAC/DC,EAAmBR,EAAQ,OAAQO,GAAM,CAACL,EAAmBK,EAAE,EAAE,CAAC,EAClEE,EAAgBD,EAAiB,SAAW,EAElD,aACG,MAAA,CAAI,UAAU,sEACb,SAAAE,EAAAA,KAAC,MAAA,CAAI,UAAU,wEACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,qCAAqC,SAAA,oBAEnD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,sCAAsC,SAAA,wGAGnD,EACCL,EAAe,OAAS,GAAKE,EAAiB,OAAS,GACtDG,EAAAA,IAAC,MAAA,CAAI,UAAU,4DACb,SAAAD,EAAAA,KAAC,IAAA,CAAE,UAAU,wBACV,SAAA,CAAAJ,EAAe,IAAKC,GAAMA,EAAE,IAAI,EAAE,KAAK,IAAI,EAAG,IAC9CD,EAAe,SAAW,EAAI,MAAQ,OAAO,mBAAiB,IAC9DE,EAAiB,IAAKD,GAAMA,EAAE,IAAI,EAAE,KAAK,IAAI,EAAE,mCAAA,CAAA,CAElD,CAAA,CACF,QAED,MAAA,CAAI,UAAU,YACZ,SAAAP,EAAQ,IAAKY,GACZF,EAAAA,KAAC,MAAA,CAEC,UAAU,mEAEV,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,sIACZ,SAAAC,EAAO,KACL,MAAM,GAAG,EACT,IAAKC,GAAMA,EAAE,CAAC,CAAC,EACf,KAAK,EAAE,EACP,cACA,MAAM,EAAG,CAAC,CAAA,CACf,EACAF,EAAAA,IAAC,OACC,SAAAA,EAAAA,IAAC,MAAA,CAAI,UAAU,cAAe,SAAAC,EAAO,KAAK,CAAA,CAC5C,CAAA,EACF,EACAF,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,UAAU,uBACV,QAAS,IAAMP,EAAiBQ,EAAO,EAAE,EAC1C,SAAA,SAAA,CAAA,EAGDD,EAAAA,IAAC,SAAA,CACC,UAAU,yBACV,QAAS,IAAMR,EAAOS,EAAO,EAAE,EAC/B,SAAU,CAAC,CAACV,EAAmBU,EAAO,EAAE,EAEvC,SAAAV,EAAmBU,EAAO,EAAE,EAAI,YAAc,MAAA,CAAA,CACjD,CAAA,CACF,CAAA,CAAA,EA9BKA,EAAO,EAAA,CAgCf,EACH,EACAD,EAAAA,IAAC,MAAA,CAAI,UAAU,iCACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAW,OAAOF,EAAgB,cAAgB,yCAAyC,GAC3F,SAAU,CAACA,EACX,QAASJ,EACV,SAAA,aAAA,CAAA,CAED,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAEJ,CC9EA,SAASS,EAAU,CACjB,MAAAC,EACA,MAAAC,EACA,UAAAC,EAAY,GACZ,MAAAC,EAAQ,CACV,EAKG,CACD,OACER,EAAAA,KAAC,MAAA,CAAI,UAAW,oCAAoCO,CAAS,GAC3D,SAAA,CAAAN,EAAAA,IAAC,MAAA,CAAI,UAAU,qBAAsB,SAAAI,EAAM,EAC3CJ,EAAAA,IAAC,MAAA,CACC,UAAU,sFACV,MAAO,CAAE,UAAW,SAASO,CAAK,GAAA,EAEjC,SAAAF,CAAA,CAAA,CACH,EACF,CAEJ,CA+EA,SAAwBG,GAAmB,CACzC,KAAAC,EAAO,GACP,QAAApB,EACA,KAAAqB,EACA,OAAAC,EACA,eAAAC,EACA,eAAAC,EAAiB,GACjB,OAAAC,EACA,SAAAC,EACA,QAAAC,EAAU,CAAA,EACV,WAAAC,EAAa,GACb,YAAAC,EACA,uBAAAC,EAAyB,GACzB,gBAAAC,EAAkB,EACpB,EAcG,CAED,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAASV,GAAkB,EAAE,EACrD,CAACW,GAAYC,CAAa,EAAIF,EAAAA,SAAS,CAAC,EAExCG,EAAU,CAAC,CAACjB,EACZ,CAACkB,EAAiBC,CAAkB,EAAIL,EAAAA,SAAS,EAAK,EACtD,CAAChC,EAAoBsC,CAAqB,EAAIN,EAAAA,SAEjD,IAAM,CACP,MAAMO,EAAgC,CAAA,EACtC,GAAI,CAACX,EACH,UAAWvB,KAAKP,EAASyC,EAAIlC,EAAE,EAAE,EAAI,GAEvC,OAAOkC,CACT,CAAC,EACK,CAACxC,EAAoByC,CAAqB,EAAIR,EAAAA,SAEjD,CAAA,CAAE,EACCS,EAAUC,EAAAA,OAA8B,IAAI,EAC5CC,EAAcD,EAAAA,OAAiC,IAAI,EACnDE,EAAWF,EAAAA,OAAiC,IAAI,EAChDG,EAAoBH,EAAAA,OAA2B,IAAI,EAEnDI,EAAaJ,EAAAA,OAAO,EAAK,EAE/BK,EAAAA,UAAU,KAERD,EAAW,QAAU,GACd,IAAM,CACXA,EAAW,QAAU,EACvB,GACC,CAAA,CAAE,EAGLC,EAAAA,UAAU,IAAM,CACTnB,GACHU,EAAuBU,GAAS,CAC9B,MAAMC,EAAO,CAAE,GAAGD,CAAA,EAClB,UAAW3C,KAAKP,EAAcmD,EAAK5C,EAAE,EAAE,IAAG4C,EAAK5C,EAAE,EAAE,EAAI,IACvD,OAAO4C,CACT,CAAC,CAEL,EAAG,CAACnD,EAAS8B,CAAsB,CAAC,EAEpC,MAAMsB,EAAoBpD,EAAQ,MAAOO,GAAML,EAAmBK,EAAE,EAAE,CAAC,EAKvE0C,EAAAA,UAAU,IAAM,CACd,GAAI,CAACZ,EAAS,OAGd,GAAI,CACF,WAAW,IAAM,CACf,GAAI,CACFQ,EAAY,SAAS,MAAA,CACvB,MAAQ,CAAC,CACX,EAAG,CAAC,CACN,MAAQ,CAAC,CAET,GAAI,CACFE,EAAkB,QAAU,SAAS,aACvC,MAAQ,CAAC,CAET,MAAMM,EAAU,SAAS,eAAe,MAAM,EACdA,GAC5BA,EAAQ,aAAa,aAAa,EAEtC,GAAI,CACEA,GAASA,EAAQ,aAAa,cAAe,MAAM,CACzD,MAAQ,CAAC,CACT,MAAMC,EAAIF,EACN,YAAY,IAAMnB,EAAYsB,GAAMA,EAAI,CAAC,EAAG,GAAI,EAChD,KACEC,EAASC,GAAqB,CAClC,GAAKT,EAAW,SACZ,CAACjB,IAAoB0B,EAAE,MAAQ,UAAYA,EAAE,MAAQ,OAAQ,CAC/DA,EAAE,eAAA,EAEF,GAAI,CACF,WAAW,IAAM,CACf,GAAI,CACFlC,IAAA,CACF,MAAQ,CAAC,CACX,EAAG,CAAC,CACN,MAAQ,CAAC,CACT,GAAI,CACFwB,EAAkB,SAAS,MAAA,CAC7B,MAAQ,CAAC,CACX,CACF,EACA,gBAAS,iBAAiB,UAAWS,CAAK,EAEnC,IAAM,CAEX,GAAI,CACEH,GACFA,EAAQ,gBAAgB,aAAa,CAEzC,MAAQ,CAAC,CACLC,iBAAiBA,CAAC,EACtB,SAAS,oBAAoB,UAAWE,CAAK,CAC/C,CACF,EAAG,CAACnB,EAASf,EAAQ8B,CAAiB,CAAC,EAEvCH,EAAAA,UAAU,IAAM,CACTZ,IAGHP,GACAE,KAAaR,GAAkB,KAC/B,CAACc,IAEDC,EAAmB,EAAI,GAEG,SAAY,CACpC,MAAMmB,EAAwC,CAAA,EAC9C,UAAW9C,KAAUZ,EACnB,GAAIqB,GAAM,UAAYT,EAAO,OAASS,EAAK,SAAU,CAEnD,KAAM,CAAE,EAAAsC,EAAG,UAAAC,EAAW,OAAAC,CAAA,EAAWC,GAAe,SAAA,EAC5CH,GAAKE,IAAQH,EAAO9C,EAAO,IAAI,EAAI,CAAE,EAAA+C,EAAG,UAAAC,EAAW,OAAAC,CAAA,EACzD,KAEE,IAAI,CACF,MAAME,EAAM,MAAM,MAChB,cAAc,mBAAmBnD,EAAO,IAAI,CAAC,cAAA,EAE/C,GAAImD,EAAI,GAAI,CACV,MAAMC,EAAO,MAAMD,EAAI,KAAA,EACnBC,EAAK,cAAaN,EAAO9C,EAAO,IAAI,EAAIoD,EAAK,YACnD,CACF,OAASC,EAAK,CACZ,QAAQ,KAAK,kCAAmCrD,EAAO,KAAMqD,CAAG,CAClE,CAGJvB,EAAsBgB,CAAM,CAC9B,GACA,GAGEN,IACEpB,GAAW,GAAKA,EAAU,GAC5BI,EAAemB,GAAMA,EAAI,EAAG,EAE1BvB,GAAW,GAGb,WAAW,IAAM,CAGf,GAAI,CACFV,IAAA,CACF,MAAQ,CAAC,CACT,GAAI,CACF,WAAW,IAAM,CACf,GAAI,CACFC,IAAA,CACF,MAAQ,CAAC,CACX,EAAG,CAAC,CACN,MAAQ,CAAC,CAET,GAAI,CACFwB,EAAkB,SAAS,MAAA,CAC7B,MAAQ,CAAC,CACX,EAAG,GAAI,GAGb,EAAG,CACDf,EACAV,EACAe,EACAC,EACAc,EACApD,EACAqB,CAAA,CACD,EAED,MAAM6C,EAAQC,EAAAA,QACZ,IACEnE,EAAQ,IAAKO,GAAM,CACjB,GAAI,CACF,MAAM6D,EAAOC,EAAc9D,EAAE,IAAI,EAC3B+D,EAAQC,EAAuBhE,EAAE,IAAI,EACrCiE,EAAeC,EAAuBlE,EAAE,IAAI,EAC5CmE,EAAUC,EAAkBpE,EAAE,IAAI,EAClCqE,EAAMC,EAAWtE,EAAE,IAAI,EACvBuE,EAAaC,EAAexE,EAAE,IAAI,EAExC,IAAIyE,EAAY,EAChB,GAAI,CACF,UAAWC,KAAK1E,EAAE,MAAQ,CAAA,EACxB,UAAW2E,KAAKD,EAAE,QAAU,CAAA,EACtB,OAAOC,EAAE,OAAS,CAAC,IAAM,MAAKF,GAAa,EAGrD,MAAQ,CAAC,CACT,MAAMG,EAAS,GAAGH,CAAS,IAAIF,CAAU,GACzC,MAAO,CACL,GAAIvE,EAAE,GACN,KAAMA,EAAE,KACR,KAAM6D,EAAK,QAAQ,CAAC,EACpB,MAAOE,EAAM,QAAQ,CAAC,EACtB,aAAAE,EACA,QAAAE,EACA,OAAAS,CAAA,CAEJ,MAAc,CAEZ,MAAO,CACL,GAAI5E,EAAE,GACN,KAAMA,EAAE,KACR,KAAM,IACN,MAAO,IACP,aAAc,IACd,QAAS,IACT,OAAQ,GAAA,CAEZ,CACF,CAAC,EACH,CAACP,CAAO,CAAA,EAGJoF,EAAcxC,EAAAA,OAClB,OAAO,SAAa,IAAc,SAAS,cAAc,KAAK,EAAI,IAAA,EAwBpE,GAtBAyC,EAAAA,gBAAgB,IAAM,CACpB,GAAI,CAACD,EAAY,QAAS,OAC1B,MAAME,EAAKF,EAAY,QACvBE,EAAG,UAAY,yBACf,GAAI,CACU,MAAM,KAChB,SAAS,iBAAiB,yBAAyB,CAAA,EAEjD,QAASC,GAAM,CACjB,GAAI,CACFA,EAAE,YAAY,YAAYA,CAAC,CAC7B,MAAQ,CAAC,CACX,CAAC,CACH,MAAQ,CAAC,CACT,gBAAS,KAAK,YAAYD,CAAE,EACrB,IAAM,CACX,GAAI,CACEA,GAAMA,EAAG,YAAYA,EAAG,WAAW,YAAYA,CAAE,CACvD,MAAQ,CAAC,CACX,CACF,EAAG,CAAA,CAAE,EAED,CAACjD,EAAS,OAAO,KAIrB,MAAMmD,EAAejC,GACfA,GAAK,EAAU,IACfA,IAAM,EAAU,IAChBA,IAAM,EAAU,IAChBA,IAAM,EAAU,IACb,EAGHkC,EACJ9E,EAAAA,IAAC,MAAA,CAAI,UAAU,sEACb,SAAAA,EAAAA,IAAC,MAAA,CACC,KAAK,SACL,aAAW,OACX,kBAAgB,sBAChB,SAAU,GAEV,SAAAA,EAAAA,IAAC+E,EAAA,CAAU,YAAa,GACtB,SAAA/E,EAAAA,IAAC,MAAA,CAAI,IAAKgC,EACR,SAAAjC,EAAAA,KAAC,MAAA,CAAI,UAAU,yGACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CACC,GAAG,sBACH,UAAU,gCACX,SAAA,qBAAA,CAAA,EAGDD,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CACC,UAAU,2CACV,YAAU,SAET,SAAAqB,EAAU,EAAIA,EAAU,IAAA,CAAA,EAE3BtB,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,IAAKkC,EACL,UAAU,aACV,QAAS,IAAM,CACb,GAAI,CACFvB,IAAA,CACF,MAAQ,CAAC,CACT,GAAI,CACF,GAAI,CACF,SACG,eAAe,MAAM,GACpB,gBAAgB,aAAa,CACnC,MAAQ,CAAC,CACT,WAAW,IAAM,CACf,GAAI,CACFC,IAAA,CACF,MAAQ,CAAC,CACX,EAAG,CAAC,CACN,MAAQ,CAAC,CACX,EACA,aAAW,kBACZ,SAAA,WAAA,CAAA,EAGDZ,EAAAA,IAAC,SAAA,CACC,IAAKmC,EACL,UAAU,uBACV,QAAS,IAAM,CACb,GAAI,CACFxB,IAAA,CACF,MAAQ,CAAC,CACT,GAAI,CACF,SACG,eAAe,MAAM,GACpB,gBAAgB,aAAa,CACnC,MAAQ,CAAC,CACT,GAAI,CACF,WAAW,IAAM,CACf,GAAI,CACFC,IAAA,CACF,MAAQ,CAAC,CACX,EAAG,CAAC,CACN,MAAQ,CAAC,CACX,EACA,aAAW,6BACZ,SAAA,OAAA,CAAA,CAED,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,QACC,MAAA,CAAI,UAAU,6CACZ,SAAA2C,EAAM,IAAKyB,GACVjF,EAAAA,KAAC,MAAA,CAEC,UAAU,yFAEV,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,sJACZ,SAAAgF,EAAG,KACD,MAAM,GAAG,EACT,IAAK9E,GAAMA,EAAE,CAAC,CAAC,EACf,KAAK,EAAE,EACP,cACA,MAAM,EAAG,CAAC,CAAA,CACf,EACAF,EAAAA,IAAC,MAAA,CAAI,UAAU,yCACZ,WAAG,KACN,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gCACb,SAAA,CAAAC,EAAAA,IAACG,EAAA,CACC,MAAM,aACN,MAAO6E,EAAG,KACV,MAAOH,EAAYxD,CAAO,CAAA,CAAA,EAE5BrB,EAAAA,IAACG,EAAA,CACC,MAAM,cACN,MAAO6E,EAAG,MACV,MAAOH,EAAYxD,CAAO,CAAA,CAAA,EAE5BrB,EAAAA,IAACG,EAAA,CACC,MAAM,gBACN,MAAO6E,EAAG,cAAgB,IAC1B,MAAOH,EAAYxD,CAAO,CAAA,CAAA,EAE5BrB,EAAAA,IAACG,EAAA,CACC,MAAM,WACN,MAAO6E,EAAG,SAAW,IACrB,MAAOH,EAAYxD,CAAO,CAAA,CAAA,CAC5B,EACF,EACAtB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,CAAA,0BACfiF,EAAG,MAAA,CAAA,CAC7B,CAAA,CAAA,EAtCKA,EAAG,EAAA,CAwCX,EACH,EACAhF,EAAAA,IAAC,MAAA,CAAI,UAAU,cACZ,SAAAqB,GAAW,EACVrB,EAAAA,IAAC,MAAA,CAAI,UAAU,sCAAsC,SAAA,yBAAA,CAErD,EAEAA,EAAAA,IAAC,OAAI,UAAU,qBACZ,SAAAX,EAAQ,IAAKO,GAAMA,EAAE,IAAI,EAAE,KAAK,MAAM,CAAA,CACzC,CAAA,CAEJ,CAAA,CAAA,CACF,EACF,CAAA,CACF,CAAA,CAAA,EAEJ,EAEF,OAAOqF,GAAAA,aACLlF,OAAAmF,EAAAA,SAAA,CACG,SAAA,CAAAvD,GACC3B,EAAAA,IAACZ,GAAA,CACC,QAAAC,EACA,mBAAAC,EACA,mBAAAC,EACA,OAAS4F,GACPtD,EAAuBU,IAAU,CAAE,GAAGA,EAAM,CAAC4C,CAAE,EAAG,IAAO,EAE3D,iBAAmBA,GAAe,CAChC,GAAI,CACF,OAAO,cACL,IAAI,YAAY,iBAAkB,CAChC,OAAQ,CAAE,IAAK,WAAA,CAAY,CAC5B,CAAA,CAEL,MAAQ,CAAC,CAET,GAAI,CACF,WAAW,IAAM,CACf,GAAI,CACFvE,IAAA,CACF,MAAQ,CAAC,CACX,EAAG,CAAC,CACN,MAAQ,CAAC,CACX,EACA,QAAS,IAAM,CACbgB,EAAmB,EAAK,CAC1B,CAAA,CAAA,EAGHkD,CAAA,EACH,EACAL,EAAY,OAAA,CAEhB"}
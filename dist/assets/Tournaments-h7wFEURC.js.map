{"version":3,"file":"Tournaments-h7wFEURC.js","sources":["../../src/components/MatchCard.tsx","../../src/components/Tournaments.tsx"],"sourcesContent":["import React from \"react\";\nimport { labelForMode, type ModeKey } from \"../utils/games\";\n\ntype Tournament = {\n  id: string;\n  title: string;\n  game: string;\n  mode: ModeKey;\n  value: number;\n  startAt: number;\n  capacity: number;\n  participants: { email: string; username: string }[];\n  creatorName?: string;\n  creatorEmail?: string;\n  official?: boolean;\n};\n\nexport default function MatchCard({\n  t,\n  onJoin,\n  onLeave,\n  joined,\n  disabled,\n}: {\n  t: Tournament;\n  onJoin?: (t: any) => void;\n  onLeave?: (t: any) => void;\n  joined?: boolean;\n  disabled?: boolean;\n}) {\n  return (\n    <li className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\">\n      <div className=\"space-y-0.5\">\n        <div className=\"font-semibold\">\n          {t.title}\n          {t.official && (\n            <span className=\"ml-2 inline-flex items-center px-2 py-0.5 rounded bg-amber-500 text-black text-xs\">\n              Official\n            </span>\n          )}\n        </div>\n        <div className=\"text-sm opacity-80\">\n          {t.game}\n          {t.game === \"X01\" ? `/501` : \"\"} ¬∑ {labelForMode(t.mode)} {t.value} ¬∑{\" \"}\n          {new Date(t.startAt).toLocaleString()} ¬∑ Cap {t.capacity} ¬∑ Joined{\" \"}\n          {t.participants?.length || 0}\n        </div>\n        <div className=\"text-xs opacity-60 mt-1\">\n          Created by: {t.creatorName || t.creatorEmail || \"Unknown\"}\n        </div>\n      </div>\n      <div className=\"flex items-center gap-2\">\n        <button\n          className={`btn ${joined ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n          disabled={disabled}\n          onClick={() => (joined ? onLeave && onLeave(t) : onJoin && onJoin(t))}\n        >\n          {joined ? \"Already Joined! ‚úÖ\" : \"Join Now ‚öîÔ∏è\"}\n        </button>\n      </div>\n    </li>\n  );\n}\n","import { useEffect, useMemo, useState, useRef } from \"react\";\nimport {\n  getModeOptionsForGame,\n  labelForMode,\n  type ModeKey,\n} from \"../utils/games\";\nimport { useMatch } from \"../store/match\";\nimport MatchCard from \"./MatchCard\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase\";\nimport { useToast } from \"../store/toast\";\nimport { useWS } from \"./WSProvider\";\nimport { apiFetch } from \"../utils/api\";\nimport { useUserSettings } from \"../store/userSettings\";\nimport { launchInPlayDemo } from \"../utils/inPlayDemo\";\nimport { openMatchWindow } from \"../utils/matchWindow\";\n\ntype Tournament = {\n  id: string;\n  title: string;\n  game: string;\n  mode: ModeKey;\n  value: number;\n  description: string;\n  startAt: number;\n  checkinMinutes: number;\n  capacity: number;\n  participants: { email: string; username: string }[];\n  official?: boolean;\n  prize?: boolean;\n  prizeType?: \"premium\" | \"none\";\n  status: \"scheduled\" | \"running\" | \"completed\";\n  winnerEmail?: string | null;\n  startingScore?: number;\n  creatorEmail?: string;\n  creatorName?: string;\n};\n\nconst containsIntegrationMarker = (value: unknown) => {\n  if (typeof value === \"string\") {\n    return value.toLowerCase().includes(\"integration\");\n  }\n  if (typeof value === \"number\") {\n    return value.toString().toLowerCase().includes(\"integration\");\n  }\n  return false;\n};\n\nconst isIntegrationTournament = (t: Tournament) => {\n  if (!t) return false;\n  const candidates = [t.title, t.description, t.creatorName, t.creatorEmail];\n  return candidates.some((value) => containsIntegrationMarker(value));\n};\n\nconst isTouch =\n  typeof window !== \"undefined\" &&\n  (\"ontouchstart\" in window || navigator.maxTouchPoints > 0);\n\nexport default function Tournaments({ user }: { user: any }) {\n  const toast = useToast();\n  const wsGlobal = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  // Persisted match preferences (used when creating or joining)\n  const {\n    matchType: _matchType = \"singles\",\n    setMatchType: _setMatchType,\n    teamAName: _teamAName = \"Team A\",\n    setTeamAName: _setTeamAName,\n    teamBName: _teamBName = \"Team B\",\n    setTeamBName: _setTeamBName,\n  } = useUserSettings();\n  const [list, setList] = useState<Tournament[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [errorMsg, setErrorMsg] = useState(\"\");\n  const [_fetchError, setFetchError] = useState<string | null>(null);\n  const [lastRefresh, setLastRefresh] = useState<number | null>(null);\n  const [cooldownUntil, setCooldownUntil] = useState<number | null>(null);\n  const [showCreate, setShowCreate] = useState(false);\n  const [showDemoStart, setShowDemoStart] = useState(false);\n  const [showStartShowcase, setShowStartShowcase] = useState(false);\n  const _startedShowcasedRef = useRef(false);\n\n  const inProgress = useMatch((s) => s.inProgress);\n  const roomId = useMatch((s) => s.roomId);\n\n  useEffect(() => {\n    if (!inProgress) return;\n    try {\n      const st = useMatch.getState();\n      const game = ((st as any)?.game || \"X01\") as string;\n      if (game !== \"X01\") return;\n      if (!st.roomId) return;\n      const flagKey = `ndn:matchWindowOpened:${st.roomId}`;\n      if (window.sessionStorage.getItem(flagKey) === \"1\") return;\n      window.sessionStorage.setItem(flagKey, \"1\");\n      openMatchWindow();\n    } catch {}\n  }, [inProgress, roomId]);\n\n  const [form, setForm] = useState({\n    title: \"\",\n    game: \"X01\",\n    mode: \"501\",\n    value: 0,\n    description: \"\",\n    startAt: new Date().toISOString().slice(0, 16),\n    checkinMinutes: 15,\n    capacity: 16,\n    startingScore: 501,\n    requireCalibration: false,\n  });\n\n  // Prestart / Bull Up Logic for Tournaments\n  const [joinMatch, setJoinMatch] = useState<any>(null);\n  const [joinTimer, setJoinTimer] = useState(30);\n  const [joinChoice, setJoinChoice] = useState<\"bull\" | \"skip\" | null>(null);\n  const [remoteChoices, setRemoteChoices] = useState<Record<string, string>>(\n    {},\n  );\n  const [_bullActive, setBullActive] = useState(false);\n  const [_bullThrown, setBullThrown] = useState(false);\n  const [_bullLocalThrow, setBullLocalThrow] = useState<any>(null);\n  const [_bullWinner, setBullWinner] = useState<string | null>(null);\n  const [leaveAsk, setLeaveAsk] = useState<{\n    open: boolean;\n    t: Tournament | null;\n  }>({ open: false, t: null });\n  const [deleteConfirm, setDeleteConfirm] = useState<{\n    open: boolean;\n    t: Tournament | null;\n  }>({ open: false, t: null });\n  const serverPrestartRef = useRef(false);\n  const _joinAcceptRef = useRef<HTMLButtonElement>(null);\n  const [participants, setParticipants] = useState<Record<string, string>>({});\n\n  // Listen for match-prestart events (same as OnlinePlay)\n  useEffect(() => {\n    if (!wsGlobal) return;\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg?.type === \"match-prestart\") {\n          // Someone accepted the invite; show prestart and update join match if it matches\n          const m = msg.match || null;\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\n          // Ensure we know the creator's username\n          try {\n            if (m?.creatorId && m?.creatorName)\n              setParticipants((prev) => ({\n                ...prev,\n                [m.creatorId]: m.creatorName,\n              }));\n          } catch {}\n          serverPrestartRef.current = true;\n          setJoinMatch(m);\n          const endsAt = msg.prestartEndsAt || Date.now();\n          setJoinTimer(\n            Math.max(\n              0,\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\n            ),\n          );\n          setTimeout(() => {\n            serverPrestartRef.current = false;\n          }, 0);\n          // reset diffuse state\n          setJoinChoice(null);\n          setRemoteChoices({});\n          setBullActive(false);\n          setBullThrown(false);\n          setBullWinner(null);\n        }\n        if (msg?.type === \"match-start\") {\n          // If the started match matches our current join request, close the modal\n          if (joinMatch && msg.roomId === joinMatch.id) {\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setRemoteChoices({});\n          }\n        }\n        if (msg?.type === \"prestart-choice-notify\") {\n          const { roomId, playerId, choice } = msg;\n          if (!roomId || !choice) return;\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\n        }\n        if (msg?.type === \"prestart-bull\") {\n          setBullActive(true);\n          setBullThrown(false);\n          setBullLocalThrow(null);\n        }\n        if (msg?.type === \"prestart-bull-winner\") {\n          setBullWinner(msg.winnerId || null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n        if (msg?.type === \"prestart-bull-tie\") {\n          // reset to allow another round\n          setBullWinner(null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n      } catch (err) {}\n    });\n    return unsub;\n  }, [wsGlobal, joinChoice, joinMatch]);\n\n  // Join timer\n  useEffect(() => {\n    if (!joinMatch) return;\n    if (serverPrestartRef.current) return;\n    // If a server-supplied prestart exists, do not override joinTimer\n    if ((joinMatch as any).prestartEndsAt) return;\n    setJoinTimer(30);\n    setJoinChoice(null);\n    setRemoteChoices({});\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\n    return () => clearInterval(t);\n  }, [joinMatch]);\n\n  // Watch for match start (inProgress)\n  const match = useMatch((s) => ({\n    players: s.players,\n    currentPlayerIdx: s.currentPlayerIdx,\n    roomId: s.roomId,\n  }));\n  useEffect(() => {\n    if (!inProgress) return;\n    setShowStartShowcase(true);\n  }, [inProgress]);\n\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\n    setJoinChoice(choice);\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"prestart-choice\",\n          roomId: joinMatch.id,\n          choice,\n        });\n      }\n    } catch {}\n  };\n\n  async function refresh() {\n    try {\n      // Avoid multiple quick refreshes which can cause load spikes\n      if (lastRefresh && Date.now() - lastRefresh < 3000) return;\n      const res = await apiFetch(\"/api/tournaments\");\n      const data = await res.json();\n      const newList = Array.isArray(data.tournaments) ? data.tournaments : [];\n      setList(newList);\n      try {\n        console.debug(\n          \"[Tournaments] refresh fetched\",\n          newList.length,\n          \"tournaments\",\n        );\n        console.log(\"[Tournaments] fetched list:\", newList);\n      } catch {}\n      setFetchError(null);\n      setLastRefresh(Date.now());\n    } catch (err: any) {\n      try {\n        if (typeof window !== \"undefined\") {\n          setFetchError(String(err?.message || err));\n        }\n      } catch {\n        if (typeof window !== \"undefined\") {\n          setFetchError(\"unknown\");\n        }\n      }\n    }\n  }\n  useEffect(() => {\n    refresh();\n  }, []);\n\n  // Re-fetch tournaments when we have a fresh WS connection so clients resync after reconnects/server restarts\n  useEffect(() => {\n    try {\n      if (wsGlobal?.connected) refresh();\n    } catch {}\n  }, [wsGlobal?.connected]);\n\n  // Listen for WS push updates from global provider if available\n  useEffect(() => {\n    if (!wsGlobal) return;\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg.type === \"tournaments\") {\n          setList(msg.tournaments || []);\n          setLastRefresh(Date.now());\n        }\n        if (msg.type === \"tournaments\") {\n          try {\n            console.debug(\n              \"[Tournaments] WS tournaments update, num=\",\n              (msg.tournaments || []).length,\n            );\n          } catch {}\n        }\n        if (msg.type === \"tournament-win\" && msg.message) {\n          toast(msg.message, { type: \"success\", timeout: 10000 }); // Show for 10 seconds\n        }\n        // tournament-reminder handled optionally here if desired\n      } catch {}\n    });\n    return () => {\n      unsub();\n    };\n  }, [wsGlobal?.connected]);\n\n  // If WS connects, ask for a fresh list via WS; this will prompt server to send a tournaments snapshot.\n  useEffect(() => {\n    try {\n      if (wsGlobal?.connected) {\n        try {\n          wsGlobal.send({ type: \"list-tournaments\" });\n        } catch {}\n        // Also ensure we refresh as a fallback\n        refresh();\n      }\n    } catch {}\n  }, [wsGlobal?.connected]);\n\n  // Polling fallback: if WS is unavailable, poll the API every 10s to keep lobby up-to-date\n  useEffect(() => {\n    let iv: number | null = null;\n    try {\n      if (!wsGlobal || !wsGlobal.connected) {\n        iv = window.setInterval(() => {\n          refresh();\n        }, 10000);\n      }\n    } catch {}\n    return () => {\n      if (iv) clearInterval(iv);\n    };\n  }, [wsGlobal?.connected]);\n\n  const email = String(user?.email || \"\").toLowerCase();\n  const showDemoControls =\n    (import.meta as any).env?.DEV || email === \"daviesfamily108@gmail.com\";\n\n  const runTournamentInPlayDemo = () => {\n    launchInPlayDemo({\n      players: [\"Tournament A\", \"Tournament B\"],\n      startingScore: 501,\n      roomId: \"tournament-demo\",\n      visits: [{ score: 45 }, { score: 81 }, { score: 140 }],\n    });\n  };\n\n  const hasJoined = (t: Tournament | null | undefined) => {\n    if (!t || !email) return false;\n    const ps = Array.isArray(t.participants) ? t.participants : [];\n    return ps.some((p) => String(p?.email || \"\").toLowerCase() === email);\n  };\n\n  // Simple, persistent match preference UI\n  const MatchPrefs = () => (\n    <div className=\"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap\">\n      <span className=\"opacity-70\">Default match</span>\n      <span className=\"btn py-1 px-2 bg-indigo-500/30 border border-indigo-400/50 text-indigo-100\">\n        Singles\n      </span>\n      <span className=\"text-xs opacity-60 ml-2\">\n        (tournaments use Singles only)\n      </span>\n    </div>\n  );\n  // Fetch subscription to detect if user is a recent tournament winner (cooldown)\n  useEffect(() => {\n    let abort = false;\n    async function check() {\n      if (!email) {\n        setCooldownUntil(null);\n        return;\n      }\n      try {\n        const res = await apiFetch(\n          `/api/subscription?email=${encodeURIComponent(email)}`,\n        );\n        const data = await res.json();\n        if (!abort) {\n          if (\n            data?.source === \"tournament\" &&\n            typeof data.expiresAt === \"number\" &&\n            data.expiresAt > Date.now()\n          ) {\n            setCooldownUntil(data.expiresAt);\n          } else {\n            setCooldownUntil(null);\n          }\n        }\n      } catch {\n        if (!abort) setCooldownUntil(null);\n      }\n    }\n    check();\n    return () => {\n      abort = true;\n    };\n  }, [email]);\n\n  // Helper to delete a tournament with proper error handling and owner fallback\n  async function deleteTournament(t: Tournament) {\n    if (!email) return;\n    setDeleteConfirm({ open: true, t });\n  }\n\n  async function confirmDeleteTournament() {\n    const t = deleteConfirm.t;\n    if (!t || !email) return;\n    setDeleteConfirm({ open: false, t: null });\n    setLoading(true);\n    try {\n      // First try creator/owner shared endpoint\n      let res = await apiFetch(\"/api/tournaments/delete\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ tournamentId: t.id, requesterEmail: email }),\n      });\n\n      // If forbidden but user is the owner, try the admin endpoint as a fallback\n      if (\n        !res.ok &&\n        res.status === 403 &&\n        String(email) === \"daviesfamily108@gmail.com\"\n      ) {\n        res = await apiFetch(\"/api/admin/tournaments/delete\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ tournamentId: t.id, requesterEmail: email }),\n        });\n      }\n\n      if (!res.ok) {\n        let msg = \"Delete failed\";\n        try {\n          const data = await res.json();\n          if (data?.error) msg = `Delete failed: ${String(data.error)}`;\n        } catch {}\n        toast(msg, { type: \"error\" });\n        return;\n      }\n\n      toast(\"Tournament deleted\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function join(t: Tournament) {\n    if (!email) return;\n    setLoading(true);\n    try {\n      const res = await apiFetch(\"/api/tournaments/join\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          tournamentId: t.id,\n          email,\n          username: user?.username,\n        }),\n      });\n      if (!res.ok) {\n        let data: any = {};\n        try {\n          data = await res.json();\n        } catch {}\n        if (\n          data?.error === \"WINNER_COOLDOWN\" &&\n          typeof data.until === \"number\"\n        ) {\n          setErrorMsg(\n            `You're a recent NDN tournament winner. You can re-enter after ${fmt(data.until)}.`,\n          );\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          toast(\"Join blocked: winner cooldown active\", { type: \"error\" });\n        } else if (data?.error === \"ALREADY_IN_TOURNAMENT\") {\n          setErrorMsg(\n            String(\n              data.message || \"You can only join one tournament at a time.\",\n            ),\n          );\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          toast(\"Join blocked: already in another tournament\", {\n            type: \"error\",\n          });\n        } else if (data?.error) {\n          setErrorMsg(String(data.error));\n          setTimeout(() => setErrorMsg(\"\"), 3500);\n          toast(`Join failed: ${String(data.error)}`, { type: \"error\" });\n        }\n        return;\n      }\n      toast(\"Joined tournament\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function leave(t: Tournament) {\n    if (!email) return;\n    setLoading(true);\n    try {\n      const res = await apiFetch(\"/api/tournaments/leave\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ tournamentId: t.id, email }),\n      });\n      if (!res.ok) {\n        let data: any = {};\n        try {\n          data = await res.json();\n        } catch {}\n        if (data?.error) {\n          toast(`Leave failed: ${String(data.error)}`, { type: \"error\" });\n        } else if (res.status === 404) {\n          toast(\n            \"Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.\",\n            { type: \"error\" },\n          );\n        } else {\n          toast(\"Leave failed. Please try again.\", { type: \"error\" });\n        }\n        return;\n      }\n      toast(\"Left tournament\", { type: \"success\" });\n      // Optimistic local update\n      setList((prev) =>\n        prev.map((it) =>\n          it.id === t.id\n            ? {\n                ...it,\n                participants: (it.participants || []).filter(\n                  (p) => p.email !== email,\n                ),\n              }\n            : it,\n        ),\n      );\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function createTournament() {\n    setLoading(true);\n    try {\n      const start = new Date(form.startAt).getTime();\n      const res = await apiFetch(\"/api/tournaments/create\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          title: form.title,\n          game: form.game,\n          mode: form.mode,\n          value: Number(form.value),\n          description: form.description,\n          startAt: start,\n          checkinMinutes: Number(form.checkinMinutes),\n          capacity: Number(form.capacity),\n          startingScore:\n            form.game === \"X01\" ? Number(form.startingScore || 501) : undefined,\n          requireCalibration: !!form.requireCalibration,\n          creatorEmail: user?.email,\n          creatorName: user?.username,\n        }),\n      });\n      if (!res.ok) {\n        let details = \"\";\n        try {\n          const data = await res.json();\n          if (data?.error) details = String(data.error);\n          else if (data?.details) details = String(data.details);\n        } catch {}\n        const msg = details\n          ? `Create failed: ${details}`\n          : \"Create failed. Please try again.\";\n        setErrorMsg(msg);\n        toast(msg, { type: \"error\" });\n        setTimeout(() => setErrorMsg(\"\"), 6000);\n        return;\n      }\n      try {\n        const data = await res.json();\n        if (!data?.ok) {\n          const msg = data?.error\n            ? `Create failed: ${String(data.error)}`\n            : \"Create failed. Please try again.\";\n          setErrorMsg(msg);\n          toast(msg, { type: \"error\" });\n          setTimeout(() => setErrorMsg(\"\"), 6000);\n          return;\n        }\n      } catch {}\n      setShowCreate(false);\n      toast(\"Tournament created\", { type: \"success\" });\n      await refresh();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Close the create modal on Escape\n  useEffect(() => {\n    if (!showCreate) return;\n    const onKey = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") setShowCreate(false);\n    };\n    document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [showCreate]);\n\n  const visibleTournaments = useMemo(\n    () => list.filter((t) => !isIntegrationTournament(t)),\n    [list],\n  );\n  const official = useMemo(\n    () => visibleTournaments.filter((t) => t.official),\n    [visibleTournaments],\n  );\n  const community = useMemo(\n    () => visibleTournaments.filter((t) => !t.official),\n    [visibleTournaments],\n  );\n  const created = useMemo(\n    () =>\n      visibleTournaments.filter((t) => t.status === \"scheduled\" && !t.official),\n    [visibleTournaments],\n  );\n\n  // Pagination for Created Game Lobby\n  const [createdPage, setCreatedPage] = useState(1);\n  const itemsPerPage = 16;\n  const createdTotalPages = Math.ceil(created.length / itemsPerPage);\n  const paginatedCreated = created.slice(\n    (createdPage - 1) * itemsPerPage,\n    createdPage * itemsPerPage,\n  );\n\n  // Pagination for Community List\n  const [communityPage, setCommunityPage] = useState(1);\n  const communityTotalPages = Math.ceil(community.length / itemsPerPage);\n  const paginatedCommunity = community.slice(\n    (communityPage - 1) * itemsPerPage,\n    communityPage * itemsPerPage,\n  );\n\n  const nextOfficial = useMemo(() => {\n    const upcoming = official\n      .filter((t) => t.status === \"scheduled\")\n      .sort((a, b) => a.startAt - b.startAt);\n    return upcoming[0] || null;\n  }, [official]);\n\n  function fmt(ts: number) {\n    const d = new Date(ts);\n    return d.toLocaleString();\n  }\n\n  return (\n    <div className=\"card ndn-game-shell ndn-page\">\n      <div className=\"flex items-center justify-between mb-3\">\n        <h2 className=\"text-2xl font-bold ndn-section-title\">Tournaments üéØ</h2>\n      </div>\n      <div className=\"ndn-shell-body\">\n        {/* Create Tournament + and default match prefs on a single header row */}\n        <div className=\"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap\">\n          <div className=\"min-w-0\">\n            <MatchPrefs />\n          </div>\n          <div className=\"shrink-0\">\n            <button className=\"btn\" onClick={() => setShowCreate(true)}>\n              Create Tournament + üéØ\n            </button>\n            {showDemoControls && (\n              <button\n                className=\"btn btn-ghost ml-2\"\n                onClick={() => setShowDemoStart(true)}\n              >\n                Demo Start Showcase üéØ\n              </button>\n            )}\n            {showDemoControls && (\n              <button\n                className=\"btn btn-ghost ml-2\"\n                onClick={runTournamentInPlayDemo}\n              >\n                Demo In-Game üéÆ\n              </button>\n            )}\n          </div>\n        </div>\n        {/* DEV-only start showcase demo */}\n        {showDemoStart && (\n          <MatchStartShowcase\n            players={[\n              { id: \"0\", name: \"Demo A\", legsWon: 0, legs: [] },\n              { id: \"1\", name: \"Demo B\", legsWon: 0, legs: [] },\n            ]}\n            user={user}\n            onDone={() => setShowDemoStart(false)}\n          />\n        )}\n        {/* Show overlay when a tournament match starts while on the tournaments page */}\n        {showStartShowcase && (\n          <MatchStartShowcase\n            players={(match.players || []) as any}\n            user={user}\n            onDone={() => setShowStartShowcase(false)}\n          />\n        )}\n        <div className=\"mb-2 text-sm font-semibold text-slate-300\">\n          World Lobby\n        </div>\n        {/* Created Game Lobby: show all created tournaments (scheduled) */}\n        <div className=\"mb-3 p-3 rounded-xl border border-slate-700 bg-black/10\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"font-semibold\">Created Game Lobby</div>\n            <div className=\"text-xs opacity-60\">\n              All tournaments created by users and admins\n            </div>\n          </div>\n          <ul className=\"space-y-2\">\n            {created.length === 0 && (\n              <li className=\"text-sm opacity-60\">\n                No created tournaments yet.\n              </li>\n            )}\n            {paginatedCreated.map((t) => (\n              <MatchCard\n                key={t.id}\n                t={t}\n                onJoin={(m) => join(m)}\n                onLeave={(m) => leave(m)}\n                joined={hasJoined(t)}\n                disabled={\n                  loading ||\n                  t.status !== \"scheduled\" ||\n                  (!hasJoined(t) && t.participants.length >= t.capacity)\n                }\n              />\n            ))}\n          </ul>\n          {/* Pagination controls for Created Game Lobby */}\n          {createdTotalPages > 1 && (\n            <div className=\"mt-4 flex items-center justify-between text-sm\">\n              <button\n                className=\"text-slate-300 hover:text-white transition-colors\"\n                onClick={() => setCreatedPage((p) => Math.max(p - 1, 1))}\n                disabled={createdPage === 1}\n              >\n                &larr; Previous\n              </button>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-slate-400\">\n                  Page {createdPage} of {createdTotalPages}\n                </span>\n                <button\n                  className=\"text-slate-300 hover:text-white transition-colors\"\n                  onClick={() =>\n                    setCreatedPage((p) => Math.min(p + 1, createdTotalPages))\n                  }\n                  disabled={createdPage === createdTotalPages}\n                >\n                  Next &rarr;\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n        {/* Persistent banner for next official weekly tournament */}\n        {nextOfficial && (\n          <div className=\"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\n            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2\">\n              <div>\n                <div className=\"text-sm uppercase tracking-wide text-indigo-300 font-semibold\">\n                  Weekly Official Tournament üéØ\n                </div>\n                <div className=\"font-bold\">{nextOfficial.title}</div>\n                <div className=\"text-sm opacity-80\">\n                  {nextOfficial.game}\n                  {nextOfficial.game === \"X01\" && nextOfficial.startingScore\n                    ? `/${nextOfficial.startingScore}`\n                    : \"\"}{\" \"}\n                  ¬∑ {labelForMode(nextOfficial.mode)} {nextOfficial.value} ¬∑\n                  Starts {fmt(nextOfficial.startAt)} ¬∑ Cap{\" \"}\n                  {nextOfficial.capacity} ¬∑ Joined{\" \"}\n                  {nextOfficial.participants.length}\n                </div>\n                {nextOfficial.prize && (\n                  <div className=\"text-xs mt-1\">Prize: 3 months PREMIUM</div>\n                )}\n                {nextOfficial.status !== \"scheduled\" && (\n                  <div className=\"text-xs\">Status: {nextOfficial.status}</div>\n                )}\n                {cooldownUntil && cooldownUntil > Date.now() && (\n                  <div className=\"text-xs text-rose-300\">\n                    Recent winners can re-enter after {fmt(cooldownUntil)}.\n                  </div>\n                )}\n              </div>\n              <div className=\"shrink-0\">\n                <button\n                  className={`btn ${hasJoined(nextOfficial) ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n                  title={\n                    hasJoined(nextOfficial)\n                      ? \"Double-click to leave this tournament\"\n                      : nextOfficial.official &&\n                          cooldownUntil &&\n                          cooldownUntil > Date.now()\n                        ? `Recent winners can re-enter after ${fmt(cooldownUntil)}`\n                        : \"\"\n                  }\n                  disabled={\n                    loading ||\n                    nextOfficial.status !== \"scheduled\" ||\n                    (!hasJoined(nextOfficial) &&\n                      (nextOfficial.participants.length >=\n                        nextOfficial.capacity ||\n                        (!!cooldownUntil && cooldownUntil > Date.now())))\n                  }\n                  onClick={() => {\n                    if (!hasJoined(nextOfficial)) {\n                      join(nextOfficial);\n                    } else if (isTouch) {\n                      setLeaveAsk({ open: true, t: nextOfficial });\n                    }\n                  }}\n                  onDoubleClick={() => {\n                    if (!isTouch && hasJoined(nextOfficial))\n                      setLeaveAsk({ open: true, t: nextOfficial });\n                  }}\n                  aria-label={\n                    hasJoined(nextOfficial) ? \"Already Joined\" : \"Join Now\"\n                  }\n                >\n                  {hasJoined(nextOfficial)\n                    ? \"Already Joined! üéØ\"\n                    : \"Join Now üéØ\"}\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n        {errorMsg && (\n          <div className=\"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm\">\n            {errorMsg}\n          </div>\n        )}\n        <div className=\"space-y-4\">\n          <section>\n            <div className=\"font-semibold mb-1\">Official üéØ</div>\n            <div className=\"text-xs opacity-70 mb-2\">\n              {cooldownUntil && cooldownUntil > Date.now() ? (\n                <>\n                  You‚Äôre a recent NDN tournament winner ‚Äî to keep it fair, you\n                  can re-enter after {fmt(cooldownUntil)}.\n                </>\n              ) : (\n                <>\n                  Note: Weekly winners can re-enter once their 3 months of\n                  PREMIUM ends.\n                </>\n              )}\n            </div>\n            <ul className=\"space-y-2\">\n              {official.map((t) => (\n                <li\n                  key={t.id}\n                  className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\"\n                >\n                  <div className=\"space-y-0.5\">\n                    <div className=\"font-semibold\">\n                      {t.title}{\" \"}\n                      {t.prize && (\n                        <span className=\"inline-flex items-center gap-1 ml-2 align-middle\">\n                          <span className=\"text-xs px-2 py-0.5 rounded bg-amber-500 text-black\">\n                            Prize\n                          </span>\n                          <span\n                            className=\"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help\"\n                            title=\"Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.\"\n                            aria-label=\"Prize info\"\n                          >\n                            i\n                          </span>\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"text-sm opacity-80\">\n                      {t.game}\n                      {t.game === \"X01\" && t.startingScore\n                        ? `/${t.startingScore}`\n                        : \"\"}{\" \"}\n                      ¬∑ {labelForMode(t.mode)} {t.value} ¬∑ {fmt(t.startAt)} ¬∑\n                      Cap {t.capacity} ¬∑ Joined {t.participants.length}\n                    </div>\n                    {t.prize && (\n                      <div className=\"text-xs\">Prize: 3 months PREMIUM</div>\n                    )}\n                    {t.status !== \"scheduled\" && (\n                      <div className=\"text-xs\">Status: {t.status}</div>\n                    )}\n                    {hasJoined(t) && (\n                      <div className=\"text-xs text-emerald-400 font-semibold\">\n                        Already Joined\n                      </div>\n                    )}\n                    {t.official &&\n                      cooldownUntil &&\n                      cooldownUntil > Date.now() && (\n                        <div className=\"text-xs text-rose-300\">\n                          Cooldown active until {fmt(cooldownUntil)}.\n                        </div>\n                      )}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className={`btn ${hasJoined(t) ? \"bg-emerald-600 hover:bg-emerald-600\" : \"\"}`}\n                      title={\n                        hasJoined(t)\n                          ? \"Double-click to leave this tournament\"\n                          : t.official &&\n                              cooldownUntil &&\n                              cooldownUntil > Date.now()\n                            ? `Recent winners can re-enter after ${fmt(cooldownUntil)}`\n                            : \"\"\n                      }\n                      disabled={\n                        loading ||\n                        t.status !== \"scheduled\" ||\n                        (!hasJoined(t) &&\n                          (t.participants.length >= t.capacity ||\n                            (t.official &&\n                              !!cooldownUntil &&\n                              cooldownUntil > Date.now())))\n                      }\n                      onClick={() => {\n                        if (!hasJoined(t)) {\n                          join(t);\n                        } else if (isTouch) {\n                          setLeaveAsk({ open: true, t });\n                        }\n                      }}\n                      onDoubleClick={() => {\n                        if (!isTouch && hasJoined(t))\n                          setLeaveAsk({ open: true, t });\n                      }}\n                      aria-label={hasJoined(t) ? \"Already Joined\" : \"Join Now\"}\n                    >\n                      {hasJoined(t) ? \"Already Joined! üéØ\" : \"Join Now üéØ\"}\n                    </button>\n                    {/* Delete button when you are the creator (owner-created official) and it hasn't started */}\n                    {t.status === \"scheduled\" &&\n                      email &&\n                      ((t.creatorEmail &&\n                        String(t.creatorEmail).toLowerCase() === email) ||\n                        email === \"daviesfamily108@gmail.com\") && (\n                        <button\n                          className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\n                          title=\"Delete this tournament\"\n                          onClick={() => deleteTournament(t)}\n                          aria-label=\"Delete tournament\"\n                        >\n                          √ó\n                        </button>\n                      )}\n                  </div>\n                </li>\n              ))}\n              {official.length === 0 && (\n                <li className=\"text-sm opacity-60\">\n                  No official tournaments yet.\n                </li>\n              )}\n            </ul>\n          </section>\n\n          <section>\n            <div className=\"font-semibold mb-1\">Community üéØ</div>\n            <ul className=\"space-y-2\">\n              {paginatedCommunity.map((t) => (\n                <li\n                  key={t.id}\n                  className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\"\n                >\n                  <div className=\"space-y-0.5\">\n                    <div className=\"font-semibold\">{t.title}</div>\n                    <div className=\"text-sm opacity-80\">\n                      {t.game}\n                      {t.game === \"X01\" && t.startingScore\n                        ? `/${t.startingScore}`\n                        : \"\"}{\" \"}\n                      ¬∑ {labelForMode(t.mode)} {t.value} ¬∑ {fmt(t.startAt)} ¬∑\n                      Cap {t.capacity} ¬∑ Joined {t.participants.length}\n                    </div>\n                    {t.description && (\n                      <div className=\"text-xs opacity-80\">{t.description}</div>\n                    )}\n                    {hasJoined(t) && (\n                      <div className=\"text-xs text-emerald-400 font-semibold\">\n                        Already Joined\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className=\"btn\"\n                      title={\n                        hasJoined(t)\n                          ? \"Double-click to leave this tournament\"\n                          : \"\"\n                      }\n                      disabled={\n                        loading ||\n                        t.status !== \"scheduled\" ||\n                        (!hasJoined(t) && t.participants.length >= t.capacity)\n                      }\n                      onClick={() => {\n                        if (!hasJoined(t)) {\n                          join(t);\n                        } else if (isTouch) {\n                          setLeaveAsk({ open: true, t });\n                        }\n                      }}\n                      onDoubleClick={() => {\n                        if (!isTouch && hasJoined(t))\n                          setLeaveAsk({ open: true, t });\n                      }}\n                    >\n                      {hasJoined(t) ? \"Already Joined\" : \"Join Now\"}\n                    </button>\n                    {/* Delete button for creator to delete their own scheduled tournament */}\n                    {t.status === \"scheduled\" &&\n                      email &&\n                      ((t.creatorEmail &&\n                        String(t.creatorEmail).toLowerCase() === email) ||\n                        email === \"daviesfamily108@gmail.com\") && (\n                        <button\n                          className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\n                          title=\"Delete this tournament\"\n                          onClick={() => deleteTournament(t)}\n                          aria-label=\"Delete tournament\"\n                        >\n                          √ó\n                        </button>\n                      )}\n                  </div>\n                </li>\n              ))}\n              {community.length === 0 && (\n                <li className=\"text-sm opacity-60\">\n                  No community tournaments yet.\n                </li>\n              )}\n            </ul>\n            {/* Pagination Controls for Community */}\n            {communityTotalPages > 1 && (\n              <div className=\"flex items-center justify-center gap-2 mt-4 pt-2 border-t border-white/10\">\n                <button\n                  className=\"btn btn-sm btn-ghost\"\n                  disabled={communityPage === 1}\n                  onClick={() => setCommunityPage((p) => Math.max(1, p - 1))}\n                >\n                  Previous\n                </button>\n                <span className=\"text-sm opacity-70\">\n                  Page {communityPage} of {communityTotalPages}\n                </span>\n                <button\n                  className=\"btn btn-sm btn-ghost\"\n                  disabled={communityPage === communityTotalPages}\n                  onClick={() =>\n                    setCommunityPage((p) =>\n                      Math.min(communityTotalPages, p + 1),\n                    )\n                  }\n                >\n                  Next\n                </button>\n              </div>\n            )}\n          </section>\n        </div>\n\n        {showCreate && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"create-tournament-heading\"\n            tabIndex={-1}\n            className=\"fixed inset-0 z-[70] flex items-center justify-center bg-black/60 p-4\"\n            onClick={(e) => {\n              if (e.target === e.currentTarget) setShowCreate(false);\n            }}\n          >\n            <div className=\"bg-slate-800 rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3\n                  id=\"create-tournament-heading\"\n                  className=\"text-2xl font-semibold\"\n                >\n                  Create Tournament üéØ\n                </h3>\n                <button className=\"btn\" onClick={() => setShowCreate(false)}>\n                  Close ‚úï\n                </button>\n              </div>\n              <div className=\"space-y-4 md:space-y-0 md:grid md:grid-cols-2 md:gap-4\">\n                <div>\n                  <label className=\"block text-sm font-semibold mb-2\">\n                    Title\n                  </label>\n                  <input\n                    className=\"input w-full\"\n                    value={form.title}\n                    onChange={(e) =>\n                      setForm((f) => ({ ...f, title: e.target.value }))\n                    }\n                    placeholder=\"Enter tournament title\"\n                  />\n                </div>\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Game\n                    </label>\n                    <select\n                      className=\"input w-full\"\n                      value={form.game}\n                      onChange={(e) =>\n                        setForm((f) => ({ ...f, game: e.target.value }))\n                      }\n                    >\n                      {[\"X01\", \"Cricket\", \"Killer\"].map((g) => (\n                        <option key={g} value={g}>\n                          {g}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Mode\n                    </label>\n                    <select\n                      className=\"input w-full\"\n                      value={form.mode}\n                      onChange={(e) =>\n                        setForm((f) => ({ ...f, mode: e.target.value as any }))\n                      }\n                    >\n                      {getModeOptionsForGame(\n                        form.game as import(\"../utils/games\").GameKey,\n                      ).map((o) => (\n                        <option key={String(o)} value={String(o)}>\n                          {labelForMode(String(o))}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Number\n                    </label>\n                    <input\n                      className=\"input w-full\"\n                      type=\"number\"\n                      min={1}\n                      value={form.value}\n                      onChange={(e) =>\n                        setForm((f) => ({\n                          ...f,\n                          value: Number(e.target.value),\n                        }))\n                      }\n                    />\n                  </div>\n                </div>\n                <div>\n                  <label className=\"block text-sm font-semibold mb-1\">\n                    Description\n                  </label>\n                  <textarea\n                    className=\"input w-full\"\n                    rows={5}\n                    value={form.description}\n                    onChange={(e) =>\n                      setForm((f) => ({ ...f, description: e.target.value }))\n                    }\n                  />\n                </div>\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Start time\n                    </label>\n                    <input\n                      className=\"input w-full\"\n                      type=\"datetime-local\"\n                      value={form.startAt}\n                      onChange={(e) =>\n                        setForm((f) => ({ ...f, startAt: e.target.value }))\n                      }\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      Check-in reminder (min)\n                    </label>\n                    <input\n                      className=\"input w-full\"\n                      type=\"number\"\n                      min={0}\n                      value={form.checkinMinutes}\n                      onChange={(e) =>\n                        setForm((f) => ({\n                          ...f,\n                          checkinMinutes: Number(e.target.value),\n                        }))\n                      }\n                    />\n                  </div>\n                </div>\n                {form.game === \"X01\" && (\n                  <div>\n                    <label className=\"block text-sm font-semibold mb-1\">\n                      X01 Starting Score\n                    </label>\n                    <select\n                      className=\"input w-full\"\n                      value={String(form.startingScore)}\n                      onChange={(e) =>\n                        setForm((f) => ({\n                          ...f,\n                          startingScore: Number(e.target.value),\n                        }))\n                      }\n                    >\n                      {[301, 501, 701].map((s) => (\n                        <option key={s} value={s}>\n                          {s}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                )}\n                <div>\n                  <label className=\"inline-flex items-center gap-2 text-sm\">\n                    <input\n                      type=\"checkbox\"\n                      className=\"accent-purple-500\"\n                      checked={!!form.requireCalibration}\n                      onChange={(e) =>\n                        setForm((f) => ({\n                          ...f,\n                          requireCalibration: !!e.target.checked,\n                        }))\n                      }\n                    />\n                    <span className=\"font-semibold\">Require Camera</span>\n                  </label>\n                  <div className=\"text-xs opacity-70 mt-1\">\n                    If checked, players must have a camera connected to join\n                    matches spawned from this tournament.\n                  </div>\n                </div>\n                <div>\n                  <label className=\"block text-sm font-semibold mb-1\">\n                    Capacity\n                  </label>\n                  <input\n                    className=\"input w-full\"\n                    type=\"number\"\n                    min={6}\n                    max={64}\n                    value={form.capacity}\n                    onChange={(e) =>\n                      setForm((f) => ({\n                        ...f,\n                        capacity: Number(e.target.value),\n                      }))\n                    }\n                  />\n                </div>\n                <div className=\"text-xs opacity-70\">\n                  Note: community tournaments do not award prizes.\n                </div>\n                <div className=\"flex justify-end gap-3 mt-6\">\n                  <button\n                    className=\"btn btn-ghost\"\n                    onClick={() => setShowCreate(false)}\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    className=\"btn\"\n                    disabled={loading}\n                    onClick={createTournament}\n                  >\n                    {loading ? \"Creating...\" : \"Create Tournament\"}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Join Modal (simplified) */}\n        {joinMatch && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"join-heading\"\n            tabIndex={-1}\n            className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4\"\n          >\n            <div className=\"bg-slate-800 rounded-2xl p-6 max-w-md w-full\">\n              <div id=\"join-heading\" className=\"text-lg font-bold mb-2\">\n                Match Ready\n              </div>\n              <div className=\"mb-3\">\n                {joinMatch.game} - {joinMatch.modeType} ¬∑ {joinMatch.legs} legs\n              </div>\n              <div className=\"text-sm opacity-80 mb-3\">\n                Created by {joinMatch.createdBy}\n              </div>\n              {joinMatch.startingScore && (\n                <div className=\"mb-3\">\n                  Starting score:{\" \"}\n                  <span className=\"font-mono\">{joinMatch.startingScore}</span>\n                </div>\n              )}\n              {/* Match start showcase overlay */}\n              <MatchStartShowcase\n                open={showStartShowcase}\n                players={match.players as any}\n                user={user}\n                onRequestClose={() => {}}\n                onDone={() => {}}\n              />\n              <div className=\"mb-3\">\n                Timer: <span className=\"font-mono\">{joinTimer}s</span>\n              </div>\n              {(joinTimer <= 15 || (joinMatch as any)?.prestartEndsAt) && (\n                <div className=\"mb-3\">\n                  Choose:{\" \"}\n                  <div className=\"flex gap-2\">\n                    <button\n                      className={`btn ${joinChoice === \"bull\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"bull\")}\n                    >\n                      Bull Up\n                    </button>\n                    <button\n                      className={`btn ${joinChoice === \"skip\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"skip\")}\n                    >\n                      Skip\n                    </button>\n                  </div>\n                  <div className=\"text-xs opacity-70 mt-2\">\n                    {joinChoice\n                      ? `You chose: ${joinChoice}`\n                      : \"Please choose Bull Up or Skip before accepting\"}\n                  </div>\n                  {Object.keys(remoteChoices).length > 0 && (\n                    <div\n                      className=\"text-xs opacity-70 mt-2\"\n                      role=\"status\"\n                      aria-live=\"polite\"\n                    >\n                      {Object.entries(remoteChoices).map(([pid, choice]) => (\n                        <div key={pid}>\n                          {participants[pid] || pid} chose: {choice}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  {joinChoice === \"skip\" && (\n                    <div className=\"text-xs opacity-70 mt-2\">\n                      Skip requires both players to click Skip. Waiting for\n                      opponent...\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {leaveAsk.open && leaveAsk.t && (\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n            <div\n              className=\"absolute inset-0 bg-black/40\"\n              onClick={() => setLeaveAsk({ open: false, t: null })}\n            />\n            <div className=\"relative card p-4 w-[360px] max-w-[90vw]\">\n              <div className=\"text-lg font-semibold mb-2\">\n                Leave tournament?\n              </div>\n              <div className=\"text-sm opacity-80 mb-4\">\n                Are you sure you want to remove yourself from ‚Äú\n                {leaveAsk.t.title}‚Äù?\n              </div>\n              <div className=\"flex items-center justify-end gap-2\">\n                <button\n                  className=\"btn bg-rose-600 hover:bg-rose-700\"\n                  onClick={() => setLeaveAsk({ open: false, t: null })}\n                >\n                  Decline\n                </button>\n                <button\n                  className=\"btn bg-emerald-600 hover:bg-emerald-700\"\n                  onClick={async () => {\n                    const t = leaveAsk.t!;\n                    setLeaveAsk({ open: false, t: null });\n                    await leave(t);\n                  }}\n                >\n                  Accept\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Delete Tournament Confirmation Modal */}\n        {deleteConfirm.open && deleteConfirm.t && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n            <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\n              <div className=\"text-center\">\n                <div className=\"text-xl font-semibold mb-4 text-white\">\n                  Delete Tournament\n                </div>\n                <div className=\"text-slate-300 mb-6\">\n                  Are you sure you want to delete{\" \"}\n                  <span className=\"font-semibold text-white\">\n                    \"{deleteConfirm.t.title}\"\n                  </span>\n                  ?\n                  <br />\n                  <span className=\"text-sm text-slate-400\">\n                    This action cannot be undone.\n                  </span>\n                </div>\n                <div className=\"flex gap-3 justify-center\">\n                  <button\n                    className=\"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\n                    onClick={() => setDeleteConfirm({ open: false, t: null })}\n                  >\n                    Decline\n                  </button>\n                  <button\n                    className=\"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors\"\n                    onClick={confirmDeleteTournament}\n                  >\n                    Continue\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Phone camera overlay removed per UX preference; header badge preview only */}\n      </div>\n    </div>\n  );\n}\n"],"names":["MatchCard","t","onJoin","onLeave","joined","disabled","jsxs","jsx","labelForMode","containsIntegrationMarker","value","isIntegrationTournament","isTouch","Tournaments","user","toast","useToast","wsGlobal","useWS","_matchType","_setMatchType","_teamAName","_setTeamAName","_teamBName","_setTeamBName","useUserSettings","list","setList","useState","loading","setLoading","errorMsg","setErrorMsg","_fetchError","setFetchError","lastRefresh","setLastRefresh","cooldownUntil","setCooldownUntil","showCreate","setShowCreate","showDemoStart","setShowDemoStart","showStartShowcase","setShowStartShowcase","useRef","inProgress","useMatch","s","roomId","useEffect","st","flagKey","openMatchWindow","form","setForm","joinMatch","setJoinMatch","joinTimer","setJoinTimer","joinChoice","setJoinChoice","remoteChoices","setRemoteChoices","_bullActive","setBullActive","_bullThrown","setBullThrown","_bullLocalThrow","setBullLocalThrow","_bullWinner","setBullWinner","leaveAsk","setLeaveAsk","deleteConfirm","setDeleteConfirm","serverPrestartRef","participants","setParticipants","msg","m","prev","endsAt","playerId","choice","v","match","sendPrestartChoice","refresh","data","apiFetch","newList","err","unsub","iv","email","showDemoControls","runTournamentInPlayDemo","launchInPlayDemo","hasJoined","p","MatchPrefs","abort","check","deleteTournament","confirmDeleteTournament","res","join","fmt","leave","it","createTournament","start","details","onKey","e","visibleTournaments","useMemo","official","community","created","createdPage","setCreatedPage","itemsPerPage","createdTotalPages","paginatedCreated","communityPage","setCommunityPage","communityTotalPages","paginatedCommunity","nextOfficial","a","b","ts","MatchStartShowcase","Fragment","f","g","getModeOptionsForGame","o","pid"],"mappings":"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"}
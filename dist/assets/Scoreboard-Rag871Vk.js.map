{"version":3,"file":"Scoreboard-Rag871Vk.js","sources":["../../src/components/Scoreboard.tsx"],"sourcesContent":["import { useMatch } from '../store/match'\r\nimport { formatAvg } from '../utils/stats'\r\nimport { Undo2 } from 'lucide-react'\r\nimport { useState } from 'react'\r\nimport { addMatchToAllTime } from '../store/profileStats'\r\nimport { usePendingVisit } from '../store/pendingVisit'\r\n\r\nexport default function Scoreboard() {\r\n  const [score, setScore] = useState<number>(0)\r\n  const [darts, setDarts] = useState<number>(3)\r\n  const { players, currentPlayerIdx, addVisit, undoVisit, endLeg, nextPlayer, endGame, inProgress, startingScore, bestLegThisMatch } = useMatch()\r\n  const pendingEntries = usePendingVisit(s => s.entries)\r\n\r\n  const current = players[currentPlayerIdx]\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-4\">\r\n      <div className=\"col-span-2 card\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Score Input</h2>\r\n        {inProgress ? (\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <input className=\"input w-32\" type=\"number\" value={score} onChange={e => setScore(parseInt(e.target.value || '0'))} placeholder=\"Score\" />\r\n              <select className=\"input\" value={darts} onChange={e => setDarts(parseInt(e.target.value))}>\r\n                <option value={1}>1 dart</option>\r\n                <option value={2}>2 darts</option>\r\n                <option value={3}>3 darts</option>\r\n              </select>\r\n              <button\r\n                className=\"btn\"\r\n                onClick={() => {\r\n                  // Compute remaining before we update store, to decide auto-advance\r\n                  const p = players[currentPlayerIdx]\r\n                  const leg = p.legs[p.legs.length - 1]\r\n                  const prevRemaining = leg ? leg.totalScoreRemaining : startingScore\r\n                  const newRemaining = Math.max(0, prevRemaining - (Number.isFinite(score) ? score : 0))\r\n\r\n                  addVisit(score, darts)\r\n                  setScore(0)\r\n\r\n                  if (newRemaining === 0) {\r\n                    // Finish leg automatically with this checkout\r\n                    endLeg(score)\r\n                  } else {\r\n                    // Move to next player automatically after a visit\r\n                    nextPlayer()\r\n                  }\r\n                }}\r\n              >Add Visit</button>\r\n              <button className=\"px-3 py-2 rounded-xl border border-slate-200\" onClick={() => undoVisit()} title=\"Undo\">\r\n                <Undo2 className=\"w-4 h-4\" />\r\n              </button>\r\n            </div>\r\n              <div className=\"flex items-center gap-2\">\r\n              <button className=\"btn\" onClick={() => { endLeg(score); setScore(0); }}>End Leg (Checkout {score || 0})</button>\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => nextPlayer()}>Next Player</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={() => {\r\n                try {\r\n                  // Build a lightweight summary for the last finished match and persist it to localStorage\r\n                  const summary = {\r\n                    ts: Date.now(),\r\n                    players: players.map(p => {\r\n                      const totals = p.legs.reduce((acc, L) => {\r\n                        acc.points += (L.totalScoreStart - L.totalScoreRemaining)\r\n                        const legDarts = (L.visits || []).reduce((a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0), 0)\r\n                        acc.darts += legDarts\r\n                        return acc\r\n                      }, { points: 0, darts: 0 })\r\n                      const dartsThrown = totals.darts\r\n                      const avg = dartsThrown > 0 ? ((totals.points / dartsThrown) * 3) : 0\r\n                      return {\r\n                        id: p.id,\r\n                        name: p.name,\r\n                        legsWon: p.legsWon,\r\n                        dartsThrown,\r\n                        avg: Math.round(avg * 100) / 100,\r\n                      }\r\n                    }),\r\n                    winner: players.reduce((best, p) => p.legsWon > (best?.legsWon || 0) ? p : best, players[0])?.name,\r\n                  }\r\n                  try { localStorage.setItem('ndn_last_match', JSON.stringify(summary)) } catch {}\r\n                } catch (err) {}\r\n                addMatchToAllTime(players); endGame()\r\n              }}>End Game</button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-slate-600\">No game in progress.</p>\r\n        )}\r\n\r\n        <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          {players.map((p, idx) => {\r\n            const currentLeg = p.legs[p.legs.length-1]\r\n            const remaining = currentLeg ? currentLeg.totalScoreRemaining : startingScore\r\n            // TV-style 3-dart avg across the entire match (all legs): sum(points)/sum(darts)*3\r\n            const totals = p.legs.reduce((acc, L) => {\r\n              acc.points += (L.totalScoreStart - L.totalScoreRemaining)\r\n              const legDarts = (L.visits || []).reduce((a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0), 0)\r\n              acc.darts += legDarts\r\n              return acc\r\n            }, { points: 0, darts: 0 })\r\n            const dartsThrown = totals.darts\r\n            const avg = dartsThrown > 0 ? ((totals.points / dartsThrown) * 3) : 0\r\n\r\n            return (\r\n              <div key={p.id} className={`card glass ${idx === currentPlayerIdx ? 'ring-2 ring-brand-400' : ''}`}>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-lg font-semibold\">{p.name}</h3>\r\n                  <span className=\"badge\">Legs Won: {p.legsWon}</span>\r\n                </div>\r\n                <div className=\"mt-3 grid grid-cols-3 gap-2 text-center\">\r\n                  <div className=\"p-3 rounded-xl bg-white/10 border border-white/10\">\r\n                    <div className=\"text-xs text-slate-500\">Remaining</div>\r\n                    {idx === currentPlayerIdx && (\r\n                      <div className=\"flex items-center justify-center gap-2 mt-1\" aria-label={`Visit status for current player`}>\r\n                        {[0,1,2].map(i => {\r\n                          const e = pendingEntries[i] as any\r\n                          const isPending = !e\r\n                          const isHit = !!e && (typeof e.value === 'number' ? e.value > 0 : true)\r\n                          const color = isPending ? 'bg-gray-400/70' : (isHit ? 'bg-emerald-400' : 'bg-rose-500')\r\n                          return <span key={i} className={`w-2.5 h-2.5 rounded-full shadow ${color}`} />\r\n                        })}\r\n                      </div>\r\n                    )}\r\n                    <div className=\"text-2xl font-bold\">{remaining}</div>\r\n                    <div className=\"h-1 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                      <div className=\"h-full bg-emerald-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (remaining / startingScore)) * 100))}%` }} />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"p-3 rounded-xl bg-white/10 border border-white/10\">\r\n                    <div className=\"text-xs text-slate-500\">Darts</div>\r\n                    <div className=\"text-2xl font-bold\">{dartsThrown}</div>\r\n                  </div>\r\n                  <div className=\"p-3 rounded-xl bg-white/10 border border-white/10\">\r\n                    <div className=\"text-xs text-slate-500\">3-Dart Avg</div>\r\n                    <div className=\"text-2xl font-bold\">{formatAvg(avg)}</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n\r\n        {bestLegThisMatch && (\r\n          <div className=\"mt-4 p-3 rounded-xl bg-emerald-50 border border-emerald-200\">\r\n            <strong>Best Leg (this match):</strong> Player {players.find(p => p.id === bestLegThisMatch.playerId)?.name} in {bestLegThisMatch.darts} darts\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"card\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Legs Summary</h2>\r\n        <div className=\"space-y-3\">\r\n          {players.map((p) => (\r\n            <div key={p.id} className=\"p-3 rounded-xl bg-slate-50 border border-slate-200\">\r\n              <div className=\"font-semibold\">{p.name}</div>\r\n              <div className=\"text-sm text-slate-600\">Completed Legs: {p.legs.filter(l => l.finished).length}</div>\r\n              {!inProgress && (\r\n                <div className=\"mt-2 grid grid-cols-2 gap-2 text-sm\">\r\n                  <div className=\"p-2 rounded-lg bg-white border\">\r\n                    <div className=\"text-slate-500\">Best 3-Dart</div>\r\n                    <div className=\"font-semibold\">{formatAvg(p.bestThreeDartAvg)}</div>\r\n                  </div>\r\n                  <div className=\"p-2 rounded-lg bg-white border\">\r\n                    <div className=\"text-slate-500\">Worst 3-Dart</div>\r\n                    <div className=\"font-semibold\">{formatAvg(p.worstThreeDartAvg)}</div>\r\n                  </div>\r\n                  <div className=\"p-2 rounded-lg bg-white border\">\r\n                    <div className=\"text-slate-500\">Best 9-Dart (fewest darts)</div>\r\n                    <div className=\"font-semibold\">{p.bestNineDart ? `${p.bestNineDart.darts} darts` : '—'}</div>\r\n                  </div>\r\n                  <div className=\"p-2 rounded-lg bg-white border\">\r\n                    <div className=\"text-slate-500\">Best Checkout</div>\r\n                    <div className=\"font-semibold\">{p.bestCheckout ?? '—'}</div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":["Scoreboard","score","setScore","useState","darts","setDarts","players","currentPlayerIdx","addVisit","undoVisit","endLeg","nextPlayer","endGame","inProgress","startingScore","bestLegThisMatch","useMatch","pendingEntries","usePendingVisit","jsxs","jsx","e","p","leg","prevRemaining","newRemaining","Undo2","summary","totals","acc","L","legDarts","a","v","dartsThrown","avg","best","addMatchToAllTime","idx","currentLeg","remaining","i","isPending","isHit","color","formatAvg","l"],"mappings":"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"}